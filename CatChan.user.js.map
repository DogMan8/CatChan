{"version":3,"sources":["CatChan.user.js"],"names":["pref_default","for_save","proto","image_hover","image_prefetch","click","click_area","format","show","style","contents","layout","posts","fileinfo","images_2nd","hover","search","thumb","resize","size","small","w1","h1","w2","h2","large","vsmall","custom","c","width","height","max","ec","footer","use","nrtm","nr","rp","rp0","im","domain","board","no","flag","tag","page","design","rOP","iOP","pref0","native","custom2","custom3","ctime","btime","ptime","rctime","rbtime","rptime","br","prate","archived","nd","nl","nf","nid","ns","triage","menu","triage_str","menu_str","merged_tag","nr0","nr1","nr1_style","nrtm0","nrtm1","nrtm1_style","triage_hover","draw_on_demand","load_on_demand","load_on_demand_timeout","t2h_sel","t2h_L","t2h_M","t2h_N","this","t2h_num_of_posts","save_board_list_sel","board_list_sel","mark_new_posts","auto_update","auto_update_period","auto_update_countdown","storePosts","sourceOfSP","searchAs","searchAsA","searchAc","loosen","max_threads","max_threads_at_refresh","popup","colorID","backlink","popup_truncated","popup_zIndex","backlink_all","backlink_all_cross","popup_hlt","bl_ec","bl_rm","popup_delay","popdown_delay","popdown","popup_mMove","inline_post","link_show_op","link_show_cross","expand_thumbnail_inline","localtime","expand_thumbnail_inline_all_after","hide_posts_without_images","thumbnail","inline","ondemandStop","stopHover","ref_height","limit_width","limit_height","margin_width","margin_height","webm","webm_mute","webm_loop","webm_ctrl","dragfloat","df_dblC","df_mW","zoom_click","zoom_over","zoom_dblC","zoom_mW","infoPv","popupX","ID","name","anon","trip","ID2","open_spoiler_text","open_spoiler_image","merge","merge_list","merge_list_str","merge_list_obj6","merge_truncated","merge_lv","merge_lv_str","merge_lv_obj6","merge_auto_list","merge_auto_list_lv","merge_auto_list_lv_add","merge_op_auto","merge_op_lv","merge_op_lv_add","merge_op_auto_hop","merge_op_lv_inc","merge_op_attr","merge_op_list","merge_btn","merge_btn_mode","merge_btn_lv","merge_btn_lv_add","lazyDraw","merge_step","step","scroll_lock","use_expander_always","popup2_sel","popup2_sel_tolerance","popup2_resize","popup2_resize_bw","popup2_resize_cw","popup3","ww","wn","nw","nn","oX","oY","posts_search_op","posts_search_op_opacity","deleted_posts","detect","store","auto_clean","detect_sage","page_his","promiscuous","accept_others_refresh","hide_unwatched","refresh_src","refresh_src_th","postMenu","appearance","titleBar","filter","settings","refresh","boards_selector","initial","state","left","top","orderOnTB","expand","kwd","time","list","ctrl","imagesearch","google","iqdb","saucenao","whatAnime","desustorage","exhentai","safety","hide","remove","triage_place","env","disp_offset","disp_filler","popup_native","expand_thumbnail_inline_native","image_hover_native","colorID_native","backlink_native","localtime_native","auto_update_native","event_dynamic","popup_native_kill","refresh_initial","kwd_filter_delay","kwd_filter_delay_len","pref_new","script_prefix","features","graph","setting","setting2","postform","catalog","listener","uip_tracker","thread_reader","debug","notify","desktop","sound","favicon","recovery","domains","common_func","Array_toObj","site0","max_capture","interval_found","write_to_ls","aggregator","server","load_pref","load_data","check_page","check_post","check_thread","import_format","max_graph","scale_thread","auto_start","prevent_redirection","graph_animation","autoconf","info_server","info_client","wafd_tb","wafd_open_spoiler","show_page_fraction","catalog_max_page","catalog_max_page_auto","catalog_max_page_select","catalog_snoop_refresh","catalog_auto_rollup_when_moving","catalog_size_frame0_width","catalog_size_frame1_width","catalog_2nd_images_show","catalog_2nd_images_hover","catalog_2nd_images_search","catalog_posts_on_demand","catalog_popup_size_fix","catalog_open_last50","catalog_board_list_str","catalog_board_list_obj","catalog_promiscuous","catalog_board_list_sel","cataLog","embed_mode","val","localtime_offset","Date","getTimezoneOffset","catalog_footer_ignore_my_own_posts","catalog_footer_tag_letters","catalog_no_popup_at_expanded","catalog_open_in_new_tab","catalog_open_where","catalog_open_where_click","catalog_triage_hist","hide_toggle","sync_ex","sync_attr","sync_watch","postMenu_str","catalog_triage_str","catalog_auto_update_countdown","catalog_expand_with_hr","cli","auto","json_str","eval_str","tooltips","help","info","zIndex","str","re","ci","match","sentence","ew","op","post","inPost","sub","com","file","meta","id","id2","rexps","tag_ci","time_creation","time_str","now","toLocaleString","time_obj6","time_ago_str","time_ago_str_sync_at_refresh","desktopime_mark_str","time_watch","time_watch_creation","list_time_scroll","list_str","list_obj2","attr_list","attr_list_str","attr_list_obj2","bookmark_list","bookmark_list_str","bookmark_list_obj2","watch_list_str","watch_list_obj2","tag_search","show_nof_boards","pref","liveTag","tag2bList","label","by","auto_list","obj7","kill","watch","sticky","style_str","disLWKA","disTWKA","postFilter","boards","boards_str","obj7_old","bookmark_list_rm404","auto_load_filter","auto_save_filter","auto_save_filter_at_refresh","ignore","recommendation","all_boards","board_tags","ex_list","ex_list_str","ex_list_obj2","board_tags_same","style_general_list","style_general_list_str","style_general_list_obj2","except_bt","at_switch","catalog_json","embed","embed_page","embed_frame","embed_archive","order","reply_to_me","reply","ordering","auto_watch","auto_watch_override","auto_watch_override_str","mimic_base_site","__proto__","Object","create","infinite","thread","float","fc","view","catalog_size","catalog_teaser","disable_kwd_filter_at_initial","auto_launch","clone","headline","max_letters","common","clear_at_manual_scan","consolidated_filter","consolidated_watch_list","sync_watch_list","sync_watch_list_delay","watch_list_rm404","blur_404","on","deletion","interval","adaptive","highlight_str","annotate","auto_open","auto_open_th","auto_open_kwd","link","name_str","addName","addName_str","post_str","sage","tolerance","patch_bug","patch_bug2","patch_bug2nth","patch_bug3","patch_bug4","patch_bug5","annotate_page","sync","triage_close","check_num_of_children","own_posts_tracker","show_own_post_by","show_reply_to_me_by","clean_up_own_posts","unmark_on_hover","IDinfo","nof","h","t","indexing","gen","gen_str","cloudflare","auto_reload","auto_reload_time","scan","lifetime","crawler","crawler_adaptive","crawler_idle_time_to_spawn","max_archive","src","beep_freq","beep_length_f","beep_volume_f","new_thread","appear","supp_init","show_last","limit","brwsr","delay","title","hide_zero","maxstr","from","lock_tags_in_op","inherit_board_name","lock_board_name","inherit_board_tags","lock_board_tags","NC","ex","exurtm","exur","in","inurtm","inur","urtm","ur","pickup_interval","rm_404","disp_delay","fg","bg","click_func","click_func_bl","watch_all","lazy_each","lazy_delay","ex_list_obj5","rm_list","rm_list_str","rm_list_obj5","virtualBoard","scanDelay","p_board","p_remove","v_remove","scan_domains","instant_scan","tagSearch","th_b","th_t","sel","fix","titleBar_str","window_str","popUp_str","copy","post_editing","post_new","userCSS","tips","merged1","merged1_str","merged2","merged2_str","merged3","merged3_str","addSS","comment","healthIndicator","expand_running","dont_retire_running","cancel","network","cross_domain","fetch_actively","th100","th100_delay","th20","th20_delay","timeout","overXFO","overCSPF","stats","retain_404","draw_delay","estimate_posts","save","load","len_capture","auto_acquisition","auto_acquisition_scan","auto_acquisition_scan_delay","auto_acquisition_all","tolerant","patch_tm","chart","off_anime_blur","window_width","window_height","inst","len","time_sel","board_sel","show_legend","np","p","ep","nt","et","clip_np","clip_np_val","options","bezierCurve","animation","pointDot","pointDotRadius","archive","load_img","restore_auto","clear_threads","clear_files","store_auto","dir_dled","open_local","fix_inconsistency","store_watched","oneshot","tn","img","post_idb","tn_idb","img_idb","webm_idb","live","deleted","IDB","auto_clean_init","prune","prune_flush","nof_tr","nof_cl","nof_cl_max","auto_restore","auto_restore_watch","auto_restore_remove","watchdog","redirect_404","redirect_404_CSP","list_obj6","list_inherit","tar","tarsize","sub_in_filename","files_sel","IDB_board_sel","IDB_board_sel_gfunc_pre","pref4","IDB_thread_sel","IDB_thread_sel_gfunc_pre","IDB_select_multiple","editing_timeout","threadStats","full","retry","debug_mode","unread_count","parse_error","site2func","site2func_expand","pfunc","pfunc_expand","pfunc_all","pfunc_all_expand","pfunc_comp","pfunc_comp_expand_same","pfunc_comp_expand_diff","pfunc_comp_proto","debug_domains","types","debug_types","test_mode","num","num_f","test_str","patch","delayed_invoke","sec","rm_404_blacklist","pref2","KC","summer_time","meguca","historyAPI","utilize_boards_json","utilize_boards_json_domain","8chan","BBC","easy","posts_ago","threads_ago","max_boards","easy2","reset","presets","time_post","time_op","basics","VB","local","global","LTfrom","limits","INST","i","pref_default2","pref_func","pref_overwrite","delete_null","defineProperty","get","samples","Object_modifyDescriptor","writable","value","configurable","make_port_parent","win","initialize","e","console","log","window","data","source","RegExp","site","nicknames","join","test","embed_frame_win","whereami","indexOf","ff","init_receive_port","ports","removeEventListener","init_func","messages_to_send","length","send_message","addEventListener","make_port_child","parent","postMessage","channel","MessageChannel","port1","port2","port","receive_func","receive_message","onmessage","start","close_connection","close","message","Array","isArray","push","JSON","stringify","substr","receive_message_emu","send_message_emu","shift","key","jump_to_time","th","idx","site2","mark_newer_posts2","tgt_post","gGEH","marked_first_post","time_tu","tgt_top","pn","offsetTop","pClg","show_catalog_delayed","parentNode","offsetHeight","scrollTo","header_height","document","body","clientHeight","innerHeight","toString","received_messages_404","parse","httpd","sub_funcs","archiver","myself","time_jumped","mode","threads","common_obj","mark_posts_from_parent","prep_own_posts_event_received","site3","own_posts","catalog_obj","catalog_func","triage_exe_pipe","annotate_from_catalog","setTimeout","close_all","make_uip_tracker","uip_check","uip_tracker_id","nickname","uip_show","sage_detect","uip_show_2","uip_show_from_doc","post_uip","uip_show_3","time_req","clearTimeout","waste_count","uip_retry","tgt_uip","uip_tgt_post","pn_uip","createElement","innerHTML","childNodes","setAttribute","pn_posts","map","v","insertBefore","j","sage_annotate","pn_page","his","show_page","lastChild","post_nums","uip_post_num","appendChild","pn_first","splice","from_http","status","parse_json_thread","response","responseText","nof_posts","uips","last_updated","last_no","date","toLocaleTimeString","posts_new","posts_old","post_hilight","posts_deleted","undefined","p0","uip_tracker_destroy","vals","email","uip_first","nos","uip_last","slice","concat","removeChild","page_len_in","page_len","sage_scheduled","sage_done","page2num","page_his_update","pref_obj","pn_name","parse_funcs","textContent","obj","Math","floor","ps","split","parseInt","observer","disconnect","MutationObserver","observe","childList","auto_open_prep","max_no","auto_open_check","rx","threads_req","threads_opened","open","make_url4","pn_test","pn_a","getElementsByTagName","tgt","keys","http_req","destroy","uip_tracker_init","make_thread_reader","add_event_to_submit","check_reply","remake_own_posts","get_my_posts_no","remove_event_from_submit","thread_html","time_unit","favicon_obj","favicon_obj_trim","target","site_live","wrap_to_parse","end","updated","new_posts","init","sort","a","b","update_own_posts","favicon_check","document_body","scrollTop","ref_height_checked","notifier","set","opener","triage_multicast","triage_exe_tr","cmd","attr","show_hide","triage_exe_broadcast","triage_exe","com0","com1","get_checked_time","setup_submit","inst_submit","postform_submit","mems","wt","get_flag","localStorage","my_posts","parse_funcs_html","createTextNode","nextSibling","add_you","event_submit","components","btns_p","pn_ref","embed_to","Triage","onclick","inst_submit2","postform_submit2","tacks","WeakMap","catalog_get_native_area","tagName","dataset","tack","delete","func_float","cnst","tack_float_nSblgs","func_embed","tack_dock_nSblgs","previousSibling","dispatchEvent","MouseEvent","bubbles","cancelable","display","overflow","classList","addedNodes","make_tack","set_tack_float","previousElementSibling","observer_IDinfo","entry","pf","pfID","IDop","pfID2","ID2op","pfFlag","flagIDs","tripNames","nameTrips","done","add","prop_pn","prop","combo","combo_prop","show_IDop","post_prop","prep","show_pn","sanitize","m","header","trailer","total","obj_combo","show_op","pns","firstChild","redraw","remove_pn","Set","prep_pfunc","has","onchange_funcs","Tooltips","remove_root","setup_submit2","thread_reader_init","make_catalog_obj","pn12_button","set_embed_xxxx","make_catalog","make_watcher","embed_catalog","embed_embed","reentry_0_patch","clg","gClg","get_ref_height","Clg","prototype","AllThreads","idxs","hide_prev_float","currentTarget","show_prev_dock","tack_dock_e2tack","window_beforeunload","Clgs","triage_parent_set","triage_parent","pn12_1","ppn","pppn","args","stop_loop","lth","getFromName","UnsyncedTriages","merge_deleted_posts","t2h","update_posts_merge_prep","pd","expand_shrink_thread","show_catalog_hr","click_link","preventDefault","href","open_new_thread","get_key_recursive","url","dbt","fullname2dbt","archiveFile","name2dbt","short_link","as","getAttribute","window_name","names","merge_bases","query_merged_keys","time_marked","get_watch_time_of_a_thread","reduce","historyAPI_blocking","pgh","sg","sID","lastModified","triages","triage_event","get_now_height","threads_idx_debug","y","count","threads_idx","show_catalog_skip_hs","ref_count","c_len","class_hs","className","func","horizontal_separator_in_index","make_refresh_list","not_initial","tgts","tgt_domains","str2obj","blist","domains_for_all_boards","callback","get_boards_json","health_indicator","bds_picked_up_by_tags","prep_reserved_tags","bd","replace","name2domainboardthread","max_page_bd","pgs","max_page","trim_list","embed_init","merge_obj5","pref3","bds","drawn_idx","catalog_refresh","from_auto","from_switch","catalog_refresh_end","th_count","d","ths","tags_ci","tags","show_catalog","insert_myself","force_annotate","nativeUpdate2pn","posts_updated","insert_thread_from_native","site_no","parse_options","insert_thread_from_native_prep","scan_boards","scan_boards_keyword_callback2","ext_posts","scan_boards_keyword_callback2_default_args","enumerable","arr","call","querySelectorAll","forEach","bases","posts_others","lths","tgt_ths","retval","posts_shown","merge_dp","recovered","nos_updated","nof_files","tn_imgs","catalog_insert","scan_init","crawler_max","tgt_raw","restore_bd_from_IDB","req","restore_bd_from_IDB_1","restore_th_from_IDB","n","r","event_funcs","rm_items_404_check","rm_404_list","nos_recovered","rm_items_404_0","lbd","LS_synced","clean_up_LS","IDB_synced","clean_up","rm_items_404_th","no_in","rm_items_404_1","Remove_thread_refresh","rm_404_1","rm_items_404_2","merge_list_obj2","pnOrDummy","merge_lv_obj2","view_attr_set","gpf","pf_merged","watch_list","Sync_watch_save","obj2","str_in","rm_items_404_delete","rm_items_404_delete_merge","db","obj_r","fmt4str2","keep","watched","PRUNED","_rm","comment_out_bookmark","pn12_0_4","comment_out_key","apply_prep","rep_str","clone_clg","clone_threads","GEH","catalog_native_prep_watcher","catalog_native_prep","pn12_0","pn2","viewChanged","make_prog_str","prog","running","IDX","found_threads","scanned","found_boards","mouseover","req_show","show_tooltip","stat","prog_str","cancel_button","html","initiator","priority","err_str","abort_str","tooltip_func","show_2","mouseout","hide2","cancel_scan","ABORT","disp","shrink_running","elems","HealthIndicator","dual","pn_countdown","dom","pn_hi","cloneNode","pn2_countdown","pn2_hi","col","remove_from_parent","elem","HealthIndicatorElement","countdown","onmouseover","onmouseout","show_tooltip_delayed","DelayBuffer","bind","get_bound_func","report","result","SUC","set_health_indicator","Footer","mode_fmt","timestamp","clean_idx","timestamp_set","realtime","update_all_force","flags","pn_menu_old","pn_menu","pn_triage_old","pn_triage","compile","add_remove_menu","replace_menu","update_force","merge_consolidate","tgt_th","insert_footer3","update","try_dirtifying_tag","test_dirty","draw","draw_merge","factory","prep_flag_dom","Element","importNode","post_flag2html","ts_refresh","refresh_start","formatted_arr","get_str","prep_footer3","footer_old","footer_native","type_parse","footer_prep","add_menu","country","footer2","func_menu","add_menu_1","remove_menu_1","func_triage","add_triage_1","remove_triage_1","add_remove_menu_iterate","add_remove_menu_1","mb","bases_iter","bases_unique","values","color_tag_node","query_tag_node","pn_merged","nextElementSibling","remove_nullify","draw_exe_1","footer1","create_tag_nodes","tag_node_onclick","replaceChild","recent_posts","deleted_after","flags_debug","getElementsByClassName","format_relative_time","rt","sign","at","abs","s","format_time","style_gt0","func_tmp","nums2","funcs","pg","nm","watched_p","RP","IM","lp","ta","dp","ar","nc","ni","ct","cT","bt","bT","pt","pT","pr","dn","sp","funcs_and_tags","IB","bumplimit","Ib","II","imagelimit","Ii","<iB","</iB","<iI","</iI","fmts","condensed","paste_wrap","l","paste_concat","tmp","paste_const","paste_tag","tag_o0","tag_o1","tag_cl","tag_open","compile_tag","tag_close","compile_rec","res","idx_l","lastIndexOf","arr_tag","fmt","count_src","count_funcs","child_class","tgt_th_in","lth_in","AutoUpdate","indicator","timer","time_remains","timer_tgt","from_refresh_button","restart","stop_if_running","dec","period","manual_refresh","oninput_funcs","filter.kwd.str","kwd_use","checked","kwd_mirror","filter_kwd_prep","filter.list_str","filter_changed","view_time_filter_changed","filter.attr_list_str","view_attr_changed","filter.tag_search.str","popup_filter","*.board_list_sel","adaptive_refresh","blur","board_list_sel_old","format_refresh_tgts","refresh_tgts","IDB_req","catalog.order.*","float.order.*","idx_re_sort","*.hide_unwatched","*.auto_update","*.auto_update_period","Drop now","clear_filters","clearOnly","blank","tag_use","loaded","getItem","load_save_key","time_quick_sel","pn_filter","filter_kwd_prep_init","filter_onchange","save_str","obj_elim_the_same","setItem","save_watch_list","key_wl","row_obj","filter.kwd.*","filter_kwd_active","filter.kwd.re","filter.kwd.match","filter.kwd.ci","filter.kwd.sentence","filter.kwd.ew","filter.tag","clgs","filter_changed_broadcast","filter.time","filter.time_creation","filter.time_str","filter.list","filter.watch_list_str","from_storage","Sync_watch_load","newValue","filter.attr_list","scanBoardIf","scanBoard","scanSiteIf","scanSite","required_only","keyword_load_1","keyword_load","filter.time_quick_sel","selectedIndex","filter.tag_search.re","filter.tag_search.show_nof_boards","tagB.*","cbx_all_onchange","add_tags_to_boardlist","add_to_auto","cmds","str2obj7","o2s","filter.*.style","filter.*.style_str","filter.postFilter.add","s2o","filter.postFilter.str w/","filter.postFilter.use w/","filter.postFilter.REDRAW","obj_remove","obj_added","obj_remove_global","format_html","filter.disLWKA","active","filter.disTWKA","INST.view","func_hide_all","remake_html_prep","liveTag.NC","lt","subscribed","unsubscribe","Setup_liveTag","clear_pruneds","rm_items_404_clearPRUNEDs","sticky_filter_settings","SHOW3.*w/","SHOW3","HIDE3.*w/","HIDE3","add_onchange_format","Object_defProps","update_posts_merge_bases","sw_cache","subscribe","styleSheet","register_cc","headline_css","css","watcher","show_catalog_cont","show_catalog_resize","show_catalog_scroll","show_catalog_buf","Show_catalog_buf","pf_original","deep_copy2","Clgs_count","pfai","pn12","init3","func_str","onrolldown","onrollup","exit","maximize","auto_roll","autoHeight","this_obj","permit_draw_on_demand","settings_after","comp","tb_funcs","pf_at","pn12_0_2","add_to_tb","icons","auto_shrink_board_selector","setup","IDB_indicator","set_indicator","pf_order","pf_ex","html_funcs","format_html_str","updates","rollup","design_of_fc","rollup_radio","make_sel","fm","idxs_req","Map","threads_odl","pppn_window","pns_resize","comps_0_4","native_size","triage_history","image_resize1_onload_bound","image_resize1_onload","image_resize2_onload_bound","image_resize2_onload","add_root","auto_shrink_selector",".","add_onchange","event_func","delayed_filter_changed","Watchdog","serialNo","catalog_float_prep","hook_set","all","tgts_in","show_catalog_scroll_lock","show_catalog_scroll_lock_factory","val_old","rolledup","div_destroy","remove_thread","shallow_copy_1","BroadcastEventByMode","argsObj","apply","reentry","setup_pn","Maintain_AllThreads","sels","variety","16","from_modify","from_pruned","olds","news","Sync_watch_load_cmd_1","merged_broadcast","Sync_watch_save_merged","jump_to_post","dbtp","image_resize","fst","image_resize_1","w","naturalWidth","nh","naturalHeight","fw","fh","f","image_resize_onload_add","imgs","image_resize_img","first","complete","onload","image_resize_all","image_resize_th","kwd_clear","oninput","kwd_init","force_clear","search2","str_old","fail_list","suc_list","kwd_prep_regexp","filter_kwd_count","posts_active","basic_active","search_posts_active_once","posts_search_inactivated","FilterChanged","keep_html_key","pns_all_keys","icon_sticky","icon_show_always","pn_summary","pn_only","from_gClg","q","popups_release_all_not_exist","func_hide","remove_th","idx_remove","testPoster","get_latest_time_of_a_thread","tgt_th8","schedule","threads_candidates_of_deletion","tgt_lock_cancel","wdg","marks","scroll_back","mark_top","abs_top","wdg2","last_viewed","get_last_viewed","modified","general_event_handler","get_mark_from_height","clear_last_viewed","threshold","NaN","func_lazy_draw","DIH","expand_thumbnail_on_demand_kick","y_new","scrollY","y_old","Buf","do","arg1","arg2","queue","delayed_do","prep_own_posts_event","make_own_posts","scan_boards_check_pre","INDICATOR","mem","multi_entry","callback_args","scan_boards_init","pool","div","parser","DOMParser","doc","cs","type","wrapper_obj","cache_write","senders_returned","tgts_iterator","args_proto","sb","scan_boards_keyword_make_tgt","idx_insert_odl","load_on_demand_try_get_mutex","func_old","load_on_demand_release","next","force_json","u","ths_in","sb_source","threads_meguca","list_nup","got_200_board","localArchive","insert_thread_format_th_pn","filter_needs_wrapping","differentAPI","tgt_th_meguca","post_updated_static","has_editing","pf_store","sage_detect_all","sb_merge","pf_notify_new_thread","has_page","clgs_args","ALL_agg","pf_fKwd","pf_fTag","pf_foPg","tag_updated","prep_tags","post_updated","ed_t","has_posts","ed_f","update_tags_in_editing_posts","waiting","popups_fetched","archive_store","pf_store_1","get_nof_store_posts","ta_missing_info","missing_info","lastNo","th_modified","force_store_ta","type_source","dont_have_com","check","popups_add_1_cross","got_200","stats_ID","time_check_old","rescan_dp","force_ar","nof_new_posts","aggregate_passive","ed_p","editing","ed_u","replyTime","tgt_th_new","insert_thread_1","pf_store_2","store_th_to_mem","filter_test","appeared","get_max_page","idx_raise_odl","dirty","lth_w","domain_html","got_404","pf_store_th","get_t2h_num_of_posts","callback_1","REQ","key2","get_tgt_func","UPPERLIMIT","issued","responseType","data_type","callback2","hasOwnProperty","callback_1_fail","found_board","clg_args","th_key","new_th","refresh_or_search","catalog_filter_query_keyword","search_by_tags","time_bumped","time_posted","tgt_th16","expand_posts","insert_thread","idx_reorder","page_updated","scan_abort","triage_merge_base","catalog_get_native_scroll_area","set_merge_base","pn_old","key_base","datetime","click_thread","popups_href2dbtp","htmls","add_to_list_fromUI","history","mergeHist","pop","apply_prep_1n","key_tgt","emb_get_key","hist","pn_base","near_threads","add_submenu","mode_split","Get_posted_time","reverse","add_to_list_1","off","add_to_lv_list","merge_cross_links_in_op_manually","start_1","changed_watch","broadcast","changed","triage_exe_view","changeds","cmd_m","clone_thread_1","filter_dirtify","check_and_expand","from_LSmirror","hist_last","arguments","cmd_N","attr_buf","watch_buf","ex_buf","triage_exe_1","triage_rewind_watch","millisec","wt_now","wt_str","wt_has","wt_add","mark_read_thread","_revise","ex_now","ex_str","ex_add","at_now","matched","at_desc","at_obj","str2obj2","at_style","at_cmd","systemSticky","k","cmd_str","at_add","at_str","watch_time","set_watch_time","set_unwatch","dirtify_ur","triage_undo_callback","format_buttons","trg","format_tgt","format_funcs","make_1","on_off","triage_in","triage_out","triage_wheel","triaged_catalog","evt","createEvent","initMouseEvent","canBubble","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","triage_onclick","triaged_name","pn_th","make_menu","popups_posts","pop_down_temporarily","keyTime","menu2keyTime","pn_menuOpen","hiddenPosts","triaged_pn","make_triage","onmousewheel","trg_hover","trg_menu","child_style","class","trg_pMenu","embTri","caption","trg_now","trg_submenu_root","trg_submenu_leaf","WATCH","UNWATCH","SHOW","show_always","UNSHOW","STICKY","UNSTICKY","ARC","ARC1","UNARC","tpn","set_triage_style","offsetLeft","scrollLeft","getBoundingClientRect","right","offsetWidth","mode_float","bottom","thread_in","triage_off_wdg","show_triage","triage_off","change_mode","triage_on","hide_if","thread_out2","stop","ddEcW","documentElement","clientWidth","ddEcH","stopPropagation","triage_in2","REMOVET","MERGET","UNMERGET","remake","embedded_onclick","tr","et2tr","geh","recSearch_thread","doms","emMerge","href2domain","[object Object]","tgt_th16_proto","posts_in","update_posts_replace_prep","t2h_page","expand_num","expand_event","kwd_active","get_t2h_from_index","scan_ui","contract","insert_thread_prepare_html_lazy","insert_thread_dummy","get_getters","op_img_url","time_created","type_com","date_load","init_new","revise_thread","flag_overwrite","th_init","type_html","add_scan","posts_full","pff","auto_obj","merge_obj5a","apply_auto_list_filter","pfm","merge_list_delayed","_links","hop","mh","tgt_lth","view_attr_get_str","set_watch_time_thread","from_lazy","prepare_html_prep_posts","prepare_html","insert_thread_format_html","ch","set_own_posts","init_or_refresh","links","get_thread_links","merge_base","initialized","query","posts_used","update_posts_in_page","merge_cross_links_in_op","hide_if_hit","view_update_draw","type_data","quotes","merge_tgts","popups_prep","prepare_html_post","force","prepare_html_extract_params","extracted","filename","prep_mimic","mimic_force","mimic_tgt","mimic","type_mimic","tmp_pn","headline_json2html","page_json2html3","catalog_json2html3","remove_by_tagname","prep_anchor_links","toplevel_anchor","absolute_link","thq","pref_env","not_anchor","deactivate","from_not_popup","format_pn","popups_add_1","add_postMenu","bks","add_backlinks_bks_query","add_backlinks_bks_append","get_t2h_index","prep_blacklist_click_tn","pf_mode","blacklist_click","pf_env","update_posts_replace","page_json2html3_add_omitted_info","page_json2html3_replace_expander","replace_posts_by_search","th_new","kwd_make_result","contains","search_result","update_posts0_class","nofFiles","objs_global","objs","kwd_1","removeAttribute","view_update_draw_merged","base","mark_time","get_mark_time","view_update","Infinity","extra_format","ret_time","get_threads_odl_default","8","threads_odl_default","get_tgt_th","check_sub","check_func","ref","insert","check_funcs","sticky_last","sticky_first","watch_last","watch_first","get_date","funcs_get_date","c0","c1","reorder_req","insert_bulk","almost_sorted","from_merged","rm_dic","idxs_before","names_before","rm_dic_before","dic_null","idxs_new","check_bulk","idxs_single","loose_check","mb_base","funcs_lvl","func_1f","func_1b","c0b","c1b","func_1","insert_bulk_1","insert_sort","insert_bulk_1by1","insert_bulk_all","names_slices","forward","found","func_lvl","src_th","src_lvl","tgt_lvl","retval_first_idx","filterInPlace","idx_old","func_0","p_out","pos","insert_bulk_111InPlace","idx_first","insert_bulk_111","ref_lvl","insert_sort_up","insert_sort_down","sort_func","sort_key","offset","idxs_key","idxs_bulk","out_of_order","19","both_cascade","func_cas","func2_cas","cascade","func2","arr_raw4","0","4","5","f5","1","2","3","kwd_odldb","idx_delete_odl","start_pos","small_diff","odls","hide_tgts","idx_re_sort_sub","idx_rm_reorder_exe","idxs_old","names_unique","created_dic","names_dic","errors","trace","clear","idx_top","old_clean","bulk","idx_new","clg_tmp","idx_refresh","idx_idxMergeAll","idx_insert_bulk","hover_prep","prefetch","img_ex","clone_img","position","pointerEvents","hover_obj","draggable","ondragstart","zoom_dragstart","zoom_inout","onmousemove","hover_ex_mousemove","ondblclick","image_hover_remove","mousewheel","div_scroll","hover_onload","onerror","pause_cancel","pause_req","script_body","movementX","movementY","hover_ex_mousemoved","hover_ex","format_hover_ex","image_hover_add","hover_ex_old","hover_pf","img_next","get_next_image","zoom_required","cursor","hover_ex_tn_out","zoom_start","maxWidth","maxHeight","inline_or_hover","zoom_factor","fx","fy","zoom_in_place","force_zero","oT","oR","zin","drag","started","image_hover_snatch","dx","dy","cn","snatch_hover_ex","play","evfunc_factory","clone_img_make_src","from_initial","tgt_domain_html","image_hover_check_mode","post_html","img2src","get_op_src","from_odl","pfih","ext","img2ext","controls","autoplay","loop","muted","image_expanding","expand_thumbnail_on_demand_set","expand_thumbnail_inline_load","opacity","expand_thumbnail_inline_stopHover","shrink_thumbnail_inline","format_expanded_thumbnail","expand_thumbnail_on_demand","nowHeight","ot","image_expand_on_demand_instance","image_hover_reentry","fetch_and_reentry","expand_thumbnail_clicked_but_ineffective","InfoPv","rel_time","strs","s0","shown","rect","cW","last_name","track","set_watched_to_last","update_ur","debug_str2","catalog_obj2_proto","force_all_named","may_bump_down","drawn_idx_old","debug_count","retvals_idx","func_track_reset","tgts_from_idx","created_from_idx","hide_tails","debug_str","drawn_y","draw_adaptive","draw_count","observer_myself","tgts_count","ref_count_init","mode_merge","mode_merge_tails","merge_tails","try_all","shown_count","load_tgt","i_start","lazy_step","lazy_next","lazy_avgSizeInv","footer_clean_idx","load_on_demand_try_load","i_merge_tails","merge_tails_idx","isShownForTails","to_show","disp_th100","disp_th20","func_check_overrated","func_search_ref_idx","func_check_reorder","func_search_ref","func_show","update_y","func_track_shown","d_count","tgt_bt","debug_str4","debug_str3","debugWindow","connect","i1","footer0","update_drawn_y","ref_step","catalog_obj2","filler","hr","load_on_demand_timer","load_on_demand_release_draw","RollbackInfo","style_only","skip_showing","pn_in","force_unroll","wlc","noBlur","rollback_info","stl","set_icon","showAlways","query_1p","unmatch","any_or_all","query_11","query_1t","rexp","pst","txt","post_com2txt","extra_files","val_detect","filter_query","filter_query_1","tgt_posts","pop_up_set_contents","kind","flag_search","pn_result","tags_reserved_init","make_refresh_list_from_watch_list","tgts_db","refresh_1","scan_name","get_board_list","tgts_bg","tgts_wl","tgts_all","register_auto_acquisition","hi","scan_refresh","catalog_frame_prep","exe_embed","observe_tgt","key_me","key_me2","auto_merge_list","ths_hook","from_archive","obj2s","mirror_targets","subscribers","valid","last_Y","init2","mouseover_lock","change","class_expander","WeakSet","click_bl","boardlist_click_entry","insert_iframe_youtube","close_button","stop_prevent","isThumbnail","getSelection","isCollapsed","popups_link_regex","tgt_domain","domain_url","get_mark","dynamic_image_hover","popup_body","dom_addEventListener","root_body","dragstart","dnd_merge_mousedown","dom_removeEventListener","over","tag_onmouseover","mouseleave_bl","dragenter","dst","get_key_rec","dragend","mouseleave","sx","sy","bcr","pn_th_oL","pn_th_oT","pn_dragEffect","mousemove","mouseenter","removeAllRanges","syo","end_proc","mouseup","pop_up_unlock","offsetY","GEH_mouseover_force","boardlist","pth","tgt16","nocopy","9","10","20","24","auto_acquisition_init","get_threads","catalog_liveTag_scan_site","make_chart_obj","pn1","make_new_chart","PostChart","window_focus","foreach","charts","chart_posts","window_blur","destroy_all","chart_data_init","labels","datasets","chart_data_init_1","color","alpha","fillColor","strokeColor","pointColor","pointStrokeColor","pointHighlightFill","pointHighlightStroke","time_unit_sel_html","chart_options_str","chartCount","pn_popup","skelton","deep_copy","pn_canvas_root","events_beforeunload","pn2_obj","pn2_template","button_settings","legend","set_legend_str","onchange_entry_bound","onchange_entry","onchange","bottom_top","pn_board_sel","pn_canvas","chart_size_changed","Stats","get_tgts","canvas_active","deactivate_canvas_if_mouse_on_corner","append_legend","board_sel_changed","tgts_changed","len_changed","replace_data","data_src","ecTs","offsetX","chart_redraw","data_graph","dd","fN","fromNo","dr","rm","ds","layer","data_l","merge_1","data_p","data_p_old","data_t","data_t_old","scale_setup","arr_dec_slice","idx_last","data_np","clip_np_func","scale_thread_old","ctx","getContext","Chart","Line","old","scale_changed","points","update_data2","removeData","addData","tgt_p","tgt_t","tgt_ep","tgt_et","tgt_np","min_idx","remove_legend","maximize_embed_style_pnch1","maximize_float_style_pnch1","maximize_tgt","tgt_hier","get_tgt","apply_prep_set","separate","time_unit_changed","querySelector","dump","data_update","make","make_setting_obj","pn8","pn7","prep_pn7","pref_apply_prep","pn7_1","timer_obj","button_action","obj_init","pref_samples","chart_obj","site2_json","site2_eval","void_func","make_listener","listen_event","pipe_name","JSON_parse","value_old","make_timer_obj","pn0","property_changed","timer_obj2","make_timer","stop_destroy","pn0_str","finished","get_time","page_check5","page_no","page_check4","parseFromString","time_stamp","ops","get_ops","str_set","str_get","prep_next","func0_exe","page_check2","get_nos","all_got","increase_posts","last_post_old","last_post","num_of_new_threads","isNaN","timestr","missing","tgt_doc","flag_set","get_last_post","last_ops_old","last_op","get_posts","str_place","location","thread_keyword","req_events","dead","info_raw","get_page","send","page_check3","checking","page_check","timer_restart","interval_old","timer_stop","setInterval","clearInterval","XMLHttpRequest","retry_count","retry_limit","make_post_form_obj","pn9","postform_focus","postform_comment","focus","postform_float","activation","rolldown","pn10","pn10_2","on_change_redirection","func0_prep","postform_dock","show_hide2","pn11","make_iframe","submits","targets","forms","forms_post","method","inputs","posted","make_debug_obj","pn_debug_button","disabled","self","navigator","userAgent","innerText","Date_parse","do_tgt","hasFocus","desc","getOwnPropertyDescriptor","unshift","domains_all","isStep","add_domain","set_options_to_selector","text","IDB_board_sel_options","IDB_thread_sel_options","whreami","pn_end","allow_merged","effect","move","dragover","dataTransfer","dropEffect","isPopup","strict","loose","parseJSONCs","err_extra","src_str","allow","allow_prefix","callback_args0","callback_args1","pass","fail","extra","prefix","level","queryOrSet_params_by_JSON","query_or_overwrite","enables","str_out","pref_query","eval","pn_out","suc","dumb","pref_overwriteAll","storage","sessionStorage","reload_required","parent_src","working","jsons","dir","merge_list_obj2_old","head","all_fullname","field","merge_lv_obj2_old","js_file","pn13_1","pn13","mirror_names","dic","virtualBoard.max","*.merge","*.merge_list","*.refresh_src","*.refresh_src_th","hier","propagate","mirror","make_obj","no_save","HTMLCollection","NodeList","apply_prep_2_all","apply_prep_save","apply_prep_mirror","apply_prep_1","apply_prep_2","fms","site2_json_ex_remove","target_hier","apply_prep_load","str2obj6","stgt","str2obj5","apply_prep_2_str","toUpperCase","parseFloat","t2h_sel:L","t2h_sel:M","t2h_sel:N","t2h_sel:N_unread","t2h_sel:unread","posts_search_op:opaque","catalog_board_list_str_or","catalog_board_list_str_bt","catalog_board_list_str_bt_same","func_obj","func_obj2","set_event_target","add_onchange_entry_func","propagated","name02","name0","name_0","name_1","prep_beforeunload","inst_while_input","set_val_beforeunload","tgt_wrapped","bg_str","boards_sel_from_tags","or","get_owners_recommendation","lines","bn","fields","dm","exact","func_org","set_val","fs","func_rev","idxl","func_for_val","rm_merge","obj3_db","obj3_rm","obj3","add_to_list_2","no_insert","existIn","index","len_erased","key_in","exec","obj2proto","exist","obj2proto_merge","darr","sarr","dold","sold","sarr_old","obj2proto_merge_lv","lv","obj2_only","f2","flag_g","fd","idx2","str2rstr","trim","proto_post","fm_name","from_post","merge_obj5_all","merge_obj5_1","merge_obj5_1a","merge_obj5a_sc","obj_key","obj_hier","obj_init_hier","no_copy","not_root","getPrototypeOf","pref_test","site2_json_ex","simple","backwash","recommend","easy2.presets","vb_kwd","easy2.limits","easy.virtualBoard_10_passive","easy.virtualBoard_10","easy.virtualBoard_1","easy.virtualBoard_8_50","easy.virtualBoard_8_all","easy.virtualBoard_interSite","easy.posts_0h","easy.posts_24h","easy.threads_24h","easy.embed_index","easy.embed_index_lazy","easy.light","easy.embed_index_infinite","easy.embed_index_backwash","easy.stat_activate","pn_samples","onclick_event","make_popup","get_name","innerWidth","pn13_0_2","onchange_funcs_formatted","files_store","apply_pn13_1","files","Identifier","how_to_triage","howto","show_hide_all_to_header","show_hide_all","str_show","str_hide","inner","imm_down","limit_webm","expand_thumbnail_hover","resize_thumbnails","resize_thumbnails_size","str_inner","posts_for_search","op_in_search_result","deleted_posts_detection","popup_others","radios","indent","r_str","middler","no_blank","rollupHelp","rollupTrav","format_posts","merge_all","merges","ta_with_help","vb_domains","features_domains","cb_block","triage_config","pfx","design_of_fc_1","design_of_fc_size_doms","design_of_fc_size_doms_register","pn_size","pn_teaser","design_of_fc_size","instance_form","broadcast_triage","caption2","inlineBlock","same","sameCap","save_idx_promiscuous","old_prop","caption_button","notify_init","notify_tgts","add_indent","p1","p2","idt","Easy Setting2:","Easy Setting:","Virtual Board:","Catalog:","Index Page:","Thread:","Watcher/FC:","Gerenal 0","General 1","Board Group","Live Tag","Statistics","Footer for watcher","ThreadReader","Notifiers","JSON Archiver: Store","JSON Archiver: Restore","UIP tracker for 4chan","Command Line Interface","Networking","General 2","Styles","Features","About","Debug","lastReloaded","html_common","tag_gen","onchange_funcs_base","SHOWALL","TOGGLE","HIDEALL","HIDE","dst_dom","tgt_dom","SHOW2","TOGGLE2","HIDE2","SEARCH_HIER","SHOW2_I","etp","SHOW4","HIDE4","SUB","virtualBoard.search.str","SHOW5","HIDE5","SHOW_T","TRAVERSE","HIDE_T","trav","uip_tracker.on","healthIndicator.show","healthIndicator.expand_running","..","settings.indexing","pObj","pn13_1_warning_reload","pn13_1_warning","tag.scan","tag.same_tag_refresh","tag.generate_caller","tag.gen","cbxes","str_name","uri","tag.gen_add","tag.recommendation_add","tag.add_to_list","board_sel_refresh","str_changed","stats.use","stats.estimate_posts","stats.auto_acquisition","stats.auto_acquisition_all","catalog.board.recommendation","catalog.board.board_tags","catalog.board.all_boards","CLI.*w/","CLIe.*w/","EVAL","load_default","pref_def","nodes","load_default_of_this_page","load_samples","triage.hide_toggle","triage.menu_str","triage.postMenu_str","catalog.footer.*w/","float.footer.*w/","proto.footer.*w/","liveTag.style.*w/","thread_reader.use","catalog.appearance.titleBar.*w/","virtualBoard.p_board","update_boardlist","virtualBoard.p_remove","virtualBoard.show","easy.*w/","easy2.beginner","easy2.apply","force_reset","reload","triage.sampleLoader","selectedOptions","hl","mr","headline_ex","headline_merge","headline_merge_ex","basic","menu_core","menu_undo","menu_basic","menu_attr","menu_full","menu_arcMerge","opt","triage.sample.*w/","simple_kill","basic_color","colorful","borders","toggles","virtualBoard.scanStart","virtualBoard.scanStop","abort","virtualBoard.scan_domains.*w/","virtualBoard.search.show","tgt_name","bar","update_pn","virtualBoard.search.*","liveTag.ex_list_str","ex_list_changed","liveTag.inherit_board_name","inherit_board_name_changed","liveTag.inherit_board_tags","inherit_board_tags_changed","page.mark_new_posts","recovery.comment","*.scroll_lock","button_test","req_raw","restore2","restore_entry","restore_button","restore","clear_files_button","dom_new","pn_IDB_board_sel","pn_IDB_thread_sel","multiple","queryQuota","webkitTemporaryStorage","queryUsageAndQuota","showQuota","usage","queryList","showList","indexedDB","webkitGetDatabaseNames","onsuccess","results","IDB_selected_boards","selected","showThreadList_fromIDB","IDB.selected_threads","arg3","arg4","arg5","restore3","refresh_tgt","thread_json","prep_to_archive","prep_deleted_posts","consolidate_IDB_result","images","thumbs","file_obj","func_init","consolidate_IDB_result_sub","consolidate_IDB_sort_func","IDB.delete_board","deleteDatabase","IDB.delete_thread","IDB.delete_imgs","IDBKeyRange","bound","IDB.export_thread","file_id","flush","export_thread","props","props2","isPosts","Blob","suffix","add_blob","IDB.reset_time","clean_list","store_entry","kwd.*","test_mode.js_load","URL","createObjectURL","scr","tighten_loosed_limits","*w/.t2h_sel","*w/.t2h_num_of_posts","cleanMerge","has_tails","req_serial","catalog.style_general_list","catalog.style_general_list_str","postFilter.*w/","*.hide_posts_without_images","p3","p4","p5","cap","others","overwrite_prop","fill","ary","dom_addAttribute","perf_out","performance","last_ts","kwds","rstr","escape","entities","<",">","&","\"","'","escape_text","arraybuffer2blob","mime_types","jpg","jpeg","gif","png","pdf","svg","svgz","htm","mpg","mpeg","mp4","ogv","mp3","gz","tgz","zip","7z","xz","autosage","url_prefix","url_prefix2","postform_rules","server_name","protocol","catalog_threads_in_page","remove_posts","remove_files_info","remove_checkboxes","get_time_of_last_post","query_set","config","keyword","url_site","url_board","decodeURI","boardlist2","settings3","owners_recommendation","root_body2","home","spoiler_text","spoiler","make_showAlways","icon","get_icon","add_icon","onoff","postform_prep","postform_submit2_observer","postform_submit2_find","setup2","catalog_root","getElementByTagName","now_height","ecT","getID","getCountry","getTrip","getName","an2srcNo","generate_boards_json","page_def","pages","url_boards_json","callback_always","dummy_indicator","boards_json","get_boards_json_callback","postprocess_board","update_pn_buf","o","postprocess_board_add_btag","boardlist_boards","show_boardlist_physical_board","func_onclick","show_boardlist_physical_extract_func","toLowerCase","boardlist_hit","create_tag_node_1","boardlist_tags","boardlist_tags_pn","show_boardlist","sbl","tags_bl","update_tag_nodes","bd_bl","absolute_link_exe","absolute_link_1","link_dbtp2href_abs","quote","link_dbtp2href","ls_key_own_posts","prep_own_posts_1","prep_own_posts","clean_up_LS_th","ls_key_deletedPosts","ls_key_comment","ls_key_hiddenPosts","clean_up_deleted_posts_1","ls_key","ls_key_bd","add_name","to_me","regexp_anchor_txt_1","own_posts_cb","regexp_anchor_cb_txt_1","check_1","extracted_tags","extracted_posts","of_mine","reply_of_mine","anchors","regexp_anchor","regexp_anchor_len","regexp_anchor_cb","check_t1","com_or_txt","mail","pn_tags","str_rm_list","scan_regex","tag_ex_list","prep_check_1","regexp_anchor_txt","regexp_anchor_cb_txt","regexp_anchor_com","regexp_anchor_cb_com","prep_check_t1","check_t1_op","passive","tag_init","time_check","watchtime_changed","ur_old","generate_ur","omitted_posts","watching","aggregate","extract_tags","get_post_offsetTop","get_favicon","none","get_title","time_revised_check","nof_ths","format_thread_layout","format_thread_style","format_thread_contents","format_thread_always","format_remove_tn_area_size","unmark","short_cut","post_json","marked_first_idx","unmark_post_from_event","thq_no","unmark_post","modify_thread_link","preprocess_html","doc_txt","check_thread_archived","get_board_tags","get_json_url_catalog","catalog_native_prep_sel","pn_tb","selector_native","initUIEvent","selector_catchan","catalog_native_prep_swap_sortSel","sortSel","catalog_native_frame_prep","insert_remove_frame","ifrm","disgorge_children","pn_catalog","absorb_children","catalog_native_frame_prep_frame","ref_node","margin","contentWindow","catalog_embed_prep","border","thread2search_obj","up_timer_factory","over_0","over_1","up_func","up_pf","up_src","up_timer","timer_end","up_e","out","erT_done","out_1_if_exists","pn_ex","imm","out_1","pop_down","pop_setup","pna","pop_over","div_mousedown","snatch","pop_load_req_delete","scroll","pop_out","clear_down_timer","set_pos","narrow_x","narrow_y","factor_x","hist_x","factor_y","hist_y","adjust_pos","tb","lr","etHref2domain","up0","up1","popupSurface","X","erT","blacklist","post_highlight_if_visible","pop_up","pop_make","popups_post_entry","pop_style","popups_href2th_q","popups_posts_class_hlt","post_jump_remove_highlight","inline_toggle","pns_inline","pop_load","keys_loading","pop_load_req","th_q","getComputedStyle","sT","post_highlight_end","post_dotted_if_multi_anchors","an_dotted","ce","post_pn2ce","src_no","popups_fetched_1","popups_try_fetch_from_lth_ta","thqp","isOP","th_q0","popups_post_fetch","post_json2html","popups_set_waiting","popups_debug","borderStyle","boxShadow","popups_post_pnode","dnd_mode","preview","th_over","pf3","on_th","up_th","th_out","on_clg","pop_up_th","pop_up_th_1","kwd_src","tack_for_popup","btn","tack_for_popup_swap","tack_for_popup_swap_pos","pfX","popup_make","getID2","leave","menu_click","lock","pnode","lth_q_ps","popups_release","cross","hrefs","skey","popups_add_backlink","add_backlink","nof_flinks","as_txt","as_new","popups_set","dig","backlinks","blks","add_backlinks","bks_pn","add_backlinks_bks","add_backlinks_add_1","popups_backlink2dbtpth","dbtpth","remove_backlink","popups_remove_backlink","popups_remove_waiting","prep_quotes","qts","debug_len","initial_cond","d_str","remove_if_no_backlinks","toplevel_anchor_pos","site4","parse_funcs_on_demand_debug","parse_funcs_on_demand","key_table","pfunc_root","mimic_always","proto_type","th_regexp","shortCatalog","shortThread","json","doc_obj","parse_obj","proto_options","proto_obj","parse_pn_dummy","pn_id","pn_trip","tn_as","catalog_json2html3_thumbnail","ths_array","ths_col","get_lth_from_node","headline_html","catalog_html","exlist","exe_sub","exe_sub2","fname","tim","post0","page_html","posts_array","pts","idx0","idx1","get0","posts_get0","get1","posts_get1","insert_footer4","html_org","replace_omitted_info","replace_omitted_info2","page_json","replies","has_nof_files","rip_from_archive","anchor","base_html","json_template","parse_parts","add_op_img_url","posts_m","by_no","posts_ret","shownSet","reorder_bases","reorder_all","re_style","isShown","base_tgts","base_by_tgt","base_factory","merge_th","func_hide_org","setup_hook","func_2","func_3","func_4","func_max","func_min","func_sum","base_tmp_map_reduce","base_tmp","func_blank_sum","lth_ta","lth_pd","lth_sp","emu_ta","emu_pd","emu_sp","emu_16","base_proto","lazy_draw","lazy","lazy_idx","draw_1_pos","get_class","14","tags_all","tags0","tags_ret","some","headline_reorder","catalog_reorder","attr_obj","top_key","cns","class_add_all","merge_class","class_remove_all","catalog_separate","headline_separate","remove_th_page","catalog_merge","merge_th_page","page_json2html3_skelton","update_posts_separate","update_posts_merge_1","lazy_tgts","base_arr","base_arr_old","with_hr","func_show_org","idx_now","merge_tail","base_0","pf_merge","func_track_shown_org","post_count","func_track_reset_org","th_domain_html","update_posts_insert","key_op","release_hook","key_dst","prep_only","old_old","old_org","debug_copy","rest","now_org","debug_error_check","src0","src1","msg","hide_merge_tgts","srcs","*w/.merge_list_str","no_dirtify","*w/.merge_list_str_1","tgts_draw","*w/.merge_list","*w/.merge","ordering_old","onfocus","onblur","*w/.merge_lv_str","*w/.merge_lv","*w/.merge_lv_1","from_str","first_no","th_old","info_old","get_omitted_info","info_new","set_omitted_info","editings","update_posts_remove_1","update_posts_add","update_posts_remove","ref_time","pn_sep","link_sanitizedTxt2html","link_dbtp2html","link_dbtp2txt","modify_a2anchor","childElementCount","tailer","modify_href2html","MERGEE_button_html","force_expander","nof_posts_omitted","nos_shown","nof_files_omitted","page_json2html3_prep_omitted_info","page_json2html3_set_omitted_info","page_json2html3_cloneOPWithoutFooter","pn_src","post_json2html_fname_server","post_json2html_fname","post_com2txt_finisher","pn_com","max_txt","truncated","summary","headline_prep_summary","footer_in","button_in","class_footer","container","remove_by_classname","classname","remove_br","tagname","remove_by_attribute","attr_name","attr_val","remove_attribute","add_attribute_by_classname","add_attribute_by_tagname","add_attribute_by_attribute","attr_name2","attr_val2","move_up_and_delete_parent","g_parent","remove_last_hrs_and_brs","last_node","remove_brs","remove_double_br","outerHTML","remove_double_tags","change_utc_to_local","utc_str","parse_funcs_getters","time_tu1000","resto","parse_funcs_no_cache","parse_funcs_one_time","domain_url_image","getElementsByName","getElementById","pn_redirect","func_genResult","make_tag1","tag_in","tags_array_old","bds_check","bds_t","mems_boards","sfw","pph","pph_average","sub_tagSearch","read_max","frame_menu","frame_main","before_test","after_test","full_hier","mixs","pn_child","catalog_native_size","filenames","spans","last","postform_comment2","add_mouseover","op_containers","substring","firstElementChild","times","file_style","or_str","aggregate_info","op_idx","coms","subs","files_in_post","uids","nof_uids","unique_ips","node_ref","pctrls","catalog_native_size_changed","last_modified","omitted_images","before_test_post","pn_time","om_info","op_img_url2","url2","fsize","tn_w","tn_h","time_pn","post_pn","txt2com_spoiler_replace_txt","update_posts_insert_pack","ref_pnode","post_container","update_posts_insert_unpack","update_posts_insert_pack_iter","prev","prev_prev","fchild","blk","backlink_onclick","highlightReply","bg_r","bg_g","bg_b","kwd_head","kwd_tail","html_str","capcode","country_name","toISOString","post_json2html_file","multifile","fsize_str","fname_server","furl","catalog_json2html3_src","turl","both","no_expander","omit_info","config_expander","posts0","thumb_url","make_footer","catalog_from_json3","force_https","max_page_kc","main","navigation","/int/","/b/","/trv/","/m/","divs","time_offset","postdate","time_pn_1","no_JSONAPI","filename_server","balls","ball","ft","th_no","html_file","update_posts_insert_1","ref_pnode2","post_flag","catalog_json2html3_onload","open_rule","catalog_native_prep_wait_loop","catalog_native_prep_wait_loop_if_searched","catalog_posts_in_thread","trim_page","archive_patch_domain","post_containers","filethumbs","callback_in","callback_sage","add_sage","prep_own_posts_reg","invoke_func","qf_ctrl","qf_clear","ref_size","cloneSwap","doms_insertBefore","size_changed","teasers","sizes","extended","orderby","arc","ob","data_embedded","imgurl","author","teaser","pagesize","post_1","ts","html_new","class_thread","class_thumbnail","pn_next","last_replies","log_post","bumps","end_no","skeyb","latest_bump","tu","skey0","idxs_aged","bad_data","sure","time_recovered","bumped","span","tFlag","txt2com_anchor_class","fileText0","fileText_a","md5","archive_html","html_template","board_flag","expander","blk2","backlink_parent_prevSib","src_txt","op_no","tn_f","file_html","post_json2html_postinfo","func_resize","post_json2html_nameblock","since4pass","post_json2html_colorID","flag_name","rgb","charCodeAt","g","tmp_w","tmp_h","catalog_json2html3_skelton","src_pn","merge_icons","skl","idx_footer","ids","pn_tb_new","th_url","th_class_tn","th_class","image","imgnm","subject","anchor_regex","anchor_func","dims","imgctr","time_node","check_func_whereami","catalog_native_prep_wait_loop_timeout","observe_native_bg","loading_image","skip_initial_call","observer_tap","attributes","ctlg","thumbType","SHA1","fileType","post_json_template","prep_th_posts","posts_obj","page_base","shortCatalog_json_template","page_json_template","catalog_json_template","postCtr","thread_json_template","bumpTime","imageCtr","auth","MD5","sha1","arrow","anchor_func_tgt","anchor_func_1","command2txt","c2t_count","anchor_class","spoiler_replace_txt","quote_replace_txt","commands","lth_init","prep_own_posts_IDB","prep_own_posts_IDB_callback","ALL","add_backlinks_pn","add_backlinks_hrefs","popups_post_fetch_callback","RUNNING","post_0","post_json2html_imagesearch_href","post_json2html_imagesearch_1","provider","src_x","post_json2html_imagesearch","pref_imgsearch","file_header_html","md","shortCatalog_json","ths_json","pgn","posts_pns","X_FRAME_OPTIONS","CONTENT_SECURITY_POLICY_FRAME","styles","add_to_watch","threads0","blotter","backgroundColor","CONTENT_SECURITY_POLICY_DATAURI","other_html","getMilliseconds","pn_fifo_factory","filled","pn_add","pn_message","pn_hist","pn_makeThread","pn_prune","pn_errors","xhr_reqs","xhr_frees","a_update","post_func","xhr_events","xhr","myobj","str2","str2_idx","action","all_data","setRequestHeader","data_out","encodeURIComponent","pruned","debug_parse_funcs","values_obj","dic_proto","debug_parse_funcs_Init","debug_parse_funcs_dig","debug_parse_funcs_entry","pool_0","pool_1","src_type","ex_keys","ownProp","ownFunc","isOwnFunc","ownValue","isOwnValue","refCount","parse_funcs_Map","original","get_proto","me","s2dpf","start_point_template","start_point","defineProperties","debug____proto","debug_parse_funcs_all","types_tgt","str1","parse_funcs_enumerator","kv","tgt_obj","SharedWorker","make_beep","wav_str","dl","header_add","big_endian","freq","vol","sin","Audio","make_audio","src_changed","audio","pause","favicon_set","favicon_next","favicon_current","sum","CountNR","count_all","title_set","title_current","title_org","Notification","get_permission","permission","requestPermission","tagKey","dtns","dtns_queue","show_1","show_1_queued","show_1_queued_delayed","dtn","win_focus","close_1","tgt_th19_4","sound_flag","pfs","pfd","dt","cf_error","dispatch_if_idle","crawler_spawn","dispatch","req_from","reqs","xhrs_count","ERR_5xx","req_1","reload_reqs","url2tgt","domain_xhr","download_local","xhrs_free","download_remote","xhr_onload_1","reqs_waiting_finish","iframes","func_timeout","req_in","iframes_timeout","remote_opened","remote_reqs","remote_count","to_file","to_idb","sub_frame_init_ack","sub_get","GM_XMLHttpRequestWrapper","xhr_onload","onabort","xhrs","overrideMimeType","xhr_timeout_start","TIMEOUT","xhrs_reqs","crawler_timeout","xhr_timeout_restart","xhr_timeout","readyState","responseURL","onreadystatechange","xhr_onreadystatechange","onprogress","end_proc_httpd","onload_local","end_proc_user","onload_archive","sub_ack","TAR_FLUSH","free_xhrs","HTMLParser","XMLParser","download_url4","list_all_obj_downloading","ignore_domain","download_url3","onload_archive_fail","check_timestamp_and_flush","sub_tar_flush","sub_frame_init","pause_timeout","GM_xmlhttpRequest","onXXX","onXXX_factory","_onreadystatechange","dummy_func","_onprogress","SUB_GET","SUB_ACK","SUB_FREE","SUB_TAR_FLUSH","SUB_FRAME_INIT","SUB_FRAME_INIT_ACK","reqs_in","req_add","isLocal","sender","sw_cache_write","callback_arg","tb_clicks","TbInfoStore","tack_float","tack_dock","bottom2top","compatMode","right2left","div_resize_on_border","mouse_cursor_on_text","prep_drag","pos_fixed","bb_et","bb_ecT","tlbr","div_mouseup_resize","div_mousemove_resize","drag_sx","drag_sy","resize_tlbr","resize_func","tb_mousedown","roll_if_auto","div_dragstart_dynamic","div_mouseup","et_cn","range","Range","tx","selectNode","rects","getClientRects","div_dragstart","dynamic","setData","wheelDelta","INHERITED","op_p","roll_toggle","from_start","on_tb","auto_unroll","tbInfo","maximize_internal","button_pressed","maximize_state","before_max","toggleButton","funcName","op_m","tile","last_pn","pn_tmp","pn_st","rolldown_func","rollup_func","exit_func","maximize_func","site_settings","optsobj","optsobj_is_given","padding","arg","btns_html","onclick_entry","onmousedown","background","tile_set_bottom","tile_set_left","left2right","child_of_body","pn_2","pn3","hour","getHours","min","getMinutes","getSeconds","make_destroy","func_make","func_destroy","onchange_func","query_auto_acquisition","opts","make_opts","itself","tack_p","dont_overwrite","pn2all","make_styles","rules","copy_styles_and_overwrite","styleSheets","doc_rules","cssRules","selectorText","overwrite_rules","rules2Map","cssText","rule","entries","dummy_add","StyleSheet","dummy","dummy_remove","spoiler_org","spoiler_open","sText","insertRule","deleteRule","register","selector","idx_s","registry","cls","cpf","addSS_changed","rel","userCSS_changed","uss","catalog_customSize","style_fixed","sheet","style.tips.*w/","style.sel","style.fix.*","style.copy.*","style.reset.*w/","style.addSS.*","style.userCSS.*","style.post_editing","*.open_spoiler_text","*.posts_search_op","float.format.fc.*w/","func_style","str_tooltip","str_hier","show_0","tack_req","tack_displayed","tooltip_kind","e_obj","tooltip_on","tooltip_e","show_timer","show_exe2","tooltip","hide_timer","hide_exe2","keep_shown","root","onmouseleave","filter.tag_list","network.cross_domain","liveTag.rm_list_str","TagExLists","GeneralRules","CommentDS","StyleString","StyleCommand","cli.eval_str","virtualBoard.scan_domains.*","#*","KILL","TIME","NONE","KILL_N","TIME_N","ATTR","GO","UNDO","MERGEB","MERGE","MERGEOP","UNMERGE","UNDOMERGE","SPC","MENU","PMENU","EXPAND","PWATCH","PHIDE","PHIDEAFTER","PUNHIDE","PDISABLEHIDE","PENABLEHIDE","PCLEARHIDE","prep_func_onclick","setting_obj","cnst_obj","make_button","sf","draft","func_frame","post_form_func","debug_func","onclick_funcs","CC","Settings","Watcher","Frame","Graph","Draft","PostForm","pk","prep_domain","_this","ldm","acc","prep_board","btag","ref_tag","ldb","update_tags_in_th_sub","btag2","btags","prep_thread","tl","t0","t1","time_checked","posts_saved","inherit_board_tags_changed_1","retag","retag_db","retag_in_th_sub","tags_len","exclude_tags","tags1","exclude_tags_1","loop_tag","delete_tags","key_dirty","tags_proto","mems_keys_obj","mems_keys","mems_keys_length","mems_keys_length_and_set_top","re_caption","make_pn","pn_template","inv_val","keys_fix","clean","k_ci","mems_map","tag_reserved","tags_reserved","tag_pk","tags_reserved_found_scan","tags_reserved_found","update_tags_in_th","src_new","src_old","check_update_tags_color","remove_tags_in_th","thread_removed","update_ur_1","from_subscribers","update_tag_node","rm_404_2","make_info","myDomain","cbx_changed","nth","cnr","all_case","mems_objs","count_ur","nof_th","counter","nof_bds","nums","no_scan","node_in_boardlist","backward","stOut","stNone","stIn","inv_in","inv_pk","inv_ex","cbx_emulate_inv","from_filter","add_board","bds_pickup","update_pn_last_filter_active","update_pn_disp_func","cbx_onchange_entry","update_pn_1_lazy","update_pn_1","update_pn_pos","master","tags_array","dirty_count","dirty_count_deleted","exam_pn","historical_filter_active","pn_count","docfrag","createDocumentFragment","pf_boards","key_ci","tag_obj","prep_NC","lT","sync_only","cbx_onchange","str_ary","obj_in","obj_pk","obj_ex","check_op","tags_op","extract_tags_trim_editing","flag_added","retag_editing","ex_tags_keep","t0len","tags_boardlist","force_redraw","sv_rexps","tag_bl","node","tobj","sep_txt","func_click","tags_old","tags_old_org","debug_refs","debug_before","sep","sep2","tag2","ref2","hide_unhide","unhide","pn_done","get_hp","hp","search_post_from_data","search_post_from_pn","redraw_hp","lthq","hide_unhide_cmd_entry","series","IDBRequest_onerror","error","db_info","last_closed","IDBRequest_onblocked","oldVersion","newVersion","IDBTransaction_onabort","IDBT_rereq","IDBTransaction_onerror","transaction","IDBRequest_onupgradeneeded","IDBRequest_onsuccess_open","from_upgrade","version","waiting_open","reqs_vc","reqs_rw","debug_reqs","debug_query","tr_count","oss","tr_info","req_kinds","done_put","objectStoreNames","tr_inc","tr_set","IDBRequest_close","createObjectStore","req_end","num_downgraded","indicator_update","add_req","delete_th_1","loop_func","complete_func","reqs_current","get_all","put_1","delete_1","times_pruned","write","list_len_old","Meta","pruned_time","clean_up_end_proc","isEmpty","req_parent","reqs_re","reqs_re2rw","open_db","db_name","push_all","deleteObjectStore","func_prev","oncomplete","IDBT","random","codes","String","fromCharCode","objectStore","put","store_json_func","IDBTransaction_oncomplete","clean_1_onsuccess","src_obj","put_to_IDB","time_prune","flush_and_prune","IDBR","openCursor","get_all_onsuccess","req_dictionary","clear_wdg_get_db","ArrayBuffer","continue","IDB_close","case_of_test_mode78","req_obj","sub_callbacks","ver","from_watchdog","onupgradeneeded","onblocked","os_name","indicator_req_count","indicator_parent","spawn","ReqFifo","get_status","nof_crawlers","sums","length_whole","allow_multi","init_val","ary_ro","cl","cl_idx","ref_no","req_old","req_cl","whole_array","indicator_report","inactivated","db_name_key","dbtk","store_posts","content","set_timestamp","blob","download_url","revokeObjectURL","a_link","month","proto_archive","download_url2","img_dl","url_funcs_wrap","wrap","url2file","th_obj","url_funcs_wrapped","archive_no","from_check_op","list_all","list_all_obj","tgt_tmp","bug_patch_for_meguca_editing_timeout","time_now","load_list","ls_key_archive","save_list","make_header","Uint8Array","encode_filename","set_header","byteLength","checksum","numstr","tars","tarfile","ignore_limit","tfile","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","flush_req","wlist","A","SPAN","DIV","BLOCKQUOTE","BR","WBR","U","S","STRIKE","B","I","BIG","SMALL","TT","SUP","EM","STRONG","string","check_archived_time","update_archived_time","downloaded_files","restore_posts_from_IDB","time_loaded","deletedPosts","check_deleted_posts","suffix_dbt","editing_finished","ta_posts","pf_d","fill_IDB","thp","othp","post_deleted","othpd","posts_offline","deleted_before","alert","store_deleted_posts_to_IDB","no_archive","live_active","oneshot_active","posts_all","store_rescan","posts_src","clear_func","name_deleted","fileReader","FileReader","readAsText","th_deleted","com_changed","delayed_check","check_com","com_new","delayed_save","save_at_exit","rec_inst","rec_inst2","get_key","get_highest_priority","key_pre","scanner","Scanner","scanners","force_thread","get_th","scan_threads_delayed_do","priority_th","get_list_thread","req_th","get_list_thread2","get_list_board","get_list_board2","use_boards_json","upper_bits","scan_boards_enumerate","thread_or_domain","func_entry","func_scan","scan_refresh_ex_list","func_cont","aborted","priority_next","key_next","ScannerUI","list_domains","scan_refresh_1","ss","update_thread","tree_404","sr","update_board_rm","thread_created","instances","tgts_obj2","check_and_add_thread","setup_board_no","time_unit_arr","update_posts_no_1","update_posts_rm_1_func","srt","update_posts_no_time","ldbst","idx_over","time_base","shift_add","update_posts_no_1_func","post_no","update_posts_no_1_func_min","update_posts_no","get_ac_key","auto_acquisition_beforeunload","auto_acquisition_keys","label_funcs","day","sunday","quarter_year","time_root","wdg_tick","prep_time","StatsFromNo","save_all_unsubscribe","merge_1_hier","lower","ceil","merge_1_hier_1","idx_d","from_destructor","chart_bak","data_lower","prep_thread_unsubscribe","prep_board_unsubscribe","Zcompress","Zdecompress","get_ls_key","data_save","prep_board_check_valid","time_last","array_init","skip_init","prep_thread_subscribe","StatsRm","tz_offset","label_init","lfunc","distance","tree","func_t","prep_1","ld","prep_thread_init","ldbt","check_only","rm_tmp","prep_board_init","from_thread","update_thread_1","StatsRm_prototype","prep_board_init_1","ldbs","StatsFromNo_prototype","prep_board_subscribe","new_vals","data_last","idx_last2","idx_in","pow","log2","time_prev","st","time_step","time_nextThread","pn_debug","prep_sw","blobURL","key_ls","worker","unsafeWindow","sw_out","sw_tryget","sw_alive","tryget_ids","callbacks","trygetItem","tryget_timeout","func_invoke","key_a","schedule_post","cd_id","cd_id_s","sel_id","time_val","time_at_post","setHours","countdown_m","cd_txt","set_background_and_button_value","time_till_post","countdown_post","round","countdown_s","cd_s","autobumper","bg_back","timer_deadtime","posts_itt"],"mappings":"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","file":"CatChan.user.js","sourcesContent":["// ==UserScript==\r\n// @name CatChan\r\n// @version 2021.07.18.4\r\n// @description Cross domain catalog for imageboards\r\n// @include http*://*krautchan.net/*\r\n// @include http*://boards.4chan.org/*\r\n// @include http*://boards.4channel.org/*\r\n// @include http*://i.4cdn.org/*\r\n// @include http*://8kun.top/*\r\n// @include http*://lainchan.org/*\r\n// @include http*://lainchan.jp/*\r\n// @include http*://*meguca.org/*\r\n// @require https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.1-beta.4/Chart.min.js\r\n// @updateURL https://raw.github.com/Dogman8/CatChan/master/CatChan.meta.js\r\n// @grant unsafeWindow\r\n// @grant GM_xmlhttpRequest\r\n// ==/UserScript==\r\n//\r\n//    Copyright 2014 DogMan8\r\n//\r\n//    This program is free software: you can redistribute it and/or modify\r\n//    it under the terms of the GNU Affero General Public License as published by\r\n//    the Free Software Foundation, version 3 of the License.\r\n//\r\n//    This program is distributed in the hope that it will be useful,\r\n//    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n//    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n//    GNU Affero General Public License for more details.\r\n//\r\n//    You should have received a copy of the GNU Affero General Public License\r\n//    along with this program.  If not, see <http://www.gnu.org/licenses/>.\r\n//\r\n\r\n\r\n(function (){\r\n//  if (window.top != window.self) return; //don't run on frames or iframes\r\n//if (window.top != window.self && window.name!='KC' && window.name!='4chan' && window.name!='8chan') return; //don't run on frames or iframes\r\nif (window.top != window.self && window.name==='') return; //don't run on frames or iframes\r\nif (window.name==='post_tgt' && window.location.href.indexOf('localhost')!=-1) return;\r\n\r\n\r\n\r\n  \r\n//  http://stackoverflow.com/questions/9791489/greasemonkey-require-does-not-work-in-chrome\r\n//  http://stackoverflow.com/questions/2246901/how-can-i-use-jquery-in-greasemonkey-scripts-in-google-chrome\r\n//  http://stackoverflow.com/questions/17341122/link-and-execute-external-javascript-file-hosted-on-github\r\n\r\n  var brwsr = {\r\n    ff: (navigator.userAgent.indexOf(\"Firefox\") != -1),\r\n    sw_cache: true,\r\n    JSON_parse: function(val){ // patch for Tampermonkey.\r\n                       var retval = JSON.parse(val);\r\n//                       if (GM_setValue)\r\n//                       if (typeof(retval)==='object')\r\n//                       for (var i in retval) if (typeof(retval[i])==='string' && retval[i].startsWith('[') && retval[i].endsWith(']')) retval[i] = brwsr.JSON_parse(retval[i]);}\r\n                       for (var i in retval) if (typeof(retval[i])==='string' && retval[i].search(/^\\[.*\\]$/)!=-1) retval[i] = brwsr.JSON_parse(retval[i]);\r\n                       return retval;\r\n                     },\r\n  };\r\n  brwsr.innerText  = (!brwsr.ff)? 'innerText' : 'textContent';\r\n  brwsr.Date_parse = (!brwsr.ff)? Date.parse : function(str){\r\n    var time = Date.parse(str);\r\n    if (isNaN(time)) {\r\n      var idx = str.lastIndexOf('.');\r\n      time = Date.parse(str.substr(0,idx),10) + parseInt(str.substr(idx+1,3),10);\r\n    }\r\n    return time;\r\n  };\r\n//  brwsr.Date_parse = (!brwsr.ff)? Date.parse : function(str){return Date.parse(str.replace(/ /,'T'));};\r\n  brwsr.document_body = (!brwsr.ff)? document.body : document.documentElement;\r\n  brwsr.mousewheel = (!brwsr.ff)? 'mousewheel' : 'DOMMouseScroll';\r\n\r\n  var DelayBuffer = function(tgt, delay){\r\n    this.tgt = tgt;\r\n    this.delay = delay;\r\n    this.id = null;\r\n    this.do_tgt = this.do_tgt.bind(this);\r\n  };\r\n  DelayBuffer.prototype = {\r\n//    constructor: DelayBuffer,\r\n    do_tgt: function(){this.id = null; this.tgt();}, \r\n    delayed_do: function(delay){\r\n      if (this.id===null) {\r\n        if (delay===undefined) delay = this.delay;\r\n        this.id = setTimeout(this.do_tgt,\r\n                             (typeof(delay)==='number')? delay : (this.hasFocus)? delay.fg : delay.bg);\r\n      }\r\n    },\r\n    cancel: function(){if (this.id!==null) {clearTimeout(this.id);this.id=null;}},\r\n    get_bound_func: function(){return this.delayed_do.bind(this);},\r\n    hasFocus: true\r\n  };\r\n \r\n  var Watchdog = function(tgt, delay){\r\n    DelayBuffer.call(this, tgt, delay);\r\n  };\r\n  Watchdog.prototype = {\r\n//    constructor: Watchdog,\r\n    start: function(delay){this.delayed_do(delay);},\r\n    stop: function(){this.cancel();},\r\n    restart: function(delay){this.cancel();this.delayed_do(delay);},\r\n    get_bound_func: function(){return this.restart.bind(this);},\r\n    __proto__: DelayBuffer.prototype\r\n  };\r\n\r\n////  var MutexWatchdog = function(name){ // watchdog for 8chan's unstability. // working code, @safe1069\r\n////    this.mutex = true;\r\n////    this.req = false;\r\n////    this.name = name;\r\n////    this.abort_req = false;\r\n////    this.wdg = new Watchdog(this.fire.bind(this), 30000);\r\n//////    this.wdg = new DelayBuffer(function(){ // working code.\r\n//////      this.mutex = true;\r\n//////      if (pref.debug_mode['7']) console.log('watchdog: '+this.name);}.bind(this), 30000);\r\n////  }\r\n////  MutexWatchdog.prototype = {\r\n////    get: function(){\r\n////      if (this.mutex && !this.abort_req) {\r\n////        this.mutex = false;\r\n////        this.wdg.start();\r\n////        if (pref.debug_mode['5']) console.log('mutex: get: '+this.name);\r\n////        this.req = false;\r\n////        return true;\r\n////      } else {\r\n////        if (!this.abort_req) this.req = true;\r\n////        if (pref.debug_mode['5']) console.log('mutex: fail: '+this.name);\r\n////        this.abort_req = false;\r\n////        return false;\r\n////      }\r\n////    },\r\n////    restart: function(delay){\r\n////      this.wdg.restart(delay);\r\n////    },\r\n////    stop: function(){\r\n////      this.wdg.stop();\r\n////      this.mutex = true;\r\n////      if (pref.debug_mode['5']) console.log('mutex: release: '+this.name);\r\n////    },\r\n////    fire: function(){\r\n////      this.mutex = true;\r\n////      cataLog.scan_boards.scan_abort(this.name);\r\n////      if (pref.debug_mode['7']) console.log('watchdog: '+this.name);\r\n////    },\r\n////    abort: function(){\r\n////      this.abort_req = true;\r\n////      this.stop();\r\n////    },\r\n////    query_req: function(){\r\n////      return this.req;\r\n////    }\r\n////  }\r\n\r\n  var common_func = {\r\n    Object_modifyDescriptor: function(obj,prop,desc){\r\n      desc.__proto__ = Object.getOwnPropertyDescriptor(obj,prop);\r\n      Object.defineProperty(obj,prop,desc);\r\n    },\r\n    Object_defProps: function(dst,src){\r\n      for (var i in src) dst[i] = src[i];\r\n      return src;\r\n    },\r\n    Array_toObj: function(src, val){\r\n      var obj = {};\r\n      for (var i=0;i<src.length;i++) obj[src[i]] = val;\r\n      return obj;\r\n    },\r\n  };\r\n\r\n  var site0 = (function(){ // for less memory consumption and faster execution if background\r\n    var href = window.location.href;\r\n    var domain = null;\r\n    var pref_default = null;\r\n    var pref_default2 = null;\r\n    var href = window.location.href;\r\n    if (href.indexOf('/meguca.org/')!=-1) {\r\n      domain = 'meguca';\r\n      pref_default = {\r\n        pref2:{ meguca:{utilize_boards_json:false, utilize_boards_json_domain:false}},\r\n      // overwritten by easy2 default.\r\n        thread:{ env:{ disp_offset:3}},\r\n        scan:{max:100},\r\n        proto:{env:{event_dynamic:true,}},\r\n        style:{zIndex:300},\r\n        tooltips:{zIndex:302},\r\n      };\r\n      pref_default2 = true;\r\n    } else if (href.search(/(4chan(nel)*|4cdn).org/)!=-1) {\r\n      domain = '4chan';\r\n      pref_default = {\r\n        catalog_expand_with_hr: true,\r\n        page:{env:{disp_filler:'<hr>'}},\r\n        patch: {delayed_invoke: {use: brwsr.ff}},\r\n        catalog: {t2h_sel:'N', thumbnail:{hover:{popup_zIndex:100001}}, env:{popup_native:false}},\r\n        proto:{\r\n          footer:{rOP:false, iOP:false},\r\n          env:{event_dynamic: true}\r\n        },\r\n        easy2:{limits:2},\r\n        style:{addSS:{str:'//s.4cdn.org/css/flags.689.css'}},\r\n      };\r\n    } else if (href.indexOf('lainchan.org')!==-1) {\r\n      domain = 'lain';\r\n      pref_default = {\r\n        page:{ env:{ disp_offset:1}},\r\n        catalog:{image_hover:true, board:{all_boards:true}, env:{disp_offset:1, disp_filler:'                                        '}},\r\n        proto:{ env:{ localtime_native:false,\r\n                      colorID_native: false}},\r\n        stats:{ time_unit:3, patch_tm:true},\r\n        chart: {inst:{show: {p:true}, time_sel:3}},\r\n        easy2:{limits:1},\r\n        thread_reader:{own_posts_tracker:true},\r\n      };\r\n    } else if (href.indexOf('lainchan.jp')!=-1) {\r\n      domain = 'lainjp';\r\n      pref_default = {\r\n        page:{ env:{ disp_offset:1}},\r\n        proto:{ env:{ localtime_native:false,\r\n                      colorID_native: false}},\r\n        stats:{ time_unit:3, patch_tm:true},\r\n        chart: {inst:{show: {p:true}, time_sel:3}},\r\n      // overwritten by easy2 default.\r\n        catalog:{image_hover:true, board:{all_boards:true}, env:{disp_offset:1, disp_filler:' '},},\r\n        thread: {auto_update:true},\r\n        thread_reader:{own_posts_tracker:true},\r\n        scan:{max:100},\r\n        liveTag:{style:{urtm:'color:lime !important;font-weight:bold !important',\r\n                        ur:'color:limegreen !important;font-weight:bold !important',\r\n                        in:'color:red !important'}},\r\n        virtualBoard:{scanDelay:1},\r\n        easy2:{limits:1},\r\n        style:{post_new:'border:2px solid red !important'},\r\n      };\r\n      pref_default2 = true;\r\n    } else if (href.search(/8kun.top/)!=-1) { // 8chan.co|8ch.net\r\n      domain = '8chan';\r\n      pref_default = {\r\n        catalog_expand_with_hr: true,\r\n        page:{ env:{ disp_offset:1, disp_filler:'<hr>'}}};\r\n    } else if (href.search(/krautchan.net/)!=-1) {\r\n      domain = 'KC';\r\n      pref_default = {\r\n        thread_reader:{own_posts_tracker:true, check_num_of_children: false},\r\n        proto:{\r\n          env:{\r\n            popup_native:false,\r\n            expand_thumbnail_inline_native:false,\r\n            image_hover_native:false,\r\n            colorID_native:false,\r\n            backlink_native:false,\r\n            localtime_native:false,\r\n            auto_update_native:false,\r\n          },\r\n        },\r\n        page:{use_expander_always:true},\r\n      };\r\n    }\r\n    var domains = ['meguca', '4chan', 'lain', 'lainjp', '8chan', 'KC'];\r\n    if (domain) domains.unshift(domains.splice(domains.indexOf(domain),1)[0]);\r\n    var domains_all = ['8chan','8chan_live','vichan','KC','4chan_i','4chan','4chanB','4chanR','meguca','imeguca','lain','lainjp']; // , 'CatChan_tgt']; // adding 'CatChan_tgt' with opening fixed-tab is good for testing the step window.\r\n    if (pref_default2) {\r\n      pref_default2 = {// new default patch\r\n        catalog:{auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true},\r\n        liveTag: {use:false, from:'op'},\r\n        virtualBoard:{max:100, scan:true, scan_domains:{}}, \r\n        network:{fetch_actively:false},\r\n        easy2:{presets:1,VB:{local:1},catalog:{auto_update:false},page:{auto_update:false}},\r\n      };\r\n      pref_default2.virtualBoard.scan_domains[domain] = 'board';\r\n    }\r\n    return {\r\n      domain: domain,\r\n      domains: domains,\r\n      pref_default: pref_default,\r\n      pref_default2: pref_default2,\r\n      isStep: window.opener && domains_all.indexOf(window.name)!=-1,\r\n      add_domain: function(domain){\r\n        this.domains.push(domain);\r\n        this.debug_domains.push(domain);\r\n        pref.virtualBoard.scan_domains[domain] = 'none';\r\n        pref.debug_mode.domains[domain] = true;\r\n      },\r\n      debug_domains: ['DEFAULT','4chan','vichan','lain','lainjp','8chan','8chan_live','KC','meguca','meguca1','meguca2'],\r\n      debug_types: ['','_json','_html'], // ,'_json_template','_html_template']; // '' for common\r\n    };\r\n  })();\r\n\r\n  var pref4 = { // dynamic, but not auto sync objects.\r\n    funcs:{\r\n      set_options_to_selector: function(sel,options){\r\n        sel.length = options.length;\r\n        for (var i=0;i<options.length;i++) sel.options[i].text = options[i];\r\n      },\r\n    },\r\n    archive: {\r\n      IDB_board_sel_gfunc_pre:function(p,k,v,n,f){\r\n        pref4.funcs.set_options_to_selector(f,pref4.archive.IDB_board_sel_options || ['Wait...']);\r\n      },\r\n      IDB_board_sel_options: null,\r\n      IDB_thread_sel_gfunc_pre:function(p,k,v,n,f){\r\n        pref4.funcs.set_options_to_selector(f,pref4.archive.IDB_thread_sel_options || ['Wait...']);\r\n      },\r\n      IDB_thread_sel_options: null,\r\n    },\r\n    refresh:{ count:0},\r\n    search_posts_active_once: false,\r\n    scan: {\r\n      get loosen(){return pref4.search_posts_active_once && pref.proto.searchAc.loosen;},\r\n      get max(){return site.whreami==='archive'? pref.scan.max_archive : this.loosen? pref.proto.searchAc.max : pref.scan.max;},\r\n      get max_threads(){return site.whreami==='archive'? pref.scan.max_archive : this.loosen? pref.proto.searchAc.max_threads : pref.scan.max_threads;},\r\n      max_threads_at_refresh: function(clg){return this.loosen? pref.proto.searchAc.max_threads_at_refresh : clg.pref.INST.safety.max;},\r\n    },\r\n    mergeHist: {max:16,  proto:[]},\r\n  };\r\n\r\n  var pref0 = { // static shared defaults\r\n    triage:{\r\n      menu_str: 'KILL,Hide permanently,\\n'+\r\n                'TIME,Hide until new replies,\\n'+\r\n                'WATCH,Watch,\\n'+\r\n                'UNWATCH,Unwatch,\\n'+\r\n                'STICKY,Sticky,\\n'+\r\n                'UNSTICKY,Unsticky,\\n'+\r\n                'UNDO,Undo,',\r\n      postMenu_str: 'PHIDE,hide,\\n'+\r\n                    'PHIDEAFTER,hide+,\\n'+\r\n                    'PUNHIDE,unhide,\\n',\r\n    },\r\n    footer:{\r\n      native: '(ar )(U: nm/nr / )(<iB>)R: (lp/)(RP)(*sp)(+dp)(</iB>)( /<iI> I: IM</iI>)( / P: pg) (ni/nf )(ct )(cT )(bt )(bT )(pt )(pT )(pr )(dn)(bd)(no) ',\r\n      custom2:'(ar )(nm/)(nr/)(<iB>)(lp/)(RP)(*sp)(+dp)(</iB>)(/<iI>IM</iI>)(/pg) (ni/nf) (ct )(cT )(bt )(bT )(pt )(pT )(pr )(dn)(bd)(no) ',\r\n      custom3:'(ar )(nm/)(nr/)(lp/)(<iB style=\"color:orange\">RP</iB>)(<u>*sp</u>)(<span style=\"opacity:0.6\">+dp</span>)(/<iI style=\"color:orange\">IM</iI>)(/pg) (<u>ni/nf</u>) (ct )(cT )(bt )(bT )(pt )(pT )(pr )(dn)(bd)(no) ',\r\n    },\r\n  };\r\n\r\n  function pref_default(for_save) {\r\n    var proto = {\r\n      image_hover:false,\r\n      image_prefetch:false,\r\n      click: 'none',\r\n      click_area: 'thumbnail',\r\n      format: {show:  {style:  true, contents:  true, layout:  true, posts: false, fileinfo: false, images_2nd: true},\r\n               hover: {style:  true, contents: false, layout: false, posts:  true, fileinfo:  true, images_2nd: true},\r\n               search:{style: false, contents: false, layout: false, posts:  true, fileinfo:  true, images_2nd: true},\r\n               thumb: {resize: false, size:'small', small:{w1:150, h1:150, w2:75, h2:75}, large:{w1:250, h1:250, w2:125, h2:125},\r\n                       vsmall:{w1:80, h1:80, w2:40, h2:40}, custom:{w1:80, h1:80, w2:40, h2:40}},\r\n               c:  {width:165, height:0, max:false},\r\n               ec: {width:240, height:350, max:true},\r\n      },\r\n      footer: {use:true, nrtm:true, nr:true, rp:true, rp0:false, im:true, domain:false, board:true, no:false, flag:false, tag:true, page:true, design:'native', rOP:true, iOP:true,\r\n               custom: pref0.footer.native, custom2:pref0.footer.custom2, custom3:pref0.footer.custom3,\r\n               ctime:false, btime:false, ptime:false, rctime:false, rbtime:false, rptime:false, br:true, prate:false, archived:true, nd:false, nl:false, nf:false, nid:false, ns:false,\r\n               triage:false, menu:true, triage_str:'KILL,x,,SPC, ,', menu_str:'SPC, ,,MENU,\\u25b6,', merged_tag:'no',\r\n               nr0:false, nr1:false, nr1_style:'color:limegreen;font-weight:bold', nrtm0:false, nrtm1:false, nrtm1_style:'color:lime;font-weight:bold'},\r\n      triage_hover:true,\r\n//      footer_br: true,\r\n      draw_on_demand: true,\r\n      load_on_demand: false, load_on_demand_timeout: 10,\r\n      t2h_sel: 'page',\r\n      t2h_L: 100,\r\n      t2h_M: 50,\r\n      get t2h_N(){return this.t2h_num_of_posts},\r\n      t2h_num_of_posts : 5,\r\n      save_board_list_sel: false,\r\n      board_list_sel: 0,\r\n      mark_new_posts: true,\r\n      auto_update : false,\r\n      auto_update_period : 10,\r\n      auto_update_countdown : true,\r\n      storePosts:'auto', sourceOfSP:'auto', searchAs:false, searchAsA:false, searchAc:{loosen:true, max:1000, max_threads:10000, max_threads_at_refresh:10000},\r\n\r\n      popup:true, colorID:true, backlink:true, popup_truncated:true, popup_zIndex:100, backlink_all:false, backlink_all_cross:false,\r\n      popup_hlt:true, bl_ec:false, bl_rm:true,  // popup_highlight, backlink_explicit_cross, baclink_remove_if_OP\r\n      popup_delay:50, popdown_delay:500, popdown:'delay', popup_mMove:true,\r\n      inline_post:'inline',\r\n      link_show_op:true, link_show_cross:true,\r\n      expand_thumbnail_inline:true, localtime:true,\r\n      expand_thumbnail_inline_all_after:false,\r\n//      expand_thumbnail_initial:false,\r\n      hide_posts_without_images:false,\r\n      thumbnail:{\r\n        inline:{ondemandStop:true, stopHover:true, ref_height:150, // ondemand:true,\r\n                limit_width: true, limit_height:false, margin_width: 40, margin_height: 0, webm: true, webm_mute:false, webm_loop:false},\r\n        hover: {limit_width: true, limit_height: true, margin_width: 40, margin_height: 0, webm:false, webm_mute: true, webm_loop:false, webm_ctrl:true,\r\n                popup_delay:50, popdown_delay:500, popdown:'delay', popup_mMove:true, popup_zIndex:101,\r\n                dragfloat:true, df_dblC:true, df_mW:true, zoom_click:false, zoom_over:false, zoom_dblC:true, zoom_mW:true},\r\n      },\r\n      infoPv: {use:false, popup_delay:200, popdown_delay:0, popdown:'delay', popup_mMove:false, popup_zIndex:101},\r\n      popupX: {popup_delay:500, popdown_delay:500, popdown:'delay', popup_mMove:true, popup_zIndex:101, use:false, ID:true, flag:true, name:false, anon:false, trip:false, ID2:false},\r\n//      popupID: {popup_delay:500, popdown_delay:500, popdown:'delay', popup_mMove:true, popup_zIndex:101},\r\n//      popupFlag: {popup_delay:500, popdown_delay:500, popdown:'delay', popup_mMove:true, popup_zIndex:101},\r\n//      popupName: {popup_delay:500, popdown_delay:500, popdown:'delay', popup_mMove:true, popup_zIndex:101, anon:false},\r\n//      popupTrip: {popup_delay:500, popdown_delay:500, popdown:'delay', popup_mMove:true, popup_zIndex:101},\r\n      open_spoiler_text: false,\r\n      open_spoiler_image: false,\r\n      merge: false, merge_list: false, merge_list_str: '', merge_list_obj6: null, merge_truncated: false,\r\n      merge_lv:true, merge_lv_str:'', merge_lv_obj6:null,\r\n      merge_auto_list:false, merge_auto_list_lv:2, merge_auto_list_lv_add:true,\r\n      merge_op_auto:false, merge_op_lv:0, merge_op_lv_add:true, merge_op_auto_hop:0, merge_op_lv_inc:true, merge_op_attr:false, merge_op_list:false,\r\n      merge_btn:true, merge_btn_mode:'list', merge_btn_lv:2, merge_btn_lv_add:true,\r\n      lazyDraw: {merge: true, merge_step: 16, step: 16},\r\n      scroll_lock: false,\r\n      use_expander_always: false,\r\n//      popup2:'sr',\r\n      popup2_sel:'auto', popup2_sel_tolerance:10, popup2_resize:false, popup2_resize_bw:8, popup2_resize_cw:20,\r\n      popup3: {ww:'no', wn:'no', nw:'no', nn:'no', popup_delay:300, popdown_delay:500, popdown:'delay', popup_mMove:true, popup_zIndex:100, oX:10, oY:10}, // oX,oY is short for offsetX,Y\r\n      posts_search_op: 'opaque',\r\n      posts_search_op_opacity: 40,\r\n      deleted_posts: {detect:'acc', store:'LS', merge:true, auto_clean:true},\r\n      detect_sage: false, page_his: false,\r\n//      auto_config_posts_search: true,\r\n      promiscuous: false, accept_others_refresh:false,\r\n      hide_unwatched: false, refresh_src:'bg', refresh_src_th:3, \r\n      postMenu:true,\r\n      appearance: {\r\n        titleBar: {filter: true, settings: true, refresh: true, boards_selector: true},\r\n        initial: {state: 'float', width: 400, height: 400, left:0, top:0},\r\n        orderOnTB: false,\r\n        expand: {kwd:true, time:true, tag:false, list:false, ctrl:false},\r\n      },\r\n      imagesearch: {\r\n        use: true,\r\n        google: true,\r\n        iqdb: true,\r\n        saucenao: true,\r\n        whatAnime: true,\r\n        desustorage: true,\r\n        exhentai: true,\r\n      },\r\n      safety: {hide:false, remove:false, max:10000}, // at refresh\r\n      triage_place: 'topLeft',\r\n\r\n      env: {\r\n        disp_offset:0,\r\n        disp_filler:'',\r\n        popup_native:true,\r\n        expand_thumbnail_inline_native:true,\r\n        image_hover_native:false,\r\n        colorID_native:true,\r\n        backlink_native:true,\r\n        localtime_native:true,\r\n        auto_update_native:false,\r\n        event_dynamic:false,\r\n        popup_native_kill:true,\r\n        refresh_initial:true,\r\n//        thread_pos_static:true,\r\n        kwd_filter_delay: 0, kwd_filter_delay_len: 5,\r\n      },\r\n    };\r\n    var pref_new = {\r\n      script_prefix: 'CatChan',\r\n      features: {\r\n        page: true, graph: true, setting: true, setting2: true, postform: true, catalog: true, listener : true, uip_tracker: true, thread_reader: true, debug: false,\r\n        notify:{desktop:true, sound:true, favicon:true},\r\n        recovery: true,\r\n        domains: common_func.Array_toObj(site0.domains, true),\r\n      },\r\n      max_capture: 576,\r\n      interval_found: 10,\r\n      write_to_ls: true,\r\n      aggregator: 'true', // radiobutton\r\n      server: true,\r\n      load_pref: true,\r\n      load_data: true,\r\n      check_page: false,\r\n      check_post: false,\r\n      check_thread: false,\r\n      import_format: 'obj', // radiobutton\r\n      max_graph: 576, // radiobutton\r\n      scale_thread: 10,\r\n      auto_start: true,\r\n//      workaround_for_dollchan: false,\r\n      prevent_redirection: false,\r\n      graph_animation: false,\r\n      autoconf: 'auto',\r\n      info_server: false,\r\n      info_client: false,\r\n      wafd_tb: 'tb',\r\n      wafd_open_spoiler: false,\r\n      show_page_fraction : true,\r\n      catalog_max_page: 5,\r\n      catalog_max_page_auto: true,\r\n      catalog_max_page_select: 'auto',\r\n      catalog_snoop_refresh: true,\r\n      catalog_auto_rollup_when_moving: true,\r\n//      catalog_size_width: 240,\r\n//      catalog_size_height: 350,\r\n//      catalog_size_text_width: 400,\r\n//      catalog_size_text_height: 16,\r\n//      catalog_size_tn1_width: 240,\r\n//      catalog_size_tn1_height: 240,\r\n//      catalog_size_tn2_width: 80,\r\n//      catalog_size_tn2_height: 80,\r\n      catalog_size_frame0_width: 30,\r\n      catalog_size_frame1_width: 69,\r\n//      catalog_enable_cross_board: true,\r\n//      catalog_enable_cross_domain: true,\r\n      catalog_2nd_images_show: false,\r\n      catalog_2nd_images_hover: true,\r\n      catalog_2nd_images_search: true,\r\n      catalog_posts_on_demand: true,\r\n//      catalog_checkbox_deletion_show: false,\r\n//      catalog_checkbox_deletion_hover: true,\r\n//      catalog_checkbox_deletion_search: true,\r\n//      catalog_popup: true,\r\n//      catalog_popdown: 'delay',\r\n//      catalog_popup_delay: 300,\r\n//      catalog_popdown_delay: 500,\r\n      catalog_popup_size_fix: true,\r\n      catalog_open_last50: 'exist_watch',\r\n      catalog_board_list_str: '//sample of board group\\n' +\r\n//        '//board_name[,nickname+board_name[+thread No.] | \\'*\\'+up to X page | \\'^\\'+style]...\\n'+\r\n        '//board_name[,nickname+board_name[+thread No.][\\'*\\'+up to X page]]..., [#Tag|##Tag]..., [!stats]\\n'+\r\n        'Global/int/,8chan/int/,KC/int/,4chan/int/\\n'+\r\n        'Global/b/,8chan/b/,KC/b/,4chan/b/\\n'+\r\n        'v+gg,8chan/v/,8chan/gamergatehq/,4chan/v/\\n'+\r\n        'Inter/pol/,8chan/pol/,4chan/pol/\\n'+\r\n        'JapanShoppingMall,8chan/jpck/,8chan/japan2/\\n'+\r\n        'tech,meguca/g/,lain/tech/,8chan/tech/,4chan/g/,KC/t/\\n',\r\n//        'ScriptHome,8chan/scriptcdc/,KC/jp/35003\\n',\r\n//        'script_home,8chan/scriptcdc/,KC/jp/35003,KC/kc/41434\\n',\r\n      catalog_board_list_obj: null,\r\n      catalog_promiscuous: false,\r\n//      catalog_board_list_sel: 0,\r\n      get catalog_board_list_sel() {return (cataLog && cataLog.embed_mode && this[cataLog.embed_mode])? this[cataLog.embed_mode].board_list_sel : 0;},\r\n      set catalog_board_list_sel(val) {if (cataLog && cataLog.embed_mode && this[cataLog.embed_mode]) this[cataLog.embed_mode].board_list_sel = val;},\r\n//      catalog_sw_domain: 'https://8chan.co',\r\n      localtime_offset : -(new Date().getTimezoneOffset()/60),\r\n//      catalog_localtime : true,\r\n//      catalog_border_show : false,\r\n//      catalog_border : '1px solid',\r\n//      catalog_enable_background : false,\r\n      catalog_footer_ignore_my_own_posts : true,\r\n      catalog_footer_tag_letters : 3,\r\n      catalog_no_popup_at_expanded : true,\r\n      catalog_open_in_new_tab : true,\r\n      catalog_open_where : 'named',\r\n      catalog_open_where_click : true,\r\n//      catalog_use_named_window : true,\r\n//      catalog_triage : true,\r\n//      catalog_triage_place : 'topLeft',\r\n      catalog_triage_hist : 16,\r\n      triage:{\r\n        popdown:true, popdown_delay:2000, hide_toggle:true, sync_ex:'bg', sync_attr:'bg', sync_watch:'bg', // zIndex:110,\r\n        menu_str: pref0.triage.menu_str,\r\n        postMenu_str: pref0.triage.postMenu_str,\r\n      },\r\n      catalog_triage_str: 'KILL,X,,TIME,v,,WATCH,W,,UNWATCH,UW,,UNDO,U,',\r\n      catalog_auto_update_countdown : true,\r\n//      catalog_show_setting : false,\r\n//      catalog_expand_at_initial : false,\r\n//      catalog_expand_at_initial_embed : true,\r\n      catalog_expand_with_hr : false,\r\n      cli: {auto:false,\r\n            json_str:'//{\"site2\":{\"KC\":{\"time_offset\":2}}} // summer time for KC.\\n'+\r\n                     '//{\"site2\":{\"4chan\":{\"protocol\":\"https:\"}}} // use https to 4chan.\\n'+\r\n                     '//{\"pref\":{\"patch\":{\"rm_404_blacklist\":[\"8chan\"]}}} // 8chan sends corrupted data.\\n',\r\n            eval_str: '',\r\n           },\r\n//      show_tooltip : true,\r\n      tooltips: {help: {show: true, popup_delay:2000, popdown_delay:1000},\r\n                 info: {show: true, popup_delay:300,  popdown_delay:500},\r\n                 zIndex:100},\r\n      filter: {\r\n//          show : false,\r\n        kwd: {use:false, str:'', re:false, ci:true, match:0, sentence:false, ew:false, op:true, post:false, inPost:false,\r\n                sub:true, name:true, trip:false, com:true, file:false, meta:false, flag:false, id:false, id2:false,   rexps:null},\r\n          tag      : false,\r\n//          tag_list_str : '',\r\n//          tag_scan_auto : false,\r\n          tag_ci   : false,\r\n          time     : false,\r\n          time_creation : false,\r\n          time_str : new Date(Date.now()-86400000).toLocaleString(),\r\n          time_obj6 : null,\r\n//          time_ago_str : '24:00',\r\n          time_ago_str : '0:00',\r\n          time_ago_str_sync_at_refresh : false,\r\n//          time_track : false,\r\n//          time_mark : false,\r\n          desktopime_mark_str : '',\r\n          time_watch : false,\r\n          time_watch_creation : false,\r\n          list_time_scroll: true,\r\n          list : true,\r\n//          list_mark_time : true,\r\n          list_str : '',\r\n//          list_obj : [],\r\n          list_obj2 : {},\r\n          attr_list : true,\r\n          attr_list_str : '',\r\n          attr_list_obj2 : {},\r\n          bookmark_list : true,\r\n          bookmark_list_str : '',\r\n          bookmark_list_obj2 : {},\r\n          watch_list_str : '',\r\n          watch_list_obj2 : {},\r\n//          watch_list_mark_time : true,\r\n//          tag_scansite : true,\r\n          tag_search: {str:'', re:false, show_nof_boards:false,   get ci(){return pref.liveTag.ci;}, sentence:false, rexps:null},\r\n          tag2bList: {label:'', by:'tag'},\r\n          auto_list: {use:false, str:'', obj7:null, kill:false, watch:true, show:false, sticky:false, style:false, style_str:''},\r\n          disLWKA:true, disTWKA:false, // disable list/tag filter when keyword filter is active\r\n          postFilter: {use:false, hide:false, boards:false, boards_str:'', style:true, style_str:'', str:'', obj7:null, obj7_old:null},\r\n      },\r\n      postFilter: {use:false, str:'', obj7:null, obj7_old:null},\r\n      catalog: {\r\n//        get filter(){console.log('WARNING: catalog.filter is accessed'); return pref.filter;}, // for safe\r\n//        max_threads : 512,\r\n        max_threads_at_refresh : 500,\r\n        bookmark_list_rm404 : true,\r\n        auto_load_filter : false,\r\n        auto_save_filter : false,\r\n        auto_save_filter_at_refresh : false,\r\n        tag : {ignore:12, max:12},\r\n        board: {recommendation: true, all_boards:false, board_tags: false, ex_list: false, ex_list_str: '', ex_list_obj2: null, board_tags_same: false},\r\n        style_general_list : true,\r\n        style_general_list_str: '',\r\n        style_general_list_obj2: null,\r\n        refresh : {except_bt : true, at_switch: true},\r\n        design : 'auto',\r\n        catalog_json : true,\r\n        embed : true,\r\n        embed_page: true,\r\n        embed_frame : true,\r\n        embed_archive: false,\r\n//        order : {reply_to_me: true, reply: true, watch: 'dont_care', sticky:'dont_care', find_sage_in_8chan: false},\r\n        order: {reply_to_me:true, reply:true, watch:'dont_care', sticky:'first', ordering:0},\r\n//        health_indicator: {on: true, max:10},\r\n        auto_watch: true, auto_watch_override: false, auto_watch_override_str: 'WATCH,,',\r\n        mimic_base_site: true,\r\n//        text_mode: {mode:'graphic', sub:true, name:false, com:true},\r\n        appearance: {titleBar:{__proto__:proto.appearance.titleBar}, expand:{__proto__:proto.appearance.expand}, __proto__:proto.appearance},\r\n        t2h_sel: 'no',\r\n        click: 'open',\r\n        popupX: {__proto__:proto.popupX},\r\n//        env:{thread_pos_static: false, __proto__:proto.env},\r\n        footer: {__proto__:proto.footer}, // this is required for save, or refers proto directly and deletes them all.\r\n//        view: 'catalog',\r\n        env:Object.create(proto.env),\r\n        format: {thumb: {__proto__:proto.format.thumb}, __proto__:proto.format},\r\n        merge_lv:false,\r\n        infoPv: {use: false, __proto__:proto.infoPv},\r\n        safety: {__proto__:proto.safety},\r\n        searchAs:true, accept_others_refresh:true,\r\n        __proto__: proto},\r\n      page: {\r\n        get embed(){return pref.catalog.embed_page;},\r\n        infinite: false, \r\n//        scan_tag:true,\r\n        format: {show:{style:false, contents:false, layout:false, posts:true, fileinfo:true, images_2nd:true},\r\n                 thumb: {__proto__:proto.format.thumb},\r\n                 __proto__:proto.format},\r\n        image_hover:true,\r\n//        get footer(){return pref.catalog.footer;},\r\n//        footer_br: false,\r\n        load_on_demand: true,\r\n        popupX: {__proto__:proto.popupX},\r\n        env: {kwd_filter_delay: 500, __proto__:proto.env},\r\n//        view: 'page',\r\n        appearance: {titleBar:{__proto__:proto.appearance.titleBar}, expand:{__proto__:proto.appearance.expand}, __proto__:proto.appearance},\r\n        safety: {__proto__:proto.safety},\r\n        __proto__: proto},\r\n      thread: {\r\n        embed: false,\r\n        format: {show:{style:false, contents:false, layout:false, posts:true, fileinfo:true, images_2nd:true},\r\n                 thumb: {__proto__:proto.format.thumb},\r\n                 __proto__:proto.format},\r\n        image_hover:true,\r\n//        get footer(){return pref.catalog.footer;},\r\n//        footer_br: false,\r\n        popupX: {__proto__:proto.popupX},\r\n        env:{auto_update_native:true, refresh_initial:false, kwd_filter_delay:500, __proto__:proto.env},\r\n//        t2h_num_of_posts : -1,\r\n        auto_update: false,\r\n//        use_expander_always: true, // for merge\r\n//        view: 'thread',\r\n        merge_btn_mode:'all',\r\n        triage_hover:false,\r\n        appearance: {titleBar:{__proto__:proto.appearance.titleBar}, expand:{time:false, __proto__:proto.appearance.expand}, __proto__:proto.appearance},\r\n        safety: {__proto__:proto.safety},\r\n        __proto__: proto},\r\n      float: {\r\n        click: 'open',\r\n        footer: {triage:true, __proto__:proto.footer},\r\n//        get footer(){return pref.catalog.footer;},\r\n        format: {thumb: {resize: true, __proto__:proto.format.thumb},\r\n                 fc: {resize: false, width:240, height:350, max:true},\r\n                 __proto__:proto.format},\r\n        save_board_list_sel: true,\r\n        popup3: {__proto__:proto.popup3},\r\n        popupX: {__proto__:proto.popupX},\r\n        env:Object.create(proto.env),\r\n        order: {reply_to_me:true, reply:true, watch:'dont_care', sticky:'first', ordering:0},\r\n        view: 'headline', hide_unwatched:false, refresh_src:'wl', catalog_size: 0, catalog_teaser: 0,\r\n        disable_kwd_filter_at_initial: true, \r\n        auto_launch: false, clone:true,\r\n        appearance: {titleBar:{__proto__:proto.appearance.titleBar}, expand:{__proto__:proto.appearance.expand}, __proto__:proto.appearance},\r\n        safety: {__proto__:proto.safety},\r\n        __proto__: proto},\r\n      headline:{\r\n        triage_hover:false,\r\n        triage_place:'topLeft',\r\n        max_letters: 150,\r\n        merge_truncated: true,\r\n        merge_lv: false,\r\n      },\r\n      common: {\r\n        clear_at_manual_scan : false,\r\n        consolidated_filter: false, // true,\r\n        consolidated_watch_list: true,\r\n        sync_watch_list: true,\r\n        sync_watch_list_delay: 100,\r\n        watch_list_rm404: 'no',\r\n        blur_404: true,\r\n//        watch_list_fromAutoKwd: true,\r\n//        watch_list_fromTimeFilter: false,\r\n      },\r\n\r\n//      graph : {key: null, pipe: null},\r\n      uip_tracker: {on : false, posts: true, deletion: true, interval: 10, adaptive: true, highlight_str:'color:red', annotate:true,\r\n                    auto_open:false, auto_open_th:300, auto_open_kwd:'',\r\n                    deletion: {show:true, link:true, name:true, name_str:'color:red', addName:true, addName_str:'DELETED_', post:false, post_str:'opacity:0.4'},\r\n                    sage: {detect:true, name:true, name_str:'color:blue', addName:false, addName_str:'SAGE_', post:false, post_str:'opacity:0.4', tolerance:1,\r\n                           patch_bug:false, patch_bug2:false, patch_bug2nth:8, patch_bug3:true, annotate:true, page:false, patch_bug4:true, patch_bug5:false, annotate_page:false}},\r\n      thread_reader: {use: true, sync: true, triage: true, triage_close: true, check_num_of_children: true,\r\n                      own_posts_tracker: false, show_own_post_by: 'anchor', show_reply_to_me_by: 'anchor', clean_up_own_posts: true, unmark_on_hover: true},\r\n      IDinfo: {use:true, auto:true,\r\n               ID:  {use:true,  nof:true, op:true, h:'', t:''},\r\n               ID2: {use:false, nof:true, op:true, h:'', t:''},\r\n               flag:{use:true,  nof:true, ID:true, h:'(', t:')'},\r\n               trip:{use:false, nof:true, name:false, h:'(', t:')'},\r\n               name:{use:false, nof:true, trip:false, h:'(', t:')'}},\r\n//      IDinfo: {use:true, ID:true, flag:true, flagID:true, IDop:true, nofIDs:true, nofFlags:true, auto:true, name:false, trip:false, nameTrip:false, nofNames:true, nofTrips:true,\r\n//               ID2:true, ID2op:true, nofID2s:true, tripName:false},\r\n      settings: {indexing: 0},\r\n      tag : {gen: false, gen_str:''}, // dummy for checkbox and textarea.\r\n      cloudflare: {auto_reload: true, auto_reload_time: 5},\r\n      scan: {max:10000, lifetime:20, crawler:50, max_threads:1000, crawler_adaptive:true, crawler_idle_time_to_spawn:100, max_archive:150},\r\n      notify : {sound: {notify: false, src:'beep', beep_freq:1000, beep_length_f:0.2, beep_volume_f:1, reply_to_me: true, reply: true, new_thread: true, appear: true, supp_init:true},\r\n                desktop: {notify: true, reply_to_me: true, reply: true, new_thread:true, appear:true, lifetime:30, show_last:false, supp_init:true,\r\n                          limit:(brwsr.ff)? 10 : 30, delay:(brwsr.ff)? 500 : 0},\r\n                favicon: true,\r\n                title: {notify:true, hide_zero: true},\r\n               },\r\n      liveTag: {\r\n        use: true, max: 12, maxstr: 25, from:'post', lock_tags_in_op: true, ci: true,\r\n        inherit_board_name: true, lock_board_name: true, inherit_board_tags: true, lock_board_tags: true,\r\n        info: true, NC: true, // NotConsolidated\r\n        style: {ex:'color:blue', exurtm:'color:cyan;font-weight:bold', exur:'color:deepskyblue;font-weight:bold',\r\n                in:'color:red', inurtm:'color:yellow;font-weight:bold', inur:'color:orange;font-weight:bold',\r\n                use:true, urtm:'color:lime;font-weight:bold', ur:'color:limegreen;font-weight:bold'},\r\n//        style_urtm_obj4:{},                           style_ur_obj4:{},                                style_in_obj4:{},\r\n        pickup_interval: 10, rm_404:'imm', disp_delay:{fg:500, bg:5000}, click_func: 'in', click_func_bl: 'pkin',\r\n        watch_all: true, lazy_each:150, lazy_delay:100,\r\n        ex_list: true, ex_list_str:'8chan:#selection\\n', ex_list_obj5:null,\r\n        rm_list: true, rm_list_str:'http*\\n', rm_list_obj5:null},\r\n      virtualBoard: {\r\n        show: true, max:20, scan: false, scanDelay: 5, p_board: 'replace', p_remove: false, v_remove:true,\r\n        scan_domains: common_func.Array_toObj(site0.domains,'none'),\r\n//        scan_domains: {meguca:'none', lain:'none', '8chan':'none', '4chan':'none', KC:'none', lainjp:'none'},\r\n        instant_scan: true,\r\n        search: {show: true,  str:'', re:false,    get ci(){return pref.liveTag.ci;}, sentence:false, rexps:null},\r\n      },\r\n      tagSearch:{auto:false, th_b:20, th_t:1}, // for 8chan\r\n      style:{\r\n        sel: 'fix', zIndex:1,\r\n        fix:{\r\n          titleBar_str:'background:#b5ccf9;border:1px solid blue;font-weight:normal',\r\n          window_str:'background:#e5ecf9;color:#000000;font-weight:normal',\r\n          popUp_str:'background:#e5f4f9;color:#000000;border:2px solid blue;font-weight:normal'\r\n        },\r\n        copy:{titleBar_str:'body', window_str:'body', popUp_str:'body'},\r\n        post_editing: 'background:#cec952 !important',\r\n        post_new: 'border:2px solid red',\r\n        userCSS: {use:false, str:''},\r\n        tips:{\r\n          merged1:true, merged1_str:'merged1::before{float:left;content:\">\";}',\r\n          merged2:true, merged2_str:'merged2::before{float:left;content:\">>\";}',\r\n          merged3:true, merged3_str:'merged3::before{float:left;content:\">>>\";}',\r\n        },\r\n        addSS: {use:false, str:''},\r\n      },\r\n      recovery:{comment:true, interval:10, auto_clean:true},\r\n      healthIndicator: {show:true, max:10, expand_running:false, dont_retire_running:true, cancel:true},\r\n      network: {cross_domain:'indirect', fetch_actively:true, adaptive:true, th100:5, th100_delay:500, th20:10, th20_delay:100, timeout:15, overXFO:true, overCSPF:true},\r\n      stats: {use:false, retain_404:true, draw_delay:10, estimate_posts:true,\r\n              save:true, load:true, len_capture:1440, auto_acquisition:true, auto_acquisition_scan:true, auto_acquisition_scan_delay:120, auto_acquisition_all:false, \r\n              tolerant:true, tolerance:90, patch_tm:false},  // patch_tm is a patch for thread moving in lainchan or 4chan/bant/.\r\n      chart: {off_anime_blur:true, window_width:400, window_height:400, instant_scan:true, load_on_demand:false,\r\n              inst:{len:120, scale_thread:10, time_sel:1, board_sel:0, show_legend:true, // separate:false, \r\n                    show: {np:true, p:false, ep:false, nt:false, t:true, et:false}, clip_np:false, clip_np_val:0,\r\n                    options: {bezierCurve: false, animation:false, pointDot:true, pointDotRadius:4}}},\r\n      archive:{load_img:true, restore_auto:true, clear_threads:true, clear_files:false, format:'auto', domain:0, board:'',\r\n               src:'shown', store_auto:false, dir_dled:null, open_local:false, fix_inconsistency:true, store_watched:false,\r\n               oneshot: {post:true, tn:true, img:true,  webm:true , post_idb:true, tn_idb:true, img_idb:true,  webm_idb:true},\r\n               live:    {post:true, tn:true, img:false, webm:false, post_idb:true, tn_idb:true, img_idb:false, webm_idb:false},\r\n               deleted: {post:true, tn:true, img:false, webm:false, post_idb:true, tn_idb:true, img_idb:false, webm_idb:false},\r\n               IDB:     {auto_clean:true, auto_clean_init:true, prune:168, prune_flush:false, nof_tr:10, nof_cl:20, nof_cl_max:80,\r\n                         auto_restore:false, auto_restore_watch:false, auto_restore_remove:true,\r\n                         watchdog:120, redirect_404: false, redirect_404_CSP: false}, // check_every:1, },\r\n               kwd: {use:true, str:'', re:false, ci:true, match:0, op:true, post:false, sub:true, name:true, trip:false, com:true, file:false, meta:false, sentence:false,    rexps:null},\r\n               list:true,\r\n               list_str:'', list_obj6:null, list_inherit:false,\r\n               tar: true, tarsize: 100, sub_in_filename:true,\r\n//               get list_str(){return pref3.archive.list_str_get();},\r\n//               set list_str(val){pref3.archive.list_str_set(val);},\r\n               files_sel:0,\r\n               IDB_board_sel:0,  IDB_board_sel_gfunc_pre:pref4.archive.IDB_board_sel_gfunc_pre,\r\n               IDB_thread_sel:0, IDB_thread_sel_gfunc_pre:pref4.archive.IDB_thread_sel_gfunc_pre,\r\n               IDB_select_multiple: true,\r\n               editing_timeout: true,\r\n              },\r\n      threadStats: {use:false, full:true, retry:false},\r\n      debug_mode : {unread_count:'', parse_error:false, site2func:'', site2func_expand:true, pfunc:'', pfunc_expand: true, pfunc_all:'', pfunc_all_expand: true,\r\n                    pfunc_comp:'', pfunc_comp_expand_same:true, pfunc_comp_expand_diff:true, pfunc_comp_proto:'', domains: common_func.Array_toObj(site0.debug_domains,true),\r\n                    types: common_func.Array_toObj(site0.debug_types, true)},\r\n      test_mode: {tips:false, num:0, num_f:0, test_str:''},\r\n      patch: {\r\n        delayed_invoke: {use: false, sec: 10},\r\n        rm_404_blacklist: [], //['8chan'], // 8chan sends corrupted data.\r\n      },\r\n      pref2: {\r\n        KC: {summer_time: false},\r\n        meguca: {\r\n//          get remove_history_class(){return pref.catalog_open_where!=='_self';},\r\n          historyAPI: true,\r\n          utilize_boards_json:true, utilize_boards_json_domain:true,},\r\n        '8chan': {utilize_boards_json:true,},\r\n        BBC: {summer_time: true},\r\n      },\r\n      easy: {posts_ago:24, threads_ago:24, max_boards:50,},\r\n      easy2: {\r\n        reset: true, presets: 0, time_post:24, time_op:24, basics:true, // easy2 local parameters.\r\n        auto_update:false, auto_update_period:10, // easy2 local parameters.\r\n        VB: {local:0, global:0}, LTfrom: 0, limits:0, // easy2 local parameters.\r\n        virtualBoard: {show:true, scan:true, max:100},\r\n        liveTag: {use:false, from:'op'},\r\n        catalog: {embed:true, embed_page:true, max_threads_at_refresh:500,\r\n                  auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:10},\r\n        filter: {time_watch:false, time_watch_creation:false},\r\n        page:{auto_update:true, auto_update_period:10},\r\n        thread: {embed:false, auto_update:true, auto_update_period:10},\r\n        notify:{desktop:{notify:true}},\r\n        stats: {use:false},\r\n        scan:{max:100, max_threads:1000},\r\n        network:{fetch_actively:false},\r\n        healthIndicator:{expand_running:false},\r\n      },\r\n      INST:{},\r\n      proto: proto, // for overwrite from pref_default.\r\n    };\r\n    for (var i=0;i<40;i++) pref_new.debug_mode[i] = false;\r\n    for (var i=0;i<200;i++) pref_new.test_mode[i] = false;\r\n    if (site0.pref_default2) pref_func.pref_overwrite(pref_new,site0.pref_default2);\r\n    if (site0.pref_default ) pref_func.pref_overwrite(pref_new,site0.pref_default);\r\n//    if (site) if (site2[site.nickname].pref_default) pref_func.pref_overwrite(pref_new,site2[site.nickname].pref_default);\r\n    if (for_save) {\r\n      pref_func.delete_null(pref_new);\r\n//      Object.defineProperty(pref_new.page,  'footer',{get:function(){return pref_new.catalog.footer;}, enumerable:true, configurable:true}); // patch for refer to each object instead of global pref.\r\n//      Object.defineProperty(pref_new.thread,'footer',{get:function(){return pref_new.catalog.footer;}, enumerable:true, configurable:true});\r\n//      Object.defineProperty(pref_new.float, 'footer',{get:function(){return pref_new.catalog.footer;}, enumerable:true, configurable:true});\r\n    } else Object.defineProperty(pref_new, 'samples', {get:function(){return pref_func.settings.samples;}});\r\n    common_func.Object_modifyDescriptor(pref_new.style.userCSS,'sample',{writable:false});\r\n    common_func.Object_modifyDescriptor(pref_new.features.domains, site0.domain, {writable:false});\r\n    Object.defineProperty(pref_new.triage, 'sampleLoader', {value:0, configurable:true});\r\n    return pref_new;\r\n  }\r\n  var gGEH = {\r\n    get_key_rec: function(e){return this.get_key_recursive(e.target, e.currentTarget);},\r\n    get_key_recursive: function(pn, pn_end, allow_merged){\r\n      var key;\r\n      while (pn && !(key=this.pns_all_keys.get(pn)) && pn!==pn_end) pn = pn.parentNode;\r\n      if (key) if (!allow_merged && typeof(key)!=='string') key = key.lths[0].key; // for merged thread\r\n      return key;\r\n    },\r\n    pns_all_keys: new WeakMap(),\r\n    pns_resize: new WeakMap(), // stores resize funcs\r\n    triage_in: null, // patch for test_mode['127']\r\n    triage_in2: null, // patch for test_mode['127']\r\n    last_viewed: null,\r\n    time_jumped: 0,\r\n\r\n    drag: {\r\n      sx: 0,\r\n      sy: 0,\r\n      effect: null,\r\n      callback: null,\r\n      move: null,\r\n      started: function(e, callback, effect, move){\r\n        this.sx = e.screenX;\r\n        this.sy = e.screenY;\r\n        document.body.addEventListener('dragover',this.dragover,false);\r\n        e.currentTarget.addEventListener('dragend',this.dragend,false);\r\n        this.effect = effect;\r\n        this.callback = callback;\r\n        this.move = move;\r\n        e.stopPropagation()\r\n      },\r\n      dragover: function(e){ // http://www.html5rocks.com/ja/tutorials/dnd/basics/\r\n        e.preventDefault();\r\n        e.dataTransfer.dropEffect = gGEH.drag.effect;\r\n      },\r\n      dragend: function(e){\r\n        document.body.removeEventListener('dragover',gGEH.drag.dragover,false);\r\n        var pn = e.currentTarget;\r\n        pn.removeEventListener('dragend',gGEH.drag.dragend,false);\r\n        var dx = e.screenX - gGEH.drag.sx;\r\n        var dy = e.screenY - gGEH.drag.sy;\r\n        if (gGEH.drag.move) {\r\n          var s = pn.style;\r\n          if (pref.catalog_popup_size_fix && pn.dataset.isPopup==='true') {\r\n            s.width  = pn.offsetWidth + 'px';\r\n            s.height = pn.offsetHeight + 'px';\r\n          }\r\n          if (s.left) s.left  = (parseInt(s.left ,10) + dx) + 'px';\r\n          else        s.right = (parseInt(s.right,10) - dx) + 'px';\r\n          if (s.top)  s.top = (parseInt(s.top   ,10) + dy) + 'px';\r\n          else     s.bottom = (parseInt(s.bottom,10) - dy) + 'px';\r\n        }\r\n        if (gGEH.drag.callback) gGEH.drag.callback(e, dx, dy);\r\n        gGEH.drag.callback = null;\r\n        e.stopPropagation()\r\n      },\r\n    },\r\n  };\r\n\r\n  var pref_func = {\r\n      delete_null: function(dst){\r\n        for (var i in dst) {\r\n          if (dst[i]===null) delete dst[i];\r\n          else if (typeof(dst[i])==='object' && !Array.isArray(dst[i])) pref_func.delete_null(dst[i]);\r\n        }\r\n      },\r\n      pref_overwrite: function(dst,src,strict,loose){\r\n        for (var i in src)\r\n          if (loose || dst[i]!==undefined && (dst[i]!==null || pref && pref.test_mode['117'])) {\r\n            if (strict && typeof(src[i])!==typeof(dst[i])) continue;\r\n            if (typeof(src[i])==='object' && !Array.isArray(src[i])) pref_func.pref_overwrite(dst[i],src[i],strict,loose);\r\n//            else dst[i] = src[i];\r\n            else if (dst[i]!==src[i]) dst[i] = src[i]; // utilize prototype\r\n          }\r\n        return dst;\r\n      },\r\n    parseJSONCs: (function(){\r\n      function err_extra(str, src_str, allow){\r\n        if (str.search(/^[\\s\\n]*$/)===0) return 0;\r\n        if (!allow) console.log('WARNING: '+src_str+': There are extra characters in JSON: '+str);\r\n        return 1;\r\n      }\r\n      return function(str, callback, src_str, allow_prefix, callback_args0, callback_args1){\r\n        var result = {pass:0, fail:0, extra:0, prefix:0};\r\n        var prefix = '';\r\n        var json_str = '';\r\n        var start = 0;\r\n        var level = 0;\r\n        var i=-1;\r\n        while (++i<str.length) {\r\n          if (str[i]==='\"') {while (++i<str.length) if (str[i]==='\"' && str[i-1]!=='\\\\') break;} // referencing back letter may be slow?\r\n          else if (str[i]==='{') {\r\n            if (level++===0) {\r\n              prefix = json_str + str.slice(start,i);\r\n              if (prefix) result.prefix += err_extra(prefix, src_str, allow_prefix);\r\n              json_str = '';\r\n              start = i;\r\n            }\r\n          } else if (str[i]==='}') {\r\n            if (--level<=0) {\r\n              json_str += str.slice(start,i+1);\r\n              if (level===0) {\r\n                var obj = undefined;\r\n                try {\r\n                  obj = JSON.parse(json_str);\r\n                  result.pass++;\r\n                } catch (e) {\r\n                  console.log('ERROR: '+src_str+': in parsing JSON strings: '+json_str);\r\n                  console.log(e);\r\n                  result.fail++;\r\n                }\r\n                if (obj!==undefined) callback(obj, prefix.replace(/^[\\s\\n]*/,''), callback_args0, callback_args1); // call even if obj===null\r\n              } else if (level<0) {result.extra += err_extra(json_str, src_str); level = 0;}\r\n              json_str = '';\r\n              start = i+1;\r\n            }\r\n          } else if (str[i]==='/') {\r\n            if (str[i+1]==='/')      {json_str += str.slice(start,i); i++; while (++i<str.length) if (str[i]==='\\n') break; start = i+1;} // remove comments of //\r\n            else if (str[i+1]==='*') {json_str += str.slice(start,i); i++; while (++i<str.length) if (str[i]==='/' && str[i-1]==='*') break; start = i+1;} // remove comments of /* */\r\n          } // else if (str[i]==='\\\\') i++; // skip an escaped letter\r\n        }\r\n        if (start!==str.length || json_str!=='') result.extra += err_extra(json_str + str.slice(start), src_str);\r\n        return result;\r\n      };\r\n    })(),\r\n    queryOrSet_params_by_JSON: (function(){\r\n      var str_out;\r\n      function query_or_overwrite(obj, prefix, query, enables){\r\n        for (var i in obj)\r\n          if (i==='site2' || i==='pref' || i==='pref_func' || i=='liveTag' || i==='site3')\r\n            if (!enables || enables.indexOf(i)!=-1)\r\n              if (!query) pref_func.pref_overwrite(eval(i),obj[i], undefined, i==='site2');\r\n              else str_out = '{\"' + i + '\":' + pref_func.pref_query(query===true? eval(i) : query, obj[i]) + '}\\n';\r\n      }\r\n      return function(query, str_in, enables, pn_out){\r\n        if (!str_in) return;\r\n        str_out = '';\r\n        var result = this.parseJSONCs(str_in, query_or_overwrite, 'JSON_CLI', false, query, enables);\r\n        if (pn_out) {\r\n          var extra = result.extra + result.prefix;\r\n          var suc = result.fail===0 && extra===0;\r\n          pn_out.style.color = (suc)? '' : 'red';\r\n          pn_out.textContent = (suc? 'OK' : (result.fail>0? 'Failed:'+result.fail : '')+(extra>0? (result.fail>0? ', ':'')+'Extra strings:'+extra : ''))+', Passed:'+result.pass +\r\n                               ' @'+ new Date().toLocaleString();\r\n        }\r\n        if (query && suc) pref.cli.json_str = str_out;\r\n      };\r\n    })(),\r\n    site2_json: function(query, dumb, enables){\r\n      this.queryOrSet_params_by_JSON(query, pref.cli.json_str, enables);\r\n    },\r\n//      site2_json: function(query, dumb, enables){ // working code // obsolete\r\n//        var pn_out = document.getElementsByName('JSON_result')[0];\r\n//        if (pn_out) pn_out.style = {};\r\n//        try { \r\n//          if (pref.cli.json_str!=='') {\r\n//            var fields = pref.cli.json_str.split('\"'); // can't handle \\\"\r\n//            var i=0;\r\n//            while (i<fields.length) {\r\n//              if (fields[i].search(/\\/\\/.*/)!=-1) {\r\n//                while (i+1<fields.length && fields[i].search(/\\/\\/[^\\n]*\\n/)==-1) fields[i] += fields.splice(i+1,1);\r\n//                fields[i] = fields[i].replace(/\\/\\/[^\\n]*(\\n|$)/,'');\r\n//              } else i+=2;\r\n//            }\r\n//            var str = fields.join('\"');\r\n//            var ex_count = 0;\r\n//            var str_out = '';\r\n//            var count = 0;\r\n//            var start = 0;\r\n//            for (var j=0;j<str.length;j++) { // can handle multiple JSON.\r\n//              if (count==0 && str[j]!=='{' && str[j]!==' ' && str[j]!=='\\n') ex_count++;\r\n//              if (str[j]==='{') count++;\r\n//              if (str[j]==='}' && --count==0) {\r\n//                var obj = JSON.parse(str.substr(start,j-start+1));\r\n//                for (var i in obj)\r\n//                  if (i==='site2' || i==='pref' || i==='pref_func' || i=='liveTag' || i==='site3')\r\n//                    if (!enables || enables.indexOf(i)!=-1)\r\n////                  if ((!disable_others && (i==='site2' || i==='pref' || i==='pref_func' || i=='liveTag')) || (!disable_site3 && i==='site3'))\r\n//                      if (!query) pref_func.pref_overwrite(eval(i),obj[i]);\r\n//                      else str_out = '{\"' + i + '\":' + pref_func.pref_query(query===true? eval(i) : query, obj[i]) + '}';\r\n//                start = j+1;\r\n//              }\r\n//            }\r\n//\r\n////            if (str!=='') { // working code.\r\n////            if (str.indexOf('{')!=-1) {\r\n////              var obj = JSON.parse(str);\r\n////              for (var i in obj)\r\n////                if (i==='site2' || i==='pref' || i==='pref_func') pref_func.pref_overwrite(eval(i),obj[i]);\r\n////            }\r\n//////          if (pref.overwrite_site2_json_str!=='') { // working code\r\n////////            var str = pref.overwrite_site2_json_str.replace(/\\/\\/.*/mg,'').replace(/\\n/g,'');\r\n//////            var fields = pref.overwrite_site2_json_str.split('\"');\r\n//////            for (var i=0;i<fields.length;i+=2) {\r\n//////              if (fields[i].search(/\\/\\/.*/)!=-1) {\r\n//////                if (fields[i].search(/\\n/)!=-1 || i+1==fields.length) fields[i] = fields[i].replace(/\\/\\/[^\\n]*(\\n|$)/,'');\r\n//////                else {\r\n////////                  while (i+1<fields.length && fields[i].search(/\\n/)==-1) fields[i++]='';\r\n//////                  while (i+1<fields.length && fields[i].search(/\\n/)==-1) fields.splice(i,1);\r\n//////                  if (i<fields.length) fields[i] = fields[i].replace(/[^\\n]*(\\n|$)/,'');\r\n//////                }\r\n//////              }\r\n//////            }\r\n//////            var str = fields.join('\"');\r\n//////            var count = 0;\r\n//////            var start = 0;\r\n//////            for (var j=0;j<str.length;j++) {\r\n//////              if (str[j]==='{') count++;\r\n//////              if (str[j]==='}') {\r\n//////                count--;\r\n//////                if (count==0) {\r\n//////                  var str_tmp = str.substr(start,j-start+1);\r\n//////                  if (str_tmp!=='') {\r\n//////                    var obj = JSON.parse(str_tmp);\r\n//////                    for (var i in obj)\r\n//////                      if (i==='site2' || i==='pref' || i==='pref_func') pref_func.pref_overwrite(eval(i),obj[i]);\r\n//////                  }\r\n//////                  start = j+1;\r\n//////                }\r\n//////              }\r\n//////            }\r\n////////            if (str!=='') pref_func.pref_overwrite(site2,JSON.parse(str));\r\n////////            if (str!=='') {\r\n////////              var obj = JSON.parse(str);\r\n////////              for (var i in obj)\r\n////////                if (i==='site2' || i==='pref' || i==='pref_func') pref_func.pref_overwrite(eval(i),obj[i]);\r\n////////            }\r\n//            if (pn_out) {\r\n//              pn_out.textContent = ((ex_count!=0)? 'OK, but there are extra useless strings, ' :\r\n//                                    (count!=0)? 'OK, but there are non-closed brackets, ' :\r\n//                                    'OK, ') + new Date().toLocaleString();\r\n//              pn_out.style.color = '';\r\n//              if (str_out!=='') {\r\n//                document.getElementsByName('cli.json_str')[0].value = str_out;\r\n//                pref.cli.json_str = str_out;\r\n//              }\r\n//            }\r\n//          }\r\n//        } catch (e) {\r\n//          if (pn_out) {\r\n//            pn_out.textContent = 'ERROR!!!, ' + new Date().toLocaleString();\r\n//            pn_out.style.color = 'red';\r\n//          }\r\n//          console.log('ERROR in overwtite strings:');\r\n//          console.log(pref.cli.json_str);\r\n//          console.log(e);\r\n//        }\r\n//      },\r\n      sanitize: function(str){\r\n        return  str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\"/g,'&quot;').replace(/'/g,'&#39;');\r\n      },\r\n  };\r\n\r\n  var pref = pref_default(); // pref_default is loaded.\r\n  (function(){\r\n    function pref_overwriteAll(storage){\r\n      var src_str = storage && storage[pref.script_prefix+'.pref'];\r\n      if (!src_str) return;\r\n      var src = JSON.parse(src_str);\r\n      if (src.proto) {pref_func.pref_overwrite(pref.proto, src.proto, true); delete src.proto;}\r\n      pref_func.pref_overwrite(pref, src, true);\r\n    }\r\n    pref_overwriteAll(localStorage);\r\n  //  if (  localStorage &&   localStorage[pref.script_prefix+'.pref']) pref_func.pref_overwrite(pref,JSON.parse(  localStorage[pref.script_prefix+'.pref']),true);\r\n    for (var i in {catalog:null, page:null, float:null, thread:null}) if (!pref[i].save_board_list_sel) pref[i].board_list_sel = 0;\r\n    pref_overwriteAll(sessionStorage);\r\n  //  if (sessionStorage && sessionStorage[pref.script_prefix+'.pref']) pref_func.pref_overwrite(pref,JSON.parse(sessionStorage[pref.script_prefix+'.pref']),true);\r\n    if (window.name) for (var i in {catalog:null, page:null, float:null, thread:null}) pref[i].board_list_sel = 0;\r\n    if (pref.cli.auto) pref_func.site2_json(false,true,['pref']);\r\n    pref.script_prefix = pref_func.sanitize(pref.script_prefix);\r\n    if (site0.isStep) {\r\n  //    for (var i in site.features) site.features[i] = false;\r\n      for (var i in pref.features) if (i!=='domains') pref.features[i] = false;\r\n      for (var i in pref.features.domains) if (i!==site0.domain) pref.features.domains[i] = false;\r\n      brwsr.sw_cache = null;\r\n      pref_func.pref_overwrite(pref,{\r\n        catalog:{auto_update:false},\r\n        thread:{auto_update:false},\r\n        page:{auto_update:false},\r\n        float:{auto_update:false},\r\n        virtualBoard:{scan:false},\r\n        stats:{auto_acquisition_scan:false},\r\n        cloudflare:{auto_reload:false},\r\n      });\r\n    }\r\n  })();\r\n  var pref3 = { // auto sync objects.\r\n    stats: {use:null, estimate_posts:null},\r\n    reload_required: false,\r\n//      order:{ordering_old: 0},\r\n    filter: {\r\n        time_str: function(parent,key,val, parent_src){parent_src['time_obj6'] = Date.parse(val);},\r\n//        time_str: function(parent,key,val){parent[key.replace(/str$/,'obj')] = Date.parse(val);},\r\n//        time_obj6: 0,\r\n//        kwd: {\r\n//          str: function(e){if (this.obj) this.obj[(this.obj[0]===e.target)? 1 : 0].value = pref.filter.kwd.str;},\r\n//          obj: null,\r\n//          clear: function(){ // non-enumerable\r\n////            if (!this.obj) return; // patch for obj_init_hier\r\n//            this.obj[1].value = '';\r\n//            this.obj[1].oninput({target:this.obj[1],currentTarget:this.obj[1]});\r\n//          },\r\n//          init: function(search, pn_filter){ // non-enumerable\r\n//            var search2;\r\n//            if (!this.obj) { // for multientry in meguca.\r\n//              search2 = search.cloneNode(false);\r\n//              search2.name = 'filter.kwd.str';\r\n//              search2.oninput = cataLog.event_func;\r\n//              this.obj = [pn_filter.getElementsByTagName('input')['filter.kwd.str'], search2];\r\n//            } else search2 = this.obj[1];\r\n//            search.setAttribute('style','display:none');\r\n//            search.parentNode.insertBefore(search2,search.nextSibling);\r\n//            this.clear();\r\n//            return search2;\r\n//          },\r\n//        },\r\n    },\r\n    notify:{sound:{file:null}},\r\n    archive: {\r\n      working: false,\r\n      list_str: function(parent,key,val){parent[key.replace(/str$/,'obj2')] = pref_func.str2obj2(val);},\r\n      list_obj2: null,\r\n//      list_obj3: null,\r\n      jsons: null,\r\n      imgs: null,\r\n      dir: null,\r\n//      list_str_set: function(val){\r\n//        pref3.archive.list_str = val;\r\n//        pref_func.str2obj2(pref3.archive,'list_obj2',val);\r\n//      },\r\n//      list_str_get: function(){\r\n//        var lm = liveTag.mems;\r\n//        for (var name in pref3.archive.list_obj2) {\r\n//          var dbt = common_func.name2domainboardthread(name);\r\n//          if (!dbt[2]) continue;\r\n//          if (lm[dbt[0]] && lm[dbt[0]][dbt[1]]) var lth = lm[dbt[0]][dbt[1]][dbt[2]];\r\n//          if (lth && lth.archived && lth.time_checked !== pref3.archive.list_obj2[name].time) pref3.archive.list_str = list_func_1(pref3.archive.list_str, name, lth.time_checked); // BUG. NOT implemented yet.\r\n//        }\r\n//        return pref3.archive.list_str;\r\n//        function list_func_1(str,name,datetime){ // refer 'triage_exe'\r\n//          var key = new RegExp('(^|,)'+name.replace(/\\+/,'\\\\+')+'([\\\\^@!][^,\\n]*)*(,|\\n|$)','mg');\r\n////          var millisec = datetime%1000;\r\n////          var time_str = '@' + new Date(datetime).toLocaleString() + ((datetime%1000==0)? '' : '.'+millisec);\r\n////          str = str.value.replace(key,',') + ',' + name + time_str + '\\n';\r\n//          str = str.value.replace(key,',') + ',' + name + '\\n'; // remove time_str\r\n//          return str.replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,'');\r\n//        }\r\n//      },\r\n    },\r\n    proto: {\r\n      merge_list_str: function(parent,key,val){\r\n        if (!this.merge_list_obj2_old) this.merge_list_obj2_old = this.merge_list_obj2;\r\n        var head = null;\r\n        var all_fullname = true;\r\n        this.merge_list_obj2 = pref_func.str2obj2(val.replace(/\\s*\\+\\s*/g,',+'), 'merge', null, function(field, tgt){\r\n          var add = field[0]==='+'; // .search(/^\\s*\\+\\s*/)!=-1;\r\n          var name = (add? field.slice(1) : field) || 'DEFAULT'; // field.replace(/^\\s*\\+\\s*/,'') || 'DEFAULT';\r\n          var dbt = common_func.name2domainboardthread(name,true);\r\n          if (!dbt[0] || !dbt[1] || !dbt[2]) all_fullname = false;\r\n          if (add && head) head[head.length] = name;\r\n          else head = [name];\r\n          tgt[name] = head;\r\n        });\r\n        if (all_fullname) this.merge_list_obj2[':F'] = true;\r\n//        if (pref.test_mode['177']) { // DOESN\"T WORK\r\n//          this.merge_list_obj2c = {};\r\n//          if (gClg) for (var name in gClg.AllThreads) this.merge_list_obj2c_update(name, true);\r\n//        }\r\n      },\r\n      merge_list_obj2: null,\r\n//      merge_list_obj2c: {}, // cache\r\n      merge_list_obj2_old: null,\r\n      merge_lv_str: function(parent,key,val){\r\n        if (!this.merge_lv_obj2_old) this.merge_lv_obj2_old = this.merge_lv_obj2;\r\n        parent['merge_lv_obj2'] = pref_func.str2obj2(val, 'merge_lv', null, 'val');\r\n      },\r\n      merge_lv_obj2: null,\r\n      merge_lv_obj2_old: null,\r\n//      merge_lv_obj3: null,\r\n    },\r\n    test_mode: {js_file:null},\r\n  };\r\n//  Object.defineProperty(pref3.proto, 'merge_list_obj2c_update', {value:function(name, single){ // DOESN'T WORK\r\n//    var arr = pref_func.merge_obj5a_sc(name, this.merge_list_obj2, null);\r\n//    if (arr) {\r\n//      if (single) this.merge_list_obj2c[name] = arr;\r\n//      else for (var i=0;i<arr.length;i++) this.merge_list_obj2c[arr[i]] = arr;\r\n//    }\r\n//  }, writable:true, configurable:true});\r\n\r\n//  Object.defineProperties(pref3.filter.kwd, {\r\n//    'clear': {value:pref3.filter.kwd.clear, configurable:true, enumerable:false, writable:true},\r\n//    'init':  {value:pref3.filter.kwd.init,  configurable:true, enumerable:false, writable:true}});\r\n\r\n  var gClg; // global catalog\r\n  var pClg; // primary catalog\r\n  var debugWindow;\r\n  var cataLog = {\r\n    threads: null,\r\n//    insert_footer3: null,\r\n    scan_boards: null,\r\n    scan_init: null,\r\n//    catalog_filter_query: null,\r\n    embed_mode: null,\r\n////    catalog_refresh_watch: null,\r\n    format_html: null,\r\n    show_catalog: null,\r\n    get_ref_height: null,\r\n    catalog_obj2: null,\r\n    healthIndicator: null,\r\n    parent: null, // triage_parent\r\n//    show_catalog_scroll_lock: null,\r\n    general_event_handler: null,\r\n    catalog_refresh_end: null,\r\n//    catalog_filter_changed: null,\r\n    image_hover_reentry: null,\r\n    image_hover_remove: null,\r\n    scan_boards_keyword_callback2: null,\r\n    scan_boards_keyword_callback2_default_args: null,\r\n    catalog_filter_query_keyword: null,\r\n    set_watch_time_thread: null,\r\n    event_func: null,\r\n    restore_th_from_IDB: null,\r\n    components: null,\r\n    triage: null,\r\n    GEH: null,\r\n    insert_myself: null,\r\n    DIH: null,\r\n    auto_update: null,\r\n    gClg: null,\r\n    InfoPv: null, \r\n  }\r\n\r\n  pref_func = (function(){\r\n//    var tooltip = document.createElement('div');\r\n//    var tooltip_txt = tooltip.appendChild(document.createTextNode('help'));\r\n////    var tooltip_txt = tooltip.appendChild(document.createElement('textarea'));\r\n//    tooltip.style.position = 'fixed';\r\n//    tooltip.style.background = '#e5f4f9';\r\n//    tooltip.style.color = '#000000';\r\n//    tooltip.style.border = '2px solid blue';\r\n//    tooltip.style.fontWeight = 'normal';\r\n//    var tooltip_on = false;\r\n    return {\r\n      __proto__: pref_func,\r\n      mirror_targets: {\r\n        pn12_0_2: null,\r\n        pn12_0_4: null,\r\n        get pn13_1(){return pref_func.settings.pn13 && pref_func.settings.pn13.childNodes[1] || null;},\r\n        boardlist: null,\r\n      },\r\n      mirror_names: (function(){\r\n        var dic = {\r\n          'virtualBoard.max': null,\r\n          '*.merge': null,\r\n          '*.merge_list': null,\r\n          '*.refresh_src': null,\r\n          '*.refresh_src_th': null,\r\n        };\r\n        return function(name){\r\n          var hier = name.split('.');\r\n          if (hier[0]==='catalog' || hier[0]==='page' || hier[0]==='thread') hier[0] = '*';\r\n          return (hier.join('.') in dic);\r\n        };\r\n      })(),\r\n////////      style_sheet: null,\r\n      apply_prep: function(pn,set,propagate, mirror, make_obj, pref_obj, no_save){\r\n//        if (!pn) return; // reject mirroring to null, // patch for attr_changed.\r\n        var fm = (Array.isArray(pn))? pn\r\n            : (pn instanceof HTMLCollection || pn instanceof NodeList)? Array.prototype.slice.call(pn)\r\n            : (fm = pn.querySelectorAll('input,textarea,select'+ ((set)? '' : ',span[data-class=show_value]')), fm.length>0? Array.prototype.slice.call(fm) : [pn]);\r\n//        var fm; // working code\r\n//        if (Array.isArray(pn) || pn instanceof HTMLCollection || pn instanceof NodeList) fm = pn;\r\n//        else {\r\n//          var query_str = 'input,textarea,select'+ ((set)? '' : ',span[data-class=show_value]');\r\n//          fm = Array.prototype.slice.call(pn.querySelectorAll(query_str));\r\n//          if (fm.length==0) fm = [pn];\r\n//        }\r\n        this.apply_prep_2_all(fm, set, propagate, false, make_obj, pref_obj);\r\n        if (!no_save) this.apply_prep_save(pn,set,propagate, false, make_obj, pref_obj);\r\n        this.apply_prep_mirror(fm[0],set,propagate, mirror, make_obj, pref_obj); // will be removed.\r\n      },\r\n      apply_prep_1n: function(name,set,propagate, mirror, make_obj, pref_obj){\r\n        this.apply_prep_1(pref_func.settings.pnOrDummy(name),set,propagate, mirror, make_obj, pref_obj);\r\n      },\r\n      apply_prep_1: function(pn,set,propagate, mirror, make_obj, pref_obj){\r\n        this.apply_prep_2(pn,set,propagate, false, make_obj, pref_obj);\r\n        this.apply_prep_save(pn,set,propagate, false, make_obj, pref_obj);\r\n        this.apply_prep_mirror(pn,set,propagate, mirror, make_obj, pref_obj);\r\n      },\r\n      apply_prep_mirror: function(pn, set,propagate, mirror, make_obj, pref_obj){\r\n        var name = pn.name || pn.getAttribute('name'); // getAttribute for span, pn.name for pnOrDummy\r\n        if (name && this.mirror_names(name)) mirror = true;\r\n        if (mirror) {\r\n          var fms = [];\r\n          for (var j in this.mirror_targets) if (this.mirror_targets[j])\r\n            fms = fms.concat(Array.prototype.slice.call(this.mirror_targets[j].getElementsByTagName(pn.tagName)).filter(function(v){return v.getAttribute('name')===name;}));\r\n          for (var j=0;j<fms.length;j++) if (pn!==fms[j])\r\n            if (fms[j].tagName!=='INPUT' || fms[j].type!=='radio' || fms[j].value===pn.value) this.apply_prep_2(fms[j], false, false, false, false, pref_obj);\r\n        }\r\n//          for (var j in this.mirror_targets) { // working code\r\n//            if (this.mirror_targets[j]) {\r\n//              fm = fm.concat(Array.prototype.slice.call(this.mirror_targets[j].getElementsByTagName('input')).filter(function(v){return v.name===pn.name;}));\r\n//              var fm_tmp = this.mirror_targets[j].getElementsByTagName('input')[pn.name]; // working code, but this always returns A dom.\r\n//              if (fm_tmp)\r\n//                if (Array.isArray(fm_tmp)) fm = fm.concat(Array.prototype.slice.call(fm_tmp));\r\n//                else fm[fm.length] = fm_tmp;\r\n//            }\r\n//          }\r\n//          for (var j=fm.length-1;j>=0;j--) if (fm[j]===pn) fm.splice(j,1);\r\n//          if (fm.length==0) return;\r\n//          this.apply_prep_2(fm,set,propagate, mirror, make_obj, pref_obj);\r\n      },\r\n      apply_prep_save: function(fms,set,propagate, mirror, make_obj, pref_obj){\r\n        if (pref.test_mode['117']) {if (sessionStorage && set) sessionStorage[pref.script_prefix+'.pref']=JSON.stringify(pref_func.site2_json_ex_remove());}\r\n        else {if (sessionStorage && (set||make_obj)) sessionStorage[pref.script_prefix+'.pref'] = JSON.stringify(pref);}\r\n      },\r\n      apply_prep_2_all: function(fms,set,propagate, mirror, make_obj, pref_obj){\r\n        for (var i=0;i<fms.length;i++) this.apply_prep_2(fms[i], set, propagate, false, make_obj, pref_obj);\r\n      },\r\n      apply_prep_2: function(fm,set,propagate, mirror, make_obj, pref_obj){\r\n          var name = fm.name || fm.getAttribute('name'); // fm.name for pnOrDummy\r\n          if (!name) return; // for <span> //  if (!fm.name) continue;\r\n          if (fm.type=='button') return;\r\n          var target_hier = pref_func.get_tgt(name, fm.type==='file'? pref3 : pref_obj || set!==true && set || null); // set(==this['.']) for each instance\r\n          var parent = target_hier[0];\r\n          var tgt    = target_hier[1];\r\n          if (!parent) return;\r\n          var tagName = fm.tagName;\r\n          if (tagName==='INPUT') {\r\n            if (fm.type==='file') {\r\n              if (!set && parent[tgt] && parent[tgt]!==fm) fm.parentNode.replaceChild(parent[tgt],fm);\r\n              else parent[tgt] = fm; // set also when set===false, keep tracking the DomNode.\r\n            } else if (set) {\r\n//              if (parent[tgt+'_old']!==undefined) parent[tgt+'_old'] = parent[tgt]; // not used\r\n              this.apply_prep_set(parent, tgt, fm, name);\r\n//              if (!mirror && fm.type!=='radio') this.apply_prep(fm,false,false,true); // !mirror for cutting infinite loop. // radio has multiple elements.\r\n            } else this.apply_prep_load(fm, parent, tgt);\r\n            if (set || make_obj)\r\n              if (typeof(parent[tgt])==='string' )\r\n                if (fm.type==='text') {\r\n//                  if (tgt.substr(-3,3)==='str' && parent[tgt.substr(0,tgt.length-3)+'obj4']) pref_func.str2obj4(parent,tgt.substr(0,tgt.length-3)+'obj4',fm.value);\r\n                  if (tgt.substr(-3,3)==='str' && parent[tgt.slice(0,-3)+'obj6']) pref_func.str2obj6(parent,tgt,fm.value,name);\r\n                }\r\n          } else if (tagName==='TEXTAREA') {\r\n            if (set) parent[tgt] = fm.value;\r\n            else fm.value = parent[tgt];\r\n            if (set || make_obj) {\r\n              if (tgt.slice(-3)==='str') {\r\n                var stgt = tgt.slice(0,-3);\r\n                if (parent[stgt+'obj']) pref_func.str2obj(tgt);\r\n                else if (parent[stgt+'obj2']) parent[stgt+'obj2'] = pref_func.str2obj2(fm.value);\r\n//                if (tgt.substr(-3,3)==='str' && parent[tgt.substr(0,tgt.length-3)+'obj4']) pref_func.str2obj4(parent,tgt.substr(0,tgt.length-3)+'obj4',fm.value);\r\n                else if (parent[stgt+'obj5']!==undefined) pref_func.str2obj5(parent,stgt+'obj5',fm.value, tgt==='rm_list_str');\r\n                else if (parent[stgt+'obj6']===null) pref_func.str2obj6(parent,tgt,fm.value,name); // obj6===null always, obj6 is located in pref3, \r\n                else if (parent[stgt+'obj7']!==undefined) {\r\n                  if (parent[stgt+'obj7_old']!==undefined) parent[stgt+'obj7_old'] = parent[stgt+'obj7'];\r\n                  parent[stgt+'obj7'] = pref_func.str2obj7.s2o({}, fm.value, name);\r\n                }\r\n              }\r\n            }\r\n          } else if (tagName==='SELECT') {\r\n            if (set) this.apply_prep_set(parent, tgt, fm, name); // if (parent[tgt]!==undefined) parent[tgt] = fm.selectedIndex;,\r\n            else {\r\n//              var tgt_obj = (tgt.search(/sel/)!=-1)? tgt.replace(/sel/,'obj') : null;\r\n//              if (parent[tgt_obj]) {\r\n//                fm.length=0;\r\n//                for (var j=0;j<parent[tgt_obj].length;j++) {\r\n//                  fm.length++;\r\n//                  fm.options[fm.length-1].text = parent[tgt_obj][j][0]['key'];\r\n//                }\r\n//              }\r\n              if (parent[tgt+'_gfunc_pre']) parent[tgt+'_gfunc_pre'](parent,tgt,parent[tgt],name,fm);\r\n              this.apply_prep_load(fm, parent, tgt);\r\n//              if (parent[tgt]>=fm.length) parent[tgt] = 0;\r\n//              fm.selectedIndex = parent[tgt];\r\n            }\r\n          } else if (tagName==='SPAN') {\r\n            if (!set && fm.getAttribute('data-class')==='show_value') {\r\n              var val = parent[tgt];\r\n              var func_str = this.apply_prep_2_str[tgt+':'+parent[tgt]];\r\n              if (func_str) val = (typeof(func_str)==='string')? func_str : func_str(parent);\r\n//              if (fm.getAttribute('name').substr(-7,7)==='t2h_sel' && ['L','M','N'].indexOf(parent[tgt])!=-1) val = parent['t2h_'+parent[tgt]];\r\n              fm.textContent = val.toString().replace(/^./,function(v){return v.toUpperCase();});\r\n            }\r\n          }\r\n          if (propagate) {\r\n            if (fm.oninput)  fm.oninput.call(fm, {currentTarget:fm, target:fm}, true);\r\n            if (fm.onchange) fm.onchange.call(fm, {currentTarget:fm, target:fm}, true);\r\n          }\r\n      },\r\n      apply_prep_set: function(parent, tgt, fm, name){ // don't set if parent[tgt]===undefined, ex.time_quick_sel\r\n        var type = typeof(parent[tgt]);\r\n        if (type==='number') {\r\n          var val;\r\n          parent[tgt] = (fm.tagName==='SELECT')? fm.selectedIndex\r\n                      : (val = (name && name.substr(-2)==='_f')? parseFloat(fm.value) : parseInt(fm.value,10), isNaN(val)? 0 : val)\r\n        } else if (type==='boolean') parent[tgt] = fm.checked;\r\n        else if (type==='string') if (fm.type==='text'|| fm.tagName==='SELECT' || fm.checked) parent[tgt] = fm.value;\r\n      },\r\n      apply_prep_load: function(fm, parent, tgt){\r\n        var val = parent[tgt];\r\n        if (fm.tagName==='SELECT') {\r\n          fm.selectedIndex = (typeof(val)==='number')? (val>=fm.length? parent[tgt]=0:0, parent[tgt])\r\n            : Array.prototype.slice.call(fm.options).map(function(v){return v.value;}).indexOf(parent[tgt]);\r\n//          } else fm.selectedOptions = parent[tgt]; // selectedOptions is read only\r\n        } else { // INPUT\r\n          var type = typeof(val);\r\n          if      (type=='number' ) fm.value = val;\r\n          else if (type=='boolean') fm.checked = val;\r\n          else if (type=='string' ) if (fm.type==='text') fm.value = val;\r\n                                    else if (val === fm.value) fm.checked = true;\r\n        }\r\n      },\r\n      apply_prep_2_str: {\r\n        't2h_sel:L': function(parent){return parent['t2h_L'];},\r\n        't2h_sel:M': function(parent){return parent['t2h_M'];},\r\n        't2h_sel:N': function(parent){return parent['t2h_N'];},\r\n        't2h_sel:N_unread': function(parent){return parent['t2h_N']+'+unread';},\r\n        't2h_sel:unread': 'All unread',\r\n        'posts_search_op:opaque': function(parent){return 'opaque '+parent['posts_search_op_opacity']+'%';},\r\n//        'popup2:sr': 'SearchResult',\r\n//        'popup2:srpv': 'SearchResult/Preview',\r\n//        'popup2:pv': 'Preview',\r\n//        'popup2:chart': 'PostRateChart',\r\n//        'popup2:dp': 'DeletedPosts',\r\n      },\r\n//      make_pref_obj : function(name){ // copy of part of apply_prep.\r\n//        var target_hier = pref_func.get_tgt(name);\r\n//        var parent = target_hier[0];\r\n//        var tgt    = target_hier[1];\r\n//        if (tgt.search(/str$/)!=-1 && parent[tgt.replace(/str$/,'obj')]) pref_func.str2obj(tgt);\r\n//        if (tgt.search(/str$/)!=-1 && parent[tgt.replace(/str$/,'obj2')]) pref_func.str2obj2(parent,tgt.replace(/str$/,'obj2'),parent[tgt]);\r\n//      },\r\n      catalog_board_list_str_or: '',\r\n      catalog_board_list_str_bt: '',\r\n      catalog_board_list_str_bt_same: '',\r\n      add_onchange: function(pn,func_obj, func_obj2){ // obj2 for oninput\r\n        return this.set_event_target(pn, this.add_onchange_entry_func.bind(func_obj), func_obj2, func_obj);\r\n      },\r\n      add_onchange_entry_func: function(e, propagated){ // always used after binded.\r\n        var pn_name = e.currentTarget.getAttribute('name'); // for <span>\r\n        if (!propagated && ['INPUT','TEXTAREA','SELECT'].indexOf(e.currentTarget.tagName)!=-1) pref_func.apply_prep_1(e.currentTarget, this['.'] && this['.'].pref || true); // this['.'] for each instance\r\n        if (this[pn_name]) this[pn_name].call(this,e); // e.currentTarget,e); // exact match\r\n        else if (this[pn_name+' w/']) this[pn_name+' w/'].call(this,e,pn_name);\r\n//        else if (this[pn_name+'/t']) this[pn_name+'/t'].call(this,e); // all should be this.\r\n        else {\r\n          var idx = pn_name.indexOf('.');\r\n          if (idx!=-1) {\r\n            var name = pn_name.substr(idx); // *.XXX\r\n            if (this['*'+name]) this['*'+name].call(this,e); // e.currentTarget,e);\r\n            else if (this['*w/'+name]) this['*w/'+name].call(this,e,pn_name); // e.currentTarget,e,pn_name);\r\n            else {\r\n              var idx_l = pn_name.lastIndexOf('.');\r\n              if (idx_l!=-1) {\r\n                var name = pn_name.substr(0,idx_l+1)+'*'; // XXX.YYY.*\r\n                if (this[name]) this[name].call(this,e); // e.currentTarget,e);\r\n                else if (this[name+'w/']) this[name+'w/'].call(this,e,pn_name); // e.currentTarget,e,pn_name); // XXX.YYY.* with source name\r\n                else {\r\n                  var arr = pn_name.split('.');\r\n                  var name02 = arr.slice(0,-2).join('.')+'.*.'+arr.slice(-1)[0]; // XXX.*.ZZZ\r\n                  if (this[name02]) this[name02].call(this,e);\r\n                  else {\r\n                    var name0 = pn_name.split('.').slice(0,-2).join('.')+'.*.*w/'; // XXX.*.*\r\n                    if (this[name0]) this[name0].call(this,e,pn_name);\r\n//                else {\r\n//                  var name_middle = pn_name.split('.').slice(1,-1).join('.');\r\n//                  var func;\r\n//                  if (name_middle && func = this['*.'+name_middle+'.*']) func.call(this,e);\r\n//                  else if (name_middle && func = this['*.'+name_middle+'.*w/']) func.call(this,e,pn_name); // *.YYY.*\r\n                    else if (idx!=-1) { // hierarchical approach\r\n                      var name_0 = pn_name.substr(0,idx); // XXX.YYY\r\n                      var name_1 = pn_name.substr(idx+1);\r\n                      if (this[name_0] && this[name_0][name_1]) this[name_0][name_1](e); // NO EMULATION of 'this' value. should consolidate to func.call(this,e).\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n//        var pn = e.target.parentNode; // 'Filter' doesn't have stopper.\r\n//        while (pn && pn!==site.script_body) {\r\n//          if (pn.getAttribute('name')==='SUB') this['SUB'].call(pn,{currentTarget:pn});\r\n//          pn = pn.parentNode;\r\n//        }\r\n      },\r\n      add_onchange_format: function(func_obj){\r\n        var keys = Object.keys(func_obj);\r\n        for (var i=0;i<keys.length;i++) if (typeof(func_obj[keys[i]])==='string') func_obj[keys[i]] = func_obj[func_obj[keys[i]]];\r\n        return func_obj;\r\n      },\r\n////      add_onchange: function(pn,func_obj, func_obj2){ // obj2 for oninput // working code.\r\n////        var call_tgt = func_obj;\r\n////        if (typeof(func_obj)!=='function') { // object\r\n////          for (var i in func_obj) if (typeof(func_obj[i])==='string') func_obj[i] = func_obj[func_obj[i]];\r\n////          if (func_obj2) for (var i in func_obj2) if (typeof(func_obj2[i])==='string') func_obj2[i] = func_obj2[func_obj2[i]];\r\n//////          func_obj.func_default = function(){ // cause EventListener leak.\r\n//////            pref_func.apply_prep(this,true);\r\n//////            if (func_obj[this.name]) func_obj[this.name](this);\r\n//////          };\r\n//////          call_tgt = func_obj.func_default;\r\n////          call_tgt = func_obj.entry_func;\r\n////        }\r\n////        this.set_event_target(pn,call_tgt, func_obj2);\r\n////      },\r\n      set_event_target: (function(){\r\n        var inst_while_input = null;\r\n        function prep_beforeunload(e){\r\n          inst_while_input = (e)? e.target : null;\r\n        }\r\n        function set_val_beforeunload(){\r\n          if (inst_while_input) pref_func.apply_prep_1(inst_while_input,true);\r\n        }\r\n        window.addEventListener('beforeunload', set_val_beforeunload, false);\r\n//        function eventfunc_factory(tgt, check_func){ // dynamic approach, but this may conflict with native.\r\n//          return function(e){\r\n//            var et = e.target;\r\n//            do {\r\n//              var name = et.getAttribute('name');\r\n//              if (name && check_func(et, name)) tgt.call(this, {target:et, currentTarget:et, __proto__:e}); // emulation of static approach\r\n//              et = et.parentNode;\r\n//            } while (et!==e.currentTarget);\r\n//          };\r\n//        }\r\n        return function(pn,tgt, func_obj2, func_obj){\r\n          var tgt_wrapped = function(e, propagated){inst_while_input=null;tgt.call(this,e, propagated);};\r\n//          pn.oninput  = eventfunc_factory(tgt_wrapped, function(et, name){\r\n//            var r = (et.tagName==='INPUT' || et.tagName==='TEXTAREA' || et.tagName==='SELECT') &&  (func_obj2 && func_obj2[name]);\r\n//            if (!r && ((et.tagName==='INPUT' && et.type==='text') || et.tagName==='TEXTAREA')) inst_while_input = et; // prep_beforeunload\r\n//            return r;});\r\n//          pn.onchange = eventfunc_factory(tgt_wrapped, function(et, name){\r\n//            inst_while_input = null;\r\n//            return  (et.tagName==='INPUT' || et.tagName==='TEXTAREA' || et.tagName==='SELECT') && !(func_obj2 && func_obj2[name]) ||\r\n//              (et.tagName==='SPAN' || et.tagName==='DIV') && name==='SUB';});\r\n//          pn.onclick  = eventfunc_factory(tgt, function(et, name){\r\n//            return et.tagName==='BUTTON' || et.tagName==='A' || (et.tagName==='SPAN' || et.tagName==='DIV') && name!=='SUB';});\r\n          var fm = pn.getElementsByTagName('*'); // working code, static approach\r\n          if (fm.length==0) fm = [pn];\r\n          for (var i=0;i<fm.length;i++) {\r\n            var name = fm[i].getAttribute('name');\r\n            if (!name) continue; // for span // if (!fm[i].name) continue;\r\n            var tagName = fm[i].tagName;\r\n            if (tagName==='INPUT' || tagName==='TEXTAREA' || tagName==='SELECT') {\r\n              if (func_obj2 && func_obj2[fm[i].name]) fm[i].oninput = tgt_wrapped;\r\n//              if (func_obj2 && (func_obj2[fm[i].name] || func_obj2[fm[i].name+'/t'])) fm[i].oninput = tgt_wrapped;\r\n              else {\r\n                fm[i].onchange = tgt_wrapped;\r\n                if ((tagName==='INPUT' && fm[i].type==='text') || tagName==='TEXTAREA') fm[i].oninput = prep_beforeunload;\r\n              }\r\n            } else if (tagName==='BUTTON') fm[i].onclick = tgt_wrapped; // OK.\r\n            else if (tagName==='A') {\r\n              /*if (func_obj[name])*/ fm[i].onclick = tgt;\r\n//              if (name==='SHOW' || name==='SHOWALL' || name==='HIDEALL' || name==='SHOW2' || name==='SHOW3' || name==='HIDE3' || name==='SHOW5' || name==='HIDE5') fm[i].onclick = tgt;\r\n            } else if (tagName==='SPAN' || tagName==='DIV') {\r\n//              if (name==='NEXT') fm[i].onclick = tgt;\r\n              if (name==='SUB') fm[i].onchange = tgt; // called twice times when INPUT in SUB is changed.\r\n              if (name==='SHOW2_I' || name==='SHOW4' || name==='HIDE4') fm[i].onclick = tgt;\r\n            }\r\n          }\r\n          return tgt_wrapped;\r\n        };\r\n      })(),\r\n//      remove_onchange: function(pn){this.set_event_target(pn,null);},\r\n//      invoke_onchange: function(pn){\r\n//        var evt = document.createEvent('UIEvents');\r\n//        evt.initUIEvent('change', false, true, window, 1);\r\n//        pn.dispatchEvent(evt);\r\n//      },\r\n      str2obj: function(key) {\r\n//        var tgt = key+'_obj';\r\n        var tgt = key.replace(/str$/,'obj');\r\n        pref[tgt] = [];\r\n        tgt = pref[tgt];\r\n        var bg_str = (site.whereami==='boards')? site2[site.nickname].boards_sel_from_tags() :\r\n                     site.board + ((site.whereami==='thread')? site.no : '');\r\n        if (bg_str==='//') bg_str = '/ROOT_DUMMY/';\r\n        bg_str += ',' + bg_str + '\\n' + pref[key] + '\\n';\r\n        if (pref.catalog.board.recommendation) {\r\n//          var blotter = document.getElementsByClassName('blotter')[0];\r\n//          if (blotter) {\r\n//            or_str = document.getElementsByClassName('blotter')[0][brwsr.innerText];\r\n//            var kwd = 'Recommendation: ';\r\n//            var idx = or_str.indexOf(kwd);\r\n//            if (idx!=-1) {\r\n//              var or = or_str.substr(idx+kwd.length);\r\n//              pref_func.catalog_board_list_str_or = or;\r\n//              lines.push(or);\r\n//            }\r\n//          }\r\n          var or = site2[site.nickname].get_owners_recommendation();\r\n          pref_func.catalog_board_list_str_or = or;\r\n//          lines.push(or);\r\n          bg_str = bg_str + or + '\\n';\r\n        }\r\n//        if (pref.catalog.board.board_tags && pref_func.catalog_board_list_str_bt!=='') lines.push(pref_func.catalog_board_list_str_bt);\r\n//        if (pref.catalog.board.board_tags_same && pref_func.catalog_board_list_str_bt_same!=='') lines.push(pref_func.catalog_board_list_str_bt_same);\r\n        if (pref.catalog.board.board_tags && pref_func.catalog_board_list_str_bt!=='') bg_str = bg_str + pref_func.catalog_board_list_str_bt + '\\n';\r\n        if (pref.catalog.board.board_tags_same && pref_func.catalog_board_list_str_bt_same!=='') bg_str = bg_str + pref_func.catalog_board_list_str_bt_same + '\\n';\r\n        var lines = bg_str.split('\\n');\r\n        var bn = -1;\r\n        for (var i=0;i<lines.length;i++) {\r\n          var fields = lines[i].replace(/\\s*\\/\\/.*/,'').replace(/, +/g,',').split(',');\r\n          var j=0;\r\n          while (j<fields.length && fields[j]=='') j++;\r\n          if (fields[j]) {\r\n            tgt[++bn] = [{key:fields[j++]}];\r\n            var idx=0;\r\n            while (j<fields.length) {\r\n              if (fields[j]!==''){\r\n                if (fields[j].search(/^\\s*!?#/)!==-1) {\r\n                  if (!tgt[bn][0].tags) tgt[bn][0].tags=[];\r\n                  tgt[bn][0].tags[tgt[bn][0].tags.length] = fields[j].replace(/\\s/g,'');\r\n                } else if (fields[j].search(/^\\s*!/)!==-1) {\r\n                  if (!tgt[bn][0].cmds) tgt[bn][0].cmds=[];\r\n                  tgt[bn][0].cmds[tgt[bn][0].cmds.length] = fields[j].replace(/\\s/g,'').substr(1);\r\n                } else {\r\n                  tgt[bn][++idx] = {};\r\n                  tgt[bn][idx].key = fields[j].replace(/[\\*\\^!].*/,'').replace(/\\s/g,'')\r\n                  if (fields[j].search(/\\*/)!=-1) tgt[bn][idx].max_page  = parseInt(fields[j].replace(/[^\\*\\^!]*[\\*\\^!]/,'').replace(/[\\^!].*/,''),10);\r\n                  if (fields[j].search(/\\^/)!=-1) tgt[bn][idx]['style' ] = fields[j].replace(/[^\\*\\^!]*[\\*\\^!]/,'').replace(/[\\*!].*/,'');\r\n//                  if (fields[j].search(/\\!/)!=-1) tgt[bn][idx]['search'] = fields[j].replace(/[^\\*\\^!]*[\\*\\^!]/,'').replace(/[\\*\\^].*/,'');\r\n//                  tgt[bn][idx].key = fields[j].replace(/[\\*%!].*/,''); // working code..., but '%' is used in URL...\r\n//                  if (fields[j].search(/\\*/)!=-1) tgt[bn][idx]['num'   ] = fields[j].replace(/[^\\*%!]*[\\*%!]/,'').replace(/[%!].*/,'');\r\n//                  if (fields[j].search(/\\%/)!=-1) tgt[bn][idx]['style' ] = fields[j].replace(/[^\\*%!]*[\\*%!]/,'').replace(/[\\*!].*/,'');\r\n//                  if (fields[j].search(/\\!/)!=-1) tgt[bn][idx]['search'] = fields[j].replace(/[^\\*%!]*[\\*%!]/,'').replace(/[\\*%].*/,'');\r\n                }\r\n              }\r\n              j++;\r\n            }\r\n          }\r\n        }\r\n        if (pref.catalog.board.all_boards) tgt[tgt.length] = [{key:'ALL'},{key:site.nickname}];\r\n        for (var i=0;i<tgt.length;i++) {\r\n          for (var j=1;j<tgt[i].length;j++) {\r\n            var dm = tgt[i][j].key.replace(/\\/.*/,'');\r\n            if (dm=='') dm=site.nickname;\r\n            var bd = '/'+ tgt[i][j].key.replace(/[^\\/]*\\//,'').replace(/\\/.*/,'') +'/';\r\n            if (j==1) {\r\n              tgt[i][0]['domain']= dm;\r\n              tgt[i][0]['board' ]= bd;\r\n            } else {\r\n              if (tgt[i][0]['domain']!=dm) tgt[i][0]['domain']=null;\r\n              if (tgt[i][0]['board' ]!=bd) tgt[i][0]['board' ]=null;\r\n            }\r\n          }\r\n        }\r\n        for (var i=0;i<tgt.length;i++)\r\n          for (var j=1;j<tgt[i].length;j++) {\r\n            var dbt = common_func.name2domainboardthread(tgt[i][j].key,false);\r\n            tgt[i][j].key = common_func.name2domainboardthread(tgt[i][j].key,true).join(''); // patch\r\n            if (dbt[1]==='' && dbt[2]==='') {\r\n              if (!tgt[i][0].domains_for_all_boards) tgt[i][0].domains_for_all_boards = [];\r\n              tgt[i][0].domains_for_all_boards[tgt[i][0].domains_for_all_boards.length] = dbt[0];\r\n              tgt[i].splice(j--,1);\r\n            }\r\n          }\r\n      },\r\n      get_tgt: function(name, parent, exact){\r\n        if (!parent) parent = (name[0]==='#')? liveTag.tags : pref; // this might be redundant anymore, because tags are drawn on demand.\r\n        var tgts = name.split('.');\r\n        for (var j=0;j<tgts.length;j++)\r\n          if (!exact || parent[tgts[j]]!==undefined) {\r\n            if (j!=tgts.length-1) parent = parent[tgts[j]];\r\n            else return [parent,tgts[j]];\r\n          } else return null;\r\n      },\r\n      str2obj2: (function(){\r\n        function func_org(str, tgt){\r\n          var name = str.replace(/[@;].*/,'').replace(/^\\s*/,'');\r\n          var fields = str.slice(name.length).replace(/@/g,';@').split(';').filter(function(v){return v;}); // better than match(/(^.|[@;])[^@;]*)/g);\r\n//          var idx = str.search(/@;/);\r\n//          var name = idx>0? str.slice(0,idx) : 'DEFAULT';\r\n//          var fields = str.substring(idx).replace(/@/g,';@').replace(/!/g,';').split(';').filter(function(v){return v;}); // better than match(/(^.|[@;])[^@;]*)/g);\r\n          if (!name) name = 'DEFAULT';\r\n          if (!tgt[name]) tgt[name] = {};\r\n          for (var i=0;i<fields.length;i++) set_val(tgt[name], fields[i]);\r\n        }\r\n        function set_val(obj, val){\r\n          if (val[0]==='@') obj.time = (val[1]==0)? 0 : brwsr.Date_parse(val.slice(1)); // Date.parse(0) returns 2000/1/1 0:00. '==0' is intended, 0 is string in this case.\r\n          else {\r\n            var tgt = val.search(/^[A-Z]/)===0? 'cmd' : 'style';\r\n            var fs = val.split(':');\r\n            if (!obj[tgt]) obj[tgt] = {};\r\n            if (tgt==='cmd' && (fs[1]==='null' || fs[1]==='')) delete obj[tgt][fs[0]];\r\n            else obj[tgt][fs[0]] = (tgt!=='cmd')? fs[1] : (fs.length===1 || fs[1]==='true')? true : (fs[1]==='false')? false : fs[1];\r\n          }\r\n        }\r\n//        function set_vals(tgt,key,vals_in,completion){ // working code.\r\n//          if (vals_in) {\r\n//            if (!tgt[key]) tgt[key] = {};\r\n//            var vals = vals_in[0].substr(1).split(';');\r\n//            for (var j=0;j<vals.length;j++) {\r\n//              var val = vals[j].split(':');\r\n//              if (completion) {\r\n//                if (val.length===1 || val[1]==='true') val[1] = true;\r\n//                else if (val[1]==='false') val[1] = false;\r\n//              }\r\n//              tgt[key][val[0]] = val[1];\r\n//            }\r\n//          }\r\n//        }\r\n//        function func_org(field, tgt){\r\n//          var name = field.replace(/[@\\^!].*/,'') || 'DEFAULT';\r\n//          if (tgt[name]===undefined) tgt[name] = {};\r\n////          var time = field.match(/@[^\\^!]*/);\r\n////          if (time) tgt[name].time = Date.parse(time[0].replace(/@/,''));\r\n//          var time = field.match(/@([^\\^!]*)/);\r\n//          if (time) tgt[name].time = (time[1]==0)? 0 : brwsr.Date_parse(time[1]); // Date.parse(0) returns 2000/1/1 0:00. '==0' is intended, 0 is string in this case.\r\n//          set_vals(tgt[name],'style',field.match(/\\^[^@\\^!]*/g));\r\n//          set_vals(tgt[name],'cmd'  ,field.match(/![^@\\^!]*/g),true);\r\n//        }\r\n        function func_rev(field, tgt){\r\n          if (field[0]==='+') field = field.slice(1);\r\n          var name = field.replace(/[@;:].*/,'') || 'DEFAULT';\r\n          var idx = name.indexOf('/');\r\n          var idxl = name.lastIndexOf('/');\r\n          if (idx>0 && idx!==idxl && idxl!=name.length-1) { // domain/board/thread\r\n            var db = name.slice(0,idxl+1);\r\n            if (!tgt[db]) tgt[db] = {};\r\n            tgt[db][name.slice(idxl+1)] = null;\r\n          }\r\n        }\r\n        function func_for_val(field, tgt){\r\n          field = field.replace(/\\s*/g,'');\r\n          var idx = field.indexOf(':');\r\n          var name = (idx>=1)? field.substr(0,idx) : 'DEFAULT';\r\n          tgt[name] = field.substr(idx+1);\r\n        }\r\n        var obj2proto = {\r\n          _revise: function(name, str){\r\n            if (str) str = str.replace(/\\s*\\/\\/.*/mg,'').replace(/\\n/g,',').replace(/\\s*$/,'').split(/\\s*,\\s*/)[0]; // for safety\r\n            var exist = (name in this);\r\n            if (exist) {\r\n              if (!str) obj3_rm(this[':REV'], name);\r\n              delete this[name]; // force remake for not accumulating\r\n            }\r\n            if (!str) return;\r\n            func_org(str,this);\r\n            if (!exist) func_rev(str,this[':REV']);\r\n          },\r\n//          _add: function(str){\r\n//            str = str.replace(/\\s*\\/\\/.*/mg,'').replace(/\\n/g,',').replace(/\\s*$/,'').split(/\\s*,\\s*/)[0]; // for safety\r\n//            if (!str) return;\r\n//            delete this[name]; // force remake for unsticky\r\n//            func_org(str,this);\r\n//            func_rev(str,this[':REV']);\r\n//          },\r\n//          _rm: function(str){\r\n//            var name = str.replace(/[@;:].*/,'');\r\n//            var idx = name.indexOf('/');\r\n//            var idxl = name.lastIndexOf('/');\r\n//            if (idx>0 && idx!==idxl && idxl!=name.length-1) { // domain/board/thread\r\n//              delete this[name];\r\n//              var db = name.slice(0,idxl+1);\r\n//              delete this[':REV'][db][name.slice(idxl+1)];\r\n//            }\r\n//          },\r\n        };\r\n        var obj2proto_merge = {\r\n          _revise: function(dst, src, str, no_insert, old){ // dst and src must be fullname\r\n            var now = this;\r\n            var darr = now[dst];\r\n            var sarr = now[src];\r\nif (!pref.test_mode['192']) {\r\n            if (!old) old = {__proto__:now}; // emulation of _old, WILL BE REMOVED\r\n            if (darr) {\r\n              var dold = darr.slice();\r\n              for (var i=0;i<darr.length;i++) if (!old.hasOwnProperty(darr[i])) old[darr[i]] = dold;\r\n            } else if (dst && !old.hasOwnProperty(dst)) old[dst] = undefined;\r\n            if (sarr) {\r\n              var sold = sarr.slice();\r\n              for (var i=0;i<sarr.length;i++) if (!old.hasOwnProperty(sarr[i])) old[sarr[i]] = sold;\r\n            } else if (!old.hasOwnProperty(src)) old[src] = undefined;\r\n}\r\n            var tgts;\r\n            var sarr_old = sarr && sarr.slice();\r\n            if (sarr && (!dst || darr || no_insert)) sarr.splice(sarr.indexOf(src),1);\r\n            if (dst) {\r\n              if (darr) {darr.splice(darr.indexOf(dst)+1,0,src); now[src] = darr; tgts = sarr_old || [src];} // members of sarr_old may bump down\r\n              else if (sarr && !no_insert) {sarr.splice(sarr.indexOf(src),0,dst); now[dst] = sarr; tgts = darr || [dst];} // members of darr may bump down\r\n              else {now[dst] = now[src] = tgts = [dst,src];}\r\n            } else {delete now[src]; tgts = sarr_old;} // member of sarr_old may bump down\r\n            var obj3 = now[':REV'];\r\n            if (dst && !darr) func_rev(dst,obj3);\r\n            if (dst && !sarr) func_rev(src,obj3);\r\n            else if (!dst && sarr) obj3_rm(obj3,src);\r\n            str = add_to_list_2(dst, src, str, no_insert);\r\n            if (sarr && sarr.length==1) if (obj3_rm(obj3,sarr[0])) { // check if fullname and delete\r\n              delete now[sarr[0]];\r\n              str = add_to_list_2(null, sarr[0], str);\r\n            }\r\n            return {str:str, tgts:tgts, old:old};\r\n          },\r\n          _rm: function(name,obj3_db,no,str){\r\n            var tgt = this[name];\r\n            if (tgt.length>1) {\r\n              tgt.splice(tgt.indexOf(name),1);\r\n              if (tgt.length==1) if (obj3_rm(this[':REV'],tgt[0])) { // checking if fullname, and tgt[0] may be in other boards\r\n                delete this[tgt[0]];\r\n                str = site2['DEFAULT'].update_posts_merge_bases.add_to_list_2(null, tgt[0], str); // temporarily, CAUTION, regular expression must be reconsider\r\n              }\r\n            }\r\n            return rm_merge.call(this,name,obj3_db,no,str);\r\n          }\r\n        };\r\n        function rm_merge(name,obj3_db,no,str){\r\n          delete this[name];\r\n          delete obj3_db[no];\r\n          var key = name.replace(/\\+/,'\\\\+')+'([\\\\^@;:][^,\\n]*)*'; // see 'triage_exe'\r\n          return str.replace(new RegExp('(^|,)'+key+'([,\\n]+\\\\s*\\\\+*|$|\\\\+)','mg'),'$1').replace(new RegExp('\\\\+\\\\s*'+key+'(,|\\n|$|\\\\s*\\\\+)','mg'),'$2');\r\n        }\r\n        var obj2proto_merge_lv = {\r\n          _revise: function(name, lv, rm, str){ // name must be fullname\r\n            var idxl = name.lastIndexOf('/');\r\n            var db = name.slice(0,idxl+1);\r\n            var obj3_db = this[':REV'][db];\r\n            var no = name.slice(idxl+1);\r\n            if (rm) {\r\n              delete this[name];\r\n              delete obj3_db[no];\r\n            } else {\r\n              this[name] = lv;\r\n              if (!obj3_db) obj3_db = this[':REV'][db] = {};\r\n              obj3_db[no] = null;\r\n            }\r\n            var rx = new RegExp('(^|,)\\\\s*'+name+'(:[^,\\n]*)*(,|\\n|$)','mg');\r\n            return pref_func.fmt4str2(str.replace(rx,',')+'\\n'+(rm? '' : name+':'+lv+'\\n'));\r\n          },\r\n          _rm: rm_merge\r\n        };\r\n        function obj3_rm(obj3, name){\r\n          var idx = name.indexOf('/');\r\n          var idxl = name.lastIndexOf('/');\r\n          if (idx>0 && idx!==idxl && idxl!=name.length-1) { // domain/board/thread\r\n            var db = name.slice(0,idxl+1);\r\n            if (obj3[db]) delete obj3[db][name.slice(idxl+1)];\r\n            else console.log('Error: an inconsistency was found in str2obj2.obj3_rm: '+name);\r\n            return true;\r\n          }\r\n        }\r\n        function add_to_list_2(tgt, name, str, no_insert){\r\n          var dst = tgt && existIn(str,tgt);\r\n          var src = existIn(str,name);\r\n          if (src && (!tgt || dst || no_insert)) {\r\n            str = src[1]==='+'? str.slice(0,src.index)              +str.slice(src.index+src[0].length) // eliminates '+' preferentially\r\n                              : str.slice(0,src.index+src[1].length)+str.slice(src.index+src[0].length+src[3].length); // remove\r\n            var len_erased = src[0].length + (src[1]==='+'? 0 : -src[1].length+src[3].length);\r\n          }\r\n          if (tgt) { // if (dst || tgt===null) {\r\n            if (dst) { // if (tgt!==null) {\r\n              var idx = (src && dst.index>src.index? dst.index - len_erased : dst.index) + dst[0].length;\r\n              str = str.slice(0,idx)+'+'+name+str.slice(idx); // add\r\n            } else if (src && !no_insert) str = str.slice(0,src.index+src[1].length)+tgt+'+'+str.slice(src.index+src[1].length); // insert\r\n            else str += '\\n'+tgt+'+'+name+'\\n' // add to last\r\n          }\r\n          return pref_func.fmt4str2(str);\r\n        }\r\n        function existIn(str, key_in){\r\n          var key = key_in.replace(/\\+/,'\\\\+');\r\n          return new RegExp('(^|,|\\\\+)\\\\s*'+key+'(\\s*)(?=(,|\\n|$|\\\\+))','mg').exec(str);\r\n//          return new RegExp('(^|,|\\\\+)\\\\s*'+key+'([^,\\n+]*)(?=(,|\\n|$|\\\\+))','mg').exec(str); // (?<=) requires chrome 62 // BUG, key isn't terminated\r\n        }\r\n        return function(str, src, obj2_only, func){\r\n          var tgt = src==='merge'? {__proto__:obj2proto_merge} : src==='merge_lv'? {__proto__:obj2proto_merge_lv} : src || {__proto__:obj2proto};\r\n          var fields = str.replace(/\\s*\\/\\/.*/mg,'').replace(/\\n/g,',').replace(/\\s*$/,'').split(/\\s*,\\s*/);\r\n          var f2 = (func==='val')? func_for_val : func || func_org;\r\n          for (var i=0;i<fields.length;i++) if (fields[i]) f2(fields[i],tgt);\r\n//          if (!src) parent[key] = tgt;\r\n          if (obj2_only) return tgt;\r\n          var obj3 = {};\r\n//          if (!pref.test_mode['134']) {\r\n          for (var i=0;i<fields.length;i++) if (fields[i]) func_rev(fields[i],obj3);\r\n          tgt[':REV'] = obj3;\r\n//          } else {\r\n//            for (var i in tgt) obj3[i.replace(/\\/[0-9]+$/,'/')] = true;\r\n//            parent[key.slice(0,-1)+'3'] = obj3;\r\n//          }\r\n//          var key3 = key.replace(/_obj2/,'_obj3');\r\n//          parent[key3] = {};\r\n//          var tgt3 = parent[key3];\r\n//          for (var i in tgt) tgt3[i.replace(/\\/[0-9]+$/,'/')] = true;\r\n          return tgt;\r\n        };\r\n      })(),\r\n      fmt4str2: function(str){\r\n        return str.replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,'');\r\n      },\r\n////      str2obj2: function(parent,key,str){ // working code.\r\n////        parent[key] = {};\r\n////        tgt = parent[key];\r\n////        var fields = str.replace(/\\/\\/.*/mg,'').replace(/\\n/g,',').split(',');\r\n////        for (var i=0;i<fields.length;i++) {\r\n////          if (fields[i]=='') continue;\r\n////          var name  = fields[i].replace(/[@%].*/,'');\r\n////          if (name=='') name = 'DEFAULT';\r\n////          var attr  = fields[i].match(/[@%].*/);\r\n////          var time  = (attr!=null)? attr[0].replace(/%[^@]*(@|$)/,'').replace(/@/,'') : null;\r\n////          var style = (attr!=null)? attr[0].replace(/@[^%]*(%|$)/,'').replace(/%/,'') : null;\r\n////          if (tgt[name]===undefined) tgt[name] = {};\r\n////          if (time ) tgt[name]['time']  = Date.parse(time);\r\n//////          if (style) tgt[name]['style'] = style;\r\n////          if (style) {\r\n////            if (!tgt[name].style) tgt[name].style = {};\r\n////            var styles = style.split(';');\r\n////            for (var j=0;j<styles.length;j++) {\r\n////              var stl = styles[j].split(':');\r\n////              tgt[name].style[stl[0]] = stl[1];\r\n////            }\r\n//////            tgt[name]['style'] = true;\r\n//////            var styles = style.split(';');\r\n//////            for (var j=0;j<styles.length;j++) {\r\n//////              var stl = styles[j].split(':');\r\n//////              tgt[name]['style.'+stl[0]] = stl[1];\r\n//////            }\r\n////          }\r\n////        }\r\n////        var key3 = key.replace(/_obj2/,'_obj3');\r\n////        parent[key3] = {};\r\n////        var tgt3 = parent[key3];\r\n////        for (var i in tgt) tgt3[i.replace(/\\/[0-9]+$/,'/')] = true;\r\n////      },\r\n//      str2obj4: function(parent,key,str) {\r\n//        parent[key] = this.style2obj(str);\r\n//      },\r\n//      style2obj: function(str) {\r\n//        var fields  = str.split(';');\r\n//        for (var i=fields.length-1;i>=0;i--) {\r\n//          if (fields[i]) {\r\n//            var coms = fields[i].replace(/\\s/g,'').split(':');\r\n//            fields[i] = '\"'+coms[0]+'\":\"'+coms[1]+'\"';\r\n//          } else fields.splice(i,1);\r\n//        }\r\n//        return JSON.parse('{' + fields.join(',') + '}');\r\n//      },\r\n      str2obj5: function(parent,key,str_in, flag_g){\r\n        parent[key] = {};\r\n        var tgt = parent[key];\r\n        var fields = str_in.replace(/\\s*\\/\\/.*/mg,'').replace(/\\n/g,',').split(',');\r\n        for (var i=0;i<fields.length;i++) {\r\n          var fd = fields[i].replace(/\\s*:\\s*/,':').replace(/\\s+$/,'');\r\n          if (fd=='') continue;\r\n          var idx = fd.indexOf(':'); // tags never contains ':'\r\n          var name = (idx!=-1)? fd.substr(0,idx) : 'DEFAULT';\r\n          var idx2;\r\n          var rx = fd[idx+1]==='/' && (idx2 = fd.lastIndexOf('/'), idx2>idx+2);\r\n          var str = (rx)? fd.slice(idx+2,idx2) : fd.slice(idx+1);\r\n          var flags = (flag_g? 'g':'') + (rx? fd.slice(idx2+1).replace(/g/,'') : '');\r\n          if (tgt[name]===undefined) tgt[name] = [];\r\n          try {\r\n            tgt[name][tgt[name].length] = new RegExp((rx)? str : this.str2rstr(str, flag_g), flags);\r\n          } catch(e) {\r\n            console.log('ERROR at str2obj5 in string of: '+fields[i]);\r\n          }\r\n//          tgt[name][tgt[name].length] = (fields[i][idx+1]==='/')? new RegExp(fields[i].substr(idx+2,fields[i].lastIndexOf('/')-idx-2),fields[i].substr(fields[i].lastIndexOf('/')+1)) :\r\n//                                        (key==='ex_list_obj5')? new RegExp(fields[i].substr(idx+1).replace(/\\*/g,'.*')) :\r\n//                                                                new RegExp(fields[i].substr(idx+1).replace(/\\*/g,'\\\\S*(\\\\s|$)'),'g');\r\n//          tgt[name][tgt[name].length] = new RegExp('#'+(fields[i][idx]==='/')? fields[i].substr(idx+1) :\r\n//                                                                               fields[i].substr(idx+1).replace(/\\*/,'.*'));\r\n        }\r\n      },\r\n      str2rstr: function(str,flag_g){\r\n        return str.replace(/[\\.\\(\\)\\[\\]\\+\\^\\$\\{\\}]/g,'\\\\$&').replace(/\\*/g,flag_g?'\\\\S*(\\\\s|\\\\n|$)':'.*').replace(/\\?/g,'.');\r\n      },\r\n//      str2obj8: (function(){ // not tested\r\n//        var idx;\r\n//        var proto = {re:false, ci:false, match:0, sentence:false, op:true, post:false,\r\n//                     sub:true, name:true, trip:false, com:true, file:false, meta:false, flag:false, id:false,    rexps:null};\r\n//        return {\r\n//          str2obj: function(parent,key,str_pref){\r\n//            parent[key] = {};\r\n//            tgt = parent[key];\r\n//            var fields = str_pref.replace(/\\s*\\/\\/.*/mg,'').replace(/\\n/g,',').split(',');\r\n//            var flag_g = key==='rm_list_obj5';\r\n//            var json = key==='auto_list_obj5';\r\n//            for (var i=0;i<fields.length;i++) {\r\n//              var fd = fields[i].replace(/\\s*:\\s*/,':').replace(/\\s+$/,'');\r\n//              if (fd=='') continue;\r\n//              var idx = fd.indexOf(':'); // tags never contains ':'\r\n//              try {\r\n//                var val = json? func_json(fd) : func_str(fd, flag_g); // must be preceded, this may change idx\r\n//              } catch(e) {\r\n//                console.log('ERROR at str2obj5 in string of: '+fd);\r\n//              }\r\n//              var name = (idx!=-1)? fd.substr(0,idx) : 'DEFAULT';\r\n//              if (tgt[name]===undefined) tgt[name] = [];\r\n//              tgt[name][tgt[name].length] = val;\r\n//            }\r\n//          },\r\n//          obj2str: function(obj){\r\n//            var tgt = common_func.deep_copy(obj);\r\n//            pref_func.obj_elim_the_same(tgt,proto);\r\n//            return JSON.stringify(tgt);\r\n//          }\r\n//        };\r\n//        function func_str(fd, flag_g){\r\n//          var idx2;\r\n//          var rx = fd[idx+1]==='/' && (idx2 = fd.lastIndexOf('/'), idx2>idx+2);\r\n//          var str = (rx)? fd.slice(idx+2,idx2) : fd.slice(idx+1);\r\n//          var flags = (flag_g? 'g':'') + (rx? fd.slice(idx2+1).replace(/g/g,'') : '');\r\n//          return new RegExp((rx)? str : this.str2rstr(str, flag_g), flags);\r\n//        }\r\n//        function func_json(fd){\r\n//          var idx2 = fd.indexOf('{');\r\n//          if (idx2<idx) idx = -1;\r\n//          var obj = JSON.parse(fd.slice(idx+1));\r\n//          obj.__proto__ = proto;\r\n//          obj.rexps = common_func.kwd_prep_regexp(obj);\r\n//          return obj;\r\n//        }\r\n//      })(),\r\n      str2obj7: (function(){\r\n        var proto = {use:true, str:'', re:false, ci:true, match:0, sentence:false, ew:false, op:true, post:false,\r\n                     sub:true, name:true, trip:false, com:true, file:false, meta:false, flag:false, id:false, id2:false, // rexps is not stringified.\r\n                     cmds:'', hide:false, boards:null, style:''};\r\n        var proto_post = {post:true, __proto__:proto};\r\n        function prep(obj, prefix, tgt, proto){\r\n          obj.__proto__ = proto;\r\n          obj.rexps = common_func.kwd_prep_regexp(obj);\r\n          var name = prefix.trim().replace(/\\s*[;:]\\s*/,'') || 'DEFAULT';\r\n          if (tgt[name]===undefined) tgt[name] = [obj];\r\n          else tgt[name][tgt[name].length] = obj;\r\n        }\r\n        return {\r\n          s2o: function(tgt, str_in, fm_name){\r\n            pref_func.parseJSONCs(str_in, prep, fm_name, true, tgt, (fm_name.indexOf('postFilter')!=-1)? proto_post : proto);\r\n            return tgt;\r\n          },\r\n//          s2o: function(tgt, str_in, fm_name){ // working code\r\n//            var fields = str_in.split(/\\s*\\n\\s*/); // no comments are allowed\r\n//            for (var i=0;i<fields.length;i++) {\r\n//              var fd = fields[i];\r\n//              var idx = fd.indexOf('{');\r\n//              if (idx===-1) continue;\r\n//              var name = fd.substr(0,idx).trim().replace(/\\s*:\\s*/,'') || 'DEFAULT';\r\n//              try {\r\n//                var obj = JSON.parse(fd.slice(idx).trim());\r\n//                obj.__proto__ = (fm_name==='postFilter.str')? proto_post : proto;\r\n//                obj.rexps = common_func.kwd_prep_regexp(obj);\r\n//                if (tgt[name]===undefined) tgt[name] = [obj];\r\n//                else tgt[name][tgt[name].length] = obj;\r\n//              } catch(e) {\r\n//                console.log('ERROR at str2obj7 in string of: '+fields[i]);\r\n//              }\r\n//            }\r\n//            return tgt;\r\n//          },\r\n          o2s: function(obj, from_post){\r\n            var tgt = {};\r\n            var p = from_post? proto_post : proto;\r\n            for (var i in p) if (p[i]!=obj[i]) tgt[i] = obj[i];\r\n            delete tgt['use'];\r\n            if (obj.sentence && obj.str.indexOf(' ')===-1) delete tgt['sentence'];\r\n            return JSON.stringify(tgt);\r\n          },\r\n        };\r\n      })(),\r\n      merge_obj5: function(name,obj,val){\r\n        return this.merge_obj5_all(name,obj,val,this.merge_obj5_1);\r\n      },\r\n      merge_obj5a: function(th,obj,val){\r\n        return this.merge_obj5_all(th.key,obj,val,this.merge_obj5_1a);\r\n      },\r\n      merge_obj5a_sc: function(name,obj,val){ // short cut logic.\r\n        if (':F' in obj) return obj[name];\r\n//        if (!obj) return val;\r\n        var dbt = common_func.fullname2dbt(name);\r\n        return obj[name] ||\r\n               obj[dbt[1]+dbt[2]] || // board+thread\r\n               obj[dbt[0]+dbt[2]] || // domain+thread\r\n               obj[dbt[2]] || // thread\r\n               obj[dbt[0]+dbt[1]] || // domain+board\r\n               obj[dbt[1]] || // board\r\n               obj[dbt[0]] || // domain\r\n               obj['DEFAULT'] || val;\r\n      },\r\n      merge_obj5_all: function(name,obj,val,func){\r\n        var dbt = common_func.fullname2dbt(name);\r\n        val = func(val,obj,'DEFAULT');\r\n        val = func(val,obj,dbt[0]); // domain\r\n        val = func(val,obj,dbt[1]); // board\r\n        val = func(val,obj,dbt[0]+dbt[1]); // domain+board\r\n        val = func(val,obj,dbt[2]); // thread\r\n        val = func(val,obj,dbt[0]+dbt[2]); // domain+thread\r\n        val = func(val,obj,dbt[1]+dbt[2]); // board+thread\r\n        val = func(val,obj,name); // CAUTION, direct access is used in some points, search 'CAUTION' in comments.\r\n        return val;\r\n      },\r\n      merge_obj5_1: function(val,obj,key){\r\n        if (obj[key]) {\r\n          var obj_key = obj[key];\r\n//          if (Array.isArray(obj_key)) return obj_key.concat(val || []);\r\n          if (!val) val = {};\r\n//          if (val.hit!==undefined) val.hit = true;\r\n          for (var i in obj_key)\r\n            if (typeof(obj_key[i])!=='object') val[i] = obj_key[i];\r\n            else {\r\n              if (val[i]===undefined) val[i]={};\r\n              for (var j in obj_key[i]) val[i][j] = obj_key[i][j]; // 2nd level.\r\n            }\r\n        }\r\n        return val;\r\n      },\r\n      merge_obj5_1a: function(val,obj,key){\r\n        var tgt = obj[key];\r\n        return tgt? (val? val.concat(tgt) : tgt) : val; // add after for postFilter\r\n//        return tgt? (val? tgt.concat(val) : tgt) : val;\r\n      },\r\n      str2obj6: function(parent,key,val,name){\r\n        var obj_hier  = pref_func.get_tgt(name, pref3);\r\n        obj_hier[0][obj_hier[1]](obj_hier[0],key,val, parent);\r\n      },\r\n      obj_init_hier: function(dst, src){\r\n        for (var i in dst) {\r\n          if (typeof(dst[i])==='object' && src[i]) this.obj_init_hier(dst[i], src[i]); // stopped by null.\r\n          else if (typeof(dst[i])==='function') dst[i](dst, i, src[i], src);\r\n        }\r\n      },\r\n      obj_init: function(){\r\n        pref_func.str2obj('catalog_board_list_str');\r\n        pref.catalog['style_general_list_obj2'] = pref_func.str2obj2(pref.catalog.style_general_list_str);\r\n        pref.catalog.board['ex_list_obj2'] = pref_func.str2obj2(pref.catalog.board.ex_list_str);\r\n//        pref_func.str2obj4(pref.liveTag, 'style_urtm_obj4', pref.liveTag.style_urtm_str);\r\n//        pref_func.str2obj4(pref.liveTag, 'style_ur_obj4',   pref.liveTag.style_ur_str);\r\n//        pref_func.str2obj4(pref.liveTag, 'style_in_obj4',   pref.liveTag.style_in_str);\r\n        pref_func.str2obj5(pref.liveTag, 'ex_list_obj5',    pref.liveTag.ex_list_str);\r\n        pref_func.str2obj5(pref.liveTag, 'rm_list_obj5',    pref.liveTag.rm_list_str);\r\n        pref_func.settings.onchange_funcs.archive['kwd.*'](); // archiver.event_funcs['kwd.*'](); can't use this because it doesn't exist at this time.\r\n        this.obj_init_hier(pref3, pref);\r\n        pref.postFilter.obj7 = pref_func.str2obj7.s2o({}, pref.postFilter.str, 'postFilter.str');\r\n      },\r\n      obj_elim_the_same: function(dst,src, no_copy, not_root){\r\n        var flag = false;\r\n        for (var i in dst) if (dst.hasOwnProperty(i) && !Object.getOwnPropertyDescriptor(dst,i).get || src.hasOwnProperty(i)) {\r\n          if (typeof(dst[i])==='object' && src[i] && typeof(src[i])==='object') { // eliminates objects made by program automatically because original object are vacant.\r\n            if (!pref_func.obj_elim_the_same(dst[i],src[i], no_copy, true)) delete dst[i];\r\n            else {\r\n              flag = true;\r\n              if (!no_copy) if (Array.isArray(dst[i]) || Array.isArray(src[i])) dst[i] = src[i];\r\n            }\r\n          } else {\r\n            if (dst[i]===src[i]) {\r\n              var proto;\r\n              if (dst.hasOwnProperty(i) || (proto = Object.getPrototypeOf(src), !proto || proto===Object.getPrototypeOf({}) || src[i]===proto[i])) delete dst[i];\r\n            } else {\r\n              flag = true;\r\n              if (!no_copy) dst[i]=src[i];\r\n            }\r\n          }\r\n        }\r\n        if ((Array.isArray(dst) || Array.isArray(src)) && dst.length!==src.length) flag = false;\r\n        return (not_root)? flag : dst;\r\n      },\r\n//      obj_elim_the_same: function(dst,src, not_root, no_copy){ // working code\r\n//        return this.obj_elim_the_same_1(new Set(), dst,src, not_root, no_copy);\r\n//      },\r\n//      obj_elim_the_same_1: function(done_list, dst,src, not_root, no_copy){\r\n//        var flag = false;\r\n//        for (var i in dst) {\r\n//          if (typeof(dst[i])==='object' && src[i] && typeof(src[i])==='object') { // eliminates objects made by program automatically because original object are vacant.\r\n//            if (!dst.hasOwnProperty(i)) continue;\r\n//            if (done_list.has(dst[i])) continue; else done_list.add(dst[i]); // blocks getters\r\n//            if (!pref_func.obj_elim_the_same_1(done_list, dst[i],src[i], true, no_copy)) {delete dst[i]; done_list.add(src[i]);}\r\n//            else {\r\n//              flag = true;\r\n//              if (!no_copy) if (Array.isArray(dst[i]) || Array.isArray(src[i])) dst[i] = src[i];\r\n//            }\r\n//          } else {\r\n//            if (dst[i]===src[i]) delete dst[i];\r\n//            else {\r\n//              flag = true;\r\n//              if (!no_copy) dst[i]=src[i];\r\n//            }\r\n//          }\r\n//        }\r\n//        if ((Array.isArray(dst) || Array.isArray(src)) && dst.length!==src.length) flag = false;\r\n//        return (not_root)? flag : dst;\r\n//      },\r\n      site2_json_ex_remove: function(){\r\n        var pref_test = pref_default(true);\r\n        delete pref_test.INST;\r\n//        delete pref_test.catalog_board_list_obj;\r\n//        delete pref_test.catalog.style_general_list_obj2;\r\n//        delete pref_test.catalog.board.ex_list_obj2;\r\n//        delete pref_test.liveTag.style_urtm_obj4;\r\n//        delete pref_test.liveTag.style_ur_obj4;\r\n//        delete pref_test.liveTag.style_in_obj4;\r\n//        delete pref_test.liveTag.ex_list_obj5;\r\n//        delete pref_test.liveTag.rm_list_obj5;\r\n//        if (pref_test.settings) delete pref_test.settings;\r\n//        if (pref_test.graph) delete pref_test.graph;\r\n        pref_func.obj_elim_the_same(pref_test,pref); // proto might be removed\r\n        var proto = pref_default().proto;\r\n        ['catalog','page','thread','float'].forEach(function(v){ // 'v => {' can use 'this' instead of 'pref_func'.\r\n          if (!pref_func.obj_elim_the_same(pref_test[v], proto, true)) delete pref_test[v];});\r\n//        delete pref_test.page.footer;\r\n//        delete pref_test.thread.footer;\r\n//        delete pref_test.float.footer;\r\n        return pref_test;\r\n      },\r\n      site2_json_ex: function(full, filter){\r\n        var pref_test = this.site2_json_ex_remove();\r\n        if (!filter) if (pref_test.filter) delete pref_test.filter;\r\n        if (!full) if (pref_test.catalog_board_list_str) delete pref_test.catalog_board_list_str;\r\n        if (pref_test.cli) delete pref_test.cli.json_str;\r\n        pref.cli.json_str = '{\"pref\":' + (!filter? JSON.stringify(pref_test) : '{\"filter\":'+JSON.stringify(pref_test.filter)+'}') + '}';\r\n//        if (!filter) pref.cli.json_str = '{\"pref\":' + JSON.stringify(pref_test) + '}';\r\n//        else pref.cli.json_str = '{\"pref\":{\"filter\":' + JSON.stringify(pref_test.filter) + '}}';\r\n      },\r\n      pref_query: function(ref,src){\r\n        var str = '';\r\n        for (var i in src) {\r\n          if (ref[i]!==undefined) {\r\n            str += '\"' + i + '\":' +\r\n                   ((typeof(src[i])==='object' && !Array.isArray(src[i]))? pref_func.pref_query(ref[i],src[i]) :\r\n                                                                           JSON.stringify(ref[i]))\r\n                 + ',';\r\n          }\r\n        }\r\n        return '{' + str.substr(0,str.length-1) + '}';\r\n      },\r\n      site2_eval: function(){\r\n//        try { \r\n//          if (pref.cli.eval_str!=='') eval(pref.cli.eval_str);\r\n//        } catch (e) {\r\n//          console.log('ERROR in overwtite strings:');\r\n//          console.log(pref.cli.eval_str);\r\n//          console.log(e);\r\n//        }\r\n      },\r\n//      get tooltips(){return Tooltips;}, // code was moved.\r\n      pref_samples: (site0.isStep)? null : {\r\n        simple: {\r\n          catalog_triage_str: 'KILL,X,',\r\n          catalog : {style_general_list_str:'%border:4px solid #d6daf0\\n%margin:4px',\r\n                     format : {show:{posts:true}}},\r\n        },\r\n        backwash: {\r\n          catalog_triage_str :\r\n            'NONE,O,width:;height:,NONE,O,border:4px solid #ff0000;width:100px;height:100px,NONE,O,border:4px solid #00ff00;width:100px;height:100px,'+\r\n            'NONE,O,border:4px solid #0000ff;width:100px;height:100px,NONE,O,border:4px solid #ffff00;width:100px;height:100px,'+\r\n            'NONE,O,border:4px solid #ff00ff;width:100px;height:100px,NONE,O,border:4px solid #00ffff;width:100px;height:100px',\r\n//          catalog_expand_at_initial : true,\r\n          page:{click:'expand'},\r\n          catalog:{format: {show:  {style:  true, contents:  true, layout:  true, posts: true, fileinfo: true, images_2nd: true}}},\r\n        },\r\n        recommend: {\r\n          max_threads_at_refresh : 500,\r\n          catalog: {\r\n            auto_load_filter: true,\r\n            auto_save_filter: true,\r\n            auto_save_filter_at_refresh: true,\r\n            order: {\r\n              sticky:'first',\r\n//              find_sage_in_8chan: true\r\n            },\r\n            board: {board_tags_same: true},\r\n            auto_update : true,\r\n            auto_update_period : 1,\r\n          },\r\n          page:{auto_update:true, auto_update_period:1},\r\n          float:{auto_update:true, auto_update_period:1},\r\n        },\r\n        get easy2(){return pref.easy2;},\r\n        'easy2.presets': (function(){\r\n          var presets = [\r\n            {liveTag: {use:false}, virtualBoard:{scan:false}, LTfrom:0, VB:{local:0, global:0}, network:{fetch_actively:false}},\r\n            {liveTag: {use:false}, virtualBoard:{scan:true }, LTfrom:0, VB:{local:1, global:0}, network:{fetch_actively:false}},\r\n            {liveTag: {use:false}, virtualBoard:{scan:true }, LTfrom:0, VB:{local:1, global:1}, network:{fetch_actively:false}},\r\n            {liveTag: {use:true }, virtualBoard:{scan:true }, LTfrom:0, VB:{local:2, global:0}, network:{fetch_actively:true }},\r\n            {liveTag: {use:true }, virtualBoard:{scan:true }, LTfrom:0, VB:{local:2, global:1}, network:{fetch_actively:true }},\r\n            {liveTag: {use:true }, virtualBoard:{scan:true }, LTfrom:0, VB:{local:2, global:2}, network:{fetch_actively:true }},\r\n            {liveTag: {use:true }, virtualBoard:{scan:true }, LTfrom:1, VB:{local:2, global:0}, network:{fetch_actively:true }},\r\n            {liveTag: {use:true }, virtualBoard:{scan:true }, LTfrom:1, VB:{local:2, global:1}, network:{fetch_actively:true }},\r\n            {liveTag: {use:true }, virtualBoard:{scan:true }, LTfrom:1, VB:{local:2, global:2}, network:{fetch_actively:true }},\r\n          ];\r\n          var vb_kwd = ['none','board','thread'];\r\n          var basics = {\r\n            catalog:{auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true},\r\n          };\r\n          return function(idx){\r\n            var easy2 = pref.easy2;\r\n            if (idx!==undefined) pref_func.pref_overwrite(easy2, presets[idx]);\r\n            easy2.virtualBoard.scan_domains = {};\r\n            for (var i in pref.virtualBoard.scan_domains) easy2.virtualBoard.scan_domains[i] = vb_kwd[((i===site.nickname)? easy2.VB.local : easy2.VB.global)];\r\n            easy2.liveTag.from = (easy2.LTfrom===0)? 'op' : 'post';\r\n            var auto_update = {auto_update:pref.easy2.auto_update, auto_update_period:pref.easy2.auto_update_period};\r\n            if (easy2.catalog.embed)      pref_func.pref_overwrite(easy2,{catalog:auto_update});\r\n            if (easy2.catalog.embed_page) pref_func.pref_overwrite(easy2,{page:   auto_update});\r\n            if (easy2.thread.embed)       pref_func.pref_overwrite(easy2,{thread: auto_update});\r\n            if (easy2.filter.time_watch || easy2.filter.time_watch_creation)\r\n              easy2.filter.time_str = new Date(Date.now()-((easy2.filter.time_watch)?easy2.time_post:easy2.time_op)*3600000).toLocaleString();\r\n            if (pref.easy2.basics) pref_func.pref_overwrite(easy2, basics);\r\n            return easy2;\r\n          };\r\n        })(),\r\n        'easy2.limits': (function(){\r\n          var limits = [\r\n            {virtualBoard:{max:100}, scan:{max:  100, max_threads:  1000}, catalog:{max_threads_at_refresh:  500}}, // general\r\n            {virtualBoard:{max: 50}, scan:{max:  100, max_threads:  1500}, catalog:{max_threads_at_refresh: 1500}}, // lain, meguca\r\n            {virtualBoard:{max:150}, scan:{max:  100, max_threads: 15000}, catalog:{max_threads_at_refresh:15000}}, // 4chan\r\n            {virtualBoard:{max:100}, scan:{max:   50, max_threads: 15000}, catalog:{max_threads_at_refresh:15000}}, // 8chan, top 50\r\n            {virtualBoard:{max:150}, scan:{max:  100, max_threads: 30000}, catalog:{max_threads_at_refresh:15000}}, // 8chan, top 100\r\n            {virtualBoard:{max:200}, scan:{max:  500, max_threads:100000}, catalog:{max_threads_at_refresh:15000}}, // 8chan, top 500\r\n            {virtualBoard:{max:200}, scan:{max:10000, max_threads:100000}, catalog:{max_threads_at_refresh:15000}}, // 8chan, all\r\n            {virtualBoard:{max:150}, scan:{max:  100, max_threads: 15000}, catalog:{max_threads_at_refresh:15000}}, // KC\r\n          ];\r\n          return function(){\r\n            pref_func.pref_overwrite(pref.easy2, limits[pref.easy2.limits]);\r\n          }\r\n        })(),\r\n        'easy.virtualBoard_10_passive': {\r\n          virtualBoard: {show: true, scan: true, max:20},\r\n          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:10},\r\n          page:{auto_update:true, auto_update_period:10},\r\n          float:{auto_update:true, auto_update_period:10},\r\n          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'board' : 'none';},\r\n        },\r\n        'easy.virtualBoard_10': {\r\n          virtualBoard: {show: true, scan: true, max:20},\r\n          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:10},\r\n          page:{auto_update:true, auto_update_period:10},\r\n          float:{auto_update:true, auto_update_period:10},\r\n          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'none';},\r\n        },\r\n        'easy.virtualBoard_1': {\r\n          virtualBoard: {show: true, scan: true, max:100, scanDelay: 20},\r\n          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:1},\r\n          page:{auto_update:true, auto_update_period:1},\r\n          float:{auto_update:true, auto_update_period:1},\r\n          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'none';},\r\n        },\r\n        'easy.virtualBoard_8_50': {\r\n          virtualBoard: {show: true, scan: true, max:100, scanDelay: 20},\r\n//          scan:{max:50},\r\n          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:5},\r\n          page:{auto_update:true, auto_update_period:5},\r\n          float:{auto_update:true, auto_update_period:5},\r\n          func: function(){\r\n            pref.scan.max = pref.easy.max_boards;\r\n            for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'none';\r\n          },\r\n        },\r\n////        'easy.virtualBoard_8_100': {\r\n////          catalog_auto_update : true,\r\n////          catalog_auto_update_period : 5,\r\n////          virtualBoard: {show: true, scan: true, max:100, scanDelay: 20},\r\n////          scan:{max:100},\r\n////          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true},\r\n////          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'none';},\r\n////        },\r\n////        'easy.virtualBoard_8_500': {\r\n////          catalog_auto_update : true,\r\n////          catalog_auto_update_period : 5,\r\n////          virtualBoard: {show: true, scan: true, max:100, scanDelay: 20},\r\n////          scan:{max:500},\r\n////          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true},\r\n////          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'none';},\r\n////        },\r\n        'easy.virtualBoard_8_all': {\r\n          virtualBoard: {show: true, scan: true, max:100, scanDelay: 20},\r\n          scan:{max:10000},\r\n          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:5},\r\n          page:{auto_update:true, auto_update_period:5},\r\n          float:{auto_update:true, auto_update_period:5},\r\n          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'none';},\r\n        },\r\n        'easy.virtualBoard_interSite': {\r\n          virtualBoard: {show: true, scan: true, max:100, scanDelay: 20},\r\n          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:10},\r\n          page:{auto_update:true, auto_update_period:10},\r\n          float:{auto_update:true, auto_update_period:10},\r\n          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'board';},\r\n//          func: function(){for (var i in pref.virtualBoard.scan_domains) if (i!==site.nickname && pref.virtualBoard.scan_domains[i]==='none') pref.virtualBoard.scan_domains[i] = 'board';},\r\n        },\r\n        'easy.posts_0h': {\r\n          filter:{time_str:null, time_watch:true},\r\n          func: function(){pref_func.pref_samples['easy.posts_0h'].filter.time_str = new Date().toLocaleString();}\r\n        },\r\n        'easy.posts_24h': {\r\n          filter:{time_str:null, time_watch:true},\r\n          func: function(){pref_func.pref_samples['easy.posts_24h'].filter.time_str = new Date(Date.now()-pref.easy.posts_ago*3600000).toLocaleString();}\r\n        },\r\n        'easy.threads_24h': {\r\n          filter:{time_str:null, time_watch_creation:true},\r\n          func: function(){pref_func.pref_samples['easy.threads_24h'].filter.time_str = new Date(Date.now()-pref.easy.threads_ago*3600000).toLocaleString();}\r\n        },\r\n////        'easy.posts_48h': {\r\n////          filter:{time_str:null, time_watch:true},\r\n////          func: function(){pref_func.pref_samples['easy.posts_48h'].filter.time_str = new Date(Date.now()-48*3600000).toLocaleString();}\r\n////        },\r\n        'easy.embed_index': {\r\n          catalog:{embed_page:true, auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true},\r\n        },\r\n        'easy.embed_index_lazy': {\r\n          catalog:{embed_page:true, auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_watch:false},\r\n          liveTag:{use:false},\r\n          notify:{desktop:{notify:false}},\r\n          network:{fetch_actively:false},\r\n//          page:{scan_tag:false},\r\n        },\r\n        'easy.light': {\r\n          catalog:{embed_page:true, auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true},\r\n          filter:{time_watch:false, time_watch_creation:false},\r\n          liveTag:{use:false},\r\n          stats:{use:false},\r\n          network:{fetch_actively:false},\r\n//          page:{scan_tag:false},\r\n        },\r\n        'easy.embed_index_infinite': {\r\n          catalog_max_page_auto:true,\r\n          catalog:{embed_page:true, auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true},\r\n        },\r\n        'easy.embed_index_backwash': {\r\n          catalog_max_page_auto:true,\r\n          catalog:{embed_page:true, auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:0},\r\n          page:{auto_update:true, auto_update_period:0},\r\n          float:{auto_update:true, auto_update_period:0},\r\n        },\r\n        'easy.stat_activate': {\r\n          stats:{use:true},\r\n          virtualBoard:{scan:true, scan_domains:{}},\r\n          liveTag:{use:true, from:'post'},\r\n          func: function(){this.virtualBoard.scan_domains[site.nickname] = 'board';},\r\n        },\r\n        pn_samples : null,\r\n        init : function(){\r\n          if (pref_func.pref_samples.pn_samples) return;\r\n          var html = pref_func.format_html_str('General samples:<br>'+\r\n                     '<BTN\"simple,simple\"><br>'+\r\n                     '<BTN\"backwash,backwash\"><br>'+\r\n                     '<BTN\"recommend,recommend for desktop/note\"><br>'+\r\n                     'Triages:<br>'+\r\n                     '<BTN\"triage.sample.simple_kill\"><br>'+\r\n                     '<BTN\"triage.sample.simple\"><br>'+\r\n                     '<BTN\"triage.sample.basic\"><br>'+\r\n                     '<BTN\"triage.sample.basic_color\"><br>'+\r\n                     '<BTN\"triage.sample.colorful\"><br>'+\r\n                     '<BTN\"triage.sample.borders\"><br>'+\r\n                     '<BTN\"triage.sample.samples\"><br>'+\r\n                     '<BTN\"triage.sample.test\"><br>');\r\n          var onchange_funcs = { // patch\r\n            simple: this.onclick_event,\r\n            backwash: this.onclick_event,\r\n            recommend: this.onclick_event,\r\n            __proto__:pref_func.settings.onchange_funcs\r\n          };\r\n          cnst.make_popup(pref_func.pref_samples,'pn_samples',html,onchange_funcs);\r\n//          pref_func.pref_samples.pn_samples = cnst.init('left:0px:tile:get:bottom:Show:tb',cnst.void_func,cnst.void_func,pref_func.pref_samples.destroy,cnst.void_func)[0];\r\n//          var pn_smpl = pref_func.pref_samples.pn_samples;\r\n//          pn_smpl.childNodes[1].innerHTML = '<button name=\"backwash\">backwash</button>';\r\n//          var buttons = pn_smpl.childNodes[1].getElementsByTagName('BUTTON');\r\n//          for (var i=0;i<buttons.length;i++) buttons[i].onclick = pref_func.pref_samples.onclick_event;\r\n        },\r\n//        destroy : function() {\r\n//          pref_func.pref_samples.pn_samples = cnst.div_destroy(pref_func.pref_samples.pn_samples, true);\r\n//        },\r\n        get_name: function(src,names,str){\r\n          for (var i in src) {\r\n            if (typeof(src[i])!=='object') names.push(str+i);\r\n            else pref_func.pref_samples.get_name(src[i],names,str+i+'.');\r\n          }\r\n          return names;\r\n        },\r\n        onclick_event : function(e, src) {\r\n          if (!src) src = pref_func.pref_samples[this.name || e.target.name];\r\n          if (src.func && typeof(src.func)==='function') src.func();\r\n          pref_func.pref_overwrite(pref,src);\r\n          pref_func.pref_overwrite(Tooltips.str,src);\r\n          var names = pref_func.pref_samples.get_name(src,[],'');\r\n          var pns = Array.prototype.slice.call(document.querySelectorAll('*[name]'));\r\n          for (var i=pns.length-1;i>=0;i--) if (names.indexOf(pns[i].name)==-1) pns.splice(i,1);\r\n          if (pns.length>0) pref_func.apply_prep(pns, false, true, null, true);  // refresh appearance, make object, trigger event.\r\n//          for (var i=0;i<names.length;i++) { // worknig code, but has a bug...\r\n//            var pn = document.getElementsByName(names[i])[0];\r\n//            if (pn) pref_func.apply_prep(document.getElementsByName(names[i])[0], false, true, null, true);  // refresh appearance, make object, trigger event.\r\n//          }\r\n////          for (var i=0;i<names.length;i++) { // working code.\r\n////            var pn = document.getElementsByName(names[i])[0];\r\n////            if (pn) {\r\n////              pref_func.apply_prep(pn,false);  // refresh appearance.\r\n//////            pref_func.apply_prep(pn,true);   // make obj.\r\n//////              pref_func.invoke_onchange(pn,true);   // make obj.\r\n////            }\r\n////            pref_func.make_pref_obj(names[i]); // make obj.\r\n//////            if (pref_func.settings.onchange_funcs[names[i]]) pref_func.settings.onchange_funcs[names[i]].call(pn);\r\n////            if (pn && pref_func.settings.onchange_funcs[names[i]]) pref_func.settings.onchange_funcs[names[i]].call(pn);\r\n////          }\r\n////          if (sessionStorage) sessionStorage.pref = JSON.stringify(pref);\r\n        }\r\n      },\r\n      settings: {\r\n        pn13 : null,\r\n        pnOrDummy: function(name){return this.pn13 && this.pn13.getElementsByTagName('*')[name] || {name:name, tagName:'TEXTAREA', onchange:cataLog.event_func, getAttribute: function(prop){return this[prop];}};},\r\n        show_hide : function(e){\r\n          if (pref_func.settings.pn13===null) {\r\n            var pos = ((e.clientX*2>window.innerWidth)? 'right':'left') + ':0px:' + ((e.clientY*2>window.innerHeight)? 'bottom:0':'top:'+site.header_height())+'px';\r\n            var pn13 = cnst.init(pos+':Show:tb',cnst.void_func,cnst.void_func,pref_func.settings.show_hide,cnst.void_func);\r\n            var pn13_0_2 = cnst.add_to_tb(pn13,\r\n              '<select name=\"settings.indexing\">'+\r\n                '<option>' + pref_func.settings.options.join('</option><option>') + '</option>'+\r\n              '</select>');\r\n            pn13_0_2.getElementsByTagName('select')['settings.indexing'].selectedIndex = pref.settings.indexing<pref_func.settings.options.length? pref.settings.indexing : 0;\r\n            pref_func.settings.pn13 = pn13; // for onchange func.\r\n//            pref_func.mirror_targets.pn13_1 = pn13.childNodes[1]; // for mirror.\r\n            pref_func.settings.onchange_funcs['settings.indexing']();\r\n            pref_func.add_onchange(pn13_0_2,pref_func.settings.onchange_funcs_formatted);\r\n            Tooltips.add_root(pn13.childNodes[1]);\r\n            cnst.bottom_top(pn13);\r\n          } else {\r\n            Tooltips.remove_root(pref_func.settings.pn13.childNodes[1]);\r\n            pref_func.settings.files_store();\r\n//            pref_func.mirror_targets.pn13_1 = null;\r\n            pref_func.settings.pn13 = cnst.div_destroy(pref_func.settings.pn13, true); // returns null\r\n          }\r\n        },\r\n////        show_hide : function(){cnst.make_destroy(pref_func.settings,'pn13',pref_func.settings.prep_pn13,pref_func.settings.destroy_pn13);}, // working code.\r\n////        prep_pn13 : function(){\r\n////          var pn13 = cnst.init('left:0px:tile:get:bottom:Show:tb',cnst.void_func,cnst.void_func,pref_func.settings.show_hide,cnst.void_func)[0];\r\n////          var pn13_0_2 = cnst.add_to_tb(pn13,\r\n////            '<select name=\"settings.indexing\">'+\r\n////              pref_func.settings.options.join('') + \r\n////////              '<option>Catalog: General 0</option>'+\r\n////////              '<option>Catalog: General 1</option>'+\r\n////////              '<option>Catalog: Board Group</option>'+\r\n////////              '<option>Catalog: Appearance</option>'+\r\n////////              '<option>Catalog: Design</option>'+\r\n////////              '<option>Catalog: Footer/PopUp</option>'+\r\n////////              '<option>Watcher / Notifiers</option>'+\r\n//////////              '<option>Statistics:</option>'+\r\n////////              '<option>UIP tracker for 4chan</option>'+\r\n////////              '<option>Command Line Interface</option>'+\r\n//////////              '<option>Workaround for dollchan</option>'+\r\n////////              '<option>General</option>'+\r\n////////              '<option>About</option>'+\r\n////            '</select>');\r\n////          pn13_0_2.getElementsByTagName('*')['settings.indexing'].selectedIndex = pref.settings.indexing;\r\n////          pref_func.settings.pn13 = pn13; // for onchange func.\r\n////          pref_func.mirror_targets.pn13_1 = pn13.childNodes[1]; // for mirror.\r\n////          pref_func.settings.onchange_funcs['settings.indexing'](); // leaks 1 EventLister, but call add_onchange in this.\r\n////          pref_func.add_onchange(pn13_0_2,pref_func.settings.onchange_funcs); // leaks 1.\r\n////          cnst.bottom_top(pn13);\r\n////          return pn13;\r\n////        },\r\n////        destroy_pn13 : function(){\r\n////          pref_func.mirror_targets.pn13_1 = null;\r\n////          pref_func.settings.files_store();\r\n////          pref_func.settings.pn13 = cnst.div_destroy(pref_func.settings.pn13, true); // returns null\r\n////        },\r\n        apply_pn13_1: function(set,propagate){\r\n          pref_func.apply_prep(pref_func.settings.pn13.childNodes[1],set,propagate);\r\n          pref_func.settings.onchange_funcs['pn13_1_warning']();\r\n        },\r\n        files_store: function(){\r\n//          var files_archive = pref_func.mirror_targets.pn13_1.querySelectorAll('span[name=\"FILES_ARCHIVE0\"]')[0]; // out of w3c, but works in chrome and FF.\r\n//          if (files_archive) site.script_body.firstChild.appendChild(files_archive); // called also at initial. // firstChild is 'display:none'.\r\n////          if (files_archive) site.script_body.appendChild(files_archive); // called also at initial.\r\n          var files = pref_func.settings.pn13.querySelectorAll('input[type=file]');\r\n          if (files.length>0) pref_func.apply_prep_2_all(files,true);\r\n        },\r\n        samples: {\r\n          catalog: {\r\n            get style_general_list_str(){return Tooltips.str['catalog.style_general_list_str']().replace(/^[^\\n]/mg,'// $&').replace(\r\n              /^\\n/m,'\\n;background:#e5ecf9 // example for all threads\\n'+\r\n                ';border:1px solid black\\n'+\r\n                '8chan;background:#eef2ff;border:1px solid #d6daf0\\n'+\r\n                '8chan;background:#eef2ff\\n'+\r\n                'KC;background:#e0e0fc;border:1px solid #aaaacc\\n'+\r\n                '4chan;background:#ffffee;border:1px solid #f0e0d6\\n'+\r\n                '/a/;background:#eef2ff // color /a/ blue\\n\\n');}},\r\n          postFilter:{get str(){return '// [Identifier:]JSONC for post filter\\n'+\r\n            '// comments are started wich // or enclosed by /*...*/\\n'+\r\n            '// You can edit this directly,\\n'+\r\n            '//   but I recommend you to copy-paste from local postFilter whose JSONs are generated by GUI.\\n'+\r\n            '// You can add identifier to each head of JSONC. If no indentifier, it will be applied to all.\\n\\n'+\r\n            '{\"str\":\"cute\",\"style\":\"border-left:10px solid pink\"}\\n\\n'+Tooltips.str.Identifier.replace(/^[^\\n]/mg,'// $&')+\r\n            '// JSONC: is JSON but allows C-type comments in it.';}},\r\n          style:{userCSS:{str:'/* userCSS will be a <style> elemnt directly. You can use all CSS notations.*/\\n'+\r\n            '/* comments must be enclosed by shash-aster, like this */\\n'+\r\n            '\\n/* levelized merge */\\n'+\r\n            '.CatChan_merged1::before{float:left;content:\">\";}\\n'+\r\n            '.CatChan_merged2::before{float:left;content:\">>\";}\\n'+\r\n            '.CatChan_merged3::before{float:left;content:\">>>\";}\\n'+\r\n            '.CatChan_merged4::before{float:left;content:\">>>>\";}\\n'+\r\n            '.CatChan_merged5::before{float:left;content:\">>>>>\";}\\n'+\r\n            '/* colored merge */\\n'+\r\n            '.CatChan_merged1{border-left:10px solid red;}\\n'+\r\n            '.CatChan_merged2{border-left:10px solid orange;}\\n'+\r\n            '.CatChan_merged2{border-left:10px solid yellow;}\\n'+\r\n            '.CatChan_merged2{border-left:10px solid green;}\\n'+\r\n            '.CatChan_merged3{border-left:10px solid blue;}\\n'+\r\n            '\\n/* remove buttons in titleBar */\\n'+\r\n            '.CatChan_titleBar button[name^=\"op\"]{display:none} /* remove transparency buttons */\\n'+\r\n            '.CatChan_titleBar button[name=\"roll_toggle\"]{display:none} /* remove toggle button */\\n'+\r\n            '.CatChan_titleBar button[name=\"max\"]{display:none} /* remove maximize button */\\n'+\r\n            '.CatChan_titleBar button[name=\"top\"]{display:none} /* remove embed to top button */\\n'+\r\n            '.CatChan_titleBar button[name=\"bottom\"]{display:none} /* remove embed to bottom button */\\n'+\r\n            '.CatChan_titleBar button[name=\"autoHeight\"]{display:none} /* remove auto height button */\\n'+\r\n            '/* give transparency to titlebar of watcher, add these 2 lines */\\n'+\r\n            '.CatChan_FC>*:first-child{position:absolute;width:100%;opacity:0;top:-2em}\\n'+\r\n            '.CatChan_FC>*:first-child:hover{opacity:1}\\n'+\r\n            '/* remove titlebar, add these 5 lines */\\n'+\r\n            '.CatChan_titleBar>*:first-child{position:absolute;width:100%;opacity:0}\\n'+\r\n            '.CatChan_titleBar>*:first-child:hover{opacity:1}\\n'+\r\n            '.CatChan_titleBar>*:first-child{pointer-events:none}\\n'+\r\n            '.CatChan_titleBar>*:first-child>*{pointer-events:auto}\\n'+\r\n            '.CatChan_titleBar>*:first-child>*:nth-child(4){pointer-events:none}\\n'+\r\n            '\\n/* patches */\\n'+\r\n            '.CatChan_search_miss>*{opacity:inherit} /* patch for chrome in 4chan */\\n'}}, // https://mevius.5ch.net/test/read.cgi/hp/1544452458/346\r\n          get how_to_triage(){return Triage.prototype.howto;},\r\n        },\r\n        html_funcs: null,\r\n        htmls:{ __proto__:{ // html_funcs is set to this\r\n          show_hide_all_to_header: function(str){\r\n            return '<span>' + str + '<a name=\"SHOWALL\" style=\"float:right;cursor:pointer\" data-str=\"[all\\u25b2]\">[all\\u25bc]</a></span>';\r\n          },\r\n//          show_hide_all_to_header: function(str){\r\n//            return '<span>' + str + '<span style=\"float:right\">' + this.show_hide_all('all\\u25bc', 'all\\u25b2') + '</span></span>';\r\n//          },\r\n          show_hide_all: function(str_show, str_hide){\r\n            return '<a name=\"SHOWALL\" style=\"cursor:pointer\">[' +str_show+ ']</a><a name=\"HIDEALL\" style=\"cursor:pointer\">[' +str_hide+ ']</a>';\r\n          },\r\n          show_hide: function(show, hide, inner, header, style){\r\n            return '<a name=\"SHOW\" style=\"cursor:pointer'+(style?';'+style:'')+'\" data-str=\"' +hide+ '\">' +show+ '</a><span style=\"display:none\">' +(header||'')+ '<br>' +inner+ '</span>';\r\n          },\r\n//          show_hide: function(str_show, str_hide, str_inner){\r\n//            return '<a name=\"SHOW\" style=\"cursor:pointer\">[' +str_show+ ']</a><a name=\"HIDE\" style=\"cursor:pointer;display:none\">[' +str_hide+ ']</a><span style=\"display:none\" name=\"SUB\"><br>' +str_inner+ '</span>';\r\n//          },\r\n          popup: function(mode){\r\n            return '2,<IC\"'+mode+'.popup\">Pop up reply' + this.rollup(\r\n              this.popup_delay('proto.')+'<br>'+\r\n              '3,<IC\"proto.popup_hlt\">Highlight the post if it is visible')+'<br>'+\r\n              '2,'+ this.rollup_radio(mode+'.inline_post', ' :Click posts to', 3, '',\r\n                ['no:No','inline:Inline the post, shift-click to jump', 'jump:Jump to the post'])+ '<br>';\r\n          },\r\n          popup_delay: function(pf, imm_down){\r\n            return '4,<IR\"'+pf+'popdown,imm\">immediately<br>'+\r\n              '4,<IR\"'+pf+'popdown,delay\">delayed: up:<ITB4\"'+pf+'popup_delay\">'+(imm_down? '':', down:<ITB4\"'+pf+'popdown_delay\">')+' ms<br>'+\r\n              '5,<IC\"'+pf+'popup_mMove\">Don\\'t popup while mouse is moving<br>'+\r\n              '4,zIndex: <ITB3\"'+pf+'popup_zIndex\">';\r\n          },\r\n//          popupX: function(mode, prop, caption){\r\n//            return '2,<IC\"'+mode+'.popup\">'+caption+this.rollup(\r\n//              this.popup_delay(prop))+'<br>';\r\n//          },\r\n          expand_thumbnail_inline: function(mode){\r\n            var pf = mode+'.thumbnail.inline.';\r\n            return '2,<IC\"' +mode+ '.expand_thumbnail_inline\">Image expansion at click'+ this.rollup(\r\n              this.limit_webm(pf)+\r\n//              '3,<IC\"' +mode+ '.expand_thumbnail_initial\">Expand all images at initial<br>'+\r\n              '3,<IC\"' +mode+ '.expand_thumbnail_inline_all_after\">Expand all images after clicked one automatically<br>'+\r\n              '4,On demand loading: <ITB3\"' +pf+ 'ref_height\">% of screen height<br>'+\r\n//              '4,<IC\"' +pf+ 'ondemand\">On demand loading: <ITB3\"' +pf+ 'ref_height\">% of height<br>'+\r\n              '4,<IC\"' +pf+ 'ondemandStop\">Stop expanding when any expanded image is shrinked<br>'+\r\n              '3,<IC\"' +pf+ 'stopHover\">Stop image hover on expanded image')+ '<br>';\r\n          },\r\n          expand_thumbnail_hover: function(mode){\r\n            var pf = mode+'.thumbnail.hover.';\r\n            return '2,<IC\"' +mode+ '.image_hover\">Image hover'+ this.rollup(\r\n              this.popup_delay(pf, true)+'<br>'+\r\n              this.limit_webm(pf, true)+\r\n              '3,<IC\"' +mode+ '.image_prefetch\">Prefetch next image<br>'+\r\n              '3,<IC\"' +pf+ 'dragfloat\">Drag thumbnail to make it window<br>'+\r\n              '4,<IC\"' +pf+ 'df_dblC\">Double click to close<br>'+\r\n              '4,<IC\"' +pf+ 'df_mW\">Wheel to scroll<br>'+\r\n              '3,<IC\"' +pf+ 'zoom_click\">Click to zoom mode if limited<br>'+\r\n              '3,<IC\"' +pf+ 'zoom_over\">Enter to zoom mode if limited<br>'+\r\n              '4,<IC\"' +pf+ 'zoom_dblC\">Double click to close<br>'+\r\n              '4,<IC\"' +pf+ 'zoom_mW\">Wheel to scroll<br>'+\r\n              '4,Tips for zoom mode: Limit max width.')+'<br>';\r\n          },\r\n          resize_thumbnails: function(mode){\r\n            return '<IC\"'+mode+'.format.thumb.resize\">Resize thumbnails'+this.rollup(\r\n              this.resize_thumbnails_size(mode, 'vsmall', 'Very small')+'<br>'+\r\n              this.resize_thumbnails_size(mode, 'small', 'Small')+'<br>'+\r\n              this.resize_thumbnails_size(mode, 'large', 'Large'))+'<br>';\r\n          },\r\n          resize_thumbnails_size: function(mode, size, caption){\r\n            var pf = mode+'.format.thumb.';\r\n            return '3,<IR\"'+pf+'size,'+size+'\">'+caption+'<br>'+\r\n              '4,1st thumbnail: <ITB4\"'+pf+size+'.w1\"> x <ITB4\"'+pf+size+'.h1\"><br>'+\r\n              '4,2nd and later: <ITB4\"'+pf+size+'.w2\"> x <ITB4\"'+pf+size+'.h2\">';\r\n          },\r\n          limit_webm: function(pf, webm_ctrl){\r\n            return '4,<IC\"' +pf+ 'limit_width\">Limit to browser\\'s width - <ITB3\"' +pf+ 'margin_width\"> px<br>'+\r\n              '4,<IC\"' +pf+ 'limit_height\">Limit to browser\\'s height - <ITB3\"' +pf+ 'margin_height\"> px<br>'+\r\n              '4,<IC\"' +pf+ 'webm\">Play webm'+(webm_ctrl? ', or <IC\"' +pf+ 'webm_ctrl\">play if ctrlKey':'')+'<br>'+\r\n              '5,<IC\"' +pf+ 'webm_loop\">Loop<br>'+\r\n              '5,<IC\"' +pf+ 'webm_mute\">Mute<br>';\r\n//              '3,<ICBX\"' +pref+ 'limit_width\"> Limit to browser\\'s width - <ITB3\"' +pref+ 'margin_width\"> px<br>'+\r\n//              '3,<ICBX\"' +pref+ 'limit_height\"> Limit to browser\\'s height - <ITB3\"' +pref+ 'margin_height\"> px';\r\n          },\r\n          env: function(mode, str_inner){\r\n            return '1,Environment values:(advanced option)'+ this.rollup(\r\n              '2,You are using native function of:<br>'+\r\n              '3,<IC\"' +mode+ '.popup_native\">Pop up reply<br>'+\r\n              '3,<IC\"' +mode+ '.expand_thumbnail_inline_native\">Image expansion<br>'+\r\n              '3,<IC\"' +mode+ '.image_hover_native\">Image hover<br>'+\r\n              '3,<IC\"' +mode+ '.colorID_native\">Color ID<br>'+\r\n              '3,<IC\"' +mode+ '.backlink_native\">Backlink<br>'+\r\n              '3,<IC\"' +mode+ '.localtime_native\">Local time'+\r\n              str_inner + '<br>'+\r\n              '2,<IC\"' +mode+ '.popup_native_kill\">Suppress native static popup<br>'+\r\n              '2,<IC\"' +mode+ '.refresh_initial\">Refresh at initial<br>'+\r\n              '2,Delay for posts search:<br>'+\r\n              '3,Incremental posts search may cause massive delay when keyword is short.<br>'+\r\n              '3,<ITB3\"'+mode+'.kwd_filter_delay\">ms if &lt;<ITB2\"'+mode+'.kwd_filter_delay_len\">letters') +'<br>';\r\n//              this.native_html_config(mode)) + '<br>';\r\n          },\r\n//          native_html_config: function(mode){\r\n//            return '2,Native HTML configuration<br>'+\r\n//              '3,<IC\"' +mode+ '.thread_pos_static\">Thread position is static<br>';\r\n//          },\r\n          posts_for_search: function(mode){\r\n            return '2,'+ this.rollup_radio(mode+'.storePosts',' :Num of posts to store for search', 3, '',\r\n              ['no:No additional posts are stored for search.<br>5,Search will be done only from posts for preview.',\r\n               'ALL:All posts are stored always.<br>5,Search will be done from all posts without preparation scan.',\r\n               'auto:All posts in all scanned threads are stored after the first activation of search.<br>5,Need (automatic) scans prior to search. (usual usage)',\r\n               'ALL_agg:All posts in all scanned threads are stored.<br>5,Search will be done from all scanned threads.<br>5,This is an option for search from entire domains.<br>'+\r\n               '3,<IC\"proto.searchAc.loosen\">Auto loosen limits at the first activation'+this.rollup(\r\n                 '6,Max boards of a scan: <ITB6\"proto.searchAc.max\"><br>'+\r\n                 '6,Max threads of a scan: <ITB6\"proto.searchAc.max_threads\"><br>'+\r\n                 '6,Max threads at refresh (auto deletion): <ITB6\"proto.searchAc.max_threads_at_refresh\"><br>'+\r\n                 '5,<BTN\"tighten_loosed_limits,Tighten loosed limits\">')+'<br>'+\r\n               '3,<IC\"'+mode+'.searchAs\">Auto scan from this (virtual) board if needed <BTN\"scanBoardIf,Scan\"><BTN\"scanBoard,Rescan\"><br>'+\r\n               '3,<IC\"'+mode+'.searchAsA\">Auto scan from all (virtual) boards if needed <BTN\"scanSiteIf,Scan\"><BTN\"scanSite,Rescan\">']) +'<br>'+\r\n              '2,'+ this.rollup_radio(mode+'.sourceOfSP',' :Posts to be used for search', 3,\r\n              '3,Posts may be stored also by function of deleted posts detection.<br>'+\r\n              '3,Number of stored posts can be shown in footer.<br>',\r\n              ['auto:All stored posts.(usual usage)',\r\n              'pv:Posts for preview only.<br>5,Search will be done only from recent or newer posts,<br>5,which depends on preview settings.']) +'<br>';\r\n          },\r\n          op_in_search_result: function(mode){\r\n            return '2,' + this.rollup_radio(mode+'.posts_search_op', ' :Unmatched OP in search result', 3, '',\r\n              ['show:Show', 'opaque:Opaque: <ITB3\"' +mode+ '.posts_search_op_opacity\"> %','hide:Hide']) + '<br>';\r\n//              '2,<ICBX\"' + mode + '.auto_config_posts_search\"> Auto config and scan at searching posts(WILL BE REPLACED)<br>';\r\n          },\r\n          deleted_posts_detection: function(mode){\r\n            return '2,' + this.rollup_radio(mode+'.deleted_posts.detect', ' :Detect deleted posts', 4, '3,Detection:<br>',\r\n                ['no:No', 'passive:Passive detection. Don\\'t make any request',\r\n                 'acc:Best effort without any additional requests', 'full:Full detection, read all posts at first', 'full_IDB:Full detection with IndexedDB'],\r\n              '<br>'+\r\n              '3,<IC\"' + mode + '.deleted_posts.merge\">Merge deleted posts with live posts'\r\n//              this.radios(mode+'.deleted_posts.store',4,\r\n//                ['LS:Store to LocalStorage to share with other tabs<br>5,<ICBX\"' + mode + '.deleted_posts.auto_clean\"> Clean up automatically',\r\n//                 'SS:Store to SessionStorage to get higher security', 'MC:Use ChannelMessage for security'])\r\n              );\r\n          },\r\n          popup_others: function(mode){\r\n            return '2,<IC\"'+mode+'.popupX.use\">Pop up others'+ this.rollup(\r\n              this.popup_delay('proto.popupX.')+'<br>'+\r\n              '3,<IC\"'+mode+'.popupX.ID\">Pop up ID<br>'+\r\n              '3,<IC\"'+mode+'.popupX.ID2\">Pop up ID2<br>'+\r\n              '3,<IC\"'+mode+'.popupX.flag\">Pop up flag<br>'+\r\n              '3,<IC\"'+mode+'.popupX.name\">Pop up name<br>'+\r\n              '3,<IC\"'+mode+'.popupX.trip\">Pop up trip')+'<br>';\r\n          },\r\n//          show_val_rollup: function(pref, inner){\r\n//            return '<SSV\"' +pref+ '\">'+ '&emsp;' + this.show_hide('change...', 'hide', '', inner);\r\n//          },\r\n          radios: function(pref, indent, args, pref2){\r\n            var r_str = indent+',<IR\"'+pref+',$1\">' + (pref2? pref2.map(function(v){return '<IR\"'+v+',$1\">';}).join('') : '');\r\n            return args.map(function(v){return v.replace(/([^:]*):/, r_str);}).join('<br>');\r\n          },\r\n          rollup_radio: function(pref, header, indent, middler, args, trailer, pref2){\r\n            return '<a name=\"SHOW2\" style=\"cursor:pointer\" data-str=\"\\u25b2]\">[<SSV\"' +pref+ '\"></span>\\u25bc]</a>'+\r\n              '<span name=\"SHOW2_I\">' + header + '</span><span style=\"display:none\" name=\"SUB\"><br>' +middler + this.radios(pref,indent,args,pref2)+ (trailer || '') + '</span>';\r\n//            return '<span name=\"NEXT\" style=\"cursor:pointer\">[<SSV\"' +pref+ '\"></span>' + this.show_hide('\\u25bc]', '\\u25b2]', header, middler + args.join('<br>'));\r\n//            return '<SSV\"' +pref+ '\">'+ header + '&emsp;' + this.show_hide('change...', 'hide', '', middler + args.join('<br>'));\r\n          },\r\n          rollup: function(inner, header, no_blank){\r\n            return (no_blank?'':'&emsp;') + this.show_hide('[\\u25bc]', '[\\u25b2]', inner, header);\r\n          },\r\n          rollupHelp: function(caption, inner, header){\r\n            return this.show_hide('['+caption+'\\u25bc]', '['+caption+'\\u25b2]', inner, header, 'float:right');\r\n          },\r\n          rollupTrav: function(tgt, caption){\r\n            return '<a name=\"SHOW_T\" style=\"cursor:pointer\" data-str=\"['+caption+'\\u25b2]\" data-trav=\"'+tgt+'\">['+caption+'\\u25bc]</a>';\r\n          },\r\n          format_posts: function(mode){\r\n            return '2,<IC\"' +mode+ '.open_spoiler_text\">Open text spoiler<br>'+\r\n              '2,<IC\"' +mode+ '.colorID\">Color ID<br>'+\r\n              this.backlink(mode)+\r\n              '2,<IC\"' +mode+ '.localtime\">Local time<br>'+\r\n              this.deleted_posts_detection(mode)+'<br>'+\r\n              '2,<IC\"' +mode+ '.mark_new_posts\">Mark new posts<br>'+\r\n              '2,<IC\"' +mode+ '.use_expander_always\">Use CatChan\\'s expander always<br>';\r\n          },\r\n          backlink: function(mode){\r\n            return '2,<IC\"' +mode+ '.backlink\">Backlink'+ this.rollup(\r\n              '3,<IC\"proto.bl_ec\">Explicit cross backlink<br>'+\r\n              '3,<IC\"proto.bl_rm\">Don\\'t retain backlinks to OP<br>'+\r\n              '3,<IC\"' +mode+ '.backlink_all\">Track all backlinks<br>'+\r\n              '4,<IC\"' +mode+ '.backlink_all_cross\">Track all cross-board links') + '<br>';\r\n          },\r\n          merge_all: function(mode){\r\n            return '2,<IC\"' +mode+ '.merge\">Merge all threads'+ this.rollup(\r\n              '2,<IC\"' +mode+ '.merge_list\">Merge listed threads&emsp;<BTN\"cleanMerge,CleanUpList\">'+'<br>'+\r\n              this.merges(mode)+'<br>'+\r\n              (mode==='thread'? '3,<IC\"thread.scroll_lock\">Don\\'t scroll at merging<br>':''))+'<br>';\r\n          },\r\n          merge_list: function(mode){\r\n            return '2,<IC\"' +mode+ '.merge_list\">Merge listed threads'+ this.rollup(\r\n              this.merges(mode)+'<br>'+\r\n              '2,<IC\"' +mode+ '.merge\">Merge all threads','&emsp;<BTN\"cleanMerge,CleanUpList\">');\r\n          },\r\n          merges: function(mode){\r\n            return '3,<TA\"proto.merge_list_str,40,1\"><br>'+\r\n              '3,<IC\"' +mode+ '.merge_lv\"'+(mode==='catalog'?' disabled':'')+'>Merge with level<br>'+\r\n              '4,<TA\"proto.merge_lv_str,40,1\"><br>'+\r\n              '4,Use style tips or user CSS to style'+this.rollup(\r\n                this.userCSS(1))+'<br>'+\r\n              (mode==='thread' || mode==='page'? '3,<IC\"'+mode+'.merge_auto_list\">Auto merge listed threads'+this.rollup(\r\n                '4,<IC\"'+mode+'.merge_auto_list_lv_add\">with level <ITB2\"'+mode+'.merge_auto_list_lv\">')+'<br>' : '')+\r\n              '3,<IC\"'+mode+'.merge_op_auto\">Auto merge cross-linked threads in OP'+this.rollup(\r\n              '5,(For new thread of generals typically.)<br>'+\r\n              '4,to hop <ITB2\"'+mode+'.merge_op_auto_hop\"><br>'+\r\n              '4,<IC\"'+mode+'.merge_op_lv_add\">with level <ITB2\"'+mode+'.merge_op_lv\">, <IC\"'+mode+'.merge_op_lv_inc\">increment by hop<br>'+\r\n              '4,(Entries of level are also used as end flags.<br>'+\r\n              '4,Unmerged states will be cleared after relaod if they are not added.)<br>'+\r\n              '4,<IC\"'+mode+'.merge_op_list\">Inherit value of exclusive list<br>'+\r\n              '4,<IC\"'+mode+'.merge_op_attr\">Inherit value of attribute list')+'<br>'+\r\n              '3,<IC\"' +mode+ '.merge_btn\">Add merge button to cross-links'+ this.rollup(\r\n              '4,Merge mode:<br>'+\r\n              '5,<IR\"'+mode+'.merge_btn_mode,all\"'+ (mode!=='thread'?' disabled':'')+'>all (Don\\'t modify the list)<br>'+\r\n              '5,<IR\"'+mode+'.merge_btn_mode,list\"'+(mode!=='thread'?' disabled':'')+'>by list (target is added to the list)<br>'+\r\n              '4,<IC\"'+mode+'.merge_btn_lv_add\">with level <ITB2\"'+mode+'.merge_btn_lv\">');\r\n          },\r\n          userCSS: function(indent){\r\n            return indent + ',Style tips for merge:<br>'+\r\n              (indent+1)+',<IC\"style.tips.merged1\">Add \">\" to merged threads of level 1<br>'+\r\n              (indent+1)+',<IC\"style.tips.merged2\">Add \">>\" to merged threads of level 2<br>'+\r\n              (indent+1)+',<IC\"style.tips.merged3\">Add \">>>\" to merged threads of level 3<br>'+\r\n              indent+','+this.ta_with_help('style.userCSS', 'User CSS');},\r\n//              indent+',<IC\"style.userCSS.use\">User CSS<br>'+\r\n//              (indent+1)+',<TA\"style.userCSS.str,40,1\"><br>'+\r\n//              (indent+1)+',Sample user CSS:<br>'+\r\n//              (indent+1)+',<TA\"samples.style.userCSS,40,1\" disabled>';},\r\n////            '<div>'+\r\n////              '<div style=\"float:left\">&emsp;&emsp;</div>'+\r\n////              '<div style=\"float:left\">'+\r\n////                '<TA\"style.userCSS.str,50,1\">'+\r\n////                '<div style=\"overflow:scroll;resize:both;\">'+this.userCSS_samples.replace(/\\n/g,'<br>')+'</div>'+\r\n////              '</div>'+\r\n////            '</div>';},\r\n////          userCSS_samples: 'Samples:\\n'+\r\n////            '.CatChan_titleBar button[name^=\"op\"]{display:none} /* remove transparency buttons in titleBar */\\n',\r\n          vb_domains: function(){\r\n            var pf = 'virtualBoard.scan_domains.';\r\n//            var str = '<span name=\"virtualBoard.scan_domains\">'+\r\n            return '2,Scan targets:<br>'+\r\n              '3,None/Board/Thread(No/Passive/Active)<br>'+\r\n              site0.domains.map(function(v){return '3,<IR\"'+pf+v+',none\"><IR\"'+pf+v+',board\"><IR\"'+pf+v+',thread\"> '+ v +'<br>';}).join('');  // 'apply_prep' can't recognize ['domain'] notation.\r\n          },\r\n//          get_domains: function(){\r\n//            var sites = Object.keys(pref.virtualBoard.scan_domains);\r\n//            sites.unshift(sites.splice(sites.indexOf(site.nickname),1)[0]);\r\n//            return sites;\r\n//          },\r\n          make_sel: function(pref,args){\r\n            var str = '<select name=\"' + pref + '\" style=\"float:none\">';\r\n            for (var i=0;i<args.length;i++) str += '<option>' + args[i] + '</option>';\r\n            return str + '</select>';\r\n          },\r\n          features_domains: function(){\r\n            var str = ''\r\n            for (var i=0;i<site0.domains.length;i++) str += '1,<IC\"features.domains.'+site0.domains[i]+'\">'+ site0.domains[i] +'<br>';\r\n            return str;\r\n          },\r\n          cb_block: function(pf,start, end){\r\n            var str = '';\r\n            var i=start-1;\r\n            while (pref[pf][++i]!==undefined && (!end || i<end)) str += '<ICN\"'+pf+'.'+i+'\">' + ((i%10===4)? '&emsp;' : (i%50===49)? '<br><br>' : (i%10===9)? '<br>' : '');\r\n            return str;\r\n          },\r\n          footer: function(mode){\r\n            var pf = mode+'.footer.';\r\n            return '1,<IC\"'+pf+'use\">Show information footer<br>'+ // this.rollup(\r\n//                '3,<IC\"'+mode+'.footer_br\">Always over/under the image')+'<br>'+\r\n              '2,<IC\"'+pf+'nrtm\">Show num of new replies to me (nm)'+this.rollup(\r\n                '3,<IC\"'+pf+'nrtm1\">Style if &gt;0:<ITBL30\"'+pf+'nrtm1_style\"><br>'+\r\n                '3,<IC\"'+pf+'nrtm0\">Empty if 0')+'<br>'+\r\n              '2,<IC\"'+pf+'nr\">Show num of new replies (nr)'+this.rollup(\r\n                '3,<IC\"'+pf+'nr1\">Style if &gt;0:<ITBL30\"'+pf+'nr1_style\"><br>'+\r\n                '3,<IC\"'+pf+'nr0\">Empty if 0')+'<br>'+\r\n              '2,<IC\"'+pf+'rp\">Show num of replies (rp), bold (RP)'+this.rollup(\r\n                '3,<IC\"'+pf+'rOP\">Count OP<br>'+\r\n                '3,<IC\"'+pf+'rp0\">Empty if OP only')+'<br>'+\r\n              '2,<IC\"'+pf+'im\">Show num of images (im), bold (IM)'+this.rollup(\r\n                '3,<IC\"'+pf+'iOP\">Count images in OP')+'<br>'+\r\n              '2,<IC\"'+pf+'nl\">Show num of stored live posts (lp)<br>'+\r\n              '2,<IC\"'+pf+'nd\">Show num of deleted posts (dp)<br>'+\r\n              '2,<IC\"'+pf+'ns\">Show num of saged posts (sp)<br>'+\r\n              '2,<IC\"'+pf+'page\">Show page No. (pg)<br>'+\r\n              '2,<IC\"threadStats.use\">Take statistics of each thread'+this.rollup(\r\n                '4,<IC\"threadStats.full\">Issue additional fetchs if required<br>'+\r\n                '5,<IC\"threadStats.retry\">Retry if obsolete data(may cause infinite loop)') + '<br>'+\r\n              '3,<IC\"'+pf+'nid\">Show num of IDs (ni)<br>'+\r\n              '3,<IC\"'+pf+'nf\">Show num of flags (nf)<br>'+\r\n              '2,<IC\"'+pf+'ctime\"> <IC\"'+pf+'rctime\">Show created time (ct), relative (cT)<br>'+\r\n              '2,<IC\"'+pf+'btime\"> <IC\"'+pf+'rbtime\">Show bumped time (bt), relative (bT)<br>'+\r\n              '2,<IC\"'+pf+'ptime\"> <IC\"'+pf+'rptime\">Show last posted time (pt), relative (pT)<br>'+\r\n              '2,<IC\"'+pf+'prate\">Show post rate, posts/day (pr)<br>'+\r\n              '2,<IC\"'+pf+'domain\">Show domain\\'s name (dn)<br>'+\r\n              '2,<IC\"'+pf+'board\">Show board\\'s name (bd)<br>'+\r\n              '2,<IC\"'+pf+'no\">Show thread\\'s no (no)<br>'+\r\n              '2,<IC\"'+pf+'archived\">Show archived (ar)<br>'+\r\n              '2,<IC\"'+pf+'tag\">Show tags, <SE\"proto.footer.merged_tag,no:no tags,any:in any threads,all:in all threads\"> for merged threads<br>'+\r\n    //          ', in <input type=\"text\" name=\"'+pf+'tag_letters\" size=\"2\" style=\"text-align: right;\"> letters'+\r\n              '2,<IC\"'+pf+'flag\">Show recent flags<br>'+\r\n              '2,<IC\"'+pf+'menu\">Show menu button at last'+this.rollup(\r\n              '3,'+this.triage_config(pf+'menu_str', 'Footer tail', 'kill,simple,menu:menu (default),headline,headline_ex,headline_merge,headline_merge_ex'))+'<br>'+\r\n//                '3,<TA\"'+pf+'menu_str,40,1\">', this.rollup(Triage.prototype.howto))+'<br>'+\r\n              '2,<IC\"'+pf+'triage\">Show triage button at head'+this.rollup(\r\n              '3,'+this.triage_config(pf+'triage_str', 'Footer head', 'kill,simple:simple (default),menu,headline,headline_ex,headline_merge,headline_merge_ex'))+'<br>'+\r\n//                '3,<TA\"'+pf+'triage_str,40,1\">', this.rollup(Triage.prototype.howto))+'<br>'+\r\n              '2,Design:<br>'+\r\n              '3,<IR\"'+pf+'design,native\"> U: */* / R: * / I: * / P: *<br>'+\r\n              '3,<IR\"'+pf+'design,condensed\"> */*/*/*/*<br>'+\r\n              '3,<IR\"'+pf+'design,meguca\"> /bd/ */*/*/*/*'+this.rollup(\r\n                'How to custoimze design<br>'+\r\n                '1,** are replaced by the parameter above.<br>'+\r\n                '1,() forms a group, all parameters to be replaced must be in ().<br>'+\r\n//                '4,(IB) and (Ib) are italics start/end at bumplimit, must be used in pair.<br>'+\r\n//                  '4,(II) and (Ii) are italics start/end at imagelimit, must be used in pair.<br>'+\r\n                '1,b, i, u, s, span, iB, and iI tags are accepted.<br>'+\r\n                '1,Each tag can accept style attribute.<br>'+\r\n                '1,&lt;iB&gt; and &lt;iI&gt; are pseudo tags for italics at Bump/Image limit.')+'<br>'+\r\n              '3,<IR\"'+pf+'design,custom\"> <ITBL40\"'+pf+'custom\"><br>'+\r\n              '3,<IR\"'+pf+'design,custom2\"> <ITBL40\"'+pf+'custom2\"><br>'+\r\n              '3,<IR\"'+pf+'design,custom3\"> <ITBL40\"'+pf+'custom3\"><br>';\r\n          },\r\n          design_of_fc: function(pfx){\r\n            return '<SE\"'+pfx+'.view,headline:Headline,catalog:Catalog,page:Page\"> :View';\r\n//            return this.rollup_radio('float.view', ' :View', indent, '', ['headline:Headline','catalog:Catalog<br>'+\r\n//              (indent+1)+',fc'+this.design_of_fc_1(mode, 'fc')+'<br>'+(indent+1)+',customNoOP'+this.design_of_fc_1(mode, 'c')+'<br>'+(indent+1)+',custom'+this.design_of_fc_1(mode, 'ec'), 'page:Page']);\r\n//              (indent+1)+',<IC\"float.format.'+prop+'.resize\">Resize:<ITB4\"float.format.'+prop+'.width\"> x <ITB4\"float.format.'+prop+'.height\">(<ICBX\"float.format.'+prop+'.max\">Max)', 'page:Page']);\r\n          },\r\n          design_of_fc_1: function(mode, prop){\r\n            return ': <ITBN4\"'+mode+'.format.'+prop+'.width\">x<ITB4\"'+mode+'.format.'+prop+'.height\">(<ICN\"'+mode+'.format.'+prop+'.max\">Max)';\r\n          },\r\n          design_of_fc_size_doms: document.createElement('div'),\r\n          design_of_fc_size_doms_register: function(pn_size,pn_teaser){\r\n            var pn = this.design_of_fc_size_doms;\r\n            if (pn.childNodes.length!==0) return;\r\n            pn.appendChild(pn_size.cloneNode(true)).name = 'float.catalog_size';\r\n            pn.appendChild(pn_teaser.cloneNode(true)).name = 'float.catalog_teaser';\r\n          },\r\n          design_of_fc_size: function(){\r\n            return this.design_of_fc_size_doms.innerHTML;\r\n          },\r\n          updates: function(mode, instance_form){\r\n            return '<IC\"' +mode+ '.auto_update\">Auto update'+(instance_form?'':', every ')+'<ITBN2\"' +mode+ '.auto_update_period\">min'+(instance_form || '.')+'<br>'+\r\n              this.rollup_radio(mode+'.refresh_src', ' :Refresh targets from', 1, '', ['bg:Boards group (usual catalog)','bgwl:Both; boards group and watch list (embed watcher)', 'wl:Watch list (watcher mode)'], '<br>2,Use catalog if >=<ITB3\"'+mode+'.refresh_src_th\"> threads in a board') + '<br>';\r\n          },\r\n          broadcast_triage: function(prop, caption, caption2){\r\n            return this.rollup_radio('triage.sync_'+prop, ' :Sync '+(caption || prop)+' list in this tab'+(caption2||''), 3, '', ['no:No','bg:Sync among the same board group', 'all:Sync with any board group']) + '<br>';\r\n          },\r\n          popup3: function(mode, indent){\r\n            return this.rollup_radio(mode+'.popup3.ww',' :Pop up', indent,\r\n              '3,WW/WN/NW/NN (Wider/Narrower) side:'+this.rollup(this.popup_delay('proto.popup3.')+'<br>'+\r\n              '4,Distance from mouse pointer, x:<ITB4\"proto.popup3.oX\">, y:<ITB4\"proto.popup3.oY\">')+'<br>',\r\n              ['no:No','sr:Search result','srpv:Search result or preview','pv:Preview','chart:Post rate chart (statistics must be activated)','dp:Deleted posts'], '',[mode+'.popup3.wn',mode+'.popup3.nw',mode+'.popup3.nn'])+ '<br>';\r\n          },\r\n          t2h: function(mode, caption){\r\n            return '2,' + this.rollup_radio(mode+'.t2h_sel', ' :'+caption, 3, '',\r\n              ['page:Inherit from index page',\r\n               'L: <ITB3\"'+mode+'.t2h_L\"> posts(L posts)',\r\n               'M: <ITB3\"'+mode+'.t2h_M\"> posts(M posts)',\r\n               'N: <ITB3\"'+mode+'.t2h_num_of_posts\"> posts(N posts)',\r\n               'N_unread:N + all unread posts',\r\n               'unread:All unread posts',\r\n               'ALL:All posts',\r\n//               'ALL_agg:All posts (for incremental posts search)',\r\n              ]) +'<br>';\r\n          },\r\n          appearance: function(prop, style){\r\n            if (!style) style='';\r\n            return '<IC\"catalog.appearance.'+prop+style+'\"><IC\"page.appearance.'+prop+style+'\"><IC\"thread.appearance.'+prop+style+'\"><IC\"float.appearance.'+prop+style+'\">';\r\n          },\r\n          triage_config: function(prop, caption, samples){\r\n            return this.inlineBlock(\r\n              '<span>'+caption+': <span style=\"float:right\"><SE\"triage.sampleLoader,Load sample...,'+samples+'\" data-tgt=\"'+prop+'\"> '+this.rollupTrav('PPn','How to')+'</span></span>'+\r\n              '<span style=\"display:none\"><br>'+\r\n                '<TA\"samples.how_to_triage,40,1\" disabled>'+\r\n              '</span><br>'+\r\n              '<TA\"'+prop+',40,1\">');\r\n//            return '<div style=\"display:inline-block\">'+\r\n//                caption+': <SE\"triage.sampleLoader,Load sample...,'+samples+'\" data-tgt=\"'+prop+'\">'+this.rollupHelp('How to','<TA\"samples.how_to_triage,40,1\" disabled>')+'<br>'+\r\n//                '<TA\"'+prop+',40,1\">'+\r\n//              '</div>'+\r\n//              '<div style=\"clear:both\"></div>';\r\n          },\r\n//          triage_config: function(prop, indent, caption, samples){\r\n//            return indent+','+caption+': <SE\"triage.sampleLoader,Load sample...,'+samples+'\" data-tgt=\"'+prop+'\">'+this.rollup(Triage.prototype.howto)+'<br>'+\r\n//              (indent+1)+',<TA\"'+prop+',40,1\">';\r\n//          },\r\n          triage_hover: function(mode){\r\n            return '3,<IC\"'+mode+'.triage_hover\">'+(mode==='page'? 'index ':'')+mode+' view, <SE\"'+mode+'.triage_place,topLeft:Top left,bottomLeft:Bottom left,topRight:Top right,bottomRight:Bottom right\"><br>';\r\n          },\r\n          IDinfo: function(tgt, op, same, sameCap){\r\n            return '3,<IC\"IDinfo.'+tgt+'.use\">nth/all by each '+tgt+', enclosed by <ITBL1\"IDinfo.'+tgt+'.h\"><ITBL1\"IDinfo.'+tgt+'.t\"><br>'+\r\n              (same? '4,<IC\"IDinfo.'+tgt+'.'+same+'\">nth/all/nof '+same+'s of the same '+tgt+'<br>':'')+\r\n              '4,<IC\"IDinfo.'+tgt+'.nof\">nth/all'+(same? '(/'+(sameCap)+')':'')+'/nof '+tgt+'s at that time<br>'+\r\n              (op? '4,<IC\"IDinfo.'+tgt+'.op\">Add \\'OP\\'<br>':'');\r\n          },\r\n          save_idx_promiscuous: function(mode){\r\n            return '2,<IC\"'+mode+'.save_board_list_sel\">Save board group index<br>'+\r\n              (mode==='float'? '2,<IC\"'+mode+'.clone\">Clone threads at initial if others refer the same board group<br>' : '')+\r\n              '2,<IC\"'+mode+'.accept_others_refresh\">Sync with others which refer the same board group<br>'+\r\n              '2,<IC\"'+mode+'.promiscuous\">Show all fetched threads<br>';\r\n          },\r\n          ta_with_help: function(prop, caption, old_prop, caption_button){\r\n            return this.inlineBlock('<IC\"'+prop+(old_prop?'':'.use')+'\">'+caption+this.rollupHelp(caption_button||'sample',\r\n              '1,<TA\"samples.'+prop+(old_prop?'_':'.')+'str,40,1\" disabled>')+'<br>'+\r\n              '1,<TA\"'+prop+(old_prop?'_':'.')+'str,40,1\">')+'<br>';\r\n          },\r\n          notify_init: function(prop){\r\n            return this.rollup('4,<IC\"notify.'+prop+'.supp_init\">Suppressed at initial')+ '<br>';\r\n          },\r\n          notify_tgts: function(prop){\r\n            return '2,<IC\"notify.'+prop+'.reply_to_me\">New replies to me<br>'+\r\n              '2,<IC\"notify.'+prop+'.reply\">New replies<br>'+\r\n              '2,<IC\"notify.'+prop+'.new_thread\">New threads<br>'+\r\n              (pref.test_mode['133']? '2,<IC\"notify.'+prop+'.appear\">Appear threads<br>' : '');\r\n          },\r\n          add_indent: function(indent, str){\r\n            return str.replace(/(^|<br>|<\\/div>)(\\d+,)*</g, function(m,p1,p2){\r\n              var idt = indent + (parseInt(p2,10)||0);\r\n              return (p1||'') + (idt? idt+',':'')+'<';});\r\n          },\r\n          inlineBlock: function(str){\r\n            return '<div style=\"display:inline-block\">'+str+'</div>'; // +\r\n//              '<div style=\"clear:both\"></div>';\r\n          },\r\n        },\r\n        'Easy Setting2:': function(){return 'Easy Setting2: --- Welcome to CatChan! ---<br>'+\r\n          '<br>'+\r\n          '1,0. <BTN\"easy2.beginner,I\\'m a beginner and I just want to try\">, click this.<br>'+\r\n          '2,Then a reload will occur after loading settings for beginner.<br>'+\r\n          '2,(This will be default after a certain period of test.)<br>'+\r\n          '2,Or follow next steps to choose your favorite settings.<br>'+\r\n          '<br>'+\r\n          '1,1. <input type=\"checkbox\" name=\"easy2.reset\"> Reset all settings before loading new one if you prefer.<br>'+\r\n          '1,2. Select a preset: '+\r\n          '<select name=\"easy2.presets\" style=\"float:none\">'+\r\n            '<option>Safe default</option>'+\r\n            '<option>Silent inter-board operability (for beginner)</option>'+ // passive/No/No. works silently.\r\n            '<option>Silent inter-site operability</option>'+  // passive/passive/No, works silently.\r\n//            '<option>Silent in-board operability with tags from OP</option>'+    // active/No/liveTag-OP\r\n            '<option>Active inter-board operability</option>'+ // active/No/LiveTag-OP, scans all catalogs.\r\n            '<option>Active inter-site ondemand operability</option>'+ // active/passive/LiveTag-OP, scans all catalogs, but ondemand for other site.\r\n            '<option>Active inter-site operability</option>'+ // active/active/LiveTag-OP, scans all catalogs.\r\n            '<option>Active in-board operability with LiveTag</option>'+    // active/No/liveTag-Post, scans all threads.\r\n            '<option>Active inter-board operability with LiveTag</option>'+ // active/passive/liveTag-Post, scans all threads.\r\n            '<option>Active inter-site operability with LiveTag</option>'+ // active/active/liveTag-Post, scans all threads.\r\n          '</select><br>'+\r\n          '1,3. Select limits for safe: '+\r\n          '<select name=\"easy2.limits\" style=\"float:none\">'+\r\n            '<option>General</option>'+\r\n            '<option>/all/ for lain, meguca</option>'+\r\n            '<option>/all/ for 4chan</option>'+\r\n            '<option>8chan with top 50 boards</option>'+\r\n            '<option>8chan with top 100 boards</option>'+\r\n            '<option>8chan with top 500 boards</option>'+\r\n            '<option>8chan with all boards</option>'+\r\n            '<option>/all/ for KC</option>'+\r\n          '</select><br>'+\r\n          '1,4. Modify details if you want.<br>'+\r\n          '2,<input type=\"checkbox\" name=\"easy2.virtualBoard.show\"> VirtualBoards, shows '+\r\n          '<input type=\"text\" name=\"easy2.virtualBoard.max\" size=\"3\" style=\"text-align: right;\"> virtual boards<br>'+\r\n          '4,Local: <select name=\"easy2.VB.local\" style=\"float:none\">'+\r\n            '<option>No</option>'+\r\n            '<option>Passive</option>'+\r\n            '<option>Active</option>'+\r\n          '</select>'+\r\n          '&emsp;Global: <select name=\"easy2.VB.global\" style=\"float:none\">'+\r\n            '<option>No</option>'+\r\n            '<option>Passive</option>'+\r\n            '<option>Active</option>'+\r\n          '</select><br>'+\r\n          '2,<input type=\"checkbox\" name=\"easy2.liveTag.use\"> LiveTag, '+\r\n          'from: <select name=\"easy2.LTfrom\" style=\"float:none\">'+\r\n            '<option>OP</option>'+\r\n            '<option>Posts</option>'+\r\n          '</select><br>'+\r\n          '2,<IC\"easy2.catalog.embed\">Use CatChan in catalog<br>'+\r\n          '2,<IC\"easy2.catalog.embed_page\">Use CatChan in index page<br>'+\r\n          '2,<IC\"easy2.thread.embed\">Use CatChan in thread<br>'+\r\n          '2,<IC\"easy2.auto_update\">Auto update, every <ITB2\"easy2.auto_update_period\"> min.<br>'+\r\n          '2,<IC\"easy2.notify.desktop.notify\">Desktop notification<br>'+\r\n          '2,Misc.'+this.rollup(\r\n            '3,<IC\"easy2.filter.time_watch\">Hide all threads which have no posts in recent <ITB3\"easy2.time_post\"> hours<br>'+\r\n            '3,<IC\"easy2.filter.time_watch_creation\">Hide all threads which are created before <ITB3\"easy2.time_op\"> hours ago<br>'+\r\n            '3,<IC\"easy2.stats.use\">Statistics<br>'+\r\n            '3,<IC\"easy2.healthIndicator.expand_running\">Show details of running indicators<br>'+\r\n            '3,<IC\"easy2.network.fetch_actively\">Fetch missing info actively<br>'+\r\n//          '2,<input type=\"checkbox\" name=\"easy2.basics\"> Other basic settings, which depends on preset<br>'+\r\n            '3,<IC\"easy2.basics\">Other basic settings<br>'+\r\n            '3,Limits for safe: <br>'+\r\n            '4,At scan: <ITB6\"easy2.scan.max\"> boards, <ITB6\"easy2.scan.max_threads\"> threads.<br>'+\r\n            '4,In a catalog: <ITB6\"easy2.catalog.max_threads_at_refresh\"> threads.')+'<br>'+\r\n          '1,5. Click <BTN\"easy2.apply,Apply\"><br>'+\r\n          '1,6. Click <BTN\"save,Save\"> if you want to save your settings to localStorage<br>'+\r\n          '1,7. Click <BTN\"reload,Reload\">, because some setting may need<br>';},\r\n        'Easy Setting:': 'Easy Setting:<br>'+\r\n          '&emsp;VBs: virtual boards<br>'+\r\n          '&emsp;AU: auto update every X min<br>'+\r\n          '1,<BTN\"easy.virtualBoard_10_passive,Click\"> 20 VBs / AU 10 min. / passive scan. (for all)<br>'+\r\n          '1,<BTN\"easy.virtualBoard_10,Click\"> 20 VBs / AU 10 min. (for lainchan and meguca)<br>'+\r\n          '1,<BTN\"easy.virtualBoard_1,Click\"> 100 VBs / AU 1 min. (for 4chan)<br>'+\r\n          '1,<BTN\"easy.virtualBoard_8_50,Click\"> 100 VBs / AU 5 min from top '+\r\n          '<input type=\"text\" name=\"easy.max_boards\" size=\"3\" style=\"text-align: right;\">'+\r\n          ' boards. (for 8chan)<br>'+\r\n//          '&emsp;<BTN\"easy.virtualBoard_8_100,Click\"> 100 VBs / AU 5 min from top 100 boards. (for 8chan)<br>'+\r\n//          '&emsp;<BTN\"easy.virtualBoard_8_500,Click\"> 100 VBs / AU 5 min from top 500 boards. (for 8chan)<br>'+\r\n          '1,<BTN\"easy.virtualBoard_8_all,Click\"> 100 VBs / AU 5 min from all boards. (for 8chan)<br>'+\r\n          '1,<BTN\"easy.virtualBoard_interSite,Click\"> 100 VBs / AU 10 min from all sites. / passive scan. (for all)<br>'+\r\n          '<br>'+\r\n          '1,<BTN\"easy.posts_0h,Click\"> I want to check all new posts from now.<br>'+\r\n          '1,<BTN\"easy.posts_24h,Click\"> I want to check all posts from '+\r\n          '<input type=\"text\" name=\"easy.posts_ago\" size=\"3\" style=\"text-align: right;\">'+\r\n          ' hours ago.<br>'+\r\n          '1,<BTN\"easy.threads_24h,Click\"> I want to check all new threads from '+\r\n          '<input type=\"text\" name=\"easy.threads_ago\" size=\"3\" style=\"text-align: right;\">'+\r\n          ' hours ago.<br>'+\r\n          '<br>'+\r\n//          '&emsp;<BTN\"easy.embed_index,Click\"> Use CatChan in index page without infinite scroll.<br>'+\r\n          '1,<BTN\"easy.embed_index_lazy,Click\"> Setup for narrow band.<br>'+\r\n          '1,<BTN\"easy.embed_index_infinite,Click\"> Setup for infinite scroll.<br>'+\r\n          '1,<BTN\"easy.embed_index_backwash,Click\"> Backwash style. (infinite scroll/quick auto update)<br>'+\r\n          '<br>'+\r\n          '1,<BTN\"easy.light,Click\"> Setup for light start up.<br>'+\r\n          '',\r\n        'Virtual Board:': function(){return 'Virtual Board:<br>'+\r\n            '&emsp;<input type=\"checkbox\" name=\"virtualBoard.show\"> Show virtual boards'+\r\n            ', up to: <input type=\"text\" name=\"virtualBoard.max\" size=\"3\" style=\"text-align: right;\"><br>'+\r\n            '2,<IC\"virtualBoard.search.show\">Show search bar in boardlist<br>'+\r\n//            '3,<ICBX\"virtualBoard.search.re\"> Regular Expression<br>'+\r\n            '&emsp;<input type=\"checkbox\" name=\"virtualBoard.scan\"> Scan at start up'+\r\n            ', delay: <input type=\"text\" name=\"virtualBoard.scanDelay\" size=\"2\" style=\"text-align: right;\">s<br>'+\r\n            '3,Scan: <BTN\"virtualBoard.scanStart,Start\">'+\r\n            '&emsp;<BTN\"virtualBoard.scanStop,Stop\"><br>'+\r\n            this.vb_domains()+\r\n            '&emsp;&emsp;<input type=\"checkbox\" name=\"virtualBoard.instant_scan\"> Instant scan<br>'+\r\n            '&emsp;Physical boards in boardlist:<br>'+\r\n            '&emsp;&emsp;<input type=\"radio\" name=\"virtualBoard.p_board\" value=\"both\"> Show as they are<br>'+\r\n            '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"virtualBoard.p_remove\"> Remove virtual boards of the same name<br>'+\r\n            '&emsp;&emsp;<input type=\"radio\" name=\"virtualBoard.p_board\" value=\"replace\"> Replace with virtual boards<br>'+\r\n//            '3,<ICBX\"virtualBoard.v_remove\"> Remove filtered virtual boards<br>'+\r\n            '1,<IC\"liveTag.info\">Show infomation on hover<br>'+\r\n            '1,Styles:'+this.rollup(\r\n            '2,Selected:<ITBL30\"liveTag.style.in\"><br>'+\r\n            '2,Excluded:<ITBL30\"liveTag.style.ex\"><br>'+\r\n            '2,<IC\"liveTag.style.use\">Add style for unread posts:<br>'+\r\n  //          '&emsp;&emsp;Unread replies to me:<textarea rows=\"1\" cols=\"20\" name=\"liveTag.style_urtm_str\"></textarea><br>'+\r\n  //          '&emsp;&emsp;Unread replies:<textarea rows=\"1\" cols=\"20\" name=\"liveTag.style_ur_str\"></textarea><br>'+\r\n            '3,Unread replies to me:<ITBL30\"liveTag.style.urtm\"><br>'+\r\n            '3,Unread replies:<ITBL30\"liveTag.style.ur\"><br>'+\r\n            '3,Unread replies to me + selected:<ITBL30\"liveTag.style.inurtm\"><br>'+\r\n            '3,Unread replies + selected:<ITBL30\"liveTag.style.inur\"><br>'+\r\n            '3,Unread replies to me + excluded:<ITBL30\"liveTag.style.exurtm\"><br>'+\r\n            '3,Unread replies + excluded:<ITBL30\"liveTag.style.exur\">')+'<br>';},\r\n        'Catalog:': function(){\r\n            return this.show_hide_all_to_header('Catalog:') + '<br>'+\r\n              '1,<IC\"catalog.embed\">Use CatChan in catalog<br>'+\r\n              '2,<IC\"catalog.infoPv.use\">Info preview hover'+this.rollup(this.popup_delay('catalog.infoPv.'))+'<br>'+\r\n              this.expand_thumbnail_hover('catalog')+\r\n              this.popup_others('catalog')+\r\n              '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.open_spoiler_text\"> Open text spoiler<br>'+\r\n              this.add_indent(2,this.updates('catalog'))+\r\n              '2,<IC\"catalog.mark_new_posts\">Mark new posts at opening threads<br>'+\r\n              '2,'+ this.rollup_radio('catalog.click_area', ' :Click to open the thread', 3, '',\r\n                ['thumbnail:Thumbnail','entire:Entire thread card'])+ '<br>'+\r\n              '2,'+ this.popup3('catalog',3)+\r\n//              '2,'+ this.rollup_radio(!pref.test_mode['110']? 'catalog.popup3.ww':'catalog.popup2',' :Pop up', 3,\r\n//                '3,WW/WN/NW/NN (Wider/Narrower) side:'+this.rollup(this.popup_delay('proto.popup3.'))+'<br>',\r\n//                ['no:No','sr:Search result','srpv:Search result or preview','pv:Preview','chart:Post rate chart (statistics must be activated)','dp:Deleted posts'], '',['catalog.popup3.wn','catalog.popup3.nw','catalog.popup3.nn'])+ '<br>'+\r\n              '2,'+ this.rollup_radio('catalog.t2h_sel',' :Num of posts for preview or footer', 3, '',\r\n                ['no:No','N:Last <ITB3\"catalog.t2h_num_of_posts\"> posts (N posts)',\r\n                 'N_unread:N + all unread posts', 'unread:All unread posts', 'ALL:All posts' //, ALL_agg:All posts from all scanned threads'\r\n                ]) +'<br>'+\r\n              this.posts_for_search('catalog')+\r\n              this.op_in_search_result('catalog')+\r\n              this.deleted_posts_detection('catalog')+'<br>'+\r\n              '2,<IC\"catalog.detect_sage\">Detect saged posts in 4chan<br>'+\r\n              '3,<IC\"catalog.page_his\">Store page history in 4chan<br>'+\r\n              this.backlink('catalog')+\r\n              this.save_idx_promiscuous('catalog')+\r\n              this.merge_list('catalog')+'<br>'+ // + this.rollup(\r\n//              '2,OP merge by manual<br>'+\r\n//              '3,to hop <ITB2\"catalog.merge_op_auto_hop\"><br>'+\r\n//              '3,<IC\"catalog.merge_op_lv_add\">with level <ITB2\"catalog.merge_op_lv\">, <IC\"catalog.merge_op_lv_inc\">increment by hop')+'<br>'+\r\n              '1,<IC\"catalog.embed_archive\">Generate catalog in archive'+this.rollup(\r\n                '5,from top <ITB5\"scan.max_archive\"> threads')+'<br>'+\r\n              '<br>'+\r\n              '1,Environment values:(advanced option)'+ this.rollup(\r\n                '2,You are using native function of:<br>'+\r\n                '3,<IC\"catalog.env.popup_native\">Pop up reply<br>'+\r\n                '3,<IC\"catalog.env.image_hover_native\">Image hover<br>'+\r\n                '2,<IC\"catalog.env.refresh_initial\">Refresh at initial<br>'+\r\n                '2,Custom size:<br>'+\r\n                '3,With OP'+this.design_of_fc_1('catalog','ec')+'<br>'+\r\n                '3,Without OP'+this.design_of_fc_1('catalog','c')+'<br>'+\r\n                '2,'+this.resize_thumbnails('catalog')) + '<br>';},\r\n//                this.native_html_config('catalog.env')) + '<br>';},\r\n        'Index Page:': function(){\r\n            return this.show_hide_all_to_header('Index Page:') + '<br>'+\r\n              '&emsp;<input type=\"checkbox\" name=\"catalog.embed_page\"> Use CatChan in index page' + this.rollup(\r\n                '3,Refresh up to:<br>'+\r\n                '4,<IR\"catalog_max_page_select,manual\"> <ITB2\"catalog_max_page\"> pages<br>'+\r\n                '4,<IR\"catalog_max_page_select,auto\"> Max pages<br>'+\r\n                '5,<IC\"catalog_max_page_auto\">Update automatically') +'<br>'+\r\n    //          '&emsp;&emsp;<input type=\"checkbox\" name=\"page.infinite\"> Infinite scroll<br>'+\r\n              this.popup('page')+\r\n              this.expand_thumbnail_inline('page')+\r\n              this.expand_thumbnail_hover('page')+\r\n              this.popup_others('page')+\r\n              this.format_posts('page')+\r\n    //          '&emsp;&emsp;<input type=\"checkbox\" name=\"page.scan_tag\"> Scan tags at initial<br>'+\r\n    //          '&emsp;&emsp;<input type=\"checkbox\" name=\"page.format.show.posts\"> Show posts<br>'+\r\n              this.t2h('page','Num of posts to show')+\r\n//              '2,' + this.rollup_radio('page.t2h_sel', ' :Num of posts to show', 3, '',\r\n//                ['page:Inherit from index page',\r\n//                 'L: <ITB3\"page.t2h_L\"> posts(L posts)',\r\n//                 'M: <ITB3\"page.t2h_M\"> posts(M posts)',\r\n//                 'N: <ITB3\"page.t2h_num_of_posts\"> posts(N posts)',\r\n//                 'N_unread:N + all unread posts',\r\n//                 'unread:All unread posts',\r\n//                 'ALL:All posts',\r\n////                 'ALL_agg:All posts (for incremental posts search)',\r\n//                ]) +'<br>'+\r\n              this.posts_for_search('page')+\r\n              this.op_in_search_result('page')+\r\n              this.add_indent(2,this.updates('page'))+\r\n              this.merge_all('page')+\r\n              '2,<IC\"page.scroll_lock\">Don\\'t scroll at update<br>'+\r\n              this.save_idx_promiscuous('page')+\r\n              '2,'+this.resize_thumbnails('page')+\r\n              '2,<IC\"page.hide_posts_without_images\">Hide posts without images<br>'+\r\n              '<br>'+\r\n              this.env('page.env','');},\r\n        'Thread:': function(){\r\n            return this.show_hide_all_to_header('Thread:') + '<br>'+\r\n              '&emsp;<input type=\"checkbox\" name=\"thread.embed\"> Use CatChan in thread<br>'+\r\n              this.popup('thread')+\r\n              this.expand_thumbnail_inline('thread')+\r\n              this.expand_thumbnail_hover('thread')+\r\n              this.popup_others('thread')+\r\n//              (pref.test_mode['121']? this.popupX('thread','proto.popupID.', 'Pop up ID') + this.popupX('thread','proto.popupFlag.','Pop up Flag'):'')+\r\n              this.format_posts('thread')+\r\n              this.posts_for_search('thread')+\r\n              this.add_indent(2,this.updates('thread'))+\r\n              this.merge_all('thread')+\r\n              this.t2h('thread','Num of posts to show at initial merging')+\r\n              '2,<IC\"archive.IDB.redirect_404\">Open archive from IDB if 404'+this.rollup(\r\n                '3,<IC\"archive.IDB.redirect_404_CSP\">Open blob to bypass Content Security Policy')+'<br>'+\r\n    //          '&emsp;<input type=\"checkbox\" name=\"thread.save_board_list_sel\"> Save board group index<br>'+\r\n              '2,<IC\"thread.hide_posts_without_images\">Hide posts without images<br>'+\r\n              '<br>'+\r\n              this.env('thread.env', '<br>3,<input type=\"checkbox\" name=\"thread.env.auto_update_native\"> Auto update');},\r\n        'Watcher/FC:': function(){\r\n        return 'Watcher / Floating Catalog:<br>'+\r\n          '1,<IC\"catalog.auto_watch\">Auto add to watch list'+this.rollup(\r\n            '2,<IC\"catalog.auto_watch_override\">Override default behavior by triage<br>'+\r\n            '3,<TA\"catalog.auto_watch_override_str,40,1\">')+'<br>'+\r\n          '1,Default settings:<br>'+\r\n          '2,'+ this.design_of_fc('float',3)+', max<ITB4\"headline.max_letters\">letters in headline<br>'+\r\n          (this.design_of_fc_size()? '3,'+ this.design_of_fc_size() +'<br>' : '')+\r\n          this.add_indent(2,this.updates('float'))+\r\n//          '2,<IC\"float.refresh_by_watchlist\">Refresh according to watchlist (watcher mode)<br>'+\r\n          '2,<IC\"float.hide_unwatched\">Show watched threads only (watcher mode)<br>'+\r\n          '2,<IC\"liveTag.NC\">Separated virtual board for each instance<br>'+\r\n          this.merge_list('float')+'<br>'+\r\n          '3,<IC\"headline.merge_truncated\">Truncate members in headline view<br>'+\r\n          '2,<IC\"catalog.appearance.orderOnTB\">Order selector on title bar<br>'+\r\n          '2,'+this.rollup_radio('catalog.appearance.initial.state',' :At initial, <ITBN4\"catalog.appearance.initial.width\">x<ITB4\"catalog.appearance.initial.height\">(0 means auto)', 3, '',\r\n            ['max:Maximized',\r\n             'float:Floating, left:<ITB4\"catalog.appearance.initial.left\">px, top:<ITB4\"catalog.appearance.initial.top\">px',\r\n             'top:Embed to top', 'bottom:Embed to bottom'])+'<br>'+\r\n          '2,<IC\"float.disable_kwd_filter_at_initial\">Disable keyword filter at initial<br>'+\r\n          '1,'+ this.popup3('float',2)+\r\n          '1,<IC\"float.auto_launch\">Auto start an instance at initial<br>'+\r\n          '1,<IC\"float.env.refresh_initial\">Refresh at initial<br>'+\r\n          this.add_indent(-1, this.save_idx_promiscuous('float'))+\r\n          '1,'+this.resize_thumbnails('float')+\r\n          (pref.test_mode['147']? this.add_indent(-1,this.merge_all('float')) : '')+\r\n          '<br>'+\r\n          '1,Advanced options:<br>'+\r\n          '2,<IC\"common.consolidated_watch_list\">Consolidated watch list (for watcher mode)<br>'+\r\n          '3,<IC\"common.sync_watch_list\">Sync watch list with other tabs<br>'+\r\n          '2,'+this.broadcast_triage('watch', null, ' (ignored if consolidated)')+\r\n          '2,'+this.broadcast_triage('attr')+\r\n          '2,'+this.broadcast_triage('ex', 'exclude')+\r\n//          '2,<IC\"triage.broadcast_attr\">Sync attributes list of all watcher<br>'+\r\n//          '2,<IC\"triage.broadcast_time\">Sync hide/watch time list of all watcher<br>'+\r\n          '2,<IC\"liveTag.watch_all\">Watch all boards<br>'+\r\n          '';},\r\n        'Gerenal 0': function(){\r\n            return 'General 0:<br>'+\r\n          '&emsp; Open short link<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_last50\" value=\"no\">No. Open entire thread<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_last50\" value=\"exist\">If it exists<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_last50\" value=\"exist_watch\">If it exists and all unread posts are in it<br>'+\r\n////          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_last50\" value=\"speculative\">If it is estimated to exist<br>'+\r\n////          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_last50\" value=\"spec_watch\">If it is estimated to exist and unread posts are less than 50<br>'+\r\n          '&emsp; Open the thread in<br>'+\r\n//          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_open_where_click\"> Apply to reply links in index page<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_where\" value=\"_self\">this tab<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_where\" value=\"_blank\">new tab always<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_where\" value=\"named\">named tab<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_where\" value=\"CatChan_tgt\">a fixed tab<br>'+\r\n//          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_use_named_window\"> Prevent opening a thread in multiple tabs<br>'+\r\n          '2,<IC\"pref2.meguca.historyAPI\">Use historyAPI in meguca'+\r\n          '<br>'+\r\n          '1,'+this.ta_with_help('postFilter', 'Use global post filter')+\r\n          '&emsp;Triage:<br>'+\r\n          '2,Use hover triage on and where<br>'+\r\n          this.triage_hover('catalog')+\r\n          this.triage_hover('page')+\r\n          this.triage_hover('thread')+\r\n          this.triage_hover('headline')+\r\n//          '2,Where to show:<br>'+\r\n//          '3,<span style=\"display:inline-block\">'+\r\n//            '<IR\"catalog_triage_place,topLeft\">Top left<br>'+\r\n//            '<IR\"catalog_triage_place,bottomLeft\">Bottom left'+\r\n//          '</span>'+\r\n//          '<span style=\"display:inline-block\">'+\r\n//            '<IR\"catalog_triage_place,topRight\">Top right<br>'+\r\n//            '<IR\"catalog_triage_place,bottomRight\">Bottom right'+\r\n//          '</span><br>'+\r\n          '2,<IC\"triage.popdown\">Auto pop down with delay <ITBN4\"triage.popdown_delay\">ms<br>'+\r\n          '2,<IC\"triage.hide_toggle\">Hide useless toggle buttons<br>'+\r\n          '2,Configurations of triages:<br>'+\r\n          '3,'+this.triage_config('catalog_triage_str', 'Hover', 'simple_kill,simple:simple (default),basic,basic_color,colorful,borders,toggles,samples,test')+'<br>'+\r\n//          '<!-- &emsp;<input type=\"checkbox\" name=\"catalog_enable_cross_board\"> Enable cross-board catalog<br> -->'+\r\n//          '<!-- &emsp;<input type=\"checkbox\" name=\"catalog_enable_cross_domain\"> Enable cross-domain catalog<br> -->'+\r\n//          '<!-- &emsp;&emsp; Cache working in <textarea style=\"height:1em\" cols=\"20\" name=\"catalog_sw_domain\"></textarea><br> -->'+\r\n//          '2,Load sample to hover triage:<br>'+\r\n//          '3,<BTN\"triage.sample.simple_kill\"> <BTN\"triage.sample.simple\"> <BTN\"triage.sample.basic\"> <BTN\"triage.sample.basic_color\"><br>'+\r\n//          '3,<BTN\"triage.sample.colorful\"> <BTN\"triage.sample.borders\"> <BTN\"triage.sample.toggles\"> <BTN\"triage.sample.samples\"> <BTN\"triage.sample.test\"><br>'+\r\n          '3,'+this.triage_config('triage.menu_str', 'Menu', 'menu_basic:basic (default),menu_attr:attr,menu_full:full')+'<br>'+\r\n          '3,'+this.triage_config('triage.postMenu_str', 'PostMenu', 'simple:simple (default),basic,full')+'<br>';},\r\n//          '2,z-Index: <ITB4\"triage.zIndex\"><br>';},\r\n        'General 1': function(){\r\n            return 'General 1:<br>'+\r\n          '&emsp;Click to:<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"float.click\" value=\"open\">Go to/open the thread<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"float.click\" value=\"expand\">Expand/shrink the OP in catalog<br>'+\r\n//          '&emsp;&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_expand_at_initial\"> Expand at initial<br>'+\r\n//          '&emsp;&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_expand_at_initial_embed\"> Expand at initial in index.<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_expand_with_hr\"> Insert horizontal splitter when it is expanded<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_no_popup_at_expanded\"> Don\\'t popup when the catalog is expanded<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"float.click\" value=\"none\">None<br>'+\r\n          '&emsp;Click area:<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"float.click_area\" value=\"thumbnail\">Thumbnail<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"float.click_area\" value=\"entire\">Entire thread card<br>'+\r\n//          '&emsp;<input type=\"checkbox\" name=\"float.popup2\"> Use pop-up window<br>'+\r\n//          '2,appear/disappear:<br>'+\r\n//          '3,<IR\"catalog_popdown,imm\">immediately<br>'+\r\n//          '3,<IR\"catalog_popdown,delay\">delayed: <ITB4\"catalog_popup_delay\"><ITB4\"catalog_popdown_delay\"> ms<br>'+\r\n          '1,Window handling<br>'+\r\n          '2,grab to move / select text:<br>'+\r\n          '3,<IR\"proto.popup2_sel,move\">Move always<br>'+\r\n          '3,<IR\"proto.popup2_sel,auto\">Auto, padding-x:<ITB4\"proto.popup2_sel_tolerance\"> px<br>'+\r\n          '3,<IR\"proto.popup2_sel,sel\">Select always<br>'+\r\n          '3,<IC\"catalog_popup_size_fix\">Fix size when you move it<br>'+\r\n          '2,<IC\"proto.popup2_resize\">Resize on borders of <ITB4\"proto.popup2_resize_bw\"> px<br>'+\r\n          '3,Size of corner angle: <ITB4\"proto.popup2_resize_cw\"> px<br>'+\r\n          '1,Appearance:'+this.rollup(\r\n            '2,catalog/page/thread/watcher<br>'+\r\n            '2,'+this.appearance('dummy','\" style=\"visibility:hidden')+'Shows in title bar:<br>'+\r\n            '2,'+this.appearance('titleBar.filter')+'Filter button<br>'+\r\n            '2,'+this.appearance('titleBar.settings')+'Settings button<br>'+\r\n            '2,'+this.appearance('titleBar.refresh')+'Refresh button<br>'+\r\n            '2,'+this.appearance('titleBar.boards_selector')+'Boards selector<br>'+\r\n  //          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_localtime\"> Localtime<br>'+\r\n            '2,'+this.appearance('dummy','\" style=\"visibility:hidden')+'Expands in filters panel by default<br>'+\r\n            '2,'+this.appearance('expand.kwd')+'Keyword filter<br>'+\r\n            '2,'+this.appearance('expand.time')+'Time filter<br>'+\r\n            '2,'+this.appearance('expand.tag')+'Tag filter<br>'+\r\n            '2,'+this.appearance('expand.list')+'List filter<br>'+\r\n            '2,'+this.appearance('expand.ctrl')+'Filter controls')+'<br>'+\r\n              '<br>'+\r\n              '&emsp;<input type=\"checkbox\" name=\"catalog.embed_frame\"> Embed to frame<br>'+\r\n              '&emsp;&emsp;Frame size : '+\r\n              '&emsp;&emsp;<input type=\"text\" name=\"catalog_size_frame0_width\" size=\"4\" style=\"text-align: right;\">%, '+\r\n              '&emsp;&emsp;<input type=\"text\" name=\"catalog_size_frame1_width\" size=\"4\" style=\"text-align: right;\">%<br>'+\r\n    //          '&emsp;Max threads in catalog: <input type=\"text\" name=\"catalog.max_threads\" size=\"4\" style=\"text-align: right;\"><br>'+\r\n              '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.refresh.except_bt\"> Except the page of selecting boards\\' tag.<br>'+\r\n              '&emsp;<input type=\"checkbox\" name=\"catalog.refresh.at_switch\"> Clear and refresh when boards are switched<br>'+\r\n              '&emsp;<input type=\"checkbox\" name=\"common.clear_at_manual_scan\"> Clear all threads at manual scan<br>'+\r\n              '1,'+ this.rollup_radio('common.watch_list_rm404',' :Remove 404 threads in watch list', 2, '',\r\n                ['imm:Immediately','unread:Keep them if they have unread posts<br>4,(can\\'t catch unread posts during offline)',\r\n                 'no:No, user interaction is need to remove<br>2,<IC\"archive.IDB.auto_restore_watch\">Auto restore pruned threads from IDB archive']) +'<br>'+\r\n//              '1,<IC\"common.watch_list_fromAutoKwd\">Auto keyword filter adds items to watch list<br>'+\r\n//              '1,<IC\"common.watch_list_fromTimeFilter\">Time filter adds items to watch list<br>'+\r\n              '1,'+ this.rollup_radio('liveTag.rm_404',' :Remove 404 threads', 2, '',\r\n                ['imm:Immediately','watched:Keep watched threads','unread:Keep watched threads if they have unread posts', 'no:No, keep all threads remain']) +'<br>'+\r\n              '1,<IC\"common.blur_404\">Blur 404 threads<br>'+\r\n              '&emsp;<input type=\"checkbox\" name=\"catalog.bookmark_list_rm404\"> Remove 404 threads from bookmark<br>'+\r\n              '&emsp;<input type=\"checkbox\" name=\"pref2.8chan.utilize_boards_json\"> Utilize boards.json in 8chan<br>'+\r\n              '1,<IC\"pref2.meguca.utilize_boards_json\">Utilize boardTimestamps in meguca<br>'+\r\n              '2,<IC\"pref2.meguca.utilize_boards_json_domain\">Utilize boardTimestamps at refresh in meguca<br>'+\r\n              '1,<IC\"common.consolidated_filter\">Use consolidated filter<br>';},\r\n        'Board Group': function(){return 'Board Group:<br>'+\r\n          '&emsp;configuration:<br>'+\r\n          '&emsp;&emsp;<textarea rows=\"1\" cols=\"40\" name=\"catalog_board_list_str\"></textarea><br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.board.recommendation\"> Read owner\\'s recommendation '+\r\n          '&emsp;&emsp;<BTN\"tag.recommendation_add,Add to list\"><br>'+\r\n          '2,<IC\"catalog.board.all_boards\">Add all boards group to the last<br>'+\r\n//          '&emsp;&emsp;<input type=\"button\" value=\"Scan\"> Scan board tags<br>'+\r\n//          '&emsp;&emsp;<input type=\"button\" value=\"Generate\" name=\"tag.generate\"> Generate board groups from tags <br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.board.board_tags\"> Generate board groups from tags '+\r\n          '&emsp;&emsp;<BTN\"tag.scan,Scan\"><br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.board.board_tags_same\"> Pick up boards which have the same tag'+\r\n          '&emsp;&emsp;<BTN\"tag.same_tag_refresh,Refresh\"><br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.board.ex_list\"> Use exclusive list<br>'+\r\n          '&emsp;&emsp;<textarea rows=\"1\" cols=\"40\" name=\"catalog.board.ex_list_str\"></textarea><br>'+\r\n          '1,'+this.ta_with_help('catalog.style_general_list', 'Use general style', true)+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.mimic_base_site\"> Mimic base site<br>'+\r\n////////          '&emsp;Tagging:<br>'+\r\n////////          '&emsp;&emsp;Ignore tags latter than <input type=\"text\" name=\"catalog.tag.ignore\" size=\"2\" style=\"text-align: right;\">th in a board/thread<br>'+\r\n////////          '&emsp;&emsp;Ignore boards/threads which have more than <input type=\"text\" name=\"catalog.tag.max\" size=\"2\" style=\"text-align: right;\"> tags<br>'+\r\n          '&emsp;Scan:<br>'+\r\n          '&emsp;&emsp;Max scan boards <input type=\"text\" name=\"scan.max\" size=\"6\" style=\"text-align: right;\"><br>'+\r\n          '&emsp;&emsp;Max found threads <input type=\"text\" name=\"scan.max_threads\" size=\"6\" style=\"text-align: right;\"><br>'+\r\n////////          '&emsp;&emsp;Reload older than <input type=\"text\" name=\"scan.lifetime\" size=\"6\" style=\"text-align: right;\"> minutes old<br>'+\r\n          '&emsp;&emsp;Num of crawler: <input type=\"text\" name=\"scan.crawler\" size=\"2\" style=\"text-align: right;\"><br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"scan.crawler_adaptive\"> Spawn adaptively at idle' + \r\n          '<input type=\"text\" name=\"scan.crawler_idle_time_to_spawn\" size=\"2\" style=\"text-align: right;\">ms<br>';},\r\n        'Live Tag': 'Live Tag:<br>'+\r\n          '1,From:<br>'+\r\n          '2,<IR\"liveTag.from,op\">OP<br>'+\r\n          '2,<IR\"liveTag.from,post\">All posts<br>'+\r\n          '1,<IC\"liveTag.use\">Live<br>'+\r\n//          '4,<ICBX\"stats.use\"> Take statistics<br>'+\r\n          '1,max: <ITB2\"liveTag.max\">'+\r\n          ', max string length: <ITB2\"liveTag.maxstr\"><br>'+\r\n          '1,<IC\"liveTag.ci\">Case insensitive<br>'+\r\n          '1,<IC\"liveTag.inherit_board_name\">Inherits board\\'s name as a tag<br>'+\r\n          '2,<IC\"liveTag.lock_board_name\">Lock & sticky<br>'+\r\n          '1,<IC\"liveTag.inherit_board_tags\">Inherits board\\'s tags<br>'+\r\n          '2,<IC\"liveTag.lock_board_tags\">Lock & sticky<br>'+\r\n          '1,<IC\"liveTag.lock_tags_in_op\">Lock & sticky tags in OP<br>'+\r\n          '1,<IC\"liveTag.ex_list\">Use exclusive list<br>'+\r\n          '2,String list to remove before extraction (costs much)<br>'+\r\n          '3,<textarea rows=\"1\" cols=\"40\" name=\"liveTag.rm_list_str\"></textarea><br>'+\r\n          '2,Tag list to remove after extraction (costs less)<br>'+\r\n          '3,<textarea rows=\"1\" cols=\"40\" name=\"liveTag.ex_list_str\"></textarea><br>'+\r\n          '1,Click function: tags in <br>'+\r\n          '2,boardlist / threads<br>'+\r\n          '2,<IR\"liveTag.click_func_bl,pkin\"><IR\"liveTag.click_func,pkin\">None -> Fetch/In -> None<br>'+\r\n          '2,<IR\"liveTag.click_func_bl,in\"><IR\"liveTag.click_func,in\">None -> In -> None<br>'+\r\n          '2,<IR\"liveTag.click_func_bl,inex\"><IR\"liveTag.click_func,inex\">None <-> In <-> Out <-> None (ctrl for backward)<br>'+\r\n          '2,<IR\"liveTag.click_func_bl,ex\"><IR\"liveTag.click_func,ex\">None -> Out -> None<br>'+\r\n          '1,Update intervals:<br>'+\r\n          '2,Foreground: <ITB4\"liveTag.disp_delay.fg\">ms<br>'+\r\n          '2,Background: <ITB4\"liveTag.disp_delay.bg\">ms<br>'+\r\n          '2,Lazy draw of incremental search:<br>'+\r\n          '3,every <ITB4\"liveTag.lazy_each\"> tags with <ITB4\"liveTag.lazy_delay\"> ms delay<br>',\r\n        'Statistics': function(){\r\n            return 'Statistics:<br>'+\r\n////            '&emsp;&emsp;Statistics is a subfunction of the LiveTag,<br>'+\r\n////            '&emsp;&emsp;You must activate it beforehand and RELOAD to start.<br>'+\r\n////            '&emsp;&emsp;Then, the \"Graph\" button will appear in the setting button([CC])<br>'+\r\n//////            '&emsp;&emsp;And this function uses both local and server timestamps,<br>'+\r\n//////            '&emsp;&emsp;your local clock must be accurate.<br>'+\r\n////            '<span style=\"float:left,&emsp;&emsp;<BTN\"easy.stat_activate,Activate\"></span>'+\r\n////            '<span>'+\r\n////              '&emsp;<input type=\"checkbox\" name=\"stats.use\"> Take statistics<br>'+\r\n////              '&emsp;<input type=\"checkbox\" name=\"stats.estimate_posts\"> Estimate num of posts from posts\\' No.<br>'+\r\n////            '</span>'+\r\n////            '<br>'+\r\n            '1,<IC\"stats.use\">Take statistics<br>'+\r\n            '3,<IC\"stats.estimate_posts\">Estimate num of posts from posts\\' No.<br>'+\r\n            '4,<IC\"stats.patch_tm\">Patch for thread move<br>'+\r\n            '2,Default settings:<br>'+\r\n            '3,Time unit: '+ chart_obj.time_unit_sel_html + '<br>' +\r\n            '3,' + chart_obj.chart_options_str.join('3,') +\r\n            '3,Size of window: <ITB4\"chart.window_width\"> x <ITB4\"chart.window_height\"><br>'+\r\n            '<br>'+\r\n//            '&emsp;Data of pruned threads:<br>'+\r\n//            '&emsp;&emsp;<input type=\"checkbox\" name=\"stats.retain_404\"> Retain values of pruned thread<br>'+\r\n            '2,Accumulation:<br>'+\r\n            '3,<IC\"stats.load\">Load data<br>'+\r\n            '4,<IC\"stats.save\">Save data: <ITB4\"stats.len_capture\"> points<br>'+\r\n            '4,Auto acquisition of data:<br>'+\r\n            '5,<IC\"stats.auto_acquisition_all\">All board groups which you saw once<br>'+\r\n            '5,<IC\"stats.auto_acquisition\">Board groups with \\'!stats\\'<br>'+\r\n            '6,<IC\"stats.auto_acquisition_scan\">Scan all targets at startup with '+\r\n            '<ITB2\"stats.auto_acquisition_scan_delay\"> secs delay<br>'+\r\n            '5,(Targets are colored <span style=\"background:#b5fbda\">green</span> in board selector)<br>'+\r\n            '<br>'+\r\n            '2,<IC\"chart.instant_scan\">Instant scan at switching board group<br>'+\r\n            '2,Delay to draw: <ITB2\"stats.draw_delay\"> sec.<br>'+\r\n            '2,<IC\"chart.off_anime_blur\">Off animation in background<br>'+\r\n            '2,<IC\"stats.tolerant\">Tolerant of inaccuracy of server and local clocks<br>'+\r\n            '5,up to <input type=\"text\" name=\"stats.tolerance\" size=\"2\" style=\"text-align: right;\"> min<br>'+\r\n            '';\r\n          },\r\n//        function(){return 'Design of Floating Catalog:<br>'+\r\n////          '<input type=\"radio\" name=\"catalog.text_mode.mode\" value=\"graphic\"> Graphical mode: '+\r\n////          '<input type=\"text\" name=\"catalog_size_width\" size=\"4\" style=\"text-align: right;\"> x '+\r\n////          '<input type=\"text\" name=\"catalog_size_height\" size=\"4\" style=\"text-align: right;\"><br>'+\r\n////          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.format.thumb.resize\">Resize thumbnails in embed catalog<br>'+\r\n////          '&emsp;&emsp;<input type=\"checkbox\" name=\"page.format.thumb.resize\">Resize thumbnails in embed page<br>'+\r\n////          '&emsp;&emsp;<input type=\"checkbox\" name=\"float.format.thumb.resize\">Resize thumbnails in float catalog<br>'+\r\n////          '&emsp;&emsp;&emsp;1st thumbnail: '+\r\n////          '<input type=\"text\" name=\"catalog_size_tn1_width\" size=\"4\" style=\"text-align: right;\"> x '+\r\n////          '<input type=\"text\" name=\"catalog_size_tn1_height\" size=\"4\" style=\"text-align: right;\"><br>'+\r\n////          '&emsp;&emsp;&emsp;2nd and later: '+\r\n////          '<input type=\"text\" name=\"catalog_size_tn2_width\" size=\"4\" style=\"text-align: right;\"> x '+\r\n////          '<input type=\"text\" name=\"catalog_size_tn2_height\" size=\"4\" style=\"text-align: right;\"><br>'+\r\n//          '&emsp;Catalog/Pop-up/Search<br>'+\r\n//          '<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"float.format.show.images_2nd\">'+\r\n//          '<input type=\"checkbox\" name=\"float.format.hover.images_2nd\">'+\r\n//          '<input type=\"checkbox\" name=\"float.format.search.images_2nd\"> 2nd or more images in OP<br> -->'+\r\n//          '&emsp;&emsp;<input type=\"checkbox\" name=\"float.format.show.posts\">'+\r\n//          '<input type=\"checkbox\" name=\"float.format.hover.posts\">'+\r\n//          '<input type=\"checkbox\" name=\"float.format.search.posts\"> Posts<br>'+\r\n//          '&emsp;&emsp;<input type=\"checkbox\" name=\"float.format.show.fileinfo\">'+\r\n//          '<input type=\"checkbox\" name=\"float.format.hover.fileinfo\">'+\r\n//          '<input type=\"checkbox\" name=\"float.format.search.fileinfo\"> File information<br>'+\r\n//          '<!--&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_checkbox_deletion_show\">'+\r\n//          '<input type=\"checkbox\" name=\"catalog_checkbox_deletion_hover\">'+\r\n//          '<input type=\"checkbox\" name=\"catalog_checkbox_deletion_search\"> Checkbox for deletion<br> -->'+\r\n//          '&emsp;&emsp;<input type=\"checkbox\" name=\"float.format.show.contents\">'+\r\n//          '<input type=\"checkbox\" name=\"float.format.hover.contents\">'+\r\n//          '<input type=\"checkbox\" name=\"float.format.search.contents\"> Format contents<br>'+\r\n//          '&emsp;&emsp;<input type=\"checkbox\" name=\"float.format.show.layout\">'+\r\n//          '<input type=\"checkbox\" name=\"float.format.hover.layout\">'+\r\n//          '<input type=\"checkbox\" name=\"float.format.search.layout\"> Format layout<br>'+\r\n//          '&emsp;&emsp;<input type=\"checkbox\" name=\"float.format.show.style\">'+\r\n//          '<input type=\"checkbox\" name=\"float.format.hover.style\">'+\r\n//          '<input type=\"checkbox\" name=\"float.format.search.style\"> Format style<br>'+\r\n//          '<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"catalog_border_show\">&emsp;&emsp;&emsp; Show border<br> -->'+\r\n//          '<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"catalog_enable_background\">&emsp;&emsp;&emsp; Use backgfound color<br> -->'+\r\n//          '&emsp;Num of posts in thread headline: <input type=\"text\" name=\"float.t2h_num_of_posts\" size=\"3\" style=\"text-align: right;\"><br>'+\r\n////          '<input type=\"radio\" name=\"catalog.text_mode.mode\" value=\"text\"> Text mode: '+\r\n////          '<input type=\"text\" name=\"catalog_size_text_width\" size=\"4\" style=\"text-align: right;\"> x '+\r\n////          '<input type=\"text\" name=\"catalog_size_text_height\" size=\"4\" style=\"text-align: right;\"><br>'+\r\n////          '&emsp;<input type=\"checkbox\" name=\"catalog.text_mode.sub\"> Show title<br>'+\r\n////          '&emsp;<input type=\"checkbox\" name=\"catalog.text_mode.name\"> Show op\\'s name<br>'+\r\n////          '&emsp;<input type=\"checkbox\" name=\"catalog.text_mode.com\"> Show op\\'s comment<br>';\r\n//          ''},\r\n        'Footer': function(){return 'Footer:<br>'+this.footer('catalog');},\r\n        'Footer for watcher': function(){return 'Footer for watcher:<br>'+this.footer('float');},\r\n        'ThreadReader': function(){return 'ThreadReader:<br>'+\r\n//          '&emsp;<input type=\"checkbox\" name=\"catalog.order.find_sage_in_8chan\"> Find sage post in native catalog in 8chan<br>'+\r\n          '1,<IC\"thread_reader.unmark_on_hover\">Unmark post on hover<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"thread_reader.use\"> Thread reader<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"thread_reader.own_posts_tracker\"> Own posts tracker<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;>> (You)<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;<input type=\"radio\" name=\"thread_reader.show_reply_to_me_by\" value=\"anchor\"> anchor text<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;<input type=\"radio\" name=\"thread_reader.show_reply_to_me_by\" value=\"plain\"> plain text (for dollchan)<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;(You) in name field<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;<input type=\"radio\" name=\"thread_reader.show_own_post_by\" value=\"anchor\"> name string<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;<input type=\"radio\" name=\"thread_reader.show_own_post_by\" value=\"plain\"> plain text<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"thread_reader.clean_up_own_posts\"> Clean up localStorage at loading embed native catalog<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"thread_reader.sync\"> Sync with parent catalog<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"thread_reader.triage\"> Show triage to parent catalog<br>'+\r\n//          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"thread_reader.triage_close\"> Close window when triage is clicked<br>'+\r\n          '2,<IC\"IDinfo.use\">ID counters'+this.rollup(\r\n          '4,<IC\"IDinfo.auto\">Auto off when OP doesn\\'t have ID or flag')+'<br>'+\r\n          this.IDinfo('ID',true)+\r\n          this.IDinfo('ID2',true)+\r\n          this.IDinfo('flag',false,'ID','nof flagged IDs')+\r\n          this.IDinfo('name',false,'trip','nof named trips')+\r\n          this.IDinfo('trip',false,'name','nof tripped names');},\r\n//          '3,<IC\"IDinfo.ID\">nth/all by each ID<br>'+\r\n//          '4,<IC\"IDinfo.nofIDs\">nth/all/nof IDs at that time<br>'+\r\n//          '4,<IC\"IDinfo.IDop\">Add \\'OP\\'<br>'+\r\n//          '3,<IC\"IDinfo.ID2\">nth/all by each ID2<br>'+\r\n//          '4,<IC\"IDinfo.nofID2s\">nth/all/nof ID2s at that time<br>'+\r\n//          '4,<IC\"IDinfo.ID2op\">Add \\'OP\\'<br>'+\r\n//          '3,<IC\"IDinfo.flag\">nth/all by each flag<br>'+\r\n//          '4,<IC\"IDinfo.flagID\">nth/all/nof IDs of the same flag<br>'+\r\n//          '4,<IC\"IDinfo.nofFlags\">nth/all(/nofIDs)/nof flags at that time<br>'+\r\n//          '3,<IC\"IDinfo.name\">nth/all by each name<br>'+\r\n//          '4,<IC\"IDinfo.nameTrip\">nth/all/nof trips of the same name<br>'+\r\n//          '4,<IC\"IDinfo.nofNames\">nth/all(/namedTrip)/nof names at that time<br>'+\r\n//          '3,<IC\"IDinfo.trip\">nth/all by each trip<br>'+\r\n//          '4,<IC\"IDinfo.tripName\">nth/all/nof names of the same trip<br>'+\r\n//          '4,<IC\"IDinfo.nofTrips\">nth/all(/trippedName)/nof trips at that time<br>';},\r\n        'Notifiers': function(){return 'Notifiers:<br>'+\r\n            '1,<IC\"notify.desktop.notify\">Desktop Notification'+ this.notify_init('desktop')+\r\n            '3,<ITB3\"notify.desktop.lifetime\"> secs (0 means permanent)<br>'+\r\n            '3,max: <ITB3\"notify.desktop.limit\">, '+\r\n              'delay: <ITB3\"notify.desktop.delay\">ms<br>'+\r\n            '3,<IC\"notify.desktop.show_last\">Show the last post only<br>'+\r\n            this.notify_tgts('desktop')+\r\n            '1,<IC\"notify.favicon\">Favicon<br>'+\r\n            '1,<IC\"notify.title.notify\">Show number of unread replies in title<br>'+\r\n            '2,<IC\"notify.title.hide_zero\">Hide unread count in title bar when it is zero<br>'+\r\n            '1,<IC\"notify.sound.notify\">Sound&emsp;&emsp;<BTN\"notify.sound.pause,Pause\">'+ this.notify_init('sound')+\r\n            '3,<IR\"notify.sound.src,beep\">Beep '+\r\n              '&emsp;freq:<ITB4\"notify.sound.beep_freq\"> '+\r\n              'length:<ITB4\"notify.sound.beep_length_f\"> '+\r\n              'volume:<ITB4\"notify.sound.beep_volume_f\"><br>'+\r\n            '3,<IR\"notify.sound.src,file\">File '+\r\n            '&emsp;<input type=\"file\" accept=\"audio/*\" name=\"notify.sound.file\"><br>'+\r\n            this.notify_tgts('sound');\r\n          },\r\n        'JSON Archiver: Store': function(){\r\n            archiver.event_funcs['queryQuota']();\r\n            return 'JSON Archiver: Store<br>'+\r\n//            '1,Store:<br>'+\r\n            '<br>'+\r\n            '1,1. Make sure DOWNLOAD DIRECTORY to be set correctly.'+this.rollup(\r\n              '3,All files will be into the directory.<br>'+\r\n              '3,And also, make sure each download doesn\\'t ask you anything.<br>'+\r\n              '3,So many files will be downloaded.<br>'+\r\n              '2,<IC\"archive.editing_timeout\">Timeout for editing posts (patch for meguca)') +'<br>'+\r\n            '1,2. Select sources for each target:<br>'+\r\n            '2,File: Manual/Auto<br>'+\r\n            '3,<IC\"archive.oneshot.post\"><IC\"archive.live.post\">Posts<br>'+\r\n            '3,<IC\"archive.oneshot.tn\"><IC\"archive.live.tn\">Thumbnails<br>'+\r\n            '3,<IC\"archive.oneshot.img\"><IC\"archive.live.img\">Images (original size)<br>'+\r\n            '3,<IC\"archive.oneshot.webm\"><IC\"archive.live.webm\">Webms<br>'+\r\n            '2,IndexedDB:'+this.rollup(\r\n              '4,<IC\"archive.IDB.auto_clean\">Automatic clean up<br>'+\r\n              '4,<IC\"archive.IDB.auto_clean_init\">Automatic clean up at start up<br>'+\r\n              '4,Delayed pruning: <ITB3\"archive.IDB.prune\"> hours<br>'+\r\n              '5,<IC\"archive.IDB.prune_flush\">Archive to file at pruning<br>'+\r\n              '4,num of transactions: <ITB3\"archive.IDB.nof_tr\"><br>'+\r\n              '4,num of requests in a cluster: <ITB3\"archive.IDB.nof_cl\"> - <ITB3\"archive.IDB.nof_cl_max\"><br>'+\r\n              '4,watchdog timer: <ITB3\"archive.IDB.watchdog\">s')+'<br>'+\r\n            '4,used / limit: <span name=\"SHOW_QUOTA\"></span><button type=\"button\" name=\"archive.queryQuota\"><img src=\"' + cnst.icons.refresh + '\" style=\"width:1em;height:1em\"></button><br>'+\r\n            '3,Manual/Auto<br>'+\r\n            '3,<IC\"archive.oneshot.post_idb\"><IC\"archive.live.post_idb\">Posts<br>'+\r\n            '3,<IC\"archive.oneshot.tn_idb\"><IC\"archive.live.tn_idb\">Thumbnails<br>'+\r\n            '3,<IC\"archive.oneshot.img_idb\"><IC\"archive.live.img_idb\">Images (original size)<br>'+\r\n            '3,<IC\"archive.oneshot.webm_idb\"><IC\"archive.live.webm_idb\">Webms<br>'+\r\n//            '2,3. Select files which will be skipped downloading<br>'+\r\n//            '3,Downloaded files: <IF\"archive.dir_dled\" multiple directory><br>'+\r\n            '1,3. <IC\"archive.list_inherit\">Inherit previous archiving list (for 4d,e)<br>'+\r\n            '1,4a. <IC\"archive.store_watched\">Auto archiving for watched threads<br>'+\r\n            '1,4b. <IC\"archive.store_auto\">Auto archiving if OP matches:<br>'+\r\n            '2,Keyword: <input type=\"text\" name=\"archive.kwd.str\" size=\"25\">'+\r\n            this.make_sel('archive.kwd.match', ['match all','match any','unmatch all','unmatch any'])+ '<br>'+\r\n            '3,<ICN\"archive.kwd.sub\">Subject '+\r\n            '<ICN\"archive.kwd.name\">Name '+\r\n            '<ICN\"archive.kwd.com\">Comment <br>'+\r\n            '3,<ICN\"archive.kwd.ci\">CI'+\r\n            ' <ICN\"archive.kwd.sentence\">Sentence'+\r\n            ' <ICN\"archive.kwd.re\">RE<br>'+\r\n            '1,4c. <IC\"archive.list\">List picker<br>'+\r\n            '2,<textarea rows=\"1\" cols=\"40\" name=\"archive.list_str\" placeholder=\"lain  // whole lainchan\\n/tech/  // whole /tech/\\n/q/1234  // thread /q/1234\"></textarea><br>'+\r\n            '1,4d. <BTN\"archive.oneshot,OneShotArchive\"> or <BTN\"archive.start,StartArchiving\"><br>'+\r\n            '3,<IR\"archive.src,shown\"> All shown threads<br>'+\r\n            '3,<IR\"archive.src,watched\"> All watched threads<br>'+\r\n            '3,<IR\"archive.src,stored\"> All stored threads<br>'+\r\n//            '3,<IR\"archive.src\"\"scanned\"> All scanned threads for automatic archiving<br>'+\r\n            '1,4e. You can select target threads individually using triage<br>';},\r\n        'JSON Archiver: Restore': function(){\r\n            if (pref.archive.files_sel===2) archiver.event_funcs['queryList']();\r\n            return 'JSON Archiver: Restore<br>'+\r\n//            '1,Restore:<br>'+\r\n            '<br>'+\r\n            '1,1. Open a live catalog, index page or thread to be overriden.<br>'+\r\n            '2,CatChan must be working in it.<br>'+\r\n            '1,2. Select where to extract<br>'+\r\n            '2,<IR\"archive.format,auto\">Select from filename: Domain-Board-No_Sub.json<br>'+\r\n            '2,<IR\"archive.format,manual\">Set manually: '+ this.make_sel('archive.domain',site0.domains) + '/<ITB5\"archive.board\">/No.<br>'+\r\n            '1,3a. <IC\"archive.IDB.auto_restore\">Automatic restore from IndexedDB<br>'+\r\n            '3,<IC\"archive.IDB.auto_restore_remove\">Remove deleted thread from display<br>'+\r\n            '1,3b. Select source from: '+ this.make_sel('archive.files_sel',['Dir','Files','IndexedDB'])+ '<br>'+\r\n            '<span name=\"FILES_ARCHIVE0\"' +((pref.archive.files_sel===0)? '' : ' style=\"display:none\"') +'>'+\r\n              '&emsp;&emsp;<span><IF\"archive.dir\" multiple webkitdirectory directory><BTN\"archive.files_clear,X\"></span><br>'+\r\n            '</span>'+\r\n            '<span name=\"FILES_ARCHIVE1\"' +((pref.archive.files_sel===1)? '' : ' style=\"display:none\"') +'>'+\r\n              '&emsp;&emsp;JSONs/HTMLs: <IF\"archive.jsons\" multiple accept=\".html,.json,text/*\"><br>'+\r\n              '2,<IC\"archive.load_img\">Images: <IF\"archive.imgs\" multiple webkitdirectory directory><br>'+\r\n            '</span>'+\r\n            '<span name=\"FILES_ARCHIVE2\"' +((pref.archive.files_sel===2)? '' : ' style=\"display:none\"') +'>'+\r\n              '&emsp;&emsp;<span><select name=\"archive.IDB_board_sel\"' + ((pref.archive.IDB_select_multiple)? ' multiple':'') + ' style=\"float:none\"></select>'+\r\n              '<select name=\"archive.IDB_thread_sel\" style=\"float:none' + ((pref4.archive.IDB_thread_sel_options)? '\"' : ';display:none\"')\r\n                                                      + ((pref.archive.IDB_select_multiple)? ' multiple':'') +'></select></span>'+\r\n                this.rollup('&emsp;&emsp;<IC\"archive.IDB_select_multiple\">Multiple select<br>'+\r\n                                  '&emsp;&emsp;Export selected &emsp;&emsp;&emsp;&emsp;<BTN\"archive.IDB.export_thread,Threads\"><br>'+\r\n                                  '&emsp;&emsp;Reset archived time of selected <BTN\"archive.IDB.reset_time,Threads\">')+\r\n                this.rollup('&emsp;&emsp;Delete selected <BTN\"archive.IDB.delete_board,Boards\"><BTN\"archive.IDB.delete_thread,Threads\"><BTN\"archive.IDB.delete_imgs,Images\">')+'<br>'+\r\n            '</span>'+\r\n            '&emsp;&emsp;<BTN\"archive.restore_button,Restore\"> <IC\"archive.restore_auto\">Auto restore after selection<br>'+\r\n            '3,<IC\"archive.clear_threads\">Clear all threads at opening an archive<br>'+\r\n            '3,<IC\"archive.fix_inconsistency\">Fix inconsistencies at open<br>';\r\n            '3,<IC\"archive.open_local\">Open remote archive in local environment<br>';\r\n//            '1,5. <BTN\"archive.clear_files_button,Clear Files\"> <ICBX\"archive.clear_files\"> Auto clear after open<br>';\r\n          },\r\n        'UIP tracker for 4chan': 'UIP tracker for 4chan:<br>'+\r\n          '1,<IC\"uip_tracker.on\">Show num of unique IPs after post No.<br>'+\r\n          '3, Check interval: <ITB3\"uip_tracker.interval\">sec, <IC\"uip_tracker.adaptive\">Adaptive<br>'+\r\n          '3, Style of changes: <ITBL30\"uip_tracker.highlight_str\"><br>'+\r\n          '2,<IC\"uip_tracker.posts\">Show num of posts<br>'+\r\n          '2,<IC\"uip_tracker.deletion.show\">Show deleted posts\\' No.<br>'+\r\n          '3,<IC\"uip_tracker.deletion.link\">as links<br>'+\r\n          '2, Apply style to deleted post:<br>'+\r\n          '3,<IC\"uip_tracker.deletion.name\">Add style to name: <ITBL30\"uip_tracker.deletion.name_str\"><br>'+\r\n          '3,<IC\"uip_tracker.deletion.addName\">Add <ITBL30\"uip_tracker.deletion.addName_str\"> to name<br>'+\r\n          '3,<IC\"uip_tracker.deletion.post\">Add style to post: <ITBL30\"uip_tracker.deletion.post_str\"><br>'+\r\n          '2,<IC\"uip_tracker.annotate\">Annotate history of UIP from catalog<br>'+\r\n          '2,<IC\"uip_tracker.auto_open\">Open next thread automatically<br>'+\r\n          '3,Conditions:<br>'+\r\n          '4,After <input type=\"text\" name=\"uip_tracker.auto_open_th\" size=\"3\" style=\"text-align: right;\">th post<br>'+\r\n          '4,OP contains <textarea style=\"height:1em\" cols=\"20\" name=\"uip_tracker.auto_open_kwd\"></textarea><br>'+\r\n          '2,<IC\"uip_tracker.sage.detect\">Sage detection, tolerance: <ITB2\"uip_tracker.sage.tolerance\"> sec<br>'+\r\n          '3,<IC\"uip_tracker.sage.name\">Add style to name: <ITBL30\"uip_tracker.sage.name_str\"><br>'+\r\n          '3,<IC\"uip_tracker.sage.addName\">Add <ITBL30\"uip_tracker.sage.addName_str\"> to name<br>'+\r\n          '3,<IC\"uip_tracker.sage.post\">Add style to post: <ITBL30\"uip_tracker.sage.post_str\"><br>'+\r\n          '3,Bug patch for corrupted data<br>'+\r\n          '4,<IC\"uip_tracker.sage.patch_bug3\">Ignore corrupted data at head by history<br>'+\r\n          '4,<IC\"uip_tracker.sage.patch_bug4\">Recover by page history<br>'+\r\n          '4,<IC\"uip_tracker.sage.patch_bug5\">Cease detection at encountering obsolete data<br>'+\r\n          '4,<IC\"uip_tracker.sage.patch_bug2\">Loose detection, to <ITB2\"uip_tracker.sage.patch_bug2nth\">th thread<br>'+\r\n          '4,<IC\"uip_tracker.sage.patch_bug\">Re-evaluate and recover<br>'+\r\n          '3,<IC\"uip_tracker.sage.page\">Annotate page history<br>'+\r\n          '3,<IC\"uip_tracker.sage.annotate\">Annotate sage from catalog<br>'+\r\n          '4,<IC\"uip_tracker.sage.annotate_page\">Annotate page history from catalog<br>',\r\n        'Command Line Interface': 'Command interface for overwriting preference<br>'+\r\n          '&emsp;<textarea style=\"height:1em\" cols=\"40\" name=\"cli.json_str\"></textarea><br>'+\r\n          '1,<BTN\"CLIe.ex,extract\"><BTN\"CLIe.full,extract_full\"><BTN\"CLIe.filter,extract_current_filter\"><br>'+\r\n          '1,<BTN\"CLI.query\"><BTN\"CLI.query_default\"><BTN\"CLI.query_boards\"><br><br>'+\r\n          '1,<BTN\"CLI.apply\"><span name=\"JSON_result\"></span><br>'+\r\n          '1,<IC\"cli.auto\">auto apply at startup<br><br><br>'+\r\n          '&emsp;<textarea style=\"height:1em\" cols=\"40\" name=\"cli.eval_str\"></textarea><br>'+\r\n          '1,<BTN\"EVAL,EVAL\"><br>',\r\n//          '5',\r\n        'Networking': function(){\r\n            return 'Networking:<br>'+\r\n          '1,Timeout: <ITB3\"network.timeout\"> sec.<br>'+\r\n          '&emsp;Cross domain connection:<br>'+\r\n          this.radios('network.cross_domain',2, ['direct: Direct connection',\r\n          'indirect: Indirect connection<br>'+\r\n            '3,<IC\"network.overXFO\">Over X-Frame-Options<br>'+\r\n            '3,<IC\"network.overCSPF\">Over Content Security Policy frame',\r\n          'GM: GreaseMonkey\\'s extension'])+ '<br>'+\r\n//          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_fake_access\"> Fake access made by human to avoid poor administration<br>'+\r\n//          '&emsp;&emsp;&emsp;(This causes heavier network traffic and server load,<br>'+\r\n//          '&emsp;&emsp;&emsp;but administrators can\\'t see what script you are using)<br>'+\r\n//          '&emsp;Configuration:<br>'+\r\n//          '&emsp;&emsp;(To get faster feeling, you should check them all.)<br>'+\r\n          '&emsp;Data source:<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog.design\" value=\"page\">Page<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog.design\" value=\"auto\">Auto<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog.design\" value=\"catalog\">Catalog<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.catalog_json\"> From json file<br>'+\r\n          '1,Lazy load/draw<br>'+\r\n          '2,Catalog/IndexPage/Float <br>'+\r\n          '3,<IC\"catalog.lazyDraw.merge\" style=\"visibility:hidden\"><IC\"page.lazyDraw.merge\">'+\r\n            '<IC\"float.lazyDraw.merge\" style=\"visibility:hidden\">Lazy draw each <ITB3\"proto.lazyDraw.merge_step\">posts<br>'+\r\n          '3,<IC\"catalog.draw_on_demand\"><IC\"page.draw_on_demand\"><IC\"float.draw_on_demand\">Lazy draw each <ITB3\"proto.lazyDraw.step\">threads<br>'+\r\n          '3,<IC\"catalog.load_on_demand\"><IC\"page.load_on_demand\"><IC\"float.load_on_demand\">Lazy load HTMLs/JSONs<br>'+\r\n          '2,<input type=\"checkbox\" name=\"network.adaptive\"> Adaptive<br>'+\r\n          '3,100%: new <input type=\"text\" name=\"network.th100\" size=\"3\" style=\"text-align: right;\"> threads, '+\r\n          '<input type=\"text\" name=\"network.th100_delay\" size=\"4\" style=\"text-align: right;\"> ms delay<br>'+\r\n          '3,20%: new <input type=\"text\" name=\"network.th20\" size=\"3\" style=\"text-align: right;\"> threads, '+\r\n          '<input type=\"text\" name=\"network.th20_delay\" size=\"4\" style=\"text-align: right;\"> ms delay<br>'+\r\n          '1,<IC\"catalog_auto_update_countdown\">Show countdown to auto update<br>'+\r\n          '1,<IC\"healthIndicator.show\">Health indicator, history: <ITB3\"healthIndicator.max\"><br>'+\r\n          '2,<IC\"healthIndicator.expand_running\">Show details of running indicators<br>'+\r\n          '2,<IC\"healthIndicator.dont_retire_running\">Don\\'t retire running indicators<br>'+\r\n          '2,<IC\"healthIndicator.cancel\">Cancel scan when it is clicked<br>'+\r\n          '1,<IC\"network.fetch_actively\">Fetch missing info actively<br>';},\r\n        'General 2': 'General 2:<br>'+\r\n          '&emsp;Localtime offset<input type=\"text\" name=\"localtime_offset\" size=\"2\" style=\"text-align: right;\"><br>'+\r\n          'Share loaded html with other tabs to update<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"info_server\"> Broadcast loaded html to other tabs (server)<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"info_client\"> Listen other tab\\'s broadcasting (client)<br>'+\r\n          'Cloudflare<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"cloudflare.auto_reload\"> Auto reload at server error<br>'+\r\n          '&emsp;&emsp;<input type=\"text\" name=\"cloudflare.auto_reload_time\" size=\"2\" style=\"text-align: right;\"> minutes after<br>'+\r\n          '<br>'+\r\n          '<input type=\"checkbox\" name=\"tooltips.info.show\"> Show infotips<br>'+\r\n          '&emsp;pop up delay: <input type=\"text\" name=\"tooltips.info.popup_delay\" size=\"4\" style=\"text-align: right;\"> ms<br>'+\r\n          '&emsp;pop down delay: <input type=\"text\" name=\"tooltips.info.popdown_delay\" size=\"4\" style=\"text-align: right;\"> ms<br>'+\r\n          '<input type=\"checkbox\" name=\"tooltips.help.show\"> Show tooltips<br>'+\r\n          '&emsp;pop up delay: <input type=\"text\" name=\"tooltips.help.popup_delay\" size=\"4\" style=\"text-align: right;\"> ms<br>'+\r\n          '&emsp;pop down delay: <input type=\"text\" name=\"tooltips.help.popdown_delay\" size=\"4\" style=\"text-align: right;\"> ms<br>'+\r\n          'Z-Index of tooptips: <ITB4\"tooltips.zIndex\"><br>'+\r\n          'Misc.<br>'+\r\n          '<input type=\"checkbox\" name=\"recovery.comment\"> Recover comment when browser was crashed<br>'+\r\n          '<input type=\"checkbox\" name=\"catalog_footer_ignore_my_own_posts\"> Ignore my own posts at counting unread posts<br>'+\r\n          '<input type=\"checkbox\" name=\"pref2.KC.summer_time\"> Summer time in KC<br>'+\r\n          '<br>'+\r\n          'Patches<br>'+\r\n          '<input type=\"checkbox\" name=\"patch.delayed_invoke.use\"> Delayed invoke for 4chan, '+\r\n          '<input type=\"text\" name=\"patch.delayed_invoke.sec\" size=\"2\" style=\"text-align: right;\">sec.<br>'+\r\n//          '<input type=\"checkbox\" name=\"pref2.meguca.remove_history_class\"> Remove history class in meguca'+\r\n          '',\r\n        'Styles': function(){\r\n        return 'Styles:<br>'+\r\n          '1,<IC\"style.addSS.use\">Additional StyleSheets, URLs are below<br>'+\r\n          '2,<TA\"style.addSS.str,40,1\"><br>'+\r\n          '1,Windows and popups:<br>'+\r\n          '2,Z-Index: <ITB4\"style.zIndex\"><br>'+\r\n          '2,<IR\"style.sel,fix\"> Fixed <BTN\"style.reset.fix,reset\"><br>'+\r\n          '3,Title bar:<ITBL30\"style.fix.titleBar_str\"><br>'+\r\n          '3,Window:<ITBL30\"style.fix.window_str\"><br>'+\r\n          '3,Pop up:<ITBL30\"style.fix.popUp_str\"><br>'+\r\n          '2,<IR\"style.sel,copy\"> Copy from CSS <BTN\"style.reset.copy,reset\"><br>'+\r\n          '3,Title bar:<ITBL30\"style.copy.titleBar_str\"><br>'+\r\n          '3,Window:<ITBL30\"style.copy.window_str\"><br>'+\r\n          '3,Pop up:<ITBL30\"style.copy.popUp_str\"><br>'+\r\n          '1,Others:<br>'+\r\n          '2,New post:<ITBL30\"style.post_new\"><br>'+\r\n          '2,Editing post:<ITBL30\"style.post_editing\"><br>'+\r\n          this.userCSS(1);},\r\n        'Features': function(){\r\n        return 'Features:<br>'+\r\n          '1,<IC\"features.page\">Page<br>'+\r\n          '1,<IC\"features.graph\">Graph<br>'+\r\n//          '1,<ICBX\"features.setting\"> Setting<br>'+\r\n          '1,<IC\"features.setting2\">Setting2<br>'+\r\n          '1,<IC\"features.postform\">Postform<br>'+\r\n          '1,<IC\"features.catalog\">Catalog<br>'+\r\n          '1,<IC\"features.listener\">Listener<br>'+\r\n          '1,<IC\"features.uip_tracker\">UIP_tracker<br>'+\r\n          '1,<IC\"features.thread_reader\">Thread Reader<br>'+\r\n          '1,<IC\"features.recovery\">Recovery comment<br>'+\r\n//          '<input type=\"checkbox\" name=\"features.debug\"> Debug<br>'+\r\n          'Notifications:<br>'+\r\n          '1,<IC\"features.notify.desktop\">DesktopNotification<br>'+\r\n          '1,<IC\"features.notify.sound\">Sound<br>'+\r\n          '1,<IC\"features.notify.favicon\">Favicon<br>'+\r\n          'Sites:<br>'+\r\n          this.features_domains();},\r\n        'About': function(){\r\n        return 'CatChan<br>'+\r\n          'Version 2021.07.18.4<br>'+\r\n          '<a href=\"https://github.com/DogMan8/CatChan\">GitHub</a><br>'+\r\n          '<a href=\"https://github.com/DogMan8/CatChan/raw/master/CatChan.user.js\">Get stable release</a><br>'+\r\n          '<a href=\"https://github.com/DogMan8/CatChan/raw/develop/CatChan.user.js\">Get BETA release</a><br>'+\r\n          '<br><br>'+\r\n          'Debug mode<br>'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.0\">'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.1\">'+\r\n          '<ITB12\"debug_mode.unread_count\">'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.2\">'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.3\">'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.4\">&emsp;'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.5\">'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.parse_error\">'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.7\">'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.8\"><br>'+\r\n          '<ITB20\"debug_mode.site2func\" placeholder=\"catalog_json2html3\"><BTN\"Debug.site2func,dump_site2\"><IC\"debug_mode.site2func_expand\">func<br>'+\r\n          '<ITB15\"debug_mode.pfunc\" placeholder=\"4chan:catalog_json\"><BTN\"debug_mode.pfunc,dump_parse_funcs\"><IC\"debug_mode.pfunc_expand\">func<br>'+\r\n          '<ITB15\"debug_mode.pfunc_comp\" placeholder=\"4chan:catalog_json\"><BTN\"debug_mode.pfunc_comp,compare_parse_funcs\">'+\r\n            '<IC\"debug_mode.pfunc_comp_expand_same\"><IC\"debug_mode.pfunc_comp_expand_diff\">func <br>'+\r\n          '<ITBL60\"debug_mode.pfunc_comp_proto\" placeholder=\"temporal prototype dictionary in JSON format, {&quot;BBC.page_html_template&quot;:&quot;RSS.page_html_template&quot;}\"><br>'+\r\n          '<ITB15\"debug_mode.pfunc_all\" placeholder=\"op_img_url\"><BTN\"debug_mode.pfunc_all,find_parse_funcs\"><IC\"debug_mode.pfunc_all_expand\">func'+this.rollup(\r\n            '<div style=\"float:left\">' + site0.debug_domains.map(function(v){return '<IC\"debug_mode.domains.'+v+'\">'+v;}).join('<br>')+'</div>'+\r\n            '<div style=\"float:left\">' + site0.debug_types.map(function(v){return '<IC\"debug_mode.types.'+v+'\">'+v;}).join('<br>')+'</div>'+\r\n            '<div style=\"clear:both\"></div>')+'<br>'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.9\"><br>'+\r\n          this.cb_block('debug_mode',10)+\r\n          '<BTN\"debugWindow,debugWindow\"><br>'+\r\n          'Test mode'+this.rollup(this.cb_block('test_mode',0,100))+this.rollup(this.cb_block('test_mode',100)+\r\n          (Debug? ' LastReloaded: '+new Date(Debug.lastReloaded).toLocaleString():'')+'<br>'+\r\n          '<IC\"test_mode.tips\">'+\r\n          '<ITB6\"test_mode.num\">'+\r\n          '<ITBL30\"test_mode.test_str\">'+\r\n          '<ITB6\"test_mode.num_f\">'+\r\n          '&emsp;<BTN\"button_test,test\"><br>'+\r\n          '1,<BTN\"load_samples,setting_samples\"><br>'+\r\n          '<IF\"test_mode.js_file\" accept=\".js,text/*\"><BTN\"test_mode.js_load,JS_load\">')+'<br>';}\r\n      },\r\n        html_common:\r\n          '<span name=\"reload_recommended\" style=\"display:none;background:yellow\">&emsp;&emsp;RELOAD IS REQUIRED TO GET LIGHT FEELING&emsp;&emsp;<br></span>'+\r\n          '<span name=\"reload_required\" style=\"display:none;background:red;color:white\">&emsp;&emsp;RELOAD IS REQUIRED&emsp;&emsp;</span>'+\r\n          '<br><BTN\"close,close\">'+\r\n          '&emsp;<BTN\"save,save\">'+\r\n          '<BTN\"load_default,load_default\">'+\r\n          '<BTN\"load_default_of_this_page,load_default_of_this_page\">',\r\n//        onchange_event : function(){\r\n//          pref_func.apply_prep(this,true);\r\n//          if (pref_func.settings.onchange_funcs[this.name]) pref_func.settings.onchange_funcs[this.name]();\r\n//        },\r\n        options: [\r\n          'Easy Setting2:',\r\n          'Easy Setting:',\r\n          'Virtual Board:',\r\n          'Catalog:',\r\n          'Index Page:',\r\n          'Thread:',\r\n          'Watcher/FC:',\r\n          'Gerenal 0',\r\n          'General 1',\r\n          'Board Group',\r\n          'Live Tag',\r\n          'Statistics',\r\n//          'Design of FC',\r\n          'Footer',\r\n          'Footer for watcher',\r\n          'ThreadReader',\r\n          'Notifiers',\r\n          'JSON Archiver: Store',\r\n          'JSON Archiver: Restore',\r\n          'UIP tracker for 4chan',\r\n          'Command Line Interface',\r\n//          'Workaround for dollchan',\r\n          'Networking',\r\n          'General 2',\r\n          'Styles',\r\n          'Features',\r\n          'About'\r\n        ],\r\n        tag_gen: null,\r\n//        health_indicator: null,\r\n        get onchange_funcs_formatted(){\r\n          Object.defineProperty(this,'onchange_funcs_formatted',{value:pref_func.add_onchange_format(this.onchange_funcs), writable:true, enumerable:true, configurable:true});\r\n          pref_func.add_onchange_format(this.onchange_funcs.archive);\r\n          return this.onchange_funcs_formatted;\r\n        },\r\n        oninput_funcs: null,\r\n        onchange_funcs_base: null,\r\n        onchange_funcs: {\r\n          __proto__: { // oninput_funcs\r\n            __proto__: (function(){\r\n              var obj = {\r\n                SHOWALL: function(e){ // bound later.\r\n                  this.TOGGLE(e.target,'HIDEALL','',null,'no');\r\n                  Array.prototype.slice.call(e.target.parentNode.parentNode.querySelectorAll('[name=SHOW],[name=SHOW2]')).forEach(function(v){v.onclick({target:v, currentTarget:v});});\r\n    //              Array.prototype.slice.call(e.target.parentNode.parentNode.parentNode.querySelectorAll('[name=SHOW],[name=SHOW2]')).forEach(function(v){v.onclick({target:v});});\r\n                },\r\n                HIDEALL: function(e){ // bound later.\r\n                  this.TOGGLE(e.target,'SHOWALL','',null,'no');\r\n                  Array.prototype.slice.call(e.target.parentNode.parentNode.querySelectorAll('[name=HIDE],[name=HIDE2]')).forEach(function(v){v.onclick({target:v, currentTarget:v});});\r\n    //              Array.prototype.slice.call(e.target.parentNode.parentNode.parentNode.querySelectorAll('[name=HIDE],[name=HIDE2]')).forEach(function(v){v.onclick({target:v});});\r\n                },\r\n                SHOW: function(e){this.TOGGLE(e.target,'HIDE','');}, // bound later.\r\n                HIDE: function(e){this.TOGGLE(e.target,'SHOW','none');}, // bound later.\r\n                TOGGLE: function(et,name,disp, dst_dom, tgt_dom){\r\n                  if (!dst_dom) dst_dom = et;\r\n                  var str = et.getAttribute('data-str');\r\n                  et.setAttribute('data-str',dst_dom.textContent);\r\n                  dst_dom.textContent = str;\r\n                  et.setAttribute('name',name);\r\n                  if (tgt_dom==='no') return;\r\n                  if (!tgt_dom) tgt_dom = et.nextSibling;\r\n                  tgt_dom.style.display = disp;\r\n                },\r\n    //            NEXT: function(e){e.currentTarget.nextSibling.onclick({target:e.currentTarget.nextSibling});},\r\n                SHOW2: function(e){this.TOGGLE2(e.target,'HIDE2','');}, // bound later.\r\n                HIDE2: function(e){this.TOGGLE2(e.target,'SHOW2','none');}, // bound later.\r\n                TOGGLE2: function(et,name,disp){ // bound later.\r\n                  if (et.tagName!=='A') et = et.parentNode;\r\n                  this.TOGGLE(et,name,disp,et.childNodes[2], et.nextSibling.nextSibling);\r\n                },\r\n                SHOW3: function(e){\r\n                  var tgt = this.SEARCH_HIER(e.target, 'data-show3');\r\n                  tgt.style.display = '';\r\n                  e.target.style.display = 'none';\r\n                },\r\n                HIDE3: function(e){\r\n                  var tgt = this.SEARCH_HIER(e.target.parentNode, 'data-show3');\r\n                  tgt.style.display = '';\r\n                  e.target.parentNode.style.display = 'none';\r\n                },\r\n                SEARCH_HIER: function(et, attr){\r\n                  var val = et.getAttribute(attr);\r\n                  var tgts;\r\n                  var pn = et.parentNode;\r\n                  while (pn && (tgts = pn.querySelectorAll('['+attr+'='+val+']')).length<2) pn = pn.parentNode; // hit myself also\r\n                  return tgts[0]===et? tgts[1] : tgts[0];\r\n                },\r\n    //            SHOW3: function(e){ // bound later.\r\n    //              if (e.target.previousSibling) {\r\n    //                var div = document.createElement('div');\r\n    //                div.setAttribute('style','clear:both');\r\n    //                e.target.parentNode.insertBefore(div,e.target);\r\n    //              }\r\n    //              e.target.nextSibling.style.display = '';\r\n    //              e.target.style.display = 'none';\r\n    //            },\r\n    //            HIDE3: function(e){ // bound later.\r\n    //              e.target.parentNode.previousSibling.style.display = '';\r\n    //              e.target.parentNode.style.display = 'none';\r\n    //              var etPpp = e.target.parentNode.previousSibling.previousSibling;\r\n    //              if (etPpp) e.target.parentNode.parentNode.removeChild(etPpp);\r\n    //            },\r\n//                SHOW3: function(e){ // bound later.\r\n//                  var label = e.target.getAttribute('data-show3');\r\n//                  var tgt = e.target.previousSibling;\r\n//                  while (tgt.getAttribute('data-show3')!==label) tgt = tgt.previousSibling;\r\n//                  tgt.style.display = '';\r\n//                  e.target.style.display = 'none';\r\n//                },\r\n//                HIDE3: function(e){ // bound later.\r\n//                  var label = e.target.parentNode.getAttribute('data-show3');\r\n//                  var tgt = e.target.parentNode.nextSibling;\r\n//                  while (tgt.getAttribute('data-show3')!==label) tgt = tgt.nextSibling;\r\n//                  tgt.style.display = '';\r\n//                  e.target.parentNode.style.display = 'none';\r\n//                },\r\n                SHOW2_I: function(e){var etp = e.target.previousSibling; if (etp.onclick) etp.onclick({target:etp, currentTarget:etp});},\r\n    //            SHOW: function(e){\r\n    //              e.target.style.display = 'none';\r\n    //              e.target.nextSibling.style.display = '';\r\n    //              e.target.nextSibling.nextSibling.style.display = '';\r\n    //            },\r\n    //            HIDE: function(e){\r\n    //              e.target.style.display = 'none';\r\n    //              e.target.nextSibling.style.display = 'none';\r\n    //              e.target.previousSibling.style.display = '';\r\n    //            },\r\n                SHOW4: function(e){\r\n                  e.target.style.display = 'none';\r\n                  e.target.previousSibling.style.display = null;\r\n                },\r\n                HIDE4: function(e){\r\n                  e.target.parentNode.style.display = 'none';\r\n                  e.target.parentNode.nextSibling.style.display = null;\r\n                },\r\n                SUB: function(e){\r\n    //              var pns = e.currentTarget.parentNode.querySelectorAll('span[name=\"' +e.target.getAttribute('name')+ '\"]');\r\n                  var pn = e.currentTarget.previousSibling.previousSibling;\r\n                  if (pn && pn.querySelectorAll) {\r\n                    var pns = pn.querySelectorAll('span[data-class=show_value]');\r\n                    if (pns.length>0) pref_func.apply_prep(pns, false, null, null, null, this['.'] && this['.'].pref || null);\r\n                  }\r\n                },\r\n                'virtualBoard.search.str': function(){liveTag.filter_onchange(pref.virtualBoard.search);},\r\n                SHOW5: function(e){this.TOGGLE(e.target,'HIDE5','',     null, this.SEARCH_HIER(e.target, 'data-show5'));},\r\n                HIDE5: function(e){this.TOGGLE(e.target,'SHOW5','none', null, this.SEARCH_HIER(e.target, 'data-show5'));},\r\n//                TOGGLE5: function(et, name, disp){\r\n//                  var label = et.getAttribute('data-show5');\r\n//                  var tgts;\r\n//                  var pn = et.parentNode;\r\n//                  while (pn && (tgts = pn.querySelectorAll('[data-show5='+label+']')).length<2) pn = pn.parentNode; // hit myself also\r\n//                  this.TOGGLE(et,name,disp,null,(tgts[0]===et)? tgts[1] : tgts[0]);\r\n//                },\r\n                SHOW_T: function(e){this.TOGGLE(e.target,'HIDE_T','',    null,this.TRAVERSE(e.target));},\r\n                HIDE_T: function(e){this.TOGGLE(e.target,'SHOW_T','none',null,this.TRAVERSE(e.target));},\r\n                TRAVERSE: function(pn){\r\n                  var dir = pn.dataset.trav; // directions\r\n                  var i=-1;\r\n                  while (++i<dir.length) pn = (dir[i]==='n')? pn.nextSibling\r\n//                    : (dir[i]==='p')? pn.previousSibling // not used yet\r\n                    : (dir[i]==='P')? pn.parentNode : pn;\r\n//                    : (dir[i]==='F')? pn.firstChild\r\n//                    : (dir[i]==='L')? pn.lastChild : pn;\r\n                  return pn;\r\n                },\r\n//                SHOW_PN: function(e){this.TOGGLE(e.target,'HIDE_PN','',null,e.target.parentNode.nextSibling);},\r\n//                HIDE_PN: function(e){this.TOGGLE(e.target,'SHOW_PN','none',null,e.target.parentNode.nextSibling);},\r\n              };\r\n              for (var i in obj) obj[i] = obj[i].bind(obj);\r\n              return obj;\r\n            })(),\r\n          },\r\n          'uip_tracker.on' : uip_tracker_init,\r\n          'healthIndicator.show' : function(){cataLog.healthIndicator.show();},\r\n          'healthIndicator.expand_running' : function(){cataLog.healthIndicator.shrink_running();},\r\n          get '..'(){return pref_func.settings;},\r\n          'settings.indexing' : function(e){\r\n            var pObj = this['..'];\r\n            var pn13_1 = pObj.pn13.childNodes[1];\r\n//            if (pn13_1.innerHTML) pref_func.tooltips.remove_hier(pn13_1);\r\n            pObj.files_store();\r\n//            var files_archive;\r\n//            if (pref.settings.indexing===17) files_archive = site.script_body.querySelectorAll('span[name=\"FILES_ARCHIVE0\"]')[0]; // out of w3c, but works in chrome and FF.\r\n            var tgt = pObj.htmls[pObj.options[pref.settings.indexing]];\r\n            var html = ((typeof(tgt)==='function')?  tgt.call(pObj.htmls) : tgt) +pObj.html_common;\r\n            pn13_1.innerHTML = '<form name=\"CatChan_settings\">'+pref_func.format_html_str(html)+'</form>';\r\n//            if (files_archive) {\r\n//              var ref = pn13_1.querySelectorAll('span[name=\"FILES_ARCHIVE0\"]')[0]; // out of w3c, but works in chrome and FF.\r\n//              ref.parentNode.insertBefore(files_archive,ref);\r\n//              ref.parentNode.removeChild(ref);\r\n//            }\r\n            pref_func.add_onchange(pn13_1,pObj.onchange_funcs_formatted);\r\n            pObj.apply_pn13_1();\r\n//            pref_func.tooltips.add_hier(pn13_1);\r\n          },\r\n          'pn13_1_warning_reload': function(){\r\n            pref3.reload_required = true;\r\n            this['pn13_1_warning']();\r\n          },\r\n          'pn13_1_warning': function(){\r\n            var pn13_1 = this['..'].pn13.childNodes[1];\r\n            var pn = pn13_1.getElementsByTagName('span')['reload_required'];\r\n            pn.style.display = (pref3.reload_required || pref3.stats.use!==pref.stats.use || pref.stats.estimate_posts && !pref3.stats.estimate_posts)? '' : 'none';\r\n            var pn = pn13_1.getElementsByTagName('span')['reload_recommended'];\r\n            pn.style.display = (!pref.stats.estimate_posts && pref3.stats.estimate_posts)? '' : 'none';\r\n          },\r\n          'tag.scan' : function(){\r\n            pref.catalog.board.board_tags = true;\r\n            pref_func.settings.onchange_funcs['tag.generate_caller']('tag.scan');\r\n            liveTag.popup_filter.popup();\r\n          },\r\n          'tag.same_tag_refresh' : function(){\r\n            pref.catalog.board.board_tags_same = true;\r\n            pref_func.settings.onchange_funcs['tag.generate_caller']('tag.same_tag_refresh');\r\n          },\r\n          'tag.generate_caller' : function(src){\r\n            site2[site.nickname].get_boards_json('manual_refresh_boards_json', null, null, true);\r\n//            if (pref.test_mode['112']) {\r\n//              http_req.get('tag','8chan','https://'+site2['8chan'].domain_url+'/boards.json',pref_func.settings.onchange_funcs['tag.generate_callback'],false,false,src);\r\n//              if (pref_func.settings.pn13) pref_func.settings.apply_pn13_1();\r\n//            }\r\n          },\r\n//          'tag.generate_callback' : function(key,value,arg){ // working code\r\n//            site3['8chan'].boards = ('response' in value)? value.response : JSON.parse(value.responseText);\r\n//            pref_func.settings.onchange_funcs['tag.re_generate'](arg);\r\n//          },\r\n//          'tag.re_generate' : function(arg){\r\n//            var str = catalog_obj.scan_tags_common(site3['8chan'].boards,'name=\"tag.gen\"');\r\n//            if (!pref_func.settings['tag_gen']) {\r\n//              if (arg!=='tag.same_tag_refresh') {\r\n//                var html = '<div><button name=\"tag.scan\">Refresh</button><br>'+\r\n//                  '<textarea style=\"height:1em\" cols=\"20\" name=\"tag.gen_str\"></textarea>'+\r\n//                  '<button name=\"tag.gen_add\">Add to list</button></div><div>' + str +'</div>';\r\n//                cnst.make_popup(pref_func.settings,'tag_gen',html,pref_func.settings.onchange_funcs);\r\n//                var pn = pref_func.settings['tag_gen'].childNodes[1];\r\n////                pn.getElementsByTagName('textarea')[0].value='board_group_name';\r\n//                pn.style.height = '200px';\r\n//                pn.style.width  = '200px';\r\n//                pn.style.overflow = 'auto';\r\n//                pn.style.resize = 'both';\r\n//                cnst.bottom_top(pn);\r\n//              }\r\n//            } else pref_func.settings['tag_gen'].childNodes[1].childNodes[1].innerHTML = str;\r\n//            if (pref_func.settings['tag_gen']) pref_func.add_onchange(pref_func.settings['tag_gen'].childNodes[1].childNodes[1],pref_func.settings.onchange_funcs_formatted);\r\n//\r\n//            var str = ''\r\n//            var obj = site3['8chan'].boards;\r\n//            var myself = 0;\r\n//            while (myself<obj.length-1 && site.board!=='/'+obj[myself].uri+'/') myself++;\r\n//            for (var i=0;i<obj[myself].tags.length;i++) {\r\n//              var key = obj[myself].tags[i];\r\n//              str = str + '#' + key;\r\n//              for (var j=0;j<obj.length;j++)\r\n//                for (var m=0;m<obj[j].tags.length;m++)\r\n//                  if (obj[j].tags[m]===key) str = str + ',8chan/' + obj[j].uri + '/';\r\n//              str = str + '\\n';\r\n//            }\r\n//            pref_func.catalog_board_list_str_bt_same = str;\r\n//\r\n//            pref_func.catalog_board_list_str_bt = '';\r\n//            pref_func.settings.onchange_funcs['board_sel_refresh']();\r\n//          },\r\n//          'catalog.tag.ignore' : function(){pref_func.settings.onchange_funcs['tag.re_generate']();},\r\n//          'catalog.tag.max' : function(){pref_func.settings.onchange_funcs['tag.re_generate']();},\r\n//          'tag.gen_str' : function(){pref_func.settings.onchange_funcs['tag.gen']();},\r\n          'tag.gen' : function(){\r\n            var cbxes = pref_func.settings['tag_gen'].childNodes[1].getElementsByTagName('input');\r\n            var str = '';\r\n            var str_name = pref_func.settings['tag_gen'].childNodes[1].getElementsByTagName('textarea')[0].value;\r\n            var obj = site3['8chan'].boards;\r\n            for (var i=0;i<cbxes.length;i++)\r\n              if (cbxes[i].checked) {\r\n                var key = cbxes[i].nextSibling.textContent.replace(/ [0-9]*: /,'');\r\n                if (str_name==='') str_name = '#' + key;\r\n                for (var j=0;j<obj.length;j++)\r\n                  for (var m=0;m<obj[j].tags.length;m++)\r\n                    if (obj[j].tags[m]==key) str = str + '8chan/' + obj[j].uri + '/,';\r\n              }\r\n            pref_func.catalog_board_list_str_bt = str_name + ',' + str;\r\n            pref_func.settings.onchange_funcs['board_sel_refresh']();\r\n//            pref_func.str2obj('catalog_board_list_str');\r\n//            if (pref_func.board_sel) pref_func.apply_prep(pref_func.board_sel,false);\r\n          },\r\n          'tag.gen_add' : function(){\r\n            pref_func.settings.onchange_funcs['tag.gen']();\r\n            pref_func.settings.onchange_funcs['tag.add_to_list'](pref_func.catalog_board_list_str_bt);\r\n          },\r\n          'tag.recommendation_add' : function(){\r\n            pref_func.settings.onchange_funcs['tag.add_to_list'](pref_func.catalog_board_list_str_or);\r\n          },\r\n          'tag.add_to_list' : function(str){\r\n            if (str!=='') {\r\n              if (pref.catalog_board_list_str.search(/\\n$/)==-1) pref.catalog_board_list_str = pref.catalog_board_list_str + '\\n';\r\n              pref.catalog_board_list_str = pref.catalog_board_list_str + str + '\\n';\r\n              if (pref_func.settings.pn13) pref_func.settings.apply_pn13_1();\r\n//              pref_func.str2obj('catalog_board_list_str');\r\n//              if (pref_func.board_sel) pref_func.apply_prep(pref_func.board_sel,false);\r\n              pref_func.settings.onchange_funcs['board_sel_refresh']();\r\n            }\r\n          },\r\n          'board_sel_refresh' : function(){\r\n            pref_func.str2obj('catalog_board_list_str');\r\n            cnst.auto_shrink_board_selector.str_changed();\r\n          },\r\n          'stats.use' : 'pn13_1_warning',\r\n          'stats.estimate_posts' : 'pn13_1_warning',\r\n          'stats.auto_acquisition' : function(){cnst.auto_shrink_board_selector.color();},\r\n          'stats.auto_acquisition_all' : 'stats.auto_acquisition',\r\n          'catalog.board.recommendation': 'board_sel_refresh',\r\n          'catalog.board.board_tags': 'board_sel_refresh',\r\n          'catalog_board_list_str': 'board_sel_refresh',\r\n          'catalog.board.all_boards': 'board_sel_refresh',\r\n          'CLI.*w/': function(e, name){\r\n            var cmd = name.split('.')[1];\r\n            var str = (cmd==='query_boards')? '{\"site2\":{\"'+site.nickname+'\":{\"boards_json\":\"\"}}}' : pref.cli.json_str;\r\n            pref_func.queryOrSet_params_by_JSON(cmd==='apply'? false : cmd==='query_default'? pref_default() : true, str, null, pref_func.settings.pn13.getElementsByTagName('*')['JSON_result']);\r\n            pref_func.settings.apply_pn13_1();\r\n          },\r\n          'CLIe.*w/': function(e, name) {\r\n            var cmd = name.split('.')[1];\r\n            pref_func.site2_json_ex(cmd==='full', cmd==='filter');\r\n            pref_func.settings.apply_pn13_1();\r\n          },\r\n//          'JSON' : function() { // working code\r\n////          pref_func.apply_prep(pref_func.settings.pn13.getElementsByTagName('TEXTAREA')['cli.json_str'],true);\r\n//            pref_func.site2_json();\r\n//          },\r\n//          'JSON_query_boards': function() {\r\n//            pref.cli.json_str = '{\"site2\":{\"'+site.nickname+'\":{\"boards_json\":\"\"}}}';\r\n//            pref_func.queryOrSet_params_by_JSON(true);\r\n//          },\r\n//          'JSON_query': function() {\r\n//            pref_func.queryOrSet_params_by_JSON(true);\r\n//          },\r\n//          'JSON_query_default': function() {\r\n//            pref_func.queryOrSet_params_by_JSON(pref_default());\r\n//          },\r\n//          'JSON_ex' : function() {\r\n//            pref_func.site2_json_ex(false);\r\n//            pref_func.settings.apply_pn13_1();\r\n//          },\r\n//          'JSON_ex_full' : function() {\r\n//            pref_func.site2_json_ex(true);\r\n//            pref_func.settings.apply_pn13_1();\r\n//          },\r\n//          'JSON_ex_filter' : function() {\r\n//            pref_func.site2_json_ex(false, true);\r\n//            pref_func.settings.apply_pn13_1();\r\n//          },\r\n          'EVAL' : function() {\r\n//            pref_func.apply_prep(pref_func.settings.pn13.getElementsByTagName('TEXTAREA')['cli.eval_str'],true);\r\n            pref_func.site2_eval();\r\n          },\r\n          'close': function(){pref_func.settings.show_hide();},\r\n//          'save' : function(){if (localStorage) localStorage[pref.script_prefix+'.pref']=JSON.stringify(pref);},\r\n          'save' : function(){\r\n            if (localStorage) localStorage[pref.script_prefix+'.pref']=JSON.stringify(pref_func.site2_json_ex_remove());\r\n          },\r\n          'load_default' : function(e){\r\n            var pref_def = pref_default();\r\n            delete pref_def.settings.indexing;\r\n            delete pref_def.catalog_board_list_sel;\r\n            delete pref_def.filter;\r\n            if (e.target.name==='load_default_of_this_page') {\r\n              var nodes = e.target.parentNode.getElementsByTagName('*');\r\n              for (var i=0;i<nodes.length;i++)\r\n                if (nodes[i].name) {\r\n                  var src = pref_func.get_tgt(nodes[i].name, pref_def, true);\r\n                  if (src) {\r\n                    var dst = pref_func.get_tgt(nodes[i].name);\r\n                    dst[0][dst[1]] = src[0][src[1]];\r\n                  }\r\n                }\r\n            } else {\r\n              if (e.target.name.indexOf('easy2')===0) delete pref_def.easy2;\r\n              pref_func.pref_overwrite(pref,pref_def);\r\n              pref3.reload_required = true;\r\n            }\r\n//            var idx = pref.settings.indexing;\r\n//            pref = pref_default();\r\n            pref_func.obj_init();\r\n//            pref.settings.indexing = idx;\r\n//            pref_func.settings.onchange_funcs['settings.indexing']();\r\n            pref_func.settings.apply_pn13_1();\r\n            pref_func.settings.apply_pn13_1(true, e.target.name==='load_default_of_this_page' && cataLog.threads);  // writing to sessionStrage.\r\n          },\r\n          'load_default_of_this_page' : 'load_default',\r\n          'load_samples' : function(){pref_func.pref_samples.init();},\r\n          'catalog_triage_str': function(){if (cataLog.triage) cataLog.triage.remake();},\r\n          'triage.hide_toggle': 'catalog_triage_str',\r\n          'triage.menu_str': 'catalog_triage_str',\r\n          'triage.postMenu_str': 'catalog_triage_str',\r\n          'catalog.footer.*w/': function(e,src){if (cataLog.Footer) cataLog.Footer.update_all_force(e,src);},\r\n          'float.footer.*w/': 'catalog.footer.*w/',\r\n          'proto.footer.*w/': 'catalog.footer.*w/',\r\n          'liveTag.style.*w/': 'catalog.footer.*w/',\r\n          'thread_reader.use' : thread_reader_init,\r\n          'catalog.appearance.titleBar.*w/': function(e, name){\r\n            var mode = name.split('.')[0];\r\n            var clgs = gClg.Clgs;\r\n            for (var i=0;i<clgs.length;i++) if (clgs[i].mode===mode) clgs[i].components.titleBar.getElementsByTagName('*')[name.split('.').pop()].style.display = (e.currentTarget.checked)? '' : 'none';\r\n//            if (catalog_obj && catalog_obj.catalog_func()!==null) catalog_obj.catalog_func().pn12_0_2.getElementsByTagName('*')[name.split('.').pop()].style.display = (e.currentTarget.checked)? '' : 'none';\r\n          },\r\n//          'catalog_size_text_height': 'catalog_size_width', \r\n//          'catalog_size_text_width': 'catalog_size_width',\r\n//          'catalog_size_height': 'catalog_size_width',\r\n//          'catalog_size_width': function(e){\r\n//            if (catalog_obj && catalog_obj.catalog_func()!==null) catalog_obj.catalog_func().catalog_resized(e.currentTarget);\r\n//          },\r\n////////          'catalog.click_area': function(){ // working code.\r\n////////            if (pref_func.style_sheet) {\r\n////////              if (pref_func.style_sheet.cssRules[2]) pref_func.style_sheet.deleteRule(2);\r\n////////              pref_func.settings.onchange_funcs['catalog.click_area_add_rule']();\r\n////////            }\r\n////////          },\r\n////////          'catalog.click_area_add_rule': function(){\r\n////////////            var tgt  = site2[site.nickname].parse_funcs[site.whereami+'_html']['class_'+((pref.catalog.click_area==='entire')? 'thread' : 'thumbnail')]; // working code.\r\n////////////            if (!tgt) tgt = 'dummy';\r\n////////////            pref_func.style_sheet.insertRule('.'+tgt+' {cursor: pointer}',2);\r\n////////            pref_func.style_sheet.insertRule('.'+pref.script_prefix+((pref.catalog.click_area==='entire')? '_thread' : '_thumbnail')+' {cursor: pointer}',2);\r\n////////          },\r\n//          'sound.beep_length_f' : notifier.sound.make_beep,\r\n//          'sound.beep_volume_f' : notifier.sound.make_beep,\r\n//          'sound.beep_freq'     : notifier.sound.make_beep,\r\n//          'sound.src'           : notifier.sound.src,\r\n          'virtualBoard.p_board' : function(){liveTag.update_boardlist(true);},\r\n          'virtualBoard.p_remove' : 'virtualBoard.p_board',\r\n          'virtualBoard.max' : 'virtualBoard.p_board',\r\n          'virtualBoard.show' : 'virtualBoard.p_board',\r\n          'easy.*w/': function(e,name){this['pn13_1_warning_reload'](); pref_func.pref_samples.onclick_event.call(e.target);},\r\n          'easy2.beginner' : function(e){\r\n            pref.easy2.presets = 1;\r\n            pref_func.settings.onchange_funcs['easy2.presets'](e,pref.easy2.presets);\r\n            pref_func.settings.onchange_funcs['easy2.apply'](e, true);\r\n            pref_func.settings.onchange_funcs['reload'](e);\r\n          },\r\n          'easy2.presets' : function(e,idx){\r\n            pref_func.pref_samples['easy2.presets']((idx!==undefined)? idx : pref.easy2.presets);\r\n            pref_func.settings.apply_pn13_1();\r\n          },\r\n          'easy2.limits' : function(e,idx){\r\n            pref_func.pref_samples['easy2.limits']();\r\n            pref_func.settings.apply_pn13_1();\r\n          },\r\n          'easy2.apply' : function(e, force_reset){\r\n            if (pref.easy2.reset || force_reset) pref_func.settings.onchange_funcs['load_default'](e);\r\n            pref_func.pref_samples['easy2.presets']();\r\n            pref_func.settings.onchange_funcs['pn13_1_warning_reload']();\r\n            pref_func.pref_samples.onclick_event(null,pref.easy2);\r\n          },\r\n          'reload' : function(){location.reload();},\r\n          'triage.sampleLoader': function(e){\r\n            var tgt = e.target.dataset.tgt;\r\n            if (tgt==='catalog_triage_str') this['triage.sample.*w/'](e, e.target.selectedOptions[0].value || e.target.selectedOptions[0].textContent);\r\n            else {\r\n              var samples = tgt.indexOf('footer')!=-1? {\r\n                kill: 'KILL,x,,SPC, ,',\r\n                simple: 'KILL,x,,SPC, ,,WATCH,w,,SPC, ,,UNWATCH,uw,,SPC, ,',\r\n                menu: 'SPC, ,,MENU,\\u25b6,',\r\n                hl: 'KILL,x,,SPC, ,,NONE, H,background:lightcyan,NONE,R,opacity:0.7;background:gray,NONE,N,,',\r\n                ex: 'EXPAND,\\u25b6,\\u25c0,SPC, ,,',\r\n                mr: 'MERGEB,B,border:1px solid red,MERGE,M,,',\r\n                sp: 'SPC, ,',\r\n                get headline(){return this.hl+this.sp;},\r\n                get headline_ex(){return this.ex+this.hl+this.sp;},\r\n                get headline_merge(){return this.hl+this.mr+this.sp;},\r\n                get headline_merge_ex(){return this.ex+this.hl+this.mr+this.sp;},\r\n              } : tgt.indexOf('post')!=-1? {\r\n                simple: 'PHIDE,hide,\\n'+\r\n                  'PHIDEAFTER,hide+,\\n'+\r\n                  'PUNHIDE,unhide,\\n',\r\n                get basic(){return this.simple+\r\n                            'PCLEARHIDE,clear,\\n';},\r\n                get full(){return this.basic+\r\n                           'PDISABLEHIDE,disable,\\n'+\r\n                           'PENABLEHIDE,enable,\\n'+\r\n                           'PWATCH,Watched,\\n';},\r\n              } : {\r\n                menu_core: 'KILL,Hide permanently,\\n'+\r\n                  'TIME,Hide until new replies,\\n'+\r\n                  'WATCH,Watch,\\n'+\r\n                  'UNWATCH,Unwatch,\\n'+\r\n                  'STICKY,Sticky,\\n'+\r\n                  'UNSTICKY,Unsticky,\\n',\r\n                menu_undo: 'UNDO,Undo,',\r\n                get menu_basic(){return this.menu_core + this.menu_undo;},\r\n                get menu_attr(){return this.menu_core +\r\n                  'SHOW,Show always,\\n'+\r\n                  'UNSHOW,Remove \"show\" mark,\\n'+\r\n                  'ATTR,Red border,border:solid 2px red\\n'+\r\n                  'ATTR,Red background,background:#fac2c5\\n'+\r\n                  'NONE,Remove style,\\n' + this.menu_undo;},\r\n                get menu_full(){return this.menu_attr + '\\n'+ this.menu_arcMerge;},\r\n                menu_arcMerge: 'ARC1,Take one-shot archive,\\n'+\r\n                  'ARC,Start archiving,\\n'+\r\n                  'UNARC,Stop archiving,\\n'+\r\n                  'MERGEB,Set merge base,\\n'+\r\n                  'MERGE,Merge,\\n'+\r\n                  'MERGEOP,Merge threads in op,\\n'+\r\n                  'UNMERGE,Unmerge,\\n'+\r\n                  'UNDOMERGE,Undo last merge,\\n',\r\n              };\r\n              var opt = e.target.selectedOptions[0];\r\n              var pn = this['..'].pn13.getElementsByTagName('TEXTAREA')[tgt];\r\n              pn.value = samples[(opt.value || opt.textContent)];\r\n              pref_func.apply_prep(pn, true, true);\r\n            }\r\n            e.target.selectedIndex = 0;\r\n          },\r\n          'triage.sample.*w/': function(e, name){\r\n            var samples = {\r\n              simple_kill: 'KILL,X,',\r\n              simple: 'KILL,X,,TIME,v,,WATCH,W,,UNWATCH,UW,,UNDO,U,',\r\n              basic: 'KILL,X,,TIME,v,,WATCH,W,,UNWATCH,UW,,SHOW,\\u2605,,UNSHOW,\\u2606,,STICKY,S,,UNSTICKY,US,,UNDO,U,',\r\n              basic_color:\r\n                'KILL_N,X,,TIME_N,v,,WATCH,W,,UNWATCH,UW,,SHOW,\\u2605,,UNSHOW,\\u2606,,STICKY,S,,UNSTICKY,US,,UNDO,U,\\n'+\r\n                'NONE,O,,ATTR,O,background:#c3dcf9,ATTR,O,background:#b8efc2,'+\r\n                'ATTR,O,background:#efedbe,ATTR,O,background:#fbd5fb,ATTR,O,background:#fac2c5\\n'+\r\n                'ATTR,O,border:3px solid blue,ATTR,O,border:3px solid lime,'+\r\n                'ATTR,O,border:3px solid yellow,ATTR,O,border:3px solid orange,ATTR,O,border:3px solid red\\n',\r\n              colorful:\r\n                'KILL,X,,KILL,X,background:#c3dcf9,KILL,X,background:#b8efc2,'+\r\n                'KILL,X,background:#efedbe,KILL,X,background:#fbd5fb,KILL,X,background:#fac2c5\\n'+\r\n                'TIME,v,,TIME,v,background:#c3dcf9,TIME,v,background:#b8efc2,'+\r\n                'TIME,v,background:#efedbe,TIME,v,background:#fbd5fb,TIME,v,background:#fac2c5\\n'+\r\n                'NONE,O,,NONE,O,background:#c3dcf9,NONE,O,background:#b8efc2,'+\r\n                'NONE,O,background:#efedbe,NONE,O,background:#fbd5fb,NONE,O,background:#fac2c5\\n'+\r\n                'UNDO,U,,WATCH,W,,UNWATCH,UW,,GO,G,\\n',\r\n              borders:\r\n                'KILL,X,,KILL,X,border:3px solid blue,KILL,X,border:3px solid lime,'+\r\n                'KILL,X,border:3px solid yellow,KILL,X,border:3px solid orange,KILL,X,border:3px solid red\\n'+\r\n                'TIME,v,,TIME,v,border:3px solid blue,TIME,v,border:3px solid lime,'+\r\n                'TIME,v,border:3px solid yellow,TIME,v,border:3px solid orange,TIME,v,border:3px solid red\\n'+\r\n                'NONE,O,,NONE,O,border:3px solid blue,NONE,O,border:3px solid lime,'+\r\n                'NONE,O,border:3px solid yellow,NONE,O,border:3px solid orange,NONE,O,border:3px solid red\\n'+\r\n                'UNDO,U,,WATCH,W,,UNWATCH,UW,,GO,G,\\n',\r\n              toggles: 'KILL,X,,TIME,v,,WATCH,W,,UNWATCH,UW,,UNDO,U,,SHOW,\\u2605,,UNSHOW,\\u2605,border:2px inset,STICKY,\\u2020,,UNSTICKY,\\u2020,border:2px inset;,NONE,n,',\r\n              samples:\r\n                'KILL,delete forever,\\n'+\r\n                'TIME,hide until new replies,\\n'+\r\n                'NONE,back to default design,background:;border:;\\n'+\r\n                'NONE,border and background,background:#c3dcf9;border:3px solid blue\\n'+\r\n                'NONE,border 3px,border:3px solid blue\\n'+\r\n                'NONE,background,background:#c3dcf9\\n'+\r\n                'NONE,border 5px,border:5px solid blue\\n'+\r\n                'NONE,border 1px,border:1px solid blue\\n'+\r\n                'NONE,transparent,background:\\n'+\r\n                'NONE,shrink,width:100px;height:100px\\n'+\r\n                'GO,open this thread,\\n',\r\n              test: 'KILL,X,,TIME,v,,WATCH,W,,UNWATCH,UW,,SHOW,\\u2605,,UNSHOW,\\u2606,,STICKY,S,,UNSTICKY,US,,UNDO,U,,ARC,A+,,ARC1,A1,,UNARC,A-,',\r\n            };\r\n            pref.catalog_triage_str = samples[name.split('.').pop()];\r\n//            pref_func.pref_overwrite(pref_func.tooltips.str,src);\r\n            var pn = pref_func.settings.pn13.getElementsByTagName('*')['catalog_triage_str'];\r\n            if (pn) pref_func.apply_prep(pn, false); // , true, null, true);\r\n            this['catalog_triage_str'](e);\r\n          },\r\n//          'triage_simple': function(e){pref_func.pref_samples.onclick_event.call(e.currentTarget);},\r\n//          'triage_basic' : 'triage_simple',\r\n//          'triage_basic_color' : 'triage_simple',\r\n//          'triage_colorful' : 'triage_simple',\r\n//          'triage_borders' : 'triage_simple',\r\n//          'triage_samples' : 'triage_simple',\r\n//          'triage_test' : 'triage_simple',\r\n          'virtualBoard.scanStart' : function(){if (catalog_obj && catalog_obj.catalog_func()!==null) catalog_obj.catalog_func().catalog_liveTag_scan_site();},\r\n          'virtualBoard.scanStop' : function(){scan.abort();},\r\n          'virtualBoard.scan_domains.*w/': function(e,name){\r\n            if (pref.virtualBoard.instant_scan) {\r\n              var domain = name.split('.').pop();\r\n              scan.keyword_load_1(domain);\r\n            }},\r\n          'virtualBoard.search.show': function(e, init){\r\n            if (!site.components.boardlist) return;\r\n            var tgt_name = 'virtualBoard.search';\r\n            var bar = site.components.boardlist.getElementsByTagName('input')[tgt_name+'.str'];\r\n            if (bar) bar = bar.parentNode;\r\n            if (pref.virtualBoard.search.show) {\r\n              if (!bar) {\r\n                bar = document.createElement('span');\r\n                bar.innerHTML = pref_func.format_html_str('<ITBL10\"'+tgt_name+'.str\"><span style=\"display:none\"><ICN\"'+tgt_name+'.re\">RE, &lt;<ITB2\"virtualBoard.max\"><span name=\"HIDE4\">\\u25c0</span></span><span name=\"SHOW4\">\\u25b6</span>');\r\n                bar.style= 'float:right';\r\n                pref_func.apply_prep(bar,false);\r\n                pref_func.add_onchange(bar, pref_func.settings.onchange_funcs_formatted, pref_func.settings.oninput_funcs);\r\n//                bar.oninput = function(e){pref.virtualBoard.search.str = e.target.value;liveTag.filter_onchange(pref.virtualBoard.search);}; // not storing to sessionStorage\r\n//                var pn_settings = bar.childNodes[1];\r\n//                var pn_open = bar.childNodes[2];\r\n//                var pn_close = bar.childNodes[1].childNodes[2];\r\n//                pn_open.onclick = function(){pn_open.style.display='none';pn_settings.style.display=null;};\r\n//                pn_close.onclick = function(){pn_open.style.display=null;pn_settings.style.display='none'};\r\n                site.settings.parentNode.insertBefore(bar, site.settings);\r\n                pref_func.mirror_targets.boardlist = bar;\r\n                if (!init) liveTag.update_pn(); // activate filter\r\n              }\r\n            } else if (bar) {\r\n              site.settings.parentNode.removeChild(bar); // 'if' for initialj\r\n              pref_func.mirror_targets.boardlist = null;\r\n              liveTag.update_pn(); // disable filter\r\n            }\r\n          },\r\n          'virtualBoard.search.*': 'virtualBoard.search.str', // for 'search.re'. checkboxes don't fire oninput, though MDN says they fire. https://developer.mozilla.org/ja/docs/Web/HTML/Element/Input/checkbox\r\n//          'debug_mode.pfunc': function(){if (pref.debug_mode.pfunc) common_func.debug_parse_funcs_entry(pref.debug_mode.pfunc);},\r\n//          'debug_pfunc_comp': function(){if (pref.debug_mode.pfunc_comp) common_func.debug_parse_funcs_entry(pref.debug_mode.pfunc, pref.debug_mode.pfunc_comp);},\r\n//          'debug_mode.pfunc_all': function(){if (pref.debug_mode.pfunc_all) common_func.debug_parse_funcs_all(pref.debug_mode.pfunc_all);},\r\n          'liveTag.ex_list_str' : function(){liveTag.ex_list_changed();},\r\n          'liveTag.inherit_board_name' : function(){liveTag.inherit_board_name_changed();},\r\n          'liveTag.inherit_board_tags' : function(){liveTag.inherit_board_tags_changed();},\r\n          'page.mark_new_posts' : function(){if (gClg.Clgs) for (var i=0;i<gClg.Clgs.length;i++) gClg.Clgs[i].view_time_filter_changed();},\r\n          'recovery.comment' : function(){recovery.setup();},\r\n          '*.scroll_lock': function(){cataLog.general_event_handler.setup();},\r\n          'button_test': function(){\r\n//            site2['meguca'].catalog_native_prep(cataLog.components.pn12_0_4, cataLog.components.pn12_0, cataLog.embed_mode==='catalog');\r\n            function callback(domain, board, no, result){\r\n              console.log(result);\r\n            }\r\n            IDB.req_raw('meguca', 'meguca', 'mine', null, callback, 'get_all', true);\r\n          },\r\n          'archive': {\r\n            'restore2': function(e, files, posts){\r\n              if (!cataLog.threads) return;\r\n              if (e && !pref.archive.restore_auto && e.target.name!=='archive.restore_button') return;\r\n              if (!posts) {\r\n                files = Array.prototype.slice.call(pref3.archive.dir.files);\r\n                posts = files.filter(function(v,i,a){return v.name.search(/\\.(json|html*)$/)!=-1;});\r\n                posts = posts.filter(function(v,i,a){return v.name.indexOf('_deleted.json')==-1;}); // PATCH\r\n              }\r\n              var imgs = files.filter(function(v,i,a){return v.name.search(/\\.(json|html*)$/)==-1;});\r\n              if (posts.length===0) return;\r\n              archiver.restore_entry(posts,imgs, this['clear_files_button'], files.filter(function(v,i,a){return v.name.indexOf('_deleted.json')!=-1;}));\r\n            },\r\n            'dir': 'restore2',\r\n            'files_sel': function(e){\r\n              e.target.parentNode.querySelectorAll('span[name=\"FILES_ARCHIVE0\"]')[0].style.display = (pref.archive.files_sel===0)? '' : 'none';\r\n              e.target.parentNode.querySelectorAll('span[name=\"FILES_ARCHIVE1\"]')[0].style.display = (pref.archive.files_sel===1)? '' : 'none';\r\n              e.target.parentNode.querySelectorAll('span[name=\"FILES_ARCHIVE2\"]')[0].style.display = (pref.archive.files_sel===2)? '' : 'none';\r\n              if (pref.archive.files_sel===2) this['queryList']();\r\n            },\r\n            'restore_button': function(e){\r\n              if (pref.archive.files_sel===0) this['restore2'](e);\r\n              if (pref.archive.files_sel===2) this['IDB_thread_sel'](e);\r\n              else this['restore'](e);\r\n            },\r\n            'restore': function(e){\r\n//            if (!cataLog.threads) return;\r\n//            if (!pref.archive.restore_auto && e.target.name!=='archive.restore') return;\r\n              var posts= pref3.archive.jsons.files;\r\n              var imgs = pref3.archive.imgs.files;\r\n//            if (pref.archive.force_json) files = Array.prototype.filter.call(files,function(v){return v.name.substr(-5,5)==='.json';});\r\n              if (posts.length===0 || (pref.archive.load_img && imgs.length===0)) return;\r\n//            archiver.restore_entry(files,imgs, this['clear_files_button']);\r\n              this['restore2'](null, Array.prototype.slice.call(imgs), posts);\r\n            },\r\n            'jsons': 'restore',\r\n            'imgs': 'restore',\r\n            'clear_files_button': function(){\r\n              var doms = [pref3.archive.jsons, pref3.archive.imgs];\r\n              for (var i=0;i<doms.length;i++) if (doms[i] && doms[i].parentNode) {\r\n                var dom_new = doms[i].parentNode.insertBefore(doms[i].cloneNode(doms[i]),doms[i]);\r\n                dom_new.onchange = doms[i].onchange;\r\n                doms[i].parentNode.removeChild(doms[i]);\r\n                dom_new.onchange({target:doms[i], currentTarget:doms[i]});\r\n              }\r\n            },\r\n            get pn_IDB_board_sel(){return pref_func.settings.pn13 && pref_func.settings.pn13.querySelector('select[name=\"archive.IDB_board_sel\"]');},\r\n            get pn_IDB_thread_sel(){return pref_func.settings.pn13 && pref_func.settings.pn13.querySelector('select[name=\"archive.IDB_thread_sel\"]');},\r\n            'IDB_select_multiple': function(){\r\n              this.pn_IDB_board_sel.multiple = pref.archive.IDB_select_multiple;\r\n              this.pn_IDB_thread_sel.multiple = pref.archive.IDB_select_multiple;\r\n            },\r\n            'queryQuota': function(){\r\n              if (navigator.webkitTemporaryStorage) navigator.webkitTemporaryStorage.queryUsageAndQuota(this['showQuota'].bind(this));\r\n            },\r\n            'showQuota': function(usage, limit){\r\n              var tgt = pref_func.settings.pn13.querySelector('span[name=\"SHOW_QUOTA\"]');\r\n              if (tgt) tgt.textContent = usage.toLocaleString() + ' / ' + limit.toLocaleString() + ' (' + (usage*100/limit).toString().slice(0,5) + '%)';\r\n            },\r\n            'queryList': function(){\r\n              if (!pref.test_mode['65']) if (!pref4.archive.IDB_board_sel_options)\r\n              if (!brwsr.ff) window.indexedDB.webkitGetDatabaseNames().onsuccess = this['showList'].bind(this);\r\n                else setTimeout(function(){this.showList({target:{result:Object.keys(liveTag.mems[site.nickname])}})}.bind(this),0);\r\n            },\r\n            'showList': function(e){\r\n              if (e) {\r\n                var results = e.target.result;\r\n                var options = ['Select board'];\r\n                for (var i=0;i<results.length;i++) options[options.length] = results[i].replace(/^[^\\/]*/,'');\r\n                options[options.length] = 'ALL (' + results.length + ')';\r\n              } else options = null;\r\n              pref4.archive.IDB_board_sel_options = options;\r\n              pref_func.apply_prep(this.pn_IDB_board_sel, false);\r\n            },\r\n            'IDB_board_sel': function(){\r\n              pref4.archive.IDB_thread_sel_options = null;\r\n              var pn = this.pn_IDB_thread_sel;\r\n              pref_func.apply_prep(pn, false);\r\n              pn.style.display = '';\r\n              var boards = this['IDB_selected_boards']();\r\n              for (var i=0;i<boards.length;i++) IDB.req(site.nickname, boards[i], null, null, this['showThreadList_fromIDB'].bind(this), 'list_os');\r\n            },\r\n            'IDB_selected_boards': function(){\r\n              if (pref.archive.IDB_board_sel===0) return [];\r\n//            var board = pref4.archive.IDB_board_sel_options[pref.archive.IDB_board_sel];\r\n//            return (board[0]==='A')? pref4.archive.IDB_board_sel_options.slice(1,-1) : [board]; // ALL\r\n              return (pref4.archive.IDB_board_sel_options && pref.archive.IDB_board_sel===pref4.archive.IDB_board_sel_options.length-1)? pref4.archive.IDB_board_sel_options.slice(1,-1) :\r\n                Array.prototype.slice.call(this.pn_IDB_board_sel.options).filter(function(v){return v.selected;}).map(function(v){return v.textContent;});\r\n            },\r\n            'showThreadList_fromIDB': function(domain, board, nos){\r\n              var boards = this['IDB_selected_boards']();\r\n              if (boards.length==1) board = '';\r\n              var options = pref4.archive.IDB_thread_sel_options || ['ALL'];\r\n              for (var i=0;i<nos.length;i++) options[options.length] = board + nos[i];\r\n              options[0] = ' '; // assure the top before sort.\r\n              options.sort();\r\n              options[0] = 'ALL (' + (options.length-1) +')';\r\n              pref4.archive.IDB_thread_sel_options = options;\r\n              pref_func.apply_prep(this.pn_IDB_thread_sel, false);\r\n            },\r\n            'IDB_thread_sel': function(e){\r\n              if (!cataLog.threads) return;\r\n              if (!pref.archive.restore_auto && e.target.name!=='archive.restore_button') return;\r\n              if (pref.archive.clear_threads && cataLog.threads) pClg.clear_threads(0);\r\n              this['IDB.selected_threads'](IDB.req, null, this['restore3'].bind(this), 'get_all');\r\n            },\r\n            'IDB.selected_threads': function(func, arg3, arg4, arg5){\r\n              var ths = (pref.archive.IDB_thread_sel===0)? pref4.archive.IDB_thread_sel_options.slice(1) : // ALL\r\n                Array.prototype.slice.call(this.pn_IDB_thread_sel.options).filter(function(v){return v.selected;}).map(function(v){return v.textContent;});\r\n//                                                      [pref4.archive.IDB_thread_sel_options[pref.archive.IDB_thread_sel]];\r\n              var boards = this['IDB_selected_boards']();\r\n              var board = (boards.length===1)? boards[0] : '';\r\n              if (func) for (var i=0;i<ths.length;i++) func(site.nickname, board || ths[i].replace(/[^\\/]*$/,''), ths[i].replace(/\\/[^\\/]*\\//,''), arg3, arg4, arg5);\r\n              else {\r\n                var proto = {domain:site.nickname, boards:boards};\r\n                for (var i=0;i<ths.length;i++) ths[i] = {board:board || ths[i].replace(/[^\\/]*$/,''), no:ths[i].replace(/\\/[^\\/]*\\//,''), __proto__:proto};\r\n                return ths;\r\n              }\r\n            },\r\n            'restore3': function(domain, board, no, result, refresh_tgt){\r\n              var obj = this['consolidate_IDB_result'](result, domain);\r\n              if (obj.posts.length>0) {\r\n                var th = archiver.restore({name:(site.nickname+board+no).replace(/\\//,'-')}, site2[domain].parse_funcs.thread_json.prep_to_archive(obj.posts), obj.tn, true, refresh_tgt);\r\n                if (obj.posts_deleted.length>0) {\r\n                  if (pref.test_mode['80']) board = board.slice(0,-1)+'_IDB/';\r\n                  var lth = liveTag.mems.init({domain:domain, board:board, no:no});\r\n                  archiver.prep_deleted_posts(th, lth, true, obj.posts_deleted, refresh_tgt);\r\n                }\r\n              }\r\n            },\r\n            'consolidate_IDB_result': function(result, domain){\r\n              var posts = [];\r\n              var posts_deleted = [];\r\n              var images = {};\r\n              var thumbs = Object.create(images);\r\n              var keys = Object.keys(result);\r\n              for (var i=0;i<keys.length;i++) {\r\n                if (keys[i].indexOf('posts_deleted')===0) posts_deleted = posts_deleted.concat(result[keys[i]]);\r\n                else if (keys[i].indexOf('posts')===0) posts = posts.concat(result[keys[i]]);\r\n                else if (keys[i]==='pruned_time') continue; // patch for old files.\r\n                else {\r\n                  var ext = keys[i].replace(/[^\\.]*./,'');\r\n                  var type = (ext==='webm')? 'video/webm' : 'image';\r\n                  var file_obj = {type:type, file:result[keys[i]]};\r\n                  if (keys[i].indexOf('tn_')===0) thumbs[keys[i].substr(3)] = file_obj;\r\n                  else images[keys[i].substr(4)] = file_obj;\r\n                }\r\n              }\r\n              var i = 0;\r\n              while (i<posts.length-1 && posts[i].no<posts[i+1].no) i++;\r\n              if (i!==posts.length-1) { // out of order or duplication may due to queueing system of IDB, retry or reload.\r\n                posts.sort(this['consolidate_IDB_sort_func']);\r\n                i = 0;\r\n                while (i<posts.length-1) {\r\n                  if (posts[i].no===posts[i+1].no) {\r\n                    var j=i+2;\r\n                    while (j<posts.length && posts[i].no===posts[j].no) j++;\r\n                    if (domain==='meguca') {\r\n                      var editing = posts[i].editing;\r\n                      var k=i+1;\r\n                      while (k<j && posts[k].editing==editing) k++;\r\n                      if (k<j) {\r\n                        k=j;\r\n                        while (--k>i) if (posts[k].editing) {posts.splice(k,1);j--;}\r\n                      }\r\n                    }\r\n                    while (--j>i) posts.splice(j,1); // 4chan has different coms when anchor refers deleted posts.\r\n//                    while (--j>i) if (posts[j-1].com===posts[j].com) posts.splice(j,1); // BUG. posts[x].no must be unique and simple increase at 'check_deleted_posts'.\r\n                  }\r\n                  i++;\r\n                }\r\n              }\r\n              j=0;\r\n              for (var i=0;i<posts_deleted.length;i++) {\r\n                while (j<posts.length && posts[j].no<posts_deleted[i].no) j++;\r\n                if (j<posts.length && posts[j].no===posts_deleted[i].no) posts.splice(j,1);\r\n              }\r\n              var func_init = domain && site2[domain].parse_funcs.thread_json.consolidate_IDB_result_sub;\r\n              if (func_init && posts.length!==0) func_init(posts);\r\n              return {posts:posts, posts_deleted:posts_deleted, img:images, tn:thumbs};\r\n            },\r\n            'consolidate_IDB_sort_func': function(a,b){return (a.no!==b.no)? a.no - b.no : (a.com<b.com)? -1:1},\r\n            'IDB.delete_board': function(){\r\n              var boards = this['IDB_selected_boards']();\r\n              for (var i=0;i<boards.length;i++) window.indexedDB.deleteDatabase(pref.script_prefix+'.'+boards[i]);\r\n//              this['IDB.delete_board_pn']();\r\n//            },\r\n//            'IDB.delete_board_pn': function(){\r\n              var pn = this.pn_IDB_thread_sel;\r\n              if (pn) pn.style.display = 'none';\r\n              this['showList'](null);\r\n              this['queryList']();\r\n            },\r\n            'IDB.delete_thread': function(){\r\n              this['IDB.selected_threads'](IDB.req, null, null, 'delete_th');\r\n              this['IDB_board_sel'](null);\r\n            },\r\n            'IDB.delete_imgs': function(){\r\n              this['IDB.selected_threads'](IDB.req, IDBKeyRange.bound('img_', 'img`', false, true), null, 'delete');\r\n            },\r\n            'IDB.export_thread': function(){\r\n              var ths = this['IDB.selected_threads']();\r\n              var filename = 'CatChan_IDB_'+ths[0].domain+'-'+((ths[0].boards.length==1)? ths[0].board.slice(1,-1) : ths[0].boards.length)+'-'+\r\n                                                              ((ths.length===1)? ths[0].no : ths.length) +'.tar';\r\n              var file_id = 'IDB_extract_'+Date.now();\r\n              var callback = (function(this_obj){\r\n                var count = ths.length;\r\n                return function(domain, board, no, result){\r\n                  this_obj['export_thread'](domain, board, no, result, file_id);\r\n                  if (--count===0) archiver.tar.flush(file_id, filename);\r\n                }\r\n              })(this);\r\n              for (var i=0;i<ths.length;i++) IDB.req(ths[i].domain, ths[i].board, ths[i].no, null, callback, 'get_all');\r\n            },\r\n            'export_thread': function(domain, board, no, result, file_id, filename){\r\n              var obj = this['consolidate_IDB_result'](result, domain);\r\n//            var file_id = 'CatChan_IDB_'+domain+'-'+board.slice(1,-1)+'-'+no+'.tar';\r\n              var props = Object.keys(obj);\r\n              for (var i=0;i<props.length;i++) {\r\n                var props2 = (Array.isArray(obj[props[i]]))? ['dummy'] : Object.keys(obj[props[i]]);\r\n                for (var j=0;j<props2.length;j++) {\r\n                  var isPosts = props[i].indexOf('posts')===0;\r\n                  if (isPosts && obj[props[i]].length===0) continue;\r\n                  var data = (isPosts)? new Blob([JSON.stringify(site2[domain].parse_funcs.thread_json.prep_to_archive(obj[props[i]]))], {type:'text/plain'}) : obj[props[i]][props2[j]].file;\r\n                  var suffix = (isPosts)? domain+'-'+board.slice(1,-1)+'-'+no+ props[i].substr(5)+'.json' : props[i] +'_'+ props2[j];\r\n                  archiver.tar.add_blob(data, {domain:domain, board:board, no:no}, suffix, file_id, true);\r\n                }\r\n              }\r\n              if (filename) archiver.tar.flush(file_id, filename);\r\n            },\r\n            'IDB.reset_time': function(){\r\n              this['IDB.selected_threads'](archiver.clean_list);\r\n            },\r\n            'start': function(e){archiver.store_entry((e.target.name==='archive.start')? 'ARC' : 'ARC1');},\r\n            'oneshot': 'start',\r\n            'kwd.*': function(){pref.archive.kwd.rexps = common_func.kwd_prep_regexp(pref.archive.kwd);},\r\n          },\r\n          'test_mode.js_load': function(){\r\n            var file = pref_func.settings.pn13.getElementsByTagName('input')['test_mode.js_file'].files[0];\r\n            var url = window.URL.createObjectURL(file);\r\n            var scr = document.createElement('script');\r\n            scr.src = url;\r\n            site.script_body.appendChild(scr);\r\n          },\r\n//          '*.merge': function(e){site2['DEFAULT'].update_posts_merge_bases.onchange_merge(e);},\r\n//          '*.merge_list': '*.merge',\r\n//          '*.merge_list_str': '*.merge',\r\n//          '*.merge_lv': function(e){site2['DEFAULT'].update_posts_merge_bases.onchange_lv(e);},\r\n//          '*.merge_lv_str': '*.merge_lv',\r\n          'scanBoard': function(e){if (cataLog.event_func) cataLog.event_func(e);},\r\n          'scanBoardIf': 'scanBoard',\r\n          'scanSite': 'scanBoard',\r\n          'scanSiteIf': 'scanBoard',\r\n          'tighten_loosed_limits': function(e){pref4.search_posts_active_once = false;},\r\n          '*w/.t2h_sel': function(e,src){if (cataLog.Footer && pref.catalog.footer.use && pref.catalog.footer.flag) cataLog.Footer.update_all_force(e,src,true);},\r\n          '*w/.t2h_num_of_posts': 'catalog.t2h_sel',\r\n          'debugWindow': function(){\r\n            debugWindow = cnst.init3({func_str:'left:0px:top:0px:tb:width:400px:height:400px:overflow:auto:Show:bottom_top:tb_press:float'});\r\n            debugWindow.connect = function(){return debugWindow.cn.appendChild(document.createElement('div'));};\r\n          },\r\n          'cleanMerge': function(){\r\n            var mems = pref.proto.merge_list_str.replace(/\\+/g,',+').replace(/\\n/g,',\\n,').split(',');\r\n            var has_tails = false;\r\n            for (var i=mems.length-1;i>=0;i--) {\r\n              var tgt = mems[i].replace(/^\\s*/,'').replace(/\\s*$/,'');\r\n              if (tgt==='\\n' || tgt==='') continue;\r\n              if (tgt.search(/[^/+]+\\/[^/]+\\/[^/]+/)===0) { // head with fullname\r\n                if (!has_tails) mems.splice(i,1); // removes single heads\r\n                has_tails = false;\r\n              } else has_tails = true;\r\n            }\r\n            pref.proto.merge_list_str = pref_func.fmt4str2(mems.join(',').replace(/,\\+/g,'+').replace(/,\\n,/g,'\\n'));\r\n            pref_func.apply_prep_1n('proto.merge_list_str', false, true, null, true); // make obj, call event\r\n            var req = {\r\n              key:'cleanMerge',\r\n              obj:Object.keys(pref3.proto.merge_list_obj2[':REV']).filter(function(key){\r\n                var dbt = common_func.name2dbt(key);\r\n                var url = site2[dbt[0]].make_url4(dbt);\r\n                return url && url[0] && url[1];}),\r\n              found_threads: 0, max_threads:Infinity, // for emulation\r\n              __proto__:cataLog.scan_boards.args_proto}.initialize();\r\n            httpd.req_serial(req,2);\r\n          },\r\n          'catalog.style_general_list': function(){\r\n            for (var i=0;i<gClg.Clgs.length;i++) gClg.Clgs[i].onchange_funcs['filter.attr_list_str']();\r\n          },\r\n          'catalog.style_general_list_str': function(){\r\n            if (pref.catalog.style_general_list) this['catalog.style_general_list']();\r\n          },\r\n          'postFilter.*w/': function(e,name){\r\n            if (name==='postFilter.use' || pref.postFilter.use) for (var i=0;i<gClg.Clgs.length;i++) gClg.Clgs[i].onchange_funcs['filter.'+name+' w/'](e,name);\r\n            pref.postFilter.obj7_old = null;\r\n          },\r\n          '*.hide_posts_without_images': function(){\r\n            for (var i=0;i<gClg.Clgs.length;i++)\r\n              for (var name in gClg.Clgs[i].threads) cataLog.format_html.hide_posts_without_images(gClg.Clgs[i], gClg.Clgs[i].threads[name][16].posts);\r\n          },\r\n        },\r\n      },\r\n//      bind_myself: function(obj, args){for (var i of args) obj[i] = obj[i].bind(obj);},\r\n      format_html_str: function(html){\r\n        html = html.replace(/(<br>|<\\/div>)([0-9]),/g,function(match,p1,p2){ // function myself(match,p1){return (!p1)? '<br>' : myself(null,p1-1)+'&emsp;';}\r\n          var str = p1;\r\n          for (var i=0;i<p2;i++) str += '&emsp;';\r\n          return str;\r\n        });\r\n        html = html.replace(/<SE\"([^\"]*)\"([^>]*)>/g,function(m,p1,p2){\r\n          var options = p1.split(',');\r\n          return '<select name=\"'+options[0]+'\"'+p2+'>'+options.slice(1).map(function(v){\r\n//            var a = v.split(':');\r\n//            return '<option' + (a.length>1? ' value=\"'+a[0]+'\"'+(a.length>2? ' '+a[2]:''):'')+'>'+(a.length>1? a[1]:a[0])+'</option>';}).join('')+'</select>';\r\n            var idx = v.indexOf(':');\r\n            return '<option' + (idx>=0? ' value=\"'+v.slice(0,idx)+'\">':'>')+v.slice(idx+1)+'</option>';}).join('')+'</select>';\r\n          });\r\n        html = html.replace(/<TA\"([\\w.]+),(\\d+),(\\d+)\"([^>]*)>/g,'<textarea style=\"height:1em\" rows=\"$3\" cols=\"$2\" name=\"$1\"$4></textarea>');\r\n        html = html.replace(/<IC(N)?\"([\\w.]+)\"([^>]*)>(\\w)?/g,function(m,p0,p1,p2,p3){return '<input type=\"checkbox\" name=\"'+p1+'\"'+p2+'>'+(p3&&!p0?' '+p3:(p3||''));}); // N for no space\r\n        html = html.replace(/<ITB(N)?(L)?(\\d+)\"([\\w.]+)\"([^>]*)>(\\w)?/g,function(m,p0,p1,p2,p3,p4,p5){return '<input type=\"text\"'+(p1?'':' style=\"text-align: right;\"')+' size=\"'+p2+'\" name=\"'+p3+'\"'+p4+'>'+(p5&&!p0?' '+p5:(p5||''));}); // with single space\r\n//        html = html.replace(/<ICBX\"/g,'<input type=\"checkbox\" name=\"'); // used for filter.kwd\r\n//        html = html.replace(/<ITBL(\\d+)\"/g,'<input type=\"text\" size=\"$1\" name=\"');\r\n//        html = html.replace(/<ITB(\\d+)\"/g,'<input type=\"text\" style=\"text-align: right;\" size=\"$1\" name=\"');\r\n//        html = html.replace(/<IR(\"[\\w\\.]+):([^:]+):([^\"]+)\">/g,'<input type=\"radio\" name=$1\" value=\"$2\">$3');\r\n        html = html.replace(/<IR\"([\\w\\.]+),([^\"]+)\"([^>]*)>/g,'<input type=\"radio\" name=\"$1\" value=\"$2\"$3>');\r\n        html = html.replace(/<SSV(\"[\\w\\.]+\")>/g,'<span data-class=\"show_value\" style=\"font-weight:bold\" name=$1></span>');\r\n//        html = html.replace(/<BTN\"([\\w.]+),([^\"]+)\"([^>]*)>/g,'<button type=\"button\" name=\"$1\"$3>$2</button>');\r\n        html = html.replace(/<BTN\"([\\w.\\s]+)(,[^\"]+)*\"([^>]*)>/g,function(m,name,cap,others){return '<button type=\"button\" name=\"'+name+'\"'+others+'>'+(cap? cap.slice(1) : name.split('.').pop())+'</button>';});\r\n        html = html.replace(/<IF\"/g,'<input type=\"file\" name=\"');\r\n        return html.replace(/<input type=\"(checkbox|radio)[^>]+>[^<]+/g,'<label>$&</label>');\r\n      },\r\n    };\r\n  })();\r\n  pref_func.settings.onchange_funcs_base = pref_func.settings.onchange_funcs.__proto__.__proto__;\r\n  pref_func.settings.oninput_funcs = pref_func.add_onchange_format(pref_func.settings.onchange_funcs.__proto__);\r\n///  pref_func.settings.onchange_funcs.entry_func = (function(myself){ // working code.\r\n///    return function(e){\r\n///      pref_func.apply_prep(this,true);\r\n///      var pn_name = this.getAttribute('name'); // for <span>\r\n///      if (myself[pn_name]) myself[pn_name].call(this,e);\r\n///      else if (pn_name.indexOf('.')!=-1) {\r\n///        var name = '*'+pn_name.substr(pn_name.indexOf('.')); // *.XXX\r\n///        if (myself[name]) myself[name].call(this,e);\r\n///        else if (pn_name.lastIndexOf('.')!=-1) {\r\n///          var name = pn_name.substr(0,pn_name.lastIndexOf('.')+1)+'*'; // XXX.YYY.*\r\n///          if (myself[name]) myself[name].call(this,e);\r\n///        }\r\n///      }\r\n///      var pn = e.target.parentNode;\r\n///      while (pn && pn!==site.script_body) {\r\n///        if (pn.getAttribute('name')==='SUB') myself['SUB'].call(pn,{currentTarget:pn});\r\n///        pn = pn.parentNode;\r\n///      }\r\n///    }\r\n///  })(pref_func.settings.onchange_funcs);\r\n\r\n//  pref_func.settings.onchange_funcs['catalog.tag.ignore'] = pref_func.settings.onchange_funcs['tag.re_generate'];\r\n//  pref_func.settings.onchange_funcs['catalog.tag.max']    = pref_func.settings.onchange_funcs['tag.re_generate'];\r\n  pref_func.settings.onchange_funcs['tag.gen_str']        = pref_func.settings.onchange_funcs['tag.gen'];\r\n//  pref_func.bind_myself(pref_func.settings.oninput_funcs.__proto__, ['SHOW','HIDE','SHOW2','HIDE2','SHOW3','HIDE3','TOGGLE2','SHOWALL','HIDEALL']);\r\n  pref_func.settings.html_funcs = pref_func.settings.htmls.__proto__;\r\n\r\n  var options = {\r\n    func0_prep: function(){},\r\n    func0_exe : function(){}\r\n  };\r\n\r\n  common_func = {\r\n    __proto__:common_func,\r\n    overwrite_prop: function(dst,src){\r\n      for (var i in src) {\r\n        if (src[i]===undefined && dst[i]) delete dst[i];\r\n        else if (typeof(dst[i])==='object' && typeof(src[i])==='object') common_func.overwrite_prop(dst[i],src[i]);\r\n        else dst[i] = src[i];\r\n      }\r\n    },\r\n    name2domainboardthread: function(name,fill){\r\n//      var thread = name.replace(/[^\\/]*\\//g,'');\r\n//      var domain = name.replace(/\\/.*/,'');\r\n//      var board  = name.replace(new RegExp('^'+domain),'').replace(new RegExp(thread+'$'),'');\r\n\r\n//      name = new String(name); // not tested.\r\n      var thread = name.substr(name.lastIndexOf('/')+1);\r\n      var domain = name.substr(0,name.indexOf('/'));\r\n      var board  = name.substr(domain.length,name.length-thread.length-domain.length);\r\n      if (name===thread && thread.search(/[^0-9]/)!=-1) {\r\n        domain = thread;\r\n        thread = '';\r\n      }\r\n//      if (thread===domain) // BUG PATCH, SHOULD BE REMOVED.\r\n//        if (thread.search(/[^0-9]/)!=-1) thread ='';\r\n//        else domain = '';\r\n      if (fill) {\r\n        if (domain==='') domain = site.nickname;\r\n        if (board==='') board = site.board;\r\n      }\r\n      return [domain,board,thread];\r\n    },\r\n    name2dbt: (function(){\r\n      var type = { c:'catalog_html',\r\n                   j:'catalog_json',\r\n                   p:'page_html',\r\n                   q:'page_json',\r\n                   t:'thread_json',\r\n//                   0:'thread_html' // default\r\n                 };\r\n      return function(name){\r\n        var dbt = this.name2domainboardthread(name,true);\r\n        dbt[3] = type[dbt[2][0]];\r\n        if (dbt[3]) dbt[2] = dbt[2].substr(1);\r\n        else dbt[3] = 'thread_html';\r\n//        if (dbt[2][0].search(/[A-z]/)!=-1) {\r\n//          dbt[3] = type[dbt[2][0]];\r\n//          dbt[2] = dbt[2].substr(1);\r\n//        } else dbt[3] = 'thread_html';\r\n        return dbt;\r\n      }\r\n    })(),\r\n//    fullname2dbt: function(name){ // slow\r\n//      var dbt = name.split('/');\r\n//      dbt[1] = '/'+dbt[1]+'/';\r\n//      return dbt;\r\n//    },\r\n    fullname2dbt: function(name){\r\n      var thread = name.substr(name.lastIndexOf('/')+1);\r\n      var domain = name.substr(0,name.indexOf('/'));\r\n      var board  = name.substr(domain.length,name.length-thread.length-domain.length);\r\n      return [domain,board,thread];\r\n    },\r\n    dom_addEventListener: function(ary, dom, kwd, func){\r\n      dom.addEventListener(kwd, func, false);\r\n      ary[ary.length] = [dom, kwd, func];\r\n    },\r\n    dom_removeEventListener: function(ary, dom, kwd, func){\r\n      for (var i=ary.length-1;i>=0;i--) {\r\n        if ((!dom || dom===ary[i][0]) && (!kwd || kwd===ary[i][1]) && (!func || func===ary[i][2])) {\r\n          var tgt = ary.splice(i,1)[0];\r\n          tgt[0].removeEventListener(tgt[1], tgt[2], false);\r\n        }\r\n      }\r\n    },\r\n    dom_addAttribute: function(dom,attr,val){\r\n      var val_old = dom.getAttribute(attr);\r\n      if (val_old) val = val_old + ' ' + val;\r\n      dom.setAttribute(attr,val);\r\n    },\r\n//    modify_bookmark: function(name,add){ // working code\r\n//      var key = new RegExp('(^|,)'+name.replace(/\\+/,'\\\\+')+'([\\^@*!][^,\\n]*)*(,|\\n|$)','mg');\r\n//      var str = pref.filter.bookmark_list_str;\r\n//      str = str.replace(key,',') + ((add)? ','+name+'\\n' : '');\r\n//      pref.filter.bookmark_list_str = str.replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,'')\r\n//      if (catalog_obj.catalog_func()) {\r\n//        var tgt = catalog_obj.catalog_func().pn12_0_4.getElementsByTagName('textarea')['filter.bookmark_list_str'];\r\n//        pref_func.apply_prep(tgt,false);\r\n//      } else if (pref.catalog.auto_save_filter) { // see 'save' in catalog.\r\n//        if (localStorage) {\r\n//          key = pref.script_prefix + '.filter.' + pref.catalog_board_list_obj[pref.catalog_board_list_sel][0].key;\r\n//          var obj = JSON.parse(localStorage.getItem(key));\r\n//          obj.bookmark_list_str = pref.filter.bookmark_list_str;\r\n//          localStorage.setItem(key,JSON.stringify(obj));\r\n//        }\r\n//      }\r\n//    },\r\n    perf_out: function(obj){\r\n      obj.push(performance.now());\r\n      var str = '';\r\n      var last_ts = null;\r\n      for (var i=0;i<obj.length;i++) {\r\n        if (typeof(obj[i])==='number') {\r\n          if (last_ts) str += (obj[i]-last_ts) + ', ';\r\n          last_ts = obj[i];\r\n        } else str += obj[i] + ', ';\r\n      }\r\n      console.log(str);\r\n    },\r\n//    obj_scopy_from_key: function(obj){\r\n//      for (var i in obj)\r\n//        if (typeof(i)==='string' && Object.prototype.hasOwnProperty.call(obj,obj[i])) obj[i] = obj[obj[i]];\r\n//      return obj;\r\n//    },\r\n//    set_value_to_root: function(leaf,key,val){ // working code.\r\n//      if (Object.prototype.hasOwnProperty.call(leaf,key)) leaf[key] = val;\r\n//      else this.set_value_to_root(Object.getPrototypeOf(leaf),key,val);\r\n//    },\r\n//    init_set_style: function(dom,src){\r\n//      dom.style = {};\r\n//      if (src) for (var i in src) dom.style[i] = src[i];\r\n//      if (src===null) {\r\n//        src = dom.getAttribute('style');\r\n//        if (src) {\r\n//          src = pref_func.style2obj(src);\r\n//          for (var i in src) dom.style[i] = null;\r\n//        }\r\n//      }\r\n//    },\r\n    shallow_copy_1: function(src){ // to be obsoleted.\r\n      var dst = Object.create(null);  \r\n      for (var i in src) if (src.hasOwnProperty(i)) dst[i] = src[i];\r\n      return dst;\r\n    },\r\n    deep_copy: function(dst,src){\r\n      for (var i in src)\r\n        if (src.hasOwnProperty(i))\r\n          if (Array.isArray(src[i])) dst[i] = src[i].slice();\r\n//          else if (typeof(src[i])==='object') {if (src[i]===null) dst[i] = null; else dst[i] = this.deep_copy({},src[i]);} // not debugged yet.\r\n          else if (typeof(src[i])==='object') dst[i] = this.deep_copy({},src[i]); // BUG, null becomes {}, \r\n          else dst[i] = src[i];\r\n      return dst;\r\n    },\r\n    deep_copy2: function(dst,src){ // modified version. use this later.\r\n      for (var i in src)\r\n        if (src.hasOwnProperty(i))\r\n          if (Array.isArray(src[i])) dst[i] = src[i].slice();\r\n          else if (typeof(src[i])==='object') {\r\n            if (src[i]===null) dst[i] = null;\r\n            else dst[i] = this.deep_copy({},src[i]);\r\n          } else dst[i] = src[i];\r\n      return dst;\r\n    },\r\n    kwd_prep_regexp: function(kwd, exact) {\r\n      if (!kwd.str) return null;\r\n      var kwds = (kwd.sentence)? [kwd.str] : kwd.str.split(' ');\r\n      var rexps = [];\r\n      for (var i=0;i<kwds.length;i++) {\r\n        if (kwds[i]) {\r\n          if (!kwd.re) {\r\n            var rstr = kwds[i].replace(/[\\.\\(\\)\\[\\]\\+\\^\\$\\{\\}\\\\]/g,'\\\\$&').replace(/\\*/g,'.*').replace(/\\?/g,'.'); // should be consolidated with str2rstr\r\n            rstr = (exact)? '^' + rstr + '$' : (kwd.ew)? '(^|\\\\s|\\\\n)' + rstr + '(\\\\s|\\\\n|$)' : rstr.replace(/([^\\\\])\\.\\**$/,'$1');\r\n          } else rstr = kwds[i].replace(/\\\\$/,''); // for incremental search, trailing '/' causes error\r\n          while (rstr.length>0) {\r\n            try {\r\n              rexps[rexps.length] = new RegExp(rstr,(kwd.ci)? 'i' : '');\r\n              break;\r\n            } catch(e){ // user input causes errors usually, ex. trailing \\ or [ in incremental search.\r\n              rstr = rstr.slice(0,-1); // for incremental regexp search\r\n            }\r\n          }\r\n//          try {\r\n//            rexps[rexps.length] = new RegExp(rstr,(kwd.ci)? 'i' : '');\r\n//          } catch(e) {} // user input causes errors usually, ex. trailing \\ or [ in incremental search.\r\n        }\r\n      }\r\n      return (rexps.length>0)? rexps : null;\r\n    },\r\n    escape:(function(){\r\n      var entities = {\r\n        '<': '&lt;',\r\n        '>': '&gt;',\r\n        '&': '&amp;',\r\n        '\"': '&quot;',\r\n        '\\'':'&#039;', // '&apos;'\r\n      };\r\n      function escape(str){\r\n        return entities[str];\r\n      }\r\n      return function(txt){\r\n        return txt.replace(/[<>\"'&]/g,escape);\r\n      }\r\n    })(),\r\n    escape_text: function(txt){ // http://d.hatena.ne.jp/ockeghem/20070510/1178813849\r\n      return txt.replace(/&/g,'&amp;').replace(/</g,'&lt;');\r\n    },\r\n    arraybuffer2blob: (function(){\r\n      var mime_types = {jpg:'image/jpeg', jpeg:'image/jpeg', gif:'image/gif', png:'image/png', pdf:'application/pdf',\r\n                        svg:'image/svg+xml', svgz:'image/svg+xml', \r\n                        htm:'text/html', html:'text/html', txt:'text/plain',\r\n                        webm:'video/webm', mpg:'video/mpeg', mpeg:'video/mpeg', mp4:'video/mp4', ogv:'video/ogg',\r\n                        mp3:'audio/mp3', \r\n                        gz:'application/x-gzip', tar:'application/x-tar', tgz:'application/x-tar', zip:'application/x-compress',\r\n                        '7z':'application/x-7z-compressed', xz:'application/x-xz',\r\n                       };\r\n      return function(filename, data){\r\n        var ext = filename.substr(filename.lastIndexOf('.')+1);\r\n        var type = mime_types[ext] || 'text/plain';\r\n        return new Blob([data], {type:type});\r\n      }\r\n    })(),\r\n  };\r\n\r\n  var common_obj = {\r\n    thread_reader: null,\r\n    events_beforeunload: [],\r\n  };\r\n  common_func.dom_addEventListener(common_obj.events_beforeunload, window, 'beforeunload', function(){common_func.dom_removeEventListener(common_obj.events_beforeunload)});\r\n  common_func.dom_addEventListener(common_obj.events_beforeunload, window, 'focus', function(){DelayBuffer.prototype.hasFocus = true;});\r\n  common_func.dom_addEventListener(common_obj.events_beforeunload, window, 'blur', function(){DelayBuffer.prototype.hasFocus = false;});\r\n\r\n  var site = { // krautchan/int/\r\n    max_page   : 20,\r\n    autosage   : 300,\r\n    page: 0,\r\n//    board_name : '/int/',\r\n    url_prefix : 'https://krautchan.net/int/',\r\n    url_prefix2 : {},\r\n    nickname   : 'KC',\r\n    nicknames  : ['CatChan_tgt'],\r\n    thread_keyword: 'thread',\r\n    postform: null,\r\n    postform_rules: null,\r\n    get_ops    : null,\r\n    get_posts  : null,\r\n////////    make_url   : null,\r\n////////    make_url2  : function(bn,idx){\r\n////////      var nickname  = (bn.indexOf('/')==0)? site.nickname : bn.substr(0,bn.indexOf('/'));\r\n////////      var boardname = '/' + bn.replace(/[^\\/]*\\//,'').replace(/\\/.*/,'/');\r\n////////      return [nickname, boardname, idx, site2[nickname].make_url(boardname,idx)];\r\n////////    },\r\n    server_name : null, // optional for 2chan.\r\n    protocol : (document.location.href.search(/https/)!=-1)? 'https:' : 'http:',\r\n    catalog_threads_in_page : null,\r\n//    catalog_posts_in_thread : null,\r\n    remove_posts : function(src){return src;},\r\n    remove_files_info : function(src){return src;},\r\n    remove_checkboxes : function(src){return src;},\r\n////////    get_thread_link : function(src){return '_blank';},\r\n    get_time_of_last_post : function(doc){return null;},\r\n    patch: null,\r\n    get key(){return site.nickname + site.board + ((site.whereami==='thread')? site.no : '');}, // for dynamic change of site.whereami in meguca.\r\n    header_height: function(){return this.components.header_height;},\r\n    components: Object.create(null,{\r\n      query:{value:function(name){\r\n        var query = site2[site.nickname].components[name];\r\n        return (typeof(query)==='string')? document.querySelector(query) :\r\n                                           document.querySelectorAll(query[0])[query[1]];}, configurable:true, writable:true},\r\n      query_set:{value:function(name){\r\n        var comp = this.query(name);\r\n        if (comp) this[name] = comp;\r\n        else delete this[name];}, configurable:true, writable:true},\r\n      header_height:{get:function(){\r\n        var header = this.query('header')\r\n        return header? header.offsetHeight : 0;}, configurable:true},\r\n    }),\r\n    config: function(keyword,nickname, reentry){ // url='*site/board/etc', keyword='site'\r\n      var href = window.location.href;\r\n      var url_site = href.substr(0,href.indexOf(keyword)+keyword.length);\r\n      var url_board = decodeURI(href.substr(url_site.length+1)) + '/'; // add '/' to the last for case of ending without slash.\r\n      site.board = '/' + url_board.substr(0,url_board.indexOf('/')+1);\r\n      site.url_prefix = url_site + site.board;\r\n      site.server_name  = href.substr(0,href.indexOf(keyword)-1).replace(/https*:\\/\\/*/,'');\r\n      site.nickname = nickname;\r\n//      site.isthread = window.location.href.search(site2[nickname].thread_keyword)!=-1;\r\n//      for (var i in site2[nickname]) site[i] = site2[nickname][i];\r\n//      site.features = site2[site.nickname].features;\r\n      if (site.no===undefined) site.no = (site.whereami==='thread')? site2[site.nickname].get_ops(document)[0] : '';\r\n//      site.myself = site2[site.nickname].get_ops(document)[0];\r\n//      site.no = (site.whereami==='thread')? site.myself : '';\r\n      if (reentry) return;\r\n      if (!site0.isStep && site2[nickname].features) pref_func.pref_overwrite(site.features,site2[nickname].features);\r\n      for (var i in site2[site.nickname].components) if (i!=='header') site.components.query_set(i);\r\n      if (!site.settings && site.components.boardlist) {\r\n        site.settings = site.components.boardlist.appendChild(document.createElement('span'));\r\n        if (site.components.boardlist2) site.settings3 = site.components.boardlist2.appendChild(document.createElement('span'));\r\n      }\r\n//      if (site2[site.nickname].pref_default) pref_func.pref_overwrite(pref,site2[site.nickname].pref_default);\r\n      site.patch = site2[site.nickname].patch;\r\n    },\r\n    features : {page: false, graph: true, setting: true, setting2: true, postform: true, catalog: true, listener : false, uip_tracker: false, thread_reader: true, debug: false},\r\n    owners_recommendation: '',\r\n    catalog : false,\r\n    whereami: null,\r\n    embed_to: {},\r\n    root_body : document.getElementsByTagName('body')[0],\r\n//    root_body : (document.getElementsByTagName('body')[0])? document.getElementsByTagName('body')[0] :\r\n//                                                            document.getElementsByTagName('frame')[0].contentDocument.getElementsByTagName('body')[0] // KC root\r\n    embed_frame:'CatChan_embed_frame',\r\n    embed_frame_win: null,\r\n    boardlist: null,\r\n    settings: null,\r\n    __proto__: {\r\n      get myself(){\r\n        Object.defineProperty(this,'myself',{value:site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'thread_html',{thread:site.no})[0],\r\n                                             writable:true, enumerable:true, configurable:true});\r\n        return this.myself;\r\n      }\r\n    }\r\n  };\r\n  site.protocol = (document.location.href.search(/https/)!=-1)? 'https:' : 'http:'; // patch for Tampermonkey.\r\n  site.root_body2 = site.root_body;\r\n\r\n  var site2 = {};\r\n  site2['DEFAULT'] = { // skeleton for default\r\n    nickname : 'DEFAULT',\r\n    home : '', // home is used url for iframe, so it MUST BE THE SAME ORIGIN, OR LEAVE IT BLANK.\r\n    check_func: function(){ // for background iframe\r\n      if (window.location.href.indexOf(this.domain_url)!=-1) {\r\n        site.whereami = 'other';\r\n        site.config(this.domain_url,this.nickname);\r\n        return true;\r\n      } else return false;\r\n    },\r\n//    check_func: function(){return false;}, // return true if the script is running in this site.\r\n    boards_sel_from_tags : function(){return '';}, // return boards selection strings.\r\n    protocol: site.protocol,\r\n    components: {},\r\n    spoiler_text: {\r\n      spoiler: /span.spoiler$/,\r\n      open: /span.spoiler:hover/,\r\n    },\r\n    make_tack: function(){\r\n      var tack = document.createElement('i');\r\n      tack.setAttribute('class','fa fa-thumb-tack');\r\n      return tack;\r\n    },\r\n    make_showAlways: function(){\r\n      var icon = document.createElement('i');\r\n      icon.setAttribute('class','fa');\r\n      icon.textContent = '\\u2605';\r\n      return icon;\r\n    },\r\n    set_icon : function(pn,type,kind,tgt_th16, set){\r\n      if (pn) {\r\n        var icon = tgt_th16['icon_'+kind] || kind=='sticky' && this.get_icon(pn,type,kind,tgt_th16);\r\n        if (set && icon) { // for initial\r\n          if (tgt_th16.systemSticky) icon.style.opacity = null;\r\n          return icon;\r\n        }\r\n        if (set) {if (!icon) return this.add_icon(pn,type,kind,tgt_th16);}\r\n//        if (!icon) return this.add_icon(pn,type,kind,tgt_th16); // CAUTION: this is toggle, not set.\r\n        else {\r\n          if (kind=='sticky' && tgt_th16.systemSticky) {\r\n            if (!icon) tgt_th16.icon_sticky = icon = this.add_icon(pn,type,kind,tgt_th16); // patch for unmereged threads with systemSticky\r\n            icon.style.opacity = '0.4';\r\n          } else if (icon.parentNode) icon.parentNode.removeChild(icon); // for merge\r\n//          else icon.parentNode.removeChild(icon);\r\n        }\r\n      }\r\n      return null;\r\n    },\r\n    postform:(function(){\r\n      function onoff(ref){\r\n//        if (this.tack && ref) ref.parentNode.insertBefore(this.tack, ref);\r\n        if (this.tack) this.tack.style.display = (this.tack.style.display==='none')? '' : 'none';\r\n      }\r\n      return {\r\n        tack: null,\r\n        init:function(){\r\n          if (site.postform) {\r\n            this.tack = site2[site.nickname].make_tack();\r\n            this.tack.setAttribute('style','float:right;font-size:2em');\r\n            site.postform.parentNode.insertBefore(this.tack,site.postform);\r\n          }\r\n          return this.tack;\r\n        },\r\n        on: onoff,\r\n        off:onoff,\r\n      };\r\n    })(),\r\n    postform_prep: function(){ // the same as vichan.\r\n      site.components.postform_submit2 = null;\r\n      site.components.postform_submit2_observer = new MutationObserver(this.postform_submit2_find);\r\n      site.components.postform_submit2_observer.observe(document.getElementsByTagName('body')[0], {childList: true});\r\n    },\r\n    postform_submit2_find: function(){\r\n      var state_old = site.components.postform_submit2;\r\n      site.components.query_set('postform_submit2');\r\n      site.components.query_set('postform_comment2');\r\n      if (common_obj.thread_reader) common_obj.thread_reader.setup_submit2();\r\n      if (pref.features.recovery) recovery.setup2();\r\n    },\r\n    general_event_handler:(function(){\r\n//      function func_false(){return false;}\r\n      var obj = {\r\n        common: {\r\n          subscribe: function(catalog_root){\r\n            if (this.mouseover) catalog_root.addEventListener('mouseover',this.mouseover,false);\r\n          },\r\n          unsubscribe: function(catalog_root){\r\n            if (this.mouseover) catalog_root.removeEventListener('mouseover',this.mouseover,false);\r\n          },\r\n          get_mark: function(pn, clientY){\r\n            return this.get_mark_from_height(clientY, document.getElementByTagName('div'));\r\n          },\r\n          get_mark_from_height: function(now_height, pns){\r\n            var len = pns.length;\r\n            var step = len >> 1;\r\n            var i = 0;\r\n            while (step>0) {\r\n              if (pns[i+step].offsetTop<now_height) i += step;\r\n              step >>= 1;\r\n            }\r\n            while (i+1<len && pns[i+1].offsetTop<now_height) i++;\r\n            return pns[i];\r\n          },\r\n          isThumbnail: function(e){\r\n            var et = e.target;\r\n            return et.tagName==='IMG' && et.parentNode && et.parentNode.tagName==='A'; // et.parentNode for shrink_thumbnails, expanded image was removed already.\r\n          },\r\n          recSearch_thread: function(tgt,ecT, className){\r\n            if (!className) className = 'thread';\r\n            while (tgt && tgt!=ecT) {\r\n              if (tgt.classList && tgt.classList.contains(className)) return tgt;\r\n              else tgt = tgt.parentNode;\r\n            }\r\n            return null;\r\n          },\r\n\r\n          getID: function(pn){},\r\n          getCountry: function(pn){},\r\n          getTrip: function(pn){},\r\n          getName: function(pn){return pn.classList.contains('name') && pn.textContent || undefined;},\r\n          an2srcNo: function(pn, th){\r\n            while (pn) {\r\n              if (pn.classList && pn.classList.contains('post')) return site2[th.domain_html].parse_funcs['post_html'].no({pn:pn});\r\n              if (gGEH.pns_all_keys.get(pn)) return site2[th.domain_html].parse_funcs['catalog_html'].no({pn:pn});\r\n              pn = pn.parentNode;\r\n            }\r\n          },\r\n          menu2keyTime: function(pn){\r\n            var post = this.recSearch_thread(pn, null, 'post');\r\n            var key = gGEH.get_key_recursive(post, document);\r\n            var pfunc = site2[site.nickname].parse_funcs['post_html'];\r\n            var no = pfunc.no({pn:post});\r\n            var time = pfunc.time({pn:post})*pfunc.time_unit;\r\n            return [key, no, time];\r\n          },\r\n        },\r\n      };\r\n      obj.thread = Object.create(obj.common);\r\n      obj.page = Object.create(obj.common);\r\n      obj.catalog = Object.create(obj.common);\r\n      return obj;\r\n    })(),\r\n//    catalog_background : '#b5ccf9',\r\n//    catalog_bordercolor : '#000000',\r\n    horizontal_separator_in_index: function(){\r\n//      var pn = document.createElement('div');\r\n//      pn.innerHTML = '<br><br class=\"clear\"><hr>';\r\n      var pn = document.createElement('hr');\r\n      pn.setAttribute('class', pref.script_prefix+'_hs');\r\n      return pn;\r\n    },\r\n//    get_next_image: function(img,name){return null;}, // return next image for prefetch3\r\n    get_next_image: function(img,top, imgs){\r\n      if (!imgs) imgs = cataLog.parent.getElementsByTagName('img');\r\n      var idx = Array.prototype.indexOf.call(imgs,img);\r\n      if (top) while (imgs[idx+1] && imgs[idx+1].offsetTop<top) idx++;\r\n      return (idx>=0)? imgs[idx+1] : null;\r\n    },\r\n//    get_time_of_posts : function(thread){return [0,0];}, // returns parsed UTC time of last and op posts from element of the thread.\r\n//    get_time_of_post_in_utc : function(post){return 0;}, // returns parsed UTC time of posts.\r\n////////    get_thread_link : function(thread){return null;}, // returns href from element of the thread. THIS SHOULD BE MERGED WITH modify_thread_link.\r\n    catalog_threads_in_page : function(doc){return [];}, // returns array of thread elements in the page from the document.\r\n    remove_posts : function(thread,end){}, // removes posts from the thread with a certain remains.\r\n    remove_files_info : function(thread){return thread;}, // removes file information from the thread, and returns itself.\r\n//    remove_checkboxes : function(thread){return thread;}, // removes checkboxes from the thread, and returns itself.\r\n    postform_rules : null,\r\n    thread_keyword : 'thread', // thread keyword in URL.\r\n    max_page : function(board){return 10;}, // returns max_page\r\n//    max_page : 10, // maximum page number.\r\n//    make_url : function(board,no,key){return ['_blank','raw'];}, // returns URL and type from board name and page number.\r\n//    make_url3: function(board,th){return '_blank';}, // returns URL from board name and thread number.\r\n//    make_url4: function(dbt){return '_blank';}, // returns URL from dbt.\r\n////////////    enumerate_boards_to_scan:function(){ // 4chan // working code.\r\n////////////      var obj = [];\r\n////////////      var end = (site3[site.nickname].boards.length > pref.scan.max)? pref.scan.max : site3[site.nickname].boards.length;\r\n////////////      for (var i=0;i<end;i++) obj[obj.length] = '/'+site3[site.nickname].boards[i].board+'/';\r\n////////////      return obj;\r\n////////////    },\r\n////////    enumerate_boards_to_scan:function(){ // working code.(2016.01.09)\r\n////////      var obj = [];\r\n////////      var end = (site3[site.nickname].boards.length > pref.scan.max)? pref.scan.max : site3[site.nickname].boards.length;\r\n////////      for (var i=0;i<end;i++) obj[obj.length] = site3[site.nickname].boards[i];\r\n////////      return obj;\r\n////////    },\r\n    generate_boards_json: function(src, page_def){\r\n      var proto = {pages:page_def};\r\n      var arr = [];\r\n      for (var i=0;i<src.length;i++)\r\n        arr[arr.length] = (Array.isArray(src[i]))? {board:src[i][0], pages:src[i][1], __proto__:proto}\r\n                                                 : {board:src[i],                     __proto__:proto};\r\n      return {boards:arr};\r\n    },\r\n    url_boards_json: function(){return '';}, // returns url of boards.json.\r\n    get_boards_json: function(key,callback,callback_always,  dummy_indicator){\r\n      var key = 'boards_json_'+this.nickname;\r\n      if (this.boards_json) this.get_boards_json_callback(this.nickname,{status:200, response:this.boards_json},[callback,callback_always]);\r\n      else httpd.req({initiator:key,\r\n//                      INDICATOR: dummy_indicator? {shift:function(){}, report:function(){}} : null, IDX:0, RUNNING:0, SUC:0, max:1, // patch for 8chan, see tag.generate_caller\r\n                      tgts:[{domain:this.nickname, url:this.url_boards_json()[0], responseType:'json', data_type:'json'}],\r\n                      callback_1:function(req,val){this.get_boards_json_callback(key,val,[callback,callback_always,true])}.bind(this)},6);\r\n    },\r\n    get_boards_json_callback: function(key,value,args){\r\n      if (value.status==200) {\r\n        this.postprocess_board(value.response);\r\n        if (!site3[this.nickname].boards) {liveTag.update_pn_buf.cancel();liveTag.update_pn_buf.do_tgt();}\r\n        site3[this.nickname].boards = (site.nickname==='8chan' && site.whereami==='boards')? value.response : true;\r\n      }\r\n      if (args[0] && (args[1] || value.status===200))\r\n        if (args[2]) args[0]();\r\n        else setTimeout(args[0],0);\r\n    },\r\n////    get_boards_json_indicator: null, // working code.\r\n////    get_boards_json: function(key,callback,callback_always,health_indicator){\r\n////      var key = 'boards_json_'+this.nickname;\r\n////      if (this.get_boards_json_indicator) {\r\n////        this.get_boards_json_indicator.report({end:Date.now(), prog_str:'Aborted.', err_str:'Aborted by next request.'});\r\n////        this.get_boards_json_indicator = null;\r\n////      }\r\n////      if (this.boards_json) this.get_boards_json_callback(this.nickname,{status:200, response:this.boards_json},[callback,callback_always]);\r\n////      else {\r\n////        var indicator;\r\n////        if (health_indicator) { // patch\r\n////          indicator = health_indicator.shift('limegreen','b',key);\r\n////          indicator.report({start:Date.now(), prog_str:'Loading boards\\' information'});\r\n////          this.get_boards_json_indicator = indicator;\r\n////        }\r\n////        http_req.get(key,this.nickname+',dummy,dummy',this.url_boards_json(),this.get_boards_json_callback.bind(this),0,true,[callback,callback_always,indicator,key]);\r\n////      }\r\n////    },\r\n////    get_boards_json_callback: function(key,value,args){\r\n////      if (value.status==200) {\r\n////        this.postprocess_board(value.response);\r\n////        if (!site3[this.nickname].boards) liveTag.update_pn_buf.do_tgt();\r\n////        site3[this.nickname].boards = true;\r\n////      }\r\n////      if (args[2]) {\r\n////        args[2].report({end:Date.now(), prog_str: (value.status==200)? 'boards.json is loaded.' : '',\r\n////                        err_str:  (value.status==200)? '' : 'Error at loading board\\'s infomation.'});\r\n////        this.get_boards_json_indicator = null;\r\n////      }\r\n////      if (args[3]) http_req.close(args[3]);\r\n////      if (args[0] && (args[1] || value.status===200))\r\n////        if (args[2]) args[0]();\r\n////        else setTimeout(args[0],0);\r\n////    },\r\n    postprocess_board: function(val){ // for 4chan and all \r\n      for (var i=0;i<val.boards.length;i++) {\r\n        var bd = liveTag.mems.init({domain:this.nickname, board:'/'+val.boards[i].board+'/'});\r\n        bd.o = i;\r\n        if (val.boards[i].pages && !bd.pgs) bd.pgs = val.boards[i].pages;\r\n        if (val.boards[i].tags && val.boards[i].tags.length!=0) liveTag.postprocess_board_add_btag(val.boards[i].tags,bd);\r\n      }\r\n    },\r\n////////    postprocess_board: function(val){ // 4chan // working code.\r\n////////      site3[this.nickname].boards = [];\r\n////////      for (var i=0;i<val.boards.length;i++) {\r\n////////        var bd = liveTag.mems.init({domain:this.nickname, board:'/'+val.boards[i].board+'/'});\r\n////////        site3[this.nickname].boards.push(bd); // BUG. increase length forever.\r\n//////////        Object.defineProperty(bd,'bump_limit',{value:val.boards.bump_limit});\r\n////////      }\r\n////////    },\r\n\r\n////    show_boardlist_replaced: false, // working code.\r\n////    show_boardlist_physical_board: function(tags,func_onclick){\r\n////      var as = site.components.boardlist.getElementsByTagName('a');\r\n////      if (pref.virtualBoard.p_board==='replace') {\r\n////        for (var i=pn.childNodes.length-2;i>=0;i-=2) { // skip every delimiter // working code.\r\n//////          var key = pn.childNodes[i].textContent.substr(1); // working code.\r\n//////          for (var j=0;j<as.length;j++) {\r\n//////            if (as[j].textContent===key) {\r\n//////              if (!as[j].style) as[j].style = {};\r\n//////              if (as[j].style.display!=='none') {\r\n//////                as[j].style.display='none';\r\n//////                pn.childNodes[i].tagName = 'a'; // can't change by specification.\r\n//////                pn.childNodes[i].setAttribute('href',as[j].getAttribute('href'));\r\n//////                as[j].parentNode.insertBefore(pn.childNodes[i],as[j]);\r\n//////              } else pn.removeChild(pn.childNodes[i]); // remove '#XXX'(tag)\r\n//////              pn.removeChild(pn.childNodes[i]); // remove '/'(delimiter)\r\n//////            }\r\n//////          }\r\n////          var key = pn.childNodes[i].textContent;\r\n////          for (var j=0;j<as.length;j++) {\r\n////            if (as[j].textContent===key || as[j].textContent===key.substr(1)) {\r\n////              if (!as[j].classList.contains(pref.script_prefix+'_tag')) {\r\n////                var tmp_node = liveTag.update_tag_string([pn.childNodes[i].textContent], '', pn.childNodes[i].onclick, 'a').childNodes[0];\r\n////                tmp_node.setAttribute('href',as[j].getAttribute('href'));\r\n////                as[j].parentNode.insertBefore(tmp_node,as[j]);\r\n////                as[j].parentNode.removeChild(tmp_node.nextSibling);\r\n////              } else pn.removeChild(pn.childNodes[i]); // remove '#XXX'(tag)\r\n////              pn.removeChild(pn.childNodes[i]); // remove '/'(delimiter)\r\n////            }\r\n////          }\r\n////        }\r\n////        this.boardlist_replaced = true;\r\n////      } else if (this.boardlist_replaced) {\r\n////        for (var i=0;i<as.length;i++) {\r\n////          if (as[i].style && as[i].style.display==='none') {\r\n////            as[i].style.display='';\r\n////            as[i].parentNode.removeChild(as[i].previousSibling);\r\n////          }\r\n////        }\r\n////        this.boardlist_replaced = false;\r\n////      }\r\n////    },\r\n    boardlist_boards: Object.create(null,{sel:{value:null, writable:true}}),\r\n    show_boardlist_physical_board: function(tags,func_onclick){ // tuned for 8chan\r\n      var tgts = this.boardlist_boards;\r\n      if ((tgts.sel===true  && pref.virtualBoard.p_board==='replace') ||\r\n          (tgts.sel===false && pref.virtualBoard.p_board==='both')) {\r\n        var src = (tgts.sel)? 'v' : 'p';\r\n        var dst = (tgts.sel)? 'p' : 'v';\r\n        for (var i in tgts) {\r\n          var tgt = tgts[i];\r\n          if (tgt[src] && tgt[dst]) {\r\n            tgt[dst].parentNode.insertBefore(tgt[src],tgt[dst]);\r\n            tgt[dst].parentNode.removeChild(tgt[dst]);\r\n          }\r\n        }\r\n        tgts.sel = !tgts.sel;\r\n      }\r\n      if (this.boardlist_boards.sel===null && pref.virtualBoard.p_board==='replace') {\r\n        var as = site.components.boardlist.getElementsByTagName('a');\r\n        for (var i=0;i<as.length;i++) {\r\n          var key = as[i].textContent;\r\n          if (this.show_boardlist_physical_extract_func) key = this.show_boardlist_physical_extract_func(key);\r\n          if (key[0]!=='#') this.boardlist_boards['#'+ ((pref.liveTag.ci)? key.toLowerCase() : key)] = {p:as[i]};\r\n        }\r\n        this.boardlist_boards.sel = false;\r\n      }\r\n      if (pref.virtualBoard.p_board==='replace') {\r\n        var boardlist_hit = {};\r\n        for (var i=tags.length-1;i>=0;i--) {\r\n          var key = (pref.liveTag.ci)? tags[i].toLowerCase() : tags[i];\r\n          var tgt = this.boardlist_boards[key];\r\n          if (tgt) {\r\n            if (!tgt.v) {\r\n              var p = tgt.p;\r\n              var v = liveTag.create_tag_node_1(key, func_onclick, 'a');\r\n              v.setAttribute('href',p.getAttribute('href'));\r\n              p.parentNode.insertBefore(v,p);\r\n              p.parentNode.removeChild(p);\r\n              tgt.v = v;\r\n            }\r\n            tags.splice(i,1);\r\n            boardlist_hit[key] = null;\r\n          }\r\n        }\r\n        if (pref.virtualBoard.v_remove) {\r\n          for (var i in this.boardlist_boards)\r\n            if (this.boardlist_boards[i].v && boardlist_hit[i]===undefined) {\r\n              var p = this.boardlist_boards[i].p;\r\n              var v = this.boardlist_boards[i].v;\r\n              v.parentNode.insertBefore(p,v);\r\n              v.parentNode.removeChild(v);\r\n              delete this.boardlist_boards[i].v;\r\n            }\r\n        }\r\n      }\r\n      return tags;\r\n    },\r\n    boardlist_tags: null,\r\n    boardlist_tags_pn: null,\r\n    show_boardlist: function(tags,func_onclick){\r\n//      for (var i=0;i<site.boardlist.length;i++) {\r\n//        if (site.boardlist[i].lastChild.className===pref.script_prefix+'_tag') site.boardlist[i].removeChild(site.boardlist[i].lastChild);\r\n//        site.boardlist[i].appendChild(pn); // can't clone events.\r\n//      }\r\n      var sbl = site.components.boardlist;\r\n      var tags_bl = this.show_boardlist_physical_board(tags.slice(),func_onclick);\r\n      if (pref.virtualBoard.show && tags_bl.length!==0) {\r\n        var pn = (pref.test_mode['118'])? liveTag.create_tag_nodes(tags_bl, ' / ', func_onclick)\r\n                                        : liveTag.update_tag_nodes(tags_bl, ' / ', func_onclick, this.boardlist_tags_pn, this.boardlist_tags);\r\n        if (!this.boardlist_tags_pn) {\r\n          var ppn = document.createElement('span');\r\n          ppn.appendChild(document.createTextNode('[ '));\r\n          ppn.appendChild(pn);\r\n          ppn.appendChild(document.createTextNode(' ]'));\r\n          sbl.appendChild(ppn);\r\n        } else if (pref.test_mode['118']) this.boardlist_tags_pn.parentNode.replaceChild(pn, this.boardlist_tags_pn);\r\n        this.boardlist_tags_pn = pn;\r\n        this.boardlist_tags = tags_bl;\r\n      } else if (this.boardlist_tags_pn) {\r\n        sbl.removeChild(this.boardlist_tags_pn.parentNode);\r\n        this.boardlist_tags_pn = null;\r\n        this.boardlist_tags = null;\r\n      }\r\n\r\n//      this.boardlist_tags = this.show_boardlist_physical_board(tags.slice(),func_onclick);\r\n//      if (this.boardlist_tags_pn) {\r\n//        sbl.removeChild(this.boardlist_tags_pn);\r\n//        this.boardlist_tags_pn = null;\r\n//      }\r\n////      if (sbl.lastChild.getAttribute && sbl.lastChild.getAttribute('name')===pref.script_prefix+'_tag_parent') sbl.removeChild(sbl.lastChild);\r\n//      if (pref.virtualBoard.show && this.boardlist_tags.length!==0) {\r\n//        var pn = liveTag.create_tag_nodes(this.boardlist_tags, ' / ', func_onclick);\r\n//        pn.insertBefore(document.createTextNode('[ '),pn.firstChild); // referred from query_tag_node\r\n//        pn.appendChild(document.createTextNode(' ]'));\r\n//        this.boardlist_tags_pn = sbl.appendChild(pn);\r\n//      }\r\n    },\r\n    query_tag_node: function(tag){\r\n      var bd_bl = this.boardlist_boards[tag];\r\n      if (bd_bl) return bd_bl.v;\r\n      else if (this.boardlist_tags_pn) {\r\n        var idx = this.boardlist_tags.indexOf(tag);\r\n        if (idx>=0) return this.boardlist_tags_pn.childNodes[idx*2]; // [idx*2+1];\r\n      }\r\n    },\r\n    get_ops : function(doc){return [];}, // returns array of op numbers from the document.\r\n    get_posts : function(doc) {return [];}, // returns array of posts numbers from the document.\r\n    absolute_link: function(pn){\r\n      this.absolute_link_exe(pn, this.protocol + '//' + this.domain_url);\r\n    },\r\n    absolute_link_exe: function(pn, prefix){\r\n      var tgts = ['src','href'];\r\n      var all = pn.getElementsByTagName('*'); //'*[src],*[href]'\r\n      for (var i=0;i<all.length;i++) {\r\n        for (var j=0;j<tgts.length;j++) {\r\n          var tgt = all[i].getAttribute(tgts[j]);\r\n          if (tgt && tgt.indexOf('http')!=0 && tgt.indexOf('mailto:')!=0 && tgt.indexOf('blob')!=0 && tgt.substr(0,2)!='//')\r\n            all[i].setAttribute(tgts[j], prefix + tgt);\r\n//            all[i].setAttribute(tgts[j],site2[doc.domain].protocol + '//' + site2[doc.domain].domain_url + tgt); // working code.\r\n        }\r\n      }\r\n    },\r\n    absolute_link_1: function(href){return site2[this.nickname].protocol + '//' + site2[this.nickname].domain_url + href;},\r\n    link_dbtp2href_abs: function(dbtp, quote){\r\n      return (this.nickname!=site.nickname? this.protocol + '//' + this.domain_url : '') + this.link_dbtp2href(dbtp, quote);\r\n    },\r\n////////    insert_footer : function(thread,page_no,boardname,insert,date,nof_posts,nof_files){return [nof_posts,nof_files];}, // insert information footer, and returns count of posts and images.\r\n\r\n////////    insert_footer2: function(thread,type,nums,nums2){}, // insert num of new replies to me, num of new replies.\r\n//    prep_footer3 : function(){return null;}, // prepare footer\r\n//    insert_footer3: function(thread,nums,nums2){}, // insert footer.\r\n\r\n//    prep_own_posts: function(){}, // prepare own_post object.\r\n//    prep_own_posts_event: function(e){}, // event entry for preparing own_post object.\r\n    ls_key_own_posts: pref.script_prefix + '.own_posts.',\r\n    prep_own_posts_event : function(e){\r\n      if (e) site2[site.nickname].prep_own_posts_1(e.key); // gives 'this' value to 'prep_own_posts_1'. MUST BE site2[site.nickname].\r\n      if (window.name===site.nickname) send_message('parent',['OWN_POSTS', window.name, site3[window.name].own_posts]);\r\n    },\r\n    prep_own_posts : function(bt){\r\n      site3[this.nickname].own_posts = {};\r\n      if (localStorage) {\r\n        var keys = (bt)? [this.ls_key_own_posts + bt] : Object.keys(localStorage);\r\n        for (var i=0;i<keys.length;i++) this.prep_own_posts_1(keys[i]);\r\n      }\r\n//console.log(site3[this.nickname].own_posts);\r\n    },\r\n    prep_own_posts_1 : function(key){\r\n      if (key.indexOf(this.ls_key_own_posts)==0) {\r\n        var bt = key.substr(this.ls_key_own_posts.length);\r\n        var board = bt.substr(0,bt.lastIndexOf('/')+1);\r\n        if (!site3[this.nickname].own_posts[board]) site3[this.nickname].own_posts[board] = {};\r\n        var nos = JSON.parse(localStorage[key] || '[]');\r\n        for (var j=0;j<nos.length;j++) site3[this.nickname].own_posts[board][nos[j]] = null;\r\n      }\r\n    },\r\n//    clean_up_own_posts : function(ths,board){ // working code.\r\n////console.log('clean up');\r\n//      if (localStorage) {\r\n//        var nos = {};\r\n//        for (var i=0;i<ths.length;i++) nos[ths[i].key.substr(ths[i].key.lastIndexOf('/')+1)] = null;\r\n//        var own_key_bd = this.ls_key_own_posts + board;\r\n//        var keys = Object.keys(localStorage);\r\n//        for (var i=0;i<keys.length;i++)\r\n//          if (keys[i].indexOf(own_key_bd)==0 && nos[keys[i].substr(own_key_bd.length)]!==null) delete localStorage[keys[i]]\r\n//      }\r\n////console.log(site3[this.nickname].own_posts);\r\n//    },\r\n    clean_up_LS: function(domain, board, nos){\r\n      if (domain!==site.nickname) return; // PATCH.\r\n      if (localStorage) {\r\n        var keys = Object.keys(localStorage); // to minimize LS access.\r\n        if (pref.thread_reader.own_posts_tracker && pref.thread_reader.clean_up_own_posts) this.clean_up_LS_th(keys, this.ls_key_own_posts, board, nos);\r\n        if (pref[cataLog.embed_mode].deleted_posts.auto_clean) this.clean_up_LS_th(keys, this.ls_key_deletedPosts, board, nos);\r\n        if (pref.recovery.auto_clean) {\r\n          this.clean_up_LS_th(keys, this.ls_key_comment, board, nos);\r\n//          this.clean_up_LS_th(pref.script_prefix+'.comment.'+site.nickname, board, nos); // patch for half year, from 2016.09 to 2020.10\r\n        }\r\n        if (pref.test_mode['162']) this.clean_up_LS_th(keys, this.ls_key_hiddenPosts, board, nos);\r\n      }\r\n    },\r\n    ls_key_deletedPosts: pref.script_prefix + '.deletedPosts.',\r\n    clean_up_deleted_posts_1: function(bt){if (localStorage) delete localStorage[this.ls_key_deletedPosts + bt];},\r\n//    ls_key_comment: pref.script_prefix + '.draft.',\r\n    ls_key_comment: pref.script_prefix + '.draft.',\r\n    ls_key_hiddenPosts: pref.script_prefix + '.hiddenPosts.',\r\n    clean_up_LS_th: function(keys, ls_key, board, nos){\r\n      var ls_key_bd = ls_key + board;\r\n//      var keys = Object.keys(localStorage);\r\n      for (var i=0;i<keys.length;i++)\r\n        if (keys[i].indexOf(ls_key_bd)==0 && nos[keys[i].substr(ls_key_bd.length)]===undefined) delete localStorage[keys[i]]; // console.log('delete_LS: '+keys[i]);\r\n    },\r\n    check_reply: (function(){\r\n      var com_or_txt = false;\r\n      var pn_tags = document.createElement('div');\r\n      var regexp_anchor      = '';\r\n      var regexp_anchor_len  = 0;\r\n      var regexp_anchor_cb   = '';\r\n      var regexp_anchor_txt_1  = /^>>[0-9]+/; // RegExp.test executes RegExp.exec once.\r\n      var regexp_anchor_txt    = />>[0-9]+/g;\r\n      var regexp_anchor_cb_txt_1 = /^>>>\\/[0-9A-z_\\+]+\\/[0-9]+/;\r\n      var regexp_anchor_cb_txt = />>>\\/[0-9A-z_\\+]+\\/[0-9]+/g;\r\n      var regexp_anchor_com    = /&gt;&gt;[0-9]+/g;\r\n      var regexp_anchor_cb_com = /&gt;&gt;&gt;\\/[0-9A-z_\\+]+\\/[0-9]+/g;\r\n      var remake_own_posts = true;\r\n      var own_posts;\r\n      var own_posts_cb;\r\n      var tag_ex_list;\r\n      var str_rm_list;\r\n//      var time_offset = Math.floor(Date.now()/1000)*1000; // BUG.\r\n////////      var count_replies = 0; // for direct call to check_t1 from native catalog.\r\n      function add_you(post, add_name){\r\n        var as = post.pn.getElementsByTagName('a');\r\n        for (var i=0;i<as.length;i++) {\r\n          var to_me = false;\r\n          var txt = as[i].textContent;\r\n          if (own_posts && own_posts[txt.substr(2)]===null && regexp_anchor_txt_1.test(txt)) to_me = true; // SHOULD USE SEARCH INSTEAD OF TEST TO KEEP CONSISTENCY.\r\n          if (!to_me && own_posts_cb && regexp_anchor_cb_txt_1.test(txt)) {\r\n            var tgt = txt.split('/');\r\n            var bd = '/'+tgt[1]+'/';\r\n            if (own_posts_cb[bd] && own_posts_cb[bd][tgt[2]]===null) to_me = true;\r\n          }\r\n          if (to_me) {\r\n            if (pref.thread_reader.show_reply_to_me_by==='plain') as[i].parentNode.insertBefore(document.createTextNode(' (You)'), as[i].nextSibling);\r\n            else as[i].textContent = as[i].textContent + ' (You)'; // break dollchan.\r\n          }\r\n        }\r\n        if (add_name && own_posts && own_posts[post.no]===null) {\r\n          var pn_name = post.parse_funcs_html.pn_name(post);\r\n          if (pref.thread_reader.show_own_post_by==='plain') pn_name.parentNode.insertBefore(document.createTextNode(' (You)'), pn_name.nextSibling);\r\n          else pn_name.innerHTML = pn_name.innerHTML + ' (You)';\r\n        }\r\n      }\r\n      function check_1(post, watch, extracted_tags, extracted_posts){\r\n        var of_mine = own_posts && (post.no in own_posts);\r\n        if (of_mine) post.reply_of_mine = true;\r\n        if (!of_mine || !pref.catalog_footer_ignore_my_own_posts) {\r\n          var com = (com_or_txt)? post.com : post.body;\r\n          if (com) {\r\n            var to_me  = false;\r\n            if (own_posts) {\r\n              var anchors = com.match(regexp_anchor);\r\n              if (anchors!==null) {\r\n                for (var j=0;j<anchors.length;j++) {\r\n                  var tgt = anchors[j].substr(regexp_anchor_len);\r\n                  if (own_posts[tgt]===null) {to_me = true; break;}\r\n            }}}\r\n            if (!to_me && own_posts_cb) {\r\n              anchors = com.match(regexp_anchor_cb);\r\n              if (anchors!==null) {\r\n                for (var j=0;j<anchors.length;j++) {\r\n                  var tgt = anchors[j].split('/');\r\n                  var bd = '/'+tgt[1]+'/';\r\n                  if (own_posts_cb[bd] && own_posts_cb[bd][tgt[2]]===null) {to_me = true; break;}\r\n            }}}\r\n            if (to_me) {\r\n              post.reply_to_me = true;\r\n              watch[1]+=0x10000;\r\n            }\r\n          }\r\n          watch[1]++;\r\n        }\r\n        extracted_posts[extracted_posts.length] = post;\r\n        if (extracted_tags) check_t1(post, extracted_tags);\r\n      }\r\n      function check_t1(post, extracted_tags){\r\n        if (com_or_txt) {\r\n          var mail = post.com; // 4chan doesn't have 'mail'.\r\n          if (!mail) return;\r\n          mail = mail.replace(/<[^>]*>|&[^;]*;/g,' ');\r\n          if (pref.test_mode['47']) {\r\n            pn_tags.innerHTML = mail;\r\n            mail = pn_tags[brwsr.innerText];\r\n          }\r\n        } else {\r\n          if (post.editing) {\r\n            extracted_tags[extracted_tags.length] = post;// post.no;\r\n            return;\r\n          }\r\n          mail = post.body || post.txt; // post.com; // com must be html to keep consistency at creating DOM, ex. post_json2html.\r\n          if (!mail) return;\r\n        }\r\n        if (mail.indexOf('#')===-1) return; // short cut.\r\n        if (str_rm_list) for (var i=0;i<str_rm_list.length;i++) mail = mail.replace(str_rm_list[i],'\\n');\r\n        var tags = mail.match(liveTag.scan_regex);\r\n//        if (tags!==null) extracted_tags = extracted_tags.concat(tags);\r\n        if (tags!==null)\r\n          for (var i=0;i<tags.length;i++)\r\n            if (tags[i].length<=pref.liveTag.maxstr) {\r\n              if (tag_ex_list) {\r\n                for (var j=tag_ex_list.length-1;j>=0;j--) if (tag_ex_list[j].test(tags[i])) break;\r\n                if (j>=0) continue;\r\n              }\r\n              extracted_tags[extracted_tags.length] = tags[i];\r\n            }\r\n      }\r\n      function prep_check_1(th){\r\n        if (th.parse_funcs.type_com==='txt') {\r\n          regexp_anchor     = regexp_anchor_txt;\r\n          regexp_anchor_len = 2;\r\n          regexp_anchor_cb  = regexp_anchor_cb_txt;\r\n          com_or_txt        = false;\r\n        } else {\r\n          regexp_anchor     = regexp_anchor_com;\r\n          regexp_anchor_len = 8;\r\n          regexp_anchor_cb  = regexp_anchor_cb_com;\r\n          com_or_txt        = true;\r\n        }\r\n      }\r\n      function prep_check_t1(th){\r\n        if (pref.liveTag.ex_list) {\r\n          tag_ex_list = pref_func.merge_obj5a(th,pref.liveTag.ex_list_obj5,null);\r\n          str_rm_list = pref_func.merge_obj5a(th,pref.liveTag.rm_list_obj5,null);\r\n        } else {\r\n          tag_ex_list = null;\r\n          str_rm_list = null;\r\n        }\r\n//        tag_ex_list = (pref.liveTag.ex_list)? pref_func.merge_obj5(th.key,pref.liveTag.ex_list_obj5,null) : null;\r\n      }\r\n      return {\r\n        remake_own_posts : function(){remake_own_posts = true;}, // couldn't get an event from myself, so don't miss posts from my thread.\r\n        make_own_posts : function(){  // called also from catalog initialializer, prevent from being called twice at initial.\r\n          site2[site.nickname].prep_own_posts();\r\n          remake_own_posts = false;\r\n        },\r\n        add_you: add_you,\r\n        set_own_posts: function(th){\r\n          own_posts_cb = site3[th.domain].own_posts;\r\n          own_posts = own_posts_cb[th.board] || own_posts_cb['ALL']; // 'ALL' for meguca.\r\n//          own_posts = own_posts_cb[th.board];\r\n          if (Object.keys(own_posts_cb).length==0) own_posts_cb = undefined; // patch for faster execution.\r\n        },\r\n//        check_t1: check_t1,\r\n        check_t1_op: function(th){\r\n          prep_check_1(th);\r\n          prep_check_t1(th);\r\n          var extracted_tags = [];\r\n          check_t1(th, extracted_tags);\r\n////          watch[0] = (watch[0]&0xfffe0000) | 1; // BUG, WHY???\r\n//          watch[0] = (watch[0]&0xfffe0000);\r\n////          watch[2] = th.time; // requires many changes\r\n////          watch[2] = th.time_created; // requires many changes // BUG, WHY???\r\n          return extracted_tags;\r\n        },\r\n        get_checked_time: function(watch){\r\n//          return watch[2] + time_offset; // BUG.\r\n          return watch[2];\r\n        },\r\n        set_watch_time: function(watch, time, key){\r\n          if (time>0) {\r\n            watch[0] |= pref.test_mode['167']? 0x04000000 : 0x00040000;\r\n////          watch[2]  = time - time_offset; // to reduce memory usage, but doesn't effect. // BUG!!! watch[2] is initialized to 0, and not watched thread will enter with this. all threads must be initialized to '-time_offset'.\r\n//            watch[2]  = time;\r\n            if (watch[0]&0x00800000) watch[2] = time; // to reduce memory churn, this may require 'double' instead of Int32 for watch[2], CAUTION for compression.\r\n            else {\r\n              this.time_watch[key] = time;\r\n//              if (!track) this.time_watch[key] = time;\r\n//              else this.time_track[key] = time;\r\n              watch[0] &= 0xff7fffff;\r\n            }\r\n          }\r\n        },\r\n        set_watched_to_last: function(watch, time, key, track){\r\n          if (watch[0]&0x00800000 || !(watch[0]&0x00080000)) this.set_watch_time(watch, time, key);\r\n//          if (!track) this.set_watch_time(watch, time, key, track);\r\n          watch[1] = track || 0;\r\n        },\r\n        set_unwatch: function(watch){\r\n          watch[0] &= 0xfb73ffff; // 0xff73ffff;\r\n          watch[1] = 0;\r\n        },\r\n        time_watch:{},\r\n//        time_track:{},\r\n//        check: function(th, watch, make_pn){\r\n        check: function(th, lth, watch, notify, ext_posts, passive){ // watch[0]>0 && watch[3]>0 : usual check,\r\n          // watch[0]>0 && watch[3]<0 : retag, initialize tag but doesn't show new replies. (watch[3] must retain its value), and entry\r\n          // watch[0]<0 && watch[3]>0 : watchtime is updated. rescan new replies and show them. (watch[0] can be destroyed), BUG, can't entry.\r\n          // watch[0]<0 && watch[3]<0 : not used.\r\n          //\r\n          // watch[0] [15:0]: num of posts so far,\r\n          //          [16]: initial,\r\n          //          [17]: initial tag, retag,\r\n          //          [18]: watch_req, [19]:watching, [22:20]:archive,\r\n          //          [23]: watch time not initialized. (23,18) -> 10: not initialized, 11: watch_req, use watch[2], 01: watch_req, use tiem_watch, 00: usual state.\r\n          //          [24]: reentry of detection of deleted posts\r\n          //          [25]: posts_saved.\r\n          //          [26]: watching(passive).\r\n          // watch[1] number of unread replies to me << 16 + number of unread replies\r\n          // watch[2] checked time'\r\n          var tag_init = watch[0]&0x00020000; // patch for retag.\r\n//          var init = (watch[3]<0); // patch for retag.\r\n//          if (watch[3]<0) watch[3] = -watch[3];\r\n//          var time_check = watch[3];\r\n//          var time_check = watch[2] + time_offset; // BUG.\r\n          var time_check = watch[2];\r\n          var watchtime_changed = false;\r\n//          var time_lastsaw = (watch[3]>0)? watch[3] : watch[0];\r\n//          var time_lastsaw = (watch[3]>watch[0])? watch[3] : watch[0]; // redundant anymore.\r\n//          if (watch[0]<0) { // initial\r\n//            watch[0] = -watch[0];\r\n//            time_check = watch[0];\r\n//            watch[1] = 0;\r\n//            watch[2] = (watch[2]&0xfffe0000) + ((th.omitted_posts)? th.omitted_posts+1 : 0); // number of replies so far, patch for 4chan catalog_json.\r\n//            init     = true;\r\n//            watchtime_changed = true;\r\n//          }\r\n          var time_watch = watch[2];\r\n          var ur_old = liveTag.generate_ur(watch[1]);\r\n          if (watch[0]&0x00040000) { // initial\r\n//            time_watch = cataLog.get_watch_time_of_a_thread(th.key,th.time_created,null, true); // BUG, can't handle if time_watch===0(not watched).\r\n            if (watch[0]&0x00800000) {\r\n              time_check = 0;\r\n              watch[2] = 0;\r\n            } else {\r\n              time_watch = this.time_watch[th.key];\r\n//              var time_track = !this.time_watch[th.key] && this.time_track[th.key];\r\n//              time_watch = this.time_watch[th.key] || time_track;\r\n              delete this.time_watch[th.key];\r\n//              delete this.time_track[th.key];\r\n            }\r\n//            watch[2] = 0;\r\n            watch[1] = 0;\r\n            watch[0] = ((watch[0]&0xff7b0000) | 0x00080000)+ ((th.omitted_posts)? th.omitted_posts+1 : 0); // number of replies so far, patch for 4chan catalog_json.\r\n                      // &=0xff7fffff for entry by clicking WATCH triage.\r\n//            init     = true;\r\n            watchtime_changed = true;\r\n          }\r\n          var time_check_old = time_check;\r\n//console.log('start: '+dbt[0]+dbt[1]+dbt[2],watch[5]);\r\n          var watching = watch[0]&0x040c0000; // includes passive\r\nif (!passive) {\r\n          var i = th.posts.length-1;\r\n//          if (remake_own_posts) { // working code.\r\n//            site2[site.nickname].prep_own_posts(); // couldn't get an event from myself, so don't miss posts from my thread.\r\n//            remake_own_posts = false;\r\n//          }\r\n//          watch[2] = (th.posts[i].time*th.parse_funcs.time_unit || watch[2]) - time_offset; // BUG.\r\n          watch[2] = th.posts[i].time*th.parse_funcs.time_unit || watch[2];\r\n          if (th.parse_funcs.time_unit!=1) {\r\n            time_check = Math.floor(time_check/th.parse_funcs.time_unit);\r\n            time_watch = (watchtime_changed)? Math.floor(time_watch/th.parse_funcs.time_unit) : time_check;\r\n          }\r\n          var extracted_tags = (pref.liveTag.from==='post')? [] : null;\r\n          if (extracted_tags) prep_check_t1(th);\r\n//          var ur_old = liveTag.generate_ur(watch[1]);\r\n//          var watching = watch[0]&0x000c0000;\r\n          if (watching || extracted_tags) prep_check_1(th);\r\n          if (watching) {\r\n            if (remake_own_posts) this.make_own_posts();\r\n//            liveTag.mems[th.domain][th.board].nr = -1; // mark as dirty. // moved to out to include case of passive.\r\n            prep_check_1(th);\r\n            this.set_own_posts(th);\r\n            while (i>=0 && th.posts[i].time>time_watch) check_1(th.posts[i--], watch, extracted_tags, ext_posts); // extracting tags in op is redundant, because they are ALWAYS extracted.\r\n          }\r\n          if (extracted_tags) while (i>0 && (tag_init || th.posts[i].time>time_check)) check_t1(th.posts[i--], extracted_tags); // tuned for initial loop. don't extract tags in op.\r\n//          if (!common_obj.thread_reader) { // Why is this reqiured?\r\n//            if (extracted_tags && extracted_tags.length!=0) var tags = liveTag.extract_tags(th, extracted_tags, null, !tag_init); // 'check_update_tags_color' is called in this.\r\n//            else if (pref.liveTag.style.use && watching) {\r\n//              var ur = liveTag.generate_ur(watch[1]);\r\n//              if (ur_old!=ur) liveTag.update_ur(th.key,ur,ur_old!=0 && watchtime_changed); // can choose faster function if ur==0.\r\n//            }\r\n//          }\r\n////            if (pref3.stats.use && stats) stats.aggregate(th); // '&& stats' is a patch for embed_thread. // can't count deleted posts\r\n          if (time_watch!==time_check || !watching) {\r\n            i = th.posts.length;\r\n            while (i>0 && th.posts[i-1].time>time_check) i--;\r\n            var new_posts = i===0? th.posts : th.posts.slice(i);\r\n          }\r\n          if (pref3.stats.use) stats.aggregate(th, new_posts || ext_posts); // can count deleted posts\r\n} else { // passive is the same as nof_new_posts\r\n            if (watching) watch[1] += passive - (((watch[0]&0x0000ffff)===0 && watch[2]<0x10000)? watch[2] : 0); // means lth.nr += nof_new_posts - (lth.nof_posts===0? watch[2] : 0);\r\n//          if (pref3.stats.use && stats) stats.aggregate_passive(th, passive, date); // moved to outside of this function.\r\n}\r\n          if (extracted_tags && extracted_tags.length!=0) var tags = liveTag.extract_tags(th, extracted_tags, null, !tag_init); // 'check_update_tags_color' is called in this.\r\n//          else if (pref.liveTag.style.use && watching) {\r\n          if (watching) {\r\n            liveTag.dirtify_ur(th); // mark as dirty.\r\n            if (pref.liveTag.style.use) {\r\n              var ur = liveTag.generate_ur(watch[1]);\r\n              if (ur_old!=ur) liveTag.update_ur(lth,ur,ur_old!=0 && watchtime_changed); // can choose faster function if ur==0.\r\n            }\r\n          }\r\n          watch[0] = (watch[0]&0xfff90000) + th.nof_posts;\r\n//console.log('end:   '+dbt[0]+dbt[1]+dbt[2]);\r\n//if (pref.debug_mode['3'] && extracted_tags.length!=0) console.log(th.key+': '+extracted_tags);\r\n////////          if (cataLog.threads && cataLog.threads[th.key]) { // working code.\r\n//////////            if (!cataLog.threads[th.key][9][0]) cataLog.threads[th.key][9] = cataLog.catalog_filter_query(th.key); // doesn't work because threads[name][8] is NOT updated.\r\n////////            cataLog.insert_footer3(th.key,null,th.page,tags);\r\n////////          }\r\n          if (notify && (watch[0]&0x040c0000)) {\r\n//            if (ext_posts.length!=0 && pref.notify.desktop.notify && th.parse_funcs.add_op_img_url) th.parse_funcs.add_op_img_url(ext_posts,th.board,th.domain); // can't get 'com' if 'meguca'\r\n            if (pref.notify.desktop.notify) {\r\n              if (ext_posts.length!=0) site2[th.domain].wrap_to_parse.posts({posts:ext_posts, __proto__:th});\r\n              else if (passive) ext_posts[ext_posts.length] = {com: passive==1? 'a new reply.' : passive+' of new replies.', time:watch[2]};\r\n            }\r\n            notifier.changed(th, ext_posts); // time_track? [] : ext_posts);\r\n          }\r\n          return {tags:tags, posts:new_posts || ext_posts, time_check_old:time_check_old};\r\n        },\r\n      }\r\n    })(),\r\n\r\n////////    get_posts2 : function(doc,pool){return {}}, // subfunction of check_reply_to_me, parse html to json.\r\n    get_post_offsetTop : function(doc,num) {}, // get offsetTop of Nth object.\r\n    favicon: {\r\n      get_favicon: function(){\r\n        var links = document.getElementsByTagName('head')[0].getElementsByTagName('link');\r\n        for (var i=0;i<links.length;i++) if (links[i].getAttribute('rel')=='shortcut icon') return links[i];\r\n        var pn = document.createElement('link');\r\n        pn.setAttribute('rel','shortcut icon');\r\n        pn.setAttribute('href',this.none);\r\n        pn.setAttribute('type','image/x-icon');\r\n        return document.getElementsByTagName('head')[0].appendChild(pn);\r\n      },\r\n      get_title: function(){\r\n        var title = document.getElementsByTagName('head')[0].getElementsByTagName('title')[0];\r\n        if (!title){\r\n          title = document.createElement('title');\r\n          title = document.getElementsByTagName('head')[0].appendChild(title);\r\n        }\r\n        return title;\r\n      },\r\n    }, // object for favicon\r\n//    get_op_image_url: function(th,type){}, // get op image's url.\r\n    get_icon : function(){}, // get sticky icon.\r\n    add_icon : function(){}, // add sticky icon.\r\n    time_revised_check: function(nof_ths){return false;},\r\n\r\n    format_thread_layout   : function(thread){}, // formats its layout   for catalog.\r\n    format_thread_style    : function(thread){}, // formats its style    for catalog.\r\n    format_thread_contents : function(thread){}, // formats its contents for catalog.\r\n    format_thread_always   : function(thread){}, // formats its contents for catalog, always executed.\r\n////////    format_time            : function(thread){}, // formats its timestamp to local time.\r\n    format_remove_tn_area_size: function(thread){}, // remove thumbnail area size\r\n//    mark_newer_posts       : function(thread,time){return null;},  // mark newer posts, and returns marked first post.\r\n//    unmark_post_from_event : function(post){},  // unmark post.\r\n    mark_newer_posts2: function(posts,date,unmark, short_cut) {\r\n      date = date/this.parse_funcs.post_json.time_unit;\r\n      var marked_first_idx = null;\r\n      for (var i=posts.length-1;i>=0;i--) {\r\n        var pn = posts[i].pn\r\n        if (date<posts[i].time) {\r\n          pn.setAttribute('style', pref.style.post_new);\r\n          if (unmark) pn.addEventListener('mouseleave', this.unmark_post_from_event, false);\r\n          marked_first_idx = i;\r\n        } else {\r\n          if (short_cut) break;\r\n          if (pn.getAttribute('style')!=null) pn.removeAttribute('style');\r\n        }\r\n      }\r\n      return marked_first_idx;\r\n    },\r\n//    mark_newer_posts : function(nickname,posts,date, func, unmark, short_cut){ // working code\r\n////      var offset_top = 0;\r\n//      var marked_first_post = null;\r\n//      for (var i=posts.length-1;i>=0;i--) {\r\n////        var reply = posts[i];\r\n//////        posts[i] = posts[i].parentNode;\r\n//////        if (class_or_tag=='class') while (posts[i].className.search(key)==-1) posts[i] = posts[i].parentNode;\r\n//////        if (class_or_tag=='tag') while (posts[i].tagName.search(key)==-1) posts[i] = posts[i].parentNode;\r\n////        if (class_or_tag=='class') reply = posts[i].getElementsByClassName(key)[0];\r\n////        if (class_or_tag=='tag')  reply = posts[i].getElementsByTagName(key)[0];\r\n//        var reply = (func)? func(posts[i]) : posts[i];\r\n//        if (reply)\r\n//          if (date<site2[nickname].parse_funcs.post_html.time_pn(posts[i])) {\r\n//            reply.setAttribute('style', pref.style.post_new);\r\n////            if (!reply.style) reply.style = {};\r\n////            reply.style.border = '2px solid red'; // ca'nt use !important\r\n//            if (unmark) reply.addEventListener('mouseover', site2[nickname].unmark_post_from_event, false);\r\n////            offset_top = reply.offsetTop;\r\n//            marked_first_post = reply;\r\n//          } else {\r\n//            if (reply.getAttribute('style')!=null) reply.removeAttribute('style');\r\n//            if (short_cut) break;\r\n////            if (reply.style) reply.style.border = 'none';\r\n//          }\r\n//      }\r\n////      return offset_top;\r\n//      return marked_first_post;\r\n//    },\r\n    format_pn: function(pn,thq_no, pref_env, post, th){\r\n      if (!pref_env) pref_env = pref[cataLog.embed_mode];\r\n      if (pref_env.colorID) this.colorID(pn);\r\n      if (pref_env.backlink) this.backlink(pn,thq_no, th); // th for short href.\r\n      if (pref_env.localtime) this.localtime(pn);\r\n      if (post) { // BUG, CALLED TWISE TIMES for deleted posts in embed_mode==='thread'\r\n//        if (cataLog.embed_mode==='page' || cataLog.embed_mode==='thread') site2['DEFAULT'].check_reply.add_you(post, true); // \"cataLog.embed_mode==='page'\" is a patch.\r\n        site2['DEFAULT'].check_reply.add_you(post, true);\r\n        if (post.deleted_after) pn.classList.add('CatChan_deleted');\r\n        if (post.search_result!==undefined) site2[post.domain_html].update_posts0_class(pn, post.search_result);\r\n      }\r\n    },\r\n    colorID: function(){},\r\n    localtime: function(){},\r\n    unmark_post_from_event: function(e) {\r\n      e.currentTarget.removeEventListener('mouseleave', site2['common'].unmark_post_from_event, false);\r\n      site2['DEFAULT'].unmark_post(e.target);\r\n    },\r\n    unmark_post: function(pn) {\r\n      pn.removeAttribute('style');\r\n//      pn.setAttribute('style','border: none');\r\n    },\r\n    modify_thread_link     : function(thread){return [];}, // modify thread link and returns information to add event listener.\r\n    preprocess_html        : function(doc_txt){return doc_txt;},  // pre-process document from txt. // cause memory leak.\r\n//    preprocess_doc         : null, //function(doc){},  // pre-process document.\r\n////////    thread2headline : function(doc){return [0,0];},  // make headline from entire thread, returns num of [posts, images].\r\n//    add_thread_link : function(doc,url){}, // add link to this thread.\r\n    check_thread_archived : function(thread){return false;}, // check the thread is archived.\r\n    get_owners_recommendation: function(){return '';}, // return string of owner's recommendation.\r\n    get_board_tags : function(){return {};}, // return object of board tags.\r\n//    get_json_url_thread : function(board,thread){return '';}, // return url of JSON API.\r\n    get_json_url_catalog : function(board){return '';}, // return url of JSON API.\r\n//    parse_json_thread: function(txt,from_http){return JSON.parse(txt);}, // parser of JSON API.\r\n    parse_json_thread: function(obj,from_http){}, // parser of JSON API.\r\n//    parse_json_catalog: function(txt){return JSON.parse(txt);},  // parser of JSON API.\r\n    uip_tgt_post : function(no){return null;}, // returns uip target post.\r\n    uip_post_num : function(post){return null;}, // returns num in posts.\r\n    uip_check: function(callback){}, // hook for uip_tracker.\r\n    catalog_native_prep_sel: function(pn_filter, pn_tb, selector_native){\r\n      if (selector_native) {\r\n        if (selector_native.selectedIndex!=0) {\r\n          selector_native.selectedIndex = 0;\r\n          var evt = document.createEvent('UIEvents');\r\n          evt.initUIEvent('change', false, true, window, 1);\r\n          selector_native.dispatchEvent(evt);\r\n        }\r\n        selector_native.style.display = 'none';\r\n      }\r\n      var selector_catchan = pn_filter.getElementsByTagName('select')['catalog.order.ordering'];\r\n      selector_catchan.parentNode.removeChild(selector_catchan.nextSibling); // remove <br>\r\n      if (selector_native) selector_native.parentNode.insertBefore(selector_catchan,selector_native);\r\n      else pn_tb.childNodes[3].insertBefore(selector_catchan,pn_tb.childNodes[3].firstChild);\r\n    },\r\n    catalog_native_prep_swap_sortSel: function(sortSel){\r\n      sortSel.parentNode.insertBefore(cataLog.components.ordering, sortSel.nextSibling);\r\n      sortSel.setAttribute('style', 'display:none');\r\n    },\r\n    catalog_frame_prep: function(pn12){}, // prepare for frame mode.\r\n    catalog_native_frame_prep: function(pn12_button){ // prepare for frame mode in native catalog.\r\n      var mode = false;\r\n      var ifrm;\r\n      var pn_catalog;\r\n      function insert_remove_frame(){\r\n        if (!mode) {\r\n          pn_catalog = site2['common'].absorb_children(site.root_body);\r\n          pn_catalog.style.width = pref.catalog_size_frame0_width + '%';\r\n          pn_catalog.style.float = 'left';\r\n          pn_catalog.style.height = '' + window.innerHeight + 'px';\r\n          pn_catalog.style.overflow = 'scroll';\r\n          ifrm = site2[site.nickname].catalog_native_frame_prep_frame(site.root_body,null);\r\n        } else {\r\n          site.root_body.removeChild(ifrm);\r\n          ifrm = null;\r\n          site.embed_frame_win = null;\r\n          site2['common'].disgorge_children(pn_catalog);\r\n//          this.removeEventListener('click', insert_remove_frame, false);\r\n        }\r\n        mode = !mode;\r\n      }\r\n      pn12_button.addEventListener('click', insert_remove_frame, false);\r\n      return insert_remove_frame;\r\n    },\r\n    catalog_native_frame_prep_frame: function(parent,ref_node){\r\n      ifrm = document.createElement('iframe');\r\n      ifrm.setAttribute('name',site.embed_frame);\r\n      ifrm.style.height = '' + window.innerHeight + 'px';\r\n      ifrm.style.margin = '0px';\r\n      ifrm.style.width = pref.catalog_size_frame1_width + '%';\r\n      parent.insertBefore(ifrm,ref_node);\r\n      site.embed_frame_win = ifrm.contentWindow;\r\n      return ifrm;\r\n    },\r\n    catalog_embed_prep: function(pn12){ // https://developer.mozilla.org/ja/docs/Web/API/HTMLElement/style, reset by null.\r\n      pn12.style.position = null;\r\n      pn12.childNodes[1].style.width = null;\r\n      pn12.childNodes[1].style.height = window.innerHeight + 'px';\r\n      pn12.childNodes[0].childNodes[0].style.display = 'none';\r\n      pn12.childNodes[0].childNodes[1].style.display = 'none';\r\n      pn12.style.border = null;\r\n      pn12.style.left = null;\r\n      pn12.style.resize = null;\r\n      pn12.style.top = null;\r\n    },\r\n    thread2search_obj : function(thread){return [thread[brwsr.innerText],'','','','','','',''];}, // return search_obj from thread.\r\n////    get_click_area: function(pn){\r\n////      var img = pn.getElementsByTagName('img');\r\n////      return (img.length!=0)? img : pn;\r\n////    },\r\n//    get_click_area: function(pn){\r\n//      var img0 = pn.getElementsByTagName('img')[0];\r\n//      return (img0)? img0 : pn;\r\n//    }\r\n    popups_posts: (function(){\r\n      function up_timer_factory(){\r\n        var up_timer = null;\r\n        var up_e = null;\r\n        var up_func = null;\r\n        var up_pf = null;\r\n        var up_src = null;\r\n        function over_0(pf, e, func, src){\r\n          if (pf.popdown==='imm') func(e);\r\n          else {\r\n            if (!src) src = e.target;\r\n            if (pf.popup_mMove) src.addEventListener('mousemove', over_1, false);\r\n            up_func = func;\r\n            up_pf = pf;\r\n            up_src = src;\r\n            over_1(e, true);\r\n          }\r\n        }\r\n        function over_1(e, force){\r\n          if (!up_timer && !force) return; // for racing condition\r\n          if (up_timer) clearTimeout(up_timer);\r\n          up_timer = setTimeout(timer_end, up_pf.popup_delay);\r\n          up_e = e;\r\n        }\r\n        function timer_end(stop){ // this may be fired twice, because this has a racing condition between finish of up_timer and over_1 event. // FIXED.\r\n          if (stop) clearTimeout(up_timer);\r\n          up_timer = null;\r\n          if (up_pf.popup_mMove) up_src.removeEventListener('mousemove', over_1, false);\r\n          if (!stop) up_func(up_e);\r\n        }\r\n        return {\r\n          over: over_0,\r\n          stop: function(){\r\n            if (up_timer) {timer_end(true);return true;}\r\n            return false;\r\n          },\r\n          get up_timer(){return up_timer;},\r\n          out: function(e){\r\n            if (e.relatedTarget===erT_done) {erT_done = null; return e.relatedTarget;}\r\n            else return this.stop();\r\n          },\r\n        };\r\n      }\r\n      var pns = new Map();\r\n      var erT_done = null;\r\n      function out_1_if_exists(src, pn_ex, imm){\r\n        var pn = pns.get(src);\r\n        if (pn)\r\n          if (!Array.isArray(pn)) {if (pn!==pn_ex) out_1(pn, imm);}\r\n          else for (var i=0;i<pn.length;i++) if (pn[i] && pn[i]!==pn_ex) out_1(pn[i], imm);\r\n      }\r\n      function out_1(pn, imm){\r\n        var info = pns.get(pn);\r\n        var pf = info.pf && info.pf() || pref.proto;\r\n        if (imm || pf.popdown==='imm') pop_down(pn);\r\n        else info.timer = setTimeout(pop_down.bind(null,pn), pf.popdown_delay);\r\n      }\r\n      function pop_setup(src, pn, obj, pna){\r\n        pns.set(src, pna || pn);\r\n        pns.set(pn, obj || {src:src}); // bi-directional\r\n        pn.addEventListener('mouseenter',pop_over, false);\r\n        pn.addEventListener('mousedown',cnst.div_mousedown,false);\r\n      }\r\n      function pop_down(pn, snatch){\r\n        if (pn && pn.parentNode) {\r\n          if (!snatch) pn.parentNode.removeChild(pn);\r\n          var info = pns.get(pn);\r\n          if (info.key) posts.pop_load_req_delete(info.key, pn);\r\n          if (info.chart && !snatch) info.chart.destroy();\r\n          if (info.scroll) pn.removeEventListener(brwsr.mousewheel, cnst.div_scroll, false);\r\n          var src = info.src;\r\n          var pna = pns.get(src);\r\n          if (Array.isArray(pna)) {\r\n            pna[pna.indexOf(pn)] = null; // keep position, not splice\r\n            for (var i=0;i<pna.length;i++) if (pna[i]) break;\r\n            if (i==pna.length) pns.delete(src);\r\n          } else pns.delete(src);\r\n          pns.delete(pn);\r\n          pn.removeEventListener('mouseenter', pop_over, false);\r\n          pn.removeEventListener('mousedown',cnst.div_mousedown,false);\r\n          if (snatch) {\r\n            pn.removeEventListener('mouseleave', pop_out, false);\r\n            return info;\r\n          }\r\n        }\r\n      }\r\n      function pop_over(e){\r\n        var ecT = e.currentTarget;\r\n        var info = pns.get(ecT);\r\n        var pf = info.pf && info.pf() || pref.proto;\r\n        if (pf.popdown==='imm') pop_down(ecT);\r\n        else {\r\n          if (info.timer) clear_down_timer(info);\r\n          erT_done = e.relatedTarget;\r\n          ecT.addEventListener('mouseleave', pop_out, false);\r\n        }\r\n      }\r\n      function pop_out(e){\r\n        var ecT = e.currentTarget;\r\n        ecT.removeEventListener('mouseleave', pop_out, false);\r\n        out_1(ecT);\r\n      }\r\n      function clear_down_timer(info){clearTimeout(info.timer); info.timer=null;}\r\n\r\n      var hist_x = 'left';\r\n      var hist_y = 'top';\r\n      var ddEcW = 0;\r\n      var ddEcH = 0;\r\n      function set_pos(pn, e, hist, narrow_x, narrow_y){\r\n        var factor_x = (!hist)? 0.5 : (hist_x==='left')? 3/4 : 1/4;\r\n        var factor_y = (!hist)? 0.5 : (hist_y==='top')?  4/5 : 1/5;\r\n        ddEcW = document.documentElement.clientWidth;\r\n        ddEcH = document.documentElement.clientHeight;\r\n        var oX = pref.proto.popup3.oX;\r\n        var oY = pref.proto.popup3.oY;\r\n        if (ddEcW*factor_x-e.clientX>0 ^ narrow_x) {pn.style.left = e.clientX + oX + 'px'; hist_x='left';}\r\n        else {pn.style.right = ddEcW - e.clientX + oX + 'px'; hist_x='right';}\r\n        if (ddEcH*factor_y-e.clientY>0 ^ narrow_y) {pn.style.top = e.clientY + oY + 'px'; hist_y='top';}\r\n        else {pn.style.bottom = ddEcH - e.clientY + oY + 'px'; hist_y='bottom';}\r\n//        if (document.documentElement.clientWidth/2-e.clientX>0) pn.style.left = e.clientX + 10 + 'px';\r\n//        else pn.style.right = document.documentElement.clientWidth - e.clientX + 10 + 'px';\r\n//        if (document.documentElement.clientHeight/2-e.clientY>0) pn.style.top = e.clientY + 10 + 'px';\r\n//        else  pn.style.bottom = document.documentElement.clientHeight - e.clientY + 10 + 'px';\r\n      }\r\n      function adjust_pos(pn, e){\r\n        var s = pn.style;\r\n        var tb = parseInt(s.top?s.top:s.bottom,10);\r\n        var visible_v = pn.offsetHeight + tb < ddEcH;\r\n        if (!visible_v && tb > ddEcH*0.5) {\r\n          var h = ddEcH - pn.offsetHeight;\r\n          var pos = (h<0? 0:h)+'px';\r\n          if (s.top) {s.top = pos; hist_y = 'bottom';}\r\n          else {s.bottom = pos; hist_y = 'top';}\r\n        }\r\n        var lr = parseInt(s.left?s.left:s.right,10);\r\n        var visible_h = pn.offsetWidth + lr < ddEcW;\r\n        if (!visible_h && lr > ddEcW*0.5) {\r\n          var pos = ddEcW - parseInt(s.left?s.left:s.right,10)+20 + 'px';\r\n          if (s.left) {s.right = pos; s.left = null;}\r\n          else {s.left = pos; s.right = null;}\r\n        }\r\n      }\r\n\r\n      var blacklist = new WeakSet();\r\n      var geh;\r\n      function etHref2domain(et){\r\n        return href2domain(et.getAttribute('href')) || href2domain(et.href); // et.href is patch for backlinks in 4chan page\r\n      }\r\n      function href2domain(href){\r\n        if (href[0]==='/' || href[0]==='#') return site.nickname;\r\n        else for (var d in liveTag.mems) if (href.indexOf(site2[d].domain_url)!=-1) return site2[d].nickname;\r\n        for (var d in site2) if (href.indexOf(site2[d].domain_url)!=-1) return /*site2[d].nickname_href2domain ||*/ site2[d].nickname;\r\n      }\r\n      var up0 = up_timer_factory(); // surface\r\n      var up1 = up_timer_factory(); // surface for infoPreview\r\n      function over(e, force){ // image_hover can be merged to this, and popup2 also. e.path can be created easily, mouseenter can be replaced to mouseover.\r\n        out(e);\r\n        var et = e.target;\r\n        var pf_mode = pref[cataLog.embed_mode];\r\n        if (pf_mode.popup && et.tagName==='A' && site2['DEFAULT'].popups_link_regex.test(et.textContent)) posts.over(e, force);\r\n        else if ((pf_mode.image_hover || pf_mode.infoPv.use) && geh.isThumbnail(e)) {\r\n          if (pf_mode.image_hover) up0.over(pf_mode.thumbnail.hover, e, cataLog.DIH.image_hover_add);\r\n          if (pf_mode.infoPv.use) up1.over(pf_mode.infoPv, e, cataLog.InfoPv.show);\r\n        } else if (pf_mode.popupX.use) up0.over(pf_mode.popupX, e, popupSurface.X);\r\n//        else if (pref.test_mode['121'] && geh.getID(et)) up0.over(pf_mode.popupID, e, popupSurface.ID);\r\n//        else if (pref.test_mode['121'] && geh.getName(et)) up0.over(pf_mode.popupName, e, popupSurface.Name);\r\n//        else if (pref.test_mode['121'] && geh.getTrip(et)) up0.over(pf_mode.popupTrip, e, popupSurface.Trip);\r\n//        else if (pref.test_mode['121'] && geh.getCountry(et)) up0.over(pf_mode.popupFlag, e, popupSurface.Flag);\r\n      }\r\n      function out(e){\r\n        cataLog.DIH.image_hover_remove(e);\r\n        if (up0.out(e)) return;\r\n        var erT = e.relatedTarget;\r\n//        if (erT) out_1_if_exists(erT); // cause too many errors\r\n        if (erT && (erT.tagName==='A' || popupSurface.et)) out_1_if_exists(erT);\r\n        popupSurface.et= null;\r\n//        if (erT && (erT.tagName==='A' || pref.test_mode['121'] && (geh.getID(erT) || geh.getName(erT) || geh.getTrip(erT) || geh.getCountry(erT)))) out_1_if_exists(erT);\r\n//        if (erT && erT.tagName==='A') out_1_if_exists(erT);\r\n//        if (erT===erT_done) erT_done = null;\r\n//        else if (up0.stop()) return;\r\n//        else if (erT && erT.tagName==='A') {\r\n//          var info = pns.get(erT);\r\n//          if (info) out_1(info);\r\n//        }\r\n        cataLog.InfoPv.hide();\r\n        up1.out(e);\r\n      }\r\n      var posts = (function(){\r\n        function over(e, force){\r\n          if (pref.proto.popup_hlt && post_highlight_if_visible(e)) return;\r\n          up0.force = force\r\n          up0.over(pref.proto, e, pop_up);\r\n          var domain = etHref2domain(e.target);\r\n          if (domain!==site.nickname) e.stopPropagation(); // prevent striking(----) because of being taken as a deleted post in 4chan.\r\n        }\r\n        function pop_up(e){\r\n          var force = up0.force;\r\n          var et = e.target;\r\n          if (pns.has(et)) {clear_down_timer(pns.get(pns.get(et))); return;}\r\n          var domain = etHref2domain(et);\r\n          if (!force && pref[cataLog.embed_mode].env.popup_native) {\r\n            if (pref[cataLog.embed_mode].env.event_dynamic && !pref.test_mode['100']) {\r\n              if (site.nickname===domain) return; // 4chan\r\n            } else if (blacklist.has(et)) return // { // working code, but can't surpress dual popup.\r\n  //            if (pref[cataLog.embed_mode].env.popup_native_kill) {\r\n  //              var pn = blacklist.get(et);\r\n  //              if (pn===null) {\r\n  //                pn = et.cloneNode(true);\r\n  //                pn.setAttribute('style','position:relative;left:-'+et.offsetWidth+'px;'); // to cause mouseout to popdown native popup.\r\n  //                et.parentNode.insertBefore(pn,et.nextSibling);\r\n  //                blacklist.set(pn,et);\r\n  //              } else {\r\n  //                et.parentNode.removeChild(et.previousSibling);\r\n  //                et.removeAttribute('style');\r\n  //                blacklist.delete(et);\r\n  //              }\r\n  //            } else return;\r\n  //          }\r\n          }\r\n          pop_make(e, domain);\r\n        }\r\n        function pop_make(e, domain){\r\n          var obj = popups_post_entry(e, domain);\r\n          if (obj) {\r\n            pop_style(e,obj.pn);\r\n            pop_setup(e.target, obj.pn, obj.key? {src:e.target, key:obj.key} : null);\r\n          }\r\n          return obj.pn;\r\n        }\r\n        function inline_post(e, clg){\r\n          var domain = etHref2domain(e.target);\r\n          if (e.shiftKey || pref[clg.mode].inline_post==='jump') {\r\n            var pn = clg.jump_to_post(site2[domain].popups_href2th_q(e.target.getAttribute('href'))[2]);\r\n            if (pn) {\r\n              pn.classList.add(site2[site.nickname].popups_posts_class_hlt); // 4chan uses post:target, this is the better\r\n              pn.addEventListener('mouseleave', post_jump_remove_highlight, false);\r\n            }\r\n          } else inline_toggle(e, domain);\r\n        }\r\n        var pns_inline = new WeakMap(); // WeakMap for recursive remove\r\n        function inline_toggle(e, domain){\r\n          var et = e.target;\r\n          var pn = pns_inline.get(et);\r\n          if (pn) {\r\n            pn.parentNode.removeChild(pn);\r\n            pns_inline.delete(et);\r\n          } else {\r\n            var obj = popups_post_entry(e, domain);\r\n            if (obj) {\r\n              et.parentNode.insertBefore(obj.pn, et.nextElementSibling);\r\n              pns_inline.set(et,obj.pn);\r\n            }\r\n          }\r\n        }\r\n        function post_jump_remove_highlight(e){\r\n          e.currentTarget.removeEventListener('mouseleave',post_jump_remove_highlight, false);\r\n          e.currentTarget.classList.remove(site2[site.nickname].popups_posts_class_hlt);\r\n        }\r\n\r\n        var keys_loading = new Map();\r\n        function pop_load(key, domain){\r\n          var tgts = keys_loading.get(key);\r\n          if (tgts) {\r\n            for (var i=tgts.length-1;i>=0;i--) { // must be backward, tgts[i] will be removed in pop_down\r\n              var tgt = tgts[i]; // backup is needed, pop_down removes tgts[i] itself.\r\n              var pn = pns.get(tgt.target);\r\n              if (pn) {\r\n                pop_down(pn); // removes tgts[i]\r\n                var pn2 = pop_make(tgt,domain);\r\n//                if (pn.style.left) pn2.style.left = pn.style.left; else pn2.style.right = pn.style.right; // BUG. creates too narrow popups.\r\n//                if (pn.style.top) pn2.style.top = pn.style.top; else pn2.style.bottom = pn.style.bottom;\r\n              }\r\n              var pn_inline = pns_inline.get(tgt.target);\r\n              if (pn_inline) {\r\n                inline_toggle(tgt,domain); // toggle, remove\r\n                inline_toggle(tgt,domain); // toggle, add\r\n              }\r\n            }\r\n            keys_loading.delete(key);\r\n          }\r\n        }\r\n        function pop_load_req(e, key, pn){\r\n          var val = {target:e.target, clientX:e.clientX, clientY:e.clientY, pn:pn};\r\n          var tgts = keys_loading.get(key);\r\n          if (tgts) tgts.unshift(val); // reverse ordering.\r\n          else keys_loading.set(key,[val]);\r\n        }\r\n        function pop_load_req_delete(key, pn){\r\n          var tgts = keys_loading.get(key);\r\n          if (tgts) {\r\n            for (var i=tgts.length-1;i>=0;i--) if (tgts[i].pn===pn) tgts.splice(i,1);\r\n            if (tgts.length===0) keys_loading.delete(key);\r\n          }\r\n        }\r\n  \r\n        function post_highlight_if_visible(e){\r\n          var href = e.target.getAttribute('href'); // keep as it is, et.href may be %xx%yy.\r\n          var domain = etHref2domain(e.target); // patch for backlinks in 4chan page\r\n          var th_q = site2[domain].popups_href2th_q(href);\r\n          var no = th_q[1];\r\n          var tgt_th = cataLog.threads[th_q[0].key];\r\n          var posts = tgt_th && tgt_th[16] && tgt_th[16].posts;\r\n          if (posts) {\r\n            for (var i=posts.length-1;i>=0;i--) if (posts[i].no===no) break;\r\n            var pn = (i>=0)? posts[i].pn : undefined;\r\n            if (pn && window.getComputedStyle(pn).display!=='none') {\r\n              var oT = pn.offsetTop;\r\n              var sT = brwsr.document_body.scrollTop;\r\n              if (oT>sT && oT+pn.offsetHeight<sT+document.documentElement.clientHeight) { // temporal, embed only. see 'get_ref_height'.\r\n                pn.classList.add(site2[site.nickname].popups_posts_class_hlt);\r\n                e.target.addEventListener('mouseout',post_highlight_end, false);\r\n                pns.set(e.target, pn);\r\n                post_dotted_if_multi_anchors(pn, e, {domain_html:pref.catalog.mimic_base_site? site.nickname : domain});\r\n                return true;\r\n              }\r\n            }\r\n          }\r\n          return false;\r\n        }\r\n        var an_dotted = null;\r\n        function post_highlight_end(e){\r\n          var et = e.target;\r\n          et.removeEventListener('mouseout',post_highlight_end, false);\r\n          pns.get(et).classList.remove(site2[site.nickname].popups_posts_class_hlt);\r\n          pns.delete(et);\r\n          if (an_dotted) {\r\n            an_dotted.classList.remove('dotted');\r\n            an_dotted = null;\r\n          }\r\n        }\r\n        function post_dotted_if_multi_anchors(pn, e, th){\r\n          if (!pref.test_mode['108']) {\r\n            var ce = site2[th.domain_html].post_pn2ce(pn); // patch for catalog_html, whose th.posts[0].pn is the same as th.pn, this doesn't give ce, but the caller generates pn from it.\r\n            var as = ce? ce.getElementsByTagName('a') : undefined;\r\n            if (as && as.length>1) {\r\n              var src_no = geh.an2srcNo(e.target,th);\r\n//              var pn_post = site2[th.domain_html].post_an2pn(e.target);\r\n//                var src_no = site2[th.domain_html].parse_funcs['post_html'].no({pn:pn_post});\r\n              if (src_no) for (var i=0;i<as.length;i++) {\r\n                var href = as[i].getAttribute('href');\r\n                if (href && site2[th.domain_html].popups_href2dbtp(href)[3]==src_no) {\r\n                  as[i].classList.add('dotted');\r\n                  an_dotted = as[i];\r\n                  break;\r\n                }}}}\r\n        }\r\n        function popups_fetched_1(th, lth, no, post){\r\n    //      post.parse_funcs = th.parse_funcs; // redundant???  // CAUSED A BUG, parse_funcs are archived and stop its prototype chain.\r\n    //      if (th.type_data==='html') this.popups_fetched_html(post, th); // wrap_to_parse.post and prepare_html_extract_params should be used, but not debugged, left this.\r\n          cataLog.format_html.prepare_html_prep_posts({posts:[post], __proto__:th}) // wrap_to_parse is in this.\r\n//          site2[th.domain].wrap_to_parse.posts({posts:[post], __proto__:th});\r\n          cataLog.format_html.prepare_html_post(th, post, lth.q);\r\n//          site2['DEFAULT'].popups_add_1(th, post, false, lth.q, false); // cut quote link.\r\n    //      this.popups_set(lth.q, no, post); // BUG, this doesn't update quotes, this will be appear in multiple popup mode, use popups_add_1.\r\n    //                                               // In single popup mode, this cut quote links and reduce memory consumption.\r\n    ////      this.popups_set(lth.q, i, (th.type_data==='json')? post : this.popups_fetched_html(post, th)); // BUG, this deletes quote.\r\n        }\r\n        function popups_try_fetch_from_lth_ta(lth, no, th){\r\n          if (lth.ta) for (var i=lth.ta.posts.length-1;i>=0;i--) if (lth.ta.posts[i].no==no) {\r\n            var post = lth.ta.posts[i];\r\n            var th = {domain_html: th.domain_html, lth:lth, type_data:post.type_data || (post.pn? 'html':'json'), posts:[post], __proto__:lth};\r\n            popups_fetched_1(th, lth, no, post);\r\n            return;\r\n          }\r\n        }\r\n        function popups_post_entry(e, domain){\r\n          var th_q = site2[domain].popups_href2th_q(e.target.getAttribute('href'));\r\n          if (!th_q) return;\r\n          var dbt = th_q[2];\r\n  //        if (pref[cataLog.embed_mode].env.event_dynamic && pref[cataLog.embed_mode].env.popup_native && site.nickname===th.domain && pref.test_mode['98']) return;\r\n          var pn;\r\n          var thqp = th_q[0][th_q[1]];\r\n          var isOP = dbt[3] == dbt[2]; // thqp.no == dbt[2]; // == must be used, typeof(dbt[2]) is string.\r\n          var lth = th_q[3];\r\n          var th = {domain:domain, domain_html: pref.catalog.mimic_base_site? site.nickname : domain, posts:[thqp], lth:lth, __proto__:lth};\r\n          if (thqp===undefined && pref.test_mode['80']) { // patch\r\n            th.no = th_q[2][2];\r\n            var boards = ['_IDB/', '_File/'];\r\n            for (var i=0;i<2;i++) {\r\n              th.board = th_q[2][1].slice(0,-1)+boards[i];\r\n              var th_q0 = liveTag.mems[th.domain][th.board] && liveTag.mems[th.domain][th.board][th.no] && liveTag.mems[th.domain][th.board][th.no].q;\r\n              if (th_q0) {\r\n                th_q[0] = th_q0;\r\n                break;\r\n              }\r\n            }\r\n          }\r\n          if (thqp===undefined || Array.isArray(thqp)) {\r\n            popups_try_fetch_from_lth_ta(lth, parseInt(dbt[3],10), th); // may change thqp, th for domain_html(mimic)\r\n            thqp = th_q[0][th_q[1]];\r\n          } else if (thqp && !thqp.pn) popups_fetched_1(th, lth, dbt[2], thqp);\r\n          if (thqp===undefined || Array.isArray(thqp)) { // 'thqp===undefined' for multilevel popups.\r\n            site2[th.domain].popups_post_fetch(th, dbt);\r\n  //          cataLog.scan_init('popup',[th.domain+dbt[1]+((pref.catalog.catalog_json)? 't':'')+dbt[2]], {priority:8});\r\n            pn = site2[th.domain_html].post_json2html({time: Date.now(), com:'Loading...', domain:domain, board:dbt[1], no:dbt[2]}, dbt[1]); // board and no is not used now, just a insurance.\r\n            var key = dbt[0]+dbt[1]+dbt[2]+'#'+dbt[3];\r\n            pop_load_req(e, key, pn);\r\n  //          site2['DEFAULT'].popup_info = {node:et, clientX:e.clientX, clientY:e.clientY, key:dbt[0]+dbt[1]+dbt[2]+'#'+dbt[3], func_out:site2['DEFAULT'].popups_posts.pop_down.bind(null,pn)}; //out};\r\n            site2['DEFAULT'].popups_set_waiting(th_q[0],th_q[1]);\r\n          } else {\r\n  //          if (site2['DEFAULT'].popup_info) site2['DEFAULT'].popup_info.func_out();\r\n  //          if (site2['DEFAULT'].popup_info) et.onmouseout(); // BUG at editing, sometimes out is never issued because of being replaced.\r\n  //          if (!thqp.pn || thqp.isOP || thqp.type_data==='html') {\r\n            if (!thqp.pn || isOP && (site.nickname!=='4chan' || site.whereami!=='thread')) {\r\n//            if (!thqp.pn || isOP && !pref.test_mode['105']) { // test\r\n  //          if (!thqp.pn || thqp.isOP || pref.proto.popdown!=='imm') { // BUG, this requires exact extraction of country, country_name or data for images even from html.\r\n              if (!thqp.domain) { // PATCH, use prototype of liveTag.mems.\r\n                var tgt = thqp;\r\n                tgt.domain = th.domain;\r\n                if (tgt.extra_files) for (var i=0;i<tgt.extra_files.length;i++) tgt.extra_files[i].domain = th.domain;\r\n              }\r\n              pn = site2[th.domain_html].post_json2html(thqp, dbt[1]);\r\n            } else pn = thqp.pn.cloneNode(true);\r\n            cataLog.format_html.prep_anchor_links(pn, th_q[0]);\r\n            site2[th.domain_html].format_pn(pn, thqp, null, null, th_q[0]);\r\n            post_dotted_if_multi_anchors(pn, e, th);\r\n          }\r\n          gGEH.pns_all_keys.set(pn,dbt[0]+dbt[1]+dbt[2]);\r\n          if (pref.debug_mode['10']) console.log('popup: '+th_q[1]+': '+site2[th.domain].popups_debug(th_q[0]));\r\n          return key? {pn:pn, key:key} : {pn:pn};\r\n        }\r\n        function pop_style(e,pn){\r\n          pn.style = {};\r\n          pn.style.position = 'fixed';\r\n          set_pos(pn,e, true);\r\n  //        pn.style.left = e.clientX + 10 + 'px';\r\n  //        if (!pref.test_mode['25']) pn.style.top  = e.clientY -15 + 'px';\r\n  //        else pn.style.bottom  = window.innerHeight - e.clientY + 20 + 'px';\r\n          pn.style.zIndex = pref[cataLog.embed_mode].popup_zIndex;\r\n          if (site.nickname!=='KC') pn.style.borderStyle = 'solid';\r\n          pn.style.boxShadow = 'rgb(153, 153, 153) 1px 1px 1px';\r\n          if (site.nickname==='4chan') {\r\n            pn.classList.add('preview');\r\n            pn.style.display = 'block';\r\n          }\r\n  //        if (thqp.isOP) site2[th.domain_html].popups_op_func_use(pn,th_q[0], th_q[1]);\r\n          site2[site.nickname].popups_post_pnode(e.target).appendChild(pn);\r\n  //        site2['DEFAULT'].popups_posts.set(et,pn);\r\n  //        site2['DEFAULT'].popup_info = null;\r\n  //        }\r\n          adjust_pos(pn,e);\r\n        }\r\n        gGEH.triage_in2 = out;\r\n        return {\r\n          over: over,\r\n          pop_load: pop_load,\r\n          pop_load_req_delete: pop_load_req_delete,\r\n          inline_post: inline_post,\r\n        };\r\n      })();\r\n\r\n      var dnd_mode = false;\r\n      var preview = (function(){\r\n        var up_th = up_timer_factory();\r\n        var on_th = null;\r\n        var on_clg = null;\r\n        function th_over(e, tgt, clg){\r\n          var pf3 = pref[clg.mode].popup3;\r\n          if (pf3.ww==='no' && pf3.wn==='no' && pf3.nw==='no' && pf3.nn==='no') return;\r\n//          var tgt = geh.recSearch_thread(e.target, e.currentTarget);\r\n          if (tgt && !dnd_mode) {\r\n            if (on_th===tgt || up_th.up_timer && up_th.src===tgt) return;\r\n            th_out(e);\r\n            up_th.src = tgt;\r\n            on_clg = clg;\r\n            up_th.over(pf3, e, pop_up_th, tgt);\r\n          } else th_out(e);\r\n        }\r\n        function th_out(e, imm){\r\n          var pn_ex = up_th.out(e);\r\n          if (pn_ex===true) return;\r\n          var tgt = geh.recSearch_thread(e.relatedTarget,e.currentTarget) || on_th;\r\n          if (tgt) out_1_if_exists(tgt,pn_ex,imm);\r\n          on_th = null;\r\n          on_clg = null;\r\n        }\r\n        function pop_up_th(e){\r\n          if (!on_clg) return; // for racing condition.\r\n  //        if (pns.has(up_th.src)) {clear_down_timer(pns.get(up_th.src)); return;}\r\n          var name = gGEH.get_key_recursive(up_th.src, document);\r\n//          var name = up_th.src.name;\r\n//          var pf = pref[cataLog.embed_mode].popup3;\r\n          var pna = pns.get(up_th.src) || [];\r\n          var pf3 = pref[on_clg.mode].popup3;\r\n          if (!pref.test_mode['110']) pop_up_th_1(pf3.ww, e, name, pna, 0, false, false);\r\n          pop_up_th_1(pf3.wn, e, name, pna, 1, false, true);\r\n          pop_up_th_1(pf3.nw, e, name, pna, 2, true, false);\r\n          pop_up_th_1(pf3.nn, e, name, pna, 3, true, true);\r\n          on_th = up_th.src\r\n          up_th.src = null;\r\n        }\r\n        function pop_up_th_1(kind, e, name, pna, idx, narrow_x, narrow_y, kwd, kwd_src){ // kwd for popupID\r\n          if (kind==='no') return;\r\n          if (pna[idx]) {clear_down_timer(pns.get(pna[idx])); return;}\r\n          var pn = document.createElement('div');\r\n          pn.setAttribute('class', pref.script_prefix+'_window');\r\n  //        pn.style.width = '200px';\r\n  //        pn.style.height = '200px';\r\n          pn.style.position = 'fixed';\r\n  //        pn.style.backgroundColor = 'red';\r\n  //        pn.innerHTML = up_th.src.getAttribute('id');\r\n          pn.style.border = '1px solid blue';\r\n          pn.style.zIndex = pref.proto.popup3.popup_zIndex;\r\n          if (kind!=='chart') if (!on_clg.pop_up_set_contents(pn, kind, name, kwd)) return;\r\n          pn.addEventListener(brwsr.mousewheel, cnst.div_scroll, false);\r\n          set_pos(pn, e, false, narrow_x, narrow_y);\r\n          pna[idx] = site.popup_body.appendChild(pn); // for chart, must be preceded before making chart.\r\n          if (kind==='chart') {\r\n            if (chart_obj && pref3.stats.use) {\r\n              var base = on_clg.merge_bases.bases[name];\r\n              var chart = new chart_obj.PostChart(pn, base && base.pn===up_th.src && base.keys || [name]); // must be after appendChild to draw. (just to call destroy?)\r\n            } else pn.innerHTML = 'Statistics needs to be activated.';\r\n          }\r\n          pn.dataset.isPopup = 'true';\r\n//          if (pref.catalog_popup_size_fix) {\r\n//            pn.style.width  = pn.offsetWidth + 'px';\r\n//            pn.style.height = pn.offsetHeight + 'px';\r\n//          }\r\n          cnst.tack_for_popup(pn, function(e){\r\n//          var btn = document.createElement('button');\r\n////          common_func.overwrite_prop(btn.style, {position:'absolute', top:'0px', left:'0px'});\r\n//          btn.classList.add(pref.script_prefix+'_autoTp');\r\n//          btn.appendChild(site2[site.nickname].make_tack());\r\n//          pn.appendChild(btn);\r\n//          btn.onclick = function(e){\r\n            var btn = e.currentTarget;\r\n            var pn = btn.parentNode;\r\n//            cnst.bottom_top(pn);\r\n            var pn2;\r\n            var chart = pop_down(pn,true).chart;\r\n            if (chart) {\r\n              var tn = document.createElement('div');\r\n              var tn_imgs = site2[common_func.name2dbt(name)[0]].parse_funcs['catalog_html'].tn_imgs({pn:cataLog.threads[name][0]});\r\n              if (tn_imgs[0]) tn.appendChild(tn_imgs[0].cloneNode());\r\n//              if (site.nickname==='4chan') tn.appendChild(cataLog.threads[name][0].getElementsByTagName('img')[0].cloneNode());\r\n              else tn.innerHTML = name;\r\n              common_func.overwrite_prop(tn.style, {position:'absolute', bottom:'0px', left:'0px', opacity:0.4});\r\n              pn.replaceChild(tn,btn);\r\n              pn2 = chart_obj.PostChart.call(chart, null,null,chart);\r\n              pn2.childNodes[1].replaceChild(pn, pn2.childNodes[1].childNodes[1]);\r\n            } else {\r\n              pn.removeChild(btn);\r\n              pn2 = cnst.tack_for_popup_swap(pn);\r\n//              pn2 = cnst.init3({func_str:'Show:tb'}).pn;\r\n//              pn2.appendChild(pn);\r\n            }\r\n            cnst.tack_for_popup_swap_pos(pn2,pn);\r\n//            pn2.style.top = parseInt(pn.style.top,10) - pn2.offsetHeight + 'px';\r\n//            pn2.style.left = pn.style.left;\r\n//            common_func.overwrite_prop(pn.style, {position:'relative', border:null, top:null, left:null});\r\n          });\r\n          if (kwd) pop_setup(kwd_src, pn, {src:kwd_src, scroll:true, pf:pfX});\r\n          else pop_setup(up_th.src, pn, chart? {src:up_th.src, chart:chart, scroll:true, pf:pf} : {src:up_th.src, scroll:true, pf:pf}, pna);\r\n        }\r\n        function pfX(){return pref.proto.popupX;}\r\n        function pf(){return pref.proto.popup3;}\r\n        return {\r\n          th_over, th_over,\r\n          th_out: th_out,\r\n//          init: function(pn){\r\n//            site.root_body.addEventListener('mouseover',th_over,false);\r\n////            pn.addEventListener('mouseover',th_over,false);\r\n//            pn.addEventListener('mouseleave',th_out,false);\r\n//            gGEH.triage_in = th_out; // for triage\r\n//          },\r\n//          destroy: function(pn){\r\n//            site.root_body.removeEventListener('mouseover',th_over,false);\r\n////            pn.removeEventListener('mouseover',th_over,false);\r\n//            pn.removeEventListener('mouseleave',th_out,false);\r\n//          },\r\n          pop_up_th_1: pop_up_th_1, // for popupID\r\n          set on_clg(v){on_clg = v;}, // for popupX\r\n        }\r\n      })();\r\n      var popupSurface = (function(){\r\n        var et = null;\r\n        function popup_make(e, kwd){\r\n          var key = gGEH.get_key_recursive(e.target, e.currentTarget);\r\n          if (!key) return;\r\n          kwd.rexps = common_func.kwd_prep_regexp(kwd, true);\r\n          preview.pop_up_th_1('sr', e, key, [], 4, false, false, kwd, e.target);\r\n          et = e.target;\r\n        }\r\n        return {\r\n          X: function(e){\r\n            var pf = pref[cataLog.embed_mode].popupX;\r\n            if (pf.ID) {\r\n              var id = geh.getID(e.target);\r\n              if (id) return popup_make(e, {str:id, id:true});\r\n            }\r\n            if (pf.flag) {\r\n              var country = geh.getCountry(e.target);\r\n              if (country) return popup_make(e, {str:country, flag:true});\r\n            }\r\n            if (pf.name) {\r\n              var name = geh.getName(e.target);\r\n              if (!pref.anon && name==='Anonymous') return;\r\n              if (name) return popup_make(e, {str:name, name:true, sentence:true});\r\n            }\r\n            if (pf.trip) {\r\n              var trip = geh.getTrip(e.target, e);\r\n              if (trip) return popup_make(e, {str:trip, trip:true});\r\n            }\r\n            if (pf.ID2) {\r\n              var id2 = geh.getID2(e.target, e);\r\n              if (id2) return popup_make(e, {str:id2, id2:true, sentence:true}); // for 5ch's wacchoi\r\n            }\r\n          },\r\n          get et(){return et;},\r\n          set et(v){et=v;},\r\n//          ID: function(e){\r\n//            var key = gGEH.get_key_recursive(e.target, e.currentTarget);\r\n//            if (!key) return;\r\n//            var id = geh.getID(e.target);\r\n//            var kwd = {str:id, match:0, id:true, rexps:null};\r\n//            kwd.rexps = common_func.kwd_prep_regexp(kwd);\r\n//            preview.pop_up_th_1('sr', e, key, [], 4, false, false, kwd, e.target);\r\n//          },\r\n//          Flag: function(e){\r\n//            var key = gGEH.get_key_recursive(e.target, e.currentTarget);\r\n//            if (!key) return;\r\n//            var country = geh.getCountry(e.target);\r\n//            var kwd = {match:0, flag:true, rexps:[new RegExp(country)]};\r\n//            preview.pop_up_th_1('sr', e, key, [], 4, false, false, kwd, e.target);\r\n//          },\r\n//          Name: function(e){\r\n//            var key = gGEH.get_key_recursive(e.target, e.currentTarget);\r\n//            if (!key) return;\r\n//            var name = geh.getName(e.target);\r\n//            if (!pref.proto.popupName.anon && name==='Anonymous') return;\r\n//            var kwd = {str:name, match:0, name:true, rexps:null};\r\n//            kwd.rexps = common_func.kwd_prep_regexp(kwd, true);\r\n//            preview.pop_up_th_1('sr', e, key, [], 4, false, false, kwd, e.target);\r\n//          },\r\n//          Trip: function(e){\r\n//            var key = gGEH.get_key_recursive(e.target, e.currentTarget);\r\n//            if (!key) return;\r\n//            var trip = geh.getTrip(e.target);\r\n//            var kwd = {str:trip, match:0, trip:true, rexps:null};\r\n//            kwd.rexps = common_func.kwd_prep_regexp(kwd, true);\r\n//            preview.pop_up_th_1('sr', e, key, [], 4, false, false, kwd, e.target);\r\n//          }\r\n        };\r\n      })();\r\n      var triage = (function(){\r\n        function th_over(e){\r\n          var clg = this['.'];\r\n          var tgt = geh.recSearch_thread(e.target, e.currentTarget, clg.view==='headline'? pref.script_prefix+'_headline' : undefined);\r\n          if (/*!pref.test_mode['127'] &&*/ (clg.mode==='catalog' || clg.mode==='float')) {\r\n            if (tgt) preview.th_over(e,tgt, clg);\r\n            else preview.th_out(e);\r\n          } else preview.on_clg = clg;\r\n          if (tgt) {\r\n            var name = gGEH.pns_all_keys.get(tgt) || gGEH.pns_all_keys.get(tgt.parentNode); // tgt.parentNode for vichan catalog\r\n            if (name) return cataLog.triage.thread_in(e, name, tgt, clg);\r\n//            if (name) return cataLog.triage.thread_in(tgt, name,\r\n//                                                      gClg.Clgs.length>=2 && geh.recSearch_thread(tgt, e.currentTarget, pref.script_prefix+'_catalog') || pClg.ppn);\r\n          }\r\n          cataLog.triage.thread_out2(e); // onTriage_or_off(e);\r\n        }\r\n        function th_out(e){\r\n          var clg = this['.'];\r\n          if (/*!pref.test_mode['127'] &&*/ clg.mode==='catalog' || clg.mode==='float') preview.th_out(e);\r\n          else preview.on_clg = null;\r\n          cataLog.triage.thread_out2(e);\r\n        }\r\n        return {\r\n          init: function(pn, obj){\r\n            pn.addEventListener('mouseover',th_over.bind(obj),false);\r\n            pn.addEventListener('mouseleave',th_out.bind(obj),false);\r\n          },\r\n//          init: function(pn){\r\n//            site.root_body.addEventListener('mouseover',th_over,false);\r\n//            gGEH.triage_in = preview.th_out; // for triage\r\n//          },\r\n          destroy: function(pn){site.root_body.removeEventListener('mouseover',th_over,false);},\r\n          th_over: th_over,\r\n        }\r\n      })();\r\n      return {\r\n        over: over,\r\n        leave: function(){up0.stop; up1.stop();},\r\n        pop_load: posts.pop_load,\r\n        blacklist: blacklist,\r\n        set_pos: set_pos, // to be removed.\r\n        href2domain: href2domain,\r\n        init: function(pn){\r\n          geh = site2[site.nickname].general_event_handler[site.whereami];\r\n//          if (!pref.test_mode['110'] && cataLog.embed_mode==='catalog') preview.init(pn);\r\n          gGEH.triage_in = preview.th_out; // for triage\r\n        },\r\n        init2: function(pn, obj){\r\n          /*if (!pref.test_mode['127'])*/ triage.init(pn, obj);\r\n        },\r\n        inline_post: posts.inline_post,\r\n        menu_click: triage.th_over,\r\n        pop_up_unlock: function(){dnd_mode = false;},\r\n        pop_down_temporarily: function(e, lock){\r\n          preview.th_out(e, true);\r\n          if (lock) dnd_mode = true;\r\n        },\r\n      };\r\n    })(),\r\n    popups_posts_class_hlt: 'highlighted',\r\n//    popups_op_func_set: function(){return 1;}, // vichan\r\n//    popups_op_func_use: function(pn,thq,no){ // vichan\r\n//      pn.setAttribute('class',pn.getAttribute('class')+' reply');\r\n////      pn.insertBefore(thq[no].pn.parentNode.querySelector('.files').cloneNode(true),pn.firstChild);\r\n//    },\r\n    popups_post_fetch: function(th, dbt){\r\n      cataLog.scan_init('popup',[th.domain+dbt[1]+((pref.catalog.catalog_json)? 't':'')+dbt[2]], {priority:8});\r\n    },\r\n//    popup_info:null,\r\n//    popups_posts: new WeakMap(),\r\n    popups_post_pnode: function(pnode){\r\n      if (pref.test_mode['107']) return site.popup_body;\r\n      if (!pref.test_mode['106']) {\r\n        var p = pnode.parentNode;\r\n        while (p) if (p===cataLog.parent) return site.popup_body; else p = p.parentNode;\r\n      }\r\n      var attr;\r\n      while (attr = pnode.getAttribute('class'), (!attr || (attr.indexOf('post')==-1 && attr.indexOf('thread')==-1)) && pnode.parentNode) pnode = pnode.parentNode;\r\n      return pnode;\r\n    },\r\n    \r\n//    popups_href2dbtp: function(href, src, th){\r\n//      if (href[0]==='#') {\r\n//        href = th.board+'res/'+th.no+'.html'+href;\r\n//        src.setAttribute('href',href);\r\n//      }\r\n//      var hrefs = href.split('/');\r\n//      var p = hrefs[hrefs.length-1].substr(hrefs[hrefs.length-1].indexOf('#')+1);\r\n//      var t = hrefs[hrefs.length-1].substr(0,hrefs[hrefs.length-1].indexOf('.'));\r\n//      var b = (hrefs.length>=3)? '/'+hrefs[hrefs.length-3]+'/' : site.board;\r\n//      var d = this.nickname;\r\n//      return [d,b,t,p];\r\n//    },\r\n    popups_href2th_q: function(href){ //,src,th){\r\n      var dbt = this.popups_href2dbtp(href); // ,src,th);\r\n//      var th = liveTag.mems[d][b][t];\r\n      if (!dbt[0] || !dbt[1] || !dbt[2]) return null; // hit this line when dbt[2]==='' caused by '>>>/a/'\r\n      var lth = liveTag.mems.init({domain:dbt[0], board:dbt[1], no:parseInt(dbt[2],10)}); // may be first time if the llink is cross-link.\r\n      if (lth.q===undefined) lth.q = (lth.no>1000000)? Object.create(lth) : Object.create({0:undefined, 1:undefined, 2:undefined, __proto__:lth}); // PATCH before removing [0:2] // crosslink, CYCLIC REFERENCE.\r\n//      if (!liveTag.mems[dbt[0]][dbt[1]][dbt[2]] || !liveTag.mems[dbt[0]][dbt[1]][dbt[2]].q) return null; // patch for accessibility check. 'if (!th)' doesn't work. // WHY??? // HIT THIS LINE WHEN dbt[2]===''.\r\n      return [lth.q, parseInt(dbt[3],10), dbt, lth];\r\n    },\r\n////    popups_add: function(posts, posts_old, th){ // working code.\r\n////      if (!posts_old) posts_old = [];\r\n////      var th_q0 = liveTag.mems[th.domain][th.board][th.no];\r\n////      if (th_q0.q===undefined) th_q0.q = {};\r\n////      var thq = th_q0.q;\r\n////      if (posts) for (var i=0;i<posts.length;i++) Object.defineProperty(posts[i],'no',{value:th.parse_funcs.no(posts[i])});\r\n////      if (posts && posts.length!=0) {\r\n//////        for (var i=0;i<posts.length;i++) Object.defineProperty(posts[i],'no',{value:parseInt(posts[i].pn.getElementsByClassName('post_no')[1].textContent,10)});\r\n//////        if (posts_old.length!=0) while (posts_old[0].no<posts[0].no) this.popups_release(posts_old.shift()); // [0] is OP\r\n////        if (posts.length>1) while (posts_old.length>1 && posts_old[1].no<posts[1].no) this.popups_release(posts_old.splice(1,1)[0]);\r\n////      }\r\n////      if (posts) {\r\n////        for (var i=0;i<posts.length;i++) {\r\n////          var flag_old = posts_old.length!=0 && posts_old[posts_old.length-1].no>posts[i].no;\r\n////          var tgts = [];\r\n////          var as = posts[i].pn.getElementsByTagName('a');\r\n////          for (var j=0;j<as.length;j++)\r\n////            if (as[j].textContent.search(/>>[0-9]+$/)!=-1) {\r\n////              as[j].onmouseover = this.popups_post_entry;\r\n////              if (!flag_old) {\r\n////                var th_q = site2[th.domain].popups_href2th_q(as[j].getAttribute('href'),as[j],th);\r\n////                if (th_q) {\r\n////                  tgts[tgts.length] = as[j].getAttribute('href');\r\n////                  this.popups_grep(th_q[0],th_q[1]);\r\n////                }\r\n////              }\r\n////            }\r\n////          if (!flag_old) {\r\n////            posts_old[posts_old.length] = (tgts.length!==0)? {no:posts[i].no, tgts:tgts, thq:thq} : {no:posts[i].no, thq:thq};\r\n////            this.popups_grep(thq,posts[i].no);\r\n////            this.popups_set(thq,posts[i].no,posts[i]);\r\n////            if (i===0) thq[posts[i].no].isOP = 1;\r\n////          }\r\n////        }\r\n////      } else while (posts_old.length>1) this.popups_release(posts_old.shift());\r\n////      if (pref.debug_mode['10']) {\r\n////        var d_str = '';\r\n////        for (var i in thq) d_str += i+':'+((thq[i].reffered)? thq[i].reffered : thq[i])+', ';\r\n////        console.log('popups_add :'+th.key+': '+d_str);\r\n////      }\r\n////      return posts_old;\r\n////    },\r\n////    popups_grep: function(thq, no){\r\n////      if (thq[no]===undefined) thq[no] = 1; // waiting to be filled, but not make requests.\r\n////      else if (typeof(thq[no])==='number') thq[no] = thq[no] + ((thq[no]<0)? -1 : 1);\r\n////      else ++thq[no].reffered;\r\n////    },\r\n////    popups_set: function(thq, no, val){\r\n////      if (typeof(thq[no])==='number') {\r\n////        thq[no] = val;\r\n////        thq[no].reffered = (val_old>=0)? val_old : -val_old;\r\n////      }\r\n////    },\r\n////    popups_release_1: function(th_q){\r\n////      if (th_q) {\r\n////        if (typeof(th_q[0][th_q[1]])==='number') {\r\n////          th_q[0][th_q[1]] -= (th_q[0][th_q[1]]<0)? -1 : 1;\r\n////          if (th_q[0][th_q[1]]===0) delete th_q[0][th_q[1]];\r\n////        } else if (--th_q[0][th_q[1]].reffered===0) delete th_q[0][th_q[1]];\r\n////      }\r\n////    },\r\n////    popups_release: function(post){\r\n////      if (post.tgts)\r\n////        for (var i=0;i<post.tgts.length;i++)\r\n////          this.popups_release_1(site2[site.nickname].popups_href2th_q(post.tgts[i])); // TEMPORAL\r\n////      this.popups_release_1([post.thq, post.no]);\r\n////      if (pref.debug_mode['10']) {\r\n////        var d_str = '';\r\n////        for (var i in thq) d_str += i+':'+((thq[i].reffered)? thq[i].reffered : thq[i])+', ';\r\n////        console.log('popups_release :'+post.no+': '+d_str);\r\n////       }\r\n////    },\r\n    popups_prep: function(th, lth){\r\n      if (!lth) lth = liveTag.mems[th.domain][th.board][th.no];\r\n      if (lth.q===undefined) lth.q = ( th.no>1000000)? Object.create(lth) : Object.create({0:undefined, 1:undefined, 2:undefined, __proto__:lth}); // PATCH before removing [0:2] // usual, lth.q is made in popups_href2th_q if crosslink. CYCLIC REFERENCE.\r\n    },\r\n//    popups_add: function(posts, th, release){\r\n////    popups_add: function(posts, th, deactivate, from_native, release){\r\n//      var lth = liveTag.mems[th.domain][th.board][th.no];\r\n////      if (lth.q===undefined) lth.q = ( th.no>1000000)? Object.create(lth) : Object.create({0:undefined, 1:undefined, 2:undefined, __proto__:lth}); // PATCH before removing [0:2] // usual, lth.q is made in popups_href2th_q if crosslink. CYCLIC REFERENCE.\r\n//      if (posts) if (th.type_data==='html') {for (var i=0;i<posts.length;i++) if (!posts[i].no) Object.defineProperty(posts[i],'no',{value:th.parse_funcs.no(posts[i])});}\r\n////                 else for (var i=0;i<posts.length;i++) if (!posts[i].pn) posts[i].pn = this.post_json2html(posts[i],th.board);\r\n//      var posts_exist = {};\r\n//      if (posts) {\r\n//        for (var i=0;i<posts.length;i++) {\r\n//          var post_no = posts[i].no;\r\n//          posts_exist[post_no] = null;\r\n////          if (lth.q[post_no]===undefined || Array.isArray(lth.q[post_no])) this.popups_add_1(th, posts[i], deactivate, lth.q, true, from_native); // may cause multiple entry because lth.q[post_no] will be deleted even if it is shown when the post is not reffered from other posts of the same thread but there is a cross link and the post of the cross link is changed to not shown. This invokes emurational recursive call of popups_release to delete lth.q[post_no]. But this is OK because popups_add_1 admits multiple entry, you can call it any times.\r\n//        }\r\n//      }\r\n//      if (!pref[cataLog.embed_mode].backlink_all && (release || pref.test_mode['125'])) this.popups_release_all(lth, posts_exist);\r\n//    },\r\n    popups_release_all_not_exist: function(lth, posts){\r\n      if (!lth.q) return;\r\n      var nos = {};\r\n      if (posts) for (var i=0;i<posts.length;i++) nos[posts[i].no]=null;\r\n      var lth_q_ps = Object.keys(lth.q);\r\n      for (var i=0;i<lth_q_ps.length;i++)\r\n        if (nos[lth_q_ps[i]]===undefined && lth_q_ps[i]!=='waiting') this.popups_release(lth, lth_q_ps[i]);\r\n    },\r\n//    popups_release_all: function(lth, posts_exist){\r\n//      if (!lth.q) return;\r\n//      var lth_q_ps = Object.keys(lth.q);\r\n//      for (var i=0;i<lth_q_ps.length;i++)\r\n//        if (posts_exist[lth_q_ps[i]]===undefined && lth_q_ps[i]!=='waiting') this.popups_release(lth, lth_q_ps[i]);\r\n//    },\r\n//    popups_add: function(tgt_th16, th, deactivate, from_native){ // working code.\r\n//      var posts = tgt_th16.posts;\r\n//      if (!tgt_th16.popups) tgt_th16.popups = Object.create(null);\r\n//      var popups = tgt_th16.popups;\r\n//      var lth = liveTag.mems[th.domain][th.board][th.no];\r\n//      if (lth.q===undefined) lth.q = ( th.no>1000000)? Object.create(lth) : Object.create({0:undefined, 1:undefined, 2:undefined, __proto__:lth}); // PATCH before removing [0:2] // usual, lth.q is made in popups_href2th_q if crosslink. CYCLIC REFERENCE.\r\n//      if (posts) if (th.type_data==='html') {for (var i=0;i<posts.length;i++) if (!posts[i].no) Object.defineProperty(posts[i],'no',{value:th.parse_funcs.no(posts[i])});}\r\n////                 else for (var i=0;i<posts.length;i++) if (!posts[i].pn) posts[i].pn = this.post_json2html(posts[i],th.board);\r\n//      var posts_exist = {};\r\n//      if (posts) {\r\n//        for (var i=0;i<posts.length;i++) {\r\n//          var post_no = posts[i].no;\r\n//          posts_exist[post_no] = null;\r\n//          if (popups[post_no]===undefined) {\r\n//            this.popups_add_1(th, posts[i], deactivate, lth.q, true, from_native);\r\n//            popups[post_no] = null;\r\n//          }\r\n//        }\r\n//      }\r\n//      if (!pref.filter.kwd.posts_active) for (var i in popups) {\r\n//        if (posts_exist[i]===undefined) {\r\n////          this.popups_release(popups[i], i, th.key); // BUG???\r\n//          this.popups_release(lth, i);\r\n//          delete popups[i];\r\n//        }\r\n//      }\r\n////      if (posts) site2[th.domain_html].format_pn(posts[0].pn, lth.q[th.no]); // PROBABLY THIS IS REDUNDANT, BUT NOT DEBUGGED.\r\n////      if (pref.debug_mode['10']) this.popups_debug('popups_add: '+th.no+': ', lth.q);\r\n//    },\r\n    popups_add_1_cross: function(th, posts, cross){ // called before wrapped\r\n      for (var j=0;j<posts.length;j++) {\r\n        var hrefs = th.parse_funcs.hrefs(posts[j]);\r\n        if (hrefs) for (var i=0;i<hrefs.length;i++) {\r\n          if (hrefs[i][0]==='#') continue;\r\n          if (!cross && hrefs[i].indexOf(th.board)!==0) continue;\r\n          var th_q = site2[th.domain].popups_href2th_q(hrefs[i]);\r\n          if (th_q) {\r\n            var skey = th_q[2][0]!==th.domain? th.key : th_q[2][1]!==th.board? th.board+th.no : th_q[2][2]!=th.no? th.no : null;\r\n            if (skey!==null) site2[th.domain_html].popups_add_backlink(th_q[0],th_q[1], skey+'#'+posts[j].no, th, false, false);\r\n          }\r\n        }\r\n      }\r\n    },\r\n//        var link_regex = />>[0-9]+$|>>>\\/[0-z_]+\\/[0-9]+$/;\r\n//        var link_regex = />>(>\\/.+\\/)*[0-9]+$/;\r\n//    popups_link_regex: />>(>\\/.+\\/)*[0-9]+(\\s\\(You\\))*$/, // patch for '(You)'\r\n    popups_link_regex: /^>>(>\\/[^/]+\\/)*[0-9]+/, // patch for '(You)' and '(OP)'\r\n    popups_add_1: function(th, post, deactivate, thq, from_not_popup, add_backlink){ // must be able to accept multiple calls, this is called at every appearance/dissapearance.\r\n//      if (!post.pn) post.pn = site2[th.domain_html].post_json2html(post,th.board);\r\n      var as = Array.prototype.slice.call(site2[th.domain_html].post_pn2ce(post.pn).getElementsByTagName('a')); // static array for adding '<a>Merge</a>' later.\r\n      if (deactivate && pref[cataLog.embed_mode].env.backlink_native) {\r\n        var nof_flinks = as.length;\r\n        var bks = site2[th.domain_html].add_backlinks_bks_query(post.pn);\r\n        if (bks) as = as.concat(Array.prototype.slice.call(bks.getElementsByTagName('a'))); // direct call of concat causes error.\r\n      }\r\n      if (as.length>0) {\r\n//        var op_regexp = new RegExp('^>>'+th.no+'(\\\\s|\\\\(|$)');\r\n        var quotes = [];\r\n        for (var j=0;j<as.length;j++) {\r\n  //        if (as[j].textContent.search(/>>[0-9]+$/)!=-1) {\r\n          var as_txt = as[j].textContent;\r\n          if (as_txt.search(this.popups_link_regex)!=-1) {\r\n            if (deactivate) {\r\n              if (pref[cataLog.embed_mode].env.popup_native_kill) {\r\n                var as_new = as[j].cloneNode(true);\r\n                as[j].parentNode.replaceChild(as_new,as[j]);\r\n                as[j] = as_new;\r\n              } else this.popups_posts.blacklist.add(as[j]);\r\n              if (j>=nof_flinks) continue;\r\n            }\r\n//            if (activate) as[j].onmouseover = this.popups_post_entry;\r\n            var th_q = site2[th.domain].popups_href2th_q(as[j].getAttribute('href')); // ,as[j],th); // this may change href, so this must be here. <- FIXED.\r\n  //          var a_class = as[j].parentNode.getAttribute('class');\r\n  //          if (!a_class || a_class.indexOf(site2[th.domain_html].backlink_class)==-1) { // skip backlinks\r\n            if (th_q) {\r\n              if (pref[cataLog.embed_mode].link_show_op && th_q[2][2]==th_q[2][3] && as_txt.indexOf('(OP)')==-1) as[j].textContent += ' (OP)'; // th_q[2][3] is string\r\n//              if (pref[cataLog.embed_mode].link_show_op && as_txt.search(op_regexp)===0 && as_txt.indexOf('(OP)')==-1) as[j].textContent += ' (OP)';\r\n              if (th_q[0]!==thq) {\r\n                if (pref[cataLog.embed_mode].link_show_cross && as_txt.indexOf('\\u2192')===-1) as[j].textContent += ' \\u2192';\r\n                if (pref[cataLog.embed_mode].merge_btn) as[j].parentNode.insertBefore(Triage.prototype.doms.emMerge.cloneNode(true),as[j].nextSibling);\r\n//                if (pref[cataLog.embed_mode].merge_btn) cnst.doms_insertBefore(as[j].parentNode, ' [<a href=\"javascript:;\" class=\"'+pref.script_prefix+'_UImerge\">Merge</a>]',as[j].nextSibling);\r\n              }\r\n              quotes[quotes.length] = [th_q[0], th_q[1]]; // quotes may be multiple.\r\n//              quotes[quotes.length] = [thq, th_q[1]]; // quotes may be multiple.  // use 'thq' instead of 'th_q[0]' for test_mode['80'] // BUG. MUST USE th_q[0]\r\n              var skey = th_q[2][0]!==th.domain? th.key : th_q[2][1]!==th.board? th.board+th.no : th_q[2][2]!=th.no? th.no : null;\r\n              site2[th.domain_html].popups_add_backlink(th_q[0],th_q[1], skey!==null? skey+'#'+post.no : post.no, th, from_not_popup, add_backlink, from_not_popup);\r\n//              site2[th.domain_html].popups_add_backlink(thq,th_q[1], skey!==null? skey+'#'+post.no : post.no, th, dig);\r\n            }\r\n  //          }\r\n          }\r\n        }\r\n      }\r\n      this.popups_set(thq,post.no,post, quotes && quotes.length!=0 && quotes, from_not_popup);\r\n//      if (op) thq[post.no].isOP = site2[th.domain_html].popups_op_func_set(post.pn);\r\n    },\r\n    popups_add_backlink: function(thq, no, key, th, dig, add_backlink, from_not_popup){\r\n      if (thq[no]===undefined) {\r\n        thq[no] = [key];\r\n        if (dig) this.popups_set_waiting(thq,no);\r\n      } else if (Array.isArray(thq[no])) {\r\n        if (thq[no].indexOf(key)==-1) {\r\n          thq[no][thq[no].length] = key;\r\n          if (dig) this.popups_set_waiting(thq,no); // may not waiting because of 'dig'.\r\n        }\r\n      } else {\r\n        if (!thq[no].backlinks) thq[no].backlinks = [];\r\n        var blks = thq[no].backlinks;\r\n        if (blks.indexOf(key)==-1) {\r\n          blks[blks.length] = key;\r\n          if (add_backlink) { // pref[cataLog.embed_mode].backlink && (!pref[cataLog.embed_mode].env.backlink_native || !from_native)) {\r\n            if (thq[no].pn) site2[th.domain_html].add_backlinks(thq[no].pn,  blks, blks.length-1, th);\r\n            var pn = !from_not_popup && (th.posts.filter(function(v){return v.no===no;})[0]||{}).pn; // test patch for popup at first time, but slow\r\n            if (pn) site2[th.domain_html].add_backlinks(pn, blks, blks.length-1, th);\r\n          }\r\n        }\r\n      }\r\n    },\r\n    add_backlinks: function(pn,backlinks,target, th){ // this refers site2[domain_html]\r\n      var bks_pn = this.add_backlinks_bks_query(pn);\r\n      var bks = bks_pn || this.add_backlinks_bks();\r\n      if (!target) bks.innerHTML = ''; // this hits target===0 also and clean up.\r\n      for (var i=(target || 0);i<backlinks.length;i++) {\r\n        this.add_backlinks_add_1(bks, this.popups_backlink2dbtpth(backlinks[i], th));\r\n        if (target) break;\r\n      }\r\n      if (!bks_pn) this.add_backlinks_bks_append(pn, bks);\r\n    },\r\n    popups_backlink2dbtpth: function(backlink, th){\r\n      var dbtp;\r\n      var dbtpth = (typeof(backlink)==='number')? [th.domain, th.board, th.no, backlink, '>>'+backlink]\r\n          : (dbtp = backlink.split(/[\\/#]/),\r\n             dbtp.length==2? [th.domain, th.board, dbtp[0], dbtp[1], '>>'+(pref.proto.bl_ec? dbtp[0]+'#':'')+dbtp[1]]\r\n                           : [dbtp[0] || th.domain, '/'+dbtp[1]+'/', dbtp[2], dbtp[3], (dbtp[0]? '>>>>'+dbtp[0]:'>>>')+'/'+dbtp[1]+'/'+(pref.proto.bl_ec? dbtp[2]+'#':'')+dbtp[3]]);\r\n      dbtpth[5] = site2[dbtpth[0]].link_dbtp2href_abs(dbtpth); // don't use 'this', 'this' refers site2[domain_html], not site2[domain].\r\n      return dbtpth;\r\n    },\r\n    remove_backlink: function(pn,idx){}, // dummy\r\n    popups_remove_backlink: function(thq, no, key){\r\n      if (!thq[no]) return; // 'quotes' may be multiple, then hit this line.\r\n      var ary = (Array.isArray(thq[no]))? thq[no] : thq[no].backlinks;\r\n      var idx = ary.indexOf(key);\r\n      if (idx>=0) {\r\n        ary.splice(idx,1);\r\n        if (thq.no===no && pref.proto.bl_rm) if (thq[no]) this.remove_backlink(thq[no].pn, idx); // remove op only for faster execution. // includes cross link\r\n//        if (ary.length===0) return true; // prevent from infinite loop by reference loop of anchors.\r\n      }\r\n////      else console.log('ERROR in handling popups ' + no+', '+key+', '+thq[no].backlinks); // quotes allows multiple, but backlink doesn't, deletion of a post which has multiple links to a post hits this line.\r\n////      if (ary.length===0 && thq[no].remove_if_no_backlinks) delete thq[no];\r\n////      if (pref.debug_mode['10']) console.log('popups_remove_backlink: '+(idx>=0?'suc':'fail')+', '+no+'<-'+key+':    '+this.popups_debug(thq));\r\n////      if (ary.length===0) return true;\r\n    },\r\n    popups_set: function(thq, no, val, quotes, from_not_popup){\r\n      if (no<=2) if (!Object.hasOwnProperty.call(thq,no)) thq[no] = undefined; // PATCH before renaming, now thq has prototype, [0][1] or [2] returns tags or watch.\r\n      if (thq[no]===undefined) {\r\n        if (val.backlinks) val.backlinks = undefined; // PATCH FOR MEGUCA, meguca has backlinks in native.\r\n        thq[no] = val;\r\n      } else if (Array.isArray(thq[no])) {\r\n        val.backlinks = thq[no];\r\n        thq[no] = val;\r\n      } else { // for multiple entry at editing===true, update thq[no].\r\n        if (thq[no].backlinks) val.backlinks = thq[no].backlinks;\r\n        if (from_not_popup) thq[no] = val; // BUG, keep lth.q for backlinks, but this can track only one instance. Bug when there are multiple thread/page views.\r\n      }\r\n//      thq[no] = val;\r\n      if (quotes) thq[no].quotes = quotes;\r\n      if (val.editing) this.popups_set_waiting(thq,no); // keep updating while editing by 'popups_fetched'\r\n      this.popups_remove_waiting(thq,no);\r\n    },\r\n    popups_release: function(lth, no){ // in-place, on-demand ver.\r\n      var quotes = [];\r\n      var i=0;\r\n      if (pref.debug_mode['12']) var initial_cond = {no:no, lth:lth, len:debug_len(lth)};\r\n      prep_quotes.call(this, lth, no);\r\n      while (--i>=0) {\r\n        var tgt = quotes[i];\r\n        lth = tgt[0];\r\n        no  = tgt[1];\r\n        if (tgt.length==3) {\r\n          var q = tgt[2][0];\r\n          var p = tgt[2][1];\r\n          var skey = q.domain!==lth.domain? lth.key : q.board!==lth.board? lth.board+lth.no : q.no!=lth.no? lth.no : null;\r\n          this.popups_remove_backlink(q, p, skey!==null? skey+'#'+no : parseInt(no,10));\r\n          prep_quotes.call(this, Object.getPrototypeOf(q), p); // emulates recursive call // overwrite for in-place\r\n        } else delete lth.q[no];\r\n//        } else {\r\n//          if (lth.no!=no && lth.q && lth.q[no])\r\n//            if (!lth.q[no].backlinks || lth.q[no].backlinks.length===0) delete lth.q[no];\r\n////            else if (lth.q[no].quote) lth.q[no].quote = null; // nullify for strict accordance, but redundant.\r\n////          if (pref.debug_mode['10']) console.log('popups_release: '+no+':    '+this.popups_debug(lth.q));\r\n//        }\r\n      }\r\n      if (pref.debug_mode['12']) {\r\n        var len = debug_len(initial_cond.lth);\r\n        if (len!==initial_cond.len) console.log('popups_release: '+initial_cond.lth.key+': '+len+' <- '+initial_cond.len+', '+initial_cond.no+\r\n                                                ((pref.debug_mode['10'])? '    '+this.popups_debug(lth.q):''));}\r\n      function prep_quotes(lth, no){\r\n        if (lth.no!=no && lth.q && lth.q[no]) { // lth.q is nullfied when the thread was pruned.\r\n          var ary = (Array.isArray(lth.q[no]))? lth.q[no] : lth.q[no].backlinks;\r\n          if (!ary || ary.length===0) {\r\n            this.popups_remove_waiting(lth.q,no);\r\n            quotes[i++] = [lth, no];\r\n            var qts = lth.q && lth.q[no] && lth.q[no].quotes; // lth may refer archived thread, which never have loaded.\r\n            if (qts) for (var j=qts.length-1;j>=0;j--) quotes[i++] = [lth, no, qts[j]];\r\n          }\r\n        }\r\n      }\r\n      function debug_len(lth){\r\n        var nos = Object.keys(lth.q);\r\n        return nos.length - (nos.indexOf('waiting')==-1? 0:1);\r\n      }\r\n    },\r\n//    popups_release: function(lth, no){ // in-place, on-demand ver. // working code.\r\n//      var quotes = [];\r\n//      var i=0;\r\n//      if (pref.debug_mode['12']) var initial_cond = {no:no, lth:lth, len:Object.keys(lth.q).length};\r\n//      prep_quotes(lth, no);\r\n//      while (--i>=0) {\r\n//        var tgt = quotes[i];\r\n//        lth = tgt[0];\r\n//        no  = tgt[1];\r\n//        if (tgt.length==4) {\r\n//          var q = tgt[2];\r\n//          var p = tgt[3];\r\n//          var skey = q.domain!==lth.domain? lth.key : q.board!==lth.board? lth.board+lth.no : q.no!=lth.no? lth.no : null;\r\n//          if (this.popups_remove_backlink(q, p, skey!==null? skey+'#'+no : parseInt(no,10))) { // only true if removed successfully, this prevents infinite loop by reference loop.\r\n//            this.popups_remove_waiting(q,p);\r\n//            prep_quotes(Object.getPrototypeOf(q), p);// emulates recursive call // overwrite for in-place\r\n//          }\r\n//        } else {\r\n//          if (lth.no!=no && lth.q && lth.q[no])\r\n//            if (!lth.q[no].backlinks || lth.q[no].backlinks.length===0) delete lth.q[no];\r\n////            else if (lth.q[no].quote) lth.q[no].quote = null; // nullify for strict accordance, but redundant.\r\n////          if (pref.debug_mode['10']) console.log('popups_release: '+no+':    '+this.popups_debug(lth.q));\r\n//        }\r\n//      }\r\n//      if (pref.debug_mode['12']) console.log('popups_release: '+initial_cond.lth.key+': '+Object.keys(initial_cond.lth.q).length+' <- '+initial_cond.len+', '+initial_cond.no+\r\n//                                             ((pref.debug_mode['10'])? '    '+this.popups_debug(lth.q):''));\r\n//      function prep_quotes(lth, no){\r\n//        quotes[i++] = [lth, no];\r\n//        var qts = lth.q && lth.q[no] && lth.q[no].quotes; // lth may refer archived thread, which never have loaded.\r\n//        if (qts) for (var j=qts.length-1;j>=0;j--) quotes[i++] = [lth, no, qts[j][0], qts[j][1]];\r\n//      }\r\n//    },\r\n//    popups_release: function(lth, no){ // working code. loop ver.\r\n//      var quotes = format_quotes(lth, no, lth.q[no].quotes);\r\n//      while (quotes.length>0) {\r\n//        var tgt = quotes.shift();\r\n//        lth = tgt[0];\r\n//        no  = tgt[1];\r\n//        if (tgt.length==4) {\r\n//          var q = tgt[2];\r\n//          var p = tgt[3];\r\n//          var skey = q.domain!==lth.domain? lth.key : q.board!==lth.board? lth.board+lth.no : q.no!=lth.no? lth.no : null;\r\n//          if (this.popups_remove_backlink(q, p, skey? skey+'#'+no : parseInt(no,10))) {\r\n//            this.popups_remove_waiting(q,p);\r\n//            var lth_next = Object.getPrototypeOf(q);\r\n//            quotes = format_quotes(lth_next, p, lth_next.q[p].quotes).concat(quotes); // emulates recursive call\r\n//            lth_next.q[p].quotes = null; // prevent from infinite loop by reference loop of anchors.\r\n//          }\r\n//        } else {\r\n//          if (lth.no!=no && (!lth.q[no].backlinks || lth.q[no].backlinks.length===0)) delete lth.q[no];\r\n//          if (pref.debug_mode['10']) console.log('popups_release: '+no+':    '+this.popups_debug(lth.q));\r\n//        }\r\n//      }\r\n//      function format_quotes(lth,no, quotes){\r\n//        return (quotes)? quotes.map(function(v){return [lth, no].concat(v);}).concat([[lth, no]]) : [[lth, no]];\r\n//      }\r\n//    },\r\n////    popups_release_list: [], // DOESN'T WORK, leaves must be removed first, or lost reference and get too complicated procedures.\r\n////    popups_release_recursive: function(){ // avoid recursive calls\r\n////      while (this.popups_release_list.length>0) {\r\n////        var tgt = this.popups_release_list.pop();\r\n////        this.popups_release(tgt[0], tgt[1], tgt[2]);\r\n////      }\r\n////    },\r\n//    popups_release: function(lth, no){ // working code // , thq_no_in){\r\n//      var thq = lth.q;\r\n//      var thq_no = thq[no]; //  || thq_no_in;\r\n//      if (thq_no.quotes)\r\n//        for (var i=0;i<thq_no.quotes.length;i++) {\r\n//          var q = thq_no.quotes[i][0];\r\n//          var p = thq_no.quotes[i][1];\r\n//          var skey = q.domain!==lth.domain? lth.key : q.board!==lth.board? lth.board+lth.no : q.no!=lth.no? lth.no : null;\r\n//          if (this.popups_remove_backlink(q, p, skey? skey+'#'+no : parseInt(no,10))) {\r\n//            this.popups_remove_waiting(q,p);\r\n////            this.popups_release_list.push([Object.getPrototypeOf(q), p, q[p]]); // DOESN'T WORK\r\n//            try { \r\n//              this.popups_release(Object.getPrototypeOf(q), p); // RECURSIVE CALLS MAY CAUSE STACKOVERFLOW.\r\n//            } catch(e){\r\n//              setTimeout(this.popups_release.bind(this,Object.getPrototypeOf(q), p),0);\r\n//            }\r\n//          }\r\n//        }\r\n//      if (lth.no!=no && (!thq_no.backlinks || thq_no.backlinks.length===0)) delete thq[no];\r\n////      else thq_no.remove_if_no_backlinks = 1;\r\n//      if (pref.debug_mode['10']) console.log('popups_release: '+no+':    '+this.popups_debug(lth.q));\r\n////      if (!thq_no_in && this.popups_release_list.length>0) this.popups_release_recursive();\r\n//    },\r\n    popups_set_waiting: function(thq,no){\r\n      if (!thq.waiting) thq.waiting = [no];\r\n      else {\r\n        var i=0;\r\n        while (i<thq.waiting.length && thq.waiting[i]<no) i++;\r\n        if (thq.waiting[i]!=no) thq.waiting.splice(i,0,no);\r\n      }\r\n    },\r\n    popups_remove_waiting: function(thq,no){\r\n      if (!thq.waiting) return;\r\n      var idx = thq.waiting.indexOf(no);\r\n      if (idx!=-1) {\r\n        thq.waiting.splice(idx,1);\r\n        if (thq.waiting.length===0) delete thq.waiting;\r\n      }\r\n    },\r\n    popups_fetched: function(th, lth, start){ // 'if (lth.q && lth.q.waiting)' is checked by caller.\r\n      if (!start) start = 0;\r\n      var j=th.posts.length-1;\r\n      for (var i=lth.q.waiting.length-1;i>=0;i--) {\r\n        var no = lth.q.waiting[i];\r\n        while (j>start && no<th.posts[j].no) j--;\r\n        if (no===th.posts[j].no) this.popups_set(lth.q, no, th.posts[j]); // this.popups_fetched_1(th, lth, no, th.posts[j]);\r\n        else if (th.type_source==='thread') {\r\n          if (pref.test_mode['64']) this.popups_set(lth.q, no, {time: 0, com:'DELETED'});\r\n          else this.popups_set(lth.q, no, {time: 0, com:'DELETED'}); // referring deleted posts should be here.\r\n        } // else if (j===start) break;\r\n        this.popups_posts.pop_load(th.key+'#'+th.posts[j].no, th.domain);\r\n//        if (this.popup_info && this.popup_info.key===th.key+'#'+th.posts[j].no) this.popups_posts.pop_make({target:this.popup_info.node, __proto__:this.popup_info}, th.domain);\r\n      }\r\n    },\r\n//    popups_fetched_html: function(post, th){ // PATCH, WILL BE REMOVED.\r\n////      if (th.domain!==site.nickname && pref.catalog.mimic_base_site && th.domain_html!==site.nickname) {\r\n////        var post_new = common_func.shallow_copy_1(post); // MAY COLLIDE???\r\n//\r\n////        site2[th.domain].wrap_to_parse_posts(th); // TEMPORAL\r\n//        var proto_obj = {domain:th.domain, board:th.board, domain_html:th.domain_html, parse_funcs:th.parse_funcs};\r\n//        if (post.extra_files) for (var j=0;j<post.extra_files.length;j++) for (var k in proto_obj) post.extra_files[j][k] = proto_obj[k];\r\n//        for (var k in proto_obj) post[k] = proto_obj[k];\r\n//\r\n////        if (th.parse_funcs.posts_full) th.parse_funcs.posts_full(th);\r\n//        if (post.parse_funcs.filename) post.filename = post.parse_funcs.filename(post);\r\n////        if (th.parse_funcs.prep_mimic) th.parse_funcs.prep_mimic(th);\r\n//\r\n//        var dummy = post.time; // invoke getter\r\n//        dummy = post.sub;\r\n//        dummy = post.com;\r\n//        dummy = post.name;\r\n//        dummy = post.no;\r\n//        dummy = post.op_img_url;\r\n//        post.type_data = th.type_data;\r\n////      }\r\n//      return post;\r\n//    },\r\n    backlink: function(pn,thq_no, th){\r\n      var backlinks = (thq_no)? ((Array.isArray(thq_no))? thq_no : thq_no.backlinks) : null;\r\n      if (backlinks) this.add_backlinks(pn,backlinks, undefined, th);\r\n    },\r\n\r\n    popups_debug: function(thq){\r\n      if (!thq) return '';\r\n      var keys = Object.keys(thq);\r\n      var d_str = keys.length+', '+thq.key+': ';\r\n      for (var j=0;j<keys.length;j++) {\r\n        var i = keys[j];\r\n        d_str += i+':'+((Array.isArray(thq[i]))? thq[i] : (thq[i].backlinks || thq[i].remove_if_no_backlinks || 'P'))+', ';\r\n      }\r\n      return d_str;\r\n    },\r\n    toplevel_anchor_pos:1,\r\n    toplevel_anchor: function(pn, th){\r\n      var as = pn.getElementsByTagName('a');\r\n      for (var i=0;i<as.length;i++) {\r\n        var href = as[i].getAttribute('href');\r\n        if (href && href[0]==='#') as[i].setAttribute('href',this.link_dbtp2href([th.domain, th.board, th.no, href.substr(this.toplevel_anchor_pos)]));\r\n      }\r\n    },\r\n\r\n    wrap_to_parse: (function(){\r\n      var th_regexp = /[A-z]/;\r\n//      var parse_objs = {};\r\n      var key_table = { // to reduce memory consumption.\r\n        catalog: 'c',\r\n        page:    'i',\r\n        thread:  't',\r\n        post:    'p',\r\n        shortCatalog: 'b',\r\n        shortThread:  's',\r\n        html:    'h',\r\n        json:    'j',\r\n      };\r\n      function get_getters(html){\r\n//        if (pref.test_mode['6']) return site4.parse_funcs_no_cache; // no cache parse to reduce memory consumption.\r\n//        if (pref.test_mode['6']) return site4.parse_funcs_one_time; // one time parse for faster execution.\r\n        return html? site4.parse_funcs_html : (pref.debug_mode.parse_error)? site4.parse_funcs_on_demand_debug : site4.parse_funcs_on_demand;\r\n//        var obj = (pref.debug_mode.parse_error)? site4.parse_funcs_on_demand_debug : site4.parse_funcs_on_demand;\r\n//        if (pref.test_mode['1'] && parse_funcs){ // test of static getters '&& parse_funcs' is a patch for test. // required to change 'get_getters(parse_funcs){'\r\n//          var obj2 = {};\r\n//          var props = ['no', 'key', 'time_bumped', 'nof_posts', 'nof_files', 'time_created', 'posts', 'sub', 'name', 'com', 'flag', 'flags', 'footer', 'sticky', 'pn', 'time', 'time_posted', 'txt']; // ['op_img_url'] // op_img_url is wrapped at localArhicve mode dynamically.\r\n//          for (var i=0;i<props.length;i++)\r\n//            Object.defineProperty(obj2,props[i],typeof(parse_funcs[props[i]]==='function')? {get:parse_funcs[props[i]], enumerable:true, configurable:true}\r\n//                                                                                          : {value:parse_funcs[props[i]], enumerable:true, configurable:true}); // not writable\r\n//          var time_tu_func = parse_funcs.time_unit===1?    function(){return this.time;}\r\n//                           : parse_funcs.time_unit===1000? function(){return this.time * 1000;}\r\n//                           :                               function(){return this.time * parse_funcs.time_unit;};\r\n//          Object.defineProperty(obj2,'time_tu', {get:time_tu_func, enumerable:true, configurable:true});\r\n//          obj2.__proto__ = obj;\r\n//          return obj2;\r\n//        }\r\n//        return obj;\r\n      }\r\n      function prep_pfunc(domain, board, type){\r\n//        var key = domain+board+type +'/'+pref.test_mode['6']+pref.debug_mode.parse_error;\r\n//        var key = domain+board+type;\r\n//        var parse_obj = parse_objs[key];\r\n        var type_source = type.substr(0,type.indexOf('_'));\r\n        var type_data   = type.substr(type.indexOf('_')+1);\r\n        var key = key_table[type_source] + key_table[type_data] + ((pref.debug_mode.parse_error)? '_debug':''); // site2['rss'].add_rss has the same line.\r\n        var pfunc = liveTag.mems.init({domain:domain, board:board}).p[key];\r\n        if (!pfunc) {\r\n          var pfunc_root = liveTag.mems[domain].p;\r\n          var pfunc = pfunc_root[key];\r\n          if (!pfunc) {\r\n            var proto = !pref.test_mode['182'] && site2[domain].parse_funcs[type+'_template'] || site2[domain].parse_funcs[type_data+'_template'] || get_getters(type_data==='html');\r\n            var domain_html = (pref.catalog.mimic_base_site || site2[domain].mimic_always)? site.nickname : domain;\r\n            pfunc = {domain: domain,\r\n                       parse_funcs: site2[domain].parse_funcs[type],\r\n                       parse_funcs_html: site2[domain_html].parse_funcs[type_source+'_html'],\r\n                       type_parse: type,\r\n                       type_source: type_source,\r\n                       type_data: type_data,\r\n                       type_html: type_source,\r\n                       domain_html: domain_html,\r\n//                       thread: null, // for faster execution.\r\n//                       page_no: null,\r\n//                       __proto__:site4.parse_funcs_on_demand\r\n                       __proto__:proto\r\n                              };\r\n            if (pref.test_mode['182']) {\r\n              var proto_type = site2[domain].parse_funcs[type+'_template'] || proto;\r\n              while (proto_type && proto_type!==proto) {\r\n                for (var i in proto_type) if (proto_type.hasOwnProperty(i) && !pfunc.hasOwnProperty(i)) Object.defineProperty(pfunc,i,Object.getOwnPropertyDescriptor(proto_type, i));\r\n                proto_type = Object.getPrototypeOf(proto_type);\r\n              }\r\n            }\r\n            if (pfunc.parse_funcs.missing_info) pfunc.missing_info = pfunc.parse_funcs.missing_info;\r\n            pfunc_root[key] = pfunc;\r\n////            var template = site2[domain].parse_funcs[type+'_template'];\r\n////            if (template) {\r\n////////              var keys = Object.keys(template);\r\n////////              for (var i=0;i<keys.length;i++) Object.defineProperty(pfunc, keys[i], {value:template[keys[i]], enumerable:true, configurable:true, writable:true});\r\n//////              for (var i in template) Object.defineProperty(pfunc, i, {value:template[i], enumerable:true, configurable:true, writable:true}); // search in prototype, overwrite getters\r\n////              for (var i in template) // search in prototype, overwrite getters\r\n////                if (typeof(template[i])==='function') Object.defineProperty(pfunc, i, {get:template[i], enumerable:true, configurable:true});\r\n////                else Object.defineProperty(pfunc, i, {value:template[i], enumerable:true, configurable:true, writable:true});\r\n////            }\r\n          }\r\n          pfunc = {board: board, __proto__: pfunc};\r\n          liveTag.mems[domain][board].p[key] = pfunc;\r\n        }\r\n        return pfunc;\r\n      }\r\n      return {\r\n        get_getters: get_getters,\r\n        prep_pfunc: prep_pfunc,\r\n        get: function(doc_obj, domain, board, type, options){\r\n          var parse_obj = prep_pfunc(domain, board, type);\r\n          if (options) {\r\n            if (options.thread!==undefined) {\r\n              if (th_regexp.test(options.thread)) options.thread = options.thread.substr(1);\r\n//              options.op = options.thread; // patch for thread_html\r\n            }\r\n            options.__proto__ = parse_obj;\r\n            parse_obj = options;\r\n          }\r\n//          if (options) {  // working code.\r\n//            if (options.thread) parse_obj.thread = (th_regexp.test(options.thread))? options.thread.substr(1): options.thread;\r\n//            if (options.page) parse_obj.page = options.page;\r\n//          }\r\n          return (type.indexOf('_json')==-1)? parse_obj.parse_funcs.ths({pn:doc_obj, __proto__:parse_obj}) : // for dynamic ripping pfunc, see site2['rss'].parse_funcs.page_html.ths\r\n                                              parse_obj.parse_funcs.ths(doc_obj, parse_obj);\r\n//          return (type.indexOf('_json')==-1)? site2[domain].parse_funcs[type].ths({pn:doc_obj, __proto__:parse_obj}) :\r\n//                                              site2[domain].parse_funcs[type].ths(doc_obj, parse_obj);\r\n        },\r\n////        clean: function(boards){\r\n////          var keys = Object.keys(parse_objs);\r\n////          for (var i=0;i<keys.length;i++) {\r\n////            var key_split = keys[i].split('/');\r\n////            if (boards[key_split[0]+key_split[1]]===undefined) parse_objs[keys[i]] = null;\r\n////          }\r\n////        }\r\n        posts: function(th, start, proto_options){\r\n          if (th.type_data===undefined) {\r\n            var arr = [];\r\n            if (th.posts) for (var i=0;i<th.posts.length;i++) if (!th.posts[i].parse_funcs && th.posts[i].pn) arr[arr.length] = th.posts[i]; // BUG??? th.posts[i].pn was th.posts.pn, I saw this and revised it, but not debugged yet.\r\n            if (arr.length!=0) this.posts({type_data:'html', posts:arr, __proto__:th}, 0, common_func.shallow_copy_1(proto_options));\r\n            th = {type_data:'json', __proto__:th};\r\n          }\r\n          var proto_obj = prep_pfunc(th.domain, th.board, 'post_'+(th.posts[0].type_data||th.type_data));\r\n          if (proto_options) {\r\n            proto_options.__proto__ = proto_obj;\r\n            proto_obj = proto_options;\r\n          }\r\n          var localArchive = th.localArchive;\r\n          if (localArchive) proto_obj = {localArchive:localArchive, __proto__:proto_obj};\r\n//          var proto_obj = {domain:th.domain, board:th.board, domain_html:th.domain_html, parse_funcs:th.parse_funcs};\r\n          if (th.posts) for (var i=start||0;i<th.posts.length;i++) {\r\n            if (!th.posts[i].parse_funcs || localArchive) {\r\n              if (th.posts[i].extra_files) for (var j=0;j<th.posts[i].extra_files.length;j++)\r\n                if (!th.posts[i].extra_files.parse_funcs) th.posts[i].extra_files[j].__proto__ = proto_obj;\r\n              th.posts[i].__proto__ = proto_obj;\r\n            }\r\n          }\r\n          if (th.extra_files) if (!th.extra_files[0].parse_funcs || localArchive) for (var j=0;j<th.extra_files.length;j++) th.extra_files[j].__proto__ = proto_obj;\r\n          if (th.posts[0].extra_files) for (var j=0;j<th.posts[0].extra_files.length;j++) // patch for 8chan's thread_json, extra files is not parsed at first.\r\n            if (!th.posts[0].extra_files.parse_funcs) th.posts[0].extra_files[j].__proto__ = proto_obj;\r\n////      if (th.posts) for (var i=0;i<th.posts.length;i++) {\r\n////        if (th.posts[i].extra_files) for (var j=0;j<th.posts[i].extra_files.length;j++) th.posts[i].extra_files[j].__proto__ = th.__proto__;\r\n////        th.posts[i].__proto__ = th.__proto__;\r\n////      }\r\n////      if (th.extra_files) for (var j=0;j<th.extra_files.length;j++) th.extra_files[j].__proto__ = th.__proto__;\r\n        },\r\n      }\r\n    })(),\r\n    parse_pn_dummy: document.createElement('div'),\r\n    parse_funcs: { // DEFAULT\r\n      'common': {\r\n////        entry : function(dtpo,req) { // doc, thread, post, object // working code.\r\n////          for (var i=0;i<req.length;i++) {\r\n////            if (req[i]===':ITER') {\r\n////              if (req[i+1]===':ALL') for (var j=0;j<dtpo[req[i+2]].length;j++) this.exe_sub(dtpo,req,i,j);\r\n////              else if (req[i+1]===':FL') {\r\n////                this.exe_sub(dtpo,req,i,0);\r\n////                this.exe_sub(dtpo,req,i,dtpo[req[i+2]].length-1);\r\n////              } else if (req[i+1]===':FLx' || req[i+1]===':GFLx' || req[i+1]===':GALL') {\r\n////                var j = dtpo[req[i+2]].length - pref[cataLog.embed_mode].t2h_num_of_posts;\r\n////                if (j<1 || req[i+1]===':GALL') j=1;\r\n////                if (req[i+1]===':FLx') {\r\n////                  this.exe_sub(dtpo,req,i,0);\r\n////                  while (j<dtpo[req[i+2]].length) this.exe_sub(dtpo,req,i,j++);\r\n////                } else {\r\n////  //                dtpo[req[i+3][0]] = [];\r\n////                  Object.defineProperty(dtpo,req[i+3][0], {value:[], enumerable:true, configurable:true, writable:true});\r\n////                  dtpo[req[i+3][0]].push(dtpo[req[i+2]][0][req[i+3][1]]);\r\n////                  while (j<dtpo[req[i+2]].length) dtpo[req[i+3][0]].push(dtpo[req[i+2]][j++][req[i+3][1]]);\r\n////                  for (var j=dtpo[req[i+3][0]].length-1;j>=0;j--) if (!dtpo[req[i+3][0]][j]) dtpo[req[i+3][0]].splice(j,1);\r\n////                }\r\n////              }\r\n////              i += 3;\r\n////  //          } else dtpo[req[i]] = this[req[i]](dtpo,req);\r\n////            } else Object.defineProperty(dtpo,req[i], {value:this[req[i]](dtpo,req), enumerable:true, configurable:true, writable:true});\r\n////          }\r\n////        },\r\n////        exe_sub : function(dtpo,req,i,j) {\r\n////          dtpo[req[i+2]][j].domain = dtpo.domain;\r\n////          dtpo[req[i+2]][j].board  = dtpo.board;\r\n////          this.entry(dtpo[req[i+2]][j],req[i+3]);\r\n////        },\r\n        posts: function(){return undefined;},\r\n        com: function(){return undefined;},\r\n        flags: function(){return undefined;},\r\n        flag: function(){},\r\n        id: function(){},\r\n        pn_id: function(){},\r\n        pn_name: function(){},\r\n        country: function(){},\r\n        hrefs: function(){},\r\n        trip: function(){}, // hit this line in archive of 4chan with trip search acrive.\r\n        pn_trip: function(){},\r\n        id2: function(){},\r\n//        op_img_url: function() {return undefined;},\r\n//        preventDefault:function(e){e.preventDefault();},\r\n        th_init: null,\r\n//        th_destroy: null,\r\n        tn_as: function(th){return th.pn.getElementsByTagName('a');},\r\n        tn_imgs: function(th){\r\n          var imgs = [];\r\n//          for (var i=0;i<as.length;i++) imgs[i] = as[i].getElementsByTagName('img')[0];\r\n          var as = th.pn && th.pn.getElementsByTagName('a');\r\n          if (as) for (var i=0;i<as.length;i++) {\r\n            var tmp = as[i].getElementsByTagName('img')[0];\r\n            if (tmp) imgs[imgs.length] = tmp;\r\n          }\r\n          return imgs;\r\n        },\r\n        key: function(th){return th.domain + th.board + th.no;},\r\n//        pn: function(th){return site2[th.domain_html].catalog_json2html3(th,th.board, this.op_img_url(th));},\r\n        op_img_url: function(th) {return site2[th.domain].catalog_json2html3_thumbnail(th, th.board);},\r\n        get_op_src: function(th) {return th.op_img_url;},\r\n        ths_array: function(doc,ths_col){\r\n          var ths = [];\r\n          if (ths_col)\r\n            for (var i=0;i<ths_col.length;i++) {\r\n//            for (var i=ths_col.length-1;i>=0;i--) { // WHY???\r\n              var page = (doc.type_html==='catalog')? Math.floor(i/15)+'.'+i%15\r\n                                                    : (doc.type_html==='page')? doc.page + '.' + i : undefined; // page_html\r\n              ths[i] = {\r\n                pn: ths_col[i],\r\n                page: page,\r\n                __proto__: doc.__proto__};\r\n            }\r\n          return ths;\r\n        },\r\n        time: function(th){return undefined;},\r\n        time_posted : function(th){return undefined;},\r\n        time_unit: 1,\r\n        has_posts: true,\r\n//        last_replies: function(th){return th.posts.slice(1);},\r\n////        post_no: function(post){return post.no;},\r\n        txt: function(th){\r\n          site2['DEFAULT'].parse_pn_dummy.innerHTML = th.com;\r\n          return site2['DEFAULT'].parse_pn_dummy[brwsr.innerText];\r\n        },\r\n        type_com: 'html',\r\n        footer_prep: function(th, footer){\r\n          var str = footer.innerHTML.replace(/ *R:[0-9 \\/]*I:[0-9 \\/]*/,'');\r\n          str = str.replace(/P:[0-9 \\/]*/,'');\r\n          str = str.replace(/ *\\(sticky\\) */,'');\r\n          if (str!=='') {\r\n            footer.innerHTML = '<span></span>' + str;\r\n            footer = footer.childNodes[0];\r\n          }\r\n        },\r\n//        adopt_pn: function(th){\r\n////          for (var i=0;i<th.posts.length;i++) Object.defineProperty(th.posts[i], 'pn', {value:document.adoptNode(th.posts[i].pn), enumerable:true, configurable:true, writable:true});\r\n//          Object.defineProperty(th, 'pn', {value:document.adoptNode(th.pn), enumerable:true, configurable:true, writable:true});\r\n//        },\r\n        get_lth_from_node: function(pn){\r\n          while (pn && !pn.name) pn = pn.parentNode;\r\n          return pn && liveTag.mems.getFromName(pn.name) || null;\r\n        },\r\n//        txt2com: function(txt){return txt;},\r\n        nativeUpdate2pn: function(pn_in){return pn_in.lastChild;}, // rip container from updated instance by native updater.\r\n//        nativeUpdate2pn: function(pn_in){return pn_in;},\r\n        nofFiles: function(){return 0;} // nof files in post\r\n      },\r\n      'headline_html': {\r\n        footer: function(th){return th.pn.insertBefore(cnst.dom('<span style=\"padding:0 3px 0 0\"></span>'),th.pn.firstChild);},\r\n        css: '.threadIcons {margin:0px;position:static;width:auto;text-align:left;display:inline}',\r\n      },\r\n      'catalog_html': {\r\n        posts: function(th){return [{pn:th.pn, __proto__:th.__proto__}];}, // test, gives mirror of th, but not getter, [{get 0(){return th;}, length:1}]\r\n//        posts: function(th){return [{sub:th.sub, com:th.com, name:th.name, pn:th.pn}];}, // BUG, should be [{sub:th.sub, com:th.com, name:th.name}], but this causes too many erroes because all data must be parsed from th.pn in catalog_html, pn===undefined needes to write all uses of posts[0].XXX \r\n        time: function(th){return th.time_created;},\r\n        posts_full: (function(){\r\n          var exlist = {posts:null, pn:null, flag:null, flags:null, footer:null, pn_name:null, ths:null, page:null,\r\n                        tn_as:null, tn_imgs:null, txt:null, pn_id:null, pn_trip:null,\r\n                        parse_funcs:null, parse_funcs_html:null, type_parse:null, type_source:null, type_data:null, type_html:null,\r\n                        domain:null, board:null, domain_html:null, exe_sub:null, exe_sub2:null};\r\n          return function(th){\r\n//            for (var prop in th) if (exlist[prop]===undefined) th.posts[0][prop] = th[prop]; // invoke getters.\r\n            for (var prop in th) if (exlist[prop]===undefined)\r\n              if (th.parse_funcs[prop]) Object.defineProperty(th.posts[0], prop, {value:th[prop], enumerable:true, configurable:true, writable:true}); // invoke getters to cut reference to pn(whole html), and also set th[prop].\r\n          };\r\n        })(),\r\n        has_posts: false,\r\n        type_com: 'txt',\r\n        filename: function(th){\r\n          if (!th.op_img_url) return undefined;\r\n          var fname = th.op_img_url.replace(/.*\\//,'');\r\n          var idx = fname.indexOf('.');\r\n          th.tim = fname.substr(0,idx);\r\n//          th.ext = fname.substr(  idx);\r\n          return th.tim;\r\n        },\r\n      },\r\n      'catalog_json': {\r\n        ths: function(obj, parse_obj) {\r\n          var ths = [];\r\n          for (var i=0;i<obj.length;i++)\r\n            if (obj[i].threads) for (var j=0;j<obj[i].threads.length;j++) {\r\n              var post0 = obj[i].threads[j];\r\n              post0.sticky = obj[i].threads[j].sticky===1; // overwrite property of the same name before setting prototype to use polarity.\r\n              post0.__proto__ = parse_obj;\r\n              ths[ths.length] = {\r\n                page: i + '.' + j,\r\n                posts: [post0],\r\n                __proto__:post0 // all parser must need to accept both post.pn and thread.pn, but this is a catalog and post is wrapped already(has parse_funcs), OK.\r\n              };\r\n//              obj[i].threads[j].page = i + '.' + j;\r\n//              obj[i].threads[j].sticky = obj[i].threads[j].sticky===1; // overwrite property of the same name before setting prototype to use polarity.\r\n//              obj[i].threads[j].type_html = 'catalog';\r\n//              obj[i].threads[j].__proto__ = parse_obj;\r\n//              ths[ths.length] = obj[i].threads[j];\r\n            }\r\n          return ths;\r\n        },\r\n////        posts: function(th){return [{sub:th.sub, com:th.com, name:th.name, trip:th.trip, pn:th.pn, time:th.time_created}];}, // time for post_json2html\r\n////        posts: function(th){return [{sub:th.sub, com:th.com, name:th.name, time:th.time}];}, // this is used at scan, so the lighter is the best. 'time' is only for 'check_reply' and 'stats'. And this removes prototype chain to reduce memory consumption instead of using '[{__proto__:th}]'.\r\n//        posts: function(th){return [{time:th.time, DUMMY:true}];}, // 'time' is for 'check_reply' and 'stats'. And this removes prototype chain to reduce memory consumption instead of using '[{__proto__:th}]'.\r\n//        posts_full: function(th){\r\n////          th.posts[0] = {}; // BUG NEVER DO THIS. posts_full is called AFTER SETTING PROTOTYPE in wrap_to_parse.posts in format_html.prepare_html_prep_posts\r\n//            delete th.posts[0].DUMMY;\r\n//////          th.posts[0].no = th.no; // works\r\n//////          th.posts[0].time = th.time;\r\n//          var keys = Object.keys(th);\r\n////          var exlist = ['obj','posts'];\r\n////          for (var i=0;i<keys.length;i++) if (exlist.indexOf(prop)==-1) th.posts[0][keys[i]] = th[keys[i]]; // remove props in prototype chain. // will be this.\r\n//          for (var i=0;i<keys.length;i++) if (keys[i]!=='posts' && keys[i]!=='pn') th.posts[0][keys[i]] = th[keys[i]]; // remove props in prototype chain.\r\n//        },\r\n        has_posts: false,\r\n      },\r\n//      'catalog_html': {\r\n//        ths_array: function(doc,ths_col){ // working code.\r\n//          var ths = [];\r\n//          if (ths_col)\r\n////            if (site.nickname!==doc.domain) site2[doc.domain].absolute_link(doc.pn, doc.board);\r\n//            for (var i=ths_col.length-1;i>=0;i--) {\r\n//              var page = Math.floor(i/15)+'.'+i%15;\r\n//              ths[i] = {\r\n//                pn: ths_col[i],\r\n//                type_html: 'catalog_html',\r\n////                page: Math.floor(i/15)+'.'+i%15, // cause warning of 'Object literal with complex property' in V8.\r\n//                page: page,\r\n//                __proto__: doc.__proto__};\r\n//            }\r\n//          return ths;\r\n//        },\r\n//      },\r\n      'page_html': {\r\n//        ths_array: function(doc,ths_col){ // working code.\r\n//          var ths = [];\r\n//          if (ths_col)\r\n////            if (site.nickname!==doc.domain) site2[doc.domain].absolute_link(doc.pn, doc.board);\r\n//            for (var i=ths_col.length-1;i>=0;i--) {\r\n//              var page = (doc.page!=='?')? doc.page + '.' + i : doc.page;\r\n//              ths[i] = {\r\n//                pn: ths_col[i],\r\n//                type_html: 'page_html',\r\n////                page: (doc.page!=='?')? doc.page + '.' + i : doc.page, // cause warning of 'Object literal with complex property' in V8.\r\n//                page: page,\r\n//                __proto__: doc.__proto__};\r\n//            }\r\n//          return ths;\r\n//        },\r\n        posts_array: function(th,pns){ // working code.\r\n          var pts = [];\r\n          var proto = site2[th.domain].wrap_to_parse.prep_pfunc(th.domain, th.board, 'post_html');\r\n//          var proto = (th.domain==='4chan')? site2[th.domain].wrap_to_parse.prep_pfunc(th.domain, th.board, 'post_html') : th.__proto__; // tests only in 4chan, this reuires so many test...\r\n//          var proto_kwd = 'post_' + th.type_data; // working code, WILL BE THIS.\r\n//          var proto = (site2[th.domain].parse_funcs.hasOwnProperty(proto_kwd))? site2[th.domain].parse_funcs[proto_kwd] : th.__proto__;\r\n//          var proto = th.__proto__; \r\nif (!pref.test_mode['5']) { // faster, because object creation is light,,,orz,,,\r\n          for (var i=0;i<pns.length;i++) pts[pts.length] = {pn:pns[i], __proto__:proto};\r\n} else {\r\n          pts.pns = pns;\r\n          pts.idx0 = 0;\r\n          pts.idx1 = pns.length-1;\r\n          pts.get0 = this.posts_get0;\r\n          pts.get1 = this.posts_get1;\r\n          pts.proto = proto;\r\n//          var pts = {pn:pns, idx0:0, idx1:pns.length-1, length:pns.length, __proto__:proto};\r\n          Object.defineProperty(pts, pts.idx0, {get: pts.get0, enumerable:true, configurable:true});\r\n          Object.defineProperty(pts, pts.idx1, {get: pts.get1, enumerable:true, configurable:true});\r\n}\r\n          return pts;\r\n        },\r\n        posts_get0: function(){\r\n//console.log('get0: '+this.idx0);\r\n          var val = {pn:this.pns[this.idx0],  __proto__:this.proto}; // this.__proto__ reffers Array, doesn't work.\r\n          Object.defineProperty(this, this.idx0, {value: val, enumerable:true, configurable:true, writable:true});\r\n          if (++this.idx0<this.idx1) Object.defineProperty(this, this.idx0, {get: this.get0, enumerable:true, configurable:true});\r\n          return val;\r\n        },\r\n        posts_get1: function(){\r\n//console.log('get1: '+this.idx1);\r\n//console.log('this.pns: ');\r\n//console.log(this.pns);\r\n          var val = {pn:this.pns[this.idx1],  __proto__:this.proto};\r\n          Object.defineProperty(this, this.idx1, {value: val, enumerable:true, configurable:true, writable:true});\r\n          if (--this.idx1>this.idx0) Object.defineProperty(this, this.idx1, {get: this.get1, enumerable:true, configurable:true});\r\n          return val;\r\n        },\r\n//        posts_array: function(th,posts){ // working code.\r\n//          var pts = [];\r\n//          for (var i=0;i<posts.length;i++) pts[pts.length] = {pn:posts[i], __proto__:th.__proto__};\r\n//          return pts;\r\n//        },\r\n        posts: function(th){return this.posts_array(th, th.pn.getElementsByClassName('post'));},\r\n////////        posts_pn: function(th){return th.pn.getElementsByClassName('post');},\r\n        time_posted: 'thread_html',\r\n        time_bumped: function(th){ // TO BE FIXED.\r\n          return th.posts[th.posts.length-1].time;\r\n        },\r\n        time_created: function(th){return th.posts[0].time;},\r\n        key: function(th){return th.domain + th.board + th.no;},\r\n        insert_footer4: function(ref){\r\n          var footer = document.createElement('div');\r\n          return ref.parentNode.insertBefore(footer,ref);\r\n        },\r\n        flags: function(th){ // for on demand access.\r\n          var flags = [];\r\n          var i = th.posts.length -1;\r\n          var n = pref[cataLog.embed_mode].t2h_num_of_posts -1;\r\n          if (i<n) { // POSTS MUST BE ACCESSED FROM HEAD OR TAIL.\r\n            n=0;\r\n            while (n<=i) {\r\n//console.log('up: '+n+', '+i);\r\n              if (th.posts[n]) flags[n] = th.posts[n].flag; // 8chan doesn't show 5 posts all the time.\r\n              n++;\r\n            }\r\n          } else {\r\n            while (n>=0) {\r\n//console.log('down: '+n+', '+i);\r\n//console.log(th.posts[i]);\r\n              if (th.posts[i]) flags[n--] = th.posts[i--].flag;\r\n              if (n==0) i=0;\r\n            }\r\n          }\r\n          return flags;\r\n        },\r\n////        flags: function(th){ // for on demand access. // worked code, but post was changed to had to be accessed from top or end.\r\n////          var flags = [];\r\n////          var i = th.posts.length - pref.catalog_t2h_num_of_posts;\r\n////          if (i<1) i=1;\r\n////          if (th.posts.length!=0) flags[0] = th.posts[0].flag;\r\n////          while (i<th.posts.length) {\r\n////            if (th.posts[i]) flags[i] = th.posts[i].flag;\r\n////            i++;\r\n////          }\r\n////          return flags;\r\n////        },\r\n        html_org: function(th){return th.pn.innerHTML;},\r\n        sticky: function(){return false;},\r\n////        pop_post_prep: function(th){ // working code.\r\n////          th.children = th.pn.childNodes;\r\n////          th.idx_pop = th.pn.childNodes.length-1;\r\n////        },\r\n        type_com: 'txt',\r\n        replace_omitted_info : function(dst, src){dst.textContent = src.textContent;},\r\n        replace_omitted_info2: 'replace_omitted_info',\r\n        posts_full: 'catalog_html',\r\n        get_max_page: function(doc){\r\n          var pns = doc.getElementsByClassName('pages')[0];\r\n          if (!pns) return;\r\n          pns = pns.childNodes;\r\n          var max = 0;\r\n          for (var i=0;i<pns.length;i++) if (max+1 == pns[i].textContent) max++; // == used intentionally.\r\n          return max;\r\n        },\r\n      },\r\n      'page_json': {\r\n        ths: function(obj, parse_obj){\r\n          var ths = [];\r\n          if (obj && obj.threads) for (var i=0;i<obj.threads.length;i++) { // patch for 8chan\r\n//          for (var i=0;i<obj.threads.length;i++) {\r\n            var tgt = obj.threads[i];\r\n            if (tgt) { // patch for 8chan\r\n              tgt.page = (parse_obj.page)? parse_obj.page + '.' + i : undefined;\r\n              tgt.key = parse_obj.domain + parse_obj.board + tgt.posts[0].no;\r\n              tgt.posts[0].__proto__ = parse_obj;\r\n              tgt.__proto__ = tgt.posts[0];\r\n              ths[i] = tgt;\r\n            }\r\n////            if (tgt) { // patch for 8chan // working code.\r\n////              ths[i] = {obj: tgt, // buffered, because if obj is used, change of obj's contents will affect to this program directly.\r\n////                        posts: tgt.posts, ext: tgt.posts[0].ext, tim:tgt.posts[0].tim,\r\n////                        time: tgt.posts[0].time, // for 'check_reply.check_t1_op'\r\n////                        key: parse_obj.domain + parse_obj.board + tgt.posts[0].no, no: tgt.posts[0].no,\r\n////                        page: (parse_obj.page)? parse_obj.page + '.' + i : undefined,\r\n////                        __proto__:parse_obj};\r\n////            }\r\n////            tgt.posts = null; // cut the reference, if leave this, cutting th.posts.length in 'update_posts_replace_prep' doesn't affect to tgt.posts and tgt.posts keep containing all posts.\r\n          }\r\n          return ths;\r\n        },\r\n        flags: function(th){\r\n          if (!th.country) return undefined;\r\n          var n = th.posts.length - pref[cataLog.embed_mode].t2h_num_of_posts;\r\n          return [th].concat(th.posts.slice((n<=1)? 1 : n)); // patch for 4chan:catalog_html, it isn't formed as catalog_json, posts[0] doesn't contain full information.\r\n//          return (n<=1)? th.posts.slice() : [th.posts[0]].concat(th.posts.slice(n));\r\n        },\r\n      },\r\n      'thread_html'  : {\r\n        ths_array: function(doc, ths_col){\r\n          return [{pn:ths_col,\r\n//                   type_html: 'thread_html',\r\n//                   page: '?',\r\n                   __proto__: doc.__proto__}];\r\n        },\r\n        time_posted : function(th){return th.posts[th.posts.length-1].time*1000;},\r\n        posts_full: 'catalog_html',\r\n        id: function(th){return th.posts[0].id;},\r\n        country: function(th){return th.posts[0].country;},\r\n        trip: function(th){return th.posts[0].trip;},\r\n        flag: function(th){return th.posts[0].flag;},\r\n        name: function(th){return th.posts[0].name;},\r\n        type_com: 'txt',\r\n        time_unit:1000,\r\n      },\r\n      'thread_json'  : {\r\n        ths: function(obj, parse_obj){\r\n          obj.key = parse_obj.domain + parse_obj.board + obj.posts[0].no;\r\n          obj.posts[0].__proto__ = parse_obj;\r\n          obj.__proto__ = obj.posts[0];\r\n          return [obj];\r\n        },\r\n//        ths: function(obj, parse_obj){return site2['DEFAULT'].parse_funcs.page_json.ths({threads:[obj]}, parse_obj);}, // working code.\r\n////        ths: function(obj, parse_obj){\r\n////          return [{obj:obj, posts: obj.posts, ext: obj.posts[0].ext, tim:obj.posts[0].tim,\r\n////                   key: parse_obj.domain + parse_obj.board + parse_obj.thread, no: parse_obj.thread, __proto__:parse_obj}];\r\n////        },\r\n\r\n////        pop_post_prep: function(obj){ // working code.\r\n////          obj.idx_pop = obj.posts.length-1;\r\n////        },\r\n////        pop_post: function(obj){\r\n////          if (obj.idx_pop>=0) {\r\n////            obj.post = obj.posts[obj.idx_pop--];\r\n//////            obj.post.parse_funcs = this;\r\n//////            obj.post.__proto__ = obj.__proto__;\r\n////            obj.post.time *= 1000; // DESTRUCTIVE\r\n////            return true;\r\n////          } else return false;\r\n////        },\r\n////        preprocess: function(obj){ // working code, but deleted.\r\n////          if (!obj.preprocessed) {\r\n////            obj.preprocessed = true;\r\n////            for (var i=obj.posts.length-1;i>=0;i--) obj.posts[i].time *= 1000;\r\n////          }\r\n////        },\r\n////        time_created : function(obj){return obj.posts[0].time;}, // preprocessed\r\n////        time_bumped : function(obj){return obj.posts[obj.posts.length-1].time;}, // preprocessed\r\n        time_created : function(obj){return obj.posts[0].time*1000;},\r\n        time_bumped : function(obj){\r\n          if (obj.posts[0].bumplimit) return undefined; // 4chan doesn't have email field but compensated.\r\n          var i = obj.posts.length-1;\r\n          while (i>0 && obj.posts[i].email && obj.posts[i].email==='sage') i--;\r\n          return obj.posts[i].time*1000;\r\n        },\r\n        time_posted : function(obj){return obj.posts[obj.posts.length-1].time*1000;},\r\n        nof_posts: function(obj){return obj.posts[0].replies+1;},\r\n        nof_files: function(obj){return obj.posts[0].images+1;},\r\n        has_nof_files: true,\r\n        sub: function(obj){return (obj.posts[0].sub || '');},\r\n        name: function(obj){return (obj.posts[0].name || '');},\r\n        com: function(obj){return (obj.posts[0].com || '');},\r\n        sticky: function(obj){return obj.posts[0].sticky===1;},\r\n        time_unit: 1000,\r\n        prep_to_archive: function(obj){return {posts:obj};},\r\n        rip_from_archive: function(obj){return obj.posts || obj;}, // patch for dual acceptance, internal and external format.\r\n//        proto: 'page_json'\r\n      },\r\n      'post_html': {\r\n        sub: function(post){\r\n          var sub = post.pn.getElementsByClassName('subject')[0];\r\n          return (sub)? sub.textContent : '';\r\n        },\r\n        img2src: function(img){return img.parentNode.href;},\r\n        img2ext: function(img){return img.parentNode.getAttribute('data-ext');},\r\n        nofFiles: function(post){return post.pn.getElementsByClassName('file').length;},\r\n      },\r\n      'post_json': {\r\n        time_unit: 1000,\r\n        pn: function(post){return site2[post.domain_html].post_json2html(post,post.board);}, // blocked by template\r\n        anchor: function(){},\r\n        hrefs: function(post){\r\n          if (!post.com) return;\r\n          var hrefs = post.com.match(/href=\"([^\"]*)\"/g);\r\n          if (hrefs) for (var i=0;i<hrefs.length;i++) {\r\n            var idx = hrefs[i].indexOf('://');\r\n            hrefs[i] = hrefs[i].slice(idx===-1? 6:idx+1, -1);\r\n          }\r\n          return hrefs;\r\n        },\r\n      },\r\n      'base_html': { // for HTML based sites, timeunit===1\r\n        time_created: function(th){return th.posts[0].time;},\r\n        time_posted: function(th){return th.posts[th.posts.length-1].time;},\r\n        time_unit: 1,\r\n        proto: 'page_html',\r\n      },\r\n      'json_template': {\r\n        sub: '',\r\n        name: 'Anonymous',\r\n        com: '',\r\n        sticky: undefined,\r\n//        pn: undefined, // block getter\r\n        no: undefined, // patch\r\n        time: undefined, // patch\r\n        get nofFiles(){return this.filename? 1 : 0;},\r\n      },\r\n    },\r\n//    parse_funcs : function(dtp,req) { // doc, thread, post, use .call() to call with 'this'.\r\n//      for (var i=0;i<req.length;i++) {\r\n//        if (this[req[i]]) dtp[req[i]] = this[req[i]](dtp,req);\r\n//        if (req[i]==='ths') i++;\r\n//      }\r\n//    },\r\n    parse_parts:{\r\n      add_op_img_url: function(posts,board,domain){\r\n         for (var i=0;i<posts.length;i++)\r\n          posts[i].op_img_url = site2[domain].catalog_json2html3_thumbnail(posts[i], board);\r\n      },\r\n    },\r\n////    update_posts_replace: function(th,th_old,pnode) { // working code.\r\n////      if (th_old.posts) {\r\n////        th_old.posts[0].pn.innerHTML = th.posts[0].pn.innerHTML;\r\n////        for (var i=th_old.posts.length-1;i>=1;i--) this.update_posts_remove(th_old,i,pnode);\r\n////      }\r\n////      th_old.posts = [th_old.posts[0]];\r\n////      this.update_posts_add(th,th_old,pnode);\r\n////    },\r\n    update_posts_merge_prep: function(posts, posts_m, num, by_no) { // merge posts by time\r\n      if (posts) {\r\n        num = (num>=0)? num+1 : ((posts_m && posts_m.length)? posts_m.length : 0) + posts.length;\r\n        if (num<posts.length) posts = posts.slice(0,1).concat(posts.slice(posts.length - num + 1)); // cut\r\n        var i=1;\r\n        var j=0;\r\n        var posts_ret = [posts[0]];\r\n        if (by_no) // by no.\r\n          while (i<posts.length && j<posts_m.length) {\r\n            if (posts[i].no === posts_m[j].no) {posts_ret[posts_ret.length] = posts[i++]; j++; continue;}\r\n            posts_ret[posts_ret.length] = (posts[i].no < posts_m[j].no)? posts[i++] : posts_m[j++];\r\n          }\r\n        else\r\n          while (i<posts.length && j<posts_m.length)\r\n            posts_ret[posts_ret.length] = (posts[i].time * posts[i].parse_funcs.time_unit < posts_m[j].time * posts_m[j].parse_funcs.time_unit)? posts[i++] : posts_m[j++];;\r\n        posts_ret = posts_ret.concat((i<posts.length)? posts.slice(i) : posts_m.slice(j));\r\n        return (posts_ret.length<=num)? posts_ret :\r\n                                        posts_ret.slice(0,1).concat(posts_ret.slice(posts_ret.length-num+1,posts_ret.length));\r\n      }\r\n    },\r\n    update_posts_merge_bases: {\r\n      factory: function(){\r\n        return {\r\n          bases: {},\r\n          initialized: false,\r\n          shown: new Map(), // Set(),\r\n          shownSet: new Set(), // null,\r\n//          view: this.view,\r\n          __proto__: this\r\n        };\r\n      },\r\n      bases: {},\r\n      bases_unique: function(){\r\n        var map = new Map();\r\n        for (var name in this.bases) map.set(this.bases[name], name);\r\n        return map;\r\n      },\r\n      reorder_bases: function(clg){\r\n        for (var b in this.bases)\r\n          if (this.bases[b].reorder_req>=4) this.bases[b].reorder_all(clg); else this.bases[b].re_style(clg);\r\n      },\r\n      initialized: false,\r\n      query: function(key, tgt_th, th, isShown, clg){\r\n//      query: function(key, tgt_th, th, tgt, isShown, clg){\r\n//        if (this.bases[key]) return this.bases[key]; // this is checked in caller.\r\n        var tgt = this.base_tgts(key, clg.pref[clg.mode]);\r\n        if (!tgt) return undefined;\r\n        var base_by_tgt = this.bases[tgt];\r\n        var base = base_by_tgt || this.base_factory(key, tgt_th, th, isShown, clg);\r\n        this.bases[key] = base;\r\n        this.merge_th(tgt_th, th, base, key, clg);\r\n        if (base_by_tgt) {\r\n          if (isShown) clg.func_hide_org(key);\r\n        } else if (!this.initialized) this.setup_hook(clg);\r\n        tgt_th[0] = base.pn; // after func_hide_org\r\n//        var base = (tgt)? this.bases[tgt] : null; // working code\r\n//        if (base) {\r\n////        for (var i=0;i<tgts.length;i++) if (this.bases[tgts[i]]) {\r\n////          var base = this.bases[tgts[i]];\r\n//          this.bases[key] = base;\r\n//          this.merge_th(tgt_th, th, base, key, clg);\r\n//          if (isShown) cataLog.catalog_obj2.func_hide_org(key);\r\n////          th.pn.setAttribute('style','display:none'); // TEMPORAL PATCH.\r\n//          tgt_th[0] = base.pn;\r\n//          return base;\r\n//        }\r\n//        this.base_factory(key, tgt_th, th, isShown, clg);\r\n//        this.bases[key] = base;\r\n//        this.merge_th(tgt_th, th, base, key, clg);\r\n//        if (!this.initialized) this.setup_hook();\r\n        return base;\r\n      },\r\n      base_factory: (function(){\r\n        function func_0(v){return v[8][0];}\r\n        function func_1(v){return v[8][1];}\r\n        function func_2(v){return v[8][2];}\r\n        function func_3(v){return v[8][3];}\r\n        function func_4(v){return v[8][4];}\r\n        function func_max(a,c){return a>c? a : c;}\r\n        function func_min(a,c){return a<c? a : c;}\r\n        function func_sum(a,c){return a+c;}\r\n        var base_tmp;\r\n        function base_tmp_map_reduce(func){return base_tmp.lths.map(func).reduce(func_blank_sum);}\r\n        function func_blank_sum(a,c){return a && c? a+c : a? a : c;}\r\n        function lth_ta(lth){return (lth.ta && lth.ta.posts)? lth.ta.posts.length : '';}\r\n        function lth_pd(lth){return lth.pd? lth.pd.length : '';}\r\n        function lth_sp(lth){return lth.sg? lth.sg.size : '';}\r\n        var emu_ta = {posts:{get length(){return base_tmp_map_reduce(lth_ta);}}};\r\n        var emu_pd = {get length(){return base_tmp_map_reduce(lth_pd);}};\r\n        var emu_sp = {get size(){return base_tmp_map_reduce(lth_sp);}};\r\n        var emu_16 = {recent_posts: function(num){\r\n          if (num===undefined || num===null) num = {lth: base_tmp, __proto__:base_tmp.tgt_ths[0][16]}.get_t2h_num_of_posts();\r\n          var posts = base_tmp.posts ||\r\n            (base_tmp.lths.forEach(function(lth){if (lth.ta) site2[lth.domain].wrap_to_parse.posts({posts:lth.ta.posts, __proto__:lth.ta.posts[0]});}), // for not watching threads.\r\n             base_tmp.tgt_ths.map(function(v){return v[16].recent_posts(num);}).reduce(function(a,c){return site2['DEFAULT'].update_posts_merge_prep(a,c, num);}));\r\n          return site2['DEFAULT'].update_posts_replace_prep(null, posts, num);\r\n        }};\r\n        var base_proto = {\r\n          lazy_draw: function(idx){\r\n            if (idx>=this.lazy.length) this.lazy[idx] = true; // all are not initialized.\r\n            else this.lazy.splice(idx,0,true);\r\n            if (this.lazy_idx>idx) this.lazy_idx = idx;\r\n          },\r\n          remove: function(idx){\r\n            this.posts.splice(idx,1);\r\n            if (idx<this.lazy_idx) this.lazy_idx--;\r\n            return (this.lazy)? !this.lazy.splice(idx,1)[0] : true;\r\n          },\r\n          draw_1_pos: function(idx){ // this.lazy_idx may refer \"true\" node by this.\r\n            var n=idx+1;\r\n            while (n<this.lazy.length && this.lazy[n]) n++; // skip myself also\r\n            this.lazy[idx] = false;\r\n            return n;\r\n          },\r\n          get_class: function(key, force, old) {\r\n            if (!force && !pref.proto.merge_lv) return null;\r\n            var lv = pref_func.merge_obj5a_sc(key,old? pref3.proto.merge_lv_obj2_old : pref3.proto.merge_lv_obj2, null);\r\n//            var lv = (key===site.nickname+site.board+site.no)? 0 : 1; // test\r\n            return (lv===null)? null : pref.script_prefix+'_merged'+lv;\r\n          },\r\n\r\n          posts: null, // dummies for catalog or headline\r\n          lazy: null,\r\n          lazy_idx: null,\r\n//        tgt_th: {\r\n//          '8':{\r\n//              get 0(){\r\n//                var latest = this.tgt_ths[0][8][0];\r\n//                for (var i=1;i<this.tgt_ths.length;i++) {\r\n//                  var test = this.tgt_ths[i][8][0];\r\n//                  if (test>latest) latest = test;\r\n//                }\r\n//                return latest;\r\n//              },\r\n              get 0(){return this.tgt_ths.map(func_0).reduce(func_max);},\r\n              get 1(){return this.tgt_ths.map(func_1).reduce(func_min);},\r\n              get 2(){return this.tgt_ths.map(func_2).reduce(func_sum);},\r\n              get 3(){return this.tgt_ths.map(func_3).reduce(func_sum);},\r\n              get 4(){return this.tgt_ths.map(func_4).reduce(func_max);},\r\n              get 8(){return this;}, // remove hierarchy, but tricky\r\n//          },\r\n            get 14(){\r\n              if (this.tgt_ths.length==1) return this.tgt_ths[14];\r\n              var tmp;\r\n              var arr = this.tgt_ths.map(function(v){return (tmp = (v[14]||'').split('.'), tmp[0] = parseInt(tmp[0],10), tmp);}).sort(function(a,b){return a[0]!=b[0]? a[0]-b[0] : a[1].length!=b[1].length? a[1].length-b[1].length : a[1]<b[1]? -1 : 1});\r\n              return arr[0].join('.')+'-'+arr[arr.length-1].join('.');\r\n            }, // '14': 'M',\r\n            get 16(){base_tmp = this;return emu_16;}, // '16':{recent_posts:function(){return null;}},\r\n//        },\r\n//        lth: {\r\n            domain:'', board:'', no:'',\r\n            get tags(){\r\n              var pf = pref.proto.footer.merged_tag;\r\n              if (pf==='no') return [];\r\n              if (pf==='all') {\r\n                var tags_all = {};\r\n                for (var i=0;i<this.lths.length;i++) {\r\n                  var tags = this.lths[i].tags;\r\n                  for (var j=0;j<tags.length;j++) tags_all[tags[j]] = (tags_all[tags[j]]||0) + 1; // obj might be faster than Map?\r\n                }\r\n                var tags0 = this.lths[0].tags;\r\n                for (var j=0;j<tags0.length;j++) if (tags_all[tags0[j]]!=this.lths.length) return tags.slice(0,j);\r\n                return tags0;\r\n              } else {\r\n                var tags_all = new Map();\r\n                for (var i=0;i<this.lths.length;i++) {\r\n                  var tags = this.lths[i].tags;\r\n                  for (var j=0;j<tags.length;j++) tags_all.set(tags[j], (tags_all.get(tags[j])||0)+1);\r\n                }\r\n                var tags_ret = [];\r\n                for (var tag of tags_all.keys()) tags_ret[tags_ret.length] = tag;\r\n                return tags_ret.sort(function(a,b){return tags_all.get(b) - tags_all.get(a);});\r\n              }\r\n            },\r\n            get watched(){return this.lths.some(function(v){return v.watched;});},\r\n            get watched_p(){return this.lths.some(function(v){return v.watched_p;});},\r\n            get nrtm(){return this.lths.map(function(v){return v.watched && v.nrtm || 0;}).reduce(func_sum);},\r\n            get nr(){return this.lths.map(function(v){return v.watched_p && v.nr || 0;}).reduce(func_sum);},\r\n            get ta(){base_tmp = this; return emu_ta;},\r\n            get pd(){base_tmp = this; return emu_pd;},\r\n            get sp(){base_tmp = this; return emu_sp;},\r\n            get archived(){\r\n              var len = this.lths.filter(function(v){return v.archived;}).length;\r\n              return len===0? 0 : (len===this.lths.length)? 1 : 8;\r\n            },\r\n//        },\r\n          get keys(){return this.lths.map(function(v){return v.key;});},\r\n          reorder_all(clg){\r\n            var keys = this.keys;\r\n            if (keys.length<2) return;\r\n            var idxs = clg.idx_insert_bulk(keys, clg, true, true);\r\n//            if (pref.test_mode['168'] || pref.test_mode['169']) { // working code, dropped by releasing test_mode168,169\r\n//              var idxs = [keys[0]];\r\n//              var clg_emu = {idxs:idxs, __proto__:clg};\r\n//              for (var i=1;i<keys.length;i++) clg.idx_insert(keys[i], clg_emu);\r\n//            }\r\n//            if (!pref.test_mode['168']) {\r\n//              var idxs_bulk = clg.idx_insert_bulk(keys, pref.test_mode['169']? {idxs_single:idxs, loose_check:true, __proto__:clg} : clg, true, true); // clg.idxs will be ovrwritten\r\n//              if (!pref.test_mode['169']) idxs = idxs_bulk;\r\n//            }\r\n            for (var i=0;i<idxs.length;i++) if (idxs[i]!=keys[i]) {\r\n              var idx_old = keys.indexOf(idxs[i]);\r\n              keys.splice(i,0,keys.splice(idx_old,1)[0]);\r\n              this.lths.splice(i, 0, this.lths.splice(idx_old,1)[0]);\r\n              this.tgt_ths.splice(i, 0, this.tgt_ths.splice(idx_old,1)[0]);\r\n              var tgt_th = this.tgt_ths[i];\r\n              var domain_html = tgt_th[16].domain_html;\r\n              if (clg.view==='headline') site2[domain_html].headline_reorder(tgt_th[3], this, clg, i);\r\n              else if (clg.view==='catalog') site2[domain_html].catalog_reorder(tgt_th[3], this, clg, i);\r\n            }\r\n            this.re_style(clg);\r\n          },\r\n//          reorder(key, clg){\r\n//            var keys = this.keys;\r\n//            if (keys.length<2) return;\r\n//            var idx_old = keys.indexOf(key);\r\n//            keys.splice(idx_old,1);\r\n//            var idx_new = clg.idx_insert(key, {idxs:keys, __proto__:clg});\r\n//            if (idx_old===idx_new) return;\r\n//            this.lths.splice(idx_new, 0, this.lths.splice(idx_old,1)[0]);\r\n//            this.tgt_ths.splice(idx_new, 0, this.tgt_ths.splice(idx_old,1)[0]);\r\n//            var tgt_th = this.tgt_ths[idx_new];\r\n//            var domain_html = tgt_th[16].domain_html;\r\n//            if (clg.view==='headline') site2[domain_html].headline_reorder(tgt_th[3], this, clg, idx_new);\r\n//          },\r\n          re_style: function(clg){\r\n            var attr_obj = clg.pref.filter.attr_list_obj2;\r\n            var lths = this.lths;\r\n            var force = this.reorder_req&0x02;\r\n            if (force) clg.view_attr_set(lths[0].key, true);\r\n            var i=0;\r\n            while (i<lths.length) if (attr_obj[lths[i].key] && attr_obj[lths[i].key].style) { // SLOW!!!\r\n              if (!force) clg.view_attr_set(lths[0].key, true);\r\n              if (i!==0) clg.view_attr_set(lths[i].key, true);\r\n              break;\r\n            } else i++;\r\n            this.reorder_req = 0;\r\n          },\r\n        };\r\n        return function(key, tgt_th, th, isShown, clg){\r\n          var merge = {\r\n            pn: tgt_th[0], // site2[th.domain].page_json2html3({domain:th.domain, board:th.board, no:0}, '/ALL_MERGED/', null, true),\r\n            isShown: 0, // increased in merge_th_catalog // (isShown)? 1 : 0, // num of participants\r\n//            key:key,\r\n            top_key:key,\r\n            tgt_ths:[],\r\n            lths:[],\r\n            footer: null,\r\n            reorder_req: 0,\r\n            __proto__:base_proto\r\n          };\r\n          if (clg.view==='catalog') {\r\n            merge.cns = null;\r\n          } else if (clg.view==='page' || clg.view==='thread') {\r\n            var posts = tgt_th[16].posts || th.posts;\r\n            clg.merge_bases.class_add_all(posts, base_proto.get_class(key));\r\n            merge.posts = posts.slice(),\r\n            merge.lazy = (pref[clg.view].lazyDraw.merge)? posts.map(function(){return false;}) : null;\r\n            merge.lazy_idx = (pref[clg.view].lazyDraw.merge)? posts.length : null;\r\n          }\r\n          return merge;\r\n        }\r\n      })(),\r\n      class_add_all: function(posts, merge_class){\r\n        if (!merge_class) return;\r\n        for (var i=0;i<posts.length;i++) if (posts[i].pn && posts[i].pn.parentNode) posts[i].pn.parentNode.classList.add(merge_class);\r\n      },\r\n      class_remove_all: function(posts, merge_class){\r\n        if (!merge_class) return;\r\n        for (var i=0;i<posts.length;i++) if (posts[i].pn && posts[i].pn.parentNode) posts[i].pn.parentNode.classList.remove(merge_class);\r\n      },\r\n      remove_th: function(key, tgt_th, clg){\r\n        var merge = this.bases[key];\r\n        if (merge) {\r\n          var domain_html = tgt_th[16].domain_html;\r\n          tgt_th[0] = (clg.view==='catalog')? site2[domain_html].catalog_separate(merge, tgt_th[3], tgt_th[16], clg, merge.isShown>1 && merge.keys[0]===key) // this.remove_th_catalog({cns:tgt_th[3], __proto__:tgt_th[16]}, merge);\r\n                    : (clg.view==='headline')? site2[domain_html].headline_separate(merge, tgt_th[3])\r\n                    : this.remove_th_page(tgt_th[16], false, merge, clg); // merge.isShown==1 doesn't mean 'remove'\r\n          if (merge.isShown===2) {\r\n            merge.footer[0].parentNode.removeChild(merge.footer[0]);\r\n            merge.footer = null;\r\n          }\r\n//          if (pref.test_mode['140']) {\r\n          clg.remake_html_prep(tgt_th, clg.view!=='headline' && (pref.test_mode['191'] || clg.view!=='catalog') && key); // overwrite tgt_th[0] to false\r\n//          clg.remake_html_prep(tgt_th, clg.view==='page' || clg.view==='thread'); // overwrite tgt_th[0] to false\r\n////            tgt_th[0] = false;\r\n////            tgt_th[16].th = {pn:null, __proto__:tgt_th[16].lth.th};\r\n////            tgt_th[16].posts = null;\r\n//          } else {\r\n//            if (tgt_th[16].icon_sticky) delete tgt_th[16].icon_sticky;\r\n//            if (tgt_th[16].icon_show_always) delete tgt_th[16].icon_show_always;\r\n//            gGEH.pns_all_keys.set(tgt_th[0], key);\r\n//            clg.view_attr_set(key, null, true); // calls idx_reorder and changes order of clg.idxs here\r\n//          }\r\n          tgt_th[3] = null; // for catalog and headline\r\n//          if (merge.isShown>=2) tgt_th[22] = null;\r\n          var idx = merge.lths.indexOf(liveTag.mems.getFromName(key));\r\n          merge.tgt_ths.splice(idx,1);\r\n          merge.lths.splice(idx,1);\r\n          clg.footer.draw_merge(tgt_th,key,null); // update both footers.\r\n          if (--merge.isShown===1) gGEH.pns_all_keys.set(merge.pn, merge.lths[0].key);\r\n          else if (merge.isShown!==0) merge.reorder_req |= (idx===0)? 0x03 : 0x01;\r\n//          else if (merge.isShown!==0 && idx===0) {\r\n//            clg.view_attr_set(key, true, true, merge.pn, true);\r\n//            clg.view_attr_set(merge.lths[0].key, null, true, merge.pn); // calls idx_reorder and changes order of clg.idxs here\r\n//          }\r\n////          if (--merge.isShown!==0 && merge.key===key) {\r\n////            merge.key = merge.lths[0].key;\r\n////            gGEH.pns_all_keys.set(merge.pn, merge.key);\r\n////            clg.view_attr_set(merge.key, null, true); // calls idx_reorder and changes order of clg.idxs here\r\n////          }\r\n          if (merge.top_key===key) merge.top_key = null; // thread is overrated\r\n          delete this.bases[key];\r\n        }\r\n      },\r\n      merge_th: function(tgt_th, th, merge, key, clg){\r\n        var domain_html = tgt_th[16].domain_html;\r\n        if (clg.view==='catalog') tgt_th[3] = site2[domain_html].catalog_merge(tgt_th[0], merge, clg, key); // this.merge_th_catalog({pn:tgt_th[0], __proto__:tgt_th[16]}, merge, clg);\r\n        else if (clg.view==='headline') tgt_th[3] = site2[domain_html].headline_merge(tgt_th[0], merge, clg);\r\n        else {\r\n          if (merge.isShown===1) merge.footer = [merge.pn.insertBefore(cnst.dom('<div style=\"clear:both\"></div>'), merge.pn.firstChild)];\r\n          if (merge.isShown!==0) this.merge_th_page({pn:tgt_th[0], posts:tgt_th[16].posts || th.posts, __proto__:tgt_th[16]}, merge, clg);\r\n        }\r\n        merge.tgt_ths[merge.tgt_ths.length] = tgt_th;\r\n        merge.lths[merge.lths.length] = liveTag.mems.getFromName(key); // th.lth can't be used here, because th is null when this is called from func_search_ref_idx\r\n        clg.footer.draw_merge(tgt_th,key,merge);\r\n        merge.isShown++; // this.bases[th.key].isShown++;\r\n//        if (merge.isShown>=2) tgt_th[22] = clg.threads[merge.lths[0].key][22];\r\n//        else if (merge.isShown==1 && !tgt_th[22]) tgt_th[22] = {};\r\n        if (merge.isShown===2) {\r\n          gGEH.pns_all_keys.set(merge.pn,merge);\r\n          gGEH.pns_all_keys.set(merge.footer[0], merge);\r\n        }\r\n//        if (merge.isShown>=2) {\r\n//          if (clg.view==='headline') {\r\n//            var attr_obj = clg.pref.filter.attr_list_obj2;\r\n//            var key0 = merge.lths[0].key;\r\n//            var attr_key = (merge.isShown===2 && attr_obj[key0])? key0 : attr_obj[key]? key : key0;\r\n//            if (attr_key) clg.view_attr_set(attr_key, null, true, merge.pn);\r\n//          }\r\n//        }\r\n        if (pref.test_mode['148'] && merge.isShown>=2) merge.reorder_req |= (merge.isShown===2)? 7 : 5;\r\n        gGEH.pns_all_keys.set(tgt_th[24][0],key);\r\n      },\r\n      remove_th_page: function(th, remove, merge, clg){\r\n//          var dbt = common_func.name2dbt(th.key);\r\n//          if (!cataLog.threads[th.key][16].th) cataLog.threads[th.key][16].th = {domain:dbt[0], board:dbt[1], no:dbt[2], posts:th.posts.slice(), __proto__:cataLog.threads[th.key][16]}; // test patch, but these funcs are NOT reentrant.\r\n//          var posts = (!remove)? th.posts.slice() : null;\r\n//          var k = 0;\r\n//          for (var i=th.posts.length-1;i>=0;i--) k = site2[th.domain_html].update_posts_remove_1(th, i, merge.pn, merge.isShown, merge, k);\r\n        var pnode = (!remove)? site2[th.domain_html].page_json2html3_skelton(th) : null;\r\n        site2[th.domain_html].update_posts_separate(th, merge, pnode, clg);\r\n//          if (--merge.isShown==0) {\r\n//            cataLog.catalog_obj2.func_hide_org(th.key);\r\n//            this.shown.delete(merge);\r\n//            cataLog.catalog_obj2.lazy_tgts.delete(merge);\r\n//          }\r\n//          delete this.bases[th.key];\r\n//          if (!remove) {\r\n//            cataLog.threads[th.key][0] = pnode;\r\n//            gGEH.pns_all_keys.set(pnode,th.key);\r\n//          }\r\n////          if (!remove) {\r\n////            var dbt = common_func.name2dbt(th.key);\r\n////            var pnode = site2[th.domain_html].page_json2html3_skelton({no:dbt[2]});\r\n////            for (var i=0;i<posts.length;i++) site2[th.domain_html].update_posts_insert(posts,th.posts,i,i,pnode,false); // th.posts is NOT updated.\r\n////            th.posts = posts;\r\n////            site2[th.domain_html].page_json2html3_add_omitted_info({posts:th.posts, __proto__:liveTag.mems.getFromName(th.key)},th.posts,th.posts); // th.nof_xxx are required.\r\n//////            site2[th.domain_html].page_json2html3_add_omitted_info(th,th.posts,th.posts); // th.nof_xxx are required.\r\n////            cataLog.threads[th.key][0] = pnode;\r\n////          }\r\n        return pnode;\r\n      },\r\n      merge_th_page: function(th, merge, clg){\r\n        var k=0;\r\n        for (var i=0;i<th.posts.length;i++) {\r\n//          cataLog.format_html.prepare_html_post(th, merge.posts[i]); // NEED TO CHECK CAPABILITY OF REENTRY.\r\n          k = site2[th.domain_html].update_posts_merge_1(th, merge, i, k);\r\n        }\r\n//        merge.isShown++; // this.bases[th.key].isShown++;\r\n        if (merge.lazy && merge.lazy_idx<merge.posts.length) clg.lazy_tgts.set(merge,th.key); // patch for merge_first. slightly redundant.\r\n      },\r\n//      remove_th_catalog: function(th, merge){\r\n//        return site2[th.domain_html].catalog_json2html3_separate(th, merge);\r\n//      },\r\n//      merge_th_catalog: function(th, merge, clg){\r\n//        return site2[th.domain_html].catalog_json2html3_merge(th.pn, merge, clg);\r\n//      },\r\n      base_arr: function(name){\r\n        return pref_func.merge_obj5a_sc(name, pref3.proto.merge_list_obj2, null);\r\n//        if (pref.test_mode['177']) { // cached\r\n//          var cached = pref3.proto.merge_list_obj2c[name] || null;\r\n//          if (ref!==cached) console.log('ERROR: base_arr:'+name+': '+cached+', ref:'+ref);\r\n//        }\r\n//        return ref;\r\n      },\r\n      base_arr_old: function(name){\r\n        return pref_func.merge_obj5a_sc(name, pref3.proto.merge_list_obj2_old || {}, null);\r\n      },\r\n//      base_arr_raw: function(name, old){\r\n//        return pref_func.merge_obj5a_sc(name, old? pref3.proto.merge_list_obj2_old : pref3.proto.merge_list_obj2, null);\r\n//      },\r\n//      base_arr: function(name, old){\r\n//        return pref_func.merge_obj5a_sc(name, old? pref3.proto.merge_list_obj2_old : pref3.proto.merge_list_obj2, null);\r\n//      },\r\n      base_tgts: function(name, pf){\r\n        if (pf.merge) return Object.keys(this.bases)[0] || name;\r\n        if (!pf.merge_list) return null;\r\n        var mems = this.base_arr(name);\r\n        if (!mems) return null;\r\n        for (var i=0;i<mems.length;i++) if (this.base_arr(mems[i])===mems && this.bases[mems[i]]) return mems[i]; // merge to existing merged thread // SCANNING!!! TOO SLOW!!!, but better than stannning whole this.bases\r\n//        for (var key in this.bases) if (this.base_arr(key)===mems) return key; // merge to existing merged thread // SCANNING!!! TOO SLOW!!!\r\n        return name;\r\n      },\r\n      query_merged_keys: function(name){\r\n        var base = this.bases[name];\r\n        return base? base.keys : [name];\r\n      },\r\n//      query_others: function(name){ // called from triage\r\n//        var base = this.bases[name];\r\n//        if (!base) return null;\r\n//        return base.lths.map(function(v){return v.key;}).filter(function(v){return v!==name;});\r\n////        return this.base_arr(name).filter(function(v){return v!==name && this.bases[v]===base;}, this);\r\n//      },\r\n      func_check_reorder: function(name, i){ // this refers catalog_obj2 \r\n        var mb = this.merge_bases;\r\n        var base = mb.bases[name];\r\n        if (!base) return;\r\n        var top = i;\r\n        for (var j=0;j<base.lths.length;j++) {\r\n          var key = base.lths[j].key;\r\n          var idx = (key===name)? i : this.idxs.indexOf(key);\r\n          if (idx<=top) {\r\n            top = idx;\r\n            base.top_key = key;\r\n          }}\r\n//        if (top===i) mb.shown.delete(base); // to bump in func_show\r\n      },\r\n      func_show: function(name,ref, with_hr){ // this refers catalog_obj2\r\n        var mb = this.merge_bases;\r\n        var tgt_th = this.threads[name];\r\n        var base = mb.bases[name]; //  || !tgt_th[1] && mb.query(name, tgt_th, null, false, this); // for merge_tails\r\n//        var base = mb.bases[name]; // working code\r\n//        if (!base && !this.threads[name][1]) { // CAUTION: this may cause conflict with all boards where threads[name][1]===1 always.\r\n//          var tgts = mb.base_tgts(name);\r\n//          if (tgts) {\r\n//            var tgt_th = this.threads[name];\r\n//            base = mb.query(name, tgt_th, null, tgts, false, this);\r\n//          }\r\n//        }\r\n//        var base = (pref[cataLog.embed_mode].merge)? mb.query({pn:tgt_th[0], __proto__:tgt_th[16]}, 'ALL', false) : mb.bases[name];\r\n        if (base) {\r\n//          if (base.isShown!=0) cataLog.catalog_obj2.func_hide_org(name);\r\n//          if (base.isShown==0) base.isShown++;\r\n          if (base.top_key===name) this.func_show_org(name,ref, with_hr); // bump if this thread is the top of merged threads.\r\n//          if (!mb.shown.has(base)) this.func_show_org(name,ref, with_hr); // bump if this thread is the top of merged threads.\r\n          return true;\r\n        } else return this.func_show_org(name,ref, with_hr);\r\n      },\r\n      func_hide: function(name){ // this refers catalog_obj2\r\n        var mb = this.merge_bases;\r\n        var base = mb.bases[name];\r\n        if (base) {\r\n          if (base.isShown===1) {\r\n            this.func_hide_org(name); // prior to mb.remove_th to use tgt_th[0]\r\n            mb.shown.delete(base);\r\n            if (this.view==='page' || this.view==='thread') this.lazy_tgts.delete(base);\r\n          }\r\n          mb.remove_th(name, this.threads[name], this);\r\n          return true;\r\n        } else return this.func_hide_org(name);\r\n      },\r\n      func_search_ref_idx: function(key, idx_now, merge_tail){ // this refers catalog_obj2\r\n        var mb = this.merge_bases;\r\n        var tgt_th = this.threads[key];\r\n        var base_0 = mb.bases[key];\r\n        var base = base_0 || !tgt_th[1] && mb.query(key, tgt_th, null, false, this); // for usual case -> all cases\r\n//        if (pref.test_mode['148'] && base) base.reorder_req = true; // base.reorder(key, this); // causes chattering // moved to insert in idx_xxxx because this invokes reorder always.\r\n        if (!base || base_0 && merge_tail) return idx_now; // merge_tail for short cut, ignores return value // base_0 check is for additional auto merge by pref.*.merge_op_auto\r\n//        var base = mb.bases[key];\r\n        if (pref.test_mode['179']) return mb.shown.get(base) || idx_now;\r\n        var idx = this.idxs.indexOf(base.top_key); // idx===-1 means base.top_key===null\r\n        return (idx===-1 || idx>idx_now)? (base.top_key = key, idx_now) : idx; // bump up, and this can handle bumping down also,\r\n      },\r\n      func_search_ref: function(key){ // this refers catalog_obj2\r\n        var mb = this.merge_bases;\r\n        var base = mb.bases[key];\r\n        return base && base.top_key!==key;\r\n      },\r\n      func_check_overrated: function(key){\r\n        var mb = this.merge_bases;\r\n        var base = mb.bases[key];\r\n//        if (base && base.top_key===null && pref.test_mode['179']) console.log('overrated: '+key); // this line is not hit probably.\r\n        return base && base.top_key===null;\r\n      },\r\n      func_track_shown: function(name, update_drawn_y, idx){ // this refers catalog_obj2\r\n        var mb = this.merge_bases;\r\n        var base = mb.bases[name];\r\n        if (base) {\r\n          var pf_merge = this.pref[this.mode].merge;\r\n          if (!mb.shown.has(base)) {\r\n//          var pn = base.pn;\r\n//          if (!mb.shown.has(pn) || mb.shown.get(pn)===name) { // ===name for reentry.\r\n            var retval = true;\r\n            this.func_track_shown_org(name, !pf_merge && update_drawn_y);\r\n            mb.shown.set(base, idx); // track first idx to remove indexOf in func_search_ref_idx // cant' be used in test_mode['132']\r\n            if (pref.test_mode['179']) base.top_key = name;\r\n//            mb.shown.add(base); // set(base, name); // track first name, but this causes BUG at test_mode['132'] // trial patch 'func_check_reorder was given.\r\n            /*if (mb.shownSet)*/ mb.shownSet.add(mb.base_arr(name));\r\n          }\r\n          if (base.lazy && base.lazy_idx<base.posts.length) this.lazy_tgts.set(base,name);\r\n          if (pf_merge && update_drawn_y && (this.view==='page' || this.view==='thread')) {\r\n            var step = (pref.test_mode['88'])? 1 : pref.proto.lazyDraw.merge_step;\r\n            if (++this.post_count%step==0) this.drawn_y = this.threads[name][16].posts[0].pn.offsetTop;\r\n          }\r\n          return retval;\r\n        } else {\r\n          this.func_track_shown_org(name, update_drawn_y);\r\n          return false;\r\n        }\r\n      },\r\n      shown: new Map(), // base -> idx of first shown member\r\n//      shown: new Set(), // Map(), // base -> name of first shown pair for search_ref\r\n      shownSet: new Set(), // null,\r\n      isShownForTails: function(name){\r\n//        if (!pref.test_mode['149'] && this.bases[name]) return true; // for short cut\r\n////        if (!this.shownSet) {\r\n////          this.shownSet = new Set();\r\n////          for (var base of this.shown.values()) this.shownSet.add(this.base_arr(base.key)); // name));\r\n////        }\r\n        var arr = this.base_arr(name);\r\n        return arr? this.shownSet.has(arr) : false; // for faster execution, .has() consumes 0.3% of execution time.\r\n//        return this.shownSet.has(this.base_arr(name));\r\n      },\r\n      func_track_reset: function(){ // this refers catalog_obj2\r\n        var mb = this.merge_bases;\r\n        mb.shown.clear();\r\n        mb.shownSet.clear(); // = null;\r\n        this.post_count = 0;\r\n        this.lazy_tgts.clear();\r\n        this.func_track_reset_org();\r\n      },\r\n      setup_hook: function(clg){\r\n        clg.func_show_org = clg.func_show;\r\n        clg.func_show     = this.func_show;\r\n        clg.func_hide_org = clg.func_hide;\r\n        clg.func_hide     = this.func_hide;\r\n        clg.func_track_shown_org = clg.func_track_shown;\r\n        clg.func_track_shown     = this.func_track_shown;\r\n        clg.func_track_reset_org = clg.func_track_reset;\r\n        clg.func_track_reset     = this.func_track_reset;\r\n        clg.func_search_ref = this.func_search_ref;\r\n        clg.func_search_ref_idx = this.func_search_ref_idx;\r\n        clg.func_check_overrated = this.func_check_overrated;\r\n        clg.post_count = 0;\r\n        clg.lazy_tgts = new Map();\r\n//        var lazy_tgts = new Map();\r\n//        clg.lazy_tgts = lazy_tgts;\r\n//        this.lazy_tgts = lazy_tgts;\r\n////        cataLog.catalog_obj2.lazy_draw = function(name){ // this refers catalog_obj2\r\n////          var mb = site2['DEFAULT'].update_posts_merge_bases;\r\n////          var merge = mb.bases[name];\r\n////          if (!merge || !merge.lazy || merge.lazy_idx>=merge.posts.length) lazy_tgts.set(merge,name);\r\n////        };\r\n        clg.func_lazy_draw = this.func_lazy_draw;\r\n        clg.func_check_reorder = this.func_check_reorder;\r\n        this.initialized = true;\r\n      },\r\n      func_lazy_draw: function(){ // this refers each clg.\r\n        if (this.view==='page' || this.view==='thread') {\r\n          var ref_height = this.get_ref_height(4);\r\n          for (var merge of this.lazy_tgts.keys()) {\r\n            var i = merge.lazy_idx;\r\n            if (i>=1 && merge.posts[i-1].pn.offsetTop>ref_height) break;\r\n            var j = 0;\r\n            var step = (pref.test_mode['88'])? 1 : pref.proto.lazyDraw.merge_step;\r\n            var th_domain_html = (pref.catalog.mimic_base_site)? site.nickname : this.threads[this.lazy_tgts.get(merge)][16].domain_html;\r\n            while (i<merge.posts.length) {\r\n              if (merge.lazy[i]) {\r\n                if (j<i) j=i+1;\r\n                while (j<merge.lazy.length && merge.lazy[j]) j++;\r\n                site2[th_domain_html].update_posts_insert(merge.posts,merge.posts,i,j,merge.pn);\r\n                merge.lazy[i] = false;\r\n                var merge_class = merge.get_class(merge.posts[i].key_op);\r\n                if (merge_class) merge.posts[i].pn.parentNode.classList.add(merge_class);\r\n              }\r\n              if (!pref.test_mode['111']) if (++this.post_count%step==0 && merge.posts[i].pn.offsetTop>ref_height) break; // slow.\r\n              i++;\r\n            }\r\n            merge.lazy_idx = i;\r\n            if (i>=merge.posts.length) this.lazy_tgts.delete(merge);\r\n          }\r\n        } else if (this.view==='headline' || this.view==='catalog') this.merge_bases.reorder_bases(this);\r\n      },\r\n      release_hook: function(){},\r\n      auto_merge_list: function(name, clg){\r\n//        var tgt_th = clg.threads[name];\r\n        var base = this.bases[name]; //  || this.query(name, tgt_th, null, false, clg); // called after show_catalog(), calling this.query is redundant.\r\n        if (base) {\r\n          var arr = this.base_arr(name);\r\n          if (arr) {\r\n            var tgts = arr.slice().splice(arr.indexOf(name),1);\r\n            scan.scan_ui('mergeAuto', {tgts:tgts, options:{refresh:clg}});\r\n            if (pref[pClg.mode].merge_auto_list_lv_add) pClg.merge_bases.add_to_lv_list(tgts, pref[pClg.mode].merge_auto_list_lv, pClg);\r\n          }\r\n//          for (var key in pref3.proto.merge_list_obj2) if (name!==key && this.base_arr(key)===arr) tgts[tgts.length] = key;\r\n//          scan.scan_ui('mergeAuto', {tgts:tgts, options:{refresh:clg}});\r\n        }\r\n      },\r\n      add_to_list_fromUI: function(key_dst, name, clg){\r\n        scan.scan_ui('mergeUI', {tgts:[name], options:{refresh:clg}});\r\n//        var pn13_doms = pref_func.settings.pn13 && pref_func.settings.pn13.getElementsByTagName('*') || {};\r\n        if (pref.proto.merge_btn_lv_add) this.add_to_lv_list(name, pref.proto.merge_btn_lv, clg);\r\n//        if (pref.proto.merge_btn_lv_add) { // working code\r\n//          var key_lv = new RegExp('(^|,)\\\\s*'+name+'\\\\s*:\\\\s*\\\\d+(,|\\n|$)','mg');\r\n//          var str_lv = pref.proto.merge_lv_str.replace(key_lv,',')+','+name+':'+pref.proto.merge_btn_lv+',\\n';\r\n//          pref.proto.merge_lv_str = str_lv.replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,''); // see 'triage_exe'\r\n//          var dom_lv = pn13_doms['proto.merge_lv_str'];\r\n//          pref_func.apply_prep(dom_lv || cnst.dom('<textarea name=\"proto.merge_lv_str\"></textarea>'), false, true, null, true);\r\n//          if (!dom_lv) clg.onchange_funcs['*w/.merge_lv_str']();\r\n//        }\r\n        if (clg.pref[clg.mode].merge_btn_mode==='all') {\r\n          if (!clg.pref[clg.mode].merge) {\r\n            clg.pref[clg.mode].merge = true;\r\n            pref_func.apply_prep(clg.components.merge, false, true, clg.mode!=='float');\r\n          }\r\n        } else {\r\n          this.add_to_list_1(key_dst, name, clg, null, true);\r\n//        var str = pref.proto.merge_list_str.replace(/\\s*\\+/g,',+'); // working code\r\n//        var dst_arr = this.base_arr(key_dst);\r\n//        var src_arr = this.base_arr(name);\r\n//        if (!dst_arr || !src_arr || dst_arr!==src_arr) {\r\n//          var key = new RegExp('(^|,)\\\\s*\\\\+*\\\\s*'+key_dst+'\\\\s*(,|\\n|$)','mg');\r\n//          var str_addend = ',+'+name+',';\r\n//          var idx = str.search(key);\r\n//          var str_new = (idx!=-1)? str.replace(key,'$&'+str_addend) : str + key_dst + str_addend;\r\n//          pref.proto.merge_list_str = str_new.replace(/,+\\+/g,'+').replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,''); // see 'triage_exe'\r\n//          var dom = pn13_doms['proto.merge_list_str'];\r\n//          pref_func.apply_prep(dom || cnst.dom('<textarea name=\"proto.merge_list_str\"></textarea>'), false, true, null, true);\r\n//          if (!dom) pref_func.settings.onchange_funcs['*.merge_list_str']();\r\n//        }\r\n          if (!pref.proto.merge_list) {\r\n            pref.proto.merge_list = true;\r\n            pref_func.settings.pnOrDummy(pClg.mode+'.merge_list').checked = true;\r\n//          var dom_cb = pn13_doms[pClg.mode+'.merge_list'];\r\n//          if (dom_cb) dom_cb.checked = true;\r\n            clg.onchange_funcs['*w/.merge_list']();\r\n          }\r\n        }\r\n      },\r\n      add_to_lv_list: function(name, lv, clg, rm){\r\nif (pref.test_mode['193']) {\r\n        if (!Array.isArray(name))            pref.proto.merge_lv_str = pref3.proto.merge_lv_obj2._revise(name,    lv, rm, pref.proto.merge_lv_str);\r\n        else for (var i=0;i<name.length;i++) pref.proto.merge_lv_str = pref3.proto.merge_lv_obj2._revise(name[i], lv, rm, pref.proto.merge_lv_str);\r\n        pref_func.settings.pnOrDummy('proto.merge_lv_str').value = pref.proto.merge_lv_str;\r\n} else {\r\n        if (Array.isArray(name)) {\r\n          for (var i=0;i<name.length;i++) this.add_to_lv_list(name[i], lv, i===name.length-1? clg : null, rm);\r\n          return;\r\n        }\r\n        var key = new RegExp('(^|,)\\\\s*'+name+'\\\\s*:\\\\s*\\\\w+\\\\s*(,|\\n|$)','mg');\r\n        var str = pref.proto.merge_lv_str.replace(key,',')+'\\n'+(rm? '' : name+':'+lv+'\\n');\r\n        pref.proto.merge_lv_str = pref_func.fmt4str2(str);\r\n        if (!clg) return;\r\n        pref_func.apply_prep_1n('proto.merge_lv_str', false, null, null, true); // make obj\r\n}\r\n//        var dom = pref_func.settings.pn13 && pref_func.settings.pn13.getElementsByTagName('TEXTAREA')['proto.merge_lv_str'];\r\n//        pref_func.apply_prep(dom || cnst.dom('<textarea name=\"proto.merge_lv_str\"></textarea>'), false, true, null, true);\r\n        if (this.base_arr(name)) clg.onchange_funcs['*w/.merge_lv_str'](null, clg.mode, name);\r\n//        /*if (!dom)*/ clg.onchange_funcs['*w/.merge_lv_str']();\r\n      },\r\n      add_to_list_1: function(dst, name, clg, prep_only, merge){\r\n        var arr = this.base_arr(name);\r\n        if (dst && name && arr && (prep_only || arr===this.base_arr(dst))) return;\r\nif (pref.test_mode['192']) {\r\n        var retval = pref3.proto.merge_list_obj2._revise(dst, name, pref.proto.merge_list_str, merge==='no_insert');\r\n        pref_func.settings.pnOrDummy('proto.merge_list_str').value = pref.proto.merge_list_str = retval.str;\r\n        clg.onchange_funcs['*w/.merge_list_str'](null, clg.mode, common_func.Array_toObj(retval.tgts,null), prep_only, true, merge);\r\n} else {\r\n        if (pref.test_mode['178']) {\r\n          var old_old = pref3.proto.merge_list_obj2_old;\r\n          var now = pref3.proto.merge_list_obj2;\r\n          var old_org = this.debug_copy(old_old||now);\r\n          var str_old = pref.proto.merge_list_str;\r\n        }\r\n        var str = pref.proto.merge_list_str;\r\n//        if (arr && merge==='unmerge_once') str = this.add_to_list_2(null, name, str); // erase once for GUI\r\n        str = this.add_to_list_2(dst, name, str, merge==='no_insert'); // erase, add or insert\r\n        if ((dst===null || this.base_arr(dst) || merge==='no_insert') && arr && arr.length===2) {\r\n          var rest = arr[arr.indexOf(name)? 0 : 1];\r\n          var idx = rest.indexOf('/');\r\n          var idxl = rest.lastIndexOf('/');\r\n          if (idx>0 && idx!==idxl && idxl!==rest.length-1) str = this.add_to_list_2(null, rest, str); // erase // check if fullname\r\n        }\r\n        pref.proto.merge_list_str = str;\r\n        pref_func.apply_prep_1n('proto.merge_list_str', false, null, null, true); // make obj\r\n//        if (pref.test_mode['177']) pref3.proto.merge_list_obj2c_update(name); // name is NOT registered to gClg.AllThreads yet.\r\n//        var dom = pref_func.settings.pn13 && pref_func.settings.pn13.getElementsByTagName('TEXTAREA')['proto.merge_list_str'];\r\n//        pref_func.apply_prep(dom || cnst.dom('<textarea name=\"proto.merge_list_str\"></textarea>'), false, null, null, true); // make obj\r\n        var tgts = common_func.Array_toObj((arr||[]).concat(this.base_arr(name)||[]), null); // arr was made from obj2_old at this time.\r\n        clg.onchange_funcs['*w/.merge_list_str'](null, clg.mode, tgts, prep_only, true, merge);\r\n        if (pref.test_mode['178']) { // changes old directly, can't be before drawing.\r\n          var now_org = pref3.proto.merge_list_obj2;\r\n//          if (arr && merge==='unmerge_once') var old = now._revise(old_old, null, name);\r\n          var retval = now._revise(dst, name, str_old, merge==='no_insert', old || old_old);\r\n          var old = retval.old;\r\n          for (var i in old) if (old[i])      this.debug_error_check(name,dst,i,old,old_org,'old!==old_org');\r\n          for (var i in old_org) if (!old[i]) this.debug_error_check(name,dst,i,old_org,old,'old_org!==old');\r\n          for (var i in now)                  this.debug_error_check(name,dst,i,now,now_org,'now!==now_org', old_org);\r\n          for (var i in now_org) if (!now[i]) this.debug_error_check(name,dst,i,now_org,now,'now_org!==now', old_org);\r\n          for (var db in now[':REV'])     for (var i in now[':REV'][db])     if (now[':REV'][db][i]!==now_org[':REV'][db][i]) console.log('ERROR: now3!==now_org3, '+db+i);\r\n          for (var db in now_org[':REV']) for (var i in now_org[':REV'][db]) if (now_org[':REV'][db][i]!==now[':REV'][db][i]) console.log('ERROR: now_org3!==now3, '+db+i);\r\n          if (retval.str!==pref.proto.merge_list_str) {\r\n            for (var i=0;i<retval.str.length;i++) if (retval[i]!==pref.proto.merge_list_str[i]) break;\r\n            console.log('ERROR: str at '+i+'\\n'+str.slice(i-10,i+100)+'\\n'+pref.proto.merge_list_str.slice(i-10,i+100));\r\n          }\r\n        }\r\n}\r\n      },\r\n      debug_copy: function(src){\r\n        var obj = {};\r\n        for (var i in src) obj[i] = Array.isArray(src[i])? src[i].slice() : src[i];\r\n        return obj;\r\n      },\r\n      debug_error_check: function(name,dst,i,src0,src1,msg, old){\r\n        if (i!==':REV' && i!==':F' && i!=='_revise' && i!=='_rm') if (!src1[i] || src0[i].join()!==src1[i].join()) console.log('ERROR: ',name,dst,msg+': '+i+': '+src0[i].join()+': '+(Array.isArray(src1[i])? src1[i].join() : src1[i])+': '+(old? old[i] : '----'));\r\n      },\r\n      add_to_list_2: function(tgt, name, str, no_insert){\r\n        var dst = tgt && this.existIn(str,tgt);\r\n        var src = this.existIn(str,name);\r\n        if (src && (!tgt || dst || no_insert)) {\r\n          str = src[1]==='+'? str.slice(0,src.index)              +str.slice(src.index+src[0].length) // eliminates '+' preferentially\r\n                            : str.slice(0,src.index+src[1].length)+str.slice(src.index+src[0].length+src[3].length); // remove\r\n          var len_erased = src[0].length + (src[1]==='+'? 0 : -src[1].length+src[3].length);\r\n        }\r\n        if (tgt) { // if (dst || tgt===null) {\r\n//          if (src) {\r\n//            str = src[1].length>0? str.slice(0,src.index)+str.slice(src.index+src[0].length)\r\n//                                 : str.slice(0,src.index)+str.slice(src.index+src[0].length+src[3].length); // remove\r\n//            var len_erased = src[1].length>0? src[0].length : src[0].length+src[3].length;\r\n//          }\r\n          if (dst) { // if (tgt!==null) {\r\n            var idx = (src && dst.index>src.index? dst.index - len_erased : dst.index) + dst[0].length;\r\n            str = str.slice(0,idx)+'+'+name+str.slice(idx); // add\r\n          } else if (src && !no_insert) str = str.slice(0,src.index+src[1].length)+tgt+'+'+str.slice(src.index+src[1].length); // insert\r\n          else str += '\\n'+tgt+'+'+name+'\\n' // add to last\r\n        }\r\n        return pref_func.fmt4str2(str);\r\n      },\r\n      existIn: function(str, key_in){\r\n        var key = key_in.replace(/\\+/,'\\\\+');\r\n        return new RegExp('(^|,|\\\\+)\\\\s*'+key+'(\\s*)(?=(,|\\n|$|\\\\+))','mg').exec(str);\r\n//        return new RegExp('(^|,|\\\\+)\\\\s*'+key+'([^,\\n+]*)(?=(,|\\n|$|\\\\+))','mg').exec(str); // (?<=) requires chrome 62 // BUG, key isn't terminated\r\n      },\r\n//      add_to_list_2: function(dst, name, clg, insert){\r\n//        var str = pref.proto.merge_list_str;\r\n//        var key = dst.replace(/\\+/,'\\\\+')+'([\\\\^@;][^,\\n]*)*'; // see 'rm_items_404_delete_merge' and 'triage_exe'\r\n//        if (!name) str = str.replace(new RegExp('(^|,)'+key+'([,\\n]+\\\\s*\\\\+*|$|\\\\+)','mg'),'$1').replace(new RegExp('\\\\+\\\\s*'+key+'(,|\\n|$|\\\\s*\\\\+)','mg'),'$2');\r\n//        else {\r\n//          var res = new RegExp('(^|,|\\\\+|\\\\s)'+key+'(?=(,|\\n|$|\\\\+))','mg').exec(str); // (?<=) requires chrome 62\r\n//          str = (!res)? str + '\\n'+dst+'+'+name+'\\n'\r\n//            : (insert)? str.slice(0,res.index+res[1].length)+name+'+'+str.slice(res.index+res[1].length)\r\n//            : str.slice(0,res.index+res[0].length)+'+'+name+str.slice(res.index+res[0].length); // str.replace(rx,'$&'+'+'+name);\r\n//        }\r\n//        pref.proto.merge_list_str = str.replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,'');\r\n//      },\r\n      hide_merge_tgts: function(clg, check_func, srcs, merge){\r\n        var tgts = pref.test_mode['192'] && srcs || {};\r\n        if (!srcs || !pref.test_mode['192']) {\r\n          if (!srcs) srcs = clg.threads;\r\n          for (var name in srcs) {\r\n            var tgt_th = clg.threads[name];\r\n            if (tgt_th && (tgt_th[1]||merge) && check_func.call(this,name)) tgts[name] = tgt_th; // '||merge' for merging with not shown threads by MERGEN/MERGEC triage\r\n//            if (clg.func_hide(name)) tgt_th[1] = false; // BUG. can't give catalog_expand_with_hr, see show_catalog\r\n          }\r\n        }\r\n        clg.func_hide_all(tgts);\r\n//        pref3.proto.merge_list_obj2_old = null;\r\n        clg.func_track_reset();\r\n        if (!this.initialized) this.setup_hook(clg);\r\n        return tgts; // Object.keys(tgts).length;\r\n      },\r\n      onchange_funcs: common_func.Object_defProps(pref_func.settings.onchange_funcs, { // dummy prop; this property itself is not used.\r\n        '*w/.merge_list_str': function(e,name, tgts, prep_only, no_dirtify, merge){\r\n//          var clg = this['.'];\r\n/*          if (!clg)*/ gClg.BroadcastEventByMode(name.split('.')[0], this['*w/.merge_list_str_1'], arguments); // broadcast always\r\n//          else this['*w/.merge_list_str_1'](e, name, prep_only);\r\n          pref3.proto.merge_list_obj2_old = null;\r\n        },\r\n        '*w/.merge_list_str_1': function(e,name, tgts, prep_only, no_dirtify, merge){\r\n          var clg = this['.'];\r\n          if (!clg.pref[clg.mode].merge_list) return;\r\n          var tgts_draw = clg.merge_bases.hide_merge_tgts(clg, function(name){\r\n            var now = this.base_arr(name);\r\n            var old = this.base_arr_old(name);\r\n            return (now)? (!old || now.join()!==old.join() && (!merge || this.bases[this.base_tgts(name, clg.pref[clg.mode])]!==this.bases[name])) : old;}, tgts, merge); // now.join()!==old.join() may be redundant. // !merge check for rewinding overrated merged threads when its top thread is unmerged. // this.bases will be updated after show_catalog, but this.base_tgts was updated because it is calculated from this.base_arr.\r\n//            return (now)? (!old || now.join()!==old.join()) : old;});\r\n          if (!no_dirtify) clg.dirty |= 0x10;\r\n          if (!prep_only && Object.keys(tgts_draw).length) clg.show_catalog_buf(tgts_draw);\r\n        },\r\n        '*w/.merge_list': function(e, name){\r\n          var clg = this['.'];\r\n          if (!clg) {gClg.BroadcastEventByMode(name.split('.')[0], this['*w/.merge_list'], arguments); return;}\r\n          clg.merge_bases.hide_merge_tgts(clg, function(name){return this.base_arr(name) || this.base_arr_old(name);});\r\n          clg.dirty |= 0x10;\r\n          clg.show_catalog(0);\r\n        },\r\n        '*w/.merge': function(e, name){\r\n          var clg = this['.'];\r\n          if (!clg) {gClg.BroadcastEventByMode(name.split('.')[0], this['*w/.merge'], arguments); return;}\r\n          clg.merge_bases.hide_merge_tgts(clg, function(){return true;});\r\n          clg.dirty |= 0x10;\r\n          if (clg.pref[clg.mode].merge) clg.order.ordering_old = clg.order.ordering;\r\n          clg.components.ordering.onfocus();\r\n          clg.order.ordering = (clg.pref[clg.mode].merge)? clg.idx_idxMergeAll : clg.order.ordering_old || 0; // default value for all merge valid at initial\r\n          pref_func.apply_prep(clg.components.ordering,false,true); // call show_catalog();\r\n          clg.components.ordering.onblur();\r\n          clg.components.ordering.disabled = clg.pref[clg.mode].merge;\r\n        },\r\n        '*w/.merge_lv_str': function(e, name, tgt){\r\n//          var clg = this['.'];\r\n/*          if (!clg)*/ gClg.BroadcastEventByMode(name.split('.')[0], this['*w/.merge_lv_1'], [e, name, true, tgt]); // broadcast always\r\n//          if (pref[clg.view].merge_lv) this['*w/.merge_lv_1'](e,name, true, tgt); // changed from clg.pref[clg.mode].merge_lv\r\n          pref3.proto.merge_lv_obj2_old = null; // this must be after broadcasting.\r\n        },\r\n        '*w/.merge_lv': function(e, name){\r\n          var clg = this['.'];\r\n          if (!clg) gClg.BroadcastEventByMode(name.split('.')[0], this['*w/.merge_lv_1'], arguments);\r\n          else this['*w/.merge_lv_1'](e, name);\r\n        },\r\n        '*w/.merge_lv_1': function(e, name, from_str, tgt){\r\n          var clg = this['.'];\r\n          if (!clg.pref[clg.mode].merge && !clg.pref[clg.mode].merge_list) return;\r\n          var mb = clg.merge_bases;\r\n          var tgts = !tgt? clg.threads : !clg.threads[tgt]? {} : common_func.Array_toObj([tgt], null); // {[tgt]:null}\r\n          for (var name in tgts) {\r\n            if (!clg.threads[name][1]) continue;\r\n            var base = mb.bases[name];\r\n            if (!base) continue;\r\n            var now = base.get_class(name);\r\n            var old = from_str? base.get_class(name,true,true) : null;\r\n            if (!from_str || now!=old) {\r\n              var posts = (clg.view==='page' || clg.view==='thread')? clg.threads[name][16].posts : [{pn:base.pn}];\r\n              if (from_str || !clg.pref[clg.mode].merge_lv) mb.class_remove_all(posts, from_str? old : now);\r\n              if (from_str ||  clg.pref[clg.mode].merge_lv) mb.class_add_all(posts,now);\r\n            }\r\n          }\r\n//          pref3.proto.merge_lv_obj2_old = null; // this must be moved to after broadcasting.\r\n        },\r\n      }),\r\n//      onchange_merge: function(e){ // working code\r\n//        var mb = site2['DEFAULT'].update_posts_merge_bases;\r\n//        var et_name1 = (e.target.name || e.target.getAttribute('name')).split('.')[1];\r\n//        if (et_name1==='merge_list_str' && !pref[cataLog.embed_mode].merge_list) return;\r\n//        var check_tgts = (et_name1==='merge')? function(){return true;}\r\n//        : (et_name1==='merge_list')? function(name){return mb.base_arr(name) || mb.base_arr(name,true);}\r\n//                       : function(name){\r\n//                           var now = mb.base_arr(name);\r\n//                           var old = mb.base_arr(name,true);\r\n//                           return (now)? (!old || now.join()!==old.join()) : old;};\r\n//        for (var name in cataLog.threads) {\r\n//          var tgt_th = cataLog.threads[name];\r\n//          if (tgt_th[1] && check_tgts(name))\r\n//            if (cataLog.catalog_obj2.func_hide(name)) tgt_th[1] = false;\r\n//        }\r\n//        pref3.proto.merge_list_obj2_old = null;\r\n//        cataLog.catalog_obj2.func_track_reset();\r\n//        if (!mb.initialized) mb.setup_hook();\r\n//        if (et_name1==='merge') {\r\n//          if (pref[cataLog.embed_mode].merge) pref3.catalog.order.ordering_old = pref.catalog.order.ordering;\r\n//          cataLog.components.ordering.onfocus();\r\n//          pref.catalog.order.ordering = (pref[cataLog.embed_mode].merge)? 7 : pref3.catalog.order.ordering_old; // 7:/creation\r\n//          pref_func.apply_prep(cataLog.components.ordering,false,true); // call show_catalog();\r\n//          cataLog.components.ordering.onblur();\r\n//          cataLog.components.ordering.disabled = pref[cataLog.embed_mode].merge;\r\n//        } else cataLog.show_catalog();\r\n//      },\r\n//      onchange_lv: function(e){\r\n//        if (!pref[cataLog.embed_mode].merge && !pref[cataLog.embed_mode].merge_list) return;\r\n//        var et_name = (e.target.name || e.target.getAttribute('name')).split('.')[1];\r\n//        if (et_name==='merge_lv_str' && !pref[cataLog.embed_mode].merge_lv) return;\r\n//        var mb = site2['DEFAULT'].update_posts_merge_bases;\r\n//        for (var name in cataLog.threads) {\r\n//          if (!cataLog.threads[name][1]) continue;\r\n//          var base = mb.bases[name];\r\n//          if (!base) continue;\r\n//          var now = base.get_class(name);\r\n//          var old = base.get_class(name,true,true);\r\n//          if (et_name==='merge_lv' || now!=old) {\r\n//            var posts = cataLog.threads[name][16].posts;\r\n//            if (et_name!=='merge_lv' || !pref[cataLog.embed_mode].merge_lv) mb.class_remove_all(posts,old);\r\n//            if (et_name!=='merge_lv' ||  pref[cataLog.embed_mode].merge_lv) mb.class_add_all(posts,now);\r\n//          }\r\n//        }\r\n//        pref3.proto.merge_lv_obj2_old = null;\r\n//      },\r\n    },\r\n////////    update_posts_merge_base: null,\r\n    update_posts_replace_prep: function(posts,posts_old,num) { // use newer posts as much as possible // concate posts by no. existence of posts_old was checked in caller.\r\n      if (!posts || posts.length<=1) return (num<0 || posts_old.length<=num+1)? posts_old : (num==0)? posts_old.slice(0,1) : posts_old.slice(0,1).concat(posts_old.slice(-num));\r\n      num = (num>=0)? num+1 : posts_old.length + posts.length -1;\r\n      if (num==posts.length) return posts;\r\n      if (num< posts.length) return posts.slice(0,1).concat(posts.slice(posts.length - num + 1)); // cut\r\n      var first_no = posts[1].no;\r\n      var i=1;\r\n      while (i<posts_old.length && posts_old[i].no<first_no) i++;\r\n      if (i===1) return posts;\r\n      var start = (i>num-posts.length)? i-(num-posts.length) : 1;\r\n      return posts.slice(0,1).concat(posts_old.slice(start,i),posts.slice(1));\r\n    },\r\n    update_posts0_class: function(pn,search_result) {\r\n      if (search_result) pn.classList.remove('CatChan_search_miss');\r\n      else               pn.classList.add('CatChan_search_miss');\r\n    },\r\n    update_posts_replace: function(th,th_old,pnode,merge,show, posts_used, clg, deactivate) {\r\n      if (merge) {\r\n        pnode = merge.pn;\r\n        show  = merge.isShown;\r\n      }\r\n      if (th_old.posts) {\r\nif (!pref.test_mode['140']) {\r\n        site2[th.domain].page_json2html3_add_omitted_info(th,th_old, pref[clg.view].use_expander_always);\r\n} else {\r\n        var info_old = th_old.parse_funcs_html.get_omitted_info(th_old.posts[0]); // (th_old.posts[0].pn)? : null; // for lazy_draw in merge, but this is patched in 'update_posts_merge_1'.\r\n        var info_new = (th.posts[0].pn && (pref.test_mode['139'] || th.posts[0]!==th_old.posts[0]))? th.parse_funcs_html.get_omitted_info(th.posts[0]) : site2[th.domain_html].page_json2html3_add_omitted_info(th,null,th.posts);\r\n        if (info_old) {\r\n//          if (info_new) th_old.parse_funcs_html.replace_omitted_info(info_old, info_new);\r\n//          else info_old.parentNode.removeChild(info_old);\r\n          th_old.parse_funcs_html.replace_omitted_info2(info_old, info_new, th); // REDUNDANT when check new replies at initial in page view.\r\n        } else if (info_new) th_old.parse_funcs_html.set_omitted_info(th_old.posts[0], info_new);\r\n}\r\n////        var nos = {}; // working code.\r\n////        for (var i=1;i<th.posts.length;i++) nos[th.posts[i].no] = null;\r\n////        for (var i=th_old.posts.length-1;i>=1;i--) \r\n////          if (nos[th_old.posts[i].no]===undefined) {\r\n////            this.update_posts_remove(th_old,i,pnode);\r\n////            th_old.posts.splice(i,1);\r\n////          }\r\n        var k = -1;\r\n        var j = th.posts.length-1;\r\n//        var scroll_back = 0;\r\n//        var now_height = (scroll_lock)? brwsr.document_body.scrollTop : 0; // WILL BE CHANGED TO get_now_height for multi inscance\r\n        var editings = null;\r\n        for (var i=th_old.posts.length-1;i>=1;i--) {\r\n          while (j>1 && th.posts[j].no>th_old.posts[i].no) j--;\r\n          var editing = th_old.posts[i].editing && th_old.posts[i].pn && th_old.posts[i]!==th.posts[j]; // meguca returns old data sometime since they uses cache.\r\n          // Meguca uses caches of 30 seconds, so it returns old data sometime, and last posts aren't contained in old data sometimes.\r\n          // CatChan takes this as a situation of \"the posts was removed\", so deleted_posts are fluctuate,\r\n          // and th.posts may contain shallow copies of th_old.posts because deleted_posts are merged with live posts.\r\n          // So, \"insert-remove\" method causes an error when the post is a shallow copy of an old post beacuse th.posts[j].pn.parentNode will be null.\r\n          if (th.posts[j].no!=th_old.posts[i].no || editing) k = this.update_posts_remove_1(th_old, i, pnode, show, merge, k, clg);\r\n          if (editing) if (editings) editings[editings.length] = th.posts[j]; else editings = [th.posts[j]];\r\n//          else if (th_old.posts[i].editing && (th_old.posts[i].pn) && th_old.posts[i]!==th.posts[j]) { // meguca returns old data sometime since they uses cache.\r\n////          } else if (th_old.posts[i].editing && (!merge || show) && (th_old.posts[i].pn)) {\r\n//            var thq = liveTag.mems[th.domain][th.board][th.no].q;\r\n//            cataLog.format_html.prepare_html_post(th, th.posts[j]);\r\n//            this.popups_add_1(th, th.posts[j], false, thq, j===0, true);\r\n//            if (pref[cataLog.embed_mode].backlink) if (thq[th.posts[j].no].backlinks) site2[th.domain_html].add_backlinks(th.posts[j].pn,thq[th.posts[j].no].backlinks, undefined, th);\r\n//            th_old.posts[i].pn.parentNode.insertBefore(th.posts[j].pn,th_old.posts[i].pn);\r\n//            th_old.posts[i].pn.parentNode.removeChild(th_old.posts[i].pn);\r\n//            th_old.posts[i] = th.posts[j];\r\n//            posts_used[posts_used.length] = th.posts[j];\r\n//          }\r\n        }\r\n//        if (scroll_back) window.scrollTo(0,now_height + scroll_back);\r\n      }\r\n      this.update_posts_add(th,th_old,pnode,merge,show, posts_used, editings, deactivate);\r\n    },\r\n    update_posts_add: function(th,th_old,pnode,merge,show, posts_used, editings, deactivate) {\r\n      if (th_old.posts && th.posts) {\r\n        var thq = liveTag.mems[th.domain][th.board][th.no].q;\r\n        var time_unit = (merge)? th.parse_funcs.time_unit : 1; // (merge)? for safety.\r\n//        var first_no = th_old.posts[1].no; // working, but not verified enough.\r\n//        if (th.posts[1].no<first_no) {\r\n//          var end=1;\r\n//          while (end+1<th.posts.length && th.posts[end+1].no<first_no) end++;\r\n//          var i=end;\r\n//          while (i>=1) {\r\n//            this.update_posts_1(th,th_old,pnode,merge, i, 1, time_unit, thq); // inset before\r\n//            th_old.posts.splice(1,0,th.posts[i--]);\r\n//          }\r\n//          if (merge && show) this.update_posts_insert_merge(th.posts.splice(0,end+1),1);\r\n//        }\r\n//        var th_old_posts_length = th_old.posts.length;\r\n//        for (var i=th_old_posts_length;i<th.posts.length;i++) {\r\n//          this.update_posts_1(th,th_old,pnode,merge, i, th_old.posts.length, time_unit, thq); // th_old.posts.length is live count, always add to end. // add after\r\n//          th_old.posts[th_old.posts.length] = th.posts[i];\r\n//        }\r\n//        if (th.posts.length>1 && merge && show) this.update_posts_insert_merge(th.posts,th_old_posts_length);\r\n\r\n        var k = -1;\r\n        var j=(merge)? 0 : 1; // for filter output, random insert.\r\n        for (var i=(merge)? 0 : 1;i<th.posts.length;i++) {\r\n          while (j<th_old.posts.length && th.posts[i].no>th_old.posts[j].no) j++;\r\n          if (j>=th_old.posts.length || th.posts[i].no!=th_old.posts[j].no) {\r\n            var editing = editings && editings.indexOf(th.posts[i])!=-1;\r\n            var thq = editing? liveTag.mems[th.domain][th.board][th.no].q : null; // must be here?\r\n            cataLog.format_html.prepare_html_post(th, th.posts[i], null, null, null, deactivate, true);\r\n            if (editing) {\r\n//              this.popups_add_1(th, th.posts[i], false, thq, true);\r\n              if (pref[cataLog.embed_mode].backlink) if (thq[th.posts[i].no].backlinks) site2[th.domain_html].add_backlinks(th.posts[i].pn,thq[th.posts[i].no].backlinks, undefined, th);\r\n            }\r\n            if (!merge) this.update_posts_insert(th.posts,th_old.posts,i,j,pnode); // th_old.posts.length is live count, always add to end.\r\n            else k = this.update_posts_merge_1(th, merge, i, k);\r\n//            this.update_posts_1(th,th_old,pnode,merge, i, j, time_unit, thq); // th_old.posts.length is live count.\r\n            if (j<th_old.posts.length) th_old.posts.splice(j,0,th.posts[i]); // live array\r\n            else th_old.posts[th_old.posts.length] = th.posts[i];\r\n            posts_used[posts_used.length] = th.posts[i];\r\n          }\r\n          if (j<th_old.posts.length) j++;\r\n        }\r\n//        if (th.posts.length>1 && merge && show) this.update_posts_insert_merge(th.posts,0, th_old.posts[0].pn);\r\n      }\r\n    },\r\n    update_posts_remove_1: function(th_old, i, pnode, isShown, merge, k, clg){\r\n      var post = th_old.posts[i];\r\n      if (isShown) if (pref[cataLog.embed_mode].scroll_lock) clg.show_catalog_scroll_lock.modified(post);\r\n      if (!merge) {\r\n        if (post.pn) this.update_posts_remove(th_old,i,pnode); // MAY CAUSE A BUG. post.pn may not have the same lifetime as th.pn\r\n      } else {\r\n        k = (k==-1)? merge.posts.indexOf(post) // for faster search\r\n                   : merge.posts.lastIndexOf(post, k);\r\n        if (k==-1) k = merge.posts.lastIndexOf(post); // 4chan sometimes returns out-of-order posts.\r\n        if (k>=0) if (merge.remove(k)) this.update_posts_remove(th_old,i,pnode);\r\n      }\r\n//      scroll_back += this.update_posts_remove(th_old,i,pnode,now_height); // SLOW.\r\n      th_old.posts.splice(i,1);\r\n      return k;\r\n    },\r\n    update_posts_merge_1: function(th, merge, i, k){\r\n      var ref_time = th.posts[i].time_tu;\r\n      if (k==-1) k = merge.posts.length-1;\r\n      while (k>0 && merge.posts[k].time_tu>=ref_time) k--; // for faster search // 4chan sometimes returns out-of-order posts.\r\n      while (k<merge.posts.length && (merge.posts[k].time_tu <ref_time || \r\n                                      merge.posts[k].time_tu==ref_time && merge.posts[k].no<=th.posts[i].no)) k++;\r\n      if (merge.lazy) merge.lazy_draw(k);\r\n      if (!merge.lazy || (!pref.test_mode['89'] && i==0)) {\r\n        this.update_posts_insert(th.posts,merge.posts,i,merge.lazy? merge.draw_1_pos(k)-1:k, merge.pn); // th_old.posts.length is live count, always add to end if !merge.lazy.\r\n        var merge_class = merge.get_class(th.key);\r\n        if (merge_class) th.posts[i].pn.parentNode.classList.add(merge_class);\r\n      }\r\n//      if (i==0) th.posts[0].isOP = true;\r\n//      if (merge.lazy) merge.lazy_draw(k);\r\n//      else this.update_posts_insert(th.posts,merge.posts,i,k,merge.pn); // th_old.posts.length is live count, always add to end.\r\n//      if (!pref.test_mode['89'] && merge.lazy && i==0) // required, sometimes OP has omitted_info outside of the OP. \r\n//        if (pref[cataLog.embed_mode].merge) this.update_posts_insert(th.posts,merge.posts,i,merge.draw_1_pos(k)-1,merge.pn);\r\n////        if (pref.test_mode['89']) this.update_posts_insert(th.posts,merge.posts,i,merge.draw_1_pos(k)-1,merge.pn,merge); // i!=0 for ommited info, which doesn't expect lazy drawing. -1 of dst[j] is because dst isn't updated yet.\r\n//        else th.posts[0].isOP = true;\r\n      if (k<merge.posts.length) merge.posts.splice(k,0,th.posts[i]); // live array\r\n      else merge.posts[merge.posts.length] = th.posts[i];\r\n      return k;\r\n    },\r\n    update_posts_separate: function(th, merge, pn_sep, clg){\r\n      var merge_class = merge.get_class(th.key, true);\r\n      var k=0;\r\n      for (var i=0;i<th.posts.length;i++) {\r\n        var post = th.posts[i];\r\n        k = merge.posts.indexOf(post, k);\r\n        if (k==-1) k = merge.posts.indexOf(post); // 4chan sometimes returns out-of-order posts.\r\n        var exist = (k!=-1)? merge.remove(k) : false;\r\n        if (merge.isShown) if (pref[cataLog.embed_mode].scroll_lock) clg.show_catalog_scroll_lock.modified(post);\r\n        if (merge_class && post.pn.parentNode) post.pn.parentNode.classList.remove(merge_class);\r\n        if (pn_sep) this.update_posts_insert(th.posts,[],i,i,pn_sep);\r\n        else if (exist) this.update_posts_remove(th,i,merge.pn);\r\n      }\r\n    },\r\n//    update_posts_1: function(th,th_old,pnode,merge, tgt, pos, time_unit, thq) { // working code.\r\n//      if (!merge) this.update_posts_insert(th.posts,th_old.posts,tgt,pos,pnode,merge); // th_old.posts.length is live count, always add to end.\r\n////      this.format_pn(th.posts[tgt].pn, th_old.q[th.posts[tgt].no]); // WILL BE THIS.\r\n////      if (time_unit!==1) th.posts[tgt].time *= time_unit; // BUG!!!, THIS DOESN'T ALLOW MULTIPLE ENTRY, CAN'T BE USED FOR POSTS SEARCH.\r\n//    },\r\n////    update_posts_add: function(th,th_old,pnode,merge,show) { // working code.\r\n////      if (th_old.posts && th.posts) {\r\n////        var thq = liveTag.mems[th.domain][th.board][th.no].q;\r\n////        var last_no = th_old.posts[th_old.posts.length-1].no;\r\n////        if (th.posts[th.posts.length-1].no==last_no || th.posts.length<=1) return;\r\n////        //        var i=1;\r\n////        //        while (i<th.posts.length && th.posts[i].no<=last_no) i++;\r\n////        var i=th.posts.length;\r\n////        while (i>1 && th.posts[i-1].no>last_no) i--;\r\n////        if (i>1) th.posts.splice(1,i-1);\r\n////        if (pref[cataLog.embed_mode].t2h_num_of_posts>=0 && th.posts.length > pref[cataLog.embed_mode].t2h_num_of_posts+1) {\r\n////          th.posts.splice(1,th.posts.length - pref[cataLog.embed_mode].t2h_num_of_posts -1);\r\n////          this.page_json2html3_add_omitted_info(th, th_old.posts, th.posts);\r\n////        }\r\n////        var time_unit = (merge)? th.parse_funcs.time_unit : 1; // (merge)? for safety.\r\n////        for (var i=1;i<th.posts.length;i++) {\r\n////          if (!merge) this.update_posts_insert(th.posts,th_old.posts,i,th_old.posts.length,pnode,merge); // th_old.posts.length is live count, always add to end.\r\n////            this.format_pn(th.posts[i].pn, (thq)? thq[th.posts[i].no] : null);\r\n////          //          this.format_pn(th.posts[i].pn, th_old.q[th.posts[i].no]); // WILL BE THIS.\r\n////          if (time_unit!==1) th.posts[i].time *= time_unit;\r\n////          th_old.posts[th_old.posts.length] = th.posts[i];\r\n////        }\r\n////        if (th.posts.length>1 && merge && show) this.update_posts_insert_merge(th.posts,1);\r\n////      }\r\n////    },\r\n////////    update_posts_insert_merge: function(src,start, src0_pn) { // working code, but very slow because of based on HTML.\r\n////////      if (pref[cataLog.embed_mode].scroll_lock) cataLog.show_catalog_scroll_lock.set();\r\n////////      var i,j;\r\n////////      var myself = this.update_posts_prep_merge();\r\n////////      var dst = myself.posts;\r\n////////      var pnode = myself.pn;\r\n////////      src = src.slice();\r\n////////      src[0].pn = src0_pn; // patch for posts search\r\n////////      for (var i=src.length-1;i>=0;i--) // sort by timestamp only, so if there is, that is already sorted.\r\n////////        if (src[i].pn) {\r\n////////          var tgt = src[i].pn.parentNode;\r\n////////          while (tgt) {\r\n////////            if (tgt===pnode) {src.splice(i,1);break;} // if other sorting scheme is needed, change this to 'update_posts_remove'\r\n////////            else tgt = tgt.parentNode;\r\n////////          }\r\n////////        }\r\n////////      if (src.length===0) return;\r\n////////      if (start===0) {\r\n////////        i = start;\r\n////////        j = 0;\r\n////////        var step = dst.length & 0x7ffffff0;\r\n////////        while (i<src.length) {\r\n////////          if (step>1) while (j+step<dst.length && (dst[j+step].time_tu<src[i].time_tu || dst[j+step].time_tu==src[i].time_tu && dst[j+step].no<=src[i].no)) j += step+1;\r\n////////          while (j<dst.length && (dst[j].time_tu<src[i].time_tu || dst[j].time_tu==src[i].time_tu && dst[j].no<=src[i].no)) j++;\r\n////////          if (j<dst.length) site2[site.nickname].update_posts_insert(src, dst, i++, j, pnode);\r\n////////          else { // can't refer nodes after inserted one.\r\n////////            var k = src.length-1;\r\n////////            site2[site.nickname].update_posts_insert(src, dst, k--, j, pnode);\r\n////////            while (k>=i) {\r\n////////              site2[site.nickname].update_posts_insert(src, src, k, k+1, pnode); // can't refer nodes after inserted one.\r\n////////              k--;\r\n////////            }\r\n////////            break;\r\n////////          }\r\n////////        }\r\n////////      } else {\r\n////////        i = src.length-1;\r\n////////        j = dst.length;\r\n////////        while (i>=start) {\r\n////////          while (j>0 && (dst[j-1].time_tu>src[i].time_tu || dst[j-1].time_tu==src[i].time_tu && dst[j-1].no>src[i].no)) j--;\r\n////////          site2[site.nickname].update_posts_insert(src, dst, i--, j, pnode);\r\n////////          while (i>=start && !(j>0 && (dst[j-1].time_tu>src[i].time_tu || dst[j-1].time_tu==src[i].time_tu && dst[j-1].no>src[i].no))) { // dst is NOT updated. It's an object, not a live list.\r\n////////            site2[site.nickname].update_posts_insert(src, src, i, i+1, pnode);\r\n////////            i--;\r\n////////          }\r\n////////        }\r\n////////      }\r\n////////    },\r\n////////    update_posts_prep_merge: function() {\r\n////////      return (cataLog.embed_mode==='thread')? this.wrap_to_parse.get(document, site.nickname, site.board, 'thread_html', {thread:site.no})[0] :\r\n////////                                              this.wrap_to_parse.get(document, site.nickname, site.board, 'page_html', {page:0})[0];\r\n////////    },\r\n////    update_posts_add: function(th,th_old,pnode) { // working code.\r\n////      if (th_old.posts && th.posts) {\r\n////        var thq = liveTag.mems[th.domain][th.board][th.no].q;\r\n////        for (var i=1;i<th.posts.length;i++) {\r\n////          if (th.posts[i].no>th_old.posts[th_old.posts.length-1].no) {\r\n////            this.update_posts_insert(th,th_old,i,pnode);\r\n////            this.format_pn(th.posts[i].pn, (thq)? thq[th.posts[i].no] : null);\r\n//////            this.format_pn(th.posts[i].pn, th_old.q[th.posts[i].no]); // WILL BE THIS.\r\n////            th_old.posts[th_old.posts.length] = th.posts[i];\r\n////          }\r\n////        }\r\n////      }\r\n////    },\r\n////////    update_posts_add: function(th,th_old,pnode) { // working code.\r\n////////      var ref = th_old.posts[0].nextSibling || null;\r\n////////      for (var i=0;i<th.posts.length;i++) {\r\n////////        if (th.posts[i].no>th_old.posts[th_old.posts.length-1].no) {\r\n////////          pnode.appendChild(document.createElement('br'));\r\n////////          pnode.appendChild(this.post_container(th.posts[i].pn || this.post_json2html(th.posts[i],th.posts.board),th.posts[i].no));\r\n////////          th_old.posts[th_old.posts.length] = th.posts[i];\r\n////////        }\r\n////////      }\r\n////////    },\r\n    short_link:function(){return '';},\r\n//    link_txt2html: function(txt){ // not used\r\n//      return txt.replace(/>>(>(>[^/]+)*\\/\\w+\\/)*(\\d\\d+)/g,function(m,p1,p2,p3){\r\n//        var dbtp = [p2? p2.slice(1): site.nickname, p1? p1.slice(p1.indexOf('/')) : site.board, p3, p3];\r\n//        return this.link_dbtp2html(dbtp);\r\n//      }.bind(this));\r\n//    },\r\n    link_sanitizedTxt2html: function(txt, th){\r\n      return txt.replace(/&gt;&gt;(&gt;(&gt;[^/]+)*\\/\\w+\\/)*(\\d\\d+)/g,function(m,p1,p2,p3){\r\n        var dbtp = [p2? p2.slice(4): site.nickname, p1? p1.slice(p1.indexOf('/')) : site.board, p3, p3];\r\n        if (!th._links) th._links = [dbtp]; else th._links[th._links.length] = dbtp;\r\n        return this.link_dbtp2html(dbtp, m); //  + (pref.test_mode['147']? Triage.prototype.MERGEE_button_html:'');\r\n      }.bind(this));\r\n    },\r\n    link_dbtp2txt: function(dbtp, board, domain){\r\n      return (dbtp[0]!==(domain||site.nickname)? '>>>>'+dbtp[0]+dbtp[1]+'/': (dbtp[1]!==(board||site.board)? '>>>'+dbtp[1] : '>>'))+ (dbtp[3]||dbtp[2]);\r\n    },\r\n    modify_a2anchor: function(pn){\r\n      if (pn.childElementCount!=0 || pn.textContent[0]==='>') return;\r\n      var domain = this.popups_posts.href2domain(pn.href);\r\n      if (!domain || !site2[domain]) return;\r\n      var tailer = pn.textContent.replace(pn.href,' ()');\r\n      var dbtp = site2[domain].popups_href2dbtp(pn.href);\r\n      pn.textContent = this.link_dbtp2txt(dbtp) + (tailer===' ()'? '' : tailer);\r\n    },\r\n    modify_href2html: function(th, domain, board, href){\r\n      var dbtp = this.popups_href2dbtp(href);\r\n      if (!th._links) th._links = [dbtp]; else th._links[th._links.length] = dbtp;\r\n      return '<a href=\"'+href+'\">'+this.link_dbtp2txt(dbtp, board, domain)+'</a>' + (pref.test_mode['147']? Triage.prototype.MERGEE_button_html:'');\r\n    },\r\n    page_json2html3_replace_expander: function(){}, // temporal\r\n    page_json2html3_add_omitted_info: function(th, th_old, force_expander, from_initial) {\r\n      if (!from_initial) {\r\n        var posts = th.posts;\r\n        var posts_deleted = th.lth.pd;\r\n        var nof_posts_omitted = th.nof_posts - posts.length + (posts_deleted? posts_deleted.length : 0);\r\n        if (nof_posts_omitted) {\r\n          var nof_files = 0;\r\n          for (var i=0;i<posts.length;i++) nof_files += posts[i].nofFiles;\r\n          if (posts_deleted) {\r\n            var nos_shown = {};\r\n            for (var i=0;i<posts.length;i++) if (posts[i].deleted_after) nos_shown[posts[i].no] = null;\r\n            for (var i=0;i<posts_deleted.length;i++) if (nos_shown[posts_deleted[i].no]===undefined) nof_files -= posts_deleted[i].nofFiles; // decrease nof_files to increase nof_files_omitted\r\n          }\r\n          var nof_files_omitted = th.nof_files - nof_files; // (+ files_in_not_shown_deleted_posts)\r\n        }\r\n      }\r\n      if (!th_old.pn_summary) {\r\n        force_expander |= th.domain!==site.nickname; //  || pref[cataLog.embed_mode].use_expander_always;\r\n        if (nof_posts_omitted>0 || force_expander) th_old.pn_summary = this.page_json2html3_prep_omitted_info(th_old.posts? th_old.posts[0] : th.posts[0], th, force_expander);\r\n      }\r\n      if (th_old.pn_summary && !from_initial) th_old.pn_summary.textContent = this.page_json2html3_set_omitted_info(nof_posts_omitted, nof_files_omitted||0);\r\n//      site2[th_old && th_old.domain_html || th.domain_html].page_json2html3_add_omitted_info_html(th, th_old, force_expander, nof_posts_omitted, nof_files_omitted||0); // 'th_old &&' is a patch for working regardless of pref.test_mode['140'], it can be removed when I fix the test_mode to true.\r\n    },\r\n    page_json2html3_cloneOPWithoutFooter: function(pn_src){\r\n      if (!pn_src) return;\r\n      var pn = pn_src.cloneNode(true);\r\n      var footer = pn.getElementsByClassName(pref.script_prefix+'_footer')[0];\r\n      if (footer) footer.parentNode.removeChild(footer);\r\n      return pn;\r\n    },\r\n    post_json2html_fname_server: function(post){return post.tim+post.ext;},\r\n    post_json2html_fname: function(post){return post.filename+post.ext;},\r\n    post_com2txt_finisher: (function(){\r\n      var pn_com = document.createElement('div');\r\n      return function(txt, pst){\r\n        if (txt.search(/&[#\\w\\d]+;/)==-1) return txt; //  && !pref.test_mode['58']) return txt;\r\n        if (pref.debug_mode['17']) console.log('not interpreted html: '+txt);\r\n        pn_com.innerHTML = pst && pst.com; // giving com is faster than giving txt.\r\n        return pn_com.textContent; // [brwsr.innerText];\r\n      };\r\n    })(),\r\n    post_com2txt: function(post){\r\n      return (!post.com)? '' : this.post_com2txt_finisher(post.com.replace(/<[^>]*>/g,' ').replace(/&gt;/g,'>').replace(/&lt;/g,'<').replace(/&amp;/g,'&'), post); // most of lainchan, speed: 9.4/1.99, misshit 4%\r\n    },\r\n    patch:{},\r\n    post_pn2ce: function(pn){\r\n      return (pn.lastChild.tagName==='BLOCKQUOTE')? pn.lastChild : pn.getElementsByTagName('blockquote')[0];\r\n    },\r\n//    post_an2pn: function(pn){\r\n//      while (pn && pn.classList && !pn.classList.contains('post')) pn = pn.parentNode; // because document.parentNode.parentNode.classList===undefined\r\n//      return pn;\r\n//    },\r\n    //    post_pn2ce: function(pn){return pn;},\r\n    headline_json2html: function(th){\r\n//      var pn = cnst.dom('<div class=\"'+pref.script_prefix+'_headline'+'\">' +(th.sub?'<b>'+th.sub+'</b>: ':'') + th.com + '</div>');\r\n//      var max_txt = pref.headline.max_letters;\r\n//      for (var i=0;i<pn.childNodes.length;i++) {\r\n//        var n = pn.childNodes[i];\r\n//        if (n.tagName==='BR') {pn.removeChild(n);i--;}\r\n//        if (!n.childNodes && n.textContent.length > max_txt) n.textContent = n.textContent.slice(0,max_txt)+' ... ';\r\n//      }\r\n      var txt = site2[th.domain].post_com2txt(th);\r\n      var max_txt = pref.headline.max_letters - (th.sub? th.sub.length+9:0); // 9 for '<b></b>: ', not for cliping in tag notations.\r\n      var html = (th.sub? '<b>'+th.sub+'</b>: ': '') + (txt.length<max_txt? txt : txt.slice(0,max_txt)+' ...');\r\n      var pn = cnst.dom('<div class=\"'+pref.script_prefix+'_headline'+'\">'+html+'</div>');\r\n//      pn.setAttribute('style','white-space:nowrap;text-overflow:ellipsis;overflow:hidden;width:100%');\r\n      gGEH.pns_all_keys.set(pn,th.key);\r\n//      pn.innerHTML = '<span></span> '+sub_com;\r\n//      Object.defineProperty(th,'footer',{value:th.firstChild, configurable:true, enumerable:true, writable:true});\r\n//      th.footer = th.firstChild;\r\n      return pn;\r\n    },\r\n    headline_merge: function(pn, merge, clg){ // changing merge.tgt_ths[0][0] is patchy, but better than buggy.\r\n      if (merge.isShown===0) return pn;\r\n      if (merge.isShown===1) {\r\n        var pn0 = merge.pn;\r\n        merge.pn = merge.tgt_ths[0][0] = cnst.dom('<div class=\"'+pref.script_prefix+'_headline '+pref.script_prefix+'_merged\"></div>');\r\n        if (pn0.parentNode) pn0.parentNode.insertBefore(merge.pn, pn0);\r\n        var truncated = pref.headline.merge_truncated;\r\n        var mems = cnst.dom('<div class=\"'+pref.script_prefix+'_mergedMembers\"'+(truncated?' style=\"display:none\"':'')+'></div>');\r\n        mems.appendChild(pn0);\r\n        merge.footer = [clg.footer.add_menu(cnst.dom('<span class=\"'+pref.script_prefix+'_footer\"></span>'))]; // dependant on tagname of footer\r\n        var summary = this.headline_prep_summary(cnst.dom('<div></div>'), pn0, merge.footer[0], cnst.dom('<a class=\"'+pref.script_prefix+'_button\" name=\"'+(truncated?'SHOW_T':'HIDE_T')+'\" data-trav=\"Pn\" data-str=\"'+(truncated?'[\\u25b2]\">[\\u25bc]':'[\\u25bc]\">[\\u25b2]')+'</a>')); // to remove style, use cnst.dom instead of cloneNode // not to add class to through th_pn search\r\n        merge.pn.appendChild(summary);\r\n        merge.pn.appendChild(mems);\r\n      }\r\n      return merge.pn.lastChild.appendChild(pn);\r\n    },\r\n    headline_separate: function(merge, pn){\r\n      if (merge.isShown>=3) {\r\n        if (merge.pn.lastChild.firstChild===pn) this.headline_prep_summary(merge.pn.firstChild, merge.pn.lastChild.childNodes[1]);\r\n        return merge.pn.lastChild.removeChild(pn);\r\n      } else if (merge.isShown==2) {\r\n        var mems = merge.pn.lastChild;\r\n        var idx0 = mems.firstChild===pn? 1 : 0;\r\n        var pn0 = idx0===1? mems.lastChild : mems.firstChild;\r\n        if (merge.pn.parentNode) merge.pn.parentNode.replaceChild(pn0, merge.pn);\r\n        merge.pn = merge.tgt_ths[idx0][0] = pn0;\r\n      }\r\n      return pn;\r\n    },\r\n//    headline_merge: function(pn, merge, clg){ // works, but can't color properly when isShown===1, open_thread colors tgt_th[0](outer), but embeddedTriage colors tgt_th[3](inner)\r\n//      if (merge.isShown===0) {\r\n//        merge.pn = cnst.dom('<div class=\"'+pref.script_prefix+'_headline '+pref.script_prefix+'_merged\"></div>'); // merge.pn will be tgt_th[0], must be this hierarchy.\r\n//        if (pn.parentNode) pn.insertBefore(merge.pn, pn);\r\n//        return merge.pn.appendChild(pn);\r\n//      }\r\n//      if (merge.isShown===1) {\r\n//        var truncated = pref.headline.merge_truncated;\r\n//        var mems = cnst.dom('<div class=\"'+pref.script_prefix+'_mergedMembers\"'+(truncated?' style=\"display:none\"':'')+'></div>');\r\n//        var mem0 = mems.appendChild(merge.pn.firstChild);\r\n//        merge.footer = [clg.footer.add_menu(cnst.dom('<span class=\"'+pref.script_prefix+'_footer\"></span>'))]; // dependant on tagname of footer\r\n//        var summary = this.headline_prep_summary(cnst.dom('<div></div>'), mem0, merge.footer[0], cnst.dom('<a class=\"'+pref.script_prefix+'_button\" name=\"'+(truncated?'SHOW':'HIDE')+'_PN\" data-str=\"'+(truncated?'[\\u25b2]\">[\\u25bc]':'[\\u25bc]\">[\\u25b2]')+'</a>')); // to remove style, use cnst.dom instead of cloneNode // not to add class to through th_pn search\r\n////        var clone = merge.pn.lastChild.firstChild.cloneNode(true); // BUG, styles are inherited.\r\n////        clone.firstChild.innerHTML = '';\r\n////        clone.insertBefore(cnst.dom('<a class=\"'+pref.script_prefix+'_button\" name=\"'+(truncated?'SHOW':'HIDE')+'_PN\" data-str=\"'+(truncated?'[\\u25b2]\">[\\u25bc]':'[\\u25bc]\">[\\u25b2]')+'</a>'),clone.childNodes[1]);\r\n//        merge.pn.appendChild(summary);\r\n//        merge.pn.appendChild(mems);\r\n//      }\r\n////      if (merge.isShown===1) merge.footer = [merge.pn.insertBefore(clg.footer.add_menu(document.createElement('div')), merge.pn.firstChild)];\r\n//      return merge.pn.lastChild.appendChild(pn);\r\n//    },\r\n//    headline_separate: function(merge, pn){\r\n//      if (merge.isShown>=3) {\r\n//        if (merge.pn.lastChild.firstChild===pn) this.headline_prep_summary(merge.pn.firstChild, merge.pn.lastChild.childNodes[1]);\r\n////      if (merge.pn.lastChild.firstChild===pn && merge.pn.lastChild.childNodes.length>=2) {\r\n////        var clone = merge.pn.lastChild.childNodes[1].cloneNode(true);\r\n////        var ppn = merge.pn.firstChild\r\n////        var n;\r\n////        while (n = ppn.childNodes[2]) ppn.removeChild(n); // [0]:footer, [1]:button for expand\r\n////        while (n = clone.childNodes[1]) ppn.appendChild(n); // [0]:footer\r\n////      }\r\n//        return merge.pn.lastChild.removeChild(pn);\r\n//      } else if (merge.isShown==2) {\r\n//        merge.pn.removeChild(merge.pn.firstChild);\r\n//        var mems = merge.pn.removeChild(merge.pn.lastChild);\r\n//        merge.pn.appendChild(mems.firstChild===pn? mems.lastChild : mems.firstChild);\r\n//      }\r\n//      return pn;\r\n//    },\r\n    headline_prep_summary: function(dst, src, footer_in, button_in){\r\n      var class_footer = pref.script_prefix+'_footer';\r\n      var footer = footer_in || dst.getElementsByClassName(class_footer)[0];\r\n      var button = button_in || footer.nextSibling;\r\n      var pn;\r\n      if (!footer_in) while (pn = dst.firstChild) dst.removeChild(pn); // remove all for threadIcon\r\n      var i = 0;\r\n      while (pn = src.childNodes[i++]) dst.appendChild(pn.classList && pn.classList.contains(class_footer)? (dst.appendChild(footer), button) : pn.cloneNode(true));\r\n//      var pn;\r\n//      if (replace) while (pn = dst.childNodes[2]) dst.removeChild(pn); // [0]:footer, [1]:button for expand\r\n//      var class_footer = pref.script_prefix+'_footer';\r\n//      var i = 0;\r\n//      while (pn = src.childNodes[i++]) if (!pn.classList || !pn.classList.contains(class_footer)) dst.appendChild(pn.cloneNode(true)); // [0]:footer\r\n      return dst;\r\n    },\r\n    headline_reorder: function(pn, merge, clg, idx_new){\r\n      merge.pn.childNodes[1].insertBefore(pn, merge.pn.childNodes[1].childNodes[idx_new] || null);\r\n      if (idx_new==0) this.headline_prep_summary(merge.pn.firstChild, pn); // set title from top one.\r\n    },\r\n  };\r\n  site2['common'] = { // common functions\r\n    absorb_children: function(pn){\r\n      var container = document.createElement('div');\r\n      while (pn.childNodes.length!=0) container.appendChild(pn.childNodes[0]);\r\n      pn.appendChild(container);\r\n      return container;\r\n    },\r\n    disgorge_children: function(pn){\r\n      while (pn.childNodes.length!=0) pn.parentNode.appendChild(pn.childNodes[0]);\r\n      pn.parentNode.removeChild(pn);\r\n    },\r\n    remove_by_classname : function(pn,classname,end,remove_br){\r\n      if (end===undefined) end = 0;\r\n      var tgts = pn.getElementsByClassName(classname);\r\n      for (var i=tgts.length-1-end;i>=0;i--) {\r\n        if (remove_br && tgts[i].nextSibling && tgts[i].nextSibling.tagName==='BR') tgts[i].parentNode.removeChild(tgts[i].nextSibling);\r\n//if (!pref.test_mode['14']) tgts[i].setAttribute('style','display:none;'+(tgts[i].getAttribute('style') || ''));\r\n//else\r\n        tgts[i].parentNode.removeChild(tgts[i]);\r\n      }\r\n    },\r\n//    remove_by_classname : function(pn,classname,end,remove_br){ // cause document leak in Chrome at 4chan/a/.\r\n//      if (end===undefined) end = 0;\r\n//      var tgts = pn.getElementsByClassName(classname);\r\n//      for (var i=tgts.length-1-end;i>=0;i--) {\r\n//        if (remove_br && tgts[i].nextSibling && tgts[i].nextSibling.outerHTML==='<br>') tgts[i].parentNode.removeChild(tgts[i].nextSibling);\r\n//        tgts[i].parentNode.removeChild(tgts[i]);\r\n//      }\r\n//    },\r\n    remove_by_tagname : function(pn,tagname,end){\r\n      if (end===undefined) end = 0;\r\n      var tgts = pn.getElementsByTagName(tagname);\r\n      for (var i=tgts.length-1-end;i>=0;i--) tgts[i].parentNode.removeChild(tgts[i]);\r\n    },\r\n    remove_by_attribute : function(pns,attr_name,attr_val){ // pns must be array.\r\n      for (var i=pns.length-1;i>=0;i--)\r\n        for (var j=pns[i].childNodes.length-1;j>=0;j--)\r\n          if (pns[i].childNodes[j].getAttribute)\r\n            if (pns[i].childNodes[j].getAttribute(attr_name))\r\n              if (pns[i].childNodes[j].getAttribute(attr_name).search(attr_val)!=-1) pns[i].removeChild(pns[i].childNodes[j]);\r\n    },\r\n    remove_attribute : function(doc,attr_name){\r\n      var pns = doc.getElementsByTagName('*');\r\n      for (var i=pns.length-1;i>=0;i--)\r\n        if (pns[i].getAttribute && pns[i].getAttribute(attr_name)) pns[i].removeAttribute(attr_name);\r\n    },\r\n    add_attribute_by_classname : function(pn,classname,attr_name,attr_val){\r\n      var tgts = pn.getElementsByClassName(classname);\r\n      for (var i=tgts.length-1;i>=0;i--) tgts[i].setAttribute(attr_name,attr_val);\r\n    },\r\n    add_attribute_by_tagname : function(pn,tagname,attr_name,attr_val){\r\n      var tgts = pn.getElementsByTagName(tagname);\r\n      for (var i=tgts.length-1;i>=0;i--) tgts[i].setAttribute(attr_name,attr_val);\r\n    },\r\n    add_attribute_by_attribute : function(pns,attr_name,attr_val,attr_name2,attr_val2){ // pns must be array.\r\n      for (var i=pns.length-1;i>=0;i--)\r\n        for (var j=pns[i].childNodes.length-1;j>=0;j--)\r\n          if (pns[i].childNodes[j].getAttribute)\r\n            if (pns[i].childNodes[j].getAttribute(attr_name))\r\n              if (pns[i].childNodes[j].getAttribute(attr_name).search(attr_val)!=-1) pns[i].setAttribute(attr_name2,attr_val2);\r\n    },\r\n    move_up_and_delete_parent : function(pns){\r\n      for (var i=0;i<pns.length;i++) {\r\n        var parent = pns[i].parentNode;\r\n        var g_parent = parent.parentNode;\r\n        g_parent.insertBefore(pns[i],parent);\r\n        g_parent.removeChild(parent);\r\n      }\r\n    },\r\n    remove_last_hrs_and_brs : function(th){\r\n      while (1) {\r\n        var last_node = th.childNodes[th.childNodes.length-1];\r\n        if (last_node.tagName !== 'HR' && last_node.tagName !== 'BR') break;\r\n        else th.removeChild(last_node);\r\n      }\r\n    },\r\n    remove_brs : function(elem){\r\n      var tgts = elem.getElementsByTagName('br');\r\n      for (var i=tgts.length-1;i>=0;i--) tgts[i].parentNode.removeChild(tgts[i]);\r\n    },\r\n    remove_double_br : function(elem){\r\n      var elems = elem.getElementsByTagName('*');\r\n      for (var i=elems.length-2;i>=0;i--)\r\n//        if (elems[i].outerHTML=='<br>' && elems[i+1].outerHTML=='<br>') elems[i+1].parentNode.removeChild(elems[i+1]); // CAN'T FIND STRINGS WITHOUT TAGS.\r\n        if (elems[i].outerHTML==='<br>' && elems[i].nextSibling && elems[i].nextSibling.tagName==='BR') elems[i].parentNode.removeChild(elems[i].nextSibling);\r\n    },\r\n    remove_double_tags : function(elem,tag){\r\n      var elems = elem.getElementsByTagName('*');\r\n      for (var i=elems.length-2;i>=0;i--) {\r\n        if (elems[i].tagName===tag && elems[i+1].tagName===tag) elems[i+1].parentNode.removeChild(elems[i+1]);\r\n      }\r\n    },\r\n    change_utc_to_local : function(utc_str){\r\n      var date = new Date(utc_str);\r\n//      return date.toString().replace(/\\ GMT.*/,'');\r\n      return date.toLocaleString().replace(/\\ /,' ('+date.toString().replace(/\\ .*/,'')+') ');\r\n    },\r\n////////    thread2headline : function(doc,nickname){\r\n////////      var retval  = site2[nickname].insert_footer(doc,0,'t2h',false,0,0,0);\r\n////////      site2[nickname].remove_posts(doc,pref.catalog_t2h_num_of_posts);\r\n////////      site2.common.remove_double_br(doc);\r\n////////      var retval2 = site2[nickname].insert_footer(doc,0,'t2h',false,0,0,0);\r\n////////      return [retval[0]-retval2[0], retval[1]-retval2[1]];\r\n////////    },\r\n  };\r\n  var site4 = {\r\n////////\r\n//////// TUNING RESULTS to parse entire 4chan by chrome, (avarage of 3 times), 2015/10/5 on XXX.\r\n////////     TYPE1: written in flat with 'exe_sub'. (traditional)\r\n////////     TYPE2: written in array with 'exe_sub'.\r\n////////     TYPE3: written in array.\r\n////////     TYPE4: written in array systematically.\r\n////////     TYPE5: written in flat.\r\n////////   results(ms): (idle), (program), (anonymous_function), usage. \r\n////////     TYPE1: 179164.7, 24936.9, 12598.6, 17.3%\r\n////////     TYPE2: 165382.5, 35503.6, 14546.3, 23.2%\r\n////////     TYPE3: 169261.9, 23509.1, 13727.0, 18.0%\r\n////////     TYPE4: 159156.4, 37429.6, 14104.5, 24.5%\r\n////////     TYPE5: 159990.8, 32805.5, 14998.7, 23.0%\r\n////////\r\n//////// TUNING RESULTS use TYPE1 to parse entire 4chan 2015/12/19 on chrome 47.0.2526.106m. Just one trial.\r\n////////     rev_547: 12min05s\r\n////////     rev_714: 11min30s, why does 4chan become so slow? lainchan is not so slow.\r\n////\r\n////    parse_funcs_getters: {}, // works.\r\n////    parse_funcs_getters: Object.create(null), // THIS DOESN'T WORK.\r\n////    parse_funcs_getters: (function(){ // works if '{}'\r\n//////      var obj = Object.create(null); // DOESN'T WORK, probably introduce problem to make prototype chain using '__proto__'.\r\n////      var obj = {}; // works.\r\n////      var props=['no','ths','key','time_bumped','nof_posts','nof_files','time_created','posts','sub','name','com','flag','flags',\r\n////                 'footer','sticky','format','pn','pn_name','time','time_posted','tn_as','tn_imgs','op_img_url','post_no'];\r\n////      for (var i=0;i<props.length;i++) Object.defineProperty(obj,props[i],{get:(function(prop){return function(){return this.exe_sub(prop);}})(props[i]), enumerable:true});\r\n////      return obj;\r\n////    })(),\r\n////\r\n    parse_funcs_getters: { // working code. // TYPE1\r\n      get no() {return this.exe_sub('no');},\r\n//      get ths() {return this.exe_sub('ths');}, // removed to get faster.\r\n      get key() {return this.exe_sub('key');},\r\n      get time_bumped() {return this.exe_sub('time_bumped');},\r\n      get nof_posts() {return this.exe_sub('nof_posts');},\r\n      get nof_files() {return this.exe_sub('nof_files');},\r\n      get time_created() {return this.exe_sub('time_created');},\r\n      get posts() {return this.exe_sub('posts');},\r\n      get sub() {return this.exe_sub('sub');},\r\n      get name() {return this.exe_sub('name');},\r\n      get com() {return this.exe_sub('com');},\r\n      get flag() {return this.exe_sub('flag');},\r\n      get flags() {return this.exe_sub('flags');},\r\n      get footer() {return this.exe_sub('footer');},\r\n      get sticky() {return this.exe_sub('sticky');},\r\n//      get format() {return this.exe_sub('format');},\r\n//      get pn() {return this.exe_sub('pn');},\r\n//      get pn_name() {return this.exe_sub2('pn_name');},\r\n      get time() {return this.exe_sub('time');},\r\n      get time_posted() {return this.exe_sub('time_posted');},\r\n//      get html_org() {return this.exe_sub('html_org');},\r\n      get tn_as() {return this.exe_sub2('tn_as');},  // CAUTION. ADDED AFTER TUNING.\r\n      get tn_imgs() {return this.exe_sub2('tn_imgs');},  // CAUTION. ADDED AFTER TUNING.\r\n      get op_img_url() {return this.exe_sub('op_img_url');},\r\n////      get post_no() {return this.exe_sub('post_no');},\r\n//      get last_replies() {return this.exe_sub('last_replies');},   // CAUTION. ADDED AFTER TUNING.\r\n      get txt() {return this.exe_sub('txt');},   // CAUTION. ADDED AFTER TUNING.\r\n\r\n      get time_tu() {return this.time * this.parse_funcs.time_unit;},   // CAUTION. ADDED AFTER TUNING. THIS IS NOT A CALLER.\r\n      get time_tu1000() {return this.time;},  // assume time_unit===1000  // CAUTION. ADDED AFTER TUNING. THIS IS NOT A CALLER.\r\n      get lth() {return liveTag.mems[this.domain][this.board][this.no];},   // CAUTION. ADDED AFTER TUNING. THIS IS NOT A CALLER.\r\n      get type_mimic(){return this.type_source;},\r\n      get key_op() {return this.domain + this.board + (this.resto || this.op || this.no);}, // this.op for meguca, it always refer to op, while resto===0 if it is op itself.\r\n    },\r\n////    parse_funcs_on_demand : { // TYPE5\r\n////      get no() {return Object.defineProperty(this,'no',{value:this.parse_funcs['no'](this), enumerable:true, configurable:true, writable:true})['no'];},\r\n////      get ths() {return Object.defineProperty(this,'ths',{value:this.parse_funcs['ths'](this), enumerable:true, configurable:true, writable:true})['ths'];},\r\n////      get key() {return Object.defineProperty(this,'key',{value:this.parse_funcs['key'](this), enumerable:true, configurable:true, writable:true})['key'];},\r\n////      get time_bumped() {return Object.defineProperty(this,'time_bumped',{value:this.parse_funcs['time_bumped'](this), enumerable:true, configurable:true, writable:true})['time_bumped'];},\r\n////      get nof_posts() {return Object.defineProperty(this,'nof_posts',{value:this.parse_funcs['nof_posts'](this), enumerable:true, configurable:true, writable:true})['nof_posts'];},\r\n////      get nof_files() {return Object.defineProperty(this,'nof_files',{value:this.parse_funcs['nof_files'](this), enumerable:true, configurable:true, writable:true})['nof_files'];},\r\n////      get time_created() {return Object.defineProperty(this,'time_created',{value:this.parse_funcs['time_created'](this), enumerable:true, configurable:true, writable:true})['time_created'];},\r\n////      get posts() {return Object.defineProperty(this,'posts',{value:this.parse_funcs['posts'](this), enumerable:true, configurable:true, writable:true})['posts'];},\r\n////      get sub() {return Object.defineProperty(this,'sub',{value:this.parse_funcs['sub'](this), enumerable:true, configurable:true, writable:true})['sub'];},\r\n////      get name() {return Object.defineProperty(this,'name',{value:this.parse_funcs['name'](this), enumerable:true, configurable:true, writable:true})['name'];},\r\n////      get com() {return Object.defineProperty(this,'com',{value:this.parse_funcs['com'](this), enumerable:true, configurable:true, writable:true})['com'];},\r\n////      get flag() {return Object.defineProperty(this,'flag',{value:this.parse_funcs['flag'](this), enumerable:true, configurable:true, writable:true})['flag'];},\r\n////      get flags() {return Object.defineProperty(this,'flags',{value:this.parse_funcs['flags'](this), enumerable:true, configurable:true, writable:true})['flags'];},\r\n////      get footer() {return Object.defineProperty(this,'footer',{value:this.parse_funcs['footer'](this), enumerable:true, configurable:true, writable:true})['footer'];},\r\n////      get sticky() {return Object.defineProperty(this,'sticky',{value:this.parse_funcs['sticky'](this), enumerable:true, configurable:true, writable:true})['sticky'];},\r\n////      get format() {return Object.defineProperty(this,'format',{value:this.parse_funcs['format'](this), enumerable:true, configurable:true, writable:true})['format'];},\r\n////      get pn() {return Object.defineProperty(this,'pn',{value:this.parse_funcs['pn'](this), enumerable:true, configurable:true, writable:true})['pn'];},\r\n////      get pn_name() {return Object.defineProperty(this,'pn_name',{value:this.parse_funcs['pn_name'](this), enumerable:true, configurable:true, writable:true})['pn_name'];},\r\n////      get time() {return Object.defineProperty(this,'time',{value:this.parse_funcs['time'](this), enumerable:true, configurable:true, writable:true})['time'];},\r\n////      get time_posted() {return Object.defineProperty(this,'time_posted',{value:this.parse_funcs['time_posted'](this), enumerable:true, configurable:true, writable:true})['time_posted'];},\r\n//////      get html_org() {return Object.defineProperty(this,'html_org',{value:this.parse_funcs['html_org'](this), enumerable:true, configurable:true, writable:true})['html_org'];},\r\n////      get tn_as() {return Object.defineProperty(this,'tn_as',{value:this.parse_funcs['tn_as'](this), enumerable:true, configurable:true, writable:true})['tn_as'];},\r\n////      get tn_imgs() {return Object.defineProperty(this,'tn_imgs',{value:this.parse_funcs['tn_imgs'](this), enumerable:true, configurable:true, writable:true})['tn_imgs'];},\r\n////      get op_img_url() {return Object.defineProperty(this,'op_img_url',{value:this.parse_funcs['op_img_url'](this), enumerable:true, configurable:true, writable:true})['op_img_url'];},\r\n////      get post_no() {return Object.defineProperty(this,'post_no',{value:this.parse_funcs['post_no'](this), enumerable:true, configurable:true, writable:true})['post_no'];},\r\n////    },\r\n  };\r\n////  var props=['no','ths','key','time_bumped','nof_posts','nof_files','time_created','posts','sub','name','com','flag','flags', // works.\r\n////             'footer','sticky','format','pn','pn_name','time','time_posted','tn_as','tn_imgs','op_img_url','post_no'];\r\n////  for (var i=0;i<props.length;i++)\r\n//////    Object.defineProperty(site4.parse_funcs_getters,props[i],{get:(function(prop){return function(){return this.exe_sub(prop);}})(props[i]), enumerable:true}); // TYPE2\r\n////    Object.defineProperty(site4.parse_funcs_on_demand,props[i],{get:(function(prop){ // WORKS // TYPE3\r\n////      return function(){\r\n////        return Object.defineProperty(this,prop,{value:this.parse_funcs[prop](this), enumerable:true, configurable:true, writable:true})[prop];\r\n////      }})(props[i]), enumerable:true});\r\n  site4.parse_funcs_on_demand = { // working code. // TYPE1,2\r\n    exe_sub : function(prop){return Object.defineProperty(this,prop,{value:this.parse_funcs[prop](this), enumerable:true, configurable:true, writable:true})[prop];},\r\n    exe_sub2 : function(prop){return this.parse_funcs_html[prop](this);}, // no cache\r\n    __proto__: site4.parse_funcs_getters\r\n  };\r\n  site4.parse_funcs_on_demand_debug = {\r\n    exe_sub : function(prop){\r\n      try {\r\n        return Object.defineProperty(this,prop,{value:this.parse_funcs[prop](this), enumerable:true, configurable:true, writable:true})[prop];\r\n      } catch(e) {\r\n        console.log('parse_error: '+this.key+', '+this.type_parse+', '+prop);\r\n        console.trace();\r\n        console.log(this);\r\n      }\r\n    },\r\n    exe_sub2 : function(prop){\r\n      try {\r\n        return this.parse_funcs_html[prop](this); // no cache\r\n      } catch(e) {\r\n        console.log('parse_error: '+this.key+', '+this.type_parse+', '+prop);\r\n        console.trace();\r\n        console.log(this);\r\n      }\r\n    },\r\n    __proto__: site4.parse_funcs_getters\r\n  };\r\n  site4.parse_funcs_no_cache = {\r\n    exe_sub : function(prop){return this.parse_funcs[prop](this);},\r\n    exe_sub2 : function(prop){return this.parse_funcs_html[prop](this);},\r\n    __proto__: site4.parse_funcs_getters\r\n  };\r\n  site4.parse_funcs_one_time = {\r\n    get posts() {return Object.defineProperty(this,'posts',{value:this.parse_funcs['posts'](this), enumerable:true, configurable:true, writable:true})['posts'];},\r\n    exe_sub : function(prop){return this.parse_funcs[prop](this);},\r\n    exe_sub2 : function(prop){return this.parse_funcs_html[prop](this);},\r\n    __proto__: site4.parse_funcs_getters\r\n  };\r\n  site4.parse_funcs_html = { // for test_mode['121'] initially\r\n    get id(){return this.exe_sub('id');},\r\n    get pn_id(){return this.exe_sub('pn_id');},\r\n//        get country(){return this.exe_sub('country');},\r\n//        get trip(){return this.exe_sub('trip');},\r\n//        get pn_trip(){return this.exe_sub('pn_trip');},\r\n    get pn_name(){return this.exe_sub('pn_name');},\r\n//        get tFlag(){return this.exe_sub('tFlag');},\r\n    get nofFiles(){return this.exe_sub('nofFiles');},\r\n    __proto__: (pref.debug_mode.parse_error)? site4.parse_funcs_on_demand_debug : site4.parse_funcs_on_demand\r\n  }\r\n\r\n////  (function (){ // WORKS, BUT TOO SLOW // TYPE4\r\n////    var props=['no','ths','key','time_bumped','nof_posts','nof_files','time_created','posts','sub','name','com','flag','flags', // works.\r\n////               'footer','sticky','format','pn','pn_name','time','time_posted','tn_as','tn_imgs','op_img_url','post_no'];\r\n////    for (var i=0;i<props.length;i++) {\r\n////      var func = (function(prop){return function(){\r\n////                   return Object.defineProperty(this,prop,{value:this.parse_funcs[prop](this), enumerable:true, configurable:true, writable:true})[prop];\r\n////                 }})(props[i]);\r\n////      var func_no_cache = (function(prop){return function(){\r\n////                   return this.parse_funcs[prop](this);\r\n////                 }})(props[i]);\r\n////      var func_debug = (function(func,prop){return function(){\r\n////                         try {\r\n//////                           return func();  // THIS DOESN'T WORK, WHY???\r\n////                           return Object.defineProperty(this,prop,{value:this.parse_funcs[prop](this), enumerable:true, configurable:true, writable:true})[prop]; // works.\r\n////                         } catch(e) {\r\n////                           console.log('parse_error: '+this.key+', '+this.type_parse);\r\n////                         }\r\n////                       }})(func,props[i]);\r\n////      Object.defineProperty(site4.parse_funcs_on_demand,props[i],{get:func, enumerable:true});\r\n////      Object.defineProperty(site4.parse_funcs_on_demand_debug,props[i],{get:func_debug, enumerable:true});  // NOT DEBUGGED YET\r\n////      Object.defineProperty(site4.parse_funcs_no_cache,props[i],{get:func_no_cache, enumerable:true});  // NOT DEBUGGED YET\r\n////      if (props[i]!=='posts') Object.defineProperty(site4.parse_funcs_one_time,props[i],{get:func, enumerable:true});  // NOT DEBUGGED YET\r\n////      else Object.defineProperty(site4.parse_funcs_one_time,props[i],{get:func_no_cache, enumerable:true});\r\n////    }\r\n////  })();\r\n\r\nif (pref.features.domains['8chan']) {\r\n  site2['8chan'] = {\r\n    nickname : '8chan',\r\n    domain_url: '8kun.top', // '8ch.net',\r\n    domain_url_image: 'media.8kun.top',\r\n//    home : site.protocol + '//8chan.co/faq.html', // stop twitter and IRC access.\r\n//    home : site.protocol + '//8ch.net/faq.html', // stop twitter and IRC access.\r\n//    home : site.protocol + '//8ch.net/favicon.ico', // can't work in FF.\r\n    home: site.protocol + '//8kun.top' + ((brwsr.ff)? '/faq.html' : '/favicon.ico'),\r\n//    protocol : 'https:',\r\n    protocol : site.protocol,\r\n    features : {uip_tracker: true},\r\n    utilize_boards_json: true,\r\n    check_func : function(){\r\n      var href = window.location.href;\r\n      if (href.indexOf(this.domain_url)!==-1) { // 8chan\r\n//        site2['8chan'].domain_url = (href.search(/8ch.net/)!=-1)? '8ch.net' : '8chan.co';\r\n        this.home = site.protocol + '//' + this.domain_url + this.home.substr(this.home.lastIndexOf('/')); // FF doesn't work on favicon.\r\n        site.whereami = (document.title.indexOf('404 - Page Not Found')!=-1)? '404'\r\n                      : (href.search(/8kun\\.top\\/?$/)!=-1)? 'frame'\r\n                      : (href.search(/catalog\\.html/)!=-1)? 'catalog'\r\n                      : (href.search(/res\\/[0-9\\+]*\\.html/)!=-1)? 'thread'\r\n                      : (href.search(/8kun\\.top\\/index/)!=-1)? 'boards'\r\n                      : (href.search(/\\/$|(index|[0-9]+)\\.html|\\/#all$/)!=-1)? 'page'\r\n                      : (href.search(/boards.html/)!=-1)? 'boards'\r\n                      : 'other';\r\n        site.config(site2['8chan'].domain_url,'8chan');\r\n        site.header_height = function(){\r\n          var header = document.getElementsByClassName('boardlist')[0];\r\n          return (header)? header.offsetHeight : 0;\r\n        }\r\n        site.postform = document.getElementsByTagName('form')[0];\r\n//        site.postform_comment = document.getElementById('body');\r\n        if (site.postform) this.postform_prep();\r\n        site.max_page = site2['8chan'].max_page(site.board);\r\n        site.catalog = href.search(/catalog\\.html/)!=-1;\r\n        site.embed_to = (site.whereami==='thread' || site.whereami==='page')? {\r\n          top: function(){return document.getElementsByName('postcontrols')[0];},\r\n          bottom: function(){return document.getElementsByClassName('boardlist bottom')[0];}\r\n        } : (site.whereami==='catalog')? {\r\n          top: function(){return document.getElementsByClassName('thumbnail')[0].nextSibling;},\r\n          bottom: function(){return document.getElementsByTagName('footer')[0];}\r\n        } : {};\r\n        if (site.components.boardlist) site.components.boardlist.style.zIndex = 0;\r\n        if (site.whereami==='boards') {\r\n          var ppn = document.getElementById('search-form').parentNode;\r\n          var button = ppn.parentNode.insertBefore(document.createElement('button'),ppn);\r\n//          var button = ppn.firstChild.appendChild(document.createElement('button')); // doesn't work, form is submitted.\r\n          button.textContent = 'TagSearch';\r\n          var pn_redirect = document.createElement('div');\r\n          pn_redirect.innerHTML = pref_func.format_html_str('<BTN\"tagSearch.genResult,Generate Result\"><IC\"tagSearch.auto\">Auto, &lt;= <ITB4\"tagSearch.th_b\">boards or <ITB4\"tagSearch.th_t\">tags, Now: <span></span>');\r\n          var pn_summary = pn_redirect.lastChild;\r\n          pref_func.apply_prep(pn_redirect, false);\r\n          button.onclick = function(e){\r\n            pref.catalog.board.board_tags = true;\r\n            pref_func.settings.onchange_funcs['tag.generate_caller']('tag.scan');\r\n            var pn = liveTag.popup_filter.embed(pn_redirect);\r\n            if (pn) {\r\n              button.parentNode.insertBefore(pn, button.nextSibling);\r\n              button.textContent = 'Hide original search';\r\n              button.onclick = function(e){\r\n                ppn.style.display = 'none';\r\n                e.target.style.display = 'none';\r\n              }\r\n            }\r\n          };\r\n          var pn_result = document.getElementsByClassName('board-list-tbody')[0];\r\n          var func_genResult = function(e,from_auto){\r\n            var tags = liveTag.tags_array_old.filter(function(obj){return liveTag.tags[obj.key].pn;});\r\n            if (tags.length==0) {pn_summary.textContent = 'none'; return;} // pn_summary check is required because liveTag.update_pn is synchronous in popup_filter.embed.\r\n            var bds_check = {};\r\n            var bds = [];\r\n            for (var i=0;i<tags.length;i++) {\r\n              var bds_t = Object.keys(liveTag.tags[tags[i].key].mems_boards());\r\n              for (var j=0;j<bds_t.length;j++) {\r\n                var bd = bds_t[j].replace(/^8chan/,'');\r\n                if (bds_check[bd]===undefined) {\r\n                  bds[bds.length] = bd;\r\n                  bds_check[bd] = null;\r\n                }\r\n              }\r\n            }\r\n//            var bds = tags.map(function(v){return Object.keys(liveTag.tags[v.key].mems_boards()).map(function(v){return v.replace(/^8chan/,'');}).filter(function(bd){return bds_check[bd]===undefined && (bds_check[bd]=null || true);});}).reduce(function(a,c){return a.concat(c);});\r\n            pn_summary.textContent = bds.length+' board'+(bds.length>=2?'s':'')+', '+tags.length+' tag'+(tags.length>=2?'s':'');\r\n            if (from_auto && (!site3['8chan'].boards || bds.length>pref.tagSearch.th_b && tags.length>pref.tagSearch.th_t)) return;\r\n            var obj = site3['8chan'].bds;\r\n            if (!obj) {\r\n              obj = {};\r\n              site3['8chan'].boards.forEach(function(v){obj['/'+v.uri+'/']=v;});\r\n              site3['8chan'].bds = obj;\r\n            }\r\n            pn_result.innerHTML = bds.map(function make_row(bd){return bd[0]!=='/'? '' :\r\n              '<tr><td class=\"board-uri\"><p class=\"board-cell\"><a href=\"'+bd+'\">'+bd+'</a>'+(obj[bd].sfw==1?'<i class=\"fa fa-briefcase board-sfw\" title=\"SFW\"></i>':'')+'</p></td>'+\r\n              '<td class=\"board-title\"><p class=\"board-cell\" title=\"Created \">'+obj[bd].title+'</p></td>'+\r\n              '<td class=\"board-pph\"><p class=\"board-cell board-pph-desc\" title=\"'+obj[bd].pph+' made in the last hour, '+obj[bd].pph_average+' on average\">'+obj[bd].pph+'</p></td>'+\r\n              '<td class=\"board-unique\"><p class=\"board-cell\">'+obj[bd].active+'</p></td>'+\r\n              '<td class=\"board-tags\"><p class=\"board-cell\">'+ obj[bd].tags.map(make_tag1).join('') + \r\n//                '<a class=\"tag-link\" href=\"/boards.php?tags=/pol/\">/pol/</a>'+\r\n//                '<a class=\"tag-link\" href=\"/boards.php?tags=politics\">politics</a>'+\r\n//                '<a class=\"tag-link\" href=\"/boards.php?tags=news\">news</a>'+\r\n//                '<a class=\"tag-link\" href=\"/boards.php?tags=free-speech\">free-speech</a>'+\r\n//                '<a class=\"tag-link\" href=\"/boards.php?tags=current-events\">current-events</a>'+\r\n              '</p></td>'+\r\n              '<td class=\"board-max\"><p class=\"board-cell\">'+obj[bd].max+'</p></td></tr>';}).join('');\r\n            function make_tag1(tag_in){\r\n              var tag = tag_in.slice(1);\r\n              return '<a class=\"tag-link\" href=\"/boards.php?tags='+tag+'\">'+tag+'</a>';\r\n            }\r\n          };\r\n//          pn_redirect.firstChild.onclick = func_genResult;\r\n          setTimeout(function(){\r\n            liveTag.popup_filter.onchange_funcs['tagSearch.genResult'] = func_genResult;\r\n            liveTag.sub_tagSearch = function(){if (pref.tagSearch.auto) func_genResult(null, true);};},0);\r\n//          button.onclick = pref_func.settings.onchange_funcs['tag.scan'];\r\n        }\r\n        return true;\r\n      } else {\r\n        if (!brwsr.ff) {\r\n          this.protocol = 'https:';\r\n          this.home = this.protocol + '//' + this.domain_url + this.home.substr(this.home.lastIndexOf('/'));\r\n        }\r\n        return false;\r\n      }\r\n    },\r\n    postprocess_board: function(val){\r\n      for (var i=0;i<val.length;i++) {\r\n        if (val[i].max>0) { // val[i].max is string, but this is ok.\r\n          var bd = liveTag.mems.init({domain:this.nickname, board:'/'+val[i].uri+'/'});\r\n          bd.o = i;\r\n          if (val[i].pages && !bd.pgs) bd.pgs = val[i].pages;\r\n////          site3[this.nickname].boards.push(bd); // BUG. increase length forever.\r\n          Object.defineProperty(bd,'max',{value:parseInt(val[i].max,10), writable:true});\r\n          if (bd.read_max===undefined) Object.defineProperty(bd,'read_max',{value:0, writable:true});\r\n          if (val[i].tags && val[i].tags.length!=0) liveTag.postprocess_board_add_btag(val[i].tags,bd);\r\n        }\r\n      }\r\n    },\r\n////    enumerate_boards_to_scan:function(){\r\n////      var obj = [];\r\n////      var end = (site3[site.nickname].boards.length > pref.scan.max)? pref.scan.max : site3[site.nickname].boards.length;\r\n////      for (var i=0;i<end;i++) \r\n////        if (site3[site.nickname].boards[i].max) obj[obj.length] = '/'+site3[site.nickname].boards[i].uri+'/';\r\n////      return obj;\r\n////    },\r\n////    make_site3_bds:function(){ // working code.\r\n////      var tgts = site3[site.nickname].boards;\r\n////      for (var i=0;i<tgts.length;i++) site3[this.nickname].bds['/'+tgts[i].uri+'/'] = tgts[i].max;\r\n////    },\r\n    catalog_frame_prep: function(pn12){\r\n      document.getElementsByTagName('header')[0].style.display='none';\r\n      document.getElementsByClassName('footer')[0].style.display = 'none';\r\n      var frame_menu = document.getElementsByClassName('menuCol')[0];\r\n      frame_menu.firstChild.style.display='none';\r\n      var frame_main = document.getElementsByClassName('bodyCol')[0];\r\n      frame_main.firstChild.style.display = 'none';\r\n      frame_menu.insertBefore(pn12,frame_menu.firstChild);\r\n      var ifrm = this.catalog_native_frame_prep_frame(frame_main,frame_main.firstChild);\r\n      this.catalog_embed_prep(pn12);\r\n    },\r\n    prep_own_posts_event : function(e){\r\n      if (e && e.key==='own_posts') site2['8chan'].prep_own_posts();\r\n      if (window.name==='8chan') send_message('parent',['OWN_POSTS', window.name, site3[window.name].own_posts]);\r\n    },\r\n    prep_own_posts : function(){\r\n      var own_posts = {};\r\n      var obj = JSON.parse(localStorage.getItem('own_posts'));\r\n      for (var i in obj) {\r\n        var board = '/'+i+'/';\r\n        own_posts[board] = {};\r\n        for (var j=0;j<obj[i].length;j++) own_posts[board][obj[i][j]] = null;\r\n      }\r\n//      for (var i in obj)\r\n//        for (var j=0;j<obj[i].length;j++)\r\n//          own_posts['/'+i+'/'+obj[i][j]] = null;\r\n//console.log(own_posts);\r\n      site3['8chan'].own_posts = own_posts;\r\n    },\r\n////    format_thread_always : function(th){\r\n////////      site2.common.remove_last_hrs_and_brs(th); // working code.\r\n////      if (th.nextSibling && th.nextSibling.tagName==='HR') th.appendChild(th.nextSibling);\r\n////      else th.appendChild(document.createElement('hr'));\r\n////    },\r\n//    preprocess_doc2: {\r\n//      thread_html: function(doc){\r\n//        var head = doc.getElementsByTagName('head')[0];\r\n//        while (head.firstChild) head.removeChild(head.firstChild);\r\n//        var body = doc.getElementsByTagName('body')[0];\r\n//        for (var i=body.childNodes.length-1;i>=0;i--) if (body.childNodes[i].name!=='postcontrols') body.removeChild(body.childNodes[i]);\r\n//      }\r\n//    },\r\n\r\n    parse_funcs : { // 8chan\r\n      'catalog_html' : {\r\n//        ths: function(doc,req){\r\n//          var req2 = req[req.indexOf('ths')+1];\r\n//          var mixs = doc.pn.getElementsByClassName('mix');\r\n//          var ths = [];\r\n//          for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV') {\r\n//            ths.push({pn:mixs[i], board:doc.board, domain:doc.domain});\r\n//            site2['DEFAULT'].parse_funcs.call(this,ths[ths.length-1],req2);\r\n//          }\r\n//          return ths;\r\n//        },\r\n        before_test : ['ths',':ITER',':ALL','ths',['key','time_bumped','nof_posts','nof_files']],\r\n        after_test  : ['time_created','sub','name','com','footer','sticky','format'],\r\n        full_hier   : ['ths',':ITER',':ALL','ths',['key','time_bumped','nof_posts','nof_files','time_created','sub','name','com','footer','sticky','format']],\r\n//        full_th     : ['key','time_bumped','nof_posts','nof_files','sub','name','com','footer','sticky'],\r\n        ths: function(doc) {\r\n          var mixs = doc.pn.getElementsByClassName('mix');\r\n          var ths = [];\r\nif (pref.test_mode['0']) {\r\n          for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV') ths[ths.length] = {pn:mixs[i], page:Math.floor(i/15)+'.'+i%15};\r\n} else { \r\n          for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV') ths[ths.length] = mixs[i];\r\n          ths = this.ths_array(doc,ths);\r\n}\r\n//          for (var i=0;i<ths.length;i++) ths[i].pn.getElementsByTagName('a')[0].addEventListener('click',this.preventDefault,false); // TEST, works.\r\n          return ths;\r\n        },\r\n        th_init: function(th){\r\n          var pn_child = th.pn.getElementsByTagName('div')[0];\r\n//          pn_child.className = pn_child.className.replace(/grid\\-size\\-[a-z]*/,'grid-size-'+site2[th.domain].catalog_native_size); // BUG WHEN MIMICED.\r\n          pn_child.className = pn_child.className.replace(/grid\\-size\\-[a-z]*/,'grid-size-'+site2['8chan'].catalog_native_size);\r\n//          th.pn.getElementsByTagName('a')[0].removeAttribute('href');\r\n//          th.pn.getElementsByTagName('a')[0].addEventListener('click',th.parse_funcs.preventDefault,false); // TEST\r\n        },\r\n//        th_destroy: function(pn, parse_funcs){\r\n////          pn.getElementsByTagName('a')[0].removeEventListener('click',parse_funcs.preventDefault,false); // TEST\r\n//        },\r\n////        ths: function(doc) {\r\n////          var mixs = doc.pn.getElementsByClassName('mix');\r\n////          var ths = [];\r\n////if (pref.test_mode['0']) {\r\n////          for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV') ths[ths.length] = {pn:mixs[i], page:Math.floor(i/15)+'.'+i%15};\r\n////} else { \r\n//////          for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV')\r\n//////            ths[ths.length] = {pn:mixs[i], page:Math.floor(i/15)+'.'+i%15, type_html: 'catalog_html', __proto__:doc.__proto__};\r\n////          for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV') ths[ths.length] = mixs[i];\r\n////          ths = this.ths_array(doc,ths);\r\n////}\r\n////          for (var i=0;i<ths.length;i++) {\r\n////            var pn_child = ths[i].pn.getElementsByTagName('div')[0];\r\n////            pn_child.className = pn_child.className.replace(/grid\\-size\\-[a-z]*/,'grid-size-'+site2['8chan'].catalog_native_size);\r\n////          }\r\n////          for (var i=0;i<ths.length;i++) ths[i].pn.getElementsByTagName('a')[0].removeAttribute('href');\r\n//////          for (var i=0;i<ths.length;i++) ths[i].pn.getElementsByTagName('a')[0].addEventListener('click',this.preventDefault,false); // TEST\r\n////          return ths;\r\n//////          for (var i=mixs.length-1;i>=0;i--) if (mixs[i].tagName==='DIV') mixs[i]={pn:mixs[i]}; // CAN'T WRITE TO COLLECTION.\r\n//////                                             else Array.prototype.splice.call(mixs,i,1);\r\n//////          return mixs; // return collection\r\n////        },\r\n//        no : function(th){return th.pn.getElementsByTagName('img')[0].id.replace(/img\\-/,'');},\r\n        no : function(th){return parseInt(th.pn.getAttribute('data-id'),10);},\r\n        sticky: function(th){return th.pn.getAttribute('data-sticky')==='true';},\r\n        posts: 'DEFAULT.catalog_html',\r\n        proto: 'vichan.catalog_html'\r\n      },\r\n      'catalog_json' : {\r\n////        op_img_url: function(obj) { // working code.\r\n////          return (obj.ext==='.jpg' || obj.ext==='.png' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.webm' || obj.ext==='.mp4')?\r\n////                   'https://' + site2['8chan'].domain_url + obj.board + 'thumb/' + obj.tim + '.jpg' :\r\n////                 (obj.embed)? 'https:' + obj.embed.replace(/.*src=\"/,'').replace(/\".*/,'') :\r\n////                 (obj.ext==undefined)? 'https://' + site2['8chan'].domain_url + '/static/no-file.png' :\r\n//////                 (obj.ext==undefined)? 'https://' + site2['8chan'].domain_url + '/static/assets' + obj.board + 'no-file.png' :\r\n////                 '';\r\n//////          return ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://' + site2['8chan'].domain_url + obj.board + 'thumb/' + obj.tim + obj.ext : '');\r\n////        },\r\n        get_op_src: 'thread_json',\r\n        proto: 'vichan.catalog_json'\r\n      },\r\n      'page_html'    : {\r\n        ths: function(doc) {\r\n//          var pc = doc.pn.getElementsByName('postcontrols')[0].childNodes;\r\n//          var ths = [];\r\n//          if (pc) for (var i=0;i<pc.length;i++) if (pc[i].id && pc[i].id.substr(0,6)=='thread') ths[ths.length] = pc[i];\r\n//          ths = this.ths_array(doc,ths);\r\n          var ths = this.ths_array(doc,doc.pn.getElementsByClassName('thread')); // 2015.04.26 changed to the same as 4chan.\r\n          if (site.whereami!=='page' || !pref.catalog.embed_page) for (var i=0;i<ths.length;i++) ths[i].pn.removeAttribute('class');\r\n//          for (var i=0;i<ths.length;i++) if (ths[i].pn.nextSibling && ths[i].pn.nextSibling.tagName==='HR') ths[i].pn.appendChild(ths[i].pn.nextSibling);\r\n////          for (var i=0;i<ths.length;i++) {\r\n////            var as = ths[i].pn.getElementsByTagName('a');\r\n////            as[0].removeAttribute('href'); // changed 2015.04.26\r\n////            as[1].removeAttribute('href'); // changed 2015.04.26\r\n////          }\r\n          return ths;\r\n        },\r\n//        no : function(th){return parseInt(th.pn.getElementsByClassName('post op')[0].id.substring(3),10);},\r\n//          pn: 'page_json', // for mimic\r\n        filename: 'thread_html',\r\n        proto: 'vichan.page_html'\r\n      },\r\n      'page_json'  : {\r\n        has_posts: true,\r\n//pn: function(th){return site2[th.domain_html].catalog_json2html3(th,th.board, this.op_img_url(th));}, // TEMPORAL PATCH\r\n        proto: 'vichan.page_json'\r\n      },\r\n      'thread_html'  : {\r\n////        qsel_th2posts: ':scope>.post.reply', // working code.\r\n////        pop_post_prep: function(th){\r\n////          th.posts_col = th.pn.querySelectorAll(this.qsel_th2posts);\r\n////          th.idx_pop = th.posts_col.length-1;\r\n////        },\r\n////        pop_post: function(th){\r\n////          while (th.idx_pop>=0) {\r\n////            var pn = th.posts_col[th.idx_pop--];\r\n////            if (pn.className && pn.className.indexOf('post')!=-1 && pn.className.indexOf('reply')!=-1) {\r\n////              th.post = {pn:pn, parse_funcs:this, __proto__:th.__proto__};\r\n////              return true;\r\n////            }\r\n////          }\r\n////          return false;\r\n////        },\r\n        filename: function (th){ // post can be accepted.\r\n          var filenames = [];\r\n          var files = ((th.pn.classList.contains('op'))? th.pn.parentNode : th.pn).getElementsByClassName('files')[0];\r\n          if (files) {\r\n            var spans = files.getElementsByClassName('postfilename');\r\n            for (var i=0;i<spans.length;i++) filenames[i] = spans[i].textContent;\r\n//            files = files.getElementsByClassName('file');\r\n//            for (var i=0;i<files.length;i++) {\r\n//              var as = files[i].getElementsByTagName('a');\r\n//              for (var j=0;j<as.length;j++) if (as[j].getAttribute('title')==='Save as original filename') filenames[filenames.length] = as[j].textContent;\r\n//            }\r\n          }\r\n          if (filenames.length>1) {\r\n            th.extra_files = [];\r\n            for (var i=1;i<filenames.length;i++) th.extra_files[i-1] = {filename:filenames[i], __proto__:th.__proto__};\r\n          }\r\n          return filenames[0];\r\n        },\r\n        get_op_src: 'thread_json',\r\n        proto: 'vichan.thread_html'\r\n      },\r\n      'thread_json'  : {\r\n        get_op_src: function(th){return th.op_img_url.replace('thumb','src').replace('.jpg',th.ext);},\r\n        proto: 'vichan.thread_json'\r\n      },\r\n    },\r\n\r\n////    popups_op_func_set: function(pn){return pn.parentNode.querySelector('.files');},\r\n//    popups_op_func_set: function(pn){return pn.querySelector('.files');}, // MUST BE CONSISTENT OF page_json2html\r\n//    popups_op_func_use: function(pn,thq,no){\r\n//      pn.setAttribute('class',pn.getAttribute('class')+' reply');\r\n//      pn.insertBefore(thq[no].isOP.cloneNode(true),pn.firstChild);\r\n//    },\r\n    update_posts_remove: function(th_old,i,pnode){\r\n      pnode.removeChild(th_old.posts[i].pn.nextSibling);\r\n      pnode.removeChild(th_old.posts[i].pn);\r\n    },\r\n    update_posts_insert: function(src,dst,i,j,pnode){\r\n      var last;\r\n      var ref = (j<dst.length)? dst[j].pn : (last = dst[dst.length-1].pn.nextSibling, last  && last.nextSibling);\r\n//      var ref = (j==1)? (dst[0].pn.nextSibling || null) :\r\n//                (j<dst.length)? (dst[j].pn.nextSibling && dst[j].pn.nextSibling.nextSibling || null) : null;\r\n      if (!src[i].pn) src[i].pn = this.post_json2html(src[i],src[i].board);\r\n      pnode.insertBefore(src[i].pn, ref);\r\n      pnode.insertBefore(document.createElement('br'),ref);\r\n    },\r\n\r\n    catalog_json2html3_thumbnail: function(obj, board) {\r\n      return (obj.ext==='.jpg' || obj.ext==='.png' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.webm' || obj.ext==='.mp4')?\r\n        this.protocol + '//' + ((obj.tim.length!=64)? this.domain_url + board + 'thumb/' + obj.tim + (obj.ext==='.gif'? '.gif' : '.jpg')\r\n                                                    : this.domain_url_image + '/file_store/thumb/' + obj.tim + (obj.ext==='.gif'? '.gif' : obj.ext==='.png'? '.png' : obj.ext==='.jpeg'? '.jpeg' : '.jpg'))\r\n      : (obj.embed)? (obj.embed.slice(0,2)=='//'?'https:':'') + obj.embed.replace(/.*src=\"/,'').replace(/\".*/,'')\r\n      : (obj.ext==='.swf')? '/static/file.png' :\r\n//             (obj.ext===undefined)? site2['8chan'].protocol + site2['8chan'].domain_url + '/static/no-file.png' :\r\n////             (obj.ext===undefined)? 'https://' + site2['8chan'].domain_url + '/static/assets' + board + 'no-file.png' :\r\n             '';\r\n//      return ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://' + site2['8chan'].domain_url + board + 'thumb/' + obj.tim + obj.ext : '');\r\n    },\r\n    short_link:function(){return '';},\r\n    favicon: {\r\n      __proto__: site2['DEFAULT'].favicon,\r\n      none: '/favicon.ico',\r\n      reply: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAQElEQVR42mNgGEbg/5n/GJgYORQFDQ0IjK4BmxxWzehsQnJYBdFtxCWH1QBcrkKWw2sAWS6gKAwojgWqpIORDQBVkjfW5KYpFQAAAABJRU5ErkJggg==',\r\n      reply_to_me: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAWUlEQVR42mNgAIH/Z/4zNDRgYpA4UQBqADIYZAaAaHRMtAEwjB42cEPQFaCzCclhFcQWK9jk0A1A8QJW2xgYiDeAJBdQFAbYAhLdRryxgByVuOKaYDoY2QAAcHCIXLRHYMUAAAAASUVORK5CYII='\r\n    },\r\n    proto : 'vichan'\r\n  };\r\n  site2['8chan_live'] = {\r\n    parse_funcs : {\r\n      'thread_html'  : {\r\n        posts: function(th){return this.posts_array(th, th.pn.querySelectorAll(':scope>.post.reply'));},\r\n        proto: '8chan.thread_html'\r\n      }\r\n    },\r\n    proto : '8chan'\r\n  };\r\n}\r\nif (pref.features.domains['8chan'] || pref.features.domains['lain'] || pref.features.domains['lainjp']) {\r\n  site2['vichan'] = {\r\n    components: {\r\n      boardlist: '.boardlist',\r\n      postform_comment: ['textarea[name=\"body\"]',0],\r\n      postform_comment2: ['textarea[name=\"body\"]',1],\r\n      postform_submit: ['input[name=\"post\"]',0],\r\n      postform_submit2: ['input[name=\"post\"]',1],\r\n    },\r\n////    postform_prep: function(){\r\n////      site.components.postform_submit2 = null;\r\n////      site.components.postform_submit2_observer = new MutationObserver(this.postform_submit2_find);\r\n////      site.components.postform_submit2_observer.observe(document.getElementsByTagName('body')[0], {childList: true});\r\n////    },\r\n////    postform_submit2_find: function(){\r\n////      var postform_qr = document.querySelectorAll('input[name=post]')[1]; // quick reply\r\n////      if (!site.components.postform_submit2 && postform_qr) {\r\n////        site.components.postform_submit2 = postform_qr;\r\n//////        site.components.postform_submit2_observer.disconnect();\r\n//////        delete site.components.postform_submit2_observer;\r\n////        if (common_obj.thread_reader) common_obj.thread_reader.add_event_to_submit(site.components.postform_submit2);\r\n////      } else if (site.components.postform_submit2 && !postform_qr) {\r\n////        if (common_obj.thread_reader) common_obj.thread_reader.remove_event_from_submit(site.components.postform_submit2);\r\n////        site.components.postform_submit2 = null;\r\n////      }\r\n////      site.components.query_set('postform_comment2');\r\n////      recovery.setup2();\r\n////    },\r\n    general_event_handler:(function(){\r\n      var obj = {\r\n        thread: {\r\n          get_mark: function(pn, clientY){\r\n            while (pn && pn!== cataLog.parent) {\r\n              if (pn.tagName==='BR' || !pn.classList) {pn = pn.previousSibling || pn.parentNode; continue;}\r\n              if (pn.classList.contains('post')) return pn;\r\n              if (pn.classList.contains('postcontainer')) return pn.getElementsByClassName('post')[0];\r\n              if (pn.parentNode && pn.parentNode.id && pn.parentNode.id.search(/^thread/)!=-1) {\r\n                pn = pn.previousSibling;\r\n                if (pn) continue;\r\n                else break;\r\n              }\r\n              if (pn.id && pn.id.search(/^thread/)!=-1) break;\r\n              pn = pn.parentNode;\r\n            }\r\n            return this.get_mark_from_height(clientY);\r\n          },\r\n          get_mark_from_height: function(now_height){\r\n            return this.__proto__.get_mark_from_height(now_height, document.getElementsByClassName('post'));\r\n          },\r\n          image_hover_check_mode: function(img){\r\n            return img.parentNode.parentNode.classList.contains('file')? 'page' : 'catalog';\r\n          },\r\n          getID: function(pn){return pn.classList.contains('poster_id') && pn.textContent;},\r\n          __proto__: site2['DEFAULT'].general_event_handler.common,\r\n        },\r\n      };\r\n      obj.page = {\r\n        add_mouseover: pref.test_mode['68'], // true,\r\n        mouseover: function(e){\r\n          var et = e.target;\r\n          var et_tagName = et.tagName;\r\n          if (et_tagName==='A')\r\n            if (pref[cataLog.embed_mode].popup_truncated && et.parentNode.className==='toolong') site2['DEFAULT'].popups_posts.over(e);\r\n        },\r\n        __proto__:obj.thread\r\n      },\r\n      obj.catalog = Object.create(obj.thread);\r\n//      obj.catalog = { // working code\r\n//        mouseover: function(e){\r\n//          var et = e.target;\r\n//          var et_tagName = et.tagName;\r\n//          if (et_tagName==='IMG')\r\n//            if (pref[cataLog.embed_mode].image_hover && et.parentNode.tagName==='A') cataLog.image_hover_add.call(et, e);\r\n//        },\r\n//        __proto__:obj.thread\r\n//      };\r\n      return obj;\r\n    })(),\r\n    boards_sel_from_tags : function(){\r\n      var boards = document.getElementsByClassName('board-list-tbody')[0];\r\n      var str = 'SELECTED_BOARDS,';\r\n      for (var i=0;i<boards.childNodes.length;i++)\r\n        if (boards.childNodes[i].style.display!=='none') str = str + '8chan' + boards.childNodes[i].getElementsByClassName('board-uri')[0].getElementsByTagName('a')[0].getAttribute('href') + ',';\r\n      return str+'\\n';\r\n    },\r\n//    catalog_background : '#eef2ff',\r\n//    catalog_bordercolor : '#d6daf0',\r\n    get_next_image: function(img,top){\r\n      var imgs = Array.prototype.slice.call(cataLog.parent.getElementsByClassName('post-image')).filter(function(v){return v.src.substr(-5,5)!=='.webm';});\r\n//      var imgs = cataLog.parent.getElementsByClassName('post-image');\r\n//      var imgs = cataLog.parent.querySelectorAll('img[id^=\"thumbnail\"]');\r\n      return site2['DEFAULT'].get_next_image(img,top,imgs);\r\n    },\r\n//    get_time_of_posts : function(doc){ // working code.\r\n//      var posts = doc.getElementsByClassName('post');\r\n//      return [Date.parse(posts[posts.length-1].getElementsByTagName('time')[0].getAttribute('datetime')),\r\n//              Date.parse(posts[0             ].getElementsByTagName('time')[0].getAttribute('datetime'))];\r\n//    },\r\n////////    get_thread_link : function(pn,bn,del,name){\r\n////////      var as = pn.getElementsByClassName('post op')[0].getElementsByTagName('a');\r\n////////      var hrefs = [];\r\n////////      var href;\r\n////////      for (var i=as.length-1;i>=0;i--) if (as[i].innerHTML==='[Reply]' || as[i].innerHTML==='[Last 50 Posts]') {\r\n////////        var href = as[i].getAttribute('href');\r\n////////        if (hrefs.length==0 || as[i].innerHTML==='[Reply]') hrefs.unshift(href);\r\n////////        else hrefs.push(href);\r\n////////        if (del) as[i].parentNode.removeChild(as[i]);\r\n////////        else {\r\n//////////          as[i].setAttribute('target',(pref.catalog_open_in_new_tab)? '_blank' : '_self');\r\n//////////          as[i].setAttribute('onclick','open_new_thread('+as[i].getAttribute('href')+','+name+')');\r\n////////          as[i].addEventListener('click', function(){open_new_thread(as[i].getAttribute('href'),name);}, false);\r\n//////////          as[i].removeAttribute('href');\r\n////////        }\r\n////////      }\r\n////////      return (hrefs.length!=0)? hrefs : null;\r\n////////    },\r\n    modify_thread_link : function(pn){\r\n      var as = pn.getElementsByClassName('post op');\r\n      if (as.length==0) return [];\r\n      var retval = [];\r\n      as = as[0].getElementsByTagName('a');\r\n      for (var i=as.length-1;i>=0;i--) \r\n        if (as[i].innerHTML=='[Reply]' || as[i].innerHTML=='[Last 50 Posts]') {\r\n          var href = as[i].getAttribute('href');\r\n          if (href) {\r\n            retval.push([as[i],href]);\r\n//            as[i].addEventListener('click', make_open_new_thread_callback(href,name), false);\r\n//            as[i].addEventListener('click', function(){open_new_thread(href,name);}, false);\r\n            as[i].removeAttribute('href');\r\n          }\r\n        }\r\n      return retval;\r\n    },\r\n//    add_thread_link : function(doc,url){\r\n//      var pn = document.createElement('a');\r\n//      pn.href = url.replace(new RegExp('/https*:\\/\\/'+site2['8chan'].domain_url+'/'),'');\r\n//      pn.innerHTML = '[Reply]';\r\n//      var th = doc.getElementsByClassName('post op')[0];\r\n//      if (th) th.insertBefore(pn,th.firstChild);\r\n//    },\r\n    catalog_threads_in_page : function(doc){ // patch\r\n      var doc_obj = {domain:site.nickname, pn:doc};\r\n      var ths = this.parse_funcs['page_html'].ths(doc_obj);\r\n      for (var i=0;i<ths.length;i++) ths[i] = ths[i].pn;\r\n      return ths;\r\n    },\r\n//    catalog_threads_in_page : function(doc){return this.parse_funcs['page_html'].ths(doc);},\r\n//    catalog_threads_in_page : function(doc){\r\n//      var pc = doc.getElementsByName('postcontrols');\r\n//      th = [];\r\n//      if (pc.length!=0)\r\n//        for (var i=0;i<pc[0].childNodes.length;i++)\r\n//          if (pc[0].childNodes[i].id && pc[0].childNodes[i].id.substr(0,6)=='thread') th.push(pc[0].childNodes[i]);\r\n//      return th;\r\n//    },\r\n    remove_posts : function(th,end){\r\n      site2.common.remove_by_classname(th,'post reply',end,true);\r\n//      site2.common.remove_double_br(th);\r\n    },\r\n    remove_files_info : function(th){\r\n      site2.common.remove_by_classname(th,'fileinfo');\r\n      site2.common.move_up_and_delete_parent(th.getElementsByClassName('post-image'));\r\n    },\r\n//    site.catalog_files_info = function(doc){return doc.getElementsByClassName('fileinfo');};\r\n//    site.catalog_delete_checkboxs = function(doc){return doc.getElementsByClassName('delete');};\r\n//    remove_checkboxes : function(doc){\r\n//      var cbxs = doc.getElementsByClassName('delete');\r\n//      for (var i=cbxs.length-1;i>=0;i--) cbxs[i].outerHTML = '';\r\n//      return doc;\r\n//    },\r\n    postform_rules : null,\r\n    thread_keyword : 'res',\r\n    max_page : function(){return 15;},\r\n    make_url4 : function(dbt){\r\n      var url_prefix = this.protocol + '//' + this.domain_url + dbt[1];\r\n//      if (dbt[3]==='page_json') dbt[3] = 'page_html'; // TEMPORAL PATCH\r\n      if      (dbt[3]==='page_html')    return [url_prefix + ((dbt[2]!=0)? (parseInt(dbt[2],10)+1) :'index')+'.html', 'html'];\r\n      else if (dbt[3]==='page_json')    return [url_prefix +                parseInt(dbt[2],10)             +'.json', 'json'];\r\n      else if (dbt[3]==='catalog_json') return [url_prefix + 'catalog.json', 'json'];  // Doesn't contain information about webm thumbnail.\r\n      else if (dbt[3]==='catalog_html') return [url_prefix + 'catalog.html', 'html'];\r\n      else if (dbt[3]==='thread_html')  return [url_prefix + 'res/' + dbt[2] + '.html', 'html'];\r\n      else if (dbt[3]==='thread_json')  return [url_prefix + 'res/' + dbt[2] + '.json', 'json'];\r\n    },\r\n////////    make_url : function(board,no,key){ // working code.\r\n////////      var url_prefix = site2['8chan'].protocol + '//' + site2['8chan'].domain_url + board;\r\n////////      if (key==='p') return [url_prefix + ((no!=0)? (no+1) :'index')+'.html', 'html'];\r\n////////      else if (key==='j') return [url_prefix + 'catalog.json', 'json'];  // Doesn't contain information about webm thumbnail.\r\n////////      else return [url_prefix + 'catalog.html', 'html'];\r\n////////    },\r\n//////////    make_url3: function(board,th){return site2['8chan'].protocol + '//' + site2['8chan'].domain_url + board + 'res/' + th + '.html';},\r\n////////    make_url3: function(board,th){return site2['8chan'].protocol + '//' + site2['8chan'].domain_url + board + 'res/' + ((th[0]!=='t')? (th + '.html') : (th.substr(1) + '.json'));},\r\n//////////    make_url3: function(board,th){\r\n//////////      return [site2['8chan'].protocol + '//' + site2['8chan'].domain_url + board + 'res/' + ((th[0]!=='t')? (th + '.html') : (th.substr(1) + '.json')), (th[0]!=='t')? 'html' : 'json'];\r\n//////////    },\r\n    url_boards_json : function(){return [site2['8chan'].protocol + '//' + site2['8chan'].domain_url + '/boards.json','json'];},\r\n//    enumerate_boards_to_scan:function(){\r\n//      var obj = [];\r\n//      var end = (site3[site.nickname].boards.length > pref.scan.max)? pref.scan.max : site3[site.nickname].boards.length;\r\n//      for (var i=0;i<end;i++) \r\n//        if (site3[site.nickname].boards[i].max) obj[obj.length] = '/'+site3[site.nickname].boards[i].uri+'/';\r\n//      return obj;\r\n//    },\r\n    get_ops : function(doc){\r\n      var op_containers = doc.getElementsByClassName('post op');\r\n      var ops = [];\r\n//      for (var i=0;i<op_containers.length;i++) ops.push(op_containers[i].getElementsByTagName('input')[0].id.substring(7));\r\n      for (var i=0;i<op_containers.length;i++) ops.push(parseInt(op_containers[i].id.substring(3),10));\r\n      return ops;\r\n    },\r\n    get_posts : function(doc) {\r\n      var posts = [];\r\n//      var deletes = doc.getElementsByClassName('delete');\r\n//      for (var i=0;i<deletes.length;i++) posts.push(deletes[i].id.substr(7));\r\n      var nos = doc.getElementsByClassName('post_no');\r\n      for (var i=0;i<nos.length;i++) if (nos[i].id) posts.push(parseInt(nos[i].id.substr(8),10));\r\n      return posts;\r\n    },\r\n////////    insert_footer : function(th,page_no,bn,exe,date,nof_posts,nof_files){\r\n////////      var key = (!brwsr.ff)? 'innerText' : 'innerHTML';\r\n////////      nof_posts += th.getElementsByClassName('post').length;\r\n////////      nof_files += th.getElementsByClassName('fileinfo').length;\r\n////////      var om_info = th.getElementsByClassName('omitted');\r\n////////      if (om_info[0]) {\r\n////////        var str = om_info[0][key].replace(/\\n/g,'');\r\n////////        nof_posts += parseInt(str.replace(/\\ post.*/,''),10);\r\n////////        nof_files += parseInt('0'+str.replace(/\\ image.*/,'').replace(/[^\\ ]*\\ /g,''),10);\r\n////////      }\r\n////////      if (exe) {\r\n////////        var pn = document.createElement('div');\r\n////////        pn.setAttribute('name','catalog_footer');\r\n////////        if (pref.catalog_footer_br) pn.setAttribute('style','clear:both');\r\n////////        pn.innerHTML = '<span>' + bn + '  ' + nof_posts + '/' + nof_files + '/' + page_no + '  </span>';\r\n//////////        pn.innerHTML = '<span><span>' + bn + '  </span><span></span><span>' + nof_posts + '/' + nof_files + '/' + page_no + '  </span></span>';\r\n////////        var flags = th.getElementsByClassName('flag');\r\n////////        for (var i=0;i<flags.length;i++) {\r\n////////          pn.appendChild(flags[i].cloneNode(false));\r\n//////////          pn.appendChild(document.createTextNode(' '));\r\n////////        }\r\n////////        th.insertBefore(pn,th.getElementsByClassName('post op')[0]);\r\n////////      }\r\n////////      return [nof_posts,nof_files];\r\n////////    },\r\n////////    insert_footer2 : function(th,type,nums,nums2){\r\n////////      var str_add = ((pref.catalog_footer_show_nof_rep_to_me)? nums[1]+'/' : '' ) +(nums2[2]-nums[2]);\r\n////////      if (type==='page') {\r\n////////        var footer = th.getElementsByTagName('div')['catalog_footer'];\r\n//////////        footer.childNodes[0].childNodes[1].innerHTML = nums[1] + '/' + (nums2[2]-nums[2]) + '/';\r\n//////////        footer.childNodes[0].innerHTML = footer.childNodes[0].innerHTML.replace(/  /,'  '+ nums[1] + '/' + (nums2[2]-nums[2]) + '/');\r\n////////        var str = footer.childNodes[0].innerHTML;\r\n////////        var fields = str.replace(/[^ ]*  /,'').split('/');\r\n////////        if (fields.length>3) fields.splice(0,fields.length-3);\r\n////////        footer.childNodes[0].innerHTML = str.replace(/  .*/,'  ') + ((nums[0]>=0)? str_add + '/' :'') + fields.join('/');\r\n////////      } else {\r\n////////        var footer = th.getElementsByTagName('strong')[0];\r\n////////        footer.childNodes[0].innerHTML = (nums[0]>=0)? 'U: '+ str_add + ' / ' : '';\r\n////////      } \r\n////////    },\r\n//    prep_footer3 : function(footer,board){\r\n////      th.footer.setAttribute('name',pref.script_prefix+'_footer');\r\n//      if (pref.catalog_footer_show_board_name) {\r\n////        footer.innerHTML = '<span name=\"'+pref.script_prefix+'_footer\">' + footer.innerHTML +'</span>' + '&emsp;' + board;\r\n//        footer.innerHTML = '<span>' + footer.innerHTML + '</span>' + '&emsp;' + board;\r\n//        footer = footer.childNodes[0];\r\n//      }\r\n//      return footer;\r\n//    },\r\n//    insert_footer3 : function(footer,nums,nums2){\r\n//      var str_add = ((pref.catalog_footer_show_nof_rep_to_me)? nums[1]+'/' : '' ) +(nums2[2]-nums[2]);\r\n//      var str = (pref.catalog_footer_design==='native')? ((nums[0]>=0)? 'U: '+ str_add + ' / ' : '') + 'R: '+(nums2[2]-1) + ' / I: '+nums2[3]\r\n//                                                       : ((nums[0]>=0)? str_add + '/' : '') + nums2[2] + '/'+nums2[3]; // trial.\r\n//      footer.innerHTML = str;\r\n//    },\r\n////////    check_reply_to_me : function(name,dbt,nums,value,date,pool){\r\n////////      var obj ;\r\n////////      var time_check = (nums[6]==nums[0])? nums[3] : nums[0];\r\n////////      if (dbt[2][0]==='t') {\r\n////////        obj = ('response' in value)? value.response.posts : JSON.parse(value.responseText).posts;\r\n////////        var images = 0;\r\n////////        for (var i=0;i<obj.length;i++) {\r\n////////          if ('filename' in obj[i]) images++;\r\n////////          if (obj[i].extra_files) for (var j=0;j<obj[i].extra_files.length;j++) if ('filename' in obj[i].extra_files[j]) images++;\r\n////////          obj[i].time *= 1000;\r\n//////////obj[i].time += - pref.localtime_offset*3600000; // BUG PATCH.\r\n////////          if (obj[i].ext==='.jpeg' || obj[i].ext==='.gif') obj[i].ext = '.jpg';\r\n////////          if (obj[i].filename) obj[i].icon =  'https://' + site2['8chan'].domain_url + dbt[1] + 'thumb/' + obj[i].tim + obj[i].ext;\r\n////////        }\r\n////////        obj[0].images = images;\r\n//////////        if (obj[obj.length-1].ext==='.jpeg' || obj[obj.length-1].ext==='.gif') obj[obj.length-1].ext = '.jpg';\r\n//////////        if (obj[obj.length-1].filename) obj[obj.length-1].icon =  'https://' + site2['8chan'].domain_url + dbt[1] + 'thumb/' + obj[obj.length-1].tim + obj[obj.length-1].ext;\r\n////////        pool.sticky = obj[0].sticky;\r\n////////      } else obj = site2['8chan'].get_posts2(value,pool,time_check);\r\n//////////      date = [obj[obj.length-1].time, date[1], obj.length, obj[0].images];\r\n//////////      date[0] = obj[obj.length-1].time; // CAUSE BUG IN PAGE, THIS PREVENT REVISING POST'S INFO FOR POPUPS. AND MUST BE FIXED TIMEZONE MISUNDERSTOOD.\r\n//////////if (date[4] != obj[obj.length-1].time) console.log('find: '+name+', '+date[4]+' -> '+obj[obj.length-1].time+', '+(obj[obj.length-1].time-date[4]));\r\n////////      date[4] = obj[obj.length-1].time;\r\n//////////                            IF UNCOMMENT, CAUSE BLINKS BECAUSE USING DIFFERENT METHOD TO EVALUATE,\r\n//////////                            IF COMMENT, DELAYS UPDATE AND CAUSE BUG IN PAGE MODE.\r\n//////////      date[2] = obj.length; // CAUSE BUG IN PAGE, THIS CAUSE INCONSISTENCY BETWEEN FOOTER AND POPUP COMMENTS.\r\n//////////      date[3] = obj[0].images; // CAUSE BUG IN PAGE, THIS CAUSE INCONSISTENCY BETWEEN FOOTER AND POPUP COMMENTS.\r\n////////\r\n//////////      var i = 0;\r\n//////////      while (i<obj.length && (!obj[i] || obj[i].time<=time_check)) i++;\r\n////////      var i = obj.length;\r\n////////      while (i-1>=0 && obj[i-1] && obj[i-1].time>time_check) i--;\r\n//////////console.log(name+', '+obj.length+', '+(obj.length-i));\r\n//////////      nums[2] = i;\r\n////////      var rep_to_me = (nums[6]==nums[0])? nums[1] : 0;\r\n////////      var rep       = (nums[6]==nums[0])? nums[7] : 0;\r\n////////      nums[4] = [];\r\n////////      if (nums[3]<nums[0]) nums[3]=nums[0];\r\n////////      if (i<obj.length ) {\r\n////////        while (i<obj.length) {\r\n////////          if (pref.catalog_footer_ignore_my_own_posts && (dbt[1]+obj[i].no in site3['8chan'].own_posts)) {i++;continue;}\r\n////////          rep++;\r\n//////////          if (obj[i].time>nums[3]) nums[4].push({icon:obj[obj.length-1].icon, body:obj[obj.length-1].com, time:obj[obj.length-1].time, to_me:false});\r\n////////          if (obj[i].time>nums[3]) nums[4].push({icon:obj[i].icon, body:obj[i].com, time:obj[i].time, to_me:false});\r\n////////          var tgts = [];\r\n////////          if (obj[i].com) {\r\n////////            var anchors = obj[i].com.match(/&gt;&gt;[0-9]+/g);\r\n////////            if (anchors) for (var j=0;j<anchors.length;j++) tgts.push(dbt[1]+anchors[j].substr(8));\r\n////////            anchors = obj[i].com.match(/&gt;&gt;&gt;\\/[0-9A-z_\\+]+\\/[0-9]+/g);\r\n////////            if (anchors) for (var j=0;j<anchors.length;j++) tgts.push(anchors[j].substr(12));\r\n//////////console.log(tgts);\r\n////////            for (var j=0;j<tgts.length;j++) {\r\n////////              if (site3['8chan'].own_posts[tgts[j]]===null) {\r\n////////                rep_to_me++;\r\n////////                if (obj[i].time>nums[3]) nums[4][nums[4].length-1].to_me = true;\r\n//////////console.log(dbt[2]+', >>'+tgts[j]);\r\n////////                break;\r\n////////          }}}\r\n//////////          var anchors = (obj[i].com)? obj[i].com.match(/&gt;&gt;[0-9]+/g) : null; // working code.\r\n//////////          if (anchors) {\r\n//////////            for (var j=0;j<anchors.length;j++) {\r\n//////////              var tgt = anchors[j].substr(8);\r\n//////////              if (site3['8chan'].own_posts[dbt[1]+tgt]===null) {\r\n//////////                rep_to_me++;\r\n//////////                if (obj[i].time>nums[3]) nums[4][nums[4].length-1].to_me = true;\r\n////////////console.log(dbt[2]+', >>'+tgt);\r\n//////////                break;\r\n//////////          }}}\r\n//////////          anchors = (obj[i].com)? obj[i].com.match(/&gt;&gt;&gt;\\/[0-9A-z_\\+]+\\/[0-9]+/g) : null;\r\n//////////          if (anchors) {\r\n//////////            for (var j=0;j<anchors.length;j++) {\r\n//////////              var tgt = anchors[j].substr(12);\r\n//////////              if (site3['8chan'].own_posts[tgt]===null) {\r\n//////////                rep_to_me++;\r\n//////////                if (obj[i].time>nums[3]) nums[4][nums[4].length-1].to_me = true;\r\n//////////                break;\r\n//////////          }}} \r\n////////          i++;\r\n////////        }\r\n////////      }\r\n////////      nums[2] = obj.length - rep;\r\n////////      nums[1] = rep_to_me;\r\n////////      nums[3] = obj[obj.length-1].time;\r\n////////      nums[6] = nums[0];\r\n////////      nums[7] = rep;\r\n////////    },\r\n////////    get_posts2 : function(doc,pool,time_check) {\r\n////////      var obj = [];\r\n////////      var posts = doc.getElementsByClassName('post');\r\n//////////      for (var i=0;i<posts.length;i++) {\r\n////////      var i=posts.length-1;\r\n////////      while (i>=0) {\r\n////////        var image = posts[i].getElementsByClassName('post-image');\r\n////////        image = (image[0])? image[0].getAttribute('src') : undefined;\r\n////////        var time = Date.parse(posts[i].getElementsByTagName('time')[0].getAttribute('datetime'));\r\n////////        obj[i] = {\r\n////////          time: time,\r\n////////          com:  posts[i].getElementsByClassName('body')[0].innerHTML,\r\n////////          no:   parseInt(posts[i].getElementsByClassName('post_no')[0].id.substr(8),10),\r\n////////          icon: image\r\n////////        }\r\n////////        if (time<=time_check && i!=0) i=0;\r\n////////        else i--;\r\n////////      }\r\n//////////      var image = posts[posts.length-1].getElementsByClassName('post-image');\r\n//////////      obj[obj.length-1].icon = (image[0])? image[0].src : undefined;\r\n////////      var files = doc.getElementsByClassName('thread')[0].getElementsByClassName('file');\r\n//////////      for (var i=files.length-1;i>=0;i--) if (files[i].tagName!=='DIV') files[i].remove(); // slow?\r\n////////      var nof_files = 0;\r\n////////      for (var i=files.length-1;i>=0;i--) if (files[i].tagName==='DIV') nof_files++;\r\n////////      var op_images = doc.getElementsByClassName('thread')[0].getElementsByClassName('files');\r\n////////      op_images = (!op_images[0])? 0 : op_images[0].getElementsByClassName('file').length;\r\n//////////      obj[0].images = files.length - op_images;\r\n////////      obj[0].images = nof_files - op_images;\r\n////////      pool.sticky = doc.getElementsByClassName('fa-thumb-tack').length!=0\r\n////////      return obj;\r\n////////    },\r\n    get_post_offsetTop : function(doc,num) {\r\n      return doc.getElementsByClassName('post')[num].offsetTop;\r\n    },\r\n    get_icon : function(pn,type,kind,tgt_th16){\r\n//      return (type==='catalog')? this.add_icon(pn,type,kind,tgt_th16) :\r\n      return (kind==='sticky')? pn.getElementsByClassName('fa-thumb-tack')[0] : null;\r\n    },\r\n    add_icon : function(pn,type,kind,tgt_th16){\r\n//      if (pn) {\r\n//        var del_tgt = tgt_th16['icon_'+kind];\r\n//        if (!del_tgt) {\r\n//          var count = 0;\r\n//          if (tgt_th16['icon_sticky']) count++;\r\n//          if (tgt_th16['icon_show_always']) count++;\r\n          var icon = (kind==='sticky')? this.make_tack() : this.make_showAlways();\r\n          var ref;\r\n          if (type==='catalog' || type==='headline') {\r\n            ref = pn.getElementsByClassName('threadIcons')[0] ||\r\n              (ref = type==='catalog'? pn.firstElementChild : pn.getElementsByClassName(pref.script_prefix+'_footer')[0].parentNode, ref.insertBefore(cnst.dom('<div class=\"threadIcons\"'+(type==='catalog'?'style=\"position:absolute\"':'')+'></div>'), ref.firstChild));\r\n//            if (!ref) {\r\n//              ref = document.createElement('div');\r\n//              ref.setAttribute('class','threadIcons');\r\n//              ref.setAttribute('style','position:absolute');\r\n//              pn.firstElementChild.insertBefore(ref,pn.firstElementChild.firstChild);\r\n//            }\r\n            ref.appendChild(icon);\r\n//            icon.setAttribute('style','position:absolute;left:' + (16*count) + 'px');\r\n//            ref = pn.getElementsByClassName('thread')[0];\r\n//            ref.insertBefore(icon,ref.firstChild);\r\n          } else {\r\n            var op = pn.getElementsByClassName('op')[0];\r\n            ref = op.getElementsByClassName('mentioned')[0] || op.getElementsByClassName('post_no')[1].nextSibling;\r\n//            ref = pn.getElementsByClassName('mentioned')[0] || Array.prototype.filter.call(pn.getElementsByTagName('a'),function(dom){return dom.textContent==='[Reply]';})[0];\r\n            ref.parentNode.insertBefore(icon,ref);\r\n          }\r\n          return icon;\r\n//        } else del_tgt.parentNode.removeChild(del_tgt);\r\n//      }\r\n//      return null;\r\n    },\r\n//    add_icon : function(th,type,kind,tgt_th16){\r\n//      if (type==='catalog') {\r\n//        var parent = th.getElementsByClassName('thread')[0];\r\n//        if (parent) {\r\n//          var del_tgt = tgt_th16['icon_'+kind];\r\n//          if (!del_tgt) {\r\n//            var count = 0;\r\n//            if (tgt_th16['icon_sticky']) count++;\r\n//            if (tgt_th16['icon_show_always']) count++;\r\n//            var icon = document.createElement('i');\r\n//            icon.setAttribute('class',(kind==='sticky')? 'fa fa-thumb-tack' : 'fa');\r\n//            icon.setAttribute('style','position:absolute;left:' + (16*count) + 'px');\r\n//            if (kind==='show_always') icon.textContent = '\\u2605';\r\n//            parent.insertBefore(icon,parent.firstChild);\r\n//            return icon;\r\n//          } else del_tgt.parentNode.removeChild(del_tgt);\r\n//        }\r\n//      }\r\n//      return null;\r\n//    },\r\n    favicon: {\r\n      __proto__: site2['DEFAULT'].favicon,\r\n      none: '/favicon.ico',\r\n      reply: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAQElEQVR42mNgGEbg/5n/GJgYORQFDQ0IjK4BmxxWzehsQnJYBdFtxCWH1QBcrkKWw2sAWS6gKAwojgWqpIORDQBVkjfW5KYpFQAAAABJRU5ErkJggg==',\r\n      reply_to_me: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAWUlEQVR42mNgAIH/Z/4zNDRgYpA4UQBqADIYZAaAaHRMtAEwjB42cEPQFaCzCclhFcQWK9jk0A1A8QJW2xgYiDeAJBdQFAbYAhLdRryxgByVuOKaYDoY2QAAcHCIXLRHYMUAAAAASUVORK5CYII='\r\n    },\r\n//    get_op_image_url: function(th,type){\r\n//      var img = th.getElementsByTagName('img')[0];\r\n//      return (img)? img.src : undefined; // patch.\r\n//    },\r\n    time_revised_check: function(nof_ths){return nof_ths>300;},\r\n    format_thread_layout : function(th){\r\n      site2.common.add_attribute_by_tagname(th,'img','style','margin:0px');\r\n      site2.common.add_attribute_by_tagname(th,'iframe','style','margin:0px');\r\n      site2.common.add_attribute_by_classname(th,'post','style','padding:0px');\r\n      site2.common.add_attribute_by_classname(th,'intro','style','margin:0px');\r\n      site2.common.add_attribute_by_classname(th,'body','style','margin:12px 5px');\r\n    },\r\n    format_thread_contents : function(th){\r\n      site2.common.remove_by_classname(th,'delete');\r\n//      site2.common.remove_by_tagname(th,'hr');\r\n//      site2.common.remove_by_tagname(th,'br');\r\n      site2.common.remove_by_classname(th,'omitted');\r\n    },\r\n    localtime: function(pn){\r\n      var times = pn.getElementsByTagName('time');\r\n      for (var i=0;i<times.length;i++) times[i].textContent = site2.common.change_utc_to_local(times[i].getAttribute('datetime'));\r\n    },\r\n    format_remove_tn_area_size: function(th){\r\n      var files = th.getElementsByClassName('file');\r\n      for (var i=0;i<files.length;i++){\r\n        var file_style = files[i].getAttribute('style');\r\n        if (file_style) {\r\n          file_style = ((file_style)? file_style + ';' : '') + 'float:left;';\r\n          if (file_style.indexOf('width')!=-1) file_style = file_style.replace(/width:[^;]*(;|$)/,'');\r\n          if (file_style.indexOf('height')!=-1) file_style = file_style.replace(/height:[^;]*(;|$)/,'');\r\n          files[i].setAttribute('style',file_style);\r\n        }\r\n      }\r\n    },\r\n//    get_time_of_post_in_utc : function(post){ // working code\r\n//      return Date.parse(post.getElementsByTagName('time')[0].getAttribute('datetime'));\r\n//    },\r\n//    mark_newer_posts: function(th,date,unmark, short_cut) {\r\n////      return site2.common.mark_newer_posts('8chan',th.getElementsByClassName('post'),date,'border:2px solid red','border: none','class','post');\r\n//      return site2['DEFAULT'].mark_newer_posts('8chan',th.getElementsByClassName('post'),date,null,unmark, short_cut);\r\n//    },\r\n////    unmark_post_from_event: function() {\r\n////      this.setAttribute('style','border: none');\r\n////      this.removeEventListener('mouseover', site2['8chan'].unmark_post_from_event, false);\r\n////    },\r\n////    mark_newer_posts : function(th,date){\r\n////      var marked_first_post = null;\r\n//////      var offset_top = 0;\r\n////      var times = th.getElementsByTagName('time');\r\n////      for (var i=times.length-1;i>=0;i--) {\r\n////        var mark = date<Date.parse(times[i].getAttribute('datetime'))-pref.localtime_offset*3600000;\r\n////        var reply = times[i].parentNode;\r\n////        while (reply.className.search(/post/)==-1) reply = reply.parentNode;\r\n////        if (mark) {\r\n////          reply.setAttribute('style','border: 2px solid red');\r\n////          marked_first_post = reply;\r\n//////          offset_top = reply.offsetTop;\r\n////        } else reply.setAttribute('style','border: none');\r\n////      }\r\n//////      return offset_top;\r\n////      return marked_first_post;\r\n////    },\r\n    get_owners_recommendation: function(){\r\n      var blotter = document.getElementsByClassName('blotter')[0];\r\n      if (blotter) {\r\n        or_str = document.getElementsByClassName('blotter')[0][brwsr.innerText];\r\n        var kwd = 'Recommendation: ';\r\n        var idx = or_str.indexOf(kwd);\r\n        if (idx!=-1) return or_str.substr(idx+kwd.length);\r\n      }\r\n      return '';\r\n    },\r\n////////    thread2headline : function(doc){\r\n////////      return site2.common.thread2headline(doc,'8chan');\r\n////////    },\r\n//    get_json_url_thread: function(board,thread){\r\n//      return site2['8chan'].protocol + '//8chan.co' + board +'res/' + thread + '.json';\r\n//    },\r\n    get_json_url_catalog: function(board){\r\n      return site2['8chan'].protocol + '//' + site2['8chan'].domain_url + board +'catalog.json';\r\n    },\r\n    thread2search_obj: function(th){\r\n      var coms  = aggregate_info(th.getElementsByClassName('body'));\r\n      var subs  = aggregate_info(th.getElementsByClassName('subject'));\r\n      var names = aggregate_info(th.getElementsByClassName('name'));\r\n\r\n      var files = th.getElementsByClassName('files');\r\n      var filenames = ['',''];\r\n      if (files.length!=0) {\r\n        for (var i=0;i<files.length;i++) {\r\n          var files_in_post = files[i].getElementsByClassName('unimportant');\r\n          filenames[i] = '';\r\n          for (var j=0;j<files_in_post.length;j++) {\r\n            if (files_in_post[j].getElementsByTagName('a').length!=0) filenames[i] = filenames[i] + files_in_post[j].getElementsByTagName('a')[0][brwsr.innerText] + '\\n';\r\n            if (files_in_post[j].getElementsByTagName('span').length!=0) filenames[i] = filenames[i] + files_in_post[j].getElementsByTagName('span')[0][brwsr.innerText] + '\\n';\r\n          }\r\n        }\r\n        for (var i=2;i<filenames.length;i++) filenames[1] = filenames[1] + filenames[i] + '\\n';\r\n        if (files[0].parentNode!=th) {\r\n          filenames[1] = filenames[0] + '\\n' + filenames[1];\r\n          filenames[0] = '';\r\n        }\r\n      }\r\n      return [coms[0], subs[0], names[0], filenames[0], coms[1], subs[1], names[1], filenames[1]];\r\n\r\n      function aggregate_info(pns){\r\n        if (pns.length!=0) {\r\n          var parent = pns[0].parentNode;\r\n          while (parent.classList.contains('post')) parent = parent.parentNode;\r\n          var op_idx = (!parent.classList.contains('op'))? 0 : -1;\r\n          var op = (op_idx>=0)? pns[0][brwsr.innerText] : '';\r\n          var posts = '';\r\n          for (var i=op_idx+1;i<pns.length;i++) posts = posts + pns[i][brwsr.innerText] + '\\n';\r\n          return [op, posts];\r\n        } return ['',''];\r\n      }\r\n    },\r\n    parse_json_thread: function(txt,from_http){\r\n      var obj = {posts: []};\r\n      var uids = {};\r\n      var nof_uids = 0;\r\n      var posts = document.getElementsByClassName('post');\r\n      for (var i=0;i<posts.length;i++) {\r\n        obj.posts[i] = {};\r\n        obj.posts[i].no = posts[i].id.replace(/op_/,'').replace(/reply_/,'');\r\n        var id = posts[i].getElementsByClassName('poster_id')[0].textContent;\r\n        obj.posts[i].id = id;\r\n        if (uids[id]===undefined) {\r\n          nof_uids++;\r\n          uids[id] = 1;\r\n        }\r\n        obj.posts[i].unique_ips = nof_uids;\r\n      }\r\n      return obj;\r\n    },\r\n    uip_check: function(callback){\r\n      callback(0,200,'');\r\n    },\r\n    uip_tgt_post : function(no){\r\n      var pn = document.getElementById('reply_'+no);\r\n      if (pn) return pn;\r\n      else return document.getElementById('op_'+no);\r\n    },\r\n    uip_post_num : function(tgt_post){\r\n      return tgt_post.getElementsByClassName('intro');\r\n    },\r\n//    catalog_native_prep0: function(threads,callback,pn_filter,pn_tb,func_sel){\r\n////      var node_ref = document.getElementsByClassName('catalog_search')[0].nextSibling;  // FF doesn't work.\r\n//      var node_ref = document.getElementsByClassName('threads')[0];\r\n//      node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n//      node_ref.parentNode.insertBefore(pn_filter,node_ref);\r\n//\r\n//      site2['8chan'].catalog_from_native(Date.now(),document,threads,null);\r\n//\r\n//      document.getElementById('sort_by').addEventListener('change',func_event,false);\r\n//      return function(){document.getElementById('sort_by').removeEventListener('change',func_event,false);};\r\n//      function func_event(){\r\n//        pref.catalog.indexing = document.getElementById('sort_by').selectedIndex;\r\n//        func_sel();\r\n//      }\r\n//\r\n////      var mixs = document.getElementsByClassName('mix');\r\n////      var date_load = Date.now();\r\n////      for (var i=0;i<mixs.length;i++) site2['8chan'].catalog_from_native_1(threads,mixs[i],date_load);\r\n////      for (var i=0;i<mixs.length;i++) {\r\n////        var url  = mixs[i].getElementsByTagName('a')[0].href;\r\n////        mixs[i].getElementsByTagName('a')[0].removeAttribute('href');\r\n////        var name = url.replace(/.*8chan\\.co/,'8chan').replace(/res\\//,'').replace(/\\.html/,'');\r\n////        var date = [0,0,0,0];\r\n////        var date_load = 0;\r\n////        var page_no = 0;\r\n////        threads[name] = [mixs[i], false, null,\r\n////                         [mixs[i].innerHTML, '8chan'],\r\n////                         mixs[i][brwsr.innerText], null, null, url, date, true,\r\n////                         null,\r\n////                         null, null, date_load, page_no, 0];\r\n////      }\r\n////      http_req.get('catalog',site.nickname+site.board,site.protocol+'//8chan.co'+site.board+'catalog.json',site2['8chan'].catalog_from_json,false,false,[threads,callback,null,site.board]);\r\n//    },\r\n    catalog_native_prep: function(pn_filter,pn_tb,pn_hi){\r\n//      var node_ref = document.getElementsByClassName('catalog_search')[0].nextSibling;  // FF doesn't work.\r\n      var node_ref = (site.whereami==='catalog')? document.getElementsByClassName('threads')[0]\r\n                                                : document.getElementsByName('postcontrols')[0];\r\n      site2['DEFAULT'].catalog_native_prep_sel(pn_filter,pn_tb,site.whereami==='catalog'? document.getElementById('sort_by') : null);\r\n      if (site.whereami==='catalog') {\r\n        pn_tb.style.display='inline';\r\n        pn_tb.childNodes[3].style.display='inline';\r\n//        document.getElementById('image_size').addEventListener('change', site2['8chan'].catalog_native_size_changed, false);\r\n//        var pn_tb_new = document.createElement('span');\r\n//        while (pn_tb.firstChild) pn_tb_new.appendChild(pn_tb.firstChild);\r\n//        pn_tb = pn_tb_new;\r\n//        pn_tb.appendChild(pn_tb.removeChild(pn_tb.childNodes[3]).firstChild);\r\n      } else if (site.whereami==='page') {\r\n        var pctrls = document.getElementsByName('postcontrols')[0];\r\n        if (!pref.catalog_expand_with_hr) {for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.removeChild(pctrls.childNodes[i]);}\r\n        else for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.childNodes[i].setAttribute('class',pref.script_prefix+'_hs');\r\n        pctrls.parentNode.insertBefore(document.createElement('hr'),pctrls.nextSibling);\r\n      }\r\n//      node_ref.parentNode.insertBefore(pn_hi,node_ref);\r\n      node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n//      node_ref.parentNode.insertBefore(pn_filter,node_ref);\r\n//      pn_tb.childNodes[0].setAttribute('style',pn_tb.childNodes[0].getAttribute('style')+';display:none');\r\n//      pn_tb.childNodes[1].setAttribute('style',pn_tb.childNodes[1].getAttribute('style')+';display:none');\r\n////////      return site2['8chan'].catalog_from_native(date,document,site.board,site.whereami+'_html');\r\n    },\r\n    catalog_native_size: (document.getElementById('image_size'))? document.getElementById('image_size').value : 'small',\r\n    catalog_native_size_changed: function(){site2['8chan'].catalog_native_size = this.value;},\r\n    catalog_get_native_area: function(){\r\n      if (site.whereami==='catalog') return document.getElementById('Grid');\r\n      return document.getElementsByName('postcontrols')[0];\r\n////      else { // working code.\r\n////        var pc = document.getElementsByName('postcontrols')[0];\r\n////        return pc.insertBefore(document.createElement('div'),pc.firstChild);\r\n////      }\r\n    },\r\n////////    catalog_from_native : function(date,doc,board,type) { // working code.\r\n////////      var ths;\r\n////////if (pref.test_mode['0']) {\r\n////////      ths = {domain:'8chan', board:board, pn:doc};\r\n////////      this.parse_funcs['catalog_html'].entry(ths,this.parse_funcs['catalog_html']['full_hier']);\r\n////////      return ths.ths;\r\n////////} else {\r\n////////////      var parse_obj = {domain:'8chan', board:board, parse_funcs:site2['8chan'].parse_funcs[type], __proto__:site4.parse_funcs_on_demand};\r\n////////////      ths = {pn:doc, __proto__:parse_obj};\r\n////////////      return ths.ths;\r\n////////      return site2[this.nickname].wrap_to_parse.get(doc, this.nickname, board, type);\r\n////////}\r\n////////    },\r\n//    catalog_from_native : function(date,doc,board) {\r\n//      var ths;\r\n//if (pref.test_mode['0']) {\r\n//      ths = {domain:'8chan', board:board, pn:doc};\r\n//      this.parse_funcs['catalog_html'].entry(ths,this.parse_funcs['catalog_html']['full_hier']);\r\n//} else {\r\n////      ths = {domain:'8chan', board:board, pn:doc, parse_funcs:this.parse_funcs['catalog_html'], __proto__:site4.parse_funcs_on_demand};\r\n//      var parse_obj = {domain:'8chan', board:board, parse_funcs:site2['8chan'].parse_funcs['catalog_html'], __proto__:site4.parse_funcs_on_demand};\r\n//      ths = {pn:doc, __proto__:parse_obj};\r\n//}\r\n//      return ths.ths;\r\n//    },\r\n//    catalog_from_native : function(date,doc,board) {\r\n//      var mixs = doc.getElementsByClassName('mix');\r\n//      var ths = [];\r\n////      for (var i=0;i<mixs.length;i++) {\r\n////        ths.push(site2['8chan'].catalog_from_native_1(mixs[i]));\r\n////        if (mixs[i].parentNode) mixs[i].parentNode.removeChild(mixs[i]);\r\n////      }\r\n////var time_in = Date.now();\r\n//      for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV') ths.push(site2['8chan'].catalog_from_native_1(mixs[i],board));\r\n////console.log('aaa: '+(Date.now()-time_in));\r\n////      for (var i=0;i<ths.length;i++) if (ths[i].pn.parentNode) ths[i].pn.parentNode.removeChild(ths[i].pn);\r\n//      return ths;\r\n//    },\r\n//    catalog_from_native_1 : function(th,board) {\r\n//      th.getElementsByTagName('a')[0].removeAttribute('href');\r\n//      var sub = th.getElementsByClassName('subject');\r\n//      sub = (sub[0])? sub[0].textContent : '';\r\n//      var opn = th.getElementsByTagName('img')[0].getAttribute('data-name');\r\n//      var op = th[brwsr['innerText']].replace(th.getElementsByTagName('strong')[0][brwsr['innerText']],'');\r\n//      if (sub!=='') op = op.replace(sub,'');\r\n////      if (pref.catalog_footer_show_board_name) th.getElementsByTagName('strong')[0].innerHTML = '<span></span>' + th.getElementsByTagName('strong')[0].innerHTML + '&emsp;' + board;\r\n//      return {\r\n//        pn: th,\r\n//        exist: false,\r\n//        no: th.getElementsByTagName('img')[0].id.replace(/img\\-/,''),\r\n//        search_obj: [ op, sub, opn, '', '', '', '', ''],\r\n//        page_no: '?',\r\n//        time_bumped: (parseInt(th.getAttribute('data-bump'),10)-pref.localtime_offset*3600)*1000,\r\n//        time_created : (parseInt(th.getAttribute('data-time'),10)-pref.localtime_offset*3600)*1000,\r\n//        nof_posts: parseInt(th.getAttribute('data-reply'),10) +1,\r\n//        nof_files: parseInt(th.getElementsByClassName('replies')[0].getElementsByTagName('strong')[0].textContent.replace(/.*I: */,''),10),\r\n////        init_func: site2['8chan'].catalog_from_native_init_elem_func,\r\n//        update_func: site2['8chan'].catalog_from_native_update_elem_func,\r\n//        board: board,\r\n//        footer: th.getElementsByTagName('strong')[0], // temporal\r\n//        domain: '8chan', // temporal\r\n//        sticky: th.getAttribute('data-sticky')==='true', // temporal\r\n//      }\r\n//    },\r\n//    catalog_from_native_init_elem_func : function(th) {\r\n//      th.setAttribute('class','mix');\r\n//      th.setAttribute('style','display: inline-block;');\r\n//    },\r\n//    catalog_from_native_update_elem_func : function(th,src) {\r\n//      th.setAttribute('data-reply',src.nof_posts);\r\n//      th.setAttribute('data-bump',src.time_bumped);\r\n//      th.setAttribute('data-time',src.time_created);\r\n//    },\r\n//    catalog_from_native_1 : function(th,board) { // working code\r\n//      var th2 = {domain:'8chan', board:board, pn:th};\r\n//      this.parse_funcs['catalog_html'].entry(th2,this.parse_funcs['catalog_html']['full_th']);\r\n//      return th2;\r\n//    },\r\n    parse_funcs : { // vichan\r\n      'catalog_html' : {\r\n//        ths: function(doc) {\r\n//          var ths = this.ths_array(doc,doc.pn.getElementsByClassName('mix'));\r\n//          for (var i=0;i<ths.length;i++) ths[i].pn.getElementsByTagName('a')[0].removeAttribute('href');\r\n//          return ths;\r\n//        },\r\n        ths: function(doc) {return this.ths_array(doc,doc.pn.getElementsByClassName('mix'));},\r\n        no : function(th){return parseInt(th.pn.getElementsByTagName('img')[0].id.substr(4),10);},\r\n        time_bumped: function(th){return parseInt(th.pn.getAttribute('data-bump'),10)*1000;},\r\n        time: function(th){return parseInt(th.pn.getAttribute('data-time'),10);},\r\n        time_created: function(th){return th.time*1000;},\r\n        nof_posts: function(th){return parseInt(th.pn.getAttribute('data-reply'),10) +1;},\r\n//        nof_files: function(th){return parseInt(th.pn.getElementsByClassName('replies')[0].getElementsByTagName('strong')[0].textContent.replace(/.*I: */,''),10);},\r\n        nof_files: function(th){return parseInt(th.pn.getElementsByTagName('strong')[0].textContent.replace(/.*I: */,''),10) +1;}, // assumes OP has 1 pic.\r\n        key: function(th){\r\n//          if (!th.hasOwnProperty('no')) th['no'] = this['no'](th);\r\nif (pref.test_mode['0']) {\r\n          if (!th.hasOwnProperty('no')) Object.defineProperty(th,'no',{value:this['no'](th), enumerable:true, configurable:true, writable:true});\r\n}\r\n          return th.domain + th.board + th.no;\r\n        },\r\n        sub: 'DEFAULT.post_html',\r\n        name: function(th){return th.pn.getElementsByTagName('img')[0].getAttribute('data-name');},\r\n        com: function(th){\r\n          return th.pn.getElementsByClassName('replies')[0].innerHTML.replace(/\\s*<strong>[^<]*<\\/strong>\\s*(<br>)*/,'').replace(/\\s*$/,'');\r\n        },\r\n        type_com:'html',\r\n//        com: function(th){ // working code.\r\n//if (pref.test_mode['0']) {\r\n//          if (!th.hasOwnProperty('sub')) th.sub = this.sub(th);\r\n//}\r\n//          return th.pn[brwsr.innerText].replace(th.pn.getElementsByTagName('strong')[0][brwsr.innerText],'').replace(th.sub,'');\r\n//        },\r\n        footer: function(th){return th.pn.getElementsByTagName('strong')[0];},\r\n        sticky: function(th){return null;}, // patch\r\n//        format: function(th){th.pn.getElementsByTagName('a')[0].removeAttribute('href');return null;},\r\n        op_img_url: function(th){\r\n          var img = th.pn.getElementsByTagName('img')[0];\r\n          return (img)? img.getAttribute('src') : undefined; // patch.\r\n        },\r\n//        filename: function(th){return th.op_img_url;},\r\n//        missing_info: {time_posted: null, op_img_src_url: null},\r\n////        missing_info_fetch: function(th){scan.list_nup.add_board(th.domain+th.board,0,null,null,true);scan.scan('b',this.nickname)}, // BUG. catalog doesn't contain time_posted.\r\n//        missing_info_fetch: function(th){scan.list_nup.add(th.key,0);scan.scan('t',this.nickname)}, // BUG. catalog doesn't contain time_posted.\r\n        dynamic_image_hover: true,\r\n        missing_info: 2,\r\n        img2src: function(img){\r\n          var lth = this.get_lth_from_node(img);\r\n          if (!lth) return null;\r\n          var src = img.src;\r\n          if (lth.th && lth.th.ext) src = src.replace(/thumb/,'src').replace(/.[^\\.]*$/,lth.th.ext);\r\n          else if (lth.th.missing_info) scan.scan_ui('image_hover', {tgts: [lth.domain+lth.board+'j0'], options:{callback:function(){cataLog.image_hover_reentry(img);}, priority:6}});\r\n          return src;\r\n        },\r\n        get_op_src: 'thread_json',\r\n        time_unit:1000,\r\n      },\r\n      'catalog_json' : {\r\n        before_test : ['ths',':ITER',':ALL','ths',['key','time_bumped','nof_posts','nof_files']],\r\n        after_test  : ['time_created','pn','footer'],\r\n        full_hier   : ['ths',':ITER',':ALL','ths',['key','time_bumped','nof_posts','nof_files','pn','footer']],\r\n        ths: 'DEFAULT.catalog_json',\r\n        time_bumped: function(th){return th.last_modified*1000;},\r\n        time_created : function(th){return th.time*1000;},\r\n        nof_posts: function(th){return th.replies+1;},\r\n        nof_files: function(th){return th.images+th.omitted_images;},\r\n        key: function(th){return th.domain + th.board + th.no;},\r\n//        sub: function(th){return ('sub' in th)? th.sub : '';},\r\n//        name: function(th){return ('name' in th)? th.name : '';},\r\n//        com: function(th){return ('com' in th)? th.com : '';},\r\n//        sticky: function(th){return (th.sticky===1);}, // prevent memory leak.\r\n        sub: function(th){return (th.hasOwnProperty('sub'))? th.sub : '';},\r\n        name: function(th){return (th.hasOwnProperty('name'))? th.name : '';},\r\n        com: function(th){return (th.hasOwnProperty('com'))? th.com : '';},\r\n//        sticky: function(th){return (th.hasOwnProperty('sticky'))? th.sticky==='1' : false;},\r\n        op_img_url: 'DEFAULT.common',\r\n////        op_img_url: function(obj) { // working code.\r\n////          return site2[obj.domain].protocol + '//' + site2[obj.domain].domain_url + obj.board + 'thumb/' + obj.tim + ((obj.ext==='.jpg')? '.png' : obj.ext);\r\n//////          return this.protocol+ '//' + site2[obj.domain].domain_url + obj.board + 'thumb/' + obj.tim + ((obj.ext==='.jpg')? '.png' : obj.ext);\r\n////        },\r\n        missing_info: 1,\r\n//        missing_info: null,\r\n//        posts: 'DEFAULT.catalog_json', // DOESN'T WORK\r\n        get_op_src: 'thread_json',\r\n        time_unit: 1000,\r\n        type_com: 'html',\r\n        posts: 'DEFAULT.catalog_json',\r\n        posts_full: null, // 'DEFAULT.catalog_json',\r\n        get_max_page: function(doc){return doc.length;},\r\n        proto: 'catalog_html',\r\n      },\r\n      'page_json' : {\r\n        has_posts: true,\r\n        nof_posts: 'DEFAULT.thread_json', // VICHAN HAS A INCONSISTENCY, thread_json doesn't provide 'replies'.\r\n        nof_files: function(th){return th.posts[0].images+th.posts[0].omitted_images;},\r\n        ths: 'DEFAULT.page_json',\r\n        proto:'thread_json'\r\n      },\r\n      'page_html' : {\r\n        before_test : ['ths',':ITER',':ALL','ths',['key','time_bumped','nof_posts','nof_files']],\r\n//        after_test  : [':ITER',':ALL','posts',['sub','name','com'],'flags'],\r\n        after_test  : ['time_created',':ITER',':ALL','posts',['sub','name','com','flag'],':ITER',':GALL','posts',['flags','flag']],\r\n        before_test_post : ['posts',':ITER',':FL','posts',['time'],'html_org','footer'],\r\n//        ths: function(doc) {\r\n//          var ths = doc.pn.querySelectorAll('div[id^=thread_]');\r\n//          if (ths.length===0) ths = doc.pn.querySelectorAll('div[de-thread]'); // for dollchan archive // doesn't work because of other modification.\r\n//          return this.ths_array(doc,ths);\r\n//        },\r\n        ths: function(doc) {return this.ths_array(doc,doc.pn.querySelectorAll('div[id^=thread_]'));},\r\n        th_init: function(th){\r\n          if (site.whereami!=='page' || !pref.catalog.embed_page) th.pn.removeAttribute('class');\r\n//          var as = th.pn.querySelectot_inheritrAll('.files a');\r\n//          for (var j=0;j<as.length;j++) as[j].removeAttribute('href');\r\n////          for (var j=0;j<as.length;j++) as[j].addEventListener('click',th.parse_funcs.preventDefault,false); // not debugged.\r\n        },\r\n//        th_destroy: function(pn, parse_funcs){\r\n////          var as = pn.querySelectorAll('.files a');\r\n////          for (var j=0;j<as.length;j++) as[j].removeEventListener('click',parse_funcs.preventDefault,false); // not debugged.\r\n//        },\r\n//        ths: function(doc) {\r\n//          var ths = this.ths_array(doc,doc.pn.querySelectorAll('div[id^=thread_]'));\r\n//          if (site.whereami!=='page' || !pref.catalog.embed_page) for (var i=0;i<ths.length;i++) ths[i].pn.removeAttribute('class');\r\n//          for (var i=0;i<ths.length;i++) {\r\n//            var as = ths[i].pn.querySelectorAll('.files a');\r\n//            for (var j=0;j<as.length;j++) as[j].removeAttribute('href');\r\n//          }\r\n//          return ths;\r\n//        },\r\n        no: 'post_html',\r\n//        no : function(th){return parseInt(th.pn.id.substring(th.pn.id.indexOf('_')+1),10);},\r\n////        post_no: 'page_html.no',\r\n        time: function(post){\r\n          var pn_time = post.pn.getElementsByTagName('time')[0]; // old threads doesn't have this.\r\n          return (pn_time)? Date.parse(pn_time.getAttribute('datetime'))/1000 : undefined;\r\n        },\r\n        time_unit:1000, // must be the same as json\r\n////////        time_posted: function(th){\r\n////////if (pref.test_mode['0']) {\r\n////////          if (!th.hasOwnProperty('posts')) this.entry(th,this.before_test_post);\r\n////////}\r\n////////          return th.posts[th.posts.length-1].time;\r\n////////        },\r\n        time_bumped: function(th){ // TO BE FIXED.\r\n////if (pref.test_mode['0']) {\r\n////          if (!th.hasOwnProperty('posts')) this.entry(th,this.before_test_post);\r\n////}\r\n////          return th.posts[th.posts.length-1].time;\r\n          var i=th.posts.length;\r\n          while (--i>=0) {\r\n            var mail = th.posts[i].pn.getElementsByClassName('email')[0];\r\n            if (!mail || mail.href!=='mailto:sage') return th.posts[i].time_tu;\r\n          }\r\n          return undefined;\r\n        },\r\n        time_created : function(th){\r\nif (pref.test_mode['0']) {\r\n          if (!th.hasOwnProperty('posts')) this.entry(th,this.before_test_post);\r\n}\r\n          return th.posts[0].time;\r\n        },\r\n        nof_posts: function(th){\r\n          var nof_posts = th.pn.getElementsByClassName('post').length;\r\n          var nof_files = th.pn.getElementsByClassName('fileinfo').length;\r\n          var om_info   = th.pn.getElementsByClassName('omitted')[0];\r\n          if (om_info) {\r\n            var str = om_info.childNodes[0].textContent.replace(/\\n/g,'');\r\n            nof_posts += parseInt(str.replace(/\\ post.*/,''),10) || 0;\r\n            nof_files += parseInt('0'+str.replace(/\\ image.*/,'').replace(/[^\\ ]*\\ /g,''),10) || 0;\r\n          }\r\n//          th.nof_files = nof_files;\r\n          Object.defineProperty(th,'nof_files',{value:nof_files, enumerable:true, configurable:true, writable:true});\r\n          return nof_posts;\r\n        },\r\n        nof_files: function(th){\r\n          if (!th.hasOwnProperty('nof_posts')) this['nof_posts'](th);\r\n          return th.nof_files;\r\n        },\r\n        key: function(th){\r\n//          if (!th.hasOwnProperty(('no')) th.no = this.no(th);\r\nif (pref.test_mode['0']) {\r\n          if (!th.hasOwnProperty('no')) Object.defineProperty(th,'no',{value:this['no'](th), enumerable:true, configurable:true, writable:true});\r\n}\r\n          return th.domain + th.board + th.no;\r\n        },\r\n        sub: 'DEFAULT.post_html',\r\n        com:  function(post){\r\n          var com = post.pn.getElementsByClassName('body')[0];\r\n//          return (com)? com[brwsr.innerText] : '';\r\n          return (com)? com.innerHTML : '';\r\n        },\r\n        type_com:'html',\r\n        footer: function(th){return this.insert_footer4(th.pn.getElementsByClassName('post op')[0]);},\r\n//        footer: function(th){\r\n//          var footer = document.createElement('div');\r\n//          footer = th.pn.insertBefore(footer,th.pn.getElementsByClassName('post op')[0]);\r\n//          return footer;\r\n//        },\r\n        sticky: function(th){return (th.pn.getElementsByClassName('fa-thumb-tack').length!=0);},\r\n        flag: 'post_html',\r\n////        flag: function(post){return post.pn.getElementsByClassName('flag')[0];},\r\n//        flag: function(post){\r\n//          var flags = post.pn.getElementsByClassName('flag');\r\n//          return (flags.length!=0)? document.importNode(flags[0],false) : null;\r\n//        },\r\n//        flags: function(th){\r\n//          var flags = th.pn.getElementsByClassName('flag');\r\n//          var pn_flags = [];\r\n//          for (var i=0;i<flags.length;i++) pn_flags.push(flags[i].cloneNode(false));\r\n//          return pn_flags;\r\n//        },\r\n//        flags: function(th){ // for on demand access.\r\n//          var flags = [];\r\n//          var i = th.posts.length - pref.catalog_t2h_num_of_posts;\r\n//          if (i<1) i=1;\r\n//          if (th.posts.length!=0) flags[0] = th.posts[0].flag;\r\n//          while (i<th.posts.length) {\r\n//            if (th.posts[i]) flags[i] = th.posts[i].flag;\r\n//            i++;\r\n//          }\r\n//          return flags;\r\n//        },\r\n        op_img_url: function(th){\r\n          var img = th.pn.getElementsByTagName('img');\r\n          if (img.length>=2) {\r\n            th.op_img_url2 = [];\r\n            for (var i=1;i<img.length;i++) {\r\n              var url2 = img[i].getAttribute('src');\r\n              if (url2) th.op_img_url2[th.op_img_url2.length] = url2;\r\n            }\r\n          }\r\n          return (img && img[0])? img[0].getAttribute('src') : undefined; // patch.\r\n        },\r\n        tn_as: function(th){return th.tn_imgs;},\r\n//        tn_imgs: function(th){\r\n//          var imgs = [];\r\n//          var files = th.pn.getElementsByClassName('file');\r\n//          for (var i=0;i<files.length;i++) imgs[i] = files[i].getElementsByTagName('img')[0];\r\n//          return imgs;\r\n//        },\r\n        tn_imgs: function (th){ // post can be accepted.\r\n          var imgs = [];\r\n          var files = ((th.pn.classList.contains('op'))? th.pn.parentNode : th.pn).getElementsByClassName('files')[0];\r\n          if (files) {\r\n            files = files.getElementsByClassName('file');\r\n            for (var i=0;i<files.length;i++) {\r\n              var tmp = files[i].getElementsByTagName('img')[0] || files[i].getElementsByTagName('video')[0];\r\n//              var tmp = files[i].getElementsByTagName('img')[0];\r\n              if (tmp) imgs[imgs.length] = tmp;\r\n            }\r\n          }\r\n          return imgs;\r\n        },\r\n        get_thread_links : function(th){\r\n          var links = [];\r\n          var as = th.pn.getElementsByClassName('post op')[0].getElementsByTagName('a');\r\n          for (var i=0;i<as.length;i++) {\r\n            if (as[i].textContent==='[Reply]') links.unshift(as[i]);\r\n            if (as[i].textContent==='[Last 50 Posts]') links.push(as[i]);\r\n            if (as[i].classList.contains(pref.script_prefix+'_link')) links.push(as[i]);\r\n          }\r\n          return links;\r\n        },\r\n        get_omitted_info : function(post){return post.pn.getElementsByClassName('omitted')[0];},\r\n        set_omitted_info : function(post, info){post.pn.lastChild.appendChild(info);},\r\n//        replace_omitted_info : function(dst, src){dst.childNodes[0].textContent = src.childNodes[0].textContent;},\r\n        replace_omitted_info2 : function(dst, src){dst.childNodes[0].textContent = (src)? src.childNodes[0].textContent : '';},\r\n        filename: 'thread_html',\r\n        get_op_src: 'thread_json',\r\n        id: 'DEFAULT.thread_html',\r\n        country: 'DEFAULT.thread_html',\r\n        trip: 'DEFAULT.thread_html',\r\n        flag: 'DEFAULT.thread_html',\r\n        name: 'DEFAULT.thread_html',\r\n        pn_name: 'post_html',\r\n      },\r\n      'thread_html' : {\r\n        after_test  : ['time_created',':ITER',':FLx','posts',['sub','name','com','flag'],':ITER',':GFLx','posts',['flags','flag']],\r\n//        'finisher' : function(th){site2['8chan'].remove_posts(th.pn,pref.catalog_t2h_num_of_posts);},\r\n////        pop_post: function(th){ // working code.\r\n////          while (th.idx_pop>=0) {\r\n////            var pn = th.children[th.idx_pop--];\r\n////            if (pn.className && pn.className.indexOf('post')!=-1 && pn.className.indexOf('reply')!=-1) {\r\n////              th.post = {pn:pn, parse_funcs:this, __proto__:th.__proto__};\r\n////              return true;\r\n////            }\r\n////          }\r\n////          return false;\r\n////        },\r\n        get_op_src: 'thread_json',\r\n        filename: function(th){\r\n          var files = ((th.pn.classList.contains('op'))? th.pn.parentNode : th.pn).getElementsByClassName('files')[0];\r\n          if (files) {\r\n            files = files.querySelectorAll(':scope>.file');\r\n            for (var i=0;i<files.length;i++) {\r\n              var fname = files[i].getElementsByTagName('a')[0];\r\n              if (!fname) continue; // file may be deleted.\r\n              fname = fname.textContent;\r\n              if (i===1) th.extra_files = [];\r\n              if (i>=1) th.extra_files[i-1] = {domain:th.domain, board:th.board};\r\n              var tgt = (i===0)? th : th.extra_files[i-1];\r\n              tgt.filename = (th.domain==='lain')? files[i].getElementsByTagName('a')[1].getAttribute('download') // lainchan 2017.04.25- \r\n                                                 : files[i].getElementsByClassName('postfilename')[0].textContent.replace(/\\..*/,'');\r\n              tgt.ext = fname.substr(  fname.indexOf('.'));\r\n              tgt.tim = fname.substr(0,fname.indexOf('.'));\r\n              var info = (th.domain!=='lainjp')? files[i].getElementsByClassName('details')[0].textContent.split(',')\r\n                                               : files[i].getElementsByClassName('unimportant')[0].textContent.split(',');\r\n              tgt.w = parseInt(info[1].substr(0,info[1].indexOf('x')  ),10);\r\n              tgt.h = parseInt(info[1].substr(  info[1].indexOf('x')+1),10);\r\n              var fsize = info[0].split(/\\s/);\r\n              fsize[1] = (fsize[1]==='KB')? 1024 : (fsize[1]==='MB')? 1024*1024 : 1;\r\n              tgt.fsize = parseFloat(fsize[0].replace(/\\(/,'')) * fsize[1];\r\n              var tn = files[i].querySelector('img.post-image');\r\n              if (tn) {\r\n                tgt.tn_w = parseInt(tn.style.width,10);\r\n                tgt.tn_h = parseInt(tn.style.height,10);\r\n              }\r\n            }\r\n          }\r\n          return (files)? th.filename : undefined;\r\n        },\r\n        proto: 'page_html',\r\n      },\r\n      'thread_json' : {\r\n        nof_posts: function(obj){return obj.posts.length;},\r\n        nof_files: function(obj){\r\n          var count=0;\r\n          for (var i=1;i<obj.posts.length;i++) {\r\n            if (obj.posts[i].filename) count++;\r\n            if (obj.posts[i].extra_files) count += obj.posts[i].extra_files.length;\r\n          }\r\n          return count;\r\n        },\r\n        add_op_img_url: site2['DEFAULT'].parse_parts.add_op_img_url,\r\n//        get_op_src: function(th){return th.op_img_url.replace('thumb','src').replace('.png',th.ext);},\r\n        get_op_src: function(th, img){\r\n          if (!th.ext && th.missing_info) scan.scan_ui('image_hover', {tgts: [th.domain+th.board+'j0'], options:{callback:function(){cataLog.image_hover_reentry(img);}, priority:6}});\r\n          return (th.ext)? th.op_img_url.replace('thumb','src').replace('.png',th.ext) : img.src;\r\n        },\r\n        pn_name: 'post_html',\r\n        proto: 'DEFAULT.thread_json',\r\n      },\r\n      'post_html': {\r\n        com: 'page_html',\r\n        no: function(th){\r\n          var id = th.pn.getAttribute('id');\r\n          return id && parseInt(id.substring(id.indexOf('_')+1),10);},\r\n        name: function(post){return (post.pn_name)? post.pn_name.textContent : '';},\r\n        pn_name: function(post){return post.pn.getElementsByClassName('name')[0];},\r\n        time_pn: function(post_pn){return Date.parse(post_pn.getElementsByTagName('time')[0].getAttribute('datetime'));},\r\n//        txt2com: function(txt){\r\n//          txt = txt.replace(/(^>[^>].*$)/mg,'<span class=\"quote\">$1</span>');\r\n//          txt = txt.replace(/\\*\\*([^(\\*\\*)]*)((\\*\\*)|$)/g,'<span class=\"spoiler\">$1</span>');\r\n//          return txt.replace(/\\n/g,'<br>');},\r\n        txt2com_spoiler_replace_txt: '<span class=\"spoiler\">$1</span>',\r\n        flag: function(post){return post.pn.getElementsByClassName('flag')[0];},\r\n        pn_id: function(post){return post.pn.getElementsByClassName('poster_id')[0];},\r\n        id: function(post){return (post.pn_id)? post.pn_id.textContent : undefined;},\r\n        time: 'page_html',\r\n        time_unit:1000,\r\n        proto: 'DEFAULT.post_html',\r\n      },\r\n      'post_json': {\r\n        proto: 'DEFAULT.post_json'\r\n      },\r\n      'json_template': {\r\n        get nofFiles(){return !this.filename? 0 : (!this.extra_files)? 1 : this.extra_files.length+1;},\r\n      },\r\n    },\r\n    update_posts_remove: function(th_old,i,pnode,merge){\r\n      var tgt = th_old.posts[i].pn;\r\n      if (!merge || tgt.parentNode!==pnode) tgt = tgt.parentNode;\r\n      else this.update_posts_insert_pack(tgt);\r\n      pnode.removeChild(tgt.nextSibling);\r\n      pnode.removeChild(tgt);\r\n    },\r\n    update_posts_insert: function(src,dst,i,j,pnode){\r\n////      var ref = (j==1)? (dst[0].pn.getElementsByClassName('op')[0].nextSibling || null) :\r\n//      var ref = (i==1)? (dst[0].pn.nextSibling || null) :\r\n//                        (dst[dst.length-1].pn.parentNode.nextSibling || null);\r\n//      var ref = (j==0)? (dst[0].pn || null) :\r\n//                (j==1)? (dst[0].pn.nextSibling || null) :\r\n//                (j<dst.length)? (dst[j].pn.parentNode.nextSibling || null) :\r\n//                (dst[dst.length-1].pn.parentNode.nextSibling &&\r\n//                 dst[dst.length-1].pn.parentNode.nextSibling.nextSibling || null);\r\n      var ref = (j<dst.length)? dst[j].pn : null;\r\n//      var ref = dst[(j<dst.length)? j : dst.length-1];\r\n//      ref = (ref)? ref.pn : null;\r\n      var ref_pnode = ref && ref.parentNode;\r\n      if (ref_pnode && ref_pnode!==pnode) ref = ref_pnode; // remove container\r\n//      if (j>=1 && (!merge || ref.parentNode!==pnode)) ref = ref.parentNode; // remove container\r\n      if (j>=dst.length) ref = pnode.getElementsByClassName('clear')[0]; // for universal merge with lazy draw, dst[dst.length-1].pn may remain in old pnode.\r\n//      if (j>=dst.length) ref = ref && ref.nextSibling && ref.nextSibling.nextSibling || null;\r\n      if (!src[i].pn) src[i].pn = this.post_json2html(src[i],src[i].board);\r\n//      pnode.insertBefore(this.post_container(src[i].pn,src[i].no), ref); // working code.\r\n//      pnode.insertBefore(document.createElement('br'),ref);\r\n//      if (ref && ref.parentNode!==pnode) ref = ref.parentNode; // patch for thread merging.\r\n      if (i===0) this.update_posts_insert_pack(src[i].pn);\r\n      if (j===0 && dst[0]) this.update_posts_insert_pack(dst[0].pn);\r\n//      if (j===0 && ref) this.update_posts_insert_pack(dst[0].pn); // BUG???\r\n      var tgt = (j===0 && i===0)? src[i].pn : this.post_container(src[i].pn,src[i].no); // patch for thread merging.\r\n      pnode.insertBefore(tgt, ref);\r\n      pnode.insertBefore(document.createElement('br'),ref);\r\n      if (i===0 && j===0) this.update_posts_insert_unpack(src[i].pn);\r\n//      if (j===0) {\r\n//        ref = dst[0].pn.nextSibling;\r\n//        pnode.insertBefore(this.post_container(dst[0].pn,dst[0].no), ref);\r\n//      }\r\n    },\r\n    update_posts0_class: function(pn,search_result) {\r\n      site2['DEFAULT'].update_posts0_class(pn,search_result);\r\n      this.update_posts_insert_pack_iter(pn, (search_result)? function(prev){prev.classList.remove('CatChan_search_miss');} : \r\n                                                              function(prev){prev.classList.add('CatChan_search_miss');});\r\n    },\r\n    update_posts_insert_pack: function(pn){\r\n      this.update_posts_insert_pack_iter(pn, function(prev){pn.insertBefore(prev, pn.firstChild);});\r\n    },\r\n    update_posts_insert_pack_iter: function(pn, func){\r\n      var prev = pn.previousSibling;\r\n      while (prev) {\r\n        var prev_prev = prev.previousSibling; // prev is livelist.\r\n        if (prev.classList && (prev.classList.contains(pref.script_prefix+'_footer') || prev.classList.contains('files'))) func(prev);\r\n        if (prev.classList &&  prev.classList.contains('op')) break;\r\n        prev = prev_prev;\r\n      }\r\n    },\r\n    update_posts_insert_unpack: function(pn){\r\n      while (1) {\r\n        var fchild = pn.firstChild;\r\n        if (fchild && fchild.classList && (fchild.classList.contains(pref.script_prefix+'_footer') || fchild.classList.contains('files'))) pn.parentNode.insertBefore(fchild, pn);\r\n        else break;\r\n      }\r\n    },\r\n    add_backlinks_bks: (function(){\r\n      var bks = document.createElement('span');\r\n      bks.setAttribute('class','mentioned unimportant');\r\n      return function(){\r\n        return bks.cloneNode(false);\r\n      };\r\n    })(),\r\n    add_backlinks_add_1: (function(){\r\n      var blk = document.createElement('a');\r\n      blk.setAttribute('class','mentioned'); // mentioned-XXXX in lainchan.\r\n      return function(bks, dbtpth){\r\n        var pn = blk.cloneNode(true);\r\n        pn.setAttribute('href',dbtpth[5]);\r\n        pn.textContent = dbtpth[4];\r\n        pn.onclick = this.backlink_onclick;\r\n//        pn.onmouseover = this.popups_post_entry;\r\n        bks.appendChild(pn);\r\n      };\r\n    })(),\r\n    add_backlinks_bks_query: function(pn){\r\n      return pn.getElementsByClassName('mentioned')[0];\r\n    },\r\n////    add_backlinks: function(pn,backlinks,target,th){\r\n////      var bks_pn = pn.getElementsByClassName('mentioned')[0];\r\n////      var bks = bks_pn || this.add_backlinks_bks();\r\n////      if (!target) bks.innerHTML = '';\r\n////      for (var i=(target || 0);i<backlinks.length;i++) {\r\n////        var dbtp = this.popups_backlink2dbtpth(backlinks[i], th);\r\n////        var domain = dbtp[0];\r\n//////        var board = dbtp[1];\r\n//////        var post_no = dbtp[3];\r\n////        var href = site2[domain].link_dbtp2href(dbtp);\r\n////        if (domain!==site.nickname) href = site2[domain].absolute_link_1(href);\r\n//////        var blk = null; // IS THIS REQUITED???\r\n//////        if (target!==undefined)\r\n//////          for (var j=0;j<bks.childNodes.length;j++)\r\n//////            if (bks.childNodes[j].textContent==='>>'+post_no) {\r\n//////              blk = bks.childNodes[j];\r\n//////              break;\r\n//////            }\r\n//////        if (!blk)\r\n////        this.add_backlinks_add_1(bks, dbtp, href);\r\n////        if (target) break;\r\n////      }\r\n////      if (!bks_pn) {\r\n////        var ref = pn.getElementsByClassName('post_no')[1];\r\n////        var pnode = ref.parentNode;\r\n////        do {ref = ref.nextSibling;} while (ref && ref.tagName==='I');\r\n////        pnode.insertBefore(bks,ref);\r\n////      }\r\n////    },\r\n    add_backlinks_bks_append: function(pn, bks){\r\n      var ref = pn.getElementsByClassName('post_no')[1];\r\n      var pnode = ref.parentNode;\r\n      do {ref = ref.nextSibling;} while (ref && ref.tagName==='I');\r\n      pnode.insertBefore(bks,ref);\r\n    },\r\n    popups_href2dbtp: function(href){ //, src, th){\r\n//      if (href[0]==='#') {\r\n//        href = th.board+'res/'+th.no+'.html'+href;\r\n//        src.setAttribute('href',href);\r\n//      }\r\n      var hrefs = href.split('/');\r\n      var p = hrefs[hrefs.length-1].substr(hrefs[hrefs.length-1].indexOf('#')+1);\r\n      var t = hrefs[hrefs.length-1].substr(0,hrefs[hrefs.length-1].indexOf('.')) || href[0]==='#' && site.no;\r\n      var b = (hrefs.length>=3)? '/'+hrefs[hrefs.length-3]+'/' : site.board;\r\n      var d = this.nickname;\r\n      return [d,b,t,p];\r\n    },\r\n    link_dbtp2href: function(dbtp){\r\n      return dbtp[1] + 'res/' + dbtp[2] + '.html#' + dbtp[3];\r\n    },\r\n    backlink_onclick: function(){\r\n      highlightReply.call(this,parseInt(this.textContent.substr(2),10));\r\n    },\r\n//    backlink_class: 'mentioned',\r\n    colorID: function(pn) {\r\n      var id = pn.getElementsByClassName('poster_id')[0];\r\n      if (id) {\r\n        var bg = id.textContent;\r\n        var bg_r = parseInt(bg.substr(0,2),16);\r\n        var bg_g = parseInt(bg.substr(2,2),16);\r\n        var bg_b = parseInt(bg.substr(4,2),16);\r\n        var fg = (bg_r + bg_g + bg_b>384)? 0 : 255;\r\n        id.setAttribute('style','padding: 0px 5px; border-radius: 8px; color: rgb('+fg+','+fg+','+fg+'); background-color: rgb('+bg_r+','+bg_g+','+bg_b+');');\r\n      }\r\n    },\r\n//    localtime: function(pn) {\r\n//      var pn_time = pn.getElementsByTagName('time');\r\n//      for (var i=0;i<pn_time.length;i++)\r\n//        pn_time[i].textContent = site2.common.change_utc_to_local(pn_time[i].getAttribute('datetime'));\r\n//    },\r\n//    post_com2txt: function(com){\r\n//      return com.replace(/<[^>]*>/g,' ').replace(/&gt;/g,'>').replace(/&lt;/g,'<').replace(/&amp;/g,'&').replace(/&hellip;/g,'\\u2026'); // most of lainchan, speed: 10.62/2.02\r\n//    },\r\n    post_container : function(post_pn,no) {\r\n      var pn = document.createElement('div');\r\n      pn.setAttribute('id','pc'+no);\r\n      pn.setAttribute('class','postcontainer');\r\n      pn.innerHTML = '<div class=\"sidearrows\">&gt;&gt;</div>';\r\n      pn.appendChild(post_pn);\r\n      return pn;\r\n    },\r\n    short_link: function(name, nof_posts, num, kwd_head, kwd_tail){\r\n      var dbt = common_func.fullname2dbt(name);\r\n      return (nof_posts>100)? '<a href=\"' +dbt[1]+ 'res/' +dbt[2]+ '+50.html\" class=\"' + pref.script_prefix + '_link' + '\">'+kwd_head+'50'+kwd_tail+'</a>' : '';\r\n    },\r\n    post_json2html : function(post, board, op, short_link) {\r\n      var pn = document.createElement('div');\r\n      var time_unit = (post.parse_funcs && post.parse_funcs.time_unit) || 1;\r\n      var date = new Date((post.time || 0) * time_unit);\r\n      var html_str =\r\n        '<div class=\"post ' +((op)? 'op':'reply')+ '\" id=\"reply_'+post.no+'\" style=\"border: none\">'+\r\n//        '<div class=\"post reply\" id=\"reply_'+post.no+'\" style=\"border: none\">'+\r\n          '<p class=\"intro\">'+\r\n            '<input type=\"checkbox\" class=\"delete\" name=\"delete_'+post.no+'\" id=\"delete_'+post.no+'\">'+\r\n            '<label for=\"delete_'+post.no+'\">'+\r\n              ((post.sub)? '<span class=\"subject\">'+post.sub+ ' </span>' : '')+\r\n              ((post.email)? '<a class=\"email\" href=\"mailto:' + post.email + '\">' : '') +\r\n                '<span class=\"name\">'+(post.name || '')+'</span>'+\r\n                ((post.trip)? '<span class=\"trip\">' + post.trip + '</span>' : '') +\r\n              ((post.capcode)? '<span class=\"capcode\" style=\"color:orange;font-weight:bold\">## ' + post.capcode + '</span>' : '') +\r\n              ((post.email)? '</a> ' : ' ') +\r\n              ((post.country)? '<img class=\"flag flag-' + post.country.toLowerCase() + '\" src=\"/static/blank.gif\" style=\"width:16px;height:11px;\" alt=\"' + post.country_name + '\" title=\"' + post.country_name +'\"> ' : ' ')+\r\n              '<time datetime=\"'+ date.toISOString() + '\">' + date.toLocaleString()+'</time>'+\r\n            '</label>'+\r\n            ((post.id)? '<span class=\"poster_id\">'+post.id+'</span>' : '')+\r\n            '&nbsp;'+\r\n            '<a class=\"post_no\" id=\"post_no_'+post.no+'\">No.</a>'+\r\n//            '<a class=\"post_no\" onclick=\"citeReply(12486)\" href=\"/tech/res/12393.html#q12486\">12486</a>'+\r\n            '<a class=\"post_no\">'+post.no+'</a>'+\r\n            ((op)? ('<a href=\"' + site2[post.domain].make_url4([post.domain, board, post.no, 'thread_html'])[0] +'\">[Reply]</a>'+\r\n//            ((op)? ('<a href=\"' +board+ 'res/' +post.no+ '.html\">[Reply]</a>'+\r\n                   ((short_link)? short_link : '')) : '') +\r\n//////////            '<span class=\"mentioned unimportant\"><a class=\"mentioned-12497\" onclick=\"highlightReply('12497');\" href=\"#12497\">&gt;&gt;12497</a></span>'+\r\n          '</p>';\r\n      if (post.filename) {\r\n        html_str += '<div class=\"files\">' +\r\n                    this.post_json2html_file(post,board, post.extra_files);\r\n        if (post.extra_files) for (var i=0;i<post.extra_files.length;i++) html_str += this.post_json2html_file(post.extra_files[i],board, true);\r\n        html_str += '</div>';\r\n      }\r\n      html_str +=\r\n          '<div class=\"body\">'+ ((post.com)? post.com : '') +\r\n//////////            '<a onclick=\"highlightReply('12446');\" href=\"/tech/res/12393.html#12446\">&gt;&gt;12446</a><br>'+\r\n//////////            '<a onclick=\"highlightReply('12403');\" href=\"/tech/res/12393.html#12403\">&gt;&gt;12403</a><br>'+\r\n//////////            '<span class=\"quote\"><br>&gt;people saying nice things about openstack</span><br><br>Thanks, lainons. I work on developing openstack and people seem to love complaining about it, so it's heartening to hear somewhat happy people.'+\r\n          '</div>'+\r\n        '</div>';\r\n      pn.innerHTML = html_str;\r\n      return pn.childNodes[0];\r\n    },\r\n    post_pn2ce: function(pn){\r\n      return (pn.lastChild.className==='body')? pn.lastChild : pn.getElementsByClassName('body')[0];\r\n    },\r\n    post_json2html_file : function(post, board, multifile) {\r\n      var fsize_str = (((post.fsize>1048576)? post.fsize/1048576 : post.fsize/1024)+0.005).toString();\r\n      fsize_str = fsize_str.substr(0,fsize_str.indexOf('.')+3) + ((post.fsize>1048576)? ' MB' : ' KB');\r\n      var fname_server = site2[post.domain].post_json2html_fname_server(post);\r\n      var fname = site2[post.domain].post_json2html_fname(post);\r\n      var furl = site2[post.domain].catalog_json2html3_src(post,board);\r\n      var turl = site2[post.domain].catalog_json2html3_thumbnail(post,board);\r\n      var html_str = \r\n              '<div class=\"file' + ((multifile)?' multifile':'')+'\"' +((multifile)?' style=\"width:'+(post.tn_w+40)+'px\"':'') +'>'+\r\n                '<p class=\"fileinfo\">File: '+\r\n                  '<a href=\"'+furl+'\">'+fname_server+'</a> '+\r\n                  '<span class=\"details\">('+fsize_str+', '+post.w+'x'+post.h+', '+\r\n                    '<span class=\"postfilename\">'+fname+'</span>) '+\r\n////////                  '<span class=\"unimportant image_id\">'+\r\n//////////                    '<a href=\"http://imgops.com/https://lainchan.org/tech/src/1445201930315.jpg\" target=\"_blank\">ImgOps</a>'+\r\n//////////                    '<a href=\"http://regex.info/exif.cgi?url=https://lainchan.org/tech/src/1445201930315.jpg\" target=\"_blank\">Exif</a>'+\r\n//////////                    '<a href=\"http://iqdb.org/?url=https://lainchan.org/tech/src/1445201930315.jpg\" target=\"_blank\">iqdb</a>'+\r\n////////                  '</span>'+\r\n                  '</span>'+\r\n                '</p>'+\r\n                '<a href=\"'+furl+'\" target=\"_blank\">'+\r\n                  ((post.ext!=='.webm')? '<img class=\"post-image\" src=\"'+turl+'\" style=\"width: '+post.tn_w+'px; height: '+post.tn_h+'px; max-width: 98%;\" alt=\"\"'+\r\n                                         ((post.tn_w===128 && post.tn_h===128)? 'onerror=\"this.onerror=null;this.src=\\'/static/spoiler.png\\';\"' : '')+ '>' : // vichan doesn't have any information about spoilered.\r\n                                         '<video class=\"post-image\" src=\"'+furl+'\" style=\"width: '+post.tn_w+'px; height: '+post.tn_h+'px; max-width: 98%;\">')+\r\n                '</a>'+\r\n              '</div>';\r\n      return html_str;\r\n    },\r\n    page_json2html3_skelton: function(obj, both){\r\n      var th = document.createElement('div');\r\n      th.setAttribute('class','thread');\r\n      th.setAttribute('id','thread_'+obj.no);\r\n      th.setAttribute('data-board',obj.board.slice(1,-1));\r\n//      th.setAttribute('style','float: left; overflow: hidden;');\r\n      var br = document.createElement('br');\r\n      br.setAttribute('class','clear');\r\n      th.appendChild(br);\r\n      th.appendChild(document.createElement('hr'));\r\n      return (both)? [th,br] : th;\r\n    },\r\n    page_json2html3: function(obj, clone, dst, force_expander, no_expander){\r\n      var doms = this.page_json2html3_skelton(obj,true);\r\n      var th = doms[0];\r\n      var ref = doms[1];\r\n      var op = this.post_json2html((obj.posts && obj.posts[0])? obj.posts[0] : obj, obj.board, true, site2[obj.domain].short_link(obj.key, obj.nof_posts, 2, '[Last ',' Posts]'));\r\n      var files = op.getElementsByClassName('files')[0];\r\n      if (files) th.insertBefore(files, ref);\r\n      if (clone && obj.posts[0].pn) op = obj.posts[0].pn.cloneNode(true);\r\n      op.setAttribute('class','post op');\r\n      if (obj.posts && obj.posts[0] && obj.posts[0].extra_files) op.setAttribute('style','clear:both;');\r\n      th.insertBefore(op, ref);\r\n//      if (assign_pn) obj.posts[0].pn = th;\r\n      obj.posts[0].pn = op;\r\n      if (obj.posts) {\r\n        for (var i=1;i<obj.posts.length;i++) {\r\n//          th.appendChild(this.post_json2html(obj.posts[i], board));\r\n          var pn = clone && obj.posts[i].pn && obj.posts[i].pn.cloneNode(true) || this.post_json2html(obj.posts[i], obj.board);\r\n          th.insertBefore(this.post_container(pn,obj.posts[i].no), ref);\r\n          th.insertBefore(document.createElement('br'), ref);\r\n          obj.posts[i].pn = pn;\r\n        }\r\n        if (!no_expander) this.page_json2html3_add_omitted_info(obj, dst, force_expander);\r\n////////      } else { // WILL BE REDUNDANT\r\n////////        var keys = Object.keys(obj); // obj.posts===undefined, but it is defined as undefined, so key contains 'posts'. \r\n////////        obj.posts = [];\r\n////////        obj.posts[0] = {};\r\n////////        for (var i=0;i<keys.length;i++) if (keys[i]!=='posts') obj.posts[0][keys[i]] = obj[keys[i]]; // remove props in prototype chain.\r\n////////        obj.posts[0].pn = op;\r\n      }\r\n      return th;\r\n    },\r\n    page_json2html3_replace_expander : function(posts_old, idx, key) {\r\n      var omit_info = posts_old[0].pn.getElementsByClassName('omitted')[0];\r\n      if (omit_info) {\r\n        if (omit_info.childNodes.length>=3) omit_info.removeChild(omit_info.childNodes[2]);\r\n        if (omit_info.childNodes.length>=2) omit_info.removeChild(omit_info.childNodes[1]); // 'if ()' is a parch for a bug in lainchan, inconsistency between usual boards and /mega/\r\n//        omit_info.removeChild(omit_info.childNodes[1]);\r\n        omit_info.appendChild(cnst.config_expander(key, idx));\r\n      }\r\n    },\r\n    page_json2html3_prep_omitted_info: function(posts0, th, force_expander){\r\n      var omit_info = posts0.pn.getElementsByClassName('omitted')[0];\r\n      if (!omit_info) {\r\n        omit_info = document.createElement('span');\r\n        omit_info.setAttribute('class','omitted');\r\n//            omit_info.innerHTML = 'dummy<a href=\"javascript:void(0)\">Click to expand</a>.';\r\n        omit_info.innerHTML = 'dummy';\r\n        posts0.pn.appendChild(omit_info);\r\n      }\r\n      if (force_expander) omit_info.appendChild(cnst.config_expander(th.key));\r\n      return omit_info.childNodes[0];\r\n    },\r\n    page_json2html3_set_omitted_info: function(nof_posts_omitted, nof_files_omitted) {\r\n      return (nof_posts_omitted<=0)? 'Showing all replies.'\r\n        : nof_posts_omitted +' post' + ((nof_posts_omitted!==1)? 's':'') +\r\n          ((nof_files_omitted)? ' and ' + nof_files_omitted + ' image repl'+ ((nof_files_omitted===1)? 'y' : 'ies') : '') + ' omitted. ';\r\n    },\r\n//    page_json2html3_add_omitted_info : function(th, th_old, force_expander) { // working code\r\n//      var posts = th.posts;\r\n//      var nof_files = 0;\r\n//      for (var i=1;i<posts.length;i++) nof_files += (posts[i].type_data==='html')? posts[i].pn.getElementsByClassName('file').length :\r\n//                                                    (!posts[i].filename)? 0 : (posts[i].extra_files)? posts[i].extra_files.length+1 : 1;\r\n//      var posts_deleted = posts.filter(function(v){return v.deleted_after;});\r\n//      var nof_files_omitted = th.nof_files - nof_files + posts_deleted.reduce(function(a,v){return a + ((!v.filename)? 0 : (v.extra_files)? v.extra_files.length+1 : 1);},0);\r\n//      var nof_posts_omitted = th.nof_posts - posts.length + posts_deleted.length;\r\n//      site2[th_old && th_old.domain_html || th.domain_html].page_json2html3_add_omitted_info_html(th, th_old, force_expander, nof_posts_omitted, nof_files_omitted); // 'th_old &&' is a patch for working regardless of pref.test_mode['140'], it can be removed when I fix the test_mode to true.\r\n//    },\r\n//    page_json2html3_add_omitted_info_html: function(th, th_old, force_expander, nof_posts_omitted, nof_files_omitted, from_initial) {\r\n//if (pref.test_mode['140']) {\r\n//      if (!th_old.pn_summary) {\r\n//        force_expander |= th.domain!==this.nickname;\r\n//        if (nof_posts_omitted>0 || force_expander) {\r\n//          var posts0 = th_old.posts? th_old.posts[0] : th.posts[0];\r\n//          var omit_info = posts0.pn.getElementsByClassName('omitted')[0];\r\n//          if (!omit_info) {\r\n//            omit_info = document.createElement('span');\r\n//            omit_info.setAttribute('class','omitted');\r\n////            omit_info.innerHTML = 'dummy<a href=\"javascript:void(0)\">Click to expand</a>.';\r\n//            omit_info.innerHTML = 'dummy';\r\n//            posts0.pn.appendChild(omit_info);\r\n//          }\r\n//          if (force_expander) omit_info.appendChild(cnst.config_expander(th.key));\r\n//          th_old.pn_summary = omit_info.childNodes[0];\r\n//        }\r\n//      }\r\n//      if (th_old.pn_summary && !from_initial)\r\n//        th_old.pn_summary.textContent = (nof_posts_omitted<=0)? 'Showing all replies.'\r\n//                                      : nof_posts_omitted +' post' + ((nof_posts_omitted!==1)? 's':'') +\r\n//                                        ((nof_files_omitted)? ' and ' + nof_files_omitted + ' image repl'+ ((nof_files_omitted===1)? 'y' : 'ies') : '') + ' omitted. ';\r\n//} else {\r\n//  var posts_old = th.posts.pn && th.posts;\r\n//      var omit_info = (posts_old)? posts_old[0].pn.getElementsByClassName('omitted')[0] : null;\r\n//      if (nof_posts_omitted!=0) {\r\n////      if (th.nof_posts>1) {\r\n//        if (!omit_info) {\r\n//          omit_info = document.createElement('span');\r\n//          omit_info.setAttribute('class','omitted');\r\n////          omit_info.innerHTML = 'dummy<a href=\"javascript:void(0)\">Click to expand</a>.';\r\n//          omit_info.innerHTML = 'dummy';\r\n//          omit_info.appendChild(cnst.config_expander(th.key));\r\n//          if (posts_old) posts_old[0].pn.appendChild(omit_info);\r\n//        }\r\n////        omit_info.childNodes[0].textContent = (nof_posts_omitted!==0)? (nof_posts_omitted +' post' + ((nof_posts_omitted!==1)? 's':'') +\r\n////          ((nof_files_omitted)? ' and ' + nof_files_omitted + ' image repl'+ ((nof_files_omitted===1)? 'y' : 'ies') : '') + ' omitted. ') : '';\r\n//        omit_info.childNodes[0].textContent = nof_posts_omitted +' post' + ((nof_posts_omitted!==1)? 's':'') +\r\n//          ((nof_files_omitted)? ' and ' + nof_files_omitted + ' image repl'+ ((nof_files_omitted===1)? 'y' : 'ies') : '') + ' omitted. ';\r\n//      } else if (omit_info) omit_info.childNodes[0].textContent = 'Showing all posts.'; //if (omit_info && posts_old) posts_old[0].pn.removeChild(omit_info);\r\n//      return omit_info;\r\n//}\r\n//    },\r\n    catalog_json2html3_thumbnail: function(obj, board) {\r\n      return ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://' + this.domain_url + board + 'thumb/' + obj.tim + obj.ext : '');\r\n    },\r\n    catalog_json2html3_src: function(obj, board) {\r\n      return ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png' || obj.ext==='.webm')? 'https://' + this.domain_url + board + 'src/' + obj.tim + obj.ext : '');\r\n    },\r\n    catalog_json2html3 : function(obj,board,thumb_url, make_footer) {\r\n      var th = document.createElement('div');\r\n      th.setAttribute('class','mix');\r\n      th.setAttribute('style','display: inline-block;');\r\n//      if (obj.ext==='.gif' || obj.ext==='.png') obj.ext='.jpg';\r\n//      if (obj.ext==='.gif' || obj.ext==='.jpeg') obj.ext='.jpg';\r\n      th.innerHTML = '<div class=\"thread grid-li grid-size-' + site2[site.nickname].catalog_native_size + '\">' +\r\n                     '<a href=\"' + site2[obj.domain].make_url4([obj.domain,obj.board,obj.no,'thread_html'])[0] + '\">' +\r\n//                     '<a href=\"' + thumb_url + '\">' +\r\n//                     '<a>' +\r\n                       '<img src=\"' + thumb_url +\r\n                       '\" id=\"img-' + obj.no +\r\n                       '\" data-subject=\"' + obj.sub +\r\n                       '\" data-name=\"' + obj.name +\r\n                       '\" data-muhdifference=\"\" data-last-reply=\"\" data-last-subject=\"\" data-last-name=\"\" data-last-difference=\"\"' +\r\n                       'class=\"' + board + ' thread-image\" title=\"' + new Date(obj.last_modified*1000).toLocaleString() + ' '+obj.ext + '\"></a>' +\r\n                     '<div class=\"replies\"><strong>' + (make_footer?' R: ' + (obj.nof_posts-1) +' / I: ' + obj.nof_files : '') + '</strong>' + \r\n                     ((obj.sub)? '<p class=\"intro\"><span class=\"subject\">' + obj.sub + '</span></p>' : '<br>') +\r\n                     obj.com + '</div></div>';\r\n      return th;\r\n    },\r\n//    catalog_json2html3 : function(obj,board) {\r\n//      th = document.createElement('div');\r\n////      if (obj.ext==='.gif' || obj.ext==='.png') obj.ext='.jpg';\r\n//      if (obj.ext==='.gif' || obj.ext==='.jpeg') obj.ext='.jpg';\r\n//      th.innerHTML = '<div class=\"thread grid-li grid-size-small\"><a href=\"'\r\n//                   + site2['8chan'].make_url3(board,obj.no) + '\"><img src=\"'\r\n//                   + ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://' + site2['8chan'].domain_url + board + 'thumb/' + obj.tim + obj.ext : '')\r\n//                   + '\" id=\"img-'\r\n//                   + obj.no  + '\" data-subject=\"'\r\n//                   + obj.sub + '\" data-name=\"'\r\n//                   + obj.name+ '\" data-muhdifference=\"\" data-last-reply=\"\" data-last-subject=\"\" data-last-name=\"\" data-last-difference=\"\"'\r\n////                   + 'class=\"scriptcdc thread-image\" title=\"' + new Date(obj.last_modified*1000).toLocaleString() +'\"></a>'\r\n//                   + 'class=\"'+board+' thread-image\" title=\"' + new Date(obj.last_modified*1000).toLocaleString() + ' '+obj.ext + '\"></a>'\r\n//                   + '<div class=\"replies\"><strong>R: '\r\n//                   + obj.replies +' / I: '\r\n//                   + (obj.images+obj.omitted_images)\r\n////                   + ((pref.catalog_footer_show_board_name)? ' '+board : '')\r\n//                   + '</strong>'\r\n//                   + ((obj.sub)? '<p class=\"intro\"><span class=\"subject\">' + obj.sub + '</span></p>' : '')\r\n//                   + obj.com + '</div></div>';\r\n//      return th;\r\n//    },\r\n    catalog_from_json3 : function(obj,board) {\r\n      var ths;\r\nif (pref.test_mode['0']) {\r\n      ths = {domain:'8chan', board:site.board, obj:obj};\r\n      this.parse_funcs['catalog_json'].entry(ths,this.parse_funcs['catalog_json']['full_hier']);\r\n} else {\r\n//      ths = {domain:'8chan', board:board, obj:obj, parse_funcs:this.parse_funcs['catalog_json'], __proto__:site4.parse_funcs_on_demand};\r\n////      var parse_obj = {domain:'8chan', board:board, parse_funcs:this.parse_funcs['catalog_json'], __proto__:site4.parse_funcs_on_demand};\r\n////      ths = {obj:obj, __proto__:parse_obj};\r\n      return site2[this.nickname].wrap_to_parse.get(obj, this.nickname, board, 'catalog_json');\r\n}\r\n      return ths.ths;\r\n    },\r\n//    catalog_json2html2 : function(obj,board) {\r\n//      th = document.createElement('div');\r\n//      th.setAttribute('data-reply',obj.replies);\r\n//      th.setAttribute('data-bump',obj.last_modified);\r\n//      th.setAttribute('data-time',obj.time);\r\n////      if (obj.ext==='.gif' || obj.ext==='.png') obj.ext='.jpg';\r\n//      if (obj.ext==='.gif' || obj.ext==='.jpeg') obj.ext='.jpg';\r\n//      th.innerHTML = '<div class=\"thread grid-li grid-size-small\"><a href=\"'\r\n//                   + site2['8chan'].make_url3(board,obj.no) + '\"><img src=\"'\r\n////                   + ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://media.' + site2['8chan'].domain_url + board + 'thumb/' + obj.tim + obj.ext : '')\r\n//                   + ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://' + site2['8chan'].domain_url + board + 'thumb/' + obj.tim + obj.ext : '')\r\n//                   + '\" id=\"img-'\r\n//                   + obj.no  + '\" data-subject=\"'\r\n//                   + obj.sub + '\" data-name=\"'\r\n//                   + obj.name+ '\" data-muhdifference=\"\" data-last-reply=\"\" data-last-subject=\"\" data-last-name=\"\" data-last-difference=\"\"'\r\n////                   + 'class=\"scriptcdc thread-image\" title=\"' + new Date(obj.last_modified*1000).toLocaleString() +'\"></a>'\r\n//                   + 'class=\"scriptcdc thread-image\" title=\"' + new Date(obj.last_modified*1000).toLocaleString() + ' '+obj.ext + '\"></a>'\r\n//                   + '<div class=\"replies\"><strong>R: '\r\n//                   + obj.replies +' / I: '\r\n//                   + (obj.images+obj.omitted_images)\r\n////                   + ((pref.catalog_footer_show_board_name)? ' '+board : '')\r\n//                   + '</strong>'\r\n//                   + ((obj.sub)? '<p class=\"intro\"><span class=\"subject\">' + obj.sub + '</span></p>' : '')\r\n//                   + obj.com + '</div></div>';\r\n//      return th;\r\n//    },\r\n//    catalog_from_json2 : function(doc_json,board) {\r\n//    catalog_from_json2 : function(obj,board) {\r\n////      var obj = JSON.parse(doc_json);\r\n//      var ths = [];\r\n//      for (var i=0;i<obj.length;i++)\r\n//        for (var j=0;j<obj[i].threads.length;j++) {\r\n//          var name = '8chan' + board + obj[i].threads[j].no;\r\n//          var pn = site2['8chan'].catalog_json2html2(obj[i].threads[j],board);\r\n//          ths.push(site2['8chan'].catalog_from_native_1(pn,board));\r\n//          ths[ths.length-1][14] = i + '.' +j;\r\n//        }\r\n//      return ths;\r\n//    },\r\n    patch:{\r\n      expand_thumbnail_inline_load: function(){\r\n        var pnode = this.parentNode && this.parentNode.parentNode;\r\n        if (pnode && pnode.classList && pnode.classList.contains('multifile') && pnode.style.width) { // patch for multifile in vichan\r\n          this.setAttribute('data-originalWidth',pnode.style.width);\r\n          pnode.style = '';\r\n        }\r\n      },\r\n    },\r\n    proto : 'DEFAULT'\r\n  };\r\n}\r\nif (pref.features.domains['KC']) { \r\n  site2['KC'] = {\r\n    nickname : 'KC',\r\n    domain_url: 'krautchan.net',\r\n//    features : {thread_reader: true},\r\n    components: {\r\n      boardlist: '.menu',\r\n      postform_comment: '#postform_comment',\r\n      postform_submit: '#postform_submit',\r\n    },\r\n    make_tack: function(){\r\n      var tack = document.createElement('img');\r\n      tack.setAttribute('src','/images/sticky.gif');\r\n      return tack;\r\n    },\r\n//    postform: {\r\n//      init:function(){\r\n//        this.tack = site2[site.nickname].make_tack();\r\n//        this.tack.setAttribute('style','float:right;font-size:2em;');\r\n//        site.postform.parentNode.insertBefore(this.tack,site.postform);\r\n//        return this.tack;\r\n//      },\r\n//      __proto__:site2['DEFAULT'].postform\r\n//    },\r\n    boards_json: site2['DEFAULT'].generate_boards_json(\r\n      [['b',15],['int',20],'vip',\r\n       'a','c','co','d','e','f','fb','fe','fit','jp','k','l','li',['m',5],'n','ng','p','ph','prog','sp',\r\n       't',['trv',18],'tu','tv','v','w','we','wk','wp','z','zp','ft','r',['h',8],'s','bans','kc','rfk',['rvss',15]], 10),\r\n    check_func : function(){\r\n      if (!site2['KC'].force_https) site2['KC'].protocol = site.protocol;\r\n      var href = window.location.href;\r\n      if (href.search(/krautchan.net/)!=-1) { // Krautchan\r\n        site.whereami = (document.head.innerHTML.indexOf('404 Not Found')!=-1)? '404'\r\n                      : (href.search(/krautchan\\.net\\/?$/)!=-1)? 'frame'\r\n                      : (href.search(/catalog/)!=-1)? 'catalog'\r\n                      : (href.search(/thread/)!=-1)? 'thread'\r\n                      : (href.search(/\\/$|(index|[0-9]+)\\.html|\\/#all$/)!=-1)? 'page'\r\n                      : 'other';\r\n        if (site.whereami==='page' || site.whereami==='thread') {\r\n          this.components.boardlist = 'body > div:nth-child(3)';\r\n          delete this.show_boardlist_physical_extract_func;\r\n        }\r\n        site.config('krautchan.net','KC');\r\n        site.max_page  = (site2['KC'].max_page_kc[site.board]==undefined)? 10 : site2['KC'].max_page_kc[site.board];\r\n        if (site.whereami==='catalog') {\r\n          if (href[href.length-1]==='/') href = href.substr(0,href.length-1);\r\n          site.board = href.substr(href.lastIndexOf('/'))+'/';\r\n        }\r\n        if (site.whereami==='frame') {\r\n          site.root_body2 = document.createElement('div');\r\n          site.embed_frame = 'main';\r\n          site.embed_frame_win = main;\r\n          navigation.onload = function(){\r\n            site.root_body = navigation.document.body;\r\n            site.root_body.appendChild(site.root_body2);\r\n          };\r\n        }\r\n        site.embed_to = (site.whereami==='thread' || site.whereami==='page')? {\r\n          top: function(){return document.querySelector('form[action=\"/delete\"]');},\r\n          bottom: function(){return document.querySelector('form[action=\"/delete\"]').nextSibling;}} : {};\r\n//        if (site.whereami==='thread' || site.whereami==='page') {\r\n//          site.embed_to['top']    = document.querySelector('form[action=\"/delete\"]');\r\n//          site.embed_to['bottom'] = document.querySelector('form[action=\"/delete\"]').nextSibling;\r\n////        } else if (site.whereami==='catalog') {\r\n////          site.embed_to['top']    = document.getElementsByTagName('header')[0].nextSibling;\r\n////          site.embed_to['bottom'] = document.getElementsByTagName('footer')[0];\r\n//        }\r\n        site.postform = document.getElementById('postform');\r\n        site.postform_rules = document.getElementById('rules_row');\r\n////        this.pref_default(pref); // working code.\r\n        return true;\r\n      } else return false;\r\n    },\r\n////    pref_default: function(pref){ // working code.\r\n////      pref.thread_reader.own_posts_tracker = true;\r\n////      pref.thread_reader.check_num_of_children = false;\r\n////    },\r\n    force_https : false,\r\n    protocol : 'https:',\r\n//    home : site.protocol + '//krautchan.net', // cause memory leak\r\n    home : site.protocol + '//krautchan.net/regeln.html',\r\n//    home : site.protocol + '//krautchan.net/favicon.ico',\r\n    show_boardlist_physical_extract_func: function(key){return key.substr(1,key.length-2);},\r\n    catalog_frame_prep: function(pn12){\r\n      var source = [navigation.document.body, main.document.body];\r\n//      for (var i=0;i<2;i++) {\r\n//        var container = document.createElement('div');\r\n//        container.style.display = 'none';\r\n//        while (source[i].childNodes.length!=0) container.appendChild(source[i].childNodes[0]);\r\n//        source[i].appendChild(container);\r\n//      }\r\n      site2['common'].absorb_children(source[0]).style.display = 'none';\r\n      site2['common'].absorb_children(source[1]).style.display = 'none';\r\n      source[0].insertBefore(pn12,source[0].firstChild);\r\n      source[0].insertBefore(pn12,source[0].firstChild);\r\n      site.root_body.appendChild(site.root_body2);\r\n      this.catalog_embed_prep(pn12);\r\n    },\r\n////    catalog_background : '#cfcede',\r\n////    catalog_background : '#dadafc',\r\n//    catalog_background : '#e0e0fc',\r\n//    catalog_bordercolor : '#aaaacc',\r\n//    catalog_threads_in_page : function(doc){return doc.getElementsByClassName('thread');},\r\n    catalog_threads_in_page : function(doc){return doc.getElementsByClassName('thread_body');},\r\n//    remove_posts : function(doc){\r\n//      var threads_body = doc.getElementsByClassName('thread_body');\r\n//      var posts = [];\r\n//      for (var i=0;i<threads_body.length;i++) {\r\n//        posts_in_thread = threads_body[i].getElementsByTagName('table');\r\n//        for (var j=0;j<posts_in_thread.length;j++) posts.push(posts_in_thread[j]);\r\n//      }\r\n//      for (var i=posts.length-1;i>=0;i--) posts[i].innerHTML = '';\r\n//      return doc;\r\n//    },\r\n    max_page_kc : {\r\n      '/int/' : 20,\r\n      '/b/'   : 15,\r\n      '/trv/' : 13,\r\n      '/m/'   : 5\r\n    },\r\n    max_page: function(bn){return site2['KC'].max_page_kc[bn];},\r\n    make_url4 : function(dbt){\r\n      var url_prefix = this.protocol + '//' + this.domain_url;\r\n      dbt[3] = dbt[3].replace(/_json/,'_html');\r\n      if      (dbt[3]==='page_html')    return [url_prefix + dbt[1] + ((dbt[2]==0)? '' : dbt[2] + '.html'), 'html'];\r\n      else if (dbt[3]==='catalog_html') return [url_prefix + '/catalog' + dbt[1].substr(0,dbt[1].length-1), 'html'];\r\n      else if (dbt[3]==='thread_html')  return [url_prefix + dbt[1] + 'thread-' + dbt[2] + '.html', 'html'];\r\n    },\r\n    trim_list: 'no',\r\n//////////    make_url : function(board,no){return [site2['KC'].protocol + '//krautchan.net' + board + ((no==0)? '' : no + '.html'), 'html'];}, // working code.\r\n////////    make_url : function(board,no,key){\r\n////////      var url_prefix = site2['KC'].protocol + '//krautchan.net';\r\n////////      return (key==='p')? [url_prefix + board + ((no==0)? '' : no + '.html'), 'html'] : \r\n////////                          [url_prefix + '/catalog' + board.substr(0,board.length-1),'html'];\r\n////////    },\r\n////////    make_url3: function(board,th){return  site2['KC'].protocol + '//krautchan.net' + board + 'thread-' + th + '.html';},\r\n    get_next_image: function(img,top){\r\n      var imgs = Array.prototype.slice.call(document.querySelectorAll('img[id^=thumbnail]')).filter(function(v){return v.src.substr(-5,5)!=='.webm';});\r\n//      var imgs = cataLog.parent.querySelectorAll('img[id^=\"thumbnail\"]');\r\n      return site2['DEFAULT'].get_next_image(img,top,imgs);\r\n    },\r\n    get_ops : function(doc){\r\n      var ops = [];\r\n      var divs = doc.getElementsByTagName('div');\r\n      for (var i=0;i<divs.length;i++)\r\n        if (divs[i].className == 'thread' || divs[i].className == 'thread kc_showReplies')\r\n          ops.push(divs[i].id.substring(7)); // substring(7) for removing 'thread_'\r\n      return ops;\r\n    },\r\n    get_posts : function(doc) {\r\n      var posts = [];\r\n      var anchors = doc.getElementsByTagName('a');\r\n      for (var i=0;i<anchors.length;i++) if (anchors[i].name != '') posts.push(anchors[i].name);\r\n      return posts;\r\n    },\r\n////////    get_thread_link : function(pn,boardname,del){\r\n//////////      var keyword = (boardname=='/int/')? 'Reply' : 'Antworten';\r\n////////      var as = pn.getElementsByClassName('postheader')[0].getElementsByTagName('a');\r\n//////////      for (var i=0;i<as.length;i++) if (as[i][brwsr.innerText]==keyword) return as[i].getAttribute('href');\r\n//////////      for (var i=0;i<as.length;i++) if (as[i].innerHTML==keyword) {\r\n////////      for (var i=0;i<as.length;i++) if (as[i][brwsr.innerText]=='Reply' || as[i][brwsr.innerText]=='Antworten') {\r\n////////        var href = as[i].getAttribute('href');\r\n////////        if (del) {\r\n////////          var j=0;\r\n////////          var parent = as[i].parentNode;\r\n////////          while (parent.childNodes[j]!=as[i]) j++;\r\n////////          parent.removeChild(parent.childNodes[j+1]);\r\n////////          parent.removeChild(as[i]);\r\n////////          parent.removeChild(parent.childNodes[j-1]);\r\n////////        } else as[i].setAttribute('target',(pref.catalog_open_in_new_tab)? '_blank' : '_self');\r\n////////        return href;\r\n////////      }\r\n////////      return null;\r\n////////    },\r\n    modify_thread_link : function(pn){\r\n      var retval = [];\r\n      var as = pn.getElementsByClassName('postheader')[0].getElementsByTagName('a');\r\n      for (var i=0;i<as.length;i++) if (as[i][brwsr.innerText]=='Reply' || as[i][brwsr.innerText]=='Antworten') {\r\n        var href = as[i].getAttribute('href');\r\n        retval.push([as[i],href]);\r\n        as[i].removeAttribute('href');\r\n      }\r\n      return retval;\r\n    },\r\n//    add_thread_link : function(doc,url){\r\n//      var pn = document.createElement('a');\r\n//      pn.href = url.replace(/https*:\\/\\/krautchan\\.net/,'');\r\n//      pn.innerHTML = 'Reply';\r\n//      var th = doc.getElementsByClassName('postheader')[0];\r\n//      if (th) {\r\n//        th.insertBefore(pn,th.firstChild);\r\n//        th.insertBefore(document.createTextNode('['),pn);\r\n//        th.insertBefore(document.createTextNode(']'),pn.nextSibling);\r\n//      }\r\n//    },\r\n    time_offset : 1, // 1 for usual, 2 for summer time.\r\n//    get_time_of_posts : function(doc){ // working code.\r\n//      var postdates = doc.getElementsByClassName('postdate');\r\n//      return [parseInt(brwsr.Date_parse(postdates[postdates.length-1][brwsr.innerText]),10) - site2['KC'].time_offset*3600000,\r\n//              parseInt(brwsr.Date_parse(postdates[0                 ][brwsr.innerText]),10) - site2['KC'].time_offset*3600000];\r\n//    },\r\n//    get_time_of_posts : function(th){ // cause error\r\n//      var posts = th.getElementsByTagName('table');\r\n//      return [site2['KC'].get_time_of_post_in_utc(posts[posts.length-1]),site2['KC'].get_time_of_post_in_utc(posts[0])];\r\n//    },\r\n//    get_time_of_post_in_utc : function(post){ // working code\r\n//      var postdates = post.getElementsByClassName('postdate');\r\n//      if (postdates[0]) return parseInt(brwsr.Date_parse(postdates[0][brwsr.innerText]),10) - site2['KC'].time_offset*3600000;\r\n//    },\r\n//    mark_newer_posts: function(th,date,unmark, short_cut) {\r\n//      var pn = site2['DEFAULT'].mark_newer_posts('KC',th.getElementsByTagName('table'),date, function(post){return post.getElementsByClassName('postreply')[0];}, unmark, short_cut);\r\n//      return (pn!=null)? pn.offsetParent : null;\r\n//    },\r\n    localtime: function(pn){\r\n      var postdate = pn.getElementsByClassName('postdate')[0];\r\n      if (postdate) {\r\n        var lt = postdate.cloneNode(false);\r\n        lt.setAttribute('class','CatChan_localtime');\r\n        lt.textContent = site2.common.change_utc_to_local(site2['KC'].parse_funcs.post_html.time_pn_1(postdate)); // use direct path to hope to be inline optimized.\r\n        postdate.parentNode.insertBefore(lt,postdate.nextSibling);\r\n        postdate.setAttribute('style','display:none');\r\n      }\r\n//      var times = pn.getElementsByClassName('postdate');\r\n//      for (var i=0;i<times.length;i++) times[i].textContent = site2.common.change_utc_to_local(Date.parse(times[i][brwsr.innerText])-site2['KC'].time_offset*3600000);\r\n//      for (var i=0;i<times.length;i++) times[i].textContent = site2.common.change_utc_to_local(brwsr.Date_parse(times[i][brwsr.innerText])-site2['KC'].time_offset*3600000);\r\n    },\r\n    remove_files_info : function(th){\r\n      site2.common.remove_by_classname(th,'filename');\r\n      site2.common.remove_by_classname(th,'fileinfo');\r\n      var imgs = th.getElementsByTagName('img');\r\n      for (var i=0;i<imgs.length;i++) if (imgs[i].id && imgs[i].id.search('thumbnail')!=-1) {\r\n        imgs[i].removeAttribute('onmouseover');\r\n        imgs[i].removeAttribute('onmouseout');\r\n        imgs[i].removeAttribute('onload');\r\n        site2.common.move_up_and_delete_parent([imgs[i]]);\r\n      }\r\n      var files = th.getElementsByClassName('file_thread');\r\n      for (var i=0;i<files.length;i++) site2.common.remove_brs(files[i]);\r\n      for (var i=0;i<files.length;i++) site2.common.remove_by_attribute([files[i]],'id','filename');\r\n//      site2.common.remove_by_classname(th,'file_thread');\r\n//      site2.common.remove_by_classname(th,'postbody');\r\n    },\r\n////////    insert_footer : function(th,page_no,bn,exe,date,nof_posts,nof_files){\r\n////////      var key = (!brwsr.ff)? 'innerText' : 'innerHTML';\r\n////////      var posts = th.getElementsByTagName('table');\r\n////////      nof_posts += posts.length +1; // +1 for OP.\r\n////////      var files = th.getElementsByClassName('file_thread');\r\n////////      nof_files += th.getElementsByClassName('filename').length;\r\n////////      var om_info = th.getElementsByClassName('omittedinfo');\r\n////////      if (om_info[0]) {\r\n////////        var str = om_info[0][key].replace(/\\n/g,'');\r\n////////        nof_posts += parseInt(str.replace(/\\ post.*/,''),10);\r\n////////        nof_files += parseInt('0'+str.replace(/\\ file.*/,'').replace(/[^\\ ]*\\ /g,''),10);\r\n////////      }\r\n////////      if (exe) {\r\n////////        var pn = document.createElement('div');\r\n//////////        pn.name = 'catalog_footer';\r\n////////        pn.setAttribute('name','catalog_footer');\r\n//////////        pn[key] = bn + '  ' + nof_posts + '/' + nof_files + '/' + page_no + '  ';\r\n////////        pn.innerHTML = '<span>' + bn + '  ' + nof_posts + '/' + nof_files + '/' + page_no + '  </span>';\r\n////////        var imgs = th.getElementsByTagName('img');\r\n////////        for (var i=0;i<imgs.length;i++) {\r\n//////////          if (imgs[i].src && imgs[i].getAttribute('src').search(/images\\/balls/)!=-1) pn.appendChild(imgs[i].cloneNode(false)); // doesn't work in KC.\r\n////////          if (imgs[i].getAttribute('src') && imgs[i].getAttribute('src').search(/images\\/balls/)!=-1) pn.appendChild(imgs[i].cloneNode(false));\r\n////////        }\r\n////////        th.insertBefore(pn,files[0]);\r\n////////      }\r\n////////      return [nof_posts,nof_files];\r\n////////    },\r\n    remove_posts : function(th,end){\r\n//      site2.common.remove_by_tagname(th,'table',end);\r\n//      site2.common.remove_double_tags(th,'A');\r\n      var tgts = th.getElementsByTagName('table');\r\n      for (var i=tgts.length-1-end;i>=0;i--) {\r\n        if (tgts[i].previousSibling.previousSibling) tgts[i].parentNode.removeChild(tgts[i].previousSibling.previousSibling); // a tags\r\n        tgts[i].parentNode.removeChild(tgts[i].previousSibling); // text\r\n//if (!pref.test_mode['14']) tgts[i].setAttribute('style','display:none;'+(tgts[i].getAttribute('style') || ''));\r\n//else\r\n        tgts[i].parentNode.removeChild(tgts[i]);\r\n      }\r\n    },\r\n    format_thread_layout : function(th){\r\n      site2.common.add_attribute_by_classname(th,'file_thread','style','float:left;margin:5px');\r\n      site2.common.add_attribute_by_classname(th,'file_reply','style','float:left;margin:5px');\r\n      th.getElementsByTagName('blockquote')[0].setAttribute('style','margin:5px;clear:both');\r\n//      var ph = th.getElementsByClassName('postheader');\r\n//      th.insertBefore(ph,th.getElementsByClassName('postbody')[0]);\r\n    },\r\n    format_thread_style : function(th){\r\n      site2.common.add_attribute_by_classname(th,'postreply','style','background:#cacaec');\r\n    },\r\n    format_thread_contents : function(th){\r\n      site2.common.remove_by_tagname(th,'input');\r\n      site2.common.remove_by_classname(th,'report_parent');\r\n      site2.common.remove_by_attribute(th.getElementsByClassName('postheader'),'onclick','hideThread');\r\n      site2.common.remove_by_attribute(th.getElementsByClassName('file_thread'),'onclick','toggleThumbnail');\r\n//      site2.common.add_attribute_by_attribute(th.getElementsByClassName('file_thread'),'onclick','toggleThumbnail','style','display:none');\r\n      site2.common.remove_by_attribute(th.getElementsByClassName('file_thread'),'href','shipainter');\r\n//      site2.common.remove_by_classname(th,'thread_hidden');\r\n      site2.common.remove_by_tagname(th,'hr');\r\n//      site2.common.remove_by_tagname(th,'br');\r\n      site2.common.remove_by_classname(th,'omittedinfo');\r\n    },\r\n    preprocess_html : function(doc_txt,page){ // cause memory leak in chrome, but fail without this in FF or GreaseMonkey.\r\n      if (doc_txt) {\r\n//        if (page) while (doc_txt.search(/<script[>\\ ](.|\\n)*<\\/script>/)!=-1) doc_txt = doc_txt.replace(/<script[>\\ ](.|\\n)*<\\/script>/,''); // slower execution.\r\n//        while (doc_txt.search(/onload=\"imageFinishedLoading\\([0-9]*\\)\"/)!=-1) doc_txt = doc_txt.replace(/onload=\"imageFinishedLoading\\([0-9]*\\)\"/,''); // slower execution.\r\n//        if (page) doc_txt = doc_txt.replace(/<script[>\\ ](.|\\n)*<\\/script>/mg,''); // cause leak in Chrome, probably a bug.\r\n        if (page) doc_txt = doc_txt.replace(/<script[> ].*<\\/script>/mg,''); // cause leak in Chrome, probably a bug. (remove \\n)\r\n        doc_txt = doc_txt.replace(/onload=\"imageFinishedLoading\\([0-9]*\\)\"/mg,''); // cause leak in Chrome, probably a bug.\r\n// sanitize\r\n        doc_txt = doc_txt.replace(/onmouseover=\"[^\"]*\"/mg,'');\r\n        doc_txt = doc_txt.replace(/onmouseout=\"[^\"]*\"/mg,'');\r\n        doc_txt = doc_txt.replace(/onclick=\"[^\"]*\"/mg,'');\r\n      }\r\n      return doc_txt;\r\n    },\r\n//    preprocess_doc : function(doc){\r\n////      site2.common.remove_by_tagname(doc,'script');\r\n//      site2.common.remove_attribute(doc,'onload');\r\n//      site2.common.remove_attribute(doc,'onmouseover');\r\n//      site2.common.remove_attribute(doc,'onmouseout');\r\n//      site2.common.remove_attribute(doc,'onclick');\r\n//\r\n//      site2.common.remove_attribute(doc,'onchange');\r\n//      site2.common.remove_attribute(doc,'onfocus');\r\n//      site2.common.remove_attribute(doc,'onsubmit');\r\n//var pns = doc.getElementsByTagName('*');\r\n//for (var i=pns.length-1;i>=0;i--)\r\n//  if (pns[i].getAttribute && pns[i].getAttribute('href') && pns[i].getAttribute('href').indexOf('javascript:')==0) pns[i].removeAttribute('href');\r\n//\r\n//if (pref.test_mode['28']) {\r\n//      doc.getElementsByTagName('html')[0].innerHTML = doc.getElementsByTagName('html')[0].innerHTML; // remake to sanitize. // Leak is caused by DOMParser itself.\r\n//}\r\n//    },\r\n////////    thread2headline : function(doc){\r\n////////      return site2.common.thread2headline(doc,'KC');\r\n////////    },\r\n    catalog_native_prep: function(pn_filter,pn_tb,pn_hi){\r\n      var node_ref = (site.whereami==='catalog')? document.getElementsByClassName('catalog')[0]\r\n                                                : document.querySelector('form[action=\"/delete\"]');\r\n//      var node_ref = (site.whereami==='catalog')? document.getElementById('settings')\r\n//                                                : document.getElementsByName('postcontrols')[0];\r\n//      pn_tb.setAttribute('style', 'float:right');\r\n//      if (site.whereami==='catalog') {\r\n      var selector_catchan = pn_filter.getElementsByTagName('select')['catalog.order.ordering'];\r\n      selector_catchan.setAttribute('style','float:left');\r\n      node_ref.parentNode.insertBefore(selector_catchan,node_ref);\r\n      pn_tb.childNodes[3].setAttribute('style','float:left');\r\n      node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n////////      return site2['KC'].catalog_from_native(date,document,site.board,site.whereami+'_html');\r\n    },\r\n////////    catalog_from_native : function(date,doc,board,type) { // working code.\r\n////////      return site2[this.nickname].wrap_to_parse.get(doc, this.nickname, board, type);\r\n////////////      var parse_obj = {domain:'KC', board:board, parse_funcs:site2['KC'].parse_funcs[type], __proto__:site4.parse_funcs_on_demand};\r\n////////////      var ths = {pn:doc, __proto__:parse_obj};\r\n////////////      return ths.ths;\r\n////////    },\r\n    catalog_get_native_area: function(){\r\n      if (site.whereami==='page') return document.querySelector('form[action=\"/delete\"]');\r\n      else return document.getElementsByClassName('catalog')[0];\r\n    },\r\n////    get_click_area: function(pn, th){\r\n////      var areas = [];\r\n////      if (th.type_html==='catalog_html') {\r\n////        var tn = pn.getElementsByClassName('thumbnail');\r\n////        for (var i=0;i<tn.length;i++) areas.push(tn[i].getElementsByTagName('img')[0]);\r\n////      } else if (th.type_html==='page_html') {\r\n////        var fths = pn.getElementsByClassName('file_thread');\r\n////        for (var i=0;i<fths.length;i++) {\r\n////          var imgs = fths[i].getElementsByTagName('img');\r\n////          areas.push(imgs[imgs.length-1]);\r\n////        }\r\n////      }\r\n////      return (areas.length!=0)? areas : [pn]; \r\n////    },\r\n//    get_click_area: function(pn, th){\r\n//      if (th.type_html==='catalog_html') {\r\n//        var tn = pn.getElementsByClassName('thumbnail');\r\n//        return (tn[0])? tn[0].getElementsByTagName('img')[0] : pn;\r\n//      } else if (th.type_html==='page_html') {\r\n//        var imgs = pn.getElementsByClassName('file_thread')[0].getElementsByTagName('img');\r\n//        return imgs[imgs.length-1];\r\n//      }\r\n//    },\r\n    no_JSONAPI: true,\r\n    parse_funcs : { // KC\r\n      'catalog_html' : {\r\n        ths: function(doc) {\r\n          var ths = this.ths_array(doc,doc.pn.getElementsByClassName('thread'));\r\n          var t = Date.now() - pref.localtime_offset*3600000; // patch\r\n          for (var i=0;i<ths.length;i++) {\r\n            if (ths[i].time_bumped<0) ths[i].time_bumped += t;\r\n//            var as = ths[i].pn.getElementsByTagName('a');\r\n//            for (var j=0;j<as.length;j++) as[j].removeAttribute('href');\r\n          }\r\n          return ths;\r\n        },\r\n//        th_init: function(th) {\r\n//          var as = th.pn.getElementsByTagName('a');\r\n//          for (var j=0;j<as.length;j++) as[j].addEventListener('click',th.parse_funcs.preventDefault,false);\r\n//        },\r\n//        th_destroy: function(pn, parse_funcs){\r\n//          var as = pn.getElementsByTagName('a');\r\n//          for (var j=0;j<as.length;j++) as[j].removeEventListener('click',parse_funcs.preventDefault,false);\r\n//        },\r\n\r\n        no : function(th){return parseInt(th.pn.getAttribute('id').substr(7),10);}, // the same as 4chan.\r\n//        time_bumped: function(th){return 0;},\r\n        time_bumped: function(th){\r\n          return -1 -parseInt(th.page.substr(0,th.page.indexOf('.')),10)*16 - parseInt(th.page.substr(th.page.indexOf('.')+1));},\r\n        time_created : function(th){return 0;},\r\n        nof_posts: function(th){\r\n          var footer = th.pn.getElementsByClassName('omitted_text')[0];\r\n//          Object.defineProperty(th, 'footer', {value:footer, enumerable:true, writable:true, configurable:true});\r\n//          footer.innerHTML = '';\r\n          var nof_posts = (footer)? parseInt(footer.textContent.match(/[0-9]+/),10) : 0;\r\n          return (isNaN(nof_posts))? 1 : nof_posts + 1;\r\n        },\r\n        nof_files: function(th){return 0;},\r\n        key: function(th){return th.domain + th.board + th.no;},\r\n        sub: function(th){\r\n          var sub = th.pn.getElementsByTagName('header')[0].textContent.trim();\r\n          return (sub.search(/^#[0-9]+$/)==0)? '' : sub;\r\n        },\r\n        name: function(th){return '';},\r\n//        com: function(th){return th.pn.getElementsByTagName('section')[0][brwsr.innerText];},\r\n        com: function(th){return th.pn.getElementsByTagName('section')[0].innerHTML;},\r\n        type_com: 'html',\r\n        footer: function(th){\r\n          var footer = th.pn.getElementsByClassName('omitted_text')[0]; // must parse pn because of mimic mode.\r\n          footer.innerHTML = '';\r\n          return footer;\r\n        },\r\n        sticky: function(th){return false;},\r\n//        format: function(th){th.pn.getElementsByTagName('a')[0].removeAttribute('href');return null;},\r\n        op_img_url:function(th){\r\n//          var img = th.pn.getElementsByClassName('thumbnail')[0].getElementsByTagName('img');\r\n          var tn  = th.pn.getElementsByClassName('thumbnail');\r\n          var img = (tn[0])? tn[0].getElementsByTagName('img') : null; // parse other site's html\r\n          var url = (img && img[img.length-1])? img[img.length-1].getAttribute('src') : undefined;\r\n          return url;\r\n        },\r\n        get_op_src: 'thread_html',\r\n        filename: function (th){ // post can be accepted.\r\n          var op = th.pn.classList.contains('thread') || th.pn.classList.contains('thread_body');\r\n          var files = th.pn.getElementsByClassName('post_files')[0].getElementsByTagName('figure');\r\n          if (files) \r\n            for (var i=0;i<files.length;i++) {\r\n              var href = files[i].getElementsByTagName('img')[0].getAttribute('src');\r\n              if (i===1) th.extra_files = [];\r\n              if (i>=1) th.extra_files[i-1] = {domain:th.domain, board:th.board};\r\n              var idx = href.lastIndexOf('/');\r\n              var tgt = (i===0)? th : th.extra_files[i-1];\r\n//              tgt.filename = href.substr(idx+1);\r\n              tgt.filename = files[i].getElementsByTagName('img')[0].getAttribute('alt');\r\n//              tgt.filename_server = href.substr(0,idx).replace(/[^\\/]*\\//g,'');\r\n              tgt.filename_server = href.substr(idx+1);\r\n            }\r\n          return th.filename;\r\n        },\r\n        prep_mimic: 'page_html',\r\n        tn_imgs: function(){return [];}, // dynamic, or function(th){return th.pn.getElementsByClassName('thumbnail');},\r\n        img2src: function(img){return th.op_img_url.replace('thumbnails','files');},\r\n        dynamic_image_hover: true,\r\n      },\r\n      'catalog_json' : {\r\n        proto: 'catalog_html',\r\n      },\r\n      'page_html' : {\r\n        ths: function(doc) {return this.ths_array(doc, doc.pn.getElementsByClassName('thread'));},\r\n        th_init: function(th) {\r\n          th.pn.removeAttribute('class');\r\n          th.pn.style.clear = 'none';\r\n        },\r\n//        th_destroy: function(pn, parse_funcs){},\r\n//        no : function(th){return th.pn.id.substr(7);},\r\n//        no : function(th){return parseInt(th.pn.id.substr((th.pn.classList.contains('thread'))? 7:5),10);}, // page and posts\r\n        no : function(th){ // page and posts\r\n          return parseInt((th.pn.id)? th.pn.id.replace(/[^_\\-]*./,'') : // /int/\r\n                                      th.pn.getElementsByClassName('postnumber')[0].getElementsByTagName('a')[1].textContent, 10);}, // other boards.\r\n//        ths: function(doc) { // working code.\r\n//          var ths = this.ths_array(doc, doc.pn.getElementsByClassName('thread'));\r\n//          for (var i=0;i<ths.length;i++) {\r\n//            Object.defineProperty(ths[i], 'no', {value:ths[i].pn.id.substr(7), enumerable:true, writable:true, configurable:true});\r\n//            ths[i].pn.removeAttribute('class'); // collection ISN'T writable? and if wrote, its enumerator doesn't work.\r\n//            ths[i].pn.style.clear = 'none';\r\n//          }\r\n//          return ths;\r\n//        },\r\n//        no : function(th){return parseInt(th.pn.getElementsByClassName('quotelink')[0][brwsr.innerText],10);},\r\n        posts: function(th){return this.posts_array(th, th.pn.querySelectorAll('.thread_body, td.postreply'));},\r\n//        posts: function(th){return this.posts_array(th, th.pn.querySelectorAll('.thread_body, .postreply'));}, // doesn't work for thread_reader.\r\n//        posts: function(th){ // working code.\r\n//          var posts = [];\r\n//          posts[0] = {pn:th.pn.getElementsByClassName('thread_body')[0], __proto__:th.__proto__}; // OP\r\n//          var replies = th.pn.getElementsByClassName('postreply');\r\n//          for (var i=0;i<replies.length;i++) posts[posts.length] = {pn:replies[i], __proto__:th.__proto__};\r\n//          return posts;\r\n//        },\r\n        time: 'post_html.time',\r\n        nof_posts: function(th){\r\n          var nof_posts = th.pn.getElementsByTagName('table').length +1; // +1 for OP.\r\n          var nof_files = th.pn.getElementsByClassName('filename').length;\r\n          var om_info = th.pn.getElementsByClassName('omittedinfo');\r\n          if (om_info[0]) {\r\n            var str = om_info[0][brwsr.innerText].replace(/\\n/g,'');\r\n            nof_posts += parseInt(str.replace(/\\ post.*/,''),10);\r\n            nof_files += parseInt('0'+str.replace(/\\ file.*/,'').replace(/[^\\ ]*\\ /g,''),10);\r\n          }\r\n          Object.defineProperty(th,'nof_files',{value:nof_files, enumerable:true, configurable:true, writable:true});\r\n          return nof_posts;\r\n        },\r\n        nof_files: function(th){\r\n          if (!th.hasOwnProperty('nof_posts')) this['nof_posts'](th);\r\n          return th.nof_files;\r\n        },\r\n        sub:  function(post){\r\n          var sub = post.pn.getElementsByClassName('postsubject')[0];\r\n          return (sub)? sub.textContent : '';},\r\n        name: function(post){return post.pn.getElementsByClassName('postername')[0][brwsr.innerText];},\r\n        pn_name: function(post){return post.pn.getElementsByClassName('postername')[0];},\r\n//        com:  function(post){return (post.pn.getElementsByClassName('postbody')[0] || post.pn).getElementsByTagName('p')[0][brwsr.innerText];},\r\n        com:  function(post){return (post.pn.getElementsByClassName('postbody')[0] || post.pn).getElementsByTagName('p')[0].innerHTML.replace(/^\\s*/,'').replace(/\\s*$/,'');},\r\n        type_com: 'html',\r\n        footer: function(th){return this.insert_footer4(th.pn.getElementsByClassName('file_thread')[0]);},\r\n//        sticky: function(th){return (th.pn.getElementsByClassName('stickyIcon').length!=0);},\r\n        flag: function(post){  // same as 8chan\r\n          var balls = post.pn.getElementsByTagName('img');\r\n          for (var i=0;i<balls.length;i++) if (balls[i].getAttribute('src').search(/images\\/balls/)!=-1) break;\r\n//          return (i<balls.length)? balls[i].cloneNode(false) : null; // may cause memory leak\r\n//          return (i<balls.length)? document.importNode(balls[i],false) : null;\r\n          if (i<balls.length) {\r\n            var ball = document.importNode(balls[i],false);\r\n            ball.setAttribute('src', site2['KC'].absolute_link_1(ball.getAttribute('src')));\r\n            return ball;\r\n          } else return null;\r\n//          if (i<balls.length) { // didn't stop memory leak.\r\n//            var ball = document.createElement('img');\r\n//            ball.setAttribute('src',balls[i].getAttribute('src'));\r\n//            return ball;\r\n//          } else return null;\r\n        },\r\n        op_img_url:function(th){\r\n//          var img = th.pn.getElementsByClassName('file_thread')[0].getElementsByTagName('img');\r\n          var ft  = th.pn.getElementsByClassName('file_thread');\r\n          var img = (ft[0])? ft[0].getElementsByTagName('img') : null; // parse other site's html\r\n          var url = (img && img[img.length-1])? img[img.length-1].getAttribute('src') : undefined;\r\n          if (ft.length>=2) {\r\n            th.op_img_url2 = [];\r\n            for (var i=1;i<ft.length;i++) {\r\n              img = ft[i].getElementsByTagName('img');\r\n              var url2 = (img && img[img.length-1])? img[img.length-1].getAttribute('src') : undefined;\r\n              if (url2) th.op_img_url2[th.op_img_url2.length] = url2;\r\n            }\r\n          }\r\n//          return url;\r\n          return site2[th.domain].protocol + '//' + site2[th.domain].domain_url + url; // patch\r\n        },\r\n////        post_no: function(post){return parseInt(post.pn.getElementsByClassName('quotelink')[1][brwsr.innerText],10);},\r\n        get_op_src: 'thread_html',\r\n        get_thread_links : function(th){\r\n          var as = th.pn.getElementsByClassName('postheader')[0].getElementsByTagName('a');\r\n          for (var i=0;i<as.length;i++) \r\n            if (as[i].textContent==='Reply' || as[i].textContent==='Antworten') return [as[i]];\r\n        },\r\n        get_omitted_info : function(post){return post.pn.getElementsByClassName('omittedinfo')[0];},\r\n        set_omitted_info : function(post, info){post.pn.insertBefore(info,post.pn.getElementsByClassName('postbody')[0].nextSibling);},\r\n        replace_omitted_info2 : function(dst, src){dst.childNodes[0].textContent = (src)? src.childNodes[0].textContent : '';},\r\n        filename: function (th){ // post can be accepted.\r\n          var op = th.pn.classList.contains('thread') || th.pn.classList.contains('thread_body');\r\n          var files = th.pn.getElementsByClassName((op)? 'file_thread' : 'file_reply');\r\n          if (files) \r\n            for (var i=0;i<files.length;i++) {\r\n              var href = files[i].getElementsByClassName('filename')[0].getElementsByTagName('a')[0].getAttribute('href');\r\n              if (i===1) th.extra_files = [];\r\n              if (i>=1) th.extra_files[i-1] = {domain:th.domain, board:th.board};\r\n              var idx = href.lastIndexOf('/');\r\n              var tgt = (i===0)? th : th.extra_files[i-1];\r\n              tgt.filename = href.substr(idx+1);\r\n//              tgt.filename_server = href.substr(0,idx).replace(/[^\\/]*\\//g,'');\r\n              tgt.filename_server = href.substr(0,idx).replace(/[^\\/]*\\//g,'').replace(/jpeg$/,'jpg');\r\n              var info = files[i].getElementsByClassName('fileinfo')[0].textContent.replace(/\\s/g,'').split(',');\r\n              tgt.w = parseInt(info[1].substr(0,info[1].indexOf('x')  ),10);\r\n              tgt.h = parseInt(info[1].substr(  info[1].indexOf('x')+1),10);\r\n              var fsize = info[1].split(/\\s/);\r\n              fsize[1] = (fsize[1]==='kB')? 1000 : (fsize[1]==='MB')? 1000000 : 1;\r\n              tgt.fsize = parseInt(fsize[0],10) * fsize[1];\r\n              var tn = files[i].querySelector('img[id^=thumbnail]');\r\n              if (tn) {\r\n                tgt.tn_w = parseInt(tn.getAttribute('width'),10);\r\n                tgt.tn_h = parseInt(tn.getAttribute('height'),10);\r\n              }\r\n            }\r\n          return th.filename;\r\n        },\r\n        tn_imgs: function(th){return th.pn.querySelectorAll('img[id^=thumbnail]');},\r\n        prep_mimic: function (th){\r\n//          th.posts[0].no = th.no; // doesn't work because posts[0].no has getter.\r\n//          for (var i=0;i<th.posts.length;i++) Object.defineProperty(th.posts[i],'no',{value:th.no}); // test patch\r\n          th.op_img_url = th.parse_funcs.op_img_url(th);\r\n        },\r\n        get_op_src: function(th){return site2['KC'].catalog_json2html3_src(th);},\r\n        get_max_page: function(doc){\r\n//          var pns = doc.querySelectorAll('form[action*=delete]')[0].lastChild.previousSibling.previousSibling.previousSibling.getElementsByTagName('*'); // CAN'T GET [1] because it's a text node.\r\n          var pns = doc.querySelectorAll('form[action*=delete]')[0].lastChild.previousSibling.previousSibling.previousSibling.childNodes[1].childNodes[1].childNodes[0].childNodes[3].childNodes; // WORKS ONLY PAGE 0.\r\n          var max = 0;\r\n          for (var i=0;i<pns.length;i++) {\r\n            var text = pns[i].textContent.replace(/\\s+/g,'');\r\n            if (max+1 == text || '['+(max+1)+']'===text) max++; // == used intentionally.\r\n          }\r\n          return max;\r\n        },\r\n      },\r\n      'thread_html' : {\r\n//        ths: function(doc) { // pn of thread isn't used.\r\n//          var ths = site2['KC'].parse_funcs.page_html.ths(doc);\r\n//          for (var i=0;i<ths.length;i++) {\r\n//            var ph = ths[i].pn.getElementsByClassName('postheader')[0];\r\n//            if (ph) {\r\n//              ph.appendChild(document.createTextNode(' ['));\r\n//              var link = document.createElement('a');\r\n//              link.setAttribute('href',ths[i].board + 'thread-' + ths[i].no + '.html');\r\n//              link.innerHTML = 'Reply';\r\n//              ph.appendChild(link);\r\n//              ph.appendChild(document.createTextNode('] '));\r\n//            }\r\n//          }\r\n//          return ths;\r\n//        },\r\n//        ths: function(doc) {return this.ths_array(doc, doc.pn.getElementsByClassName('thread_body'));}, // patch, but for what???, de-patched for trial.\r\n//        com:  function(post){return post.pn.getElementsByTagName('blockquote')[0][brwsr.innerText];},\r\n        com:  function(post){return post.pn.getElementsByTagName('blockquote')[0].innerHTML.replace(/^\\s*/,'').replace(/\\s*$/,'');},\r\n        type_com: 'html',\r\n        time_created: function(th){\r\nreturn th.parse_funcs.time(th.posts[0]);},\r\n        time_bumped: function(th){\r\nreturn th.parse_funcs.time(th.posts[th.posts.length-1]);},\r\n////        pop_post_prep: function(th){ // working code.\r\n////          th.children = th.pn.getElementsByClassName('postreply');\r\n////          th.idx_pop = th.children.length-1;\r\n////        },\r\n////        pop_post: function(th){\r\n////          if (th.idx_pop>=0) {\r\n////            th.post = {pn:th.children[th.idx_pop--], parse_funcs:this, __proto__:th.__proto__};\r\n////            return true;\r\n////          }\r\n////          return false;\r\n////        },\r\n        get_op_src: function(th){return th.op_img_url.replace('thumbnails','files');},\r\n        proto: 'page_html',\r\n      },\r\n      'post_html' : {\r\n        flag: 'page_html',\r\n        time: function(post){\r\n          return site2['KC'].parse_funcs.post_html.time_pn(post.pn); // use direct path to hope to be inline optimized.\r\n        },\r\n        time_pn: function(post_pn){\r\n          var postdate = post_pn.getElementsByClassName('postdate')[0];\r\n          return (postdate)? site2['KC'].parse_funcs.post_html.time_pn_1(postdate) : undefined; // use direct path to hope to be inline optimized.\r\n        },\r\n        time_pn_1: function(postdate){\r\n          return Date.parse(postdate.textContent) + (pref.localtime_offset-site2['KC'].time_offset)*3600000; // FF accepts KC's format\r\n        },\r\n      },\r\n      'post_json' : {\r\n        time_unit: 1, // for archive.list_all\r\n      }\r\n    },\r\n\r\n    general_event_handler:{\r\n//      catalog:{ // working code\r\n//        mouseover: function(e){\r\n//          var et = e.target;\r\n//          var et_tagName = et.tagName;\r\n//          if (et_tagName==='IMG')\r\n//            if (pref[cataLog.embed_mode].image_hover && et.parentNode.className==='thumbnail') cataLog.image_hover_add.call(e.target,e, e.target.src.replace(/thumbnail/,'file'));\r\n//        },\r\n//        __proto__: site2['DEFAULT'].general_event_handler.catalog\r\n//      },\r\n    },\r\n\r\n    popups_href2dbtp: function(href){ //, src, th){\r\n//      if (href[0]==='#' && th) {\r\n//        href = this.link_dbtp2href([th.domain, th.board, th.no, href.substr(1)]);\r\n//        src.setAttribute('href',href);\r\n//      }\r\n      var hrefs = href.split(/[\\/#]/);\r\n      var p = hrefs[hrefs.length-1];\r\n      var t = hrefs[hrefs.length-2].replace('thread-','').replace('.html','');\r\n      var b = (hrefs.length>=3)? '/'+hrefs[hrefs.length-3]+'/' : site.board;\r\n      return ['KC',b,t,p]\r\n    },\r\n    link_dbtp2href: function(dbtp){\r\n      return dbtp[1] + 'thread-' + dbtp[2] + '.html#' + dbtp[3];\r\n    },\r\n\r\n    post_json2html_fname_server: function(post){return post.filename_server;},\r\n    post_json2html_fname: function(post){return post.filename;},\r\n    catalog_json2html3_src: function(obj) {\r\n      return site.protocol + '//' + site2[obj.domain].domain_url + '/files/' + obj.filename_server;\r\n    },\r\n    catalog_json2html3_thumbnail: function(obj) {\r\n      return site.protocol + '//' + site2[obj.domain].domain_url + '/thumbnails/' + obj.filename_server;\r\n    },\r\n//    catalog_json2html3_thumbnail: function(obj, board) {\r\n//      var ext = (obj.ext==='.jpg' || obj.ext==='.png' || obj.ext==='.gif' || obj.ext==='.webm')? '.jpg' : obj.ext;\r\n//      return (obj.ext)? 'http://i.4cdn.org' + obj.board + obj.tim + 's' + ext : '';\r\n//    },\r\n\r\n\r\n\r\n\r\n    \r\n    post_json2html : function(post, board, op, short_link, th_no) {\r\n      var pn = document.createElement('div');\r\n      var time_unit = (post.parse_funcs && post.parse_funcs.time_unit) || 1;\r\n      var date = new Date((post.time || 0) * time_unit -(pref.localtime_offset-site2['KC'].time_offset)*3600000);\r\n      var html_file = '';\r\n      if (post.filename) {\r\n        html_file += this.post_json2html_file(post,board, post.extra_files);\r\n        if (post.extra_files) for (var i=0;i<post.extra_files.length;i++) html_file += this.post_json2html_file(post.extra_files[i],board, true);\r\n      }\r\n      pn.innerHTML =\r\n        '<div class=\"' +((op)? 'thread_body' : 'postreply\" id=\"post-' +post.no) + '\">'+ // <td> can't be used alone.\r\n          '<div class=\"postheader\">'+\r\n            '<input name=\"post_' + post.no+ '\" value=\"delete\" type=\"checkbox\">'+\r\n            ((post.flag)? post.flag.outerHTML : '')+ //  '<img src=\"/images/balls/ca.png\">'+\r\n            '<span class=\"postsubject\">' +post.sub+ '</span> '+\r\n            '<span class=\"postername\">' +post.name+ '</span> '+\r\n            '<span class=\"postdate\">' + date.toLocaleString()+ '</span> '+\r\n            '<span class=\"postnumber\">'+\r\n              '<a href=\"/int/thread-' +th_no+ '.html#' +post.no+ '\" class=\"quotelink\">No.</a>'+\r\n              '<a href=\"/int/thread-' +th_no+ '.html#q'+post.no+ '\" class=\"quotelink\">' +post.no+ '</a>'+\r\n            '</span> '+\r\n            '<div class=\"report_parent\"><a href=\"/report/int/' +th_no +'\" class=\"report_link\"><img src=\"/images/icon-report.png\"></a></div>'+\r\n            ((op)? ' [<a href=\"' + board + 'thread-' + post.no + '.html\">Reply</a>] ' : '')+\r\n          '</div>'+\r\n          html_file+\r\n          '<div' + ((op)? ' class=\"postbody\"' : '') + '>'+\r\n            '<blockquote>'+\r\n              '<p id=\"post_text_' +post.no+ '\">'+ post.com + '</p>'+\r\n            '</blockquote>'+\r\n          '</div>'+\r\n        '</div>'; //'<td>';\r\n      return pn.childNodes[0];\r\n    },\r\n    post_pn2ce: function(pn){ // NOT DEBUGGED BECAUSE KC WAS CLOSED.\r\n      return (pn.lastChild.firstChild.tagName==='BLOCKQUOTE')? pn.lastChild.firstChild : pn.getElementsByTagName('blockquote')[0];\r\n    },\r\n    post_json2html_file : function(post, board, multifile) {\r\n      var fsize_str = (((post.fsize>1048576)? post.fsize/1048576 : post.fsize/1024)+0.005).toString();\r\n      fsize_str = fsize_str.substr(0,fsize_str.indexOf('.')+3) + ((post.fsize>1048576)? ' MB' : ' KB');\r\n      var fname_server = site2[post.domain].post_json2html_fname_server(post);\r\n      var fname = site2[post.domain].post_json2html_fname(post);\r\n      var furl = site2[post.domain].catalog_json2html3_src(post,board);\r\n      var turl = site2[post.domain].catalog_json2html3_thumbnail(post,board);\r\n      var html_str =\r\n        '<div class=\"file_thread\">'+\r\n          '<span class=\"filename\">'+\r\n            '<a href=\"/download/' +fname_server+ '/' +fname+ '\">' +fname+ '</a>'+\r\n          '</span>'+\r\n//          '<img id=\"button_expand_image_185478186\" src=\"/images/button-expand.gif\" style=\"cursor: pointer\">'+\r\n//          '<a href=\"/paint?action=new&amp;board=int&amp;thread=35608887&amp;modify=185478186&amp;applet=shipainter\" onmouseover=\"helpTip('Modify picture')\" onmouseout=\"UnTip()\">'+\r\n//            '<img src=\"/images/button-paint.gif\" border=\"0\" width=\"15\" height=\"15\"></a>\r\n          '<br>'+\r\n          '<span class=\"fileinfo\"> '+ fname.substr(fname.lastIndexOf('.')+1).toUpperCase()+ ', ' +post.w+ 'x' +post.h+ ', ' + fsize_str + '</span><br>'+\r\n          '<a href=\"' +furl+ '\" target=\"_blank\">'+\r\n           '<img style=\"display: block\" id=\"thumbnail_' +fname_server+ '\" src=\"' +turl+ '\" width=\"' +post.tn_w+ '\" height=\"' +post.tn_h+ '\">'+\r\n          '</a>'+\r\n//          '<span id=\"filename_XXXXXXXXX\" style=\"display: none; margin-top: 0px; margin-left: 0px;\">iPhone-SE-vs-iPhone-6S.jpg</span>'+\r\n        '</div>'\r\n      return html_str;\r\n    },\r\n    page_json2html3: function(obj, clone, dst, force_expander, no_expander){ // copied from vichan.\r\n      var th = document.createElement('div');\r\n      th.setAttribute('id','thread_'+obj.no);\r\n      th.setAttribute('style','clear:both');\r\n      th.innerHTML = '<hr><a name=' +obj.no+ '></a>';\r\n//      th.setAttribute('style','float: left; overflow: hidden;');\r\n      var op = this.post_json2html((obj.posts && obj.posts[0])? obj.posts[0] : obj, obj.board, true, site2[obj.domain].short_link(obj.key, obj.nof_posts, 2, '[Last ',' Posts]'), obj.no);\r\n//      var files = op.getElementsByClassName('file_thread');\r\n//      if (files.length>0) for (i=0;i<files.length;i++) th.appendChild(files[i]);\r\n//      if (obj.posts && obj.posts[0] && obj.posts[0].extra_files) op.setAttribute('style','clear:both;');\r\n      th.appendChild(op);\r\n//      if (assign_pn) obj.posts[0].pn = th;\r\n      obj.posts[0].pn = op;\r\n      if (obj.posts) {\r\n        for (var i=1;i<obj.posts.length;i++) {\r\n//          th.appendChild(this.post_json2html(obj.posts[i], board));\r\n          var pn = this.post_json2html(obj.posts[i], obj.board);\r\n          this.update_posts_insert_1(this.post_container(pn,obj.posts[i].no), obj.posts[i].no, null, th);\r\n//          var pn = this.post_container(this.post_json2html(obj.posts[i], board),obj.posts[i].no); // WHY DID I DO THIS? PROBABLY THERE IS A PROBLEM IN A SOLUTION ABOVE.\r\n//          this.update_posts_insert_1(pn, obj.posts[i].no, null, th);\r\n//          th.appendChild(document.createElement('br'));\r\n          obj.posts[i].pn = pn;\r\n        }\r\n        if (!no_expander) this.page_json2html3_add_omitted_info(obj,obj.posts,obj.posts);\r\n////////      } else { // WILL BE REDUNDANT\r\n////////        var keys = Object.keys(obj); // obj.posts===undefined, but it is defined as undefined, so key contains 'posts'. \r\n////////        obj.posts = [];\r\n////////        obj.posts[0] = {};\r\n////////        for (var i=0;i<keys.length;i++) if (keys[i]!=='posts') obj.posts[0][keys[i]] = obj[keys[i]]; // remove props in prototype chain.\r\n////////        obj.posts[0].pn = op;\r\n      }\r\n//      var br = document.createElement('br');\r\n//      br.setAttribute('class','clear');\r\n//      th.appendChild(br);\r\n//      th.appendChild(document.createElement('hr'));\r\n      return th;\r\n    },\r\n    page_json2html3_replace_expander : function(posts_old, idx, key) {\r\n      var omit_info = posts_old[0].pn.getElementsByClassName('omittedinfo')[0];\r\n      if (omit_info) {\r\n//        omit_info.removeChild(omit_info.childNodes[1]);\r\n        omit_info.appendChild(cnst.config_expander(key, idx));\r\n      }\r\n    },\r\n    page_json2html3_add_omitted_info : function(th,posts_old,posts) {\r\n      var nof_files = 0;\r\n      for (var i=1;i<posts.length;i++) nof_files += (posts[i].type_data==='html')? posts[i].pn.getElementsByClassName('file_thread').length :\r\n                                                    (!posts[i].filename)? 0 :\r\n                                                    (posts[i].extra_files)? posts[i].extra_files.length+1 : 1;\r\n      var nof_files_omitted = th.nof_files - nof_files;\r\n      var nof_posts_omitted = th.nof_posts - posts.length;\r\n\r\n      var omit_info = (posts_old)? posts_old[0].pn.getElementsByClassName('omittedinfo')[0] : null;\r\n      if (th.nof_posts>1) { // for expand ALL\r\n        if (!omit_info) {\r\n          omit_info = document.createElement('span');\r\n          omit_info.setAttribute('class','omittedinfo');\r\n//          omit_info.innerHTML = 'dummy<a href=\"javascript:void(0)\">Click to expand</a>.';\r\n          omit_info.innerHTML = 'dummy';\r\n          omit_info.appendChild(cnst.config_expander(th.key));\r\n          if (posts_old) posts_old[0].pn.insertBefore(omit_info, posts_old[0].pn.getElementsByClassName('postbody')[0].nextSibling);\r\n        }\r\n        omit_info.childNodes[0].textContent = (nof_posts_omitted!==0)? (nof_posts_omitted +' post' + ((nof_posts_omitted!==1)? 's':'') +\r\n          ((nof_files_omitted)? ' and ' + nof_files_omitted + ' file'+ ((nof_files_omitted===1)? '' : 's') : '') + ' are not shown. ') : '';\r\n      } else if (omit_info) omit_info.childNodes[0].textContent = 'Showing all posts.'; //if (omit_info && posts_old) posts_old[0].pn.removeChild(omit_info);\r\n      return omit_info;\r\n    },\r\n    update_posts_remove: function(th_old,i,pnode,merge){\r\n      pnode = pnode.getElementsByClassName('thread_body')[0];\r\n      var tgt = th_old.posts[i].pn;\r\n      if (!merge || tgt.parentNode!==pnode) tgt = tgt.parentNode.parentNode.parentNode;\r\n      else this.update_posts_insert_pack(tgt);\r\n      if (tgt.previousSibling && tgt.previousSibling.tagName==='A') pnode.removeChild(tgt.previousSibling); // <a>\r\n      pnode.removeChild(tgt);\r\n    },\r\n    update_posts_insert: function(src,dst,i,j,pnode){\r\n      var ref = dst[j];\r\n//      var ref = dst[(j<dst.length)? j : dst.length-1];\r\n      ref = (ref)? ref.pn : null;\r\n      var ref_pnode2 = ref && ref.parentNode && ref.parentNode.parentNode && ref.parentNode.parentNode.parentNode;\r\n      if (ref_pnode2 && ref_pnode2.parentNode && ref_pnode2.parentNode.parentNode===pnode) ref = ref_pnode2; // remove container\r\n//      if (j>=dst.length) ref = ref && ref.nextSibling && ref.nextSibling.nextSibling || null;\r\n      if (!src[i].pn) src[i].pn = this.post_json2html(src[i],src[i].board);\r\n      if (i===0) this.update_posts_insert_pack(src[0].pn);\r\n      if (j===0 && ref) this.update_posts_insert_pack(dst[0].pn);\r\n      var tgt = (j===0 && i===0)? src[i].pn : this.post_container(src[i].pn,src[i].no); // patch for thread merging.\r\n      this.update_posts_insert_1(tgt,src[i].no,ref,pnode);\r\n      if (i===0 && j===0) this.update_posts_insert_unpack(src[0].pn);\r\n    },\r\n    update_posts_insert_1: function(tgt,no,ref,pnode){\r\n      pnode = pnode.getElementsByClassName('thread_body')[0];\r\n      var pn_a = document.createElement('a');\r\n      pn_a.setAttribute('name',no);\r\n      pnode.insertBefore(pn_a,ref);\r\n      pnode.insertBefore(tgt, ref);\r\n    },\r\n    update_posts0_class: site2['vichan'].update_posts0_class,\r\n    update_posts_insert_pack: site2['vichan'].update_posts_insert_pack,\r\n    update_posts_insert_pack_iter: function(pn, func){\r\n      var prev = pn.previousSibling;\r\n      while (prev) {\r\n        var prev_prev = prev.previousSibling; // prev is livelist.\r\n        if (prev.classList && (prev.classList.contains(pref.script_prefix+'_footer') || prev.classList.contains('file_thread') || prev.classList.contains('post_header'))) func(prev);\r\n        if (prev.classList &&  prev.classList.contains('postbody')) break;\r\n        prev = prev_prev;\r\n      }\r\n    },\r\n    update_posts_insert_unpack: function(pn){\r\n      while (1) {\r\n        var fchild = pn.firstChild;\r\n        if (fchild && fchild.classList && (fchild.classList.contains(pref.script_prefix+'_footer') || fchild.classList.contains('file_thread') || fchild.classList.contains('post_header'))) pn.parentNode.insertBefore(fchild, pn);\r\n        else break;\r\n      }\r\n    },\r\n    post_container : function(post_pn,no) {\r\n      var pn = document.createElement('table');\r\n      pn.innerHTML = '<tbody><tr><td valign=\"top\">&gt;&gt;</td></tr></tbody>';\r\n      pn.childNodes[0].childNodes[0].appendChild(post_pn);\r\n      return pn;\r\n    },\r\n\r\n\r\n\r\n\r\n    catalog_json2html3 : function(obj,board,thumb_url, make_footer) {\r\n      var th = document.createElement('article');\r\n      th.setAttribute('class','thread teaser');\r\n      th.setAttribute('id','thread-'+obj.no);\r\n      var post_flag = null;\r\n      if (obj.flags && obj.flags[0]) {\r\n//        post_flag = obj.flags[0].cloneNode(false);\r\n        post_flag = document.importNode(obj.flags[0],false);\r\n        post_flag.setAttribute('class','post_country');\r\n      }\r\n//      th.innerHTML = '<a href=\"http://boards.4chan.org' + obj.board + 'thread/' + obj.no + ((obj.sub)? '/'+obj.sub.replace(/ /,'-') : '') + '\">' + // cause direct jump\r\n\r\n        th.innerHTML =\r\n//          '<article tabindex=\"0\" id=\"thread_' + obj.no + '\" class=\"thread teaser\">'+\r\n            '<article class=\"thread_OP\" id=\"' + obj.no + '\">'+\r\n              '<div class=\"post\">'+\r\n                '<header>'+\r\n                  '<a><h1>'+\r\n                    ((post_flag)? post_flag.outerHTML : '') + \r\n//                    '<img class=\"post_country\" src=\"http://krautchan.net/images/balls/kz.png\" style=\"cursor:pointer\" name=\"KC/catalog/01234567\">/+\r\n                        ((obj.sub)? obj.sub : '#'+obj.no )+ \r\n//                        obj.sub + \r\n                  '</h1></a>'+\r\n                '</header>'+\r\n                '<div class=\"post_body\">'+\r\n                  '<a>'+\r\n                    '<div class=\"post_files multiple\">'+\r\n                      '<figure>'+\r\n                        '<div class=\"thumbnail\">'+\r\n                          '<img src=\"' + obj.op_img_url + '\">'+\r\n                        '</div>'+\r\n                      '</figure>'+\r\n                      ((obj.op_img_url2 && obj.op_img_url2[0])? (\r\n                        '<figure>'+\r\n                          '<div class=\"thumbnail\">'+\r\n                            '<img src=\"' + obj.op_img_url2[0] + '\">'+\r\n                          '</div>'+\r\n                        '</figure>'+\r\n                        ((obj.op_img_url2 && obj.op_img_url2[1])? (\r\n                          '<figure>'+\r\n                            '<div class=\"thumbnail\">'+\r\n                              '<img src=\"' + obj.op_img_url2[1] +'\">'+\r\n                            '</div>'+\r\n                          '</figure>'+\r\n                          ((obj.op_img_url2 && obj.op_img_url2[2])? (\r\n                            '<figure>'+\r\n                              '<div class=\"thumbnail\">'+\r\n                                '<img src=\"' + obj.op_img_url2[2] + '\">'+\r\n                              '</div>'+\r\n                            '</figure>') :\r\n                          '')) :\r\n                       '')) : '') +\r\n                    '</div>'+\r\n                  '</a>'+\r\n                  '<div class=\"omittedposts\">'+\r\n                    '<span class=\"omitted_text\">'+(make_footer? 'R: 0 / I: 0 / P: 0.0&emsp;/catalog/':'')+'</span>'+\r\n                  '</div>'+\r\n                  '<div class=\"post_text\"><section>'+\r\n                    obj.com +\r\n                  '</section></div>'+\r\n                '</div>'+\r\n              '</div>'+\r\n            '</article>';\r\n//          '</article>';\r\n      var tns = th.getElementsByClassName('thumbnail');\r\n      tns[0].childNodes[0].addEventListener('load',site2['KC'].catalog_json2html3_onload,false);\r\n      return th;\r\n    },\r\n    catalog_json2html3_onload : function() {\r\n      this.removeEventListener('load',site2['KC'].catalog_json2html3_onload,false);\r\n      var w = this.naturalWidth;\r\n      var h = this.naturalHeight;\r\n      var f = ((w>h)? w : h) / 200;\r\n      this.setAttribute('width', w/f);\r\n      this.setAttribute('height', h/f);\r\n    },\r\n    favicon : {\r\n      __proto__: site2['DEFAULT'].favicon,\r\n      none: '/favicon.ico',\r\n      reply: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAKJJREFUOE9jZPh/hgECfv4yts59/PgxlAujZGVlzx6dzMDOBhMAaoCjtEA01SAuUBBZDQrnwEwsGoCCKBp+HEPwPx6QkZFB1gPifjyAUABUbGxsDLIUaAxEItQFxRIgFygIlAIqSAsEKYYDkGGhLpaWlsgaQNxQFxRrxcTEsLgbhxBI8SDUQLKnSQ9WUiOO9KRBfuL7cQzoH2C0oAGQJ5GcDQBwM6RhinByrgAAAABJRU5ErkJggg==',\r\n      reply_to_me: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAMxJREFUOE9jZPh/hgECfv4yts59/PgxlAujZGVlzx6dzMDOBhMAavh/5j8MoKkGcdMCQYbCEYSFT8OBmagafhxD1iAjI4NsCYj78QBCA1CxsbEx0FKEDaEuKK4CcoFOAOoB2pMWCFIMAXANlpaWyBpA3FAXFGvFxMSQNWDxNJIQSDFEA5EAoQFfKGG1gQQNcP0gn4W6EPY0JFhBoQYJb8LBCo44KPp4gHDEoUQ70B5MgJ40kBMW0G2YAGviA9nz4xjQP8CQRgMgTyI5GwD2xdfU779fsgAAAABJRU5ErkJggg=='\r\n    },\r\n    add_backlinks: function(pn,backlinks,target,th){}, // dummy\r\n  };\r\n}\r\nif (pref.features.domains['4chan'] || pref.features.domains['meguca']) {\r\n  site2['4chan_i'] = {\r\n//    home:undefined,\r\n//    nickname:'4chan_i',\r\n//    nickname_href2domain:'4chan',\r\n    domain_url: 'i.4cdn.org',\r\n    check_func: site2['DEFAULT'].check_func,\r\n    proto:'4chan'\r\n  };\r\n  site2['4chan'] = {\r\n    nickname : '4chan',\r\n    get home(){return site.protocol + '//' + this.domain_url + '/favicon.ico';}, // 4chan.org is redirected to 4channel.org, see site2['4chanR'].home\r\n//    home : site.protocol + '//boards.4chan.org/favicon.ico',\r\n//    home : site.protocol + '//boards.4chan.org/int/',\r\n    protocol: 'https:', // https always since 20200330\r\n    make_tack: function(){\r\n      var tack = document.createElement('img');\r\n      tack.setAttribute('src','//s.4cdn.org/image/sticky.gif');\r\n      tack.setAttribute('class','stickyIcon retina');\r\n      return tack;\r\n    },\r\n    postform_rules: null,\r\n    postform: {\r\n//      init:function(){\r\n//        this.tack = site2[site.nickname].make_tack();\r\n//        this.tack.setAttribute('style','float:right;font-size:2em;');\r\n//        site.postform.parentNode.insertBefore(this.tack,site.postform);\r\n//        return this.tack;\r\n//      },\r\n      activation: function(){\r\n        document.getElementById('togglePostFormLink').getElementsByTagName('a')[0].click();\r\n        this.activation = null;\r\n      },\r\n      __proto__:site2['DEFAULT'].postform\r\n    },\r\n    features : {uip_tracker: true},\r\n    components: {\r\n      header: '#header',\r\n      boardlist: '.boardList',\r\n      boardlist2: ['.boardList',1],\r\n      postform_comment: 'textarea[name=\"com\"]',\r\n      postform_submit: 'input[type=\"submit\"]',\r\n      postform_comment2: ['textarea[name=\"com\"]',1],\r\n      postform_submit2: ['input[type=\"submit\"]',2],\r\n    },\r\n    spoiler_text: {\r\n      open_rule: 's,s a:not(:hover) {color: #fff!important;}',\r\n    },\r\n    general_event_handler:(function(){\r\n      var obj = {\r\n        thread: {\r\n////          last_viewed: function(e){return e.target.classList && e.target.classList.contains('post');}, // working code, but not used.\r\n////          get_next_mark: function(pn){\r\n////            var parent_next = pn.parentNode && pn.parentNode.nextSibling;\r\n////            if (parent_next.tagName==='SPAN') parent_next = parent_next.nextSibling;\r\n////            var next_post = parent_next && parent_next.getElementsByClassName('post')[0];\r\n////            if (!next_post) {\r\n////              var parent_parent_next = pn.parentNode.parentNode.nextSibling;\r\n////              next_post = parent_parent_next.getElementsByClassName('post')[0];\r\n////            }\r\n////            return next_post;\r\n////          },\r\n////          get_prev_mark: function(pn){\r\n////            var parent_prev = pn.parentNode && pn.parentNode.previousSibling;\r\n////            if (parent_prev.tagName==='SPAN') parent_prev = parent_prev.previousSibling;\r\n////            var prev_post = parent_prev && parent_prev.getElementsByClassName('post')[0];\r\n////            if (!prev_post) {\r\n////              var parent_parent_prev = pn.parentNode.parentNode.previousSibling;\r\n////              prev_post = parent_parent_prev.getElementsByClassName('post')[0];\r\n////            }\r\n////            return prev_post;\r\n////          },\r\n          get_mark: function(pn, clientY){\r\n            while (pn && pn!== cataLog.parent) {\r\n              if (pn.classList.contains('post')) return pn;\r\n              if (pn.classList.contains('postContainer')) return pn.getElementsByClassName('post')[0];\r\n              if (pn.parentNode && pn.parentNode.classList.contains('thread')) {\r\n                pn = pn.previousSibling;\r\n                if (pn) continue;\r\n                else break;\r\n              }\r\n              if (pn.classList.contains('thread')) break;\r\n              pn = pn.parentNode;\r\n            }\r\n            return this.get_mark_from_height(clientY);\r\n          },\r\n          get_mark_from_height: function(now_height){\r\n            return this.__proto__.get_mark_from_height(now_height, document.getElementsByClassName('post'));\r\n          },\r\n          image_hover_check_mode: function(img){\r\n            return img.parentNode.classList.contains('fileThumb')? 'page' : 'catalog';\r\n          },\r\n          getID: function(pn){return pn.classList.contains('hand') && pn.textContent;},\r\n          getCountry: function(pn){\r\n            return pn.classList.contains('flag') && pn.getAttribute('class').replace(/\\s*flag\\-*/g,'').toUpperCase() ||\r\n              pn.classList.contains('bfl') && pn.className.replace(/\\s*bfl\\-*/g,'').toLowerCase();}, // lower case for bfl\r\n//              pn.className==='countryFlag' && pn.getAttribute('alt').toLowerCase();}, // lower case for troll flag\r\n          getTrip: function(pn){return pn.classList.contains('postertrip') && pn.textContent;},\r\n          __proto__: site2['DEFAULT'].general_event_handler.common,\r\n        },\r\n      };\r\n//      obj.catalog = { // working code\r\n//        mouseover: function(e){\r\n//          var et = e.target;\r\n//          var et_tagName = et.tagName;\r\n//          if (et_tagName==='IMG')\r\n//            if (pref[cataLog.embed_mode].image_hover && et.parentNode.tagName==='A') cataLog.image_hover_add.call(et, e);\r\n//        },\r\n//        __proto__:obj.thread\r\n//      };\r\n      obj.catalog = Object.create(obj.thread);\r\n      obj.page = Object.create(obj.thread);\r\n      obj.archive = Object.create(obj.thread);\r\n      return obj;\r\n    })(),\r\n    domain_url: 'boards.4chan.org',\r\n    check_func : function(){\r\n      var href = window.location.href;\r\n      var domain = (href.indexOf(site2['4chanB'].domain_url)!==-1)? '4chanB' : (href.indexOf(site2['4chanR'].domain_url)!==-1)? '4chanR' : null;\r\n      if (!domain) return false;\r\n//      if (href.search(this.domain_url)===-1) return false;\r\n      this.domain_url = site2[domain].domain_url;\r\n      site.whereami = (document.title.indexOf('404 Not Found')!=-1)? '404'\r\n                    : (href.search(/catalog/)!=-1)? 'catalog'\r\n                    : (href.search(/thread\\/[0-9]+/)!=-1)? 'thread'\r\n                    : (href.search(/archive/)!=-1)? 'archive'\r\n                    : (href.search(/\\/$|(index|[0-9]+)(\\.html)*|\\/#all$/)!=-1)? 'page'\r\n                    : 'other';\r\n      if (site.whereami==='thread') site.no = parseInt(href.replace(/.*thread\\/([0-9]+)/,'$1'),10);\r\n      else if (site.whereami==='page') site.page = parseInt((href.match(/\\/([0-9]+)\\/*/)||[])[1],10) || 0;\r\n      else if (site.whereami==='catalog' && href.indexOf('catalog#s=')!=-1) this.catalog_native_prep_wait_loop = this.catalog_native_prep_wait_loop_if_searched;\r\n      site.config(this.domain_url,'4chan');\r\n      this.postform_prep();\r\n      site.max_page = site2['4chan'].max_page(site.board);\r\n//      site.header_height = function(){\r\n//        var header = document.getElementById('header');\r\n//        return (header)? header.offsetHeight : 0;\r\n//      }\r\n      site.embed_to = (site.whereami==='thread')? {\r\n        top:function(){return document.getElementsByClassName('navLinks')[0];},\r\n        bottom:function(){return document.getElementsByClassName('bottomad')[0] || document.getElementById('boardNavDesktopFoot');}\r\n//          site.embed_to['bottom'] = document.getElementsByClassName('bottomad')[0];\r\n      } : (site.whereami==='page')? {\r\n        top:function(){return document.getElementById('ctrl-top');},\r\n//          site.embed_to['bottom'] = document.getElementsByClassName('board')[0].nextSibling; // fail\r\n        bottom:function(){return document.getElementsByClassName('pagelist')[0];}\r\n      } : (site.whereami==='catalog')? {\r\n        top:function(){return document.getElementById('content').previousSibling;},\r\n        bottom:function(){return document.getElementsByClassName('navLinksBottom')[0].nextSibling;}\r\n      } : {};\r\n      site.postform = document.getElementsByClassName('postForm')[0];\r\n      return true;\r\n    },\r\n//    catalog_background : '#ffffee',\r\n    //    catalog_bordercolor : '#f0e0d6',\r\n    get_next_image: function(img,top){\r\n      var imgs = cataLog.parent.querySelectorAll('img[data-md5]');\r\n      if (imgs.length===0) imgs = site.popup_body.querySelectorAll('img[data-md5]'); // for popup in catalog\r\n      var idx = Array.prototype.indexOf.call(imgs,img);\r\n      if (idx==-1) idx = Array.prototype.indexOf.call(imgs,img.previousSibling);\r\n      if (top) while (imgs[idx+1] && imgs[idx+1].offsetTop<top) idx++;\r\n      if (idx>=0) {\r\n        if (pref.test_mode['164']) while (imgs[idx+1] && imgs[idx+1].parentNode.getAttribute('href').search(/\\.webm$/)!=-1) idx++; // skip webm\r\n        return imgs[idx+1];\r\n      } else return null;\r\n    },\r\n    format_expanded_thumbnail: function(img){\r\n      img.removeAttribute('data-md5');\r\n      img.className = 'expanded-thumb';\r\n    },\r\n    catalog_threads_in_page : function(doc){return doc.getElementsByClassName('thread');},\r\n    catalog_posts_in_thread : function(doc){return doc.getElementsByClassName('replyContainer');},\r\n    max_page : function(){return 10;},\r\n    make_url4 : function(dbt, trim_page){ // dbt[2] is string.\r\n      var url_prefix  = site.protocol + '//' + this.domain_url  + dbt[1];\r\n      var url_prefix2 = site.protocol + '//' + 'a.4cdn.org' + dbt[1];\r\n      if (dbt[3]==='catalog_html' || (trim_page && dbt[2]==0 && dbt[3]==='page_json')) dbt[3] = 'catalog_json'; // catalog_html is a skelton.\r\n      return (dbt[3]==='page_json')?       [url_prefix2 + (parseInt(dbt[2],10)+1) + '.json', 'json', (trim_page)? '4chan'+dbt[1]+'j0' : undefined] : // dbt[2] is string.\r\n             (dbt[3]==='catalog_json')?    [url_prefix2 + 'catalog.json', 'json', '4chan'+dbt[1]+'j0'] :\r\n             (dbt[3]==='thread_json')?     [url_prefix2 + 'thread/' + dbt[2] + '.json', 'json'] :\r\n             (dbt[3]==='page_html')?       [url_prefix  + ((dbt[2]!=0)? (parseInt(dbt[2],10)+1) :''), 'html'] :\r\n             (dbt[3]==='thread_html')?     [url_prefix  + 'thread/' + dbt[2], 'html'] : null;\r\n    },\r\n    trim_list: 'force_init',\r\n//////////    make_url : function(board,no){return [site.protocol+'//boards.4chan.org' + board + ((no!=0)? (no+1) :''), 'html'];},  // worling code.\r\n//////////    make_url3: function(board,th){return  site.protocol+'//boards.4chan.org' + board + 'thread/' + th;},\r\n////////    make_url : function(board,no,key){\r\n////////      var url_prefix = site.protocol+'//boards.4chan.org' + board;\r\n////////      return (key==='p')? [url_prefix + ((no!=0)? (no+1) :''), 'html'] :\r\n////////                          [url_prefix + 'catalog.json'       , 'json']; // 4chan's html is skelton.\r\n//////////             (key==='j')? [url_prefix + 'catalog.json'       , 'json'] :\r\n//////////                          [url_prefix + 'catalog'            , 'html'];\r\n////////    },\r\n////////    make_url3: function(board,th){return site.protocol+'//boards.4chan.org' + board + 'thread/' + ((th[0]!=='t')? th : th.substr(1)+'.json');},\r\n    url_boards_json : function(){return [site.protocol+'//a.4cdn.org/boards.json', 'json'];},\r\n    archive_patch_domain: function(proto){\r\n      Object.defineProperty(proto,'domain_xhr',{get:function(){return (this.url.indexOf('i.4cdn.org/')===-1)? null : '4chan_i';}, configurable:true, enumerable:true});\r\n    },\r\n    get_ops : function(doc){\r\n      var ops = [];\r\n      var threads = doc.getElementsByClassName('thread');\r\n      for (var i=0;i<threads.length;i++) ops.push(threads[i].id.substring(1));\r\n      return ops;\r\n    },\r\n    get_posts : function(doc) {\r\n      var posts = [];\r\n      var post_containers = doc.getElementsByClassName('postContainer');\r\n      for (var i=0;i<post_containers.length;i++) posts.push(parseInt(post_containers[i].id.substring(2),10));\r\n      return posts;\r\n    },\r\n////////    get_thread_link : function(pn,bn,del){\r\n////////      var link = pn.getElementsByClassName('replylink')[0];\r\n////////      if (link) {\r\n//////////        if (del) link.parentNode.parentNode.removeChild(link.parentNode);\r\n////////        if (del) {\r\n////////          link.parentNode.removeChild(link.nextSibling);\r\n////////          link.parentNode.removeChild(link.previousSibling);\r\n////////          link.parentNode.removeChild(link);\r\n////////        } else if (pref.catalog_open_in_new_tab) link.setAttribute('target','_blank');\r\n////////        return link.getAttribute('href');\r\n////////      } else return null;\r\n////////    },\r\n    modify_thread_link : function(pn){\r\n      var link = pn.getElementsByClassName('replylink')[0];\r\n      if (link) {\r\n        var href = link.getAttribute('href');\r\n        link.removeAttribute('href');\r\n        return [[link, href]];\r\n      } else return [];\r\n    },\r\n//    add_thread_link : function(doc,url){\r\n////      <a href=\"thread/32599218/finland-general\" class=\"replylink\" rel=\"canonical\">Reply</a>\r\n//      var pn = document.createElement('a');\r\n//      var prefix = new RegExp('https*://boards\\.4chan\\.org/[^/]*/');\r\n//      pn.href = url.replace(prefix,'');\r\n//      pn.className = 'replylink';\r\n//      pn.rel = 'canonical';\r\n//      pn.innerHTML = 'Reply';\r\n//      var th = doc.getElementsByClassName('thread')[0];\r\n//      if (th) {\r\n//        th.insertBefore(pn,th.firstChild);\r\n//        th.insertBefore(document.createTextNode('['),pn);\r\n//        th.insertBefore(document.createTextNode(']'),pn.nextSibling);\r\n//      }\r\n//    },\r\n    check_thread_archived : function(th){\r\n      return (th.getElementsByClassName('archivedIcon').length!=0);\r\n    },\r\n//    get_time_of_posts : function(doc){\r\n//      var posts = doc.getElementsByClassName('postContainer');\r\n//      var last_post = posts[posts.length-1];\r\n//      return [(parseInt(posts[posts.length-1].getElementsByClassName('dateTime')[0].getAttribute('data-utc'),10)- pref.localtime_offset*3600)*1000,\r\n//              (parseInt(posts[0             ].getElementsByClassName('dateTime')[0].getAttribute('data-utc'),10)- pref.localtime_offset*3600)*1000];\r\n//    },\r\n//    get_time_of_posts : function(th){ // working code.\r\n//      var posts = th.getElementsByClassName('postContainer');\r\n//      return [site2['4chan'].get_time_of_post_in_utc(posts[posts.length-1]),site2['4chan'].get_time_of_post_in_utc(posts[0])];\r\n//    },\r\n//    get_time_of_post_in_utc : function(post){ // working code\r\n//      return parseInt(post.getElementsByClassName('dateTime')[0].getAttribute('data-utc'),10)*1000;\r\n//    },\r\n//    mark_newer_posts: function(th,date,unmark, short_cut) {\r\n//      return site2['DEFAULT'].mark_newer_posts('4chan',th.getElementsByClassName('postContainer'),date,function(post){return post.getElementsByClassName('post')[0];}, unmark, short_cut);\r\n////      return site2['DEFAULT'].mark_newer_posts('4chan',th.getElementsByClassName('postContainer'),date,function(post){return post.getElementsByClassName('post reply')[0];}, unmark, short_cut);\r\n//    },\r\n    localtime: function(pn){\r\n      var times = pn.getElementsByClassName('dateTime');\r\n      for (var i=0;i<times.length;i++) times[i].textContent = site2.common.change_utc_to_local(parseInt(times[i].getAttribute('data-utc'),10)*1000);\r\n    },\r\n    remove_files_info : function(th){\r\n      site2.common.remove_by_classname(th,'fileText');\r\n      site2.common.remove_by_classname(th,'mFileInfo');\r\n      var filethumbs = th.getElementsByClassName('fileThumb');\r\n      for (var i=0;i<filethumbs.length;i++) site2.common.move_up_and_delete_parent([filethumbs[i].childNodes[0]]);\r\n    },\r\n//    remove_checkboxes : function(doc){\r\n//      var cbxs = doc.getElementsByTagName('input');\r\n//      for (var i=cbxs.length-1;i>=0;i--) cbxs[i].outerHTML = '';\r\n//      return doc;\r\n//    },\r\n    remove_posts : function(th,end){\r\n      site2.common.remove_by_classname(th,'postContainer replyContainer',end,true);\r\n//      site2.common.remove_double_br(th);\r\n    },\r\n////////    insert_footer : function(th,page_no,bn,exe,date,nof_posts,nof_files){\r\n////////      var key = (!brwsr.ff)? 'innerText' : 'innerHTML';\r\n////////      nof_posts += th.getElementsByClassName('postContainer').length;\r\n////////      nof_files += th.getElementsByClassName('fileText').length;\r\n////////      var om_info = th.getElementsByClassName('summary desktop');\r\n////////      if (om_info[0]) {\r\n////////        var str = om_info[0][key].replace(/\\n/g,'');\r\n////////        nof_posts += parseInt(str.replace(/\\ post.*/,''),10);\r\n////////        nof_files += parseInt('0'+str.replace(/\\ image.*/,'').replace(/[^\\ ]*\\ /g,''),10);\r\n////////      }\r\n////////      if (exe) {\r\n////////        var pn = document.createElement('div');\r\n////////        pn.setAttribute('name','catalog_footer');\r\n////////        pn.innerHTML = '<span>' + bn + '  ' + nof_posts + '/' + nof_files + '/' + page_no + '  </span>';\r\n////////        var flags = th.getElementsByClassName('flag');\r\n////////        for (var i=0;i<flags.length;i+=2) { // contains both mobile and desktop.\r\n////////          pn.appendChild(flags[i].cloneNode(false));\r\n//////////          pn.appendChild(document.createTextNode(' '));\r\n////////        }\r\n////////        var op_info = th.getElementsByClassName('postInfo desktop')[0];\r\n////////        op_info.parentNode.insertBefore(pn,op_info);\r\n////////      }\r\n////////      return [nof_posts,nof_files];\r\n////////    },\r\n    format_thread_layout : function(th){\r\n      site2.common.add_attribute_by_classname(th,'post op','style','padding:0px');\r\n//      site2.common.add_attribute_by_classname(th,'file','style','float:left');\r\n      site2.common.add_attribute_by_tagname(th,'blockquote','style','margin:12px 5px');\r\n    },\r\n    format_thread_contents : function(th){\r\n      site2.common.remove_by_tagname(th,'input');\r\n      site2.common.remove_by_classname(th,'mobile');\r\n//      site2.common.remove_by_classname(th,'postLink mobile');\r\n//      site2.common.remove_by_classname(th,'postInfoM mobile');\r\n      site2.common.remove_by_classname(th,'sideArrows');\r\n      site2.common.remove_by_classname(th,'summary');\r\n    },\r\n////////    thread2headline : function(doc){\r\n////////      return site2.common.thread2headline(doc,'4chan');\r\n////////    },\r\n//    get_json_url_thread: function(board,thread){\r\n//      return site.protocol + '//a.4cdn.org' + board +'thread/' + thread + '.json';\r\n//    },\r\n    get_json_url_catalog: function(board){\r\n      return site.protocol + '//a.4cdn.org' + board +'catalog.json';\r\n    },\r\n    uip_check: function(callback_in, callback_sage){\r\n//      var dbt = [site.nickname,site.board,site.no,(pref.uip_tracker.sage.detect)? 'catalog_json' : 'thread_json']; // catalog doesn't contain 'unique_ips'\r\n      var dbt = [site.nickname,site.board,site.no,'thread_json']; // [site.protocol + '//a.4cdn.org' + site.board +'thread/' + site.no + '.json', 'json'];\r\n      var callback = (pref.test_mode['136'] && pClg)? function(key,value,args){\r\n        callback_in(key,value,args);\r\n        var ths = cataLog.scan_boards_keyword_callback2(key,value, ['sage_detect',{refresh:null, __proto__:cataLog.scan_boards_keyword_callback2_default_args}]);\r\n      } : callback_in; // callback2 merges deleted posts to show.\r\n//      var callback = (pref.test_mode['136'] && pClg)? function(key,value,args){cataLog.scan_boards_keyword_callback2(key,value, ['sage_detect',{refresh:null, __proto__:cataLog.scan_boards_keyword_callback2_default_args}]); callback_in(key,value,args);} : callback_in;\r\n      http_req.get('uip',dbt.join(),'',callback,false,false);\r\n      if (pref.uip_tracker.sage.detect) {\r\n        dbt[3] = 'catalog_json';\r\n        http_req.get('sage_detection',dbt.join(),'',this.sage_detect,false,false, callback_sage);\r\n      }\r\n    },\r\n    sage_detect: function(key,value, callback){\r\n      var dbt = key.split(',');\r\n      var ths = pref.test_mode['136'] && pClg? cataLog.scan_boards_keyword_callback2(key,value, ['sage_detect',{refresh:null, __proto__:cataLog.scan_boards_keyword_callback2_default_args}])\r\n              : site2['4chan'].wrap_to_parse.get(value.response, dbt[0], dbt[1], dbt[3], {page:0});\r\n      var obj = site2['4chan'].parse_funcs['catalog_json'].add_sage(ths, site.no) || ths.filter(function(th){return th.no===site.no;})[0];\r\n      callback(obj, value.response[0].threads.length);\r\n    },\r\n    sage_detect_all: function(ths){\r\n      this.parse_funcs['catalog_json'].add_sage(ths, null);\r\n      for (var i=0;i<ths.length;i++) {\r\n        var posts = ths[i].posts;\r\n        var lth = liveTag.mems.init(ths[i]); // ths[i].lth;\r\n        for (var j=0;j<posts.length;j++) {\r\n          if (posts[j].email==='sage') {\r\n            if (!lth.sg) lth.sg = new Set();\r\n            lth.sg.add(posts[j].no);\r\n          }\r\n        }\r\n        if (pref.catalog.page_his) { // qeuivalent to show_page in uip_tracker\r\n          if (!lth.pgh) lth.pgh = {};\r\n          var pgh = lth.pgh;\r\n          var no = ths[i].posts[ths[i].posts.length-1].no;\r\n          if (!pgh[no]) pgh[no] = [i];\r\n          else this.page_his_update(pgh[no],i);\r\n        }\r\n      }\r\n    },\r\n    page_his_update: function(pgh,now){\r\n      var last = pgh[pgh.length-1];\r\n      if (last!=now) pgh[pgh.length - (pgh.length<=1? 0 : last<now && pgh[pgh.length-2]<last? 1:0)] = now;\r\n//      if (last!=now) pgh[pgh.length - (pgh.length>=3 && pgh.length%2===1? 0 : pgh.length>1 && last<now? 1:0)] = now;\r\n      return last!=now;\r\n    },\r\n    parse_json_thread: function(obj,from_http){\r\n      if (from_http) {\r\n//        var obj = JSON.parse(txt);\r\n        obj.posts[obj.posts.length-1]['unique_ips'] = obj.posts[0]['unique_ips'];\r\n        return obj;\r\n      } else {\r\n        var obj = {posts: []};\r\n        var uids = {};\r\n        var nof_uids = 0;\r\n        var posts = document.getElementsByClassName('postContainer');\r\n        for (var i=0;i<posts.length;i++) {\r\n          obj.posts[i] = {};\r\n          obj.posts[i].no = posts[i].id.replace(/pc/,'');\r\n          var id = posts[i].getElementsByClassName('posteruid')[0];\r\n          if (id) {\r\n            id = id.textContent;\r\n            obj.posts[i].id = id;\r\n            if (uids[id]===undefined) {\r\n              nof_uids++;\r\n              uids[id] = 1;\r\n            }\r\n          }\r\n          obj.posts[i].unique_ips = nof_uids;\r\n        }\r\n//        obj.posts[posts.length-1].unique_ips = document.getElementById('unique-ips').textContent; // not refreshed.\r\n        obj.posts[posts.length-1].unique_ips = 0;\r\n        return obj;\r\n      }\r\n    },\r\n    uip_tgt_post : function(no){\r\n      return document.getElementById('p'+no);\r\n//      return document.getElementById('pc'+no);\r\n    },\r\n    uip_post_num : function(tgt_post){\r\n      return tgt_post.getElementsByClassName('postNum');\r\n    },\r\n    prep_own_posts_reg: /^4chan\\-track\\-[0-9A-z]+\\-[0-9]+$/,\r\n    prep_own_posts_event : function(e){\r\n      if (e) if (site2['4chan'].prep_own_posts_1(e.key)) e = null;\r\n      if (window.name==='4chan' && !e) send_message('parent',['OWN_POSTS', window.name, site3[window.name].own_posts]);\r\n    },\r\n    prep_own_posts : function(bt){\r\n      site3[this.nickname].own_posts = {};\r\n      if (localStorage) {\r\n        var keys = (bt)? [('4chan-track'+bt).replace(/\\//g,'-')] :\r\n                         Object.keys(localStorage || '{}');\r\n        for (var i=0;i<keys.length;i++) this.prep_own_posts_1(keys[i]);\r\n      }\r\n//console.log(site3[this.nickname].own_posts);\r\n    },\r\n    prep_own_posts_1 : function(key){\r\n      if (this.prep_own_posts_reg.test(key)) {\r\n        var board = '/' + key.replace(/^4chan\\-track\\-/,'').replace(/\\-[0-9]+$/,'') + '/';\r\n        if (!site3[this.nickname].own_posts[board]) site3[this.nickname].own_posts[board] = {};\r\n        var nos = JSON.parse(localStorage[key] || '{}');\r\n        for (var j in nos) site3[this.nickname].own_posts[board][j.substr(2)] = null;\r\n        return true;\r\n      }\r\n      return false;\r\n    },\r\n    catalog_native_prep_wait_loop: null,\r\n    catalog_native_prep_wait_loop_if_searched: function(whereami,invoke_func){\r\n      var qf_ctrl = document.getElementById('qf-ctrl');\r\n      var qf_clear = document.getElementById('qf-clear');\r\n      var func = function(){\r\n        qf_ctrl.removeEventListener('click',func,false);\r\n        qf_clear.removeEventListener('click',func,false);\r\n        setTimeout(invoke_func,100);\r\n      };\r\n      qf_ctrl.addEventListener('click',func,false);\r\n      qf_clear.addEventListener('click',func,false);\r\n    },\r\n    catalog_native_prep_watcher: true,\r\n    catalog_native_prep: function(pn_filter,pn_tb,pn_hi, clg){\r\n      var node_ref = (clg.mode==='catalog')? document.getElementById('ctrl') :\r\n                                             document.getElementById('ctrl-top');\r\n      if (clg.mode!=='float') {\r\n        if (clg.mode==='thread' || !node_ref) { // !node_ref for 4chan-X v1.13.8.7\r\n          var node_ref = document.getElementsByClassName('navLinks');\r\n          for (var i=0;i<node_ref.length;i++)\r\n            if (window.getComputedStyle(node_ref[i]).display!=='none') {node_ref = node_ref[i]; break;}\r\n        }\r\n//      pn_tb.setAttribute('style', 'float:right');\r\n        site2['DEFAULT'].catalog_native_prep_sel(pn_filter,pn_tb,clg.mode==='catalog'? document.getElementById('order-ctrl') : null);\r\n      }\r\n      var ref_size = clg.components.native_size;\r\n      var pn_size = (clg.mode==='catalog')? cnst.cloneSwap(document.getElementById('size-ctrl'))\r\n        : cnst.doms_insertBefore(null, '<br>&emsp;<select size=\"1\"> <option value=\"small\">Small</option> <option value=\"large\">Large</option> </select>', ref_size);\r\n      pn_size.add(cnst.dom('<option>custom</option>'));\r\n      if (clg.mode==='float') pn_size.selectedIndex = pref.float.catalog_size;\r\n      clg.pref[clg.mode].format.thumb.size = pn_size.value;\r\n      var pn_teaser = (clg.mode==='catalog')? cnst.cloneSwap(document.getElementById('teaser-ctrl'))\r\n        : ref_size.parentNode.insertBefore(cnst.dom('<select size=\"1\"> <option value=\"off\">Off</option> <option value=\"on\">On</option> </select>'), ref_size);\r\n      if (clg.mode==='float') pn_teaser.selectedIndex = pref.float.catalog_teaser;\r\n      var size_changed = size_changed_factory(clg, pn_size, pn_teaser);\r\n      pref_func.settings.html_funcs.design_of_fc_size_doms_register(pn_size, pn_teaser);\r\n      pn_size.addEventListener('change', size_changed, false);\r\n      pn_teaser.addEventListener('change', size_changed, false);\r\n//        pn_size.addEventListener('change', site2['4chan'].catalog_native_size_changed, false);\r\n\r\n      if (clg.mode==='catalog') {\r\n////        var fl = document.getElementById('filters-ctrl'); // working code.\r\n////        fl.parentNode.setAttribute('style','display:none');\r\n////        var qf2 = this.catalog_native_prep_clonenode(document.getElementById('qf-box'));\r\n//////        var qf = document.getElementById('qf-box');\r\n//////        var qf2= qf.cloneNode();\r\n//////        qf2.name = 'CatChan_qf2';\r\n//////        qf.parentNode.insertBefore(qf2,qf.nextSibling);\r\n//////        qf.setAttribute('style','display:none');\r\n////        var kwd_str = document.getElementsByName('filter.kwd.str')[0];\r\n////        if (kwd_str.value!=='') {\r\n////          kwd_str.value = '';\r\n////          pref_func.apply_prep(kwd_str,true,true);\r\n////        }\r\n////        qf2.onkeyup = function(){\r\n////          pref.filter.kwd.str = this.value;\r\n////          pref_func.apply_prep(kwd_str,false);\r\n////          kwd_str.onkeyup();\r\n////        }\r\n////        var qfctrl = this.catalog_native_prep_clonenode(document.getElementById('qf-ctrl'),true);\r\n////        qfctrl.onclick = function(){\r\n////          var qf_cnt = document.getElementById('qf-cnt');\r\n////          if (qf_cnt.style.display==='none') qf_cnt.style.display = 'inline';\r\n////          else {\r\n////            qf_cnt.style.display = 'none';\r\n////            qf2.value = '';\r\n////            qf2.onkeyup();\r\n////          }\r\n////        }\r\n////        var qfc = this.catalog_native_prep_clonenode(document.getElementById('qf-clear'),true);\r\n////        qfc.onclick = function(){\r\n////          qfctrl.onclick();\r\n////        }\r\n        clg.kwd_init(document.getElementById('qf-box'), pn_filter, this.catalog_native_prep_wait_loop).id = null;\r\n        document.getElementById('qf-ctrl').addEventListener('click',clg.kwd_clear,false);\r\n        document.getElementById('qf-clear').addEventListener('click',clg.kwd_clear,false);\r\n////        var qf = document.getElementById('qf-box');\r\n////        var qf2 = qf.cloneNode(false);\r\n////        qf2.name = 'filter.kwd.str';\r\n////        qf2.id = null;\r\n////        qf2.oninput = cataLog.event_func;\r\n////        qf.parentNode.insertBefore(qf2,qf);\r\n////        qf.setAttribute('style','display:none');\r\n////        pref3.filter.kwd.obj = [pn_filter.getElementsByTagName('input')['filter.kwd.str'], qf2];\r\n//        var clear_func = pref3.filter.kwd.clear.bind(pref3.filter.kwd);\r\n//        document.getElementById('qf-ctrl').addEventListener('click',clear_func,false);\r\n//        document.getElementById('qf-clear').addEventListener('click',clear_func,false);\r\n//        clear_func();\r\n\r\n//        var pn_tb_new = document.createElement('span');\r\n//        while (pn_tb.firstChild) pn_tb_new.appendChild(pn_tb.firstChild);\r\n//        pn_tb = pn_tb_new;\r\n//        pn_tb.appendChild(pn_tb.removeChild(pn_tb.childNodes[3]).firstChild);\r\n        var settings = document.getElementById('settings');\r\n        pn_tb.childNodes[3].style.float = 'left';\r\n        pn_tb.style.float = 'right';\r\n        node_ref.appendChild(pn_filter);\r\n        node_ref.insertBefore(pn_tb.childNodes[3],settings);\r\n        node_ref.insertBefore(pn_tb,settings);\r\n      } else if (clg.mode==='page') {\r\n        pn_tb.childNodes[3].style.display = 'inline';\r\n        pn_tb.style.float = 'right';\r\n        node_ref.appendChild(pn_tb.childNodes[3]);\r\n        node_ref.appendChild(pn_tb);\r\n        node_ref.appendChild(pn_filter);\r\n//        var pctrls = document.getElementsByClassName('board')[0]; // test patch\r\n//        for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.removeChild(pctrls.childNodes[i]);\r\n//        pctrls.parentNode.insertBefore(document.createElement('hr'),pctrls.nextSibling);\r\n      } else if (clg.mode==='thread') {\r\n//      node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n        node_ref.appendChild(pn_tb);\r\n        node_ref.appendChild(pn_filter);\r\n        document.getElementsByClassName('navLinksBot')[0].appendChild(pn_hi);\r\n      }\r\n//      node_ref.parentNode.insertBefore(pn_filter,node_ref);\r\n////////      return site2['4chan'].catalog_from_native(date,document,site.board,clg.mode+'_html');\r\n      if (site.whereami==='archive') {\r\n        styleSheet.register_cc('threads','padding:20px 0;text-align:center;');\r\n        styleSheet.register_cc('threads>.thread','width:180px;max-height:320px;vertical-align:top;display:inline-block;word-wrap:break-word;overflow:hidden;margin-top:5px;margin-bottom:20px;padding:5px 0 3px;position:relative;');\r\n      }\r\n      var teasers = ['','extended-'];\r\n      var sizes = ['small','large','custom'];\r\n      function size_changed_factory(clg, pn_size, pn_teaser){\r\n        return function size_changed(e){\r\n          clg.ppn.setAttribute('class',clg.ppn.getAttribute('class').replace(/(extended\\-)*(small|large|custom)/g,'').replace(/\\s\\s*/,' ').replace(/^\\s|\\s$/,''));\r\n          if (clg.view==='catalog') clg.ppn.classList.add(teasers[pn_teaser.selectedIndex]+sizes[pn_size.selectedIndex]);\r\n          if (!e) return;\r\n          if (e.target===pn_size) clg.image_resize_all(e.target.value);\r\n          if (clg.mode==='catalog') if (localStorage) localStorage['catalog-settings'] = JSON.stringify({extended:pn_teaser.selectedIndex==1, large:pn_size.selectedIndex==1, orderby:'alt'});\r\n          e.stopPropagation();\r\n        };\r\n      }\r\n      clg.native.viewChanged = size_changed;\r\n    },\r\n//    catalog_native_prep_clonenode : function(node,deep) { // working code\r\n//      var cn = node.cloneNode(deep);\r\n//      cn.setAttribute('name',((cn.name)? cn.name : 'clone_node') + '_CatChan');\r\n//      node.parentNode.insertBefore(cn,node.nextSibling);\r\n//      node.setAttribute('style','display:none');\r\n//      return cn;\r\n//    },\r\n////////    catalog_from_native : function(date,doc,board,type) { // working code.\r\n////////      return this.wrap_to_parse.get(doc, this.nickname, board, type);\r\n////////    },\r\n//    catalog_from_native : function(date,doc,board,type) { // working code.\r\n//      var parse_obj = {domain:'4chan', board:board, parse_funcs:site2['4chan'].parse_funcs[type], __proto__:site4.parse_funcs_on_demand};\r\n//      var ths = {pn:doc, __proto__:parse_obj};\r\n//      return ths.ths;\r\n//    },\r\n    catalog_get_native_area: function(){\r\n      if (site.whereami==='archive') {\r\n        var arc = document.getElementById('arc-list');\r\n        var div = document.createElement('div');\r\n        div.setAttribute('class',pref.script_prefix+'_threads');\r\n        arc.parentNode.insertBefore(div,arc);\r\n        var btn = document.createElement('button');\r\n        btn.textContent= 'More threads';\r\n        arc.parentNode.insertBefore(btn,arc);\r\n        btn.onclick = function(){\r\n          cataLog.insert_myself(null,null,true);}; // argument init is a patch for patch, should be removed.\r\n        return div;\r\n      }\r\n      return (site.whereami==='catalog')? document.getElementById('threads') : document.getElementsByClassName('board')[0];\r\n    },\r\n//    catalog_native_size: (document.getElementById('size-ctrl'))? document.getElementById('size-ctrl').value : 'small',\r\n//    catalog_native_size_changed: function(e){ // working code\r\n//      pref.catalog.format.thumb.size = e.target.value;\r\n////      site2['4chan'].catalog_native_size = e.target.value;\r\n////      document.getElementById('threads').innerHTML = ''; // 4chan rewrites innerHTML, this can be used also.\r\n//      var ths = document.getElementsByClassName('thread');\r\n//      for (var i=ths.length-1;i>=0;i--) if (!gGEH.pns_all_keys.has(ths[i])) ths[i].parentNode.removeChild(ths[i]);\r\n//      pClg.image_resize_all(e.target.value);\r\n//      pClg.drawn_idx = 0;\r\n//      pClg.show_catalog();\r\n////      var threads = catalog_obj.catalog_func().get_threads();\r\n////      for (var name in threads) if (threads[name][0]) site2['4chan'].catalog_json2html3_size_changed(threads[name][0].getElementsByTagName('img')[0]);\r\n////      catalog_obj.catalog_func().show_catalog();\r\n//    },\r\n    catalog_float_prep: function(clg){\r\n      if (site.whereami==='catalog') clg.ppn.appendChild(cnst.dom('<div style=\"clear:both\"></div>'));\r\n    },\r\n    parse_funcs : { // 4chan\r\n      'catalog_html': {\r\n        ths_hook: function(callback){ // https://stackoverflow.com/questions/34235401/greasemonkey-sharing-data-between-two-scripts-running-in-same-tab\r\n          var pn = document.createElement('script');\r\n          pn.innerHTML = 'var clg; try{clg = JSON.stringify(catalog);} catch (e){clg = null;} document.body.lastChild.textContent = clg;';\r\n          var ob = new MutationObserver(function(e){\r\n            document.body.removeChild(pn);\r\n            ob.disconnect();\r\n            try {\r\n              site.data_embedded = JSON.parse(pn.textContent);\r\n            } catch (e) {}\r\n            callback();\r\n          });\r\n          ob.observe(pn, {childList:true});\r\n          document.body.appendChild(pn);\r\n        },\r\n        ths: function(doc){\r\n          var pns = doc.pn.getElementsByClassName('thread');\r\n          var obj = site.data_embedded;\r\n          if (!obj) return this.ths_array(doc, pns);\r\n          var ths= [];\r\n          var proto = {\r\n            get filename(){return this.file.slice(0,this.file.indexOf('.'));},\r\n            get tim(){return this.imgurl;},\r\n            get ext(){return this.file.slice(this.file.lastIndexOf('.'));},\r\n            get name(){return this.author;},\r\n            get com(){return Object.defineProperty(this,'com',{value:site2['4chan'].link_sanitizedTxt2html(this.teaser, this), writable:true, configurable:true, enumerable:true}).com;},\r\n            parse_funcs: {type_com:'html', __proto__:this},\r\n//            get com(){return this.teaser;},\r\n            missing_info:undefined,\r\n            __proto__:doc.__proto__\r\n          };\r\n          for (var i in obj.threads) {\r\n            var th = obj.threads[i];\r\n            if (th.b>pns.length) continue; // for safe\r\n            th.no = parseInt(i,10); // patch for 4chan's bug. why do they use string for no?\r\n            th.page = Math.floor(th.b/(obj.pagesize || 15))+'.'+th.b%(obj.pagesize || 15);\r\n            th.nof_posts = th.r+1;\r\n            th.nof_files = th.i+1;\r\n            th.time_created = th.date * 1000;\r\n            th.time_posted = (th.lr && th.lr.date || th.date) * 1000;\r\n            th.time_bumped = th.time_posted;\r\n            th.time = th.date;\r\n            th.name = th.author || obj.anon;\r\n            if (th.lr && th.lr.id!=i) {\r\n              th.last_name = th.lr.author || obj.anon;\r\n              th.last_no   = th.lr.id;\r\n            }\r\n            if (pref.test_mode['159']) {\r\n              th.last_modified = th.lr && th.lr.date || th.date; // for add_sage\r\n              var post_1 = (th.lr && th.lr.id!=i)? {name:th.lr.author || obj.anon, no:th.lr.id, time:th.lr.date} : null;\r\n            }\r\n//            th.pn = pns[th.b]; // copy for extracting params in remake_html_prep at merging/unmerging // doesn't work, pn was destroyed already at extraction\r\n            th.__proto__ = proto;\r\n            if (pref.test_mode['146']) {\r\n              var ts = pns[th.b].getElementsByClassName('teaser')[0];\r\n              var html_new = (th.sub? '<b>'+th.sub+'</b>: ':'')+th.com;\r\n              if (html_new!==ts.innerHTML.replace(/\\'/g,'&#039;')) ts.innerHTML = html_new;\r\n            }\r\n            ths[th.b] = {\r\n              pn: pns[th.b],\r\n              posts: post_1? [th, post_1] : [th], __proto__:th};\r\n          }\r\n//            var lbd = liveTag.mems['4chan'][site.board]; // ths is captured here.\r\n//            for (var i=0;i<ths.length;i++) {\r\n//              var th = obj.threads[ths[i].no]; // obj.threads[x].b means i\r\n//              if (th) {\r\n//                th.no = ths[i].no;\r\n////                th.page = Math.floor(i/(obj.pagesize || 15))+'.'+i%(obj.pagesize || 15);\r\n//                th.pn = ths[i].pn;\r\n//                th.__proto__ = proto;\r\n//                lbd[ths[i].no].th = th;\r\n//                lbd[ths[i].no].ta.posts= [th];\r\n//              }\r\n//            }\r\n          if (pref.test_mode['159']) {\r\n            site2['4chan'].parse_funcs['catalog_json'].add_sage(ths);\r\n            for (var i=0;i<ths.length;i++) ths[i].posts.splice(1,1);\r\n          }\r\n          return ths;\r\n        },\r\n//        ths: 'thread_html',\r\n//        th_init: function(th) {\r\n//          th.pn.getElementsByTagName('a')[0].addEventListener('click',th.parse_funcs.preventDefault,false);\r\n//        },\r\n//        th_destroy: function(pn, parse_funcs){\r\n//          pn.getElementsByTagName('a')[0].removeEventListener('click',parse_funcs.preventDefault,false);\r\n//        },\r\n//        ths: function(doc) {\r\n//          var ths = this.ths_array(doc,doc.pn.getElementsByClassName('thread'));\r\n//          for (var i=0;i<ths.length;i++)\r\n//            ths[i].pn.getElementsByTagName('a')[0].removeAttribute('href');\r\n//          return ths;\r\n//        },\r\n        no : function(th){return parseInt(th.pn.getAttribute('id').substr(7),10);},\r\n        time_bumped: function(th){return 0;},\r\n        time_created : function(th){return 0;},\r\n        nof_posts: function(th){\r\n          var tmp = th.footer.textContent.match(/[0-9]+/g);\r\n          var nof_files = tmp && tmp[1] && parseInt(tmp[1],10)+1 || 1;\r\n          Object.defineProperty(th, 'nof_files', {value:nof_files, enumerable:true, writable:true, configurable:true});\r\n          return tmp && parseInt(tmp[0],10)+1 || 1;\r\n        },\r\n        nof_files: function(th){\r\n          var tmp = th.footer.textContent.match(/[0-9]+/g);\r\n          var nof_posts = tmp && parseInt(tmp[0],10)+1 || 1;\r\n          Object.defineProperty(th, 'nof_posts', {value:nof_posts, enumerable:true, writable:true, configurable:true});\r\n          return tmp && tmp[1] && parseInt(tmp[1],10)+1 || 1;\r\n        },\r\n        sub: function(th){\r\n          var ts = th.pn.getElementsByClassName('teaser')[0];\r\n          var sub = (ts)? ts.getElementsByTagName('b') : null;\r\n          var com = (!ts)? '' : (sub && sub[0])? ((ts.childNodes[1])? ts.childNodes[1].textContent : '') : ts.childNodes[0].textContent;\r\n          Object.defineProperty(th, 'com', {value:com, enumerable:true, writable:true, configurable:true});\r\n          return (sub && sub[0])? sub[0].textContent : '';\r\n        },\r\n        name: function(th){return '';},\r\n        com: function(th){\r\n          if (!th.hasOwnProperty('sub')) Object.defineProperty(th, 'sub', {value:this['sub'](th), enumerable:true, writable:true, configurable:true});\r\n          return th.com;\r\n        },\r\n        footer: function(th){\r\n          return th.pn.getElementsByClassName('meta')[0]; // must parse pn because of mimic mode.\r\n//          footer.innerHTML = '';\r\n        },\r\n        sticky: function(th){return th.pn.getElementsByClassName('stickyIcon')[0]!==undefined;},\r\n//        format: function(th){th.pn.getElementsByTagName('a')[0].removeAttribute('href');return null;},\r\n        tn_as: function(th){return th.pn.getElementsByTagName('a');},\r\n//        tn_imgs: function(th){ // doesn't work with merge\r\n//          var a0 = th.pn.getElementsByTagName('a')[0];\r\n//          return (a0)? [a0.getElementsByTagName('img')[0]] : [];}, // for chart popup, not using tn_as\r\n//        tn_imgs: function(th){return (th.tn_as[0])? [th.tn_as[0].getElementsByTagName('img')[0]] : [];},\r\n        class_thread: 'thread',\r\n        class_thumbnail: 'thumb',\r\n//        op_img_url: function(th){ // working code.\r\n//          var img = th.pn.getElementsByTagName('img')[0];\r\n//          return (img)? img.getAttribute('src') : undefined; // patch.\r\n//        },\r\n        op_img_url: function(th){return site2['4chan'].catalog_json2html3_thumbnail(th,th.board) || th.tn_imgs[0] && th.tn_imgs[0].getAttribute('src') || undefined;}, // patch. // BUG IN MIMIC MODE, BECAUSE THIS REQURES TH.PN AND TH.PN WILL BE WRITTEN AFTERWARDS. // moved from DEFAULT.common\r\n        get_op_src: 'thread_json',\r\n//        get_op_src: function(th){ // working code.\r\n//          return (th.op_img_url.indexOf('s.4cdn.org')!=-1)? th.op_img_url : th.op_img_url.replace(/s(\\.\\w+)$/,'$1');}, // TEMPORAL PATCH\r\n        dynamic_image_hover: true,\r\n        missing_info: 1,\r\n        img2src: function(img){\r\n          var dbt = site2['4chan'].popups_href2dbtp(img.parentNode.getAttribute('href'));\r\n          var lth = liveTag.mems.getFromName(dbt[0]+dbt[1]+dbt[2]);\r\n          return (!lth)? null\r\n            : (lth.th && lth.th.ext)? img.src.replace(/thumb/,'src').replace(/s\\.[^\\.]*$/,lth.th.ext)\r\n            : (lth.th.missing_info && cataLog.DIH.fetch_and_reentry([lth.domain+lth.board], img), img.src);\r\n        },\r\n        time_unit: 1000,\r\n//        posts: function(th){\r\n//          return (pref.test_mode['126'])? [{sub:th.sub, com:th.com, name:th.name, pn:undefined, __proto__:th.__proto__}] : [{sub:th.sub, com:th.com, name:th.name, get pn(){console.trace();return this._pn;}, _pn:th.pn}];}, // for debug\r\n        footer_prep: function(th, footer){\r\n          var pn = document.createElement('span');\r\n          var menu = footer.lastChild;\r\n          if (menu) footer.removeChild(menu); // remove native menu, which introduces inconsistencies.\r\n          footer.insertBefore(pn, footer.firstChild);\r\n//          footer.removeChild(footer.lastChild); // remove menu\r\n          var pn_next;\r\n          while (pn_next = pn.nextSibling) pn.appendChild(pn_next);\r\n          return pn;\r\n        },\r\n      },\r\n      'catalog_json' : {\r\n        ths: function(obj, parse_obj) {\r\n          var ths = [];\r\n          for (var i=0;i<obj.length;i++)\r\n            if (obj[i].threads) for (var j=0;j<obj[i].threads.length;j++) {\r\n              var tgt = obj[i].threads[j];\r\n              tgt.__proto__ = parse_obj;\r\n              ths[ths.length] = {\r\n                page: i + '.' + j,\r\n                key: parse_obj.domain + parse_obj.board + tgt.no,\r\n                __proto__: tgt,\r\n              }\r\n            }\r\n//          this.add_sage(ths);\r\n          return ths;\r\n        },\r\n//        ths: 'DEFAULT.catalog_json',\r\n        time_posted: function(th){return (th.last_replies)? th.last_replies[th.last_replies.length-1].time*1000 : th.time_created;},\r\n        time_bumped: function(th){return (th.bumplimit)? undefined : th.time_posted;},\r\n        time_created : function(th){return th.time*1000;},\r\n        nof_posts: function(th){return th.replies+1;}, // same as 8chan\r\n        nof_files: function(th){return th.images+1;},\r\n////        key: function(th){return th.domain + th.board + th.no;}, // same as 8chan\r\n////        sub: function(th){return (th.hasOwnProperty('sub'))? th.sub : '';},\r\n////        name: function(th){return (th.hasOwnProperty('name'))? th.name : '';},\r\n////        com: function(th){return (th.hasOwnProperty('com'))? th.com : '';},\r\n        op_img_url: 'DEFAULT.common',\r\n////        op_img_url: function(th) {\r\n////          return site2['4chan'].catalog_json2html3_thumbnail(th, th.board);},\r\n        //        footer: function(th){return th.pn.getElementsByClassName('meta')[0];},\r\n        posts: function(th){\r\n          return (th.last_replies)? [th.__proto__].concat(th.last_replies) : [th.__proto__];\r\n        },\r\n////        posts: function(th){\r\n////          var posts = site2['DEFAULT'].parse_funcs.catalog_json.posts(th);\r\n////          if (th.last_replies) posts = posts.concat(th.last_replies);\r\n////          return posts;\r\n////        },\r\n//////        posts: function(th){return th.last_replies;}, // can't show icon in desktop notification. // BUG, don't hit at search.\r\n//////        posts: function(th){ // work, but parse redundantly\r\n//////          if (th.last_replies) for (var i=0;i<th.last_replies.length;i++)\r\n//////            th.last_replies[i].op_img_url = site2['4chan'].catalog_json2html3_thumbnail(th.last_replies[i], th.board);\r\n//////          return th.last_replies;\r\n//////        },\r\n        has_posts: true,\r\n////        last_replies: function(th){return undefined;}, // stop parsing loop between 'posts' and 'last_replies'\r\n//        add_op_img_url: function(th){  // slow in chrome because of making needless prefetch.\r\n//          for (var i=0;i<th.posts.length;i++)\r\n//            th.posts[i].op_img_url = site2['4chan'].catalog_json2html3_thumbnail(th.posts[i], th.board);\r\n//        },\r\n//        add_op_img_url: function(posts,board){\r\n//          for (var i=0;i<posts.length;i++)\r\n//            posts[i].op_img_url = site2['4chan'].catalog_json2html3_thumbnail(posts[i], board);\r\n//        },\r\n        add_op_img_url: site2['DEFAULT'].parse_parts.add_op_img_url,\r\n        time_unit: 1000,\r\n        get_op_src: 'thread_json',\r\n        type_com: 'html',\r\n        posts_full: null,\r\n////        posts_full: 'DEFAULT.catalog_json',\r\n        missing_info: undefined,\r\n        tn_as: 'catalog_html',\r\n        tn_imgs: 'catalog_html',\r\n        footer: 'catalog_html',\r\n        class_thread: 'catalog_html',\r\n        class_thumbnail: 'catalog_html',\r\n        add_sage: (function(){\r\n          var bumps = {};\r\n          var pages = {};\r\n//          function i2pkey(i,skey,post){\r\n//            return 'p'+Math.floor(i/15)+'.'+(i%15)+', '+skey+'#'+post.no;\r\n//          }\r\n          function log_post(th,j){\r\n            var skey = (th.domain!==site.nickname? th.domain : '') + (th.board!==site.board? th.board : '') + th.no;\r\n            return 'p'+th.page+', '+skey+'#'+th.posts[j].no+', '+th.posts[j].time;\r\n          }\r\n//          function debug_out(ths, i, cap, old){\r\n//            var hist = (old)? history_latest_bump_old : history_latest_bump;\r\n//            ths.slice(i>=5?i-5:0,i+5).map(function(th,i){console.log(cap, th.no, hist[i], new Date(hist[i]*1000).toLocaleString(), th.last_modified, new Date(th.last_modified*1000).toLocaleString(), th.page, th.bumplimit);});\r\n//          }\r\n//          var history_latest_bump = [];\r\n//          var history_latest_bump_old;\r\n//          var ths_old;\r\n          return function(ths, end_no){\r\n            var pf = pref.uip_tracker.sage;\r\n            var i=0;\r\n            while (i<ths.length && ths[i].sticky) if (ths[i].no===end_no) return ths[i]; else i++;\r\n            if (pf.patch_bug3) { // ignore not updated data\r\n              var skeyb = (ths[0].domain!==site.nickname? ths[0].domain : '') + ths[0].board;\r\n              var latest_bump = bumps[skeyb] || 0;\r\n              while (i<ths.length && ths[i].last_modified<latest_bump) if (ths[i].no===end_no) return ths[i]; else i++;\r\n              if (i<ths.length) bumps[skeyb] = ths[i].last_modified;\r\n              var j=i;\r\n              while (--j>=0) Object.defineProperty(ths[j],'time_bumped',{value:ths[i].last_modified*tu, enumerable:true, configurable:true, writable:true});\r\n            }\r\n            if (i==ths.length) return;\r\n            if (ths[i].no==end_no) return ths[i];\r\n            latest_bump = ths[i].last_modified; // for deletion of the last post, instead of ths[i].posts[ths[i].posts.length-1].time;\r\n            var skey0 = (ths[0].domain!==site.nickname? ths[0].domain : '') + (ths[0].board!==site.board? ths[0].board : '');\r\n            var tu = this.time_unit;\r\n            var idxs_aged = [];\r\n            var bad_data = false;\r\n            while (++i<ths.length) { // can't use stateful fast approach because of 4chan's bug.\r\n              var th = ths[i];\r\n//              if (pref.debug_mode['30']) history_latest_bump[i] = latest_bump;\r\n              var skey = skey0? skey0 + th.no : th.no; // retain numeric type.\r\n              if (!th.bumplimit) {\r\n                for (var j=th.posts.length-1;j>=1;j--) { // annotate all\r\n                  var time = th.posts[j].time;\r\n                  if (bumps[skey]===time && i<pages[skey]) {\r\n                    if (pref.debug_mode['30']) console.log('Bumped without any posts: p'+i+'<-'+pages[skey]+', '+log_post(th,j)+', '+(i<ths.length-2? ths[i+1].posts[ths[i+1].posts.length-1].time : '')+', '+latest_bump);\r\n                    bad_data = true;\r\n                    break;\r\n                  }\r\n                  if (bumps[skey]>=time) break; // for deletion and reentry\r\n                  if (latest_bump+pf.tolerance>=time) break; // bug of 4chan at roundup, 1 tolerance is required.\r\n  //                if (latest_bump>=time) break;\r\n                  if (pf.patch_bug4) {\r\n                    if (i<pages[skey] && (j>=2 || th.nof_posts===1) && th.posts[j-1].time<=bumps[skey]) { // In case of that all new posts are saged but page order is younger than before.\r\n                      var sure = (j===th.posts.length-1) && j-1>=0 && th.posts[j-1].time===bumps[skey] && !(bumps[skey]+pf.tolerance>=latest_bump); // 100% sure if there is only one new post and its previous post is newer than 'latest_bump'\r\n                      if (pref.debug_mode['30']) console.log('RECOVERED by page history: '+log_post(th,j)+', '+(sure?'sure':'maybe')+', p'+i+'<-'+pages[skey]+', '+time+'<-'+bumps[skey]+', '+latest_bump);\r\n                      latest_bump = time;\r\n                      var r = i;\r\n                      while (--r>=0) {\r\n                        var k = idxs_aged[r] || ths[r].posts.length-1; // refers aged last post\r\n                        var time_recovered = ths[r].posts[k].time;\r\n                        if (time_recovered+pf.tolerance>=latest_bump) break;\r\n                        while (++k<ths[r].posts.length) {\r\n                          idxs_aged[r] = k; // idxs_aged must refers existing post\r\n                          ths[r].posts[k].email = '';\r\n                          if (pref.debug_mode['30']) console.log('Recovered saged posts: '+log_post(ths[r],k)+', '+latest_bump);\r\n                          time_recovered = ths[r].posts[k].time;\r\n                          if (time_recovered+pf.tolerance>=latest_bump) {\r\n                            latest_bump = (time_recovered>latest_bump)? time_recovered : latest_bump;\r\n                            Object.defineProperty(ths[r],'time_bumped',{value:latest_bump*tu, enumerable:true, configurable:true, writable:true});\r\n                            break;\r\n                          }\r\n                        }\r\n                        if (k===ths[r].posts.length) if (pref.debug_mode['30']) console.log('There should be updated data after: '+log_post(ths[r],k-1)+', '+latest_bump);\r\n                      }\r\n//                      if (pref.debug_mode['30']) {debug_out(ths,i,'new',false);debug_out(ths_old,i,'old',true);}\r\n                      bad_data = true;\r\n                      break;\r\n                    }\r\n                  }\r\n                  th.posts[j].email = 'sage'; // vichan has 'email' field.\r\n                  if (pref.debug_mode['30']) console.log('detect: sage: '+log_post(th,j)+', '+time+', '+latest_bump);\r\n                }\r\n                idxs_aged[i] = j;\r\n                if (j===0) time = (th.nof_posts===th.posts.length)? th.posts[0].time : latest_bump -1; //all posts are saged or new thread without any posts. // assuming -1 bump time\r\n//                if (th.nof_posts===1 || th.posts[th.posts.length-1].time!=th.last_modified) time = th.last_modified; // for deletion of the last post, assumes last post was age. th.posts.length===1 for new threads which has no posts.\r\n  //              if (time<th.last_modified) time = th.last_modified; // for deletion of the last post.\r\n                var bumped = bumps[skey]!=time;\r\n                if ((bumps[skey]||0)<time) bumps[skey] = time; // catalog doesn't have all posts.\r\n                if (bumped) latest_bump = (pf.patch_bug2 && i<pf.patch_bug2nth)? th.last_modified : bumps[skey]; // for fast board like /v/.\r\n//                Object.defineProperty(th,'time_bumped',{value:latest_bump*tu, enumerable:true, configurable:true, writable:true});\r\n              } else latest_bump--; // assuming -1 bump time for bumplimited threads\r\n              Object.defineProperty(th,'time_bumped',{value:latest_bump*tu, enumerable:true, configurable:true, writable:true});\r\n              pages[skey] = i;\r\n//              var obsolete = !bumped && i<pages[skey]; // )? pages[skey] : 0;\r\n//              pages[skey] = (obsolete)? pages[skey] : i; // lock to pages[skey], 10000 is too strict for thread deletion.\r\n//              pages[skey] = (obsolete)? 10000 : i; // lock to 10000 as a flag, since threads are bumped without new posts in 4chan.(bug)\r\n              if (th.no==end_no) return th;\r\n              if (pf.patch_bug5 && bad_data) {\r\n//              if (pf.patch_bug5 && (recovered!==estimated || obsolete)) {\r\n                if (i<ths.length-2 && time+pf.tolerance<ths[i+1].posts[ths[i+1].posts.length-1].time) {\r\n                  if (pref.debug_mode['30']) console.log('Vailed out by bad data: p'+i);\r\n//                  if (pref.debug_mode['30']) {debug_out(ths,i,'new',false);debug_out(ths_old,pages[skey],'old',true);}\r\n                  break;\r\n                }\r\n              }\r\n            }\r\n//            if (pref.debug_mode['30']) {ths_old = ths; history_latest_bump_old = history_latest_bump; history_latest_bump = [];};\r\n          };\r\n        })(),\r\n        flags: 'DEFAULT.page_json',\r\n        hrefs: 'DEFAULT.post_json',\r\n        proto: 'DEFAULT.common',\r\n//        proto: 'DEFAULT.catalog_json',\r\n      },\r\n      'page_html' : {\r\n        footer2: undefined,\r\n        ths: function(doc) {\r\n          var ths = this.ths_array(doc, doc.pn.getElementsByClassName('thread'));\r\n          if (pref.test_mode['159']) {\r\n            for (var i=0;i<ths.length;i++) {\r\n              site2['4chan'].wrap_to_parse.posts(ths[i]);\r\n              ths[i].last_modified = ths[i].posts[ths[i].posts.length-1].time;\r\n            }\r\n            site2['4chan'].parse_funcs['catalog_json'].add_sage(ths);\r\n          }\r\n          return ths;\r\n        },\r\n        proto: 'thread_html',\r\n      },\r\n      'thread_html' : {\r\n        time_created: 'DEFAULT.thread_json',\r\n        time_bumped: 'DEFAULT.thread_json',\r\n        time_posted: 'DEFAULT.thread_json',\r\n        posts: function(th){return this.posts_array(th, th.pn.querySelectorAll(':scope>.postContainer>.post'));}, // must be able to be used in live thread which may have poopups.\r\n        ths: function(doc) {return this.ths_array(doc, doc.pn.getElementsByClassName('thread'));},\r\n//        ths: function(doc) {return site2['DEFAULT'].parse_funcs['thread_html'].ths_array(doc, doc.pn.getElementById('t'+doc.thread));}, // working code.\r\n//        ths: function(doc) { // working code.\r\n//          return [{pn:doc.pn.getElementById('t'+doc.thread),\r\n//                   type_html: 'thread_html',\r\n//                   page: '?',\r\n//                   __proto__: doc.__proto__}];\r\n//        },\r\n\r\n//        pop_post: function(th){ // debuging code.\r\n//          th.post = th.posts[--th.idx_pop];\r\n//          return th.post;\r\n//        },\r\n//        pop_post_prep: function(th){\r\n//          delete th.posts;\r\n//          th.idx_pop = th.posts.length;\r\n//        },\r\n////        pop_post: function(th){ // working code\r\n////          while (th.idx_pop>=0) {\r\n////            var pn = th.children[th.idx_pop--];\r\n////            if (pn.className && pn.className.indexOf('postContainer')!=-1) {\r\n////              th.post = {pn:pn, parse_funcs:this, __proto__:th.__proto__};\r\n////              return true;\r\n////            }\r\n////          }\r\n////          return false;\r\n////        },\r\n//////        post_no: function(post){return parseInt(post.pn.id.substr(3),10);},\r\n////        post_no: function(post){return parseInt(post.pn.id.substr(2),10);}, // 2015.05.12, maybe depends on baord???\r\n        id: 'DEFAULT.thread_html',\r\n        country: 'DEFAULT.thread_html',\r\n        trip: 'DEFAULT.thread_html',\r\n        flag: 'DEFAULT.thread_html',\r\n        name: 'DEFAULT.thread_html',\r\n\r\n        th_init: function(th) {th.pn.removeAttribute('class');},\r\n//        th_destroy: function(pn, parse_funcs){},\r\n//        ths: function(doc) { // working code.\r\n//          var ths = this.ths_array(doc, doc.pn.getElementsByClassName('thread'));\r\n//          for (var i=0;i<ths.length;i++) {\r\n//            Object.defineProperty(ths[i], 'no', {value:ths[i].pn.id.substr(1), enumerable:true, writable:true, configurable:true});\r\n//            ths[i].pn.removeAttribute('class'); // collection ISN'T writable? and if wrote, its enumerator doesn't work.\r\n//          }\r\n//          return ths;\r\n//        },\r\n//        no : function(th){return parseInt(th.pn.getElementsByClassName('postContainer')[0].id.substring(2),10);},\r\n//        last_replies: 'catalog_json',\r\n        nof_posts: function(th){\r\n          var nof_posts = th.pn.getElementsByClassName('postContainer').length;\r\n          var nof_files = th.pn.getElementsByClassName('fileText').length;\r\n          var om_info   = th.pn.getElementsByClassName('summary desktop')[0];\r\n          if (om_info) {\r\n            var str = om_info[brwsr.innerText].replace(/\\n/g,'');\r\n            nof_posts += parseInt(str.replace(/\\ post.*/,''),10);\r\n            nof_files += parseInt('0'+str.replace(/\\ image.*/,'').replace(/[^\\ ]*\\ /g,''),10);\r\n          }\r\n          Object.defineProperty(th,'nof_files',{value:nof_files, enumerable:true, configurable:true, writable:true});\r\n          return nof_posts;\r\n        },\r\n        nof_files: function(th){\r\n          if (!th.hasOwnProperty('nof_posts')) this['nof_posts'](th);\r\n          return th.nof_files;\r\n        },\r\n//        name: function(post){return post.pn.getElementsByClassName('name')[0][brwsr.innerText];}, // same as 8chan\r\n        footer: function(th){return this.insert_footer4(th.pn.getElementsByClassName('postInfo')[0]);}, //  desktop')[0]);},\r\n        footer2:function(th){return document.getElementsByClassName('navLinksBot')[0].appendChild(cnst.dom('<div style=\"clear:both;float:right\"></div>'));},\r\n        sticky: function(th){return (th.pn.getElementsByClassName('stickyIcon').length!=0);},\r\n        op_img_url:function(th){\r\n          var img = th.pn.querySelector('img[data-md5]');\r\n//          var img = th.pn.getElementsByTagName('img')[0];\r\n          var url = (img)? img.getAttribute('src') : undefined;\r\n          return url;\r\n        },\r\n        get_thread_links : function(th){return th.pn.querySelectorAll('.replylink,.'+pref.script_prefix+'_link');}, // PATCH\r\n//        get_thread_links : function(th){return th.pn.getElementsByClassName('replylink');}, \r\n//        get_omitted_info : function(post){return post.pn.getElementsByClassName('summary')[0];},\r\n        get_omitted_info : function(post){\r\n          var omit_info = post.pn.parentNode && post.pn.parentNode.nextSibling;\r\n          return (omit_info && omit_info.classList.contains('summary'))? omit_info : undefined;\r\n//          var omit_info = post.pn.parentNode.parentNode; // working, but slow.\r\n//          if (omit_info) omit_info = omit_info.getElementsByClassName('summary')[0];\r\n////          if (omit_info && omit_info.childNodes[1]) omit_info = omit_info.childNodes[1];\r\n//          return omit_info;\r\n        },\r\n        set_omitted_info : function(post, info){post.pn.parentNode.parentNode.insertBefore(info, post.pn.parentNode.nextSibling);},\r\n        replace_omitted_info : function(dst, src){dst.childNodes[1].textContent = src.childNodes[1].textContent;}, // not used, but reffered from meguca.\r\n        replace_omitted_info2 : function(dst, src, th){\r\n//          if (!dst.childNodes[1]) { // for 4chan-X v1.13.8.7 in therad, but this isn't required.\r\n          if (dst.tagName==='A') { // for 4chan-X v1.13.8.7\r\n            var span = document.createElement('span');\r\n            span.setAttribute('class','summary');\r\n            span.appendChild(document.createElement('span'));\r\n            span.appendChild(dst);\r\n            dst = span;\r\n          }\r\n//          if (!src) dst.parentNode.removeChild(dst); // BUG, when I choose ALL in expander, the expander will disappear.\r\n          if (!src) {\r\n            dst.childNodes[0].setAttribute('style','display:none');\r\n            dst.childNodes[1].setAttribute('style','display:none');\r\n          } else {\r\n            if (dst.childNodes[1].style.display==='none') {\r\n              if (th.domain===site.nickname) dst.childNodes[0].removeAttribute('style');\r\n              dst.childNodes[1].removeAttribute('style');\r\n            }\r\n            this.replace_omitted_info(dst,src);\r\n          }\r\n        },\r\n        get_op_src: 'thread_json',\r\n        proto: 'post_html',\r\n      },\r\n      'page_json'  : {\r\n        ths: 'DEFAULT.page_json',\r\n        get_op_src: 'thread_json',\r\n        proto: 'thread_json'\r\n      },\r\n      'thread_json'  : {\r\n////        op_img_url: function(th){\r\n////          return site2[th.domain].catalog_json2html3_thumbnail(th.posts[0],th.board);},\r\n        tn_as: 'catalog_html.tn_as',\r\n        sticky: function(th){return th.posts[0].sticky;},\r\n//        time_bumped : function(obj){return (obj.posts[0].bumplimit)? undefined : obj.posts[obj.posts.length-1].time*1000;}, // 4chan doesn't have email field.\r\n//                   obj.posts[site3[this.domain].boards[this.board].bump_limit-2].time*1000 :   // for safety, 2.\r\n//        get_op_src: function(th){return th.op_img_url.replace(/s\\..*/,th.ext);},\r\n        get_op_src: function(th, img){\r\n          if (th.op_img_url.indexOf('s.4cdn.org')!=-1) return th.op_img_url;\r\n          if (!th.ext && th.missing_info) scan.scan_ui('image_hover', {tgts: [th.domain+th.board+'j0'], options:{callback:function(){cataLog.image_hover_reentry(img);}, priority:6}}); // NEVER ACTIVATED because catalog.json is read always at initial\r\n          return (th.localArchive)? site2[th.domain].catalog_json2html3_src(th,th.board) :\r\n                 (th.ext)? th.op_img_url.replace(/s(\\.\\w+)$/, th.ext) : img.src;\r\n//          return (th.ext)? th.op_img_url.replace(/s(\\.\\w+)$/, th.ext) : img.src;\r\n        },\r\n        consolidate_IDB_result_sub: function(posts){\r\n          posts[0].nof_posts = posts.length;\r\n          var nof_files = 0;\r\n          for (var i=0;i<posts.length;i++) if (posts[i].filename) nof_files++;\r\n          posts[0].nof_files = nof_files;\r\n        },\r\n        flags: 'DEFAULT.page_json',\r\n        hrefs: 'DEFAULT.post_json',\r\n        proto: 'DEFAULT.thread_json'\r\n      },\r\n      'post_html': {\r\n        no : function(th){\r\n          var id = th.pn.getAttribute('id');\r\n          return id? parseInt(id.substr(1),10) || parseInt(id.substr(2),10) : null}, // id check for thread_reader, it hits summary(expander)\r\n        time: function(post){\r\n          return parseInt(post.pn.getElementsByClassName('dateTime')[0].getAttribute('data-utc'),10);\r\n        },\r\n        time_pn: function(post_pn){return parseInt(post_pn.getElementsByClassName('dateTime')[0].getAttribute('data-utc'),10)*1000;}, // returns utc.\r\n        flag: function(post){return post.pn.getElementsByClassName('flag')[1] || post.tFlag;},\r\n        tFlag: function(post){return post.pn.getElementsByClassName('bfl')[1];}, // troll flag in /pol/ // countryFlag -> blf\r\n        country: function(post){\r\n          return (post.flag)? post.flag.getAttribute('class').replace(/\\s*flag\\-*/g,'').toUpperCase()\r\n            : (post.tFlag)? post.tFlag.className.replace(/\\s*bfl\\-*/g,'').toLowerCase() : undefined; // getAttribute('alt').toLowerCase() // lower case for troll flag\r\n        },\r\n        country_name: function(post){\r\n          return (post.flag)? post.flag.getAttribute('title') : (post.tFlag)? post.tFlag.getAttribute('title') : undefined;\r\n        },\r\n//        flag: function(post){\r\n//          var flag = post.pn.getElementsByClassName('flag')[1];\r\n////          var flag = (flags.length!=0)? document.importNode(flags[0],false) : null;\r\n//          if (flag) var country = flag.getAttribute('class').replace(/\\s*flag\\-*/g,'').toUpperCase();\r\n//          else {\r\n//            flag = post.pn.getElementsByClassName('countryFlag')[1]; // for /pol/\r\n//            if (flag) {\r\n//              country = flag.getAttribute('alt');\r\n//              post.troll_country = country.toUpperCase();\r\n//            }\r\n//          }\r\n//          Object.defineProperty(post,'country',{value:country, writable:true, configurable:true, enumerable:true});\r\n//          return flag;\r\n//        },\r\n//        country: function(post){\r\n//          var flag = post.flag;\r\n//          return post.country;\r\n//        },\r\n//        txt2com: function(txt){\r\n//          txt = txt.replace(/(^>[^>].*$)/mg,'<span class=\"quote\">$1</span>');\r\n//          txt = txt.replace(/\\*\\*([^(\\*\\*)]*)((\\*\\*)|$)/g,'<s>$1</s>');\r\n//          return txt.replace(/\\n/g,'<br>');},\r\n        txt2com_anchor_class: 'quotelink',\r\n        txt2com_spoiler_replace_txt: '<s>$1</s>',\r\n        pn_name: function(post){return post.pn.getElementsByClassName('desktop')[0].getElementsByClassName('name')[0];},\r\n        name: function(post){return this.pn_name(post).textContent;},\r\n        pn_id: function(post){\r\n          var pn = post.pn.getElementsByClassName('posteruid')[1];\r\n          return (pn)? pn.childNodes[1] : undefined;},\r\n        id: function(post){return (post.pn_id)? post.pn_id.textContent : undefined;},\r\n//        pn_id: function(post){return post.pn.getElementsByClassName('posteruid')[1];},\r\n//        id: function(post){return (post.pn_id)? post.pn_id.className.replace(/\\s*posteruid\\s*/,'').replace(/id_/,'') : undefined;},\r\n        pn_trip: function(post){return post.pn.getElementsByClassName('postertrip')[1];},\r\n        trip: function(post){return (post.pn_trip)? post.pn_trip.textContent : undefined;},\r\n\r\n        time_unit: 1000,\r\n        com:  function(post){return post.pn.getElementsByClassName('postMessage')[0].innerHTML;},\r\n        type_com: 'html',\r\n        txt:  function(post){return post.pn.getElementsByClassName('postMessage')[0][brwsr.innerText];},\r\n        sub: 'DEFAULT.post_html',\r\n        img2src: 'DEFAULT.post_html',\r\n        img2ext: 'DEFAULT.post_html',\r\n        filename: function(post){\r\n          var file = post.pn.getElementsByClassName('file')[0];\r\n          if (!file) return undefined;\r\n          var fileText0 = post.pn.getElementsByClassName('fileText')[0];\r\n          if (!fileText0) return undefined; // Hit this line if file is deleted.\r\n          var fileText_a = fileText0.getElementsByTagName('a')[0];\r\n          var fname = fileText_a.getAttribute('title') || fileText_a.textContent;\r\n          var idx = fname.lastIndexOf('.');\r\n          var filename = fname.slice(0,idx);\r\n          post.ext = fname.slice(idx);\r\n          var info = fileText_a.nextSibling.textContent.replace(/^ \\(/,'').replace(/\\)$/,'').replace(',','').split(/ |x/);\r\n          post.fsize = parseInt(info[0],10)*(info[1]==='KB'? 1024 : info[1]==='MB'? 1024000 : 1);\r\n          post.w = parseInt(info[2],10);\r\n          post.h = parseInt(info[3],10);\r\n          var img = post.pn.getElementsByTagName('img')[0];\r\n          post.md5 = img.getAttribute('data-md5');\r\n          post.time = parseInt(post.pn.getElementsByClassName('dateTime')[0].getAttribute('data-utc'),10);\r\n          post.tim = parseInt(fileText_a.href.slice(fileText_a.href.lastIndexOf('/')+1).split('.')[0],10);\r\n          post.tn_w = img.naturalWidth;\r\n          post.tn_h = img.naturalHeight;\r\n          return filename;\r\n        },\r\n        prep_mimic: function(post){ // for archiving from html\r\n          var name = post.name; // dummy for invoking getter\r\n          var sub = post.sub;\r\n          var com = post.com;\r\n          var trip = post.trip;\r\n          var id = post.id;\r\n          var time = post.id;\r\n          var country = post.country;\r\n          post.country_name = post.parse_funcs.country_name(post); // no getter\r\n        },\r\n        nofFiles: 'DEFAULT.post_html',\r\n        proto: 'DEFAULT.page_html', // test\r\n//        proto: 'DEFAULT.post_html',\r\n      },\r\n      'post_json': {\r\n        proto: 'DEFAULT.post_json',\r\n      },\r\n      'archive_html': {\r\n        ths: function(doc) {\r\n          var pns = Array.prototype.slice.call(doc.pn.getElementById('arc-list').getElementsByTagName('tr')).slice(1,pref.scan.max_archive+1);\r\n          for (var i=0;i<pns.length;i++) pns[i].parentNode.removeChild(pns[i]);\r\n          return this.ths_array(doc, pns);\r\n        },\r\n        no: function(th){return parseInt(th.pn.getElementsByTagName('td')[0].textContent,10);},\r\n        sub: function(th){\r\n          var sub = th.pn.getElementsByTagName('td')[1].firstChild;\r\n          return sub.tagName==='B'? sub.textContent : '';\r\n        },\r\n        com: function(th){return th.pn.getElementsByTagName('td')[1].lastChild.textContent;},\r\n        nof_posts: function(){return undefined;},\r\n        nof_files: function(){return undefined;},\r\n        filename: function(){return '';},\r\n        footer: function(){return document.createElement('div');},\r\n        proto: 'catalog_html',\r\n      },\r\n      'html_template': { // for test_mode['121']\r\n//        get id(){return this.exe_sub('id');},\r\n//        get pn_id(){return this.exe_sub('pn_id');},\r\n        get country(){return this.exe_sub('country');},\r\n        get trip(){return this.exe_sub('trip');},\r\n        get pn_trip(){return this.exe_sub('pn_trip');},\r\n//        get pn_name(){return this.exe_sub('pn_name');},\r\n        get tFlag(){return this.exe_sub('tFlag');},\r\n      },\r\n      'json_template': { // for test_mode['121']\r\n        get country(){return this.exe_sub('country') || this.board_flag && this.board_flag.toLowerCase() || undefined;},\r\n      },\r\n    },\r\n    popups_posts_class_hlt: 'highlight',\r\n    popups_href2dbtp: function(href){ //, src, th){\r\n//      if (href[0]==='#' && th) {\r\n//        href = this.link_dbtp2href([th.domain, th.board, th.no, href.substr(2)]);\r\n//        src.setAttribute('href',href);\r\n//      }\r\n      // inputs are: \r\n      //   #PPPP\r\n      //   /BBBB/thread/TTTT/#PPPP\r\n      //   //boards.4chan.org/r/catalog#s=eddit  for >>>/r/eddit\r\n      //   //boards.4channel.org/int/thread/TTTT\r\n      //   /BBBB/\r\n      //   //i.4cdn.org/BBBB/xxxx.webm\r\n      href = href.replace(/^https*:/,'');\r\n      var hrefs = href.split(/[\\/#]/); // hrefs will be [ '', '1234'] when href is #1234.\r\n      var len = hrefs.length;\r\n      var p = hrefs[len-1].substr(1);\r\n      var t = len>=2 && hrefs[len-2] || site.no;\r\n      var b = (len>=4 && hrefs[len-4])? '/'+hrefs[len-4]+'/' : site.board;\r\n      if (hrefs[len-2]==='catalog') {\r\n        p = ''; // hrefs[len-1].slice(2,-3);\r\n        t = ''; // p;\r\n        b = (len>=3 && hrefs[len-3])? '/'+hrefs[len-3]+'/' : site.board;\r\n      } else if (href[0]==='/') {\r\n        if (href[1]==='/') {\r\n          if (href.indexOf('//boards.4chan')===0) {\r\n            p = len>=7? hrefs[6].slice(1) : '';\r\n            t = len>=6? hrefs[5] : '';\r\n            b = len>=4? '/'+hrefs[3]+'/' : site.board;\r\n          } else return [];\r\n        } else if (len!=5) {\r\n          p = len>=5? hrefs[4].slice(1) : '';\r\n          t = len>=4? hrefs[3] : '';\r\n          b = '/'+hrefs[1]+'/';\r\n        }\r\n      }\r\n      return ['4chan',b,t,p]\r\n    },\r\n\r\n    update_posts_remove: function(th_old,i,pnode){\r\nif (pref.debug_mode['13'] && th_old.posts[i].pn.parentNode.parentNode!==pnode) console.log(th_old.posts[i].pn);\r\n      var tgt = th_old.posts[i].pn.parentNode;\r\n      var expander = (i==0)? tgt.nextSibling : null; // for merge\r\n      pnode.removeChild(tgt);\r\n      if (expander && expander.tagName==='SPAN') pnode.removeChild(expander);\r\n    },\r\n////    update_posts_remove_lock: function(th_old,i,pnode, now_height){ // TEST, slow implementation\r\n////      var ref, ref_pos;\r\n////      var tgt = th_old.posts[i].pn.parentNode;\r\n////      if (now_height && tgt.offsetTop<now_height) ref = tgt.nextSibling || tgt.parentNode.nextSibling;\r\n////      if (ref) ref_pos = ref.offsetTop;\r\n////      pnode.removeChild(th_old.posts[i].pn.parentNode);\r\n////      return (ref)? ref.offsetTop - ref_pos : 0;\r\n////    },\r\n    update_posts_insert: function(src,dst,i,j,pnode){\r\n      var ref = (j<dst.length)? dst[j].pn.parentNode : null;\r\n      if (!src[i].pn) src[i].pn = this.post_json2html(src[i], src[i].board);\r\n      var tgt = src[i].pn.parentNode || this.post_container(src[i].pn,src[i].no);\r\n      var expander = (i==0)? tgt.nextSibling : null; // for merge\r\n      pnode.insertBefore(tgt, ref);\r\n      if (expander && expander.tagName==='SPAN') pnode.insertBefore(expander, ref);\r\n    },\r\n//    update_posts_insert: function(src,dst,i,j,pnode){ // working code.\r\n//      var ref;\r\n//      if (j<dst.length) {\r\n//        ref = dst[j].pn.parentNode;\r\n//        if (ref.tagName==='SPAN') ref = ref.nextSibling; // skip summary, don't see j===1 for merge.\r\n//      } else ref = null;\r\n//      if (!src[i].pn) src[i].pn = this.post_json2html(src[i], src[i].board);\r\n//      var tgt = src[i].pn.parentNode || this.post_container(src[i].pn,src[i].no);\r\n//      pnode.insertBefore(tgt, ref);\r\n//    },\r\n////    update_posts_insert: function(th,th_old,i,j,pnode){ // working code.\r\n//////      var ref = (j==1)? (th_old.posts[0].pn.parentNode.nextSibling || th_old.posts[0].pn.parentNode) : \r\n//////                         th_old.posts[th_old.posts.length-1].pn.parentNode;\r\n////      var ref;\r\n////      if (j<th_old.posts.length) {\r\n////        ref = th_old.posts[j].pn.parentNode;\r\n////        if (ref.tagName==='SPAN') ref = ref.nextSibling; // skip summary, don't see j===1 for merge.\r\n////      } else ref = null;\r\n////      if (!th.posts[i].pn) th.posts[i].pn = this.post_json2html(th.posts[i],th.board);\r\n////      pnode.insertBefore(this.post_container(th.posts[i].pn,th.posts[i].no), ref);\r\n////    },\r\n////    update_posts_insert_lock: function(th,th_old,i,j,pnode, now_height){ // TOO SLOW\r\n////      var ref, ref_pos;\r\n////      if (j<th_old.posts.length) {\r\n////        ref = th_old.posts[j].pn.parentNode;\r\n////        if (ref.tagName==='SPAN') ref = ref.nextSibling; // skip summary, don't see j===1 for merge.\r\n////      } else ref = null;\r\n////      if (now_height && ref) ref_pos = ref.offsetTop;\r\n////      if (!th.posts[i].pn) th.posts[i].pn = this.post_json2html(th.posts[i],th.board);\r\n////      pnode.insertBefore(this.post_container(th.posts[i].pn,th.posts[i].no), ref);\r\n////      return (ref_pos<now_height)? ref.offsetTop - ref_pos : null;\r\n////    },\r\n    update_posts0_class: function(pn,search_result) {\r\n      site2['DEFAULT'].update_posts0_class(pn,search_result);\r\n      var summary = pn.parentNode && pn.parentNode.nextSibling;\r\n      if (summary && summary.classList.contains('summary')) site2['DEFAULT'].update_posts0_class(summary,search_result);\r\n    },\r\n    post_container : function(post_pn,no, op) {\r\n      var pn = document.createElement('div');\r\n      pn.setAttribute('id','pc'+no);\r\n      pn.setAttribute('class','postContainer ' + ((op)? 'op' : 'reply') + 'Container');\r\n      if (op) {\r\n//<div class=\"postLink mobile\"><span class=\"info\">97 Replies / 26 Images</span><a href=\"thread/138122016\" class=\"button\">View Thread</a></div>\r\n      } else {\r\n        pn.innerHTML = '<div class=\"sideArrows\" id=\"sa'+no+'\">&gt;&gt;</div>';\r\n      }\r\n      pn.appendChild(post_pn);\r\n      return pn;\r\n    },\r\n    remove_backlink: function(pn,idx){\r\n      var bks = pn && pn.getElementsByClassName('backlink')[0];\r\n      var blk = bks && bks.childNodes[idx];\r\n      if (blk) bks.removeChild(blk);\r\n    },\r\n    add_backlinks_bks: (function(){\r\n      var bks = document.createElement('div'); // why div???\r\n      bks.setAttribute('class','backlink');\r\n      return function(){\r\n        return bks.cloneNode(false);\r\n      }\r\n    })(),\r\n    add_backlinks_add_1: (function(){\r\n      var blk = document.createElement('a');\r\n      blk.setAttribute('class','quotelink');\r\n      var blk2 = document.createElement('span');\r\n      blk2.appendChild(blk);\r\n      blk2.appendChild(document.createTextNode(' '));\r\n      return function(bks, dbtpth){\r\n        blk.setAttribute('href',dbtpth[5]);\r\n        blk.textContent = dbtpth[4];\r\n        var pn = blk2.cloneNode(true);\r\n        if (dbtpth[0]!=='4chan' || pref.test_mode['91']) { // TO BE REMOVED\r\n          var pn1 = pn.firstChild;\r\n          pn1.onclick = this.backlink_onclick;\r\n//          pn1.onmouseover = this.popups_post_entry;\r\n        }\r\n        bks.appendChild(pn);\r\n      };\r\n    })(),\r\n    add_backlinks_bks_query: function(pn){\r\n      return pn.getElementsByClassName('backlink')[0];\r\n    },\r\n////    add_backlinks: function(pn,backlinks,target, th){\r\n////if (pref.test_mode['35']) return;\r\n////      var bks_pn = pn.getElementsByClassName('backlink')[0];\r\n////      var bks = bks_pn || this.add_backlinks_bks();\r\n////      if (!target) bks.innerHTML = ''; // this hits target===0 also and clean up.\r\n////      for (var i=(target || 0);i<backlinks.length;i++) {\r\n////        var dbtp = this.popups_backlink2dbtpth(backlinks[i], th);\r\n//////        var domain = dbtp[0];\r\n//////        var board = dbtp[1];\r\n//////        var post_no = dbtp[3];\r\n//////        var txt = dbtp[4];\r\n//////        var href = site2[domain].link_dbtp2href(dbtp);\r\n//////        if (domain!==site.nickname) href = site2[domain].absolute_link_1(href);\r\n////\r\n//////        var blk = null; // IS THIS REQUIRED???\r\n//////        if (target!==undefined) {\r\n//////          var as = bks.getElementsByTagName('a');\r\n//////          for (var j=0;j<as.length;j++)\r\n//////            if (as[j].textContent===txt) {\r\n//////              blk = as[j];\r\n//////              break;\r\n//////            }\r\n//////        }\r\n//////        if (!blk)\r\n////        this.add_backlinks_add_1(bks, dbtp);\r\n////        if (target) break;\r\n////      }\r\n////      if (!bks_pn) pn.getElementsByClassName('desktop')[0].appendChild(bks); // for 4chan-X v1.13.8.7\r\n//////        var ref = this.backlink_parent_prevSib(pn);\r\n//////        ref.parentNode.insertBefore(bks,ref.nextSibling);\r\n////    },\r\n    add_backlinks_bks_append: function(pn, bks){\r\n      pn.getElementsByClassName('desktop')[0].appendChild(bks); // for 4chan-X v1.13.8.7\r\n    },\r\n//    toplevel_anchor: function(pn, th){\r\n//      var as = pn.getElementsByTagName('a');\r\n//      for (var i=0;i<as.length;i++) {\r\n//        var href = as[i].getAttribute('href');\r\n//        if (!href) continue;\r\n//        if (href[0]==='#') as[i].setAttribute('href',this.link_dbtp2href([th.domain, th.board, th.no, href.substr(2)]));\r\n//        else if (href.indexOf('thread')===0) as[i].setAttribute('href',th.board+href);\r\n//      }\r\n//    },\r\n    toplevel_anchor_pos:2,\r\n\r\n    link_dbtp2href: function(dbtp, quote){\r\n      return (dbtp[1]!=site.board || dbtp[2]!=site.no? dbtp[1]+'thread/'+dbtp[2] : '') + '#'+(quote?'q':'p')+dbtp[3];\r\n    },\r\n    backlink_onclick: function(){\r\n      highlightReply.call(this,parseInt(this.textContent.substr(2),10)); // call native function in 4chan.\r\n    },\r\n//    backlink_class: 'quotelink',\r\n    backlink_parent_prevSib: function(pn){return pn.getElementsByClassName('postNum')[1];},\r\n    link_dbtp2html: function(dbtp, src_txt){\r\n      return '<a href=\"'+this.link_dbtp2href(dbtp)+'\" class=\"quotelink\">'+(src_txt? src_txt : this.link_dbtp2txt(dbtp))+'</a>';\r\n    },\r\n    post_com2txt: function(post){\r\n      return (!post.com)? '' : this.post_com2txt_finisher(post.com.replace(/<[^>]*>/g,' ').replace(/&gt;/g,'>').replace(/&lt;/g,'<').replace(/&quot;/g,'\"').replace(/&#039;/g,\"'\").replace(/&#0*44;/g,',').replace(/&amp;/g,'&'), post); // most of 4chan. speed: 13.07/2.38 inlainchan.\r\n    },\r\n    post_json2html : function(post, board, op, short_link, op_no) {\r\n      if (op_no===undefined) op_no = post.op || post.resto || post.no;\r\n      if (op===undefined) op = post.resto===0 || post.no==post.op;\r\n//      var time_unit = (post.parse_funcs && post.parse_funcs.time_unit) || 1;\r\n//      var date = new Date((post.time || 0) * time_unit);\r\n//      var name = post.name || 'Anonymous';\r\n      if (post.ext) {\r\n        var fsize_str = (((post.fsize>1048576)? post.fsize/1048576 : post.fsize/1024)+0.005).toString();\r\n        fsize_str = fsize_str.substr(0,fsize_str.indexOf('.')+3) + ((post.fsize>1048576)? ' MB' : ' KB');\r\n//        var fname_server = site2[post.domain].post_json2html_fname_server(post);\r\n//        var fname = site2[post.domain].post_json2html_fname(post);\r\n        var furl = site2[post.domain].catalog_json2html3_src(post,board);\r\n        var turl = site2[post.domain].catalog_json2html3_thumbnail(post,board);\r\n        var tn_f = (op)? 1 : ((post.tn_w>post.tn_h)? post.tn_w : post.tn_h) / 125; // 150;\r\n        var file_html =\r\n          '<div class=\"file\" id=\"f' + post.no + '\">'+\r\n            '<div class=\"fileText\" id=\"fT' + post.no + '\">File: '+\r\n              '<a '+(post.filename.length>30? 'title=\"'+post.filename+post.ext+'\" ':'')+'href=\"' + furl + '\" target=\"_blank\">'+\r\n                    (post.spoiler? 'Spoiler Image' : post.filename.length>30? post.filename.slice(0,25)+'(...)':post.filename) + post.ext + '</a>'+\r\n              ' (' + fsize_str + ', ' + post.w + 'x' + post.h + ')</div>'+\r\n            '<a class=\"fileThumb\" href=\"' +furl + '\" target=\"_blank\">'+\r\n              '<img src=\"' + turl + '\" alt=\"' + fsize_str + '\" data-md5=\"' + post.md5 + '\" style=\"height: ' + ((post.spoiler)? 100 : (op)? post.tn_h : post.tn_h / tn_f) + 'px; width:' + ((post.spoiler)? 100 : (op)? post.tn_w : post.tn_w/tn_f) +'px;\">'+\r\n              '<div data-tip=\"\" data-tip-cb=\"mShowFull\" class=\"mFileInfo mobile\">' + fsize_str + ' ' + post.ext.substr(1).toUpperCase() + '</div>'+\r\n            '</a>'+\r\n          '</div>';\r\n      }\r\n      var dbtp = [post.domain, board, op_no, post.no];\r\n//      var href_prefix = (post.domain!=='4chan' || site.board!==board || site.whereami==='catalog')? board+'thread/' : (site.whereami==='page')? 'thread/' : '';\r\n      var pn = cnst.dom(\r\n        '<div id=\"p' + post.no + '\" class=\"post reply\">'+\r\n          this. post_json2html_postinfo(post, false, dbtp)+'</div>'+\r\n//          '<div class=\"postInfoM mobile\" id=\"pim' + post.no + '\">'+\r\n//            this.post_json2html_nameblock(post, name, false)+\r\n//            '<span class=\"dateTime postNum\" data-utc=\"' + post.time + '\">' + site2['common'].change_utc_to_local(date) + '</span>'+\r\n//          '</div>'+\r\n          ((post.ext && op)? file_html : '') +\r\n          this.post_json2html_postinfo(post, true, dbtp)+\r\n//          '<div class=\"postInfo desktop\" id=\"pi' + post.no + '\">'+\r\n//            '<input type=\"checkbox\" name=\"' + post.no +'\" value=\"delete\"> '+ // a blank is here\r\n//            ((post.sub)? '<span class=\"subject\">' + post.sub + '</span> ' : '')+\r\n//            this.post_json2html_nameblock(post, name, true)+\r\n//            '<span class=\"dateTime\" data-utc=\"' + post.time + '\">' + site2['common'].change_utc_to_local(date) + '</span> '+\r\n//            '<span class=\"postNum desktop\">'+\r\n//              '<a href=\"'+ this.link_dbtp2href_abs(dbtp)      + '\" title=\"Link to this post\">No.</a>'+\r\n//              '<a href=\"'+ this.link_dbtp2href_abs(dbtp,true) + '\" title=\"Reply to this post\">' + post.no + '</a>'+\r\n////              '<a href=\"'+ href_prefix + op_no + '#p' + post.no + '\" title=\"Link to this post\">No.</a>'+\r\n////              '<a href=\"'+ href_prefix + op_no + '#q' + post.no + '\" title=\"Reply to this post\">' + post.no + '</a>'+\r\n//            '</span>'+\r\n//            ((op)? '<span>[<a href=\"thread/' + op_no + ((post.sub)? '/' + post.sub.replace(/\\s/g,'-').toLowerCase() +' ': '') + '\" class=\"replylink\">Reply</a>]</span>' : '') +\r\n            ((op)? (' &nbsp; <span>[<a href=\"' + site2[dbtp[0]].link_dbtp2href_abs(dbtp) +'\" class=\"replylink\">Reply</a>]</span>'+\r\n                   ((short_link)? short_link.replace(/>\\[/g,'>').replace(/<a/g,'<span>[<a').replace(/\\]<\\/a/g,'</a>]</span') : '')) : '') +\r\n            (post.domain==='4chan' && site.nickname==='4chan'? '<a href=\"#\" class=\"postMenuBtn\" title=\"Post menu\" data-cmd=\"post-menu\">\\u25b6</a>' : '')+\r\n          '</div>' +\r\n          ((post.ext && !op)? file_html : '') +\r\n          '<blockquote class=\"postMessage\" id=\"m' + post.no + '\">'+ (post.com || '') + '</blockquote>'+ \r\n        '</div>');\r\n      if (post.ext && post.func_resize) post.func_resize(pn.childNodes[op? 1 : 2]);\r\n      return pn;\r\n    },\r\n    post_json2html_postinfo: function(post, desktop, dbtp) {\r\n      return '<div class=\"postInfo'+(desktop?' desktop':'M mobile')+'\" id=\"pi'+(desktop?'':'m')+post.no+'\">'+\r\n        (desktop?'<input type=\"checkbox\" name=\"'+post.no+'\" value=\"delete\"> '+ // a blank is here\r\n          ((post.sub)?'<span class=\"subject\">'+post.sub+'</span> ':''):'')+\r\n        this.post_json2html_nameblock(post, desktop)+\r\n        '<span class=\"dateTime'+(desktop?'':' postNum')+'\" data-utc=\"'+post.time_tu1000+'\">'+site2['common'].change_utc_to_local(post.time_tu)+\r\n        (desktop?'</span> <span class=\"postNum desktop\">':' ')+\r\n          '<a href=\"'+ site2[dbtp[0]].link_dbtp2href_abs(dbtp)      + '\" title=\"Link to this post\">No.</a>'+\r\n          '<a href=\"'+ site2[dbtp[0]].link_dbtp2href_abs(dbtp,true) + '\" title=\"Reply to this post\">' + post.no + '</a>'+\r\n//        '<a href=\"'+ href_prefix + op_no + '#p' + post.no + '\" title=\"Link to this post\">No.</a>'+\r\n//        '<a href=\"'+ href_prefix + op_no + '#q' + post.no + '\" title=\"Reply to this post\">' + post.no + '</a>'+\r\n        '</span>';\r\n    },\r\n    post_json2html_nameblock: function(post, desktop) {\r\n      var color;\r\n      return '<span class=\"nameBlock\">'+\r\n        '<span class=\"name\">' + post.name + '</span> '+\r\n        ((post.trip)? '<span class=\"postertrip\">' + post.trip + '</span> ' : '') +\r\n        ((post.capcode)? '<strong class=\"capcode hand id_mod\" title=\"Highlight posts by Moderators\">##' + post.capcode + '</strong>' : '')+\r\n//        '<img src=\"//s.4cdn.org/image/modicon.gif\" alt=\"Mod Icon\" title=\"This user is a 4chan Moderator.\" class=\"identityIcon retina\"></span>\r\n        ((post.since4pass)? '<span title=\"Pass user since '+post.since4pass+'\" class=\"n-pu\"></span>':'')+\r\n        ((post.id)? '<span class=\"posteruid id_'+post.id+'\">(ID: '+\r\n          '<span class=\"hand\" title=\"Highlight posts by this ID\"'+\r\n          (desktop? (color = this.post_json2html_colorID(post), ' style=\"color: ' + color[1] + '; background-color: rgb(' + color[0] + ');\"'):'') + '>'+post.id+'</span>'+\r\n        ')</span> ' : '')+\r\n        site2['4chan'].post_flag2html(post) +\r\n      ((desktop)? '</span> ' : '<br></span>');\r\n    },\r\n    post_flag2html: function(post){\r\n      return post.board_flag? '<span title=\"'+post.flag_name+'\" class=\"bfl bfl-'+post.board_flag.toLowerCase()+'\"></span>'\r\n//      return post.troll_country? '<img src=\"//s.4cdn.org/image/country/troll/'+post.troll_country.toLowerCase()+'.gif\" alt=\"'+post.troll_country+'\" title=\"'+post.country_name+'\" class=\"countryFlag\">'\r\n        : post.country? '<span '+(post.country_name? 'title=\"'+post.country_name+'\" ':'')+'class=\"flag flag-'+post.country.toLowerCase()+'\"></span>' : ''; // post.flag? post.flag.outerHTML : '';\r\n\r\n    },\r\n    post_json2html_colorID: function(post){\r\n      var rgb = 0;\r\n      for (var i=0;i<post.id.length;i++) rgb = (rgb << 5) - rgb + post.id.charCodeAt(i);\r\n      var r = rgb >> 24 & 255;\r\n      var g = rgb >> 16 & 255;\r\n      var b = rgb >> 8  & 255;\r\n      return [ r+','+g+','+b, (.299 * r + .587 * g + .114 * b > 125)? 'black' : 'white'];\r\n    },\r\n// codes from 4chan (extension.min.1076.js)\r\n//    $.hash = function(e) {\r\n//      var t, i, a = 0;\r\n//      for (t = 0,\r\n//           i = e.length; t < i; ++t)\r\n//        a = (a << 5) - a + e.charCodeAt(t);\r\n//      return a\r\n//    }\r\n//    IDColor.compute = function(e) {\r\n//      var t, i;\r\n//      return t = [],\r\n//      i = $.hash(e),\r\n//      t[0] = i >> 24 & 255,\r\n//      t[1] = i >> 16 & 255,\r\n//      t[2] = i >> 8 & 255,\r\n//      t[3] = .299 * t[0] + .587 * t[1] + .114 * t[2] > 125,\r\n//      this.ids[e] = t,\r\n//      t\r\n//    }\r\n//    ,\r\n//    IDColor.apply = function(e) {\r\n//      var t;\r\n//      t = IDColor.ids[e.textContent] || IDColor.compute(e.textContent),\r\n//      e.style.cssText = \"    background-color: rgb(\" + t[0] + \",\" + t[1] + \",\" + t[2] + \");    color: \" + (t[3] ? \"black;\" : \"white;\")\r\n//    }\r\n    page_json2html3_skelton: function(obj) {\r\n      var th = document.createElement('div');\r\n      th.setAttribute('class','thread');\r\n      th.setAttribute('id','t'+obj.no);\r\n      return th;\r\n    },\r\n    page_json2html3: function(obj, clone, dst, force_expander, no_expander){\r\n      var th = this.page_json2html3_skelton(obj);\r\n      var tmp_pn, tmp_footer;\r\n      var op = clone && this.page_json2html3_cloneOPWithoutFooter(obj.posts[0].pn) || this.post_json2html((obj.posts && obj.posts[0])? obj.posts[0] : obj, obj.board, true, site2[obj.domain].short_link(obj.key, obj.nof_posts, 2, '[Last ',' Posts]'), obj.posts[0].no);\r\n      op.setAttribute('class','post op');\r\n      th.appendChild(this.post_container(op,obj.posts[0].no,true));\r\n      obj.posts[0].pn = op;\r\n      if (obj.posts) {\r\n        for (var i=1;i<obj.posts.length;i++) {\r\n          var pn = clone && obj.posts[i].pn && obj.posts[i].pn.cloneNode(true) || this.post_json2html(obj.posts[i], obj.board);\r\n          th.appendChild(this.post_container(pn,obj.posts[i].no));\r\n          obj.posts[i].pn = pn;\r\n        }\r\n        if (!no_expander) this.page_json2html3_add_omitted_info(obj, dst, force_expander);\r\n      }\r\n      return th;\r\n    },\r\n//    page_json2html3_replace_expander : function(posts_old, idx, key) {\r\n//      var omit_info = this.parse_funcs['page_html'].get_omitted_info(posts_old[0]); // posts_old[0].pn.parentNode.parentNode.getElementsByClassName('summary')[0];\r\n//      if (omit_info) omit_info.appendChild(cnst.config_expander(key, idx));\r\n//    },\r\n    page_json2html3_prep_omitted_info: function(posts0, th, force_expander) {\r\n      var omit_info = this.parse_funcs['page_html'].get_omitted_info(posts0);\r\n      if (!omit_info) {\r\n        omit_info = document.createElement('span');\r\n        omit_info.setAttribute('class','summary');\r\n        omit_info.innerHTML = '<img class=\"extButton expbtn\" title=\"Expand thread\" alt=\"+\" data-cmd=\"expand\" data-id=\"' + th.posts[0].no + '\" ' + \r\n          'src=\"//s.4cdn.org/image/buttons/burichan/post_expand_plus.png\">' +\r\n          '<span class=\"summary\"></span><span style=\"display: none;\">Showing all replies.</span>';\r\n        if (th.domain!==site.nickname) omit_info.childNodes[0].style.display = 'none';\r\n        this.parse_funcs['page_html'].set_omitted_info(posts0,omit_info);\r\n      }\r\n      if (force_expander) omit_info.appendChild(cnst.config_expander(th.key));\r\n      return omit_info.childNodes[1];\r\n    },\r\n    page_json2html3_set_omitted_info: function(nof_posts_omitted, nof_files_omitted) {\r\n      return (nof_posts_omitted<=0)? 'Showing all replies.'\r\n        : nof_posts_omitted + ((nof_posts_omitted==1)? ' reply' : ' replies') +\r\n          ((nof_files_omitted)? ' and ' + nof_files_omitted + ' image' + ((nof_posts_omitted!==1)? 's' : '') : '') + ' omitted.';\r\n    },\r\n//    page_json2html3_add_omitted_info: function(th, th_old, force_expander) { // working code\r\n//      var posts = th.posts;\r\n//      var nof_files = 0;\r\n//      for (var i=0;i<posts.length;i++) nof_files += (posts[i].type_data==='html')? posts[i].pn.getElementsByClassName('file').length :\r\n//                                                    (posts[i].filename)? 1 : 0;\r\n//      var posts_deleted = posts.filter(function(v){return v.deleted_after;});\r\n//      var nof_files_omitted = th.nof_files - nof_files + posts_deleted.filter(function(v){return v.filename;}).length;\r\n//      var nof_posts_omitted = th.nof_posts - posts.length + posts_deleted.length;\r\n//      site2[th_old.domain_html || th.domain_html].page_json2html3_add_omitted_info_html(th, th_old, force_expander, nof_posts_omitted, nof_files_omitted);\r\n//    },\r\n//    page_json2html3_add_omitted_info_html: function(th, th_old, force_expander, nof_posts_omitted, nof_files_omitted, from_initial) {\r\n//      if (!th_old.pn_summary) {\r\n//        force_expander |= th.domain!=='4chan'; //  || pref[cataLog.embed_mode].use_expander_always;\r\n//        if (nof_posts_omitted>0 || force_expander) {\r\n//          var posts0 = th_old.posts? th_old.posts[0] : th.posts[0];\r\n//          var omit_info = this.parse_funcs['page_html'].get_omitted_info(posts0);\r\n//          if (!omit_info) {\r\n//            omit_info = document.createElement('span');\r\n//            omit_info.setAttribute('class','summary');\r\n//            omit_info.innerHTML = '<img class=\"extButton expbtn\" title=\"Expand thread\" alt=\"+\" data-cmd=\"expand\" data-id=\"' + th.posts[0].no + '\" ' + \r\n//              'src=\"//s.4cdn.org/image/buttons/burichan/post_expand_plus.png\">' +\r\n//              '<span class=\"summary\"></span><span style=\"display: none;\">Showing all replies.</span>';\r\n//            if (th.domain!==site.nickname) omit_info.childNodes[0].style.display = 'none';\r\n//            this.parse_funcs['page_html'].set_omitted_info(posts0,omit_info);\r\n//          }\r\n//          if (force_expander) omit_info.appendChild(cnst.config_expander(th.key));\r\n//          th_old.pn_summary = omit_info.childNodes[1];\r\n//        }\r\n//      }\r\n//      if (th_old.pn_summary && !from_initial)\r\n//        th_old.pn_summary.textContent = (nof_posts_omitted<=0)? 'Showing all replies.'\r\n//                                      : nof_posts_omitted + ((nof_posts_omitted==1)? ' reply' : ' replies') +\r\n//                                        ((nof_files_omitted)? ' and ' + nof_files_omitted + ' image' + ((nof_posts_omitted!==1)? 's' : '') : '') + ' omitted.';\r\n//    },\r\n    catalog_json2html3_thumbnail: function(obj, board) {\r\n      return (!obj.ext)? ''\r\n        : (obj.spoiler)? '//s.4cdn.org/image/spoiler-a1.png'\r\n        : this.protocol+'//i.4cdn.org' + board + obj.tim + 's'  // not 'obj.board' but 'board' is for thread_json.\r\n          + ((obj.ext==='.jpg' || obj.ext==='.png' || obj.ext==='.gif' || obj.ext==='.webm')? '.jpg' : obj.ext);\r\n    },\r\n    catalog_json2html3_src: function(obj, board) {\r\n      return (obj.ext)? this.protocol+'//i.4cdn.org' + board + obj.tim + obj.ext : // not 'obj.board' but 'board' is for thread_json.\r\n                        '';\r\n    },\r\n//    catalog_json2html3_src: function(obj, board) { // working code.\r\n//      return (obj.ext)? this.protocol+'//i.4cdn.org' + board + obj.tim  // not 'obj.board' but 'board' is for thread_json.\r\n//                          + ((obj.ext==='.jpg' || obj.ext==='.webm')? '.jpg' : obj.ext)\r\n//                      : '';\r\n//    },\r\n    catalog_json2html3 : function(obj,board,thumb_url, make_footer) {\r\n      var th = this.catalog_json2html3_skelton(obj);\r\n//      var th = document.createElement('div');\r\n//      th.setAttribute('class','thread');\r\n//      th.setAttribute('id','thread-'+obj.no);\r\n      var pf = pref.catalog.format.thumb;\r\n      var tmp_w, tmp_h;\r\n      var f = pf.size==='small' && pf.small.w1===150 && pf.small.h1===150? 3/5\r\n            : pf.size==='large' && pf.large.w1===250 && pf.large.h1===250? 1\r\n            : (tmp_w = pf[pf.size].w1/obj.tn_w, tmp_h = pf[pf.size].h1/obj.tn_h, tmp_w<tmp_h? tmp_w : tmp_h);\r\n      th.innerHTML = '<a href=\"'+site2[obj.domain].link_dbtp2href_abs([obj.domain, obj.board, obj.no, obj.no])+'\">' + // (cause direct jump) fixed.\r\n//      th.innerHTML = '<a href=\"' + this.protocol + '//boards.4chan.org' + obj.board + 'thread/' + obj.no + ((obj.sub)? '/'+obj.sub.replace(/ /,'-') : '') + '\">' + // (cause direct jump) fixed. // cause error at parcing href, and 4chan adiscarded this.\r\n                       '<img alt=\"\" id=\"thumb-' + obj.no +\r\n//                       '<img alt=\"\" id=\"thumb-' + obj.no + '\" class=\"thumb\"' + // cause popup error, class will be removed in catalog_json2html3_onload\r\n                         ((obj.tn_w)? '\" width=\"'  + obj.tn_w*f : '' ) +\r\n                         ((obj.tn_h)? '\" height=\"' + obj.tn_h*f : '' ) +\r\n                         '\" src=\"' + thumb_url + '\" data-id=\"' + obj.no + '\">' +\r\n                     '</a>' +\r\n                     '<div title=\"(R)eplies / (I)mages\" id=\"meta-' + obj.no + '\" class=\"meta\">' +\r\n                       (make_footer? 'R: <b>' + obj.nof_posts + '</b> / I: <b>' + obj.nof_files + '</b>':'')+'</div>' +\r\n                     '<div class=\"teaser\">' + ((obj.sub)?'<b>'+obj.sub+'</b>':'') + ((obj.com)? ((obj.sub)? ': ' : '' ) + obj.com : '') + '</div>';\r\n//      if (!obj.tn_w || !obj.tn_h) {\r\n//        th.childNodes[0].childNodes[0].addEventListener('load',site2['4chan'].catalog_json2html3_onload,false);\r\n//      }\r\n      return th;\r\n    },\r\n//    catalog_json2html3_onload : function() { // working code\r\n//      this.removeEventListener('load',site2['4chan'].catalog_json2html3_onload,false);\r\n//      if (!this.tn_w || !this.tn_h) site2['4chan'].catalog_json2html3_size_changed(this);\r\n//      this.removeAttribute('class'); // remove popup.\r\n//    },\r\n//    catalog_json2html3_size_changed : function(myself) {\r\n//      var w = myself.naturalWidth;\r\n//      var h = myself.naturalHeight;\r\n//      var f = ((w>h)? w : h) / ((site2['4chan'].catalog_native_size==='small')? 150 : 250);\r\n//      myself.setAttribute('width', w/f);\r\n//      myself.setAttribute('height', h/f);\r\n//    },\r\n    catalog_json2html3_skelton: function(obj) {\r\n      return cnst.dom('<div class=\"thread\" id=\"thread-'+obj.no+'\"></div>');\r\n//      var th = document.createElement('div');\r\n//      th.setAttribute('class','thread');\r\n//      th.setAttribute('id','thread-'+obj.no);\r\n//      return th;\r\n    },\r\n    catalog_merge: function(src_pn, merge, clg, key){\r\n      if (merge.isShown===1) {\r\n        merge.pn.classList.add(pref.script_prefix+'_merged');\r\n//        merge.pn.childNodes[0].style.float = 'left';\r\n        var merge_icons = merge.pn.getElementsByClassName('threadIcons')[0];\r\n        var footer = clg.footer.add_menu(merge.pn.insertBefore(cnst.dom('<div style=\"clear:both\" class=\"meta\"></div>'), merge.pn.childNodes[merge_icons? 2 : 1]));\r\n        merge.footer = [footer];\r\n        merge.cns = [footer, merge.pn.childNodes[merge_icons? 4:3], merge.pn.childNodes[0]]; // footer, teaser, thumbnail\r\n      }\r\n      var icons = src_pn.getElementsByClassName('threadIcons')[0];\r\n      var cns = [src_pn.childNodes[icons? 2:1], src_pn.childNodes[icons? 3:2], src_pn.childNodes[0]];\r\n      gGEH.pns_all_keys.set(cns[2], key); // for drag'n'drop merging GUI\r\n      if (merge.pn!==src_pn) {\r\n//        cns[2].style.float = 'left';\r\n        merge.pn.insertBefore(cns[2], merge.cns[0]);\r\n        merge.pn.insertBefore(cns[0], merge.cns[1]);\r\n        merge.pn.appendChild(cns[1]);\r\n//        console.log('complete:' +cns[2].firstChild.complete);\r\n//        if (cns[2].firstChild.complete) {\r\n//          setTimeout(function(){gClg.image_resize_th(merge.pn);},0); // avoid racing condition against 'image_resize[12]_onload' at start up.\r\n        clg.image_resize_img(cns[2].firstChild); // clg.image_resize_th(merge.pn);\r\n//        } else {\r\n//          merge.pn.addEventListener('load', clg.image_resize_th_onload_bound, false); // doesn't fire\r\n//          merge.pn.childNodes[1].firstChild.addEventListener('load', clg.image_resize_th_onload_bound, false); // test\r\n//        }\r\n      }\r\n      return cns;\r\n    },\r\n    catalog_separate: function(merge, cns, tgt_th, clg, first){\r\n      var skl = this.catalog_json2html3_skelton(tgt_th);\r\n      if (merge.isShown===2) {\r\n        merge.pn.classList.remove(pref.script_prefix+'_merged');\r\n//        merge.cns[2].style.float = null;\r\n//        merge.footer[0].parentNode.removeChild(merge.footer[0]);\r\n//        merge.footer = null;\r\n        merge.cns = null;\r\n      }\r\n//      cns[2].style.float = null;\r\n      skl.appendChild(cns[2]);\r\n      if (merge.cns && cns[0]===merge.cns[0]) merge.cns[0] = cns[0].nextSibling;\r\n      skl.appendChild(cns[0]);\r\n      if (merge.cns && cns[1]===merge.cns[1]) merge.cns[1] = cns[1].nextSibling;\r\n      skl.appendChild(cns[1]);\r\n      clg.image_resize_img(cns[2].firstChild, true);\r\n      if (first) clg.image_resize_img(merge.pn.firstChild.firstChild, true);\r\n      return skl;\r\n    },\r\n    catalog_reorder: function(cns, merge, clg, idx_new){\r\n      if (idx_new==0) {\r\n        clg.image_resize_img(cns[2].firstChild,true);\r\n        clg.image_resize_img(merge.pn.firstChild.firstChild);\r\n      }\r\n      merge.pn.insertBefore(cns[2], merge.pn.childNodes[idx_new] || null); // thumbnail\r\n      var idx_footer = merge.isShown + (merge.pn.childNodes[merge.isShown]===merge.footer[0]? 1 : 2); // +1 for merged footer\r\n      merge.pn.insertBefore(cns[0], merge.pn.childNodes[idx_footer + idx_new] || null); // footer\r\n      merge.pn.insertBefore(cns[1], merge.pn.childNodes[idx_footer + merge.isShown + idx_new] || null); // teaser\r\n    },\r\n    favicon : {\r\n      __proto__: site2['DEFAULT'].favicon,\r\n      none: '/favicon.ico',\r\n      reply: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAoUlEQVQ4T61TwRGAMAiTmexMDuVMOlM1XOEoAj60L20gDUlLy8dF6Kd+dM/TqTEmK6shAe4GW8zfQlLVMAGat2NVgr2dUDWJymomBRlJdUCoAEdbFZ7A4qEHw9jHCM5U/k1TiEyMkiqj8ikIgY1YCXxUUQp2NCW3F8malZno9kk9qKLKMKj4nwAScaGiETw2KRix8RWG5MhEjynB24usXusFrlPCCCmAi/UAAAAASUVORK5CYII=',\r\n      reply_to_me: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAvUlEQVQ4T61TXRrDIAiDXWmeabvTzlSvVGb8hFIK3ct8aeUnJkSZxmLZBF+/hBvHWLafRQDY6Wn5B3WKANUhrIkIADQF0Zqxt0NGbP5PACREDhXMDFZREr22g+Wn9VmTMnj3RlqwmKTNJYNfAGi8MPD61mAvEnzAZlDZmA0xs7q08Q7AW5wCVC54aWaxl4A5qFWVCyE+DF830Tf7Kd/ZCBb/BwBFyMgkxNyJgVKFv5CTXeWYM4DqLsTHlD33Lx2GzAg15eTiAAAAAElFTkSuQmCC'\r\n    },\r\n    stats_ID: function(th, posts_new, lth){\r\n      if (!lth.sID) lth.sID = {ids:{}, cs:{}, nid:0, nc:0, np:0, h:null};\r\n      var sID = lth.sID;\r\n      if (th.unique_ips) {\r\n        sID.np = th.unique_ips;\r\n        if (!th.id && th.posts) {\r\n          if (!sID.h) sID.h = [];\r\n          var len = sID.h.length;\r\n          if (sID.h[len-3]!=th.posts[th.posts.length-1].no || sID.h[len-2]!=th.nof_posts || sID.h[len-1]!=th.unique_ips) // not updated data may come because of delay and cache \r\n            sID.h.push(th.posts[th.posts.length-1].no, th.nof_posts, th.unique_ips);\r\n          else if (th.nof_posts<lth.nof_posts) scan.list_nup.add(lth,0,true); // for cache delay, this is safe and never be infinite loop, because lth.nof_posts will be updated to small value copie3d from th.nof_posts.\r\n        }\r\n      }\r\n      if (posts_new && posts_new.length>0 && (th.id || th.country)) {\r\n        for (var i=0;i<posts_new.length;i++) {\r\n          var c = posts_new[i].country;\r\n          if (c) if (sID.cs[c]) sID.cs[c]++; else {sID.cs[c]=1;sID.nc++;}\r\n          if (posts_new[i].id) {\r\n            var id = (c || '') + posts_new[i].id;\r\n            if (sID.ids[id]) sID.ids[id]++; else {sID.ids[id]=1;sID.nid++;}\r\n          }\r\n        }\r\n      }\r\n      if (th.nof_posts==1) {sID.np=1; return false;}\r\n//      return posts_new && posts_new.length>0 && pref.threadStats.full && (!th.id && !th.unique_ips || th.unique_ips>sID.nid); // for thread moving, but this can't make an initial kick.(BUG)\r\n      return posts_new && posts_new.length>0 && pref.threadStats.full && !th.id && !th.unique_ips; // TEMPORAL PATCH, !th.id SHOULD BE REPLAED BY INFO IN boards.json\r\n    },\r\n    get_icon : function(pn,type,kind,tgt_th16){\r\n      return kind=='sticky'? pn.getElementsByClassName('stickyIcon')[0] : null;\r\n    },\r\n    add_icon : function(pn,type,kind,tgt_th16){\r\n      var icon = (kind==='sticky')? this.make_tack() : this.make_showAlways();\r\n      var dom, footer;\r\n      var ref = (type!=='headline' && type!=='catalog')? pn.getElementsByClassName('postNum')[1] : pn.getElementsByClassName('threadIcons')[0] ||\r\n        (dom = cnst.dom('<div class=\"threadIcons\"></div>'),\r\n          type==='headline'? (footer = pn.getElementsByClassName(pref.script_prefix+'_footer')[0], footer.parentNode.insertBefore(dom,footer))\r\n         : pn.insertBefore(dom, pn.getElementsByClassName('meta')[0]));\r\n//        pn.insertBefore(cnst.dom('<div class=\"threadIcons\"></div>'), type==='headline'? pn.firstChild : pn.getElementsByClassName('meta')[0]);\r\n      ref.appendChild(icon);\r\n//      var ref;\r\n////      if (type==='catalog') {\r\n//        ref = pn.getElementsByClassName('threadIcons')[0];\r\n//        if (!ref) {\r\n//          ref = document.createElement('div');\r\n//          ref.setAttribute('class','threadIcons');\r\n//          pn.insertBefore(ref, type==='headline'? null : pn.getElementsByClassName('meta')[0]);\r\n//        }\r\n//        ref.appendChild(icon);\r\n////      } else {\r\n////        var op = pn.getElementsByClassName('op')[0];\r\n////        ref = op.getElementsByClassName('mentioned')[0] || op.getElementsByClassName('post_no')[1].nextSibling;\r\n////        ref.parentNode.insertBefore(icon,ref);\r\n////      }\r\n      return icon;\r\n    },\r\n//    domain_IDB_check: function(board){\r\n//      var domain = (site2['4chanR'].boards[board]===null)? '4chanR' : '4chanB';\r\n//      return (site2[domain].domain_url===site2['4chan'].domain_url)? '4chan' : (httpd.prep_iframe(domain), domain);\r\n//    },\r\n//    boards_prep: function(arr){\r\n//      var obj = {};\r\n//      for (var i=0;i<arr.length;i++) obj['/'+arr[i]+'/'] = null;\r\n//      return obj;\r\n//    },\r\n  };\r\n  site2['4chanB'] = {\r\n    domain_url: 'boards.4channel.org',\r\n//    boards: site2['4chan'].boards_prep(['3', 'a', 'adv', 'an', 'asp', 'biz', 'c', 'cgl', 'ck', 'cm', 'co', 'diy', 'fa', 'fit', 'g', 'gd', 'his', 'int', 'jp', 'k', 'lgbt', 'lit', 'm', 'mlp', 'mu', 'n', 'news', 'o', 'out', 'p', 'po', 'qa', 'qst', 'sci', 'sp', 'tg', 'toy', 'trv', 'tv', 'v', 'vg', 'vip', 'vp', 'vr', 'w', 'wsg', 'wsr', 'x']),\r\n    proto:'4chan'\r\n  };\r\n  site2['4chanR'] = {\r\n    domain_url: 'boards.4chan.org',\r\n//    boards: site2['4chan'].boards_prep(['aco', 'b', 'bant', 'd', 'e', 'f', 'gif', 'h', 'hc', 'hm', 'hr', 'i', 'ic', 'pol', 'r', 'r9k', 's', 's4s', 'soc', 't', 'trash', 'u', 'wg', 'y']),\r\n    home: site.protocol + '//boards.4chan.org/pol/',\r\n    proto:'4chan'\r\n  };\r\n//  site2['4channel'] = {\r\n////    nickname:'4channel',\r\n//    domain_url: 'boards.4channel.org',\r\n//    check_func: site2['4chan'].check_func,\r\n//    proto:'4chan'\r\n//  };\r\n}\r\nif (pref.features.domains['meguca']) {\r\n  site2['meguca1'] = { // meguca.org v1\r\n    nickname : 'meguca',\r\n    protocol: 'https:',\r\n    home : 'https://meguca.org/favicon.ico',\r\n    domain_url: 'meguca.org',\r\n    domain_url_image: 'meguca.org',\r\n    features : {page: false, graph: false, setting2: false, thread_reader:false},\r\n//    features : {page: false, graph: false, setting2: false, thread_reader:false, catalog:false, setting: false}, // temporal\r\n    components: {\r\n      boardlist: '#navTop'\r\n    },\r\n    pref_default: {\r\n//      patch: {delayed_invoke: {use: true, sec:10}},\r\n      catalog:{image_hover:true},\r\n    },\r\n    boards_json:{boards:[{board:'a'}, {board:'an'}, {board:'cr'}, {board:'g'}, {board:'v'}]},\r\n    check_func : function(){\r\n      var href = window.location.href;\r\n      if (href.indexOf('/meguca.org/')!=-1) {\r\n        site.whereami = (href.indexOf('/catalog')!=-1)? 'catalog'\r\n                      : (href.search(/page[0-9]/)!=-1)? 'page'\r\n                      : (href.search(/[0-9]+$/)!=-1)? 'thread'\r\n//                      : (document.getElementsByTagName('title')[0] && document.getElementsByTagName('title')[0].textContent==='404')? '404' \r\n                      : 'other';\r\n        site.config('meguca.org',this.nickname);\r\n        site.max_page = 3;\r\n        site.header_height = function(){\r\n          var header = document.getElementById('banner');\r\n          if (header) return header.offsetHeight;\r\n          else return 0;\r\n        }\r\n////        site.myself = (site.whereami==='thread')? parseInt(href.replace(/.*res\\//,'').replace(/\\.html/,''),10) : 0;\r\n////        if (site.whereami==='thread' || site.whereami==='page') {\r\n////          site.embed_to['top']    = document.getElementsByName('postcontrols')[0];\r\n////          site.embed_to['bottom'] = document.getElementsByTagName('footer')[0];\r\n////        } else if (site.whereami==='catalog') {\r\n////          site.embed_to['top']    = document.getElementsByTagName('header')[0].nextSibling;\r\n////          site.embed_to['bottom'] = document.getElementsByTagName('footer')[0];\r\n////        }\r\n////        if (site.whereami==='thread' || site.whereami==='page') {\r\n//////          site.postform = document.getElementsByTagName('form')['post'].getElementsByTagName('tbody')[0];\r\n////          site.postform = document.getElementsByTagName('form')['post'];\r\n////          site.postform_comment = document.getElementById('body');\r\n////          this.postform_prep();\r\n////\r\n//////          var bar_bottom = document.getElementsByClassName('bottom')[0];\r\n//////////          site.root_body2 = bar_bottom.insertBefore(document.createElement('span'),bar_bottom.childNodes[1]); // working code.\r\n////////          site.root_body2 = document.getElementsByClassName('pages')[0];\r\n////////          site.root_body2.setAttribute('style','width:auto');\r\n//////////          site.root_body2 = document.getElementById('style-select');\r\n////        }\r\n////        pref.thread_reader.own_posts_tracker = true;\r\n////        setTimeout(function(){this.postprocess_board(this.boards_json)}.bind(this),0);\r\n        return true;\r\n      } else {\r\n        this.prep_own_posts(); // make own_posts structure WITH PROTOTYPE.\r\n        return false;\r\n      }\r\n    },\r\n    make_url4 : function(dbt){\r\n      var url_prefix  = this.protocol + '//' + this.domain_url; // force to use https:\r\n      if (dbt[3]==='page_json' && dbt[2]==0) dbt[3] = 'catalog_json'; // dbt[2] is string, === can't be used.\r\n      if      (dbt[3]==='page_html')    return [url_prefix + ((dbt[2]!=0)? (parseInt(dbt[2],10)+1) :''), 'html'];\r\n      else if (dbt[3]==='catalog_json') return [url_prefix + '/api/board'+ dbt[1].substr(0,dbt[1].length-1), 'json'];\r\n      else if (dbt[3]==='thread_html')  return [url_prefix + dbt[1] + dbt[2], 'html'];\r\n      else if (dbt[3]==='thread_json')  return [url_prefix + '/api/thread/' + dbt[2], 'json'];\r\n    },\r\n////    prep_own_posts_reg: /^4chan\\-track\\-[0-9A-z]+\\-[0-9]+$/,\r\n\r\n\r\n\r\n    catalog_get_native_area: function(){\r\n      return (site.whereami==='catalog')? document.getElementById('catalog') :\r\n                                          document.getElementsByName('postcontrols')[0];\r\n    },\r\n    catalog_native_prep: function(pn_filter,pn_tb,pn_hi){\r\n//      var node_ref = document.getElementsByClassName('catalog_search')[0].nextSibling;  // FF doesn't work.\r\n      var node_ref = (site.whereami==='catalog')? document.getElementsByTagName('threads')[0].getElementsByTagName('aside')[0] :\r\n                                                  document.getElementsByName('postcontrols')[0];\r\n      if (site.whereami==='catalog') {\r\n////        var selector_native = document.getElementById('sort_by');\r\n////        if (selector_native.selectedIndex!=0) {\r\n////          selector_native.selectedIndex = 0;\r\n////          var evt = document.createEvent('UIEvents');\r\n////          evt.initUIEvent('change', false, true, window, 1);\r\n////          selector_native.dispatchEvent(evt);\r\n////        }\r\n////        selector_native.style.display = 'none';\r\n////        document.getElementById('image_size').addEventListener('change', site2['lain'].catalog_native_size_changed, false);\r\n        var pn_tb_new = document.createElement('span');\r\n        while (pn_tb.firstChild) pn_tb_new.appendChild(pn_tb.firstChild);\r\n        pn_tb = pn_tb_new;\r\n        pn_tb.appendChild(pn_tb.removeChild(pn_tb.childNodes[3]).firstChild);\r\n        pn_tb.setAttribute('style','float:right');\r\n      } else if (site.whereami==='page') {\r\n        var pctrls = document.getElementsByName('postcontrols')[0];\r\n//        for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.removeChild(pctrls.childNodes[i]);\r\n        pctrls.parentNode.insertBefore(document.createElement('hr'),pctrls.nextSibling);\r\n      }\r\n//      node_ref.parentNode.insertBefore(pn_hi,node_ref);\r\n      if (site.whereami==='catalog') node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n      else node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n      node_ref.parentNode.insertBefore(pn_filter,document.getElementById('catalog'));\r\n      var selector_catchan = pn_filter.getElementsByTagName('select')['catalog.order.ordering'];\r\n      selector_catchan.setAttribute('style','float:left');\r\n      if (site.whereami==='catalog') node_ref.parentNode.insertBefore(selector_catchan,node_ref);\r\n      else pn_tb.childNodes[3].insertBefore(selector_catchan,pn_tb.childNodes[3].firstChild);\r\n//      pn_tb.childNodes[0].setAttribute('style',pn_tb.childNodes[0].getAttribute('style')+';display:none');\r\n//      pn_tb.childNodes[1].setAttribute('style',pn_tb.childNodes[1].getAttribute('style')+';display:none');\r\n\r\n      node_ref.setAttribute('style','float:left');\r\n      node_ref.parentNode.insertBefore(pn_tb.childNodes[3],node_ref.nextSibling);\r\n//      if (site.whereami==='catalog') document.getElementById('catalog').innerHTML = ''; // clear all thread.\r\n    },\r\n    catalog_json2html3 : function(obj,board,thumb_url, make_footer) {\r\n      var th = document.createElement('article');\r\n      var th_url = site2[obj.domain].make_url4([obj.domain,obj.board,obj.no,'thread_html'])[0];\r\n      var tn_w = obj.tn_w || obj.posts[0].tn_w;\r\n      var tn_h = obj.tn_h || obj.posts[0].tn_h;\r\n      var tn_f = 150 / ((tn_w>tn_h)? tn_w : tn_h);\r\n      var th_class_tn = (site2[obj.domain].historyAPI && pref.pref2.meguca.historyAPI)? 'history' : '';\r\n      var th_class    = th_class_tn + ' ' + pref.script_prefix +'_link';\r\n      var short_link = site2[obj.domain].short_link(obj.key, obj.nof_posts, 1, 'Last ', '');\r\n      th.innerHTML = '<a target=\"_blank\" rel=\"nofollow\" href=\"' + th_url + '\"' + ((th_class_tn)?' class=\"' + th_class_tn + '\"' : '') +'>'+\r\n                        '<img src=\"' + thumb_url + '\" width=\"' + (tn_w * tn_f) + '\" height=\"' + (tn_h * tn_f) + '\" class=\"expanded\">'+\r\n                     '</a>'+\r\n                     '<br>'+\r\n                     '<small>'+\r\n                     '<span title=\"Replies/Images\">'+ (make_footer? (obj.nof_posts-1) + '/' + (obj.nof_files-1):'')+ '</span>'+\r\n                       '<span class=\"act expansionLinks\">'+\r\n                         '<a href=\"' + th_url + '\" class=\"' + th_class + '\">Expand</a>'+\r\n//                         '] [<a href=\"' + th_url + '?last=100\" class=\"' + th_class + '\">Last 100</a>'+\r\n                         ((short_link)? '] [' + short_link : '')+\r\n                       '</span>'+\r\n                     '</small>'+\r\n                     '<br>'+\r\n                     ((obj.sub)? '<h3>' + obj.sub + ' </h3>' : '')+\r\n                     ((obj.com)? obj.com : '');\r\n      return th;\r\n    },\r\n//    mark_newer_posts: function(th,date,unmark, short_cut) {\r\n//      return site2['DEFAULT'].mark_newer_posts('meguca',th.getElementsByTagName('article'),date,null,unmark, short_cut);\r\n//    },\r\n//    get_time_of_post_in_utc: function(post_pn){return this.parse_funcs.post_html.time_pn(post_pn);}, // TEMPORAL\r\n////////    mark_newer_posts : function(nickname,posts,date,style_mark,style_unmark,class_or_tag,key,unmark){\r\n//////////      var offset_top = 0;\r\n////////      var marked_first_post = null;\r\n////////      for (var i=posts.length-1;i>=0;i--) {\r\n////////        var mark = date<site2[nickname].get_time_of_post_in_utc(posts[i]);\r\n////////        var reply = posts[i];\r\n//////////        posts[i] = posts[i].parentNode;\r\n//////////        if (class_or_tag=='class') while (posts[i].className.search(key)==-1) posts[i] = posts[i].parentNode;\r\n//////////        if (class_or_tag=='tag') while (posts[i].tagName.search(key)==-1) posts[i] = posts[i].parentNode;\r\n////////        if (class_or_tag=='class') reply = posts[i].getElementsByClassName(key)[0];\r\n////////        if (class_or_tag=='tag')  reply = posts[i].getElementsByTagName(key)[0];\r\n////////        if (reply)\r\n////////          if (mark) {\r\n////////            reply.setAttribute('style',style_mark);\r\n////////            if (unmark) reply.addEventListener('mouseover', site2[nickname].unmark_post_from_event, false);\r\n//////////            offset_top = reply.offsetTop;\r\n////////            marked_first_post = reply;\r\n////////          } else reply.setAttribute('style',style_unmark);\r\n////////      }\r\n//////////      return offset_top;\r\n////////      return marked_first_post;\r\n////////    },\r\n////////    unmark_post_from_event: function() {\r\n////////      this.setAttribute('style','border: none');\r\n////////      this.removeEventListener('mouseover', site2['common'].unmark_post_from_event, false);\r\n////////    },\r\n\r\n\r\n    prep_own_posts_event : function(e){\r\n      if (e && e.key==='mine') site2['meguca'].prep_own_posts();\r\n      if (window.name==='meguca') send_message('parent',['OWN_POSTS', window.name, site3[window.name].own_posts['ALL']]);\r\n    },\r\n    prep_own_posts_event_received : function(val){\r\n      site3[this.nickname].own_posts['ALL'] = val;\r\n//      for (var i in val) site3[this.nickname].own_posts['ALL'][i] = null;\r\n    },\r\n    prep_own_posts : function(bt){\r\n      if (!site3[this.nickname].own_posts['ALL']) {\r\n        site3[this.nickname].own_posts['ALL'] = {};\r\n        var boards = ['/a/','/an/','/cr/','/g/'];\r\n        for (var i=0;i<boards.length;i++) site3[this.nickname].own_posts[boards[i]] = Object.create(site3[this.nickname].own_posts['ALL']);\r\n      }\r\n      if (localStorage) {\r\n        var nos = JSON.parse(localStorage['mine'] || '{}');\r\n        for (var j in nos) site3[this.nickname].own_posts['ALL'][j] = null;\r\n      }\r\n    },\r\n    wrap_to_parse: {\r\n      get: site2['DEFAULT'].wrap_to_parse.get,\r\n      posts: function(th){\r\n        delete Object.getPrototypeOf(th.posts[0]).com; // PATCH\r\n      },\r\n    },\r\n    short_link:function(name, nof_posts, num, kwd_head, kwd_tail){\r\n      var url = this.make_url4(common_func.name2dbt(name))[0];\r\n      var th_class = pref.script_prefix +'_link';\r\n      return ((!num || num>1)? '<a href=\"' + url + '?last=50' + '\" class=\"' + th_class + '\">' + kwd_head + '50' + kwd_tail + '</a>' : '') +\r\n             '<a href=\"' + url + '?last=100' + '\" class=\"' + th_class + '\">' + kwd_head + '100' + kwd_tail + '</a>';\r\n    },\r\n    catalog_json2html3_src: function(post){return (post.image)? '/static/src/'+post.image.src : undefined}, // TEMPORAL\r\n//    catalog_json2html3_thumbnail: function(post){return (post.image)? '/static/thumb/'+post.image.thumb : undefined}, // TEMPORAL\r\n    catalog_json2html3_thumbnail: function(post){\r\n      return (post.image)? '/static/'+ ((post.image.spoiler!==undefined && !pref[cataLog.embed_mode].open_spoiler_image)? 'spoil/spoilers'+post.image.spoiler+'.png' :\r\n                                        (post.image.thumb!==undefined)? 'thumb/' + post.image.thumb :\r\n                                                                        'src/' + post.image.src) : undefined;\r\n    },\r\n    post_json2html_fname_server: function(post){return (post.image)? post.image.src : undefined;},\r\n    post_json2html_fname: function(post){return (post.image)? post.image.imgnm : undefined;},\r\n    popups_href2dbtp: function(href){ //, src, th){\r\n//      if (href[0]==='#' && th) {\r\n//        href = th.board+href;\r\n//        src.setAttribute('href',href);\r\n//      }\r\n      var hrefs = href.split(/[\\/#]/);\r\n      var p = hrefs[hrefs.length-1];\r\n      var t = hrefs[hrefs.length-2];\r\n      var b = '/'+hrefs[hrefs.length-3]+'/';\r\n      return ['meguca',b,t,p]\r\n    },\r\n    link_dbtp2href: function(dbtp){\r\n      return dbtp[1] + dbtp[2] + '#' + dbtp[3];\r\n    },\r\n    time_offset: -5,\r\n    parse_funcs : { // meguca\r\n      'post_json' : {\r\n        get no()  {return this.num;},\r\n        get sub() {return this.subject;},\r\n//        get name() {return this.name;},\r\n        name:'Anonymous', // default value\r\n        get txt() {return this.body;},\r\n        get com() {return (this.body)? this.body.replace(this.anchor_regex,this.anchor_func) : '';},\r\n        get filename() {return (this.image)? this.image.imgnm : undefined;},\r\n        get w() {return (this.image)? this.image.dims[0] : undefined;},\r\n        get h() {return (this.image)? this.image.dims[1] : undefined;},\r\n        get tn_w() {return (this.image)? ((this.image.spoiler!==undefined && !pref[cataLog.embed_mode].open_spoiler_image)? 250 : this.image.dims[2]) : undefined;},\r\n        get tn_h() {return (this.image)? ((this.image.spoiler!==undefined && !pref[cataLog.embed_mode].open_spoiler_image)? 250 : this.image.dims[3]) : undefined;},\r\n        get fsize() {return (this.image)? this.image.size : undefined;},\r\n        get ext() {return (this.image)? this.image.ext : undefined;},\r\n        domain:'meguca',\r\n//        type_html: site.whereami,\r\n        get domain_html() {return site.nickname}, // mimic always\r\n        get parse_funcs_html() {return site2[site.nickname].parse_funcs[site.whereami+'_html'];},\r\n        anchor_regex: /(>>)([0-9]+)/g,\r\n//        pn: undefined, // stop prototype chain.\r\n      },\r\n      'thread_json' : {\r\n        ths: function(obj, parse_obj){\r\n          var proto_obj = {\r\n            board: parse_obj.board,\r\n            anchor_func: (function(){\r\n              var htmls = ['<a href=\"' + parse_obj.board + parse_obj.thread + '#', '\">&gt;&gt;', '</a>'];\r\n              return function(str,ar,no){\r\n                return htmls[0] + no + htmls[1] + no + htmls[2];\r\n              };\r\n            })(),\r\n            get com() {return this.body;}, // PATCH\r\n            __proto__:site2[parse_obj.domain].parse_funcs.post_json\r\n          };\r\n////          for (var i=0;i<obj.length;i++) obj[i].__proto__ = site2[parse_obj.domain].parse_funcs.post_json;\r\n          var i=0;\r\n          while (i<obj.length && obj[i].state===undefined) obj[i++].__proto__ = proto_obj; // 'state' shows that a post is being typed.\r\n          if (i!==obj.length) obj.splice(i,obj.length-i);\r\n          return [{posts: obj, // ext: obj[0].ext, tim:obj[0].time, obj:null,\r\n                   nof_posts:obj.length,\r\n                   key: parse_obj.domain + parse_obj.board + parse_obj.thread, no: parse_obj.thread,\r\n                   __proto__:parse_obj}];\r\n        },\r\n        get_op_src: function(obj){return site2[obj.domain].protocol + '//' + site2[obj.domain].domain_url + '/static/'+ 'src/' + obj.posts[0].image.src;},\r\n        op_img_url: function(obj){return site2[obj.domain].protocol + '//' + site2[obj.domain].domain_url + '/static/'+ site2['meguca'].catalog_json2html3_thumbnail(obj.posts[0]);},\r\n//        op_img_url: function(obj){return site2[obj.domain].protocol + '//' + site2[obj.domain].domain_url + '/static/'+ // working code.\r\n//                                         ((obj.posts[0].image.spoiler!==undefined)? 'spoil/spoilers'+obj.posts[0].image.spoiler+'.png' :\r\n//                                          (obj.posts[0].image.thumb!==undefined)?   'thumb/' + obj.posts[0].image.thumb :\r\n//                                                                                    'src/' + obj.posts[0].image.src);},\r\n//        nof_posts: function(obj){return obj.posts.length;},\r\n        nof_files: function(obj){return obj.posts[0].imgctr -1;}, // patch\r\n////        nof_files: function(obj){\r\n////          var num = 0;\r\n////          for (var i=0;i<obj.posts.length;i++) if (obj.posts[i].image) num++;\r\n////          return num;\r\n////        },\r\n        time: function(obj){return obj.posts[0].time;},\r\n        time_posted: function(obj){return obj.posts[obj.posts.length-1].time;},\r\n        time_created: function(obj){return obj.posts[0].time;},\r\n        time_bumped: function(obj){\r\n          var i=obj.posts.length-1;\r\n          while (i>0) if (!obj.posts[i].email || obj.posts[i].email!=='sage') return obj.posts[i].time; else i++;\r\n          return obj.posts[0].time;\r\n        },\r\n        sticky: function(th){return false;},\r\n        com: function(obj){return obj.posts[0].body;},\r\n        sub: function(obj){return obj.posts[0].sub;},\r\n        name: function(obj){return obj.posts[0].name;},\r\n        filename: function(obj){return obj.posts[0].image.imgnm;},\r\n//        tn_w: function(obj){return obj.posts[0].tn_w;},\r\n//        tn_h: function(obj){return obj.posts[0].tn_h;},\r\n\r\n        type_com: 'txt',\r\n//        type_com: 'html',\r\n        time_unit: 1,\r\n\r\n//        tn_as: function(th){return th.pn.getElementsByTagName('a');}, // the same as DEFAULT\r\n        //        footer: function(th){return th.pn.getElementsByClassName('meta')[0];},\r\n\r\n//        add_op_img_url: site2['DEFAULT'].parse_parts.add_op_img_url,\r\n        add_op_img_url: function(posts,board,domain){\r\n          for (var i=0;i<posts.length;i++)\r\n            if (posts[i].image) posts[i].op_img_url = site2[domain].protocol + '//' + site2[domain].domain_url + '/static/thumb/' + posts[i].image.thumb;\r\n        },\r\n\r\n        footer: 'catalog_html',\r\n        footer_prep: 'catalog_html',\r\n        proto: 'DEFAULT.thread_json'\r\n      },\r\n      'catalog_html' : {\r\n        footer: function(th){return th.pn.getElementsByClassName('counters')[0];}, // v3.\r\n//        footer: function(th){return th.pn.getElementsByTagName('small')[0].getElementsByTagName('span')[0];}, // working code for v1, v2.\r\n        footer_prep: function(th){th.footer.textContent = '';},\r\n        ths: function(doc) {\r\n          if (!pref.pref2.meguca.historyAPI) {\r\n            var hist = doc.pn.getElementsByClassName('history');\r\n            for (var i=hist.length-1;i>=0;i--) {\r\n              if (hist[i].textContent==='Expand' || hist[i].textContent==='Last 100') hist[i].setAttribute('class',pref.script_prefix+'_link');\r\n              else hist[i].removeAttribute('class');\r\n            }\r\n          }\r\n          var ths = this.ths_array(doc,doc.pn.getElementsByTagName('article'));\r\n          if (site.board==='/all/') for (var i=ths.length-1;i>=0;i--) ths[i].board = ths[i].pn.getElementsByTagName('a')[0].getAttribute('href').replace(/\\d+$/,''); // for v3.\r\n          return ths;\r\n        },\r\n        no : function(th){return th.pn.getElementsByTagName('a')[0].getAttribute('href').replace(/.*\\//g,'');}, // 'replace' for ve.\r\n//        no : function(th){return th.pn.getElementsByTagName('a')[0].getAttribute('href');},\r\n        time_bumped: function(th){return undefined;},\r\n        time_created : function(th){return undefined;},\r\n        nof_posts: function(th){return parseInt(th.footer.textContent.split('/')[0],10);},\r\n        nof_files: function(th){return parseInt(th.footer.textContent.split('/')[1],10);},\r\n        sub: function(th){\r\n          var sub = th.pn.getElementsByTagName('h3')[0];\r\n          return (sub)? common_func.escape(sub.textContent) : undefined;\r\n        },\r\n        name: function(th){return undefined;},\r\n        com: function(th){return th.pn.childNodes[th.pn.childNodes.length-1].textContent;},\r\n        sticky: function(th){return false;},\r\n////////        tn_as: function(th){return th.pn.getElementsByTagName('a');},\r\n////////        tn_imgs: function(th){return (th.tn_as[0])? [th.tn_as[0].getElementsByTagName('imgs')[0]] : [];},\r\n////////        class_thread: 'thread',\r\n////////        class_thumbnail: 'thumb',\r\n//////////        op_img_url: function(th){ // working code.\r\n//////////          var img = th.pn.getElementsByTagName('img')[0];\r\n//////////          return (img)? img.getAttribute('src') : undefined; // patch.\r\n//////////        },\r\n        op_img_url: function(th){\r\n          var img = th.pn.getElementsByTagName('img')[0];\r\n          return img && img.getAttribute('src') || '';},\r\n        get_op_src: function(th){return th.op_img_url.replace(/thumb/,'src');}, // patch\r\n        dynamic_image_hover: true,\r\n        missing_info: 1,\r\n        img2src: function(img, lth){\r\n          if (!lth) lth = this.get_lth_from_node(img);\r\n          if (!lth) return null;\r\n          var src = img.src;\r\n          if (lth.th && lth.th.posts[0].ext) src = src.replace(/thumb/,'src').replace(/\\.\\w+$/,lth.th.posts[0].ext);\r\n          else if (lth.th.missing_info) scan.scan_ui('image_hover', {tgts: [lth.key], options:{callback:function(){cataLog.image_hover_reentry(img);}, priority:6}}); // NEVER ACTIVATED because catalog.json is read always at initial\r\n          return src;\r\n        },\r\n      },\r\n      'post_html' : {\r\n        time_pn: function(post_pn){\r\n          var time_node = post_pn.getElementsByTagName('time')[0];\r\n          return Date.parse(time_node.title || time_node.textContent) + (pref.localtime_offset - site2['meguca'].time_offset) * 3600000;}, // timezone -5\r\n        pn_name: function(post){return post.pn.getElementsByClassName('name')[0];}, // same as vichan.\r\n      },\r\n    },\r\n    general_event_handler:{\r\n      page:{\r\n        mouseover: function(e){}, // patch for test_mode['98']\r\n      },\r\n      catalog:{\r\n//        mouseover: function(e){ // working code\r\n//          var et = e.target;\r\n//          var et_tagName = et.tagName;\r\n//          if (et_tagName==='IMG')\r\n//            if (pref[cataLog.embed_mode].image_hover && et.parentNode.tagName==='A') cataLog.image_hover_add.call(et, e);\r\n//        },\r\n        image_hover_check_mode: function(img){\r\n          return img.parentNode.parentNode.parentNode.parentNode.id==='catalog'? 'catalog' : 'page';\r\n        },\r\n        recSearch_thread: function(tgt,ecT, className){\r\n          var func = site2['DEFAULT'].general_event_handler.common.recSearch_thread;\r\n          return func(tgt,ecT,'op') || className && func(tgt,ecT,className) || null;\r\n        },\r\n        __proto__: site2['DEFAULT'].general_event_handler.catalog\r\n      },\r\n    },\r\n    favicon : {\r\n      __proto__: site2['DEFAULT'].favicon,\r\n      none: '/static/favicon.ico',\r\n      reply: '/static/css/ui/unreadFavicon.ico',\r\n      reply_to_me: '/static/css/ui/replyFavicon.ico',\r\n    },\r\n    make_tack: function(){\r\n      var tack = document.createElement('div');\r\n      tack.innerHTML = '<svg class=\"sticky\" xmlns=\"http://www.w3.org/2000/svg\" width=\"8\" height=\"8\" viewBox=\"0 0 8 8\"><path d=\"M1.34 0a.5.5 0 0 0 .16 1h.5v2h-1c-.55 0-1 .45-1 1h3v3l.44 1 .56-1v-3h3c0-.55-.45-1-1-1h-1v-2h.5a.5.5 0 1 0 0-1h-4a.5.5 0 0 0-.09 0 .5.5 0 0 0-.06 0z\"></path></svg>';\r\n      return tack.childNodes[0];\r\n    },\r\n  };\r\n  site2['meguca2'] = { // meguca.org v2\r\n    home: 'https://meguca.org/assets/favicons/default.ico',\r\n    components: {\r\n      boardlist: '#banner', // '#board-navigation'\r\n    },\r\n    boards_json: undefined, // terminate prototype chain\r\n    check_func: function(reentry){ // required to be a own property.\r\n      var href = window.location.href;\r\n      if (href.indexOf('/meguca.org/')!=-1) {\r\n        site.whereami = (href.search(/[A-z]+\\/(\\?page=\\d+)*$/)!=-1)? 'page'\r\n                      : (href.search(/[0-9]+(\\?last=\\d+)*$/)!=-1)? 'thread'\r\n                      : (href.search(/catalog\\/*$/)!=-1)? 'catalog' : 'other';\r\n        site.config('meguca.org',this.nickname, reentry);\r\n        site.no = (site.whereami==='thread')? parseInt(href.replace(/.*meguca\\.org\\/\\w*\\/([0-9]+)/,'$1'),10) : '';\r\n        if (site.whereami==='page') {\r\n          var idx = href.indexOf('?page=');\r\n          site.page = idx!=-1 && parseInt(href.substr(idx+6),10) || 0;\r\n        } else site.page = null;\r\n        if (reentry) return;\r\n        site.max_page = 3;\r\n        site.header_height = function(){\r\n          var header = document.getElementById('banner');\r\n          return (header)? header.offsetHeight : 0;\r\n        }\r\n        return true;\r\n      } else {\r\n//        this.prep_own_posts(); // make own_posts structure WITH PROTOTYPE.\r\n        return false;\r\n      }\r\n    },\r\n    check_func_whereami: function(){\r\n    },\r\n////    url_boards_json : function(){return ['https://meguca.org/json/boardList', 'json'];}, // working code.\r\n////    postprocess_board: function(val){\r\n////      for (var i=0;i<val.length;i++) {\r\n////        var bd = liveTag.mems.init({domain:this.nickname, board:'/'+val[i].id+'/'});\r\n////        bd.o = i;\r\n////        if (val[i].tags && val[i].tags.length!=0) liveTag.postprocess_board_add_btag(val[i].tags,bd);\r\n////      }\r\n////    },\r\n    utilize_boards_json: true,\r\n    url_boards_json : function(){return ['https://meguca.org/json/boardTimestamps', 'json'];}, // need to be debugged\r\n    postprocess_board: function(val){\r\n      var order = 0;\r\n      for (var i in val) {\r\n        var bd = liveTag.mems.init({domain:this.nickname, board:'/'+i+'/'});\r\n        bd.o = order++;\r\n        Object.defineProperty(bd,'max',{value:val[i], writable:true});\r\n        if (bd.read_max===undefined) Object.defineProperty(bd,'read_max',{value:0, writable:true});\r\n//        if (val[i].tags && val[i].tags.length!=0) liveTag.postprocess_board_add_btag(val[i].tags,bd);\r\n      }\r\n    },\r\n    make_url4 : function(dbt){\r\n      var url_prefix  = this.protocol + '//' + this.domain_url; // force to use https:\r\n      if (dbt[3].substr(0,4)==='page' && dbt[2]==0) dbt[3] = 'catalog_json'; // dbt[2] is string, === can't be used.\r\n//      if      (dbt[3]==='page_html')    return [url_prefix + ((dbt[2]!=0)? (parseInt(dbt[2],10)+1) :''), 'html'];\r\n      return (dbt[3]==='catalog_json')? [url_prefix + '/json'+ dbt[1], 'json', 'meguca' + dbt[1] + 'j0'] :\r\n             (dbt[3]==='thread_html')?  [url_prefix + dbt[1] + dbt[2], 'html'] :\r\n             (dbt[3]==='thread_json')?  [url_prefix + '/json'+ dbt[1]+dbt[2], 'json'] : undefined;\r\n    },\r\n//    trim_list: 'force_init', // catalog_json is changed to have no posts. // this way is more optimized than fetching each thread when some threads are watched.\r\n    catalog_get_native_area: function(){\r\n      return document.getElementById((site.whereami==='catalog')? 'catalog'\r\n                                   : (site.whereami==='page')?    'index-thread-container' : 'threads');\r\n    },\r\n    catalog_get_native_scroll_area: function(){\r\n      return (site.whereami==='catalog')? document.getElementsByTagName('section')[1] : window;\r\n    },\r\n    catalog_native_prep_wait_loop_timeout: 100,\r\n    catalog_native_prep_wait_loop: function(whereami, callback){\r\n      if (--this.catalog_native_prep_wait_loop_timeout<0) return;\r\n      if ((whereami==='catalog' && (!document.getElementsByName('sortMode')[0])) ||\r\n          (whereami==='page' &&    (!document.getElementById('catalog-controls') || !document.getElementById('index-thread-container'))) ||\r\n          (whereami==='thread' &&  (!document.getElementById('expand-images') || !document.getElementById('threads')))\r\n         ) setTimeout(function(){this.catalog_native_prep_wait_loop(whereami,callback);}.bind(this),1000);\r\n      else callback();\r\n    },\r\n    catalog_native_prep: function(pn_filter,pn_tb,pn_hi){\r\n//      var node_ref = document.getElementsByClassName('catalog_search')[0].nextSibling;  // FF doesn't work.\r\n//      var node_ref = (site.whereami==='catalog')? document.getElementById('threads').getElementsByTagName('aside')[0] :\r\n      var node_ref = (site.whereami==='catalog')? document.getElementsByName('sortMode')[0]\r\n                   : (site.whereami==='page')? document.getElementById('catalog-controls').getElementsByTagName('input')['search']\r\n                   : document.getElementById('expand-images'); // .parentNode.nextSibling;\r\n      if (site.whereami==='catalog' && node_ref.nextSibling===cataLog.components.ordering) return; // return if just focused, not entered from transition.\r\n//      if (pn_tb.childNodes[3] && pn_tb.childNodes[3].ondblclick) cnst.tb_prep_for_embed(pn_tb);\r\n//      if (site.whereami==='catalog' || site.whereami==='page') {\r\n        if (!cataLog.components.initialized) {\r\n//          var pn_tb_new = document.createElement('span');\r\n//          while (pn_tb.firstChild) pn_tb_new.appendChild(pn_tb.firstChild);\r\n//          pn_tb = pn_tb_new;\r\n          pn_tb.setAttribute('style','float:right');\r\n          cataLog.components.pn12_0 = pn_tb;\r\n          cataLog.components.pn_hi = pn_tb.removeChild(pn_tb.childNodes[3]); //.firstChild;\r\n          var redraw = function(){\r\n////            console.log('redraw');\r\n            cataLog.catalog_obj2.func_track_reset();\r\n            cataLog.insert_myself(null,null,null,true);\r\n            cataLog.show_catalog();\r\n          }\r\n//          var reentry_tap = function(e){\r\n//////            console.log('reentry');\r\n//            observer3.disconnect();\r\n////            this.catalog_native_prep(null, pn_filter, pn_tb);\r\n////            if (this.catalog_get_native_area()!=cataLog.components.initialized) { // doesn't work\r\n////              console.log('found background refresh');\r\n////              cataLog.components.initialized = this.catalog_get_native_area();\r\n//          }; // .bind(this);\r\n//          window.addEventListener('focus', reentry_tap, false);\r\n\r\n          var updated_by_native = false;\r\n          var observe_native_bg = function(e){\r\n//            updated_by_native = true;\r\n////            console.log('found an update in background');\r\n\r\n            if (pref[site.whereami].embed) { // test\r\n//              observer3.disconnect();\r\n//              cataLog.catalog_obj2.masked = false;\r\n              cataLog.general_event_handler.destroy();\r\n//              cataLog.triage.off();\r\n              cataLog.triage_parent_set();\r\n              cataLog.general_event_handler = new cataLog.GEH(cataLog.parent);\r\n              cataLog.general_event_handler.init();\r\n              redraw();\r\n              site2['meguca'].catalog_native_prep(pn_filter, pn_tb);\r\n//              blur_tap();\r\n            }\r\n\r\n          };\r\n          var observer3 = new MutationObserver(observe_native_bg);\r\n//          var blur_tap = function(){\r\n//////            console.log('start observe...');\r\n////            observer3.observe(cataLog.parent, {childList: true}); // doesn't work\r\n            observer3.observe(document.getElementById('threads'), {childList: true});\r\n////            cataLog.catalog_obj2.masked = true;\r\n//          };\r\n//          window.addEventListener('blur', blur_tap, false);\r\n          pref_func.settings.onchange_funcs['button_test'] = observe_native_bg; // test\r\n\r\n          var loading_image = document.getElementById('loading-image');\r\n          var skip_initial_call = loading_image.style.display!=='none';\r\n          var observer_tap = function(e){\r\n            if (e[0].target.style.display!=='none') {\r\n              site2['meguca'].historyAPI_blocking = true;\r\n              if (site.whereami==='thread') site2['meguca'].prep_own_posts(); // patch for IDB, but BUG, this has a racing condition.\r\n            } else {\r\n              site2['meguca'].historyAPI_blocking = false;\r\n              if (!skip_initial_call) {\r\n////                console.log('mascot off');\r\n                cataLog.DIH.image_hover_remove();\r\n                cataLog.general_event_handler.destroy();\r\n//                cataLog.triage.off();\r\n                for (var name in cataLog.threads) pClg.remove_thread(name, true);\r\n//                for (var name in cataLog.threads) if (cataLog.threads[name][1]) if (cataLog.catalog_obj2.func_hide(name)) cataLog.threads[name][1] = false;\r\n\r\n                site2['meguca'].check_func(true);\r\n                if (pref[site.whereami].embed) { // using site.whereami instead of cataLog.embed_mode\r\n//                  cataLog.catalog_obj2.masked = false;\r\n                  cataLog.set_embed_xxxx(); // this changes embed_mode\r\n                  cataLog.triage_parent_set();\r\n                  cataLog.general_event_handler = new cataLog.GEH(cataLog.parent);\r\n                  cataLog.general_event_handler.init();\r\n//                  if (!pref.test_mode['90']) {\r\n                  if ((site.whereami==='catalog' || site.whereami==='page') && !pref.test_mode['90']) redraw();\r\n                  site2['meguca'].catalog_native_prep(pn_filter, pn_tb);\r\n//                  reentry_tap(); // WILL call show_catalog here, from pref3.filter.kwd.clear()\r\n                } // else cataLog.catalog_obj2.masked = true;\r\n                recovery.reentry();\r\n                receive_message_emu();\r\n              }\r\n              skip_initial_call = false;\r\n            }\r\n          };\r\n          var observer = new MutationObserver(observer_tap);\r\n//          observer.observe(document.getElementById('page-container'), {childList: true});\r\n          observer.observe(loading_image, {attributes: true});\r\n////          window.addEventListener('popstate', function(event) {console.log(\"onpopstate: location: \" + document.location + \", state: \" + JSON.stringify(event.state));}, false); // doesn't work\r\n//////          setTimeout(function(){require('state').page.onChange('thread', function(e){\r\n//////            console.log('state_changed: ',e);\r\n//////          });},30000);\r\n////          setTimeout(function(){ // working code, but spec was changed on 2017.06.12\r\n////            var test_func = function(e){console.log('state changed');};\r\n////            var div = document.createElement('div');\r\n////            div.id = 'CatChan_csi';\r\n////            div.setAttribute('data-csi',0);\r\n//////            div.textContent = 0;\r\n//////            div.onclick = test_func; // can't call\r\n////            site.script_body.appendChild(div);\r\n////            var scr = document.createElement('script');\r\n////            scr.setAttribute('type', 'application/javascript');\r\n//////            scr.textContent = 'console.log(\"Hello\");';\r\n//////            scr.textContent = 'console.log(require(\"state\"));';\r\n//////            scr.textContent = 'var tgt_func = document.getElementById(\"CatChan_csi\").onclick;'+\r\n//////                              'require(\"state\").page.onChange(\"thread\", tgt_func);';\r\n////            scr.textContent = 'var tgt = document.getElementById(\"CatChan_csi\");'+\r\n//////                              'function mutate(){tgt.textContent+=1;}'+\r\n////                              'function mutate(){tgt.setAttribute(\"data-csi\",parseInt(tgt.getAttribute(\"data-csi\"),10)+1);}'+\r\n////                              'require(\"state\").page.onChange(\"thread\", mutate);'+\r\n////                              'require(\"state\").page.onChange(\"page\", mutate);'+\r\n////                              'require(\"state\").page.onChange(\"catalog\", mutate);';\r\n////            site.script_body.appendChild(scr);\r\n////            site.script_body.removeChild(scr);\r\n////            var observer2 = new MutationObserver(test_func);\r\n////            observer2.observe(div, {attributes: true});\r\n//////            observer2.observe(div.childNodes[0], {attributes: true, characterData: true});\r\n//////            console.log('unsafeWindow: ');\r\n//////            unsafeWindow.require('state').page.onChange('thread', function(e){\r\n//////              console.log('state_changed: ',e);\r\n//////            });\r\n////          },10000);\r\n        }\r\n//      } else if (site.whereami==='page') {\r\n////        var pctrls = document.getElementsByName('postcontrols')[0];\r\n//////        for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.removeChild(pctrls.childNodes[i]);\r\n////        pctrls.parentNode.insertBefore(document.createElement('hr'),pctrls.nextSibling);\r\n//      }\r\n//      node_ref.parentNode.insertBefore(pn_hi,node_ref);\r\n      if (site.whereami==='catalog') {\r\n        node_ref.parentNode.appendChild(pn_tb);\r\n        node_ref.parentNode.parentNode.insertBefore(cataLog.components.pn_hi, node_ref.parentNode);\r\n      } else {\r\n        node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n        node_ref.parentNode.insertBefore(cataLog.components.pn_hi, node_ref);\r\n      }\r\n      if (site.whereami==='catalog') {\r\n        var ctlg = document.getElementById('catalog');\r\n        ctlg.parentNode.insertBefore(pn_filter,ctlg);\r\n      } else node_ref.parentNode.insertBefore(pn_filter,document.getElementById('catalog'));\r\n      if (site.whereami==='catalog') site2['DEFAULT'].catalog_native_prep_swap_sortSel(node_ref);\r\n      else {\r\n//        var selector_catchan = pn_filter.getElementsByTagName('select')['catalog.indexing'];\r\n//        selector_catchan.setAttribute('style','float:left');\r\n//        if (!cataLog.components.initialized) pn_tb.childNodes[3].insertBefore(cataLog.components.catalog.indexing, pn_tb.childNodes[3].firstChild);\r\n        node_ref.parentNode.insertBefore(cataLog.components.ordering, node_ref.nextSibling);\r\n//        node_ref.setAttribute('style','float:left');\r\n      }\r\n//      pn_tb.childNodes[0].setAttribute('style',pn_tb.childNodes[0].getAttribute('style')+';display:none');\r\n//      pn_tb.childNodes[1].setAttribute('style',pn_tb.childNodes[1].getAttribute('style')+';display:none');\r\n//      if (site.whereami!=='catalog' && !cataLog.components.initialized) node_ref.parentNode.insertBefore(pn_tb.childNodes[3],node_ref.nextSibling);\r\n      if (site.whereami=='catalog' || site.whereami=='page') {\r\n        document.getElementById('banner').style=\"height:auto\";\r\n        pClg.kwd_init(document.getElementById('catalog-controls').getElementsByTagName('input')['search'], pn_filter);\r\n      }\r\n      cataLog.components.initialized = true; // this.catalog_get_native_area();\r\n    },\r\n//    catalog_native_prep: function(date,pn_filter,pn_tb,pn_hi){ // working code\r\n//      //      var node_ref = document.getElementsByClassName('catalog_search')[0].nextSibling;  // FF doesn't work.\r\n//      //      var node_ref = (site.whereami==='catalog')? document.getElementById('threads').getElementsByTagName('aside')[0] :\r\n//      var node_ref = (site.whereami==='catalog')? document.getElementsByName('sortMode')[0] :\r\n//            document.getElementById('expand-images').parentNode.nextSibling;\r\n//      cnst.tb_prep_for_embed(pn_tb);\r\n//      if (site.whereami==='catalog') {\r\n//        var pn_tb_new = document.createElement('span');\r\n//        while (pn_tb.firstChild) pn_tb_new.appendChild(pn_tb.firstChild);\r\n//        pn_tb = pn_tb_new;\r\n//        pn_tb.setAttribute('style','float:right');\r\n//        pn_tb.setAttribute('style','float:right');\r\n//      } else if (site.whereami==='page') {\r\n//        var pctrls = document.getElementsByName('postcontrols')[0];\r\n//        //        for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.removeChild(pctrls.childNodes[i]);\r\n//        pctrls.parentNode.insertBefore(document.createElement('hr'),pctrls.nextSibling);\r\n//      }\r\n//      //      node_ref.parentNode.insertBefore(pn_hi,node_ref);\r\n//      if (site.whereami==='catalog') {\r\n//        node_ref.parentNode.appendChild(pn_tb);\r\n//        node_ref.parentNode.parentNode.insertBefore(pn_tb.removeChild(pn_tb.childNodes[3]).firstChild, node_ref.parentNode);\r\n//      } else node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n//      if (site.whereami==='catalog') {\r\n//        var ctlg = document.getElementById('catalog');\r\n//        ctlg.parentNode.insertBefore(pn_filter,ctlg);\r\n//      } else node_ref.parentNode.insertBefore(pn_filter,document.getElementById('catalog'));\r\n//      var selector_catchan = pn_filter.getElementsByTagName('select')['catalog.indexing'];\r\n//      selector_catchan.setAttribute('style','float:left');\r\n//      if (site.whereami==='catalog') node_ref.parentNode.insertBefore(selector_catchan,node_ref);\r\n//      else pn_tb.childNodes[3].insertBefore(selector_catchan,pn_tb.childNodes[3].firstChild);\r\n//      //      pn_tb.childNodes[0].setAttribute('style',pn_tb.childNodes[0].getAttribute('style')+';display:none');\r\n//      //      pn_tb.childNodes[1].setAttribute('style',pn_tb.childNodes[1].getAttribute('style')+';display:none');\r\n//\r\n//      node_ref.setAttribute('style','float:left');\r\n//      if (site.whereami!=='catalog') node_ref.parentNode.insertBefore(pn_tb.childNodes[3],node_ref.nextSibling);\r\n//      if (site.whereami=='catalog') {\r\n//        node_ref.style.display = 'none';\r\n//        document.getElementById('banner').style=\"height:auto\";\r\n//        var search = document.getElementById('catalog-controls').getElementsByTagName('input')['search'];\r\n//        var search2 = search.cloneNode(false);\r\n//        search2.name = 'filter.kwd.str';\r\n//        search2.oninput = cataLog.event_func;\r\n//        search.parentNode.insertBefore(search2,search);\r\n//        search.setAttribute('style','display:none');\r\n//        pref3.filter.kwd.obj = [pn_filter.getElementsByTagName('input')['filter.kwd.str'], search2];\r\n//        pref3.filter.kwd.clear();\r\n//      }\r\n//    },\r\n    post_json2html: site2['4chan'].post_json2html,\r\n    page_json2html3_skelton: site2['4chan'].page_json2html3_skelton,\r\n    page_json2html3: site2['4chan'].page_json2html3,\r\n    page_json2html3_replace_expander: site2['4chan'].page_json2html3_replace_expander,\r\n    page_json2html3_prep_omitted_info: site2['4chan'].page_json2html3_prep_omitted_info,\r\n    page_json2html3_set_omitted_info: site2['4chan'].page_json2html3_set_omitted_info,\r\n    post_container: site2['4chan'].post_container,\r\n    wrap_to_parse: site2['DEFAULT'].wrap_to_parse, // bypass meguca1\r\n    catalog_json2html3_thumbnail: function(post){\r\n      return (post.image)? this.protocol + '//' + this.domain_url_image + // fullpath is required for desktopNotification.\r\n        ((post.image.spoiler!==undefined && !pref[cataLog.embed_mode].open_spoiler_image)? '/spoil/default.jpg' :\r\n        (post.image.thumbType===14)? '/audio.png' :\r\n        '/images/thumb/' + post.image.SHA1 + ((post.image.thumbType===0 || post.image.thumbType===undefined && post.image.fileType===0)? '.jpg' : '.png')) : undefined;\r\n//        '/images/thumb/' + post.image.SHA1 + ((post.image.fileType===0)? '.jpg' : '.png')) : undefined;\r\n    },\r\n//    catalog_json2html3_src: (function(){\r\n//      var fileType = ['jpg', 'png', 'gif', 'webm', 'pdf', 'svg', 'mp4', 'mp3', 'ogg'];\r\n//      return function(post){return (post.image)? '/images/src/' + post.image.SHA1 + '.' + fileType[post.image.fileType] : undefined;};\r\n//    })(),\r\n    catalog_json2html3_src: function(post){\r\n      return (post.image)? this.protocol + '//' + this.domain_url_image + '/images/src/' + post.image.SHA1 +\r\n                             (post.ext || Object.getOwnPropertyDescriptor(this.parse_funcs.post_json_template, 'ext').get.call(post)) // for archive. It's before wrap. <- REALLY?\r\n                         : undefined;},\r\n//    catalog_json2html3_src: function(post){return (post.image)? '/images/src/' + post.image.SHA1 + (post.ext || Object.getOwnPropertyDescriptor(this.parse_funcs.post_json_template, 'ext').get.call(post)) :\r\n//                                                                undefined;}, // for archive. It's before wrap.\r\n//    catalog_json2html3_src: function(post){return (post.image)? '/images/src/' + post.image.SHA1 + post.ext : undefined;},\r\n    post_json2html_fname_server: function(post){return (post.image)? post.image.SHA1 + ((post.image.fileType===0)? '.jpg' : '.png') : undefined;},\r\n    post_json2html_fname: function(post){return (post.image)? post.filename + post.ext : undefined;},\r\n    parse_funcs: {\r\n      'page_html': { // for popup\r\n        get_omitted_info: site2['4chan'].parse_funcs.page_html.get_omitted_info,\r\n        set_omitted_info: site2['4chan'].parse_funcs.page_html.set_omitted_info,\r\n        replace_omitted_info: site2['4chan'].parse_funcs.page_html.replace_omitted_info,\r\n        replace_omitted_info2: site2['4chan'].parse_funcs.page_html.replace_omitted_info2,\r\n      },\r\n      'thread_json' : {\r\n        ths: function(obj, parse_obj) {\r\n          var th = this.prep_th_posts(obj);\r\n          th.nof_posts = th.posts.length; // for not being reduced if posts are sliced.\r\n          obj.__proto__ = parse_obj;\r\n//          if (pref.filter.kwd.post) site2['meguca'].wrap_to_parse.posts(th); // patch for each posts' \"com\". // v3 // patched in catalog_filter_query_keyword.query_11\r\n//          if (pref.filter.kwd.post) site2['DEFAULT'].wrap_to_parse.posts(th); // patch for each posts' \"com\". // v2\r\n          return [th];\r\n        },\r\n        prep_th_posts: function(obj){ // API was changed on 2017.02.19.\r\n          var th = Object.create(obj); // keep original as it is for archiving.\r\n          if (th.sticky) th.sticky = true; // overwrite property of the same name before setting prototype to use polarity.\r\n          th.board = '/' + obj.board +'/';\r\n          obj.no = obj.id || obj.no; // '|| obj.no' for restoring from archive.\r\n          delete obj.id;\r\n          var posts = [obj];\r\n////          var flag = false; // working code -2016.10.06\r\n////          var max_no = 0;\r\n////          for (var i in th.posts) {\r\n          if (obj.posts) for (var i=0;i<obj.posts.length;i++) {\r\n            var post = obj.posts[i];\r\n//            if (pref.test_mode['72'] && post.editing) break; // static for live tagging and archiving, extraction will be done before finishing the posts.\r\n            if (post.id) {\r\n              post.no = post.id;\r\n              delete post.id;\r\n            }\r\n            posts[posts.length] = post;\r\n////            if (max_no>post.no) flag = true;\r\n////            max_no = post.no;\r\n          }\r\n////          if (flag) posts.sort(function(a,b){return a.no - b.no;});\r\n////          th.posts_obj = th.posts;\r\n          th.posts = posts;\r\n          return th;\r\n        },\r\n        get_op_src: function(obj){return site2[obj.domain].catalog_json2html3_src(obj.posts[0]);},\r\n        op_img_url: 'DEFAULT.common', // function(th) {return site2['meguca'].catalog_json2html3_thumbnail(th, th.board);},\r\n//        op_img_url: function(obj){return site2[obj.domain].protocol + '//' + site2[obj.domain].domain_url + site2['meguca'].catalog_json2html3_thumbnail(obj.posts[0]);},\r\n//        add_op_img_url: site2['DEFAULT'].parse_parts.add_op_img_url,\r\n        time_unit: 1000,\r\n        type_com: 'txt',\r\n//        posts_full: 'DEFAULT.catalog_json',\r\n        posts_full: null,\r\n        has_editing: true,\r\n        posts_obj: function(th,no_in){\r\n          var posts_obj = {};\r\n          var i=th.posts.length;\r\n          while (--i>=0) {\r\n            var no = th.posts[i].no;\r\n            posts_obj[no] = th.posts[i];\r\n            if (no===no_in) break;\r\n          }\r\n          return posts_obj;\r\n//          th.posts_obj = posts_obj;\r\n//          return posts_obj[no_in];\r\n        },\r\n        key: 'DEFAULT.common',\r\n      },\r\n      'catalog_json': {\r\n        ths: function(obj, parse_obj) {\r\n          var ths = [];\r\n          var page_base = parseInt(parse_obj.page || 0, 10);\r\n          if (obj.threads) obj = obj.threads; // for v2\r\n          for (var j=0;j<obj.length;j++) {\r\n            var th = this.prep_th_posts(obj[j]);\r\n            th.page = (page_base + Math.floor(j/15)) + '.' + j%15;\r\n//            if (th.sticky) th.sticky = true; // overwrite property of the same name before setting prototype to use polarity.\r\n//            th.board = '/' + th.board +'/';\r\n//            obj[j].no = th.id;\r\n//            delete obj[j].id;\r\n//            th.posts = [th.__proto__];\r\n//            th.posts_obj = {};\r\n//            th.posts_obj[th.no] = th.posts[0];\r\n            obj[j].__proto__ = parse_obj;\r\n            ths[ths.length] = th;\r\n          }\r\n          return ths;\r\n        },\r\n//        footer: function(th){return th.pn.getElementsByClassName('meta')[0];},\r\n//        posts: 'DEFAULT.catalog_json',\r\n//        posts: function(th){\r\n//          var posts = site2['DEFAULT'].parse_funcs.catalog_json.posts(th);\r\n//          if (th.last_replies) posts = posts.concat(th.last_replies);\r\n//          return posts;\r\n//        },\r\n//        has_editing: false,\r\n        has_posts: true, // API was changed on 2017.02.19. // false,\r\n//        missing_info: 1, // API was changed on 2017.02.19. // com is missing.\r\n        proto: 'thread_json',\r\n      },\r\n      'shortCatalog_json_template': {\r\n        proto: 'catalog_json_template'\r\n      },\r\n      'page_json_template': {\r\n        proto: 'catalog_json_template'\r\n      },\r\n      'catalog_json_template': {\r\n        dont_have_com: true,\r\n        get nof_posts(){return this.postCtr;}, // v3\r\n//        get nof_posts(){return this.postCtr+1;}, // v2\r\n//        com: '', // doesn't have this. // changed.\r\n//        get max(){return this.lastUpdated;},\r\n        proto: 'thread_json_template'\r\n      },\r\n      'thread_json_template': {\r\n        get time_posted(){return this.replyTime*1000;},\r\n        get time_bumped(){return this.bumpTime*1000;},\r\n        get time_created(){return this.time*1000;},\r\n//        get nof_posts(){return this.posts.length;}, // remove editing posts. // BUG. reduced if posts are sliced.\r\n        get nof_files(){return this.imageCtr;},\r\n        get com(){return this.body;},\r\n        proto: 'post_json_template'\r\n      },\r\n      'post_json': {\r\n        anchor: function(board,op,no, cross, href){\r\n          if (!href) href = ((cross)? '/all/' : board) + '#p' + no;\r\n          return '<em>'+\r\n                   '<a class=\"history post-link\" data-id=\"' + no + '\" href=\"' + href + '\">&gt;&gt;' + no + '</a>'+\r\n                   '<a class=\"hash-link history\" href=\"' + href + '\"> #</a> '+\r\n                 '</em>';\r\n        },\r\n      },\r\n      'post_json_template': (function(){\r\n        var fileType = ['jpg', 'png', 'gif', 'webm', 'pdf', 'svg', 'mp4', 'mp3', 'ogg', 'zip', '7z', 'tar.gz', 'tar.xz', 'flac', 'noFile', 'txt'];\r\n        return {\r\n          get filename() {return (this.image)? this.image.name : undefined;},\r\n          get w(){return (this.image)? this.image.dims[0] : undefined;},\r\n          get h(){return (this.image)? this.image.dims[1] : undefined;},\r\n          get tn_w(){return (this.image)? ((this.image.spoiler!==undefined && !pref[cataLog.embed_mode].open_spoiler_image)? 150 : this.image.dims[2] || 125) : undefined;},\r\n          get tn_h(){return (this.image)? ((this.image.spoiler!==undefined && !pref[cataLog.embed_mode].open_spoiler_image)? 150 : this.image.dims[3] || 125) : undefined;},\r\n          get fsize(){return (this.image)? this.image.size : undefined;},\r\n          get ext(){return (this.image)? '.'+fileType[this.image.fileType] : undefined;},\r\n          get sub(){return (this.subject)? common_func.escape(this.subject) : '';},\r\n          get capcode(){return this.auth;},\r\n          get md5(){return (this.image)? this.image.MD5 : undefined;},\r\n          get sha1(){return (this.image)? this.image.SHA1 : undefined;},\r\n          get country(){return (this.flag)? this.flag.toUpperCase() : undefined;},\r\n          name: 'Anonymous',\r\n          get txt(){return this.body;},\r\n          get com(){\r\n//            var txt2com = site2[site.nickname].parse_funcs.post_html.txt2com;\r\n            var anchor_class = (site2[site.nickname].parse_funcs.post_html.txt2com_anchor_class)? '\" class=\"' + site2[site.nickname].parse_funcs.post_html.txt2com_anchor_class : '';\r\n            var anchor_regex = /(>>)([0-9]+)/g;\r\n            var anchor_func_tgt = null;\r\n            var anchor_func_1 = (site.nickname==='meguca')? site2['meguca'].parse_funcs.post_json.anchor\r\n                                                          : function(board,op,no,cross){ // for v3\r\n              return '<a href=\"' + ((cross)? '/cross/' : board) + op + '#p' + no + anchor_class + '\">&gt;&gt;' + no + '</a>'; // URL is changed on 2017/05/30\r\n            };\r\n            function anchor_func(str,arrow,no){\r\n              var links = anchor_func_tgt.links;\r\n              var i=0;\r\n              while (i<links.length && links[i].id!=no) i++; // link.no is string, != is used intentionally.\r\n              return (i<links.length)? anchor_func_1(anchor_func_tgt.board, links[i].op, no, anchor_func_tgt.op!=links[i].op, null) // editing post isn't included in links.\r\n                : str;\r\n//              while (i<links.length && links[i][0]!=no) i++; // working code -2018.10.31\r\n//              return (i>=links.length)? str\r\n//                   : anchor_func_1(anchor_func_tgt.board, links[i][1], no, anchor_func_tgt.op!=links[i][1], null); // editing post isn't included in links.\r\n            }\r\n//            function anchor_func(board, str,arrow,no){ // v2\r\n//              var link = this[no];\r\n//              return (link)? '<a href=\"/' + link.board + '/' + link.op + '#' + no + anchor_class +\r\n//                '\">&gt;&gt;' + ((link.board!=board)? '&gt;/'+ link.board +'/' : '') + no + '</a>' : str; // links isn't provided while editing\r\n//            }\r\n            var spoiler_replace_txt = site2[site.nickname].parse_funcs.post_html.txt2com_spoiler_replace_txt || '<spoiler>$1</spoiler>';\r\n            var quote_replace_txt = (site.nickname==='meguca')? '<em>$1</em>' : '<span class=\"quote\">$1</span>';\r\n            var c2t_count;\r\n            function command2txt(str){\r\n              return '<strong>' + str + ' (' + ((this[c2t_count])? this[c2t_count++].val : '') + ')</strong>';\r\n            }\r\n            Object.defineProperty(site2['meguca'].parse_funcs.post_json_template,'com',{get:function(){\r\n                if (!this.body) return '';\r\n                var com = common_func.escape_text(this.body);\r\n                if (this.links) { // v3\r\n                  anchor_func_tgt = this;\r\n                  com = com.replace(anchor_regex,anchor_func);\r\n                }\r\n//                if (this.links) com = com.replace(anchor_regex,anchor_func.bind(this.links, this.board.slice(1,-1))); // v2\r\n                com = com.replace(/(^>[^>].*$)/mg,quote_replace_txt);\r\n                com = com.replace(/\\*\\*(.*?)((\\*\\*)|$)/mg,spoiler_replace_txt);\r\n                if (this.commands) {\r\n                  c2t_count = 0;\r\n                  com = com.replace(/^#(pyu|flip|\\d*d\\d+|8ball)$/mg,command2txt.bind(this.commands));\r\n                }\r\n                com = com.replace(/(https*:\\/\\/[^\\s]*)(\\s|$)/mg,'<a href=\"$1\" target=\"_blank\">$1</a>$2');\r\n                return com.replace(/\\n/g,'<br>');\r\n              }, enumerable:true, configurable:true});\r\n            return this.com;}, // return Object.defineProperty(...).com doesn't work, because 'this' refers site2['meguca'].parse_funcs.post_json_template.\r\n//          get com(){return (this.body)? site2[site.nickname].parse_funcs.post_html.txt2com((this.links)? this.body.replace(anchor_regex,anchor_func(this.links)) : this.body) : '';}, // BUG, /a/1179831(test thread) doesn't have links and cause error. // links isn't provided while editing.\r\n//          get posts_editing(){\r\n//            var posts_editing = {};\r\n//            for (var i=0;i<this.posts.length;i++) if (this.posts[i].editing) posts_editing[this.posts[i].no] = this.posts[i];\r\n//            return Object.defineProperty(this,'posts_editing',{value:posts_editing, writable:true, enumerable:true, configurable:true}).posts_editing;\r\n//          },\r\n          sticky: false,\r\n//          pn: undefined, // block getter\r\n          get no(){return this.id;},\r\n          time: undefined, // patch\r\n          flag: undefined,\r\n          flags: undefined,\r\n          get parse_funcs_html(){\r\n            Object.defineProperty(site2['meguca'].parse_funcs.post_json_template,'parse_funcs_html',\r\n              {value:site2[site.nickname].parse_funcs[site.whereami+'_html'], writable:true, enumerable:true, configurable:true});\r\n            return this.parse_funcs_html;},\r\n          proto: 'DEFAULT.common'\r\n        };\r\n      })(),\r\n    },\r\n    mimic_always: true,\r\n    post_com2txt: function(post){\r\n      return (post.body)? post.body.replace(/\\*\\*([^(\\*\\*)\\n]*)((\\*\\*)|$)/mg,' $1 ') : '';\r\n    },\r\n    proto: 'meguca1'\r\n  };\r\n  common_func.Object_modifyDescriptor(site2['meguca2'],'check_func',{writable:false}); // for reentry.\r\n\r\n  site2['meguca'] = { // meguca.org v3\r\n    domain_url_image: 'meguca.org/assets', // changed around 2018.04.01\r\n//    domain_url_image: 'images.meguca.org/assets',\r\n    check_func: site2['meguca2'].check_func, // needed as a own property.\r\n//    url_boards_json: function(){return ['https://meguca.org/json/' + ((pref.pref2['meguca'].utilize_boards_json)? 'boardTimestamps' : 'boardList'), 'json'];},\r\n    url_boards_json : function(){return ['https://meguca.org/json/board-list', 'json'];},\r\n//    url_boards_json : function(){return ['https://meguca.org/json/boardList', 'json'];}, // working code before 2017.06.19\r\n    postprocess_board: function(val){\r\n      for (var i=0;i<val.length;i++) {\r\n        var bd = liveTag.mems.init({domain:this.nickname, board:'/'+val[i].id+'/'});\r\n        bd.o = i;\r\n        if (val[i].tags && val[i].tags.length!=0) liveTag.postprocess_board_add_btag(val[i].tags,bd);\r\n      }\r\n    },\r\n    utilize_boards_json: false,\r\n    catalog_get_native_scroll_area: undefined, // always window.\r\n//    spoiler_text: {\r\n//      open_rule: 'del, del em {color: #fff!important;}',\r\n//    },\r\n    make_url4 : function(dbt){\r\n      var url_prefix  = this.protocol + '//' + this.domain_url; // force to use https:\r\n      var json_prefix = '/json/boards'; // '/json'; // working code before  2017.06.19\r\n      return (dbt[3]==='catalog_json')? [url_prefix + json_prefix + dbt[1]+ 'catalog', 'json']\r\n           : (dbt[3]==='page_json')?    [url_prefix + json_prefix + dbt[1]+ '?page='+dbt[2], 'json']\r\n           : (dbt[3]==='thread_html')?  [url_prefix + dbt[1] + dbt[2], 'html']\r\n           : (dbt[3]==='thread_json')?  [url_prefix + json_prefix + dbt[1]+dbt[2], 'json']\r\n           : (dbt[3]==='page_html')?    [url_prefix + dbt[1], 'html'] : undefined;\r\n    },\r\n    differentAPI: true,\r\n    historyAPI: false, // true, // changed on 2017.06.12 \r\n    historyAPI_blocking: false,\r\n    short_link:function(name, nof_posts, num, kwd_head, kwd_tail){\r\n      var url = this.make_url4(common_func.name2dbt(name))[0];\r\n      var th_class = 'history lastN-link ' + pref.script_prefix +'_link';\r\n      return '<a href=\"' + url + '?last=100' + '\" class=\"' + th_class + '\">' + kwd_head + '100' + kwd_tail + '</a>';\r\n    },\r\n    wrap_to_parse: {\r\n      get: site2['DEFAULT'].wrap_to_parse.get,\r\n      posts: function(th, start){site2['DEFAULT'].wrap_to_parse.posts(th, start || th.localArchive && 1 || undefined, {op:th.no || th.id});},\r\n//      posts: function(th, start){site2['DEFAULT'].wrap_to_parse.posts(th, start, {op:th.no || th.id});},\r\n    },\r\n    lth_init: function(th){\r\n      liveTag.mems.init({board:'/cross/', domain:th.domain});\r\n      Object.defineProperty(liveTag.mems['meguca'],'/cross/',{value:liveTag.mems['meguca']['/cross/'], configurable:true, enumerable:false, writable:true});\r\n    },\r\n    prep_own_posts: function(bt){\r\n      if (window.opener && window.name==='meguca') setTimeout(this.prep_own_posts_IDB.bind(this),0); // wait to configure IDB module.\r\n      else this.prep_own_posts_IDB();\r\n    },\r\n    prep_own_posts_IDB: function(bt){\r\n      IDB.req_raw('meguca', 'meguca', 'mine', null, this.prep_own_posts_IDB_callback.bind(this), 'get_all'); // This has a racing condition, http request in subframe is faster than IDB usually.\r\n    },\r\n    prep_own_posts_IDB_callback: function(domain, board, no, result){\r\n      var all = {};\r\n      for (var i in result) all[result[i].id] = null;\r\n      site3[this.nickname].own_posts = {ALL:all};\r\n//      var boards = ['/a/','/an/','/cr/','/g/'];\r\n//      for (var i=0;i<boards.length;i++) site3[this.nickname].own_posts[boards[i]] = all;\r\n      if (window.opener && window.name==='meguca') this.prep_own_posts_event();\r\n    },\r\n\r\n    popups_post_pnode: function(pnode){\r\n      while (pnode.tagName!=='ARTICLE' && pnode.parentNode) pnode = pnode.parentNode;\r\n      return pnode;\r\n    },\r\n//    backlink_class: 'backlinks', // for popups_add_1\r\n    add_backlinks_pn: function(pn, target){\r\n      var bks = pn.getElementsByClassName('backlinks')[0];\r\n      if (!bks) {\r\n        bks = document.createElement('span');\r\n        bks.setAttribute('class','spaced backlinks');\r\n        pn.appendChild(bks);\r\n        return {pn:bks, hrefs:{}};\r\n      } else return {pn:bks, hrefs:this.add_backlinks_hrefs(bks, target)};\r\n    },\r\n    add_backlinks_hrefs: function(bks, target){\r\n      var hrefs = {};\r\n      if (!target) bks.innerHTML = '';\r\n      else {\r\n        var as = bks.getElementsByTagName('a');\r\n        for (var j=0;j<as.length;j++) hrefs[as[j].getAttribute('href')] = null;\r\n      }\r\n      return hrefs;\r\n    },\r\n    add_backlinks_add_1: function(bks, dbtp, href){\r\n      var blk = document.createElement('span');\r\n      blk.innerHTML = site2['meguca'].parse_funcs.post_json.anchor(dbtp[1], dbtp[2], dbtp[3], null, href);\r\n      blk = blk.childNodes[0];\r\n//      blk.onclick = this.backlink_onclick;\r\n//      blk.onmouseover = this.popups_post_entry;\r\n      if (dbtp[0]!=='meguca' || pref.test_mode['91']) {\r\n        blk.childNodes[0].onclick = this.backlink_onclick;\r\n        blk.childNodes[1].onclick = this.backlink_onclick;\r\n//        blk.childNodes[0].onmouseover = this.popups_post_entry;\r\n//        blk.childNodes[1].onmouseover = this.popups_post_entry;\r\n      }\r\n      bks.pn.appendChild(blk);\r\n    },\r\n    add_backlinks: function(pn,backlinks,target, th){ // MUST CHANGE TO USE site2['DEFAULT'].add_backlinks, but meguca is down and I can't debugg it now, so I leave this.\r\n      var bks = this.add_backlinks_pn(pn, target);\r\n      for (var i=(target || 0);i<backlinks.length;i++) {\r\n        var dbtp = this.popups_backlink2dbtpth(backlinks[i], th);\r\n        var domain = dbtp[0];\r\n        var href = site2[domain].link_dbtp2href_abs(dbtp);\r\n//        if (domain!==site.nickname) href = site2[domain].absolute_link_1(href);\r\n        if (bks.hrefs[href]!==null) this.add_backlinks_add_1(bks, dbtp, href);\r\n        if (target) break;\r\n      }\r\n    },\r\n    popups_href2dbtp: function(href){ //, src, th){\r\n//      if (href[0]==='#' && th) {\r\n//        href = th.board+th.no+href; // this.link_dbtp2href([th.domain, th.board, th.no, href.substr(2)]);\r\n//        src.setAttribute('href',href);\r\n//      }\r\n      var hrefs = href.split(/[\\/#]/);\r\n      var p = hrefs[hrefs.length-1].substr(1); // remove 'p'\r\n      var b = '/'+hrefs[hrefs.length-3]+'/';\r\n      var t = hrefs[hrefs.length-2];\r\n      if (!t) t = -1;\r\n      return ['meguca',b,t,p]\r\n    },\r\n    toplevel_anchor_pos:2,\r\n    link_dbtp2href: function(dbtp){\r\n      return dbtp[1] + dbtp[2] + '#p' + dbtp[3];\r\n    },\r\n\r\n    popups_post_fetch: function(th, dbt){\r\n      httpd.req({initiator:'popup',\r\n                 tgts:[{url:'https://meguca.org/json/post/'+dbt[3], responseType:'json', tgt:dbt[0]+'/*/'+dbt[2]+'#'+dbt[3], data_type:'json', domain:th.domain}],\r\n                 callback_1:site2[th.domain].popups_post_fetch_callback.bind(site2[th.domain]),\r\n//                 INDICATOR: {shift:function(){}, report:function(){}},\r\n                 IDX:0, RUNNING:0, SUC:0, max:1,\r\n                 dbt:dbt,\r\n                },8);\r\n    },\r\n    popups_post_fetch_callback: function(req,val, REQ){\r\n      var post_0 = {domain:REQ.dbt[0], board:REQ.dbt[1], no:REQ.dbt[2], type_data:'json', domain_html:site.nickname, key:REQ.dbt[0]+REQ.dbt[1]+REQ.dbt[2]};\r\n//      var post_0 = {domain:REQ.dbt[0], board:'/'+val.response.board+'/', no:REQ.dbt[2], type_data:'json', domain_html:site.nickname};\r\n      delete val.response.board;\r\n      var th = {posts:[post_0, val.response], __proto__:post_0};\r\n      site2[th.domain].wrap_to_parse.posts(th);\r\n      var lth = liveTag.mems.init(th);\r\n//      var lth = liveTag.prep_tags(th);\r\n      this.popups_fetched(th,lth, 1);\r\n//      cataLog.format_html.prepare_html_post(th, th.posts[1]);\r\n//      this.popups_add_1(th, th.posts[1], pref[cataLog.embed_mode].popup, lth.q, th.no===th.posts[1].no, false); // cut quote link.\r\n//      if (this.popup_info && this.popup_info.key===REQ.dbt[0]+REQ.dbt[1]+REQ.dbt[2]+'#'+th.posts[1].no) this.popups_post_entry({target:this.popup_info.node, __proto__:this.popup_info});\r\n    },\r\n    post_json2html_imagesearch_href: {\r\n      google: function(url){return 'https://www.google.com/searchbyimage?image_url='+url;},\r\n      iqdb: function(url){return 'http://iqdb.org/?url='+url;},\r\n      saucenao: function(url){return 'http://saucenao.com/search.php?db=999&amp;url='+url;},\r\n      whatAnime: function(url){return 'https://whatanime.ga/?url='+url;},\r\n      desustorage: function(md5){return 'https://desuarchive.org/_/search/image/'+md5;},\r\n      exhentai: function(sha1){return 'http://exhentai.org/?fs_similar=1&amp;fs_exp=1&amp;f_shash='+sha1;},\r\n    },\r\n    post_json2html_imagesearch_1: function(provider,src_x,label){\r\n      var href = this.post_json2html_imagesearch_href[provider](src_x);\r\n      return '<a class=\"image-search ' + provider + '\" target=\"_blank\" rel=\"nofollow\" href=\"' + href + '\">' + label + '</a>';\r\n    },\r\n    post_json2html_imagesearch: function(pref_imgsearch,furl,md5,sha1){\r\n      return ((pref_imgsearch.google)?             this.post_json2html_imagesearch_1('google'     ,furl,'G' ) : '')+\r\n             ((pref_imgsearch.iqdb)?               this.post_json2html_imagesearch_1('iqdb'       ,furl,'Iq') : '')+\r\n             ((pref_imgsearch.saucenao)?           this.post_json2html_imagesearch_1('saucenao'   ,furl,'Sn') : '')+\r\n             ((pref_imgsearch.whatAnime)?          this.post_json2html_imagesearch_1('whatAnime'  ,furl,'Wa') : '')+\r\n             ((pref_imgsearch.desustorage && md5)? this.post_json2html_imagesearch_1('desustorage',md5, 'Ds') : '')+\r\n             ((pref_imgsearch.exhentai && sha1  )? this.post_json2html_imagesearch_1('exhentai'   ,sha1,'Ex') : '');\r\n    },\r\n    post_json2html: function(post, board, op, short_link, op_no) {\r\n      var pn = document.createElement('div');\r\n      var time_unit = (post.parse_funcs && post.parse_funcs.time_unit) || 1;\r\n      var date = new Date((post.time || 0) * time_unit);\r\n      var name = post.name || 'Anonymous';\r\n      var file_header_html= '';\r\n      var file_html= '';\r\n      if (post.ext) {\r\n        var fsize_str = (((post.fsize>1048576)? post.fsize/1048576 : post.fsize/1024)+0.005).toString();\r\n        fsize_str = fsize_str.substr(0,fsize_str.indexOf('.')+3) + ((post.fsize>1048576)? ' MB' : ' KB');\r\n//        var fname_server = site2[post.domain].post_json2html_fname_server(post);\r\n//        var fname = site2[post.domain].post_json2html_fname(post);\r\n        var furl = site2[post.domain].catalog_json2html3_src(post,board);\r\n        var turl = site2[post.domain].catalog_json2html3_thumbnail(post,board);\r\n        var tn_f = (op)? 1 : ((post.tn_w>post.tn_h)? post.tn_w : post.tn_h) / 150;\r\n        file_header_html = '<figcaption class=\"spaced\">'+\r\n            '<a class=\"image-toggle act\" hidden=\"\"></a>'+\r\n            ((pref[cataLog.embed_mode].imagesearch.use)? '<span class=\"spaced image-search-container\">'+\r\n              this.post_json2html_imagesearch(pref[cataLog.embed_mode].imagesearch, furl, post.md, post.sha1) + '</span>' : '')+\r\n            '<span class=\"fileinfo\">'+\r\n              '<span class=\"filesize\">' + fsize_str + '</span>'+\r\n              '<span class=\"dims\">' + post.w + 'x' + post.h + '</span>'+\r\n            '</span>'+\r\n            '<a href=\"' + ((post.domain==='meguca')? furl.replace(/images\\.meguca\\.org/,'meguca.org') : furl) + '\" download=\"' + post.filename + post.ext + '\">' + post.filename + post.ext + '</a>'+\r\n//            '<a href=\"' + furl + '\" download=\"' + post.filename + post.ext + '\">' + post.filename + post.ext + '</a>'+\r\n          '</figcaption>';\r\n        file_html = '<figure>'+\r\n            '<a target=\"_blank\" href=\"' + furl + '\">'+\r\n              '<img src=\"' + turl + '\" width=\"' + post.tn_w + '\" height=\"' + post.tn_h + '\">'+\r\n            '</a>'+\r\n          '</figure>';\r\n      }\r\n      pn.innerHTML = '<article id=\"p' + post.no + '\" class=\"glass' + ((post.ext)? ' media' : '') + '\">'+\r\n          '<input type=\"checkbox\" class=\"deleted-toggle\">'+\r\n          '<header class=\"spaced\"><input type=\"checkbox\" class=\"mod-checkbox hidden\">'+\r\n            '<b class=\"name\">'+post.name+'</b>'+\r\n            ((post.country)? '<img class=\"flag\" src=\"/assets/flags/' + post.country.toLowerCase() + '.svg\" title=\"' + post.country + '\">' : '')+\r\n            '<time>' + site2['common'].change_utc_to_local(date) + '</time>'+\r\n            '<nav>'+\r\n//              '<a class=\"history\" href=\"' + board + op_no + ((post.domain==='meguca')? '?last=100' : '')) + '#p'+post.no + '\">No.</a>'+\r\n//              '<a class=\"history quote\" href=\"/all/2025573?last=100#p2032325\">2032325</a>'+\r\n              '<a class=\"history\" href=\"' + '#p'+post.no + '\">No.</a>'+\r\n              '<a class=\"history quote\" href=\"#p' + post.no + '\">' + post.no + '</a>'+\r\n            '</nav>'+\r\n            ((op)? '<span>'+\r\n              '<span class=\"act\">'+\r\n                 '<a class=\"history expand-link\" href=\"' + board + post.no + '\">Expand</a>'+\r\n              '</span>'+\r\n              ((short_link)? '<span class=\"act\">'+ short_link + \r\n//                '<a class=\"history lastN-link\" href=\"/all/2114139?last=100\">Last 100</a>'+\r\n              '</span>' : '' )+\r\n            '</span>' : '' )+\r\n            '<a class=\"control\">'+\r\n              '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"8\" height=\"8\" viewBox=\"0 0 8 8\">'+\r\n                '<path d=\"M1.5 0l-1.5 1.5 4 4 4-4-1.5-1.5-2.5 2.5-2.5-2.5z\" transform=\"translate(0 1)\"></path>'+\r\n              '</svg>'+\r\n            '</a>'+\r\n          '</header>'+\r\n          file_header_html+\r\n          '<div class=\"post-container\">'+\r\n            file_html+\r\n            '<blockquote>'+\r\n//              '<em>'+\r\n//                '<a class=\"history post-link\" data-id=\"2032314\" href=\"/all/2025573#p2032314\">&gt;&gt;2032314</a>'+\r\n//                '<a class=\"hash-link history\" href=\"/all/2025573#p2032314\"> #</a> '+ // there is a blank here.\r\n//              '</em>'+\r\n//              '<br>Well the grave has already been dug<br>Might as well hop in'+\r\n              post.com+\r\n            '</blockquote>'+\r\n          '</div>'+\r\n        '</article>';\r\n      return pn.removeChild(pn.childNodes[0]);\r\n    },\r\n\r\n    \r\n    post_container: function(pn){return pn},\r\n    update_posts_remove: function(th_old,i,pnode){\r\n      pnode.removeChild(th_old.posts[i].pn);\r\n    },\r\n    update_posts_insert: function(src,dst,i,j,pnode){\r\n      var ref = (j<dst.length)? dst[j].pn : pnode.getElementsByTagName('aside')[0];// dst[dst.length-1].pn.nextSibling; // dst[dst.length-1].pn.nextSibling;\r\n      if (!src[i].pn) src[i].pn = this.post_json2html(src[i], src[i].board);\r\n      var tgt = src[i].pn;\r\n      pnode.insertBefore(tgt, ref);\r\n    },\r\n    page_json2html3_skelton: function(obj, both) {\r\n      var th = document.createElement('section');\r\n      th.setAttribute('class','index-thread');\r\n      th.setAttribute('data-id',obj.no);\r\n      th.innerHTML = '<input type=\"checkbox\" class=\"deleted-toggle\">'+\r\n                     '<aside class=\"act posting glass\"><a href=\"'+ obj.board + obj.no + '?last=100#bottom\">Reply</a></aside>';\r\n      return (both)? [th,th.childNodes[1]] : th;\r\n    },\r\n    page_json2html3: function(obj, clone, dst, force_expander, no_expander){\r\n      var doms = this.page_json2html3_skelton(obj, true);\r\n      var th = doms[0];\r\n      var ref = doms[1];\r\n//      if (!obj.posts) obj.posts = {posts:[{}], _proto__:obj}; // obj.posts = [obj]; // test patch for catalog->page transition.\r\n      var op = this.post_json2html((obj.posts && obj.posts[0])? obj.posts[0] : obj, obj.board, true, site2[obj.domain].short_link(obj.key, obj.nof_posts, 2, 'Last ',''), obj.no);\r\n//      if (!obj.posts) obj.posts = cataLog.threads[obj.key][4].slice(0,1); // test patch for catalog->page transition.\r\n//      op.setAttribute('class','post op');\r\n      th.insertBefore(op,ref);\r\n      obj.posts[0].pn = op;\r\n      if (obj.posts) {\r\n        for (var i=1;i<obj.posts.length;i++) {\r\n          var pn = this.post_json2html(obj.posts[i], obj.board);\r\n          th.insertBefore(pn,ref);\r\n          obj.posts[i].pn = pn;\r\n        }\r\n        if (!no_expander) this.page_json2html3_add_omitted_info(obj,obj.posts,obj.posts);\r\n      }\r\n      return th;\r\n    },\r\n    page_json2html3_replace_expander : function(posts_old, idx, key) {\r\n      var omit_info = this.parse_funcs['page_html'].get_omitted_info(posts_old[0]);\r\n      if (omit_info) omit_info.appendChild(cnst.config_expander(key, idx));\r\n    },\r\n    page_json2html3_add_omitted_info : function(th,posts_old,posts) {\r\n      var nof_files = 0;\r\n      for (var i=0;i<posts.length;i++) nof_files += (posts[i].type_data==='html')? posts[i].pn.getElementsByClassName('figure').length :\r\n                                                    (posts[i].filename)? 1 : 0;\r\n      var nof_files_omitted = th.nof_files - nof_files;\r\n      var nof_posts_omitted = th.nof_posts - posts.length;\r\n\r\n      var omit_info = (posts_old)? this.parse_funcs['page_html'].get_omitted_info(posts_old[0]) : null;\r\n      if (nof_posts_omitted!=0) {\r\n        if (!omit_info) {\r\n          omit_info = document.createElement('span');\r\n          omit_info.setAttribute('class','omit');\r\n          omit_info.setAttribute('data-omit',nof_posts_omitted);\r\n          omit_info.setAttribute('data-image-omit',nof_files_omitted);\r\n          omit_info.innerHTML = ' <span class=\"act\"><a href=\"' + posts[0].no + '\" class=\"history\">See All</a></span>';\r\n          if (th.domain!=='meguca' || pref[cataLog.embed_mode].use_expander_always) omit_info.appendChild(cnst.config_expander(th.key));\r\n          if (posts_old) this.parse_funcs['page_html'].set_omitted_info(posts_old[0],omit_info);\r\n        }\r\n        omit_info.childNodes[0].textContent = nof_posts_omitted + ((nof_posts_omitted==1)? ' post' : ' posts') +\r\n                                ((nof_files_omitted)? ' and ' + nof_files_omitted + ' image' + ((nof_posts_omitted!==1)? 's' : '') : '') + ' omitted ';\r\n//        if (th.domain!==site.nickname) omit_info.childNodes[0].style.display = 'none';\r\n      } else if (omit_info) omit_info.childNodes[0].textContent = 'Showing all posts.'; // if (omit_info && posts_old) posts_old[0].pn.removeChild(omit_info);\r\n      return omit_info;\r\n    },\r\n\r\n\r\n    catalog_json2html3 : function(obj,board,thumb_url, make_footer) {\r\n      var th = document.createElement('article');\r\n      th.id = 'p'+obj.no;\r\n      th.setAttribute('class','glass media op' + ((obj.deleted)? ' deleted' : ''));\r\n      th.setAttribute('data-id',obj.no);\r\n      var th_url = site2[obj.domain].make_url4([obj.domain,obj.board,obj.no,'thread_html'])[0];\r\n      if (thumb_url) {\r\n        var tn_w = obj.tn_w || obj.posts[0].tn_w;\r\n        var tn_h = obj.tn_h || obj.posts[0].tn_h;\r\n        var tn_f = 150 / ((tn_w>tn_h)? tn_w : tn_h);\r\n      }\r\n      var th_class_tn = (site2[obj.domain].historyAPI && pref.pref2.meguca.historyAPI)? 'history' : '';\r\n      var th_class    = th_class_tn + ((th_class_tn)? ' ':'') + pref.script_prefix +'_link';\r\n      var short_link = site2[obj.domain].short_link(obj.key, obj.nof_posts, 1, 'Last ', '');\r\n//      if (!thumb_url) thumb_url = site2[obj.domain].catalog_json2html3_thumbnail(obj, obj.board) || site2[obj.domain].catalog_json2html3_thumbnail(obj.posts[0], obj.board); // for reentry\r\n      th.innerHTML = \r\n        '<input type=\"checkbox\" class=\"deleted-toggle\">'+\r\n        ((thumb_url)? '<figure>'+\r\n          '<a class=\"' + th_class_tn + '\" href=\"' + board + obj.no + '\">'+\r\n          '<img width=\"' + (tn_w * tn_f) + '\" height=\"' + (tn_h * tn_f) + '\" class=\"catalog\" src=\"'+ thumb_url + '\"></a>'+\r\n        '</figure>' : '' )+\r\n        '<span class=\"spaced thread-links hide-empty\">'+\r\n          '<b class=\"board\">' + board + '</b>'+\r\n        '<span class=\"counters\" title=\"Posts/Images\">'+(make_footer? (obj.nof_posts-1) + '/' + (obj.nof_files-1):'')+'</span>'+\r\n          '<span class=\"act\">'+\r\n            ((obj.domain==='meguca')? '<a class=\"' + th_class_tn + ' lastN-link\" href=\"' + board + obj.no + '?last=100\">Last 100</a></span>' :\r\n                                      '<a href=\"' + th_url + '\" class=\"'+ th_class + ' lastN-link\">Expand</a>'+\r\n                                      ((short_link)? '] [' + short_link : ''))+\r\n          '</span>'+\r\n        '</span><br>'+\r\n        ((obj.sub)? '<h3>' + obj.sub + ' </h3>' : '')+\r\n        '<blockquote>' + ((obj.com)? obj.com : '') + '</blockquote>';\r\n      return th;\r\n    },\r\n//    mark_newer_posts: function(th_pn,date,unmark, short_cut, th) {\r\n//      var ths = (th)? [th] : site2['meguca'].wrap_to_parse.get(document, 'meguca', site.board, site.whereami+'_html', (site.whereami==='thread')? {thread:site.no} : null);\r\n////      if (!th && th_pn!==document) return site2['meguca1'].mark_newer_posts(th_pn,date,unmark, short_cut); // patch.\r\n////      if (!th) {\r\n////        th = JSON.parse(document.getElementById('post-data').innerHTML); // JSON.parse(th_pn.getElementById('post-data').innerHTML);\r\n////        th.posts = [th].concat(th.posts);\r\n////        var pns = th_pn.getElementsByTagName('article');\r\n////        for (var i=0;i<pns;i++) th.posts[i].pn = pns[i];\r\n////      }\r\n//      var marked_first_post = null;\r\n//      for (var i=ths.length-1;i>=0;i--)\r\n//        marked_first_post = ths[i].posts[0].pn && this.mark_newer_posts2(ths[i].posts, date, unmark, short_cut) || marked_first_post; // ths[i].posts[0].pn for reentry.\r\n//      return marked_first_post;\r\n//    },\r\n    parse_funcs: {\r\n      'shortCatalog_json': {\r\n        has_posts: false,\r\n        proto: 'meguca2.catalog_json'\r\n      },\r\n      'catalog_json': {\r\n        has_posts: false, // API was changed on 2017/5/24.\r\n      },\r\n      'catalog_html': {\r\n        ths_json: 'thread_html',\r\n        ths: function(doc) {\r\n          var ths = site2['meguca2'].parse_funcs.catalog_html.ths(doc);\r\n          var obj = this.ths_json(doc, ths.map(function(v){return v.pn;}), 'shortCatalog_json', 'catalog');\r\n          for (var i=0;i<obj.length;i++) obj[i].page = Math.floor(i/15) + '.' + (i%15);\r\n          return obj; //site2['meguca'].wrap_to_parse.get(obj, 'meguca', doc.board, 'shortCatalog_json');\r\n//          setTimeout(function(){\r\n//          cataLog.scan_boards_keyword_callback2('meguca,'+doc.board+',j0,shortCatalog_json', {date:Date.now(), status:200, response:obj},\r\n//            ['reentry_data',Object.create(cataLog.scan_boards_keyword_callback2_default_args)]);\r\n//          }, 0);\r\n//          return ths; // REDUNDANT, pass twice.\r\n//          return site2['meguca2'].parse_funcs.catalog_html.ths(doc);\r\n        },\r\n        get_omitted_info: function(){},\r\n        set_omitted_info: function(){},\r\n        pn_name: 'thread_html',\r\n      },\r\n      'page_json': {\r\n        proto: 'meguca2.catalog_json',\r\n      },\r\n      'post_json': {\r\n        pn: 'DEFAULT.post_json',\r\n      },\r\n      'page_html': {\r\n        ths: function(doc) {\r\n          var obj = this.ths_json(doc, document.getElementsByClassName('index-thread'), 'page_json', 'page');\r\n//          var href = window.location.href;\r\n//          var idx  = href.indexOf('?page=');\r\n//          var page = (idx!=-1)? href.substr(idx+6) : 0; // SHOULD BE site.page;\r\n          for (var i=0;i<obj.length;i++) obj[i].page = site.page + '.' + i;\r\n          return obj;\r\n        },\r\n//        footer: function(th){return this.insert_footer4(th.pn.getElementsByClassName('deleted-toggle')[0]);},\r\n        get_max_page: function(doc){\r\n          var len;\r\n          var pgn = doc.getElementsByClassName('pagination')[0];\r\n          return pgn? (len = pgn.childNodes.length, (len<=1)? len : len-1) : 1;\r\n        },\r\n        proto: 'thread_html',\r\n      },\r\n      'thread_html': {\r\n        ths_json: function(doc, pns, type_parse, type_html) {\r\n          var obj = JSON.parse(doc.pn.getElementById('post-data').innerHTML);\r\n          obj = site2['meguca'].wrap_to_parse.get(obj, 'meguca', doc.board, type_parse);\r\n          var dic = {};\r\n          for (var i=0;i<pns.length;i++) dic[pns[i].dataset.id] = pns[i];\r\n          for (var i=0;i<obj.length;i++) {\r\n            obj[i].pn = dic[obj[i].no];\r\n            var posts_pns = obj[i].pn && obj[i].pn.getElementsByTagName('article');\r\n            if (posts_pns) {\r\n              for (var j=0;j<obj[i].posts.length;j++) obj[i].posts[j].pn = posts_pns[j];\r\n              Object.defineProperty(obj[i], 'footer', {value:this.footer(obj[i]), configurable:true, enumerable:true, writable:true});\r\n              Object.defineProperty(obj[i], 'type_mimic', {value:type_html, configurable:true, enumerable:true, writable:true});\r\n            }\r\n          }\r\n//          Object.defineProperty(obj[0].__proto__.__proto__.__proto__, 'type_mimic', {value:type_html, configurable:true, enumerable:true, writable:true}); // BUG. this also effects *_json at next fetch.\r\n          obj[0].__proto__.__proto__.__proto__.parse_funcs_html = site2['meguca'].parse_funcs[type_html+'_html'];\r\n          return obj;\r\n        },\r\n        ths: function(doc) {return this.ths_json(doc, [document.getElementById('thread-container')], 'thread_json', 'thread');},\r\n        footer: function(th){return site2['DEFAULT'].parse_funcs.page_html.insert_footer4(th.pn.getElementsByClassName('deleted-toggle')[0]);},\r\n        get_thread_links: function(th){return th.pn.querySelectorAll('.expand-link,.lastN-link,.'+pref.script_prefix+'_link');},\r\n        get_omitted_info: function(post){\r\n          return post.pn && post.pn.getElementsByClassName('omit')[0] || undefined;\r\n//          var omit_info = post.pn && post.pn.lastChild; // post.pn for transition\r\n//          return (omit_info && omit_info.classList.contains('omit'))? omit_info : undefined; // BUG, this refers backlinks\r\n        },\r\n        set_omitted_info : function(post, info){if (info) post.pn.appendChild(info);},\r\n        replace_omitted_info : function(dst, src){dst.childNodes[0].textContent = src.childNodes[0].textContent;},\r\n        replace_omitted_info2 : function(dst, src, th){\r\n          if (!src) {\r\n            var span = document.createElement('span');\r\n            span.setAttribute('style','display:none');\r\n            dst.insertBefore(span,dst.childNodes[1]);\r\n            span.appendChild(dst.childNodes[0]);\r\n            dst.childNodes[1].setAttribute('style','display:none');\r\n          } else {\r\n            if (dst.childNodes[1].style.display==='none') {\r\n              dst.insertBefore(dst.childNodes[0].childNodes[0], dst.firstChild);\r\n              dst.removeChild(dst.childNodes[1]);\r\n              dst.childNodes[1].removeAttribute('style');\r\n            }\r\n            this.replace_omitted_info(dst,src);\r\n          }\r\n        },\r\n//        replace_omitted_info2: site2['4chan'].parse_funcs.page_html.replace_omitted_info2,\r\n        pn_name: function (post){return post.pn.getElementsByClassName('name')[0].childNodes[0];},\r\n      },\r\n      'thread_json': {\r\n        prep_to_archive: function(obj){\r\n          obj[0].posts = obj.slice(1);\r\n          return obj[0];\r\n        },\r\n        proto: 'meguca2.thread_json',\r\n      },\r\n    },\r\n    favicon : {\r\n      __proto__: site2['DEFAULT'].favicon,\r\n      none: '/assets/favicons/default.ico',\r\n      reply: '/assets/favicons/unread.ico',\r\n      reply_to_me: '/assets/favicons/reply.ico',\r\n    },\r\n    proto: 'meguca2'\r\n  };\r\n  common_func.Object_modifyDescriptor(site2['meguca'],'check_func',{writable:false}); // for reentry.\r\n\r\n  site2['imeguca'] = {\r\n    nickname: 'imeguca',\r\n    domain_url: 'images.meguca.org',\r\n    home: 'https://images.meguca.org/assets/favicons/default.ico',\r\n    check_func: site2['DEFAULT'].check_func,\r\n  };\r\n}\r\nif (pref.features.domains['lain'] || pref.features.domains['lainjp']) {\r\n  site2['lain'] = { //lainchan.org // 5.1.3\r\n    nickname : 'lain',\r\n    home : site.protocol + '//lainchan.org/q/index.html',\r\n//    home : site.protocol + '//lainchan.org',\r\n    X_FRAME_OPTIONS: true,\r\n    CONTENT_SECURITY_POLICY_FRAME: true,\r\n    protocol: 'https:',\r\n    domain_url: 'lainchan.org',\r\n    postform_rules: null,\r\n    features : {page: false, graph: true, setting2: false},\r\n    boards_json:site2['DEFAULT'].generate_boards_json([['\\u03bb',5],['diy',2],['sec',6],['tech',6],['inter',2],['lit',3],['music',3],['vis',3],['hum',3],['drg',3],['zzz',2],['layer',1],['q',7],['r',7]],3),\r\n//    boards_json:{boards:[{board:'cyb', pages:7}, {board:'sci', pages:2}, {board:'tech', pages:7}, {board:'\\u03bb', pages:7}, {board:'layer', pages:5}, {board:'zzz', pages:17}, {board:'w', pages:4}, {board:'feels', pages:7}, {board:'drg', pages:4}, {board:'lit', pages:7}, {board:'civ', pages:1}, {board:'diy', pages:7}, {board:'art', pages:7}, {board:'r', pages:9}, {board:'q', pages:3}, {board:'f', pages:2}, {board:'sec', pages:3}, {board:'cult', pages:4}]},\r\n    check_func : function(){\r\n      var href = window.location.href;\r\n      if (href.indexOf(this.domain_url)===-1 || href.search(new RegExp(this.domain_url+'\\/*$'))!=-1) return false;\r\n//      if (href.indexOf(new RegExp(this.domain_url))!=-1) {\r\n        site.whereami = (href.indexOf('/catalog')!=-1)? 'catalog'\r\n                      : (href.indexOf('/res/')!=-1)? 'thread'\r\n                      : (document.title==='404')? '404' \r\n//                      : (site.board==='/all/' || site.board==='/popular/')? 'other'\r\n//                      : (!pref.test_mode['29'] && (site.board==='/all/' || site.board==='/popular/'))? 'other'\r\n                      : 'page';\r\n//                      : (href.search(/\\/$|(index|[0-9]+)\\.html|\\/all$|\\/popular$/)!=-1)? 'page'\r\n//                      : 'other';\r\n        if (site.whereami==='thread') site.no = parseInt(href.replace(/.*res\\//,'').replace(/\\.html/,''),10);\r\n        site.config(this.domain_url, this.nickname);\r\n        site.max_page = 7;\r\n        site.header_height = function(){\r\n          var header = document.getElementsByClassName('boardlist')[0];\r\n          return (header)? header.offsetHeight : 0;\r\n        }\r\n//        site.myself = site.no || 0;\r\n        site.embed_to = (site.whereami==='thread' || site.whereami==='page')? {\r\n          top: function(){return document.getElementsByName('postcontrols')[0];},\r\n          bottom: function(){return document.getElementsByTagName('footer')[0];}\r\n        } : (site.whereami==='catalog')? {\r\n          top: function(){return document.getElementsByTagName('header')[0].nextSibling;},\r\n          bottom: function(){return document.getElementsByTagName('footer')[0];}\r\n        } : {};\r\n        if (site.whereami==='thread' || site.whereami==='page') {\r\n//          site.postform = document.getElementsByTagName('form')['post'].getElementsByTagName('tbody')[0];\r\n          site.postform = document.getElementsByTagName('form')['post'];\r\n          if (site.postform) {\r\n//            site.postform_comment = document.getElementById('body');\r\n            this.postform_prep();\r\n\r\n//          var bar_bottom = document.getElementsByClassName('bottom')[0];\r\n//////          site.root_body2 = bar_bottom.insertBefore(document.createElement('span'),bar_bottom.childNodes[1]); // working code.\r\n////          site.root_body2 = document.getElementsByClassName('pages')[0];\r\n////          site.root_body2.setAttribute('style','width:auto');\r\n//////          site.root_body2 = document.getElementById('style-select');\r\n          }\r\n        }\r\n//        pref.thread_reader.own_posts_tracker = true;\r\n////////        setTimeout(function(){this.postprocess_board(this.boards_json)}.bind(this),0);\r\n//        var ss = document.querySelector('link[href^=\"/stylesheets/\"]');\r\n        // http://stackoverflow.com/questions/2635814/javascript-capturing-load-event-on-link\r\n        // But https://pie.gd/test/script-link-events/\r\n//        if (this.nickname==='lain') {\r\n//          styleSheet.add_to_watch(document.getElementById('stylesheet'));\r\n//          styleSheet.add_to_watch(document.getElementById('code_stylesheet'));\r\n//        }\r\n//        var ss = document.getElementById('stylesheet'); // doesn't work because chrome and FF don't support onload event from link tag.\r\n//        ss.addEventListener('load',styleSheet.styles_changed,false);\r\n        return true;\r\n//      } else return false;\r\n    },\r\n    styles: 'a.dotted{border-bottom:1px dashed;}',\r\n//    catalog_threads_in_page : function(doc){return doc.getElementsByClassName('mix');},\r\n    catalog_posts_in_thread : function(doc){return doc.getElementsByClassName('replyContainer');},\r\n    max_page : function(){return 10;},\r\n    all_boards: ['/popular/','/all/','/mega/','/random/', '/culture/','/psy/'],\r\n    make_url4: function(dbt){\r\n      return (site2['lain'].all_boards.indexOf(dbt[1])!=-1 && dbt[3]!=='catalog_html')? undefined : site2['vichan'].make_url4.call(this,dbt);\r\n//      return (site2['lain'].all_boards.indexOf(dbt[1])!=-1 && dbt[3]!=='catalog_html')? undefined : this.__proto__.make_url4.call(this,dbt); // cause error from lainjp\r\n    },\r\n\r\n    catalog_native_prep: function(pn_filter,pn_tb,pn_hi){\r\n        if (this.nickname==='lain') {\r\n          styleSheet.add_to_watch(document.getElementById('stylesheet'));\r\n          styleSheet.add_to_watch(document.getElementById('code_stylesheet'));\r\n        }\r\n//      var node_ref = document.getElementsByClassName('catalog_search')[0].nextSibling;  // FF doesn't work.\r\n      var node_ref = (site.whereami==='catalog')? document.getElementsByClassName('threads')[0]\r\n                                                : document.getElementsByName('postcontrols')[0];\r\n      site2['DEFAULT'].catalog_native_prep_sel(pn_filter,pn_tb,site.whereami==='catalog'? document.getElementById('sort_by') : null);\r\n      if (site.whereami==='catalog') {\r\n        document.getElementById('image_size').addEventListener('change', site2['lain'].catalog_native_size_changed, false);\r\n        pn_tb.style.display='inline';\r\n        pn_tb.childNodes[3].style.display='inline';\r\n//        var pn_tb_new = document.createElement('span'); // rip from div to span\r\n//        while (pn_tb.firstChild) pn_tb_new.appendChild(pn_tb.firstChild);\r\n//        pn_tb = pn_tb_new;\r\n//        var pn3 = pn_tb.removeChild(pn_tb.childNodes[3]);\r\n//        while (pn3.firstChild) pn_tb.appendChild(pn3.firstChild); // rip from div to span\r\n////        pn_tb.appendChild(pn_tb.removeChild(pn_tb.childNodes[3]).firstChild);\r\n        if (this.nickname==='lain') {\r\n          document.getElementsByClassName('controls')[0].appendChild(pn_tb);\r\n        } else {\r\n          var threads0 = document.getElementsByClassName('threads')[0];\r\n          threads0.parentNode.insertBefore(pn_tb,threads0);\r\n        }\r\n        node_ref.parentNode.insertBefore(pn_filter,node_ref);\r\n      } else { // if (site.whereami==='page') {\r\n        var pctrls = document.getElementsByName('postcontrols')[0];\r\n//        for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.removeChild(pctrls.childNodes[i]);\r\n//        pctrls.parentNode.insertBefore(document.createElement('hr'),pctrls.nextSibling);\r\n        if (this.nickname==='lain') {\r\n          var blotter = document.getElementsByClassName('blotter')[0];\r\n          var pn = document.createElement('div');\r\n          pn.setAttribute('style','float:left');\r\n          pn.appendChild(blotter.nextSibling.nextSibling);\r\n          pn.appendChild(blotter.nextSibling.nextSibling);\r\n          if (site.whereami==='page') pn.appendChild(document.createTextNode(' | '));\r\n          blotter.parentNode.insertBefore(pn,blotter.nextSibling.nextSibling);\r\n          pn.parentNode.insertBefore(pn_filter, pn.nextSibling);\r\n          pn.parentNode.insertBefore(pn_tb, pn.nextSibling);\r\n        } else {\r\n          pctrls.parentNode.insertBefore(pn_filter,pctrls);\r\n          pctrls.parentNode.insertBefore(pn_tb,pctrls);\r\n        }\r\n      }\r\n//      node_ref.parentNode.insertBefore(pn_hi,node_ref);\r\n//      if (site.whereami==='catalog') node_ref.previousElementSibling.appendChild(pn_tb);\r\n//      if (site.whereami==='catalog') node_ref.previousSibling.appendChild(pn_tb);\r\n//      else node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n//      node_ref.parentNode.insertBefore(pn_filter,node_ref);\r\n//      pn_tb.childNodes[0].setAttribute('style',pn_tb.childNodes[0].getAttribute('style')+';display:none');\r\n//      pn_tb.childNodes[1].setAttribute('style',pn_tb.childNodes[1].getAttribute('style')+';display:none');\r\n////////      return site2['lain'].catalog_from_native(date,document,site.board,site.whereami+'_html');\r\n    },\r\n////    catalog_get_native_area: function(){\r\n////      if (site.whereami==='catalog') return document.getElementById('Grid');\r\n////      else {\r\n////        var pc = document.getElementsByName('postcontrols')[0];\r\n////        return pc.insertBefore(document.createElement('div'),pc.firstChild);\r\n////      }\r\n////    },\r\n\r\n////////    catalog_from_native : function(date,doc,board,type) { // working code.\r\n////////      return site2[this.nickname].wrap_to_parse.get(doc, this.nickname, board, type);\r\n////////////      var parse_obj = {domain:this.nickname, board:board, parse_funcs:site2[this.nickname].parse_funcs[type], __proto__:site4.parse_funcs_on_demand};\r\n////////////      var ths = {pn:doc, __proto__:parse_obj};\r\n////////////      return ths.ths;\r\n////////    },\r\n//    catalog_get_native_area: function(){return document.getElementById('Grid');},\r\n    catalog_native_size: (document.getElementById('image_size'))? document.getElementById('image_size').value : 'small',\r\n    catalog_native_size_changed: function(){site2[site.nickname].catalog_native_size = this.value;},\r\n    parse_funcs : { // lainchan\r\n      'catalog_html' : {\r\n        sticky: function(th){return th.footer.textContent.indexOf('(sticky)')!=-1;},\r\n//        sticky: function(th){return false;}, // patch\r\n        ths: function(doc){\r\n          var ths = this.__proto__.ths(doc);\r\n          if (site2['lain'].all_boards.indexOf(site.board)!=-1)\r\n            for (var i=ths.length-1;i>=0;i--) ths[i].board = '/' + ths[i].pn.getAttribute('data-board') + '/';\r\n          for (var i=0;i<ths.length;i++) ths[i].page = Math.floor(i/10) + '.' + i%10;\r\n          return ths;\r\n        },\r\n      },\r\n      'page_html':{\r\n//        tn_as: function (th){\r\n//          var as = [];\r\n////          var files = th.pn.getElementsByClassName('op')[0].getElementsByClassName('file');\r\n//          var files = th.pn.getElementsByClassName('files')[0].getElementsByClassName('file');\r\n//          for (var i=0;i<files.length;i++) {\r\n//            var as_tmp = files[i].getElementsByTagName('a');\r\n//            if (as_tmp) for (var j=0;j<as_tmp.length;j++) if (as_tmp[j].getElementsByTagName('img')[0]) as[as.length] = as_tmp[j];\r\n//          }\r\n//          return as;\r\n//        },\r\n        ths: function(doc){\r\n//          var ths = site2['vichan'].parse_funcs.page_html.ths(doc);\r\n          var ths = this.__proto__.ths(doc);\r\n          if (site2['lain'].all_boards.indexOf(site.board)!=-1) {\r\n            for (var i=ths.length-1;i>=0;i--) {\r\n              var key = site.nickname + '/' + ths[i].pn.getAttribute('data-board') + '/' + ths[i].no;\r\n              if (cataLog.threads[key]) {ths.splice(i,1);continue;}\r\n              ths[i].board = '/' + ths[i].pn.getAttribute('data-board') + '/';\r\n            }\r\n//            for (var i=0;i<ths.length;i++) {\r\n////            for (var i=ths.length-1;i>=0;i--) {\r\n//              var prev = ths[i].pn.previousSibling;\r\n//              if (!prev || prev.tagName!=='H2') {ths.splice(i,ths.length-i);break;}\r\n////              if (!prev || prev.tagName!=='H2') {ths.splice(i,1);continue;}\r\n////              if (!prev || !prev.getElementsByTagName('a')[0]) {ths.splice(i,1);continue;}\r\n//              ths[i].board = prev.getElementsByTagName('a')[0].textContent;\r\n//              prev.classList.add(pref.script_prefix+'_hs');\r\n////              prev.setAttribute('style','display:none');\r\n////              ths[i].pn.insertBefore(prev,ths[i].pn.firstChild);\r\n//            }\r\n            if (ths.length===0) cataLog.show_catalog();\r\n          }\r\n          return ths;\r\n        },\r\n      },\r\n      'catalog_json' : {\r\n        time_unit: 1000,\r\n      },\r\n      'post_html' : {\r\n        img2src: function(img){\r\n          var src = img.parentNode.href;\r\n          if (src.search(/.webm/)!=-1) src = src.replace(/.*player.php\\?v=/,'').replace(/&t=.*/,'');\r\n//              https://lainchan.org/player.php?v=/test/src/1449566174628.webm&t=1449422283293.webm&loop=1\r\n          return src;\r\n        }\r\n      },\r\n\r\n    },\r\n    colorID: function(pn) {\r\n      var id = pn.getElementsByClassName('poster_id')[0];\r\n      if (id && id.style && !id.style.backgroundColor) {\r\n        site2['vichan'].colorID(pn);\r\n        var prev = id.previousSibling;\r\n        id.textContent = 'ID: '+id.textContent;\r\n        if (prev.textContent===' ID: ') prev.textContent = '';\r\n      }\r\n    },\r\n    catalog_json2html3_thumbnail: function(obj, board) {\r\n      return (obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png' || obj.ext==='.pdf')? 'https://' + this.domain_url + board + 'thumb/' + obj.tim + '.png'\r\n           : (obj.ext==='.epub')? 'https://' + this.domain_url + '/static/lain_epub.jpg' : '';\r\n    },\r\n////////    catalog_json2html3 : function(obj,board,thumb_url) {\r\n////////      var th = document.createElement('div');\r\n////////      th.setAttribute('class','mix');\r\n////////      th.setAttribute('style','display: inline-block;');\r\n//////////      if (obj.ext==='.gif' || obj.ext==='.png') obj.ext='.jpg';\r\n////////      if (obj.ext==='.gif' || obj.ext==='.jpeg') obj.ext='.jpg';\r\n////////      th.innerHTML = '<div class=\"thread grid-li grid-size-' + this.catalog_native_size + '\">' +\r\n////////                     '<a href=\"' + thumb_url + '\">' +\r\n////////                       '<img src=\"' + thumb_url +\r\n////////                       '\" id=\"img-' + obj.no +\r\n////////                       '\" data-subject=\"' + obj.sub +\r\n////////                       '\" data-name=\"' + obj.name +\r\n////////                       '\" data-muhdifference=\"\" data-last-reply=\"\" data-last-subject=\"\" data-last-name=\"\" data-last-difference=\"\"' +\r\n////////                       'class=\"' + board + ' thread-image\" title=\"' + new Date(obj.last_modified*1000).toLocaleString() + ' '+obj.ext + '\"></a>' +\r\n////////                     '<div class=\"replies\"><strong>R: ' + (obj.nof_posts-1) +' / I: ' + obj.nof_files +\r\n//////////                     ((pref.catalog_footer_show_board_name)? ' '+board : '')\r\n////////                     '</strong>' + \r\n////////                     ((obj.sub)? '<p class=\"intro\"><span class=\"subject\">' + obj.sub + '</span></p>' : '<br>') +\r\n////////                     obj.com + '</div></div>';\r\n////////      return th;\r\n////////    },\r\n    catalog_from_json3 : function(obj,board) {\r\n      return site2[this.nickname].wrap_to_parse.get(obj, this.nickname, board, 'catalog_json');\r\n////      var parse_obj = {domain:this.nickname, board:board, parse_funcs:this.parse_funcs['catalog_json'], __proto__:site4.parse_funcs_on_demand};\r\n////      var ths = {obj:obj, __proto__:parse_obj};\r\n////      return ths.ths;\r\n    },\r\n    favicon : {\r\n      __proto__: site2['DEFAULT'].favicon,\r\n      none: '/favicon.png',\r\n      reply: 'png;base64,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',\r\n      reply_to_me: 'png;base64,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'\r\n    },\r\n    proto : 'vichan'\r\n  };\r\n}\r\nif (pref.features.domains['lainjp']) {\r\n  site2['lainjp'] = { //lainchan.jp // ?.?.?\r\n    nickname : 'lainjp',\r\n    home : site.protocol + '//lainchan.jp/lainicon.ico',\r\n    X_FRAME_OPTIONS: true,\r\n    CONTENT_SECURITY_POLICY_DATAURI: true,\r\n    CONTENT_SECURITY_POLICY_FRAME: true,\r\n    protocol: 'https:',\r\n    domain_url: 'lainchan.jp',\r\n    postform_rules: null,\r\n    features : {page: false, graph: true, setting2: false, postform:true},\r\n    boards_json:site2['DEFAULT'].generate_boards_json([['cyb',2],['tech',2],['cult',2],['\\u03bb',1],['\\u03bc',1],['psy',1],['feels',1],['q',2],['r',1]],2),\r\n    check_func: site2['lain'].check_func,\r\n    components: {\r\n      boardlist: '#overheader',\r\n//      postform_comment: 'textarea[name=\"'+ pref.script_prefix + '_draft\"]',\r\n//      postform_submit: 'button[name=\"'+ pref.script_prefix + '_send\"]',\r\n      __proto__:site2['vichan'].components\r\n    },\r\n    parse_funcs: {\r\n      catalog_html: {\r\n        sticky: function(th){return th.pn.getElementsByTagName('strong')[0].textContent.search(/\\(sticky\\)/)!=-1},\r\n        proto: 'lain.catalog_html'\r\n      },\r\n    },\r\n    post_container: function(post_pn,no){return post_pn;},\r\n    update_posts_remove: function(th_old,i,pnode,merge){\r\n      var tgt = th_old.posts[i].pn;\r\n      if (i==0 && tgt.classList.contains('op')) this.update_posts_insert_pack(tgt);\r\n      else pnode.removeChild(tgt.nextSibling);\r\n      pnode.removeChild(tgt);\r\n    },\r\n    catalog_json2html3_thumbnail: function(obj, board) {\r\n      return (obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://' + this.domain_url + board + 'thumb/' + obj.tim + '.png' :\r\n             (obj.ext==='.pdf')? 'https://' + this.domain_url + '/static/pdf.png' : '';\r\n    },\r\n    favicon : {\r\n      __proto__: site2['lain'].favicon,\r\n      none: '/lainicon.ico',\r\n    },\r\n    proto: 'lain'\r\n  };\r\n}\r\nif (window.location.href.search(/localhost/)!=-1) {\r\n  pref.test_mode['94'] = true;\r\n  pref.catalog.embed_page = false;\r\n  pref.virtualBoard.scan_domains['dist'] = 'none';\r\n}\r\nif (pref.test_mode['94']) { // pref.features.domains['dist']) {\r\n  site2['dist'] = { //distchan\r\n    nickname: 'dist',\r\n    domain_url: 'localhost',\r\n    boards_json:site2['DEFAULT'].generate_boards_json([['a',1], ['undefined',1]],3),\r\n    check_func: function(){ // must be owned.\r\n      site0.add_domain(this.nickname);\r\n      site2['DEFAULT'].check_func.call(this);\r\n      site.postform = document.getElementsByClassName('postForm')[0];\r\n    },\r\n    make_url4 : function(dbt, trim_page){ // dbt[2] is string. // modified from 4chan.\r\n      var url_prefix  = site.protocol + '//' + this.domain_url  + dbt[1];\r\n      if (dbt[3]==='catalog_html' || (trim_page && dbt[2]==0 && dbt[3]==='page_json')) dbt[3] = 'catalog_json'; // catalog_html is a skelton.\r\n      return (dbt[3]==='page_json')?       [url_prefix + (parseInt(dbt[2],10)+1) + '.json', 'json', (trim_page)? this.nickname+dbt[1]+'j0' : undefined] : // dbt[2] is string.\r\n             (dbt[3]==='catalog_json')?    [url_prefix + 'catalog.json', 'json', this.nickname+dbt[1]+'j0'] :\r\n             (dbt[3]==='thread_json')?     [url_prefix + dbt[2] + '.json', 'json'] :\r\n             (dbt[3]==='page_html')?       [url_prefix + ((dbt[2]!=0)? (parseInt(dbt[2],10)+1) :''), 'html'] :\r\n             (dbt[3]==='thread_html')?     [url_prefix + dbt[2], 'html'] : null;\r\n    },\r\n    parse_funcs: {\r\n      other_html: {},\r\n    },\r\n    testPoster: (function(){\r\n      var queue = [];\r\n//      var post_func = DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(function(){ // working code.\r\n//        var area_com = document.getElementsByTagName('form')[0].getElementsByTagName('textarea')[0];\r\n//        var button_submit = document.getElementsByTagName('form')[0].getElementsByTagName('input')[0];\r\n//        var post = queue.shift();\r\n//        if (post) {\r\n////          console.log(post.com);\r\n//          area_com.textContent = post.com;\r\n////          button_submit.click();\r\n//          setTimeout(submit,600);\r\n//          if (queue.length>0) post_func();\r\n//        }\r\n//        function submit(){\r\n//          button_submit.click();\r\n//        }\r\n//      }),1000);\r\n      var pn_message = document.getElementsByClassName('message')[1];\r\n      if (pn_message) {\r\n        pn_message.innerHTML = '<div></div><div></div><div></div><div></div>';\r\n        var pn_hist   = pn_fifo_factory(pn_message.childNodes[0]);\r\n        var pn_makeThread = pn_fifo_factory(pn_message.childNodes[1]);\r\n        var pn_prune  = pn_fifo_factory(pn_message.childNodes[2]);\r\n        var pn_errors = pn_fifo_factory(pn_message.childNodes[3]);\r\n      }\r\n      var xhr_reqs = new Map();\r\n      var xhr_frees = [];\r\n      var a_update = document.getElementsByClassName('a_update')[0];\r\n      var post_func = DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(function(){\r\n        var all_data = queue.shift();\r\n        var op = all_data.op;\r\n        var post = all_data.post;\r\n        if (post) {\r\n          if (post.no===op) post.new_thread = true; // patch for bug.\r\n          var data = {type:'json', action:(post.new_thread)? 'makeThread' : (post.pruned)? 'prune' : 'post', board:post.board.slice(1,-1), thread:op, body:queue.length+': '+post.com, subject:post.sub, debug:op};\r\n          if (post.com && post.com.indexOf(' is ')!=-1) data.tag = post.com.substr(post.com.indexOf(' is ')+4).split(/[\\W]/)[0];\r\n          var pn = document.createElement('div');\r\n          var key = data.action+'/'+data.board+'/'+data.thread;\r\n//          pn_messages.set(pn,key);\r\n//          var xhr_events = xhr_events_factory(pn);\r\n          var xhr = xhr_frees.shift() || new_xhr();\r\n          xhr_reqs.set(xhr,{pn:pn, data:data});\r\n          xhr.open('POST', '//localhost/post.php', true);\r\n          xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\r\n          xhr.send(EncodeHTMLForm(data));\r\n          pn.textContent = timestamp()+': '+key+(data.tag? ' '+data.tag:'');\r\n          var old = pn_hist(pn);\r\n          if (old)\r\n            if (old.textContent.indexOf('OK.')===-1) pn_errors(old);\r\n            else if (old.textContent.indexOf('prune')!==-1) pn_prune(old);\r\n            else if (old.textContent.indexOf('makeThread')!==-1) pn_makeThread(old);\r\n        }\r\n          function new_xhr(){\r\n            var xhr = new XMLHttpRequest();\r\n            xhr.addEventListener('load',  xhr_events, false);\r\n            xhr.addEventListener('error', xhr_events, false);\r\n            xhr.addEventListener('abort', xhr_events, false);\r\n            xhr.responseType = 'json';\r\n            return xhr;\r\n          }\r\n          \r\n//          function xhr_events_factory(pn_in) {\r\n//            var pn = pn_in;\r\n//            return function(e) {\r\n          function xhr_events(e) {\r\n            var xhr = e.target;\r\n            var myobj = xhr_reqs.get(xhr);\r\n            var pn = myobj.pn;\r\n            var data = myobj.data;\r\n              var str = (xhr.status==200)? xhr.response && xhr.response.message : xhr.status;\r\n              var str2 = pn.textContent;\r\n              var str2_idx = str2.indexOf(': ')+2;\r\n              str2 = [str2.slice(0,str2_idx), str2.slice(str2_idx)];\r\n              if (str && str.indexOf('OK.')!=-1) {\r\n                str2[1] = str2[1].replace(/(makeThread|post|prune)/,'');\r\n                var str = str.split(' ');\r\n                str[1] = str[1].slice(0,8);\r\n                str[4] = str[4].slice(0,8);\r\n                str[5] = 'op/sec,';\r\n                str = str.join(' ');\r\n              }\r\n  //            if (str===null) str = 'null: '+data.action;\r\n              pn.textContent = str2[0]+ timestamp() +': '+ str + str2[1];\r\n//              pn_messages.delete(pn);\r\n  //            if (xhr.status==200 && localStorage) localStorage['newPost'] = xhr.response.no;\r\n              a_update.textContent = data.thread;\r\n  //            a_update.click(undefined, op); // fail to pass;\r\n              if (data.board===site.board.slice(1,-1) && data.action!=='prune') a_update.click();\r\n              if (queue.length>0) post_func(pref.test_mode.num || 500);\r\n            xhr_reqs.delete(xhr);\r\n            xhr_frees.push(xhr);\r\n//            }\r\n          }\r\n          function EncodeHTMLForm(data) {\r\n            var data_out = [];\r\n            var i=0;\r\n            for(var key in data) data_out[i++] = encodeURIComponent(key) + '=' + encodeURIComponent(data[key]);\r\n            return data_out.join('&').replace(/%20/g,'+');\r\n          }\r\n//        }\r\n      },500));\r\n      function timestamp(){\r\n        var time = new Date();\r\n        return time.toLocaleTimeString() + '.' + ('00' + time.getMilliseconds()).slice(-3);\r\n      }\r\n      function pn_fifo_factory(pn){\r\n        var filled = false;\r\n        return function(pn_add){\r\n          pn.insertBefore(pn_add,pn.firstChild);\r\n          if (filled) return pn.removeChild(pn.lastChild);\r\n          else filled = pn.childNodes.length>=10;\r\n          return null;\r\n        };\r\n      }\r\n      return function entry_func(post, op){\r\n        if (typeof(post)==='string') queue = queue.concat({post:{board:'/'+post.split('/')[1]+'/', pruned:true}, op:post.split('/')[2]});\r\n        else if (post) queue = queue.concat({post:post, op:op});\r\n        post_func(pref.test_mode.num || 500);\r\n      }\r\n    })(),\r\n    features : {catalog: true},\r\n    parse_funcs: {\r\n      'catalog_json': {\r\n        ths: function(obj, parse_obj) {\r\n          var ths = [];\r\n          var page_base = parseInt(parse_obj.page || 0, 10);\r\n          for (var j=0;j<obj.length;j++) {\r\n            var th = Object.create(obj[j]);\r\nth.sub = obj[j].subject; // TEMPORAL\r\n            th.board = '/' + obj[j].board +'/';\r\n            th.page = (page_base + Math.floor(j/15)) + '.' + j%15;\r\n            th.posts = [obj[j]];\r\n            obj[j].__proto__ = parse_obj;\r\n            ths[ths.length] = th;\r\n          }\r\n          return ths;\r\n        },\r\n        op_img_url: function(){return '/distchan.png';},\r\n        key: function(th){return th.domain+th.board+th.no;},\r\n        has_posts: false,\r\n        __proto__: site2['meguca'].parse_funcs.catalog_json\r\n      },\r\n      'thread_json': {\r\n        ths: function(obj, parse_obj){\r\n          return site2['DEFAULT'].parse_funcs['thread_json'].ths({posts:obj, nof_posts:obj.length, board:'/'+obj[0].board+'/'}, parse_obj);\r\n        },\r\n        __proto__: site2['meguca'].parse_funcs.thread_json\r\n      },\r\n      __proto__: site2['meguca'].parse_funcs\r\n    },\r\n    catalog_json2html3: site2['meguca'].catalog_json2html3,\r\n    __proto__: site2['4chan'], // proto: '4chan',\r\n  };\r\n}\r\n\r\n\r\n\r\n////////  if (!site2['futaba']) site2['futaba'] = { // working code.\r\n////////    nickname : 'futaba',\r\n////////    check_func : function(){\r\n////////      if (window.location.href.search(/2chan.net/)!=-1) { // futaba\r\n////////        site.config('2chan.net','futaba');\r\n////////        site.max_page = site2['futaba'].max_page_futaba[site.server_name + site.board];\r\n////////        return true;\r\n////////      } else return false;\r\n////////    },\r\n////////    max_page_futaba : {\r\n////////      'may/b/' : 11,\r\n////////      'jun/b/' : 10,\r\n////////      'dec/b/' : 8,\r\n////////    },\r\n////////    max_page : function(bn){return site2['futaba'].max_page_futaba[bn];},\r\n//////////    make_url : function(board,no){return ['http://'+site.server_name+'.2chan.net' + board + ((no==0)? 'futaba' : no) + '.htm', 'html'];},\r\n////////    make_url4 : function(dbt){return ['http://'+site.server_name+'.2chan.net' + dbt[1] + ((dbt[2]==0)? 'futaba' : dbt[2]) + '.htm', 'html'];},\r\n////////    get_ops : function(doc){\r\n////////      var ops = [];\r\n////////      var responds = doc.getElementsByClassName('hsbn');\r\n//////////      for (var i=0;i<responds.length;i++) ops.push(responds[i].href.substr(-13,9)); // doesn't work for sub-docment.\r\n//////////      for (var i=0;i<responds.length;i++) ops.push(responds[i].getAttribute('href').substr(-13,9)); // may\r\n////////      for (var i=0;i<responds.length;i++) ops.push(responds[i].getAttribute('href').replace(/res\\//,'').replace(/\\.htm/,''));\r\n////////      return ops;\r\n////////    },\r\n////////    get_posts : function(doc) {\r\n////////      var posts = [];\r\n////////      var inputs = doc.getElementsByTagName('input');\r\n////////      for (var i=0;i<inputs.length;i++) if (inputs[i].value=='delete') posts.push(inputs[i].name);\r\n////////      return posts;\r\n////////    },\r\n////////    format_thread : function(doc){return doc;},\r\n////////  };\r\n\r\n  var Debug = /*(!pref.debug_mode['8'])? null :*/ (function(){\r\n//    debug_show_proto_func_pool: null,\r\n    function debug_parse_funcs(str, values_obj, dic_proto) {\r\n      debug_parse_funcs_Init();\r\n      /*if (pref.debug_mode['8'])*/ return debug_parse_funcs_dig(str.split(':')[0], str.split(':')[1], undefined, values_obj, dic_proto); // .replace(/\\//g,',/').replace('::,/','::/');\r\n//      var search_key = 'debug____proto';\r\n//      var ex_keys = [search_key,'proto']; // 'proto' for patch (obsolete)\r\n//      var domain = str.split(':')[0];\r\n//      var type = str.split(':')[1];\r\n//      var pfuncs = site2[domain].parse_funcs;\r\n//      var start_point_template = pfuncs[type+'_template'] || pfuncs[type.split('_')[0]+'_template'];\r\n//      var start_point = pfuncs[type];\r\n//      var func_pool = this.debug_show_proto_func_pool;\r\n//      return str+'::'+ (dig_horizontal(start_point_template) + dig_horizontal(start_point) || 'NONE');\r\n//      function dig_horizontal(obj){ // ,ex_keys,search_key) {\r\n////        if (!search_key) search_key='proto';\r\n////        if (!ex_keys) ex_keys = ['proto'];\r\n//        if (!obj || !obj[search_key]) return '';\r\n//        var str = '/'+obj[search_key] + ':';\r\n//        var keys = Object.keys(obj);\r\n//        for (var i=0;i<keys.length;i++) if (ex_keys.indexOf(keys[i])==-1) {\r\n//          str += keys[i] + ',';\r\n//          ex_keys.push(keys[i]);\r\n//          if (func_pool) func_pool[keys[i]] = Debug.isOwnFunc(obj, keys[i]);\r\n//        }\r\n//        return str + dig_horizontal(obj.__proto__); // , ex_keys, search_key); // for 'debug____proto'\r\n//      }\r\n    }\r\n    function debug_parse_funcs_entry(str, str2) {\r\n      var expand = (!str2)? pref.debug_mode.pfunc_expand : pref.debug_mode.pfunc_comp_expand_same || pref.debug_mode.pfunc_comp_expand_diff;\r\n//      if (expand) this.debug_show_proto_func_pool = {};\r\n//      if (pref.debug_mode['8']) console.log(this.debug_parse_funcs_dig(str.split(':')[0], str.split(':')[1]).replace(/\\//g,',/').replace('::,/','::/'));\r\n      var pool_0 = {};\r\n      console.log(debug_parse_funcs(str, pool_0));\r\n      if (str2) {\r\n//        var pool_0 = this.debug_show_proto_func_pool;\r\n//        this.debug_show_proto_func_pool = {};\r\n        try {\r\n          var dic_proto = JSON.parse(pref.debug_mode.pfunc_comp_proto||null);\r\n        } catch(e) {\r\n          console.log('ERROR in JSON string: '+pref.debug_mode.pfunc_comp_proto);\r\n        }\r\n//        if (pref.debug_mode.pfunc_comp_proto) {\r\n//          var dp = str2.split(':');\r\n//          var start_point = site2[dp[0]].parse_funcs[dp[1]];\r\n//          var proto_org = start_point.__proto__;\r\n//          dp = pref.debug_mode.pfunc_comp_proto.split(':');\r\n//          dp = site2[dp[0]].parse_funcs[dp[1]];\r\n//          if (dp) start_point.__proto__ = dp;\r\n//        }\r\n        var pool_1 = {};\r\n        console.log(debug_parse_funcs(str2, pool_1, dic_proto));\r\n//        var pool_1 = this.debug_show_proto_func_pool;\r\n      }\r\n      if (expand)\r\n        if (!str2) for (var i in pool_0) console.log(i+': '+pool_0[i]);\r\n        else {\r\n          for (var i in pool_1) {\r\n            var same = pool_0[i] === pool_1[i];\r\n            if (pref.debug_mode.pfunc_comp_expand_same && same || pref.debug_mode.pfunc_comp_expand_diff && !same) {\r\n              console.log(i+': '+ (same? 'same':'differ') + ': '+ pool_0[i]);\r\n              if (!same) console.log(i+': '+ (same? 'same':'differ') + ': '+ pool_1[i]);\r\n            }\r\n            delete pool_0[i];\r\n          }\r\n          for (var i in pool_0) console.log(i+': only_in_original: '+ pool_0[i]);\r\n        }\r\n//      this.debug_show_proto_func_pool = null;\r\n//      if (proto_org) start_point.__proto__ = proto_org;\r\n    }\r\n    function debug_parse_funcs_dig(domain, src_type, prop, values_obj, dic_proto){ // prop for vertical digging\r\n////      var src_types = [src_type+'_template', src_type.slice(src_type.indexOf('_')+1)+'_template', src_type];\r\n////      for (var s=0;s<src_types.length;s++) {\r\n//////        if (s==1 && pref.debug_mode['8']) continue;\r\n////        var str = this.debug_parse_funcs_dig(domain, src_types[s], prop);\r\n////        if (str.indexOf('::END')>=0) break;\r\n////      }\r\n//////      var pf = site2[domain].parse_funcs[src_types[s]];\r\n////      return (domain+':'+src_type+'::'+ str.replace(/::END/,'')).replace('::/'+domain+'.'+src_type+':','::');\r\n//////      return pref.debug_mode['8']? str : s<2? domain+':'+src_types[2]+'::'+str.replace(/::/,':') : str; // str.replace(/^.*?::\\//,'').replace(/:/,'::').replace(/\\./,':');\r\n////    },\r\n////    debug_parse_funcs_dig: function(domain, src_type, prop){\r\n      var s2dpf = site2[domain].parse_funcs;\r\n      var start_point_template = s2dpf[src_type+'_template'] || s2dpf[src_type.split('_')[1]+'_template'];\r\n      var start_point = s2dpf[src_type];\r\n      var ex_keys = Object.defineProperties(values_obj||{}, {debug____proto:{value:null}, proto:{value:null}});\r\n//      var ex_keys = Object.create(null, {debug____proto:{value:null}, proto:{value:null}});\r\n//      if (this.debug_show_proto_func_pool) this.debug_show_proto_func_pool = ex_keys;\r\n      var ownProp = false;\r\n      return (domain+':'+src_type+'::' + dig(start_point_template, prop) + (!ownProp? dig(start_point, prop) : '') + ((prop && !ownProp)? ' undefined' : '')).replace('::/'+domain+'.'+src_type+':','::');\r\n//      return domain+':'+src_type+'::'+ dig(start_point, prop);\r\n      function dig(obj, prop){\r\n        if (!obj || !obj['debug____proto']) return '';\r\n        var keys = !prop && Object.keys(obj).filter(function(key){var op; return !(key in ex_keys)? (op = Object.getOwnPropertyDescriptor(obj,key), ex_keys[key] = op.value || op.get, true) : false;}); // horizontal dig\r\n        ownProp = prop && obj.hasOwnProperty(prop); // used as an end_flag also.\r\n        var ownFunc = ownProp && isOwnFunc(obj, prop);\r\n        var ownValue = ownProp && isOwnValue(obj, prop);\r\n        var refCount = (ownFunc)? ++parse_funcs_Map.get(ownFunc).refCount : (ownValue)? parse_funcs_Map.set(ownValue, {refCount:1, count:'value'}).refCount : 0;\r\n//        var ownFuncValue = ownFunc || ownValue;\r\n//        if (ownProp) {\r\n//          var ref = Debug.parse_funcs_Ref.get(ownFuncValue);\r\n//          if (ref===undefined) {\r\n//            ref = {original: (ownFunc)? Debug.parse_funcs_Map.get(ownFunc).original:'', count:1};\r\n//            Debug.parse_funcs_Ref.set(ownFuncValue, ref);\r\n//          } else ref.count++;\r\n//        }\r\n        return '/'+obj['debug____proto']+':'+\r\n          (ownProp? /*'::END'+*/ prop + (ownFunc? ' (==='+parse_funcs_Map.get(ownFunc).original+', '+refCount+')'\r\n                                                : ', '+ownValue) // ownValue && !pref.debug_mode['8']? ', '+ownValue : '')\r\n                  : (prop? '':keys.join(',')) + dig(get_proto(obj), prop));\r\n      }\r\n      function get_proto(obj){\r\n        var p, me;\r\n        var proto = dic_proto && (me = obj['debug____proto'], p = dic_proto[me], p && site2[p.split('.')[0]].parse_funcs[p.split('.')[1]]);\r\n        if (!proto) return obj.__proto__;\r\n        dic_proto[me] = null; // prevent infinite loop\r\n        return proto;\r\n      }\r\n    }\r\n    function debug_parse_funcs_all(str) {\r\n      var domains = Object.keys(site2).filter(function(d){return site2[d].hasOwnProperty('parse_funcs');});\r\n      var types = ['','_json','_html']; // '' for common\r\n      var types_tgt = types.map(function(v){return pref.debug_mode.types[v];});\r\n      var srcs = ['common','post','thread','page','catalog','base'];\r\n      var objs = {};\r\n      debug_parse_funcs_Init();\r\n      for (var d=0;d<domains.length;d++) for (var t=0;t<types.length;t++) for (var s=0;s<srcs.length;s++) {\r\n        var domain = domains[d];\r\n        var src_type = srcs[s]+types[t];\r\n        if (domain!=='DEFAULT' && srcs[s]==='common' || (site2[domain].no_JSONAPI? types[t]==='_json' : src_type==='base_html')) continue;\r\n        if (!site2[domain].parse_funcs[src_type]) continue;\r\n        var str1 = debug_parse_funcs_dig(domain, srcs[s]+types[t], str);\r\n//        if (pref.debug_mode['8']) {\r\n//                var result = this.debug_parse_funcs_parse(domain, src_type, str);\r\n//                var strs = result[0];\r\n//                var hier_str = result[1];\r\n//                src_type = result[2];\r\n//        //      try {\r\n//                var obj_root = site2[domain].parse_funcs[src_type];\r\n//                if (obj_root) {\r\n//                  var obj = obj_root[str];\r\n//                  var flag = true;\r\n//                  for (var i in objs) if (objs[i][0]===obj) {strs[strs.length] = ' (==='+i+')'; flag=false; objs[i][1]++; break;}\r\n//        //        if (flag) objs[domain+':'+src_type] = obj;\r\n//                  if (flag) objs[hier_str] = [obj,1];\r\n//                  if ((typeof(obj)==='string' || typeof(obj)==='number')) strs[str.length] = ', '+obj;\r\n//                }\r\n//        //      } catch(e){\r\n//        //        if (src_type.indexOf('_template')==-1) throw e; // templates don't have parse_funcs and cause excaption.\r\n//        //      }\r\n//        //        console.log(strs.join(''));\r\n//                var str0 = strs.join('').replace(/ *\\(.*/,'');\r\n//                if (str0!==str1.replace(/ *\\(.*/,'')) {console.log('ERROR1:');console.log(str0);console.log(str1);}\r\n//        }\r\n        if (pref.debug_mode.domains[domain] && types_tgt[t]) console.log(str1);\r\n      }\r\n      var num = 0;\r\n      if (pref.debug_mode.pfunc_all_expand) {\r\n        /*if (pref.debug_mode['8']) for (var i in objs) console.log((num++)+'('+objs[i][1]+'): '+ i +': '+objs[i][0]);\r\n        else*/\r\n        for (var i of parse_funcs_Map.keys()) {\r\n          var ref = parse_funcs_Map.get(i);\r\n          if (ref.refCount>0) console.log((num++)+'('+ref.refCount+'/'+ref.count+'): '+(ref.original? ref.original+': ':'')+i);\r\n        }}\r\n      \r\n    }\r\n//    debug_parse_funcs_parse: function(domain, src_type, str, force) { // working code\r\n//      var src_types = [src_type+'_template', /*src_type.slice(src_type.indexOf('_')+1)+'_template',*/ src_type];\r\n//      for (var s=0;s<2;s++) {\r\n//        if (pref.debug_mode['8']) {\r\n//          var str0 = this.debug_parse_funcs(domain+':'+src_types[s]);\r\n//          var str1   = this.debug_parse_funcs_dig(domain, src_types[s]).replace(/ *\\(.*/,'');\r\n//          var str1m  = str1.replace(/\\//g,',/').replace(/:,\\//g,':/').replace(/NONE$/,'');\r\n//          var str1m2 = str1m.replace(/$/,',');\r\n//          if (str0!==str1 && str0!==str1m && str0!==str1m2) {console.log('ERROR0:');console.log(str0);console.log(str1);console.log(str1m);}\r\n//        }\r\n//        var strs = this.debug_parse_funcs(domain+':'+src_types[s]).split(',');\r\n//        for (var i=0;i<strs.length;i++) {\r\n//          var idx_s = strs[i].lastIndexOf(':');\r\n//          if (strs[i].substr(idx_s+1)===str) {\r\n//            strs.splice(i+1,strs.length-i-1);\r\n//            var hier_str = strs[(i>0)?i-1:i].replace(/[^\\/]*\\//g,'').replace(/:[^:]*$/,'').replace(/\\./,':');\r\n//            var root_str = strs[0].replace(/::.*/,'');\r\n//            if (hier_str!==root_str) strs[strs.length] = ' (==='+hier_str+')';\r\n//            return [strs, hier_str, src_types[s]];\r\n//          }\r\n//          if (idx_s===-1) strs.splice(i--,1);\r\n//          else strs[i]=strs[i].substr(0,idx_s+1);\r\n//        }\r\n//      }\r\n//      return [strs, hier_str, src_types[s]];\r\n//    },\r\n//    debug_parse_funcs_all_old: function(str) {\r\n//      var domains = site0.debug_domains.filter(function(v){return pref.debug_mode.domains[v];});\r\n//      var types = site0.debug_types.filter(function(v){return pref.debug_mode.types[v];}); // ['','_json','_html']; // ,'_json_template','_html_template']; // '' for common\r\n//      var srcs = ['common','post','thread','page','catalog','base'];\r\n//      var objs = {};\r\n//      for (var d=0;d<domains.length;d++) for (var t=0;t<types.length;t++) for (var s=0;s<srcs.length;s++) {\r\n//        var domain = domains[d];\r\n//        var src_type = srcs[s]+types[t];\r\n//        if (domain!=='DEFAULT' && srcs[s]==='common' || (site2[domain].no_JSONAPI? types[t]==='_json' : src_type==='base_html')) continue;\r\n//        if (!site2[domain].parse_funcs[src_type]) continue;\r\n//        var result = this.debug_parse_funcs_parse(domain, src_type, str);\r\n//        var strs = result[0];\r\n//        var hier_str = result[1];\r\n//        src_type = result[2];\r\n////      try {\r\n//        var obj_root = site2[domain].parse_funcs[src_type];\r\n//        if (obj_root) {\r\n//          var obj = obj_root[str];\r\n//          var flag = true;\r\n//          for (var i in objs) if (objs[i][0]===obj) {strs[strs.length] = ' (==='+i+')'; flag=false; objs[i][1]++; break;}\r\n////        if (flag) objs[domain+':'+src_type] = obj;\r\n//          if (flag) objs[hier_str] = [obj,1];\r\n//          if ((typeof(obj)==='string' || typeof(obj)==='number')) strs[str.length] = ', '+obj;\r\n//        }\r\n////      } catch(e){\r\n////        if (src_type.indexOf('_template')==-1) throw e; // templates don't have parse_funcs and cause excaption.\r\n////      }\r\n//        console.log(strs.join(''));\r\n//        var str0 = strs.join('').replace(/ *\\(.*/,'');\r\n//        var str1 = this.debug_parse_funcs_dig_vertical(domain, srcs[s]+types[t], str);\r\n//        if (str0!==str1) {console.log('ERROR1:');console.log(str0);console.log(str1);}\r\n//      }\r\n//      var num = 0;\r\n//      if (pref.debug_mode.pfunc_all_expand) for (var i in objs) console.log((num++)+'('+objs[i][1]+'): '+ i +': '+objs[i][0]);\r\n//    },\r\n    function isOwnFunc(pf,prop){\r\n      var desc = Object.getOwnPropertyDescriptor(pf, prop);\r\n      return desc.get || desc.value && typeof(pf[prop])==='function' && desc.value;\r\n    }\r\n    function isOwnValue(pf,prop){\r\n      return Object.getOwnPropertyDescriptor(pf, prop).value;\r\n    }\r\n    function parse_funcs_enumerator(callback){\r\n      for (var i in site2) if (site2[i].hasOwnProperty('parse_funcs'))\r\n        for (var j in site2[i].parse_funcs) if (site2[i].parse_funcs.hasOwnProperty(j) && typeof(site2[i].parse_funcs[j])!=='string')\r\n          for (var k in site2[i].parse_funcs[j]) if (site2[i].parse_funcs[j].hasOwnProperty(k)) callback(site2[i].parse_funcs[j], k, i, j);\r\n    }\r\n//      parse_funcs_Map: (function(){\r\n//        var map = new Map();\r\n//        for (var i in site2) if (site2[i].hasOwnProperty('parse_funcs'))\r\n//          for (var j in site2[i].parse_funcs) if (site2[i].parse_funcs.hasOwnProperty(j))\r\n//            for (var k in site2[i].parse_funcs[j]) if (site2[i].parse_funcs[j].hasOwnProperty(k) && typeof(site2[i].parse_funcs[j])!=='string')\r\n//              if (Object.getOwnPropertyDescriptor(site2[i].parse_funcs[j], k).value && typeof(site2[i].parse_funcs[j][k])==='function') map.set(site2[i].parse_funcs[j][k], i+':'+j+'.'+k);\r\n//        return map;\r\n    //      })(),\r\n    pref_func.settings.onchange_funcs['Debug'] = {\r\n      site2func: function(){\r\n        var prop = pref.debug_mode.site2func;\r\n        if (!prop) return;\r\n        var dic = new Map();\r\n        for (var i in site2) if(site2[i].hasOwnProperty(prop)) dic.set(site2[i][prop],i);\r\n        console.log(Object.keys(site2).map(function(i){return i+': '+dic.get(site2[i][prop]);}).join(', '));\r\n        if (pref.debug_mode.site2func_expand) Array.from(dic).forEach(function(kv){console.log(kv[1]+': ', typeof(site2[kv[1]][prop])==='object'? site2[kv[1]][prop] : site2[kv[1]][prop].toString());});\r\n      },\r\n//      dump_site2: function(){ // working code\r\n//        var name = pref.debug_mode.site2func;\r\n//        if (!name) return;\r\n//        for (var i in site2) if(site2[i].hasOwnProperty(name)) site2[i]['debug____'+name] = i;\r\n//        var str = '';\r\n//        var funcs = {};\r\n//        for (var i in site2) {\r\n//          str += i+': '+site2[i]['debug____'+name]+', ';\r\n//          funcs[site2[i]['debug____'+name]] = site2[i][name];\r\n//        }\r\n//        console.log(str);\r\n//        if (pref.debug_mode.site2func_expand) for (var i in funcs) console.log(i+': ',funcs[i]);\r\n//      },\r\n      pfunc: function(){if (pref.debug_mode.pfunc) debug_parse_funcs_entry(pref.debug_mode.pfunc);},\r\n      pfunc_comp: function(){if (pref.debug_mode.pfunc_comp) debug_parse_funcs_entry(pref.debug_mode.pfunc, pref.debug_mode.pfunc_comp);},\r\n      pfunc_all: function(){if (pref.debug_mode.pfunc_all) debug_parse_funcs_all(pref.debug_mode.pfunc_all);},\r\n    };\r\n    pref_func.settings.onchange_funcs['debug_mode'] = pref_func.settings.onchange_funcs['Debug'];\r\n    var parse_funcs_Map;\r\n    function debug_parse_funcs_Init(){\r\n      for (var i in site2) if (site2[i].hasOwnProperty('parse_funcs'))\r\n        for (var j in site2[i].parse_funcs) if (site2[i].parse_funcs.hasOwnProperty(j)) site2[i].parse_funcs[j]['debug____proto'] = i+'.'+j;\r\n      parse_funcs_Map = new Map();\r\n      parse_funcs_enumerator(function(pf,prop, i, j){var func = isOwnFunc(pf,prop); if (func) parse_funcs_Map.set(func, {original:i+':'+j+'.'+prop, count:0, refCount:0});});\r\n//      parse_funcs_InitCount();\r\n////      Debug.parse_funcs_Ref = new Map();\r\n//    }\r\n//    function parse_funcs_InitCount(){\r\n//      for (var i of parse_funcs_Map.keys()) {\r\n//        var tgt = parse_funcs_Map.get(i);\r\n//        tgt.count = 0;\r\n//        tgt.refCount = 0;\r\n//      }\r\n      parse_funcs_enumerator(function(pf,prop, i, j){var func = isOwnFunc(pf,prop); if (func) parse_funcs_Map.get(func).count++;}.bind(this));\r\n    }\r\n    return {\r\n//      parse_funcs_InitRefCount: function(){\r\n//        for (var i of this.parse_funcs_Map.keys()) this.parse_funcs_Map.get(i).refCount = 0;\r\n//      },\r\n//      parse_funcs_Ref: null,\r\n      lastReloaded: Date.now(),\r\n    };\r\n  })();\r\n\r\n//if (pref.test_mode['18']) { // leak test about 8chan catalog in 4chan.\r\n//  delete site2['8chan'].parse_funcs['catalog_html'].th_init;\r\n//  delete site2['8chan'].parse_funcs['catalog_html'].th_destroy;\r\n//}\r\n\r\n//  for (var i in site2) {\r\n//    if (i=='DEFAULT') continue;\r\n//    for (var j in site2['DEFAULT'])\r\n//      if (site2[i][j]===undefined) site2[i][j]=site2['DEFAULT'][j];\r\n//  }\r\n  for (var i in site2) {\r\nif (pref.test_mode['94'] && i==='dist') continue;\r\n    for (var j in site2[i].parse_funcs) {\r\n      if (typeof(site2[i].parse_funcs[j])==='string') {\r\n        var tgt = site2[i].parse_funcs[j];\r\n        site2[i].parse_funcs[j] = site2[i].parse_funcs[tgt];\r\n        continue;\r\n      }\r\n      for (var k in site2[i].parse_funcs[j]) { // working code.\r\n        if (k!=='proto' && typeof(Object.getOwnPropertyDescriptor(site2[i].parse_funcs[j],k).value)==='string') { // skip getter.\r\n//        if (k!=='proto' && typeof(site2[i].parse_funcs[j][k])==='string') {\r\n          tgt = site2[i].parse_funcs[j][k].split('.');\r\n////          if (tgt.length>1) site2[i].parse_funcs[j][k] = (tgt.length===3)? site2[tgt[0]].parse_funcs[tgt[1]][tgt[2]] : // working code.\r\n////                                                                           site2[i].parse_funcs[tgt[0]][tgt[1]];\r\n          var tgt_obj = (tgt.length===1)? site2[i].parse_funcs[tgt[0]] && site2[i].parse_funcs[tgt[0]][k] : // catalog_json\r\n                        (tgt.length===2 && site2[i].parse_funcs[tgt[0]] && site2[i].parse_funcs[tgt[0]][tgt[1]])? site2[i].parse_funcs[tgt[0]][tgt[1]] : // catalog_json.XXX\r\n                        (tgt.length===2 && site2[tgt[0]] && site2[tgt[0]].parse_funcs[tgt[1]] && site2[tgt[0]].parse_funcs[tgt[1]][k])? site2[tgt[0]].parse_funcs[tgt[1]][k] : // vichan.catalog_json\r\n                        (tgt.length===3 && site2[tgt[0]] && site2[tgt[0]].parse_funcs[tgt[1]])? site2[tgt[0]].parse_funcs[tgt[1]][tgt[2]] : // vichan.catalog_json.XXX\r\n                        null;\r\n          if (tgt_obj) site2[i].parse_funcs[j][k] = tgt_obj;\r\n        }\r\n      }\r\n////      if (i!=='DEFAULT' || j!=='common') { // working code.\r\n////        var proto = (site2[i].parse_funcs[j].hasOwnProperty('proto'))? site2[i].parse_funcs[j].proto : (site2['DEFAULT'].parse_funcs[j] && i!=='DEFAULT')? 'DEFAULT.'+j : 'DEFAULT.common';\r\n//////        if (pref.debug_mode['0']) site2[i].parse_funcs[j].proto = proto; // debug\r\n////        proto = (proto.indexOf('.')==-1)? site2[i].parse_funcs[proto] : site2[proto.substr(0,proto.indexOf('.'))].parse_funcs[proto.substr(proto.indexOf('.')+1)];\r\n////        site2[i].parse_funcs[j].__proto__ = proto;\r\n//////        if (!pref.debug_mode['0']) delete site2[i].parse_funcs[j].proto;\r\n////        delete site2[i].parse_funcs[j].proto;\r\n////      }\r\n      if (i!=='DEFAULT' || j!=='common') {\r\n        var tmp;\r\n        var proto = (site2[i].parse_funcs[j].hasOwnProperty('proto'))? site2[i].parse_funcs[j].proto :\r\n                    (site2[i].hasOwnProperty('proto') && i!=='DEFAULT')? site2[i].proto + '.' + j :\r\n                    (site2['DEFAULT'].parse_funcs[j] && i!=='DEFAULT')? 'DEFAULT.'+j : 'DEFAULT.common';\r\n                    (tmp = j.slice(j.indexOf('_')+1), site2['DEFAULT'].parse_funcs[tmp] && i!=='DEFAULT')? 'DEFAULT.'+tmp : 'DEFAULT.common'; // tmp is one of /(html|json)(_template)*/\r\n//        var proto2= (site2[i].parse_funcs[j].hasOwnProperty('proto'))? site2[i].parse_funcs[j].proto : // old\r\n//                    (site2['DEFAULT'].parse_funcs[j] && i!=='DEFAULT')? 'DEFAULT.'+j : 'DEFAULT.common';\r\n//if (proto!==proto2) console.log(i+':'+j+', '+proto+', '+proto2+', '+(proto===proto2));\r\n        proto = (j.slice(-9)==='_template' && proto==='DEFAULT.common')? site2['DEFAULT'].wrap_to_parse.get_getters(j.indexOf('html')!=-1) :\r\n                (proto.indexOf('.')==-1)? site2[i].parse_funcs[proto] : site2[proto.substr(0,proto.indexOf('.'))].parse_funcs[proto.substr(proto.indexOf('.')+1)];\r\n//        if (proto!==null) proto = (proto.indexOf('.')==-1)? site2[i].parse_funcs[proto] : site2[proto.substr(0,proto.indexOf('.'))].parse_funcs[proto.substr(proto.indexOf('.')+1)];\r\n        site2[i].parse_funcs[j].__proto__ = proto;\r\n        delete site2[i].parse_funcs[j].proto;\r\n      }\r\n    }\r\n    if (i!=='DEFAULT') {\r\n      proto = (site2[i].hasOwnProperty('proto'))? site2[i].proto : 'DEFAULT';\r\n//      if (pref.debug_mode['0']) site2[i].proto = proto; // debug\r\n      if (site2[i].parse_funcs) site2[i].parse_funcs.__proto__ = site2[proto].parse_funcs;\r\n      if (site2[i].patch) site2[i].patch.__proto__ = site2[proto].patch;\r\n      site2[i].__proto__ = site2[proto];\r\n//      if (!pref.debug_mode['0']) delete site2[i].proto;\r\n      delete site2[i].proto;\r\n    }\r\n  }\r\n//  for (var i in site2) {\r\n//    if (i==='DEFAULT' || i==='common') continue;\r\n//    if (!site2[i].hasOwnProperty('prep_own_posts_event')) {\r\n//      site2[i].prep_own_posts_event = site2[i].prep_own_posts_event.bind(site2[i]); // DOESN'T WORK, WHY??? MAY THIS BE CHROME'S BUG??? but I found a better solution.\r\n//console.log('DEBUG: '+i);\r\n//    }\r\n//  }\r\n//    site2['lain'].prep_own_posts_event = site2['lain'].prep_own_posts_event.bind(site2['lain']); // works correctly.\r\n//    site2['KC'].prep_own_posts_event = site2['KC'].prep_own_posts_event.bind(site2['KC']);\r\n\r\n//  for (var i in site2) if (i!=='DEFAULT' && i!=='common') {\r\n//    var proto = site2[i].hasOwnProperty('proto')? site2[i].proto : false;\r\n//    site2[i].__proto__ = (proto)? site2[proto] : site2['DEFAULT'];\r\n//    if (proto) delete site2[i].proto;\r\n//    for (var j in site2[i].parse_funcs) {\r\n//      proto = site2[i].parse_funcs[j].hasOwnProperty('proto')? site2[i].parse_funcs[j].proto : false;\r\n//      if (proto) proto = (proto.indexOf('.')==-1)? site2[i].parse_funcs[proto] : site2[proto.substr(0,proto.indexOf('.'))].parse_funcs[proto.substr(proto.indexOf('.')+1)];\r\n//      site2[i].parse_funcs[j].__proto__ = (proto)? proto\r\n//                                        : (site4.parse_funcs[j])? site4.parse_funcs[j] : site4.parse_funcs.common;\r\n//      if (proto) delete site2[i].parse_funcs[j].proto;\r\n//    }\r\n//  }\r\n//  for (var i in site4.parse_funcs) if (i!=='common') site4.parse_funcs[i].__proto__ = site4.parse_funcs.common;\r\n\r\n//  if (  localStorage &&   localStorage[pref.script_prefix+'.pref']) pref_func.pref_overwrite(pref,JSON.parse(  localStorage[pref.script_prefix+'.pref']),true);\r\n//  if (sessionStorage && sessionStorage.pref) pref_func.pref_overwrite(pref,JSON.parse(sessionStorage.pref),true);\r\n//  pref_func.site2_json();\r\n  site2['ALL'] = {};\r\n\r\n  var site3 = {setup: function(i){\r\n    for (var i in site2) if (i!=='DEFAULT' && i!=='common' && i!=='meguca1' && i!=='meguca2') {\r\n      site3[i] = {boards: null, /*tags: {cs:[], ci:[]},*/ own_posts:{}};\r\n      if (site2[i].hasOwnProperty('check_func')) {\r\n        site2[i].check_func();\r\n        delete site2[i].check_func; // reduce memory consumption.\r\n      }\r\n      site.nicknames.push(i);\r\n      site2['ALL'][site2[i].domain_url] = i;\r\n    }}};\r\n  for (var i in site2) if (i!=='DEFAULT' && i!=='common' && i!=='meguca1' && i!=='meguca2') site3.setup(i);\r\n  if (!site.embed_to['top']) site.embed_to['top'] = function(){return site.root_body && site.root_body.firstChild;};\r\n  if (!site.embed_to['bottom']) site.embed_to['bottom'] = function(){return site.root_body && site.root_body.lastChild;};\r\n\r\n  if (pref.pref2.KC.summer_time) site2['KC'].time_offset = 2;\r\n  if (pref.cli.auto) pref_func.site2_json(false,true,['site2','pref_func','site3']);\r\n\r\n  if (window.top != window.self) {\r\n    if (site.nicknames.indexOf(window.name)==-1 && window.name!==site.embed_frame) return; //don't run on frames or iframes\r\n    for (var i in site2) if (site.nicknames.indexOf(i)!=-1 && i!=site.nickname && site2[i].nickname!=site.nickname) delete site2[i]; // '&& site2[i].nickname!=site.nickname' for '4chan_i'\r\n  }\r\n\r\n  var pipe_name = pref.script_prefix + '.graph.' + site.board + '__pipe__';\r\n  var info_raw  = site.nickname + site.board;\r\n\r\n  if (!window.SharedWorker) {\r\n    pref.info_server = false;\r\n    pref.info_client = false;\r\n  }\r\n//  pref_func.str2obj('catalog_board_list_str');\r\n//  pref_func.str2obj2(pref.catalog,'style_general_list_obj2',pref.catalog.style_general_list_str);\r\n//  pref_func.str2obj2(pref.catalog.board,'ex_list_obj2',pref.catalog.board.ex_list_str);\r\n  if (!site0.isStep) pref_func.obj_init();\r\n  pref3.stats.use = pref.stats.use;\r\n  pref3.stats.estimate_posts = pref.stats.estimate_posts;\r\n\r\n  var notifier = (function(){\r\n    var sound = (pref.features.notify.sound)? (function(){\r\n      var audio = null\r\n      function make_beep(){\r\n        var wav_str = [];\r\n        var dl = header_prep_monaural8(pref.notify.sound.beep_length_f);\r\n        data_prep_monaural8(pref.notify.sound.beep_freq,dl,pref.notify.sound.beep_volume_f);\r\n        for (var i=0;i<wav_str.length;i++) if (wav_str[i].length==1) wav_str[i] = '0'+wav_str[i];\r\n        return new Audio('data:audio/wav,%'+wav_str.join('%'));\r\n\r\n        function header_prep_monaural8(period) {\r\n          var dl=Math.floor(period*44100);\r\n          var header_size=46;\r\n          header_add(0x52494646,4,1);     //riff\r\n          header_add(dl+header_size,4,0); //size\r\n          header_add(0x57415645,4,1);     //WAVE\r\n          header_add(0x666d7420,4,1);     //fmt\r\n          header_add(0x12,4,0);           //size of fmt\r\n          header_add(0x01,2,0);           //linearPCM\r\n          header_add(0x01,2,0);           //Stereo\r\n          header_add(44100,4,0);          //44.1kHz\r\n          header_add(44100,4,0);          //176400 bit/sec\r\n          header_add(1,2,0);              //block size, 4Byte\r\n          header_add(8,2,0);              //bit/sample\r\n          header_add(0,2,0);              //size of ext\r\n    //      header_add(0x66616374,4,1);     //fact\r\n    //      header_add(4,4,0);              //size of fact\r\n    //      header_add(0xdbcd5a00,4,1);     //data of fact\r\n          header_add(0x64617461,4,1);     //data\r\n          header_add(dl,4,0);             //size of data\r\n          return dl;\r\n  \r\n          function header_add(val,num,big_endian) {\r\n            if (big_endian==1) for (var i=0;i<num;i++) wav_str.push('');\r\n            for (var i=0;i<num;i++) {\r\n              if (big_endian==1) wav_str[wav_str.length-1-i] = (val%0x100).toString(16);\r\n              else wav_str.push((val%0x100).toString(16));\r\n              val = Math.floor(val/0x100);\r\n            }\r\n          }\r\n        }\r\n        function data_prep_monaural8(freq,period,vol){\r\n          var pi2 = 3.141592654*2;\r\n          vol *=127;\r\n          for (var i=0;i<period;i++) {\r\n            var val = Math.floor(Math.sin(pi2*freq*i/44100)*vol+0x80)%0x100;\r\n            wav_str.push(val.toString(16));\r\n          }\r\n        }\r\n      }\r\n      function make_audio(){\r\n        if (pref.notify.sound.src==='file') {\r\n          var file = pref3.notify.sound.file && pref3.notify.sound.file.files[0];\r\n          if (file) return new Audio(URL.createObjectURL(file));\r\n        }\r\n        return make_beep();\r\n      }\r\n      function src_changed(e,src){\r\n        if (audio) audio.pause();\r\n        src = src.slice(13); // remove 'notify.sound.'\r\n        if (src==='pause') return;\r\n        audio = null;\r\n        if (pref.notify.sound.notify && (src==='notify' || src==='src' || src.indexOf(pref.notify.sound.src)===0)) play();\r\n      }\r\n      function play(){  // pref.notify.sound.notify is checked in caller\r\n        if (!audio) audio = make_audio();\r\n        audio.play();\r\n      }\r\n      pref_func.settings.onchange_funcs['notify.sound.*w/'] = src_changed;\r\n      return {play: play};\r\n    })() : {play:function(){}};\r\n\r\n    var favicon = (pref.features.notify.favicon)? (function(){\r\n      var favicon = site2[site.nickname].favicon.get_favicon();\r\n      var title = site2[site.nickname].favicon.get_title();\r\n      var title_org = title.innerHTML;\r\n      var favicon_current = 'none';\r\n      var title_current = '';\r\n      function favicon_set(favicon_next){\r\n        if (favicon_current!==favicon_next) {\r\n          var str = site2[site.nickname].favicon[favicon_next];\r\n          if (str[0]!=='/') str = 'data:image/'+str;\r\n          favicon.setAttribute('href',str);\r\n          favicon_current = favicon_next;\r\n        }\r\n      }\r\n//      var func_debug = function(e){for (var i=0;i<e.length;i++) console.log(e[i].target.href);};\r\n//      new MutationObserver(func_debug).observe(favicon, {attributes:true});\r\n//      function favicon_set(str){ // working code.\r\n//        if (!favicon) favicon = site2[site.nickname].favicon.get_favicon();\r\n//        if (str[0]!=='/') str = 'data:image/'+str;\r\n//        favicon.setAttribute('href',str);\r\n//      }\r\n\r\n      function set(){\r\n        var sum = new liveTag.CountNR();\r\n        if (pref.liveTag.watch_all) sum.count_all();\r\n//        if (pref.liveTag.watch_all) {\r\n//          for (var d in liveTag.mems) {\r\n//            for (var b in liveTag.mems[d]) {\r\n//              if (liveTag.mems[d][b].nr<0) {\r\n//                var sum_sub = new liveTag.CountNR();\r\n//                for (var t in liveTag.mems[d][b]) sum_sub.count(liveTag.mems[d][b][t].wt);\r\n//                liveTag.mems[d][b].nrtm = sum_sub.nrtm;\r\n//                liveTag.mems[d][b].nr   = sum_sub.nr;\r\n//              }\r\n////              sum.count([0x000c0000, (liveTag.mems[d][b].nrtm<<16) + liveTag.mems[d][b].nr]); // BUG, nr overflowed in 4chan.\r\n//              sum.nrtm += liveTag.mems[d][b].nrtm;\r\n//              sum.nr   += liveTag.mems[d][b].nr;\r\n//        }}} else {\r\n        else {\r\n          var threads = cataLog.threads;\r\n          if (threads) for (var name in threads) sum.count(threads[name][19]);\r\n        }\r\n        if (pref.notify.favicon) favicon_set((sum.nrtm!=0)? 'reply_to_me' : (sum.nr!=0)? 'reply' : 'none');\r\n        if (pref.notify.title.notify)\r\n          title_set((sum.nr==0 && pref.notify.title.hide_zero)? '' : (pref.catalog.footer.nrtm && sum.nrtm? sum.nrtm + '/' : '') + sum.nr + ' - ');\r\n      }\r\n      function title_set(str){\r\n        if (title_current!==str) {\r\n          title.innerHTML = str + title_org;\r\n          title_current = str;\r\n        }\r\n      }\r\n      return {\r\n        set : new DelayBuffer(set, 200).get_bound_func(),\r\n      } \r\n    })() : {set:function(){}};\r\n\r\n    var desktop = (Notification && pref.features.notify.desktop)? (function(){\r\n      function get_permission(){\r\n        if (Notification.permission !== 'granted') {\r\n          Notification.requestPermission(function (status) {\r\n            if (Notification.permission !== status) {\r\n              Notification.permission = status;\r\n            }\r\n          });\r\n        }\r\n        return Notification.permission==='granted';\r\n      }\r\n//      get_permission(); // this cause a redundant confirmation.\r\n\r\n//      var dtns = {};\r\n      var dtns = [];\r\n      var dtns_queue = [];\r\n      function show(th, post, tagKey, new_thread){\r\n        if (pref.test_mode['94'] && site.nickname==='dist') return site2[site.nickname].testPoster((num>=0)? obj[num] : obj, th.no);\r\n        if (dtns.length + dtns_queue.length < pref.notify.desktop.limit)\r\n          if (Notification.permission === 'granted' || get_permission()) show_1(th, post, tagKey, new_thread);\r\n      }\r\n//      function show(name,obj,num){ // working code.\r\n//        if (dtns.length>pref.notify.desktop.limit) return;\r\n//        if (Notification.permission === 'granted') show_1(name,obj,num);\r\n//        else if (Notification && Notification.permission !== 'denied') {\r\n//          Notification.requestPermission(function (status) {\r\n//            if (Notification.permission !== status) {\r\n//              Notification.permission = status;\r\n//            }\r\n//            if (status === 'granted') show_1(name,obj,num);\r\n//          })\r\n//        }\r\n//      }\r\n      var pn = document.createElement('div');\r\n      function show_1(th, post, tagKey, new_thread){\r\n        if (post.reply_of_mine && pref.catalog_footer_ignore_my_own_posts) return;\r\n        var obj = {\r\n          icon: post.op_img_url,\r\n          body: post.com || '',\r\n          title: (new_thread? 'New Thread ':'') + (post.reply_to_me && pref.notify.desktop.reply_to_me? '(You) in ' : '') + (th.sub || th.key),\r\n          tag: pref.script_prefix+'/' + th.key + ', '+tagKey,\r\n          __proto__: post};\r\n////        if (obj.tag) obj.tag = 'CatChan/' + obj.tag;\r\n//        var obj = (num>=0)? objs[num] : objs; // working code\r\n//        obj = {icon: obj.op_img_url,\r\n//               body: obj.com || '',\r\n//               __proto__: obj};\r\n//        if (obj.reply_of_mine && pref.catalog_footer_ignore_my_own_posts) return;\r\n//        obj.title = ( // (obj.appear_thread)? 'Appear thread ' :\r\n//                     (obj.new_thread)? 'New Thread ' :\r\n//                     (obj.reply_to_me && pref.notify.desktop.reply_to_me)? '(You) in ' :\r\n//                      '') + (th.sub || th.key);\r\n////        if (obj.tag) obj.tag = 'CatChan/' + obj.tag;\r\n//        obj.tag = pref.script_prefix+'/' + th.key + ', '+(objs.length-num-1);\r\n        pn.innerHTML = obj.body;\r\n//        var dtn = new Notification(obj.title,{tag:obj.tag, body:pn[brwsr.innerText], icon:obj.icon});\r\n//        var dtn = new Notification(obj.title,{tag:obj.tag, body:pn[brwsr.innerText].trim(), icon:obj.icon}); // trim for KC\r\n        obj.body = pn[brwsr.innerText].trim(); // trim for KC\r\n        if (pref.notify.desktop.delay===0) show_1_queued(obj);\r\n        else {\r\n          dtns_queue[dtns_queue.length] = obj;\r\n          show_1_queued_delayed(); // FF denies multiple notifications at a time.\r\n        }\r\n      }\r\n      var show_1_queued_delayed = new DelayBuffer(show_1_queued, 200).get_bound_func();\r\n      function show_1_queued(obj) {\r\n        if (!obj) obj = dtns_queue.shift();\r\n        var dtn = new Notification(obj.title, obj); // trim for KC\r\n        dtn.onclick = win_focus;\r\n//        dtn.onclose = close_1;\r\n        var id = (pref.notify.desktop.lifetime!=0)? setTimeout(close_1, pref.notify.desktop.lifetime*1000) : null;\r\n        dtns[dtns.length] = [dtn, id];\r\n//console.log(dtns.length);\r\n//        dtns[obj.tag] = dtn;\r\n//        if (pref.notify.desktop.lifetime!=0) setTimeout(function(){dtn.close();delete dtns[obj.tag];},pref.notify.desktop.lifetime*1000); // can't call this in setTimeout without 'use strict'\r\n        if (dtns_queue.length>0) show_1_queued_delayed();\r\n      }\r\n      function close_1(){dtns.shift()[0].close();}\r\n      function win_focus(){window.focus();for (var i=dtns.length-1;i>=0;i--) if (dtns[i][0]===this || i==0) {if (dtns[i][1]) clearTimeout(dtns[i][1]);dtns.splice(i,1);break;}}\r\n      function close_all(){while (dtns.length>0) {if (dtns[0][1]) clearTimeout(dtns[0][1]);close_1();}}\r\n//      function win_focus(){window.focus();clearTimeout(dtns.shift()[1]);};\r\n//      function close_all(){while (dtns.length>0) close_1();}\r\n////      function win_focus(){window.focus()};\r\n////      function close_all(){\r\n////        for (var i in dtns) dtns[i].close();\r\n////      }\r\n      window.addEventListener('beforeunload', close_all, false);\r\n      return {\r\n        show : show,\r\n      }\r\n    })() : {show:function(){}};\r\n    return {\r\n      sound:   sound,\r\n      favicon: favicon,\r\n      desktop: desktop,\r\n//      changed: function(th, posts_r, new_thread){ // posts_r contains posts by reverse order. // working code, but failed, because not watched thread can't be tracked by this.\r\n//        if (pref.notify.favicon || pref.notify.title.notify) favicon.set();\r\n//        var sound_flag = false;\r\n//        var init = pref4.refresh.count<=1;\r\n//        var pfs = pref.notify.sound;\r\n//        var pfd = pref.notify.desktop;\r\n//        var dt_start = ((pfd.reply || pfd.reply_to_me) && pfd.show_last)? 0 : posts_r.length-1;\r\n//        var dt_end   = (pfd.reply || pfd.reply_to_me)? 0 : posts_r.length-1;\r\n//        for (var i=posts_r.length-1;i>=0;i--) {\r\n//          if (pfs.reply || (pfs.reply_to_me && posts_r[i].reply_to_me) || (pfs.new_thread && new_thread===1)) sound_flag = true; // 1 means new thread\r\n//          if ((i<=dt_start && i>=dt_end) && pfd.notify)\r\n//            if (pfd.reply || (pfd.reply_to_me && posts_r[i].reply_to_me) || (pfd.new_thread && new_thread===1))\r\n//              if (!init || !pfd.supp_init) desktop.show(th,posts_r[i],posts_r.length-1-i, new_thread===1);\r\n//        }\r\n//        if (pfs.notify && sound_flag) if (!init || !pfs.supp_init) notifier.sound.play();\r\n//      },\r\n      changed: function(th, tgt_th19_4){\r\n        if (pref.notify.favicon || pref.notify.title.notify) favicon.set();\r\n//        if (!threads[name][19][5] && tgt_th19_4 && tgt_th19_4.length!=0) { // I think that tgt_th19_4 is redundant, but error occured, so patched.\r\n          var sound_flag = false;\r\n          var init = pref4.refresh.count<=1;\r\n          var pfs = pref.notify.sound;\r\n          var pfd = pref.notify.desktop;\r\n          var dt = (pfd.show_last)? 0 : tgt_th19_4.length-1;\r\n          for (var i=tgt_th19_4.length-1;i>=0;i--) {\r\n            if (pfs.reply || (pfs.reply_to_me && tgt_th19_4[i].reply_to_me)) sound_flag = true;\r\n            if (i<=dt && pfd.notify)\r\n              if (pfd.reply || (pfd.reply_to_me && tgt_th19_4[i].reply_to_me)) if (!init || !pfd.supp_init) desktop.show(th,tgt_th19_4[i],i);\r\n          }\r\n          if (pfs.notify && sound_flag) if (!init || !pfs.supp_init) notifier.sound.play();\r\n//        }\r\n//console.log(tgt_th19_4.length);\r\n      },\r\n////      changed: function(name,threads){\r\n////        if (pref.notify.favicon) favicon.set(threads);\r\n////        var sound_flag = false;\r\n//////threads[name][19][5] = false; // for debug.\r\n////        if (!threads[name][19][5] && threads[name][19][4] && threads[name][19][4].length!=0) { // I think that threads[name][19][4] is redundant, but error occured, so patched.\r\n////          if (pref.notify.desktop.notify) {\r\n////            var i = (pref.notify.desktop.show_last)? 0 : threads[name][19][4].length-1;\r\n////            while (i>=0) {\r\n////              if (i==0 || !pref.notify.desktop.show_last)\r\n////                if (pref.notify.desktop.reply || (pref.notify.desktop.reply_to_me && threads[name][19][4][i].to_me)) desktop.show(name,threads[name][19][4],i);\r\n////              i--;\r\n////            }\r\n////          }\r\n////          for (var i=0;i<threads[name][19][4].length;i++) if (pref.notify.sound.reply || (pref.notify.sound.reply_to_me && threads[name][19][4][i].to_me)) sound_flag = true;\r\n////        }\r\n////        if (pref.notify.sound.notify && sound_flag) notifier.sound.play();\r\n//////console.log(threads[name][19][4].length);\r\n////      },\r\n////      appeared: function(names,threads){ // working code.\r\n//////        if (pref.notify.sound.notify) notifier.sound.play();\r\n////        if (pref.notify.favicon || pref.notify.title.notify) favicon.set(threads);\r\n////        var sound_flag = false;\r\n////        for (var i=0;i<names.length;i++) {\r\n////          var name = names[i];\r\n//////          if (threads[name][19][0]<0) { // 'changed' shall not be issued.\r\n//////            if (pref.notify.desktop.new_thread && threads[name][19][8]) desktop.show(name,[{new_thread:true, body:threads[name][0].innerHTML}],0);\r\n////            var dbt = common_func.name2domainboardthread(name,true);\r\n//////            if (pref.notify.desktop.notify && (pref.notify.desktop.appear || (pref.notify.desktop.new_thread && threads[name][19][8])))\r\n////            if (pref.notify.desktop.notify &&   ((pref.notify.desktop.appear && !(threads[name][19][0]!==0 && (pref.notify.desktop.reply || pref.notify.desktop.reply_to_me)))\r\n////                                              || (pref.notify.desktop.new_thread && threads[name][19][8])))\r\n//////              desktop.show(name,[{new_thread:threads[name][19][8], body:threads[name][0].innerHTML, icon:site2[dbt[0]].get_op_image_url(threads[name][0],threads[name][18])}],0);\r\n////              desktop.show(name,{new_thread:threads[name][19][8], body:threads[name][0].innerHTML, icon:threads[name][26]},-1);\r\n////            if (pref.notify.sound.appear || (pref.notify.sound.new_thread && threads[name][19][8])) sound_flag = true;\r\n////        }\r\n////        if (pref.notify.sound.notify && sound_flag) notifier.sound.play();\r\n////      }\r\n      appeared: function(th, new_thread){\r\n//        var threads = cataLog.threads;\r\n//        if (pref.notify.favicon || pref.notify.title.notify) favicon.set(threads);\r\n        var watch = liveTag.mems[th.domain][th.board][th.no].wt;\r\n        if (pref.notify.desktop.notify && ((pref.test_mode['133'] && pref.notify.desktop.appear && !(watch[0]!==0 && (pref.notify.desktop.reply || pref.notify.desktop.reply_to_me)))\r\n                                            || (pref.notify.desktop.new_thread && new_thread)))\r\n          desktop.show(th,th.posts && th.posts[0] || th, 0, true);\r\n//          desktop.show(th,{new_thread:new_thread, __proto__:th},-1);\r\n        if (pref.notify.sound.notify && (pref.notify.sound.appear || (pref.notify.sound.new_thread && new_thread))) notifier.sound.play();\r\n      }\r\n    }\r\n  })();\r\n\r\n  var ports = {};\r\n  var messages_to_send = {};\r\n  var init_func = {};\r\n  var receive_func = {};\r\n  function make_port_parent(name,win){\r\n    if (ports[name]) send_message(name,['CLOSE']);\r\n    ports[name] = 'init';\r\n    init_func[name] = function(e){initialize(e,name,win);};\r\n    window.addEventListener('message', init_func[name], false);\r\n    if (pref.debug_mode['0']) console.log(window.name + ': Waiting for connection from '+name+' ...');\r\n    function initialize(e,name,win) {\r\n      if (pref.debug_mode['0']) console.log(window.name + ': Connecting from '+e.data);\r\n//      if (e.source==win) {\r\n//      if (e.source==win && site2[e.data]) { // remove \"{\"name\":\"twttr:private:requestArticleUrl\"}\" from someone...\r\n//      if (e.source==win && site.nicknames.indexOf(e.data)!=-1) { // remove \"{\"name\":\"twttr:private:requestArticleUrl\"}\" from someone... in Tampermonkey. // BUG.\r\n//      if (e.source==win && new RegExp(site.nicknames.join('|')).test(e.data)) { // remove \"{\"name\":\"twttr:private:requestArticleUrl\"}\" from someone... in Tampermonkey.\r\n      if ((e.source==win && new RegExp(site.nicknames.join('|')).test(e.data)) ||\r\n          (e.source==site.embed_frame_win && site.whereami==='frame' && e.data.indexOf('CLOSE')==-1)) { // remove \"{\"name\":\"twttr:private:requestArticleUrl\"}\" from someone... in Tampermonkey.\r\n        if (pref.debug_mode['0']) console.log(window.name + ': Connected successfully.');\r\n        if (!brwsr.ff) init_receive_port(name,e.ports[0]);\r\n        else init_receive_port(name,win);\r\n        window.removeEventListener('message', init_func[name], false);\r\n        delete init_func[name];\r\n        if (messages_to_send[name]) {\r\n          for (var i=0;i<messages_to_send[name].length;i++) if (send_message(name,messages_to_send[name][i][0], null, messages_to_send[name][i][1])) break;\r\n          delete messages_to_send[name];\r\n        }\r\n        if (name=='_blank') send_message(name,['CLOSE']);\r\n      } else if (pref.debug_mode['0']) console.log(window.name + ': FAIL.');\r\n    }\r\n  }\r\n  function make_port_child(parent){\r\n    if (pref.debug_mode['0']) console.log(window.name + ': Try to connect to parent...');\r\n    if (!brwsr.ff) {\r\n      var channel = new MessageChannel();\r\n      init_receive_port('parent',channel.port1);\r\n      parent.postMessage(window.name, '*', [channel.port2]); // Specification(order of arguments) was changed.\r\n//      parent.postMessage(window.name, [channel.port2], '*'); // chrome 59 doesn't work this\r\n    } else { // FF doesn't support channel messaging.\r\n      init_receive_port('parent',parent);\r\n      parent.postMessage(window.name, '*');\r\n    }\r\n  }\r\n  function init_receive_port(name,port){\r\n    ports[name] = port;\r\n    receive_func[name] = function(e){receive_message(e,name);};\r\n    if (!brwsr.ff) {\r\n      port.addEventListener('message', receive_func[name], false);\r\n      port.start();\r\n    } else window.onmessage = receive_func[name];\r\n  }\r\n  function close_connection(name){\r\n    if (!brwsr.ff) ports[name].close();\r\n    ports[name].removeEventListener('message', receive_func[name], false);\r\n    delete receive_func[name];\r\n    delete ports[name];\r\n  }\r\n  function send_message(name,message,win,list){\r\n    if (Array.isArray(message) && Array.isArray(message[0])) {message = message[0]; console.log('WARNING, PATCHED: send_mesage');}// patch, ready for depatch and testing.\r\n//    if (typeof(val[0])==='string') val = [val];\r\n//    if (!ports[name]) make_port_parent(name,win);\r\n    if (win) make_port_parent(name,win);\r\n    if (ports[name]==='init') { // chrome works at ==.\r\n      if (!messages_to_send[name]) messages_to_send[name] = [];\r\n      messages_to_send[name].push([message, list]);\r\n    } else {\r\n      if (!ports[name]) {\r\n        name='parent';\r\n        if (!ports[name]) return; // for debug using direct connection\r\n      }\r\n      if (pref.debug_mode['0']) console.log(window.name + ': Sent to '+name+': '+ JSON.stringify(message).substr(0,80));\r\n      if (!brwsr.ff) ports[name].postMessage(message, list);\r\n      else ports[name].postMessage(message,'*', list);\r\n//      if (!brwsr.ff) ports[name].postMessage(JSON.stringify(val[i]));\r\n//      else ports[name].postMessage(JSON.stringify(val[i]),'*');\r\n      if (message[0]=='CLOSE') {close_connection(name); return true;} // fallback for chrome's removing extensions.\r\n    }\r\n  }\r\n  var received_messages_404 = null;\r\n  var send_message_emu = [];\r\n  function receive_message_emu(name) {\r\n    while (send_message_emu.length>0) receive_message({data:send_message_emu.shift()}, name || site.key);\r\n  }\r\n  function jump_to_time(th, time){\r\n    if (pref.test_mode['167'] & time<0x10000) time = th.posts[time-1] && th.posts[time-1].time || time;\r\n    var idx = site2[th.domain].mark_newer_posts2(th.posts,time,pref.thread_reader.unmark_on_hover, true); //  || null;\r\n//      var marked_first_post = (common_obj.thread_reader && pref.test_mode['16'])? common_obj.thread_reader.mark_newer_posts(val[1])\r\n//                                                        : site2[site.nickname].mark_newer_posts(document,val[1],pref.thread_reader.unmark_on_hover, true);\r\n    var tgt_post = gGEH.marked_first_post && th.posts[idx]? (gGEH.marked_first_post.time_tu < th.posts[idx].time_tu? gGEH.marked_first_post : th.posts[idx])\r\n                 : gGEH.marked_first_post || th.posts[idx];\r\n    if (tgt_post) {\r\n      var tgt_top = tgt_post.pn.offsetTop;\r\n      if (!tgt_top && pClg) {\r\n        pClg.show_catalog_delayed(); // for lazy merge, force to draw.\r\n        tgt_top = tgt_post.pn.offsetTop;\r\n        if (!tgt_top) { // for deleted post\r\n          while (idx>0 && !th.posts[idx].pn.parentNode) idx--;\r\n          tgt_top = th.posts[idx].pn.offsetTop + th.posts[idx].pn.offsetHeight;\r\n        }\r\n      }\r\n      scrollTo(0, tgt_top - site.header_height());\r\n//      if (pClg) pClg.GEH.last_viewed = marked_first_post; // BUG!!! error at racing condition, messages may be earlier than creation of pClg.\r\n//      else gGEH.last_viewed = marked_first_post; // avoids racing condition\r\n    } else scrollTo(0,document.body.clientHeight - window.innerHeight); // to the last\r\n    gGEH.marked_first_post = tgt_post;\r\n  }\r\n  function receive_message(e,name) {\r\n    if (pref.debug_mode['0']) console.log(window.name + ': Received from '+name+': '+e.data.toString().substr(0,80));\r\n    var val = e.data;\r\n    var list = e.ports;\r\n//    var val = JSON.parse(e.data);\r\n    if (site.whereami==='404' && val[0]!=='CLOSE') {if (!received_messages_404) received_messages_404 = [e.data]; else received_messages_404.push(e.data); return;}\r\n    if (typeof(val)=='string') val=JSON.parse(val); // patch for GM.\r\n    if (val[0]=='HTTPD') httpd.sub_funcs(val[1]);\r\n    else if (val[0]=='IDB' && IDB) IDB.sub_funcs(val[1], list);\r\n    else if (val[0]=='ARCHIVER' && archiver) archiver.sub_funcs(val[1], val[2]);\r\n    else if (val[0]=='CLOSE') close_connection(name);\r\n    else if (val[0]=='MARK' && val[1]>0) {\r\n      jump_to_time(site.myself, val[1]);\r\n//      var marked_first_post = site.myself && site2[site.nickname].mark_newer_posts2(site.myself.posts,val[1],pref.thread_reader.unmark_on_hover, true) || null; // working code\r\n////      var marked_first_post = (common_obj.thread_reader && pref.test_mode['16'])? common_obj.thread_reader.mark_newer_posts(val[1])\r\n////                                                        : site2[site.nickname].mark_newer_posts(document,val[1],pref.thread_reader.unmark_on_hover, true);\r\n//      if (marked_first_post) {\r\n//        scrollTo(0,marked_first_post.offsetTop - site.header_height());\r\n////        if (pClg) pClg.GEH.last_viewed = marked_first_post; // BUG!!! error at racing condition, messages may be earlier than creation of pClg.\r\n////        else gGEH.last_viewed = marked_first_post; // avoids racing condition\r\n//      } else scrollTo(0,document.body.clientHeight - window.innerHeight); // to the last\r\n      gGEH.time_jumped = val[1];\r\n      if (pClg && pClg.mode==='thread') for (var name in pClg.threads) if (name!==site.key && pClg.threads[name][1]) jump_to_time(pClg.threads[name][16], val[1]); // for racing condition\r\n      if (common_obj.thread_reader) common_obj.thread_reader.mark_posts_from_parent(val[1]);\r\n    }\r\n////    else if (val[0]=='SUBFRAME_INIT') http_req.remote();\r\n////    else if (val[0]=='SUB_GET') http_req.sub_get(val[1]);\r\n////    else if (val[0]=='SUB_ACK') http_req.sub_ack(val[1]);\r\n////    else if (val[0]=='SUB_DEST') http_req.sub_dest(val[1]);\r\n    else if (val[0]=='OWN_POSTS') {\r\n      if (site2[val[1]].prep_own_posts_event_received) site2[val[1]].prep_own_posts_event_received(val[2]);\r\n      else site3[val[1]].own_posts = val[2];\r\n    } else if (val[0]=='TRIAGE') {\r\n//console.log('receive: TRIAGE, '+val[1]+', '+val[2]+', '+val[3]);\r\n//      if (catalog_obj && catalog_obj.catalog_func()!=null) catalog_obj.catalog_func().triage_exe_0(val[1],val[2],'',true,val[3]);\r\n      if (catalog_obj && catalog_obj.catalog_func()!=null) catalog_obj.catalog_func().triage_exe_pipe(val[1]);\r\n    } else if (val[0]=='UIP') {\r\n      if (uip_tracker) uip_tracker.annotate_from_catalog(val[1]);\r\n    }\r\nelse if (pref.test_mode['34'] && val[0]==='ECHO') setTimeout(function(){send_message(window.name? 'parent' : 'meguca',['ECHO',val[1]])},5000);\r\n  }\r\n//  function receive_message(e,name) { // working code for old http_req\r\n//    if (pref.debug_mode['0']) console.log(window.name + ': Received from '+name+': '+e.data.toString().substr(0,80));\r\n//    var val = JSON.parse(e.data);\r\n//    if (typeof(val)=='string') val=JSON.parse(val); // patch for GM.\r\n//    if (val[0]=='CLOSE') close_connection(name);\r\n//    else if (val[0]=='MARK' && val[1]>=0) {\r\n//      var offset_top = site2[site.nickname].mark_newer_posts(document,val[1]);\r\n//      scrollTo(0,offset_top);\r\n//    } else if (val[0]=='SUBFRAME_INIT') {\r\n//      http_req.remote();\r\n//    } else if (val[0]=='SUB_GET') {\r\n//      http_req.get(val[1][0],val[1][1],val[1][2],val[1][3],val[1][4],val[1][5],val[1][6]);\r\n//    } else if (val[0]=='SUB_ACK') {\r\n//      iframes[name][1]--;\r\n//      http_req.onload_local(val[1],val[2]);\r\n//    }\r\n//  }\r\n  function close_all(){\r\n    for (var name in ports) send_message(name,['CLOSE']);\r\n  }\r\n  window.addEventListener('beforeunload', close_all, false);\r\n  if (window.opener) {\r\n//console.log('child');\r\n    make_port_child(window.opener);\r\n////    for (var i in site2) // moved to before.\r\n////      if (site2[i].nickname===window.name) {\r\n////        for (var i in site.features) site.features[i] = false;\r\n////        brwsr.sw_cache = null;\r\n////        pref.cloudflare.auto_reload = false;\r\n////        break;\r\n////      }\r\n    if (site2[window.name] && site2[window.name].prep_own_posts_event) {\r\n      window.addEventListener('storage', site2[window.name].prep_own_posts_event, false);\r\n      site2[window.name].prep_own_posts();\r\n      site2[window.name].prep_own_posts_event();\r\n    }\r\n  }\r\n  if (pref.cloudflare.auto_reload) {\r\n    var cf_error = document.getElementsByClassName('cf-error-code');\r\n    if (cf_error.length>0 && parseInt(cf_error[0].textContent,10)>=500) setTimeout(function(){location.reload();},pref.cloudflare.auto_reload_time*60000);\r\n  }\r\n\r\n//  var ports = {}; // working code for test\r\n//  function make_port_parent(name, val){\r\n//    ports[name] = val;\r\n//    var port;\r\n//    if (pref.debug_mode['0']) console.log('parent: '+name+', '+val);\r\n//    window.onmessage = function(e) {\r\n//      if (pref.debug_mode['0']) console.log('from child #unkown: '+e.data);\r\n//      port = e.ports[0];\r\n//      port.postMessage(JSON.stringify(['MARK',val]));\r\n//      port.postMessage(JSON.stringify('CLOSE'));\r\n//      port.close();\r\n////      port.onmessage = function(e) {\r\n////        if (pref.debug_mode['0']) console.log(e.data);\r\n////        port.postMessage('received : ('+Date.now()+')');\r\n////      }\r\n//    }\r\n//  }\r\n//\r\n//  function make_port_child(prt){\r\n//    if (pref.debug_mode['0']) console.log('child :');\r\n//    var channel = new MessageChannel;\r\n//    var port = channel.port1;\r\n//    prt.postMessage('Connection: ', [channel.port2], '*');\r\n////    prt.postMessage('start', [channel.port2], '*');\r\n////    setInterval(function() {port.postMessage('sent : ' + (+new Date));}, 2000);\r\n////    port.onmessage = function(e) {if (pref.debug_mode['0']) console.log(e.data);};\r\n//    port.onmessage = function(e) {\r\n//      if (pref.debug_mode['0']) console.log(e.data);\r\n//      var val = JSON.parse(e.data);\r\n//      if (val[0]=='CLOSE') port.close();\r\n//      else if (val[0]=='MARK' && val[1]>=0) {\r\n//        var offset_top = site2[site.nickname].mark_newer_posts(document,val[1]);\r\n//        scrollTo(0,offset_top);\r\n//      }\r\n//    };\r\n//  }\r\n//  if (window.opener) make_port_child(window.opener);\r\n\r\n  var httpd = (function(){\r\n//    var cooldowns = {};\r\n//    function cooldown_check(req){\r\n//      var period = pref.scan.cooldowns[req.domain];\r\n//      if (!period) return req;\r\n//      var now = Date.now();\r\n//      if (!cooldowns[req.domain]) {cooldowns[req.domain] = {domain:req.domain, urls:{}, queue:[], time:now}; return req;}\r\n//      var cooldown = cooldowns[req.domain];\r\n//      var rest = cooldown.time + period*1000 - now;\r\n//      if (rest<=0 && !queue_get(cooldown.queue)) {cooldown.time = now; return req;}\r\n//      queue_add(cooldown.queue, req);\r\n//      if (rest<=0) {cooldown.time = now; return queue_get(cooldown.queue);}\r\n//      setTimeout(cooldown_wakeup.bind(null,cooldown), rest+1000); // 1000 for safty\r\n//      return null;\r\n//    }\r\n//    function cooldown_wakeup(cooldown){\r\n//      queue_add(reqs, queue_get(cooldown.queue));\r\n//      dispatch_if_idle();\r\n//    }\r\n//    function queue_add(queue, req){\r\n//      var i=0\r\n//      while (i<queue.length && queue[i].priority>req.priority) i++;\r\n//      queue.splice(i,0,req);\r\n//    }\r\n//    function queue_get(queue){\r\n//      while (queue[0] && queue[0].tgts.length===0) queue.shift();\r\n//      return queue[0];\r\n//    }\r\n    var iframes = {};\r\n    var iframes_timeout = {};\r\n    var local = true;\r\n//    var parser = new DOMParser();\r\n//    var serializer = new XMLSerializer();\r\n    var xhrs = new Map();\r\n    var xhrs_free = [];\r\n    var xhrs_count = 0;\r\n//    var xhrs_count_by_domain = {};\r\n    var remote_opened = {};\r\n    var remote_count = 0;\r\n    var remote_reqs = {};\r\n    var reqs = [];\r\n    var reqs_waiting_finish = [];\r\n    var pause = 0;\r\n    var crawler_spawn   = new Watchdog(dispatch, pref.scan.crawler_idle_time_to_spawn);\r\n    var xhrs_reqs = [];\r\n    var crawler_timeout = new Watchdog(xhr_timeout, 30000);\r\n    var health_indicator = {shift:function(){return {report:function(){}};}}; // initial dummy indicator for 8chan, see tag.generate_caller, (and uip_tracker)\r\n    function dispatch_if_idle(){\r\n      if (!crawler_spawn.id) dispatch();\r\n    }\r\n    function dispatch(xhr, req_from){\r\n//      var req = queue_get(reqs);\r\n//      var i=0;\r\n//      while (req && req.ERR_5xx && req_from!==req) req = reqs[++i];\r\n//      if (!pause && req && (xhrs_count<pref.scan.crawler || req.priority>=8)) {\r\n      if (!pause) for (var p=8;p>=0;p--) if (reqs[p] && (xhrs_count<pref.scan.crawler || p==8)) {\r\n        while (reqs[p][0] && reqs[p][0].tgts.length===0) reqs[p].shift();\r\n        var req = reqs[p][0];\r\n        var i=0;\r\n        while (req && req.ERR_5xx && req_from!==req) req = reqs[p][++i];\r\n        if (!req) continue;\r\n        if (!req.INDICATOR) {\r\n          req.INDICATOR = (req.indicator || health_indicator).shift('limegreen', req.initiator[0], req.initiator, p);\r\n          req.INDICATOR.report({start:Date.now(), prog:req}); // make reference loop.\r\n          req.IDX = 0;\r\n          req.RUNNING = 0;\r\n          req.SUC = 0;\r\n          if (!req.max) req.max = req.tgts.length;\r\n        }\r\n        var req_1 = (req.ABORT)? null : (req.get_tgt_func)? req.get_tgt_func(req) : {REQ:req, __proto__:req.tgts[req.IDX++]};\r\n        if (req.IDX>=req.max || !req_1 && req.ABORT) reload_reqs(req,p);\r\n//        if (req.IDX>=req.max) reload_reqs(req,p);\r\n        xhrs_count++; // THIS CAN BE A SINK AND CAUSE DEADLOCK WHEN OVER X_FRAME_OPTIONS.\r\n//        xhrs_count_by_domain[req_1.domain] = (xhrs_count_by_domain[req_1.domain] || 0) + 1;\r\n        req.RUNNING++;\r\n        if (req_1) {\r\n          req.INDICATOR.report({tgt:req_1.tgt || url2tgt(req_1.url)});\r\n          if (req_1.domain===site.nickname && !req_1.domain_xhr || pref.network.cross_domain!=='indirect') download_local(xhr, req_1);\r\n          else {\r\n            if (xhr) xhrs_free[xhrs_free.length] = xhr;\r\n            download_remote(req_1);\r\n          }\r\n          if (pref.scan.crawler_adaptive) crawler_spawn.restart(pref.scan.crawler_idle_time_to_spawn);\r\n          else if (xhrs_count<pref.scan.crawler) dispatch();\r\n        } else {\r\n//          if (!(req.IDX<req.max && (req.refresh || req.found_threads<req.max_threads))) {\r\n//            reload_reqs(req,p);\r\n//            req.FINISHED += req.max - req.IDX;\r\n//            req.IDX = req.max;\r\n//          }\r\n          setTimeout(function(){xhr_onload_1({type:'SKIPPED_TO_END'}, xhr, {REQ:req}, true, {date:Date.now(), status:200});},0);\r\n        }\r\n        return;\r\n      }\r\n      if (crawler_spawn.id) crawler_spawn.stop();\r\n      if (xhr) xhrs_free[xhrs_free.length] = xhr;\r\n    }\r\n    function url2tgt(url){return url.substr(url.lastIndexOf('/')+1);}\r\n    function reload_reqs(req,p){\r\n      if (reqs[p] && reqs[p].length>1) reqs[p].shift();\r\n      else reqs[p] = null;\r\n      reqs_waiting_finish[reqs_waiting_finish.length] = req;\r\n    }\r\n    function download_remote(req){ // , prep_only){\r\n      var domain = req.domain_xhr || req.domain;\r\n      if (!iframes[domain]) {\r\n        var func_timeout = function(req_in){xhr_onload_1({type:'SKIPPED'}, undefined, req_in || req, false, {date:Date.now(), status:499});};\r\n        if (iframes[domain]===undefined) {\r\n          cnst.make_iframe(domain);\r\n          iframes[domain] = window.open(site2[domain] && site2[domain].home || req.url, domain);\r\n          send_message(domain,['HTTPD',['SUB_FRAME_INIT']],iframes[domain]);\r\n          iframes_timeout[domain] = [setTimeout(function(){\r\n            iframes[domain] = false;\r\n            iframes_timeout[domain].slice(1).forEach(function(v){func_timeout(v)});\r\n            delete iframes_timeout[domain];\r\n          }, pref.network.timeout*1000)];\r\n        } else if (iframes[domain]===false) {setTimeout(func_timeout,0); return;}\r\n      }\r\n      remote_opened[domain] = null;\r\n//      if (prep_only) return;\r\n      remote_reqs[remote_count] = req;\r\n      if (!req.archive) req.responseType = 'text';\r\n      send_message(domain,['HTTPD',['SUB_GET',[{ID:remote_count++, url:req.url, responseType:req.responseType, domain:req.domain,\r\n                                                board:req.board, no:req.no, key:req.key, archive:req.archive,\r\n                                                to_file:req.to_file, to_idb:req.to_idb, kind:req.kind, timestamp:req.timestamp,// for archive\r\n                                                domain_xhr:req.domain_xhr,\r\n                                               }]]]);\r\n      if (iframes_timeout[domain]) iframes_timeout[domain].push(req); \r\n    }\r\n    function sub_frame_init_ack(args){\r\n      clearTimeout(iframes_timeout[args[0]][0]);\r\n      delete iframes_timeout[args[0]];\r\n    }\r\n    function sub_get(args){\r\n      download_local(undefined,args[0]);\r\n    }\r\n    var GM_XMLHttpRequestWrapper = function(){\r\n      this.onload  = this.onload.bind(this);\r\n      this.onerror = this.onerror.bind(this);\r\n      this.onabort = this.onabort.bind(this);\r\n    };\r\n    GM_XMLHttpRequestWrapper.prototype = {\r\n      open: function(method, url){\r\n        this.method = method;\r\n        this.url = url;\r\n      },\r\n      send: function(){\r\n        this.response = null;\r\n        GM_xmlhttpRequest(this);\r\n      },\r\n      onload: function(e){\r\n        this.response = e.response;\r\n        if (!this.response) // GM has 'response', this is for emulation.\r\n          this.response = (this.responseType==='document')? new DOMParser().parseFromString(e.responseText, 'text/xml')\r\n                        : (this.responseType==='json')? JSON.parse(e.responseText)\r\n//                   : (this.responseType==='arraybuffer')? new DOMParser().parseFromString(e.responseText, 'text/xml')\r\n//                   : (this.responseType==='blob')? new DOMParser().parseFromString(e.responseText, 'text/xml')\r\n                        : e.responseText;\r\n// GM has 'arraybuffer' from 3.2, // http://www.greasespot.net/2015/05/greasemonkey-32-release.html\r\n// TM has 'arraybuffer' from ? // https://github.com/Tampermonkey/tampermonkey/issues/279\r\n//        if (this.responseType==='arraybuffer') console.log(this.url+', '+this.response.byteLength);\r\n        this.onXXX('load', e, xhr_onload);\r\n      },\r\n      onerror: function(e){this.onXXX('error',e, xhr_onload);},\r\n      onabort: function(e){this.onXXX('abort',e, xhr_onload);},\r\n      onXXX: function(type, result, callback){\r\n        this.type = type;\r\n        this.result = result;\r\n        callback(this);\r\n      },\r\n      onXXX_factory: function(type, func){\r\n        return function(result){this.onXXX(type, result, func);}.bind(this);\r\n      },\r\n      set onreadystatechange(v){this._onreadystatechange = (v)? this.onXXX_factory('readystatechange',v) : v;},\r\n      get onreadystatechange(){return this._onreadystatechange || this.dummy_func;},\r\n      set onprogress(v){this._onprogress = (v)? this.onXXX_factory('progress',v) : v;},\r\n      get onprogress(){return this._onprogress || this.dummy_func;},\r\n      dummy_func: function(){}, // for chrome emulation, it uses existence of property, not a value.\r\n      get status(){return this.result && this.result.status || 1404;},\r\n      get responseText(){return this.result.responseText;},\r\n      get target(){return this;},\r\n      result: null,\r\n    };\r\n    function download_local(xhr, req){\r\n      if (!xhr) { \r\n        if (xhrs_free.length>0) xhr = xhrs_free.pop();\r\n        else {\r\n          if (pref.network.cross_domain==='GM') xhr = new GM_XMLHttpRequestWrapper();\r\n          else {\r\n            xhr = new XMLHttpRequest();\r\n            xhr.onload  = xhr_onload;\r\n            xhr.onerror = xhr_onload;\r\n            xhr.onabort = xhr_onload;\r\n          }\r\n        }\r\n      }\r\n      xhrs.set(xhr, req);\r\n      xhr.open('GET', req.url);\r\n      xhr.responseType = req.responseType;\r\n      if (pref.test_mode['186'] && req.tgt.indexOf('/news24/')>=0) xhr.overrideMimeType('application/xml');\r\n      xhr.send();\r\n      xhr_timeout_start(xhr,Date.now(),req);\r\n    }\r\n    function xhr_timeout_start(xhr,date,req){\r\n      req.TIMEOUT = ((req.TIMEOUT)? req.TIMEOUT : date) + pref.network.timeout*1000;\r\n      xhrs_reqs[xhrs_reqs.length] = xhr;\r\n      if (xhrs_reqs.length===1) crawler_timeout.restart(pref.network.timeout*1000);\r\n    }\r\n    function xhr_timeout_restart(xhr,date){\r\n      var idx = xhrs_reqs.indexOf(xhr);\r\n      if (idx<0) return true; // timeouted.\r\n      xhrs_reqs.splice(idx,1);\r\n      if (idx===0) {\r\n        if (xhrs_reqs.length>0) {\r\n          var timeout = xhrs.get(xhrs_reqs[0]).TIMEOUT - date;\r\n          if (timeout>0) crawler_timeout.restart(timeout);\r\n          else xhr_timeout();\r\n        } else crawler_timeout.stop();\r\n      }\r\n    }\r\n    function xhr_timeout(){\r\n      var xhr = xhrs_reqs[0];\r\n      if (pref.debug_mode['25']) console.log('xhr_timeout: '+xhr.readyState+', '+xhr.responseURL);\r\n      if (!xhr.onreadystatechange) {\r\n        xhr.onreadystatechange = xhr_onreadystatechange;\r\n        xhr.onprogress = xhr_onreadystatechange;\r\n        xhr_onreadystatechange({target:xhr});\r\n      } else xhr_onload({target:xhr, type:'TIMEOUT'});\r\n    }\r\n    function xhr_onreadystatechange(e){\r\n      var xhr = e.target;\r\n      var req = xhrs.get(xhr);\r\n      if (pref.debug_mode['25']) console.log('xhr_onreadystatechange: '+req.url+((e.type==='progress')? ': '+e.loaded+'/'+e.total:''));\r\n      if (e.type==='progress') e.target.onreadystatechange = null;\r\n      var date = Date.now();\r\n      xhr_timeout_restart(xhr,date);\r\n      xhr_timeout_start(xhr,date,req);\r\n    }\r\n    function xhr_onload(e){\r\n      var xhr = e.target;\r\n      var date = Date.now();\r\n      if (xhr_timeout_restart(xhr,date)) return; // timeouted.\r\n      xhr.onreadystatechange = null;\r\n      xhr.onprogress = null;\r\n      var req = xhrs.get(xhr);\r\n      var valid = xhr.status===200 || xhr.status===304;\r\n      var value = (xhr.responseType==='text')? {date: date, status: xhr.status, responseText: (valid)? xhr.responseText: null} :\r\n                                               {date: date, status: xhr.status, response:     (valid)? xhr.response    : null};\r\n      xhr_onload_1(e, xhr, req, valid, value);\r\n    }\r\n    function xhr_onload_1(e, xhr, req, valid, value){ // CACHE HIT ENTRY HERE\r\n      if (local) {\r\n        xhrs_count--;\r\n//        xhrs_count_by_domain[req.domain]--;\r\n        var end = --req.REQ.RUNNING === 0 && (req.REQ.IDX >= req.REQ.max || req.ABORT);\r\n//        var end = ++req.REQ.FINISHED === req.REQ.IDX && req.REQ.IDX >= req.REQ.max;\r\n        dispatch(xhr, (value.status<500)? req : null);\r\n        if (end) end_proc_httpd(req.REQ);\r\n        // CACHE WRITE CODE HERE\r\n        if (valid) {\r\n          req.REQ.SUC++;\r\n          onload_local(req, value);\r\n        } else {\r\n          if (value.status>=500 && !req.REQ.ERR_5xx) req.REQ.ERR_5xx = setTimeout(\r\n            (function(req){\r\n              return function(){\r\n                delete req.ERR_5xx;\r\n                dispatch_if_idle();\r\n              }})(req.REQ),30000);\r\n          req.REQ.INDICATOR.report({err_str:(req.tgt||url2tgt(req.url))+'('+value.status+((e.type!=='load')? ':'+e.type : '')+')'});\r\n          if (req.REQ.callback_1_fail) req.REQ.callback_1_fail(req, value, req.REQ);\r\n        }\r\n        if (end) end_proc_user(req.REQ, value.date);\r\n        req.REQ = null; // cut reference loop for GC.\r\n      } else {\r\n        send_message('parent',['HTTPD',['SUB_ACK',[req.ID, {type:(req.archive)? 'ARCHIVE' : e.type}, valid, (req.archive)? {date:value.date, status:value.status, responseText:'', response:{}} : value]]]);\r\n        xhrs_free[xhrs_free.length] = xhr;\r\n        if (valid && req.archive) onload_archive(req, value);\r\n      }\r\n    }\r\n    function sub_ack(args){\r\n      var req = remote_reqs[args[0]];\r\n      delete remote_reqs[args[0]];\r\n      xhr_onload_1(args[1], undefined, req, args[2], args[3]);\r\n    }\r\n    function end_proc_httpd(req){ // called local only\r\n      reqs_waiting_finish.splice(reqs_waiting_finish.indexOf(req),1);\r\n      if (req.archive) req.TAR_FLUSH = remote_opened;\r\n      free_xhrs();\r\n    }\r\n    function free_xhrs(){\r\n      if (xhrs_count===0) {\r\n        xhrs.clear();\r\n        if (local) for (var domain in remote_opened) send_message(domain,['HTTPD',['SUB_FREE']]);\r\n        remote_count = 0;\r\n        remote_opened = {};\r\n      } else for (var i=0;i<xhrs_free.length;i++) xhrs.delete(xhrs_free[i]);\r\n      xhrs_free = [];\r\n    }\r\n    function onload_local(req,value) {\r\n      if (req.responseType==='text') {\r\n        if (pref.test_mode['154'] && req.data_type==='html' && site2[req.domain].HTMLParser) { // DOMParser causes massive leak particular in BBC, see https://stackoverflow.com/questions/56451731/dom-parser-chrome-extension-memory-leak\r\n          value.response = new site2[req.domain].HTMLParser(value.responseText);\r\n//          for (var i=0;i<100;i++) value.response = new DOMParser().parseFromString(value.responseText, 'text/'+req.data_type); // for test\r\n        } else if (pref.test_mode['154'] && req.data_type==='xml' && site2[req.domain].XMLParser) {\r\n          value.response = site2[req.domain].XMLParser(value.responseText);\r\n        } else if (req.data_type==='html' || req.data_type==='xml') value.response = new DOMParser().parseFromString(value.responseText, 'text/'+req.data_type); // causes massive leak on chrome50\r\n        else if (req.data_type==='json') {\r\n          if (brwsr.ff) value = Object.create(value); // avoid error in FF, Error: Not allowed to define cross-origin object as property on [Object] or [Array] XrayWrapper\r\n          value.response = JSON.parse(value.responseText);\r\n        }\r\n      }\r\n      req.REQ.callback_1(req, value, req.REQ);\r\n//        req.REQ.callback(req.key, value, req.callback_arg);\r\n      if (req.responseType==='text' && req.data_type==='html') value.response = null; // doesn't effect at all.\r\n    }\r\n    function onload_archive(req, value){\r\n      if (typeof(req.archive)==='string') {\r\n        archiver.download_url4(value.response, req.archive);\r\n        return;\r\n      }\r\n      if (req.from && local) delete archiver.list_all_obj_downloading[req.from];\r\n      var ignore_domain = pref.network.cross_domain!=='indirect';\r\n      if (req.domain===site.nickname && (!local || !req.domain_xhr) || ignore_domain) {\r\n//      if ((req.domain_xhr||req.domain)===site.nickname || ignore_domain) {\r\n        var suffix = req.kind + '_'+ req.url.replace(/.*\\//g,'');\r\n        if (req.to_file) archiver.download_url3(value.response, req, suffix, req.timestamp);\r\n        if (req.to_idb) if (!pref.test_mode['65']) IDB.req(req.domain, req.board, req.no, suffix, value.response, 'put');\r\n      }\r\n      if (local && req.REQ.TAR_FLUSH) { // remote doesn't have 'req.REQ'\r\n//        if (check_timestamp_and_flush(req.timestamp)) // flush local\r\n        archiver.tar.flush((xhrs_count===0)? undefined : req.timestamp);\r\n        for (var domain in req.REQ.TAR_FLUSH) send_message(domain,['HTTPD',['SUB_TAR_FLUSH',[(xhrs_count===0)? undefined : req.timestamp]]]); // flush remote\r\n      }\r\n    }\r\n    function onload_archive_fail(req, value){\r\n      if (req.from) delete archiver.list_all_obj_downloading[req.from]; // patch, retry code should be here.\r\n    }\r\n    function check_timestamp_and_flush(timestamp){\r\n      if (reqs[0] && reqs[0][0] && reqs[0][0].timestamp === timestamp && reqs[0][0].tgts.length>0) return false;\r\n//      if (reqs[0] && reqs[0][0] && reqs[0][0].timestamp === timestamp) return false;\r\n      for (var i=0;i<reqs_waiting_finish.length;i++) if (reqs_waiting_finish[i].timestamp===timestamp) return false;\r\n      archiver.tar.flush((xhrs_count===0)? undefined : timestamp);\r\n      return true;\r\n    }\r\n    function end_proc_user(req, date){\r\n      if (req.callback) req.callback(req); // this must be prior to report({end:}), because somefunc reports err_str to indicator.\r\n      req.INDICATOR.report({end:date});\r\n    }\r\n    function sub_tar_flush(args){\r\n      archiver.tar.flush(args[0]);\r\n    }\r\n    function sub_frame_init(){\r\n      local=false;\r\n      send_message('parent',['HTTPD',['SUB_FRAME_INIT_ACK', [window.name]]]);\r\n    }\r\n    function pause_cancel(){\r\n      if (pause>0) {\r\n        if (--pause>0) pause_timeout.delayed_do();\r\n      } else {\r\n        pause_timeout.cancel();\r\n        dispatch_if_idle();\r\n      }\r\n    }\r\n    var pause_timeout = new DelayBuffer(pause_cancel,10000);\r\n    var sub_funcs = {SUB_GET:sub_get, SUB_ACK:sub_ack, SUB_FREE:free_xhrs, SUB_TAR_FLUSH:sub_tar_flush, SUB_FRAME_INIT:sub_frame_init, SUB_FRAME_INIT_ACK:sub_frame_init_ack};\r\n    return {\r\n      req: function(reqs_in, priority){\r\n        if (!reqs[priority]) reqs[priority] = [reqs_in];\r\n        else reqs[priority].push(reqs_in);\r\n        if (reqs_in.tgts.length!==0) dispatch();\r\n      },\r\n      req_add: function(reqs_in, priority){\r\n        if (!reqs[priority] || reqs[priority].length===0) reqs[priority] = [reqs_in]; // BUG, destroy prototype.\r\n        else reqs[priority][reqs[priority].length-1].tgts = reqs[priority][reqs[priority].length-1].tgts.concat(reqs_in.tgts);\r\n        dispatch_if_idle();\r\n      },\r\n      check_timestamp_and_flush: check_timestamp_and_flush,\r\n      onload_archive: onload_archive,\r\n      onload_archive_fail: onload_archive_fail,\r\n      sub_funcs: function(args){\r\n        sub_funcs[args[0]](args[1]);\r\n      },\r\n      pause_req: function(){\r\n        pause++;\r\n        pause_timeout.delayed_do();\r\n      },\r\n      pause_cancel: pause_cancel,\r\n      set_health_indicator: function(val){health_indicator = val;},\r\n      get isLocal(){return local;},\r\n//      prep_iframe: function(domain){download_remote({domain_xhr:domain},true);},\r\n      req_serial: function(reqs_in, priority){ // not implemented yet\r\n        this.req(reqs_in, priority);\r\n      }\r\n    };\r\n  })();\r\n\r\n  if (site0.isStep && pref.test_mode['142']) return;\r\n  \r\n  var http_req = { // emulation of old interface for uip tracker.\r\n    get: function (sender,key,url,callback,sw_cache,sw_cache_write,callback_arg, archived){\r\n      var dbt = (key.indexOf(',')==-1)? common_func.name2dbt(key): key.split(',');\r\n      if (url==='') url = site2[dbt[0]].make_url4(dbt);\r\n      else if (typeof(url)==='string') url = [ url, 'raw'];\r\n      key = dbt.join(',');\r\n      httpd.req({initiator:sender||key,\r\n                 tgts:[{url:url[0], responseType:(url[1]==='html')? 'document' : (url[1]==='raw')? 'text' : url[1], tgt:key, data_type:url[1], domain:dbt[0]}],\r\n                 callback_1:function(req,val){callback(key,val,callback_arg);},\r\n//                 INDICATOR: {shift:function(){}, report:function(){}},\r\n//                 IDX:0, RUNNING:0, SUC:0, max:1,\r\n                },6);\r\n    },\r\n  };\r\n\r\n////  var http_req = (function(){ // working code.\r\n////    var iframes = {};\r\n//////    var caches = {}; // prevent occuring multiple access to the same url in short time.\r\n////    var local = true;\r\n////    var parser = new DOMParser();\r\n////    var serializer = new XMLSerializer();\r\n//////    var doc;\r\n//////    var pool; // object pool\r\n////    var reqs = {};\r\n////    var Req = function(sender){\r\n////      this.sender = sender;\r\n////      this.req = null;\r\n////      this.httpd = new XMLHttpRequest();\r\n////      this.httpd.onload  = Req.prototype.onload.bind(this);\r\n////      this.httpd.onerror = this.httpd.onload;\r\n////      this.httpd.onabort = this.httpd.onload;\r\n////    }\r\n////    Req.prototype.onload = function(){\r\n//////      if (local) onload_local(this.sender,{date: Date.now(), __proto__:this.httpd},false); // cause illegal invocation, I don't know why.\r\n////      if (local) {\r\n////        if (this.httpd.responseType==='text') onload_text(this.sender,{date: Date.now(), status: this.httpd.status, responseText: this.httpd.responseText},false); // temporaly patch.\r\n////        else onload_local(this.sender,{date: Date.now(), status: this.httpd.status, response: this.httpd.response},false);\r\n////      } else send_message('parent',[['SUB_ACK',[this.sender,Date.now(),this.httpd.status,this.httpd.responseText]]]);\r\n////    };\r\n////    function get_make_Req(sender, req){\r\n////      if (reqs[sender]===undefined) reqs[sender] = new Req(sender);\r\n////      if (req) reqs[sender].req = req;\r\n////      return reqs[sender];\r\n////    }\r\n////    function destroy_httpd(sender){\r\n////      delete reqs[sender];\r\n////    }\r\n////////    function make_httpd(sender){ // working code.\r\n////////      var httpd = new XMLHttpRequest();\r\n////////      function httpd_events(){\r\n//////////        if (local) onload_local(sender,{date: Date.now(), status: httpd.status, responseText: httpd.responseText},false);\r\n////////        if (local) {\r\n////////          if (httpd.responseType==='text') onload_local(sender,{date: Date.now(), status: httpd.status, responseText: httpd.responseText},false); // temporaly patch.\r\n////////          else onload_local(sender,{date: Date.now(), status: httpd.status, response: httpd.response},false);\r\n////////        } else send_message('parent',[['SUB_ACK',[sender,Date.now(),httpd.status,httpd.responseText]]]);\r\n////////      }\r\n////////      httpd.addEventListener('load',  httpd_events, false);\r\n////////      httpd.addEventListener('error', httpd_events, false);\r\n////////      httpd.addEventListener('abort', httpd_events, false);\r\n////////      httpds[sender] = [httpd, httpd_events];\r\n////////    }\r\n////////    function destroy_httpd(sender){\r\n////////      if (sender in httpds) {\r\n////////        var httpd = httpds[sender][0];\r\n////////        var httpd_events = httpds[sender][1];\r\n////////        httpd.removeEventListener('load',  httpd_events, false);\r\n////////        httpd.removeEventListener('error', httpd_events, false);\r\n////////        httpd.removeEventListener('abort', httpd_events, false);\r\n////////        delete httpds[sender];\r\n//////////if (pref.test_mode['30']) console.log('destroyed: '+site.nickname+'/'+sender)\r\n////////      }\r\n////////    }\r\n////    function make_iframe(domain,url){\r\n//////      var ifrm = cnst.init('left:200px:bottom:200px:display:none:Show'); // working code.\r\n////////      var ifrm = cnst.init('left:200px:bottom:200px:' + ((pref.debug_mode['0'])? '' : 'display:none:') + 'Show');\r\n////////      var ifrm = cnst.init('left:200px:bottom:200px:Show');\r\n//////      ifrm.innerHTML = '<iframe name=' + domain + '></iframe>';\r\n////      cnst.make_iframe(domain);\r\n//////      try {\r\n////        iframes[domain] = window.open((site2[domain].home!=='')? site2[domain].home : url, domain);\r\n////        send_message(domain,[['SUBFRAME_INIT']],iframes[domain]);\r\n//////      } catch (e) {\r\n//////        console.log('IFRAME OPEN ERROR'); // not debugged yet.\r\n//////      }\r\n//////      iframes[domain].onerror = function(){console.log('IFRAME OPEN ERROR');}; // can't catch\r\n////    }\r\n////    function onload_from_sw_cache_check(key,value,args) {\r\n////      if (value!==null) {\r\n//////        var date = value[0];\r\n//////        var req_date = Date.now() - args[4]*1000;\r\n//////        if (date>req_date) {onload_from_sw_cache(key,value,args);return;}\r\n////        if (args[4]===true || value.date > Date.now() - args[4]*1000) {onload_text(args[0],value,true);return;} // date check.\r\n////      }\r\n////      get_req(args[0],args[1],args[2],args[3],false,args[5]);\r\n////    }\r\n////    function onload_text(sender,value,from_cache) {\r\n////      if (reqs[sender]) { // for 8chan's 524 error(Origin Time-out)\r\n////        if (reqs[sender].req.data_type==='html') {\r\n////          value.response = parser.parseFromString(value.responseText, 'text/html');\r\n//////          delete value.responseText;\r\n////        } else if (reqs[sender].req.data_type==='json') {\r\n////          value.response = (value.status==200)? JSON.parse(value.responseText) : value.responseText;\r\n////        }\r\n////        onload_local(sender,value,from_cache);\r\n////      }\r\n//////      value.response = null;\r\n////    }\r\n////    function onload_local(sender,value,from_cache) {\r\n////      if (!reqs[sender]) return;\r\n////      var req = reqs[sender].req;\r\n//////      if (!from_cache && data_type==='html') {\r\n//////        doc = parser.parseFromString(value.responseText, 'text/html');\r\n//////        site2.common.remove_by_tagname(doc,'script');\r\n//////        doc.getElementsByTagName('head')[0].innerHTML = '';\r\n////////        value = {date:value.date, status:value.status, responseText:serializer.serializeToString(doc)};\r\n//////      }\r\n//////      if (!from_cache && cache_write) {\r\n////////        caches[key] = [date, value.status, response_txt];\r\n////////        setTimeout(function(){delete caches[key];},10000);\r\n////////        if (pref.info_server && brwsr.sw_cache && value.status==200) brwsr.sw_cache.setItem(key,[date, response_txt]);\r\n////////        if (pref.info_server && brwsr.sw_cache && value.status==200) brwsr.sw_cache.setItem(key,[date, value.status, response_txt]);\r\n//////        if (pref.info_server && brwsr.sw_cache && value.status==200) {\r\n//////          if (data_type==='html') value = {date:value.date, status:value.status, responseText:serializer.serializeToString(doc)};\r\n//////          brwsr.sw_cache.setItem(key,value);\r\n//////        }\r\n//////      }\r\n//////      if (data_type==='html') {value.response = doc; delete value.responseText;} // trial patch.\r\n//////      else if (data_type==='json') {value.response = JSON.parse(value.responseText); delete value.responseText;}\r\n//////      callback(key, value, callback_arg);\r\n////\r\n////      if (!from_cache && req.data_type==='html' && value.response) {\r\n//////        site2.common.remove_by_tagname(value.response,'script');\r\n//////        var dbt = common_func.name2domainboardthread(key,true);\r\n////        var dbt = req.key.split(',');\r\n////if (pref.test_mode['28']) {\r\n////        site2[dbt[0]].preprocess_doc(value.response);\r\n////}\r\n////if (pref.test_mode['50'] && site2[dbt[0]].preprocess_doc2 && site2[dbt[0]].preprocess_doc2[dbt[3]]) site2[dbt[0]].preprocess_doc2[dbt[3]](value.response);\r\n////if (pref.test_mode['4']) {\r\n////  site2[dbt[0]].remove_posts(value.response,pref.test_mode.num);\r\n////  site2.common.remove_double_br(value.response);\r\n////}\r\n////        if (value.response.getElementsByTagName('head')[0]) value.response.getElementsByTagName('head')[0].innerHTML = '';\r\n////      }\r\n//////var check_perf = ['http_req :', performance.now()];\r\n////      if (!from_cache && req.cache_write) {\r\n////        if (pref.info_server && brwsr.sw_cache && value.status==200) {\r\n////          if (req.data_type==='html') site2.common.remove_by_tagname(value.response,'script');\r\n////          var value_sw_cache = (req.data_type==='html')? {date:value.date, status:value.status, responseText:serializer.serializeToString(value.response)}\r\n////                                                       : {date:value.date, status:value.status, responseText:JSON.stringify(value.response)};\r\n//////check_perf.push(performance.now());\r\n////          brwsr.sw_cache.setItem(req.key,value_sw_cache);\r\n//////check_perf.push(performance.now());\r\n////        }\r\n////      }\r\n////// https://github.com/rtomayko/rack-cache/issues/111 Cache hit gives 200 instead of 304 when behind Nginx, Nginx + StringEtag + chrome.\r\n////if (pref.test_mode['48'] && value.status===304) console.log('onload_local: 304, '+req.key);\r\n////      req.callback(req.key, value, req.callback_arg);\r\n//////if (sender==='catalog') common_func.perf_out(check_perf);\r\n////    }\r\n////    function get_req(sender,domain,url,key,sw_cache,data_type, archived){\r\n//////      if (caches[key]) setTimeout(function(){onload_local(sender,{date: caches[key][0], status: caches[key][1], responseText: caches[key][2]},true);},0); // this make racing condition at checking page in catalog.\r\n////      if ((sw_cache===true || (typeof(sw_cache)==='number' && sw_cache!=0)) && brwsr.sw_cache)\r\n////        brwsr.sw_cache.trygetItem(key,onload_from_sw_cache_check,[sender,domain,url,key,sw_cache,data_type]);\r\n////      else {\r\n////        if (domain==site.nickname || pref.catalog_cross_domain_connection=='direct') {\r\n////          var httpd = get_make_Req(sender).httpd;\r\n////          httpd.open('GET', url, true);\r\n////          httpd.responseType = (archived)? 'text' : (data_type==='html')? 'document' : (data_type==='json')? 'json' : 'text';\r\n////          httpd.send(null);\r\n////        } else {\r\n////          if (!iframes[domain]) make_iframe(domain,url);\r\n////          send_message(domain,[['SUB_GET',[sender,domain,url,key,sw_cache,'text']]]);\r\n////        }\r\n////      }\r\n////    }\r\n////    return {\r\n////      get: function (sender,key,url,callback,sw_cache,sw_cache_write,callback_arg, archived){\r\n////        var dbt = (key.indexOf(',')==-1)? common_func.name2dbt(key): key.split(',');\r\n////        if (url==='') url = site2[dbt[0]].make_url4(dbt);\r\n////        else if (typeof(url)==='string') url = [ url, 'raw'];\r\n////        key = dbt.join(',');\r\n////        get_make_Req(sender, {url:url[0], callback:callback, key:key, sw_cache:sw_cache, sw_cache_write:sw_cache_write, callback_arg:callback_arg, data_type:url[1]});\r\n////        get_req(sender,dbt[0],url[0],key,sw_cache,url[1], archived);\r\n////      },\r\n////////////      get: function (sender,key,url,callback,sw_cache,sw_cache_write,callback_arg){ // working code.\r\n////////////        var dbt = cnst.name2domainboardthread(key,true);\r\n////////////        key = dbt[0]+dbt[1]+dbt[2];\r\n////////////        if (url==='')\r\n////////////          if (dbt[2][0]==='c' || dbt[2][0]==='p' || dbt[2][0]==='j') url = site2[dbt[0]].make_url(dbt[1],parseInt(dbt[2].substr(1),10),dbt[2][0]);\r\n////////////          else url = [site2[dbt[0]].make_url3(dbt[1],dbt[2]), (dbt[2][0]!=='t')? 'html' : 'json'];\r\n////////////        if (typeof(url)==='string') url = [ url, 'raw'];\r\n////////////        req[sender] = {url:url[0], callback:callback, key:key, sw_cache:sw_cache, sw_cache_write:sw_cache_write, callback_arg:callback_arg, data_type:url[1]};\r\n////////////        get_req(sender,dbt[0],url[0],key,sw_cache,url[1]);\r\n////////////      },\r\n////      close:   function(sender){\r\n////        destroy_httpd(sender);\r\n////        if (!pref.test_mode['30']) for (var domain in iframes) send_message(domain,[['SUB_DEST',[sender]]]);\r\n////      },\r\n////      sub_dest: function(args){destroy_httpd(args[0]);},\r\n////      sub_get: function(arg){get_req(arg[0],arg[1],arg[2],arg[3],arg[4],arg[5]);},\r\n////      sub_ack: function(arg){\r\n////        var value =  {date: arg[1], status: arg[2], responseText: arg[3]};\r\n////        onload_text(arg[0], value, false);\r\n////if (pref.test_mode['34']) send_message('meguca',[['ECHO',arg]]);\r\n////      },\r\n////      remote : function(){local=false;}\r\n////    };\r\n////  })();\r\n\r\n//  var http_req = (function(){ // working code, but chokes when and err occur.\r\n//    var reqs = [];\r\n//    var caches = {}; // prevent occuring multiple access to the same url in short time.\r\n//    var httpd = new XMLHttpRequest();\r\n//    var httpd_events = function(){onload_local(httpd.status,httpd.responseText);}; // for local\r\n//    httpd.addEventListener('load',  httpd_events, false);\r\n//    httpd.addEventListener('error', httpd_events, false);\r\n//    httpd.addEventListener('abort', httpd_events, false);\r\n//    \r\n//    function onload_local(status,response_txt) {\r\n//      var req = reqs[0];\r\n//\r\n//      if (req[1]!=null) req[1](status, response_txt);\r\n//        if (pref.info_server && brwsr.sw_cache)\r\n//          brwsr.sw_cache.setItem(req[2]+req[3]+req[4],JSON.stringify([Date.now(), response_txt]));\r\n//\r\n//      prep_next();\r\n//    }\r\n//    function prep_next() {\r\n//      reqs.shift();\r\n//      if (reqs.length!=0) req_get(true); // javascript doesn't allow multiphe threads in a program, so this works well.\r\n//    }\r\n//    function req_get(force) {\r\n//      if (!force && reqs.length>=2) return;\r\n//      var url = reqs[0][0];\r\n//      if (reqs[0][2]==site.nickname || pref.catalog_cross_domain_connection=='direct') {\r\n//        httpd.open('GET', url, true);\r\n//        httpd.send(null);\r\n//      } else {\r\n//        var domain = reqs[0][2];\r\n//        if (!iframes[domain]) {\r\n////          iframes[domain] = [window.open(url,domain), 0];\r\n////          var ifrm = cnst.init('left:300px:bottom:300px:Show');\r\n//          var ifrm = cnst.init('left:300px:bottom:300px:display:none:Show');\r\n//          ifrm.innerHTML = '<iframe name=' + domain + '></iframe>';\r\n//          iframes[domain] = [window.open(url,domain), 0];\r\n//          send_message(domain,[['SUBFRAME_INIT']]);\r\n//        }\r\n//        send_message(domain,[['SUB_GET',reqs[0]]]);\r\n//        iframes[domain][1]++;\r\n//      }\r\n//    }\r\n//    return {\r\n//      get: function(url,callback,domain,board,page,sw_cache,sender){\r\n//        reqs.push([url,callback,domain,board,page,sw_cache,sender]);\r\n//        req_get(false);\r\n//      },\r\n//      remote: function(){\r\n//        httpd.removeEventListener('load',  httpd_events, false);\r\n//        httpd.removeEventListener('error', httpd_events, false);\r\n//        httpd.removeEventListener('abort', httpd_events, false);\r\n//        httpd_events = function(){\r\n//          send_message('parent',[['SUB_ACK',httpd.status, httpd.responseText]]);\r\n//          prep_next();\r\n//        };\r\n//        httpd.addEventListener('load',  httpd_events, false);\r\n//        httpd.addEventListener('error', httpd_events, false);\r\n//        httpd.addEventListener('abort', httpd_events, false);\r\n//      },\r\n//      onload_local: onload_local\r\n//    };\r\n//  })();\r\n\r\n  var cnst = (function(){\r\n    var TbInfoStore = new WeakMap();\r\n    var tb_funcs = {\r\n      INHERITED: 'tb_funcs',\r\n      op_p: function(e){\r\n        var s = e.currentTarget.parentNode.style;\r\n        var op = parseFloat(s.opacity) || 1;\r\n        s.opacity = (e.target.name==='op_p')? ((op+0.1>=1)? 1 : op+0.1)\r\n                                            : ((op-0.1<=0.1)? 0.1: op-0.1);\r\n      },\r\n      roll_toggle: function(e, options){\r\n        if (options.tb.classList.contains(pref.script_prefix+'_autoTp')) {\r\n          options.cn.style.height = !parseInt(options.cn.style.height,10)? options.tb.offsetHeight + 'px' : null; // 'auto'; 'auto' doesn't work for youtibe iframe\r\n        } else {\r\n          if (options.cn.style.display=='none') this.rolldown(options);\r\n          else this.rollup(options);\r\n        }\r\n      },\r\n      roll_if_auto: function(e, from_start, on_tb){\r\n        var options = TbInfoStore.get(e.currentTarget);\r\n        if (!options) return; // for popup\r\n        if (from_start) {\r\n          if (options.auto_roll && options.cn.style.display!=='none' && options.cn.offsetHeight>window.innerHeight) {\r\n            if (!on_tb) {\r\n              options.auto_unroll = [options.cn.parentNode.style.height];\r\n              options.cn.parentNode.style.height = options.cn.parentNode.offsetHeight+'px';\r\n            } else options.auto_unroll = true;\r\n            this.rollup(options);\r\n          }\r\n        } else if (options.auto_unroll && options.cn.style.display==='none') {\r\n          this.rolldown(options);\r\n          if (Array.isArray(options.auto_unroll)) options.cn.parentNode.style.height = options.auto_unroll[0];\r\n          options.auto_unroll = false;\r\n        }\r\n      },\r\n      rolldown: function(tbInfo){\r\n        tbInfo.tb.style.width = '';\r\n        tbInfo.cn.style.display = ''; // for dollchan\r\n        if (tbInfo.onrolldown) tbInfo.onrolldown.call(tbInfo.this_obj);\r\n      },\r\n      rollup: function(tbInfo){\r\n        tbInfo.tb.style.width = tbInfo.tb.offsetWidth + 'px'; // for dollchan\r\n        tbInfo.cn.style.display = 'none'; // for dollchan\r\n        if (tbInfo.onrollup) tbInfo.onrollup.call(tbInfo.this_obj);\r\n      },\r\n      top: function(e, options){\r\n        this.maximize_internal(options.pn, options.tb, options.cn, e.target.name, options, e.target);\r\n      },\r\n//    var state_arr = ['top','bottom','float','max']; // ['top','bottom','max','float']; // changed 2018.03.30, probably a bug.\r\n      maximize_internal: function(pn,tb,cn, req, options, button_pressed){\r\n        var state = options.maximize_state;\r\n        var prev = state.now;\r\n        var cns = (options.maximize_tgt || cn).style; \r\n// if (!pref.test_mode['130']) {\r\n        var pns = pn.style;\r\n        state.btn.style.display = null;\r\n        if (req==='max') state.before_max = {pns:{width:pns.width, height:pns.height}, cns:{width:cns.width, height:cns.height}};\r\n        if (state.now==='max') {\r\n          common_func.overwrite_prop(pns, state.before_max.pns);\r\n          common_func.overwrite_prop(cns, state.before_max.cns);\r\n        } else if (state.now==='float') state.float = {left:pns.left, top:pns.top, right:pns.right, bottom:pns.bottom};\r\n        if (req==='max') {\r\n          var header_height = site.header_height();\r\n          var w = document.documentElement.clientWidth;\r\n          var h = document.documentElement.clientHeight - header_height;\r\n          common_func.overwrite_prop(pns, {left:'0px', top:header_height + 'px', position:'fixed', width:w+'px', height:h+'px', zIndex:pref.style.zIndex, right:null, bottom:null, float:null});\r\n          common_func.overwrite_prop(cns, {width: (w-6)+'px', height: (h-tb.offsetHeight-3)+'px'}); // 6,3 are for margin\r\n        } else if (req==='float'){\r\n          common_func.overwrite_prop(pns, {position:'fixed', float:null, zIndex:pref.style.zIndex, __proto__:state.float});\r\n        } else { // 'top' or 'bottom'\r\n          var ref = site.embed_to[req](); // lazy evaluation\r\n          if (ref){\r\n            common_func.overwrite_prop(pns, {position:'relative', float:'left', zIndex:null, top:null, left:null, right:null, bottom:null});\r\n            ref.parentNode.insertBefore(pn,ref);\r\n          }\r\n        }\r\n        state.now = req;\r\n        state.btn = button_pressed;\r\n//} else {\r\n//        var now = state[0];\r\n//  //      if (options.before_maximize) options.before_maximize(state_str, now);\r\n//        state[5].style.display = null;\r\n//        if (now!=='max') state = [req, pn.style.left, pn.style.top, pn.style.width, pn.style.height, button_pressed, pn.style.right, pn.style.bottom, cns.width, cns.height];\r\n//        else {\r\n//          common_func.overwrite_prop(pn.style, {left:state[1], top:state[2], width:state[3], height:state[4], right:state[6], bottom:state[7]});\r\n//          common_func.overwrite_prop(cns, {width: state[8], height:state[9]});\r\n//          state[0] = req;\r\n//          state[5] = button_pressed;\r\n//        }\r\n//        if (req==='max') {\r\n//          var header_height = site.header_height();\r\n//          var w = document.documentElement.clientWidth;\r\n//          var h = document.documentElement.clientHeight - header_height;\r\n//          common_func.overwrite_prop(pn.style, {left:'0px', top:header_height + 'px', position:'fixed', width:w+'px', height:h+'px', zIndex:pref.style.zIndex});\r\n//          common_func.overwrite_prop(cns, {width: (w-6)+'px', height: (h-tb.offsetHeight-3)+'px'}); // 6,3 are for margin\r\n//        } else if (req==='float'){\r\n//          common_func.overwrite_prop(pn.style, {position:'fixed', zIndex:pref.style.zIndex});\r\n//        } else { // 'top' or 'bottom'\r\n//          var ref = site.embed_to[req](); // lazy evaluation\r\n//          if (ref){\r\n//            common_func.overwrite_prop(pn.style, {position:'static', zIndex:null});\r\n//            ref.parentNode.insertBefore(pn,ref);\r\n//            tb.classList.remove(pref.script_prefix+'_autoTp');\r\n//          }\r\n//        }\r\n//        options.maximize_state = state;\r\n//}\r\n        button_pressed.style.display = 'none';\r\n        if (options.maximize) options.maximize.call(options.this_obj, req, prev);\r\n      },\r\n      exit: function(e, options){\r\n        if (options.exit) options.exit.call(options.this_obj,e);\r\n        else cnst.div_destroy(options.pn, true);\r\n      },\r\n      settings: function(e, options){\r\n//        if (!pref.test_mode['102'] && !options) return; // patch for embed\r\n        var btn = (e.target.tagName==='BUTTON')? e.target : e.target.parentNode;\r\n        var tgt = this.this_obj && this.this_obj.components && this.this_obj.components[btn.getAttribute('name')] || options.cn.childNodes[0];\r\n        tgt.style.display = (tgt.style.display==='none')? null : 'none';\r\n        cnst.toggleButton(btn);\r\n        if (this.settings_after) this.settings_after();\r\n      },\r\n      evfunc_factory: function(obj, funcName){\r\n        return function(e){\r\n          cnst.tb_funcs[funcName](e, TbInfoStore.get(obj.pn));\r\n        };\r\n      }\r\n    };\r\n    tb_funcs.op_m = tb_funcs.op_p;\r\n    tb_funcs.bottom = tb_funcs.top;\r\n    tb_funcs.float = tb_funcs.top;\r\n    tb_funcs.max = tb_funcs.top;\r\n    tb_funcs.filter = tb_funcs.settings;\r\n    function tb_clicks(e){ // tb_funcs itself or obj which inherits tb_funcs are bound\r\n      var et = e.target;\r\n      var func = (e.type==='click')? et.tagName==='BUTTON' && this[et.name] || et.parentNode.tagName==='BUTTON' && this[et.parentNode.name]\r\n                                   : (et.tagName==='DIV' || et.tagName==='SPAN') && this['roll_toggle']; // double click\r\n      if (func) {\r\n        e.stopPropagation();\r\n        func.call(this, e, TbInfoStore.get(e.currentTarget.parentNode)); // TbInfoStore.get(e.currentTarget.parentNode) will be redundant.\r\n      }\r\n    }\r\n//    function ev_to_close(e){\r\n//      e.stopPropagation();\r\n//      if (e.target.tagname!=='BUTTON') tb_funcs.exit.call(tb_funcs, e, TbInfoStore.get(e.currentTarget.parentNode));\r\n//    }\r\n//    function tb_dblclick(e){\r\n//      if (e.target.tagName==='DIV' || e.target.tagName==='SPAN') tb_funcs['roll_toggle'](e);\r\n//    }\r\n    function tack_float(e){\r\n      var obj = TbInfoStore.get(e.currentTarget);\r\n      (obj && obj.float || cnst.tack_float_nSblgs)(e);\r\n    }\r\n    function tack_dock(e){\r\n      var obj = TbInfoStore.get(TbInfoStore.get(e.currentTarget.parentNode).tack);\r\n      (obj && obj.embed || cnst.tack_dock_nSblgs)(e);\r\n    }\r\n\r\n//    function flip_top(s){\r\n//      return bottom2top(s,{offsetHeight:0});\r\n//    }\r\n    function bottom2top(s,pn){ // can be used as top2bottom also.\r\n      return (document.compatMode==='BackCompat'? window.innerHeight : document.documentElement.clientHeight) - parseInt(s, 10) - pn.offsetHeight; // BackCompat for 5ch\r\n    }\r\n    function right2left(s,pn){\r\n      return document.documentElement.clientWidth - parseInt(s, 10) - pn.offsetWidth;\r\n    }\r\n    function div_mousedown(e){\r\n      if ((!pref.proto.popup2_resize && !gGEH.pns_resize.has(e.currentTarget)) || !div_resize_on_border(e))\r\n        if (!(pref.proto.popup2_sel==='sel' || mouse_cursor_on_text(e)))\r\n          /*if (!pref[cataLog.embed_mode].thumbnail.hover.dragfloat || !cataLog.DIH || !cataLog.DIH.hover_ex)*/ prep_drag(e, e.currentTarget);\r\n    }\r\n    var resize_tlbr = null;\r\n    function div_resize_on_border(e){\r\n      var ecT = e.currentTarget;\r\n      var et = e.target;\r\n      var s = ecT.style;\r\n      var pos_fixed = s.position==='fixed';\r\n      var bb_et = pos_fixed? null : et.getBoundingClientRect(); // returns questionable value if e.target is label, this can't apply to 'pos_fixed'\r\n      var bb_ecT = pos_fixed? null : ecT.getBoundingClientRect();\r\n      var top = pos_fixed? e.clientY - ((s.top)? parseInt(s.top, 10) : bottom2top(s.bottom,ecT)) : e.offsetY + bb_et.top - bb_ecT.top;\r\n      var left = pos_fixed? e.clientX - ((s.left)? parseInt(s.left, 10) : right2left(s.right,ecT)) : e.offsetX + bb_et.left - bb_ecT.left;\r\n//      var top = pos_fixed? e.clientY - ((s.top)? parseInt(s.top, 10) : bottom2top(s.bottom,ecT)) : e.offsetY + (ecT===et? 0 : et.offsetTop); //  - ecT.offsetTop);\r\n//      var left = pos_fixed? e.clientX - ((s.left)? parseInt(s.left, 10) : right2left(s.right,ecT)) : e.offsetX + (ecT===et? 0 : et.offsetLeft); //  - ecT.offsetLeft);\r\n      var bottom = ecT.offsetHeight - top;\r\n      var right = ecT.offsetWidth - left;\r\n      var tlbr = [top, left, bottom, right];\r\n      for (var i=0;i<4;i++) if (tlbr[i]<=pref.proto.popup2_resize_bw) {\r\n        for (var j=0;j<4;j++) tlbr[j] = (tlbr[j]<=pref.proto.popup2_resize_cw)? parseInt(window.getComputedStyle(ecT)[j%2?'width':'height'],10) : null;\r\n        document.body.addEventListener('mouseup', div_mouseup_resize, false);\r\n//        document.body.addEventListener('mousemove', div_mousemove_resize, false); // NOT STABLE, causes mouseout.\r\n        document.body.addEventListener('dragend', div_mouseup_resize, false);\r\n        document.body.addEventListener('drag', div_mousemove_resize, false);\r\n        drag_sx = e.screenX;\r\n        drag_sy = e.screenY;\r\n        tlbr.push(parseInt(s.top,10), parseInt(s.left,10), parseInt(s.bottom,10), parseInt(s.right,10), ecT, s.width, s.height);\r\n        resize_tlbr = tlbr;\r\n        e.stopPropagation();\r\n        ecT.draggable = true;\r\n//        ecT.style.cursor = (tlbr[0] && tlbr[1] || tlbr[2] && tlbr[3])? 'nwse-resize'\r\n//                         : (tlbr[0] && tlbr[3] || tlbr[2] && tlbr[1])? 'nesw-resize'\r\n//                         : (tlbr[0] || tlbr[2])? 'ns-resize': 'ew-resize';\r\n        return true;\r\n      }\r\n      return false;\r\n    }\r\n    function div_mousemove_resize(e){\r\n      if (e.screenX===0) return; // BUG of chome??? Last event contains error value.\r\n      var tlbr = resize_tlbr;\r\n      var pn = tlbr[8];\r\n      var s = pn.style;\r\n      var dx = e.screenX - drag_sx;\r\n      var dy = e.screenY - drag_sy;\r\n      if (tlbr[0]) {s.height = tlbr[0] - dy + 'px'; if (s.top)    s.top    = tlbr[4] + dy + 'px';}\r\n      if (tlbr[1]) {s.width  = tlbr[1] - dx + 'px'; if (s.left)   s.left   = tlbr[5] + dx + 'px';}\r\n      if (tlbr[2]) {s.height = tlbr[2] + dy + 'px'; if (s.bottom) s.bottom = tlbr[6] - dy + 'px';}\r\n      if (tlbr[3]) {s.width  = tlbr[3] + dx + 'px'; if (s.right)  s.right  = tlbr[7] - dx + 'px';}\r\n      e.stopPropagation();\r\n    }\r\n    function div_mouseup_resize(e){\r\n      var ecT = e.currentTarget;\r\n      ecT.removeEventListener('drag', div_mousemove_resize, false);\r\n      ecT.removeEventListener('dragend', div_mouseup_resize, false);\r\n//      ecT.removeEventListener('mousemove', div_mousemove_resize, false);\r\n      ecT.removeEventListener('mouseup', div_mouseup_resize, false);\r\n      e.stopPropagation();\r\n      ecT.draggable = false;\r\n      var pn = resize_tlbr[8];\r\n      var resize_func = gGEH.pns_resize.get(pn) || null;\r\n      if (resize_func) {\r\n        pn.childNodes[1].style.width = (parseInt(pn.style.width,10)-6) + 'px'; // 6 for margin\r\n        pn.childNodes[1].style.height = (parseInt(pn.style.height,10)-pn.childNodes[0].offsetHeight-3) + 'px'; // 3 for margin\r\n        if (!resize_tlbr[9]) pn.style.width = null;\r\n        if (!resize_tlbr[10]) pn.style.height = null;\r\n        resize_func();\r\n      }\r\n//      pn.style.cursor = null;\r\n      resize_tlbr = null;\r\n    }\r\n    function tb_mousedown(e){\r\n      var pn = e.currentTarget.parentNode;\r\n      if (prep_drag(e, pn)!==false) tb_funcs.roll_if_auto({currentTarget:pn}, true, true);\r\n    }\r\n    function prep_drag(e, pn){\r\n      e.stopPropagation();\r\n      if (pn.style.position!=='fixed') return false;\r\n      pn.draggable = true;\r\n      pn.addEventListener('dragstart', div_dragstart_dynamic, false);\r\n      pn.addEventListener('mouseup', div_mouseup, false);\r\n    }\r\n    function div_mouseup(e){\r\n      e.currentTarget.removeEventListener('dragstart', div_dragstart_dynamic, false);\r\n      e.currentTarget.removeEventListener('mouseup', div_mouseup, false);\r\n      e.currentTarget.draggable = false;\r\n      tb_funcs.roll_if_auto(e, false);\r\n    }\r\n    function mouse_cursor_on_text(e){\r\n      if (e.target.tagName==='INPUT' || e.target.tagName==='TEXTAREA' || e.target.tagName==='SELECT') return true;\r\n      if (pref.proto.popup2_sel==='move') return false;\r\n      var et_cn = e.target.childNodes;\r\n//      if (et_cn.length===1) return et_cn[0].nodeType===3; // textNode\r\n      var range = new Range();\r\n      for (var i=0;i<et_cn.length;i++) {\r\n        var tx = (et_cn[i].tagName==='BUTTON' || et_cn[i].tagName==='SELECT')? 0 : pref.proto.popup2_sel_tolerance;\r\n        range.selectNode(et_cn[i]);\r\n        var rects = range.getClientRects();\r\n        for (var j=0;j<rects.length;j++) {\r\n          var rect = rects[j];\r\n          if (rect.bottom>e.clientY && e.clientY>=rect.top)\r\n            if (rect.left-tx < e.clientX && e.clientX < rect.right+tx) return true;\r\n        }\r\n      }\r\n      return false;\r\n    }\r\n    var drag_sx;\r\n    var drag_sy;\r\n//    var drag_opacity_back;\r\n//    var dragStopProp = new WeakSet();\r\n//    var drag_cursor_style;\r\n    var root_body = document.body;\r\n    function div_dragstart_dynamic(e){ // with tb or popup\r\n      tb_funcs.roll_if_auto(e, true);\r\n      div_dragstart(e, true)\r\n    }\r\n    function div_dragstart(e, dynamic){ // static\r\n//      var cT = e.currentTarget;\r\n////      if (this.pn) this.pn.removeEventListener('dragstart', this.event_funcs.dragstart, false);\r\n//      drag_sx = e.screenX;\r\n//      drag_sy = e.screenY;\r\n////      drag_cursor_style = pn.style.cursor;\r\n////      pn.style.cursor = 'move';\r\n      e.dataTransfer.setData('text/plain', ''); // for FF. CH doesn't require this.\r\n//      e.dataTransfer.effectAllowed = 'move';\r\n//      e.dataTransfer.dropEffect = 'move';\r\n////      e.preventDefault();\r\n//      if (dragStopProp.has(cT)) e.stopPropagation(); // prevent from invoking twice when legend on chart is moved.\r\n//      drag_opacity_back = cT.style.opacity;\r\n//      cT.style.opacity = 0.4;\r\n////      div_dragend_caller = this;\r\n      gGEH.drag.started(e, (dynamic)? div_mouseup : null, 'move', true); // mouseup isn't called after dragend\r\n//      gGEH.drag.started(e, (dynamic)? div_dragend_dynamic : null, 'move', true);\r\n//      cT.addEventListener('dragend', (dynamic)? div_dragend_dynamic : div_dragend, false);\r\n//      root_body.addEventListener('dragover',div_dragover,false);\r\n    }\r\n////    function div_dragover(e){ // http://www.html5rocks.com/ja/tutorials/dnd/basics/\r\n////      e.preventDefault();\r\n////      e.dataTransfer.dropEffect = 'move';\r\n////    }\r\n//////    var div_dragend_caller;\r\n//    function div_dragend_dynamic(e){\r\n////      div_dragend(e, true);\r\n//      tb_funcs.roll_if_auto(e, false);\r\n//      div_mouseup(e); // mouseup isn't called after dragend\r\n//    }\r\n////    function div_dragend(e, dynamic){\r\n////      root_body.removeEventListener('dragover',div_dragover,false);\r\n////      var cT = e.currentTarget;\r\n////      var s = cT.style;\r\n////      cT.removeEventListener('dragend', (dynamic)? div_dragend_dynamic : div_dragend, false);\r\n////      if (s.left) s.left  = (parseInt(s.left ,10) + e.screenX - drag_sx) + 'px';\r\n////      else        s.right = (parseInt(s.right,10) - e.screenX + drag_sx) + 'px';\r\n////      if (s.bottom) s.bottom = (parseInt(s.bottom,10) - e.screenY + drag_sy) + 'px';\r\n////      else          s.top =    (parseInt(s.top   ,10) + e.screenY - drag_sy) + 'px';\r\n//////      if (div_dragend_caller.dragend) div_dragend_caller.dragend.call(div_dragend_caller.this_obj,e); // isn't used anymore.\r\n//////      div_dragend_caller = null;\r\n////      s.opacity = drag_opacity_back;\r\n////      if (dragStopProp.has(cT)) e.stopPropagation();\r\n////    }\r\n    function div_scroll(e){\r\n      var val = (!brwsr.ff)? e.wheelDelta : -e.detail*40;\r\n      var s = e.currentTarget.style;\r\n      if (s.bottom) s.bottom = (parseInt(s.bottom,10) - val) + 'px'; // from bottom.\r\n      else s.top = (parseInt(s.top,10) + val) + 'px';\r\n      e.preventDefault();\r\n    }\r\n    var tile = {\r\n      left   : 0,\r\n      bottom : 0,\r\n      last_pn: null, // CAUTION. grep last pn permanently.\r\n    };\r\n    var pn_tmp = document.createElement('div');\r\n    return {\r\n      init3: function(obj){\r\n        return this.init(obj.func_str,null,null,null,null,obj.pn_st, obj);\r\n      },\r\n      init2: function(obj){\r\n        return this.init(obj.func_str,obj.rolldown_func,obj.rollup_func,obj.exit_func,obj.maximize_func,obj.pn_st);\r\n      },\r\n      init: function(func_str,rolldown_func,rollup_func,exit_func,maximize_func,site_settings, optsobj){\r\n        var optsobj_is_given = (optsobj!==undefined);\r\n        if (optsobj===undefined) optsobj = { // optsobj WILL BE this.\r\n//          rolldown: rolldown_func, // changed to onXXX\r\n//          rollup: rollup_func,\r\n          exit: exit_func,\r\n          maximize: maximize_func,\r\n        };\r\n        var pn = optsobj.pn || document.createElement('span');\r\n        optsobj.pn = pn; // must be prior to 'tb_press'\r\n        if (site_settings) {\r\n          pn.textContent = ' '+func_str.replace(/.*:button:/,'').replace(/:.*/,'');\r\n          pn.setAttribute('style','cursor:pointer');\r\n          site_settings.appendChild(document.createTextNode(' '));\r\n          site_settings.appendChild(pn);\r\n          return pn;\r\n        }\r\n//        var pn = document.createElement('div');\r\n        if (!pn.style) pn.style = {};\r\n        pn.style.position = 'fixed';\r\n        pn.draggable = true;\r\n        pn.style.padding = '0px';\r\n        pn.style.zIndex = pref.style.zIndex;\r\n        pn.style.float = 'left'; // for embed_to_top/bottom\r\n        pn.style.display = 'inline-block';\r\n        var funcs = func_str.split(':');\r\n        var i=0;\r\n        if (funcs[0]!='pop') {\r\n//          pn.style.background = '#e5ecf9';\r\n//          pn.style.color = '#000000';\r\n//          pn.style.fontWeight = 'normal';\r\n//          pn.style.border = '1px solid blue';\r\n//          pn.style.border = 'none';\r\n        } else {\r\n          var pop = true;\r\n          pn.addEventListener(brwsr.mousewheel, div_scroll, false);\r\n          pn.name = 'catalog_pop';\r\n          i=1;\r\n          pn.draggable = false;\r\n        }\r\n        pn.classList.add(pref.script_prefix+'_window');\r\n//        var rollup_func_tb = null;\r\n        var tgt = pn;\r\n        while (i<funcs.length) {\r\n          var arg = funcs[i++];\r\n          if (arg==='etb' || arg==='tb' || arg==='ftb' || arg==='fitb') {\r\n            pn.classList.remove(pref.script_prefix+'_window');\r\n            pn.classList.add(pref.script_prefix+'_titleBar');\r\n            if (arg!=='fitb') pn.innerHTML = '<div class=\"' + pref.script_prefix + '_window\" style=\"margin: 0px 3px 3px 3px\"></div>';\r\n            var cn = pn.firstChild;\r\n            var btns_html = pref_func.format_html_str('<div style=\"height:auto;overflow:hidden\">' +\r\n                '<div style=\"float: left\">'+(arg==='etb'?'':'<BTN\"roll_toggle,-\"><BTN\"op_m,&lt;\"><BTN\"op_p,&gt;\"><span style=\"width:16px;display:inline-block\"></span>')+'</div>' +\r\n                '<div style=\"float: right\">'+(arg==='etb'?'':'<BTN\"top,^\"><BTN\"bottom,v\"><BTN\"float,o\" style=\"display:none\"><BTN\"max,[]\">'+(arg==='fitb'? '<BTN\"exit,x\">':'')+'<BTN\"exit,X\">')+'</div>' +\r\n                '<div></div>' + // not \"clear both\", this will contain healthIndicators.\r\n              '</div>');\r\n            var tb = pn.insertBefore(cnst.dom(btns_html), arg==='tb' || arg==='etb'? cn : cn.nextSibling); // must be latter for 'ftb', otherwise titleBar doesn't appear at the top if 'cn' has <video> tag on chrome51\r\n            tgt = cn;\r\n//            tb.childNodes[2].style.height = tb.childNodes[0].offsetHeight + 'px';\r\n//            tb.childNodes[0].style.cursor = 'move';\r\n//            tb.childNodes[2].style.cursor = 'move';\r\n//            rollup_func_tb = function(){rollup(pn,pn.childNodes[1], optsobj);};\r\n//            tb.childNodes[0].childNodes[0].onclick = rollup_func_tb;\r\n//            tb.childNodes[0].childNodes[1].onclick = function(){opacity(pn, false);};\r\n//            tb.childNodes[0].childNodes[2].onclick = function(){opacity(pn, true);};\r\n//            tb.childNodes[0].childNodes[3].ondblclick = rollup_func_tb;\r\n//            tb.childNodes[2].ondblclick = rollup_func_tb;\r\n            optsobj.maximize_state = {now:'float', btn:tb.childNodes[1].childNodes[2]};\r\n//            optsobj.maximize_state = (!pref.test_mode['130'])? {now:'float', btn:tb.childNodes[1].childNodes[2]} : ['float',null,null,null,null,tb.childNodes[1].childNodes[2]];\r\n//            optsobj.maximize_state_str = 'float';\r\n//            tb.childNodes[1].childNodes[0].onclick = function(){maximize(pn,tb,0, optsobj);}; // can reduce footprint if 'prototype' is used.\r\n//            tb.childNodes[1].childNodes[1].onclick = function(){maximize(pn,tb,1, optsobj);};\r\n//            tb.childNodes[1].childNodes[2].onclick = function(){maximize(pn,tb,2, optsobj);};\r\n//            tb.childNodes[1].childNodes[3].onclick = function(){maximize(pn,tb,3, optsobj);};\r\n//            tb.childNodes[1].childNodes[4].onclick = (optsobj.this_obj)? optsobj.exit.bind(optsobj.this_obj) : optsobj.exit;\r\n//            if (brwsr.ff) {\r\n            pn.draggable = false;\r\n//            tb.childNodes[0].draggable = true;\r\n//            tb.childNodes[2].draggable = true;\r\n//            }\r\n            var onclick_entry = tb_clicks.bind(optsobj.INHERITED==='tb_funcs'? optsobj : tb_funcs);\r\n            tb.onclick = onclick_entry;\r\n            if (arg!=='etb') tb.ondblclick = onclick_entry;\r\n////            tb.ondblclick = tb_dblclick;\r\n            tb.onmousedown = tb_mousedown;\r\n            optsobj.tb = tb;\r\n            optsobj.cn = cn;\r\n            TbInfoStore.set(pn,optsobj);\r\n            if (arg=='ftb' || arg=='fitb') {\r\n//            tb.childNodes[0].removeChild(tb.childNodes[0].childNodes[0]);\r\n//            pn.insertBefore(cn,tb);\r\n              tb.style.width = '100%';\r\n              tb.classList.add(pref.script_prefix+'_autoTp');\r\n              cn.style.margin = '3px';\r\n            }\r\n//            if (arg==='ftb') {\r\n//              var pf = pref[cataLog.embed_mode].thumbnail.hover;\r\n//              if (pf.df_dblC) cn.ondblclick = ev_to_close;\r\n////            tb.ondblclick = ev_to_close;\r\n//              if (pf.df_mW) pn['on'+brwsr.mousewheel] = div_scroll;\r\n//            }\r\n          } else if (arg=='tb_press') { // must be used at initial time because of using onclick_entry\r\n            var btn = funcs[i++];\r\n            if (btn!=='float') onclick_entry({target:tb.getElementsByTagName('button')[btn], currentTarget:tb, type:'click', stopPropagation:function(){}});\r\n          } else if (arg=='embed') {\r\n            tb.onmousedown = null;\r\n          } else if (arg=='bottom_top') {\r\n            this.bottom_top(pn);\r\n          } else if (arg=='txt' || (brwsr.ff && arg=='button')) {\r\n            tgt.appendChild(document.createTextNode(funcs[i++]));\r\n            tgt.style.cursor = 'pointer';\r\n            tgt.style.padding = '2px 5px 2px 5px';\r\n          } else if (arg=='button') {\r\n            tgt.innerHTML = '<input type=\"button\" value=\"' + funcs[i++] + '\">';\r\n//            tgt.innerHTML = '<button draggable=\"true\">' + funcs[++] + '</button>';\r\n            tgt.style.padding = '0';\r\n            tgt.style.border = '0';\r\n            tgt.style.background = 'none';\r\n          } else if (arg=='Show2') {\r\n            if (site.root_body!==site.root_body2 && site.root_body2) {\r\n              pn.style.position = 'static';\r\n              site.root_body2.appendChild(pn);\r\n            } else site.root_body.appendChild(pn);\r\n          } else if (arg=='Show') site.script_body.appendChild(pn);\r\n//          } else if (arg=='Show') site.root_body.appendChild(pn);\r\n          else if (arg=='tile' || arg=='tile2') {\r\n            if (funcs[i++]=='set') {\r\n              if (funcs[i]=='left') {tile[funcs[i]] = parseInt(pn.style[funcs[i]].replace(/px/,''),10) + pn.offsetWidth;i++;}\r\n              else {tile[funcs[i]] = parseInt(pn.style[funcs[i]].replace(/px/,''),10) + pn.offsetHeight;i++;}\r\n            } else if (arg==='tile') {pn.style[funcs[i]] = tile[funcs[i]]+'px';i++;} // tile:get\r\n            else {pn.style[funcs[i]] = tile[funcs[i]]+parseInt(funcs[i+1],10)+'px';i+=2;} // tile2:get\r\n            \r\n//            console.log(tile);\r\n//          } else if (arg=='dragStopProp') dragStopProp.add(tgt);\r\n          } else tgt.style[arg] = funcs[i++];\r\n        }\r\n//        optsobj.event_funcs = {};\r\n        if (tb || pop) pn.addEventListener('mousedown', div_mousedown, false);\r\n        else pn.addEventListener('dragstart', div_dragstart, false);\r\n//        optsobj.event_funcs.dragstart = div_dragstart.bind(optsobj);\r\n//        pn.addEventListener('dragstart', optsobj.event_funcs.dragstart, false);\r\n        tile.last_pn = pn;\r\n//        optsobj.rollup_func_tb = rollup_func_tb;\r\n        if (optsobj_is_given) return optsobj;\r\n        return pn;\r\n//        return (rollup_func_tb)? [pn,rollup_func_tb] : pn;\r\n      },\r\n      tile_set_bottom: function(){if (tile.last_pn) tile.bottom = tile.last_pn.offsetHeight;},\r\n      tile_set_left: function(){if (tile.last_pn) tile.left = tile.last_pn.offsetWidth;},\r\n//      top2bottom: bottom2top,\r\n      left2right: right2left,\r\n//      flip_top: flip_top,\r\n      bottom_top: function(pn){\r\n        var s = pn.style;\r\n        if (s.bottom) {\r\n          s.top = bottom2top(s.bottom,pn) + 'px';\r\n          s.bottom = null;\r\n        }\r\n        if (s.right) {\r\n          s.left = right2left(s.right,pn) + 'px';\r\n          s.right = null;\r\n        }\r\n      },\r\n      void_func: function(){},\r\n      div_mousedown: div_mousedown,\r\n      div_dragstart: div_dragstart,\r\n      div_scroll: div_scroll,\r\n      div_destroy: function(pn,child_of_body, options){\r\n//        pref_func.tooltips.remove_hier(pn);\r\n//        pref_func.tooltips.remove_root(pn);\r\n        if (child_of_body) pn.parentNode.removeChild(pn);\r\n        if (pn.name || TbInfoStore.has(pn)) pn.removeEventListener('mousedown', div_mousedown, false);\r\n        else pn.removeEventListener('dragstart', div_dragstart, false);\r\n//        pn.removeEventListener('dragstart', (options)? options.event_funcs.dragstart : div_dragstart, false);\r\n        if (pn.name) pn.removeEventListener(brwsr.mousewheel, div_scroll, false);\r\n        return null;\r\n      },\r\n//      tb_prep_for_embed: function(tb){\r\n//        tb.childNodes[0].innerHTML = '';\r\n//        tb.childNodes[1].innerHTML = '';\r\n////        tb.childNodes[0].draggable = false;\r\n////        tb.childNodes[3].ondblclick = null;\r\n////        tb.childNodes[3].draggable = false;\r\n//        tb.childNodes[3].removeAttribute('style');\r\n//        tb.ondblclick = null;\r\n////        tb.onmousedown = null;\r\n////        tb.childNodes[2].onmousedown = null;\r\n//      },\r\n      add_to_tb: function(pn,str){\r\n        var pn_2 = document.createElement('div');\r\n        pn_2.style.float = 'right'; // doesn't work on FF\r\n        pn_2.style.resize = 'none';\r\n        pn_2.style.overflow = 'visible';\r\n        pn_2.innerHTML = str;\r\n        pn.childNodes[0].insertBefore(pn_2,pn.childNodes[0].childNodes[pn.childNodes[0].childNodes.length-1]);\r\n//        if (brwsr.ff) pn.childNodes[0].childNodes[2].setAttribute('style','float: right');\r\n        if (brwsr.ff) pn_2.setAttribute('style','float: right');\r\n        return pn_2;\r\n      },\r\n      show_hide: function(pn,pn2, pn3){\r\n        if (pn.style.display=='none') {\r\n          pn.style.display='';\r\n          if (pn2) pn2.style.height = parseInt(pn2.style.height.replace(/px/,''),10) - pn.offsetHeight + 'px'; // May not work? It depends on the timing of invoking rendering engine. Chrome is ok.\r\n          if (pn3) pn3.style.top    = parseInt(pn3.style.top.replace(/px/,''),10)    + pn.offsetHeight + 'px';\r\n        } else {\r\n          if (pn2) pn2.style.height = parseInt(pn2.style.height.replace(/px/,''),10) + pn.offsetHeight + 'px';\r\n          if (pn3) pn3.style.top    = parseInt(pn3.style.top.replace(/px/,''),10)    - pn.offsetHeight + 'px';\r\n          pn.style.display='none';\r\n        }\r\n      },\r\n//      rollup: function(tb,pn){rollup(tb,pn,cnst.void_func,cnst.void_func);},\r\n      name2domainboardthread: common_func.name2domainboardthread,\r\n//      name2domainboardthread: function(name,fill){\r\n//        var thread = name.replace(/[^\\/]*\\//g,'');\r\n//        var domain = name.replace(/\\/.*/,'');\r\n//        var board  = name.replace(new RegExp('^'+domain),'').replace(new RegExp(thread+'$'),'');\r\n//        if (thread==domain)\r\n//          if (thread.search(/[^0-9]/)!=-1) thread ='';\r\n//          else domain = '';\r\n//        if (fill) {\r\n//          if (domain==='') domain = site.nickname;\r\n//          if (board==='') board = site.board;\r\n//        }\r\n//        return [domain,board,thread];\r\n//      },\r\n      get_time: function(){\r\n        var now = new Date();\r\n        var hour = now.getHours();\r\n        var min = now.getMinutes();\r\n        var sec = now.getSeconds();\r\n        if(hour<10) hour = '0' + hour;\r\n        if(min<10)  min  = '0' + min;\r\n        if(sec<10)  sec  = '0' + sec;\r\n        return hour + ':' + min + ':' + sec;\r\n      },\r\n      make_destroy: function(parent,key,func_make,func_destroy){\r\n        if (!parent[key]) parent[key] = func_make();\r\n        else parent[key] = func_destroy();\r\n      },\r\n      make_popup: function(parent,tgt,html,onchange_func){\r\n        parent[tgt] = cnst.init('left:0px:tile:get:bottom:Show:tb',cnst.void_func,cnst.void_func, function(){\r\n            parent[tgt] = cnst.div_destroy(parent[tgt], true);\r\n          },cnst.void_func);\r\n        parent[tgt].childNodes[1].innerHTML = html;\r\n        pref_func.add_onchange(parent[tgt].childNodes[1],onchange_func);\r\n      },\r\n      make_iframe: function(name){\r\n        if (site2[name] && site2[name].X_FRAME_OPTIONS && pref.network.overXFO || site2[site.nickname].CONTENT_SECURITY_POLICY_FRAME && pref.network.overCSPF) {\r\n//           setTimeout(function(){window.focus();},2000); // this doesn't effect.\r\n          return;\r\n        }\r\n        var ifrm = document.createElement('iframe');\r\n        ifrm.name = name;\r\n        ifrm.setAttribute('style','display:none');\r\n        site.script_body.appendChild(ifrm);\r\n        return ifrm;\r\n      },\r\n\r\n\r\n      subscribe: function(container, tgt){ // for [] container.\r\n        container.push(tgt);\r\n      },\r\n      unsubscribe: function(container, tgt){\r\n        var idx = container.indexOf(tgt);\r\n        if (idx!=-1) container.splice(idx,1);\r\n      },\r\n      foreach: function(container, func){\r\n        for (var i=0;i<container.length;i++) func(container[i]);\r\n      },\r\n      auto_shrink_board_selector: (function(){\r\n        var sels = [];\r\n        function focus(){\r\n          this.removeAttribute('style');\r\n          for (var j=0;j<this.length;j++) {\r\n            this.options[j].text = pref.catalog_board_list_obj[j][0].key;\r\n            color(this.options[j],j);\r\n          }\r\n        }\r\n        function blur(){\r\n          for (var j=0;j<this.length;j++)\r\n            if (j!=this.selectedIndex) this.options[j].text = '';\r\n          color(this,this.selectedIndex);\r\n        }\r\n        function prep(sel, idx){\r\n          if (idx===undefined) idx = sel.selectedIndex;\r\n          sel.length=0;\r\n          for (var j=0;j<pref.catalog_board_list_obj.length;j++) {\r\n            sel.length++; // this is required to add\r\n            sel.options[sel.length-1].text = pref.catalog_board_list_obj[j][0]['key'];\r\n          }\r\n          sel.selectedIndex = (idx>=sel.length)? 0 : idx;\r\n          sel.onblur();\r\n          return sel.selectedIndex;\r\n        }\r\n        function color(pn,idx){\r\n          if (pref3.stats.use && (pref.stats.auto_acquisition || pref.stats.auto_acquisition_all) && stats.query_auto_acquisition(idx)) pn.setAttribute('style','background:#b5fbda');\r\n          else pn.removeAttribute('style');\r\n        }\r\n        return {\r\n          setup: function(sel, idx){\r\n            cnst.subscribe(sels,sel);\r\n            sel.onfocus = focus;\r\n            sel.onblur = blur;\r\n            return prep(sel, idx);\r\n          },\r\n          str_changed: function(){\r\n            cnst.foreach(sels,prep);\r\n          },\r\n          destroy: function(sel){\r\n            cnst.unsubscribe(sels,sel);\r\n          },\r\n          color: function(){\r\n            cnst.foreach(sels,function(inst){color(inst,inst.selectedIndex);});\r\n          },\r\n        };\r\n      })(),\r\n      tb_funcs: tb_funcs,\r\n      auto_shrink_selector: (function(){\r\n        var options = Object.create(null);\r\n        function focus(){\r\n          var opts = options[this.getAttribute('name')];\r\n          for (var j=0;j<this.length;j++) if (this.options[j].text==='') this.options[j].text = opts[j];\r\n        }\r\n        function blur(){\r\n          var opts = [];\r\n          for (var j=0;j<this.length;j++) {\r\n            opts[j] = this.options[j].text;\r\n            if (j!=this.selectedIndex) this.options[j].text = '';\r\n          }\r\n          options[this.getAttribute('name')] = opts;\r\n        }\r\n        return function(sel){\r\n          sel.onfocus = focus;\r\n          sel.onblur = blur;\r\n          sel.onblur();\r\n        };\r\n      })(),\r\n      config_expander: (function(){\r\n        function make_opts(){\r\n          var num = pref[cataLog.embed_mode].t2h_num_of_posts;\r\n          return ['Same as the page', pref[cataLog.embed_mode].t2h_L + ' posts', pref[cataLog.embed_mode].t2h_M + ' posts',\r\n                  num + ' posts', num + ' + all unread posts', 'All unread posts', 'All'];\r\n        }\r\n        function focus(){\r\n          var opts = make_opts();\r\n          for (var j=0;j<this.length;j++) if (this.options[j].text==='') this.options[j].text = opts[j];\r\n        }\r\n        function blur(){\r\n          for (var j=0;j<this.length;j++) if (j!=this.selectedIndex) this.options[j].text = '';\r\n        }\r\n        return function(key, idx){\r\n          var sel = document.createElement('select');\r\n          sel.className = pref.script_prefix + '_expander';\r\n          sel.setAttribute('data-key',key);\r\n          sel.length = 7;\r\n          if (idx===undefined) idx = 0;\r\n          sel.selectedIndex = idx;\r\n          sel.options[idx].text = (idx===0)? 'Expand...' : make_opts()[idx];\r\n          sel.onfocus = focus;\r\n          sel.onblur = blur;\r\n//          sel.onblur();\r\n          return sel;\r\n        };\r\n      })(),\r\n      icons: {\r\n        filter: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcAQAAAABaduI5AAAAAnRSTlMAAQGU/a4AAABUSURBVAjXY/j///8HBjAx////CQz8//8zMLD//8fAwPz/DwND4/8fAgwH/n8wYHhQ/6CA4YP9gQ8MP+QbPzD84Wf+wPCPnx2ol5+fLKJfHmovnAAAn79HiYOE2q8AAAAldEVYdGRhdGU6Y3JlYXRlADIwMTUtMTAtMjlUMDI6MTM6MzkrMDk6MDBxKtFiAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE1LTEwLTI5VDAyOjEzOjM5KzA5OjAwAHdp3gAAAABJRU5ErkJggg==',\r\n        settings: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcAQAAAABaduI5AAAAAnRSTlMAAQGU/a4AAABWSURBVAjXdY6xDcAgDAQvGzAKG2QllykiwWgexWxgKQ2dI4yULs1X9/dPWHMyHrudYZegvVQ6FBQqdqrgzRwLF0ZM4YjJfySS8K4tQaq2dOlzKCe/By9fz0MDWLKIZgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNS0xMC0yOVQwMjowMzowNiswOTowMMhjeagAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTUtMTAtMjlUMDI6MDM6MDYrMDk6MDC5PsEUAAAAAElFTkSuQmCC',\r\n        refresh: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcAQAAAABaduI5AAAAAnRSTlMAAQGU/a4AAABmSURBVAjXbY6xDYAwDASfijLegBUYLRuAlCIljITEAowQNnCZIspjQ0tzkvX6e4NKBREudIw7KgaBTqugLEVwUwWnI9HOzMNh6UarhR+8QWaXD4nNBW02VY0ujdAA9SH1yXfcYG88J0BH+yT9vZAAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTUtMTAtMjhUMjM6NDg6MDYrMDk6MDASyn1kAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE1LTEwLTI4VDIzOjQ4OjA2KzA5OjAwY5fF2AAAAABJRU5ErkJggg==',\r\n        img: function(src){return '<img src=\"' + src + '\" style=\"width:14px;height:14px\">';},\r\n        button_settings: function(){return '<button type=\"button\" name=\"settings\">'+this.img(this.settings)+'</button>';},\r\n      },\r\n      toggleButton: function(pn){\r\n        if (pn.style && pn.style.border) pn.style.border = '';\r\n        else pn.style.border = 'inset 2px';\r\n      },\r\n//      toggleButton: (function(){\r\n//        var style_str = 'width:14px;height:14px';\r\n//        return function(name,icon){\r\n//          var button = document.createElement('button');\r\n//          button.src = cnst.icons[icon];\r\n//          button.setAttribute('style',style_str);\r\n//          return button;\r\n//        };\r\n//      })(),\r\n      createElement: function(html){\r\n        var pn = document.createElement('div');\r\n        pn.innerHTML = html;\r\n        return (pn.childNodes.length===1)? pn.childNodes[0] : pn.querySelectorAll('*'); // return static array.\r\n      },\r\n      set_tack_float: function(pn, func_float, func_embed){\r\n        if (func_float || func_embed) TbInfoStore.set(pn, {float: func_float, embed: func_embed});\r\n        pn.onclick = tack_float;\r\n        return pn;\r\n      },\r\n      tack_float_nSblgs: function(e, all, itself){\r\n        var ecT = e.currentTarget;\r\n        var tgt = ecT.nextSibling;\r\n        var bcr = tgt.getBoundingClientRect();\r\n        var obj = cnst.init3({func_str:'left:'+bcr.left+'px:top:'+(bcr.top>0?bcr.top:0)+'px:overflow:hidden:'+(itself? 'fitb':'Show:tb'), exit:tack_dock, tack:ecT, pn:itself? tgt : null});\r\n//        var left = tgt.offsetLeft - tgt.scrollLeft;\r\n//        var tgt_p = tgt.parentNode;\r\n//        var scrollTop;\r\n//        while (tgt_p && !scrollTop) {scrollTop = tgt_p.scrollTop; tgt_p = tgt_p.parentNode;}\r\n//        var top = tgt.offsetTop - (scrollTop||0);\r\n//        var obj = cnst.init3({func_str:'left:'+left+'px:top:'+top+'px:overflow:hidden:'+(itself? 'fitb':'Show:tb'), exit:tack_dock, tack:ecT, pn:itself? tgt : null});\r\n        if (!itself) {\r\n          obj.cn.innerHTML = '<div style=\"display: none\"></div><div></div>';\r\n          var dst = obj.cn.childNodes[1];\r\n          tgt.parentNode.insertBefore(obj.pn,tgt);\r\n          dst.appendChild(tgt);\r\n          if (all) while (obj.pn.nextSibling) dst.appendChild(obj.pn.nextSibling);\r\n        }\r\n        ecT.style.display = 'none';\r\n        return obj;\r\n      },\r\n      tack_dock_nSblgs: function(e, itself){\r\n        var pn = e.currentTarget.parentNode;\r\n        var obj = TbInfoStore.get(pn);\r\n        var tack_p = obj.tack.parentNode;\r\n        var ref = obj.tack.nextSibling;\r\n        if (!itself) {\r\n          var src = obj.cn.childNodes[1];\r\n          while (src.firstChild) tack_p.insertBefore(src.firstChild,ref); // all childrens are retrieved always.\r\n        } else {\r\n          pn.style.position = 'static';\r\n          pn.removeChild(obj.tb);\r\n          if (obj.tack.nextSibling!==pn) tack_p.insertBefore(pn,obj.tack.nextSibling);\r\n        }\r\n        cnst.div_destroy(pn, !itself);\r\n        obj.tack.style.display = null;\r\n        return obj;\r\n      },\r\n      tack_dock_e2tack: function(e){\r\n        var pn = e.currentTarget.parentNode;\r\n        return TbInfoStore.get(pn).tack;\r\n      },\r\n//      set_target_of_button: function(button, tgt){\r\n//        TbInfoStore.set(button, tgt);\r\n//      },\r\n      dom: function(html){\r\n        pn_tmp.innerHTML = html;\r\n        return pn_tmp.removeChild(pn_tmp.firstChild);\r\n      },\r\n      doms_insertBefore: function(parent, html, ref){\r\n        pn_tmp.innerHTML = html;\r\n        if (!parent) parent = ref.parentNode;\r\n        var pn;\r\n        while (pn_tmp.firstChild) pn = parent.insertBefore(pn_tmp.firstChild,ref);\r\n        return pn;\r\n      },\r\n      tack_for_popup: function(pn, func_onclick){\r\n        var btn = document.createElement('button');\r\n        btn.classList.add(pref.script_prefix+'_autoTp');\r\n        btn.appendChild(site2[site.nickname].make_tack());\r\n        pn.appendChild(btn);\r\n        btn.onclick = func_onclick;\r\n        return btn;\r\n      },\r\n      tack_for_popup_swap: function(pn, ref, dont_overwrite){\r\n        var pn2all = cnst.init3({func_str:'Show:tb'});\r\n        if (ref) cnst.tack_for_popup_swap_pos(pn2all.pn, ref, dont_overwrite);\r\n        pn2all.cn.appendChild(pn);\r\n        return pn2all.pn;\r\n      },\r\n      tack_for_popup_swap_pos: function(pn2, pn, dont_overwrite){\r\n        cnst.bottom_top(pn);\r\n        pn2.style.top = parseInt(pn.style.top,10) - pn2.offsetHeight + 'px';\r\n        pn2.style.left = pn.style.left;\r\n        if (!dont_overwrite) common_func.overwrite_prop(pn.style, {position:'relative', border:null, top:null, left:null});\r\n      },\r\n      cloneSwap(src){\r\n        var pn = src.cloneNode(true);\r\n        if (src.id) {pn.id = src.id; src.removeAttribute('id');}\r\n        if (src.tagName==='SELECT') pn.selectedIndex = src.selectedIndex;\r\n        src.style.display = 'none';\r\n        return src.parentNode.insertBefore(pn,src);\r\n      },\r\n    };\r\n  })();\r\n\r\n////  function Cnst2(func_str,funcs_args){ // rolldown, rollup, exit, maximize // test for prototype base coding.\r\n////    var pn = document.createElement('div');\r\n////    if (!pn.style) pn.style = {};\r\n////    pn.style.position = 'fixed';\r\n////    pn.draggable = true;\r\n////    pn.style.padding = '0px';\r\n////    var funcs = func_str.split(':');\r\n////    var i=0;\r\n////    if (funcs[0]!='pop') {\r\n////      pn.style.background = '#e5ecf9';\r\n////      pn.style.color = '#000000';\r\n////      pn.style.fontWeight = 'normal';\r\n////      pn.style.border = '1px solid blue';\r\n//////      pn.style.border = 'none';\r\n////    } else {\r\n////      pn.addEventListener(brwsr.mousewheel, div_scroll, false);\r\n////      pn.name = 'catalog_pop';\r\n////      i=1;\r\n////    }\r\n////    this.pn = pn;\r\n////\r\n////    var tgt = pn;\r\n////    var funcs = func_str.split(':');\r\n////    while (i<funcs.length) {\r\n////      var arg = funcs[i++];\r\n////      if (arg=='tb') {\r\n////        pn.style.background = '#b5ccf9';\r\n////        pn.innerHTML = '<div>' +\r\n////          '<div style=\"float: left\"><button name=\"rollup\">-</button><button name=\"opacity,-0.1\"><</button><button name=\"opacity,0.1\">></button><span>&emsp;</span></div>' +\r\n////          '<div style=\"float: right\"><button name=\"embed_top\" style=\"display:inline\">^</button><button name=\"embed_bottom\" style=\"display:inline\">_</button><button name=\"float\" style=\"display:none\">o</button><button name=\"maximize\" style=\"display:inline\">[]</button><button name=\"exit\">X</button></div>' +\r\n////          '<div></div>' +\r\n////          '</div>' +\r\n////          '<div style=\"background: #e5ecf9; margin: 0px 3px 3px 3px\"></div>';\r\n////        var tb = pn.childNodes[0];\r\n////        tb.childNodes[2].style.height = tb.childNodes[0].offsetHeight + 'px';\r\n////        tb.childNodes[2].ondblclick = (function(myself){return function(){myself.button_click(\"rollup\");};})(this);\r\n//////        tb.childNodes[0].childNodes[3].ondblclick = tb.childNodes[2].ondblclick;\r\n////        pn.draggable = false;\r\n////        tb.childNodes[0].draggable = true;\r\n////        tb.childNodes[2].draggable = true;\r\n////        tb.childNodes[0].style.cursor = 'move';\r\n////        tb.childNodes[2].style.cursor = 'move';\r\n////        tgt = pn.childNodes[1];\r\n////        this.tb = tb;\r\n////        this.opacity = 1;\r\n////        this.rolluped = false;\r\n////        this.state = ['float'];\r\n////        this.button_click_event = (function(myself){return function(){myself.button_click.call(myself,this.name);};})(this);\r\n////        this.funcs = {};\r\n////        common_func.overwrite_prop(this.funcs,funcs_args);\r\n////        var buttons = pn.getElementsByTagName('button');\r\n////        for (var j=0;j<buttons.length;j++) buttons[j].onclick = this.button_click_event;\r\n////        this.pn_1 = pn.childNodes[1];\r\n////      } else if (arg=='txt' || (brwsr.ff && arg=='button')) {\r\n////        tgt.appendChild(document.createTextNode(funcs[i++]));\r\n////        tgt.style.cursor = 'pointer';\r\n////        tgt.style.padding = '2px 5px 2px 5px';\r\n////      } else if (arg=='button') {\r\n////        tgt.innerHTML = '<input type=\"button\" value=\"' + funcs[i++] + '\">';\r\n//////        tgt.innerHTML = '<button draggable=\"true\">' + funcs[++] + '</button>';\r\n////        tgt.style.padding = '0';\r\n////        tgt.style.border = '0';\r\n////        tgt.style.background = 'none';\r\n////      } else if (arg=='Show2') {\r\n////        if (site.root_body!==site.root_body2 && site.root_body2) {\r\n////          pn.style.position = 'static';\r\n////          site.root_body2.appendChild(pn);\r\n////        } else site.root_body.appendChild(pn);\r\n////      } else if (arg=='Show') site.root_body.appendChild(pn);\r\n////      else if (arg=='tile') {\r\n////        if (funcs[i++]=='set') {\r\n////          if (funcs[i]=='left') {this.tile[funcs[i]] = parseInt(pn.style[funcs[i]].replace(/px/,''),10) + pn.offsetWidth;i++;}\r\n////          else {this.tile[funcs[i]] = parseInt(pn.style[funcs[i]].replace(/px/,''),10) + pn.offsetHeight;i++;}\r\n////        } else {pn.style[funcs[i]] = this.tile[funcs[i]]+'px';i++;}\r\n////      } else tgt.style[arg] = funcs[i++];\r\n////    }\r\n////    pn.addEventListener('dragstart', this.div_dragstart, false);\r\n//////    pn.addEventListener('dragstart', this.div_dragstart, true);\r\n////    pn.addEventListener('dragend', this.div_dragend, false);\r\n////  }\r\n////\r\n////  Cnst2.prototype = {\r\n////    tile : {lef: 0, bottom: 0},\r\n////    button_click : function(name){\r\n////      if (name.indexOf('opacity')!=-1) {\r\n////        this.opacity += parseFloat(name.substr(name.indexOf(',')+1),10);\r\n////        if (this.opacity>1) this.opacity = 1;\r\n////        else if (this.opacity<0.1) this.opacity = 0.1;\r\n////        this.pn.style.opacity = this.opacity;\r\n////      } else if (name.indexOf('rollup')!=-1) {\r\n////        if (this.rolluped) {\r\n////          this.tb.style.width = ''; // means 'auto'\r\n////          this.pn_1.style.display = ''; // for dollchan\r\n////          if (this.funcs.rolldown) this.funcs.rolldown();\r\n////        } else {\r\n////          this.tb.style.width = this.tb.offsetWidth + 'px'; // for dollchan\r\n////          this.pn_1.style.display = 'none'; // for dollchan\r\n////          if (this.funcs.rollup) this.funcs.rollup();\r\n////        }\r\n////        this.rolluped = !this.rolluped;\r\n////      } else if (['embed_top','embed_bottom','float','maximize'].indexOf(name)!=-1) {\r\n////        common_func.overwrite_prop(this.tb.childNodes[1].getElementsByTagName('*')[this.state[0]].style,{display:'inline'});\r\n////        if (this.state[0]=='float') this.state = [name, this.pn.style.left, this.pn.style.top, this.pn.childNodes[1].style.width, this.pn.childNodes[1].style.height];\r\n////        else this.state[0] = name;\r\n////        if (name=='maximize') {\r\n////          var header_height = site.header_height();\r\n////          common_func.overwrite_prop(this.pn.style, {left:'0px', top:header_height + 'px', position:'fixed', resize:'none'});\r\n////          common_func.overwrite_prop(this.pn.childNodes[1].style,\r\n////            {width: document.documentElement.clientWidth + 'px', height: document.documentElement.clientHeight - this.tb.offsetHeight - header_height + 'px', resize:'none'});\r\n////        } else if (name=='float'){\r\n////          common_func.overwrite_prop(this.pn.style, {left:this.state[1], top:this.state[2], position:'fixed', resize:'both'});\r\n////          common_func.overwrite_prop(this.pn.childNodes[1].style, {width:this.state[3], height:this.state[4], resize:'both'});\r\n////        } else {\r\n////          var ref = site.embed_to[(name==='embed_top')?'top':'bottom'];\r\n////          if (ref){\r\n////            common_func.overwrite_prop(this.pn.style, {left:'auto', top:'auto', position:'static', resize:'none'});\r\n////            common_func.overwrite_prop(this.pn.childNodes[1].style, {width:'auto', height:'auto', resize:'none'});\r\n////            ref.parentNode.insertBefore(this.pn,ref);\r\n////          }\r\n////        }\r\n////        common_func.overwrite_prop(this.tb.childNodes[1].getElementsByTagName('*')[this.state[0]].style,{display:'none'});\r\n////        if (this.funcs.maximize) this.funcs.maximize();\r\n////      } else if (name==='exit') this.funcs.exit();\r\n////    },\r\n////    drag_sx: null,\r\n////    drag_sy: null,\r\n////    div_dragstart: function(e){\r\n//////    var drag_cursor_style;\r\n////      this.drag_sx = e.screenX;\r\n////      this.drag_sy = e.screenY;\r\n//////      drag_cursor_style = pn.style.cursor;\r\n//////      pn.style.cursor = 'move';\r\n////      e.dataTransfer.setData('text/plain', ''); // for FF. CH doesn't require this.\r\n//////      e.preventDefault();\r\n//////      e.stopPropagation();\r\n////    },\r\n////    div_dragend: function(e){\r\n////      if (e.currentTarget.style.left!='') e.currentTarget.style.left   = (parseInt(e.currentTarget.style.left.replace(/px/,''))   + e.screenX - this.drag_sx) + 'px';\r\n////      else e.currentTarget.style.right = (parseInt(e.currentTarget.style.right.replace(/px/,''))   - e.screenX + this.drag_sx) + 'px';\r\n////      if (e.currentTarget.style.bottom!='') e.currentTarget.style.bottom = (parseInt(e.currentTarget.style.bottom.replace(/px/,'')) - e.screenY + this.drag_sy) + 'px'; // from bottom.\r\n////      else e.currentTarget.style.top = (parseInt(e.currentTarget.style.top.replace(/px/,'')) + e.screenY - this.drag_sy) + 'px';\r\n//////      pn.style.cursor = drag_cursor_style;\r\n////    }\r\n////  }\r\n\r\n  var styleSheet = (site0.isStep)? {} : (function(){\r\n    var StyleSheet;\r\n//    function replace_rule(rule_str,idx){\r\n//      if (ss.cssRules[idx]) ss.deleteRule(idx);\r\n//      ss.insertRule(rule_str,idx);\r\n//    }\r\n//    function make_rule_click_area(){\r\n//      replace_rule('.'+pref.script_prefix+((pref.catalog.click_area==='entire')? '_thread' : '_thumbnail')+' {cursor: pointer}',2);\r\n//    }\r\n    function make_styles(){\r\n      var sels = ['titleBar','window','popUp'];\r\n      var rules = sels.map(function(v){return pref.style.fix[v+'_str'];});\r\n      if (pref.style.sel==='copy') copy_styles_and_overwrite(sels.map(function(v){return pref.style.copy[v+'_str'];}).filter(function(v){return v;}), rules);\r\n      sels.forEach(function(v,i){register_cc(v, rules[i]);});\r\n    }\r\n    function copy_styles_and_overwrite(sels, rules){\r\n      for (var i=document.styleSheets.length-1;i>=0;i--) {\r\n        var doc_rules = document.styleSheets[i].cssRules;\r\n        if (!doc_rules) continue;\r\n        for (var j=doc_rules.length-1;j>=0;j--) {\r\n          for (var k=sels.length-1;k>=0;k--) {\r\n            if (doc_rules[j].selectorText===sels[k]) {\r\n              rules[k] = overwrite_rules(rules2Map(rules[k]),rules2Map(doc_rules[j].cssText));\r\n              sels.splice(k,1);\r\n            }}}}\r\n    }\r\n    function rules2Map(rules){\r\n      var m = new Map();\r\n      rules.replace(/.*\\{/,'').replace(/\\}.*/,'').split(';').forEach(function(v){var a = v.split(':');m.set(a[0],a[1]);});\r\n      return m;\r\n    }\r\n    function overwrite_rules(dst, src){\r\n      for (var rule of src.keys()) if (rule.search(/\\s*(background|color)/)>=0) dst.set(rule,src.get(rule));\r\n      return Array.from(dst.entries()).map(function(v){return v.join(':');}).join(';')\r\n    }\r\n//    function make_styles(){\r\n//      var rules = [pref.style.fix.titleBar_str, pref.style.fix.window_str, pref.style.fix.popUp_str];\r\n//      if (pref.style.sel==='copy') {\r\n//        var rules_str = [pref.style.copy.titleBar_str, pref.style.copy.window_str, pref.style.copy.popUp_str];\r\n//        for (var i=document.styleSheets.length-1;i>=0;i--) {\r\n//          var doc_rules = document.styleSheets[i].cssRules;\r\n//          if (!doc_rules) continue;\r\n//          for (var j=doc_rules.length-1;j>=0;j--) {\r\n//            for (var k=0;k<3;k++) {\r\n//              if (rules_str[k] && doc_rules[j].selectorText===rules_str[k]) {\r\n//                rules[k] = trim_rules(doc_rules[j].cssText);\r\n//                rules_str[k] = null;\r\n//              }\r\n//            }\r\n//            if (!rules[0] && !rules[1] && !rules[2]) break;\r\n//          }\r\n//          if (!rules[0] && !rules[1] && !rules[2]) break;\r\n//        }\r\n//      }\r\n//      replace_rule('.'+pref.script_prefix+'_titleBar'+' {' + rules[0] + '}',4);\r\n//      replace_rule('.'+pref.script_prefix+'_window'  +' {' + rules[1] + '}',5);\r\n//      replace_rule('.'+pref.script_prefix+'_popUp'   +' {' + rules[2] + '}',6);\r\n//    }\r\n//    function trim_rules(str){\r\n//      var rules = str.replace(/.*\\{/,'').replace(/\\}.*/,'').split(';');\r\n//      for (var i=rules.length-1;i>=0;i--) if (rules[i].split(':')[0].search(/\\s*(background|color)/)==-1) rules.splice(i,1);\r\n//      return rules.join(';');\r\n//    }\r\n    function add_to_watch(elem){ // http://stackoverflow.com/questions/2635814/javascript-capturing-load-event-on-link\r\n//      elem.addEventListener('change', dummy_add, false); // doesn't work.\r\n      new MutationObserver(dummy_add).observe(elem, {attributes:true});\r\n    }\r\n    function dummy_add(){\r\n      if (!StyleSheet) return;\r\n      var dummy = document.createElement('img');\r\n      dummy.src = this.href;\r\n      dummy.onerror = dummy_remove;\r\n      document.getElementsByTagName('body')[0].appendChild(dummy);\r\n    }\r\n    function dummy_remove(){\r\n      this.parentNode.removeChild(this);\r\n      make_styles();\r\n    }\r\n    var spoiler_org = null;\r\n    var spoiler_open = null;\r\n    function open_spoiler_text(){\r\n      if (!cataLog.embed_mode) return;\r\n      var desc = site2[site.nickname].spoiler_text;\r\n      if (desc.spoiler) {\r\n        if (!spoiler_org && !spoiler_open) {\r\n          if (desc && pref[cataLog.embed_mode].open_spoiler_text) {\r\n            for (var j=0;j<document.styleSheets.length;j++)\r\n              if (document.styleSheets[j].cssRules)\r\n                for (var i=0;i<document.styleSheets[j].cssRules.length;i++) {\r\n                  var sText = document.styleSheets[j].cssRules[i].selectorText;\r\n                  if (sText) {\r\n                    if (sText.search(desc.spoiler)!=-1) spoiler_org  = [j,i,document.styleSheets[j].cssRules[i].style.cssText];\r\n                    if (sText.search(desc.open   )!=-1) spoiler_open = [j,i,document.styleSheets[j].cssRules[i].style.cssText];\r\n                  }\r\n                }\r\n          }\r\n        }\r\n        if (spoiler_org && spoiler_open)\r\n          document.styleSheets[spoiler_org[0]].cssRules[spoiler_org[1]].style.cssText = spoiler_org[2] + ((pref[cataLog.embed_mode].open_spoiler_text)? spoiler_open[2] : '');\r\n      } else { // cssRules is null when stylesheet is placed in other domain. http://hakuhin.jp/js/style_sheet.html#STYLE_SHEET_04\r\n        if (pref[cataLog.embed_mode].open_spoiler_text) {\r\n          spoiler_open = [document.styleSheets.length-1, document.styleSheets[document.styleSheets.length-1].cssRules.length, desc.open_rule];\r\n          document.styleSheets[spoiler_open[0]].insertRule(spoiler_open[2],spoiler_open[1]);\r\n        } else if (spoiler_open) document.styleSheets[spoiler_open[0]].deleteRule(spoiler_open[1]);\r\n      }\r\n    }\r\n    var registry = []; // 'dummy','dummy','dummy','dummy']; // ,'dummy','dummy','dummy'];\r\n    function register(selector, rule){\r\n      if (rule===undefined) { // for raw format\r\n        var idx_s = selector.indexOf('{');\r\n        rule = selector.slice(idx_s+1,selector.lastIndexOf('}'));\r\n        selector = selector.slice(0,idx_s);\r\n      }\r\n      var idx = registry.indexOf(selector);\r\n      if (idx!=-1) StyleSheet.deleteRule(idx);\r\n      if (rule===null || rule==='') {\r\n        if (idx!=-1) registry.splice(idx,1);\r\n      } else {\r\n        if (idx===-1) {\r\n          idx = registry.length;\r\n          registry[idx] = selector;\r\n        }\r\n        StyleSheet.insertRule(selector+' {'+rule+'}', idx); // (rule[0]===':'? rule : ' {'+rule+'}'), idx);\r\n      }\r\n    }\r\n    var cpf = '.'+pref.script_prefix+'_';\r\n    function register_cc(cls,rule){ // class is a reserved keyword\r\n      register(cpf+cls, rule);\r\n    }\r\n    var addSS;\r\n    function addSS_changed(){ // additional StyleSheets\r\n      if (addSS) addSS.forEach(function(v){v.parentNode.removeChild(v);});\r\n      addSS = null;\r\n      var pf = pref.style.addSS;\r\n      if (pf.use) addSS = pf.str.split('\\n').filter(function(v){return v;}).map(function(v){\r\n        var l = document.createElement('link');\r\n        l.rel = 'stylesheet';\r\n        l.href = v;\r\n        return document.head.appendChild(l);});\r\n    }\r\n    addSS_changed(); // init\r\n    var uss = null;\r\n    function userCSS_changed(){\r\n      var pf = pref.style.userCSS;\r\n      if (pf.use) {\r\n        var s = uss || document.createElement('style');\r\n        s.textContent = pf.str;\r\n        if (!uss) uss = document.head.appendChild(s);\r\n      } else {\r\n        if (uss) {\r\n          document.head.removeChild(uss);\r\n          uss = null;\r\n        }\r\n      }\r\n    }\r\n    userCSS_changed(); // init\r\n    function catalog_customSize(pf){\r\n      return (pf.width==0? '' : 'width:'+pf.width+'px;') + (pf.height==0? '' : (pf.max? 'max-':'')+'height:'+pf.height+'px');\r\n    }\r\n    return {\r\n      init: function(embed_mode){\r\n        var style_fixed = cpf + 'tag{cursor:pointer;}\\n'+\r\n            cpf + 'autoTp{opacity:0; position:absolute; top:0px; left:0px;}\\n'+\r\n            cpf + 'autoTp:hover{opacity:1;}\\n'+\r\n            cpf + 'embeddedTriage{display:inline-block;cursor:pointer}\\n'+ // must be block for rotation, see https://stackoverflow.com/questions/31504419/div-can-rotate-span-cant-rotate-but-it-can-animate-the-transformation\r\n            cpf + 'button{cursor:pointer;}\\n\\n'+\r\n            (site2[site.nickname].styles||'');\r\n        document.head.insertBefore(document.createElement('style'),uss).textContent = style_fixed;\r\n        StyleSheet = document.head.insertBefore(document.createElement('style'),uss).sheet;\r\n        register_cc('deleted', 'opacity:0.4;');\r\n        make_styles(); // rule4,5,6\r\nif (site.nickname==='4chan') {\r\n  if (site.whereami!=='catalog') {\r\n    register('.teaser','display:none');\r\n    register('.extended-small .teaser, .extended-large .teaser','display: block');\r\n    register('.small .thread','width: 165px');\r\n    register('.large .thread','width: 270px');\r\n    register('.extended-small .thread','width: 180px; max-height: 320px');\r\n    register('.extended-large .thread','width: 270px; max-height: 410px');\r\n  }\r\n        register_cc('catalogView','text-align:center');\r\n        register('.extended-custom .teaser','display:block');\r\n        register('.extended-custom .thread',catalog_customSize(pref.float.format.ec));\r\n        register('.custom .thread',catalog_customSize(pref.float.format.c));\r\n}\r\n//        register(cpf+'hMenu', 'display:inline-block;');\r\n//        register(cpf+'hMCnt button', 'display:block;width:100%');\r\n//        register(cpf+'hMenu '+cpf+'hMCnt', 'display:none;');\r\n//        register(cpf+'hMenu:hover '+cpf+'hMCnt', 'display:block;position:absolute;');\r\n        for (var prop in pref.style.tips) if (prop.slice(-4)!=='_str' && pref.style.tips[prop]) this.register_cc(pref.style.tips[prop+'_str']);\r\n        var onchange_funcs = {\r\n          'style.tips.*w/': function(e, name){\r\n            var prop = name.split('.')[2];\r\n            var str = pref.style.tips[prop+'_str'];\r\n            register_cc(pref.style.tips[prop]? str : str.slice(0,str.indexOf('{')), pref.style.tips[prop]? undefined : null);\r\n          },\r\n//          'catalog.click_area': make_rule_click_area,\r\n          'style.sel': make_styles,\r\n          'style.fix.*': make_styles,\r\n          'style.copy.*': make_styles,\r\n          'style.reset.*w/': function(e,name){\r\n            var pref_def = pref_default();\r\n            var tgt = name.split('.')[2];\r\n            pref_func.pref_overwrite(pref.style[tgt], pref_def.style[tgt]);\r\n            pref_func.settings.apply_pn13_1();\r\n            make_styles();\r\n          },\r\n          'style.addSS.*': addSS_changed,\r\n          'style.userCSS.*': userCSS_changed,\r\n          'style.post_editing': function(){register_cc('post_editing', pref.style.post_editing);},\r\n          '*.open_spoiler_text': open_spoiler_text,\r\n          '*.posts_search_op': function(e,embed_mode){\r\n            var pf = pref[(embed_mode || cataLog.embed_mode)];\r\n            register_cc('search_miss', (pf.posts_search_op==='opaque')? 'opacity:'+pf.posts_search_op_opacity/100+' !important' :\r\n                                       (pf.posts_search_op==='hide')? 'display:none !important' : null);},\r\n          'float.format.fc.*w/': function(e,pn_name){\r\n            var names = pn_name.split('.');\r\n            var mode = names[0];\r\n            var tgt  = names[2];\r\n            register('.'+(tgt=='ec'?'extended-':'')+'custom .thread',catalog_customSize(pref[mode].format[tgt]));\r\n          },\r\n        };\r\n        onchange_funcs['*.posts_search_op_opacity'] = onchange_funcs['*.posts_search_op'];\r\n        var func_style = onchange_funcs['float.format.fc.*w/'];\r\n        onchange_funcs['catalog.format.fc.*w/'] = func_style;\r\n        onchange_funcs['page.format.fc.*w/'] = func_style;\r\n        onchange_funcs['catalog.format.c.*w/'] = func_style;\r\n        onchange_funcs['page.format.c.*w/'] = func_style;\r\n        onchange_funcs['catalog.format.ec.*w/'] = func_style;\r\n        onchange_funcs['page.format.ec.*w/'] = func_style;\r\n        for (var name in onchange_funcs) pref_func.settings.onchange_funcs[name] = onchange_funcs[name];\r\n        onchange_funcs['*.posts_search_op'](null,embed_mode);\r\n        onchange_funcs['style.post_editing']();\r\n        if (pref[embed_mode].open_spoiler_text) open_spoiler_text();\r\n        if (!pref.test_mode['98'] && embed_mode==='catalog') register('.backlink','display:inline;font-size:0.8em;');\r\n      },\r\n      add_to_watch: add_to_watch,\r\n      register_cc: register_cc,\r\n    }\r\n  })();\r\n\r\n  var Tooltips = (site0.isStep)? null : (function(){\r\n        var tooltip = document.createElement('div');\r\n        tooltip.style.position = 'fixed';\r\n////        tooltip.style.background = '#e5f4f9';\r\n////        tooltip.style.color = '#000000';\r\n////        tooltip.style.border = '2px solid blue';\r\n//          tooltip.style.fontWeight = 'normal';\r\n        tooltip.setAttribute('class', pref.script_prefix+'_popUp');\r\n        tooltip.style.zIndex = pref.tooltips.zIndex;\r\n        tooltip.innerHTML = '<div></div>';\r\n        tooltip.onmouseover = keep_shown;\r\n        tooltip.onmouseleave = hide2;\r\n        var tack = cnst.tack_for_popup(tooltip, function(e){\r\n          cnst.tack_for_popup_swap(tooltip.replaceChild(document.createElement('div'),tooltip.firstChild), tooltip, true);\r\n          hide_exe2();\r\n        });\r\n        var tack_displayed = true;\r\n        var tooltip_on = null;\r\n//        var tooltip_shown = false;\r\n        var tooltip_kind = 'help';\r\n//        var func = {};\r\n        var show_timer = null;\r\n        var hide_timer = null;\r\n//        var str_tooltip = '';\r\n\r\n//        function add_hier(pn){ // working code\r\n//          var all = pn.getElementsByTagName('*');\r\n////          if (pref.test_mode.tips) for (var i=0;i<all.length;i++) if (!str[all[i].name]) str[all[i].name] = 'Name: ' + all[i].name;\r\n////          for (var i=0;i<all.length;i++) if (all[i].name) add(all[i]); // span can't return if .name\r\n//          for (var i=0;i<all.length;i++) {\r\n//            var name = all[i].getAttribute('name');\r\n//            if (name && (str[name] || (str[name]!==false && pref.test_mode.tips))) add(all[i]);\r\n//          }\r\n//        }\r\n//        function remove_hier(pn){\r\n//          var all = pn.getElementsByTagName('*');\r\n////          for (var i=0;i<all.length;i++) if (all[i].name) remove(all[i]);\r\n//          for (var i=0;i<all.length;i++) if (all[i].hasAttribute('name')) remove(all[i]);\r\n//        }\r\n//        function add(elem){\r\n//////          if (str.hasOwnProperty(elem.name)) {\r\n//            if (!func.hasOwnProperty(elem.name)) func[elem.name] = [];\r\n//            func[elem.name].push(elem);\r\n//            elem.addEventListener('mouseover', show, false);\r\n//////          }\r\n//        }\r\n//        function remove(elem){\r\n//          if (func.hasOwnProperty(elem.name)) {\r\n//            var elems = func[elem.name];\r\n//            for (var i=0;i<elems.length;i++) {\r\n//              if (elem===elems[i]) {\r\n//                elem.removeEventListener('mouseover', show, false);\r\n//                elems.splice(i,1);\r\n//                if (elems.length==0) delete func[elem.name];\r\n//                break;\r\n//              }\r\n//            }\r\n////            for (var i=0;i<elems.length;i++) {\r\n////              var elem = func[elem.name][i];\r\n////              elem.removeEventListener('mouseover', show, false);\r\n////            }\r\n////            delete func[elem.name];\r\n//          }\r\n//        }\r\n        function show(e){\r\n//          if (!pref.tooltips.help.show) return;\r\n          var name = e && (e.target.name || e.target.getAttribute('name')) || this.name;\r\n          if (name && e && e.target.type==='radio') name += ', '+e.target.value;\r\n          if (!name && e.target.tagName==='LABEL') name = e.target.childNodes[0].name + (e.target.childNodes[0].type==='radio'? ', '+e.target.childNodes[0].value : '');\r\n          if (name==='SHOW2_I') name = e.target.previousSibling.childNodes[1].getAttribute('name');\r\n          if (name==='SHOW2') name = e.target.childNodes[1].getAttribute('name');\r\n          if (!name) return; // for add_root\r\n//          var name = this.name || this.getAttribute('name')); // for add_hier\r\n////          for (var i in str_func) if (this.name.indexOf(i)==0) {\r\n////            str_tooltip = str_func[i](this,e);\r\n////            break;\r\n////          }\r\n          var str_tooltip = (typeof(str[name])==='function')? str[name](e) : str[name];\r\n//            if (!str_tooltip) str_tooltip = str[this.parentNode.name];\r\n          if (!str_tooltip) str_tooltip = str[name.substr(0,name.lastIndexOf('.')+1)+'*'];\r\n          if (!str_tooltip) str_tooltip = str_hier(str,name,'') || '';\r\n          if (pref.test_mode.tips) str_tooltip = 'Name: ' + name + '\\n' + str_tooltip;\r\n          str_tooltip = str_tooltip.replace(/\\n/mg,'<br>').replace(/  /g,'&emsp;'); //  .replace(/^\\s|<br>\\s/g,'$&&ensp;'); // keep white space at its head, // https://developer.mozilla.org/ja/docs/Web/API/Document_Object_Model/Whitespace\r\n\r\n          if (name[0]==='#') return str['#*'](e, str_tooltip);\r\n//          if (name[0]==='#') {str['#*'](e, str_tooltip);return;}\r\n//          if (str_tooltip) show_1.call(this,e,str_tooltip);\r\n          return str_tooltip;\r\n        }\r\n//        function show_1(e,str_func, callback, info_tips){ // working code\r\n//          tooltip_kind = (info_tips)? 'info' : 'help';\r\n//          if (!pref.tooltips[tooltip_kind].show) return;\r\n//          tooltip.innerHTML = str_func;\r\n//          if (callback) callback(tooltip);\r\n//          if (hide_timer!==null) {clearTimeout(hide_timer);hide_timer=null;} // test\r\n//          if (!e || tooltip_on===e.target) return;\r\n//          tooltip.style.left = e.clientX + 20 + 'px';\r\n//          tooltip.style.top  = e.clientY + 20 + 'px';\r\n////          if (hide_timer!==null) {clearTimeout(hide_timer);hide_timer=null;}\r\n//          if (tooltip_on) tooltip_on.removeEventListener('mouseout' ,hide, false);\r\n//          else {\r\n//            if (show_timer!==null) clearTimeout(show_timer);\r\n//            show_timer = setTimeout(show_exe,pref.tooltips[tooltip_kind].popup_delay);\r\n//          }\r\n//          tooltip_on = e.target;\r\n//          tooltip_on.addEventListener('mouseout' , hide, false);\r\n//        }\r\n//        function show_exe(){\r\n//          show_timer = null;\r\n////          tooltip_set(tooltip_contents.str_func, tooltip_contents.e, tooltip_contents.callback);\r\n//          site.script_body.appendChild(tooltip);\r\n//          tooltip_shown = true;\r\n//        }\r\n//        function hide(){ // called from both event and external function.\r\n//          if (hide_timer===null) hide_timer = setTimeout(hide_exe,pref.tooltips[tooltip_kind].popdown_delay);\r\n//        }\r\n//        function hide_exe(){\r\n//          hide_timer = null;\r\n//          if (tooltip_shown) {\r\n//            tooltip.parentNode.removeChild(tooltip);\r\n//            tooltip_shown = false;\r\n//          }\r\n//          if (show_timer!==null) {clearTimeout(show_timer);show_timer=null;}\r\n//          if (tooltip_on) {\r\n//            tooltip_on.removeEventListener('mouseout' ,hide, false);\r\n//            tooltip_on = null;\r\n//          }\r\n//        }\r\n\r\n        var tooltip_e = null;\r\n        var tooltip_func = null;\r\n        function show_0(e){\r\n          var name = e.target.getAttribute('name');\r\n          var kind = (name && name[0]==='#')? 'info' : 'help'\r\n          if (pref.tooltips[kind].show) req_show(kind, e, show, kind==='help');\r\n        }\r\n        function req_show(kind, e, func, tack_req){\r\n          if (tack_displayed^tack_req) {tack_displayed = tack_req; tack.style.display = (tack_req)? null : 'none';}\r\n          tooltip_kind = kind;\r\n          var e_obj = {target:e.target, currentTarget:e.currentTarget, clientX:e.clientX, clientY:e.clientY};\r\n          if (!tooltip_on) {\r\n            if (show_timer!==null) clearTimeout(show_timer);\r\n            show_timer = setTimeout(show_exe2,pref.tooltips[kind].popup_delay);\r\n            tooltip_e = e_obj; // e;\r\n            tooltip_func = func;\r\n          } else if (show_2(e, func(e))) tooltip_e = e_obj;\r\n        }\r\n        function show_exe2(){\r\n          show_timer = null;\r\n          if (show_2(tooltip_e, tooltip_func(tooltip_e))) site.script_body.appendChild(tooltip);\r\n          else tooltip_e = null;\r\n          tooltip_func = null;\r\n        }\r\n        function show_2(e,contents){\r\n          if (!contents) {hide2();return false;}\r\n          if (typeof(contents)==='string') tooltip.firstChild.innerHTML = contents;\r\n          else {\r\n            tooltip.firstChild.innerHTML = contents.html;\r\n            if (contents.callback) contents.callback(tooltip.firstChild);\r\n          }\r\n          if (hide_timer!==null) {clearTimeout(hide_timer);hide_timer=null;}\r\n          if (e && tooltip_on!==e.target) {\r\n            tooltip.style.left = e.clientX + 20 + 'px';\r\n            tooltip.style.top  = e.clientY + 20 + 'px';\r\n            tooltip_on = e.target;\r\n          }\r\n          return true;\r\n        }\r\n//        function hide3(e){\r\n//          if (e.target===e.currentTarget) hide2(); // out from root\r\n//        }\r\n        function hide_if(pn){\r\n          if (tooltip_e && tooltip_e.currentTarget===pn) hide2();\r\n        }\r\n        function hide2(){ // called from both event and external function.\r\n          if (tooltip_e && hide_timer===null) {\r\n//          if ((tooltip_on || tooltip_e) && hide_timer===null) {\r\n            if (show_timer!==null) {clearTimeout(show_timer);show_timer=null;}\r\n            hide_timer = setTimeout(hide_exe2,pref.tooltips[tooltip_kind].popdown_delay);\r\n          }\r\n        }\r\n        function hide_exe2(){\r\n          hide_timer = null;\r\n          if (tooltip_on) {\r\n            tooltip.parentNode.removeChild(tooltip);\r\n            tooltip_on = null;\r\n            tooltip_e = null;\r\n          }\r\n        }\r\n        function keep_shown(e){\r\n          if (hide_timer!==null) {clearTimeout(hide_timer);hide_timer=null;}\r\n          tooltip_e.currentTarget = e.currentTarget;\r\n        }\r\n        \r\n        function str_hier(root,name){\r\n          if (!root) return null; // cancel if miss\r\n          var idx = name.indexOf('.');\r\n          return (idx==-1)? root[name] || root['*'] || null :\r\n                            str_hier(root[name.substr(0,idx)],name.substr(idx+1));\r\n        }\r\n//        function str_hier(root,name,str){ // working code.\r\n//          if (!root) return null; // cancel if miss\r\n//          var idx = name.indexOf('.');\r\n//          if (idx==-1 || root['*']) {\r\n//            var val = root[name] || root['*'];\r\n//            return (val)? str + name + ': ' + val : null; // cancel if miss\r\n//          } else {\r\n//            var pfx = name.substr(0,idx);\r\n//            return str_hier(root[pfx],name.substr(idx+1),str+pfx+'.');\r\n//          }\r\n//        }\r\n        var str = {\r\n//          'pn_catalog_triage': 'hide forever, hide until new replies, watch, unwatch, undo.\\n'+\r\n//                               'You can customize this in settings -> Catalog: Appearance (in top selector) -> Style:',\r\n////          'pn_catalog_triage': '1st row: Hide it forever.\\n2nd row: Hide it now, but it will appear again when the thread gets new replies,\\n' +\r\n////            '  and new replies are marked.\\n3rd row: Don\\'t hide it, just change its appearance.\\n' +\r\n////            'Each column shows appearance the thread will get.\\n' +\r\n////            'Don\\'t forget checking \\'Exclusive list\\' and \\'Attribute list\\' for using this function.\\n' +\r\n////            'In other words, you can appear it again by unckecking them.\\nAnd you can configure these appearance in \\'Attribute list\\' and \\'Triage styles\\'.',\r\n          'catalog_promiscuous': 'Gather information whatever.',\r\n          filter: {\r\n              kwd: {\r\n                ew: 'Exact word match.\\n \\'index\\' matches \\'index\\' but \\'indexing\\' if checked.\\n \\'index*\\' maches \\'index\\' and \\'indexing\\'.',\r\n                re: 'Regular Expression.',\r\n                ci: 'Case insensitive. Don\\'t distinguish upper and lower case.',\r\n                sentence: '\"XXXX YYYY\" matches itself as a whole instead of matching \"XXXX\" and/or \"YYYY\"',\r\n                inPost: 'In a post restriction.\\n all keywords must be in a post if checked.\\n No difference if one keyword.',\r\n              },\r\n              time: 'Time : Hide threads which have no posts after the time.',\r\n              time_creation: 'Time(Creation Time) : Hide threads which were created before the time.',\r\n              time_watch: 'Watch: watch threads which have posts after the time.',\r\n              time_watch_creation: 'Watch(Creation Time): watch threads which were created after the time.',\r\n          },\r\n//          'filter.time_mark': 'Mark: mark newer posts and scrool to them when it\\'s opened.',\r\n          'filter.tag_search.str': 'String for searching tags.\\n[CAUTION] this function is very heavy, keep blank here when you don\\'t use.',\r\n          'filter.tag_list': false,\r\n          'network.cross_domain': 'Use \\'direct\\' if you could, because it\\'s quite light, but it doesn\\'t work in almost of all environments.\\n\\'indirect\\' usually works well and gives full functionality.\\n\\Or you can use \\'GreaseMonkeyM\\'s extension if your browser tend to close steps for cross domain when you connect over X-Frame-Options, but this doesn\\'t provide localStorage/IDB features in remote domains.',\r\n          'debug_mode' : 'Debug mode.',\r\n          'show_tooltip' : 'Show this tooltip.',\r\n          'liveTag.rm_list_str': function(){return this.TagExLists();},\r\n          'liveTag.ex_list_str': function(){return this.TagExLists();},\r\n          'TagExLists': function(){return 'String, ...  or\\n/RegularExpression/, ... or \\nIdentifier:String, ... or \\nIdentifier:/RegularExpression/, ...\\n'+\r\n            '\\nRegularExpression must be embraced by shashes, and accepts i flag(case insensitive).\\n'+\r\n            'Identifier must be followed by :(colon). First colon is interpreted as a delimiter always. Put a colon at the head of line when you want to use colons in search strings for global search(without any identifiers)\\n'+this.GeneralRules;},\r\n          'catalog_board_list_str': function(){return 'How to write \\'Board groups\\'.\\n'+\r\n            '\\nNameOfBoardGroup,[Identifier, ...,][Commands, ...]\\n\\n'+\r\n            'Each line becomes each board group, one line per one board group.\\n'+\r\n            'First column is a name of board group. The name is shown in board selector and become a key for localStorage or statistics.\\n'+\r\n            'Second or later columns are identifiers or commands.\\n\\n'+\r\n            this.GeneralRules+\r\n            'Commands: \\n'+\r\n            '&emsp;#xx: include filter for the tag #xx\\n'+\r\n            '&emsp;##xx: pickup and include filter for the tag #xx\\n'+\r\n            '&emsp;!#xx: exclude filter for the tag #xx\\n'+\r\n            '&emsp;!stats: take statistics if the function is enabled.\\n'+\r\n            'Examples:\\n'+\r\n            '&emsp;CC, lain/\\u03bb/, #CatChan  // load lain/\\u03bb/ and filter by #CatChan, then shows a thread for CatChan in lain/\\u03bb/.\\n'+\r\n            '&emsp;lain#lainchan, lain, #lainchan  // load all boards of lain and filter by #lainchan, then show all threads which have the tag(#lainchan).\\n'+\r\n            '&emsp;#tech, ##tech  // load all boards which have #tech from sites which are set in VirtualBoard, and filter by #tech, then show all threads which have the tag(#tech) from sites.\\n';},\r\n          get GeneralRules(){return this.CommentDS + this.Identifier;},\r\n          'CommentDS': 'Comment:\\n  Double slash(//) is a beginning of comment.\\n',\r\n          'Identifier': 'Identifier:\\n'+\r\n            '  Identifier is a string which contains domain, board and/or thread.\\n'+\r\n            '  Any parts of identifier can be omitted.\\n'+\r\n            '  If all parts of identifier are omitted, it means \\'for all\\'\\n'+\r\n            '  Board identifier must be enclosed by slashes, like /a/.\\n'+\r\n            '  Thread identifier must be numeric.\\n'+\r\n            '  Otherwise, it is taken to be a domain identifier.\\n'+\r\n            '  Domain identifier must be one of '+site0.domains.slice(0,-1).join(', ')+' and '+site0.domains.slice(-1)+'.\\n'+\r\n            '  When some identifiers are omitted, it\\'ll be interpreted as follows. Top has the priority.\\n'+\r\n            '    domain/board/thread\\n'+\r\n            '    /board/thread\\n'+\r\n            '    domain/thread\\n'+\r\n            '    thread\\n'+\r\n            '    domain/board/\\n'+\r\n            '    /board/\\n'+\r\n            '    domain\\n',\r\n          'StyleString': 'StyleString:\\n  StyleString is set to object.style.XXXX directly.\\n  You can use all of styles in CSS, which has \\'background\\', \\'border\\', \\'fontSize\\', \\'opacity\\', \\'width\\' and \\'height\\'.\\n  Delimiter is a semicolon as well as CSS, and you can use \\'!important\\' also.\\n',\r\n          'catalog.style_general_list_str': function(){return '[Identifier][;StyleString][;StyleCommand]\\n  (NOTE: There must be a delimiter \";\" even if whole identifier is omitted)\\n\\n'+this.GeneralRules+this.StyleString+this.StyleCommand;},\r\n          'StyleCommand': 'StyleCommand:\\n  STICKY[:false] // sticky or unsticky.\\n  SHOW // the thread is shown always when keyword filter is not active. (ignore tag/time/list filters)\\n',\r\n//            'About Identifier, see \\'board group\\'.',\r\n          'catalog.board.recommendation' : 'Scans \\'board announcement\\' and gets owner\\'s recommendation. This recommendation must be start \\'Recommendation: \\', and the following part of the line is treated as a line of board groups. The recommendation can be seen in a last line of board groups.',\r\n          'cli.eval_str' : 'For developers. This function is killed by security reason. If you want to use, you must uncomment the function \\'pref_func.site2_eval\\' by yourself.',\r\n//          'thread_reader.buttons.B' : 'Bookmark this thread to current catalog.',\r\n//          'thread_reader.buttons.UB': 'Unbookmark this thread from current catalog.',\r\n//          'thread_reader.buttons.X' : function(){return 'Kill this thread from parent catalog' + ((pref.thread_reader.triage_close)? ', and close.' : '.');},\r\n//          'thread_reader.buttons.v' : function(){return 'Hide this thread from parent catalog untill it gets new posts' + ((pref.thread_reader.triage_close)? ', and close.' : '.');},\r\n          'catalog_open_where' : 'this tab: open the thread in this tab, and catalog will be closed.\\nnew tab always: this enables you to open a thread in multiple tabs.\\nnamed tab: this prevents you from opening a thread in multiple tabs.\\na fixed tab: this enables you to use a catalog window as a dashboard.',\r\n          'virtualBoard.scan_domains.*': 'None: Don\\'t scan.\\nBoard: Read boards.json and set them to boardlist, not scan threads at startup. Threads are scanned when you read them.\\nThread: Scan all threads at startup.',\r\n          'scanBoard': 'Scan selected virtual boards.\\nScan this physical board if no virtual board is selected.',\r\n          'scanSite': 'Scan all virtual boards.\\nScan all boards in this site if no virtual board is selected.',\r\n          'style.fix.*': 'Write style strings.',\r\n          'style.copy.*': 'Write exact selectorText in CSS, then its styles are copied.',\r\n          debug_mode:['pipe','','removed threads from catalog'],\r\n          dummy: '',\r\n          archive: {kwd: null},\r\n          '#*': function(e, str){return liveTag.tooltip(e, str);},\r\n        };\r\n        str.archive.kwd = str.filter.kwd;\r\n        str['filter.tag_search.re'] = str.filter.kwd.re;\r\n//        Object.defineProperty(str,'catalog_triage_str',{value:str['catalog_triage_str'], enumerable:true, configurable:true, writable:false});\r\n        return {\r\n          add_root: function(elem){\r\n            elem.addEventListener('mouseover', show_0, false);\r\n            elem.addEventListener('mouseleave', hide2, false);\r\n          },\r\n          remove_root: function(elem){\r\n            elem.removeEventListener('mouseover', show_0, false);\r\n            elem.removeEventListener('mouseleave', hide2, false);\r\n          },\r\n          show: show,\r\n//          show_1: show_1,\r\n//          hide: hide,\r\n          str: str,\r\n          req_show:req_show,\r\n          hide2: hide2,\r\n          show_2: show_2,\r\n          hide: hide2,\r\n          hide_if: hide_if,\r\n        };\r\n  })();\r\n\r\n  var Triage = site0.isStep? null : (function(){ // pref_func.tooltips for iframe\r\n      var tooltips = {\r\n        KILL: 'Hide this thread permanently, and set style',\r\n        TIME: 'Hide this thread until it gets new replies, and set style',\r\n        NONE: 'Delete \"hidden\" mark and set style',\r\n        KILL_N: 'Hide this thread permanently',\r\n        TIME_N: 'Hide this thread until it gets new replies',\r\n        ATTR: 'Set style additionally',\r\n        WATCH: 'Watch and mark as I\\'ve read all posts so far',\r\n        UNWATCH: 'Delete \"watched\" mark',\r\n        SHOW: 'Show always without regard to filter',\r\n        UNSHOW: 'Remove \"show\" mark',\r\n        STICKY: 'Sticky this thread',\r\n        UNSTICKY: 'Unsticky this thread',\r\n        GO: 'Open this thread',\r\n        UNDO: 'Undo last modification', // . Effective to commands above',\r\n        ARC1: 'Take an archive (one-shot archive)',\r\n        ARC: 'Start archiving this thread',\r\n        UNARC: 'Stop archiving this thread',\r\n        MERGEB: 'Mark as marge base',\r\n        MERGE: 'Merge this thread with merge base',\r\n        MERGEOP: 'Merge all threads in OP',\r\n//        MERGEN: 'Merge with near thread',\r\n//        MERGEC: 'Issue merge command',\r\n//        MERGECR: 'Issue merge command (reverse merge)',\r\n//        MERGECU: 'Issue unmerge and merge command',\r\n        UNMERGE: 'Unmerge this thread',\r\n        UNDOMERGE: 'UNDO last merge operation',\r\n//        UNMERGELV: 'Unmerge level this thread',\r\n        SPC: 'Spacer for caption. Nothing happen',\r\n        MENU: 'Open menu',\r\n        PMENU: 'Open post menu',\r\n        EXPAND: 'Expand following triages',\r\n        PWATCH: 'Mark as I\\'ve read all posts before this',\r\n        PHIDE: 'Hide this post',\r\n        PHIDEAFTER: 'Hide this post and posts which replies to this post',\r\n        PUNHIDE: 'Unhide this post',\r\n        PDISABLEHIDE: 'Disable hide function; Shows all posts temporarily',\r\n        PENABLEHIDE: 'Enable hide function; Hide hidden marked posts again',\r\n        PCLEARHIDE: 'Clear hide list and show all posts',\r\n//        '*m': 'apply style to members at headline view',\r\n//        '*s': 'force single target',\r\n      };\r\n      Tooltips.str['triage'] = function(e){\r\n        var cmd = e.target.getAttribute('data-cmd');\r\n        var attr = e.target.getAttribute('data-attr');\r\n        var style = ['NONE','ATTR','KILL','TIME'].indexOf(cmd)!==-1;\r\n        return (tooltips[cmd]+'.') + (style? '\\nSet style '+(attr || 'default') + '.' : '');\r\n      };\r\n      var Triage = function(str,args){\r\n        var func_onclick = (args.onclick)? this.prep_func_onclick(args.onclick) : null;\r\n        var format_tgt = [];\r\n//        var brs = [];\r\n        var tag = args.embed? 'span' : 'div';\r\n        var toggles = ['WATCH','UNWATCH','SHOW','UNSHOW','STICKY','UNSTICKY','ARC','ARC1','UNARC'];\r\n        var pn = cnst.dom('<'+tag+(args.style? ' style=\"'+args.style+'\"':'')+' class=\"'+pref.script_prefix+'_'+(args.class || 'triage')+'\"></'+tag+'>');\r\n        this.pn  = pn;\r\n        Tooltips.add_root(pn);\r\n        var lines = str.replace(/\\s*\\/\\/.*/mg,'').split('\\n').filter(function(v){return v;});\r\n//        for (var i=lines.length-1;i>=0;i--) if (lines[i]==='') lines.splice(i,1);\r\n//        var triage_style_replace_list = (!brwsr.ff)? ['background','background-color'] : [];\r\n        for (var i=0;i<lines.length;i++) {\r\n          if (i!=0 && !args.menu) /*brs[brs.length] =*/ pn.appendChild(document.createElement('br'));\r\n          var str = lines[i].replace(/,\\s*$/,'').split(','); // allow last comma\r\n          for (var j=0;j<str.length;j+=3) {\r\n            if (str[j]==='SPC') {pn.appendChild(document.createTextNode(str[j+1])); continue;}\r\n            if (str[j]==='EXPAND') {pn = cnst.doms_insertBefore(pn,'<a class=\"CatChan_button\" name=\"SHOW\" data-str=\"'+str[j+2]+'\">'+str[j+1]+'</a><span style=\"display:none\"></span>',null); continue;}\r\n            var btn = args.embed? document.createElement('a') : cnst.dom('<button name=\"triage\" type=\"button\"></button>');\r\n            btn.textContent = str[j+1];\r\n            if (!args.embed && str[j]!=='MERGEC') btn.setAttribute('style','pointer-events:auto;'+(args.child_style || '')+str[j+2]);\r\n            if (args.child_class) btn.setAttribute('class',pref.script_prefix+'_'+args.child_class);\r\n            btn.setAttribute('data-cmd',str[j]);\r\n            if (str[j+2]) btn.setAttribute('data-attr',str[j+2]);\r\n//            var triage_styles = (str[j+2])? str[j+2].split(';') : [];\r\n//            for (var k=0;k<triage_styles.length;k++) {\r\n//              var style_str = triage_styles[k].replace(/:.*/,'');\r\n//              for (var m=0;m<triage_style_replace_list.length;m+=2) style_str = style_str.replace(triage_style_replace_list[m],triage_style_replace_list[m+1]);\r\n//              btn.style[style_str] = triage_styles[k].replace(/[^:]*:/,'');\r\n//            }\r\n//            btn.onclick = triage_factory(i,j);\r\n            if (func_onclick) btn.onclick = func_onclick;\r\n            if (args.onmousewheel) btn['on'+brwsr.mousewheel] = args.onmousewheel;\r\n//            if (pn.name) pref_func.tooltips.str[btn.name] = ((tooltips[str[j]])? tooltips[str[j]][0] +\r\n//                                                                       ((tooltips[str[j]][1])? '\\nSet style ' + ((str[j+2])? str[j+2] : 'default') + '.' : '') : '');\r\n            if (args.menu) {\r\n              var menu = document.createElement('div');\r\n              menu.appendChild(btn);\r\n              menu.appendChild(document.createElement('br'));\r\n              btn = menu;\r\n            }\r\n            pn.appendChild(btn);\r\n            if (toggles.indexOf(str[j])!=-1) format_tgt[format_tgt.length] = [btn, str[j]];\r\n          }\r\n        }\r\n////        pn.onclick = function(e){  // also works, but CSS is the better.\r\n////          e.preventDefault();\r\n////          var evt = document.createEvent('MouseEvents');\r\n////          evt.initUIEvent('click', false, true, window, 1);\r\n////          threads[pn12_triage_thread][0].dispatchEvent(evt);\r\n////        };\r\n////        this.str = str;\r\n//        this.pn  = pn;\r\n        this.format_tgt = (format_tgt.length!==0)? format_tgt : null;\r\n////        this.brs = brs;\r\n//        Tooltips.add_root(pn);\r\n      };\r\n      Triage.prototype.destroy = function(){Tooltips.remove_root(this.pn);};\r\n      Triage.prototype.tooltips = tooltips;\r\n      Triage.prototype.et2tr = function(et){\r\n        return {cmd: et.getAttribute('data-cmd'), attr: et.getAttribute('data-attr')||''};\r\n      };\r\n      Triage.prototype.prep_func_onclick = function(func){\r\n        return function(e){\r\n          e.stopPropagation();\r\n          var tr = Triage.prototype.et2tr(e.target);\r\n          if (tr.cmd && tr.cmd!=='SPC') func(tr.cmd, tr.attr, e.target);\r\n        };\r\n      };\r\n      Triage.prototype.howto = 'How to describe triage:\\n\\n'+\r\n        'Each line will be each line of triage.\\n'+\r\n        '1st column: command\\n'+\r\n      ['KILL','TIME','NONE','KILL_N','TIME_N','ATTR','WATCH','UNWATCH','STICKY','UNSTICKY','SHOW','UNSHOW','UNDO','GO','ARC1','ARC','UNARC','MERGEB','MERGE','MERGEOP','UNMERGE','UNDOMERGE','SPC','MENU','EXPAND'].map(\r\n            function(v){return '  '+v+': '+tooltips[v]+(v==='UNDO'? '. Effective to commands above' : '') + '.\\n';}).join('')+\r\n        '2nd column: caption on the triage button.\\n'+\r\n        '3rd column: style applied to the thread.\\n'+\r\n        'Repeat these as you wish.\\n'+\r\n        'Sample loader will help you to understand.\\n';\r\n      Triage.prototype.MERGEE_button_html = ' <a class=\"'+pref.script_prefix+'_button\" data-type=\"triage\" data-cmd=\"MERGEE\">[M]</a>';\r\n      Triage.prototype.doms = null;\r\n      return Triage;\r\n//      var format_tgt = []; // working code\r\n//      var toggles = ['WATCH','UNWATCH','SHOW','UNSHOW','STICKY','UNSTICKY','ARC','ARC1','UNARC'];\r\n//      var pn = document.createElement('div');\r\n//      pn.name = (args.name)? args.name : '';\r\n////        pn_triage.style.position = 'absolute';\r\n////        pn_triage.name = 'pn_catalog_triage';\r\n//      pn.className = 'catalog_triage_parent';\r\n//      var lines = str.replace(/\\s*\\/\\/.*/mg,'').split('\\n');\r\n//      str = [];\r\n//      for (var i=lines.length-1;i>=0;i--) if (lines[i]==='') lines.splice(i,1);\r\n//      var triage_style_replace_list = (!brwsr.ff)? ['background','background-color'] : [];\r\n//      for (var i=0;i<lines.length;i++) str[i] = lines[i].split(',');\r\n//      for (var i=0;i<str.length;i++) {\r\n//        for (var j=0;j<str[i].length;j+=3) {\r\n//          var triage_button = document.createElement('button');\r\n//          triage_button.innerHTML = str[i][j+1];\r\n//          triage_button.name = pn.name + '('+i+','+j+')';\r\n//          triage_button.className = 'catalog_triage_button';\r\n//          triage_button.type = 'button';\r\n//          var triage_styles = (str[i][j+2])? str[i][j+2].split(';') : [];\r\n//          for (var k=0;k<triage_styles.length;k++) {\r\n//            var style_str = triage_styles[k].replace(/:.*/,'');\r\n//            for (var m=0;m<triage_style_replace_list.length;m+=2) style_str = style_str.replace(triage_style_replace_list[m],triage_style_replace_list[m+1]);\r\n//            triage_button.style[style_str] = triage_styles[k].replace(/[^:]*:/,'');\r\n//          }\r\n////            triage_button.onclick = triage_factory(i,j);\r\n//          triage_button.onclick = args.onclick;\r\n//          pn.appendChild(triage_button);\r\n//          if (args.wheelpatch) triage_button.onmousewheel = args.wheelpatch;\r\n//          if (pn.name) pref_func.tooltips.str[triage_button.name] = ((tooltips[str[i][j]])? tooltips[str[i][j]][0] +\r\n//                                                                     ((tooltips[str[i][j]][1])? '\\nSet style ' + ((str[i][j+2])? str[i][j+2] : 'default') + '.' : '') : '');\r\n//          if (toggles.indexOf(str[i][j])!=-1) format_tgt[format_tgt.length] = [triage_button, str[i][j]];\r\n//        }\r\n//        pn.appendChild(document.createElement('br'));\r\n//      }\r\n////        pn.onclick = function(e){  // also works, but CSS is the better.\r\n////          e.preventDefault();\r\n////          var evt = document.createEvent('MouseEvents');\r\n////          evt.initUIEvent('click', false, true, window, 1);\r\n////          threads[pn12_triage_thread][0].dispatchEvent(evt);\r\n////        };\r\n//      this.str = str;\r\n//      this.pn  = pn;\r\n//      this.format_tgt = (format_tgt.length!==0)? format_tgt : null;\r\n  })();\r\n\r\n  var timer_obj;\r\n  var chart_obj;\r\n  var setting_obj;\r\n//  var wafd = null;\r\n  var catalog_obj;\r\n  var cnst_obj = (function(){\r\n    site.script_body = document.createElement('div');\r\n    site.script_body.className = pref.script_prefix;\r\n    site.script_body.innerHTML = '<div style=\"display:none\"></div><div></div>';\r\n    site.popup_body = site.script_body.childNodes[1];\r\n    site.root_body.appendChild(site.script_body);\r\n    var sf = site.features;\r\n    var pf = pref.features;\r\n    if (sf.postform && pf.postform && !(site.postform!=null || site2[site.nickname].postform.activation)) {\r\n      var draft = document.createElement('div');\r\n      draft.innerHTML = '<div><textarea style=\"height:5em;display:none\" cols=\"20\" name=\"' + pref.script_prefix + '_draft\"></textarea><button name=\"' + pref.script_prefix + '_send\" style=\"display:none\">send</button></div>'; // <div> was added for tack_float\r\n      site.script_body.appendChild(draft);\r\n      draft = draft.childNodes[0];\r\n      site.components['postform_comment'] = draft.childNodes[0];\r\n      site.postform = site.components['postform_comment']; // redundant. need to be cleaned up.\r\n      site.components['postform_submit'] = draft.childNodes[1];\r\n    }\r\n    if (site.settings) {\r\n      site.settings.innerHTML = '<span>[CC</span><span></span>]';\r\n      site.settings.setAttribute('style','float:right;');\r\n      var pn_st = site.settings.childNodes[1];\r\n      site.settings.childNodes[0].setAttribute('style','cursor:pointer');\r\n      site.settings.childNodes[0].onclick = function(){cnst.show_hide(pn_st);};\r\n      site.settings.childNodes[1].setAttribute('style','display:none');\r\n    }\r\n    function make_button(str){\r\n      return cnst.init2({func_str:'tile:get:left:tile:get:bottom:button:'+str+':Show2:tile:set:left',pn_st:pn_st});\r\n    }\r\n    if (sf.setting && pf.setting) make_button('settings').addEventListener('click', pref_func.settings.show_hide, false);\r\n    if (sf.catalog && pf.catalog) {\r\n      catalog_obj = make_catalog_obj(pref[site.whereami] && pref[site.whereami].embed && pref.test_mode['114']? null : make_button('Watcher'));\r\n//      catalog_obj = make_catalog_obj(pref[site.whereami] && pref[site.whereami].embed? (!pref.test_mode['114']? make_button('Watcher') : null) : make_button('Catalog'));\r\n      if (pref.catalog.embed && site.whereami==='catalog') var func_frame = site2[site.nickname].catalog_native_frame_prep(make_button('Frame'));\r\n    }\r\n    if (!pref.test_mode['94']) cnst.tile_set_left();\r\n    chart_obj = make_chart_obj((sf.graph && pf.graph && pref3.stats.use)? make_button('Graph') : null);\r\n    if (sf.setting2 && pf.setting2) setting_obj = make_setting_obj(make_button('settings2'));\r\n    if (sf.postform && pf.postform && (site.postform!=null || site2[site.nickname].postform.activation)) {\r\n//      wafd = make_wafd();\r\n      var post_form_func = make_post_form_obj(make_button(draft?'Draft':'PostForm'));\r\n    }\r\n    if (sf.debug && pf.debug) {\r\n      var debug_func = make_debug_obj(make_button('debug'));\r\n//  var pn_debug_out    = cnst.init('left:200px:bottom:50px:txt:debug_out');\r\n    }\r\n    if (sf.page && pf.page) {\r\n//      var pn0 = cnst.init('tile:get:left:tile:get:bottom:txt:init:Show2:tile:set:bottom');\r\n      var pn0 = cnst.init2({func_str:'tile:get:left:tile:get:bottom:txt:init:Show2',pn_st:pn_st});\r\n      timer_obj  = make_timer_obj(pn0);\r\n    }\r\n    cnst.tile_set_bottom();\r\n    if (sf.catalog && pf.catalog) if (pref.catalog.board.board_tags_same) pref_func.settings.onchange_funcs['tag.same_tag_refresh']();\r\n\r\n    if (site.settings3) {\r\n      var onclick_funcs = {\r\n        CC: function(e){cnst.show_hide(e.target.previousSibling);},\r\n        entry: function(e){if (e.target.tagName==='A') onclick_funcs[e.target.textContent](e);},\r\n        Settings: pref_func.settings.show_hide,\r\n        Watcher: catalog_obj && catalog_obj.show_hide,\r\n        Frame: func_frame,\r\n        Graph: chart_obj && chart_obj.make,\r\n        Draft: post_form_func,\r\n        PostForm: post_form_func,\r\n        debug: debug_func,\r\n      };\r\n      site.settings3.innerHTML = '<span style=\"float:right\">[<span style=\"display:none\">'+\r\n                                (sf.setting && pf.setting? '<a>Settings</a> ':'')+\r\n                                (sf.catalog && pf.catalog? '<a>Watcher</a> ':'')+\r\n                                (sf.catalog && pf.catalog && pref.catalog.embed && site.whereami==='catalog'? '<a>Frame</a> ':'')+\r\n                                (sf.graph && pf.graph && pref3.stats.use? '<a>Graph</a> ':'')+\r\n                                (sf.postform && pf.postform && (site.postform!=null || site2[site.nickname].postform.activation)? '<a>'+(draft?'Draft':'PostForm')+'</a> ':'')+\r\n                                (sf.debug && pf.debug? '<a>debug</a> ':'')+\r\n        '</span><a>CC</a>]</span>';\r\n      site.settings3.setAttribute('style','float:right;');\r\n      site.settings3.addEventListener('click',onclick_funcs.entry,false);\r\n    }\r\n    \r\n  })();\r\n\r\n  function make_uip_tracker (){\r\n//    var base_thread = site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'thread_html', {thread:site.no})[0];\r\n////    site.thread = site.get_ops(document)[0];\r\n////    var url = site.protocol + '//a.4cdn.org' + site.board +'thread/' + site.thread + '.json';\r\n////    var url2= site.protocol + '//a.4cdn.org' + site.board +'catalog.json';\r\n////    var url = site2[site.nickname].get_json_url_thread(site.board,site.thread);\r\n//    var url2= site2[site.nickname].get_json_url_catalog(site.board);\r\n//    var key = site.nickname + site.board + site.no;\r\n    var post_uip = [];\r\n    var last_updated = [0,1,1]; //no,posts,uips\r\n    var posts_old = {};\r\n    var uip_tracker_id;\r\n    uip_check();\r\n//    function uip_check(){http_req.get('uip',key,url,uip_show,false,false);}\r\n    function uip_check(){\r\n      uip_tracker_id = null;    \r\n      site2[site.nickname].uip_check(uip_show, sage_detect);\r\n    }\r\n//    if (pref.debug_mode['0']) { // for debug\r\n////      window.addEventListener('load',function(){console.log(new Date().toLocaleTimeString()+': load_event');},false); // can't get.\r\n////      window.addEventListener('DOMSubtreeModified',function(){console.log(new Date().toLocaleTimeString()+': DOMSubtreeModified');},false); // get too much because of root.\r\n//      site2[site.nickname].catalog_threads_in_page(document)[0].addEventListener('DOMSubtreeModified',function(){console.log(new Date().toLocaleTimeString()+': DOMSubtreeModified');},false); // ok.\r\n//    }\r\n\r\n    var observer = new MutationObserver(uip_show_from_doc);\r\n    observer.observe(site.myself.pn, {childList: true});\r\n//    function add_dom_event_listener(){\r\n//      observer.observe(site.myself.pn, {childList: true});\r\n//    }\r\n//    function remove_dom_event_listener(){\r\n//      observer.disconnect();\r\n//    }\r\n//    add_dom_event_listener();\r\n\r\n    var auto_open = (function(){\r\n      var threads = {};\r\n      var threads_req = {};\r\n      var threads_opened = {};\r\n      var max_no = site.no;\r\n      function auto_open_prep(key,value){\r\n//        var dbt = key.split(','); // for universal\r\n//        var ths = site2[dbt[0]].wrap_to_parse.get(value.response, dbt[0], dbt[1], dbt[3]);\r\n//        for (var i=0;i<ths.length;i++) {\r\n//          var th = ths[i];\r\n        var obj = value.response; // 4chan or 8chan only\r\n        for (var i=0;i<obj.length;i++) for (var j=0;j<obj[i].threads.length;j++) {\r\n          var th = obj[i].threads[j];\r\n          threads[th.no] = {sub:th.sub, name:th.name, com:th.com}; // for reducing memory consumption\r\n          if (max_no<th.no) max_no = th.no;\r\n        }\r\n//        var obj = site2[site.nickname].parse_json_catalog(value.responseText);\r\n//        for (var i=0;i<obj.length;i++) {\r\n//          for (var j=0;j<obj[i].threads.length;j++) {\r\n//            var no = obj[i].threads[j].no;\r\n//            threads[no] = {};\r\n//            threads[no].sub = obj[i].threads[j].sub;\r\n//            threads[no].com = obj[i].threads[j].com;\r\n//            if (max_no<no) max_no=no;\r\n//          }\r\n//        }\r\n        auto_open_check();\r\n      }\r\n      function auto_open_check(){\r\n        var rx = new RegExp(pref.uip_tracker.auto_open_kwd || '.*');\r\n        for (var i in threads_req) {\r\n          var th = threads[i];\r\n          if (th && i>site.no && threads_opened[i]===undefined) {\r\n            if (th.sub && th.sub.search(rx)!=-1 || th.name && th.name.search(rx)!=-1 || th.com && th.com.search(rx)!=-1) {\r\n              window.open(site2[site.nickname].make_url4([site.nickname, site.board, i, 'thread_html'])[0], '_blank');\r\n  //            window.open(site2[site.nickname].make_url3(site.board,i), '_blank');\r\n              threads_opened[i] = i;\r\n            }\r\n            delete threads_req[i];\r\n          } else if (max_no>i || threads_req[i]--<=0) delete threads_req[i];\r\n        }\r\n      }\r\n      return function(posts, posts_new, posts_old){\r\n        var i=posts.length-1;\r\n        while (i>=1 && i>=pref.uip_tracker.auto_open_th && posts_old[posts[i].no]===undefined) i--; // don't check OP\r\n        if (i==posts.length-1) return;\r\n        var pn_test = document.createElement('span');\r\n        while (++i<posts.length) {\r\n          pn_test.innerHTML = posts[i].com;\r\n          var pn_a = pn_test.getElementsByTagName('a');\r\n          for (var j=0;j<pn_a.length;j++) {\r\n            var tgt = pn_a[j].textContent.match(/>>([0-9]+)$/);\r\n            if (!tgt) continue; else tgt = tgt[1];\r\n            if (posts_new[tgt]!==undefined || posts_old[tgt]!==undefined) continue; // invoke redundant check if ahchor refers deleted posts\r\n  //        var flag = true;\r\n  //        var tgt = pn_a[j].textContent.substr(2);\r\n  //        for (var k=0;k<nof_posts.length;k++) if (posts[k].no==tgt) {flag=false;break;}\r\n  ////        if (flag) console.log('auto_opener: '+tgt);\r\n            threads_req[tgt] = 3; // check 3 times for non-coherency not between catalog and threads\r\n          }\r\n        }\r\n        auto_open_check();\r\n        if (Object.keys(threads_req).length!=0) http_req.get('uip_auto',[site.nickname,site.board,site.no,'catalog_json'].join(),'',auto_open_prep);\r\n      };\r\n    })();\r\n                       \r\n    function uip_show(key,value){ // from http\r\n      uip_show_2(key,value,true);\r\n    }\r\n    function uip_show_from_doc(e){ // from document\r\n //     uip_show_2(Date.now(),1200,'',false);\r\n      if (post_uip.length!=0) uip_show_3();\r\n      else if (time_req + interval > Date.now() + pref.uip_tracker.interval*1000) {\r\n        clearTimeout(uip_tracker_id);\r\n        waste_count = 0;\r\n        uip_retry();\r\n      }\r\n    }\r\n    function uip_show_3(){  // show\r\n//      remove_dom_event_listener();\r\n      for (var i=0;i<post_uip.length;i++) {\r\n        var tgt_uip = post_uip[i];\r\n        var no = tgt_uip[0];\r\n        var tgt_post = site2[site.nickname].uip_tgt_post(no);\r\n        if (tgt_post) {\r\n          var pn_uip = document.createElement('span');\r\n          pn_uip.innerHTML = ' (<span>'+tgt_uip[2]+'</span>)';\r\n          if (tgt_uip[4]) pn_uip.childNodes[1].setAttribute('style',pref.uip_tracker.highlight_str);\r\n          if (pref.uip_tracker.posts) {\r\n            var pn_posts = document.createElement('span');\r\n            pn_posts.innerHTML = '<span>'+ tgt_uip[1] +'</span>' + ((tgt_uip[5] && pref.uip_tracker.deletion.show)? '('+(\r\n              pref.uip_tracker.deletion.link? tgt_uip[5].map(function(v){return '<a href=\"#p'+v+'\" class=\"quotelink\">&gt;&gt;'+v+'</a>';}) : tgt_uip[5]).join()+')' : '') + '/';\r\n            if (tgt_uip[3]) pn_posts.childNodes[0].setAttribute('style',pref.uip_tracker.highlight_str);\r\n            pn_uip.insertBefore(pn_posts,pn_uip.childNodes[1]);\r\n          }\r\n          if (tgt_uip[5] && (pref.uip_tracker.deletion.name || pref.uip_tracker.deletion.addName || pref.uip_tracker.deletion.post))\r\n            for (var j=0;j<tgt_uip[5].length;j++) sage_annotate({no:tgt_uip[5][j]},pref.uip_tracker.deletion,true);\r\n          if (pref.uip_tracker.sage.page) {\r\n            var pn_page = document.createElement('span');\r\n            if (!page_his[no]) page_his[no] = {pn:pn_page, his:[]};\r\n            else {\r\n              page_his[no].pn = pn_page;\r\n              if (page_his[no].his.length>0) show_page(page_his[no]);\r\n            }\r\n            pn_uip.insertBefore(pn_page,pn_uip.lastChild);\r\n          }\r\n          var post_nums = site2[site.nickname].uip_post_num(tgt_post);\r\n          post_nums[post_nums.length-1].appendChild(pn_uip);\r\n          if (!pn_first && i==0) pn_first = [pn_uip, tgt_uip];\r\n          post_uip.splice(i--,1);\r\n        }\r\n      }\r\n//      sage_detect(); // require to merge this with catalog, format_html.update_draw runs after this and removes style of post.pn.\r\n//      add_dom_event_listener();\r\n    }\r\n    function uip_show_2(key,value,from_http){ // from http and doc\r\n//console.log(new Date(value.date).toLocaleTimeString()+', IN, '+from_http);\r\n      waste_count++;\r\n      if (value.status==200) {\r\n//        var obj = JSON.parse(value.responseText);\r\n        var posts = site2[site.nickname].parse_json_thread(('response' in value)? value.response : JSON.parse(value.responseText),from_http).posts;\r\n        var nof_posts = posts.length;\r\n        var uips = posts[nof_posts-1]['unique_ips'] || last_updated[2];\r\n        var last_no = posts[nof_posts-1]['no'];\r\n        if (last_updated[0]!=last_no || last_updated[1]!=nof_posts || last_updated[2]!=uips) {\r\nif (pref.debug_mode['31']) console.log(new Date(value.date).toLocaleTimeString()+', '+last_no+', '+nof_posts+', '+uips);\r\n          var posts_new = {};\r\n          for (var i=0;i<posts.length;i++) posts_new[posts[i].no] = null;\r\n          if (pref.uip_tracker.auto_open && last_updated[0]!=0) auto_open(posts, posts_new, posts_old);// last_updated[0]!=0 blocks initial trial.\r\n          var post_hilight = (posts.length<last_updated[1] || posts[last_updated[1]-1]['no']!=last_updated[0]);\r\n          if (pref.uip_tracker.deletion.show || pref.uip_tracker.deletion.name || pref.uip_tracker.deletion.addName || pref.uip_tracker.deletion.post) {\r\n            var posts_deleted = [];\r\n            for (var i in posts_old) if (posts_new[i]===undefined) posts_deleted[posts_deleted.length] = i;\r\nif (pref.debug_mode['31'] && posts_deleted!=='') console.log('uip_deleted '+posts_deleted);\r\n          }\r\n          last_updated = [last_no,nof_posts,uips,post_hilight,last_updated[2]!=uips, (posts_deleted.length!=0)? posts_deleted : null];\r\n          post_uip.push(last_updated);\r\n          waste_count = 0; // pass here always at first.\r\n          posts_old = posts_new;\r\n        }\r\n        uip_show_3();\r\n        var p0 = posts[0];\r\n      }\r\n      if (value.status==404 || (p0 && (p0['archived'] || p0['closed']))) uip_tracker_destroy();\r\n      else uip_retry();\r\n    }\r\n    var waste_count = 0;\r\n    var interval = 0;\r\n    var time_req = 0;\r\n    function uip_retry(){\r\n      if (pref.uip_tracker.on) {\r\n        interval = (interval===0 || waste_count==0 || !pref.uip_tracker.adaptive)? ((pref.uip_tracker.interval>10)? pref.uip_tracker.interval : 10)*1000 // waste_count===0 always at initial. // interval===0 prevent from causing inifinite loop when !uip_first in annotate_from_catalog.\r\n                 : (waste_count%8==0)? ((interval>=1800000)? 3600000 : interval*2)\r\n                 : interval;\r\n        uip_tracker_id = setTimeout(uip_check,interval);\r\n        time_req = Date.now();\r\n      } else uip_tracker_destroy();\r\n    }\r\n    var pn_first = null;\r\n    function annotate_from_catalog(vals){\r\n      if (vals[0]==='page') {\r\n        var his = JSON.parse(vals[1]);\r\n        for (var i in his) page_his[i] = {pn:null, his:his[i]};\r\n        return;\r\n      }\r\n      if (vals[0]==='sage') {\r\n        sage_detect({posts:vals.map(function(v){return {no:v, email:'sage'};})}); // posts[0].no==='sage', but posts[0] will be ignored.\r\n        return;\r\n      }\r\n      var uip_first = (pn_first)? pn_first[1] : (post_uip.length!=0)? post_uip.splice(0,1)[0] : null;\r\n      for (var i=0;i<vals.length;i+=3) post_uip[post_uip.length] = [vals[i], vals[i+1], vals[i+2], false, vals[i+1]==vals[i+2] || i>=3 && vals[i+2]!=vals[i-1], null];\r\n      if (pref.uip_tracker.sage.page) {\r\n        var nos = {};\r\n        for (var i=0;i<post_uip.length;i++) nos[post_uip[i][0]] = null;\r\n        for (var i in page_his) if (nos[i]===undefined) post_uip.splice(post_uip.length-1,0,[i, '?', '?', false, false, null]);\r\n      }\r\n      if (!uip_first) {\r\n        last_updated = post_uip[post_uip.length-1]; // RACING CONDITION. this is faster than network access usually.\r\n        pn_first = true;\r\n      } else {\r\n//        console.log('Hit: uip_tracker: racing condition');\r\n        var uip_last = post_uip[post_uip.length-1];\r\n        if (uip_last[0]!=uip_first[0] || uip_last[1]!=uip_first[1] || uip_last[2]!=uip_first[2])\r\n          post_uip[post_uip.length] = uip_first.slice(0,3).concat(false, uip_last[2]!=uip_first[2], null);\r\n        if (pn_first) pn_first[0].parentNode.removeChild(pn_first[0]);\r\n      }\r\n      uip_show_3();\r\n    }\r\n    var page_his = {};\r\n    var sage_done = {};\r\n    var sage_scheduled = {};\r\n    var page_len = 15; // default value\r\n    function sage_detect(th, page_len_in){\r\n      if (page_len_in) page_len = page_len_in;\r\n      for (var i in sage_scheduled) if (sage_annotate(sage_scheduled[i])) delete sage_scheduled[i];\r\n      if (!th || !th.posts) return;\r\n      for (var i=th.posts.length-1;i>=1;i--)\r\n        if (th.posts[i].email==='sage' && sage_done[th.posts[i].no]===undefined) sage_annotate(th.posts[i]);\r\n        else break;\r\n      // patch for 4chan's bug.\r\n      // 4chan sends corrupted data sometimes. Bump oerder and posts are NOT synchronized, posts may be dropped around before 1s from generation.\r\n      // You can see this by comparing Last-Modified in http header with timestamp of posts. I saw 3 sec delay so far.\r\n      // In this situation, threads in top orders are seen as overevaluated; just bumped, but there are no new posts.\r\n      // This bug requires re-evaluation of sage, so I can't use stateful fast approach.\r\n      if (pref.uip_tracker.sage.patch_bug) { // patch for 4chan's bug.\r\n        for (var i=th.posts.length-1;i>=1;i--)\r\n          if (th.posts[i].email!=='sage')\r\n            if (sage_done[th.posts[i].no]===null || sage_scheduled[th.posts[i].no]) {\r\n              if (pref.debug_mode['30']) console.log('OVERDETECTION: '+th.posts[i].no);\r\n              if (sage_done[th.posts[i].no]===null) sage_annotate(th.posts[i], {name_str:'', addName_str:'OVERDETECTED_', post_str:'', __proto__:pref.uip_tracker.sage});\r\n              delete sage_scheduled[th.posts[i].no];\r\n              delete sage_done[th.posts[i].no];\r\n            } else break;\r\n      }\r\n      if (pref.uip_tracker.sage.page && th.page!==undefined) {\r\n        var last_no = th.posts[th.posts.length-1].no;\r\n        var page = page2num(th.page);\r\n        if (!page_his[last_no]) page_his[last_no] = {pn:null, his:[page]};\r\n        else if (site2['4chan'].page_his_update(page_his[last_no].his, page)) if (page_his[last_no].pn) show_page(page_his[last_no]);\r\n      }\r\n    }\r\n    function sage_annotate(post, pref_obj, deletion){\r\n      var pn = site2[site.nickname].uip_tgt_post(post.no);\r\n      if (pn) {\r\n        var pn_name = site2[site.nickname].parse_funcs['post_html'].pn_name({pn:pn, __proto__:post});\r\n        if (!pref_obj) pref_obj = pref.uip_tracker.sage;\r\n        if (pref_obj.name) pn_name.setAttribute('style',pref_obj.name_str);\r\n        if (pref_obj.addName) pn_name.textContent = pref_obj.addName_str + pn_name.textContent;\r\n        if (pref_obj.post) pn.setAttribute('style',pref_obj.post_str);\r\n        if (!deletion) sage_done[post.no] = null;\r\n        return true;\r\n      } else if (!deletion) sage_scheduled[post.no] = post;\r\n    }\r\n    function show_page(obj){\r\n      obj.pn.textContent = '/'+obj.his.map(function(v){return Math.floor(v/page_len)+'.'+(v%page_len);}).join('\\u2192');\r\n    }\r\n    function page2num(page){\r\n      var ps = page.split('.');\r\n      return parseInt(ps[0],10)*page_len+parseInt(ps[1],10);\r\n    }\r\n    function uip_tracker_destroy(){\r\n      observer.disconnect();\r\n//      remove_dom_event_listener();\r\n      if (uip_tracker_id) clearTimeout(uip_tracker_id);\r\n      uip_tracker = null;\r\n//if (pref.debug_mode['0'] && uip_tracker===null) console.log('uip_tracker: stopped, '+value.status);\r\n    }\r\n\r\n    return {\r\n      destroy: uip_tracker_destroy,\r\n//      get_id: function(){return uip_tracker_id;},\r\n      annotate_from_catalog: annotate_from_catalog\r\n//      annotate_from_catalog: function(arg){setTimeout(annotate_from_catalog.bind(null, arg), 10000);} // for test\r\n    }\r\n  }\r\n  var uip_tracker=null;\r\n//  setTimeout(uip_tracker_init,2); // patch for LiveTag.\r\n  function uip_tracker_init(){\r\n    if (uip_tracker===null && site.features.uip_tracker && pref.features.uip_tracker && site.whereami==='thread' && pref.uip_tracker.on) uip_tracker = make_uip_tracker();\r\n    else if (uip_tracker && !pref.uip_tracker.on) uip_tracker.destroy();\r\n//    else if (!pref.uip_tracker.on) {\r\n//      if (uip_tracker) clearTimeout(uip_tracker.get_id());\r\n//      uip_tracker = null;\r\n//    }\r\n  }\r\n\r\n  function make_thread_reader(){\r\n//    site.no = site2[site.nickname].get_ops(document)[0]; // patch, will be changed to site.no.\r\n//    var base_thread = site2[site.nickname].catalog_threads_in_page(document)[0];\r\n    var name = site.nickname+site.board+site.no;\r\n//    var dbt = common_func.name2domainboardthread(name);\r\n    var dummy = {sticky:null};\r\n    var threads = {};\r\n    threads[name] = [];\r\n////////    threads[name][8]  = [0,0,0,0];\r\n    threads[name][19] = liveTag.mems.init({domain:site.nickname, board:site.board, no:site.no}).wt; // [2]; // prepare data structures.\r\n//    threads[name][19][0] = 0x000f0000; // start watching, init.\r\n//    threads[name][19] = [1,0,0,0,null,true,-1,0,true];\r\n    var favicon_obj = [];\r\n////////    var buf_id = null;\r\n////////    function updated_buf(){if (!buf_id) buf_id = setTimeout(updated,100);}\r\n//    var posts = {};\r\n////////    var nof_posts = 0;\r\n//    var init = true;\r\n////////    var time_lastpost = 0;\r\n////////    var num_of_children = 0;\r\n////////    var myself_th = {pn:base_thread, post_no_last:-1,\r\n////////      domain:site.nickname, board:site.board, parse_funcs:site2[site.nickname].parse_funcs['thread_html'], __proto__:site4.parse_funcs_on_demand};\r\n////////    var site_live = site.nickname + ((site2[site.nickname+'_live'])? '_live' : '');\r\n////////    var myself_th = site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'thread_html',\r\n////////                      {thread:site.myself, parse_funcs:site2[site_live].parse_funcs['thread_html']})[0];\r\n//    var parse_obj = {domain:site.nickname, board:site.board,\r\n//                     parse_funcs:site2[site_live].parse_funcs['thread_html'],\r\n//                     __proto__:site4.parse_funcs_on_demand};\r\n//    var myself_th = {pn:base_thread, __proto__:parse_obj};\r\n//    var myself_th = {pn:base_thread, domain:site.nickname, board:site.board,\r\n//                     parse_funcs:site2[site_live].parse_funcs['thread_html'],\r\n//                     __proto__:site4.parse_funcs_on_demand};\r\n////////    var regexp_anchor    = />>[0-9]+/g;\r\n////////    var regexp_anchor_cb = />>>\\/[0-9A-z_\\+]+\\/[0-9]+/g;\r\n////////    var remake_own_posts = true;\r\n\r\n\r\n\r\n    var own_posts_tracker = function(){\r\n      var get_flag = true;\r\n      function get_my_posts_no(){\r\n        get_flag = true;\r\n      }\r\n      function update_own_posts(posts,init){\r\n        if (posts.length==0) {get_flag = false; return;} // clearing get_flag for watching thread which may not have any new posts in lainchan, a conflict may occur in KC...  // length check for KC.\r\n        if (get_flag) {\r\n          var key = pref.script_prefix + '.own_posts.' + site.board + site.no;\r\n          var own_posts = JSON.parse(localStorage[key] || \"[]\");\r\n          var my_posts = [];\r\n          if (!init) {\r\n            my_posts[0] = posts[posts.length-1];\r\n            own_posts[own_posts.length] = my_posts[0].no;\r\n            localStorage[key] = JSON.stringify(own_posts);\r\n          } else {\r\n            var i = 0;\r\n            var j = posts.length-1;\r\n            while (i<own_posts.length) {\r\n              while (j>0 && own_posts[i]>posts[j].no) j--;\r\n              if (own_posts[i]===posts[j].no) my_posts[my_posts.length] = posts[j];\r\n              i++;\r\n            }\r\n          }\r\n          for (var i=0;i<my_posts.length;i++) {\r\n            var pn_name = my_posts[i].parse_funcs_html.pn_name(my_posts[i]);\r\n            if (pref.thread_reader.show_own_post_by==='plain') pn_name.parentNode.insertBefore(document.createTextNode(' (You)'), pn_name.nextSibling);\r\n            else pn_name.innerHTML = pn_name.innerHTML + ' (You)';\r\n          }\r\n          get_flag = false;\r\n        }\r\n        for (var i=0;i<posts.length;i++) site2[site.nickname].check_reply.add_you(posts[i]);\r\n      }\r\n      function event_submit(){\r\n        if (this.name==='post') get_my_posts_no();\r\n      }\r\n      return {\r\n        update_own_posts: update_own_posts,\r\n        get_my_posts_no: get_my_posts_no,\r\n        event_submit: event_submit,\r\n      }\r\n    };\r\n    if (pref.thread_reader.own_posts_tracker) {\r\n      own_posts_tracker = own_posts_tracker();\r\n      if (!site.components.postform_submit) window.addEventListener('submit', own_posts_tracker.event_submit, false); // doesn't work....\r\n    } else {\r\n      own_posts_tracker = null;\r\n//      if (!site.components.postform_submit) window.removeEventListener('submit', own_posts_tracker.event_submit, false);\r\n    }\r\n\r\n////////    var ignore_old = pref.catalog_footer_ignore_my_own_posts; // patch for showing (You), don't discard my post...\r\n////////    pref.catalog_footer_ignore_my_own_posts = false;\r\n////////    updated(true);\r\n////////    pref.catalog_footer_ignore_my_own_posts = ignore_old;\r\n////////\r\n//////////    threads[name][19][5] = false; // modified in check_reply\r\n////////    common_func.set_value_to_root(threads[name][19],'5',false);\r\n////////    function remake_own_posts_flag(){remake_own_posts = true;}\r\n////////    function add_event_to_submit(pn){pn.addEventListener('click', remake_own_posts_flag, false);}\r\n////////    function remove_event_from_submit(pn){pn.addEventListener('click', remake_own_posts_flag, false);}\r\n//    function add_event_to_submit(pn){pn.addEventListener('click', site2[site.nickname].check_reply.remake_own_posts, false);}\r\n//    function remove_event_from_submit(pn){pn.addEventListener('click', site2[site.nickname].check_reply.remake_own_posts, false);}\r\n    function add_event_to_submit(pn){\r\n      pn.addEventListener('click', site2[site.nickname].check_reply.remake_own_posts, false);\r\n      if (own_posts_tracker) pn.addEventListener('click', own_posts_tracker.get_my_posts_no, false);\r\n    }\r\n    function remove_event_from_submit(pn){\r\n      pn.removeEventListener('click', site2[site.nickname].check_reply.remake_own_posts, false);\r\n      if (own_posts_tracker) pn.removeEventListener('click', own_posts_tracker.get_my_posts_no, false);\r\n    }\r\n////////    function updated(init){\r\n////////      buf_id = null;\r\n//////////console.log('called');\r\n////////      if (pref.thread_reader.check_num_of_children) {\r\n////////        if (num_of_children>=myself_th.pn.childNodes.length) return; // KC doesn't work by this, because all of children are not posts.\r\n////////          num_of_children = myself_th.pn.childNodes.length;\r\n////////      }\r\n////////////      myself_th.parse_funcs['pop_post_prep'](myself_th);\r\n////////      site2[site.nickname].check_reply.check(myself_th, threads[name][19]);\r\n////////      delete myself_th.posts;\r\n////////////////      nof_posts += threads[name][19][7]; // patch\r\n////////      for (var i=0;i<threads[name][19][4].length;i++)\r\n////////        threads[name][19][4][i].pn.addEventListener('mouseover', favicon_check, false);\r\n//////////console.log('length:'+threads[name][19][4].length);\r\n////////\r\n\r\n//////////      threads[name][19][1] = 0;\r\n////////      threads[name][19][4] = [];\r\n////////      var flag_first = true;\r\n////////      var post_no_last_new = myself_th.post_no_last;\r\n////////      myself_th.parse_funcs['pop_post_prep'](myself_th);\r\n////////      while (1) {\r\n////////        myself_th.post = myself_th.parse_funcs['pop_post'](myself_th);\r\n////////        if (myself_th.post && myself_th.post.post_no>myself_th.post_no_last) {\r\n////////      \r\n//////////      for (var i=base_thread.childNodes.length-1;i>=0;i--) { // num of posts is changed by hover and inline.\r\n//////////        var classname = base_thread.childNodes[i].className;\r\n//////////        if (classname && classname.indexOf('post')!=-1 && classname.indexOf('reply')!=-1) { // remove popuped posts.\r\n//////////          var id = base_thread.childNodes[i].id;\r\n//////////          if (!(id in posts)) {\r\n////////          if (flag_first) {\r\n////////            post_no_last_new = myself_th.post.post_no;\r\n////////            if (remake_own_posts) {\r\n////////              site2[site.nickname].prep_own_posts(); // couldn't get an event from myself, so don't miss posts from my thread.\r\n////////              remake_own_posts = false;\r\n////////            }\r\n////////            time_lastpost = myself_th.post.time;\r\n////////            flag_first = false;\r\n////////          }\r\n////////          nof_posts++;\r\n//////////          posts[id] = id;\r\n//////////          var post = myself_th.post.pn; // temporal\r\n////////          if (!init) {\r\n//////////            var post = base_thread.childNodes[i];\r\n//////////            var image = post.getElementsByClassName('post-image');\r\n//////////            image = (image[0])? image[0].src : undefined;\r\n//////////            var body = post.getElementsByClassName('body')[0].innerHTML;\r\n////////            var to_me  = false;\r\n////////            var anchors = regexp_anchor.exec(myself_th.post.com);\r\n////////            if (anchors!==null) {\r\n////////              for (var j=0;j<anchors.length;j++) {\r\n////////                var tgt = anchors[j].substr(2);\r\n////////                if (site3[site.nickname].own_posts[dbt[1]+tgt]===null) {to_me = true; break;}\r\n////////            }}\r\n////////            if (!to_me) {\r\n////////              anchors = regexp_anchor_cb.exec(myself_th.post.com);\r\n////////              if (anchors!==null) {\r\n////////                for (var j=0;j<anchors.length;j++) {\r\n////////                  var tgt = anchors[j].substr(3);\r\n////////                  if (site3[site.nickname].own_posts[tgt]===null) {to_me = true; break;}\r\n////////            }}}\r\n//////////            var anchors = body.match(/&gt;&gt;[0-9]+/g);\r\n//////////            if (anchors) {\r\n//////////              for (var j=0;j<anchors.length;j++) {\r\n//////////                var tgt = anchors[j].substr(8);\r\n//////////                if (site3[site.nickname].own_posts[dbt[1]+tgt]===null) {to_me = true; break;}\r\n//////////            }}\r\n//////////            if (!to_me) {\r\n//////////              anchors = body.match(/&gt;&gt;&gt;\\/[0-9A-z_\\+]+\\/[0-9]+/g);\r\n//////////              if (anchors) {\r\n//////////                for (var j=0;j<anchors.length;j++) {\r\n//////////                  var tgt = anchors[j].substr(12);\r\n//////////                  if (site3[site.nickname].own_posts[tgt]===null) {to_me = true; break;}\r\n//////////            }}}\r\n////////            threads[name][19][4].unshift(\r\n////////              {icon: myself_th.post.op_img_url,\r\n////////               body: myself_th.post.com,\r\n////////               time: myself_th.post.time,\r\n//////////               icon: image,\r\n//////////               body: body,\r\n//////////               time: Date.parse(post.getElementsByTagName('time')[0].getAttribute('datetime')) - pref.localtime_offset*3600000,\r\n////////               to_me: to_me,\r\n////////               offsetTop: myself_th.post.pn.offsetTop});\r\n////////            if (to_me) threads[name][19][1]++;\r\n////////          }\r\n////////          myself_th.post.pn.addEventListener('mouseover', favicon_check_event, false);\r\n//////////            if (time_lastpost<threads[name][19][4][0].time) time_lastpost=threads[name][19][4][0].time;\r\n//////////          } else break;\r\n//////////        }\r\n//////////      }\r\n////////\r\n////////        } else break;\r\n////////      }\r\n////////      myself_th.post_no_last = post_no_last_new;\r\n\r\n////////\r\n////////      if (!init) {\r\n//////////      if (init) {init=false;buf_id=null;return;}\r\n////////////////        threads[name][8][2]  = nof_posts;\r\n//////////        for (var i=0;i<threads[name][19][4].length;i++) favicon_obj.push([threads[name][19][4][i].pn.offsetTop,threads[name][19][4][i]]);\r\n//////////        for (var i=threads[name][19][4].length-1;i>=0;i--) favicon_obj.push([threads[name][19][4][i].pn.offsetTop,threads[name][19][4][i]]);\r\n////////        for (var i=threads[name][19][4].length-1;i>=0;i--) favicon_obj.push(threads[name][19][4][i]);\r\n//////////        threads[name][19][2] = nof_posts - favicon_obj.length;\r\n////////        threads[name][19][2] = favicon_obj.length;\r\n////////\r\n//////////      if (!init) { // merge with mark_newer_posts. MIGHT CAUSE UNSTABLITY???\r\n//////////        var nof_posts = site2[site.nickname].get_posts(document).length; // works well in static.\r\n//////////        threads[name][8][2] = nof_posts;\r\n//////////        site2[site.nickname].check_reply_to_me(name,dbt,threads[name][19], document, threads[name][8], dummy);\r\n//////////        for (var i=0;i<threads[name][19][4].length;i++) favicon_obj.push([site2[site.nickname].get_post_offsetTop(document,nof_posts-1-i),threads[name][19][4][i]]);\r\n////////\r\n////////        if (threads[name][19][4].length!=0) notifier.changed(name, threads[name][19][4]);\r\n////////      }\r\n////////      if (own_posts_tracker && cataLog.embed_mode!=='thread') own_posts_tracker.update_own_posts(threads[name][19][4],init); // PATCH\r\n//////////      if (own_posts_tracker) own_posts_tracker.update_own_posts(threads[name][19][4],init);\r\n////////    }\r\n\r\n    var time_jumped = site.myself.posts[site.myself.posts.length-1].time_tu;\r\n    function mark_posts_from_parent(time){\r\n      time_jumped = time;\r\n      time /= site2[site.nickname].parse_funcs.thread_html.time_unit;\r\n//      ignore_scroll = true;\r\n      if (favicon_obj[0] && favicon_obj[0].time<time) { // not debugged this path, usually doesn't occur.\r\n        var i = 1;\r\n        while (i<favicon_obj.length && favicon_obj[i].time<=time) i++;\r\n        favicon_obj_trim({target:favicon_obj[i-1].pn});\r\n      } else {\r\n        var site_live = site.nickname + ((site2[site.nickname+'_live'])? '_live' : '');\r\n        var th = site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'thread_html',\r\n                   {thread:site.no, parse_funcs:site2[site_live].parse_funcs['thread_html']})[0];\r\n        var end = th.posts.length;\r\n        if (favicon_obj[0]) while (end>0 && th.posts[end-1].time>=favicon_obj[0].time) end--;\r\n        var i=end;\r\n        while (i>0 && th.posts[i-1].time>time) i--; // th.posts[--i].pn.addEventListener('mouseover', favicon_obj_trim, false);\r\n        favicon_obj = th.posts.slice(i,end).concat(favicon_obj);\r\n      }\r\n    }\r\n    if (own_posts_tracker) own_posts_tracker.update_own_posts(site.myself.posts, true); // patch for init issue below.\r\n    function updated(new_posts, init){ // called from catalog // this is NOT called with init, because catalog is made before thread_reader.\r\n      for (var i=0;i<new_posts.length;i++) if (new_posts[i].time_tu>=time_jumped) favicon_obj[favicon_obj.length] = new_posts[i];\r\n      favicon_obj.sort(function(a,b){return a.time_tu-b.time_tu;}); // for merge\r\n//      for (var i=new_posts.length-1;i>=0;i--) {\r\n////        new_posts[i].pn.addEventListener('mouseover', favicon_obj_trim, false);\r\n//        favicon_obj.push(new_posts[i]);\r\n//      }\r\n      threads[name][19][1] = (threads[name][19][1]&0xffff0000) + favicon_obj.length;\r\n//      if (new_posts.length!=0) notifier.changed(name, new_posts);\r\n      if (own_posts_tracker) own_posts_tracker.update_own_posts(new_posts,init);\r\n    }\r\n//    function favicon_check_event(){\r\n//      this.removeEventListener('mouseover', favicon_check_event, false);\r\n//      favicon_check();\r\n//    }\r\n//    var ignore_scroll = false;\r\n    var ref_height_checked = 0;\r\n    window.addEventListener('resize',function(){ref_height_checked = 0;},false);\r\n    function favicon_check(e){\r\n//      if (this===window && ignore_scroll) {ignore_scroll = false; return;}\r\n      if (favicon_obj.length==0) return;\r\n      var ref_height = brwsr.document_body.scrollTop;\r\n      if (ref_height<=ref_height_checked) return;\r\n      else ref_height_checked = ref_height;\r\n      ref_height += window.innerHeight; //  -50;\r\n      favicon_obj_trim(e,ref_height);\r\n    }\r\n    function favicon_obj_trim(e,ref_height){\r\n      var time;\r\n      while (favicon_obj.length!=0) {\r\n        if (ref_height && favicon_obj[0].pn.offsetTop + favicon_obj[0].pn.offsetHeight>ref_height) break;\r\n        var tgt = favicon_obj.shift();\r\n//        tgt.pn.removeEventListener('mouseover', favicon_obj_trim, false);\r\n        time = tgt.time * site2[site.nickname].parse_funcs['post_json'].time_unit;\r\n//        if (pref['thread'].mark_new_posts) site2['DEFAULT'].unmark_post(tgt.pn);\r\n//        if (pref['thread'].mark_new_posts) tgt.pn.setAttribute('style','border:none');\r\n//        if (e.currentTarget===tgt.pn) break;\r\n      }\r\n      if (time) {\r\n        threads[name][19][1] = favicon_obj.length;\r\n//        threads[name][19][0] = time;\r\n        for (var i=0;i<favicon_obj.length;i++) if (favicon_obj[i].reply_to_me) threads[name][19][1]+=0x10000;\r\n        if (pref.test_mode['167']) time = site.myself.posts.length - favicon_obj.length;\r\n        notifier.favicon.set(threads);\r\n        if (pref.thread_reader.sync && window.opener) send_message('parent',['TRIAGE',[name,'TRACK',threads[name][19][1],false,time]]); // for tracking what you see\r\n        else if (pClg) pClg.triage_multicast(name,'TRACK',threads[name][19][1],false,time);\r\n      }\r\n    }\r\n//    function mark_newer_posts(time){ // working code\r\n//      var retval = null;\r\n//      var i=0;\r\n//      while (i<favicon_obj.length && favicon_obj[i].time < time) i++;\r\n//      if (i<favicon_obj.length) retval = favicon_obj[i].pn;\r\n//      while (i<favicon_obj.length) {\r\n//        favicon_obj[i].marked = true;\r\n////        favicon_obj[i].pn.setAttribute('style','background:yellow');\r\n//        favicon_obj[i].pn.setAttribute('style','border:2px solid red');\r\n//        i++;\r\n//      }\r\n//      ignore_scroll = true;\r\n//      return retval; // scroll will be done.\r\n//    }\r\n\r\n//    var triage;\r\n    var btns_p = document.createElement('div');\r\n//    btns_p.innerHTML =\r\n//      '<div>'+\r\n//        '<button name=\"thread_reader.buttons.B\" type=\"button\">B</button>'+\r\n//        '<button name=\"thread_reader.buttons.UB\" type=\"button\">UB</button>'+\r\n//        ((window.opener)? '<button name=\"thread_reader.buttons.X\" type=\"button\">X</button>'+\r\n//                          '<button name=\"thread_reader.buttons.v\" type=\"button\">v</button>' : '')+\r\n//      '</div>';\r\n//    var btns = btns_p.getElementsByTagName('button');\r\n//    btns['thread_reader.buttons.B'].onclick  = function(){common_func.modify_bookmark(name,true)};\r\n//    btns['thread_reader.buttons.UB'].onclick = function(){common_func.modify_bookmark(name,false)};\r\n//    if (window.opener) {\r\n//      btns['thread_reader.buttons.X'].onclick = function(){triage_exe('KILL','');};\r\n//      btns['thread_reader.buttons.v'].onclick = function(){triage_exe('TIME','');};\r\n//    }\r\n////    var th_link = document.getElementById('thread-links');\r\n////    th_link.parentNode.insertBefore(buttons,th_link);\r\n    var pn_ref = site.embed_to['bottom'](); // (typeof(site.embed_to['bottom'])==='function')? site.embed_to['bottom']() : site.embed_to['bottom'];\r\n    pn_ref.parentNode.insertBefore(btns_p,pn_ref);\r\n    btns_p.appendChild(new Triage('WATCH,Watch,,UNWATCH,UnWatch,',{onclick:triage_exe_tr}).pn);\r\n    if (window.opener && pref.thread_reader.triage) btns_p.appendChild(new Triage(pref.catalog_triage_str,{onclick:triage_exe}).pn);\r\n//    if (window.opener && pref.thread_reader.triage) {\r\n////      var triage_all = common_func.make_triage({onclick:triage_event, wheelpatch:false});\r\n////      triage_str = triage_all.str;\r\n////      th_link.parentNode.insertBefore(triage_all.pn,th_link);\r\n//      triage = new Triage(pref.catalog_triage_str,{onclick:triage_exe});\r\n//////      triage = new Triage(pref.catalog_triage_str,{onclick:triage_event, wheelpatch:false, name:'thread_reader_triage'});\r\n//      btns_p.appendChild(triage.pn);\r\n//    }\r\n////    pref_func.tooltips.add_root(btns_p);\r\n\r\n//    function triage_event(){\r\n//      var flds = this.name.split(',');\r\n//      var i = parseInt(flds[0].replace(/[^\\(]*\\(/,''),10);\r\n//      var j = parseInt(flds[1].replace(/\\).*/,''),10);\r\n////      var i = parseInt(flds[0],10);\r\n////      var j = parseInt(flds[1],10);\r\n//      triage_exe(triage.str[i][j],triage.str[i][j+2]);\r\n//    }\r\n    function triage_exe_tr(cmd,attr){\r\n      if (!pClg) catalog_obj.show_hide(null, 'thread');\r\n      setTimeout(function(){pClg.triage_exe_broadcast(name,cmd,attr,true);},0); // embed mode uses setTimeout for interaction with native js.\r\n//      if (pClg) pClg.triage_exe_broadcast(name,cmd,attr,true);\r\n//      if (pref.thread_reader.triage_close) window.close();\r\n    }\r\n    function triage_exe(com0,com1){\r\n      send_message('parent',['TRIAGE',[name,com0,com1,true, site2['DEFAULT'].check_reply.get_checked_time(threads[name][19])]]);\r\n//      if (pref.thread_reader.triage_close) window.close();\r\n    }\r\n\r\n//    window.addEventListener('storage', site2[site.nickname].prep_own_posts_event, false); // can't catch events from this thread.\r\n    if (pref.notify.favicon) window.addEventListener('scroll', favicon_check, false);\r\n//    base_thread.addEventListener('DOMSubtreeModified',updated_buf,false);\r\n//    base_thread.addEventListener('DOMNodeInserted',updated_buf,false);\r\n////////    var observer = new MutationObserver(updated_buf);\r\n////////    observer.observe(myself_th.pn, {childList: true});\r\n\r\n//    threads[name][19][3] = --threads[name][19][0];threads[name][19][0]--;updated(); // debug\r\n//    if (site.components.postform_submit) add_event_to_submit(site.components.postform_submit);\r\n    function setup_submit(inst_submit, postform_submit){\r\n      if (!inst_submit && pref.thread_reader.own_posts_tracker && postform_submit) {\r\n        add_event_to_submit(postform_submit);\r\n        inst_submit = postform_submit;\r\n      } else if (inst_submit && (!pref.thread_reader.own_posts_tracker || !postform_submit)) {\r\n        remove_event_from_submit(inst_submit);\r\n        inst_submit = null;\r\n      }\r\n      return inst_submit;\r\n    }\r\n    var inst_submit  = setup_submit(null, site.components.postform_submit);\r\n    var inst_submit2 = setup_submit(null, site.components.postform_submit2);\r\n////////    window.addEventListener('storage', remake_own_posts_flag, false);\r\n    window.addEventListener('storage', site2[site.nickname].check_reply.remake_own_posts, false);\r\n\r\n    if (site.nickname==='4chan') (function(){ // popup youtube\r\n      var tacks = new WeakMap();\r\n      site2[site.nickname].catalog_get_native_area().addEventListener('click',function(e){\r\n        var et = e.target;\r\n        if (et.tagName==='A' && et.dataset.cmd=='embed') { //  && (!et.nextElementSibling || !et.nextElementSibling.classList.contains('stickyIcon'))) {\r\n          var tack = tacks.get(et);\r\n          if (!tack) observer.observe(et.parentNode, {childList: true});\r\n          else {\r\n            if (tack.parentNode) tack.remove(); // for racing condition\r\n            else tacks.get(tack).remove();\r\n            tacks.delete(tack);\r\n            tacks.delete(et);\r\n          }\r\n        }\r\n      },false);\r\n      var func_float = function(e){cnst.tack_float_nSblgs(e,null,true);};\r\n      var func_embed = function(e){\r\n        var obj = cnst.tack_dock_nSblgs(e,true);\r\n        if (e.target.textContent==='X') obj.tack.previousSibling.previousSibling.dispatchEvent(new MouseEvent('click', {bubbles:true, cancelable:true, view:window}));\r\n        else {\r\n          obj.pn.style.float = null;\r\n          obj.pn.style.display = null;\r\n          obj.pn.style.overflow = null;\r\n          obj.pn.classList.remove(pref.script_prefix+'_titleBar');\r\n        }\r\n      };\r\n      var observer = new MutationObserver(function(e){\r\n        var tgt = e[0].addedNodes[0];\r\n        var tack = site2[site.nickname].make_tack();\r\n        cnst.set_tack_float(tack, func_float, func_embed);\r\n//        tack.onclick = cnst.tack_float_nSblgs;\r\n        tacks.set(tgt.previousElementSibling,tack);\r\n        tacks.set(tack,tgt);\r\n        tgt.parentNode.insertBefore(tack,tgt);\r\n        observer.disconnect();\r\n      });\r\n    })();\r\n\r\n    var observer_IDinfo = null;\r\n    if (pref.IDinfo.use) (function(){ // 4chan and 8chan\r\n      var IDop = site.myself.parse_funcs.id(site.myself);\r\n      var pfID = !pref.IDinfo.auto || IDop;\r\n      var pfFlag = !pref.IDinfo.auto || site.myself.posts[0].flag;\r\n//      if (!pfID && !pfFlag && !pref.IDinfo.trip && !pref.IDinfo.name) return;\r\n//      var IDs = {};\r\n//      var flags = {};\r\n//      var flagIDs = {};\r\n//      var trips = {};\r\n//      var names = {};\r\n//      var nameTrips = {};\r\n      var ID2op = site.myself.parse_funcs.id2(site.myself);\r\n      var pfID2 = !pref.IDinfo.auto || ID2op;\r\n//      var ID2s = {};\r\n      var data = {ID:{}, ID2:{}, flag:{}, name:{}, trip:{}, flagIDs:{}, nameTrips:{}, tripNames:{}};\r\n      function entry(posts, pf){\r\n        if (pf.ID.use && pfID) show(data.ID, posts, 'pn_id', 'id', pref.IDinfo.ID, null, null, pref.IDinfo.ID.op && IDop);\r\n        if (pf.ID2.use && pfID2) show(data.ID2, posts, 'pn_id2', 'id2', pref.IDinfo.ID2, null, null, pref.IDinfo.ID2.op && ID2op);\r\n        if (pf.flag.use && pfFlag) show(data.flag, posts, 'flag', 'country', pref.IDinfo.flag, pref.IDinfo.flag.ID && data.flagIDs, 'id');\r\n        if (pf.trip.use) show(data.trip, posts, 'pn_trip', 'trip', pref.IDinfo.trip, pref.IDinfo.trip.name && data.tripNames, 'name');\r\n        if (pf.name.use) show(data.name, posts, 'pn_name', 'name', pref.IDinfo.name, pref.IDinfo.name.trip && data.nameTrips, 'trip');\r\n        /*if (posts)*/ for (var i=0;i<posts.length;i++) done.add(posts[i].no);\r\n      }\r\n      function show(obj, posts, prop_pn, prop, pf, combo, combo_prop, show_IDop){\r\n        var updated = {};\r\n        /*if (posts)*/ for (var i=0;i<posts.length;i++) {\r\n          var post = posts[i];\r\n          var pn = post[prop_pn];\r\n          if (pn) {\r\n            var post_prop = post[prop];\r\n            prep(obj, post_prop, pn, updated);\r\n            if (combo && post[combo_prop]) {\r\n              if (combo[post_prop]==undefined) combo[post_prop] = {};\r\n              combo[post_prop][post[combo_prop]] = null;\r\n            }\r\n          }\r\n        } // else for (var i in obj) updated[i] = 0;\r\n        show_pn(obj, updated, pref_func.sanitize(pf.h), pref_func.sanitize(pf.t), pf.nof, combo, show_IDop);\r\n      }\r\n      function prep(obj, key, pn, updated){\r\n        var val = {pn:pn, c:Object.keys(obj).length+(!obj[key]?1:0)};\r\n        if (!obj[key]) {\r\n          val.m = true; // mark\r\n          obj[key] = [val];\r\n        } else obj[key].push(val);\r\n        if (updated[key]===undefined) updated[key] = obj[key].length-1;\r\n      }\r\n      function show_pn(obj, updated, header, trailer, total, obj_combo, show_op){\r\n        for (var key in updated) {\r\n          var combo = obj_combo && obj_combo[key] && Object.keys(obj_combo[key]).length || 0;\r\n          var op = show_op && show_op===key? 'OP:' : '';\r\n          var pns = obj[key];\r\n          for (var i=0;i<pns.length;i++) {\r\n            var str = header + op + (i+1)+'/'+pns.length+(combo? '/'+combo:'')+(total? '/':trailer);\r\n//            var str = op + (i+1)+'/'+pns.length+(combo? '/'+combo:'')+(total? '/':trailer);\r\n            if (i<updated[key]) pns[i].pn.textContent = str;\r\n            else {\r\n//              if (header) pns[i].pn.parentNode.insertBefore(document.createTextNode(header), pns[i].pn);\r\n              var pn = document.createElement('span');\r\n              pn.innerHTML = str+(total? '<span'+(pns[i].m?' style=\"color:red\"':'')+'>'+pns[i].c+'</span>'+trailer:'');\r\n              pns[i].pn = pns[i].pn.parentNode.insertBefore(pn, pns[i].pn.nextSibling).firstChild;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      var done = new Set(); // for kwd search\r\n      entry(site.myself.posts, pref.IDinfo);\r\n      var proto = site2['DEFAULT'].wrap_to_parse.prep_pfunc(site.nickname, site.board, 'post_html');\r\n      var observer = new MutationObserver(function(e){\r\n        var posts = [];\r\n        for (var i=0;i<e.length;i++) if (e[i].addedNodes) for (var j=0;j<e[i].addedNodes.length;j++) {\r\n          var post = {pn:e[i].addedNodes[j], __proto__:proto};\r\n//          try { // for merge footer's being added\r\n          if (post.no && !done.has(post.no)) posts[posts.length] = post; // 'post.no &&' for 4chan's summary(expander), it hits observation criteria.\r\n//          } catch (e){\r\n//            console.log(e);\r\n//          }\r\n        }\r\n        if (posts.length>0) entry(posts, pref.IDinfo);\r\n//        for (var i=0;i<e.length;i++) if (e[i].addedNodes) entry(Array.prototype.map.call(e[i].addedNodes, function(v){return {pn:v};}));\r\n      });\r\n      observer_IDinfo = {\r\n        observe: function(){observer.observe(site.myself.pn, {childList: true})},\r\n        disconnect: function(){observer.disconnect();}\r\n      };\r\n      observer_IDinfo.observe();\r\n      function redraw(e,src){\r\n        var prop = src.split('.')[1];\r\n        var tgt = {ID:{}, ID2:{}, flag:{}, trip:{}, name:{}};\r\n        tgt[prop].use = true;\r\n        remove_pn(data[prop]);\r\n        data[prop] = {};\r\n        if (pref.IDinfo[prop].use) entry(site.myself.posts, tgt);\r\n//        if (pfID && (pref.IDinfo.ID ^ src==='IDinfo.ID')) remove_pn(IDs); // working code\r\n//        if (pfID2 && pref.IDinfo.ID2 ^ src==='IDinfo.ID2') remove_pn(ID2s, true);\r\n//        if (pfFlag && (pref.IDinfo.flag ^ src==='IDinfo.flag')) remove_pn(flags, true);\r\n//        if (pref.IDinfo.name ^ src==='IDinfo.name') remove_pn(names, true);\r\n//        if (pref.IDinfo.trip ^ src==='IDinfo.trip') remove_pn(trips, true);\r\n//        entry(null);\r\n      }\r\n      function remove_pn(obj){\r\n        for (var i in obj) for (var j=0;j<obj[i].length;j++) obj[i][j].pn.parentNode.remove();\r\n//        for (var i in obj) for (var j=0;j<obj[i].length;j++) {\r\n//          var pn = obj[i][j].pn.parentNode;\r\n//          obj[i][j].pn = pn.previousSibling;\r\n////          if (header) pn.parentNode.removeChild(pn.previousSibling.previousSibling);\r\n//          pn.parentNode.removeChild(pn);\r\n//        }\r\n      }\r\n      pref_func.settings.onchange_funcs['IDinfo.*.*w/'] = redraw;\r\n    })();\r\n\r\n    return {\r\n//      mark_newer_posts: mark_newer_posts,\r\n      destroy : function(){ // destroy\r\n        Tooltips.remove_root(btns_p);\r\n//        base_thread.removeEventListener('DOMSubtreeModified',updated_buf,false);\r\n//        base_thread.removeEventListener('DOMNodeInserted',updated_buf,false);\r\n        if (observer_IDinfo) observer_IDinfo.disconnect();\r\n////////        window.removeEventListener('storage', remake_own_posts_flag, false);\r\n        window.removeEventListener('storage', site2[site.nickname].check_reply.remake_own_posts, false);\r\n        if (inst_submit ) remove_event_from_submit(inst_submit);\r\n        if (inst_submit2) remove_event_from_submit(inst_submit2);\r\n        return null;\r\n      },\r\n      setup_submit2: function(){inst_submit2 = setup_submit(inst_submit2, site.components.postform_submit2);},\r\n      own_posts_tracker: own_posts_tracker,\r\n      updated: updated,\r\n      mark_posts_from_parent: mark_posts_from_parent,\r\n//      observer_IDinfo: observer_IDinfo,\r\n    };\r\n  }\r\n  function thread_reader_init(){\r\n    if (common_obj.thread_reader===null && site.features.thread_reader && pref.features.thread_reader && site.whereami==='thread' && pref.thread_reader.use) common_obj.thread_reader = make_thread_reader();\r\n    else if (!pref.thread_reader.use && common_obj.thread_reader) common_obj.thread_reader = common_obj.thread_reader.destroy();\r\n  }\r\n//  setTimeout(thread_reader_init,1); // call after making liveTag, and for safety, used setTimeout. (thread_reader_init contains DOM access, it may fail).\r\n\r\n\r\n\r\n  var liveTag = {\r\n    pn : null,\r\n    pn_summary : null,\r\n//    pn_filter_rexp : null,\r\n    active: {pk:0, in:0, ex:0},\r\n    tags_ci: null, // refers tags.__proto__\r\n    tags : Object.create(Object.create(null)),\r\n                                // tags[TAG] = {key:, num;, mems:, cbx:{pk:, in:, ex:}, (tgts:,) pn:, pn_num:, // summary tree\r\n                                //              ur:};\r\n//  mems : Object.create(null), // member tree : mems[domain][boards][no] = [[[],{},' '], [[],{}], threads_name_19];\r\n                                //   [0]:fixed, [1]:bumped, [x][0]:tags, [x][1]:keys, [0][2]:string,\r\n                                //   [2]:threads[name][19]\r\n                                //     [0]:time_of_checked, [1]:num_of_unread_replies_TO_ME, [2]:num_of_unread_replies,\r\n                                //     [3]:time_of_checked_time_internal, [4]:args_for_desktop_notification, [5]:init,\r\n                                //     [6]:time_of_checked_old, [7]:num_of_checked_posts, [8]:inital_loop,\r\n                                //     [9]:tag_temp, [10]:num_of_posts\r\n    mems : Object.create(null, {  //  CAUTION. USED ALWAYS EVEN IF pref.liveTag.use===false\r\n      getFromName: {value: function(name) {\r\n        var dbt = common_func.fullname2dbt(name);\r\n        return (dbt[2])? this[dbt[0]][dbt[1]][dbt[2]] : this[dbt[0]][dbt[1]];}},\r\n//      getFromDBT: {value: function(d,b,t){\r\n//        return (!this[d] || !this[d][b] || !this[d][b][t])? null : this[d][b][t];}}, // read for trial, getFromName assumes that target must exist.\r\n      init: {value: (function(){\r\n        function prep_domain(th, _this){\r\n////        if (this[th.domain]===undefined) this[th.domain] = Object.create(null, {proto:{value:Object.create(this.acc, {domain:{value:th.domain}})}, // working code.\r\n////                                                                                pfunc:{value:Object.create(null)}});\r\n////        if (!th.board) return this[th.domain];\r\n////\r\n////        if (this[th.domain][th.board]===undefined) {\r\n////          this[th.domain][th.board] = Object.create(this[th.domain].proto,\r\n////                                                     {proto:{value:Object.create(this[th.domain].proto,\r\n////                                                                                  {board:{value:th.board},\r\n////                                                                                   btag:{value:'#'+th.board.substr(1,th.board.length-2)}})},\r\n////                                                      nr:{value:0, writable:true}, nrtm:{value:0, writable:true}, nr_dirty:{value:false, writable:true},\r\n////                                                      u:{value:0, writable:true}, board:{value:th.board}, read_time:{value:0, writable:true},\r\n////                                                     });\r\n\r\n          var ldm =         Object.create(Object.create(_this.acc, {domain:{value:th.domain}}),\r\n                                          {p:{value:Object.create(null)}, // pool of parse_funcs\r\n//                                         u:{value:0, writable:true}, // for 'add_domain'\r\n                                          });\r\n          _this[th.domain] = ldm;\r\n          if (site2[th.domain].lth_init) site2[th.domain].lth_init(th, ldm); // liveTag.mems[th.domain] is used in this.\r\n        }\r\n        function prep_board(th, ldm){\r\n          var btag = '#'+th.board.substr(1,th.board.length-2);\r\n          if (liveTag.tags[btag] && liveTag.tags[btag].ref_tag === btag) btag = liveTag.tags[btag].ref_tag; // force to use the same reference.\r\n          var ldb =                   Object.create(Object.create(Object.getPrototypeOf(ldm),\r\n                                                                  {board:{value:th.board},\r\n                                                                   btag:{value:btag, writable:true}}),\r\n                                                    {nr:{value:0, writable:true},\r\n                                                     nrtm:{value:0, writable:true},\r\n//                                                     nr_dirty:{value:false, writable:true},\r\n                                                     u:{value:0, writable:true},\r\n//                                                     read_time:{value:0, writable:true},\r\n                                                     o:{value:null, writable:true}, // for 'add_domain' // order\r\n//                                                     f:{value:0, writable:true}, // for 'add_domain'\r\n                                                     p:{value:{}, configurable:true, writable:true}, // pool of parse_funcs\r\n                                                     pgs:{value:null, writable:true}, // for 'add_domain' // max pages\r\n                                                     d:{value:0, writable:true}, // flags\r\n                                                     // s:   for statistics\r\n                                                     // sr:  for statistics\r\n                                                     // srt: for statistics\r\n                                                     // st:  for statistics(passive)\r\n                                                    });\r\n          if (pref.liveTag.inherit_board_name) {\r\n            liveTag.update_tags_in_th_sub([], {}, [btag], {}, 1, null, 0, ldb);\r\n//            liveTag.update_boardlist_1(btag); // for passive virtual boarding. // BUG. don't update new tags.\r\n            liveTag.update_pn_buf.delayed_do();\r\n          }\r\n          var btag2 = site2[th.domain].btags && site2[th.domain].btags[th.board.slice(1,-1)];\r\n          if (btag2) Object.defineProperty(Object.getPrototypeOf(ldb),'btag2',{value:btag2, writable:true});\r\n          return ldb;\r\n        }\r\n        function prep_thread(th, ldb){\r\n//          this[th.domain][th.board][th.no] = {1:undefined, 2:[0,0,0,0,null,true,-2, 0, true, [], 1],  // init [10] as 1.// working code.\r\n//                                              u:0, no:th.no,\r\n//                                              __proto__:Object.getPrototypeOf(this[th.domain][th.board])};\r\n//          var bd = this[th.domain][th.board];\r\n          return     Object.create(Object.getPrototypeOf(ldb),{ // 28/324 for 1,2,u,no,tl.\r\n                                                                // 28/240 for 1,2,u,no.\r\n                                                                // 28/236 for 1,2,u,no,tl. (1===null)\r\n                                                                // 28/152 for   2,u,no.\r\n            '1':{value:undefined, writable:true},\r\n            '2':{value:[0x00830000, 0, 0]}, // 16/48 Bytes each. (header/all=header+contents)\r\n////                                               '2':{value:Object.create(this.watch,{ // 4,5,7,9 are shared for reducing memory consumption. // working code. // 28/116 Bytes each.\r\n////                                                 '0':{value:0x00010000, writable:true},\r\n////                                                 '1':{value:0, writable:true},\r\n////                                                 '2':{value:0, writable:true},\r\n//////                                                 '3':{value:0, writable:true},\r\n//////                                                 '6':{value:-2, writable:true},\r\n//////                                                 '8':{value:true, writable:true},\r\n//////                                                 '10':{value:-1, writable:true}\r\n////                                               })},\r\n            u:{value:0, writable:true}, // require 32Bytes/instance, 2.5% memory increase/instance.\r\n            no:{value:parseInt(th.no,10)},\r\n            // tl: locked tag data\r\n            // s: for statistics\r\n            // th:  thread data, aka th.\r\n            // _th:  patch for 2ch.\r\n            // ta:  live thread, 'posts' contains all live posts.\r\n            // pd:  posts_deleted\r\n            // ed_p: editing posts\r\n            // ed_t: editing tags\r\n            // ed_u: update timestamp for editing posts,\r\n            // sID: stats of IDs\r\n            // sg: saged posts\r\n            // pgh: page history\r\n            // mh: merge hop count\r\n            // q: quoted posts\r\n            // hp: hidden post(manually)\r\n          });\r\n//          var btag = bd[th.no].btag; // redundant\r\n//          liveTag.key_dirty[(pref.liveTag.ci)? btag.toLowerCase() : btag] = null;\r\n//          var btag2 = bd[th.no].btag2;\r\n//          if (btag2) for (var i=0;i<btag2.length;i++) liveTag.key_dirty[(pref.liveTag.ci)? btag2[i].toLowerCase() : btag2[i]] = null;\r\n        }\r\n        return function(th) {\r\n          var ldm = this[th.domain];\r\n          if (ldm===undefined) {prep_domain(th, this); ldm = this[th.domain];} // this[th.domain] may be wrapped in lth_init.\r\n          if (!th.board) return ldm;\r\n          var ldb = ldm[th.board];\r\n          if (ldb===undefined) ldm[th.board] = ldb = prep_board(th,ldm);\r\n          if (!th.no) return ldb;\r\n          var lth = ldb[th.no];\r\n          return (lth===undefined)? (ldb[th.no] = prep_thread(th,ldb)) : lth;\r\n//          if (this[th.domain]===undefined) prep_domain.call(this,th);\r\n//          if (!th.board) return this[th.domain];\r\n//          if (this[th.domain][th.board]===undefined) prep_board.call(this,th);\r\n//          if (!th.no) return this[th.domain][th.board];\r\n//          if (this[th.domain][th.board][th.no]===undefined) prep_thread.call(this,th);\r\n//          return this[th.domain][th.board][th.no];\r\n        }\r\n      })()},\r\n//      watch: {value: Object.create(null, {  //'1':{value:undefined, writable:true, configurable:true}, // default value of 1.\r\n//                                          '4':{value:null, writable:true},\r\n//                                          '5':{value:true, writable:true},\r\n//                                          '7':{value:0, writable:true},\r\n//                                          '9':{value:[], writable:true},\r\n//                                         })},\r\n      acc: {value: Object.create(null, {  // to reduce memory consumption.\r\n        0: { // TAGS MUST BE UPDATED BY REPLACING INSTEAD OF SPLICING because Footer takes stateful approach at test_mode['119'] // test_mode['119'] was discarded, it doesn't work with multiple footers. see Footer.\r\n////          get: function() {return (pref.liveTag.inherit_board_name && pref.liveTag.lock_board_name)? [this.btag] : null;}, // working code.\r\n////          set: function(val) {if (!pref.liveTag.inherit_board_name || !pref.liveTag.lock_board_name || val.length>=2) // inherit and lock ensures val.length>=1\r\n////                 Object.defineProperty(this,'0',{value:val, enumerable:true, configurable:true, writable:true}); // works.\r\n//////                 this.mems[this.domain][this.board][this.no]  = [val, this[1], this[2]];\r\n////               },\r\n////        },\r\n          get: function() {\r\n            var tag = this.btags;\r\n            if (this.tl) tag = (tag)? tag.concat(this.tl) : this.tl;\r\n            return tag || [];\r\n          },\r\n          set: function(val) {\r\n            var ref = this.btags;\r\n            if (ref) {\r\n              if (pref.liveTag.ci) ref = ref.map(function(v){return v.toLowerCase();});\r\n//              if (pref.liveTag.ci) for (var i=0;i<ref.length;i++) ref[i] = ref[i].toLowerCase(); // BUG, ref may original, not shallow copy.\r\n              for (var i=0;i<val.length;i++) if (ref.indexOf((pref.liveTag.ci)? val[i].toLowerCase() : val[i])!=-1) val.splice(i--,1);\r\n            }\r\n            if (val.length>0) this.tl = val;\r\n            else if (this.tl!==undefined) delete this.tl;\r\n          },\r\n        },\r\n        t: {get: function(){return this[1];}}, // TEMPORAL\r\n        t0: {get: function(){return this[0];}, set: function(v){this[0] = v;}}, // TEST PATCH, TO BE REMOVED\r\n        t1: {get: function(){return this[1];}, set: function(v){this[1] = v;}}, // TEST PATCH, TO BE REMOVED\r\n        wt: {get: function(){return this[2];}, set: function(v){this[2] = v;}}, // TEST PATCH, TO BE REMOVED\r\n        key: {get: function(){return this.domain + this.board + ((this.no)? this.no : '');}},\r\n//        tag: {get: function(){return (this[0] || []).concat(this[1] || []);}},\r\n        tags:{get: function(){return (this[0] || []).concat(this[1] || []);}}, // renaming function. use this later.\r\n//        tag: {get: function(){\r\n//          var tag0 = this[0];\r\n//          var tag1 = this[1];\r\n//          return (tag0 && tag1)? tag0.concat(tag1) : (tag0)? tag0 : (tag1)? tag1 : null;\r\n//        }},\r\n        btags: {get: function(){\r\n          var tags = (pref.liveTag.inherit_board_name && pref.liveTag.lock_board_name)? [this.btag] : null;\r\n          return (this.btag2 && pref.liveTag.inherit_board_tags && pref.liveTag.lock_board_tags)? (tags? tags.concat(this.btag2) : this.btag2) : tags;}},\r\n        watched:  {get: function(){return  this[2][0]&0x000c0000;}}, // see 'check_reply'\r\n        watched_p:{get: function(){return  this[2][0]&0x040c0000;}}, // watching including passive.\r\n        time_checked: {get: function(){return  this[2][2];}},\r\n        archived: {get: function(){return (this[2][0]&0x00700000) >> 20;},\r\n                   set: function(v){this[2][0] = this[2][0] & 0xff8fffff | ((v&0x07)<<20);}},\r\n        posts_saved:{get: function(){return (this[2][0]&0x02000000) >> 25;},\r\n                     set: function(v){this[2][0] = this[2][0] & 0xfdffffff | ((v&0x01)<<25);}},\r\n        force_ar: {get: function(){return (this[2][0]&0x00500000) >> 20;}}, // init or rescan\r\n        rescan_dp:{get: function(){return (this[2][0]&0x01000000) >> 24;},\r\n                   set: function(v){this[2][0] = this[2][0] & 0xfeffffff | ((v&0x01)<<24);}},\r\n        nrtm:     {get: function(){return (this[2][1]) >> 16;}},\r\n        nr:       {get: function(){return  this[2][1]&0x0000ffff;}, // set directly in check_reply.check_1 and thread_reader.favicon_obj_trim\r\n                   set: function(v){this[2][1] = (this[2][1]&0xffff0000)+v;}}, // setter for test_mode['166']\r\n        nof_posts:{get: function(){return  this[2][0]&0x0000ffff ;},\r\n                   set: function(v){this[2][0] = (this[2][0] & 0xffff0000) + v;}},\r\n\r\n        LS_synced: {get: function(){return this.d&0x00000001;},\r\n                    set: function(v){this.d = (this.d&0xfffffffe) | (v&0x01);}},\r\n        IDB_synced:{get: function(){return (this.d&0x00000002) >> 1;},\r\n                    set: function(v){this.d = (this.d&0xfffffffd) | ((v&0x01)<<1);}},\r\n//        q: {get: function(){ // meaningless. always added by checking lth.q.waiting in callback2\r\n//          var obj = this.no>1000000? Object.create(this) : Object.create({0:undefined, 1:undefined, 2:undefined, __proto__:this}); // PATCH before removing [0:2] // CYCLIC REFERENCE.\r\n//          return Object.defineProperty(this,'q',{value:obj, writable:true, enumerable:true, configurable:true}).q;}},\r\n      })}\r\n    }),\r\n//    mems_obj_accessors: { // to reduce memory consumption.\r\n//      get 0() {return (this._btag)? ((this._0)? [this.btag].concat(this._0) : [this.btag]) : this._0;}, // _0 is null at initial, and will never back to null after once promoted to [].\r\n//      set 0(val) {if (val[0]===this.btag) {\r\n//                     this._btag = true;\r\n//                     val.shift();\r\n//                   } else this._btag = false;\r\n//                   this._0 = (val.length!=0)? val : null;\r\n//                 }\r\n//    },\r\n    postprocess_board_add_btag: function(tags,bd){\r\n      for (var j=0;j<tags.length;j++) {\r\n        tags[j] = '#'+tags[j].replace(/[&<>'\"#]/g,'');\r\n        if (tags[j].length>pref.liveTag.maxstr) tags.splice(j--,1);\r\n      }\r\n      var flag = bd.btag2 && bd.btag2.length===tags.length;\r\n      if (flag) for (var j=0;j<tags.length;j++) if (tags[j]!==bd.btag2[j]) {flag = false;break;}\r\n      if (!flag) {\r\n        for (var j=0;j<tags.length;j++) if (liveTag.tags[tags[j]] && liveTag.tags[tags[j]].ref_tag===tags[j]) tags[j] = liveTag.tags[tags[j]].ref_tag; // force to use the same pointer to reduce memory consumption.\r\n        Object.defineProperty(Object.getPrototypeOf(bd),'btag2',{value:tags, writable:true});\r\n        if (pref.liveTag.inherit_board_tags) {\r\n          liveTag.inherit_board_tags_changed_1(tags, bd);\r\n//          for (var j=0;j<tags.length;j++) liveTag.update_boardlist_1(tags[j]); // for passive virtual boarding. // BUG. don't update new tags.\r\n//          for (var j=0;j<tags.length;j++) liveTag.update_pn_buf.delayed_do(); // called in liveTag.inherit_board_tags_changed_1\r\n        }\r\n      }\r\n    },\r\n    retag: function(lth, scan){ // retag IS NOT a full function, which tags are extracted from OP is not stored.\r\n      if (scan) {\r\n        scan.list_nup.add_scan(lth);\r\n        lth.wt[0] |= 0x00020000;\r\n      }\r\n      var th = {com:lth.tags.join(' '), parse_funcs:{type_com:'txt'}, __proto__:lth}; // patch\r\n      liveTag.prep_tags(th, true);\r\n      if (cataLog.threads[lth.key]) cataLog.Footer.update_force(lth.key,null,lth);\r\n    },\r\n    retag_db: DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(function(){gClg.FilterChanged();}, 10)),\r\n    inherit_board_name_changed: function(){\r\n      for (var d in this.mems) for (var b in this.mems[d]) this.inherit_board_tags_changed_1([this.mems[d][b].btag], this.mems[d][b], !pref.liveTag.inherit_board_name);\r\n////      if (!pref.liveTag.inherit_board_name) this.delete_tags_buffered();\r\n    },\r\n    inherit_board_tags_changed: function(){\r\n      for (var d in this.mems) for (var b in this.mems[d]) if (this.mems[d][b].btag2) this.inherit_board_tags_changed_1(this.mems[d][b].btag2, this.mems[d][b], !pref.liveTag.inherit_board_tags);\r\n////      if (!pref.liveTag.inherit_board_tags) this.delete_tags_buffered();\r\n    },\r\n    inherit_board_tags_changed_1: function(tags, bd, remove){\r\n      for (var i=0;i<tags.length;i++) this.retag_in_th_sub(tags[i], bd, remove); // must before 'this.retag'.\r\n      for (var j in bd) {\r\n        var th_key = bd.domain + bd.board + bd[j].no;\r\n        this.retag(bd[j], remove && bd[j].tags.length >= pref.liveTag.max);\r\n      }\r\n      this.retag_db();\r\n      this.update_pn_buf.delayed_do();\r\n    },\r\n    ex_list_changed: function(){ // on demand remove only. When you remove a piece of list, reload is required.\r\n      if (pref.liveTag.ex_list) {\r\n        for (var d in this.mems) for (var b in this.mems[d]) for (var t in this.mems[d][b]) {\r\n          var lth = this.mems[d][b][t];\r\n          var tags_len = lth.tags.length;\r\n          if (this.exclude_tags(lth, lth.t0, lth.t1, true)) this.retag(lth, tags_len>=pref.liveTag.max);\r\n        }\r\n      }\r\n    },\r\n    exclude_tags: function(lth, tags0, tags1, remove){\r\n      var ex_list = pref_func.merge_obj5a(lth,pref.liveTag.ex_list_obj5,null);\r\n      if (!ex_list) return;\r\n      var t0 = this.exclude_tags_1(tags0, ex_list, remove? lth : null);\r\n      var t1 = this.exclude_tags_1(tags1, ex_list, remove? lth : null);\r\n      if (remove) {\r\n        if (t0) lth.t0 = t0;\r\n        if (t1) lth.t1 = t1;\r\n      }\r\n      return t0 || t1;\r\n    },\r\n    exclude_tags_1: function(tags, ex_list, lth){ // CAUTION. LIMIT CHANGABLE TAG OR ISSUE REDUNDANT ACCESS.\r\n      var flag = false;\r\n      if (tags) for (var i=tags.length-1;i>=0;i--) {\r\n        loop_tag: for (var k=0;k<ex_list.length;k++) if (ex_list[k].test(tags[i])) {\r\n          if (lth) this.delete_tags(tags[i],lth.key);\r\n          tags.splice(i,1);\r\n          flag = true;\r\n          break loop_tag;\r\n        }\r\n      }\r\n      return flag? tags : null;\r\n    },\r\n//    exclude_tags: function(lth, tag, remove){ // working code\r\n//      var ex_list = pref_func.merge_obj5a(lth,pref.liveTag.ex_list_obj5,null);\r\n//      if (ex_list) {\r\n//        var flag = false;\r\n//        for (var k=0;k<ex_list.length;k++) { // CAUTION. LIMIT CHANGABLE TAG OR ISSUE REDUNDANT ACCESS.\r\n//          for (var j=0;j<2;j++) {\r\n//            if (tag[j]) for (var i=tag[j].length-1;i>=0;i--) if (ex_list[k].test(tag[j][i])) {\r\n////            if (tag[j]) for (var i=0;i<tag[j].length;i++) if (ex_list[k].test(tag[j][i])) { // BUG, cause infinite loop when ex_list refers btag(board's tag).\r\n//              if (remove) this.delete_tags(tag[j][i],lth.key);\r\n//              tag[j].splice(i,1);\r\n////              tag[j].splice(i--,1);\r\n//              flag = true;\r\n//            }\r\n//          }\r\n//        }\r\n//      }\r\n//      return flag;\r\n//    },\r\n    key_dirty: Object.create(null),\r\n//    key_dirty_creation: Object.create(Object.create(null)),\r\n//    key_dirty: null, // {__proto__:key_dirty_creation},\r\n////    tags_mems: Object.create(null, { // working code.\r\n////      keys_obj: {get: function(){ // working code.\r\n////        var keys = Object.create(null);\r\n////        for (var i in this) {\r\n////////////if (!pref.test_mode['23']) { // test_mode['23'] is meaningless, because String is handled by reference.\r\n////////////          var val = this[i];\r\n////////////} else {\r\n////////////          var val = this.search_from_dic(this[i]);\r\n////////////}\r\n////          if (i[i.length-1]==='/') {\r\n////            var dbt = common_func.fullname2dbt(i);\r\n////            for (var j in liveTag.mems[dbt[0]][dbt[1]]) keys[i+j] = this[i];\r\n////          } else keys[i] = this[i];\r\n////        }\r\n////        return keys;\r\n////      }},\r\n////      keys_length: {get: function(){\r\n////        var len = 0;\r\n////        for (var i in this) {\r\n////          if (i[i.length-1]==='/') {\r\n////            var dbt = common_func.fullname2dbt(i);\r\n////            len += Object.keys(liveTag.mems[dbt[0]][dbt[1]]).length;\r\n////          } else len++;\r\n////        }\r\n////        return len;\r\n////      }},\r\n////////////      search_from_dic: {value: function(no){for (var i in this.dic) if (this.dic[i]==no) return i;}},\r\n////////////      clean_up_dic: {value: function(){\r\n////////////        var keys = {};\r\n////////////        for (var i in this) keys[this[i]] = null;\r\n////////////        for (var i in this.dic) if (keys[this.dic[i]]!==null) delete this.dic[i];\r\n////////////      }},\r\n////    }),\r\n    tags_array_old : [],\r\n    tags_proto: {pk:false, in:false, ex:false, pn:null,\r\n      mems_keys_obj: function(){ // working code.\r\n        var keys = {};\r\n        for (var i of this.mems.keys())\r\n          if (i.no===undefined) for (var j in i) keys[i[j].key] = this.mems.get(i);\r\n          else keys[i.key] = this.mems.get(i);\r\n        return keys;\r\n      },\r\n      mems_keys: function*(){ // iterator is slow in chome because iterator is not optimized.\r\n        for (var i of this.mems.keys())\r\n          if (i.no===undefined) for (var j in i) yield i[j];\r\n          else yield i;\r\n      },\r\n      mems_keys_length: function(){\r\n        var len = 0;\r\n        for (var i of this.mems.keys())\r\n//          if (i.no===undefined) len += Object.keys(i).length; // slow???\r\n          if (i.no===undefined) for (var j in i) ++len;\r\n          else ++len;\r\n        return len;\r\n      },\r\n      mems_keys_length_and_set_top: function(){\r\n        var len = 0;\r\n        var keys = {};\r\n        for (var i of this.mems.keys()) {\r\n          var key = this.mems.get(i);\r\n          if (keys[key]===undefined) keys[key] = 0;\r\n          if (i.no===undefined) for (var j in i) {++keys[key];++len;} // working code.\r\n          else {++keys[key];++len;}\r\n//          if (i.no===undefined) {\r\n//            if (Object.keys(i).length===0) {++keys[key];++len;} // TEST for passive virtual boarding. // TEMPORAL PATCH // empty boards goes high.\r\n//            if (Object.keys(i).length===0) {if (len===0) {++keys[key];++len;}} // TEST for passive virtual boarding. // TEMPORAL PATCH // tag which has only 1 thread goes down.\r\n//            else for (var j in i) {++keys[key];++len;}\r\n//          } else {++keys[key];++len;}\r\n        }\r\n        for (var j in keys) if (keys[j]>keys[this.key] || (keys[j]==keys[this.key] && j<this.key)) this.key = j;\r\n        if (this.key===this.ref_tag) this.key = this.ref_tag; // get the same reference to reduce memory consumption.\r\n        return len;\r\n      },\r\n      mems_boards: function(){\r\n        var tgts = {};\r\n        for (var j of this.mems.keys()) tgts[j.key.substr(0,j.key.lastIndexOf('/')+1)]=null;\r\n        return tgts;\r\n      },\r\n      caption: function(boards){\r\n        return this.num +(boards? '/'+Object.keys(this.mems_boards()).length:'')+': ' + this.key;\r\n      },\r\n      re_caption: function(boards){\r\n         this.pn.childNodes[3].textContent = this.caption(boards);\r\n      },\r\n      make_pn: (function(){\r\n        var pn_template = cnst.dom('<div name=\"dummy\"><input type=\"checkbox\" name=\"pk\"><input type=\"checkbox\" name=\"in\"><input type=\"checkbox\" name=\"ex\"> </div>');\r\n        return function(boards){\r\n          var pn = pn_template.cloneNode(true);\r\n          pn.setAttribute('name',this.key);\r\n          pn.childNodes[0].checked = this.pk;\r\n          pn.childNodes[1].checked = this.in;\r\n          pn.childNodes[2].checked = this.ex;\r\n          pn.childNodes[3].textContent = this.caption(boards);\r\n          this.pn = pn;\r\n          return pn;\r\n        };\r\n      })(),\r\n      inv_val: function(prop){\r\n        var val = !this[prop];\r\n        this[prop] = val;\r\n        if (this.pn!==null) this.pn.childNodes[prop==='pk'? 0 : prop==='in'? 1 : 2].checked = val;\r\n        return val;\r\n      },\r\n    },\r\n    scan_regex : /#[^#, \\.:;\\n\\|\"<>&]+(?=[#, \\.:;\\n\\|\"<>&]|$)/g, // ATTENTION. REFER function prep_tag_str();\r\n////    update_tags_in_th_sub: function(tags, keys, src, keys_fix, num, th, ur, btag){ // working code for obj.\r\n////      var count = tags.length;\r\n////      var i = 0;\r\n////      while (count<num && i<src.length) {\r\n////        var k = src[i++];\r\n////        var k_ci = (pref.liveTag.ci)? k.toLowerCase() : k;\r\n////        if (k_ci===k) k_ci=k; // to reduce memory consumption.\r\n////        if (keys_fix[k_ci]===undefined) {\r\n////          if (keys[k_ci]===undefined) {\r\n////            keys[k_ci] = k; // discarded every time, so needless to think about reference of 'k'.\r\n//////            tags[count++] = k;\r\n////            if (this.tags[k]===undefined) {\r\n////              if (this.tags_ci[k_ci]===undefined) {\r\n////////////if (!pref.test_mode['23']) {\r\n////                this.tags_ci[k_ci] = {key:k, mems:Object.create(this.tags_mems), ref_tag:k,\r\n//////                                    pk:false, in:false, ex:false, // moved to prototype\r\n////                                      pn:null, pn_num:0, ur:ur, __proto__:this.tags_proto};\r\n////////////} else {\r\n////////////                this.tags[k] = {key:k, mems:Object.create(this.tags_mems, {dic:{value:{}, writable:true}, dic_no:{value:0, writable:true}}),\r\n////////////                                cbx:{pk:false, in:false, ex:false}, pn:null, pn_num:0, ur:ur};\r\n////////////}\r\n////                if (this.tags[k]===undefined) this.tags[k] = this.tags_ci[k_ci];\r\n////              } else this.tags[k] = this.tags_ci[k_ci];\r\n//////              this.tags[k].tgts[k] = null;\r\n////            }\r\n////////            this.tags[k].mems[name] = k;\r\n////            var mems = this.tags[k].mems;\r\n////////////if (!pref.test_mode['23']) {\r\n////////////            var val = k;\r\n////////////} else {\r\n////////////            if (mems.dic[k]===undefined) {mems.dic[k]=mems.dic_no++;} // to reduce memory consumption, use dictionary.\r\n////////////            var val = mems.dic[k];\r\n////////////}\r\n////            if (k===this.tags[k].ref_tag) k = this.tags[k].ref_tag; // get the same reference to reduce memory consumption. This makes major of members see 'btag'.\r\n////            else for (var j in mems) if (k===mems[j]) {k=mems[j]; break;}\r\n////            if (k!==btag) {\r\n////              if (mems[th.key]!==k) this.key_dirty[k_ci] = null; // cases are changed or a new tag is added. 'if (keys[k_ci]!==k)' ensures (pref.liveTag.ci===true).\r\n////              mems[th.key] = k; // write always to force to use the same reference to reduce memory.\r\n////            }\r\n////            tags[count++] = k;\r\n////          }  // else if (keys[k_ci]!==k) this.tags[this.tags_ci[k_ci]].key_dirty = true; // case is changed. 'if (keys[k_ci]!==k)' ensures (pref.liveTag.ci===true).\r\n////        }\r\n////      }\r\n////      return i;\r\n////    },\r\n    update_tags_in_th_sub: function(tags, keys, src, keys_fix, num, th, ur, bd, clean){\r\n      var count = tags.length;\r\n      var i = 0;\r\n      while (count<num && i<src.length) {\r\n        var k = src[i++];\r\n        var k_ci = (pref.liveTag.ci)? k.toLowerCase() : k;\r\n        if (k_ci===k) k_ci=k; // to reduce memory consumption.\r\n        if (keys_fix[k_ci]===undefined) {\r\n          if (keys[k_ci]===undefined) {\r\n            keys[k_ci] = k; // discarded every time, so needless to think about reference of 'k'.\r\n            if (this.tags[k]===undefined) {\r\n              if (this.tags_ci[k_ci]===undefined) {\r\n                if (this.key_dirty[k_ci]===null) { // fallback for rare case, Case of deleted alerady.\r\n                //  Since tags_array_old ISN'T synchronized with tas.tags_ci,\r\n                //  the same key would be duplicated in tags_array_old when deletion, creation, deletion and creation(4 operations) were in a timeslot. This would be a bug.\r\n                  this.update_pn(); // synchronize them now.\r\n                }\r\n////                this.tags_ci[k_ci] = {key:k, mems: new Map(), ref_tag:k, // not optimized\r\n////                                      pn:null, pn_num:0, ur:ur, __proto__:this.tags_proto};\r\n                var mems_map = new Map(); // consumes 16 Bytes per content, but I can't reduce.... If this is changed to Set, 2.5% reduce in 8chan, but 0.5% in 4chan.(estimated)\r\n                this.tags_ci[k_ci] = {key:k, mems: mems_map, ref_tag:k, // optimized in V8\r\n                                      num:0, ur:ur, __proto__:this.tags_proto};\r\n//                                      pn:null, pn_num:0, ur:ur, __proto__:this.tags_proto};\r\n//                if (k!==k_ci) this.tags[k] = this.tags_ci[k_ci]; // this is equiavlent to 'if (this.tags[k]===undefined)' because this.tags.__proto__ === this.tags_ci // moved to later and was consolidated.\r\n                this.tags_array_old[this.tags_array_old.length] = this.tags_ci[k_ci];\r\n//                this.key_dirty_creation[k_ci] = null; // for pickup in 'update_pn'\r\n//                if (pref.debug_mode['3']) console.log('Added: '+k);\r\n              }\r\n              if (k!==k_ci) { // this is equiavlent to 'if (this.tags[k]===undefined)' because this.tags.__proto__ === this.tags_ci\r\n                this.tags[k] = this.tags_ci[k_ci];\r\n                if (this.tags_ci[k_ci].sb===undefined) this.tags_ci[k_ci].sb = [k]; // subscribe for deletion\r\n                else this.tags_ci[k_ci].sb[this.tags_ci[k_ci].sb.length] = k;\r\n              }\r\n            } // 'else' isn't required because this.tags.__proto__ === this.tags_ci\r\n            var mems = this.tags[k].mems;\r\n            if (k===this.tags[k].ref_tag) k = this.tags[k].ref_tag; // get the same reference to reduce memory consumption. This makes major of members see 'btag'.\r\n            else for (var j in mems) if (k===mems.get(j)) {k=mems.get(j); break;}\r\n//            if (k!==btag) {\r\n            if (!mems.has(bd)) {\r\n              var me = (th===null)? bd : bd[th.no];\r\n              var val = mems.get(me);\r\n              if (val===undefined || val!==k) this.key_dirty[k_ci] = null; // a new tag is added or cases are changed. 'if (keys[k_ci]!==k)' ensures (pref.liveTag.ci===true).\r\n              mems.set(me,k); // write always to force to use the same reference to reduce memory.\r\n            } else if (!clean) this.key_dirty[k_ci] = null; // board tag is hit. Case may be changed in case of board tag.\r\n            tags[count++] = k;\r\n          }\r\n        }\r\n        var tag_reserved = this.tags_reserved[k_ci];\r\n        if (th===null) {\r\n          var tag_pk = this.tags_ci[k_ci]['pk'];\r\n          if (tag_reserved!==undefined || tag_pk) this.tags_reserved_found_scan(k_ci, true, tag_reserved, tag_pk, bd);\r\n        } else if (tag_reserved!==undefined) this.tags_reserved_found(k_ci, true, tag_reserved);\r\n      }\r\n      return i;\r\n    },\r\n    retag_in_th_sub: function(tag, bd, remove){\r\n      if (remove) {\r\n        if (this.tags[tag]) this.delete_tags(tag, bd.key); // , true);\r\n      } else { // consolidate\r\n        this.update_tags_in_th_sub([], {}, [tag], {}, 1, null, 0, bd);\r\n        var mems = this.tags[tag].mems;  \r\n        for (var t in bd) if (mems.has(t)) mems.delete(t);\r\n      }\r\n    },\r\n    update_tags_in_th: function(src_new, src_old, keys_fix, num, th, watch, bd){\r\n      var ur = this.generate_ur(watch[1]); // moved to here from 'extract_tags' because 'prep_tags' needs this when it has tags_old.\r\n      var tags = [];\r\n      var keys = {};\r\n      this.update_tags_in_th_sub(tags, keys, src_new, keys_fix, num, th, ur, bd);\r\n      if (src_old) {\r\n        var i = this.update_tags_in_th_sub(tags, keys, src_old, keys_fix, num, th, ur, bd);\r\n        while (i<src_old.length) {\r\n          var k = src_old[i++];\r\n          var k_ci = (pref.liveTag.ci)? k.toLowerCase() : k;\r\n          if (keys_fix[k_ci]===undefined) {\r\n            if (keys[k_ci]!==k) this.key_dirty[k_ci] = null; // case is changed, or removed. 'if ((k_ci in keys) && keys[k_ci]!==k)' ensures (pref.liveTag.ci===true).\r\n            if (keys[k_ci]===undefined) this.delete_tags(k,th.key);\r\n          }\r\n        }\r\n      }\r\n      for (var i in keys_fix) this.check_update_tags_color(keys_fix[i],ur);\r\n      for (var i=0;i<tags.length;i++) this.check_update_tags_color(tags[i],ur);\r\n//      this.update_pn();\r\n//      this.update_pn_buf.delayed_do();\r\n//      return [tags, keys, false];\r\n      src_new = null;\r\n      this.keys_fix = keys;\r\n      return tags;\r\n    },\r\n    remove_tags_in_th: function(dbt){\r\n      var lth = this.mems[dbt[0]][dbt[1]][dbt[2]];\r\n      if (!lth) return;\r\n      var tags = lth.tags;\r\n      for (var i=0;i<tags.length;i++) this.delete_tags(tags[i],lth.key);\r\n      var btags = lth.btags;\r\n      if (pref3.stats.use) stats.thread_removed(dbt);\r\n      if (lth.q) lth.q = null; // cut cyclic reference, lth.q.__proto__  = lth\r\n      if (lth.nr && (pref.notify.favicon || pref.notify.title.notify)) notifier.favicon.set();\r\n      delete this.mems[dbt[0]][dbt[1]][dbt[2]];\r\n      if (btags) for (var i=0;i<btags.length;i++) {\r\n        this.key_dirty[(pref.liveTag.ci)? btags[i].toLowerCase() : btags[i]] = null;\r\n        if (pref.liveTag.style.use) this.update_ur_1(btags[i]); // btags are updated here, AFTER deleting lth.\r\n      }\r\n      this.update_pn_buf.delayed_do();\r\n//      if (pref.debug_mode['3']) console.log('remove: '+name);\r\n//      if (pref.debug_mode['3']) {\r\n////        var th_count = 0;\r\n////        for (var d in this.mems) for (var b in this.mems[d]) for (var t in this.mems[d][b]) th_count++;\r\n////        console.log('remove: '+name+', '+tags.tag+', tags_ci+tags: '+Object.keys(this.tags_ci).length+'+'+Object.keys(this.tags).length+', threads:'+th_count);\r\n//        for (var i in this.tags_ci) for (var j of this.tags_ci[i].mems.keys()) if (j===tags) console.log('ERROR: tags_ci['+i+'].mems has a reference to a deleted thread.');\r\n//      }\r\n    },\r\n    delete_tags: function(tag,name, from_subscribers){ // , buffered_deletion){\r\n      if (!from_subscribers && this.subscribers.length!=0) for (var i=0;i<this.subscribers.length;i++) this.delete_tags.call(this.subscribers[i],tag, name, true);\r\n//      delete this.tags[tag].mems[name];\r\n      var tag_ci = (pref.liveTag.ci)? tag.toLowerCase() : tag;\r\n      this.key_dirty[tag_ci] = null;\r\n//      delete this.key_dirty_creation[tag_ci];\r\n      if (this.tags[tag]) {\r\n        if (this.tags[tag].mems.delete(this.mems.getFromName(name)) && pref.liveTag.style.use) this.update_ur_1(tag); // only thread's tag is updated here. see remove_tags_in_th.\r\n//        this.tags[tag].mems.delete(this.mems.getFromName(name));\r\n//        if (pref.liveTag.style) this.update_ur_1(tag); // BUG. btags can't be updated here synchronously, because ur is generated by enumerating lths, which will be deleted AFTER here.\r\n//      if (Object.keys(this.tags[tag].mems).length==0) {\r\n        if (this.tags[tag].mems.size==0) {\r\n          var pn = this.tags[tag].pn;\r\n          if (this.tags[tag].pn!==null) this.pn.removeChild(this.tags[tag].pn); // CAUSE ERROR, WHY??? // because of multiple deletion orz. this.tags[tag].pn === this.tags_ci[tag_ci].pn in this case, because this.tags[X] refers prototype which is this.tags_ci[Y]\r\n//          if (this.tags[tag].pn!==null) if (this.tags[tag].pn.parentNode===this.pn) this.pn.removeChild(this.tags[tag].pn);\r\n//          delete this.tags[tag].tgts[tag];\r\n          for (var i in this.active) if (this.tags[tag][i]) this.active[i]--;\r\n          var subscribers = this.tags_ci[tag_ci].sb;\r\n          if (subscribers) for (var i=0;i<subscribers.length;i++) delete this.tags[subscribers[i]];\r\n          delete this.tags_ci[tag_ci];\r\n////          delete this.tags[tag];\r\n//////          if (pref.liveTag.ci) for (var i in this.tags) if (!this.tags[i]) delete this.tags[i]; // tags are not removed in 'update_tags_in_th_sub' if cases are changed.\r\n//////          for (var i in this.tags) if (this.tags[i]===this.tags_ci[tag_ci]) delete this.tags[i]; // TOO SLOW\r\n////          if (!buffered_deletion) { // BUFFERED DELETION MUST BE EXECUTED ATOMICALLY, NO ACCESS TO this.taga BEFORE EXECUTION OF DELETION IS NOT ALLOWED.\r\n////            var keys_tags = Object.keys(this.tags);\r\n////            var tags_ci_obj = this.tags_ci[tag_ci];\r\n////            for (var i=0;i<keys_tags.length;i++) if (this.tags[keys_tags[i]]===tags_ci_obj) delete this.tags[keys_tags[i]];\r\n//////            if (this.tags_ci[tag_ci].pn) this.pn.removeChild(this.tags_ci[tag_ci].pn); // BUG, CAUSED AN ERROR, because of documentfragment??? // because of multiple deletion orz.\r\n////            delete this.tags_ci[tag_ci];\r\n////          } else {\r\n////            if (!this.delete_tags_buffered_list) this.delete_tags_buffered_list = new Set();\r\n////            this.delete_tags_buffered_list.add(this.tags_ci[tag_ci]);\r\n////          }\r\n          if (pref.debug_mode['3']) console.log('Remove: '+tag);\r\n        }\r\n      }\r\n    },\r\n////    delete_tags_buffered_list: null,\r\n////    delete_tags_buffered: function(){\r\n////      if (!this.delete_tags_buffered_list) return;\r\n////      var keys_tags = Object.keys(this.tags);\r\n////      for (var i=0;i<keys_tags.length;i++) if (this.delete_tags_buffered_list.has(this.tags[keys_tags[i]])) delete this.tags[keys_tags[i]];\r\n////      for (var i in this.tags_ci) if (this.delete_tags_buffered_list.has(this.tags_ci[i])) {\r\n//////        if (this.tags_ci[i].pn) this.pn.removeChild(this.tags_ci[i].pn); // because of multiple deletion orz.\r\n////        delete this.tags_ci[i];\r\n////      }\r\n////      this.delete_tags_buffered_list = null;\r\n////    },\r\n    check_update_tags_color: function(tag, ur){ // checks 0->1 only.\r\n      var ur_old = this.tags[tag].ur;\r\n      this.tags[tag].ur |= ur;\r\n//      if (pref.debug_mode['4']) if (ur_old!=ur) console.log('ur: '+tag+', '+ur_old+' <- '+ur);\r\n      if (~ur_old & ur) this.update_tag_node(tag, null, true);\r\n    },\r\n    rm_404_list: function(domain, board, nos){\r\n      var tgts = {};\r\n      if (this.mems[domain] && this.mems[domain][board]) {\r\n        var mems = this.mems[domain][board];\r\n        for (var i in mems) if (nos[i]===undefined) tgts[i] = mems[i];\r\n      }\r\n      return tgts;\r\n    },\r\n    rm_404_1: function(domain, board, no, keep){\r\n      var name = domain+board+no;\r\n//      var lth;\r\n//      var keep = pref.liveTag.rm_404==='no' || (lth = liveTag.mems.getFromName(name), lth && lth.watched && (pref.liveTag.rm_404==='watched' || lth.nr));\r\n      if (!pref.test_mode['65']) if (pref.archive.IDB.auto_clean) IDB.req(domain, board, no, 'pruned_time', Date.now(), 'check_clean');\r\n      if (!pref.test_mode['67']) archiver.clean_list(domain, board, no);\r\n      if (!keep && !pref.test_mode['65'] && pref.archive.IDB.auto_restore && cataLog.threads[name]) cataLog.restore_th_from_IDB(domain, board, no);\r\n//      if (keep) { // moved into remove_thread\r\n//        var tgt_th = cataLog.threads[name];\r\n//        if (tgt_th && tgt_th[14]!=='IDB' && tgt_th[14]!=='FILE') {\r\n//          if (tgt_th[14]!=='x') {\r\n//            tgt_th[14]='x';\r\n//            cataLog.Footer.update_force(name); // temporal, this will be rewritten after implementing watcher\r\n//          }\r\n//        }\r\n//        return true;\r\n//      }\r\n//      gClg.remove_thread(name, null, keep);\r\n//      if (keep) return true;\r\n      if (!keep) this.rm_404_2(domain, board, no);\r\n    },\r\n    rm_404_2: function(domain, board, no){\r\n      this.remove_tags_in_th([domain,board,no]);\r\n      if (pref[cataLog.embed_mode].deleted_posts.auto_clean) site2[domain].clean_up_deleted_posts_1(board + no);\r\n    },\r\n//    find_friend_tag_ci: function(tag){\r\n//      var tag_l = tag.toLowerCase();\r\n//      for (var i in liveTag.tags) if (tag!==i && tag_l===liveTag.tags[i].key.toLowerCase()) return i;\r\n//      return null;\r\n//    },\r\n    tooltip: function(e, str){\r\n      var tag;\r\n      var et = e.target;\r\n      if (et.type==='checkbox') {\r\n        var suffix = et.name; // .substr(-2,2);\r\n        tag = et.parentNode.getAttribute('name'); // .slice(0,-3);\r\n        str += ((suffix==='pk')? 'Fetch' : (suffix==='in')? 'Show' : 'Hide') + ' threads which have ' + tag + '.'\r\n      } else {\r\n        tag = et.getAttribute('name');\r\n        str += tag + ': ' + liveTag.make_info(tag) +'<br>';\r\n//        for (var i in liveTag.tags[tag].mems) str += i + ', ';\r\n        var myDomain = new RegExp('^'+site.nickname);\r\n        for (var i of liveTag.tags[tag].mems.keys()) str += i.key.replace(myDomain,'') + ', ';\r\n      }\r\n      return str;\r\n//      pref_func.tooltips.show_1.call(et, e, str, null, et.type!=='checkbox');\r\n    },\r\n    boardlist_click_entry: function(e){\r\n      if (!e.ctrlKey) {\r\n        e.preventDefault();\r\n        var tag = e.target.textContent;\r\n        this.cbx_changed(tag, pref.liveTag.click_func_bl, null, e.target);\r\n      }\r\n    },\r\n    generate_ur: function(info){\r\n      return ((info>>16)!=0)? 3 : ((info&0x0000ffff)!=0)? 1 : 0;\r\n    },\r\n    CountNR: (function(){\r\n// [ForInStatement is not fast case]\r\n// http://www.html5rocks.com/en/tutorials/performance/mystery/?redirect_from_locale=ja\r\n      var CountNR = function(){\r\n        this.nrtm = 0;\r\n        this.nr   = 0;\r\n        this.nth  = 0;\r\n      }\r\n      CountNR.prototype = {\r\n        count: function(th){\r\n          if (th[0]&0x040c0000) { // includes passive\r\n            var nr = th[1]&0x0000ffff;\r\n            if (nr) {\r\n              this.nrtm += th[1]>>16;\r\n              this.nr   += nr;\r\n              this.nth++;\r\n            }\r\n          }\r\n        },\r\n        count_all: function(){\r\n          for (var d in liveTag.mems) for (var b in liveTag.mems[d]) {\r\n            var lbd = liveTag.mems[d][b];\r\n            if (lbd.nr<0) { // check dirty\r\n              var cnr = new liveTag.CountNR();\r\n              for (var t in lbd) cnr.count(lbd[t].wt);\r\n              lbd.nrtm = cnr.nrtm;\r\n              lbd.nr   = cnr.nr;\r\n            }\r\n//              sum.count([0x000c0000, (lbd.nrtm<<16) + lbd.nr]); // BUG, nr overflowed in 4chan.\r\n            this.nrtm += lbd.nrtm;\r\n            this.nr   += lbd.nr;\r\n          }},\r\n      }\r\n      return CountNR;\r\n    })(),\r\n    dirtify_ur: function(th){\r\n      this.mems[th.domain][th.board].nr = -1; // mark as dirty\r\n    },\r\n    update_ur: function(lth,ur,all_case){\r\n      var tags = lth.tags;\r\n      for (var i=0;i<tags.length;i++)\r\n        if (!all_case) {if (this.tags[tags[i]]) this.check_update_tags_color(tags[i],ur);}\r\n        else this.update_ur_1(tags[i]);\r\n    },\r\n//    update_ur: function(name,ur,all_case){ // working code\r\n//      var dbt = common_func.fullname2dbt(name);\r\n//      var tag = this.mems[dbt[0]][dbt[1]][dbt[2]];\r\n//      this.mems[dbt[0]][dbt[1]].nr = -1;\r\n////      var tag = this.mems.getFromName(name);\r\n//      for (var j=0;j<2;j++) if (tag[j]) for (var i=0;i<tag[j].length;i++) \r\n//        if (!all_case) {if (this.tags[tag[j][i]]) this.check_update_tags_color(tag[j][i],ur);}\r\n//        else this.update_ur_1(tag[j][i]);\r\n//    },\r\n    update_ur_1: function(tag){ // subfunc of 'count_ur'\r\n      var ur_old = this.tags[tag].ur;\r\n      var ur = 0;\r\nif (!pref.test_mode['24']) {\r\n      var mems_objs = this.tags[tag].mems_keys_obj(); // working code.\r\n      for (var i in mems_objs) {\r\n//        var info = this.mems.getFromName(i).wt;\r\n        var info = this.mems.getFromName(i);\r\n        if (info) ur |= liveTag.generate_ur(info.wt[1]);\r\n      }\r\n} else {\r\n      for (var i of this.tags[tag].mems_keys())\r\n        ur |= liveTag.generate_ur(i.wt[1]);\r\n}\r\n      if (ur_old!=ur) {\r\n        this.tags[tag].ur = ur;\r\n        this.update_tag_node(tag, null, true);\r\n      }\r\n    },\r\n//    count_ur: function(tag){\r\n//      var nums = this.count_ur_sub(tag);\r\n//      var friends = Object.create(null);\r\n//      friends[tag] = null;\r\n//      if (pref.liveTag.ci) {\r\n//        var tag_l = tag.toLowerCase();\r\n//        for (var i in liveTag.tags) {\r\n//          if (tag!==i && tag_l===liveTag.tags[i].key.toLowerCase()) {\r\n//            friends[i]=null;\r\n//            if (this.tags[i].ur_cs===null) this.count_ur_sub(i);\r\n//            for (var j=0;j<4;j++) nums[j] += this.tags[i].ur_cs[j];\r\n//          }\r\n//        }\r\n//      }\r\n//      for (var i in friends) this.tags[i].ur = nums;\r\n//      return nums;\r\n//    },\r\n//    count_ur_sub: function(tag){\r\n    count_ur: function(tag){\r\n      var nof_th = 0;\r\n      var bds = {};\r\n      var counter = new this.CountNR();\r\nif (!pref.test_mode['24']) {\r\n      var mems_objs = this.tags[tag].mems_keys_obj(); // working code.\r\n      for (var i in mems_objs) {\r\n        var dbt = common_func.fullname2dbt(i);\r\n        var info = this.mems[dbt[0]][dbt[1]][dbt[2]].wt;\r\n        if (info) counter.count(info);\r\n        bds[dbt[0]+dbt[1]] = null;\r\n      }\r\n      nof_th = this.tags[tag].mems_keys_length();\r\n} else {\r\n      for (var i of this.tags[tag].mems_keys()) {\r\n        counter.count(i.wt);\r\n        bds[i.domain+i.board] = null;\r\n        nof_th++;\r\n      }\r\n}\r\n      var nof_bds = Object.keys(this.tags[tag].mems_boards()).length;\r\n      return [counter.nrtm, counter.nr, counter.nth, nof_th, Object.keys(bds).length, nof_bds];\r\n    },\r\n    make_info: function(tag){\r\n      var nums = liveTag.count_ur(tag); // must exec every time because every update are NOT exact.\r\n      return 'U: '+nums[0]+'/'+nums[1]+'/'+nums[2]+' / T: '+nums[3]+' / B: '+nums[4]+'/'+nums[5];\r\n    },\r\n    tag_onmouseover: function(e){\r\n//      var et = e.target;\r\n//      if (pref.liveTag.info) pref_func.tooltips.show_1.call(et, e, liveTag.make_info(et.textContent), null, true);\r\n      return liveTag.make_info(e.target.textContent);\r\n    },\r\n    filter_changed_broadcast: function(){\r\n      if (this.NC) this.clg.filter_changed();\r\n      else {\r\n        var clgs = gClg.Clgs;\r\n        for (var i=0;i<clgs.length;i++) if (!clgs[i].liveTag.NC) clgs[i].filter_changed();\r\n      }\r\n//      if (this.footer) this.clg.filter_changed(); else if (this.clg) gClg.filter_changed();\r\n    },\r\n    cbx_changed: function(tag, func, no_scan, node_in_boardlist, backward){\r\n      var obj = this.tags[tag];\r\n      var stOut  = obj['in']===false && obj['ex']===true;\r\n      var stNone = obj['in']===false && obj['ex']===false;\r\n      var stIn   = obj['in']===true  && obj['ex']===false;\r\n      var inv_in = func==='pkin' || func==='in' || func==='inex' && (backward? !stNone : !stOut);\r\n      var inv_pk = func==='pkin' && obj['pk']===obj['in'];\r\n      var inv_ex = func==='ex' || func==='inex' && (backward? !stIn : !stNone);\r\n      if (inv_in) this.cbx_emulate_inv(tag, 'in', no_scan); // 'in' must be processed first to prevent auto set.\r\n      if (inv_pk) this.cbx_emulate_inv(tag, 'pk', no_scan); // 'in' is NOT changed here.\r\n      if (inv_ex) this.cbx_emulate_inv(tag, 'ex', no_scan);\r\n      this.filter_changed_broadcast();\r\n//      if (this.footer) this.clg.filter_changed(); else if (this.clg) gClg.filter_changed();\r\n//      if (cataLog.catalog_filter_changed) cataLog.catalog_filter_changed();\r\n      this.update_tag_node(tag, node_in_boardlist);\r\n    },\r\n//    cbx_changed: function(tag, func, no_scan, node_in_boardlist){ // working code\r\n//      if (func==='pkin') {\r\n//        if (this.tags[tag]['pk'] !== !this.tags[tag]['in']) {\r\n//          this.tags[tag]['pk'] = !this.tags[tag]['in'];\r\n//          if (this.tags[tag].pn!==null) this.tags[tag].pn.childNodes[0].checked = this.tags[tag]['pk'];\r\n//          this.cbx_onchange(tag,'pk', no_scan); // 'in' is upped automatically when pk goes 0 -> 1.\r\n//        }\r\n//        if (this.tags[tag]['in'] !== this.tags[tag]['pk']) {\r\n//          this.tags[tag]['in'] = this.tags[tag]['pk'];\r\n//          if (this.tags[tag].pn!==null) this.tags[tag].pn.childNodes[1].checked = this.tags[tag]['in'];\r\n//          this.cbx_onchange(tag,'in');\r\n//        }\r\n//      } else {\r\n//        var in_old = this.tags[tag]['in'];\r\n//        if (func==='in' || (func==='inex' && !(this.tags[tag]['in']===false && this.tags[tag]['ex']===true))) {\r\n//          this.tags[tag]['in'] = !this.tags[tag]['in'];\r\n//          if (this.tags[tag].pn!==null) this.tags[tag].pn.childNodes[1].checked = this.tags[tag]['in'];\r\n//          this.cbx_onchange(tag,'in');\r\n//        }\r\n//        if (func==='ex' || (func==='inex' && !(in_old===false && this.tags[tag]['ex']===false))) {\r\n//          this.tags[tag]['ex'] = !this.tags[tag]['ex'];\r\n//          if (this.tags[tag].pn!==null) this.tags[tag].pn.childNodes[2].checked = this.tags[tag]['ex'];\r\n//          this.cbx_onchange(tag,'ex');\r\n//        }\r\n//      }\r\n//      this.cbx_onchange_after();\r\n//      this.update_tag_node(tag, node_in_boardlist);\r\n//    },\r\n//    filter_onchange_entry : function(e){liveTag.filter_onchange(this, e);},\r\n    filter_onchange: function(pref_obj, init, from_filter){\r\n      pref_obj.rexps = common_func.kwd_prep_regexp(pref_obj);\r\n//      this.pn_filter_rexp = (pref.filter.tag_search.str==='')? null : new RegExp(pref.filter.tag_search.str, (pref.liveTag.ci)? 'i': undefined);\r\n////      for (var i in this.tags) // working code.\r\n////        if (this.tags[i].pn!==null) this.tags[i].pn.style.display = (this.pn_filter_rexp===null || this.pn_filter_rexp.test(i))? '' : 'none';\r\n      var master = this===liveTag;\r\n      if (!master && pref_obj.rexps && !this.subscribed) this.subscribe();\r\n      if (!init || this.subscribed) this.update_pn(from_filter); // draw even at initial if '!master', to prevent from loosing 'from_initial' information\r\n    },\r\n////    set_reserved_tags: function(tags,set){ // working code\r\n////      for (var i=0;i<tags.length;i++) {\r\n////        var tag = tags[i];\r\n////        var tag_ci = (pref.liveTag.ci)? tag.toLowerCase() : tag;\r\n////        if (this.tags_ci[tag_ci]) {\r\n////          if (this.tags_ci[tag_ci]['pk']!=set) this.cbx_changed(tag_ci,'pkin', true);\r\n////          this.update_tag_node(tag_ci);\r\n////          tags.splice(i--,1);\r\n////        }\r\n////      }\r\n////    },\r\n    tags_reserved: Object.create(null),\r\n    tags_reserved_found_scan: function(tag_ci,set, prop, pk, bd){\r\n      if (prop==='pk' || pk) {\r\n        scan.list_nup.add_board(bd,0);\r\n        scan.scan('b',bd.domain);\r\n      }\r\n      if (prop!==undefined) this.tags_reserved_found(tag_ci,set, prop);\r\n    },\r\n    tags_reserved_found: function(tag_ci,set, prop){\r\n      if (this.tags_ci[tag_ci][prop]!=set) this.cbx_changed(tag_ci, prop==='pk'? 'pkin':prop, true);\r\n      delete this.tags_reserved[tag_ci];\r\n    },\r\n    tags_reserved_init: function(tags,set){\r\n      this.tags_reserved = Object.create(null);\r\n      var bds_pickup = {};\r\n      for (var i=0;i<tags.length;i++) {\r\n        var prop = tags[i][0]==='!'? 'ex' : tags[i][1]==='#'? 'pk' : 'in'; // !#tag for 'ex', ##tag for 'pkin', #tag for 'in'\r\n        var tag = prop==='in'? tags[i] : tags[i].slice(1);\r\n        var tag_ci = (pref.liveTag.ci)? tag.toLowerCase() : tag; // tags_ci must be used becase tags in blist is raw, the tag may not exist in liveTag.tags[tag].\r\n        if (this.tags_ci[tag_ci]) {\r\n          this.tags_reserved_found(tag_ci,set, prop);\r\n          if (set && prop==='pk') {\r\n            var bds = liveTag.tags_ci[tag_ci].mems_boards();\r\n            for (var bd in bds) bds_pickup[bd] = null;\r\n          }\r\n        } else if (set) this.tags_reserved[tag_ci] = prop;\r\n      }\r\n      return bds_pickup;\r\n    },\r\n    update_pn_last_filter_active: false,\r\n    sort_func: function(a,b){return b.num - a.num || b.mems.size - a.mems.size || ((b.key > a.key)? -1:1);},\r\n    update_pn_disp_func: function(rexps, key){\r\n      if (rexps===null) return 0;\r\n      for (var i=0;i<rexps.length;i++) if (rexps[i].test(key)) return 1; // match any\r\n      return 0;\r\n    },\r\n    update_pn_buf: null,\r\n    setup_pn: function(pn, pref_obj){\r\n//      this.clg = clg;\r\n//      if (footer) this.footer = footer;\r\n      this.pn = pn.getElementsByTagName('div')['filter.tag_list'];\r\n      this.pn.onchange = this.cbx_onchange_entry.bind(this);\r\n      this.pn_summary = this.pn.nextSibling.childNodes[0];\r\n      this.filter_onchange(pref_obj, true, true);\r\n    },\r\n    update_pn: function(from_filter){\r\n      if (this.pn===null) return;\r\n//      if (this.pn===0) return; // trap for thread_reader.\r\n//      if (this.pn===null) {\r\n//        this.pn = document.getElementsByName('filter.tag_list')[0];\r\n//        if (this.pn) {\r\n//          this.pn.style.height = '16px';\r\n//          this.pn.style.width = '250px';\r\n//          this.pn_summary = this.pn.previousSibling.childNodes[0];\r\n//          this.pn.onchange = this.cbx_onchange_entry;\r\n//          this.filter_onchange(pref.filter.tag_search, true);\r\n//        } else {\r\n//          this.pn = 0;\r\n//          return;\r\n//        }\r\n//      }\r\n      this.update_pn_1_lazy.cancel();\r\n      this.update_pn_1(from_filter, true);\r\n    },\r\n    update_pn_pos: null,\r\n    update_pn_1_lazy: null, // bound later, update_pn_1.bind(liveTag,true)\r\n    update_pn_1: function(from_filter, from_initial){\r\n//      if (this.reserved) { // worning code\r\n//        this.set_reserved_tags(this.reserved,true);\r\n//        if (this.reserved.length===0) this.reserved = null;\r\n//      }\r\n\r\n////      var tags_array = []; // working code.\r\n//////      var keys = {};\r\n//////      for (var i in this.tags) // patch, this can be removed if this.tags is fully overlayed at pref.liveTag.ci. // PATCHES CAN BE REMOVED\r\n//////        if (keys[i]!==null) {\r\n//////          keys[i] = null;\r\n//////          tags_array[tags_array.length] = {key:i, num:Object.keys(this.tags[i].mems).length};\r\n//////        }\r\n//////      if (pref.liveTag.ci) {\r\n//////        for (var i=0;i<tags_array.length;i++) { // search major key\r\n//////          keys = {};\r\n//////          var mems = this.tags[tags_array[i].key].mems;\r\n//////          for (var j in mems) keys[mems[j]] = (keys[mems[j]] || 0) +1;\r\n//////          for (var j in keys) if (keys[j]>keys[tags_array[i].key]) tags_array[i].key = j;\r\n//////        }\r\n//////      }\r\n////\r\n////      if (pref.liveTag.ci) {\r\n////        for (var i in this.key_dirty) { // set major key\r\n////          var tag_obj = this.tags_ci[(pref.liveTag.ci)? i.toLowerCase() : i];\r\n////          if (tag_obj) {\r\n////            var keys = {};\r\n////            var mems = tag_obj.mems;\r\n////            for (var j in mems) keys[mems[j]] = (keys[mems[j]] || 0) +1;\r\n////            var key_old = tag_obj.key;\r\n////////////if (!pref.test_mode['23']) {\r\n////            for (var j in keys) if (keys[j]>keys[tag_obj.key]) tag_obj.key = j;\r\n////////////} else {\r\n////////////            for (var j in keys) if (keys[j]>keys[tag_obj.key]) tag_obj.key = tag_obj.mems.search_from_dic(j);\r\n////////////            mems.clean_up_dic();\r\n////////////}\r\n////            if (key_old!==tag_obj.key) if (tag_obj.pn) tag_obj.pn.childNodes[3].textContent = Object.keys(tag_obj.mems).length + ': ' + tag_obj.key;\r\n////          }\r\n////        }\r\n////      }\r\n////      this.key_dirty = Object.create(null);\r\n////      for (var i in this.tags_ci) tags_array[tags_array.length] = {key:this.tags_ci[i].key, num:this.tags_ci[i].mems_keys_length(),\r\n////                                                                   disp: (this.pn_filter_rexp===null || !this.pn_filter_rexp.test(this.tags_ci[i].key))? 0 : 1};\r\n////      tags_array.sort(this.sort_func);\r\n\r\n//      var tags_array = this.tags_array_old; // working code.\r\n//      for (var i=0;i<tags_array.length;i++) {\r\n//        var key = tags_array[i].key;\r\n//        var k_ci = (pref.liveTag.ci)? key.toLowerCase() : key;\r\n//        if (this.key_dirty[k_ci]===null) {\r\n//          delete this.key_dirty[k_ci];\r\n//          if (this.tags_ci[k_ci]) {\r\n//            tags_array[i].num = (pref.liveTag.ci)? this.tags_ci[k_ci].mems_keys_length_and_set_top() : this.tags_ci[k_ci].mems_keys_length();\r\n//            if (key!==this.tags_ci[k_ci].key) {\r\n//              if (this.tags_ci[k_ci].pn) this.tags_ci[k_ci].pn.childNodes[3].textContent = tags_array[i].num + ': ' + this.tags_ci[k_ci].key;\r\n//              tags_array[i].key = this.tags_ci[k_ci].key;\r\n//            }\r\n//          } else {\r\n//            tags_array.splice(i--,1);\r\n//            continue;\r\n//          }\r\n//        }\r\n//        if (from_filter) tags_array[i].disp = this.update_pn_disp_func(pref.filter.tag_search.rexps, tags_array[i].key);\r\n//      }\r\n//      for (var i in this.key_dirty)\r\n//        if (this.tags_ci[i]) {\r\n//          var tags_ary_num = (pref.liveTag.ci)? this.tags_ci[i].mems_keys_length_and_set_top() : this.tags_ci[i].mems_keys_length(); // sets key\r\n//          tags_array[tags_array.length] = {key:this.tags_ci[i].key, num:tags_ary_num,\r\n//                                           disp: this.update_pn_disp_func(pref.filter.tag_search.rexps, this.tags_ci[i].key)};\r\n//        }\r\n//      tags_array.sort(this.sort_func);\r\n//      this.key_dirty = Object.create(null);\r\n\r\n      var master = this===liveTag;\r\n      var tags_array = this.tags_array_old;\r\n      var dirty_count = 0;\r\n      var dirty_count_deleted = 0;\r\n      for (var k_ci in this.key_dirty) { // must enumerate item in prototype.\r\n        if (this.tags_ci[k_ci]) {\r\n          if (master) this.tags_ci[k_ci].num = (pref.liveTag.ci)? this.tags_ci[k_ci].mems_keys_length_and_set_top() : this.tags_ci[k_ci].mems_keys_length();\r\n//        delete this.key_dirty_creation[k_ci]; // may be respawned, typically by IDB.\r\n        } else dirty_count_deleted++; // CAUTION, this incudes count of creation.\r\n        dirty_count++;\r\n      }\r\n//      for (var k_ci in this.key_dirty_creation) if (this.tags_ci[k_ci]) tags_array[tags_array.length] = this.tags_ci[k_ci];\r\n      if (master) if (dirty_count || pref.test_mode['73']) tags_array.sort(this.sort_func);\r\n////      for (var i in this.tags) tags_array[tags_array.length] = {key:i, num:Object.keys(this.tags[i].mems).length, mems:{}}; // working code.\r\n//////      for (var i in this.tags) { // working code, moved to 'delete_tags'.\r\n//////        var num = Object.keys(this.tags[i].mems).length;\r\n//////        if (num==0){\r\n//////          if (this.tags[i].pn!==null) this.pn.removeChild(this.tags[i].pn);\r\n//////          delete this.tags[i];\r\n//////          if (pref.debug_mode['3']) console.log('Remove: '+i);\r\n//////        } else tags_array[tags_array.length] = {key:i, num:num, mems:{}};\r\n//////      }\r\n////\r\n////      tags_array.sort(this.sort_func);\r\n////\r\n////      if (pref.liveTag.ci) {\r\n////        var tags_ci = Object.create(null);\r\n////        for (var i=0;i<tags_array.length;i++) {\r\n////          var key = tags_array[i].key.toLowerCase();\r\n////          if (!(key in tags_ci)) tags_ci[key] = i;\r\n////          else {\r\n////            var src = this.tags[tags_array[i].key];\r\n////            var ref = this.tags[tags_array[tags_ci[key]].key];\r\n////            var dst = tags_array[tags_ci[key]];\r\n////            for (var j in src.mems) if (!(j in ref.mems)) dst.mems[j] = null;\r\n////            dst.num = Object.keys(ref.mems).length + Object.keys(dst.mems).length;\r\n////            tags_array[i].num = 0;\r\n//////            src.pk = ref.pk;\r\n//////            src.in = ref.in;\r\n//////            src.ex = ref.ex;\r\n//////            ref.ci[tags_array[i].key] = null;\r\n////////            src.ci = {};\r\n////            if (src.pn!==null) { // force to remake to reflect changes next time.\r\n////              if (src.pn!==null) this.pn.removeChild(src.pn);\r\n////              src.pn=null;\r\n////              src.pn_num=0;\r\n////            }\r\n////          }\r\n////        }\r\n////        tags_array.sort(this.sort_func);\r\n////      }\r\n//////      if (pref.debug_mode['3']) console.log(JSON.stringify(tags_array));\r\n\r\n      if (dirty_count) from_initial = true;\r\n      var exam_pn = from_filter || this.update_pn_pos;\r\n      var limit = pref.liveTag.lazy_each;\r\n      var pf = (this.clg? this.clg.pref : pref).filter;\r\n      var rexps = pf.tag_search.rexps;\r\n      var historical_filter_active = rexps || this.update_pn_last_filter_active;\r\n      if (historical_filter_active || dirty_count_deleted) {\r\n        var ref = (from_initial)? this.pn.firstChild : this.update_pn_pos[0];\r\n        var pn_count = (from_initial)? 0 : this.update_pn_pos[2];\r\n        var docfrag = !ref? document.createDocumentFragment() : null;\r\n//        var docfrag = (rexps && this.pn.firstChild)? null : document.createDocumentFragment();\r\n//        var pos_insert = (from_initial)? 0 : this.update_pn_pos[0]; // BUG, up is ok, but CAN'T DOWN by 1\r\n        var pf_boards = pf.tag_search.show_nof_boards;\r\n        for (var i=(from_initial)? 0 : this.update_pn_pos[1];i<tags_array.length;i++) {\r\n          var key = tags_array[i].key;\r\n          var key_ci = (pref.liveTag.ci)? key.toLowerCase() : key;\r\n          var dirty = (key_ci in this.key_dirty);\r\n          var tag_obj = this.tags_ci[key_ci] || !master && dirty && (this.prep_NC(key), this.tags_ci[key_ci]);\r\n          if (tag_obj) {\r\n            if (historical_filter_active) {\r\n              var pn = tag_obj.pn;\r\n              if (exam_pn || dirty) {\r\n                var disp = this.update_pn_disp_func(rexps, key_ci);\r\n                if (disp===0) {\r\n                  if (pn!==null) {\r\n                    if (ref===pn) ref = pn.nextSibling;\r\n                    this.pn.removeChild(pn);\r\n                    tag_obj.pn = null;\r\n                  }\r\n                } else {\r\n                  if (pn!==null) {\r\n                    if (dirty) tag_obj.re_caption(pf_boards);\r\n//                    if (limit>0) if (this.pn.childNodes[pos_insert]!==pn) {\r\n//                      this.pn.insertBefore(pn, this.pn.childNodes[pos_insert] || null); // BUG, up is ok, but CAN'T DOWN by 1\r\n//                      if (--limit==0) this.update_pn_pos = [pos_insert+1,i+1];\r\n//                    }\r\n                  } else if (limit>0) pn = tag_obj.make_pn(pf_boards);\r\n//                    pn = document.createElement('div');\r\n//                    pn.setAttribute('name',key);\r\n//                    pn.innerHTML = \r\n//                      '<input type=\"checkbox\" name=\"' + key_ci + '.pk\" ' + ((tag_obj['pk'])? 'checked' : '') + '>' + \r\n//                      '<input type=\"checkbox\" name=\"' + key_ci + '.in\" ' + ((tag_obj['in'])? 'checked' : '') + '>' + \r\n//                      '<input type=\"checkbox\" name=\"' + key_ci + '.ex\" ' + ((tag_obj['ex'])? 'checked' : '') + '>' +\r\n//                      tag_obj.num +(pf_boards? '/'+Object.keys(this.tags[key].mems_boards()).length:'')+': ' + key; // same in popup_filter\r\n//                    tag_obj.pn = pn;\r\n////                    if (docfrag) docfrag.appendChild(pn);\r\n////                    else this.pn.insertBefore(pn, this.pn.childNodes[pos_insert] || null);\r\n////                    if (--limit==0) this.update_pn_pos = [pos_insert+1,i+1];\r\n//                  }\r\n                  if (ref!==pn) {\r\n                    if (limit>0) {\r\n                      if (docfrag) docfrag.appendChild(pn);\r\n                      else {\r\n                        this.pn.insertBefore(pn, ref);\r\n                        ref = pn.nextSibling;\r\n                      }\r\n                      if (--limit==0) this.update_pn_pos = [ref,i+1, pn_count+1];\r\n                    }\r\n                  } else if (pn) ref = pn.nextSibling;\r\n                  pn_count++; // pos_insert++;\r\n                }\r\n              } else if (pn) {\r\n                ref = pn.nextSibling; // pos_insert++;\r\n                pn_count++;\r\n              }\r\n//              var key_old = this.tags_array_old[i].key; // STILL BUG, tags_array_old is obsolete in 2nd or later loop.\r\n//              var key_old_ci = (pref.liveTag.ci)? key_old.toLowerCase() : key_old;\r\n//              if (this.key_dirty[key_old_ci]===null && pn) {\r\n//                pos_insert++;\r\n//                this.key_dirty[key_old_ci] = 1;\r\n//              }\r\n//              if (this.key_dirty[key_ci]===1) pos_insert--;\r\n            }\r\n          } else if (master) tags_array.splice(i--,1); // for deleted tags, they weren't removed in 'delete_tags'.\r\n          if ((dirty_count<=0 || dirty && --dirty_count<=0) && (!historical_filter_active || limit<=0)) break;\r\n        }\r\n        if (limit<=0 && this.update_pn_pos[1]<tags_array.length) this.update_pn_1_lazy.delayed_do(pref.liveTag.lazy_delay);\r\n        else this.update_pn_pos = null;\r\n        if (docfrag) this.pn.appendChild(docfrag);\r\n        this.pn_summary.textContent = (rexps)? pn_count+(this.update_pn_pos?'...':'')+'/'+tags_array.length : ''; // pos_insert+'/'+tags_array.length : '';\r\n      }\r\n\r\n//      var historical_filter_active = pref.filter.tag_search.rexps.length!=0 || this.update_pn_last_filter_active; // working code.\r\n//      if (historical_filter_active || dirty_count_deleted) {\r\n//        if (pref.debug_mode['34']) {console.time('update_pn');console.time('update_pn2');}\r\n//        var docfrag = (pref.filter.tag_search.rexps.length!==0 && this.pn.firstChild)? null : (pref.test_mode['74'])? this.pn.cloneNode() : document.createDocumentFragment();\r\n//        var pos_insert=0;\r\n//        for (var i=0;i<tags_array.length;i++) {\r\n//          var key = tags_array[i].key;\r\n//          var key_ci = (pref.liveTag.ci)? key.toLowerCase() : key;\r\n//          var dirty = (key_ci in this.key_dirty);\r\n//          var tag_obj = this.tags_ci[key_ci];\r\n//          if (tag_obj) {\r\n//            var pn = tag_obj.pn;\r\n//            if (from_filter || dirty) {\r\n//              var disp = this.update_pn_disp_func(pref.filter.tag_search.rexps, key_ci);\r\n//              if (pn!==null) {\r\n//                if (disp===0) { // for passive virtual boarding.\r\n// //            if (tags_array[i].num===0 || tags_array[i].disp===0) {\r\n//                  this.pn.removeChild(pn);\r\n//                  tag_obj.pn = null;\r\n//                } else {\r\n//                  if (dirty) tag_obj.pn.childNodes[3].textContent = tag_obj.num + ': ' + key;\r\n//                  if (this.pn.childNodes[pos_insert]!==pn) this.pn.insertBefore(pn, this.pn.childNodes[pos_insert] || null);\r\n//                  pos_insert++;\r\n//                }\r\n//              } else if (disp==1) { // for passive virtual boarding.\r\n//    //          } else if (tags_array[i].num!=0 && tags_array[i].disp==1) {\r\n//                pn = document.createElement('div');\r\n//                pn.setAttribute('name',key);\r\n////                pn = document.createElement('span');\r\n//                pn.innerHTML = ((pref.test_mode['101'])? '<span>P</span><span>I</span><span>E</span>'\r\n//                                : '<input type=\"checkbox\" name=\"' + key_ci + '.pk\" ' + ((tag_obj['pk'])? 'checked' : '') + '>' +\r\n//                                '<input type=\"checkbox\" name=\"' + key_ci + '.in\" ' + ((tag_obj['in'])? 'checked' : '') + '>' +\r\n//                                '<input type=\"checkbox\" name=\"' + key_ci + '.ex\" ' + ((tag_obj['ex'])? 'checked' : '') + '>') +\r\n//                  tag_obj.num + ': ' + key;\r\n////                               '<span name=\"' + key + '\">' + tag_obj.num + ': ' + key + '</span><br>';\r\n//                if (docfrag) docfrag.appendChild(pn);\r\n//                else this.pn.insertBefore(pn, this.pn.childNodes[pos_insert] || null);\r\n//                pos_insert++;\r\n////                this.pn.insertBefore(pn, this.pn.childNodes[pos_insert++] || null);\r\n//                tag_obj.pn = pn;\r\n//              }\r\n//            } else if (pn) pos_insert++;\r\n//          } else {\r\n//            tags_array.splice(i--,1); // for deleted tags, wasn't checked in 'delete_tags'.\r\n////            if (--dirty_count_deleted<=0 && !historical_filter_active) break; // redundant.\r\n//          }\r\n//          if (dirty && --dirty_count<=0 && !historical_filter_active) break;\r\n//        }\r\n//        if (pref.debug_mode['34']) console.timeEnd('update_pn');\r\n//        if (docfrag) { // no effect\r\n//          if (pref.test_mode['74']) { // no effect\r\n//            this.pn.parentNode.replaceChild(docfrag, this.pn);\r\n//            this.pn = docfrag;\r\n//          } else this.pn.appendChild(docfrag);\r\n//        }\r\n//        if (pref.debug_mode['34']) console.timeEnd('update_pn2');\r\n//        this.pn_summary.textContent = (pref.filter.tag_search.rexps.length!==0)? pos_insert+'/'+tags_array.length : '';\r\n//      }\r\n\r\n////      var j=0;\r\n//      var pos_insert=0; // working code.\r\n//      for (var i=0;i<tags_array.length;i++) {\r\n//        var key = tags_array[i].key;\r\n//        if (!this.tags[key]) {tags_array.splice(i--,1);continue;} // for deleted tags, didn't checked in 'delete_tags'.\r\n//        var num = tags_array[i].num;\r\n//        var num_old = this.tags[key].pn_num;\r\n//        if (num!==num_old || from_filter) {\r\n//          var str = num + ': ' + key;\r\n//          this.tags[key].pn_num = num;\r\n//          var pn = this.tags[key].pn;\r\n//          if (pn!==null) {\r\n//            if (tags_array[i].disp===0) { // for passive virtual boarding.\r\n////            if (tags_array[i].num===0 || tags_array[i].disp===0) {\r\n//              this.pn.removeChild(pn);\r\n//              this.tags[key].pn = null;\r\n//            } else {\r\n//              this.tags[key].pn.childNodes[3].textContent = str;\r\n////              if (this.tags_array_old[j] && key===this.tags_array_old[j].key) j++;\r\n////              else {\r\n//              if (this.pn.childNodes[pos_insert]!==pn) this.pn.insertBefore(pn, this.pn.childNodes[pos_insert] || null);\r\n//              pos_insert++;\r\n////                this.pn.insertBefore(pn, this.pn.childNodes[pos_insert++] || null);\r\n////                if (pref.debug_mode['3']) console.log('Insert: '+((num>num_old)?'promote: ':'demote: ')+key+', '+num_old+' -> '+num+', '+i+', '+j+', '+num_of_skip);\r\n////                if (num<num_old) num_of_skip--;\r\n////              }\r\n//            }\r\n//          } else if (tags_array[i].disp==1) { // for passive virtual boarding.\r\n////          } else if (tags_array[i].num!=0 && tags_array[i].disp==1) {\r\n//            pn = document.createElement('span');\r\n//            pn.innerHTML = '<input type=\"checkbox\" name=\"' + key + '.pk\" ' + ((this.tags[key]['pk'])? 'checked' : '') + '>' + \r\n//                           '<input type=\"checkbox\" name=\"' + key + '.in\" ' + ((this.tags[key]['in'])? 'checked' : '') + '>' + \r\n//                           '<input type=\"checkbox\" name=\"' + key + '.ex\" ' + ((this.tags[key]['ex'])? 'checked' : '') + '>' +\r\n//                           '<span name=\"' + key + '\">' + str + '</span><br>';\r\n//            pn.childNodes[0].onchange = this.cbx_onchange_entry;\r\n//            pn.childNodes[1].onchange = this.cbx_onchange_entry;\r\n//            pn.childNodes[2].onchange = this.cbx_onchange_entry;\r\n////            pn.childNodes[0].onmouseover = this.tooltip;\r\n////            pn.childNodes[1].onmouseover = this.tooltip;\r\n////            pn.childNodes[2].onmouseover = this.tooltip;\r\n////            pn.childNodes[3].onmouseover = this.tooltip;\r\n////            pn.style = {};\r\n////            pn.style.display = (this.pn_filter_rexp===null || this.pn_filter_rexp.test(key))? '' : 'none';\r\n//            this.pn.insertBefore(pn, this.pn.childNodes[pos_insert++] || null);\r\n//            this.tags[key].pn = pn;\r\n////            for (var j in this.tags[key].tgts) this.tags[j].pn = pn;  // PATCHES CAN BE REMOVED\r\n//          }\r\n//        } else if (tags_array[i].disp==1) pos_insert++;\r\n//////        } else { // tracking // working code.\r\n//////          while (j<this.tags_array_old.length && key!==this.tags_array_old[j].key) {\r\n//////            if (this.tags[this.tags_array_old[j].key] && this.tags[this.tags_array_old[j].key].pn_num==this.tags_array_old[j].num) num_of_skip++; // removed(to be 0) while waiting or not processed yet(demote)\r\n////////            if (pref.debug_mode['3']) {\r\n////////              var debug_str = this.tags_array_old[j].key+', '+this.tags_array_old[j].num+', '+num_of_skip;\r\n////////              if (this.tags[this.tags_array_old[j].key]===undefined) console.log('Removed: '+debug_str);\r\n////////              else if (this.tags[this.tags_array_old[j].key].pn_num==this.tags_array_old[j].num) console.log('Skip: '+debug_str);\r\n////////            }\r\n//////            j++;\r\n//////          }\r\n//////          j++;\r\n//////        }\r\n//      }\r\n//      this.tags_array_old = tags_array;\r\n//      this.key_dirty = Object.create(null);\r\n//      this.key_dirty_creation = Object.create(Object.create(null));\r\n//      this.key_dirty = Object.create(this.key_dirty_creation);\r\n//      if (pref.debug_mode['3']) { // CHECKER, working code.\r\n//        var flag = true;\r\n//        var dom = [];\r\n//        for (var i=0;i<tags_array.length;i++) {\r\n//          if (tags_array[i].num==0) break;\r\n//          var tgt = this.pn.childNodes[i].childNodes[3].textContent;\r\n//          var key = tgt.replace(/[^:]+: /,'');\r\n//          dom[dom.length] = key;\r\n//          if (tags_array[i].key!==key) {\r\n//            var j=0;\r\n//            while (j<tags_array.length && tags_array[j].key!==key) j++;\r\n//            if (j==tags_array.length) j=-1;\r\n//            var k=0;\r\n//            while (k<this.tags_array_old.length && this.tags_array_old[k].key!==key) k++;\r\n//            if (k==this.tags_array_old.length) k=-1;\r\n//            console.log('ERROR: '+tgt+', should be '+j+', but '+i+', '+k+' in old');\r\n//            flag = false;\r\n//          }\r\n//        }\r\n//        if (!flag) {\r\n//          console.log(tags_array);\r\n//          console.log(dom);\r\n//          console.log(this.tags_array_old);\r\n//        }\r\n//      }\r\n\r\n//      this.pn.innerHTML = '';\r\n//      for (var i=0;i<tags_array.length;i++) if (tags_array[i].num!=0) {\r\n//        var item = document.createElement('span');\r\n//        var key = tags_array[i].key;\r\n//        var str  = tags_array[i].num + ': ' + key;\r\n//        item.innerHTML = '<input type=\"checkbox\" name=\"' + key + '.pk\" ' + ((this.tags[key].pk)? 'checked' : '') + '>' +\r\n//                         '<input type=\"checkbox\" name=\"' + key + '.in\" ' + ((this.tags[key].in)? 'checked' : '') + '>' +\r\n//                         '<input type=\"checkbox\" name=\"' + key + '.ex\" ' + ((this.tags[key].ex)? 'checked' : '') + '>' +\r\n//                         '<span name=\"' + key + '\">' +  str + '</span><br>';\r\n//        item.childNodes[0].onchange = this.cbx_onchange_entry;\r\n//        item.childNodes[1].onchange = this.cbx_onchange_entry;\r\n//        item.childNodes[2].onchange = this.cbx_onchange_entry;\r\n//        item.childNodes[3].onmouseover = pref_func.tooltips.show;\r\n//        this.pn.appendChild(item);\r\n//      }\r\n      this.update_pn_last_filter_active = rexps;\r\n      if (master) {\r\n//        this.tags_array_old = tags_array;\r\n        if (pref.virtualBoard.show && !from_filter) this.update_boardlist();\r\n        if (this.subscribers.length!=0) {\r\n          for (var i=0;i<this.subscribers.length;i++) for (var t in this.key_dirty) this.subscribers[i].key_dirty[t] = null;\r\n          if (this.update_pn_pos===null) if (!from_filter && from_initial) for (var i=0;i<this.subscribers.length;i++) this.subscribers[i].update_pn_buf.delayed_do();\r\n        }\r\n        if (this.sub_tagSearch) if (this.update_pn_pos===null) this.sub_tagSearch();\r\n      } else if (!rexps) this.unsubscribe();\r\n      this.key_dirty = Object.create(null);\r\n    },\r\n    subscribers: [],\r\n    subscribe: function(){ // proxy is 5-8 times slower, I don't use as much as possible. http://dealwithjs.io/es6-features-10-use-cases-for-proxy/\r\n      if (!this.NC) {\r\n        this.tags_ci = {};\r\n        this.tags = Object.create(this.tags_ci);\r\n      }\r\n      for (var i=0;i<this.tags_array_old.length;i++) this.prep_NC(this.tags_array_old[i].key);\r\n      liveTag.subscribers.push(this);\r\n      this.subscribed = true;\r\n    },\r\n    unsubscribe: function(force){\r\n      if (force) for (var t in this.tags_ci) if (this.tags_ci[t].pn) this.tags_ci[t].pn.remove();\r\n      if (this.NC) {\r\n        for (var t in this.tags_ci) if (!this.tags_ci[t].pk && !this.tags_ci[t].in && !this.tags_ci[t].ex) delete this.tags_ci[t];\r\n        for (var t in this.tags)    if (!this.tags[t].pk    && !this.tags[t].in    && !this.tags[t].ex)    delete this.tags[t];\r\n      } else {\r\n        delete this.tags_ci;\r\n        delete this.tags;\r\n      }\r\n      liveTag.subscribers.splice(liveTag.subscribers.indexOf(this),1);\r\n      this.subscribed = false;\r\n    },\r\n    factory: function(clg, footer, NC){\r\n      var lt = {\r\n        clg: clg, \r\n        footer: footer,\r\n        pn: null,\r\n        pn_summary: null,\r\n        NC: NC,\r\n        subscribed: false,\r\n        key_dirty: Object.create(null),\r\n        __proto__: liveTag // this\r\n      };\r\n      lt.update_pn_buf = new DelayBuffer(liveTag.update_pn.bind(lt), pref.liveTag.disp_delay);\r\n      lt.update_pn_1_lazy = new DelayBuffer(liveTag.update_pn_1.bind(lt, true), pref.liveTag.lazy_delay);\r\n      if (NC) {\r\n        lt.tags_ci = {};\r\n        lt.tags = Object.create(lt.tags_ci);\r\n        lt.active = {pk:0, in:0, ex:0};\r\n      }\r\n      return lt;\r\n    },\r\n    popup_filter: (function(){\r\n      var oninput_funcs = {\r\n        'filter.tag_search.str': function(){\r\n          if (this['.']) this['.'].liveTag.filter_onchange(this['.'].pref.filter.tag_search, null, true);\r\n          else liveTag.filter_onchange(pref.filter.tag_search, null, true);\r\n        },\r\n        __proto__: pref_func.settings.oninput_funcs.__proto__\r\n      };\r\n      var onchange_funcs = {\r\n        'filter.tag_search.re': oninput_funcs['filter.tag_search.str'],\r\n        'filter.tag_search.show_nof_boards': function(){\r\n          var pf_boards = (this['.'] && this['.'].pref || pref).filter.tag_search.show_nof_boards;\r\n          var lT = this['.'] && this['.'].liveTag || liveTag;\r\n          for (var i=0;i<lT.tags_array_old.length;i++) {\r\n            var key = lT.tags_array_old[i].key;\r\n            var tag_obj = lT.tags[key];\r\n            if (tag_obj && tag_obj.pn) tag_obj.re_caption(pf_boards);\r\n          }\r\n        },\r\n        __proto__: oninput_funcs\r\n      };\r\n      return {\r\n        html:\r\n          '<div style=\"float:left\">'+\r\n            '<div>'+\r\n              '<ICN\"filter.tag\">Tag :'+\r\n            '</div>'+\r\n            '<div style=\"text-align:right\">'+\r\n              '<a name=\"SHOW5\" style=\"cursor:pointer\" data-show5=\"tagButtons\" data-str=\"[\\u25b2]\">[\\u25bc]</a>'+\r\n            '</div>'+\r\n          '</div>'+\r\n          '<div style=\"float:left\">'+\r\n            '<div>'+\r\n              ' Fetcn / In / Out / Threads / Tag '+\r\n              '<ITBL25\"filter.tag_search.str\" placeholder=\"Search tags...\">'+\r\n  //            ' <ICBX\"filter.tag_search.ci\">CI'+\r\n              ' <ICN\"filter.tag_search.re\">RE'+\r\n            '</div>'+\r\n            '<div style=\"display:none\" data-show5=\"tagButtons\">'+\r\n              '<span style=\"display:inline-block\">'+\r\n                '<BTN\"tagB.all_c_pk,C\"><BTN\"tagB.all_c_in,C\"><BTN\"tagB.all_c_ex,C\"> Clear checkboxes of all tags<br>'+\r\n                '<BTN\"tagB.shown_c_pk,C\"><BTN\"tagB.shown_c_in,C\"><BTN\"tagB.shown_c_ex,C\"> Clear checkboxes of shown tags<br>'+\r\n                '<BTN\"tagB.shown_t_pk,T\"><BTN\"tagB.shown_t_in,T\"><BTN\"tagB.shown_t_ex,T\"> Toggle checkboxes of shown tags<br>'+\r\n              '</span>'+\r\n              '<span>'+\r\n                '<IC\"filter.tag_search.show_nof_boards\">Show number of boards'+\r\n              '</span>'+\r\n//              '<a name=\"HIDE3\" style=\"cursor:pointer\">[\\u25b2]</a>'+\r\n            '</div>'+\r\n            '<div style=\"overflow:auto;resize:both;display:inline-block;height:16px;width:250px\" name=\"filter.tag_list\"></div>'+\r\n            '<div style=\"display:inline-block\"><span></span></div>'+\r\n//            '<a name=\"SHOW3\" style=\"cursor:pointer\" data-show3=\"tagButtons\">[\\u25bc]</a>'+\r\n            pref_func.settings.html_funcs.rollup('<div style=\"clear:both\">'+\r\n              '<BTN\"tag2bList,Add\"> selected tags to the last of board group by <SE\"filter.tag2bList.by,tag:Tag,board:Board\"><br>'+\r\n              '1,Label: <ITBL20\"filter.tag2bList.label\" placeholder=\"default: topmost tag\"><br>'+\r\n//              '1,<IR\"filter.tag2bList.by,tag\">By tag<br>'+\r\n//              '1,<IR\"filter.tag2bList.by,board\">By board<br>'+\r\n            '</div>')+\r\n  //          '<a name=\"SHOW\" style=\"cursor:pointer\" data-str=\"[\\u25b2]\">[\\u25bc]</a>'+\r\n  //          '<div name=\"SUB\" style=\"clear:both;display:none\">TEST</div>'+\r\n          '</div>'+\r\n          '<div style=\"clear:both\"></div>', // for floating\r\n        oninput_funcs: oninput_funcs,\r\n        onchange_funcs: onchange_funcs,\r\n        embed: function(pn_redirect){\r\n          if (liveTag.pn) return;\r\n          var pn = document.createElement('div');\r\n          pn.innerHTML = '<div>' + pref_func.format_html_str(this.html) + '</div>';\r\n          pn.appendChild(pn_redirect);\r\n          liveTag.setup_pn(pn, pref.filter.tag_search);\r\n          var tack = site2[site.nickname].make_tack();\r\n          tack.onclick = cnst.tack_float_nSblgs;\r\n          tack.setAttribute('style','float:right;font-size:2em');\r\n          pn.insertBefore(tack, pn.firstChild);\r\n          pref_func.add_onchange(pn, onchange_funcs, oninput_funcs);\r\n          pref_func.apply_prep(pn, false);\r\n          Tooltips.add_root(pn);\r\n          liveTag.update_pn(true);\r\n          return pn;\r\n        },\r\n        popup: function(){ // will be discarded\r\n          if (liveTag.pn) return;\r\n          var exit_func = function(){\r\n            Tooltips.remove_root(popup.pn);\r\n            liveTag.pn = null;\r\n            cnst.div_destroy(popup.pn, true);\r\n          };\r\n          var popup = cnst.init3({func_str:'top:0px:left:0px:Show:tb', exit:exit_func});\r\n          popup.cn.innerHTML = pref_func.format_html_str(liveTag.popup_filter.html);\r\n          pref_func.add_onchange(popup.cn,onchange_funcs, oninput_funcs);\r\n          pref_func.apply_prep(popup.pn, false);\r\n          Tooltips.add_root(popup.pn);\r\n          liveTag.update_pn(true);\r\n        },\r\n      };\r\n    })(),\r\n    cbx_all_onchange: function(e){ // CAUTION, this refers onchange_funcs\r\n      var myself = this['.'] && this['.'].liveTag || liveTag;\r\n      var et = e.target;\r\n      var clear = et.name.substr(-4,1)==='c';\r\n      var prop = et.name.substr(-2,2);\r\n      var all = et.name.substr(-8,3)==='all';\r\n      var tgts_all = null;\r\n      for (var tag_ci in myself.tags_ci) {\r\n        var obj = myself.tags_ci[tag_ci];\r\n        if (all || obj.pn) if (!clear || obj[prop]) {\r\n          myself.cbx_emulate_inv(tag_ci, prop, true);\r\n          myself.update_tag_node(tag_ci);\r\n          if (prop==='pk' && obj[prop]) {\r\n            var tgts = liveTag.tags_ci[tag_ci].mems_boards();\r\n            if (!tgts_all) tgts_all = tgts;\r\n            else for (var b in tgts) tgts_all[b] = tgts[b];\r\n          }\r\n        }\r\n      }\r\n      if (tgts_all && Object.keys(tgts_all).length!=0) scan.scan_ui('refresh_tag', {tgts: tgts_all, options:{callback:function(){scan.scan('t');}, priority:6}});\r\n      myself.filter_changed_broadcast();\r\n//      if (cataLog.catalog_filter_changed) cataLog.catalog_filter_changed();\r\n    },\r\n    cbx_emulate_inv: function(tag, prop, no_scan, sync_only){\r\n//      var obj = this.tags[tag];\r\n//      var val = !obj[prop];\r\n//      obj[prop] = val;\r\n//      if (obj.pn!==null) obj.pn.childNodes[prop==='pk'? 0 : prop==='in'? 1 : 2].checked = val;\r\n      this.cbx_onchange(tag, prop, this.tags[tag].inv_val(prop), no_scan, sync_only);\r\n    },\r\n////    cbx_onchange_entry : function(e){liveTag.cbx_onchange(this, e, true);},\r\n////    cbx_onchange : function(sender, e, from_cbx){ // working code.\r\n////      var prop = sender.name.substr(-2,2);\r\n//////      var val = e.target.checked;\r\n////      var val = sender.checked;\r\n////      var tag = sender.name.substr(0,sender.name.length-3);\r\n    cbx_onchange_entry: function(e){\r\n      var et = e.target;\r\n      var tag = et.parentNode.getAttribute('name');\r\n      if (pref.liveTag.ci) tag = tag.toLowerCase();\r\n      var prop = et.name;\r\n      if (!this.tags[tag]) this.prep_NC(tag);\r\n      this.tags[tag][prop] = et.checked;\r\n      this.cbx_onchange(tag, prop, this.tags[tag][prop]);\r\n      this.filter_changed_broadcast();\r\n//      if (cataLog.catalog_filter_changed) cataLog.catalog_filter_changed();\r\n      this.update_tag_node(tag);\r\n    },\r\n    cbx_onchange : function(tag, prop, val, no_scan, sync_only){\r\n//      this!==liveTag && !this.NC && this.subscribed) liveTag.cbx_emulate_inv(tag, prop, no_scan, true); // ONLY WATCHER TO THE PRIMARY VIEW IS SYNCED.\r\n      if (!sync_only || this.NC) this.active[prop] += (val)? 1 : -1;\r\n      if (prop==='pk') {\r\n        if (val && !this.tags[tag]['in']) this.cbx_emulate_inv(tag, 'in');\r\n//        if (val && !this.tags[tag]['in']) {\r\n//          this.tags[tag]['in'] = true;\r\n//          this.active['in'] += 1;\r\n//          if (this.tags[tag].pn!==null) this.tags[tag].pn.childNodes[1].checked = true;\r\n////          this.update_pn_buf.delayed_do();\r\n//        }\r\n//        var tgts = {};\r\n////        var now = Date.now();\r\n////        var prev = now - pref.liveTag.pickup_interval*1000;\r\n////        for (var i in this.tags)\r\n////          if (this.tags[i]['pk'] && (this.tags[i]['pk']==='true' || this.tags[i]['pk']<prev)) {\r\n////            this.tags[i]['pk']=now;\r\n////            for (var j in this.tags[i].mems) tgts[j.substr(0,j.lastIndexOf('/')+1)]=null;\r\n////          }\r\n////        if (val) for (var i in this.tags[tag].tgts) for (var j in this.tags[i].mems) tgts[j.substr(0,j.lastIndexOf('/')+1)]=null; // working code.\r\n////        if (val) for (var j in this.tags[tag].mems) tgts[j.substr(0,j.lastIndexOf('/')+1)]=null;\r\n//        if (val) for (var j of this.tags[tag].mems.keys()) tgts[j.key.substr(0,j.key.lastIndexOf('/')+1)]=null; // working code.\r\n        if (!sync_only && val && !no_scan && gClg) {\r\n          var tgts = this.tags[tag].mems_boards();\r\n          if (Object.keys(tgts).length!=0) scan.scan_ui('refresh_tag', {tgts: tgts, options:{callback:function(){scan.scan('t');}, priority:6}});\r\n        }\r\n      }\r\n      if (prop==='in' || prop==='ex') {\r\n        if (this.active['in']+this.active['ex']===((val)? 1 : 0)) {\r\n//        if (this.active['in']===((val)? 1 : 0)) {\r\n          if (this.clg) { // checking this.clg for tagSearch in index of 8chan\r\n            this.clg.pref.filter.tag = val; // may toggle twice if func==='inex', but leave this because func==='inex' isn't used so much.\r\n            this.clg.components.tag_use.checked = val;\r\n//            if (this!==liveTag && !this.NC) liveTag.clg.components.tag_use.checked = val; // ONLY WATCHER TO THE PRIMARY VIEW IS SYNCED.\r\n//          if (pref_func.mirror_targets.pn12_0_4)\r\n//            pref_func.apply_prep(pref_func.mirror_targets.pn12_0_4.getElementsByTagName('input')['filter.tag'],false);\r\n          }\r\n        }\r\n      }\r\n      if (!sync_only && !this.NC) {\r\n        var clgs = gClg.Clgs;\r\n        for (var i=0;i<clgs.length;i++) if (this!==clgs[i].liveTag && !clgs[i].liveTag.NC && (clgs[i].liveTag===liveTag && this.subscribed || clgs[i].liveTag.subscribed)) {\r\n          if (clgs[i].liveTag.subscribed && !clgs[i].liveTag.tags[tag]) clgs[i].liveTag.prep_NC(tag); // patch for changing board_list and create and find new tag like #c.\r\n          clgs[i].liveTag.cbx_emulate_inv(tag, prop, no_scan, true);\r\n        }\r\n      }\r\n//      if (catalog_obj && catalog_obj.catalog_func()!=null) catalog_obj.catalog_func().catalog_filter_changed();\r\n    },\r\n    add_tags_to_boardlist: function(){\r\n      var tags = liveTag.tags_array_old;\r\n      var label = pref.filter.tag2bList.label || (tags.filter(function(v){return v.in;})[0] || tags.filter(function(v){return v.pk;})[0] || tags.filter(function(v){return v.ex;})[0]).key;\r\n      var str_ary;\r\n      if (pref.filter.tag2bList.by==='tag') str_ary = [\r\n        tags.filter(function(v){return v.in;}).map(function(v){return v.key;}).join(','),\r\n        tags.filter(function(v){return v.pk;}).map(function(v){return '#'+v.key;}).join(','),\r\n        tags.filter(function(v){return v.ex;}).map(function(v){return '!'+v.key;}).join(',')];\r\n      else {\r\n        var obj_in = tags.filter(function(v){return v.in;}).map(function(v){return v.mems_boards();});\r\n        var obj_pk = tags.filter(function(v){return v.pk;}).map(function(v){return v.mems_boards();});\r\n        var obj_ex = tags.filter(function(v){return v.ex;}).map(function(v){return v.mems_boards();});\r\n        var obj = {};\r\n        for (var i=0;i<obj_in.length;i++) for (var j in obj_in[i]) obj[j] = null;\r\n        for (var i=0;i<obj_pk.length;i++) for (var j in obj_pk[i]) obj[j] = null;\r\n        for (var i=0;i<obj_ex.length;i++) for (var j in obj_ex[i]) delete obj[j];\r\n        str_ary = Object.keys(obj);\r\n      }\r\n      pref_func.settings.onchange_funcs['tag.add_to_list'](label +', '+ str_ary.filter(function(v){return v;}).join(','));\r\n    },\r\n    search_by_tags : function(lth){\r\n      var retval = !this.active.in;\r\n      var tags = lth.tags; // all tags in an array\r\n      if (this.active.in)           for (var i=0;i<tags.length;i++) if ((tags[i] in this.tags) && this.tags[tags[i]]['in']) {retval = true; break;}\r\n      if (retval && this.active.ex) for (var i=0;i<tags.length;i++) if ((tags[i] in this.tags) && this.tags[tags[i]]['ex']) {retval = false; break;}\r\n      return retval;\r\n    },\r\n//    search_by_tags : function(tags){ // working code.\r\n//      var retval = !this.active.in;\r\n//      if (this.active.in)           for (var j=0;j<2;j++) if (tags[j]) for (var i=0;i<tags[j].length;i++) if ((tags[j][i] in this.tags) && this.tags[tags[j][i]]['in']) {retval = true; break;}\r\n//      if (retval && this.active.ex) for (var j=0;j<2;j++) if (tags[j]) for (var i=0;i<tags[j].length;i++) if ((tags[j][i] in this.tags) && this.tags[tags[j][i]]['ex']) {retval = false; break;}\r\n//      return retval;\r\n//    },\r\n    keys_fix: null, // to reduce memory consumption. THIS IS USED GLOBALLY.\r\n    prep_tags: function(th, retag){ // prepare tag holder and extract tags in op.\r\n//      if (this.mems[th.domain] && this.mems[th.domain][th.board] && this.mems[th.domain][th.board][th.no]) return this.mems[th.domain][th.board][th.no];\r\n//      else {\r\n      var lth = this.mems.init(th);\r\n      var watch = lth.wt;\r\n      if ((watch[0]&0x00010000) && (pref.liveTag.watch_all && th.time_created) ||\r\n          (watch[0]&0x00840000)===0x00800000 && (th.time_created>0||th.time_posted>0)) {// for meguca or those don't have time at first.\r\n        cataLog.set_watch_time_thread(th.key, cataLog.embed_mode, th.time_created, th.time_posted, th, watch);\r\n        if (pref.archive.store_watched && lth.watched && !lth.archived) archiver.start_1('ARC',lth);\r\n      }\r\n      if ((watch[0]&0x00010000) || retag) {\r\n        if (watch[0]&0x00010000) {\r\n          if (!pref.test_mode['64'] && pref[cataLog.embed_mode].deleted_posts.merge) archiver.prep_deleted_posts(th,lth);\r\n          if (!pref.test_mode['67']) archiver.check_op(th, lth);\r\n//          if (pref.liveTag.watch_all && th.time_created) cataLog.set_watch_time_thread(th.key, cataLog.embed_mode, th.time_created, th.time_posted, th, watch);\r\n          watch[0] = (watch[0]&0xfffe0000);\r\n        }\r\n//        if (pref.liveTag.watch_all && th.time_created) { // working code.\r\n//          var time_watch = catalog_obj.catalog_func().get_watch_time_of_a_thread(th.key, th.time_created, th.time_posted || th.time_bumped, true);\r\n//          if (time_watch) site2[th.domain].check_reply.set_watch_time(watch, time_watch);\r\n//        }\r\n////        if (tag[2][0]===-1) tag[2][0]=1; // patch. This may be redundant.\r\n//        if (tag[2][0]&0x00010000) tag[2][0] &= 0xfffe0000; // there is a path which doesn't throuth 'check_reply'. // redundant, do it in 'check_reply.check_t1_op'\r\n////        if (watch[0]!==0) tag[2][2]=1; // PATCH with BUG, if op contains replies to me, this way can't find it until the thread gets new replies.\r\n        var pf = pref.liveTag;\r\n        var tags = [[],[]]; // first time only.\r\n        if (pref.liveTag.inherit_board_name) { // working code.\r\n          var idx0 = (pref.liveTag.lock_board_name)? 0 : 1;\r\n          tags[idx0][0] = lth.btag; // '#'+th.board.replace(/\\//g,'');\r\n        }\r\n        if (pref.liveTag.inherit_board_tags && lth.btag2) {\r\n          var idx1 = (pref.liveTag.lock_board_tags)? 0 : 1;\r\n          tags[idx1] = tags[idx1].concat(lth.btag2);\r\n        }\r\n        var tags_op = site2[th.domain].check_reply.check_t1_op(th); // extracting tags in op is redundant when tags are NOT locked, but locked extracting is only here, so this can't be removed.\r\n        if (tags_op.length!=0) {\r\n          var idx2 = (pref.liveTag.lock_tags_in_op)? 0 : 1;\r\n          tags[idx2] = tags[idx2].concat(tags_op);\r\n//          tags[idx2] = tags_op.concat(tags[idx2]);\r\n        }\r\n        if (th.tags && th.tags.length!=0 && pref.test_mode['153']) tags[1] = tags[1].concat(th.tags);\r\n        this.exclude_tags(th, tags[0], tags[1]);\r\n//        if (tags_old) for (var i=0;i<2;i++) if (tags_old[i]) tags[i] = tags[i].concat(tags_old[i]);\r\n        if (th.parse_funcs.has_editing && th.posts[0].editing && tags[0].length!=0) tags[0] = this.extract_tags_trim_editing(th, lth, tags[0]);\r\n        if (tags[0].length!=0) lth.t0 = this.update_tags_in_th(tags[0], null, {}, (tags[0].length < pref.liveTag.max)? tags[0].length : pref.liveTag.max, th, watch, this.mems[th.domain][th.board]); // update this.keys_fix\r\n        if (tags[1].length!=0) this.extract_tags(th, tags[1], this.keys_fix);\r\n        else {\r\n          if (lth.t1!==null) lth.t1 = null;\r\n          this.update_pn_buf.delayed_do();\r\n        }\r\n      }\r\n      return lth;\r\n    },\r\n    update_tags_in_editing_posts: function(th, lth, ed_f){ // called only when th.parse_funcs.has_editing === true.\r\n      var posts_obj = th.parse_funcs.posts_obj(th,lth.ed_t[lth.ed_t.length-1].no);\r\n      var flag_added = false;\r\n      for (var i=lth.ed_t.length-1;i>=0;i--) if (typeof(lth.ed_t[i])!=='string') {\r\n        var post = posts_obj[lth.ed_t[i].no];\r\n        if (post && !post.editing) {\r\n          if (pref.liveTag.from==='post' || post.no==th.no) {\r\n            site2[th.domain].wrap_to_parse.posts({posts:[post], __proto__:th});\r\n            var extracted_tags = site2[th.domain].check_reply.check_t1_op(post);\r\n            if (extracted_tags.length!=0) flag_added = true;\r\n            lth.ed_t = lth.ed_t.slice(0,i).concat(extracted_tags).concat(lth.ed_t.slice(i+1));\r\n          } else lth.ed_t.splice(i,1);\r\n          ed_f[ed_f.length] = post;\r\n        }\r\n      }\r\n      if (ed_f.length==0) return undefined;\r\n      if (pref.debug_mode['24']) console.log(th.key+': retag_req: '+extracted_tags+', '+flag_added+', '+(lth.ed_t && lth.ed_t.map(function(v){return (typeof(v)==='string')? v : v.no+'('+v.time+')';})));\r\n      if (lth.ed_t.length==0) {\r\n        lth.ed_t = null;\r\n        return undefined;\r\n      }\r\n      return (flag_added)? this.extract_tags(th, lth.ed_t, null, null, true) : // has extracted_tags always.\r\n        (extracted_tags)? this.extract_tags_trim_editing(th, lth, lth.ed_t, true) && undefined : // return undefined for not update intentionally.\r\n        undefined;\r\n    },\r\n    extract_tags_trim_editing: function(th, lth, extracted_tags, retag_editing){\r\n      var ex_tags_keep = null;\r\n      for (var i=extracted_tags.length-1;i>=0;i--) if (typeof(extracted_tags[i])!=='string') { // tags are reverse ordered.\r\n        if (!ex_tags_keep) ex_tags_keep = extracted_tags.slice(0,i+1);\r\n        extracted_tags.splice(i,1);\r\n      }\r\n      if (ex_tags_keep || retag_editing) {\r\n        lth.ed_t = (retag_editing || !lth.ed_t)? ex_tags_keep : ex_tags_keep.concat(lth.ed_t); // reverse order\r\n        if (pref.debug_mode['24']) console.log(th.key+ ': lth.ed_t: '+ (lth.ed_t && lth.ed_t.map(function(v){return (typeof(v)==='string')? v : v.no+'('+v.time+')';})));\r\n      }\r\n      return extracted_tags;\r\n    },\r\n    extract_tags: function(th, extracted_tags, keys_fix, clean, retag_editing){\r\n      var lth = this.mems[th.domain][th.board][th.no];\r\n      if (th.parse_funcs.has_editing) extracted_tags = this.extract_tags_trim_editing(th, lth, extracted_tags, retag_editing);\r\n      if (!keys_fix) {\r\n        this.keys_fix = {};\r\n        var t0 = lth.t0; // runs getter 1 times only.\r\n        if (t0!==null && t0.length!=0) {\r\n          if (pref.liveTag.ci) for (var i=0;i<t0.length;i++) this.keys_fix[t0[i].toLowerCase()] = t0[i];\r\n          else for (var i=0;i<t0.length;i++) this.keys_fix[t0[i]] = t0[i];\r\n        }\r\n      }\r\n      var t0len = t0!==undefined? t0.length : lth.t0.length;\r\n      var t1 = this.update_tags_in_th(extracted_tags, lth.t1, this.keys_fix, pref.liveTag.max-t0len, th, lth.wt, this.mems[th.domain][th.board], clean);\r\n      if (t1.length!=0 || (lth.t1 && lth.t1.length!==0)) lth.t1 = t1;\r\n      this.update_pn_buf.delayed_do();\r\n      this.keys_fix = null;\r\n//      else if (ur>=0) {\r\n//        for (var j=0;j<2;j++) {\r\n//          var tgt = tag[j];\r\n//          for (var i=0;i<tgt.length;i++) this.check_update_tags_color(tgt[i],ur);\r\n//        }\r\n//      }\r\n      return lth;\r\n    },\r\n    tags_boardlist: null,\r\n    update_boardlist: function(force_redraw){\r\n////      if (!site3[site.nickname].bds && site3[site.nickname].boards) { // working code.\r\n//////        site3[site.nickname].bds = {};\r\n////        for (var i=0;i<site3[site.nickname].boards.length;i++) site3[site.nickname].bds['/'+site3[site.nickname].boards[i].board+'/'] = null;\r\n////      }\r\n//      if (site.components.boardlist && site3[site.nickname].bds) {\r\n      if (site.components.boardlist) {\r\n        if (this.tags_boardlist===null) {\r\n          this.tags_boardlist = [];\r\n          pref_func.settings.onchange_funcs['virtualBoard.search.show'](null, true);\r\n          this.filter_onchange(pref.virtualBoard.search, true);\r\n        }\r\n        var i=0;\r\n        var flag = force_redraw;\r\n        var p = 0;\r\n        var j=0;\r\n        var p_remove = pref.virtualBoard.p_board==='both' && pref.virtualBoard.p_remove;\r\n        var sv_rexps = pref.virtualBoard.search.show && pref.virtualBoard.search.rexps; // search valid and rexps\r\n        while (j<pref.virtualBoard.max && i<this.tags_array_old.length) {\r\n//        while (i<pref.virtualBoard.max+p && i<this.tags_array_old.length) {\r\n          var key = this.tags_array_old[i].key;\r\n          if (p_remove && (('/'+key.substr(1)+'/') in this.mems[site.nickname])) p++;\r\n          else if (!sv_rexps || this.update_pn_disp_func(sv_rexps, (pref.liveTag.ci)? key.toLowerCase() : key)) {\r\n            if (this.tags_boardlist[j]!==key) {\r\n              this.tags_boardlist[j] = key;\r\n              flag = true;\r\n            }\r\n            j++;\r\n          }\r\n          i++;\r\n        }\r\n        if (j!=this.tags_boardlist.length) {this.tags_boardlist.splice(j,this.tags_boardlist.length-j); flag=true;}\r\n        if (flag) site2[site.nickname].show_boardlist(this.tags_boardlist, this.boardlist_click_entry);\r\n      }\r\n    },\r\n////    update_boardlist_1: function(tag){ // working code, but too slow.\r\n////      var pn = this.update_tag_string([tag].concat(this.tags_boardlist), ' / ', this.boardlist_click_entry);\r\n////      site2[site.nickname].show_boardlist(pn);\r\n////    },\r\n//    update_boardlist_1: (function(){ // working code, but not used.\r\n//      var buf = [];\r\n//      var delayed_do = new DelayBuffer(\r\n//        function(){\r\n//          var tags = Object.create(null);\r\n//          for (var i=0;i<buf.length;i++) tags[liveTag.tags_ci[(pref.liveTag.ci)? buf[i].toLowerCase() : buf[i]].key] = null;\r\n////          var pn = liveTag.update_tag_string(Object.keys(tags).concat(liveTag.tags_boardlist), ' / ', liveTag.boardlist_click_entry); // slow in 8chan.\r\n//          site2[site.nickname].show_boardlist_physical_board(Object.keys(tags), liveTag.boardlist_click_entry);\r\n//          buf = [];\r\n//        }, 500).get_bound_func();\r\n//      return function(tag) {\r\n//        if (site.components.boardlist) {\r\n//          buf[buf.length] = tag;\r\n//          delayed_do();\r\n//        }\r\n//      };\r\n//    })(),\r\n\r\n//    refresh_end_proc: function(){\r\n//      for (var i in this.tags) if (this.tags[i].ur_cs===null) this.count_ur_sub(i);\r\n//      for (var i in this.tags_update_state) this.tags[i].ur = null;\r\n//      for (var i in this.tags_update_state) {\r\n//        if (this.tags[i].ur===null) this.count_ur(i);\r\n//        this.update_tag_node(i);\r\n//      }\r\n//      this.tags_update_state = Object.create(null);\r\n//    },\r\n    update_tag_node: function(tag, node_in_boardlist, broadcast){\r\n      if (cataLog.threads!==null) {\r\n////if (!pref.test_mode['24']) {\r\n        var keys = liveTag.tags[tag].mems_keys_obj(); // runs getter only 1 time. // working code.\r\n        var footer = (broadcast || !this.NC)? gClg.footer : this.footer; //  || cataLog.Footer;\r\n        for (var name in keys) footer.color_tag_node(name,tag, broadcast);\r\n//          if (cataLog.Footer) {\r\n//            var pn = cataLog.Footer.query_tag_node(name,tag);\r\n//            if (pn) this.color_tag_node(pn,tag);\r\n//          }\r\n////          if (cataLog.threads[name] && cataLog.threads[name][24] && cataLog.threads[name][24][3])\r\n////            this.update_tag_node_1(cataLog.threads[name][24][3],keys[name]);\r\n//////} else {\r\n//////        for (var i of this.tags[tag].mems_keys()) {\r\n//////          var name = i.key;\r\n//////          if (cataLog.threads[name] && cataLog.threads[name][24] && cataLog.threads[name][24][3])\r\n//////            this.update_tag_node_1(cataLog.threads[name][24][3].getElementsByClassName(pref.script_prefix+'_tag'), this.tags[tag].mems.get(i)); // can't get tag when i is derived from board.\r\n//////        }\r\n//////}\r\n      }\r\n      if (!this.NC) {\r\n        var tag_bl = this.tags_ci[(pref.liveTag.ci)? tag.toLowerCase() : tag].key;\r\n        var pn = node_in_boardlist || site2[site.nickname].query_tag_node(tag_bl);\r\n        if (pn) this.color_tag_node(pn, tag_bl);\r\n//      else if (this.tags_boardlist && this.tags_boardlist.indexOf(tag_bl)!=-1) this.update_tag_node_1(site.components.boardlist, tag_bl);\r\n      }\r\n    },\r\n//    update_tag_node: function(tag, node_in_boardlist){ // working code.\r\n//      if (catalog_obj && catalog_obj.catalog_func()!=null) {\r\n//        var threads = catalog_obj.catalog_func().threads;\r\n//        for (var t in liveTag.tags[tag].tgts) \r\n//          for (var name in liveTag.tags[t].mems) \r\n//            if (threads[name] && threads[name][24] && threads[name][24][3]) this.update_tag_node_1(threads[name][24][3].getElementsByClassName(pref.script_prefix+'_tag'),tag);\r\n//      }\r\n//      if (node_in_boardlist) this.color_tag_node(node_in_boardlist, tag);\r\n//      else if (this.tags_boardlist.indexOf(tag)!=-1) this.update_tag_node_1(site.components.boardlist.getElementsByClassName(pref.script_prefix+'_tag'), tag);\r\n//    },\r\n//    update_tag_node_1: function(ppn, tag){ // working code, but removed because of query\r\n//      var pns = ppn.getElementsByClassName(pref.script_prefix+'_tag');\r\n//      var tag_ci = tag.toLowerCase();\r\n//      for (var j=0;j<pns.length;j++) {\r\n//        var txt = pns[j].textContent;\r\n//        if (txt===tag || (pref.liveTag.ci && txt.toLowerCase()===tag_ci)) {\r\n//          this.color_tag_node(pns[j],tag);\r\n//          break;\r\n//        }\r\n//      }\r\n//    },\r\n    color_tag_node : function(node, tag){\r\n      var pf = pref.liveTag.style;\r\n      var tobj = this.tags[tag];\r\n      var ur = !pf.use? 0 : tobj? tobj.ur : liveTag.tags[tag].ur; // NC ready\r\n      var style = (tobj && tobj['ex'])? (ur>=2? pf.exurtm : ur>=1? pf.exur : pf.ex)\r\n                : (tobj && tobj['in'])? (ur>=2? pf.inurtm : ur>=1? pf.inur : pf.in)\r\n//      var ur = (!pf.use)? 0 : tobj.ur; // working code, but NC\r\n//      var style = (tobj['ex'])? (ur>=2? pf.exurtm : ur>=1? pf.exur : pf.ex)\r\n//                : (tobj['in'])? (ur>=2? pf.inurtm : ur>=1? pf.inur : pf.in)\r\n                : ur>=2? pf.urtm : ur>=1? pf.ur : null;\r\n//      var style_str = (this.tags[tag]['ex'])? pref.liveTag.style_ex_str :\r\n//                      (this.tags[tag]['in'])? pref.liveTag.style_in_str :\r\n//                      (!pref.liveTag.style || this.tags[tag].ur<=0)? null :\r\n//                      (this.tags[tag].ur>=2)? pref.liveTag.style_urtm_str : pref.liveTag.style_ur_str;\r\n      if (style) node.setAttribute('style',style); // this can accept '!important'\r\n      else node.removeAttribute('style');\r\n    },\r\n//    color_tag_node : function(node, tag){\r\n//      if (this.tags[tag]['in']) common_func.init_set_style(node,pref.liveTag.style_in_obj4);\r\n//      else if (pref.liveTag.style) {\r\n//        if (this.tags[tag].ur>2) common_func.init_set_style(node,pref.liveTag.style_urtm_obj4);\r\n//        else if (this.tags[tag].ur>0) common_func.init_set_style(node,pref.liveTag.style_ur_obj4);\r\n//        else common_func.init_set_style(node,null);\r\n//      } else common_func.init_set_style(node,null);\r\n//    },\r\n    update_tag_nodes: function(tags, sep_txt, func_click, pn_old, tags_old){ // stateful fast approach\r\n      var tags_old_org = (pref.debug_mode['35'])? tags_old && tags_old.slice() : null;\r\n      var debug_refs = (tags_old_org)? [] : null;\r\n      var pn = pn_old || document.createElement('span');\r\n      var ref = pn.firstChild;\r\n      for (var j=0;j<tags.length;j++) {\r\n        var debug_before = tags_old && tags_old.slice();\r\n        if (tags_old_org) debug_refs.push(ref && ref.textContent || null);\r\n        var sep = null;\r\n        var tag = tags[j];\r\n        if (tags_old && tag==tags_old[j]) {\r\n          if (ref) ref = ref.nextSibling;\r\n          if (ref && j!=tags.length-1) ref = ref.nextSibling; // check j for shortening case\r\n          if (tags_old_org) debug_refs.push('same');\r\n        } else {\r\n          var idx = (tags_old)? tags_old.indexOf(tag, j) : -1;\r\n          if (idx==-1) { // new\r\n            pn.insertBefore(this.create_tag_node_1(tag, func_click, 'span'), ref);\r\n            sep = true;\r\n            if (tags_old) tags_old.splice(j,0,tag);\r\n            if (tags_old_org) debug_refs.push('new');\r\n          } else if (idx==j+1) { // down\r\n            var tgt = ref;\r\n            var sep2 = ref.nextSibling; // sep must exist, because this is a case of down.\r\n            ref = sep2.nextSibling;\r\n            var idx2 = tags.indexOf(tags_old[j], j+1);\r\n            var tag2 = tags_old.splice(j,1)[0];\r\n            if (idx2==-1) {\r\n              pn.removeChild(sep2);\r\n              pn.removeChild(tgt);\r\n              if (tags_old_org) debug_refs.push('remove');\r\n            } else {\r\n              var ref2 = pn.childNodes[(idx2+1)*2-1] || null; // +1 for myself, because of down\r\n              pn.insertBefore(sep2, ref2); // reverse order\r\n              pn.insertBefore(tgt, ref2);\r\n              tags_old.splice(idx2,0,tag2);\r\n              if (tags_old_org) debug_refs.push('down');\r\n            }\r\n            ref = ref.nextSibling;\r\n            if (ref && j!=tags.length-1) ref = ref.nextSibling; // check j for shortening\r\n          } else { // up\r\n            var tgt = pn.childNodes[idx*2];\r\n            sep = tgt.previousSibling; // sep must exist, because this is a case of up.\r\n            pn.insertBefore(tgt,ref);\r\n            tags_old.splice(j,0,tags_old.splice(idx,1)[0]);\r\n            if (tags_old_org) debug_refs.push('up');\r\n          }\r\n        }\r\n        if (j!=tags.length-1 && (!ref || sep)) pn.insertBefore(sep!==true && sep || document.createTextNode(sep_txt), ref);\r\n        if (tags_old_org) {\r\n          if (tags_old && tags.slice(0,j+1).toString()!==tags_old.slice(0,j+1).toString())\r\n            console.log('ERROR: update_tag_nodes: arr: ', j, tags_old, tags, debug_before, tags_old_org, debug_refs);\r\n          if (tags_old && pn.textContent.indexOf(tags_old.slice(0,j+1).join(sep_txt))!=0)\r\n            console.log('ERROR: update_tag_nodes_1: ', j, pn.textContent, tags_old, debug_before, tags_old_org, debug_refs);\r\n        }\r\n      }\r\n      if (ref) {\r\n        while (ref.nextSibling) pn.removeChild(ref.nextSibling);\r\n        pn.removeChild(ref);\r\n      }\r\n      if (tags_old_org) if (pn.textContent!==this.create_tag_nodes(tags, sep_txt, func_click).textContent)\r\n          console.log('ERROR: update_tag_nodes: ', pn.textContent, tags, tags_old_org);\r\n      return pn;\r\n    },\r\n    create_tag_nodes: function(tags, sep, func_click){ // equivalent function to 'update_tag_nodes', but stateless approach.\r\n      var pn = document.createElement('span');\r\n//      pn.setAttribute('class',pref.script_prefix+'_tag');\r\n//      pn.setAttribute('name',pref.script_prefix+'_tag_parent');\r\n      for (var j=0;j<tags.length;j++) {\r\n        if (j!=0 && sep) pn.appendChild(document.createTextNode(sep));\r\n        pn.appendChild(this.create_tag_node_1(tags[j], func_click, 'span'));\r\n      }\r\n      return pn;\r\n    },\r\n    create_tag_node_1: function(tag, func_click, tagname){\r\n      var pn = document.createElement(tagname);\r\n      pn.setAttribute('class',pref.script_prefix+'_tag');\r\n      pn.textContent = tag;\r\n      this.color_tag_node(pn,tag);\r\n//      pn.onclick = func_click;\r\n//      pn.onmouseover = this.tag_onmouseover;\r\n      return pn;\r\n    },\r\n    tag_node_onclick: function(e){ // must be bound\r\n      var tag = e.target.textContent;\r\n      if (!this.tags[tag]) this.prep_NC(tag);\r\n      this.cbx_changed(tag, pref.liveTag.click_func, null, null, e.ctrlKey);\r\n    },\r\n    prep_NC: function(tag){ // NotConsolidated\r\n//      console.log('prep_NC: '+tag);\r\n      if (this===liveTag) return; // safe for lazy draw.\r\n      var tag_ci = (pref.liveTag.ci)? tag.toLowerCase() : tag;\r\n      if (!liveTag.tags_ci[tag_ci]) return;\r\n      if (!this.tags_ci[tag_ci]) {\r\n        var tobj = liveTag.tags_ci[tag_ci];\r\n        this.tags_ci[tag_ci] = this.NC? {pn:null, pk:false,   in:false,   ex:false,   __proto__:tobj}\r\n                                      : {pn:null, pk:tobj.pk, in:tobj.in, ex:tobj.ex, __proto__:tobj}; // pk,in,ex are stored here, but copy in cbx_onchange\r\n      }\r\n      if (!this.tags[tag]) this.tags[tag] = this.tags_ci[tag_ci];\r\n    },\r\n//    extract_tags_in_posts : function(th, tags, name){\r\n//      tag[1] = this.update_tags_in_th(tags, tag[1][0], tag[0][1], pref.liveTag.max-tag[0][0].length, name);\r\n//      this.update_pn_buf.delayed_do();\r\n//    },\r\n  };\r\n//  liveTag.key_dirty = Object.create(liveTag.key_dirty_creation);\r\n//  liveTag.cbx_onchange_entry = liveTag.cbx_onchange_entry(liveTag);\r\n//  liveTag.update_pn_buf = new DelayBuffer(liveTag.update_pn.bind(liveTag), 500);\r\n  liveTag.update_pn_buf = new DelayBuffer(liveTag.update_pn.bind(liveTag), pref.liveTag.disp_delay);\r\n  liveTag.update_pn_1_lazy = new DelayBuffer(liveTag.update_pn_1.bind(liveTag, true), pref.liveTag.lazy_delay);\r\n  liveTag.tags_ci = Object.getPrototypeOf(liveTag.tags);\r\n  if (pref.cli.auto) pref_func.site2_json(false,true,['liveTag']);\r\n//  thread_reader_init();\r\n\r\n\r\n  var hiddenPosts = (!pref.test_mode['162'])? null : (function(){\r\n    function hide_unhide(pn, unhide, pn_done){\r\n//      pn = (site.hasPostContainer)? posts[i].pn.parentNode : posts[i].pn; // this is not slow critically, because filterd posts are not so many.\r\n      if (!pn || pn===pn_done) return;\r\n      if (unhide) pn.classList.remove(pref.script_prefix+'_hidden');\r\n      else pn.classList.add(pref.script_prefix+'_hidden');\r\n      return pn;\r\n    }\r\n    function get_hp(lth){\r\n      var hp = lth.hp;\r\n      return (hp===undefined)? (localStorage? JSON.parse(localStorage[site2[lth.domain].ls_key_hiddenPosts+lth.board+lth.no]||null) : null) : hp; // null means 'no hiddenPosts'\r\n    }\r\n    function save(lth, hp){\r\n      var data = Object.keys(hp);\r\n      var ls_key = site2[lth.domain].ls_key_hiddenPosts+lth.board+lth.no;\r\n      if (localStorage) if (data.length===0) delete localStorage[ls_key]; else localStorage[ls_key] = JSON.stringify(hp);\r\n      lth.hp = (data.length>0)? hp : null;\r\n    }\r\n    function search_post_from_data(clg, key, no){\r\n      var posts = clg.threads[key][16].posts;\r\n      for (var i=0;i<posts.length;i++) if (posts[i].no===no) return posts[i].pn;\r\n    }\r\n    function search_post_from_pn(pn){\r\n      while (!pn.classList.contains('post')) pn = pn.parentNode;\r\n      return pn;\r\n    }\r\n    function hide_if_hit(th, posts, redraw_hp, unhide, no){\r\n      var hp = redraw_hp || get_hp(th.lth);\r\n      if (!hp) return;\r\n      var lthq = th.lth.q;\r\n      for (var i=0;i<posts.length;i++) {\r\n        var post = posts[i];\r\n        if (post.no===no) continue;\r\n        if (hp[post.no]>(redraw_hp? 1:0)) {hide_unhide(post.pn); continue;}\r\n        if (post.quotes) for (var j=0;j<post.quotes.length;j++) if (post.quotes[j][0]===lthq && (hp[post.quotes[j][1]]&0x01)) {hp[post.no] = 1; hide_unhide(post.pn); break;}\r\n        if (unhide && (!post.quotes || j===post.quotes.length) && hp[post.no]===1) {delete hp[post.no]; hide_unhide(post.pn, true); continue;}\r\n      }\r\n//      if (hp) for (var i=0;i<posts.length;i++) if (th.posts[i].no in hp) hide_unhide(posts[i].pn);\r\n    }\r\n    function hide_unhide_cmd_entry(clg, key, no, pn, unhide, series){\r\n      var pn_done = hide_unhide(search_post_from_pn(pn), unhide);\r\n      hide_unhide(search_post_from_data(clg, key, no), unhide, pn_done);\r\n      var lth = liveTag.mems.getFromName(key);\r\n      var hp = get_hp(lth)||{};\r\n      var redraw = series || unhide && hp[no]&0x01;\r\n      if (unhide) delete hp[no]; else hp[no] = series? 3 : 2; // 3: head of series,  2: hidden by manual,  1: tails of series,  undefined: not hidden.\r\n      if (redraw) hide_if_hit(clg.threads[key][16], clg.threads[key][16].posts, hp, unhide, no);\r\n      save(lth, hp);\r\n    }\r\n    return {\r\n      hide_if_hit: hide_if_hit,\r\n      cmd: function(clg, key, no, pn_menu, cmd){\r\n        if (cmd==='PDISABLEHIDE' || cmd==='PENABLEHIDE' || cmd==='PCLEARHIDE') {\r\n          var hp = get_hp(liveTag.mems.getFromName(key)) || {};\r\n          var posts = clg.threads[key][16].posts;\r\n          for (var i=0;i<posts.length;i++) if (posts[i].no in hp) hide_unhide(posts[i].pn, cmd!=='PENABLEHIDE');\r\n        } else hide_unhide_cmd_entry(clg, key, no, pn_menu, cmd==='PUNHIDE', cmd==='PHIDEAFTER');\r\n        if (cmd==='PCLEARHIDE') save(liveTag.mems.getFromName(key),{});\r\n      },\r\n    };\r\n  })();\r\n\r\n  \r\n//  https://nolanlawson.com/2015/09/29/indexeddb-websql-localstorage-what-blocks-the-dom/    // IndexedDB IS TOO SLOW TO USE, Chrome47@2015.09.29\r\n//  http://stackoverflow.com/questions/28693674/indexeddb-slow-retrieval-issue               // IndexedDB IS TOO SLOW TO USE @2015.02\r\n//  http://stackoverflow.com/questions/10102571/indexeddb-very-slow-compared-to-websql-what-am-i-doing-wrong // IndexedDB IS TOO SLOW TO USE @2012.01.12\r\n//  https://dev.mozilla.jp/2012/07/why-no-filesystem-api-in-firefox/\r\n//  https://developer.mozilla.org/ja/docs/Web/API/IndexedDB_API/Browser_storage_limits_and_eviction_criteria#Storage_limits\r\n//  https://developer.mozilla.org/en-US/docs/Web/API/File_System_API/Introduction\r\n//  http://www.html5rocks.com/ja/tutorials/file/filesystem/\r\n  var IDB = (function(){\r\n    function IDBRequest_onerror(e){\r\n      console.log('IDB: ERROR: ',e);\r\n      indicator.report({err_str:'IDB_ERROR:'+e.target.error.name});\r\n      for (var key of db_info.keys()) console.log(db_info.get(key));\r\n      console.log('last_closed: ',last_closed);\r\n    }\r\n    function IDBRequest_onblocked(e){\r\n      if (pref.debug_mode['21']) console.log('IDB: BLOCKED: '+e.oldVersion+' -> '+e.newVersion);\r\n    }\r\n    function IDBTransaction_onabort(e){\r\n      console.log('IDBT: ABORT: '+e.target.error.name,e);\r\n      indicator.report({err_str:'IDBT_ABORT:'+e.target.error.name});\r\n      var tr = e.target;\r\n      var db = tr.db;\r\n//      if (tr.error.name==='TimeoutError') {\r\n//        var info = tr_info.get(tr);\r\n//        tr_info.delete(e.target);\r\n//        console.log(info);\r\n//        if (info && info.req) {\r\n//          add_req(reqs_re, db.name, info.req); // retry\r\n//          console.log('Requeued... '+db.name.replace(/^[^\\/]*/,'')+req.no+' '+req.kind);\r\n//        }\r\n//      }\r\n      // http://stackoverflow.com/questions/10477489/what-are-the-details-can-be-obtained-from-webkitstorageinfo-queryusageandquota\r\n//      if (window.webkitStorageInfo) window.webkitStorageInfo.queryUsageAndQuota(webkitStorageInfo.TEMPORARY, console.log.bind(console));\r\n      if (navigator.webkitTemporaryStorage) navigator.webkitTemporaryStorage.queryUsageAndQuota(console.log.bind(console));\r\n      IDBT_rereq(db, tr, 'IDBT_abort:'+tr.error.name);\r\n//      IDB_close(db, null, 'IDBT_abort:'+tr.error.name);\r\n    }\r\n    function IDBTransaction_onerror(e){\r\n      console.log('IDBT: ERROR: '+e.target.error.name,e);\r\n      indicator.report({err_str:'IDBT_ERROR:'+e.target.error.name});\r\n      var tr = e.target.transaction;\r\n      var db = e.target.db || e.target.transaction && e.target.transaction.db;\r\n      IDBT_rereq(db, tr, 'IDBT_onerror:'+tr.error.name);\r\n//      IDB_close(db, null, true);\r\n    }\r\n    function IDBRequest_onupgradeneeded(e){\r\n      e.target.onsuccess = null; // prevent from being called twice.\r\n      IDBRequest_onsuccess_open(e, true);\r\n    }\r\n    function IDBRequest_onsuccess_open(e, from_upgrade){\r\n      var db = e.target.result;\r\n      version[db.name] = db.version;\r\n      delete waiting_open[db.name+((from_upgrade)? 'vc' : 'rw')];\r\n//      var reqs = (from_upgrade)? reqs_vc[db.name] : reqs_rw[db.name];\r\n      var reqs = from_upgrade && reqs_vc[db.name] || reqs_rw[db.name];\r\n      if (pref.debug_mode['20']) {\r\n        var count = 1;\r\n        var debug_reqs = reqs && reqs.debug_query() || null;\r\n//        var debug_coms = reqs && reqs.ary.slice(0,10).map(function(v){return v.kind;});\r\n        console.log('IDB: opened: '+(db_info.size+1)+' '+db.name.replace(/^[^\\/]*/,'')+' v'+db.version+', '+(debug_reqs && debug_reqs.length)+' req(s), '+e.type+', '+(debug_reqs && debug_reqs.coms));\r\n      }\r\n//      if (db_info.has(db)) console.log('IDB: ERROR: the same db was returned.', db_info.get(db));\r\n      var info = {type:e.type, tr_count:1, reqs:reqs, pass:0, wdg:null, crawler:1, oss:{}, tr_info:new Map(), req_kinds:{}, coms:debug_reqs && debug_reqs.coms, done:0, done_put:0}; // tr_count.set(db, 1); // tr_count.set(db, (tr_count.get(db)||0)+1); // returns the same db sometimes.\r\n      db_info.set(db, info);\r\n      if (reqs) {\r\n        for (var i=0;i<db.objectStoreNames.length;i++) info.oss[db.objectStoreNames[i]] = null;\r\n        if (from_upgrade) {\r\n          var tr = e.target.transaction;\r\n          tr_inc(db);\r\n          tr_set(tr, function(){IDBRequest_close({target:{db:db}});});\r\n          if (db.version==1) { // patch for the first creation.\r\n            delete waiting_open[db.name+'rw']; // entried by 'rw' always.\r\n            pref4.archive.IDB_board_sel_options = null;\r\n            db.createObjectStore('Meta'); // dummy write\r\n            return req_end(db, from_upgrade);\r\n          }\r\n          var num_downgraded = 0;\r\n          while (true) {\r\n            indicator_update();\r\n            var req = reqs.shift();\r\n            info.pass++;\r\n            if (!req) break;\r\n            if (pref.debug_mode['20']) info.done++;\r\n            if (pref.debug_mode['22'] && req.kind!=='put') console.log('req_upgrade: '+req.no+', '+req.kind+', '+req.key+', '+reqs.debug_query().length);\r\n            info.req_kinds[req.kind] = null;\r\n            var contains = info.oss[req.no]===null;\r\n            if (req.kind==='put') {\r\n              if (!contains) {\r\n                make_1(db, req, IDBRequest_close);\r\n                info.oss[req.no] = null;\r\n                if (pref.debug_mode['22']) console.log('req_upgrade: '+req.no+', '+req.kind+', '+req.key+', '+reqs.debug_query().length);\r\n              } else {\r\n                add_req(reqs_rw, db.name, req); // downgrade\r\n                if (pref.debug_mode['22']) num_downgraded++;\r\n              }\r\n//              else put_1(db,req, IDBRequest_close);\r\n            } else if (req.kind==='delete_th') {\r\n              if (contains) delete_th_1(db, req, tr); // returns void, not a transaction.\r\n            }\r\n          }\r\n          if (pref.debug_mode['22'] && num_downgraded) console.log('req_upgrade: downgraded: '+num_downgraded);\r\n          req_end(db, from_upgrade);\r\n        } else {\r\n          var loop_func = function complete_func(){req_1(db,reqs,from_upgrade,complete_func);}\r\n          info.complete_func = loop_func;\r\n          req_1(db, reqs, from_upgrade, loop_func);\r\n//          while (info.crawler<pref.archive.IDB.nof_tr && !reqs.isEmpty) { // not sensitive when reqs are added after this.\r\n//            info.crawler++;\r\n//            req_1(db, reqs, from_upgrade, loop_func);\r\n//          }\r\n        }\r\n      } else req_end(db, from_upgrade);\r\n    }\r\n    function req_1(db, reqs, from_upgrade, complete_func){ // multi transaction can be accepted, but not debugged.\r\n      var info = db_info.get(db);\r\n      if (!info) return; // closed by watchdog\r\n      indicator_update();\r\n      var req = (waiting_open[db.name+'vc']!==undefined)? null : reqs.shift();\r\n      info.pass++;\r\n      if (req) {\r\n        if (pref.debug_mode['20']) info.done++;\r\n        if (pref.debug_mode['22'] && req.kind!=='put_m') console.log(db.name.replace(/^[^\\/]*/,'')+req.no+', '+req.kind+', '+req.key+', '+reqs.debug_query().length);\r\n        var contains = info.oss[req.no]===null;\r\n        if (req.kind==='get_all_m') {\r\n          var reqs_current = [];\r\n          var nos = {};\r\n          for (var i=0;i<req.reqs.length;i++) if (info.oss[req.reqs[i].no]===null) {\r\n            reqs_current[reqs_current.length] = req.reqs[i];\r\n            nos[req.reqs[i].no] = null;\r\n          }\r\n          if (reqs_current.length!==0) get_all(db,{nos:Object.keys(nos), reqs:reqs_current}, complete_func);\r\n          else complete_func();\r\n//        } else if (req.kind==='get_all') {\r\n//          if (contains) get_all(db,{nos:[req.no], reqs:[req]}, complete_func);\r\n//          else complete_func();\r\n        } else if (req.kind==='list_os') {\r\n          req.obj(site.nickname, db.name.substr(pref.script_prefix.length+1), Array.prototype.slice.call(db.objectStoreNames).filter(function(v){return v!=='Meta';}));\r\n          complete_func();\r\n        } else if (req.kind==='put_m') {\r\n          var reqs_current = [];\r\n          var nos = {};\r\n          for (var i=0;i<req.reqs.length;i++)\r\n            if (info.oss[req.reqs[i].no]!==null) add_req(reqs_vc, db.name, req.reqs[i]); // upgrade\r\n            else {\r\n              reqs_current[reqs_current.length] = req.reqs[i];\r\n              nos[req.reqs[i].no] = null;\r\n            }\r\n          if (pref.debug_mode['22']) console.log(db.name.replace(/^[^\\/]*/,'')+(reqs_current[0] && reqs_current[0].no || 'skipped')+'('+Object.keys(nos).length+')'+', '+req.kind+'('+reqs_current.length+'), '+req.key+', '+reqs.debug_query().length);\r\n          if (reqs_current.length>1) {\r\n            req.reqs = reqs_current;\r\n            req.nos = Object.keys(nos);\r\n            put_1(db,req, complete_func);\r\n          } else if (reqs_current.length==1) put_1(db,reqs_current[0], complete_func);\r\n          else complete_func();\r\n        } else if (req.kind==='put') {\r\n          if (!contains) {add_req(reqs_vc, db.name, req);complete_func();} // upgrade\r\n          else put_1(db,req, complete_func);\r\n//        } else if (req.kind==='put_if') {\r\n//          if (contains) put_1(db,req, complete_func);\r\n//          else complete_func();\r\n        } else if (req.kind==='delete') {\r\n          if (contains) delete_1(db,req, complete_func);\r\n          else complete_func();\r\n        } else if (req.kind==='clean_up' || req.kind==='clean_m') {\r\n          if (!times_pruned[db.name]) times_pruned[db.name] = {list:[], write:null};\r\n          var list = times_pruned[db.name].list;\r\n          var list_len_old = list.length;\r\n          var nos = {Meta:null, __proto__:req.obj};\r\n          for (var i=0;i<list.length;i++) nos[list[i].no] = null;\r\n          if (req.kind==='clean_up') {\r\n            var date = Date.now();\r\n            var names = db.objectStoreNames;\r\n            for (var i=0;i<names.length;i++) if (nos[names[i]]!==null) list[list.length] = {no:names[i], pruned_time:date};\r\n          } else {\r\n            for (var i=0;i<req.reqs.length;i++)\r\n              if (info.oss[req.reqs[i].no]===null) if (nos[req.reqs[i].no]!==null) list[list.length] = {no:req.reqs[i].no, pruned_time:req.reqs[i].obj};\r\n          }\r\n          if (times_pruned[db.name].write===null) {\r\n            times_pruned[db.name].write = false;\r\n            clean_up(db, req, complete_func);\r\n          } else clean_up_end_proc(db, null, complete_func, list.length!==list_len_old);\r\n//        } else if (req.kind==='check_clean') { // working code.\r\n//          if (!times_pruned[db.name]) times_pruned[db.name] = [];\r\n//          if (contains) times_pruned[db.name][times_pruned[db.name].length] = {no:req.no, pruned_time:req.obj};\r\n//          clean_up_end_proc(db, null, complete_func, contains);\r\n\r\n//          if (req.kind==='clean_up') { // working code.\r\n//            var tgts = [];\r\n//            for (var i=0;i<db.objectStoreNames.length;i++) if (req.obj[db.objectStoreNames[i]]!==null) tgts[tgts.length] = db.objectStoreNames[i];\r\n//            clean_up(db, {tgts:tgts, prune:(req.kind==='clean_up'), __proto__:req}, complete_func); // call 'clean_up_end_proc' in 'clean_up'.\r\n//          } else {\r\n//            check_cleaned[db.name][check_cleaned[db.name].length] = {no:req.no, pruned_time:req.obj};\r\n//            reqs[reqs.length] = {no:-1, key:'pruned_time', obj:check_cleaned[db.name], kind:'put'};\r\n//            clean_up_end_proc(db, null, complete_func);\r\n//          }\r\n////        } else if (req.kind==='clean_up') { // working code.\r\n////          check_cleaned[db.name] = Date.now();\r\n////          var tgts = [];\r\n////          for (var i=0;i<db.objectStoreNames.length;i++) if (req.obj[db.objectStoreNames[i]]!==null) tgts[tgts.length] = db.objectStoreNames[i];\r\n////          clean_up(db, {tgts:tgts, prune:true, __proto__:req}, complete_func);\r\n//////          for (var i=0;i<db.objectStoreNames.length;i++) if (req.obj[db.objectStoreNames[i]]!==null) clean_1(db, {no:db.objectStoreNames[i], prune:true, __proto__:req});\r\n////        } else if (req.kind==='check_clean') {\r\n////          var date = Date.now();\r\n////          if (date - (check_cleaned[db.name] || 0 ) > pref.archive.IDB.check_every * ((pref.test_mode['75'])? 60000 : 3600000)) {\r\n////            check_cleaned[db.name] = date;\r\n////            clean_up(db, {tgts:Array.prototype.slice.call(db.objectStoreNames), __proto__:req}, complete_func);\r\n////          } else complete_func();\r\n//////          for (var i=0;i<db.objectStoreNames.length;i++) clean_1(db, {no:db.objectStoreNames[i], __proto__:req});\r\n        } else complete_func();\r\n        if (info.crawler<pref.archive.IDB.nof_tr && !reqs.isEmpty) {\r\n          info.crawler++;\r\n          req_1(db, reqs, from_upgrade, complete_func);\r\n        }\r\n      } else if (--info.crawler===0) req_end(db, from_upgrade);\r\n    }\r\n    function req_end(db, from_upgrade){\r\n      IDBRequest_close({target:{db:db}});\r\n      var req_parent = from_upgrade && reqs_vc[db.name] && reqs_vc || reqs_rw;\r\n      if (req_parent[db.name] && req_parent[db.name].isEmpty) delete req_parent[db.name];\r\n//      delete (from_upgrade && reqs_vc[db.name] && reqs_vc || reqs_rw)[db.name]; // BUG, might be remade.\r\n      if (reqs_re[db.name]) reqs_re2rw(db.name);\r\n//      if ((!from_upgrade)? reqs_vc[db.name] : reqs_rw[db.name]) open_db(db.name, (!from_upgrade)? db.version+1 : undefined);\r\n//      if (req_parent===reqs_vc) {\r\n      if (from_upgrade) {\r\n        if (reqs_rw[db.name] && !reqs_rw[db.name].isEmpty) open_db(db.name);\r\n      } else if (reqs_vc[db.name] && !reqs_vc[db.name].isEmpty) open_db(db.name, true);\r\n      if (Object.keys(reqs_rw).length===0 && Object.keys(reqs_vc).length===0 && Object.keys(reqs_re).length===0) watchdog.stop();\r\n    }\r\n    function reqs_re2rw(db_name){\r\n      if (reqs_rw[db_name]) reqs_rw[db_name].push_all(reqs_re[db_name]);\r\n      else reqs_rw[db_name] = reqs_re[db_name];\r\n      delete reqs_re[db_name];\r\n    }\r\n\r\n    function delete_th_1(db,req, tr){\r\n//      tr_inc(db);\r\n      db.deleteObjectStore(req.no);\r\n//      tr_set(tr, (function(func_prev){\r\n//        return function(e){\r\n//          if (func_prev) func_prev(e);\r\n//          IDBRequest_close({target:{db:db}}); // cause ERROR, probably bug in browser, oncomplete is fired too early at createObjectStore and deleteObjectStore.\r\n//        }\r\n//      })(tr.oncomplete));\r\nif (pref.debug_mode['23']) console.log('IDB: delete_th: '+db.name+req.no+', '+db.objectStoreNames.length);\r\n    }\r\n    function make_1(db,req, complete_func){\r\n      tr_inc(db);\r\n      var tr = db.createObjectStore(req.no).transaction;\r\n      tr_set(tr, (function(func_prev){ // tr belongs to db, transaction.oncomplete is called ONE TIME, so cascade oncomplete funcs.\r\n        return function(e){\r\nif (!pref.test_mode['66']) {\r\n          put_1(db,req, complete_func);\r\n} else {\r\n          add_req(reqs_rw, db.name, req); // downgrade // DOESN'T WORK WHY???  // cause ERROR, probably bug in browser, oncomplete is fired too early at createObjectStore and deleteObjectStore.\r\n          complete_func({target:{db:db}});\r\n}\r\n          if (func_prev) func_prev(e);\r\n        }\r\n      })(tr.oncomplete));\r\n    }\r\n    function put_1(db,reqs_in, complete_func){\r\n      var reqs = reqs_in.reqs || [reqs_in];\r\n      try {\r\n        var IDBT = tr_set(db.transaction(reqs_in.nos || reqs_in.no, 'readwrite', reqs_in), complete_func, reqs_in, db);\r\n        for (var i=0;i<reqs.length;i++) {\r\n          var req = reqs[i];\r\n          if (pref.test_mode['82'] && req.obj instanceof Blob) {\r\n            if (pref.test_mode['83']) req.obj = null;\r\n            else if (pref.test_mode['84']) {\r\n              var str = '';\r\n              while (str.length*2<req.obj.size) str += Math.random();\r\n              req.obj = str;\r\n            } else {\r\n              var codes = [];\r\n              for (var j=0;j*2<req.obj.size;j++) codes[j] = Math.floor(Math.random()*65536);\r\n              req.obj = String.fromCharCode.apply(null,codes);\r\n            }\r\n          }\r\n          if (pref.debug_mode['23']) console.log('put_'+((reqs_in.nos)?'m: ':'1: ')+db.name.replace(/^[^\\/]*/,'')+req.no+', '+req.key+((req.key==='posts')? ':'+req.obj.length:'')+((reqs_in.nos)? ' '+(i+1)+'/'+reqs_in.nos.length+'/'+reqs_in.reqs.length:''));\r\n          var IDBR = IDBT.objectStore(req.no).put((req.key!=='posts')? req.obj : JSON.stringify(req.obj, archiver.store_json_func),\r\n                                                  (req.key!=='posts')? req.key : req.key+'_'+req.obj[0].no);\r\n          IDBR.onerror   = IDBRequest_onerror;\r\n//          IDBR.onsuccess = clear_wdg_get_db; // IDBRequest_onsuccess;\r\n        }\r\n        if (pref.debug_mode['20']) db_info.get(db).done_put += reqs.length;\r\n      } catch (e){\r\n//        if (pref.debug_mode['20'])\r\n          console.log('IDB: fail to put: '+e.name+': ' + JSON.stringify(req,['no','key','kind']), e, db_info.get(db));\r\n        if (e.name==='InvalidStateError') { // retry when latter requests catch up with a prior request which creates new objectStore.\r\n          add_req(reqs_re, db.name, req); // retry\r\n          if (pref.debug_mode['20']) console.log('IDB: re-scheduled:');\r\n        }\r\n        complete_func({target:{db:db}});\r\n      }\r\n    }\r\n//    function IDBRequest_onsuccess(e){\r\n//      var db = clear_wdg_get_db(e);\r\n//      var info = db_info.get(db);\r\n//      if (info) info = info.tr_info.get(e.target.transaction);\r\n//      if (info && --info.nof_reqs===0) info.func(e);\r\n//    }\r\n    function delete_1(db,req, complete_func){\r\n      tr_set(db.transaction(req.no,'readwrite'), complete_func).objectStore(req.no).delete(req.key); // .onsuccess = IDBRequest_close;\r\n    }\r\n    function tr_set(tr, complete_func, req, db){\r\n      tr.oncomplete = (req)? IDBTransaction_oncomplete : complete_func;\r\n      tr.onabort    = IDBTransaction_onabort;\r\n      tr.onerror    = IDBTransaction_onerror;\r\n      if (req) db_info.get(db).tr_info.set(tr,{req:req, func:complete_func}); //, nof_reqs:req.reqs && req.reqs.length || 1});\r\n      return tr;\r\n    }\r\n    function IDBTransaction_oncomplete(e){\r\n      var info = db_info.get(e.target.db);\r\n      if (info) {\r\n        var func = info.tr_info.get(e.target).func;\r\n        info.tr_info.delete(e.target);\r\n        if (func) func(e);\r\n      }\r\n    }\r\n    function clean_up(db,req, complete_func){\r\n      var contains = db.objectStoreNames.contains('Meta');\r\n      if (contains) tr_set(db.transaction('Meta','readwrite'), complete_func).objectStore('Meta').get('pruned_time').onsuccess = clean_1_onsuccess;\r\n      else {\r\n        times_pruned[db.name].write = true;\r\n        clean_up_end_proc(db,req, complete_func, true);\r\n      }\r\n    }\r\n    function clean_1_onsuccess(e, prune){\r\n      var db = e.target.transaction.db;\r\n      var src = e.target.result;\r\n      if (src) {\r\n        var info = db_info.get(db);\r\n        var oss = info && info.oss || {};\r\n        src = src.filter(function(v){return oss[v.no]===null;});\r\n        var src_obj = {};\r\n        for (var i=0;i<src.length;i++) {if (src_obj[src[i].no]!==undefined) src.splice(src_obj[src[i--].no],1); src_obj[src[i].no] = i;}\r\n        times_pruned[db.name].list = src.concat(times_pruned[db.name].list.filter(function(v){return src_obj[v.no]===undefined;}));\r\n      }\r\n      times_pruned[db.name].write = true;\r\n      clean_up_end_proc(db, null, null, true); // 'complete_func' will be called by transaction.oncomplete.\r\n    }\r\n//    function clean_up(db,req, complete_func){ // working code.\r\n//      req.complete_func = function(e, tr){\r\n//        if (tr) {\r\n//          if (req.tgts.length===0) return;\r\n//          tr.oncomplete = null;\r\n//        }\r\n//        clean_1(db,req, complete_func);\r\n//      };\r\n////      req.complete_func = function(){clean_1(db,req, complete_func);};\r\n//      req.tr = pref.archive.IDB.nof_tr;\r\n//      for (var i=0;i<req.tr;i++) clean_1(db,req, complete_func);\r\n//    }\r\n//    function clean_1(db,req, complete_func){\r\n//      if (req.tgts.length===0) {\r\n//        if (--req.tr===0) clean_up_end_proc(db,req, complete_func, true);\r\n//        return;\r\n//      }\r\n//      if (db_info.get(db).wdg) delete db_info.get(db).wdg;\r\n//      var no = req.tgts.shift();\r\n//      if (pref.debug_mode['23']) console.log('clean_1: '+no+', '+req.tgts.length);\r\n//      tr_set(db.transaction(no,'readwrite'), req.complete_func).objectStore(no).get('pruned_time').onsuccess = (req.prune)? clean_1_onsuccess_prune : clean_1_onsuccess;\r\n//    }\r\n////    function clean_1(db,req){ // CAUSE ERROR in Chrome, \"Internal error: Too many transactions queued.\" Upper limit is about 400-500.\r\n////      tr_inc(db);\r\n////      var tr = db.transaction(req.no,'readwrite');\r\n////      tr.objectStore(req.no).get('pruned_time').onsuccess = (req.prune)? clean_1_onsuccess_prune : clean_1_onsuccess;\r\n////      tr.oncomplete = IDBRequest_close;\r\n////      tr.onaboart = IDBTransaction_onabort;\r\n////      tr.onerror = IDBTransaction_onerror;\r\n////    }\r\n//    function clean_1_onsuccess_prune(e){\r\n//      clean_1_onsuccess(e, true);\r\n//    }\r\n//    function clean_1_onsuccess(e, prune){\r\n//      var value = e.target.result;\r\n//      if (!value && !prune) return;\r\n//      var date = value || Date.now();\r\n//      var db_name = e.target.transaction.db.name;\r\n//      var board = db_name.replace(pref.script_prefix+'.','');\r\n//      check_cleaned[db_name][check_cleaned[db_name].length] = {no:e.target.source.name, pruned_time:date};\r\n//      if (!value && prune) e.target.source.put(date, 'pruned_time');\r\n//      else if (pref.test_mode['76']) e.target.transaction.oncomplete(null, e.target.transaction);\r\n//    }\r\n//////    function clean_1_onsuccess(e, prune){ // working code.\r\n//////      var value = e.target.result;\r\n//////      var date = Date.now();\r\n//////      if (!value && prune) e.target.source.put(date, 'pruned_time');\r\n//////      else {\r\n//////        if (value + pref.archive.IDB.prune * 3600000 < date) acc(site.nickname, e.target.transaction.db.name.replace(pref.script_prefix+'.',''),\r\n//////                                                                 e.target.source.name, null, null, 'delete_th');\r\n//////      }\r\n//////    }\r\n    function clean_up_end_proc(db,req, complete_func, put_to_IDB){\r\n      var tgts = times_pruned[db.name].list;\r\n//      if (sort) tgts.sort(function(a,b){return a.pruned_time - b.pruned_time;}); // sort is in-place\r\n      var time_prune = Date.now() - pref.archive.IDB.prune * 3600000;\r\n//      var board = db.name.replace(pref.script_prefix+'.','');\r\n      var i=0;\r\n      while (i<tgts.length && tgts[i].pruned_time < time_prune) {\r\n        if (pref.archive.IDB.auto_restore_remove) gClg.Remove_thread_refresh(site.nickname + db.name.replace(/^[^\\/]*/,'') + tgts[i].no, null, true);\r\n        if (pref.archive.IDB.prune_flush) add_req(reqs_rw, db.name, {no:tgts[i++].no, key:null, obj:flush_and_prune, kind:'get_all'}, true);\r\n        else add_req(reqs_vc, db.name, {no:tgts[i++].no, key:null, obj:null, kind:'delete_th'}, true);\r\n      }\r\n//      while (i<tgts.length && tgts[i].pruned_time < time_prune) add_req(reqs_vc, db.name, {no:tgts[i++].no, key:null, obj:null, kind:'delete_th'}, true); // acc(site.nickname, board, tgts[i++].no, null, null, 'delete_th');\r\n      if (i>0) tgts.splice(0,i);\r\n      if (times_pruned[db.name].write && (put_to_IDB || i!==0)) add_req(reqs_rw, db.name, {no:'Meta', key:'pruned_time', obj:tgts, kind:'put'});\r\n      if (complete_func) complete_func();\r\n    }\r\n    function flush_and_prune(domain, board, no, result){\r\n      var filename = 'CatChan_archive_pruned_'+domain+'-'+board.slice(1,-1)+'-'+no+'.tar';\r\n      var file_id = 'pruned_'+domain+board+no+Date.now();\r\n      archiver.event_funcs['export_thread'](domain, board, no, result, file_id, filename);\r\n      acc(domain, board, no, null, null, 'delete_th');\r\n    }\r\n    function get_all(db,reqs_in, complete_func){\r\n//      var req = tr_set(db.transaction(req.no,'readonly'), complete_func).objectStore(req.no).getAll(req.key).onsuccess = req.obj;\r\n      var IDBT = tr_set(db.transaction(reqs_in.nos,'readonly'), complete_func);\r\n      for (var i=0;i<reqs_in.reqs.length;i++) {\r\n        var req = reqs_in.reqs[i];\r\n        if (pref.debug_mode['23']) console.log('get_all: '+db.name.replace(/^[^\\/]*/,'')+req.no+', '+req.key);\r\n        var IDBR = IDBT.objectStore(req.no).openCursor((req.key==='posts')? IDBKeyRange.bound('posts', 'postt', false, true) : undefined);\r\n        IDBR.onsuccess = get_all_onsuccess;\r\n        req.result = {};\r\n        req_dictionary.set(IDBR,req);\r\n      }\r\n    }\r\n    var req_dictionary = new Map();\r\n    function clear_wdg_get_db(e){\r\n      var db = e.target.transaction.db;\r\n      var info = db_info.get(db);\r\n      if (info) info.pass++; // may be stopped by watchdog.\r\n      return db;\r\n    }\r\n    function get_all_onsuccess(e){\r\n      var db = clear_wdg_get_db(e);\r\n      var IDBR = e.target;\r\n      var req = req_dictionary.get(IDBR);\r\n      var cursor = e.target.result;\r\n      if (cursor) {\r\n        req.result[cursor.key] = (cursor.key.indexOf && cursor.key.indexOf('posts')===0)? JSON.parse(cursor.value) :\r\n//                                 (req.key==='posts')? null :\r\n                                 (cursor.value instanceof ArrayBuffer)? common_func.arraybuffer2blob(cursor.key, cursor.value) : cursor.value;\r\n        cursor.continue();\r\n      } else {\r\n        req_dictionary.delete(IDBR);\r\n        var board = e.target.transaction.db.name.replace(pref.script_prefix+'.','');\r\n        var no = e.target.source.name;\r\n        setTimeout((function(req,board,no){return function(){req.obj(site.nickname, board, no, req.result);};})(req,board,no),0);\r\n        if (pref.debug_mode['29']) {\r\n          var sum = 0;\r\n          for (var i in req.result) sum += (i.indexOf('posts')===0)? JSON.stringify(req.result[i]).length*2 : req.result[i] && req.result[i].size;\r\n          console.log('IDB: '+board+no+': '+Object.keys(req.result).length+' files, '+sum.toLocaleString()+' bytes.');\r\n        }\r\n      }\r\n    }\r\n    function IDBRequest_close(e){\r\n      var db = e.target.source && e.target.source.transaction.db || e.target.db || e.target.result;\r\n      var info = db_info.get(db);\r\n      if (!info) return; // closed by WATCHDOG.\r\n      if (info.tr_count!==1) info.tr_count -= 1; //      if (tc===1) {db.close();tr_count.delete(db);}\r\n      else IDB_close(db, info);\r\n    }\r\n    function IDBT_rereq(db, tr, message){\r\n      var info = db_info.get(db);\r\n      if (info && tr.mode!=='readonly') {\r\n        var req = info.tr_info.get(tr).req;\r\n        add_req((req.kind==='delete_th')? reqs_vc : reqs_re, db.name, req);\r\n        console.log(message+': close and re-req, '+req.kind);\r\n      }\r\n    }\r\n    function IDB_close(db, info, force){\r\n      if (!info) info = db_info.get(db);\r\n      if (force && info) for (var i of info.tr_info.keys()) IDBT_rereq(db, i, force);\r\n      db_info.delete(db);\r\n      var case_of_test_mode78 = !force && info.req_kinds['delete_th']!==undefined && Object.keys(info.req_kinds).length===1 || db.version==1;\r\n      if (pref.debug_mode['26'] && case_of_test_mode78) console.log('Hit the case of test_mode[78]');\r\n//      if (Object.keys(info.req_kinds).length===0 && db.version===1) console.log('test: v1');\r\n//      else\r\n      if (!case_of_test_mode78 || pref.test_mode['78']) db.close();\r\n      else setTimeout(function(){db.close();},0);\r\n      if (pref.debug_mode['20']) console.log('IDB: closed: '+db_info.size+' '+db.name.replace(/^[^\\/]*/,'')+' v'+db.version+', '+((info)? info.type+', done:'+info.done+', done_put:'+info.done_put+', '+info.coms : ''));\r\n      if (info) info.db = db;\r\n      last_closed = info;\r\n      indicator_update();\r\n    }\r\n    var last_closed = null; // for debug\r\n    var db_info = new Map();\r\n    function tr_inc(db){\r\n      db_info.get(db).tr_count += 1;\r\n    }\r\n    var times_pruned = {};\r\n    var version = {};\r\n    var waiting_open = {}; // exclusive request,(closing a transaction without any acceess may cause an IDB ABORT ERROR)\r\n    var reqs_vc = {};\r\n    var reqs_rw = {};\r\n    var reqs_re = {};\r\n    var sub_callbacks = {};\r\n    function acc(domain,board,no,key,obj, kind){\r\n//      var db_name = pref.script_prefix+'.'+domain+board;\r\n//      if (site2[domain].domain_IDB_check) domain = site2[domain].domain_IDB_check(board);\r\n      if (domain===site.nickname) {\r\n        var db_name = pref.script_prefix+'.'+board;\r\n        var req_obj = {no:no, key:key, obj:obj, kind:kind};\r\n        var reqs = (kind==='delete_th')? reqs_vc : reqs_rw;\r\n        add_req(reqs, db_name, req_obj, true);\r\n//      if (!reqs[db_name]) reqs[db_name] = [req_obj]; // not improved.\r\n//      else reqs[db_name].push(req_obj);\r\n//      open_db(db_name, ver);\r\n      } else {\r\n        if (typeof(obj)==='function') {\r\n          sub_callbacks[domain+board+no] = obj;\r\n          obj = 'sub_callback';\r\n        }\r\n//try {\r\n        if (pref.test_mode['86'] && (obj instanceof ArrayBuffer)) send_message(domain,['IDB',['ACC',[domain,board,no,key,null, kind]]], null, [obj]); // https://bugs.chromium.org/p/chromium/issues/detail?id=334408\r\n        else send_message(domain,['IDB',['ACC',[domain,board,no,key,obj, kind]]]);\r\n//} catch (e) { // BUG. pn is attatched in some case.\r\n//  console.log(e);\r\n//}\r\n      }\r\n    }\r\n    function open_db(db_name, ver, from_watchdog){\r\n      var key = db_name+((ver)? 'vc' : 'rw');\r\n      if (waiting_open[key]!==undefined && (!from_watchdog || ++waiting_open[key]<db_info.size)) {\r\n        if (pref.debug_mode['27']) if (from_watchdog) console.log('IDB: WATCHDOG: '+key+', '+waiting_open[key]);\r\n        return;\r\n      }\r\n      waiting_open[key] = 0;\r\n      var req = window.indexedDB.open(db_name, ver && version[db_name]+1 || undefined); // version[db_name]+1 is NaN at initial.\r\n      req.onerror = IDBRequest_onerror;\r\n      req.onsuccess = IDBRequest_onsuccess_open;\r\n      req.onupgradeneeded = IDBRequest_onupgradeneeded;\r\n      req.onblocked = IDBRequest_onblocked;\r\n    }\r\n    function req_raw(domain,db_name,os_name,key,obj, kind){\r\n      if (domain===site.nickname) {\r\n        var req_obj = {no:os_name, key:key, obj:obj, kind:kind};\r\n        var reqs = (kind==='delete_th')? reqs_vc : reqs_rw;\r\n        add_req(reqs, db_name, req_obj, true);\r\n      }\r\n    }\r\n    function add_req(reqs, db_name, req, call){\r\n      indicator_req_count++;\r\n      if (!indicator && indicator_parent) {\r\n        indicator = indicator_parent.shift('limegreen', 'w', 'IDB', 0);\r\n        indicator.report({start:Date.now(), prog_str:'Opening'});\r\n      } else indicator_update();\r\n      if (!reqs[db_name]) {\r\n        reqs[db_name] = new ReqFifo(db_name, reqs!==reqs_vc, req);\r\n        if (call) open_db(db_name, reqs===reqs_vc);\r\n      } else {\r\n        var spawn = reqs===reqs_rw && reqs[db_name].isEmpty;\r\n        reqs[db_name].push(req);\r\n        if (spawn) {\r\n          for (var i of db_info.keys()) {\r\n            var info = db_info.get(i);\r\n            if (info.crawler<pref.archive.IDB.nof_tr && i.name===db_name && info.type==='success') {\r\n              info.crawler++;\r\n              setTimeout(info.complete_func, 100);\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      watchdog.start(pref.archive.IDB.watchdog*1000);\r\n    }\r\n    var ReqFifo = function(db_name, allow_multi, init_val){\r\n      this.ary = [];\r\n      this.ary_ro = [];\r\n//      this.count = 0;\r\n      this.allow_multi = allow_multi;\r\n      if (!this.reqs[db_name]) this.reqs[db_name] = {};\r\n      this.reqs = this.reqs[db_name]; // shared\r\n      this.cls = {}; // req clusters\r\n      if (init_val) this.push(init_val);\r\n      this.cl = null;\r\n      this.cl_idx = 0;\r\n    };\r\n    ReqFifo.prototype = {\r\n      shift: function(){\r\n        var max = (this.allow_multi)? pref.archive.IDB.nof_cl_max : 1;\r\n        var i=0;\r\n        while (i<this.ary_ro.length && i<max && this.ary_ro[i].kind==='get_all') i++;\r\n        if (i!=0) return {kind:'get_all_m', reqs:this.ary_ro.splice(0,i)};\r\n        else if (this.ary_ro.length!==0) return this.ary_ro.shift();\r\n//        if (this.ary_ro.length>0) return this.ary_ro.shift();\r\n        if (this.ary.length===0 && !this.cl) return null;\r\nif (!pref.test_mode['79']) {\r\n        var retval = [];\r\n  if (!pref.test_mode['81']) {\r\n        var ref_no;\r\n        while (retval.length<max) {\r\n          var req = this.ary[i];\r\n          if (!req || req.kind!=='put') break;\r\n          if (ref_no!==undefined && (!req.no || ref_no!==req.no)) break;\r\n          if (req.cl) {\r\n            if (req.idx===undefined) {\r\n              this.ary[i] = {kind:'put', cl:[req].concat(req.cl), idx:0, no:req.no};\r\n              req.cl = null;\r\n              req = this.ary[i];\r\n              this.cls[req.no] = req;\r\n            }\r\n            if (req.idx>=req.cl.length-1) {\r\n              this.cls[req.no] = null;\r\n              i++;\r\n            }\r\n            req = req.cl[req.idx++]; // all reqs are 'put'.\r\n          } else {\r\n            this.cls[req.no] = null;\r\n            i++;\r\n          }\r\n          retval[retval.length] = req;\r\n          delete this.reqs[req.no + req.key]; // shared, so must use delete.\r\n          if (retval.length===pref.archive.IDB.nof_cl-1) ref_no = req.no;\r\n        }\r\n        if (this.ary[i] && this.ary[i].cl && this.ary[i].idx<this.ary[i].cl.length) { // round robin\r\n          var cl = this.ary.splice(i,1)[0];\r\n          this.ary[this.ary.length] = cl;\r\n        }\r\n  } else {\r\n        while (retval.length<max) { // working code.\r\n          var req;\r\n          if (this.cl===null) {\r\n            req = this.ary[i];\r\n            if (!req || req.kind!=='put') break;\r\n            i++;\r\n            if (req.cl) {\r\n              this.cls[req.no] = null;\r\n              this.cl = req.cl;\r\n              this.cl_idx = 0;\r\n              req.cl = null; // for retry.\r\n            }\r\n          } else {\r\n            req = this.cl[this.cl_idx++]; // all reqs are 'put'.\r\n            if (this.cl_idx>=this.cl.length) this.cl = null;\r\n          }\r\n          retval[retval.length] = req;\r\n          delete this.reqs[req.no + req.key]; // shared, so must use delete.\r\n        }\r\n  }\r\n        if (i>0) this.ary.splice(0,i);\r\n        if (i===0 && this.ary[0] && this.ary[0].kind==='check_clean') this.cls['check_clean'] = null;\r\n        return (retval.length>1)? {kind:'put_m', reqs:retval} : (retval.length>0)? retval[0] : this.ary.shift();\r\n} else {\r\n        while (i<max) { // working code // not debugged enough\r\n          var req = this.ary[i];\r\n          if (!req) break;\r\n          if (req.cl) {\r\n            this.ary = this.ary.slice(0,i+1).concat(req.cl,this.ary.slice(i+1));\r\n            req.cl = null; // for retry.\r\n          }\r\n          if (req.kind==='put') {\r\n            this.cls[req.no] = null;\r\n            delete this.cls[req.no + req.key]; // shared, so must use delete.\r\n            i++;\r\n          } else break;\r\n        }\r\n////        while (i<max && this.ary[i] && this.ary[i].kind==='put') {delete this.cls[this.ary[i].no + this.ary[i].key]; i++;} // working code.\r\n////        this.count += i;\r\n        return (i>1)? {kind:'put_m', reqs:this.ary.splice(0,i)} :\r\n                      this.ary.shift();\r\n}\r\n      },\r\n      push: function(req){\r\n        if (req.kind==='get_all' || req.kind==='list_os') {\r\n          this.ary_ro[this.ary_ro.length] = req;\r\n          return;\r\n        }\r\n        if (req.kind==='put') {\r\n          var key = req.no + req.key;\r\n          var req_old = this.reqs[key];\r\n        }\r\n        if (req_old) req_old.obj = (req.key==='posts')? req_old.obj.concat(req.obj) : req.obj;\r\n        else if (key) {\r\n          if (req.key==='posts' || req.key==='pruned_time' || req.key==='posts_deleted') this.reqs[key] = req;\r\n//          var idx = this.reqs[req.no] - count; // maybe NaN // not debugged.\r\n//          if (idx>1 && idx!==this.ary.length) {\r\n//            this.ary.splice(idx,req);\r\n//            this.reqs[req.no] = count + idx +1;\r\n//          } else {\r\n//            this.ary[this.ary.length] = req;\r\n//            this.reqs[req.no] = count+this.ary.length;\r\n          var req_cl = this.cls[req.no];\r\n          if (req_cl) { // 'reqs' is used by 'put_m'.\r\n            if (req_cl.cl) req_cl.cl[req_cl.cl.length] = req;\r\n            else req_cl.cl = [req];\r\n          } else {\r\n            this.ary[this.ary.length] = req;\r\n            this.cls[req.no] = req;\r\n          }\r\n        } else if (req.kind==='check_clean') {\r\n          var key = null + req.key;\r\n          var req_old = this.cls[key];\r\n          if (req_old) req_old.reqs[req_old.reqs.length] = req;\r\n          else {\r\n            req = {kind:'clean_m', reqs:[req], no:null};\r\n            this.cls[key] = req;\r\n            this.ary[this.ary.length] = req;\r\n          }\r\n        } else this.ary[this.ary.length] = req;\r\n      },\r\n      push_all: function(reqs){\r\n        while (!reqs.isEmpty) this.push(reqs.shift());\r\n      },\r\n//      get length(){return this.ary.length - this.idx;},\r\n//      get length(){return this.ary.length + this.ary_ro.length;},\r\n//      get length(){return this.ary.length + this.ary_ro.length + (this.cl && this.cl.length-this.cl || 0);}, // approx.\r\n      get length(){return this.ary.length + this.ary_ro.length;},\r\n      get length_whole(){\r\n        var sum = 0;\r\n        for (var i=0;i<this.ary.length;i++) sum += (this.ary[i].cl)? this.ary[i].cl.length-(this.ary[i].idx||0) : 1;\r\n        return sum + this.ary_ro.length;\r\n      },\r\n      get isEmpty(){return this.ary.length===0 && !this.cl && this.ary_ro.length===0;},\r\n      reqs: {},\r\n      debug_query: function(){\r\n        var whole_array = Array.prototype.concat.apply(this.ary_ro, this.ary.map(function(v){return (v.cl)? ((!pref.test_mode['81'])? v.cl.slice(v.idx || 0) : [v].concat(v.cl)) : v;}));\r\n        var coms = [];\r\n        var count = 1;\r\n        var i=0;\r\n        while (coms.length<20 && i++<whole_array.length) {\r\n          if (whole_array[i] && whole_array[i-1].kind===whole_array[i].kind) count++;\r\n          else {\r\n            coms[coms.length] = whole_array[i-1].kind+((count!=1)? '*'+count:'');\r\n            count = 1;\r\n          }\r\n        }\r\n        if (i<whole_array.length) coms[coms.length-1] += '...';\r\n//        var coms = whole_array.map((function(){ // working code.\r\n//          var count = 1;\r\n//          return function(v,i,a){\r\n//            if (a[i+1] && v.kind===a[i+1].kind) {\r\n//              count++;\r\n//              return null;\r\n//            } else {\r\n//              var retval = v.kind+((count!=1)? '*'+count:'');\r\n//              count = 1;\r\n//              return retval;\r\n//            }\r\n//          }\r\n//        })()).filter(function(v){return v;});\r\n        return {coms:coms, length:this.ary_ro.length+'/'+this.ary.length+'/'+whole_array.length};\r\n      }\r\n    };\r\n    var indicator_parent = null;\r\n    var indicator = null;\r\n    var indicator_req_count = 0;\r\n    var indicator_update = function(){};\r\n    var indicator_update = DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(function(){\r\n      if (!indicator) return;\r\n      var stats = get_status();\r\n      indicator.report({prog_str:stats.str});\r\n      if (stats.total===0) {\r\n        indicator.report({end:Date.now()});\r\n        indicator = null;\r\n        indicator_req_count = 0;\r\n      }\r\n    },100));\r\n    function get_status(){\r\n      var nof_crawlers = 0;\r\n      for (var db of db_info.keys()) nof_crawlers += db_info.get(db).crawler;\r\n      var sums = [0, 0, 0, 0, 0, 0, Object.keys(reqs_vc).length, Object.keys(reqs_rw).length, Object.keys(reqs_re).length, nof_crawlers, db_info.size, Object.keys(waiting_open).length];\r\n      var tgts = [reqs_vc,reqs_rw,reqs_re];\r\n      for (var i=0;i<3;i++) {\r\n        if (sums[i+6]) for (var j in tgts[i]) {\r\n          sums[i+3] += tgts[i][j].length;\r\n          sums[i]   += tgts[i][j].length_whole;\r\n        }\r\n      }\r\n      return {sums:sums, total:sums.reduce(function(a,b){return a+b;}), str:sums.join('/')+'/'+indicator_req_count};\r\n    }\r\n    var watchdog = new Watchdog(function (){\r\n      var stats = get_status();\r\n      if (pref.debug_mode['27']) console.log('IDB: '+stats.str);\r\n      var inactivated = {};\r\n      for (var db of db_info.keys()) {\r\n        var info = db_info.get(db);\r\n        if (pref.debug_mode['27']) console.log(info);\r\n        if (info.wdg!==info.pass) {\r\n          info.wdg = info.pass;\r\n//        if (tgt.req && (!tgt.wdg || tgt.wdg!==tgt.req)) tgt.wdg = tgt.req;\r\n//        if (!tgt.wdg || tgt.wdg!==tgt.req) tgt.wdg = tgt.req; // BUG. lock when tgt.req===unefined or tgt.req===null. // This was patched in 'req_1'\r\n          inactivated[db.name] = null;\r\n        } else {\r\n          indicator_report();\r\n          IDB_close(db, info, 'IDB: WDG');\r\n        }\r\n      }\r\n      for (var i in reqs_vc) if (inactivated[i]!==null && !reqs_vc[i].isEmpty) open_db(i,true, true);\r\n      for (var i in reqs_rw) if (inactivated[i]!==null && (!reqs_vc[i] || reqs_vc[i].isEmpty) && !reqs_rw[i].isEmpty) open_db(i, undefined, true);\r\n      for (var i in reqs_re) if (inactivated[i]!==null && (!reqs_vc[i] || reqs_vc[i].isEmpty) && (!reqs_rw[i] || reqs_rw[i].isEmpty) && !reqs_re[i].isEmpty) {\r\n        reqs_re2rw(i);\r\n        open_db(i, undefined, true);\r\n      }\r\n      for (var db_name_key in waiting_open) {\r\n        var db_name = db_name_key.replace(/(rw|vc)$/,'');\r\n        if (inactivated[db_name]!==null && !reqs_vc[db_name] && !reqs_rw[db_name]) {\r\n          indicator_report();\r\n          open_db(db_name, db_name_key.search(/vc$/)!=-1, true);\r\n        }\r\n      }\r\n      if (stats.total!==0) watchdog.start(pref.archive.IDB.watchdog*1000);\r\n      function indicator_report(){\r\n        if (stats.str) {\r\n          indicator.report({err_str:'WDG: '+stats.str});\r\n          stats.str = '';\r\n        }\r\n      }\r\n    }, 60000);\r\n    return {\r\n      req: acc, // write: function(domain, board, no, key, data,     cmd)\r\n                // read : function(domain, board, no, key, callback, cmd)\r\n      req_raw: req_raw, // read : function(domain, db_name, os_name, key, callback, cmd)\r\n      clean_up: function(domain, board, nos){\r\n        if (version[pref.script_prefix+'.'+board]) {\r\n          acc(domain,board,null,null,nos, 'clean_up');\r\n          liveTag.mems[domain][board].IDB_synced = 1;\r\n        }\r\n      },\r\n      set_indicator: function(indicator){\r\n        if (!indicator_parent) indicator_parent = indicator;\r\n//        indicator_parent.shift().set('Red','IDB:');\r\n      },\r\n      sub_funcs: function(args, list){\r\n        if (args[0]==='ACC') {\r\n          if (args[1][4]==='sub_callback') args[1][4] = IDB.sub_ack;\r\n          else if (list.length>0) args[1][4] = list[0];\r\n          acc.apply(this,args[1]);\r\n        } else if (args[0]==='ACK') {\r\n          var dbtk = args[1].slice(0,3).join('');\r\n          if (sub_callbacks[dbtk]) sub_callbacks[dbtk].apply(this,args[1]);\r\n          delete sub_callbacks[dbtk];\r\n        }\r\n      },\r\n      sub_ack: function(domain, board, no, result){\r\n        send_message('parent',['IDB',['ACK',[domain,board,no,result]]]);\r\n      },\r\n    };\r\n  })();\r\n\r\n  var archiver = (function(){\r\n// http://www.redout.net/data/tar.html\r\n// dollchan\r\n// https://github.com/beatgammit/tar-js/blob/master/lib/tar.js\r\n// https://gist.github.com/kig/417483\r\n    var tar = (function(){\r\n      function make_header(blob, lth, suffix){\r\n        var header = new Uint8Array(512); // UInt8 for checksum.\r\n        suffix = (suffix.substr(0,3)==='tn_')?  'thumbs/' + encode_filename(suffix.substr(3)) :\r\n                 (suffix.substr(0,4)==='img_')? 'images/' + encode_filename(suffix.substr(4)) :\r\n                 encode_filename(suffix);\r\n        var name = lth.domain + '/' + encode_filename(lth.board.slice(1,-1)) + '/' + lth.no + '/' + suffix; // not to encode '/'\r\n        set_header(header,   0, name, 100);  // name\r\n        set_header(header, 100, '100777', 8);  // mode\r\n        set_header(header, 108, '0', 8);       // uid\r\n        set_header(header, 116, '0', 8);       // gid\r\n        set_header(header, 124, (blob.byteLength||blob.size||0).toString(8), 12);  // fileSize, octal // blob may be arraybuffer.\r\n        set_header(header, 136, Math.floor(Date.now()/1000).toString(8), 12);  // mtime, octal\r\n        set_header(header, 148, '        ', 8);  // checksum \r\n        header[156] = 0x30;  // type 0 as a normal file.\r\n        var checksum = 0;\r\n        for(i=0;i<157;i++) checksum += header[i];\r\n        set_header(header, 148, checksum.toString(8), 8); // checksum, octal\r\n        return header;\r\n      }\r\n      function set_header(header, pos, numstr, len) {\r\n        var j=0;\r\n        while (j<numstr.length && j<len) header[pos++] = numstr.charCodeAt(j++) & 0xff;\r\n        if (j<len) header[pos++] = 0x00;\r\n      }\r\n      function encode_filename(str){\r\n        return encodeURIComponent(str).replace(/[!'()*]/g, function(c) {\r\n          return '%' + c.charCodeAt(0).toString(16);});\r\n      }\r\n      var tars = {};\r\n      var count = 0;\r\n      return {\r\n        add_blob: function(blob, lth, suffix, tarfile, ignore_limit){ // blob may be arraybuffer.\r\n          if (!tars[tarfile]) tars[tarfile] = {files:[], size:0};\r\n          var tfile = tars[tarfile];\r\n          var size = blob.byteLength||blob.size;\r\n          tfile.files[tfile.files.length] = make_header(blob, lth, suffix);\r\n          tfile.size += 1;\r\n          tfile.files[tfile.files.length] = blob;\r\n          if (size%512!==0) tfile.files[tfile.files.length] = new Uint8Array(512-size%512);\r\n          tfile.size += Math.floor((size+511)/512);\r\n          if (!ignore_limit && (tfile.size>pref.archive.tarsize*2*1024 || pref.test_mode['71'])) this.flush(tarfile);\r\n        },\r\n        flush: function(tarfile, filename){\r\n          if (!tarfile) {for (var i in tars) this.flush(i); return;}\r\n          if (tars[tarfile]) { // called from both 'httpd.check_timestamp_and_flush' and 'archiver.flush_req', so the file might be flushed.\r\n            tars[tarfile].files[tars[tarfile].files.length] = new Uint8Array(1024);\r\n            download_url4(new Blob(tars[tarfile].files, {type:'application/x-tar'}), filename || 'CatChan_archive_updates_'+site.nickname+'_'+tarfile+'_'+(count++)+'.tar');\r\n            delete tars[tarfile];\r\n          }\r\n        },\r\n      };\r\n    })();\r\n    function store_posts(content, type, lth, suffix){\r\n      if (!window.URL) return;\r\n      if (!timestamp) set_timestamp();\r\n      download_url3(new Blob([content], {type:type}), lth, suffix, timestamp);\r\n    }\r\n    function download_url3(blob, lth, suffix, timestamp){\r\n      if (pref.archive.tar) tar.add_blob(blob, lth, suffix, timestamp);\r\n      else download_url4(blob, 'CatChan_'+lth.key.replace(/\\//g,'_') + '_' + suffix);\r\n    }\r\n    function download_url4(blob, filename){ // blob may be arraybuffer.\r\n      if (blob instanceof ArrayBuffer) blob = common_func.arraybuffer2blob(filename, blob);\r\n      if (brwsr.ff && !httpd.isLocal) {\r\n        send_message('parent',['ARCHIVER', ['DOWNLOAD', [blob, filename]]]);\r\n        return;\r\n      }\r\n      var url = window.URL.createObjectURL(blob);\r\n      download_url(url, filename);\r\n      window.URL.revokeObjectURL(url);\r\n//      if (!brwsr.ff || httpd.isLocal) window.URL.revokeObjectURL(url);\r\n    }\r\n    function download_url(url, filename){ // this doesn't work if url is cross-origined, for example, i.4cdn.org from boards.4chan.org in 4chan.\r\n      if (pref.test_mode['70']) return;\r\n//      if (brwsr.ff && !httpd.isLocal) {\r\n//        send_message('parent',['ARCHIVER', ['DOWNLOAD', [url, filename, site.nickname]]]); // doesn't work\r\n//        return;\r\n//      }\r\n      var a_link = document.createElement('div');\r\n      a_link.innerHTML = '<a href=' + url + ' download=\"' + filename + '\">';\r\n      if (brwsr.ff) site.script_body.appendChild(a_link);\r\n      a_link.childNodes[0].click();\r\n      if (brwsr.ff) site.script_body.removeChild(a_link);\r\n    }\r\n    var proto_archive = {initiator:'archive', get responseType(){return (pref.test_mode['85'])? 'blob' : 'arraybuffer';}, archive:true, callback_1:httpd.onload_archive, callback_1_fail:httpd.onload_archive_fail,\r\n                         get max(){return this.tgts.length;},\r\n                         get tgt(){return this.key + this.url.substr(this.url.lastIndexOf('/'));},\r\n                        };\r\n    var timestamp = null;\r\n    var month = {Jan:'01', Feb:'02', Mar:'03', Apr:'04', May:'05', Jun:'06', Jul:'07', Aug:'08', Sep:'09', Oct:'10', Nov:'11', Dec:'12'};\r\n    function set_timestamp(){\r\n      var arr = new Date().toString().split(' ').slice(1,5);\r\n      timestamp = [arr[2], month[arr[0]], arr[1], arr[3].replace(/:/g,'')].join('');\r\n      httpd.req({tgts:[], timestamp:timestamp, __proto__:proto_archive},0);\r\n    }\r\n    var flush_req = DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(function(){\r\n//      if (reqs.length==0 && xhrs.size==0) tar.flush();\r\n      httpd.check_timestamp_and_flush(timestamp);\r\n    },5000));\r\n    \r\n    var xhrs = new Map();\r\n    var reqs = [];\r\n//    function download_url2(url, lth, kind, to_file, to_idb){ // for test\r\n//      if (!timestamp) set_timestamp();\r\n//      var req = {url:url, lth:lth, kind:kind, to_file:to_file, to_idb:to_idb, timestamp:timestamp};\r\n    function download_url2(reqs_in){\r\n      httpd.req_add({tgts:reqs_in, timestamp:timestamp, __proto__:proto_archive},0);\r\n      return;\r\n    }\r\n////    function download_url2(reqs_in){ // working code.\r\n////      for (var i=0;i<reqs_in.length;i++) {\r\n////        if (xhrs.size>=10) reqs.push(reqs_in[i]);\r\n////        else {\r\n////          var xhr = new XMLHttpRequest();\r\n////          xhr.responseType = 'blob';\r\n////          xhr.onload  = download_url2_1_onload;\r\n////          xhr.onerror = download_url2_1_onload;\r\n////          xhr.onabort = download_url2_1_onload;\r\n////          download_url2_1(xhr, reqs_in[i]);\r\n////        }\r\n////      }\r\n////    }\r\n////    function download_url2_1(xhr, req){ // for test\r\n////      xhrs.set(xhr, req);\r\n////      xhr.open('GET', req.url);\r\n////      xhr.send();\r\n////      return xhr;\r\n////    }\r\n////    function download_url2_1_onload(e){\r\n////      var xhr = e.target;\r\n////      var req = xhrs.get(xhr);\r\n////      if (req.from) delete list_all_obj_downloading[req.from];\r\n////      if(xhr.status === 200 && e.type==='load') {\r\n////        var suffix = req.kind + '_'+ xhr.responseURL.replace(/.*\\//g,'');\r\n////        if (req.to_file) download_url3(xhr.response, req.lth, suffix, req.timestamp);\r\n////        if (!pref.test_mode['65']) if (req.to_idb) IDB.req(req.lth.domain, req.lth.board, req.lth.no, suffix, xhr.response, 'put');\r\n////      }\r\n////      if (reqs.length>0) {\r\n////        req = reqs.shift();\r\n////        download_url2_1(e.target, req);\r\n////      } else xhrs.delete(xhr);\r\n////      if (xhrs.size===0) tar.flush();\r\n////    }\r\n    function img_dl(kind, th, lth, posts, img, img_idb, webm, webm_idb, reqs){\r\n      for (var i=0;i<posts.length;i++) {\r\n        var url = (kind==='tn')? site2[th.domain].catalog_json2html3_thumbnail(posts[i],th.board) : site2[th.domain].catalog_json2html3_src(posts[i],th.board);\r\n        if (url) {\r\n          if (!timestamp) set_timestamp();\r\n//          var proto = {lth:lth, kind:kind, to_file:img||webm, to_idb:img_idb||webm_idb, timestamp:timestamp};\r\n          var proto = {domain:th.domain, board:th.board, no:th.no, key:th.key, kind:kind, to_file:img||webm, to_idb:img_idb||webm_idb, timestamp:timestamp, __proto__:proto_archive};\r\n          if (site2[th.domain].archive_patch_domain) site2[th.domain].archive_patch_domain(proto);\r\n          if ((url.substr(-5,5)==='.webm')? webm || webm_idb : img || img_idb) reqs[reqs.length] = {url:url, __proto__:proto};\r\n          if (posts[i].extra_files) for (var j=0;j<posts[i].extra_files.length;j++) {\r\n            url = (kind==='tn')? site2[th.domain].catalog_json2html3_thumbnail(posts[i].extra_files[j],th.board) : site2[th.domain].catalog_json2html3_src(posts[i].extra_files[j],th.board);\r\n            if ((url.substr(-5,5)==='.webm')? webm || webm_idb : img || img_idb) reqs[reqs.length] = {url:url, __proto__:proto};\r\n          }}}\r\n    }\r\n\r\n    var url_funcs_wrapped = false;\r\n    function url_funcs_wrap(){\r\n      for (var d in site2) {\r\n        if (site2[d].hasOwnProperty('catalog_json2html3_thumbnail')) site2[d].catalog_json2html3_thumbnail = wrap(site2[d].catalog_json2html3_thumbnail);\r\n        if (site2[d].hasOwnProperty('catalog_json2html3_src'))       site2[d].catalog_json2html3_src       = wrap(site2[d].catalog_json2html3_src);\r\n        if (site2[d].hasOwnProperty('parse_funcs')) {\r\n          var tgts = ['catalog_html','page_html','thread_html','post_html'];\r\n          for (var i=0;i<tgts.length;i++)\r\n            if (site2[d].parse_funcs.hasOwnProperty(tgts[i]) && site2[d].parse_funcs[tgts[i]].hasOwnProperty('op_img_url'))\r\n              site2[d].parse_funcs[tgts[i]].op_img_url = wrap(site2[d].parse_funcs[tgts[i]].op_img_url);\r\n        }\r\n      }\r\n      function wrap(func){\r\n        return function(th, board){\r\n          var url = func.call(this, th, board);\r\n          return (url && th.localArchive)? archiver.url2file(th.localArchive, url) : url;\r\n        }\r\n      }\r\n    }\r\n    var archive_no = 0;\r\n    function restore(file, result, archive, IDB, refresh_tgt){\r\n      if (!window.URL) return;\r\n      var th_obj = (IDB)? result :\r\n                   (file.type==='text/html')? new DOMParser().parseFromString(result, 'text/html') : JSON.parse(result);\r\n      var dbt = (pref.archive.format==='auto')? common_func.name2domainboardthread(file.name.replace(/\\.[^\\.]*$/,'').split('_')[0].split('-').slice(0,3).join('/'),true) :\r\n                                                [site0.domains[pref.archive.domain],\r\n                                                 '/'+pref.archive.board.replace(/\\//g,'')+'/'];\r\n      if (pref.test_mode['80']) dbt[1] = dbt[1].slice(0,-1) + ((IDB)? '_IDB/' : '_File/');\r\n      if (pref.archive.fix_inconsistency && dbt[0]!=='meguca') {\r\n        if (th_obj.posts[0].no!=dbt[2]) { // lain/drg/4654\r\n          th_obj.posts = [common_func.deep_copy(th_obj.posts[0])].concat(th_obj.posts);\r\n          th_obj.posts[0].no = parseInt(dbt[2],10);\r\n          console.log('Archiver: Fixed: added dummy OP: '+dbt.join(''));\r\n        }\r\n        for (var i=0;i<th_obj.posts.length;i++) if (th_obj.posts[i].filename===false) {\r\n          th_obj.posts[i].filename = 'LOST_AT_ARCHIVE';\r\n          console.log('Archiver: Fixed: filename was lost: '+dbt.join('')+'#'+th_obj.posts[i].no);\r\n        }\r\n      }\r\n      if (!url_funcs_wrapped) {\r\n        url_funcs_wrap();\r\n        url_funcs_wrapped = true;\r\n      }\r\n      var ths = cataLog.scan_boards_keyword_callback2(dbt[0]+','+dbt[1]+','+ (archive_no++)+',thread_' + ((file.type==='text/html')? 'html' : 'json'),\r\n                                                      {date:Date.now(), status:200, response:th_obj},\r\n                                                      ['archive_restore',{localArchive:archive, page:(IDB)?'IDB':'File', archiveFile:(IDB)?'IDB':file, refresh:refresh_tgt || pClg,\r\n                                                                          __proto__:cataLog.scan_boards_keyword_callback2_default_args}]);\r\n//      cataLog.threads[ths[0].key][16].archiveFile = (IDB)? 'IDB' : file;\r\n      return ths[0];\r\n    }\r\n    function start_1(req, lth, footer, from_check_op){\r\n      if (req==='ARC' || req==='ARC1') {\r\n        lth.archived |= (req==='ARC')? 6 : 1;\r\n//        lth.archived |= (req==='ARC')? 6 : 5;\r\n        if (!from_check_op) scan.list_nup.add_scan(lth);\r\n      } else if (req==='UNARC') {\r\n        lth.archived = 0;\r\n        archiver.clean_list(lth.domain, lth.board, lth.no);\r\n      }\r\n      if (footer && pref.catalog.footer.archived) cataLog.Footer.update_force(lth.key);\r\n    }\r\n    var blist = {pn:null, time_bumped:null, time_created:null, time_posted:null, flag:null, footer:null, time_tu:null, pn_menu:null,\r\n                 nof_posts:null, nof_files:null, tags:null, page:null, extracted:null,\r\n                 parse_funcs:null, // THIS IS REDUNDANT, but this caused a bug, so this is for safe.\r\n                 quotes:null, backlinks:null, reply_to_me:null, reply_of_mine:null, op_img_url:null, _links:null}; // BUG. meguca has 'backlinks'.\r\n    function store_json_func(key,value){\r\n      return (blist[key]===null)? undefined : value;\r\n    }\r\n\r\n// https://www.w3.org/TR/html5/scripting-1.html#the-script-element\r\n//   Note: When inserted using the document.write() method, script elements execute (typically synchronously), but when inserted using innerHTML and outerHTML attributes, they do not execute at all.\r\n    var sanitize = (function(){\r\n      var funcs = {\r\n        html: (function(){\r\n          var pn = document.createElement('div');\r\n          var wlist = {'A':null, 'SPAN':null, 'DIV':null, 'BLOCKQUOTE':null, 'BR':null, 'WBR':null,\r\n                       'U':null, 'S':null, 'STRIKE':null, 'B':null, 'I':null, 'BIG':null, 'SMALL':null, 'TT':null, 'SUB':null, 'SUP':null, 'EM':null, 'STRONG':null};\r\n          return function (key,value,obj){\r\n            pn.innerHTML = value;\r\n            var tags = pn.getElementsByTagName('*');\r\n            for (var i=0;i<tags.length;i++) if (wlist[tags[i].tagName]!==null) {obj[key] = '';return;}\r\n          }\r\n        })(),\r\n        string: function (key,value,obj){\r\n          if (value.search(/[<>\"'&]/)!=-1) obj[key] = '';\r\n        }\r\n      };\r\n      return function(ary){\r\n        if (ary) for (var j=0;j<ary.length;j++) {\r\n          var obj = ary[j];\r\n          for (var i in obj)\r\n            if (typeof(obj[i])==='string')\r\n              if (i==='com') funcs.html(i, obj[i], obj);\r\n              else funcs.string(i, obj[i], obj);\r\n        }\r\n        return ary;\r\n      }\r\n    })();\r\n    var ls_key_archive = pref.script_prefix + '.archived';\r\n    var list_all_obj = {};\r\n    if (localStorage) load_list();\r\n    if (pref.debug_mode['28']) console.log('list_all_obj: ',list_all_obj);\r\n    var list_all_obj_downloading = {};\r\n    function list_all(){\r\n      if (pref.debug_mode['28']) console.log('list_all_obj_downloading: ',list_all_obj_downloading);\r\n      for (var d in liveTag.mems) {\r\n        var time_unit = site2[d].parse_funcs.post_json.time_unit;\r\n        for (var b in liveTag.mems[d]) {\r\n          var tgt     = list_all_obj[d] && list_all_obj[d][b];\r\n          var tgt_tmp = tgt || {};\r\n          for (var t in liveTag.mems[d][b]) {\r\n            var lth = liveTag.mems[d][b][t];\r\n            var time_checked = list_all_obj_downloading[lth.key] || lth.time_checked/time_unit;\r\n            if (lth.ed_t) time_checked = (pref.archive.editing_timeout)? bug_patch_for_meguca_editing_timeout(lth) || time_checked : lth.ed_t[lth.ed_t.length-1].time - 1; // rewinds to oldest editing post and retry after reload.\r\n            if (lth.archived) {\r\n              if (list_all_obj_downloading[lth.key]) tgt_tmp[t] = list_all_obj_downloading[lth.key];\r\n              else if (!tgt_tmp[t] || tgt_tmp[t]<time_checked) tgt_tmp[t] = time_checked;\r\n            } else if (lth.posts_saved) tgt_tmp[t] = - time_checked; // 'lth.time_checked/time_unit;' can be used here.\r\n//            if (lth.archived && !(lth.key in pref3.archive.list_obj2)) list_all_obj[lth.key] = lth.time_checked; // BUG. NOT implemented yet.\r\n          }\r\n          if (!tgt && Object.keys(tgt_tmp).length!==0) {\r\n            if (!list_all_obj[d]) list_all_obj[d] = {};\r\n            list_all_obj[d][b] = tgt_tmp;\r\n          } else if (tgt && Object.keys(tgt).length===0) delete list_all_obj[d][b];\r\n        }\r\n        if (list_all_obj[d] && Object.keys(list_all_obj[d])===0) delete list_all_obj[d];\r\n      }\r\n    }\r\n    function bug_patch_for_meguca_editing_timeout(lth){\r\n      var time_now = Date.now()/1000;\r\n      for (var i=lth.ed_t.length-1;i>=0;i--) if (typeof(lth.ed_t[i])!=='string') {\r\n        var time = lth.ed_t[i].time;\r\n        if (time_now-time<3600) return time;\r\n      }\r\n      return null;\r\n    }\r\n    function load_list(e){\r\n      if (!e || e.key===ls_key_archive) list_all_obj = JSON.parse(e && e.newValue || localStorage[ls_key_archive] || '{}');\r\n    }\r\n    function save_list(){\r\n      if (pref3.archive.working && localStorage) {\r\n        list_all();\r\n        if (Object.keys(list_all_obj).length===0) delete localStorage[ls_key_archive];\r\n        else localStorage[ls_key_archive] = JSON.stringify(list_all_obj);\r\n        if (pref.debug_mode['28']) console.log('list_all_obj: ',list_all_obj);\r\n      }\r\n    }\r\n    window.addEventListener('storage', load_list, false);\r\n    window.addEventListener('beforeunload', save_list, false);\r\n    return {\r\n//      clean_list_all: function(domain, board, nos){\r\n//        if (list_all_obj[domain] && list_all_obj[domain][board]) {\r\n//          var list_all_obj_bd = list_all_obj[domain][board];\r\n//          for (var no in list_all_obj_bd) if (nos[no]===undefined) this.clean_list(domain,board,no);\r\n//        }\r\n//      },\r\n      clean_list: function(domain,board,no){\r\n        if (list_all_obj[domain] && list_all_obj[domain][board]) delete list_all_obj[domain][board][no]; // Since 4chan has 'delayed pruning', final archiving should be done here.\r\n      },\r\n      check_op: function(th,lth){\r\n        var kwd = pref.archive.kwd;\r\n        if (pref.archive.store_auto && kwd.str && (kwd.sub || kwd.name || kwd.com) &&\r\n            cataLog.threads && cataLog.catalog_filter_query_keyword.kwd(pref.archive.kwd, th.posts, th.domain) ||\r\n            this.check_archived_time(th, th.parse_funcs.time_unit, true)!==false) start_1('ARC', lth, false, true);\r\n      },\r\n      check_archived_time: function(th, time_unit, init){ // time_check_old is undefined at rescan_dp, inherited value must be returned at !init.\r\n        var val = init && pref.archive.list && pref_func.merge_obj5(th.key,pref3.archive.list_obj2,null); // find all expresion\r\n        if (val && val.time) return val.time/time_unit || 0; // val may be {} if targets are specified by board or domain like 'lain' in list picker\r\n        return (pref.archive.list_inherit || !init || val) && list_all_obj[th.domain] && list_all_obj[th.domain][th.board] && list_all_obj[th.domain][th.board][th.no] || false;\r\n      },\r\n//      check_archived_time: function(key, domain, board, no, time_unit){\r\n//        if (pref.archive.list) {\r\n//          var val = pref3.archive.list_obj2[key]; // find d/b/t@xxxx expression\r\n//          if (val && val.time) return val.time;\r\n//        }\r\n//        var val_inherited = list_all_obj[domain] && list_all_obj[domain][board] && list_all_obj[domain][board][no];\r\n//        if (pref.archive.list_inherit && val_inherited) return val_inherited;\r\n//        if (pref.archive.list) val = pref_func.merge_obj5(key,pref3.archive.list_obj2,null); // find all expresion\r\n//        return (val)? val.time/time_unit || val_inherited || 0 : false; // val may be undefined or null.\r\n//      },\r\n      update_archived_time: function(name){\r\n        pref3.archive.working = true;\r\n        if (pref3.archive.list_obj2[name] && pref3.archive.list_obj2[name].time) {\r\n          var key = new RegExp('(^|,)'+name.replace(/\\+/,'\\\\+')+'([\\\\^@!][^,\\n]*)*(,|\\n|$)','mg');\r\n//          var millisec = datetime%1000;\r\n//          var time_str = '@' + new Date(datetime).toLocaleString() + ((datetime%1000==0)? '' : '.'+millisec);\r\n//          str = str.value.replace(key,',') + ',' + name + time_str + '\\n';\r\n          pref.archive.list_str = pref_func.fmt4str2(pref.archive.list_str.value.replace(key,',') + ',' + name + '\\n'); // remove time_str\r\n          pref3.archive.list_obj2[name].time = null;\r\n        }\r\n      },\r\n      store_entry: function(req, downloaded_files){\r\n        if (cataLog.threads) {\r\n//          if (pref.archive.src==='shown') for (var name in cataLog.threads) if (cataLog.threads[name][9][0]===null) cataLog.threads[name][9] = cataLog.catalog_filter_query(name, true);\r\n          for (var name in cataLog.threads) {\r\n            var lth = liveTag.mems.getFromName(name);\r\n            if (pref.archive.src==='stored' ||\r\n                pref.archive.src==='watched' && lth.watched ||\r\n                pref.archive.src==='shown' && pClg.filter_test(name, pClg.threads[name])) start_1(req, lth, true);\r\n//               (pref.archive.src==='shown' && cataLog.threads[name][9][0])) start_1(req, lth, true);\r\n          }\r\n        }\r\n      },\r\n      start_1: start_1,\r\n      restore_posts_from_IDB: function(value, th,  domain, board, no, result){\r\n        var obj = this.event_funcs['consolidate_IDB_result'](result);\r\n        if (obj.posts.length>1) {\r\n          var lth = th.lth;\r\n////          if (th.posts.length==1) {\r\n////            lth.ta = {\r\n////              posts: obj.posts,\r\n////              nof_posts:obj.posts.length,\r\n////              time_loaded:obj.posts[obj.posts.length-1].time,\r\n////            };\r\n//////          this.store(value, th, lth, null, null, true);\r\n////          } else {\r\n            obj.time_loaded = obj.posts[obj.posts.length-1].time;\r\n            var deletedPosts = this.check_deleted_posts(value, th, lth, obj, true);\r\n            if (lth.archived && deletedPosts && (lth.archived&0x02) && pref.archive.live.post) {\r\n              var suffix_dbt = th.key.replace(/\\//g,'-');\r\n              store_posts(JSON.stringify(site2[th.domain].parse_funcs.thread_json.prep_to_archive(deletedPosts)), 'text/plain', lth, suffix_dbt+'_'+'deleted.json');\r\n            }\r\n////          }\r\n        }\r\n      },\r\n      store_th_to_mem: function(value, th,lth, pf_store, editing_finished){ // for deleted posts detection, search, page mode (, archive).\r\n        if (pf_store!=='no') {\r\n          if (editing_finished && lth.ta.posts) {\r\n            var ta_posts = lth.ta.posts;\r\n            var j=ta_posts.length-1;\r\n            for (var i=editing_finished.length-1;i>=0;i--) {\r\n              while (j>=0 && ta_posts[j].no!=editing_finished[i].no) j--;\r\n              if (j>=0) ta_posts[j] = editing_finished[i];\r\n              else j=ta_posts.length-1;\r\n            }\r\n          }\r\n          var pf_d = pref[cataLog.embed_mode].deleted_posts.detect;\r\n          var posts = (th.posts && th.posts.length>1 && th.nof_posts>th.posts.length && lth.ta && pf_d!=='passive')?\r\n              (th.posts[0].type_data!==lth.ta.posts[0].type_data? site2[th.domain].wrap_to_parse.posts(th) : null, \r\n                 site2[th.domain].update_posts_replace_prep(th.posts, lth.ta.posts, typeof(pf_store)==='number'? pf_store : -1)) :\r\n              (th.parse_funcs.has_posts)? th.posts : lth.ta && lth.ta.posts || th.posts;\r\n          if (!pref.test_mode['65'] && (lth.archived && pref.archive.live.post_idb || pf_d==='full_IDB')) {\r\n            if (!lth.ta && pf_d==='full_IDB') IDB.req(th.domain, th.board, th.no, 'posts', this.restore_posts_from_IDB.bind(this, value, {posts:th.posts, __proto__:th}), 'get_all');\r\n            var time_checked;\r\n            if (lth.ta) time_checked = lth.ta.posts[lth.ta.posts.length-1].time;\r\n            else {\r\n              time_checked = list_all_obj[th.domain] && list_all_obj[th.domain][th.board] && list_all_obj[th.domain][th.board][th.no];\r\n              if (time_checked<0) time_checked = - time_checked;\r\n            }\r\n            var posts_saved;\r\n            if (time_checked && (!lth.ta || lth.ta.posts.length===lth.ta.nof_posts || th.posts.length < th.nof_posts)) {\r\n              var i=th.posts.length;\r\n              while (i>0 && th.posts[i-1].time>time_checked) i--;\r\n              posts_saved = th.posts.slice(i);\r\n            } else posts_saved = th.posts;\r\n            if (editing_finished) posts_saved = editing_finished.concat(posts_saved);\r\n            if (posts_saved.length>0) {\r\n              if (th.type_data==='html') cataLog.format_html.prepare_html_prep_posts({posts:posts_saved, __proto__:th}, true); // prep_mimic requires getters\r\n//              if (th.type_data==='html') cataLog.format_html.prepare_html_extract_params({posts:posts_saved, __proto__:th});\r\n              IDB.req(th.domain, th.board, th.no, 'posts', posts_saved, 'put');\r\n              lth.posts_saved = 1;\r\n            }\r\n            if (pref.debug_mode['28'] && posts_saved.length>0) console.log('posts_saved: '+th.key+', '+time_checked+', '+posts_saved[posts_saved.length-1].time+' '+new Date(posts_saved[posts_saved.length-1].time*th.parse_funcs.time_unit).toLocaleString()+', LS:'+(list_all_obj[th.domain] && list_all_obj[th.domain][th.board] && list_all_obj[th.domain][th.board][th.no]));\r\n          }\r\n//          if (!pref.test_mode['65'] && pref.archive.oneshot.post_idb && (lth.archived&0x01)) IDB.req(th.domain, th.board, th.no, 'posts', posts, 'put');\r\n          lth.ta = {\r\n            posts: posts,\r\n            nof_posts:th.nof_posts,\r\n            time_loaded:value.date, // th.time_loaded,\r\n//            __proto__:th  // for debug.\r\n          };\r\n        } else if (lth.ta) delete lth.ta;\r\n      },\r\n      check_deleted_posts: function(value, th, lth, th_old, fill_IDB){\r\n        if (pref[cataLog.embed_mode].deleted_posts.detect!=='no' && th_old && th_old.posts.length>1) {\r\n          var thp = th.posts;\r\n          var othp = th_old.posts;\r\n          var flag = th.nof_posts === th.posts.length || th.type_source==='thread'; // 'thread' is for safe if inconsistent data is returned.\r\n          var i=1;\r\n          var j=1;\r\n//          if (flag) {i=1;j=1;} // patch for 4chan's inconsistency between catalog_json and thread_json, thread_json returns old data and th_old.posts contains blank in it..\r\n          if (flag) lth.rescan_dp = 0;\r\n          else {\r\n            i = th_old.nof_posts - othp.length +1 -(th.nof_posts - thp.length); // for short posts in 4chan catalog.\r\n            j=1;\r\n            if (i<1) {j+=1-i;i=1;}\r\n          }\r\n          var k=0;\r\n          var m=0;\r\n          var othpd = lth.pd || [];\r\n          var post_deleted;\r\n          var posts_offline = (fill_IDB)? [] : null;\r\n          while (i<thp.length && (j<othp.length || k<othpd.length)) {\r\n//          while (j<othp.length) {\r\n//            if (i<thp.length) {\r\n              while (k<othpd.length && thp[i].no>othpd[k].no) k++;\r\n              if (k<othpd.length && thp[i].no==othpd[k].no) { // for inconsistent data between thread_json and catalog_json in 4chan.\r\n                post_deleted = othpd.splice(k,1)[0];\r\n                if (post_deleted.deleted_after) { // These 5 lines was the function recover(post)\r\n                  delete post_deleted.deleted_after;\r\n                  delete post_deleted.deleted_before;\r\n                  if (post_deleted.pn) post_deleted.pn.classList.remove('CatChan_deleted');\r\n                }\r\n//              /*if (!th.native_prep)*/ post_deleted = recover(othpd.splice(k,1)[0]);/* else k++;*/\r\n                continue;\r\n              }\r\n            if (j>=othp.length) if (pref.test_mode['156']) continue; else break;\r\n//              if (j+1<othp.length && othp[j].no === othp[j+1].no) {j++;continue;} // BUG PATCH.\r\n              if (thp[i].no === othp[j].no) {i++;j++;flag=true;continue;}\r\n              if (thp[i].no <   othp[j].no) {if (flag && fill_IDB) posts_offline[posts_offline.length] = thp[i]; // console.log('fill: '+th.no+'#'+thp[i].no); \r\n                                             i++;              continue;}\r\n//            }\r\n            while (m<othpd.length && othp[j].no>othpd[m].no) m++;\r\n            if (m<othpd.length && othp[j].no === othpd[m].no) {j++;continue;}\r\n            if (!flag) { // passive detection, deletion of some posts was detected, but I don't know which.\r\n              if (pref[cataLog.embed_mode].deleted_posts.detect.indexOf('full')===0) {lth.rescan_dp=1; scan.list_nup.add_scan(lth);} // can't fild all of them.\r\n              j++;\r\n              continue;\r\n            }\r\n\r\n            post_deleted = othp[j++];\r\n//            while (k<othpd.length && post_deleted.no>=othpd[k].no) k++; // BUG at serial posts are removed.\r\n            if (!post_deleted.deleted_after) {\r\n              if (pref.debug_mode['33'] && (post_deleted.no===undefined || post_deleted.no===null)) alert('Stopped by illegal deleted posts,(BUG)'); // can stop without developer tool\r\n              post_deleted.deleted_after  = th_old.time_loaded;\r\n              post_deleted.deleted_before = value && value.date || null;\r\n//              post_deleted.deleted_debug  = th.type_parse + ', '+ th_old.type_parse + ', last' + (othp.length-j);\r\n              cataLog.format_html.prepare_html_prep_posts({posts:[post_deleted], __proto__:th}, true); // extraction for being updated by thread_reader which uses html(test_mode['136'])\r\n//              site2[th.domain].wrap_to_parse.posts({posts:[post_deleted], __proto__:th}); // for merge\r\n//              var posts_wrapped = {posts:[th_old.posts[0]].concat(post_deleted), __proto__:th}; // BUG, post may NOT be derived from th.posts[0], html or json. time_unit may differ.\r\n//              site2[th.domain].wrap_to_parse.posts(posts_wrapped); // for merge\r\n            }\r\n            othpd.splice(m++,0,post_deleted);\r\n          }\r\n//          if (pref.test_mode['156']) while (k<othpd.length && i<thp.length) { // accurate synchronization is required for test_mode['136'] between lth.nof_posts and lth.pd.length\r\n//            while (k<othpd.length && thp[i].no>othpd[k].no) k++;\r\n//            if (k<othpd.length && thp[i].no==othpd[k].no) {/*if (!th.native_prep)*/ post_deleted = recover(othpd.splice(k,1)[0]);/* else k++;*/ continue;} // for inconsistent data between thread_json and catalog_json in 4chan.\r\n//            i++;\r\n//          }\r\n          lth.pd = (othpd.length>0)? othpd : null;\r\n          if (post_deleted) {\r\n            if (pref[cataLog.embed_mode].deleted_posts.store!=='no' && th.domain===site.nickname) {\r\n              var storage = (pref[cataLog.embed_mode].deleted_posts.store==='LS')? localStorage : sessionStorage;\r\n              if (storage) {\r\n                var ls_key = site2[th.domain].ls_key_deletedPosts + th.board + th.no;\r\n                if (othpd.length>0) storage[ls_key] = JSON.stringify(othpd, store_json_func);\r\n                else delete storage[ls_key];\r\n              }\r\n            }\r\n            if (!pref.test_mode['65'] && pref[cataLog.embed_mode].deleted_posts.detect==='full_IDB') this.store_deleted_posts_to_IDB(th, othpd);\r\n//            if (!pref.test_mode['65'] && (lth.archived && pref.archive.live.post_idb || pref[cataLog.embed_mode].deleted_posts.detect==='full_IDB'))\r\n//              IDB.req(th.domain, th.board, th.no, 'posts_deleted', JSON.stringify(othpd, store_json_func), (othpd.length>0)? 'put' : 'delete');\r\n          }\r\n          if (posts_offline && posts_offline.length>0) {\r\n            if (th.domain!==site.nickname) posts_offline = JSON.parse(JSON.stringify(posts_offline, store_json_func)); // for structual clone, remove pn.\r\n            IDB.req(th.domain, th.board, th.no, 'posts', posts_offline, 'put');\r\n          }\r\n          if (pref.debug_mode['19'] && post_deleted && lth.pd)\r\n            for (var i=0;i<lth.pd.length-1;i++)\r\n              if (lth.pd[i].no>=lth.pd[i+1].no)\r\n                console.log('BUG: inorder of posts_deleted: '+th.key+', '+i+', '+lth.pd[i].no+', '+lth.pd[i+1].no);\r\n        }\r\n        return (post_deleted)? othpd : null; // return only if it's changed.\r\n      },\r\n      store_deleted_posts_to_IDB: function(th, othpd){\r\n        IDB.req(th.domain, th.board, th.no, 'posts_deleted', JSON.stringify(othpd, store_json_func), (othpd.length>0)? 'put' : 'delete');\r\n      },\r\n      store_json_func: store_json_func,\r\n      store: function(value, th, lth, posts_new, time_check_old, pf_store, editing_finished, no_archive){\r\n        var deletedPosts = this.check_deleted_posts(value, th, lth, lth.ta);\r\n        this.store_th_to_mem(value, th,lth, pf_store, editing_finished); // MUST BE AFTER 'check_deleted_posts', because it uses lth.ta for old version of posts and this revises them.\r\n        if (lth.archived && !no_archive) {\r\n          var time_unit = th.parse_funcs.time_unit;\r\n          var time_checked = this.check_archived_time(th, time_unit, lth.archived&0x04) || 0; // time_check_old is undefined at rescan_dp, inherited value must be returned.\r\n          time_check_old /= time_unit;\r\n          if (time_checked<time_check_old) time_checked = time_check_old;\r\n//          var time_checked = time_check_old/time_unit || this.check_archived_time(th.key, th.domain, th.board, th.no, time_unit) || 0; // BUG, because time_check_old brings pref.filter.time_str\r\n          if (!(lth.archived&0x01) && (lth.archived&0x04)) if (th.posts[th.posts.length-1].time<=time_checked || th.time_posted<=time_checked*time_unit) if (!editing_finished) {\r\n            lth.archived &= 0x02; // Should I remove this safety???\r\n            return;\r\n          }\r\n//          if (!(lth.archived&0x01) && (lth.archived&0x04)) if (th.posts[th.posts.length-1].time*th.parse_funcs.time_unit<=time_checked || th.time_posted<=time_checked) if (!editing_finished) return;\r\n          if (th.parse_funcs.posts_full) th.parse_funcs.posts_full(th);\r\n          var live_active    = lth.archived&0x02;\r\n          var oneshot_active = lth.archived&0x01;\r\n          var post = live_active && pref.archive.live.post || oneshot_active && pref.archive.oneshot.post;\r\n          var post_idb = live_active && pref.archive.live.post_idb || oneshot_active && pref.archive.oneshot.post_idb;\r\n          var suffix_dbt = th.key.replace(/\\//g,'-');\r\n          if (deletedPosts) {\r\n            if (post) store_posts(JSON.stringify(site2[th.domain].parse_funcs.thread_json.prep_to_archive(deletedPosts)), 'text/plain', lth, suffix_dbt+'_'+'deleted.json');\r\n            if (post_idb && pref[cataLog.embed_mode].deleted_posts.detect!=='full_IDB') this.store_deleted_posts_to_IDB(th, deletedPosts);\r\n          }\r\n//          if (deletedPosts && post) store_posts(JSON.stringify(site2[th.domain].parse_funcs.thread_json.prep_to_archive(deletedPosts)), 'text/plain', lth, suffix_dbt+'_'+'deleted.json');\r\n          var type = (th.type_data==='html')? 'text/html' : 'text/plain';\r\n          var posts_all = (th.type_source==='thread' || th.posts.length===th.nof_posts)? th.posts : (lth.ta && lth.ta.posts.length===th.nof_posts)? lth.ta.posts : null;\r\n          if (post) {\r\n            var sub = (th.posts[0].sub || '').replace(/\\..*/,'');\r\n            var suffix = suffix_dbt + ((pref.archive.sub_in_filename && sub)? '_'+sub : '') + ((th.type_data==='html')? '.html' : '.json');\r\n            if (posts_all) store_posts((th.type_source==='thread')? value.responseText :\r\n                                                                    JSON.stringify(site2[th.domain].parse_funcs.thread_json.prep_to_archive(posts_all), store_json_func),\r\n                                       type, lth, suffix);\r\n            else {this.store_rescan(lth); return;}\r\n          }\r\n          if (posts_new || (lth.archived&0x05) || editing_finished) {\r\n            var tn       = live_active && pref.archive.live.tn       || oneshot_active && pref.archive.oneshot.tn;\r\n            var tn_idb   = live_active && pref.archive.live.tn_idb   || oneshot_active && pref.archive.oneshot.tn_idb;\r\n            var img      = live_active && pref.archive.live.img      || oneshot_active && pref.archive.oneshot.img;\r\n            var img_idb  = live_active && pref.archive.live.img_idb  || oneshot_active && pref.archive.oneshot.img_idb;\r\n            var webm     = live_active && pref.archive.live.webm     || oneshot_active && pref.archive.oneshot.webm;\r\n            var webm_idb = live_active && pref.archive.live.webm_idb || oneshot_active && pref.archive.oneshot.webm_idb;\r\n            if (tn || tn_idb || img || img_idb || webm || webm_idb || post_idb) {\r\n              if (lth.archived&0x05) {\r\n                if (!posts_all && (oneshot_active || (!th.posts[1] || th.posts[1].time>time_checked) && (!lth.ta.posts[1] || lth.ta.posts[1].time>time_checked))) {this.store_rescan(lth); return;}\r\n                if (oneshot_active) posts_new = posts_all;\r\n                else {\r\n                  var posts_src = (th.posts[1] && th.posts[1].time<=time_checked)? th.posts : lth.ta.posts;\r\n                  var i = posts_src.length;\r\n                  while (i>0 && posts_src[i-1].time>time_checked) i--;\r\n                  posts_new = posts_src.slice(i); // posts_src contains posts_new always.\r\n                }\r\n              }\r\n              if (editing_finished) posts_new = editing_finished.concat(posts_new || []);\r\n              if (posts_new.length!=0) {\r\n                if (pref.debug_mode['28']) console.log('archive: '+th.key+', '+posts_new.length+'/'+th.nof_posts);\r\n                var reqs = [];\r\n                if (tn || tn_idb)                       img_dl('tn',  th, lth, posts_new, tn,  tn_idb,  webm, webm_idb, reqs);\r\n                if (img || img_idb || webm || webm_idb) img_dl('img', th, lth, posts_new, img, img_idb, webm, webm_idb, reqs);\r\n                if (reqs.length!=0) {\r\n                  reqs[reqs.length-1].from = th.key;\r\n                  list_all_obj_downloading[th.key] = time_checked;\r\n                  download_url2(reqs);\r\n                }\r\n                if (!pref.test_mode['65'] && post_idb && lth.archived&0x05) IDB.req(th.domain, th.board, th.no, 'posts', posts_new, 'put');\r\n              }\r\n            }\r\n          }\r\n          if (post && (deletedPosts || posts_all) && (!reqs || reqs.length===0 || th.domain!==site.nickname) && pref.archive.tar) flush_req();\r\n          lth.archived &= 0x02;\r\n          this.update_archived_time(th.key);\r\n        }\r\n      },\r\n      store_rescan: function(lth){\r\n        scan.list_nup.add_scan(lth);\r\n        lth.archived |= 0x04;\r\n      },\r\n//      test_dl: function(url){\r\n//        var xhr = download_url2(url, '4chan_test_xxxx_image_'+ url.replace(/.*\\//g,''));\r\n//        xhr.onprogress = function(e){console.log(e.target.responseURL+': '+e.loaded+'/'+e.total);};\r\n//      },\r\n      restore_entry: function(files, imgs, clear_func, posts_deleted){\r\n        var archive = {};\r\n        for (var i=0;i<imgs.length;i++) {\r\n          if (archive[imgs[i].name]===undefined) archive[imgs[i].name] = {file:imgs[i]}; // force to remake url because of having different lifetimes. Old version was '= imgs[i];'\r\n          else if (Array.isArray(archive[imgs[i].name])) archive[imgs[i].name].push({file:imgs[i]});\r\n          else archive[imgs[i].name] = [archive[imgs[i].name], {file:imgs[i]}];\r\n        }\r\n//        for (var i=0;i<imgs.length;i++) archive[imgs[i].name] = {file:imgs[i]}; // force to remake url because of having different lifetimes. Old version was '= imgs[i];'\r\n        var deleted = {};\r\n        if (!pref.test_mode['64'] && pref[cataLog.embed_mode].deleted_posts.merge) for (var i=0;i<posts_deleted.length;i++) deleted[posts_deleted[i].name] = posts_deleted[i];\r\n        var count = 0;\r\n        if (pref.archive.clear_threads && cataLog.threads) pClg.clear_threads(0);\r\n        var fileReader = new FileReader();\r\n        var name_deleted;\r\n        fileReader.onerror = function (e){console.log('ERROR at loading json file, '+e);};\r\n        fileReader.onload = function(e){\r\n          if (!name_deleted) {\r\n            restore(files[count-1], fileReader.result, archive);\r\n            if (!pref.test_mode['64'] && pref[cataLog.embed_mode].deleted_posts.merge) {\r\n              name_deleted = files[count-1].name.replace(/(_|\\.).*/,'')+'_deleted.json';\r\n              if (deleted[name_deleted]) {fileReader.readAsText(deleted[name_deleted]); return;}\r\n            }\r\n          } else {\r\n            var name = name_deleted.slice(0,-13).replace(/\\-/g,'/');\r\n            if (pref.test_mode['80']) name = name.replace(/\\/\\d+$/,'_File$&');\r\n            var lth = liveTag.mems.getFromName(name);\r\n            archiver.prep_deleted_posts(lth.th, lth, fileReader.result);\r\n          }\r\n          name_deleted = null;\r\n          if (files.length>count) fileReader.readAsText(files[count++]);\r\n          else if (pref.archive.clear_files) clear_func();\r\n        }\r\n        fileReader.readAsText(files[count++]);\r\n      },\r\n      url2file: function(archive, url){\r\n        var file = archive[url.replace(/[^\\/]*\\//g,'')];\r\n        if (file) {\r\n          if (Array.isArray(file)) file = (url.search(/thumb/)!=-1)? file[0] : file[file.length-1];\r\n          if (!file.url) file.url = window.URL.createObjectURL(file.file);\r\n          return file.url + ((file.file.type==='video/webm')? '\" data-ext=\".webm' : '');\r\n        } else return url;\r\n      },\r\n//      url2file: function(archive, th){ // cause network access because post_json2html makes url begore this.\r\n//        if (!window.URL) return;\r\n//        var tgts = ['src','href'];\r\n//        var all = th.pn.getElementsByTagName('*'); //'*[src],*[href]'\r\n//        for (var i=0;i<all.length;i++)\r\n//          for (var j=0;j<tgts.length;j++) {\r\n//            var url = all[i].getAttribute(tgts[j]);\r\n//            if (url) {\r\n//              var file = archive[url.replace(/[^\\/]*\\//g,'')];\r\n//              if (file) {\r\n//                if (!file.url) file.url = window.URL.createObjectURL(file);\r\n//                all[i].setAttribute(tgts[j], file.url);\r\n//                if (file.type==='video/webm') all[i].setAttribute('data-ext','.webm');\r\n//              }\r\n//            }\r\n//          }\r\n//      },\r\n      prep_deleted_posts: function(th,lth,src, src_obj, refresh_tgt){\r\n        var posts_deleted = (src)? src_obj || JSON.parse(src) :\r\n          (pref[cataLog.embed_mode].deleted_posts.store==='LS' && localStorage)? sanitize(JSON.parse(localStorage[site2[th.domain].ls_key_deletedPosts + th.board + th.no] || null)) :\r\n          (pref[cataLog.embed_mode].deleted_posts.store==='SS' && sessionStorage)?      JSON.parse(sessionStorage[site2[th.domain].ls_key_deletedPosts + th.board + th.no] || null) : null;\r\n        if (!pref.test_mode['123'] && posts_deleted) { // BUG PATCH\r\n          var nos = {};\r\n          for (var i=0;i<th.posts.length;i++) nos[th.posts[i].no] = null;\r\n          for (var i=posts_deleted.length-1;i>=0;i--) if (!posts_deleted[i].no || nos[posts_deleted[i].no]===null) posts_deleted.splice(i,1);\r\n          if (posts_deleted.length===0) posts_deleted = null;\r\n        }\r\n        if (posts_deleted) {\r\n//          for (var i=0;i<posts_deleted.length;i++) delete posts_deleted[i].pn;\r\n          posts_deleted = site2[th.domain].parse_funcs.thread_json.rip_from_archive(posts_deleted);\r\n          var th_deleted = {posts:[].concat(posts_deleted), // posts:[th.posts[0]].concat(posts_deleted),\r\n                            parse_funcs: site2[th.domain].parse_funcs.thread_json,\r\n////                            parse_funcs_html: site2[th.domain].parse_funcs.thread_html,\r\n                            type_parse: 'thread_json',\r\n                            type_source: 'thread',\r\n                            type_data: 'json',\r\n////                            type_html: 'thread_html',\r\n////                            domain_html: th.domain,\r\n//                            nof_posts:th.nof_posts - th.posts.length + posts_deleted.length+1,\r\n                            __proto__:th};\r\n          site2[th.domain].wrap_to_parse.posts(th_deleted);\r\n          if (src && lth.th) {  // NOT DESCRIBED ALL, UNDER IMPLEMENTATION....\r\n            lth.pd = (lth.pd)? site2[th.domain].update_posts_merge_prep(th_deleted.posts, lth.pd, -1, true).slice(1) : posts_deleted;\r\n            var clg = refresh_tgt || cataLog;\r\n            if ((cataLog.embed_mode==='page' || cataLog.embed_mode==='thread') && !pref.test_mode['64'] && pref[cataLog.embed_mode].deleted_posts.merge) {\r\n              th.posts = site2[th.domain].update_posts_merge_prep(th.posts, lth.pd, -1, true);\r\n//              cataLog.format_html.update_posts_in_page(th,th.key, null, true);\r\n              clg.threads[th.key][16].th = th;\r\n//              clg.show_catalog(th.key);\r\n            }\r\n            clg.footer.update_force(th.key);\r\n            // CALL UPDATE_POSTS HERE.\r\n          } else lth.pd = posts_deleted;\r\n//          if (src) archiver.check_deleted_posts({date:date_load}, th, {archived:true}, th_deleted); // sourced from pipe.\r\n//          else lth.pd = posts_deleted;\r\n        }\r\n      },\r\n      refresh_start: function(){\r\n        save_list(); // for browser's crash, but this make conflicts when multiple window is opened.\r\n        timestamp=null;\r\n      },\r\n      list_all_obj_downloading: list_all_obj_downloading,\r\n      download_url3: download_url3,\r\n      download_url4: download_url4,\r\n      tar: tar,\r\n      sub_funcs: function(args, callback){\r\n        if (args[0]==='SUB_INIT') {\r\n          pClg.clear_threads(0);\r\n          cataLog.auto_update.stop_if_running();\r\n          pref.stats.auto_acquisition = false;\r\n          pref[cataLog.embed_mode].t2h_sel='All';\r\n          pref.common.blur_404 = false;\r\n          if (args[1].IDB) IDB.req(args[1].domain, args[1].board, args[1].no, null,\r\n            (callback)? function(d,b,n,r){archiver.event_funcs['restore3'](d,b,n,r);callback();} : archiver.event_funcs['restore3'].bind(archiver.event_funcs), 'get_all');\r\n          else {\r\n            var tgt = args[1];\r\n            var sel = parseInt(tgt.files_sel,10);\r\n            var files = window.opener.document.getElementsByClassName(pref.script_prefix)[0].querySelectorAll('span[name=\"FILES_ARCHIVE'+sel+'\"]')[0].querySelectorAll('input[type=\"file\"]');\r\n            for (var i=0;i<files.length;i++)\r\n              for (var j=0;j<files[i].files.length;j++) {\r\n                var src = files[i].files[j];\r\n                if (src.name===tgt.name && src.size===tgt.size && src.lastModified===tgt.lastModified) {\r\n                  archiver.event_funcs['restore2'](null, Array.prototype.slice.call(files[i+sel].files), [src]);\r\n                  return;\r\n                }\r\n              }\r\n          }\r\n        } else if (args[0]==='DOWNLOAD') {\r\n          download_url4(args[1][0], args[1][1]);\r\n//          download_url(args[1][0], args[1][1]); // doesn't work\r\n//          send_message(args[1][2],['ARCHIVER', ['REVOKE_URL', args[1][0]]]);\r\n//        } else if (args[0]==='REVOKE_URL') window.URL.revokeObjectURL(args[1]);\r\n        }\r\n      },\r\n      restore: restore,\r\n      event_funcs:pref_func.settings.onchange_funcs.archive,\r\n    };\r\n  })();\r\n \r\n  var recovery = (pref.features.recovery && localStorage)? (function(){\r\n    var key;\r\n    function init(){\r\n      key = site2[site.nickname].ls_key_comment +site.board+site.no;\r\n//      var key_old = pref.script_prefix+'.comment.'+site.nickname+site.board+site.no; // patch for half year.\r\n      if (pref.recovery.comment) {\r\n        var comment = localStorage[key] || ''; // localStorage[key_old] || '';\r\n        if (comment) {\r\n          if (site.components.postform_comment ) site.components.postform_comment.value  = comment;\r\n          if (site.components.postform_comment2) site.components.postform_comment2.value = comment;\r\n        }\r\n      }\r\n    }\r\n    init();\r\n//    function clear(){if (localStorage) delete localStorage[key];}\r\n    var src = null;\r\n    var com = null;\r\n    function com_changed(){\r\n      src = this;\r\n      delayed_check();\r\n    }\r\n    var delayed_check = new DelayBuffer(check_com,1000).get_bound_func();\r\n    function check_com(){\r\n      var com_new = src.value;\r\n      if (!com || com.length<=com_new.length) com = com_new;\r\n      src = null;\r\n      delayed_save();\r\n    }\r\n    var delayed_save = new DelayBuffer(save, pref.recovery.interval*1000).get_bound_func();\r\n    function save(){\r\n      if (com) localStorage[key] = com;\r\n      else delete localStorage[key];\r\n      com = null;\r\n    }\r\n    function save_at_exit(){\r\n      if (src) com = src.value;\r\n      if (com!==null) save();\r\n    }\r\n    function setup(rec_inst,postform_comment,postform_submit){\r\n      if (!rec_inst && pref.recovery.comment && postform_comment) {\r\n        var func = com_changed.bind(postform_comment);\r\n        postform_comment.addEventListener('change',func,false);\r\n        postform_comment.addEventListener('keyup',func,false);\r\n        postform_submit.addEventListener('click',func,false);\r\n        rec_inst = [postform_comment, postform_submit, func];\r\n      } else if (rec_inst && (!pref.recovery.comment || !postform_comment)) {\r\n        rec_inst[0].removeEventListener('change',rec_inst[2],false);\r\n        rec_inst[0].removeEventListener('keyup',rec_inst[2],false);\r\n        rec_inst[1].removeEventListener('click',rec_inst[2],false);\r\n        rec_inst = null;\r\n      }\r\n      return rec_inst;\r\n    }\r\n    var rec_inst = setup(null, site.components.postform_comment, site.components.postform_submit);\r\n    var rec_inst2 = null;\r\n    window.addEventListener('beforeunload', save_at_exit, false);\r\n    return {\r\n      setup: function(){\r\n        rec_inst  = setup(rec_inst, site.components.postform_comment, site.components.postform_submit);\r\n        rec_inst2 = setup(rec_inst2,site.components.postform_comment2,site.components.postform_submit2);\r\n      },\r\n      setup2: function(){rec_inst2 = setup(rec_inst2,site.components.postform_comment2, site.components.postform_submit2);},\r\n//      clear: clear,\r\n      reentry: function(){\r\n        save_at_exit();\r\n        init();\r\n      },\r\n    }\r\n  })() : null;\r\n\r\n  var scan = (function(){\r\n////    list_nup_boards : Object.create(null), // list of next updates of boards.\r\n////    list_nup : Object.create(null), // list of next updates.\r\n    var list_nup = {\r\n      // th.u: 0:ready, >0:requested, <0:blacklisted\r\n      add: function(th, priority, force_thread){ // -1:locked, [1:0]:req, [2]:req_thread, [3]:force_json, [7:4]:priority,\r\n        if (typeof(th)==='string') th = this.get_th(th);\r\n        priority = (priority || 0) <<4;\r\n        if (th.u===0) th.u = priority | ((force_thread)? 7 : 3);\r\n        else if (th.u>0 && th.u<priority) th.u = priority | (th.u&0x0f);\r\n      },\r\n      add_scan: function(th){\r\n        this.add(th);\r\n        scan.scan_threads_delayed_do();\r\n      },\r\n      issued: function(th){\r\n        if (typeof(th)==='string') th = this.get_th(th);\r\n        if (th) th.u = (((th.u&0x03)===1)? 0xffffff00 : 0) | ((th.u===0)? 2 : th.u-1); // 'if (th)' for page(p0, p1...) // keep upper bits.\r\n        return th && th.no && th.archived;\r\n      },\r\n      got_200: function(th, lth){\r\n//        var lth = this.get_th(th.key);\r\n        if (lth.u!==0 && (!(lth.u&0x04) || th.type_source==='thread')) lth.u = 0; // not create instances for future implementation.\r\n      },\r\n      got_404: function(th){\r\n        if (typeof(th)==='string') th = this.get_th(th);\r\n        if (th) th.u = -1;\r\n      },\r\n      get_th: function(key){\r\n        var dbt = common_func.fullname2dbt(key);\r\n        if (dbt[2].search(/(p|q)[0-9]+$/)!=-1) return null; // prevent board to be blacklisted when over page loading.\r\n        if (dbt[2][0]==='t') dbt[2] = dbt[2].substr(1);\r\n        else if (dbt[2].search(/^[0-9]/)==-1) dbt[2] = '';\r\n        return liveTag.mems.init({domain:dbt[0], board:dbt[1], no:dbt[2]});\r\n      },\r\n      priority_th: [0, 0x10, 0x20, 0x30, 0x40, 0x50, 0x60, 0x70, 0x80, 0x90, 0xa0, 0xb0, 0xc0, 0xd0, 0xe0, 0xf0, 0x100],\r\n      get_list_thread: function(d, priority){\r\n        var req_th = this.priority_th[priority || 0];\r\n//        var req_th_u = this.priority_th[(priority || 0)+1];\r\n        var count = 0;\r\n        for (var b in liveTag.mems[d])\r\n          for (var t in liveTag.mems[d][b])\r\n           if (liveTag.mems[d][b][t].u>req_th) count++;            \r\n//           if (liveTag.mems[d][b][t].u>req_th && liveTag.mems[d][b][t].u<req_th_u) count++;\r\n        return (count===0)? null : [count, (function*(req_th){\r\n          for (var b in liveTag.mems[d])\r\n            for (var t in liveTag.mems[d][b])\r\n              if (liveTag.mems[d][b][t].u>req_th) yield liveTag.mems[d][b][t]; // for getting robustness\r\n//              if (liveTag.mems[d][b][t].u>req_th && liveTag.mems[d][b][t].u<req_th_u) yield liveTag.mems[d][b][t];\r\n        })(req_th)];\r\n      },\r\n      get_list_thread2: function(d, priority){ // working code.\r\n        var req_th = this.priority_th[priority || 0];\r\n        var list = [];\r\n//        for (var d in liveTag.mems)\r\n        for (var b in liveTag.mems[d])\r\n          for (var t in liveTag.mems[d][b])\r\n            if (liveTag.mems[d][b][t].u>req_th) list[list.length] = liveTag.mems[d][b][t];\r\n        return list;\r\n      },\r\n      get_list_board: function(d, priority){\r\n        var req_th = this.priority_th[priority || 0];\r\n//        var req_th_u = this.priority_th[(priority || 0)+1];\r\n        var count = 0;\r\n        for (var b in liveTag.mems[d])\r\n          if (liveTag.mems[d][b].u>req_th) count++;\r\n//          if (liveTag.mems[d][b].u>req_th && liveTag.mems[d][b].u<req_th_u) count++;\r\n        return (count===0)? null : [count, (function*(req_th){\r\n          for (var b in liveTag.mems[d])\r\n            if (liveTag.mems[d][b].u>req_th) yield liveTag.mems[d][b];\r\n//            if (liveTag.mems[d][b].u>req_th && liveTag.mems[d][b].u<req_th_u) yield liveTag.mems[d][b];\r\n        })(req_th)];\r\n      },\r\n      get_list_board2: function(d, priority){\r\n        var req_th = this.priority_th[priority || 0];\r\n        var list = [];\r\n        for (var b in liveTag.mems[d])\r\n          if (liveTag.mems[d][b].u>req_th) list[list.length] = liveTag.mems[d][b];\r\n        return list;\r\n      },\r\n//      add_domain: function(domain){liveTag.mems[domain].u = 1;},\r\n      add_domain: function(domain, force_thread, boards){\r\n        var max_boards = pref4.scan.max; // invoke getter\r\n        if (!liveTag.active.pk){\r\n          if (!boards) {\r\n            for (var b in liveTag.mems[domain])\r\n              if (liveTag.mems[domain][b].o!==null && liveTag.mems[domain][b].o < max_boards) this.add_board(domain+b, null, force_thread);\r\n          } else for (var i=0;i<boards.length;i++) this.add_board(domain+boards[i], null, force_thread);\r\n        } else {\r\n          if (boards) {\r\n            for (var b in liveTag.mems[domain]) { // working code for '>'\r\n              if (liveTag.tags[liveTag.mems[domain][b].btag].pk) this.add_board(domain+b, null, force_thread);\r\n              var btag2 = liveTag.mems[domain][b].btag2;\r\n              if (btag2) {\r\n                for (var i=0;i<btag2.length;i++)\r\n                  if (liveTag.tags[btag2[i]].pk) this.add_board(domain+b, null, force_thread);\r\n              }\r\n            }\r\n          } else {\r\n            for (var i=0;i<max_boards;i++) if (liveTag.tags_array_old[i]) {\r\n              for (var bt of liveTag.tags[liveTag.tags_array_old[i].key].mems.keys())\r\n                if (!bt.no) this.add_board(bt, null, force_thread);\r\n                else this.add(bt, null, force_thread);\r\n            }\r\n          }\r\n        }\r\n      },\r\n      add_board: function(bd, priority, force_thread, use_boards_json, force_json){\r\n        if (typeof(bd)==='string') bd = this.get_th(bd);\r\n        if (force_thread===2) { // preparation read for search posts\r\n          for (var t in bd) if (!bd[t].ta || bd[t].nof_posts!==bd[t].ta.posts.length) this.add(bd[t], priority, true);\r\n          return;\r\n        }\r\n        if (!use_boards_json || bd.read_max<bd.max) {\r\n          var upper_bits = ((priority || 0) <<4) | ((force_json)? 8 : 0) | ((force_thread)? 4 : 0);\r\n          if (bd.u===0) bd.u = upper_bits | 3;\r\n          else if (bd.u>0 && bd.u<priority) bd.u = upper_bits | (bd.u&0x0f);\r\n        }\r\n//        if (force_thread) for (var t in bd) this.add(bd[t], priority, force_thread); // BUG, bd had no members at initial, threads scan doesn't scheduled.\r\n      },\r\n////      add_board: function(bd, use_boards_json, force_thread, priority){ // working code.\r\n////        if (typeof(bd)==='string') bd = this.get_th(bd);\r\n//////        if (bd.u===0) bd.u = 3;\r\n////        if (bd.u===0 && (!use_boards_json || bd.read_max<bd.max)) bd.u = 3;\r\n//////        bd.u = 3;\r\n//////        if (time) {\r\n//////          if (bd.max) bd.read_max = bd.max;\r\n//////          bd.read_time = time;\r\n//////        }\r\n////        if (force_thread) for (var t in bd) this.add(bd[t], force_thread);\r\n////      },\r\n      got_200_board: function(d, b){\r\n        var bd = liveTag.mems[d][b];\r\n//        if (typeof(bd)==='string') bd = this.get_th(bd);\r\n        if (bd.u&0x04) for (var t in bd) this.add(bd[t], bd.u&0x00f0, true);\r\n        if (bd.max) bd.read_max = bd.max;\r\n        bd.u = 0;\r\n      },\r\n//      add_board: function(bd, time){ // working code.\r\n//        if (typeof(bd)==='string') bd = this.get_th(bd);\r\n////        if (bd.u===0) bd.u = 3;\r\n//        bd.u = 3;\r\n//        if (bd.max) bd.read_max = bd.max;\r\n//        bd.read_time = time;\r\n//      },\r\n////      get_list_board: function(d){ // working code.\r\n////        var list = [];\r\n//////        var time_th = Date.now()-pref.liveTag.pickup_interval*1000;\r\n//////        for (var d in liveTag.mems) {\r\n////////          if (liveTag.mems[d].u) { // for 'add_domain' // working code.\r\n////////            for (var b in liveTag.mems[d]) if (liveTag.mems[d][b].o!==null && liveTag.mems[d][b].o < pref.scan.max) this.add_board(d+b);\r\n////////            liveTag.mems[d].u = 0;\r\n////////          }\r\n//////          if (domain && d!==domain) continue;\r\n////        for (var b in liveTag.mems[d]) {\r\n////          var tgt = liveTag.mems[d][b];\r\n//////          if (tgt.u>0) if (tgt.read_time<time_th && (tgt.max===undefined || !pref.liveTag.utilize_boards_json || tgt.read_max<tgt.max)) list[list.length] = tgt;\r\n//////          if (tgt.u>0) if (tgt.max===undefined || !pref.liveTag.utilize_boards_json || tgt.read_max<tgt.max) list[list.length] = tgt;\r\n////          if (tgt.u>0) list[list.length] = tgt;\r\n////        }\r\n////        return (list.length!==0)? list : null;\r\n////      },\r\n//      query_list_board: function(domain){ // working code.\r\n//        var d = liveTag.mems[domain];\r\n//        if (d)\r\n//          for (var b in d)\r\n//            if (d[b].u>0) return true;\r\n//        return false;\r\n//      },\r\n      scan_boards_enumerate: function(domain, func, ex_list){\r\n        var thread_or_domain = pref.virtualBoard.scan_domains[domain]==='thread' || ex_list.has(liveTag.mems[domain]);\r\n        var max_boards = pref4.scan.max; // invoke getter\r\n        for (var b in liveTag.mems[domain])\r\n          if (thread_or_domain || Object.keys(liveTag.mems[domain][b]).length!=0)\r\n//            if (ex_list[liveTag.mems[domain][b].key]===undefined) // prevent multiple scan.\r\n            if (!ex_list.has(liveTag.mems[domain][b])) // prevent multiple scan.\r\n              if (liveTag.mems[domain][b].o!==null && liveTag.mems[domain][b].o < max_boards)\r\n                if (!func || func(liveTag.mems[domain][b])) return true;\r\n      },\r\n    };\r\n    var Scanner = function(type, domain, priority, key){ // type: 'b':boards, 't':threads\r\n      this.type = type;\r\n      this.domain = domain;\r\n      this.key = key;\r\n      this.priority = priority || 0;\r\n      this.scanners[key] = this; // and also this.wdg, this.req\r\n    };\r\n    Scanner.prototype = {\r\n      scanners: Object.create(null),\r\n      func_entry: function(){\r\n        var tgts;\r\nif (!pref.test_mode['51']) { // 1-3 times faster than generator.\r\n        tgts = (this.type==='b')? scan.list_nup.get_list_board2(this.domain, this.priority) : scan.list_nup.get_list_thread2(this.domain, this.priority);\r\n        tgts = tgts.filter(function(v){return !scan_refresh_ex_list.has(v);});\r\n        if (tgts.length!=0) this.func_scan(tgts,null);\r\n        else this.exit();\r\n} else {\r\n        tgts = (this.type==='b')? scan.list_nup.get_list_board(this.domain, this.priority) : scan.list_nup.get_list_thread(this.domain, this.priority);\r\n        if (tgts) this.func_scan(tgts,{tgts_iterator:tgts[1], max:tgts[0]});\r\n        else this.exit();\r\n}\r\n      },\r\n      func_scan: function(tgts,options, multi_entry){\r\n        if (tgts.length==0) return;\r\n        for (var i=0;i<tgts.length;i++) scan_refresh_ex_list.add(tgts[i]);\r\n        if (!this.wdg) this.wdg = new Watchdog(this.abort.bind(this),30000);\r\n        cataLog.scan_init(this.key, tgts, {callback: this.func_cont.bind(this),\r\n                                           watchdog: this.wdg.restart.bind(this.wdg),\r\n                                           priority: this.priority,\r\n                                           __proto__: options\r\n                                          }, multi_entry);\r\n      },\r\n      func_cont: function() {\r\n        if (this.req) {\r\n          this.req = false;\r\n          this.func_entry();\r\n        } else this.exit();\r\n      },\r\n      exit: function(){\r\n        if (this.wdg) this.wdg.stop();\r\n        this.scanners[this.key] = null\r\n        if (this.type==='b') {\r\n          if (!this.aborted) scan.scan('t', this.domain, this.priority);\r\n        } else if (this.type==='t' && cataLog.catalog_refresh_end) cataLog.catalog_refresh_end();\r\n        if (this.callback) this.callback();\r\n        var priority_next = get_highest_priority(this.type, this.domain);\r\n        var key_next = get_key(this.type, this.domain, priority_next);\r\n        if (this.scanners[key_next]===false) new Scanner(this.type, this.domain, priority_next, key_next).func_entry(); // do scheduled task, but this may not occur.\r\n      },\r\n      abort: function(){\r\n        if (pref.debug_mode['7']) console.log('Scanner_abort: '+this.key);\r\n        cataLog.scan_boards.scan_abort(this.key);\r\n        if (this.aborted===undefined) {\r\n          this.aborted = true;\r\n          this.wdg.restart();\r\n        } else this.exit();\r\n      },\r\n    };\r\n    var ScannerUI = function(key, arg){ // arg is {tgts:, options:}\r\n      this.key = key;\r\n      this.arg = arg;\r\n      this.scanners[key] = this;\r\n      this.callback = this.arg.options && this.arg.options.callback;\r\n    };\r\n    ScannerUI.prototype = {\r\n      scanners: Object.create(null),\r\n      priority: 8,\r\n      func_entry: function(){\r\n        this.func_scan(this.arg.tgts, this.arg.options, true);\r\n      },\r\n      func_cont: function() {\r\n        if (this.queue && this.queue.length>0) {\r\n          this.arg = this.queue.shift();\r\n          this.func_entry();\r\n        } else this.exit();\r\n      },\r\n      __proto__: Scanner.prototype\r\n    };\r\n    function get_key(type, domain, priority){\r\n      return ((type==='b')? 'scan' : 'scan_threads')+ '_' + domain + ':' + (priority || 0);\r\n    }\r\n    function get_highest_priority(type, domain){\r\n      var key_pre = get_key(type, domain, 0).replace(/0$/,'');\r\n      for (var p=8;p>=0;p--) {\r\n        var scanner = Scanner.prototype.scanners[key_pre+p];\r\n        if (scanner || scanner===false) return p;\r\n      }\r\n      return -1;\r\n    }\r\n    var scan_refresh_ex_list = new Set();\r\n    return {\r\n      scan_refresh: function(health_indicator, list, priority, list_domains){\r\n        scan_refresh_ex_list.clear();\r\n        for (var i=0;i<list.length;i++) {\r\n          var dbt = common_func.name2domainboardthread(list[i],true);\r\n          if (dbt[2].search(/^[cj]/)===0 || dbt[2]==='') scan_refresh_ex_list.add(liveTag.mems[dbt[0]][dbt[1]]);\r\n          else if (dbt[2].search(/^t*[0-9]+/)===0) scan_refresh_ex_list.add(liveTag.mems[dbt[0]][dbt[1]][(dbt[2][0]==='t')? dbt[2].substr(1) : dbt[2]]); // redundant.\r\n        }\r\n        for (var i in list_domains) scan_refresh_ex_list.add(liveTag.mems[i]);\r\n        scan.scan('t', null, priority);\r\n        if (!pref.liveTag.use)\r\n          for (var tag in liveTag.tags) // activate selected tags for NOT liveTag mode. In this case, tags are not many.\r\n            if (liveTag.tags[tag].pk)\r\n              for (var bt of liveTag.tags[tag].mems.keys())\r\n                if (!scan_refresh_ex_list.has(bt))\r\n                  if (bt.no) scan.list_nup.add(bt,2);\r\n                  else scan.list_nup.add_board(bt,2);\r\n        for (var d in liveTag.mems) {\r\n          if (pref.liveTag.use) {\r\n            if (site2[d].utilize_boards_json && pref.pref2[d].utilize_boards_json) {\r\n              if (list_nup.scan_boards_enumerate(d, null, scan_refresh_ex_list))\r\n                site2[d].get_boards_json('boards_'+d,(function(domain){return function(){scan.scan_refresh_1(domain, false);}})(d),true,health_indicator);\r\n              else scan.scan('t', d);\r\n            } else scan.scan_refresh_1(d, false);\r\n          } else scan.scan('b', d);\r\n        }\r\n      },\r\n      scan_refresh_1: function(domain, use_boards_json){\r\n        list_nup.scan_boards_enumerate(domain, function(bd){scan.list_nup.add_board(bd, null, null, use_boards_json);}, scan_refresh_ex_list);\r\n        scan.scan('b', domain);\r\n      },\r\n//      scan_refresh_move_req: function(list){ // working code.\r\n//        for (var i=0;i<list.length;i++) {\r\n//          var dbt = common_func.name2domainboardthread(list[i],true);\r\n//          if (dbt[2].search(/^[cj]/)===0) {\r\n//            scan.list_nup.add_board(dbt[0]+dbt[1]);\r\n//            list.splice(i--,1);\r\n//          } else if (dbt[2].search(/^t*[0-9]+/)===0) {\r\n//            scan.list_nup.add(dbt[0]+dbt[1]+((dbt[2][0]==='t')? dbt[2].substr(1) : dbt[2]));\r\n//            list.splice(i--,1);\r\n//          }\r\n//        }\r\n//      },\r\n      scan: function(type, domain, priority){\r\n        if (!domain) for (var d in liveTag.mems) this.scan(type, d, priority);\r\n        else {\r\n          var key = get_key(type, domain, priority);\r\n          var scanner = Scanner.prototype.scanners[key];\r\n          if (scanner) scanner.req = true; // multi entry.\r\n          else if (get_highest_priority(type, domain)>=priority) Scanner.prototype.scanners[key] = false; // schedule\r\n          else if (type==='b' && (scanner = Scanner.prototype.scanners[get_key('t', domain, priority)]))\r\n            scanner.callback = function(){scan.scan(type, domain, priority);}; // schedule\r\n          else new Scanner(type, domain, priority, key).func_entry();\r\n        }\r\n      },\r\n      abort: function(){\r\n        for (var s in Scanner.prototype.scanners) {\r\n          var scanner = Scanner.prototype.scanners[s];\r\n          if (scanner) {\r\n            if (scanner.wdg) scanner.wdg.stop();\r\n            scanner.abort();\r\n          }\r\n        }\r\n      },\r\n      scan_ui: function(key, arg){\r\n        new ScannerUI(key, arg).func_entry();\r\n//        var scanner = ScannerUI.prototype.scanners[key];\r\n//        if (scanner) {\r\n//          if (!this.queue) this.queue = [];\r\n//          this.queue[this.queue.length] = arg; // multi entry.\r\n//        } else new ScannerUI(key, arg).func_entry();\r\n      },\r\n      scan_threads_delayed_do: DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(function(){scan.scan('t');}, 200)),\r\n      keyword_load: function(force, health_indicator){\r\n        var flag = true;\r\n        for (var domain in pref.virtualBoard.scan_domains) {\r\n          if (pref.virtualBoard.scan_domains[domain]!=='none') {\r\n            this.keyword_load_1(domain, force, null, health_indicator);\r\n            flag = false;\r\n          }\r\n        }\r\n        if (flag) this.keyword_load_1(site.nickname, force, null, health_indicator);\r\n      },\r\n      keyword_load_1: function(domain, force, boards, health_indicator){\r\n//          if (!site3[domain].boards && (domain===site.nickname || pref.virtualBoard.scan_domains[domain]!=='none')) {\r\n        if (!site3[domain].boards && ((!force && pref.virtualBoard.scan_domains[domain]!=='none') ||\r\n                                       (force && liveTag.active.pk) || !boards)) {\r\n          site2[domain].get_boards_json('kwd_load',function(){scan.keyword_load_1(domain, force, boards, health_indicator)},false,health_indicator);\r\n          return;\r\n        }\r\n//          if (domain===site.nickname || pref.virtualBoard.scan_domains[domain]==='thread') {\r\n//          if (pref.virtualBoard.scan_domains[domain]!=='none' || force) {\r\n        if (pref.virtualBoard.scan_domains[domain]==='thread' || force) {\r\n          scan.list_nup.add_domain(domain, pref.filter.kwd.post && force, boards);\r\n          scan.scan('b',domain);\r\n        }\r\n      },\r\n      list_nup: list_nup,\r\n    };\r\n  })();\r\n\r\n  function make_catalog_obj(pn12_button){\r\n    var catalog_func = null;\r\n    function show_hide(e, mode){\r\n      if (catalog_func===null) {\r\n        if (mode) set_embed_xxxx(mode)\r\n        catalog_func = make_catalog();\r\n      } else if (!pref.test_mode['114']) catalog_func.make_watcher();\r\n      else catalog_func = catalog_func.destroy();\r\n    }\r\n    var embed_catalog;\r\n    var embed_page;\r\n    var embed_frame;\r\n    var embed_mode;\r\n    var embed_embed;\r\n    function set_embed_xxxx(mode){\r\n      embed_catalog = pref.catalog.embed && site.whereami==='catalog' || pref.catalog.embed_archive && site.whereami==='archive';\r\n      embed_page    = pref.catalog.embed_page && site.whereami==='page';\r\n      embed_frame   = pref.catalog.embed_frame && site.whereami==='frame';\r\n      embed_mode = (embed_catalog)? 'catalog' :\r\n                   (embed_page)? 'page' :\r\n                   ((pref.thread.embed || mode==='thread') && site.whereami==='thread')? 'thread' : 'float';\r\n      embed_embed = embed_mode!=='float';\r\n      cataLog.embed_mode = embed_mode; // this will be done in later, but do here also for meguca reentry.\r\n    }\r\n    cataLog.set_embed_xxxx = set_embed_xxxx;\r\n    set_embed_xxxx();\r\n    if (pn12_button) pn12_button.addEventListener('click', show_hide, false); // show_hide\r\n    styleSheet.init(embed_mode); // patch, but WHY???\r\n//if (!(brwsr.ff && embed_mode==='catalog' && site.nickname==='4chan')) styleSheet.init(); // patch, but WHY???\r\n////////if (!(brwsr.ff && embed_mode==='catalog' && site.nickname==='4chan')) { // patch, but WHY??? // working code.\r\n//////////    var ss = document.styleSheets[document.styleSheets.length-1];\r\n//////////    if (!ss) {\r\n//////////      var ss = document.createElement('style');\r\n//////////      document.head.appendChild(ss);\r\n//////////      ss = ss.sheet;\r\n//////////    }\r\n////////    var ss = document.head.appendChild(document.createElement('style')).sheet;\r\n////////    ss.insertRule('.catalog_triage_parent {pointer-events: none;}',0); \r\n////////    ss.insertRule('.catalog_triage_button {pointer-events: auto;}',1);\r\n////////    pref_func.style_sheet = ss;\r\n////////    pref_func.settings.onchange_funcs['catalog.click_area_add_rule'](); // rule 2.\r\n////////    ss.insertRule('.'+pref.script_prefix+'_tag {cursor:pointer;}',3);\r\n////////}\r\n\r\n//    function scan_tags_common(ths,html_str,tags_obj){ // working code\r\n//      var acc = true;\r\n//      if (tags_obj===undefined) {\r\n//        tags_obj = {cs:{}, ci:{}};\r\n//        acc = false;\r\n//      }\r\n//      for (var i in ths) {\r\n//        var tags_th = ths[i].tags;\r\n//        if (tags_th) {\r\n//          var dbt = cnst.name2domainboardthread(i,true);\r\n//          var tags_th_uniq = {};\r\n//          for (var j=tags_th.length-1;j>=0;j--)\r\n//            if (tags_th_uniq[tags_th[j]]===undefined) tags_th_uniq[tags_th[j]] = null; // BUG. #aaa and #AAA are counted as 2 in case insensitive mode.\r\n//            else tags_th.splice(j,1);\r\n//          if (tags_th.length<=pref.catalog.tag.max) {\r\n//            var end = (pref.catalog.tag.ignore<tags_th.length)? pref.catalog.tag.ignore : tags_th.length;\r\n//            for (var j=0;j<end;j++) {\r\n//              for (var k in tags_obj) {\r\n//                var tag_test = (k==='cs')? tags_th[j] : tags_th[j].toLowerCase();\r\n//                if (tags_obj[k][tag_test]===undefined) tags_obj[k][tag_test] = {num:1,mem:{}};\r\n//                else tags_obj[k][tag_test].num++;\r\n//                if (!tags_obj[k][tag_test].mem[dbt[0]+dbt[1]]) tags_obj[k][tag_test].mem[dbt[0]+dbt[1]] = 1;\r\n//                else tags_obj[k][tag_test].mem[dbt[0]+dbt[1]]++;\r\n//      }}}}}\r\n//      if (!acc) return scan_tags_common_b(tags_obj,html_str,{cs:[],ci:[]})[0];\r\n//    }\r\n//    function scan_tags_common_b(tags_obj, html_str, tags){ // CAN'T FIND 1->0 AT A BOARD.\r\n//      for (var i in tags_obj) {\r\n//        for (var j in tags_obj[i]) {\r\n//          var tag_ref = (i==='cs')? j : j.toLowerCase();\r\n//          for (var n=0;n<tags[i].length;n++) {\r\n//            var tag_test = (i==='cs')? tags[i][n].key : tags[i][n].key.toLowerCase();\r\n//            if (tag_ref===tag_test) {\r\n//              for (var k in tags_obj[i][j].mem) tags[i][n].mem[k] = tags_obj[i][j].mem[k]; // update.\r\n////var old = tags[i][n].num;\r\n//              tags[i][n].num = 0;\r\n//              for (var k in tags[i][n].mem) tags[i][n].num += tags[i][n].mem[k];\r\n////if (old!=tags[i][n].num) console.log(i+', '+j+', '+n+', '+tag_test+', '+old+', '+tags[i][n].num);\r\n//              delete tags_obj[i][j]; // works in Chrome and FF, BUT DANGEROUS?\r\n//              break;\r\n//            }\r\n//          }\r\n//        }\r\n//        for (var j in tags_obj[i]) tags[i].push({key:j, num:tags_obj[i][j].num, mem:tags_obj[i][j].mem});\r\n////        tags[i].sort(function(a,b){return b.num - a.num;});\r\n//        tags[i].sort(function(a,b){return (b.num!=a.num)? b.num - a.num : (b.key > a.key)? -1:1;});\r\n//      }\r\n//      for (var i=0;i<tags.ci.length;i++) {\r\n//        var key = tags.ci[i].key.toLowerCase();\r\n//        for (var j=0;j<tags.cs.length;j++)\r\n//          if (key===tags.cs[j].key.toLowerCase()) {tags.ci[i].key=tags.cs[j].key; break;}\r\n//      }\r\n//      return scan_tags_common_c(tags, html_str);\r\n//    }\r\n//    function scan_tags_common_c(tags, html_str){\r\n//      var tags_tgt = (pref.filter.tag_ci)? tags.ci : tags.cs;\r\n//      var str2 = '';\r\n//      for (var i=0;i<tags_tgt.length;i++) {\r\n//        var item = tags_tgt[i].num + ': ' + tags_tgt[i].key;\r\n//        str2 = str2 + '<input type=\"checkbox\"' + html_str + '> '+item + '<br>';\r\n//      }\r\n//      return [str2, tags];\r\n//    }\r\n////    function scan_tags_common(ths,html_str,tags_obj){\r\n////      var acc = true;\r\n////      if (tags_obj===undefined) {\r\n////        tags_obj = {cs:{}, ci:{}};\r\n////        acc = false;\r\n////      }\r\n////      for (var i in ths) {\r\n////        var tags_th = ths[i].tags;\r\n////        if (tags_th) {\r\n////          var dbt = cnst.name2domainboardthread(i,true);\r\n////          var tags_th_uniq = {};\r\n////          for (var j=tags_th.length-1;j>=0;j--)\r\n////            if (tags_th_uniq[tags_th[j]]===undefined) tags_th_uniq[tags_th[j]] = null;\r\n////            else tags_th.splice(j,1);\r\n////          if (tags_th.length<=pref.catalog.tag.max) {\r\n////            var end = (pref.catalog.tag.ignore<tags_th.length)? pref.catalog.tag.ignore : tags_th.length;\r\n////            for (var j=0;j<end;j++) {\r\n////              for (var k in tags_obj) {\r\n////                var tag_test = (k==='cs')? tags_th[j] : tags_th[j].toLowerCase();\r\n////                if (tags_obj[k][tag_test]===undefined) tags_obj[k][tag_test] = {num:0,mem:{}};\r\n////                tags_obj[k][tag_test].num++;\r\n////                tags_obj[k][tag_test].mem[dbt[0]+dbt[1]] = null;\r\n////      }}}}}\r\n////      if (!acc) return scan_tags_common_b(tags_obj,html_str)[0];\r\n////    }\r\n////    function scan_tags_common_b(tags_obj,html_str){\r\n////      var tags = [];\r\n////      for (var i in tags_obj.cs) tags.push({key:i, num:tags_obj.cs[i].num, mem:tags_obj.cs[i].mem});\r\n////      tags.sort(function(a,b){return b.num - a.num;});\r\n////      if (pref.filter.tag_ci) {\r\n////        for (var i=0;i<tags.length-1;i++) {\r\n////          var key = tags[i].key.toLowerCase();\r\n////          tags[i].num = tags_obj.ci[key].num;\r\n////          tags[i].mem = tags_obj.ci[key].mem;\r\n////          for (var j=tags.length-1;j>i;j--) if (key===tags[j].key.toLowerCase()) tags.splice(j,1);\r\n////        }\r\n////        tags.sort(function(a,b){return b.num - a.num;});\r\n////      }\r\n////      var str2 = '';\r\n////      for (var i=0;i<tags.length;i++) {\r\n////        var item = tags[i].num + ': ' + tags[i].key;\r\n////        str2 = str2 + '<input type=\"checkbox\"' + html_str + '> '+item + '<br>';\r\n////      }\r\n////      return [str2, tags];\r\n////    }\r\n//////    function scan_tags_common(ths,html_str,tags_obj,acc){\r\n//////      if (tags_obj===undefined) tags_obj = {};\r\n////////      var tags_obj = {};\r\n//////      for (var i in ths) {\r\n//////        var tags_th = ths[i].tags;\r\n//////        if (tags_th) {\r\n//////          var tags_th_uniq = {};\r\n//////          for (var j=tags_th.length-1;j>=0;j--)\r\n//////            if (tags_th_uniq[tags_th[j]]===undefined) tags_th_uniq[tags_th[j]] = null;\r\n//////            else tags_th.splice(j,1);\r\n//////          if (tags_th.length<=pref.catalog.tag.max) {\r\n//////            var end = (pref.catalog.tag.ignore<tags_th.length)? pref.catalog.tag.ignore : tags_th.length;\r\n//////            for (var j=0;j<end;j++) {\r\n//////              if (tags_obj[tags_th[j]]===undefined) tags_obj[tags_th[j]] = [0,{}];\r\n//////              tags_obj[tags_th[j]][0]++;\r\n//////              tags_obj[tags_th[j]][1][i] = 0;\r\n//////            }\r\n//////          } \r\n//////        }\r\n//////      }\r\n//////      if (!acc) return scan_tags_common_b(tags_obj,html_str);\r\n//////    }\r\n//////    function scan_tags_common_b(tags_obj,html_str){\r\n//////      var tags = [];\r\n//////      for (var i in tags_obj) tags.push({key:i, val:tags_obj[i][0], mem:tags_obj[i][1]});\r\n//////      tags.sort(function(a,b){return b.val - a.val;});\r\n//////      if (pref.filter.tag_ci) {\r\n//////        for (var i=0;i<tags.length-1;i++) {\r\n//////          var key = tags[i].key.toLowerCase();\r\n//////          for (var j=tags.length-1;j>i;j--) {\r\n//////            if (key===tags[j].key.toLowerCase()) {\r\n////////console.log(tags[i].key+', '+tags[i].val +' + '+tags[j].key+', '+tags[j].val);\r\n//////              tags[i].val += tags[j].val;\r\n//////              for (var k in tags[j].mem) tags[i].mem[k] = 0;\r\n//////              tags.splice(j,1);\r\n//////            }\r\n//////          }\r\n//////        }\r\n//////        for (var i in tags) tags[i].val = Object.keys(tags[i].mem).length;\r\n//////        tags.sort(function(a,b){return b.val - a.val;});\r\n//////      }\r\n//////      var str2 = '';\r\n//////      for (var i=0;i<tags.length;i++) {\r\n//////        var item = tags[i].val + ': ' + tags[i].key;\r\n//////        str2 = str2 + '<input type=\"checkbox\"' + html_str + '> '+item + '<br>';\r\n//////      }\r\n//////      return str2;\r\n//////    }\r\n    function make_catalog(){\r\n      var healthIndicator = (function(){\r\n        var his = [];\r\n        var count = 0;\r\n        var status = {};\r\n        var HealthIndicator = function(dual){\r\n          this.pn = document.createElement('span');\r\n          this.pn_countdown = this.pn.appendChild(cnst.dom('<span style=\"color:limegreen\"></span>'));\r\n          this.pn_hi = this.pn.appendChild(document.createElement('span'));\r\n          if (dual) {\r\n            this.pn2 = this.pn.cloneNode(true);\r\n            this.pn2_countdown = this.pn2.childNodes[0];\r\n            this.pn2_hi = this.pn2.childNodes[1];\r\n          }\r\n          if (!pref.healthIndicator.show) this.pn_hi.style.display = 'none';\r\n          his.push(this);\r\n          this.elems = [];\r\n        }\r\n        HealthIndicator.prototype = {\r\n          shift: function(col,str,initiator,priority){\r\n//            while (this.elems.length>=pref.healthIndicator.max) this.elems.shift().remove_from_parent();\r\n            for (var i=this.elems.length-pref.healthIndicator.max;i>=0;i--) if (this.elems[i].remove_from_parent()) this.elems.splice(i,1);\r\n            var elem = new HealthIndicatorElement(col,str,initiator,priority);\r\n            this.pn_hi.insertBefore(elem.pn, this.pn_hi.firstChild);\r\n            this.elems.push(elem);\r\n            return elem;\r\n          },\r\n          destroy: function(){\r\n            this.pn.parentNode.removeChild(this.pn);\r\n            his.splice(his.indexOf(this),1);\r\n          },\r\n          countdown: function(str){\r\n            this.pn_countdown.textContent = str;\r\n            if (this.pn2) this.pn2_countdown.textContent = str;\r\n          },\r\n//          remove: function(tgt){this.elems.splice(this.elems.indexOf(tgt),1)[0].remove();},\r\n//          set: function(col,str){this.elems[this.elems.length-1].set(col,str);}, // PATCH\r\n        };\r\n        var HealthIndicatorElement = function(col,str,initiator,priority){\r\n          this.pn = document.createElement('span');\r\n          this.name = 'healthIndicator.' + (count++);\r\n          this.pn.setAttribute('name',this.name);\r\n          this.set(col,str);\r\n          this.pn.onmouseover = mouseover;\r\n          this.pn.onmouseout  = mouseout;\r\n          this.pn.onclick     = click;\r\n          status[this.name] = {initiator:initiator, priority:priority};\r\n          this.show_tooltip_delayed = new DelayBuffer(show_tooltip.bind(this), 100).get_bound_func();\r\n//          this.status = status[this.name]; // patch for faster execution.\r\n        }\r\n        var src = null;\r\n        HealthIndicatorElement.prototype = {\r\n          set: function(col,str){\r\n            if (str) this.pn.textContent = str;\r\n            if (col) this.pn.setAttribute('style','color:'+col);\r\n          },\r\n          remove_from_parent: function(){ // must be called from parent to remove elems[this].\r\n            if (pref.healthIndicator.dont_retire_running && !status[this.name].end) return false;\r\n            delete status[this.name];\r\n            this.pn.parentNode.removeChild(this.pn);\r\n            if (this.pn===src) mouseout();\r\n            return true;\r\n          },\r\n          remove: function(){\r\n            if (this.remove_from_parent())\r\n              for (var i=0;i<his.length;i++) {\r\n                var idx = his[i].elems.indexOf(this);\r\n                if (idx!=-1) {\r\n                  his[i].elems.splice(idx,1);\r\n                  return;\r\n                }\r\n              }\r\n          },\r\n          report: function(obj){\r\n            var stat = status[this.name];\r\n            if (!stat) return; // when indicator was pruned.\r\n//            var prog = stat.prog; // prepare for being overwritten.\r\n            if (obj) for (var i in obj) {\r\n              if (i==='err_str') {\r\n                if (!stat.err_str) this.set('orange');\r\n                stat[i] = ((stat[i])? stat[i]+', ':'') + obj[i];\r\n              } else stat[i] = obj[i];\r\n              var prog = stat.prog;\r\n              if (i==='end') { // end must NOT come with prog.\r\n                if (prog) {\r\n                  stat.prog_str = make_prog_str(stat.prog);\r\n//                  stat.prog_str = (stat.prog.IDX)? prog.IDX+'/'+prog.tgts.length :\r\n//                                                   prog.found_threads+'/'+prog.scanned+', '+prog.found_boards+'/'+prog.max;\r\n                  stat.prog = null; // remove reference loop.\r\n                }\r\n                var result = (!stat.err_str || stat.initiator==='IDB')? '\\u25cf' :\r\n                             (prog && prog.SUC)? '\\u25b2' : 'X';\r\n//                             (prog && Object.keys(prog.error_obj).length<prog.max)? '\\u25b2' : 'X';\r\n                this.set((result==='X')?'red':null, result);\r\n              }\r\n            }\r\n            if (src || pref.healthIndicator.expand_running) this.show_tooltip_delayed();\r\n          },\r\n        };\r\n        function make_prog_str(prog, running){\r\n          return (prog.IDX)? prog.IDX+'/'+prog.tgts.length\r\n                           : prog.found_threads+'/'+prog.scanned+', '+prog.found_boards+(running?'/'+prog.idx:'')+'/'+prog.max;\r\n        }\r\n        function mouseover(e){\r\n          if (!pref.tooltips['info'].show) return;\r\n          src = this;\r\n          Tooltips.req_show('info', e, show_tooltip, true);\r\n//          show_tooltip.call(this,e);\r\n        }\r\n        function show_tooltip(e){\r\n          var myself = e && e.target || this;\r\n          var name = myself.name || myself.getAttribute('name');\r\n          var stat = status[name];\r\n          if (!stat) return; // retired already.\r\n          if (stat.prog) stat.prog_str = make_prog_str(stat.prog, true) + ', ' + stat.tgt;\r\n//          if (stat.prog) stat.prog_str = (stat.prog.IDX)? stat.prog.IDX+'/'+stat.prog.tgts.length+', ' + stat.tgt :\r\n//                                                          stat.prog.found_threads+'/'+stat.prog.scanned+', '+stat.prog.found_boards+'/'+stat.prog.idx+'/'+stat.prog.max+', ' + stat.tgt;\r\n          if (!e && pref.healthIndicator.expand_running && stat.start && !stat.end) myself.set(null,' :'+stat.prog_str);\r\n          if (src && src.getAttribute('name')===name) {\r\n            var cancel_button = !stat.end && !pref.healthIndicator.cancel;\r\n            var html = 'Initiator: '+stat.initiator+'&emsp;'+\r\n                       ((cancel_button)? '<button type=\"button\" name=\"'+name+'\">Cancel</button>' : '')+ '<br>' +\r\n                       ((stat.start)? 'Start: '+ new Date(stat.start).toLocaleTimeString()+'<br>' : '')+\r\n                       ((stat.prog_str)? 'Progress: '+ stat.prog_str+'<br>' : '')+\r\n                       'Priority: '+ stat.priority+'<br>'+\r\n                       ((stat.start && !stat.end && stat.prog)? 'Crawler: '+ stat.prog.crawler+'<br>' : '')+\r\n                       ((stat.err_str)? '<span style=\"color:red\">Errors: '+ stat.err_str+'</span><br>' : '')+\r\n                       ((stat.abort_str)? '<span style=\"color:red\">Abort: '+ stat.abort_str+'</span><br>' : '')+\r\n                       ((stat.end)? 'End: '+ new Date(stat.end).toLocaleTimeString()+'<br>' : '');\r\n            var retval = (!cancel_button)? html : {html:html, callback:tooltip_func}\r\n            if (!e) Tooltips.show_2(null, retval); // push\r\n            else return retval; // for initial, pull\r\n          }\r\n        }\r\n        function mouseout(e){\r\n          src = null;\r\n          if (pref.tooltips['info'].show) Tooltips.hide2();\r\n        }\r\n        function tooltip_func(pn){\r\n          pn.getElementsByTagName('button')[0].onclick = cancel_scan;\r\n        }\r\n        function click(){\r\n          if (pref.healthIndicator.cancel) cancel_scan.call(this);\r\n        }\r\n        function cancel_scan(){\r\n          var name = this.getAttribute('name');\r\n          var stat = status[name];\r\n          if (stat && !stat.end && stat.prog) stat.prog.ABORT = true; // NOT DEBUGGED YET!!!\r\n//          if (status[name] && !status[name].end) cataLog.scan_boards.scan_abort(status[name].initiator);\r\n        }\r\n        function show(){\r\n          var disp = (pref.healthIndicator.show)? '' : 'none';\r\n          for (var i=0;i<his.length;i++) his[i].pn.childNodes[1].style.display = disp;\r\n        }\r\n        function shrink_running(){\r\n          if (!pref.healthIndicator.expand_running)\r\n            for (var i=0;i<his.length;i++) \r\n              for (var j=0;j<his[i].elems.length;j++) if (his[i].elems[j].pn.textContent.length>1) his[i].elems[j].set(null,'r');\r\n        }\r\n        return {\r\n          HealthIndicator: HealthIndicator,\r\n          show: show,\r\n          shrink_running: shrink_running,\r\n        }\r\n      })();\r\n      cataLog.healthIndicator = healthIndicator;\r\n      var health_indicator = new healthIndicator.HealthIndicator(true);\r\n      httpd.set_health_indicator(health_indicator);\r\n\r\n////      var health_indicator = (function(){ // working code.\r\n////        var pn_hi = document.createElement('span');\r\n//////        if (!(embed_catalog)) pn_hi.style['font-size'] = '24px';\r\n////        if (!pref.catalog.health_indicator.on) pn_hi.style.display = 'none';\r\n////        pn12_0.childNodes[3].appendChild(pn_hi);\r\n////        function insert_node(col,str){\r\n////          var max = pref.catalog.health_indicator.max;\r\n////          while (pn_hi.childNodes.length>=max) pn_hi.removeChild(pn_hi.lastChild);\r\n////          var pn = document.createElement('span');\r\n////          if (col) pn.setAttribute('style','color:'+col);\r\n////          if (str) pn.innerHTML = str;\r\n////          pn_hi.insertBefore(pn,pn_hi.firstChild);\r\n////          return pn;\r\n//////          while (pn_hi.childNodes.length>=max) pn_hi.removeChild(pn_hi.childNodes[pn_hi.childNodes.length-1]);\r\n//////          pn_hi.innerHTML = '<span' + ((col)? ' style=\"color:'+col+'\"' : '' ) + '>'+str+'</span>' + pn_hi.innerHTML;\r\n////        }\r\n////        pref_func.health_indicator = pn_hi;\r\n////        return {\r\n////          pn_hi : pn_hi,\r\n////          set: function(pn,col,str){\r\n//////            if (!pn) pn = pn_hi.childNodes[0];\r\n////            if (str) pn.textContent = str;\r\n////            if (col) pn.style.color = col;\r\n////          },\r\n////          shift: function(col,str){return insert_node(col,str);},\r\n////          remove: function(pn){\r\n////            pn.parentNode.removeChild(pn);\r\n////          }\r\n////        }\r\n////      })();\r\n\r\n      var Footer = {\r\n        mode: embed_mode,\r\n        mode_fmt: embed_mode=='float'? 'float' : 'catalog',\r\n        threads: threads,\r\n//        timestamp_trial: 16,\r\n        timestamp: embed_mode==='thread'? 16 : 0,\r\n        clean_idx: 0,\r\n        timestamp_set: function(){\r\n//          if (this.timestamp) {\r\n          if (this.realtime) {\r\n            this.timestamp += 32; // dirtify all // 16 and 32 is the magic number here, search it. This is used in literal forms in all cases for update timestamp\r\n            this.clean_idx = 0;\r\n          }\r\n//            this.clg.drawn_idx = 0;\r\n//            this.clg.show_catalog(); // update footers, this is too heavy, but required.\r\n////            this.update_all_lazy(null, true);\r\n//          }\r\n        },\r\n//        timestamp_trial_prep: function(){this.timestamp_trial = this.timestamp + 16;},\r\n//        timestamp_inc: function(){this.timestamp = this.timestamp_trial;},\r\n//        update_all_flags_force: function(){\r\n//          for (var name in this.threads) this.update(name, true, null, true);\r\n//        },\r\n        update_all_force: function(e,src, flags, tags){\r\n          if (src.indexOf('liveTag.style')==-1) {\r\n            if (src==='proto.footer.merged_tag') {if (!pref[this.mode_fmt].footer.tag) return; else tags = true;}\r\n            else if (this.mode_fmt==='float' ^ src.indexOf('float')!=-1) return;\r\n            var tgt = src.split('.')[2];\r\n            var pn_menu_old = this.pn_menu;\r\n            var pn_triage_old = this.pn_triage;\r\n            if (!flags) this.compile(); // remake triage here\r\n            if (tgt==='use' || tgt==='triage' || tgt==='menu') {\r\n              this.add_remove_menu(tgt, pn_menu_old, pn_triage_old);\r\n              if (tgt==='triage' || tgt==='menu') return;\r\n            }\r\n            if (tgt==='triage_str' || tgt==='menu_str') {this.replace_menu(tgt);return;}\r\n          } else tags = true;\r\n          for (var name in this.threads) this.update_force(name, flags, tags, true);\r\n//          this.update_all_lazy(flags);\r\n        },\r\n//        update_all_lazy: function(flags, only_shown){\r\n//          var idxs = this.clg.idxs;\r\n//          var drawn_idx = this.clg.drawn_idx; // drawn_idx doesn't track exactly, it points meaningless point when tgts_in are given for show_catalog(tgts_in).\r\n//          if (drawn_idx===true) drawn_idx = idxs.length;\r\n//          var end = (only_shown)? drawn_idx : idxs.length;\r\n//          for (var i=0;i<end;i++) if (idxs[i].slice(0,4)!==':DL:') this.update(idxs[i], flags, null, i<drawn_idx);\r\n//        },\r\n        update_force: function(name,flags,tags, merge_consolidate){\r\n          var tgt_th = this.threads[name];\r\n          var footer = tgt_th[24];\r\n          if (footer && tgt_th[1]) this.insert_footer3(footer, name, /*0x10,*/ flags, tags, merge_consolidate); // keep force_network_update flag\r\n        },\r\n        update: function(name,flags,tags){ // , idx){ // from network only\r\n          var footer = this.threads[name][24];\r\n          if (!footer) return;\r\n//          if (this.threads[name][1] && (footer[4]&0x10)) { // 0x10 is mark for force_network_update, which is used by mode==='thread' and triage_rewind_watch\r\n////          if (this.threads[name][1] && (footer[4]>=this.timestamp || force)) { // BUG, this should be footer[4]>=this.timestamp_TRIAL to track clean area.\r\n//            this.insert_footer3(footer, name, 0, flags, tags); // clear flag for force_network_update\r\n////            footer[4] &= 0xfffffff0; // keep timestamp\r\n//          } else {\r\n            footer[4] |= (flags? 0x01 : 0) | (tags? 0x04 : 0) | 0x08; // | (page? 0x02 : 0); // 0x08 is dirty mark\r\n////            if (this.clean_idx>idx) this.clean_idx = idx;\r\n//          }\r\n        },\r\n//        queue_update_force: function(name){ // working code\r\n//          var footer = this.threads[name][24];\r\n//          if (footer) footer[4] |= 0x10; // 0x10 is mark for force_network_update\r\n//        },\r\n//        seek_clean_idx: function(idxs, idx){ // working code\r\n//          var ts = this.timestamp;\r\n//          if (idx===0 || this.realtime && this.real_ts!==ts) {this.real_ts = ts; return 0;}\r\n//          var i = idx;\r\n//          while (--i>=0) {\r\n//            var footer = this.threads[idxs[i]][24];\r\n//            if (footer && footer[4]!==ts) idx = i;\r\n//          }\r\n//          return idx;\r\n////          return this.realtime && this.real_ts!==this.timestamp? (this.real_ts = this.timestamp, 0) : this.clean_idx;\r\n//        },\r\n//        query_update_without_data: function(page_info){ // working code\r\n//          return this.realtime || page_info && pref[this.mode_fmt].footer.page;\r\n//        },\r\n////        update_without_updated_data: function(page_info){ // working code\r\n////          if (!this.realtime && (!page_info || !pref[this.mode_fmt].footer.page)) return;\r\n////          var ts_ref = this.real_ts; // real_ts is stored timestamp of last lazy_draw. // this.timestamp - 32;\r\n////          for (var name in this.threads) {\r\n////            var footer = this.threads[name][24];\r\n////            if (footer && this.threads[name][1] && footer[4]>=ts_ref) this.insert_footer3(footer, name, 0x10, null, null, true); // keep force_network_update flag\r\n////          }\r\n////        },\r\n        try_dirtifying_tag: function(name){\r\n          var footer = this.threads[name][24];\r\n          if (!footer) true;\r\n          if (footer[4] & 0x0f) {\r\n            footer[4] |= 0x04;\r\n            return true;\r\n          }\r\n        },\r\n        test_dirty: function(name){ // for debug\r\n          var footer = this.threads[name][24];\r\n          return footer && (footer[4] & 0x0f) && footer;\r\n        },\r\n        draw: function(tgt_th, name){ // must update even if footer has no updated data.\r\n          var footer = tgt_th[24];\r\n//          var footer = this.threads[name][24];\r\n//          if (!footer) return;\r\n          if (footer[4]!==this.timestamp) this.insert_footer3(footer, name); // , 0x10); // keep force_network_update flag\r\n//          if (footer[4] & 0x0f) this.insert_footer3(footer, name);\r\n//          footer[4] = this.timestamp_trial; // keep updating while lazy drawing is not completed, but this is too much.\r\n        },\r\n        draw_merge: function(tgt_th, name, merge){ // update both footers in both cases.\r\n          var footer = tgt_th[24];\r\n          if (!merge) this.insert_footer3(footer, name, /*0x10,*/ null, true); // for unmerge, update both footers.\r\n          footer[6] = merge;\r\n          if ( merge) this.insert_footer3(footer, name, /*0x10,*/ null, true); // for merge, update both footers.\r\n        },\r\n        factory: function(mode, threads, clg){\r\n          var retval = {\r\n            threads: threads,\r\n//            timestamp_trial: this.timestamp,\r\n            timestamp: 0, // updated by compile() just below\r\n            mode: mode,\r\n            mode_fmt: mode=='float'? 'float' : 'catalog',\r\n            clean_idx: 0,\r\n            clg: clg,\r\n            realtime: 0,\r\n//            real_ts: 0,\r\n            pn_menu: null,\r\n            pn_triage: null,\r\n            __proto__: this\r\n          };\r\n          retval.compile();\r\n          return retval;\r\n        },\r\n\r\n        pn: document.createElement('div'),\r\n        prep_flag_dom: function(dom){\r\n          if (dom.flag && (dom.flag instanceof Element)) return document.importNode(dom.flag);\r\n          if (!site2[site.nickname].post_flag2html) return undefined;\r\n          this.pn.innerHTML = site2[site.nickname].post_flag2html(dom); // site2[dom.domain_html].post_flag2html(dom); // patch, mimic always\r\n          return this.pn.childNodes[0];\r\n        },\r\n//        prep_flag_dom: function(flags, idx){ // working code\r\n//          var dom = flags[idx];\r\n//          if (dom instanceof Element) return dom;\r\n//          if (dom.flag && (dom.flag instanceof Element)) flags[idx] = dom.flag; // for KC\r\n//          else {\r\n//            this.pn.innerHTML = site2[site.nickname].post_flag2html(dom); // site2[dom.domain_html].post_flag2html(dom); // patch, mimic always\r\n//            flags[idx] = this.pn.childNodes[0];\r\n//          }\r\n//          return flags[idx];\r\n//        },\r\n        ts_refresh: null,\r\n        refresh_start: null,\r\n        formatted_arr: null,\r\n//        format_relative_time: null,\r\n//        format_time: null,\r\n        get_str: null,\r\n        prep_footer3: function(th, footer_old){\r\n          var footer = th.footer;\r\n          footer.classList.add(pref.script_prefix+'_footer');\r\n          var footer_native = th.type_parse==='catalog_html' && th.parse_funcs_html.footer_prep(th, footer) || null;\r\n//          var str = footer.innerHTML.replace(/ *R:[0-9 \\/]*I:[0-9 \\/]*/,'');\r\n//          str = str.replace(/P:[0-9 \\/]*/,'');\r\n//          str = str.replace(/ *\\(sticky\\) */,'');\r\n//          if (str!=='') {\r\n//            footer.innerHTML = '<span></span>' + str;\r\n//            footer = footer.childNodes[0];\r\n//          }\r\n//          if (pref[this.view].footer_br) { // working code\r\n//            var footer_style = footer.getAttribute('style');\r\n//            footer_style = ((footer_style)? footer_style + ';' : '') + 'clear:both';\r\n//            footer.setAttribute('style',footer_style);\r\n//          }\r\n          this.add_menu(footer);\r\n          return [footer, footer_native, null, null, 0x06 | (th.country? 0x01 : 0), th.footer2? [th.footer2, null, null, null] : null];\r\n//          return [footer, null, null, null, 0x06 | (th.country? 0x01 : 0), footer_native, null, null]; // [7] for test_mode['119']\r\n//          return (footer_old)? [footer, th.country, footer_old[2], null,          0x07, null, null] // for reentry\r\n//          return (footer_old)? [footer, th.country, footer_old[2], footer_old[3], 0x07, null, null] // for reentry\r\n//                             : [footer, th.country, null,          null,          0x07, null, null];\r\n        },\r\n        add_remove_menu: function(tgt, pn_menu_old, pn_triage_old){ // stateful approach is required for loading default (of this page), it changes multiple values at a time.\r\n          var func_menu = (!pn_menu_old &&  this.pn_menu)? this.add_menu_1.bind(this)\r\n                        : ( pn_menu_old && !this.pn_menu)? this.remove_menu_1.bind(this) : null;\r\n          var func_triage = (!pn_triage_old &&  this.pn_triage)? this.add_triage_1.bind(this)\r\n                          : ( pn_triage_old && !this.pn_triage)? this.remove_triage_1.bind(this) : null;\r\n          this.add_remove_menu_iterate(func_menu, func_triage);\r\n//          var pf = pref[this.mode_fmt].footer;\r\n//          var val_changed = pf[tgt];\r\n//          for (var name in this.threads) { // working code // stateful approach is required for loading default (of this page), it changes multiple values at a time.\r\n//            var footer = this.threads[name][24];\r\n//            if (!footer) continue; \r\n//            if (!pn_menu_old && this.pn_menu) this.add_menu_1(footer[0]);\r\n//            else if (pn_menu_old && !this.pn_menu) footer[0].removeChild(footer[0].lastChild);\r\n//            if (!pn_triage_old && this.pn_triage) this.add_triage_1(footer[0]);\r\n//            else if (pn_triage_old && !this.pn_triage) footer[0].removeChild(footer[0].firstChild);\r\n////            if (tgt!=='triage') { // called from 'use', 'menu' and 'triage'.\r\n////              if (pf.use && pf.menu) this.add_menu_1(footer[0]);\r\n////              else if (!val_changed && (pf.use ^ pf.menu)) footer[0].removeChild(footer[0].lastChild); // BUG, this doesn't allow multiple values to be changed at once, ERROR at loading default of this page\r\n////            }\r\n////            if (tgt!=='menu') {\r\n////              if (pf.use && pf.triage) this.add_triage_1(footer[0]);\r\n////              else if (!val_changed && (pf.use ^ pf.triage)) footer[0].removeChild(footer[0].firstChild); // BUG, this doesn't allow multiple values to be changed at once, ERROR at loading default of this page\r\n////            }\r\n//          }\r\n        },\r\n        add_remove_menu_iterate: function(func_menu, func_triage){\r\n          for (var name in this.threads) {\r\n            var footer = this.threads[name][24];\r\n            if (footer) this.add_remove_menu_1(footer, func_menu, func_triage);\r\n          }\r\n          var pf = this.clg.pref[this.clg.mode];\r\n          if (pf.merge || pf.merge_list) {\r\n            var mb = this.clg.merge_bases;\r\n            var bases_iter = mb.bases_unique().values(); // bases_unique returns (value,key) pair instead of (key,balue) pair\r\n            for (var name of bases_iter) {\r\n              var footer = mb.bases[name].footer;\r\n              if (footer) this.add_remove_menu_1(footer, func_menu, func_triage);\r\n            }\r\n          }\r\n        },\r\n        add_remove_menu_1: function(footer, func_menu, func_triage){\r\n          if (func_menu) func_menu(footer[0]);\r\n          if (func_triage) func_triage(footer[0]);\r\n        },\r\n        add_menu: function(footer){ // for initial only\r\n          if (this.pn_menu) this.add_menu_1(footer);\r\n          if (this.pn_triage) this.add_triage_1(footer);\r\n          return footer;\r\n        },\r\n        replace_menu: function(tgt){\r\n          var func_menu = (tgt==='menu_str' && this.pn_menu)? function(footer){this.remove_menu_1(footer);  this.add_menu_1(footer);}.bind(this) : null;\r\n          var func_triage = (tgt==='triage_str' && this.pn_triage)? function(footer){this.remove_triage_1(footer); this.add_triage_1(footer);}.bind(this) : null;\r\n          this.add_remove_menu_iterate(func_menu, func_triage);\r\n        },\r\n//        replace_menu: function(tgt){ // working code\r\n//          for (var name in this.threads) {\r\n//            var footer = this.threads[name][24];\r\n//            if (!footer) continue; \r\n//            if (tgt==='menu_str' && this.pn_menu) {this.remove_menu_1(footer[0]);  this.add_menu_1(footer[0]);}\r\n//            if (tgt==='triage_str' && this.pn_triage) {this.remove_triage_1(footer[0]); this.add_triage_1(footer[0]);}\r\n//          }\r\n//        },\r\n        pn_menu: null, // initialized in compile()\r\n        add_menu_1: function(footer){\r\n          footer.appendChild(this.pn_menu.cloneNode(true));\r\n        },\r\n        remove_menu_1: function(footer){\r\n          footer.removeChild(footer.lastChild);\r\n        },\r\n        pn_triage: null, // initialized in compile()\r\n        add_triage_1: function(footer){\r\n          footer.insertBefore(this.pn_triage.cloneNode(true), footer.firstChild);\r\n        },\r\n        remove_triage_1: function(footer){\r\n          footer.removeChild(footer.firstChild);\r\n        },\r\n        color_tag_node: function(name,tag){\r\n          var footer = this.threads[name] && this.threads[name][24];\r\n          if (!footer) return;\r\n//if (pref.test_mode['119']) { // doesn't work with multiple footers\r\n//          var tag_ci = tag.toLowerCase();\r\n//          var tags = footer[7];\r\n//          if (tags) for (var j=0;j<tags.length;j++) if (tags[j]===tag || (pref.liveTag.ci && tags[j].toLowerCase()===tag_ci)) return footer[3].childNodes[j*2];\r\n//} else {\r\n          if (this.try_dirtifying_tag(name)) return; // this is ok as long as liveTag.create_tag_nodes is used in insert_footer3\r\n          var pn = this.query_tag_node(footer, tag);\r\n          if (pn) {\r\n            this.liveTag.color_tag_node(pn,tag);\r\n//            if (footer[5]) this.liveTag.color_tag_node(this.query_tag_node(footer[5], tag), tag);\r\n            if (footer[6] && footer[6].footer) {\r\n              var pn_merged = this.query_tag_node(footer[6].footer, tag);\r\n              if (pn_merged) this.liveTag.color_tag_node(pn_merged, tag);\r\n            }\r\n          }\r\n//}\r\n        },\r\n        query_tag_node: function(footer, tag){\r\n          var pn = footer[3] && footer[3].firstChild;\r\n          while (pn) if (pn.textContent===tag) return pn; else pn = pn.nextElementSibling;\r\n        },\r\n        remove_nullify: function(footer,idx){\r\n          footer[0].removeChild(footer[idx]);\r\n          footer[idx] = null;\r\n        },\r\n        insert_footer3: function(footer, name, /*ts_mask,*/ flags, tags, merge_consolidate){\r\n          var tgt_th = this.threads[name];\r\n          var lth = liveTag.mems.getFromName(name);\r\n          flags = flags || (footer[4]&0x01);\r\n          tags = tags || (footer[4]&0x04);\r\n          this.draw_exe_1(footer, name, flags, tags, tgt_th, lth);\r\n          if (footer[5]) this.draw_exe_1(footer[5], name, flags, tags, tgt_th, lth);\r\n          if (footer[6] && footer[6].footer) if (!merge_consolidate || footer[6].lths[0]===lth) this.draw_exe_1(footer[6].footer, name, null, tags, footer[6], footer[6]); // tricky, see site2['DEFAULT'].update_posts_merge_bases.base_factory\r\n          footer[4] = this.timestamp; //  + (footer[4]&ts_mask); // ts_mask: 0x10 for keeping flag for force_network_update, 0 for clearing it.\r\n        },\r\n        draw_exe_1: function(footer, name, flags, tags, tgt_th, lth){\r\n          var pf = pref[this.mode_fmt].footer;\r\n          var str = pf.use && this.get_str(tgt_th, lth);\r\n//          if (pf.use) {\r\n//            flags = flags || (footer[4]&0x01);\r\n//            tags = tags || (footer[4]&0x04);\r\n//            var str = this.get_str(tgt_th, lth);\r\n////            if (pf.design==='custom') str = this.get_str(tgt_th, lth); // working code\r\n////            else {\r\n////              var nums2  = tgt_th[8];\r\n////              var page = tgt_th[14] || '?';\r\n////              var str_nr = ((pf.nrtm)? lth.nrtm +'/' : '' ) + lth.nr;\r\n////              var str_nl = (pf.nl && lth.ta && lth.ta.posts)? lth.ta.posts.length+'/' : '';\r\n////              var str_ns = (pf.ns && lth.sg)? '*'+lth.sg.size : '';\r\n////              var str_nd = (pf.nd && lth.pd)? '+'+lth.pd.length : '';\r\n////              str     = ((pf.archived && lth.archived)? 'A ' : '') +\r\n////                        ((pf.design==='native')?\r\n////                          ((pf.nr)? ((lth.watched)? 'U: '+ str_nr + ' / ' : ''):'') + 'R: '+ str_nl+(nums2[2]-1)+str_ns+str_nd +  ' / I: '+nums2[3] + ((pf.page)? ' / P: '+page : '')\r\n////                        : ((pf.nr)? ((lth.watched)? str_nr + '/' : ''):'') + str_nl+nums2[2]+str_ns+str_nd + '/'+nums2[3]+ ((pf.page)? '/'+page : '')); // trial.\r\n////              if (str) str += ' ';\r\n////              if (pf.nf || pf.nid) {\r\n////                var str_nc = pf.nf && lth.sID && lth.sID.nc;\r\n////                var str_nid = pf.nid && lth.sID && (lth.sID.nid || lth.sID.np);\r\n////                str += (str_nid || '') + ((str_nid && str_nc)? '/' : '') + (str_nc || '') + ((str_nid || str_nc)? ' ' : '');\r\n////              }\r\n////  \r\n////              if (pf.ctime) str += this.format_time(nums2[1]) + ' ';\r\n////              if (pf.rctime) str += this.format_relative_time(nums2[1]) + ' ';\r\n////              if (pf.btime && nums2[0]) str += this.format_time(nums2[0]) + ' ';\r\n////              if (pf.rbtime && nums2[0]) str += this.format_relative_time(nums2[0]) + ' ';\r\n////              if (pf.ptime && nums2[4]) str += this.format_time(nums2[4]) + ' ';\r\n////              if (pf.rptime && nums2[4]) str += this.format_relative_time(nums2[4]) + ' ';\r\n////  \r\n////              if (pf.prate) str += Math.floor(nums2[2]/((this.ts_refresh - nums2[1])/86400000)) + ' ';\r\n////              if (pf.board || pf.no || pf.domain) {\r\n////                str += ((pf.domain)? lth.domain : '')+\r\n////                       ((pf.board)? lth.board : '')+\r\n////                       ((pf.no)? lth.no : '') + ' ';\r\n////              }\r\n////            }\r\n//          }\r\n          if (str) {\r\n            if (footer[1]) {\r\n              if ((footer[4]&0x08) || this.realtime!=1 || footer[1].innerHTML!==str) footer[1].innerHTML = str; // textContent = str;\r\n            } else {\r\n              var footer1 = document.createElement('span');\r\n              footer1.innerHTML = str;\r\n              footer[1] = footer[0].insertBefore(footer1, pf.triage? footer[0].childNodes[1] : footer[0].firstChild); // document.createTextNode(str), footer[0].firstChild);\r\n            }\r\n          } else if (footer[1]) this.remove_nullify(footer,1);\r\n  \r\n          if (pf.tag && pf.use) {\r\n            if (tags || !footer[3]) {\r\n//if (pref.test_mode['119']) { // stateful approach\r\n//              var tags_new = lth.tags;\r\n//              var pn = this.liveTag.update_tag_nodes(lth.tags, ', ', this.tag_node_onclick, footer[3], footer[7]); // referred from query_tag_node\r\n//              footer[7] = tags_new; // stateful approach, TAGS MUST BE UPDATED BY REPLACING INSTEAD OF SPLICING\r\n//              if (!footer[3]) footer[3] = footer[0].insertBefore(pn, footer[2]);\r\n////              footer[7] = lth.tags;\r\n////              var pn = liveTag.create_tag_nodes(footer[7], ', ', liveTag.tag_node_onclick); // referred from query_tag_node\r\n////              if (footer[3]) footer[3].parentNode.removeChild(footer[3]);\r\n////              footer[3] = footer[0].insertBefore(pn, footer[2]);\r\n//} else {\r\n              var pn = this.liveTag.create_tag_nodes(lth.tags, ', ', this.tag_node_onclick);\r\n              footer[3] = (footer[3])? (footer[0].replaceChild(pn, footer[3]), pn)\r\n                                     : footer[0].insertBefore(pn, footer[2] || pf.menu? footer[0].lastChild : null);\r\n//              if (footer[3]) footer[3].parentNode.removeChild(footer[3]);\r\n//              footer[3] = footer[0].insertBefore(pn, footer[2] || pref[this.mode].footer_triage? footer[0].lastChild : null);\r\n//}\r\n            }\r\n          } else if (footer[3]) this.remove_nullify(footer,3); // footer[7] = null;}\r\n//          if (pf.tag && pf.use) { // working code\r\n//            tags = tags && lth;\r\n//            if (!footer[3]) {\r\n//              footer[3] = footer[0].insertBefore(document.createElement('span'), footer[6]);\r\n//              tags = lth;\r\n//            } else if (tags) footer[3].removeChild(footer[3].firstChild);\r\n//            if (tags) footer[3].appendChild(liveTag.update_tag_string(lth.tags, ', ', liveTag.tag_node_onclick));\r\n//          } else if (footer[3]) Footer.remove_nullify(footer,3);\r\n  \r\n          if (pf.flag && pref[this.mode].t2h_num_of_posts>=0 && pf.use) {\r\n            if (flags || !footer[2]) flags = tgt_th[16].recent_posts(); // .slice(); // EMBED_MODE IS USED IN THIS, MUST BE CHANGED.\r\n            if (!footer[2]) footer[2] = footer[0].insertBefore(document.createElement('span'), pf.menu? footer[0].lastChild : null);\r\n//            if (!footer[2]) footer[2] = footer[0].appendChild(document.createElement('span'));\r\n            if (flags && flags.length>0) {\r\n              for (var i=footer[2].childNodes.length-1;i>=0;i--) footer[2].removeChild(footer[2].firstChild);\r\n              for (var i=0;i<flags.length;i++) if (flags[i]) {\r\n                var flag = Footer.prep_flag_dom(flags[i]);\r\n                if (flag) {\r\n                  if (flags[i].deleted_after) flag.classList.add('CatChan_deleted');\r\n                  footer[2].appendChild(flag);\r\n                }\r\n              }\r\n//              var i = flags.length - pref[embed_mode].t2h_num_of_posts; // working code\r\n//              if (i<1) i=1;\r\n//              if (flags[0] && Footer.prep_flag_dom(flags,0)) footer[6].appendChild(flags[0]);\r\n//              while (i<flags.length) {\r\n//                if (flags[i] && Footer.prep_flag_dom(flags,i)) footer[6].appendChild(flags[i]);\r\n//                i++;\r\n//              }\r\n//              footer[1] = flags;\r\n            }\r\n          } else if (footer[2]) this.remove_nullify(footer,2);\r\n\r\n          if (pref.debug_mode['32'] && footer[2]) {\r\n            var flags_debug = tgt_th[16].recent_posts(); // .slice();\r\n            var pn = document.createElement('span');\r\n            for (var i=0;i<flags_debug.length;i++) if (flags_debug[i]) {\r\n              var flag = Footer.prep_flag_dom(flags_debug[i]);\r\n              if (flag) {\r\n                if (flags_debug[i].deleted_after) flag.classList.add('CatChan_deleted');\r\n                pn.appendChild(flag);\r\n              }\r\n            }\r\n            var pns = [footer[2], pn].map(function(v){\r\n              return Array.prototype.map.call(v.getElementsByClassName('flag'),function(v){return v.getAttribute('class').match(/flag\\-(..)/)[1];}).toString();});\r\n            if (pns[0]!=pns[1]) console.log('Error: Flags: '+lth.key+': '+'\\n'+pns[0]+'\\n'+pns[1]);\r\n          }\r\n        },\r\n        format_relative_time: function(rt){\r\n          var sign = (rt<0)? '-' : '+';\r\n          var at = Math.floor(Math.abs(rt)/1000);\r\n          var s = at%60;\r\n          var m = (at>=60)? Math.floor((at%3600)/60) : 0;\r\n          var h = (at>=3600)? Math.floor((at%86400)/3600) : 0;\r\n          var d = (at>=86400)? Math.floor(at/86400)+'d' : '';\r\n          return sign + d + ((d && h<10)? '0':'') + ((at>=3600)? h+':':'') + ((at>=3600 && m<10)?'0':'') + ((at>=60)? m+':':'') + ((at>=60 && s<10)?'0':'') + s;\r\n//          return (sat<60)? '0:00:'+at\r\n//            : (at<3600)? '0:Math.floor(at/60)+'mins'\r\n//            : Math.floor(at/3600)+':'+Math.floor((at%3600)/60);\r\n        },\r\n      };\r\n      Footer.get_str = (function(parent){\r\n        function format_relative_time(time){\r\n          return Footer.format_relative_time(time - ts_refresh);\r\n        }\r\n        var ts_refresh = Date.now();\r\n//        var ts_refresh_rx = null;\r\n        function format_time(time){\r\n          return (ts_refresh-time>=86400000)? new Date(time).toLocaleString() : new Date(time).toLocaleTimeString();\r\n//          if (!ts_refresh_rx) ts_refresh_rx = new RegExp(new Date(ts_refresh).toLocaleDateString(),'g');\r\n//          return new Date(time).toLocaleString().replace(ts_refresh_rx,'') + ' ';\r\n        }\r\n        function style_gt0(func, style){\r\n          return function(){\r\n            var n = func();\r\n            return n>0? '<span style=\"'+style+'\">'+n+'</span>' : n;};\r\n        }\r\n        var tgt_th = null;\r\n        var lth = null;\r\n        var nums2 = null;\r\n        var func_tmp;\r\n        var funcs = {\r\n          pg: function(pf){return (pf.page)? function(){return tgt_th[14] || '?';} : null;},\r\n          nm: function(pf){return (!pf.nrtm)? null\r\n                                : ((func_tmp = pf.nrtm0? function(){return lth.watched && lth.nrtm || '';} : function(){return lth.watched? lth.nrtm : '';}),\r\n                                  !pf.nrtm1? func_tmp : style_gt0(func_tmp, pref_func.sanitize(pf.nrtm1_style)));},\r\n//          nm: function(pf){return (pf.nrtm)? (pf.nrtm0? function(){return lth.watched && lth.nrtm || '';} : function(){return lth.watched? lth.nrtm : '';}) : null;},\r\n          nr: function(pf){return (!pf.nr)? null\r\n                                : ((func_tmp = pf.nr0? function(){return lth.watched_p && lth.nr || '';} : function(){return lth.watched_p? lth.nr : '';}),\r\n                                  !pf.nr1? func_tmp : style_gt0(func_tmp, pref_func.sanitize(pf.nr1_style)));},\r\n//          nr: function(pf){return (pf.nr)? (pf.nr0? function(){return lth.watched && lth.nr || '';} : function(){return lth.watched? lth.nr : '';}) : null;},\r\n          rp: function(pf){return (pf.rp)? (pf.rOP? (pf.rp0? function(){return nums2[2]>1? nums2[2] : '';} : function(){return nums2[2];})\r\n                                                  : (pf.rp0? function(){return nums2[2]-1 || '';}          : function(){return nums2[2]-1;})) : null;},\r\n//          rp: function(pf){return (pf.rp)? (pf.rOP? function(){return nums2[2];} : function(){return nums2[2]-1;}) : null;},\r\n          im: function(pf){return (pf.im)? (pf.iOP? function(){return nums2[3];} : function(){return nums2[3]>1? nums2[3]-1 : '';}) : null;},\r\n          RP: function(pf){return (pf.rp)? (pf.rOP? function(){return '<b>'+nums2[2]+'</b>';} : function(){return '<b>'+(nums2[2]-1)+'</b>';}) : null;},\r\n          IM: function(pf){return (pf.im)? (pf.iOP? function(){return '<b>'+nums2[3]+'</b>';} : function(){return nums2[3]>1? '<b>'+(nums2[3]-1)+'</b>' : '';}) : null;},\r\n//          rp: function(pf){return (pf.rp)? function(){return nums2[2];} : null;},\r\n//          r1: function(pf){return (pf.rp)? function(){return nums2[2]-1;} : null;},\r\n//          im: function(pf){return (pf.im)? function(){return nums2[3];} : null;},\r\n//          i1: function(pf){return (pf.im)? function(){return nums2[3]>1? nums2[3]-1 : '';} : null;},\r\n          lp: function(pf){return (pf.nl)? function(){return (lth.ta && lth.ta.posts)? lth.ta.posts.length : '';} : null;},\r\n          dp: function(pf){return (pf.nd)? function(){return lth.pd? lth.pd.length : '';} : null;},\r\n          ar: function(pf){return (pf.archived)? function(){var ar = lth.archived; return ar>=8? 'a' : ar? 'A' : '';} : null;}, // >=8 for merge\r\n          nf: function(pf){return (pf.nf)?  function(){return lth.sID && lth.sID.nc || '';} : null;},\r\n          ni: function(pf){return (pf.nid)? function(){return lth.sID && (lth.sID.nid || lth.sID.np) || '';} : null;},\r\n          ct: function(pf){return (pf.ctime)?  function(){return format_time(nums2[1]);} : null;},\r\n          cT: function(pf){return (pf.rctime)? function(){return format_relative_time(nums2[1]);} : null;},\r\n          bt: function(pf){return (pf.btime)?  function(){return nums2[0]? format_time(nums2[0]) : '';} : null;},\r\n          bT: function(pf){return (pf.rbtime)? function(){return nums2[0]? format_relative_time(nums2[0]) : '';} : null;},\r\n          pt: function(pf){return (pf.ptime)?  function(){return nums2[4]? format_time(nums2[4]) : '';} : null;},\r\n          pT: function(pf){return (pf.rptime)? function(){return nums2[4]? format_relative_time(nums2[4]) : '';} : null;},\r\n          pr: function(pf){return (pf.prate)?  function(){return Math.floor(nums2[2]/((ts_refresh - nums2[1])/86400000));} : null;},\r\n          dn: function(pf){return (pf.domain)? function(){return lth.domain;} : null;},\r\n          bd: function(pf){return (pf.board)?  function(){return lth.board;} : null;},\r\n          no: function(pf){return (pf.no)?     function(){return lth.no;} : null;},\r\n          sp: function(pf){return (pf.ns)?     function(){return lth.sg? lth.sg.size : '';} : null;},\r\n        };\r\n        var funcs_and_tags = {\r\n          IB: function(pf){return function(){return lth.th && lth.th.bumplimit? '<i>' : '';}},\r\n          Ib: function(pf){return function(){return lth.th && lth.th.bumplimit? '</i>' : '';}},\r\n          II: function(pf){return function(){return lth.th && lth.th.imagelimit? '<i>' : '';}},\r\n          Ii: function(pf){return function(){return lth.th && lth.th.imagelimit? '</i>' : '';}},\r\n          '<iB' : function(pf){return function(){return lth.th && lth.th.bumplimit? '<i' : '';}}, // test_mode['138']\r\n          '</iB': function(pf){return function(){return lth.th && lth.th.bumplimit? '</i' : '';}}, // for NOT enclosed pair in ()\r\n          '<iI' : function(pf){return function(){return lth.th && lth.th.imagelimit? '<i' : '';}},\r\n          '</iI': function(pf){return function(){return lth.th && lth.th.imagelimit? '</i' : '';}}, // for NOT enclosed pair in ()\r\n          __proto__: funcs\r\n        };\r\n        var fmts = {\r\n          native: pref0.footer.native,\r\n          condensed: '(ar )(nm/)(nr/)(lp/)(rp)(*sp)(+dp)(/im)(/pg) (ni/nf )(ct )(cT )(bt )(bT )(pt )(pT )(pr )(dn)(bd)(no) ',\r\n          meguca:    '(ar )(dn)(bd)(no) (nm/)(nr/)(lp/)(rp)(*sp)(+dp)(/im)(/pg) (ni/nf )(ct )(cT )(bt )(bT )(pt )(pT )(pr ) ',\r\n//          get custom_str(){return pref[myself.mode].footer.custom_str;}, // patch for minify. This line hits a bug in minifier.\r\n        };\r\n        parent.compile = function(){\r\n          var pf = pref[this.mode_fmt].footer;\r\n          var fmt = (!pref.test_mode['138'])? (fmts[pf.design] || pf[pf.design] || '')\r\n              // .split(/(\\([^)]*?\\))/).map(function(v,i){return i%2==0? ('('+v+')').replace('<',')(<').replace('>','>)(').replace(/\\(\\)/g,'') : v;}).join('') // add () to all\r\n              : pref_func.sanitize(fmts[pf.design] || pf[pf.design] || ''); // '' for safety\r\n          var rx = /(ar|n[mrfio]|pg|rp|im|[lds]p|[cbp][tT]|pr|dn|bd|RP|IM|I[BbIi]|<\\/?span|<\\/?[bius][BI]*)/; // x|y is different from y|x, see https://developer.mozilla.org/ja/docs/Web/JavaScript/Guide/Regular_Expressions\r\n//          var elems = 'ar|n[mrfio]|pg|rp|im|[lds]p|[cbp][tT]|pr|dn|bd|RP|IM|I[BbIi]|<\\/?[bius][BI]*|<\\/?span'; // don't use capture (), following code assumes it to use split function\r\n          var arr = fmt.split(/(\\([^)]*?\\))/).filter(function(v){return v;}).map(function(v){return v[0]==='('? v.slice(1,-1) : v;});\r\n//          var arr = fmt.split(new RegExp('(\\\\(.*?(?:'+elems+').*?\\\\))')).filter(function(v){return v;});\r\n//          var rx = new RegExp('('+elems+')');\r\n          var obj = {};\r\n          var len = 0;\r\n          var proto = {enumerable:true, configurable:true};\r\n          for (var i=0;i<arr.length;i++) {\r\n            var tmp = arr[i].split(rx);\r\n            if (tmp.length>=3) {\r\n              if (!pref.test_mode['138'] && arr[i].indexOf('<')!==-1) {\r\n                for (var j=1;j<tmp.length;j+=2) if (tmp[j][0]==='<' && tmp[j].indexOf('>')===-1) while (tmp[j+1].indexOf('>')===-1) tmp[j+1] += tmp.splice(j+2,2).join('');\r\n                for (var j=tmp.length-2;j>=-1;j-=2) {\r\n                  if (j>=1 && tmp[j][0]==='<')\r\n                    if ((tmp[j]+tmp[j+1]).search(/^<\\/?(span|[bius][BI]*)(?: +style=\"[^&\"<>\\']*\")?>/)===0) continue; // perfection check for security\r\n                    else tmp[j] = pref_func.sanitize(tmp[j]);\r\n                  tmp[j+1] = pref_func.sanitize(tmp[j+1]);\r\n                }\r\n//                var count = tmp.filter(function(v,i){return i%2==1 && funcs[v] && funcs[v](pf)}).length;\r\n              }\r\n              var count_src   = tmp.filter(function(v,i){return i%2==1 && funcs[v]}).length;\r\n              var count_funcs = tmp.filter(function(v,i){return i%2==1 && funcs[v] && funcs[v](pf)}).length;\r\n              if (count_src>0 && count_funcs==0) continue;\r\n              tmp = compile_rec(pf, tmp, 1, tmp.length, [tmp[0]]);\r\n//              for (var j=2;j<tmp.length;j+=2) { // patch for the pattern '( /<iI> I: IM</iI>)', but 'I:' shows even at im===0.\r\n//                var idx = tmp[j].indexOf('>');\r\n//                if (idx!==-1 && idx!==tmp[j].length) {\r\n//                  tmp.splice(j+1, 0, tmp[j].slice(idx+1), '');\r\n//                  tmp[j] = tmp[j].slice(0,idx+1);\r\n//                  j += 2;\r\n//                }\r\n//              }\r\n//              for (var j=1;j<tmp.length;j+=2) { // working code, but can't handle '( /<iI> I: IM</iI>)' properly.\r\n//                if (funcs_and_tags[tmp[j]]) {\r\n//                  tmp[j] = funcs_and_tags[tmp[j]](pf);\r\n//                  if (!tmp[j]) {tmp.splice(j,2); j-=2;} // !tmp[0] means parameters because head of tags always return functions. // delete following separator\r\n//                } else {\r\n//                  var tag_prev = j-2>=0 && (tmp[j-2][0]==='<' || tmp[j-2][0]==='I') || tmp[j-1].indexOf('>')!==-1;\r\n//                  if (j==1 || count<=1 && !tag_prev) {tmp[j-1] += tmp.splice(j,2).join(''); j-=2;}\r\n//                  else {tmp[j] = funcs.const(tmp[j]+tmp[j+1]); tmp[j+1] = '';} // can't consolidate straight 2 tags, like <iI><b>im</b></iI>\r\n//                }\r\n//              }\r\n////              for (var j=1;j<tmp.length;j+=2) tmp[j] = funcs[tmp[j]](pf); // working code. without test_mode['138]', just simple 2 lines.\r\n////              for (var j=tmp.length-3;j>=0;j-=2) if (!tmp[j+1]) tmp.splice(j,2); else if (j>0 && !tmp[j-1]) tmp[j]=''; // delete previous separator\r\n              if (tmp[1]) Object.defineProperty(obj, len++, {get: (tmp.length>=5)?  paste_concat.bind(null, tmp)\r\n                                                                : (tmp[0] || tmp[2])? paste_wrap.bind(null, tmp[0], tmp[1], tmp[2])\r\n                                                                :                     tmp[1], __proto__:proto});\r\n//              if (tmp.length>=5) { // working code, but has a bug.\r\n//                for (var j=1;j<tmp.length;j+=2) tmp[j] = funcs[tmp[j]](pf);\r\n//                for (var j=tmp.length-3;j>=0;j-=2) if (!tmp[j-1] && !tmp[j+1]) tmp.splice(j,2); // access tmp[-1], but ok.\r\n//                if (tmp.length>=3) Object.defineProperty(obj, len++, {get: funcs['concat'].bind(null, tmp), __proto__:proto});\r\n//              } else if (tmp.length>=3) {\r\n//                var func = funcs[tmp[1]](pf);\r\n//                if (func && (tmp[0] || tmp[2])) func = funcs['wrap'].bind(null, tmp[0], func, tmp[2]);\r\n//                if (func) Object.defineProperty(obj, len++, {get: func, __proto__:proto});\r\n            } else if (arr[i]) Object.defineProperty(obj, len++, {value: arr[i], __proto__:proto});\r\n          }\r\n          obj.length = len;\r\n          this.formatted_arr = obj;\r\n          this.realtime = (pf.prate || pf.rptime || pf.rbtime || pf.rctime)? 2 : (pf.ptime || pf.btime || pf.ctime)? 1 : 0; // date part may be omitted.\r\n//          this.realtime = pf.prate || pf.rptime || pf.rbtime || pf.rctime;\r\n//          this.real_ts = 0;\r\n          this.timestamp = (this.realtime? 32 : 0) + (this.mode==='thread' || pref.test_mode['131']? 16 : 0);\r\n          this.pn_menu = (pf.use && pf.menu)? new Triage(pf.menu_str, {embed:true, child_class:'embeddedTriage'}).pn : null;\r\n          this.pn_triage = (pf.use && pf.triage)? new Triage(pf.triage_str, {embed:true, child_class:'embeddedTriage'}).pn : null;\r\n          return obj;\r\n\r\n          function paste_wrap(p,func,l){\r\n            var str = func();\r\n            return str!==''? p+str+l : '';\r\n          }\r\n          function paste_concat(arr){ // for tags, delimiter belongs to previous func\r\n            var str = '';\r\n            for (var i=1;i<arr.length-1;i+=2) {\r\n              var tmp = arr[i]();\r\n              if (tmp!=='') str += tmp + arr[i+1];\r\n            }\r\n            return str!==''? arr[0] + str : ''; // can't return end tags when str==='', like (<u>ni/nf</u>)\r\n          }\r\n//          concat: function(arr){\r\n//            var str = arr[1]();\r\n//            for (var i=2;i<arr.length-1;i+=2) {\r\n//              var tmp = arr[i+1]();\r\n//              if (tmp!=='') str += arr[i] + tmp;\r\n//            }\r\n//            return str!==''? arr[0] + str + arr[arr.length-1] : '';\r\n//          },\r\n          function paste_const(str){return function(){return str;};}\r\n          function paste_tag(tag_o0, tag_o1, tag_cl, arr){\r\n            var str = (arr.length>2)? paste_concat(arr) : arr[0];\r\n            var tag_open;\r\n            return (!str)? '' : (tag_open = tag_o0())? tag_open + tag_o1 + str + tag_cl : str;\r\n          }\r\n          function compile_tag(arr, tag_close){\r\n            tag_close = ((tag_close.search(/[BI]$/)!==-1)? tag_close.slice(0,-1) : tag_close) + '>';\r\n            var idx;\r\n            return (typeof(arr[0])!=='string')? (idx=arr[1].indexOf('>'), paste_tag.bind(null, arr[0], arr[1].slice(0,idx+1), tag_close, [arr[1].slice(idx+1)].concat(arr.slice(2))))\r\n              : (arr.length>=5)? (arr[arr.length-1] = arr[arr.length-1]+tag_close, paste_concat.bind(null, [arr[0]+arr[1]].concat(arr.slice(2))))\r\n              : paste_wrap.bind(null, arr[0]+arr[1], arr[2], arr[3] + tag_close);\r\n          }\r\n          function compile_rec(pf, tmp, j, end, result){\r\n            while (j<end) {\r\n              if (funcs_and_tags[tmp[j]]) {\r\n                var res = funcs_and_tags[tmp[j]](pf);\r\n                if (res) {\r\n                  if (result.length==1 && typeof(result[result.length-1])==='string') { // patch for (<span style=\"opacity:0.6\">+dp</span>)\r\n                    var idx_l = result[result.length-1].lastIndexOf('>')+1;\r\n                    var str = (idx_l>0)? result[result.length-1].slice(idx_l) : '';\r\n                    if (str) {\r\n                      result[result.length-1] = result[result.length-1].slice(0,idx_l);\r\n                      res = paste_wrap.bind(null, str, res, '');\r\n                    }\r\n                  }\r\n                  result.push(res, tmp[j+1]);\r\n                  var tag_close = tmp[j][0]==='<' && '</'+tmp[j].slice(1);\r\n                  if (tag_close) {\r\n                    var idx = tmp.indexOf(tag_close,j+1);\r\n                    if (idx>=0) {\r\n                      var arr_tag = (idx-4>=j)? result.splice(-2).concat(compile_rec(pf, tmp, j+2, idx, [])) : result.splice(-2);\r\n                      if (arr_tag.length>=4 || !(arr_tag.length===2 && idx-4>=j)) result.push(compile_tag(arr_tag, tag_close), '');\r\n                      j = idx;\r\n                    }\r\n                  }\r\n                }\r\n              } else {\r\n                if (typeof(result[result.length-1])==='string' && (result.length==1 || tmp[j][0]!=='<')) result[result.length-1] += tmp[j]+tmp[j+1];\r\n  //              if (typeof(result[result.length-1])==='string') result[result.length-1] += tmp[j]+tmp[j+1];\r\n  //              if (result.length===1) result[result.length-1] += tmp[j]+tmp[j+1];\r\n                else result.push(paste_const(tmp[j]+tmp[j+1]), '');\r\n  //              var tag_prev = j-2>=0 && (tmp[j-2][0]==='<' || tmp[j-2][0]==='I') || tmp[j-1].indexOf('>')!==-1;\r\n  //              if (result.length>0 && (j==1 || count<=1 && !tag_prev)) result[result.length-1] += tmp[j] + tmp[j+1];\r\n  //              else result.push(funcs['const'](tmp[j]+tmp[j+1]), ''); // can't consolidate straight 2 tags, like <iI><b>im</b></iI>\r\n              }\r\n              j += 2;\r\n            }\r\n            return result;\r\n          }\r\n        }\r\n        function refresh_start(){\r\n          ts_refresh = Date.now();\r\n//          ts_refresh_rx = null;\r\n//          this.timestamp_set();\r\n        }\r\n        parent.refresh_start = refresh_start;\r\n        Object.defineProperty(parent,'ts_refresh', {get:function(){return ts_refresh;}, enumerable:true, configurable:true});\r\n//        parent.format_relative_time = format_relative_time;\r\n//        parent.format_time = format_time;\r\n        return function(tgt_th_in, lth_in){\r\n//          if (!this.formatted_arr) this.formatted_arr = compile(this);\r\n          tgt_th = tgt_th_in;\r\n          lth = lth_in;\r\n          nums2 = tgt_th[8];\r\n          return Array.prototype.join.call(this.formatted_arr,'');\r\n        };\r\n      })(Footer);\r\n      Footer.compile();\r\n      cataLog.Footer = Footer;\r\n//      cataLog.insert_footer3 = insert_footer3;\r\n\r\n\r\n      var AutoUpdate = function(clg, indicator){\r\n        this.timer = null;\r\n        this.time_remains = 0;\r\n        this.clg = clg;\r\n        this.indicator = indicator;\r\n        this.timer_tgt = this.timer_tgt.bind(this);\r\n        this.countdown = this.countdown.bind(this);\r\n      };\r\n      AutoUpdate.prototype = {\r\n        timer_tgt: function(from_refresh_button){\r\n          this.timer=null;\r\n          this.clg.refresh(true,null,!from_refresh_button);\r\n          this.restart();\r\n        },\r\n        stop_if_running: function(){\r\n          if (this.timer) {clearTimeout(this.timer); this.timer=null;}\r\n          if (pref.catalog_auto_update_countdown) this.indicator.countdown('');\r\n        },\r\n        countdown: function(){\r\n          var dec = this.time_remains>=660? 60 : 1;\r\n          this.indicator.countdown(dec>1? Math.floor(this.time_remains/60)+'m' : this.time_remains); // shows 0\r\n          this.time_remains -= dec;\r\n          if (this.time_remains<0) this.timer_tgt();\r\n          else this.timer = setTimeout(this.countdown, dec*1000);\r\n        },\r\n        set: function(){\r\n          this.stop_if_running();\r\n          this.restart();\r\n        },\r\n        restart: function(){\r\n          var pf = this.clg.pref[this.clg.mode];\r\n          if (pf.auto_update) {\r\n            var period = pf.auto_update_period>=1? pf.auto_update_period : pf.auto_update_period===-2? 1/6 : pf.auto_update_period===-1? 0.25 : 0.5;\r\n            if (!pref.catalog_auto_update_countdown) this.timer = setTimeout(this.timer_tgt,period*60000);\r\n            else {\r\n              this.time_remains = period*60;\r\n              this.countdown();\r\n            }\r\n          }\r\n        },\r\n        manual_refresh: function(){\r\n          if (this.timer) clearTimeout(this.timer);\r\n          this.timer_tgt(true);\r\n        }\r\n      };\r\n\r\n      var oninput_funcs = {\r\n        'filter.kwd.str': function(e){\r\n          var clg = this['.'];\r\n          var pf = clg.pref.filter.kwd;\r\n          if (pf.use == !pf.str) {\r\n            pf.use = !pf.use;\r\n            clg.components.kwd_use.checked = pf.use; // pref_func.apply_prep(this['.'].components.kwd_use,false); // can't use apply_prep for false with pref.\r\n          }\r\n          var idx = clg.components.kwd_mirror.indexOf(e.target); // -1, 0, or 1\r\n          if (idx!=-1) clg.components.kwd_mirror[idx?0:1].value = pf.str;\r\n          clg.filter_kwd_prep(e);\r\n        },\r\n//        'filter.kwd.str': (function(){ // working code\r\n//          var pn_use = pn_filter.getElementsByTagName('*')['filter.kwd.use'];\r\n//          return function(e){\r\n//            if (pref.filter.kwd.use == !pref.filter.kwd.str) {\r\n//              pref.filter.kwd.use = !pref.filter.kwd.use;\r\n//              pref_func.apply_prep(pn_use,false);\r\n//            }\r\n//            if (e && e.target.name.substr(-4,4)==='.str') pref3.filter.kwd.str(e);\r\n//            filter_kwd_prep(e, pref.filter.kwd);\r\n//          }\r\n//        })(),\r\n        'filter.list_str': function(){\r\n          var clg = this['.'];\r\n          clg.filter_changed();\r\n          if (clg.pref[clg.mode].mark_new_posts) clg.view_time_filter_changed();},\r\n        'filter.attr_list_str': function(){if (this['.'].pref.filter.attr_list) this['.'].view_attr_changed();},\r\n        'filter.tag_search.str': liveTag.popup_filter.oninput_funcs['filter.tag_search.str'],\r\n        __proto__: pref_func.settings.oninput_funcs.__proto__\r\n      };\r\n      var onchange_funcs = {\r\n        'refresh': function(){this['.'].auto_update.manual_refresh(true);},\r\n        '*.board_list_sel' : function(e, init, adaptive_refresh){\r\n          var clg = this['.'];\r\n          if (!init) {\r\n            e.target.blur();\r\n            if (pref.catalog.auto_save_filter) this.save(e, clg.INST.board_list_sel_old);\r\n            if (pref.catalog.refresh.at_switch) clg.clear_threads(0);\r\n            clg.prep_reserved_tags(false,clg.INST.board_list_sel_old);\r\n          }\r\n//if (this===pClg) threads_delayed_pruning = Object.create(null); // TEMPORAL\r\n          if (pref.catalog.auto_load_filter || init) this.load(e,init);\r\n          \r\n//          if (!pref.test_mode['133'] && gClg.Clgs.length>=2) { // not required\r\n//            for (var i=0;i<gClg.Clgs.length;i++) {\r\n//              var tclg = gClg.Clgs[i];\r\n//              if (clg.pref[clg.mode].board_list_sel===tclg.pref[tclg.mode].board_list_sel) {\r\n//                for (var name in tclg.threads) clone_thread(clg, name);\r\n//                adaptive_refresh = false;\r\n//                break;\r\n//              }\r\n//            }\r\n//          }\r\n          if (!init || adaptive_refresh) {\r\n            clg.refresh(pref.catalog.refresh.at_switch,null,false, true);\r\n            if (pref.archive.IDB.auto_restore) {\r\n              clg.format_refresh_tgts();\r\n              for (var i in this.refresh_tgts) gClg.IDB_req[i] = null;\r\n            }\r\n          }\r\n//          if (pref[embed_mode].auto_config_posts_search) {\r\n//            pref.filter.kwd.post = false;\r\n//            pref_func.apply_prep(pn12_0_4.getElementsByTagName('input')['filter.kwd.post'],true);\r\n//          }\r\n          clg.INST.board_list_sel_old = clg.pref[clg.mode].board_list_sel;\r\n        },\r\n//        'float.format.fc.*w/': function(e,pn_name){\r\n//          var clg = this['.'];\r\n//          if (!clg || clg.view!=='catalog') return;\r\n//          var prop = pn_name.split('.').pop();\r\n//          var pf = clg.pref.float.format.fc;\r\n//          var w = (!pf.resize || pf.width==0)? null : pf.width + 'px';\r\n//          var h = (!pf.resize || pf.height==0 ||  pf.max)? null : pf.height + 'px';\r\n//          var mh= (!pf.resize || pf.height==0 || !pf.max)? null : pf.height + 'px';\r\n//          for (var name in clg.threads) if (clg.threads[name][0]) {\r\n//            clg.threads[name][0].style.width = w;\r\n//            clg.threads[name][0].style.height = h;\r\n//            clg.threads[name][0].style.maxHeight = mh;\r\n//          }\r\n//        },\r\n//        'catalog_size_width'  : catalog_resized,\r\n//        'catalog_size_height' : catalog_resized,\r\n//        'catalog_size_text_width'  : catalog_resized,\r\n//        'catalog_size_text_height' : catalog_resized,\r\n        'catalog.order.*': 'float.order.*', // function(){pClg.idx_re_sort();},\r\n        'float.order.*': function(){this['.'].idx_re_sort();},\r\n        '*.hide_unwatched': 'float.order.*',\r\n        '*.auto_update' : function(){this['.'].auto_update.set()},\r\n        '*.auto_update_period' : '*.auto_update',\r\n        'Drop now': function(){this['.'].show_catalog(-1);},\r\n        'clear_threads'       : function(){this['.'].clear_threads(0); this['.'].show_catalog();},\r\n        'clear_filters': function(e){this['load'](e, null, true);},\r\n        'load': function(e, init, clearOnly){\r\n          if (localStorage || clearOnly) {\r\n            var clg = this['.'];\r\n            var pf = clg.pref.filter;\r\n            var blank = pref_default().filter;\r\n            delete blank['tag']; // keep filter.tag because it may be changed to getter/setter for support multiple liveTag.\r\n            if (pref.common.consolidated_watch_list) delete blank['watch_list_str'];\r\n            pref_func.pref_overwrite(pf, blank);\r\n            if (clearOnly) {\r\n              pf.tag = false;\r\n              if (!clg.liveTag.NC) for (var i=0;i<gClg.Clgs.length;i++) if (!gClg.Clgs[i].liveTag.NC) gClg.Clgs[i].components.tag_use.checked = false;\r\n            }\r\n//            pref_func.pref_overwrite(pf,pref_default().filter);\r\n          }\r\n          if (localStorage && !clearOnly) {\r\n            try { \r\n              var loaded = JSON.parse(localStorage.getItem(this.load_save_key(clg.pref[clg.mode].board_list_sel)) ||\r\n                                      localStorage.getItem(this.load_save_key(clg.pref[clg.mode].board_list_sel).replace(/\\./,'.catalog.'))) || {}; // patch from 2020.10\r\n              delete loaded['tag'];\r\n              if (pref.common.consolidated_watch_list) {\r\n                if (init) pf.watch_list_str = localStorage.getItem(pref.script_prefix + '.WatchList') || '';\r\n                if (loaded['watch_list_str']) pf.watch_list_str = loaded['watch_list_str'] + '\\n' + pf.watch_list_str; // the latter has the priority.\r\n                delete loaded['watch_list_str'];\r\n              }\r\n              pref_func.pref_overwrite(pf, loaded, true);\r\n//              pref_func.pref_overwrite(pf,JSON.parse(localStorage.getItem(this.load_save_key(clg.pref[clg.mode].board_list_sel))),true);\r\n            } catch (e){\r\n              console.log(e);\r\n            }\r\n          }\r\n          if (init && pref[clg.mode].disable_kwd_filter_at_initial) clg.pref.filter.kwd.use = false;\r\n          pref.filter.time_quick_sel = 0;\r\n          pref_func.apply_prep(clg.components.pn_filter,false, null, null, true, clg.pref, init); // also make obj.\r\n//          pref_func.apply_prep(pn_filter,true); // make obj2.\r\n          clg.filter_kwd_prep_init(null, init); // call filter_changed in this.\r\n          clg.liveTag.filter_onchange(pf.tag_search, true, true);\r\n          if (!init) clg.view_attr_changed(); // 'if (!init)' is a patch\r\n        },\r\n//        'save_onleave'        : function(){if (pref.catalog.auto_save_filter) onchange_funcs.save();window.removeEventListener('beforeunload', onchange_funcs.save_onleave, false);},\r\n//        'save'                : function(){if (localStorage) localStorage.setItem(onchange_funcs.load_save_key(pref.catalog_board_list_sel),JSON.stringify(pref.filter));},\r\n        'save': function(e, sel){\r\n          if (localStorage) {\r\n            var clg = this['.'];\r\n            if (typeof(sel)!=='number') sel = clg.pref[clg.mode].board_list_sel;\r\n            var pf = clg.pref.filter;\r\n            var save_str = JSON.stringify(\r\n              pref_func.obj_elim_the_same(pref_default(true).filter, pf), function(key,value){\r\n                return (key==='time_str' && (!pf.time && !pf.time_watch && !pf.time_watch_creation && !pf.time_creation) ||\r\n                        key==='watch_list_str' && pref.common.consolidated_watch_list)? undefined : value;});\r\n//              (!pf.time && !pf.time_watch && !pf.time_watch_creation && !pf.time_creation)?\r\n//                function(key,value){return (key==='time_str')? undefined : value;} : undefined);\r\n            var key = this.load_save_key(sel);\r\n            if (key) {\r\n              if (save_str==='{}') delete localStorage[key];\r\n              else localStorage.setItem(key, save_str);\r\n              if (key.indexOf('CatChan.filter.')===0) delete localStorage[key.replace(/\\./,'.catalog.')]; // patch from 2020.10\r\n            }\r\n            if (pref.common.consolidated_watch_list) this['save_watch_list']();\r\n          }\r\n        },\r\n        'save_watch_list': function(){\r\n          if (localStorage) {\r\n            var clg = this['.'];\r\n            var pf = clg.pref.filter;\r\n            var key_wl = pref.script_prefix + '.WatchList';\r\n            if (pf.watch_list_str==='') delete localStorage[key_wl];\r\n            else localStorage.setItem(key_wl, pf.watch_list_str);\r\n          }\r\n        },\r\n//        'load_default': function(){\r\n//          var clg = this['.'];\r\n////          var pref_def = pref_default();\r\n//          pref_func.pref_overwrite(clg.pref.filter,pref_default().filter);\r\n////          pref.filter.time_str = new Date().toLocaleString();\r\n//          pref_func.apply_prep(clg.components.pn_filter,false, null, null, true);\r\n////          pref_func.apply_prep(pn12_0_4,true); // obj init.\r\n//          clg.filter_kwd_prep(null);\r\n//          clg.view_attr_changed();\r\n//        },\r\n        'load_save_key': function(num){\r\n          var row_obj = pref.catalog_board_list_obj[num];\r\n          return (row_obj)? pref.script_prefix + (pref.common.consolidated_filter? '.Filter':'.filter.' + row_obj[0].key) : null;},\r\n        'filter.kwd.*'   : function(e){this['.'].filter_kwd_active(e);}, // use, op, sub, name, file, com, trip, meta, id, id2, post, inPost\r\n        'filter.kwd.re'    : function(){this['.'].filter_kwd_prep();},\r\n        'filter.kwd.match' : 'filter.kwd.re',\r\n        'filter.kwd.ci'    : 'filter.kwd.re',\r\n        'filter.kwd.sentence': 'filter.kwd.re',\r\n        'filter.kwd.ew'    : 'filter.kwd.re',\r\n//        'filter.kwd.post'  : function(e, init){ // working code\r\n//          var clg = this['.'];\r\n//          if (e.target.checked && this.mode!=='thread') {\r\n//            if (pref[cataLog.embed_mode].searchAs) this.scanBoard(e, true, true);\r\n//            if (pref[cataLog.embed_mode].searchAsA) this.scanSite(e, true, true);\r\n//          }\r\n////          if (pref[embed_mode].auto_config_posts_search) {\r\n////            if (e.target.checked) {\r\n////              pref[embed_mode].t2h_sel = 'ALL_agg';\r\n////              if (embed_mode==='catalog') pref[embed_mode].popup2 = 'sr';\r\n////              onchange_funcs.scanBoard();\r\n////            } else {\r\n////              var pref_def = pref_default();\r\n////              pref[embed_mode].t2h_sel = pref_def[embed_mode].t2h_sel;\r\n////              if (embed_mode==='catalog') pref[embed_mode].popup2 = pref_def[embed_mode].popup2;\r\n////            }\r\n////            pref_func.apply_prep(pref_func.mirror_targets.pn13_1,false);\r\n////          }\r\n//        },\r\n        'filter.tag': function(){\r\n          var clg = this['.'];\r\n          if (!clg.liveTag.NC) {\r\n            var clgs = gClg.Clgs;\r\n            var val = clg.components.tag_use.checked;\r\n            for (var i=0;i<clgs.length;i++) if (clg!==clgs[i] && !clgs[i].liveTag.NC) clgs[i].components.tag_use.checked = val;\r\n          }\r\n          clg.liveTag.filter_changed_broadcast();\r\n        },\r\n//        'filter.tag'       : catalog_filter_changed,\r\n//        'filter.tag_list'  : catalog_filter_changed,\r\n        'filter.time'      : oninput_funcs['filter.list_str'],\r\n        'filter.time_creation' : 'filter.time',\r\n        'filter.time_str'  : 'filter.time',\r\n        'filter.list'      : 'filter.time',\r\n        'filter.watch_list_str': function(e, from_storage){\r\n          if (pref.common.consolidated_watch_list && !from_storage) {\r\n            gClg.Sync_watch_load({newValue:this['.'].pref.filter.watch_list_str}, true); // broadcast\r\n            this['save_watch_list']();\r\n          } else this['filter.list_str']();\r\n        },\r\n//        'filter.watch_list_str' : 'filter.time',\r\n//        'filter.attr_list' : catalog_filter_changed,\r\n//        'filter.attr_list_str' : catalog_filter_changed,\r\n//        'filter.attr_list' : show_catalog, //catalog_attr_changed,\r\n//        'filter.attr_list_str' : show_catalog, //catalog_attr_changed\r\n        'filter.attr_list' : function(){this['.'].view_attr_changed();},\r\n//        'scan'                     : scan_tags,\r\n        'scanBoardIf': function(e){this.scanBoard(e,false,true);},\r\n        'scanSiteIf': function(e){this.scanSite(e,false,true);},\r\n        'scanBoard' : function(e, from_auto, required_only){if (!from_auto && pref.common.clear_at_manual_scan) this.clear_threads();scan.keyword_load_1(site.nickname,required_only? 2:true,[site.board], health_indicator);},\r\n\r\n        'scanSite' : function(e, from_auto, required_only){if (!from_auto && pref.common.clear_at_manual_scan) this.clear_threads();scan.keyword_load(required_only? 2:true, health_indicator);},\r\n//        'filter.tag_ci'     : function(){scan_tags_init(scan_tags_common_c(site3[site.nickname].tags,'')[0], null);},\r\n        'filter.time_quick_sel': function(e){\r\n          var pn = this['.'].components.time_str;\r\n          pn.value = new Date(Date.now() - e.target.value*3600000).toLocaleString();\r\n          pref_func.apply_prep(pn,this['.'].pref,true);\r\n          e.target.selectedIndex = 0;\r\n        },\r\n        'filter.tag_search.re': 'filter.tag_search.str',\r\n        'filter.tag_search.show_nof_boards': liveTag.popup_filter.onchange_funcs['filter.tag_search.show_nof_boards'],\r\n        'tagB.*': liveTag.cbx_all_onchange,\r\n        'tag2bList': liveTag.add_tags_to_boardlist,\r\n        'add_to_auto': function(e){\r\n          var clg = this['.'];\r\n          if (clg.pref.filter.kwd.str==='') return;\r\n          var pf = clg.pref.filter.auto_list;\r\n          var cmds = [pf.kill? 'KILL':null, pf.watch? 'WATCH':null, pf.show? 'SHOW':null, pf.sticky? 'STICKY':null, pf.style? 'ATTR:'+pf.style_str:null].filter(function(v){return v;}).join();\r\n          var str = pref_func.str2obj7.o2s({cmds:cmds, __proto__:clg.pref.filter.kwd});\r\n          clg.pref.filter.auto_list.str += str+'\\n';\r\n          pref_func.apply_prep(clg.components.auto_list,false, null, null, true, clg.pref);\r\n//          var pn = e.target.parentNode.getElementsByTagName('TEXTAREA')[0];\r\n//          pref_func.apply_prep(pn,false, null, null, true);\r\n        },\r\n        'filter.*.style': function(e){\r\n          this['filter.*.style_str']({target:e.target.parentNode.nextSibling});\r\n        },\r\n        'filter.*.style_str': function(e){\r\n          var str = e.target.value;\r\n          if (str[0]!=='.') e.target.nextSibling.setAttribute('style', str||'');\r\n        },\r\n        'filter.postFilter.add': function(e){\r\n          var clg = this['.'];\r\n          var pf = clg.pref.filter.postFilter;\r\n          if (clg.pref.filter.kwd.str==='' || (!pf.hide && !pf.style)) return;\r\n          var boards = pf.boards_str.replace(/\\s/g,'').split(',');\r\n          var str = pref_func.str2obj7.o2s({hide:pf.hide, boards:pf.boards && boards.length>0? boards : null, style:pf.style && pf.style_str, __proto__:clg.pref.filter.kwd}, true);\r\n          clg.pref.filter.postFilter.str += str+'\\n';\r\n          pref_func.apply_prep(clg.components.postFilter,false, null, null, true); // , clg.pref);\r\n          if (pf.use) this['filter.postFilter.REDRAW'](null, pref_func.str2obj7.s2o({}, str, 'filter.postFilter.str'));\r\n        },\r\n        'filter.postFilter.str w/': function(e, name){\r\n          var clg = this['.'];\r\n          if ((pref.postFilter.use ^ name==='postFilter.use') || (clg.pref.filter.postFilter.use ^ name==='filter.postFilter.use'))\r\n            this['filter.postFilter.REDRAW'](clg.pref.filter.postFilter.obj7_old||clg.pref.filter.postFilter.obj7||{}, null, pref.postFilter.obj7_old||pref.postFilter.obj7); // remove\r\n          clg.pref.filter.postFilter.obj7_old = null;\r\n          if (pref.postFilter.use || clg.pref.filter.postFilter.use) this['filter.postFilter.REDRAW']();\r\n        },\r\n        'filter.postFilter.use w/': 'filter.postFilter.str w/',\r\n        'filter.postFilter.REDRAW': function(obj_remove, obj_added, obj_remove_global){\r\n          var clg = this['.'];\r\n          for (var name in clg.threads) format_html.postFilter(clg, clg.threads[name][16], clg.threads[name][16].posts, obj_remove, obj_added, obj_remove_global);\r\n        },\r\n//        'postFilter.use': function(e, obj_added){\r\n//          var clg = this['.'];\r\n//          for (var name in clg.threads) format_html.postFilter(clg.threads[name][16], clg.threads[name][16].posts, !pref.postFilter.use && pref.postFilter.obj7, obj_added);\r\n//        },\r\n        'filter.disLWKA': function(){if (this['.'].pref.filter.kwd.active) this['.'].filter_changed();},\r\n        'filter.disTWKA': 'filter.disLWKA',\r\n        'INST.view': function(e){\r\n          var clg = this['.'];\r\n          clg.func_hide_all(clg.threads);\r\n          for (var i in clg.threads) clg.remake_html_prep(clg.threads[i]);\r\n//          for (var i in clg.threads) {\r\n//            var tgt_th = clg.threads[i];\r\n//            tgt_th[0] = false;\r\n//            tgt_th[16].th = {pn:null, __proto__:tgt_th[16].lth.th};\r\n//            tgt_th[16].posts = null;\r\n//            if (tgt_th[16].icon_sticky) delete tgt_th[16].icon_sticky;\r\n//            if (tgt_th[16].icon_show_always) delete tgt_th[16].icon_show_always;\r\n//          }\r\n          clg.ppn.classList.remove(pref.script_prefix+'_'+clg.view+'View');\r\n//          var idx = e.target.selectedIndex;\r\n          clg.view = clg.pref.INST.view;\r\n//          clg.view = clg.pref[clg.mode].view;\r\n//          clg.view = clg.merge_bases.view = clg.pref[clg.mode].view;\r\n          clg.ppn.classList.add(pref.script_prefix+'_'+clg.view+'View');\r\n          if (clg.native.viewChanged) clg.native.viewChanged();\r\n//          clg.drawn_idx = 0;\r\n          clg.show_catalog(0);\r\n        },\r\n        'liveTag.NC': function(){ // test\r\n          var clg = this['.'];\r\n          var lt = clg.liveTag;\r\n          if (lt===liveTag) return;\r\n          if (lt.subscribed) lt.unsubscribe(true);\r\n          clg.Setup_liveTag(clg.pref.liveTag.NC, true);\r\n          clg.footer.update_all_force(null, 'float', null, true);\r\n          clg.filter_changed();\r\n        },\r\n        'clear_pruneds': function(e){this['.'].rm_items_404_clearPRUNEDs();},\r\n        sticky_filter_settings: function(e){\r\n          var sticky = e.target.textContent==='[\\u25e5]';\r\n          e.target.textContent = (sticky)? '[\\u25e3]' : '[\\u25e5]';\r\n          var pn = e.target.parentNode.parentNode;\r\n          pn.parentNode.style.overflow = sticky? 'hidden' : 'auto';\r\n          pn.nextSibling.style.overflow = sticky? 'auto' : '';\r\n          pn.nextSibling.style.height = sticky? 'inherit' : '';\r\n        },\r\n        'SHOW3.*w/': function(e, name){\r\n          var clg = this['.'];\r\n          var tgt = name.split('.')[1];\r\n          clg.pref[clg.mode].appearance.expand[tgt] = true;\r\n          this.SHOW3(e);\r\n        },\r\n        'HIDE3.*w/': function(e, name){\r\n          var clg = this['.'];\r\n          var tgt = name.split('.')[1];\r\n          clg.pref[clg.mode].appearance.expand[tgt] = false;\r\n          this.HIDE3(e);\r\n        },\r\n        __proto__: oninput_funcs,\r\n      };\r\n////      onchange_funcs.entry_func = (function(myself){ // working code.\r\n////        return function(e){\r\n////          pref_func.apply_prep(this,true);\r\n////          var this_name = this.getAttribute('name'); // for <span>\r\n////          if (myself[this_name]) myself[this_name].call(this,e);\r\n////          else if (this_name.indexOf('.')!=-1 && this_name.substr(0,this_name.indexOf('.'))===embed_mode) {\r\n////            var name = this_name.substr(this_name.indexOf('.')+1);\r\n////            if (myself[name]) myself[name].call(this,e);\r\n////          }\r\n////        }\r\n////      })(onchange_funcs);\r\n      pref_func.add_onchange_format(oninput_funcs);\r\n      pref_func.add_onchange_format(onchange_funcs);\r\n      common_func.Object_defProps(onchange_funcs, site2['DEFAULT'].update_posts_merge_bases.onchange_funcs);\r\n\r\n\r\n      cataLog.embed_mode = embed_mode;\r\n      if (brwsr.sw_cache && pref.info_client) brwsr.sw_cache.subscribe(true);\r\n      if (!pref.test_mode['114']) {\r\n        styleSheet.register_cc('headline','white-space:nowrap;text-overflow:ellipsis;overflow:hidden;width:100%');\r\n        var headline_css = site2[site.nickname].parse_funcs['headline_html'].css;\r\n        if (headline_css) styleSheet.register_cc('headline '+headline_css);\r\n      }\r\n\r\nvar Clg = function(embed_embed, embed_mode, watcher){\r\n  this.mode = embed_mode;\r\n  this.view = embed_mode==='float'? pref.float.view : /*embed_mode==='thread'? 'page' :*/ embed_mode;\r\n  this.show_catalog_cont = new DelayBuffer(this.show_catalog_delayed.bind(this), 200).get_bound_func();\r\n  this.show_catalog_resize = this.show_catalog_resize.bind(this);\r\n  this.show_catalog_scroll = this.show_catalog_scroll.bind(this);\r\n  this.show_catalog_buf = this.Show_catalog_buf(this);\r\n\r\n  var clgs = Clg.prototype.Clgs\r\n  var pf_original = clgs.length==0 || clgs.length==1 && clgs[0].mode!=='float';\r\n  if (clgs.length==0) Object.defineProperty(this,'pref',{get:function(){return pref;}, enumerable:true, configurable:true});\r\n  else this.pref = {filter:common_func.deep_copy2({}, pref.filter), liveTag:{NC:pref.liveTag.NC}}; // copy objects also. // SHOULD CHANGE TO USE pref_overwrite by gathering functions which make obj here.\r\n//  else this.pref = {catalog:{filter:pref_default(true).filter}, liveTag:{NC:pref.liveTag.NC}};\r\n  if (pf_original) {\r\n    Object.defineProperty(this,'order',{get:this.mode==='float'? function(){return pref.float.order;} : function(){return pref.catalog.order;}, enumerable:true, configurable:true});\r\n    if (clgs.length!=0) Object.defineProperty(this.pref, this.mode, {get: this.mode==='float'? function(){return pref.float;} : function(){return pref.catalog;}, configurable:true, enumerable:true});\r\n//    if (clgs.length!=0) this.pref.float = this.mode==='float'? {get order(){return pref.float.order;}} : {get order(){return pref.catalog.order;}};\r\n  } else {\r\n    this.pref.float = pref_func.pref_overwrite(pref_default().float, pref.float, true);\r\n    this.order = this.pref.float.order;\r\n//    this.pref.float = common_func.deep_copy({}, pref.float);\r\n//    this.pref.float.order = this.order;\r\n//    this.pref.float = {order:this.order, view:pref.float.view, format:pref.float.format)}; // temporary\r\n  }\r\n  this.pref[this.mode].board_list_sel = pref[this.mode].save_board_list_sel? pref[this.mode].board_list_sel : pref.catalog_board_list_sel;\r\n  this.name = 'FC'+Clg.prototype.Clgs_count;\r\n  this.pref.INST = pf_original? {view:this.view, get safety(){return pref[embed_mode].safety;}}\r\n                              : {view:this.view, safety: common_func.deep_copy2(pref[this.mode].safety)};\r\n\r\n      var pfai = pref.catalog.appearance.initial;\r\n      var pn12 = cnst.init3({\r\n        func_str:embed_embed?'etb:embed':'left:'+pfai.left+'px:top:'+pfai.top+'px:tb'+(pfai.width?':width:'+pfai.width+'px':'')+(pfai.height?':height:'+pfai.height+'px':'')+':overflow:auto:Show:bottom_top:tb_press:'+pfai.state,\r\n//        func_str:'left:'+pfai.left+'px:top:'+pfai.top+'px:resize:both:'+((embed_embed)? 'display:none:tb:embed':'tb')+':width:'+pfai.width+'px:height:'+pfai.height+'px:resize:both:overflow:auto'+\r\n//          ':Show'+(embed_embed?'':':bottom_top')+((embed_mode==='float')? ':tb_press:'+pfai.state:''),\r\n        onrolldown: this.onrolldown,\r\n        onrollup: this.onrollup,\r\n        exit: (pref.test_mode['114'])? show_hide : this.destroy.bind(this),\r\n//        exit: (!watcher)? show_hide : this.destroy.bind(this),\r\n        maximize: this.show_catalog_resize,\r\n        get auto_roll(){return pref.catalog_auto_rollup_when_moving;},\r\n        autoHeight: function(e){\r\n          var height = e.target.dataset.height || 'auto';\r\n          var style = e.target.parentNode.parentNode.nextSibling.style;\r\n          e.target.dataset.height = style.height;\r\n          style.height = height;\r\n          if (height==='auto') this.this_obj.permit_draw_on_demand = false;\r\n          else delete this.this_obj.permit_draw_on_demand;\r\n          this.this_obj.show_catalog(0); // before binding this['.'], see initialization.\r\n        },\r\n        settings_after: function(){\r\n          if (this.this_obj.mode!=='float') return;\r\n          var comp = this.this_obj.components;\r\n          comp.sticky_filter_settings.style.display = (comp.filter.style.display==='none' && comp.settings.style.display==='none')? 'none' : null;\r\n        },\r\n        this_obj:this, __proto__:cnst.tb_funcs}).pn;\r\n//      var pn12_whole = cnst.init('left:0px:tile:get:bottom:resize:both:Show:tb:width:'+pref.catalog.appearance.initial.width+'px:height:'+pref.catalog.appearance.initial.height+'px:resize:both:overflow:auto',\r\n//        function(){pn12_0_4.style.display='';},function(){pn12_0_4.style.display='none';},show_hide,show_catalog_cont);\r\n//      var pn12 = pn12_whole[0];\r\n//      if (embed_embed) pn12.style.display = 'none';\r\n//      var pn12_rollup_func = pn12_whole[1];\r\n\r\n//// test for prototype base coding.\r\n////      var pn12_whole = new Cnst2('left:0px:tile:get:bottom:resize:both:Show:tb:width:400px:height:400px:resize:both:overflow:auto',\r\n////        {rolldowm:function(){pn12_0_4.style.display='';}, rollup:function(){pn12_0_4.style.display='none';}, exit:show_hide, maximize:show_catalog_cont});\r\n////      var pn12 = pn12_whole.pn;\r\n////      var pn12_rollup_func = pn12_whole.funcs.rollup;\r\n\r\n//      cnst.bottom_top(pn12);\r\n      pn12.classList.add(pref.script_prefix+'_FC');\r\n      pn12.id = pref.script_prefix+'_'+this.name;\r\n      var pn12_0 = pn12.childNodes[0];\r\n      var pn12_1 = pn12.childNodes[1].appendChild(document.createElement('div'));\r\n//      var pn12_1 = pn12.childNodes[1];\r\n//      pn12_1.id = 'catalog_debug'; // working code.\r\n//      var autorollup_state = false;\r\n//      function auto_hide_catalog() {\r\n//        if (pref.catalog_auto_rollup_when_moving) {\r\n//          if (pn12_1.style.display!='none') {\r\n//            pn12_rollup_func();\r\n//            autorollup_state = true;\r\n//          } else if (autorollup_state) {\r\n//            pn12_rollup_func();\r\n//            autorollup_state = false;\r\n//          }\r\n//        }\r\n//      }\r\n//      pn12.addEventListener('dragstart', auto_hide_catalog, false);\r\n//      pn12.addEventListener('dragend'  , auto_hide_catalog, false);\r\n      if (this.mode==='float') pn12_0.childNodes[1].insertBefore(cnst.dom('<button type=\"button\" name=\"autoHeight\">\\u25ca</button>'),pn12_0.childNodes[1].firstChild);\r\n  \r\n      var pf_at = this.pref[this.mode].appearance.titleBar;\r\n      var pn12_0_2 = cnst.add_to_tb(pn12,\r\n//        '<label name=\"filter\"><input type=\"checkbox\" name=\"filter.show\"> Filter </label>' +\r\n//        '<label name=\"settings\"><input type=\"checkbox\" name=\"catalog_show_setting\"> Settings</label>'+\r\n        '<button type=\"button\" name=\"filter\"'+(pf_at.filter?'':' style=\"display:none\"')+'>'+ ((site2[site.nickname].CONTENT_SECURITY_POLICY_DATAURI)? 'F' : cnst.icons.img(cnst.icons.filter)) +'</button>' +\r\n        '<button type=\"button\" name=\"settings\"'+(pf_at.settings?'':' style=\"display:none\"')+'>'+ ((site2[site.nickname].CONTENT_SECURITY_POLICY_DATAURI)? 'S' : cnst.icons.img(cnst.icons.settings)) +'</button>'+\r\n//        '<button name=\"refresh\">Refresh</button>'+\r\n//        '<button name=\"refresh\">\\u27f3</button>'+\r\n        '<button type=\"button\" name=\"refresh\"'+(pf_at.refresh?'':' style=\"display:none\"')+'>'+ ((site2[site.nickname].CONTENT_SECURITY_POLICY_DATAURI)? 'R' : cnst.icons.img(cnst.icons.refresh)) +'</button>'+\r\n//        '<span name=\"num_of_pages\">'+\r\n//          '<span name=\"hide_at_embed\"> up to <input type=\"text\" name=\"catalog_max_page\" size=\"2\" style=\"text-align: right;\">pages in </span></span>'+\r\n        '<span name=\"boards_selector\"'+(pf_at.boards_selector?'':' style=\"display:none\"')+'><select name=\"'+this.mode+'.board_list_sel\"></select></span>');\r\n      var board_sel = pn12_0_2.getElementsByTagName('select')[this.mode+'.board_list_sel'];\r\n      this.pref[this.mode].board_list_sel = cnst.auto_shrink_board_selector.setup(board_sel, this.pref[this.mode].board_list_sel);\r\n////      pref_func.apply_prep(pn12_0_2,false);\r\n//      var pn12_0_2_children = ['filter','settings','refresh','num_of_pages','boards_selector'];\r\n//      for (var i=0;i<pn12_0_2_children.length;i++)\r\n//        if (!pref.catalog.appearance.titleBar[pn12_0_2_children[i]]) pn12_0_2.getElementsByTagName('*')[pn12_0_2_children[i]].style.display = 'none';\r\n////      pn12_1.style.width = pn12_0.offsetWidth + 'px';\r\n\r\n  this.health_indicator = (!watcher)? health_indicator : new healthIndicator.HealthIndicator();\r\n      pn12_0.childNodes[3].appendChild(this.health_indicator.pn);\r\n  if (!watcher) {\r\n      pn12_0.childNodes[3].appendChild(cnst.dom('<span> </span>')); // spacer\r\n      var IDB_indicator = new healthIndicator.HealthIndicator();\r\n      IDB.set_indicator(IDB_indicator);\r\n      pn12_0.childNodes[3].appendChild(IDB_indicator.pn);\r\n  }\r\n      var pn12_0_4 = cnst.dom('<div style=\"margin:0px 3px;clear:both'+(embed_mode==='float'?';position:relative\" class=\"'+pref.script_prefix+'_window':'')+'\"></div>');\r\n//      pn12_0.appendChild(pn12_0_4);\r\n      var pf_order = (embed_mode==='float'? 'float':'catalog')+'.order.';\r\n      var pf_ex = this.pref[this.mode].appearance.expand;\r\n      var html_funcs = pref_func.settings.html_funcs;\r\n      pn12_0_4.innerHTML = pref_func.format_html_str(\r\n        '<div style=\"float:right;display:none\">'+\r\n          '<div style=\"float:right\">'+\r\n            html_funcs.updates(this.mode, html_funcs.rollup(\r\n//            '<input type=\"checkbox\" name=\"catalog_snoop_refresh\" checked> Snoop update<br>'+\r\n//            '&emsp;<input type=\"checkbox\" name=\"catalog_promiscuous\"> Promiscuous<br>'+\r\n//            '<select name=\"'+embed_mode+'.view\"><option>Headline</option><option>Catalog</option><option>Page</option></select> :View<br>'+\r\n              '1,<IC\"INST.safety.hide\">Auto drop threads temporarily for light feeling <BTN\"Drop now\"><br>'+\r\n              '1,<IC\"INST.safety.remove\">Auto remove threads latter than <ITBN5\"INST.safety.max\">th<br>'+\r\n              '<BTN\"clear_threads,Clear all threads\">','',true))+\r\n            html_funcs.design_of_fc('INST', 1)+'<br name=\"PLACEHOLDER_NATIVE_SIZE\">'+\r\n            (this.mode==='float'? '<IC\"liveTag.NC\">Separated virtual board<br>' : '')+\r\n            '<IC\"'+this.mode+'.merge\">Merge all threads<br>'+\r\n            '<IC\"'+this.mode+'.merge_list\">Merge threads by list<br>'+\r\n          '</div>'+\r\n          '<div style=\"float:right\">'+\r\n//            '<div name=\"hide_at_embed\">'+\r\n            '<SE\"'+pf_order+'ordering,Bump order,Creation date,Reply count,Image count,Last reply,Fast,/Bump order,/Creation date,/Reply count,/Image count,/Last reply,Slow\"><br>'+\r\n//              'size '+\r\n//              '<span name=\"catalog.text_mode.mode.graphic\">'+\r\n//                '<input type=\"text\" name=\"catalog_size_width\" size=\"4\" style=\"text-align: right;\"> x '+\r\n//                '<input type=\"text\" name=\"catalog_size_height\" size=\"4\" style=\"text-align: right;\"></span>'+\r\n//              '<span name=\"catalog.text_mode.mode.text\">'+\r\n//                '<input type=\"text\" name=\"catalog_size_text_width\" size=\"4\" style=\"text-align: right;\"> x '+\r\n//                '<input type=\"text\" name=\"catalog_size_text_height\" size=\"4\" style=\"text-align: right;\"></span>'+\r\n//            '</div>'+\r\n            '<div>'+\r\n//              '&emsp;Order<br>'+\r\n              html_funcs.rollup_radio(''+pf_order+'sticky', ' :Sticky', 1, '',\r\n                ['first:at first','last:at last','dont_care:don\\'t care'])+ '<br>'+\r\n              '<IC\"'+pf_order+'reply_to_me\">New reply to me at first<br>'+\r\n              '<IC\"'+pf_order+'reply\">New reply at first<br>'+\r\n//              '<input type=\"checkbox\" name=\"'+pf_order+'watch\"> Watch listed at first<br>'+\r\n              html_funcs.rollup_radio(''+pf_order+'watch', ' :Watch listed', 1, '',\r\n                ['first:at first','last:at last','dont_care:don\\'t care'])+ '<br>'+\r\n//              '&emsp;<input type=\"radio\" name=\"'+pf_order+'sticky\" value=\"hide\"> hide<br>'+\r\n              '<IC\"'+this.mode+'.hide_unwatched\">Watched only<br>'+\r\n            '</div>'+\r\n          '</div>'+\r\n//          '<div style=\"float:right\">'+\r\n//            '<div name=\"hide_at_embed\">'+\r\n//              '<input type=\"radio\" name=\"catalog.text_mode.mode\" value=\"graphic\"> Graphical mode<br>'+\r\n//              '<input type=\"radio\" name=\"catalog.text_mode.mode\" value=\"text\"> Text mode<br>'+\r\n//            '</div>'+\r\n//          '</div>'+\r\n        '</div>'+\r\n        '<div align=\"left\" style=\"float:left;display:none\">'+\r\n          '<div data-show3=\"kwd\"'+(pf_ex.kwd?'':' style=\"display:none\"')+'>'+\r\n            '<a name=\"HIDE3.kwd\" style=\"cursor:pointer\">[-]</a>'+\r\n            '<span class=\"PLACEHOLDER\" style=\"float:right\"></span>'+ // tack\r\n            '<ICN\"filter.kwd.use\">Keyword :'+\r\n//            '<textarea style=\"height:1em\" cols=\"25\" name=\"filter.kwd.str\"></textarea>'+\r\n            '<input type=\"text\" name=\"filter.kwd.str\" size=\"25\">'+\r\n            ' <ICN\"filter.kwd.ci\">CI '+\r\n            html_funcs.make_sel('filter.kwd.match', ['match all','match any','unmatch all','unmatch any'])+\r\n            ' <ICN\"filter.kwd.sentence\">Sentence'+\r\n            ' <ICN\"filter.kwd.ew\">exact'+\r\n            ' <ICN\"filter.kwd.re\">RE<br>'+\r\n            '1,(<ICN\"filter.kwd.sub\">Subject '+\r\n            '<ICN\"filter.kwd.name\">Name '+\r\n            '<ICN\"filter.kwd.com\">Comment '+\r\n            '<span style=\"display:none\">'+\r\n              '<span name=\"HIDE4\" style=\"cursor:pointer\">\\u25c0</span>'+\r\n              '<ICN\"filter.kwd.trip\">Tripcode '+\r\n              '<ICN\"filter.kwd.id\">ID '+\r\n              '<ICN\"filter.kwd.id2\">ID2 '+\r\n              '<ICN\"filter.kwd.flag\">Flag'+\r\n              '<ICN\"filter.kwd.file\">Filename '+\r\n              '<ICN\"filter.kwd.meta\">No. '+\r\n            '</span>'+\r\n            '<span name=\"SHOW4\" style=\"cursor:pointer\">\\u25b6</span>'+\r\n            ')'+\r\n            ' (<ICN\"filter.kwd.op\">OP '+\r\n            '<ICN\"filter.kwd.post\">Posts)'+\r\n            '<BTN\"scanBoard,>\">'+\r\n            '<BTN\"scanSite,>>\">'+\r\n            html_funcs.rollup(\r\n              '2,<IC\"filter.disLWKA\">Disable list filter when keyword filter is active<br>'+\r\n              '2,<IC\"filter.disTWKA\">Disable tag filter when keyword filter is active<br>'+\r\n              '1,<IC\"filter.auto_list.use\">Auto thread filter<br>'+\r\n              '2,<ICN\"filter.auto_list.kill\">Hide '+\r\n              '<ICN\"filter.auto_list.watch\">Watch '+\r\n              '<ICN\"filter.auto_list.show\">Show '+\r\n              '<ICN\"filter.auto_list.sticky\">Sticky '+\r\n              '<ICN\"filter.auto_list.style\">Style:<ITBL25\"filter.auto_list.style_str\"><span> &emsp;</span>'+\r\n              '<BTN\"add_to_auto,+\"><br>'+\r\n              '2,<TA\"filter.auto_list.str,40,1\"><br>'+\r\n              (!pref.test_mode['158']? '' : \r\n              '1,<IC\"filter.postFilter.use\">Post filter<br>'+\r\n              '2,<ICN\"filter.postFilter.hide\">Hide '+\r\n              '<ICN\"filter.postFilter.boards\">Boards:<ITBL10\"filter.postFilter.boards_str\">'+\r\n              '<ICN\"filter.postFilter.style\">Style:<ITBL25\"filter.postFilter.style_str\" placeholder=\"border-left:10px solid orange\"><span> &emsp;</span>'+\r\n              '<BTN\"filter.postFilter.add,+\"><br>'+\r\n              '2,<TA\"filter.postFilter.str,40,1\">'),'<ICN\"filter.kwd.inPost\">inPost') +\r\n          '</div>'+\r\n//          '<div>'+\r\n////            '<button name=\"scanSite\">scanSite</button> '+\r\n//////////            '<span name=\"scan_progress\"></span><br>'+\r\n////            '<button name=\"clear_threads\">ClearAllThreads</button>'+\r\n////            '<input type=\"checkbox\" name=\"common.clear_at_manual_scan\">Auto <br>'+\r\n////            '<div style=\"float:left;overflow:auto;resize:both;\" name=\"filter.tag_site_list\"></div>'+\r\n////            '<input type=\"checkbox\" name=\"filter.tag_scansite\">scan tags<br>'+\r\n//          '</div>'+\r\n          '<div style=\"clear:both'+(pf_ex.time?'':';display:none')+'\" data-show3=\"time\">'+\r\n            '<a name=\"HIDE3.time\" style=\"cursor:pointer\">[-]</a>'+\r\n//'<ICBX\"filter.time\">'+ html_funcs.rollup_radio('filter.time_sel',\r\n            'Time: Posted/Created '+\r\n            '<ICN\"filter.time\">'+\r\n            '<ICN\"filter.time_creation\">Hide '+\r\n//            '<input type=\"checkbox\" name=\"filter.time_mark\"> Mark: '+\r\n            '<ICN\"filter.time_watch\">'+\r\n            '<ICN\"filter.time_watch_creation\">Watch '+\r\n//            '<textarea style=\"height:1em\" cols=\"25\" name=\"filter.time_str\"></textarea>'+\r\n            '<ITBL25\"filter.time_str\">'+\r\n            '<SE\"filter.time_quick_sel,dummy:quick select...,0:now,1:1 hour ago,2:2 hours ago,4:4 hours ago,12:12 hours ago,24:1 day ago,72:3 days ago,168:1 week ago\">'+\r\n//            '<span class=\"CatChan_hMenu\">quick select...'+\r\n//              '<div class=\"CatChan_hMCnt\" style=\"z-index:1\">'+\r\n//                ['now','1 hour ago','2 hours ago','4 hours ago','12 hours ago','1 day ago','3 days ago','1 week ago'].map(function(v){return '<button type=\"button\">'+v+'</button>';}).join('')+\r\n//              '</div>'+\r\n//            '</span>'+\r\n//'', 1, '', ['no:no', 'hp:Hide no posts after', 'hc:Hide created before','wp:Watch posted after', 'wc:Watch created after', 'hwp:Hide and watch by posted time', 'hwc:Hide and watch by creation time'])+ '<br>'+\r\n            '<br>'+\r\n          '</div>'+\r\n          '<div style=\"clear:both'+(pf_ex.tag?'':';display:none')+'\" data-show3=\"tag\">'+\r\n            '<a name=\"HIDE3.tag\" style=\"cursor:pointer;float:left\">[-]</a>'+\r\n            '<span class=\"PLACEHOLDER\" style=\"float:right\"></span>'+ // tack\r\n            liveTag.popup_filter.html+\r\n////            '<div style=\"float:left\">'+\r\n////              '<input type=\"checkbox\" name=\"filter.tag\"> Tag :'+\r\n////            '</div>'+\r\n////            '<div style=\"float:left\">'+\r\n////              '<div>'+\r\n////                ' Fetcn / In / Out / Threads / Tag '+\r\n////                '<ITBL25\"filter.tag_search.str\" placeholder=\"Search tags...\">'+\r\n//////                ' <ICBX\"filter.tag_search.ci\">CI'+\r\n////                ' <ICBX\"filter.tag_search.re\">RE'+\r\n////              '</div>'+\r\n////              '<div><span></span>'+html_funcs.rollup(\r\n////                '<IC\"filter.tag_search.show_nof_boards\">Show number of boards<br>'+\r\n////                '<BTN\"tagB.shown_t_pk,T\"><BTN\"tagB.shown_t_in,T\"><BTN\"tagB.shown_t_ex,T\"> Toggle checkboxes of shown tags<br>'+ // span for not being wrapped by label.\r\n////                '<BTN\"tagB.shown_c_pk,C\"><BTN\"tagB.shown_c_in,C\"><BTN\"tagB.shown_c_ex,C\"> Clear checkboxes of shown tags<br>'+\r\n////                '<BTN\"tagB.all_c_pk,C\"><BTN\"tagB.all_c_in,C\"><BTN\"tagB.all_c_ex,C\"> Clear checkboxes of all tags')+'<br></div>'+\r\n////              '<div style=\"overflow:auto;resize:both;float:left\" name=\"filter.tag_list\"></div>'+\r\n////              html_funcs.rollup('<div style=\"clear:both\">'+\r\n////                '<BTN\"tag2bList,Add\"> selected tags to the last of board group<br>'+\r\n////                '1,Label: <ITBL20\"filter.tag2bList.label\" placeholder=\"default: topmost tag\"><br>'+\r\n////                '1,<IR\"filter.tag2bList.by,tag\">By tag<br>'+\r\n////                '1,<IR\"filter.tag2bList.by,board\">By board<br>'+\r\n////                '</div>')+\r\n//////              '<a name=\"SHOW\" style=\"cursor:pointer\" data-str=\"[\\u25b2]\">[\\u25bc]</a>'+\r\n//////              '<div name=\"SUB\" style=\"clear:both;display:none\">TEST</div>'+\r\n////            '</div>'+\r\n////            '<div style=\"clear:both\"></div>'+ // for floating\r\n          '</div>'+\r\n          '<div style=\"clear:both'+(pf_ex.list?'':';display:none')+'\" data-show3=\"list\">'+\r\n            '<a name=\"HIDE3.list\" style=\"cursor:pointer;float:left\">[-]</a>'+\r\n            '<span class=\"PLACEHOLDER\" style=\"float:right\"></span>'+ // tack\r\n            '<div style=\"float:left\">'+\r\n              '<input type=\"checkbox\" name=\"filter.list\"> Exclusive list:<br>'+\r\n  //            '<input type=\"checkbox\" name=\"filter.list_mark_time\"> Mark:<br>'+\r\n  //            '<!-- &emsp;<input type=\"checkbox\" name=\"filter.list_time_scroll\"> Scroll to new post -->'+\r\n  //            '<div style=\"clear:both\">&emsp;<textarea style=\"height:1em\" cols=\"20\" name=\"filter.list_str\"></textarea></div>'+\r\n              '&emsp;<textarea style=\"height:1em\" cols=\"20\" name=\"filter.list_str\"></textarea>'+\r\n            '</div>'+\r\n            '<div style=\"float:left\">'+\r\n  //            '<div style=\"float:left\"><input type=\"checkbox\" name=\"filter.attr_list\"> Attribute list:<br></div>'+\r\n              '<input type=\"checkbox\" name=\"filter.attr_list\"> Attribute list:<br>'+\r\n              '&emsp;<textarea style=\"height:1em\" cols=\"20\" name=\"filter.attr_list_str\"></textarea>'+\r\n            '</div>'+\r\n            '<div style=\"float:left\">'+\r\n              'Watch time list:<br>'+\r\n  //            '<input type=\"checkbox\" name=\"filter.watch_list_mark_time\"> Mark:<br>'+\r\n              '&emsp;<textarea style=\"height:1em\" cols=\"20\" name=\"filter.watch_list_str\"></textarea>'+\r\n            '</div>'+\r\n            '<div style=\"float:left\">'+\r\n              '<input type=\"checkbox\" name=\"filter.bookmark_list\"> Bookmark list:<br>'+\r\n              '&emsp;<textarea style=\"height:1em\" cols=\"10\" name=\"filter.bookmark_list_str\"></textarea>'+\r\n            '</div>'+\r\n            '<div style=\"clear:both\"></div>'+ // for floating\r\n          '</div>'+\r\n          '<div style=\"clear:both'+(pf_ex.ctrl?'':';display:none')+'\" data-show3=\"ctrl\">'+\r\n            '<a name=\"HIDE3.ctrl\" style=\"cursor:pointer;float:left\">[-]</a>'+\r\n            '<div style=\"float:left;width:16px\"><br></div>'+ // spaces for not clicking clear button\r\n            '<div style=\"float:left\">'+\r\n              '<BTN\"clear_filters,clear filters\"><br>'+\r\n              '<BTN\"load,load\"><IC\"catalog.auto_load_filter\">Auto load filters at changing board group<br>'+\r\n              '<div>'+\r\n                '<div style=\"float:left\"><BTN\"save,save\"></div>'+\r\n                '<div style=\"float:left\">'+\r\n                   '<IC\"catalog.auto_save_filter\">Auto save filters at opening or changing board group<br>'+\r\n                   '<IC\"catalog.auto_save_filter_at_refresh\">Auto save filters at refresh'+\r\n                '</div>'+\r\n              '</div>'+\r\n              '<BTN\"clear_pruneds,clear all pruned entries in all lists\"><br>'+\r\n            '</div>'+\r\n          '</div>'+\r\n          '<div style=\"cursor:pointer;clear:both\">'+\r\n            '<a name=\"SHOW3.kwd\"  data-show3=\"kwd\"' +(pf_ex.kwd? ' style=\"display:none\"':'')+'>[+ Keyword filter]</a>'+\r\n            '<a name=\"SHOW3.time\" data-show3=\"time\"'+(pf_ex.time?' style=\"display:none\"':'')+'>[+ Time filter]</a>'+\r\n            '<a name=\"SHOW3.tag\"  data-show3=\"tag\"' +(pf_ex.tag? ' style=\"display:none\"':'')+'>[+ Tag search]</a>'+\r\n            '<a name=\"SHOW3.list\" data-show3=\"list\"'+(pf_ex.list?' style=\"display:none\"':'')+'>[+ List filters]</a>'+\r\n            '<a name=\"SHOW3.ctrl\" data-show3=\"ctrl\"'+(pf_ex.ctrl?' style=\"display:none\"':'')+'>[+ Control]</a>'+\r\n          '</div>'+\r\n        '</div>'+\r\n        (this.mode==='float'? '<a name=\"sticky_filter_settings\" style=\"position:absolute;right:0;top:0;display:none\">[\\u25e5]</a>':'')+\r\n        '<div style=\"clear:both\"></div>');\r\n  \r\n//  var fm = pn12_0_4;\r\n//  if (!pf_original) {\r\n  var fm = document.createElement('form'); // this will be stripped at embed_mode, because contents of pn12_1 will be replaced.\r\n  fm.name = pref.script_prefix+'_'+this.name;\r\n  fm.appendChild(pn12_0_4);\r\n//  }\r\n      pn12.childNodes[1].insertBefore(fm, pn12_1); // appendChild(pn12_0_4);\r\n      var tacks = pn12_0_4.getElementsByClassName('PLACEHOLDER');\r\n      for (var i=0;i<tacks.length;i++) cnst.set_tack_float(tacks[i].appendChild(site2[site.nickname].make_tack()).parentNode, hide_prev_float, show_prev_dock);\r\n//      var btns = pn12_0_2.getElementsByTagName('button');\r\n//      cnst.set_target_of_button(btns['settings'],pn12_0_4.childNodes[0]);\r\n//      cnst.set_target_of_button(btns['filter'],pn12_0_4.childNodes[1]);\r\n  this.pn12 = pn12;\r\n  this.pn12_0 = pn12_0;\r\n  this.pn12_1 = pn12_1;\r\n  this.pn12_0_2 = pn12_0_2;\r\n  this.pn12_0_4 = pn12_0_4;\r\n  this.board_sel = board_sel;\r\n  this.threads = {};\r\n//  this.ths_undo = {};\r\n  this.idxs = [];\r\n  this.idxs_req = new Map; // Set(); // [];\r\n  this.drawn_idx = 0;\r\n  this.threads_odl = {};\r\n  this.ppn = pn12_1;\r\n  this.ppn.classList.add(pref.script_prefix+'_'+this.view+'View');\r\n//  this.ppn.className = pref.script_prefix+'_catalog';\r\n  this.pppn = this.ppn.parentNode; // pppn!==pn12, because patched.\r\n  this.pppn_window = this.mode==='float'? this.pppn : window;\r\n  gGEH.pns_resize.set(this.pn12, this.show_catalog_resize);\r\n  var comps_0_4 = pn12_0_4.getElementsByTagName('*');\r\n  this.components = {\r\n    ordering: comps_0_4[(this.mode==='float'? 'float' : 'catalog')+'.order.ordering'],\r\n    pn12_0: pn12_0,\r\n    pn12_0_4: pn12_0_4,\r\n    pn_hi: null,\r\n    kwd_use: comps_0_4['filter.kwd.use'],\r\n    kwd_mirror: [],\r\n    time_str: comps_0_4['filter.time_str'],\r\n    tag_use: comps_0_4['filter.tag'],\r\n    attr_list: comps_0_4['filter.attr_list_str'],\r\n    watch_list: comps_0_4['filter.watch_list_str'],\r\n    ex_list: comps_0_4['filter.list_str'],\r\n    pn_filter: pn12_0_4.childNodes[1],\r\n    auto_list: comps_0_4['filter.auto_list.str'],\r\n    postFilter: comps_0_4['filter.postFilter.str'],\r\n    merge: comps_0_4[this.mode+'.merge'],\r\n    merge_list: comps_0_4[this.mode+'.merge_list'],\r\n    native_size: comps_0_4['PLACEHOLDER_NATIVE_SIZE'],\r\n    filter: pn12_0_4.childNodes[1], // these are opened by clicking the button. related by name.\r\n    settings: pn12_0_4.childNodes[0],\r\n    sticky_filter_settings: pn12_0_4.childNodes[2],\r\n    titleBar: pn12_0,\r\n  };\r\n  this.native = {};\r\n  this.triage_history = [];\r\n  this.INST = {};\r\n  this.auto_update = new AutoUpdate(this, this.health_indicator);\r\n  this.refresh_tgts = {};\r\n  this.image_resize1_onload_bound = this.image_resize1_onload.bind(this);\r\n  this.image_resize2_onload_bound = this.image_resize2_onload.bind(this);\r\n//  this.image_resize_th_onload_bound = this.image_resize_th_onload.bind(this);\r\n\r\n  this.footer = (clgs.length!=0)? Footer.factory(this.mode, this.threads, this) : (Footer.clg = this, Footer);\r\n\r\n  Tooltips.add_root(pn12_0_4);\r\n  pref_func.apply_prep(pn12_0_4.childNodes[0], false, null, null, true, this.pref);\r\n//  pref_func.apply_prep(pn12_0_4,false, null, null, true, this.pref); // redundant, moved to 'load'\r\n  cnst.auto_shrink_selector(this.components.ordering);\r\n  this.onchange_funcs = {'.':this, __proto__:onchange_funcs};\r\n//  if (clgs.length!=0) { // temporal, this can be consolidated.\r\n    pref_func.add_onchange(pn12_0_2, this.onchange_funcs, oninput_funcs);\r\n    var event_func = pref_func.add_onchange(pn12_0_4, this.onchange_funcs, oninput_funcs);\r\n//  }\r\n  if (this.mode==='float' && pref.catalog.appearance.orderOnTB) {\r\n    this.components.ordering.parentNode.removeChild(this.components.ordering.nextSibling);\r\n    this.pn12_0.childNodes[2].appendChild(this.components.ordering);\r\n  }\r\n  if (clgs.length==0) cataLog.event_func = event_func;\r\n  this.scrollTop = 0;\r\n  this.innerHeight = null;\r\n  this.pppn_window.addEventListener('scroll', this.show_catalog_scroll, false);\r\n////  if (!pref.test_mode['96'] || this.mode!=='catalog') this.pppn_window.addEventListener('resize', this.show_catalog_cont, false); // BUG, DOM ELEMENT CAN'T TAKE resize EVENT, this doesn't work // https://stackoverflow.com/questions/6492683/how-to-detect-divs-dimension-changed\r\n  if (this.mode==='float') this.ppn.addEventListener('scroll', this.show_catalog_scroll, false); // Element: scroll event is not bubbles. // https://developer.mozilla.org/en-US/docs/Web/API/Element/scroll_event\r\n\r\n//  this.filter_kwd_prep_init(null,true); // prep kwd.rexps // redundant, called in this.onchange_funcs['*.board_list_sel']\r\n  this.Setup_liveTag(pref.liveTag.NC);\r\n//  this.liveTag = (clgs.length===0)? (liveTag.clg = this, liveTag.footer = this.footer, liveTag) : liveTag.factory(this, this.footer, pref.liveTag.NC);\r\n//  this.liveTag.setup_pn(pn12_0_4, this.pref.filter.tag_search); // this, clgs.length!==0 && pref.liveTag.NC && this.footer);\r\n//  this.footer.tag_node_onclick = this.liveTag.tag_node_onclick.bind(this.liveTag);\r\n//  this.footer.liveTag = this.liveTag;\r\n//  if (this.pref!==pref && !pref.liveTag.NC) Object.defineProperty(this.pref.filter, 'tag', {get:function(){return pref.filter.tag;}, set:function(v){pref.filter.tag = v;}, configurable:true, enumerable:true});\r\n  this.merge_bases = (clgs.length===0)? site2['DEFAULT'].update_posts_merge_bases : site2['DEFAULT'].update_posts_merge_bases.factory();\r\n  this.merge_bases.view = this.view; // for site2['DEFAULT'].update_posts_merge_bases itself // REDUNDANT???\r\n  this.delayed_filter_changed = new Watchdog(this.filter_changed.bind(this),1000).get_bound_func();\r\n\r\n  this.Clgs.push(this);\r\n//  this.Clgs_pn.set(pn12,this);\r\n  this.serialNo = Clg.prototype.Clgs_count++;\r\n  if (site2[site.nickname].catalog_float_prep) site2[site.nickname].catalog_float_prep(this);\r\n\r\n  if (clgs.length==2) this.hook_set({\r\n//    set drawn_idx(v){this.Clgs.forEach(function(c){c.drawn_idx = v;});}, // temporal\r\n    footer: {\r\n//      update: function(name,flags,tags, force){ // will be discarded by test_mode['133']\r\n//        var clgs = Clg.prototype.Clgs;\r\n//        for (var i=0;i<clgs.length;i++) if (clgs[i].threads[name]) clgs[i].footer.update(name,flags,tags, force);\r\n//      },\r\n      update_force: function(name,flags,tags){\r\n        var clgs = Clg.prototype.Clgs;\r\n        for (var i=0;i<clgs.length;i++) if (clgs[i].threads[name]) clgs[i].footer.update_force(name,flags && clgs[i].pref[clgs[i].footer.mode_fmt].footer.flags,tags);\r\n      },\r\n      color_tag_node: function(name,tag, all){\r\n        var clgs = Clg.prototype.Clgs;\r\n        for (var i=0;i<clgs.length;i++) if (all || !clgs[i].NC) if (clgs[i].threads[name]) clgs[i].footer.color_tag_node(name,tag);\r\n      },\r\n      update_all_force: function(e,src, flags){ // Footer.update_all_force has 'tags' in arguments, and that is used in 'liveTag.NC' event function.\r\n        var clgs = Clg.prototype.Clgs;\r\n        for (var i=0;i<clgs.length;i++) clgs[i].footer.update_all_force(e,src, flags);\r\n      },\r\n//      refresh_start: function(){\r\n//        var clgs = Clg.prototype.Clgs;\r\n//        clgs[0].footer.refresh_start();\r\n//        for (var i=1;i<clgs.length;i++) clgs[i].footer.timestamp_set();\r\n//      },\r\n      __proto__: Footer},\r\n    show_catalog: function(tgts_in){\r\n      var clgs = Clg.prototype.Clgs;\r\n      for (var i=0;i<clgs.length;i++) {\r\n        var clg = clgs[i];\r\n        if (!tgts_in) clg.show_catalog();\r\n        else if (typeof(tgts_in)==='string') {if (clg.threads[tgts_in]) clg.show_catalog(tgts_in);}\r\n        else {\r\n          var tgts = {};\r\n          var flag = false;\r\n          for (var t in tgts_in) if (clg.threads[t]) {tgts[t] = null; flag = true;}\r\n          if (flag) clg.show_catalog(tgts);\r\n        }\r\n      }\r\n    },\r\n//    remove_thread: function(name, pn_only, keep){\r\n//      var clgs = Clg.prototype.Clgs;\r\n//      var removed = false;\r\n//      for (var i=0;i<clgs.length;i++) removed |= clgs[i].remove_thread(name, pn_only, keep, true) && !keep;\r\n//      if (removed) gClg.Maintain_AllThreads(name);\r\n//    },\r\n    filter_changed: function(){\r\n      var clgs = Clg.prototype.Clgs;\r\n      for (var i=0;i<clgs.length;i++) clgs[i].filter_changed();\r\n    },\r\n    __proto__:Clg.prototype});\r\n\r\n  if (clgs.length===1) cataLog.auto_update = this.auto_update;\r\n  if (site.whereami!=='archive') this.auto_update.set();\r\n\r\n  if (pref.test_mode['160'] && clgs.length===1) site2[site.nickname].catalog_native_prep(this.pn12_0_4,this.pn12_0, this.health_indicator.pn2, this);\r\n  if (clgs.length>=2) this.onchange_funcs['*.board_list_sel'](null,true, pref[this.mode].env.refresh_initial); // invoke all, call from clgs[0] is left later for safty.\r\n  if (Clg.prototype.Clgs_count!==1 && clgs.length===1) reentry_0_patch(this);\r\n  this.show_catalog_scroll_lock = this.show_catalog_scroll_lock_factory(this);\r\n\r\n};\r\n      \r\n      Clg.prototype = {\r\n        onrolldown: function(){var val_old = this.rolledup; this.rolledup = 0; if (val_old>1) this.show_catalog(0);},\r\n        onrollup: function(){this.rolledup++;},\r\n        Clgs: [],\r\n        AllThreads: null, // contains tgt_th(s) which have the most numbers of posts to show.\r\n        UnsyncedTriages: {}, // unsynced triages; catalog data is delayed from thread sometimes, triage through pipe may hit this in 4chan.\r\n        destroy: function(e){\r\n          var pn12 = e.currentTarget.parentNode;\r\n          cnst.div_destroy(e.currentTarget.parentNode, true);\r\n          var idx = Clg.prototype.Clgs.map(function(v){return v.pn12;}).indexOf(pn12);\r\n          var clg = Clg.prototype.Clgs.splice(idx,1)[0];\r\n          if (pref.catalog.auto_save_filter) clg.onchange_funcs.save();\r\n          for (var name in clg.threads) clg.remove_thread(name);\r\n          clg.auto_update.stop_if_running();\r\n          clg.footer.liveTag = null; // cut reference loop.\r\n          clg.footer = null; // cut reference loop.\r\n          clg.liveTag = null; // cut reference loop.\r\n          clg.auto_update = null; // cut reference loop.\r\n          clg.pppn_window.removeEventListener('scroll', clg.show_catalog_scroll, false);\r\n          clg.pppn_window.removeEventListener('resize', clg.show_catalog_resize, false);\r\n          if (clg.mode==='float') clg.ppn.removeEventListener('scroll', clg.show_catalog_scroll, false);\r\n          clg.GEH.destroy();\r\n          if (Clg.prototype.Clgs.length==1) Clg.prototype.hook_set(Clg.prototype.Clgs[0]);\r\n        },\r\n        hook_set: function(clg){\r\n          gClg = clg;\r\n          cataLog.Footer = clg.footer;\r\n          show_catalog = clg.show_catalog.bind(clg);\r\n          cataLog.show_catalog = show_catalog;\r\n          cataLog.gClg = gClg;\r\n          if (Clg.prototype.Clgs.length==1) pClg = clg;\r\n          Clg.prototype.AllThreads = (Clg.prototype.Clgs.length==1)? pClg.threads : common_func.shallow_copy_1(pClg.threads);\r\n        },\r\n//        Clgs_pn: new WeakMap(),\r\n//        get_clg_recursive: function(pn){\r\n//          var clg;\r\n//          while (pn && !(clg=this.Clgs_pn.get(pn))) pn = pn.parentNode;\r\n//          return clg;\r\n//        },\r\n        Clgs_count: 0,\r\n//        ppn2clg: function(ppn){\r\n//          var i=0;\r\n//          while (i<this.Clgs.length && this.Clgs[i].ppn!==ppn) i++;\r\n//          return this.Clgs[i];\r\n//        },\r\n        BroadcastEventByMode: function(mode, func, argsObj){\r\n          var clgs = mode==='proto'? this.Clgs : this.Clgs.filter(function(v){return v.mode===mode;});\r\n          for (var i=0;i<clgs.length;i++) func.apply({'.':clgs[i], __proto__:this.onchange_funcs},argsObj); // don't use arguemnts.callee for strict mode\r\n        },\r\n        onchange_funcs: onchange_funcs,\r\n//        SearchFirstClg: function(mode){\r\n//          for (var i=0;i<this.Clgs.length;i++) if (this.Clgs[i].mode===mode) return this.Clgs[i];\r\n//        },\r\n//        Mark_missing_info: function(name, lvl){ // working code\r\n//          var clgs = Clg.prototype.Clgs;\r\n//          for (var i=0;i<clgs.length;i++) if (clgs[i].threads[name])\r\n//            clgs[i].threads[name][16].missing_info = lvl;\r\n//        },\r\n        Setup_liveTag: function(NC, reentry){\r\n          this.liveTag = (this.Clgs.length===0)? (liveTag.clg = this, liveTag.footer = this.footer, liveTag) : liveTag.factory(this, this.footer, NC);\r\n          this.liveTag.setup_pn(this.components.pn_filter, this.pref.filter.tag_search); // this, clgs.length!==0 && pref.liveTag.NC && this.footer);\r\n//          this.footer.tag_node_onclick = this.liveTag.tag_node_onclick.bind(this.liveTag);\r\n          this.footer.liveTag = this.liveTag;\r\n          if (this.pref!==pref) {\r\n            if (!NC) Object.defineProperty(this.pref.filter, 'tag', {get:function(){return pref.filter.tag;}, set:function(v){pref.filter.tag = v;}, configurable:true, enumerable:true});\r\n            else if (reentry) {\r\n              delete this.pref.filter['tag'];\r\n              this.pref.filter.tag = false;\r\n            }\r\n            this.components.tag_use.checked = this.pref.filter.tag;\r\n          }\r\n        },\r\n        Maintain_AllThreads: function(name){\r\n          if (this.Clgs.length==1) return;\r\n          var clgs = this.Clgs.filter(function(v){return v.threads[name];});\r\n          if (clgs.length===0) delete gClg.AllThreads[name];\r\n          else {\r\n            var tgt_th = clgs[0].threads[name];\r\n            if (clgs.length>=2) {\r\n              var sels = clgs.map(function(v){return v.threads[name][16].t2h_sel || pref[embed_mode].t2h_sel;});\r\n              var i=1;\r\n              while (i<clgs.length) if (sels[0]==sels[i]) i++; else break;\r\n              var variety = i!=clgs.length;\r\n            }\r\n            gClg.AllThreads[name] = (!variety)? tgt_th : {16:{t2h_sel:'ALL', __proto__:tgt_th[16]},__proto__:tgt_th};\r\n          }\r\n        },\r\n//        Maintain_AllThreads: function(name){ // working code\r\n//          if (this.Clgs.length==1) return;\r\n//          var pf_store = (pref[embed_mode].storePosts==='ALL_agg' || pref[embed_mode].storePosts==='auto' && pref4.search_posts_active_once)? 'ALL' : pref[embed_mode].deleted_posts.detect; // the same code is in callback2\r\n//          var ary = this.Clgs.map(function(v){return !v.threads[name]? null : scan_boards.get_nof_store_posts(pf_store, v.threads[name]);});\r\n//          var ary2 = ary.filter(function(v){return v!==null;});\r\n//          if (ary2.length===0) delete gClg.AllThreads[name];\r\n//          else {\r\n//            var tgt_th = this.Clgs[ary.indexOf(ary2[0])].threads[name];\r\n//            var variety = ary2.length>=2 && ary2.filter(function(v){return v!=ary2[0];}).length>=2;\r\n//            gClg.AllThreads[name] = (!variety)? tgt_th : {16:{t2h_sel:'ALL', __proto__:tgt_th[16]},__proto__:tgt_th};\r\n//          }\r\n//        },\r\n        Sync_watch_load: function(e, from_modify, from_pruned){\r\n          if (pref.common.consolidated_watch_list && pref.common.sync_watch_list) {\r\n            if (pref.debug_mode['1']) console.log('LocalStorage: '+e.key+': '+(e.newValue && e.newValue.length>120? e.newValue.slice(0,100)+'...':e.newValue));\r\n            if (e.key===pref.script_prefix+'.WatchList' || from_modify || from_pruned) {\r\n              for (var i=0;i<gClg.Clgs.length;i++) {\r\n                var clg = gClg.Clgs[i];\r\n                if (clg.pref.filter.watch_list_str === e.newValue) continue;\r\n                if (pref.debug_mode['37']) {\r\n                  var olds = clg.pref.filter.watch_list_str.split('\\n').reduce(function(a,c){a[c]=null;return a;},{});\r\n                  var news = e.newValue.split('\\n').reduce(function(a,c){if (c in olds) delete olds[c]; else a[c]=null; return a;},{});\r\n                  console.log('changed: '+Object.keys(olds)+' -> '+Object.keys(news));\r\n                }\r\n                clg.pref.filter.watch_list_str = e.newValue || '';\r\n                pref_func.apply_prep(clg.components.watch_list,false, null, null, true, clg.pref);\r\n                if (!from_pruned) clg.onchange_funcs['filter.watch_list_str'](null, true);\r\n              }\r\n            } else if (e.key===pref.script_prefix+'.WatchListCmd') {\r\n              var args = JSON.parse(e.newValue);\r\n              if (!args) return;\r\n              if (args[1]==='PRUNED') {gClg.Sync_watch_load({newValue:args[2]}, null, true); return;}\r\n              if (typeof(args[1])==='string') gClg.Sync_watch_load_cmd_1(args);\r\n              else for (var i=0;i<args.length;i++) gClg.Sync_watch_load_cmd_1(args[i]);\r\n//              if (args[1]==='UNWATCH' && !gClg.AllThreads[args[0]]) return;\r\n//              var dbt = common_func.fullname2dbt(args[0]);\r\n//              if (!liveTag.mems[dbt[0]] || !liveTag.mems[dbt[0]][dbt[1]] || !liveTag.mems[dbt[0]][dbt[1]][dbt[2]] || !gClg.AllThreads[args[0]]) {\r\n//                args[5] = true;\r\n//                gClg.triage_exe_broadcast.apply(gClg,args);\r\n//              } else triage_exe_pipe(args, true);\r\n            }\r\n          }\r\n        },\r\n        Sync_watch_load_cmd_1: function(args){\r\n          if (args[1]==='UNWATCH' && !gClg.AllThreads[args[0]]) return;\r\n          var dbt = common_func.fullname2dbt(args[0]);\r\n          if (!liveTag.mems[dbt[0]] || !liveTag.mems[dbt[0]][dbt[1]] || !liveTag.mems[dbt[0]][dbt[1]][dbt[2]] || !gClg.AllThreads[args[0]]) {\r\n            args[5] = true;\r\n            gClg.triage_exe_broadcast.apply(gClg,args);\r\n          } else triage_exe_pipe(args, true);\r\n        },\r\n        Sync_watch_save: function(args, merged_broadcast){\r\n          if (merged_broadcast) {\r\n            this.Sync_watch_save_merged.push(args);\r\n            return;\r\n          }\r\n//          pClg.onchange_funcs['save_watch_list']();\r\n          var data = this.Sync_watch_save_merged.length!=0 && this.Sync_watch_save_merged.concat([args]) || args.concat(Date.now());\r\n          if (localStorage) localStorage.setItem(pref.script_prefix + '.WatchListCmd', JSON.stringify(data)); // timestamp for force update\r\n          this.Sync_watch_save_merged = [];\r\n        },\r\n        Sync_watch_save_merged: [],\r\n//        Sync_watch_save: (function(){\r\n//          var args;\r\n//          var save_delayed = DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(function(){\r\n//            pClg.onchange_funcs['save_watch_list']();\r\n//            if (args) {\r\n//              if (localStorage) localStorage.setItem(pref.script_prefix + '.WatchListCmd', JSON.stringify(args.concat(Date.now()))); // timestamp for force update\r\n//              args = null;\r\n//            }\r\n//          },100));\r\n//          return function(args_in){\r\n//            args = args_in;\r\n//            save_delayed(pref.common.sync_watch_list_delay);\r\n//          };\r\n//        })(),\r\n        jump_to_post: function(dbtp){\r\n          var name = dbtp[0]+dbtp[1]+dbtp[2];\r\n          var posts = this.threads[name] && this.threads[name][1] && this.threads[name][16].posts;\r\n          if (posts) {\r\n            for (var i=posts.length-1;i>=0;i--) if (posts[i].no==dbtp[3]) break; // dbtp[3] is string\r\n            if (i>=0) window.scrollTo(0,posts[i].pn.offsetTop);\r\n            return posts[i].pn;\r\n          }\r\n        },\r\n        image_resize: function(pn,fst){\r\n          var pf = (pf = this.pref[this.mode].format.thumb, pf[pf.size]);\r\n          this.image_resize_1(pn, fst? pf.w1 : pf.w2, fst? pf.h1 : pf.h2);\r\n        },\r\n        image_resize_1: function(pn,w,h){\r\n          var nw = pn.naturalWidth;\r\n          var nh = pn.naturalHeight;\r\n          var fw = nw/w; // (nw>w)? nw/w : 1;\r\n          var fh = nh/h; // (nh>h)? nh/h : 1;\r\n          var f = fw>fh? fw : fh;\r\n  //      if (fh>1 || fw>1) {\r\n            pn.setAttribute('width', nw/f);\r\n            pn.setAttribute('height',nh/f);\r\n  //      }\r\n  ////        var f  = (fw>fh)? fw : fh;\r\n  ////        pn.setAttribute('width',  nw/f);\r\n  ////        pn.setAttribute('height', nh/f);\r\n        },\r\n        image_resize_onload_add: function(imgs){\r\n          for (var i=0;i<imgs.length;i++) this.image_resize_img(imgs[i], i==0);\r\n        },\r\n        image_resize_img: function(img, first){\r\n          if (img.complete) {\r\n            this.image_resize(img, first);\r\n            if (img.onload) img.onload = null;\r\n          } else img.onload = (first)? this.image_resize1_onload_bound : this.image_resize2_onload_bound; // overwrite for racing condition of merging at start up\r\n//          } else img.addEventListener('load',(i==0)? this.image_resize1_onload_bound : this.image_resize2_onload_bound, false);\r\n        },\r\n        image_resize_all: function(size){\r\n          this.pref[this.mode].format.thumb.size = size;\r\n          for (var name in this.threads) if (this.threads[name][0]) this.image_resize_th(this.threads[name][0]);\r\n//          for (var name in this.threads) if (this.threads[name][0]) {\r\n//            var imgs = site2[site.nickname].parse_funcs[this.mode+'_html'].tn_imgs({pn:this.threads[name][0]});\r\n//            for (var i=0;i<imgs.length;i++) this.image_resize(imgs[i], i===0);\r\n//          }\r\n        },\r\n        image_resize_th: function(pn){\r\n          var imgs = site2[site.nickname].parse_funcs[this.view+'_html'].tn_imgs({pn:pn}); // must be this.view instead of this.mode, because floating catalog can change view, and catalog on catalog may call parse_funcs['headline_html].tn_imgs, but undefined.\r\n          this.image_resize_onload_add(imgs);\r\n//          for (var i=0;i<imgs.length;i++) this.image_resize(imgs[i], i===0);\r\n        },\r\n//        image_resize_th_onload: function(e){\r\n//          e.currentTarget.removeEventListener('load',this.image_resize_th_onload_bound,false);\r\n//          this.image_resize_th(e.currentTarget);\r\n//        },\r\n        image_resize1_onload: function(e){\r\n          e.currentTarget.onload = null;\r\n//          e.currentTarget.removeEventListener('load',this.image_resize1_onload_bound,false);\r\n          this.image_resize(e.target, true);\r\n        },\r\n        image_resize2_onload: function(e){\r\n          e.currentTarget.onload = null;\r\n//          e.currentTarget.removeEventListener('load',this.image_resize2_onload_bound,false);\r\n          this.image_resize(e.target, false);\r\n        },\r\n        kwd_clear: function(){\r\n          var pn = pClg.components.kwd_mirror[1]; // pClg is hard-coded for event input\r\n          pn.value = '';\r\n          pn.oninput({target:pn,currentTarget:pn});\r\n        },\r\n        kwd_init: function(search, pn_filter, force_clear){\r\n          var search2;\r\n          if (this.components.kwd_mirror.length==0) { // for multientry in meguca.\r\n            search2 = search.cloneNode(false);\r\n            search2.name = 'filter.kwd.str';\r\n            search2.oninput = cataLog.event_func;\r\n            this.components.kwd_mirror = [pn_filter.getElementsByTagName('input')['filter.kwd.str'], search2];\r\n          } else search2 = this.components.kwd_mirror[1];\r\n          search.setAttribute('style','display:none');\r\n          search.parentNode.insertBefore(search2,search.nextSibling);\r\nif (force_clear || site.nickname==='meguca') this.kwd_clear(); // just NOT tested in meguca\r\n          return search2;\r\n        },\r\n        filter_kwd_prep_init: function(e, init) {\r\n          var kwd = this.pref.filter.kwd;\r\n          kwd.str_old = '';\r\n          kwd.fail_list = {};\r\n          kwd.suc_list  = {};\r\n          this.filter_kwd_prep(e, init);\r\n        },\r\n        filter_kwd_prep: function(e, init) {\r\n          var kwd = this.pref.filter.kwd;\r\n          kwd.rexps = common_func.kwd_prep_regexp(kwd);\r\n  //        kwd.timestamp = Date.now(); // not saved because pref.default() don't geenrate this.\r\n          this.filter_kwd_active(e, init);\r\n        },\r\n        filter_kwd_count: 0,\r\n        filter_kwd_active: function(e, init) {\r\n          var kwd = this.pref.filter.kwd;\r\n          var val_old = kwd.posts_active;\r\n          var basic_active = kwd.use && kwd.rexps && (kwd.sub || kwd.name || kwd.com || kwd.file || kwd.meta || kwd.trip || kwd.id || kwd.id2 || kwd.flag);\r\n          kwd.active       = basic_active && (kwd.op || kwd.post);\r\n          kwd.posts_active = basic_active &&            kwd.post;\r\n          if (kwd.posts_active && !val_old && (e && e.target.name==='filter.kwd.post' || !pref4.search_posts_active_once)) {\r\n            if (pref[this.mode].searchAs) this.onchange_funcs.scanBoard(e, true, true);\r\n            if (pref[this.mode].searchAsA) this.onchange_funcs.scanSite(e, true, true);\r\n            pref4.search_posts_active_once |= kwd.posts_active;\r\n          }\r\n          if (!init && !kwd.posts_active && val_old) format_html.posts_search_inactivated();\r\n          kwd.timestamp = this.filter_kwd_count++; // not saved because pref.default() don't geenrate this. // use single entity for multi catalog or switching pref.*.filter object.\r\n  if (!pref.test_mode['59']) {\r\n          if (e && e.target.name==='filter.kwd.str' && kwd.match===0 && !kwd.ew && (!kwd.re || /^[\\w\\s]*$/.test(kwd.str+kwd.str_old))) {\r\n            for (var i in kwd.fail_list) {\r\n              if (kwd.str.indexOf(kwd.fail_list[i])!==0) delete kwd.fail_list[i];\r\n              else if (kwd.fail_list[i]===kwd.str) kwd.timestamp = i;\r\n            }\r\n            for (var i in kwd.suc_list) {\r\n              if (kwd.suc_list[i].indexOf(kwd.str)!==0) delete kwd.suc_list[i];\r\n              else if (kwd.suc_list[i]===kwd.str) kwd.timestamp = i;\r\n            }\r\n          } else {\r\n            kwd.fail_list = {};\r\n            kwd.suc_list  = {};\r\n          }\r\n          if (kwd.str) {\r\n            kwd.fail_list[kwd.timestamp] = kwd.str;\r\n            kwd.suc_list[kwd.timestamp]  = kwd.str;\r\n          }\r\n  }\r\n          var delay = kwd.posts_active && (kwd.str.length < pref[this.view].env.kwd_filter_delay_len) && pref[this.view].env.kwd_filter_delay;\r\n          if (!init) if (delay) this.delayed_filter_changed(delay); else this.filter_changed();\r\n        },\r\n        filter_changed: function(){\r\n//if (pref.test_mode['60']) {        \r\n//        if (pref.filter.kwd.use || pref.filter.tag || pref.filter.time || pref.filter.list) for (var th in threads) threads[th][9] = catalog_filter_query(th);\r\n//        else {\r\n////          for (var th in threads) threads[th][9] = [true];\r\n//          for (var th in threads) threads[th][9][0] = true;\r\n//          gClg.drawn_idx = 0;\r\n//        }\r\n//} else {\r\n          var pf = this.pref.filter;\r\n          var val = (pf.kwd.use || pf.tag || pf.time || pf.list)? null : true;\r\n          for (var th in this.threads) this.threads[th][9][0] = val;\r\n//        this.drawn_idx = 0;\r\n//}  \r\n          if (show_catalog) this.show_catalog(0); // 'if (show_catalog)' is a patch.\r\n//console.log('filter_changed');\r\n//        catalog_refresh_gather_info(); // cut at 2015.05.15.\r\n        },\r\n        FilterChanged: function(){\r\n          for (var i=0;i<this.Clgs.length;i++) this.Clgs[i].filter_changed();\r\n        },\r\n        format_refresh_tgts: function(){\r\n          if (Array.isArray(this.refresh_tgts)) {\r\n            var refresh_tgts = {};\r\n            for (var j=0;j<this.refresh_tgts.length;j++) refresh_tgts[this.refresh_tgts[j].replace(/\\/[cjpqt][0-9]+$/,'/')] = null;\r\n            this.refresh_tgts = refresh_tgts;\r\n          }\r\n        },\r\n        IDB_req: {},\r\n        remake_html_prep: function(tgt_th, keep_html_key){\r\n          if (!keep_html_key) {\r\n            var lth = tgt_th[16].lth;\r\n            tgt_th[0] = false;\r\n            tgt_th[16].th = (lth.ta)? {pn:null, __proto__:lth.ta.posts[0], posts:lth.ta.posts} : {pn:null, __proto__:tgt_th[16].lth.th}; // lth.ta is updated without synchronizing with lth.th, but 'recent_posts' uses lth.ta.posts in insert_thread_prepare_html_lazy\r\n//            if (th.type_data==='html') cataLog.format_html.prepare_html_extract_params(lth.ta? lth.ta.posts[0] : tgt_th[16].lth.th); // for 4chan catalog_html // doesn't work because th.pn was already destroyed.\r\n//            tgt_th[16].th = {pn:null, __proto__:tgt_th[16].lth.th};\r\n            tgt_th[16].posts = null;\r\n          } else gGEH.pns_all_keys.set(tgt_th[0],keep_html_key);\r\n          if (tgt_th[16].icon_sticky) delete tgt_th[16].icon_sticky;\r\n          if (tgt_th[16].icon_show_always) delete tgt_th[16].icon_show_always;\r\n          if (tgt_th[16].pn_summary) delete tgt_th[16].pn_summary;\r\n        },\r\n        remove_thread: function(name, pn_only, from_gClg){ // , no_reorder){\r\n          var tgt_th = this.threads[name];\r\n//          if (keep) {\r\n//            if (tgt_th && tgt_th[14]!=='IDB' && tgt_th[14]!=='FILE') {\r\n//              if (tgt_th[14]!=='x') {\r\n//                tgt_th[14]='x';\r\n//                this.footer.update_force(name);\r\n//              }\r\n//            }\r\n//            return;\r\n//          }\r\n          if (name.substr(0,4)!==':DL:') {\r\n            if (!tgt_th) return;\r\n            var lth = liveTag.mems.getFromName(name);\r\n            if (!pn_only) if (lth.q) site2[lth.domain].popups_release_all_not_exist(lth); // remove cross thread/board links.\r\n//            remove_threads_events(name); // must NOT use test_mode['104']\r\n            if (tgt_th[1]) {\r\n//              if (pop_up_status[name]) pop_down_op(name); // must NOT use test_mode['110']\r\n              if (tgt_th[0] && tgt_th[0].parentNode===this.ppn) if (this.func_hide(name)) tgt_th[1] = false; // parent check is for on_demand_draw // calls idx_reorder and changes order of idxs here\r\n//              if (!no_reorder) {\r\n//                var ref = this.idxs.indexOf(name); // consumes 400ms in 2ch at initial if this is evaluated always.\r\n//                if (ref<this.drawn_idx) this.drawn_idx = 0;\r\n//              }\r\n            }\r\n            this.merge_bases.remove_th(name, tgt_th, this); // calls idx_reorder and changes order of idxs here <- ,but changed???\r\n          }\r\n          if (pn_only) {\r\n            tgt_th[0] = false;\r\n            tgt_th[1] = false;\r\n            tgt_th[16].th = tgt_th[7];\r\n            tgt_th[16].posts = null;\r\n  //          if (!tgt_th[16].th) tgt_th[16].th = tgt_th[16];\r\n            if (tgt_th[24]) tgt_th[24][0] = null;\r\n            return;\r\n          }\r\n          delete this.threads[name]; // remove ':DL:' also\r\n          if (pref.debug_mode['2']) console.log('removed: '+name);\r\n  //        for (var i=this.idxs.length-1;i>=0;i--) if (threads_idx[i]===name) {this.idxs.splice(i,1);break;}\r\n          this.idx_remove(name);\r\n//          if (ref===undefined || this.idxs[ref]!==name) ref = this.idxs.indexOf(name); // func_hide and remove_th may call idx_reorder and change order of this.idxs, so ref must be re-set.\r\n//          if (ref>=0) this.idxs.splice(ref,1);\r\n          if (pref.test_mode['95'] && site.nickname==='dist') site2[site.nickname].testPoster(name);\r\n          if (!from_gClg && tgt_th) gClg.Maintain_AllThreads(name);\r\n          return tgt_th;\r\n        },\r\n        get_latest_time_of_a_thread: function(name){\r\n          var tgt_th8 = this.threads[name][8];\r\n          return (tgt_th8[0]>tgt_th8[4])? tgt_th8[0] : (tgt_th8[4] || tgt_th8[0]);\r\n        },\r\n        clear_threads: function(num, schedule){\r\n          if (schedule && this.INST.threads_candidates_of_deletion) {\r\n            for (var name in this.INST.threads_candidates_of_deletion)\r\n              if (this.threads[name] && this.INST.threads_candidates_of_deletion[name]===this.get_latest_time_of_a_thread(name)) this.remove_thread(name);\r\n            this.INST.threads_candidates_of_deletion = null;\r\n          }\r\n          var idx = 0;\r\n          while (idx<this.idxs.length && idx<num) if (this.idxs[idx++].substr(0,4)===':DL:') num++;\r\n          var tgts = {};\r\n          this.idxs.slice(num).forEach(function(name){\r\n            if (name.substr(0,4)===':DL:' || !schedule) this.remove_thread(name);\r\n            else tgts[name] = this.get_latest_time_of_a_thread(name);\r\n          },this);\r\n          if (Object.keys(tgts).length>0) this.INST.threads_candidates_of_deletion = tgts;\r\n//          if (schedule) {if (this.INST.threads_candidates_of_deletion===null) this.INST.threads_candidates_of_deletion = {};} // working code\r\n////          else if (pref.test_mode['127']) triage.off_delay();\r\n//          while (this.idxs.length>num) {\r\n//            var name = this.idxs[num];\r\n//            if (name.substr(0,4)===':DL:' || !schedule) this.remove_thread(name);\r\n//            else {\r\n//              this.INST.threads_candidates_of_deletion[name] = this.get_latest_time_of_a_thread(name);\r\n//              num++;\r\n//            }\r\n//          }\r\n        },\r\n        show_catalog_scroll_lock_factory: function(clg){\r\n          var marks = null;\r\n  //        var set = Watchdog.prototype.restart.bind(new Watchdog(scroll_back, 5));\r\n          var wdg  = new Watchdog(scroll_back, 5);\r\n          var wdg2 = new Watchdog(tgt_lock_cancel, 100); // 500ms scroll lock and watchdog for oscillation.\r\n          var set = Watchdog.prototype.restart.bind(wdg);\r\n          function tgt_lock_cancel(){\r\n            wdg.cancel();\r\n            marks = null;\r\n          }\r\n          function scroll_back(){\r\n//            if (typeof(marks)==='number') {\r\n//              var marked_first_post = site2[site.nickname].mark_newer_posts2(clg.merge_bases.bases[site.key].posts, marks, pref.thread_reader.unmark_on_hover, true) || null;\r\n//              if (marked_first_post) scrollTo(0,marked_first_post.offsetTop - site.header_height());\r\n//              else scrollTo(0,document.body.clientHeight - window.innerHeight); // to the last\r\n//              return;\r\n//            }\r\n            var mark_top = marks[0].offsetTop || 0;\r\n            var abs_top = mark_top - marks[1] + marks[2];\r\n            if (abs_top<0) abs_top = 0;\r\n            if (!mark_top || clg.get_now_height()===abs_top) { // may cause oscillation\r\n  //            marks = null;\r\n  //             wdg2.stop(); // scroll lock\r\n              return;\r\n            }\r\n            window.scrollTo(0, abs_top);\r\n            set();\r\n          }\r\n          var last_viewed = null;\r\n          function start(pn){\r\n            if (marks===null || pn) {\r\n  //            if (marks && pn) scroll_back();\r\n              if (!pn) pn = (wdg2.id)? last_viewed : // scroll locked\r\n                            clg.GEH.get_last_viewed() || last_viewed; // return null when initial or deleted\r\n              if (pn) {\r\n                marks = [pn, pn.offsetTop, clg.get_now_height()];\r\n                last_viewed = pn;\r\n//              } else {if (gGEH.time_jumped) marks = gGEH.time_jumped;}\r\n              } else return;\r\n  ////            if (last_viewed) { // working code.\r\n  ////              marks = [last_viewed, last_viewed.offsetTop, get_now_height()];\r\n  ////              set();\r\n  ////            }\r\n  //            var now_height = get_now_height();\r\n  //            var last_top; // working code.\r\n  //            if (last_viewed) last_top = last_viewed.offsetTop;\r\n  //            if (last_viewed && last_top >= now_height && last_top <= now_height + window.innerHeight) marks = [last_viewed, last_top, now_height];\r\n  //            else { // scrolled\r\n  //              var posts = (embed_mode==='thread')? site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'thread_html', {thread:site.no})[0].posts :\r\n  //                                                   site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'page_html', {page:0})[0].posts;\r\n  //              var step = posts.length >> 1;\r\n  //              var i = 0;\r\n  //              while (step>0) {\r\n  //                if (posts[i+step].pn.offsetTop<now_height) i += step;\r\n  //                step >>= 1;\r\n  //              }\r\n  //              while (i<posts.length-1 && posts[i].pn.offsetTop<now_height) i++;\r\n  //              marks = [posts[i].pn, posts[i].pn.offsetTop, now_height];\r\n  //            }\r\n            }\r\n            wdg2.restart();\r\n            set();\r\n          }\r\n          return {\r\n            modified: function(tgt){\r\n  //            start((tgt.pn && marks[0]===tgt.pn)? site2[site.nickname].general_event_handler[site.whereami].get_prev_mark(tgt.pn) : null); // fail if get_prev_mark returns undefined;\r\n              if (tgt.pn && marks && marks[0]===tgt.pn) {\r\n                scroll_back();\r\n                marks = null; // get_prev_mark may return undefined\r\n  //              start(site2[site.nickname].general_event_handler[site.whereami].get_prev_mark(tgt.pn));\r\n                start(site2[site.nickname].general_event_handler[site.whereami].get_mark_from_height(tgt.pn.offsetTop));\r\n                clg.GEH.clear_last_viewed();\r\n              } else start();\r\n            },\r\n            set: start,\r\n  //          viewed: function(tgt){if (!marks) last_viewed = tgt;},\r\n  //          viewed: function(tgt){\r\n  //            if (!wdg2.id)\r\n  //              last_viewed = tgt;}, // scroll lock\r\n          }\r\n        },\r\n        get_now_height: function(){\r\n          return (this.mode!=='float')? brwsr.document_body.scrollTop : this.ppn.scrollTop;\r\n        },\r\n        get_ref_height: function(threshold){\r\n//        if (!threshold) threshold = 1.5;\r\n//        return (embed_embed)? brwsr.document_body.scrollTop + window.innerHeight * threshold // slow.\r\n//                            : triage_parent.scrollTop + triage_parent.clientHeight * threshold;\r\n          if (this.innerHeight===null) {\r\n            this.scrollTop = this.mode==='float'? this.pppn.scrollTop + this.pppn.offsetTop : brwsr.document_body.scrollTop; // this causes inconsistency of this.drawn_y at this.mode==='float', but OK, because embed<->float change invokes 'show_catalog_delayed' and recalculate this.scrollTop always.\r\n            this.innerHeight = this.mode==='float'? (parseInt(this.pppn.style.height,10) || null) : window.innerHeight; // for auto\r\n//            this.innerHeight = this.mode==='float'? this.pppn.clientHeight : window.innerHeight;\r\n          }\r\n          return (this.innerHeight===null)? NaN : this.scrollTop + this.innerHeight * threshold;\r\n        },\r\n        show_catalog_delayed: function(){\r\n          if (this.drawn_idx!==true) this.show_catalog();\r\n          else if (this.func_lazy_draw) this.func_lazy_draw();\r\n          if (this===pClg) { // patch\r\n            cataLog.DIH.expand_thumbnail_on_demand_kick();\r\n          }\r\n        },\r\n        show_catalog_scroll: function(e){\r\n          var y_new = e.currentTarget.scrollTop || window.scrollY;\r\n          var y_old = this.scrollTop;\r\n          this.scrollTop = y_new;\r\n          if (y_old<y_new) this.show_catalog_cont();\r\n        },\r\n        show_catalog_resize: function(e){\r\n          this.innerHeight = null;\r\n          this.show_catalog_cont();\r\n        },\r\n        Show_catalog_buf: (function(){\r\n          var Buf = function(clg){\r\n            this.clg = clg;\r\n            this.db = new DelayBuffer(this.do.bind(this), 10);\r\n            this.reset();\r\n          };\r\n          Buf.prototype = {\r\n            do: function(){\r\n              this.clg.show_catalog(this.tgts, this.arg1, this.arg2);\r\n              this.reset();\r\n            },\r\n            reset: function(){\r\n              this.tgts = {};\r\n              this.arg1 = false;\r\n              this.arg2 = false;\r\n            },\r\n            queue: function(name, arg1, arg2){\r\n              if (typeof(name)==='string') this.tgts[name] = null;\r\n              else for (var i in name) this.tgts[i] = null;\r\n              this.arg1 = this.arg1 || arg1; // ||= from chrome85\r\n              this.arg2 = this.arg2 || arg2;\r\n              this.db.delayed_do();\r\n            },\r\n          };\r\n          return function(clg){\r\n            return Buf.prototype.queue.bind(new Buf(clg));\r\n          };\r\n        })(),\r\n      };\r\n      pClg = new Clg(embed_embed, embed_mode); // primary catalog\r\n      var pn12 = pClg.pn12;\r\n      var pn12_0 = pClg.pn12_0;\r\n      var pn12_1 = pClg.pn12_1;\r\n      var pn12_0_2 = pClg.pn12_0_2;\r\n      var pn12_0_4 = pClg.pn12_0_4;\r\n      var board_sel = pClg.board_sel;\r\n      var threads = pClg.threads;\r\n      Footer.threads = pClg.threads;\r\n      cataLog.threads = threads;\r\n//      var threads_idx = pClg.idxs;\r\n//      var pop_up_status = {};\r\n//  Object.defineProperty(pClg,'idxs',{get:function(){return threads_idx;}, set:function(v){threads_idx = v;}}); // temporarily patch\r\n//  Object.defineProperty(pClg,'order',{get:function(){return pref.catalog.order;}}); // temporarily patch\r\n//  Object.defineProperty(pClg,'drawn_idx',{get:function(){return this.catalog_obj2.drawn_idx;}, set:function(v){this.catalog_obj2.drawn_idx = v;}}); // temporarily patch\r\n  Object.defineProperty(pClg,'ppn',{get:function(){return triage_parent;}, set:function(v){triage_parent = v;}}); // temporarily patch\r\n      gClg = pClg;\r\n      cataLog.gClg = gClg;\r\n      cataLog.get_ref_height = pClg.get_ref_height;\r\n      Clg.prototype.AllThreads = pClg.threads;\r\n\r\n      function reentry_0_patch(clg){\r\n        cataLog.gClg = gClg = pClg = clg;\r\n        clg.threads = threads;\r\n//  Object.defineProperty(pClg,'idxs',{get:function(){return threads_idx;}, set:function(v){threads_idx = v;}}); // temporarily patch\r\n        cataLog.get_ref_height = pClg.get_ref_height;\r\n        Clg.prototype.AllThreads = pClg.threads;\r\n        for (var i in threads) delete threads[i][1];\r\n        while (clg.idxs.length!=0) clg.idxs.shift();\r\n        clg.onchange_funcs['*.board_list_sel'](null,true, true);\r\n      }\r\n\r\n      function hide_prev_float(e){\r\n        cnst.tack_float_nSblgs(e, true);\r\n//        site.script_body.appendChild(e.currentTarget.nextSibling);\r\n        e.currentTarget.previousSibling.style.display = 'none'; // must be AFTER float not to change offsetLeft.\r\n      }\r\n      function show_prev_dock(e){\r\n        var tack = cnst.tack_dock_e2tack(e);\r\n//        tack.parentNode.insertBefore(e.currentTarget.parentNode,tack);\r\n        tack.previousSibling.style.display = null;\r\n        cnst.tack_dock_nSblgs(e);\r\n      }\r\n\r\n      cataLog.components = pClg.components;\r\n//      if (embed_mode==='catalog' || embed_mode==='page' || embed_mode==='thread') {\r\n//        pn12_0_2.getElementsByTagName('span')['hide_at_embed'].style.display = 'none';\r\n//        pn12_0_4.getElementsByTagName('div')['hide_at_embed'].style.display = 'none';\r\n//      }\r\n//      var hide_target = (pref.catalog.text_mode.mode==='text')? 'catalog.text_mode.mode.graphic' : 'catalog.text_mode.mode.text';\r\n//      pn12_0_4.getElementsByTagName('span')[hide_target].style.display = 'none';\r\n      if (embed_mode==='thread') pref_func.pref_overwrite(pref.filter,pref_default().filter);\r\n//      filter_kwd_prep_init(null, pref.filter.kwd,true); // prep kwd.rexps\r\n\r\n////      pref_func.tooltips.add_hier(pn12_0_4);\r\n//      pref_func.tooltips.add_root(pn12_0_4);\r\n////      if (pref[embed_mode].auto_config_posts_search) auto_config_posts_search_deactivate();\r\n//      pref_func.apply_prep(pn12_0_4,false, null, null, true);\r\n////      pref_func.apply_prep(pn12_0_4,true); // obj init.\r\n//      var pn_filter = pn12_0_4.childNodes[1];\r\n      window.addEventListener('beforeunload', window_beforeunload, false);\r\n//  pClg.onchange_funcs = {'.':pClg, __proto__:onchange_funcs}; // temporal, this can be consolidated.\r\n//      pref_func.add_onchange(pn12_0_2,pClg.onchange_funcs, oninput_funcs); // causes 1 leak.\r\n//      cataLog.event_func = pref_func.add_onchange(pn12_0_4,pClg.onchange_funcs, oninput_funcs); // causes 1 leak.\r\n//console.log('init_onchange');\r\n      window.addEventListener('storage', site2[site.nickname].prep_own_posts_event, false);\r\n//      site2[site.nickname].prep_own_posts();\r\n      site2[site.nickname].check_reply.make_own_posts(); // prevent from calling twice.\r\n      function window_beforeunload() {\r\n        var done = {};\r\n        if (pref.catalog.auto_save_filter) for (var i=0;i<gClg.Clgs.length;i++) {\r\n          var clg = gClg.Clgs[i];\r\n          if (clg.mode!=='thread') {\r\n            var sel = clg.pref[clg.mode].board_list_sel;\r\n            if (done[sel]===undefined) {\r\n              clg.onchange_funcs.save();\r\n              done[sel] = null;\r\n            }\r\n          }\r\n        }\r\n//        if (pref.catalog.auto_save_filter && embed_mode!=='thread') onchange_funcs.save();\r\n        window.removeEventListener('beforeunload', window_beforeunload, false);\r\n      }\r\n      if (pref.virtualBoard.scan && embed_mode!=='thread')\r\n        setTimeout(function(){scan.keyword_load(false, health_indicator);}, pref.virtualBoard.scanDelay*1000);\r\n      \r\n//      var pn_setting = pn12_0_4.childNodes[0];\r\n      var triage_parent;\r\n      triage_parent_set();\r\n      function triage_parent_set(){\r\n        triage_parent = (embed_embed)? site2[site.nickname].catalog_get_native_area() : pn12_1;\r\n        cataLog.parent = triage_parent;\r\n        pClg.ppn = triage_parent;\r\n        pClg.pppn = pClg.ppn.parentNode;\r\n        pClg.ppn.classList.add(pref.script_prefix+'_'+pClg.view+'View');\r\n      }\r\n      cataLog.triage_parent_set = triage_parent_set;\r\n//      if (pref.catalog.auto_load_filter) onchange_funcs.load();\r\n      pClg.onchange_funcs['*.board_list_sel'](null,true);\r\n\r\n//      var tags_scan_regex = new RegExp('#[^#, \\.:;\\n]+(?=#|,| |\\.|:|;|\\n|$)','g'); // ATTENTION. REFER function prep_tag_str(); // AND ALSO IN scan_tag_obj.\r\n      var scan_boards = (function(){\r\n//        var scan_button   = pn12_0_4.getElementsByTagName('button')['scanSite'];\r\n////////        var scan_boards   = {args:{}, crawler_timer:null, pool:null};\r\n        var scan_boards   = {args:{}, pool:null};\r\n////////        var scan_progress = (function(){\r\n////////          var elem = pn12_0_4.getElementsByTagName('span')['scan_progress'];\r\n////////          var timer = null;\r\n////////          var str = '';\r\n////////          function show(){elem.innerHTML=str; timer=null;}\r\n////////          return function(s){str=s; if (timer===null) timer = setTimeout(show,100);};\r\n////////        })();\r\n////////        function keyword_load(key){ // working code.\r\n////////          if (scan_boards_check_pre(key,true)) {\r\n//////////            if (pref.common.clear_at_manual_scan && !keep) onchange_funcs.clear_threads();\r\n////////            scan_button.innerHTML = 'Cancel';\r\n////////            if (!site3[site.nickname].boards) {\r\n////////              http_req.get(key,site.nickname,site2[site.nickname].url_boards_json(),scan_boards_keyword_callback,pref.scan.lifetime*60,true,key);\r\n////////              scan_progress('Loading boards\\' information');\r\n////////            } else {\r\n////////              var tgts = site2[site.nickname].enumerate_boards_to_scan(); // must remake to evaluate change of preference.\r\n////////              scan_boards_init(key, tgts, {lifetime:pref.scan.lifetime*60, cache_write:true,\r\n////////                                           callback:(pref.liveTag.use)? catalog_liveTag_scan_threads : null, callback_args:'scan'});\r\n////////            }\r\n////////          }\r\n////////        }\r\n        function scan_boards_check_pre(key){\r\n          if (scan_boards.args[key]) {\r\n            if (scan_boards.args[key].max != scan_boards.args[key].idx) {\r\n              scan_boards.args[key].max = scan_boards.args[key].idx;\r\n              if (scan_boards.args[key].INDICATOR) scan_boards.args[key].INDICATOR.report({abort_str:'canceled'});\r\n            } else {\r\n////////              if (scan_boards.args[key].crawler_watchdog) scan_boards.args[key].crawler_watchdog.stop();\r\n////              crawler.watchdog.abort(key);\r\n              if (scan_boards.args[key].INDICATOR) scan_boards.args[key].INDICATOR.report({abort_str:'aborted', end:Date.now()});\r\n              delete scan_boards.args[key];\r\n            }\r\n            return false;\r\n          } else return true;\r\n        }\r\n//        function scan_boards_keyword_init(key){\r\n//          scan_boards_init(key, site3[site.nickname].boards,pref.filter.tag_scansite,pref.filter.tag_scansite,pref.scan.lifetime*60);\r\n//          var obj = [];\r\n//          obj.max_threads = pref.scan.max_threads;\r\n//          var count = pref.scan.max;\r\n//          for (var i in site3[site.nickname].boards) if (site3[site.nickname].boards[i].max) {\r\n//            obj.push('/'+site3[site.nickname].boards[i].uri+'/');\r\n//            if (--count==0) break;\r\n//          }\r\n//          scan_boards_init(key, obj, {lifetime:pref.scan.lifetime*60, cache_write:true});\r\n//        }\r\n        function scan_init(key,mem,args, multi_entry){\r\nif (pref.debug_mode['5']) console.log('scan_init: '+key);\r\n          if (!multi_entry && !scan_boards_check_pre(key,false)) return;\r\n          if (!Array.isArray(mem)) mem = Object.keys(mem);\r\n          if (mem.length==0) {\r\n            if (args.callback) args.callback(args.callback_args);\r\n            return;\r\n          }\r\n          scan_boards_init(key, mem, args);\r\n        }\r\n        scan_boards.args_proto = { // for httpd\r\n          callback_1: function(req,value,REQ){\r\n            scan_boards_keyword_callback2(req.key2||'',value,[null,REQ]); // req.key2||'' for over limit error.\r\n          },\r\n          get_tgt_func: function(req){\r\n            if (!(req.IDX<req.max && (req.refresh || req.found_threads<req.max_threads))) {req.ABORT = true; req.UPPERLIMIT = true; return;}\r\n            do {\r\n              var tgt = scan_boards_keyword_make_tgt(req,req.IDX++);\r\n            } while (req.IDX<req.max && (!tgt || (pref.catalog.board.ex_list && pref_func.merge_obj5(tgt,pref.catalog.board.ex_list_obj2,null))));  // 'if (tgt)' is for tgts_iterator\r\n            if (req.IDX<=req.max) {\r\n              var archived = scan.list_nup.issued(tgt);\r\n              var dbt = common_func.name2dbt(tgt);\r\n              var url = site2[dbt[0]].make_url4(dbt);\r\n              var key2 = dbt.join(',');\r\n              return {REQ:req, url:url[0], responseType:(pref.test_mode['165'] || archived)? 'text' : (url[1]==='html')? 'document' : url[1], tgt:tgt, key2:key2, data_type:url[1], domain:dbt[0]};\r\n            }\r\n          },\r\n          callback: function(req){\r\n            if (req.ABORT) req.INDICATOR.report({err_str:'Aborted.'+(req.UPPERLIMIT? '(Reached upper limit)':'')});\r\n            delete scan_boards.args[req.key];\r\n            if (Object.keys(scan_boards.args).length==0) scan_boards.pool = null;\r\n            if (req.callback2) req.callback2(req.callback_args);\r\n          },\r\n          initialize: function(){\r\n            Object.defineProperty(this,'idx',{get:function(){return this.IDX;}, configurable:true}); // for test.\r\n//            Object.defineProperty(this,'indicator',{get:function(){return this.INDICATOR;}, configurable:true}); // for test.\r\n            Object.defineProperty(this,'tgts',{get:function(){return this.obj;}, configurable:true}); // for test.\r\n            Object.defineProperty(this,'initiator',{get:function(){return this.key;}, configurable:true}); // for test.\r\n            if (this.hasOwnProperty('callback')) {\r\n              this.callback2 = this.callback;\r\n              delete this.callback;\r\n            }\r\n            return this;\r\n          },\r\n        };\r\n        scan_boards.args_proto.callback_1_fail = scan_boards.args_proto.callback_1;\r\n        function scan_boards_init(key, obj, args){\r\n          if (!scan_boards.pool) scan_boards.pool = {\r\n            div: document.createElement('div'), parser: new DOMParser(), doc: null, ths: null, dbt: null, tgts: null, tags:{cs:{}, ci:{}},\r\n            name:null, sticky:null, type:null, wrapper_obj:null};\r\n  //        var obj = site3[site.nickname].boards;\r\n          scan_boards.args[key] = {\r\n                key: key,\r\n                idx: 0,\r\n//                max: (obj.length>pref.scan.max)? pref.scan.max : obj.length,\r\n                max: obj.length,\r\n//                max_threads: (obj.length>pref.scan.max)? obj.length : pref.scan.max,\r\n                max_threads: pref4.scan.max_threads,\r\n                found_threads: 0,\r\n                found_boards: 0,\r\n                scanned: 0,\r\n////////                error: '',\r\n//                error_obj: {},\r\n                crawler: 0,\r\n////////                crawler_max : pref.scan.crawler,\r\n                obj: obj,\r\n//                scan_tag: pref.filter.tag_scansite,\r\n//                store_tag: pref.filter.tag_scansite,\r\n                lifetime: 0,\r\n                cache_write: false,\r\n                callback : null,\r\n                callback_args : null,\r\n                pool: scan_boards.pool,\r\n                refresh: null,\r\n                indicator: null,\r\n                tgt_raw: false,\r\n                watchdog: null,\r\n////////                spawn_crawler: function(){scan_boards_spawn_crawler(key);},\r\n////////                crawler_watchdog: null,\r\n                from_auto: null,\r\n                load_on_demand: null,\r\n//                tag_only: null,\r\n                senders_returned:[],\r\n                priority: 0,\r\n                tgts_iterator: null,\r\n            __proto__: scan_boards.args_proto\r\n          };\r\n          for (var i in args) scan_boards.args[key][i] = args[i];\r\n          var sb = scan_boards.args[key];\r\n\r\n          if (sb.load_on_demand && !sb.tgts_iterator) {\r\n////            sb.max = 1; // working code.\r\n////            for (var i=obj.length-1;i>=1;i--) {\r\n////              var name = ':DL:'+ sb.obj[i];\r\n////              var idx = threads_idx.indexOf(name);\r\n////              if (idx!=-1) threads_idx.splice(idx,1);\r\n////              threads_idx.unshift(name);\r\n////            }\r\n            for (var i=0;i<sb.obj.length;i++) {\r\n              var tgt = scan_boards_keyword_make_tgt(sb,i);\r\n              var dbt = common_func.name2domainboardthread(tgt,true);\r\n              if (dbt[2].search(/[cjpq][1-9]/)===0) {\r\n                pClg.idx_insert_odl(tgt);\r\n                sb.obj.splice(i--,1);\r\n              }\r\n            }\r\n            if (sb.obj.length===0) {\r\n//              if (sb.indicator) sb.indicator.remove();\r\n              if (sb.callback) {\r\n                var func = sb.callback\r\n                var args = sb.callback_args;\r\n              }\r\n              delete scan_boards.args[sb.key];\r\n              return (func)? func(args) : undefined;\r\n            } else {\r\n              if (pClg.load_on_demand_try_get_mutex()) sb.callback = (sb.callback)? (function(func_old){return function(){pClg.load_on_demand_release();func_old();}})(sb.callback) : pClg.load_on_demand_release.bind(pClg); // First access may not have mutex.\r\n//              if (load_on_demand.get()) sb.callback = (sb.callback)? (function(func_old){return function(){load_on_demand.release();func_old();}})(sb.callback) : load_on_demand.release; // First access may not have mutex.\r\n              sb.max = sb.obj.length;\r\n              pClg.drawn_idx = 0;\r\n            }\r\n          }\r\n\r\n          httpd.req(sb.initialize(), (sb.priority<7)? sb.priority+1 : 1); // patch\r\n          \r\n////          if (!sb.indicator) sb.indicator = health_indicator.shift('limegreen','r',sb.key,sb.priority); // working code.\r\n////          sb.indicator.report({start:Date.now(), prog:sb}); // make reference loop.\r\n////          while (sb.crawler<pref.scan.crawler) {\r\n////////////            scan_boards_spawn_crawler(key, true);\r\n////            crawler.spawn(key, true);\r\n////            if (pref.scan.crawler_adaptive) break;\r\n////          }\r\n        }\r\n////        var crawler = { // working code.\r\n////          key: null,\r\n////          priority: 0,\r\n////          num: 0, // dangerous, may hang up, all crawlers must be returned.\r\n////          wdg_spawn: null,\r\n////          spawn_req: function(sb){\r\n////            this.clear_req(sb);\r\n////            if (sb.priority>=this.priority) {\r\n////              if (this.num<pref.scan.crawler || sb.priority>this.priority) {\r\n////                this.wdg_spawn.start(pref.scan.crawler_idle_time_to_spawn);\r\n////                this.key = sb.key;\r\n////                this.priority = sb.priority;\r\n////              }\r\n////            }\r\n////          },\r\n////          spawn: function(key, init){\r\n////            var sb = scan_boards.args[(key || this.key)]; // not to keep greping 'sb' object, 'key' and 'priority' are primitives.\r\n////            if (sb && sb.idx<sb.max) {\r\n////              var sender = (sb.senders_returned.length>0)? sb.senders_returned.shift() : sb.key+':'+sb.crawler;\r\n////              sb.crawler++;\r\n////              this.num++;\r\n////              this.watchdog.add(sb, sender);\r\n////              if (pref.debug_mode['5']) console.log('crawler_spawn: '+sender+'/'+sb.crawler);\r\n////              scan_boards_keyword([sender,sb],200);\r\n////              if (!init && !pref.scan.crawler_adaptive) this.spawn_req(sb);\r\n////            }\r\n////          },\r\n////          clear_req: function(sb){\r\n////            if (sb.priority>=this.priority) this.wdg_spawn.stop();\r\n////          },\r\n////          check_priority: function(sb, sender){\r\n////            if (sb.priority>=this.priority || sb.crawler==1) return true;\r\n////            else {\r\n////              this.finish(sb, sender);\r\n//////              sb.senders_returned.push(sender);  // THIS CAUSED A BUG,\r\n////                                                   // crawler with status 1200(now changed to -200) call 'finish' immediately,\r\n////                                                   // but this is respawned and causes multiple call of 'watchdog.add'.\r\n////                                                   // For easy debug, this was moved to 'finish'.\r\n////              return false;\r\n////            }\r\n////          },\r\n////          finish: function(sb, sender){\r\n////            this.clear_req(sb);\r\n////            http_req.close(sender);\r\n////            this.watchdog.end(sender);\r\n////            sb.senders_returned.push(sender); // shold be here, but slightly redundant for end.\r\n////            sb.crawler--;\r\n////            this.num--;\r\n////            if (pref.debug_mode['5']) console.log('crawler_finish: '+sender+'/'+sb.crawler);\r\n////          },\r\n////          finish_all: function(sb){\r\n////            this.priority = 0;\r\n////            if (Object.keys(scan_boards.args).length==0) this.reset(); // for safety.\r\n////            else for (var key in scan_boards.args) if (scan_boards.args[key].senders_returned.length>0) this.spawn(key);\r\n////          },\r\n////          reset: function(){\r\n////            this.num = 0;\r\n////            this.watchdog.reset();\r\n////          },\r\n////          watchdog: {\r\n////            list: [],\r\n////            sbs: Object.create(null),\r\n////            add: function(sb,sender){\r\n////              this.list.push(sender);\r\n////              this.sbs[sender] = sb;\r\n////              if (this.list.length===1) this.wdg.start();\r\n////            },\r\n////            end: function(sender){\r\n////              this.report_alive(sender);\r\n////              delete this.sbs[sender];\r\n////              this.list.splice(this.list.indexOf(sender),1);\r\n////              if (this.list.length===0) this.wdg.stop();\r\n//////              else this.wdg.restart(); // this is redundant because report_alive exists before\r\n////            },\r\n////            wdg: null,\r\n////            report_alive: function(sender){\r\n////              if (sender===this.list[0]) {\r\n////                this.list.push(this.list.shift());\r\n////                this.wdg.restart();\r\n////              }\r\n////            },\r\n////            respawn: function(){\r\n////              var sender = this.list[0];\r\n////              var sb = this.sbs[sender];\r\n////              if (pref.debug_mode['7']) console.log('crawler_respawn: '+sender+'/'+((sb)?sb.crawler:'undefined'));\r\n////              scan_boards_keyword([sender,sb],200);\r\n////              this.report_alive(sender);\r\n////            },\r\n////            reset: function(){\r\n////              this.list = [];\r\n////              this.sbs = Object.create(null);\r\n////              this.wdg.stop();\r\n////            },\r\n////            abort: function(key){\r\n////              for (var i=this.list.length-1;i>=0;i--) if (this.list[i].indexOf(key+':')===0) this.end(this.list[i]);\r\n////            },\r\n////          },\r\n////          priority_up: null,\r\n////          priority_release: null,\r\n////          priority_wdg: null,\r\n////          priority_count: 0,\r\n////        };\r\n////        crawler.wdg_spawn = new Watchdog(crawler.spawn.bind(crawler), 100);\r\n////        crawler.watchdog.wdg = new Watchdog(crawler.watchdog.respawn.bind(crawler.watchdog), 30000);\r\n////        crawler.priority_up = function(p){\r\n////                                this.priority = p;\r\n////                                this.priority_count++;\r\n////                                this.priority_wdg.start();\r\n////                              }.bind(crawler);\r\n////        crawler.priority_release = function(){\r\n////                                     if (--this.priority_count<=0) {\r\n////                                       this.priority=0;\r\n////                                       this.priority_wdg.stop();\r\n////                                     } else this.priority_wdg.restart();\r\n////                                   }.bind(crawler);\r\n////        crawler.priority_wdg = new Watchdog(crawler.priority_release, 10000);\r\n\r\n////////        function scan_boards_spawn_crawler_timer(sb){ // working code.\r\n////////          scan_boards_crawler_timer_clear();\r\n////////          if (sb.crawler<sb.crawler_max) scan_boards.crawler_timer = setTimeout(sb.spawn_crawler, pref.scan.crawler_idle_time_to_spawn);\r\n////////        }\r\n////////        function scan_boards_spawn_crawler(key, init){\r\n////////          var sb = scan_boards.args[key];\r\n////////          if (pref.debug_mode['5']) console.log('crawler_spawn: '+sb.key+', '+(sb.crawler+1));\r\n////////          scan_boards_keyword([sb.key+sb.crawler++,sb],200);\r\n////////          if (!init && sb.idx<sb.max) scan_boards_spawn_crawler_timer(sb);\r\n////////        }\r\n////////        function scan_boards_crawler_timer_clear(){\r\n////////          if (scan_boards.crawler_timer!==null) {\r\n////////            clearTimeout(scan_boards.crawler_timer);\r\n////////            scan_boards.crawler_timer=null;\r\n////////          }\r\n////////        }\r\n////////        var CrawlerWatchdog = function(sb){ // patch for 8chan's unstability.\r\n////////          this.sb = sb;\r\n////////          this.tgt = 0;\r\n////////          this.db = new DelayBuffer(this.respawn.bind(this), 30000);\r\n////////          this.db.delayed_do();\r\n////////        }\r\n////////        CrawlerWatchdog.prototype = {\r\n////////          report_alive: function(kwd){\r\n////////            if (!this.sb) return; // stopped already\r\n////////            var me = kwd.substr(this.sb.key.length);\r\n////////            if (this.tgt==me) {\r\n////////              this.tgt = (this.tgt<this.sb.crawler-1)? this.tgt+1 : 0;\r\n////////              this.db.cancel();\r\n////////              this.db.delayed_do();\r\n////////            }\r\n////////          },\r\n////////          respawn: function(){\r\n////////            if (this.sb.idx<this.sb.max) {\r\n////////              if (pref.debug_mode['7']) console.log('crawler_respawn: '+this.sb.key+this.tgt+'/'+this.sb.crawler);\r\n////////              scan_boards_keyword([this.sb.key+this.tgt,this.sb],200);\r\n////////              this.report_alive(this.sb.key+this.tgt);\r\n////////            } else {\r\n////////              if (pref.debug_mode['7']) console.log('crawler_respawn: '+this.sb.key+this.tgt+'/'+this.sb.crawler+', stopped.');\r\n////////              this.stop();\r\n////////            }\r\n////////          },\r\n////////          stop: function(){\r\n////////            this.db.cancel();\r\n////////            this.sb = null; // release pointer\r\n////////          }\r\n////////        }\r\n        function scan_boards_keyword_make_tgt(sb,idx){\r\n          var tgt = (sb.tgts_iterator)? sb.tgts_iterator.next().value : sb.obj[idx];\r\n          if (tgt && typeof(tgt)!=='string') {\r\n            var force_json = tgt.u&0x0080;\r\n            tgt = tgt.key;\r\n          }\r\n          var dbt;\r\n          if (tgt) dbt = cnst.name2domainboardthread(tgt,true);\r\n          return (!tgt)? tgt:\r\n                 (sb.tgt_raw)? tgt :\r\n                 (dbt[2]==='')? tgt + ((pref.catalog.catalog_json | force_json)? 'j0' : 'c0') :\r\n                 (pref.catalog.catalog_json && dbt[2][0].search(/[0-9]/)!=-1)? dbt[0]+dbt[1]+'t'+dbt[2] : tgt;\r\n        }\r\n////        function scan_boards_keyword(args,status){ // working code.\r\n////          var sender = args[0];\r\n////          var sb = args[1];\r\n////          crawler.watchdog.report_alive(sender);\r\n////          if (sb.watchdog) sb.watchdog();\r\n////          if (pref.scan.crawler_adaptive) if (!crawler.check_priority(sb,sender)) return;\r\n////////////          if (sb.crawler_watchdog) sb.crawler_watchdog.report_alive(sender);\r\n//////if (pref.debug_mode['5']) console.log('request_entry: '+sb.idx+'/'+sb.max+', '+sb.found_threads+'/'+sb.max_threads+', '+status);\r\n////if (pref.debug_mode['5'] && sb.idx!=0 && sb.idx%1000==0) console.log('request_progress: '+sb.key+', '+sb.idx+'/'+sb.max+', '+sb.found_threads+'/'+sb.max_threads+', '+status);\r\n////          if (sb.idx<sb.max && (sb.refresh || sb.found_threads<sb.max_threads) && status<500) {\r\n////            var tgt = scan_boards_keyword_make_tgt(sb,sb.idx);\r\n////            sb.idx++;\r\n////////////            scan_progress(sb.found_threads+'/'+sb.scanned+', '+sb.found_boards+'/'+sb.idx+'/'+sb.max+', ' + tgt);\r\n////            if (tgt && (!pref.catalog.board.ex_list || !pref_func.merge_obj5(tgt,pref.catalog.board.ex_list_obj2,{hit:false}).hit)) { // 'if (tgt)' is for tgts_iterator\r\n////              if (sb.indicator) sb.indicator.report({tgt:tgt});\r\n////              http_req.get(sender,tgt,'',scan_boards_keyword_callback2,sb.lifetime,sb.cache_write,args, scan.list_nup.issued(tgt));\r\n////////////              if (sb.idx<sb.max && pref.scan.crawler_adaptive) scan_boards_spawn_crawler_timer(sb);\r\n////              if (pref.scan.crawler_adaptive) crawler.spawn_req(sb);\r\n////            } else scan_boards_keyword(args,200);\r\n////          } else {\r\n////            crawler.finish(sb, sender);\r\n////////////            http_req.close(sender);\r\n////            if (sb.crawler===0) {\r\n////////////              if (pref.scan.crawler_adaptive) scan_boards_crawler_timer_clear();\r\n////////////              if (sb.crawler_watchdog) sb.crawler_watchdog.stop();\r\n////////////              var prog_str = sb.found_threads+'/'+sb.scanned+', '+sb.found_boards+'/'+sb.max\r\n////////////                            + '<span style=\"color:red\">'\r\n////////////                            +( (sb.error!=='')? ', Error at loading '+sb.error :\r\n////////////                              ((!sb.refresh && sb.found_threads>=sb.max_threads)? ', Aborted.(Reached upper limit)' : ''))\r\n////////////                            + '</span>';\r\n////////////              scan_progress(prog_str);\r\n//////              sb.max = sb.idx;\r\n//////              if (sb.key==='scan') scan_button.innerHTML = 'scanSite';\r\n////if (pref.test_mode['22']) {\r\n////              if (sb.store_tag) {\r\n////  //console.log(new Date());\r\n////  //              scan_tags_init(sb.pool.tags);\r\n////                var ret_obj = scan_tags_common_b(sb.pool.tags,'',site3[site.nickname].tags);\r\n////                site3[site.nickname].tags = ret_obj[1];\r\n////                scan_tags_init(ret_obj[0],true);\r\n////  //              sb.pool.div.innerHTML = '';\r\n////  //console.log(new Date());\r\n////              }\r\n////}\r\n//////              sb = null;\r\n////              if (sb.indicator) {\r\n////////////                var keys = Object.keys(sb.error_obj);\r\n////////////                if (keys.length==0) sb.indicator.set(null,'\\u25cf');\r\n////////////                else if (keys.length>=sb.max) sb.indicator.set('red','X');\r\n////////////                else sb.indicator.set(null,'\\u25b2');\r\n////                if (sb.found_threads>=sb.max_threads) sb.indicator.report({err_str:'Aborted.(Reached upper limit)'});\r\n////                sb.indicator.report({end:Date.now()});\r\n////              }\r\n////              delete scan_boards.args[sb.key];\r\n////if (pref.debug_mode['5']) console.log('scan_boards_end: '+sb.key+', Running:'+Object.keys(scan_boards.args));\r\n////              crawler.finish_all(sb);\r\n////              if (Object.keys(scan_boards.args).length==0) scan_boards.pool = null;\r\n////              if (sb.callback) sb.callback(sb.callback_args);\r\n////            }\r\n////          }\r\n////        }\r\n\r\n        cataLog.scan_boards_keyword_callback2_default_args = {refresh:pClg, found_threads:0, get max_threads(){return pref4.scan.max_threads;}, found_board:0, scanned:0};\r\n        var threads_meguca = {};\r\n        function scan_boards_keyword_callback2(key,value,args,    ths_in){ // requires snoop and on demand rendering for merge.\r\n////////  if (pref.scan.crawler_adaptive) scan_boards_crawler_timer_clear();\r\n          var sb = args[1];\r\n          var dbt = key.split(',');\r\n////          if (pref.scan.crawler_adaptive) crawler.clear_req(sb);\r\n          if ((value.status==200 || value.status==304) && value.response && sb.found_threads<sb.max_threads) { // Checking 'value.response' is a patch for 8chan's inconsistency, 8chan sometimes return 200 with null. // checking 304 is a patch.\r\n            var sb_source = dbt[3].slice(0,dbt[3].indexOf('_'));\r\nif (dbt[0]==='meguca1' && dbt[3]==='catalog_json') { // PATCH FOR MEGUCA\r\n            for (var i=0;i<value.response.length;i++) {\r\n//              threads_meguca[dbt[1]+value.response[i]] = {page:parseInt(i/10) +'.'+ i%10, refresh:sb.refresh};\r\n              liveTag.mems.init({domain:dbt[0], board:dbt[1], no:value.response[i]});\r\n              threads_meguca[dbt[1]+value.response[i]] = {page:parseInt(i/10) +'.'+ i%10, refresh:sb.refresh || threads_meguca[dbt[1]+value.response[i]] && threads_meguca[dbt[1]+value.response[i]].refresh}; // patch.\r\n              scan.list_nup.add(dbt[0]+dbt[1]+value.response[i], sb.priority);\r\n//              if (pref.liveTag.use) scan.list_nup.add_board(dbt[0]+dbt[1], value.date);\r\n            }\r\n            scan.list_nup.got_200_board(dbt[0],dbt[1]);\r\n} else {\r\n////            var tgts = {};\r\n////            if (!pref.test_mode['133']) { // new Array(gClg.Clgs.length).fill({});\r\n////              tgts = [];\r\n//              for (var i=0;i<gClg.Clgs.length;i++) {\r\n////                tgts[i] = {};\r\n//                gClg.Clgs[i].format_refresh_tgts();\r\n//              }\r\n////            }\r\n//            var ths_info = []; // for test_mode['133']\r\n            var parse_options = (pref.test_mode['182'] && sb_source==='catalog')? null\r\n                              : (sb_source==='thread')? {thread:dbt[2]} : {page:dbt[2]};\r\n            if (sb.localArchive) { // to be moved to archiver\r\n              if (!parse_options) parse_options = {};\r\n              parse_options.localArchive = sb.localArchive;\r\n              parse_options.archiveFile = sb.archiveFile;\r\n              parse_options.page = sb.page;\r\n            }\r\n            var ths = ths_in || site2[dbt[0]].wrap_to_parse.get(value.response, dbt[0], dbt[1], dbt[3], parse_options);\r\n            if (sb.localArchive) {\r\n              for (var i=0;i<ths.length;i++) ths[i].key = ths[i].key.substr(0,ths[i].key.lastIndexOf('/')+1) + ths[i].posts[0].no;\r\n              if (ths.length===1) dbt[2] = ths[0].posts[0].no;\r\n            }\r\n            if (sb.force_annotate) { // for reentry in meguca.\r\n              for (var i=0;i<ths.length;i++) if (threads[ths[i].key] && ths[i].pn && threads[ths[i].key][0]!==ths[i].pn) {\r\n                threads[ths[i].key][0] = ths[i].pn;\r\n                threads[ths[i].key][1] = true;\r\n                pClg.insert_thread_format_th_pn(threads[ths[i].key], true, true, true, ths[i]);\r\n//                threads[ths[i].key][24] = prep_footer3(ths[i]);\r\n                threads[ths[i].key][16].posts = ths[i].posts;\r\n              }\r\n            }\r\n            sb.scanned += ths.length;\r\n//////if (pref.test_mode['22']) {\r\n//////            var tgt_pn = sb.pool.div;\r\n//////            var from_catalog = dbt[3]==='catalog_json' || dbt[3]==='catalog_html';\r\n//////            var filter_active = pref.filter.kwd.active || (pref.filter.tag && filter_tags.length!=0);\r\n//////} else {\r\n////            var filter_active = pref.filter.kwd.active || (pref.filter.tag && pref.liveTag.use && liveTag.active.in);\r\n////            var filter_active = pref.filter.kwd.active || (pref.filter.tag && liveTag.active.in); // for passive but don't use.\r\n//            var filter_active_kwd = pref.filter.kwd.active;\r\n//            var filter_active_tag = pref.filter.tag && liveTag.active.in; // for passive\r\n            var filter_needs_wrapping = site2[dbt[0]].differentAPI && gClg.Clgs.filter(function(v){v.pref.filter.kwd.posts_active;}).length>0;\r\n////}\r\n////            var from_json = dbt[3].indexOf('_json')!=-1;\r\n            var refresh = sb.refresh;\r\n            if (dbt[0]==='meguca1' && dbt[3]==='thread_json') { // PATCH FOR MEGUCA\r\n              var tgt_th_meguca = threads_meguca[dbt[1]+dbt[2]];\r\n              if (tgt_th_meguca!== undefined) {\r\n                refresh = tgt_th_meguca.refresh;\r\n                ths[0].page = tgt_th_meguca.page;\r\n                delete threads_meguca[dbt[1]+dbt[2]];\r\n              }\r\n            }\r\n            var post_updated_static = pref.liveTag.from==='post' || pref.stats.use && !pref.test_mode['167'] || pref[embed_mode].deleted_posts.detect.indexOf('full')===0 ||\r\n                pref[embed_mode].storePosts==='ALL_agg' || site2[dbt[0]].parse_funcs[dbt[3]].has_editing && (embed_mode==='page' || embed_mode==='thread') ||\r\n                pref[embed_mode].backlink_all;\r\n//            var post_updated_static = pref.liveTag.from==='post' || pref.stats.use || pref[embed_mode].deleted_posts.detect==='full';\r\n            var pf_store = (pref[embed_mode].storePosts==='ALL_agg' || pref[embed_mode].storePosts==='auto' && pref4.search_posts_active_once)? 'ALL' : pref[embed_mode].deleted_posts.detect; // the same code is in 'gClg.Maintain_AllThreads'\r\n            if (pf_store==='no' && embed_mode==='page') pf_store = pref[embed_mode].t2h_num_of_posts;\r\n            if (pref[embed_mode].detect_sage && dbt[0]==='4chan' && dbt[3]==='catalog_json') site2['4chan'].sage_detect_all(ths);\r\n            if (dbt[3]==='catalog_json' || dbt[3]==='catalog_html') {\r\n              var nos = Object.create(null);\r\n              for (var i=0;i<ths.length;i++) nos[ths[i].no] = null;\r\n            }\r\n            var sb_merge = sb.key==='mergeUI' || sb.key==='mergeAuto';\r\n            var pf_notify_new_thread = sb.from_auto && (pref.notify.desktop.notify && pref.notify.desktop.new_thread || pref.notify.sound.notify && pref.notify.sound.new_thread);\r\n            var has_page = sb_source!=='thread';\r\n            var clgs_args = [];\r\n            for (var j=0;j<gClg.Clgs.length;j++) {\r\n              var clg = gClg.Clgs[j];\r\n              clg.format_refresh_tgts();\r\n              clgs_args[j] = {\r\n                refresh: refresh===clg ||\r\n                         refresh && refresh.pref[refresh.mode].board_list_sel===clg.pref[clg.mode].board_list_sel && clg.pref[clg.mode].accept_others_refresh ||\r\n                         clg.pref[clg.mode].promiscuous,\r\n                ALL_agg: pref[embed_mode].storePosts==='ALL_agg', // CAUTION: embed_mode is used intentionally. // this.pref[this.mode];\r\n                pf_fKwd: clg.pref.filter.kwd.active && clg.pref.filter.kwd,\r\n                pf_fTag: clg.pref.filter.tag && clg.liveTag.active.in,\r\n                pf_foPg: has_page && clg.pref[clg.footer.mode_fmt].footer.page};\r\n            }\r\n            for (var i=0;i<ths.length;i++) {\r\n              var th = ths[i];\r\n              if (!th.no) continue; // PATCH for a bug in 4chan, 4chan returns invalid data.\r\n//              th.time_loaded = value.date;\r\n//              if (sb.native_prep) th.native_prep = true;\r\n//if (pref.test_mode['33'] && dbt[0]==='meguca1' && dbt[3]==='thread_json') {scan.list_nup.got_200(th, liveTag.mems.init[th.domain][th.board]);continue;}\r\n//////if (pref.test_mode['22']) {\r\n//////              if (sb.scan_tag && from_catalog) {\r\n//////                if (th.type_data==='json') tgt_pn.innerHTML = th.name + '\\n' + th.sub + '\\n' + th.com;\r\n//////                else tgt_pn = th.pn;\r\n//////                th.tags = tgt_pn[brwsr.innerText].match(tags_scan_regex);\r\n//////              }\r\n//////} else {\r\n////var tmp_len = Object.keys(scan.list_nup).length;\r\n////if (tmp_len!=0 && tmp_len%100===0) console.log('len: '+tmp_len);\r\n//////////              if (pref.liveTag.use) {\r\n              var lth = liveTag.prep_tags(th); // extract tags in op. // editing tags are updated in this. // lth.pd is prepared here.\r\n//              var insert_thread_from_native_1 = insert_thread_from_native && insert_thread_from_native_prep(th, lth, insert_thread_from_native);\r\n//              th.tags = lth;\r\n              var watch = lth.wt;\r\n              var tgt_th = gClg.AllThreads[th.key]; // equivalent to threads[th.key] when gClg.Clgs.length===1\r\n//              var tgt_th = threads[th.key];\r\n              var tag_updated; //  = (tgt_th)? undefined : th.tags; // force new thread to add tags\r\n              var post_updated = (post_updated_static || (watch[0]&0x002c0000))? false : null; // archiving or watching\r\n//              var post_updated = (post_updated_static || (watch[0]&0x000c0000))? false : null;\r\n\r\n              if (lth.ed_t && th.parse_funcs.has_posts) { // lth.ed_t is created only when th.parse_funcs.has_editing is true. lth.ed_t is shared even if pref.liveTag.from!=='post'\r\n                var ed_f = [];\r\n                tag_updated = liveTag.update_tags_in_editing_posts(th, lth, ed_f) || tag_updated; // lth.ed_t is updated here. \r\n                if (ed_f.length===0) ed_f = null;\r\n              }\r\n//              if (th.parse_funcs.has_editing && th.parse_funcs.has_posts) {\r\n//                var ed_p = lth.ed_p || lth.ed_t; // share lth.ed_t when pref.liveTag.from==='post'\r\n//                if (ed_p) {\r\n//                  var ed_f;\r\n//                  var posts_obj = th.parse_funcs.posts_obj(th,ed_p[ed_p.length-1].no);\r\n//                  for (var j=ed_p.length-1;j>=0;j--) {\r\n//                    var post = posts_obj[ed_p[j]]; // post may be a tag.\r\n//                    if (post && !post.editing) {\r\n//                      if (ed_f) ed_f[ed_f.length] = post;\r\n//                      else ed_f = [post];\r\n//                      //// CODE FOR UPDATING ARCHIVES SHOULD BE HERE.\r\n//                      //// CODE FOR UPDATING POSTS CAN BE HERE.\r\n//                      if (lth.ed_p) {\r\n//                        if (lth.ed_p.length!==1) lth.ed_p.splice(j,1);\r\n//                        else lth.ed_p = null;\r\n//                      }\r\n//                    }\r\n//                  }\r\n//                  if (lth.ed_t) tag_updated = liveTag.update_tags_in_editing_posts(th, lth, posts_obj) || tag_updated; // lth.ed_t is updated here.\r\n//                }\r\n//              }\r\n\r\n//              if (liveTag.mems[dbt[0]][dbt[1]] && liveTag.mems[dbt[0]][dbt[1]].f) scan.list_nup.add(th.key, sb.priority); // use dbt[0] instead of th.domain for /popular/\r\n              if (lth.q && lth.q.waiting && th.parse_funcs.has_posts) site2[th.domain].popups_fetched(th, lth);\r\n              var updated = null;\r\n              var archive_store = (lth.archived || pf_store!=='no'); //  && (!pref.test_mode['67'] && !sb.localArchive);\r\n              var pf_store_1 = get_nof_store_posts(pf_store, tgt_th);\r\n//              var pf_store_th = tgt_th && tgt_th[16].get_t2h_num_of_posts() || 'no';\r\n//              var pf_store_1 = (pf_store==='ALL' || pref[embed_mode].storePosts==='ALL' && tgt_th)? -1\r\n//                  : (pf_store==='no' || pf_store==='passive' && pf_store_th!=='no')? pf_store_th : pf_store;\r\n              var ta_missing_info = lth.ta && lth.ta.posts[0].missing_info;\r\n              var lastNo = th.parse_funcs.has_posts? th.posts[th.posts.length-1].no : lth.lastNo || th.no;\r\n              var th_modified = lth.nof_posts!=th.nof_posts || lth.lastNo!==lastNo;\r\n              var force_store_ta = th_modified || pf_store_1===-1 || ta_missing_info && ta_missing_info>(th.missing_info|0); // pf_store_1===-1 for expand_posts\r\n              if (post_updated!==null && (th_modified || (watch[0]&0x00060000))) { // watch req || retag req\r\n//              if (post_updated!==null && (lth.nof_posts<th.nof_posts || (watch[0]&0x00060000))) { // watch req || retag req\r\n//              if (post_updated!==null && (lth.nof_posts<th.nof_posts || watch[3]<0)) { // watch[3]<0 is a patch for retag.\r\n//if (th.parse_funcs.has_posts && th.last_replies) console.log(th.key+', '+th.last_replies.length+', '+th.nof_posts+', '+lth.nof_posts);\r\n//                if (pref.debug_mode.unread_count===th.key) console.log('uc: watch[0]='+lth.nof_posts+', nof_posts='+th.nof_posts);\r\n                /*if (pref.test_mode['166']) {\r\n                  post_updated = th.nof_posts - lth.nof_posts\r\n                  lth.nr += post_updated;\r\n                  lth.nof_posts = th.nof_posts;\r\n                } else */ if (th.type_source==='thread' || \r\n//                    (th.parse_funcs.has_posts && th.last_replies && th.last_replies.length>=th.nof_posts-lth.nof_posts) ||\r\n                    (th.parse_funcs.has_posts && th.posts.length>th.nof_posts-lth.nof_posts && (lth.ta || pref[embed_mode].deleted_posts.detect.indexOf('full')!==0)) ||\r\n                    (th.nof_posts===1 && th.posts[0].time>=0 && !th.parse_funcs.dont_have_com)) {\r\n                  updated = site2[th.domain].check_reply.check(th, lth, watch, tgt_th /*|| (refresh && 1)*/ , sb.ext_posts || []); // dive in at the first time if page_html contains all posts. sb.ext_posts for embed_mode==='thread'. // update lth.nof_posts here\r\n                  lth.lastNo = lastNo; // for deletion\r\n                  if (updated.posts.length!==0) post_updated = true;\r\n//                  if (gClg.UnsyncedTriages[lth.key]) triage_exe_pipe(gClg.UnsyncedTriages[lth.key]); // should be here, but tgt_th[8] is not updated here.\r\n                  if (pref[embed_mode].backlink_all) site2[th.domain].popups_add_1_cross(th, updated.posts, pref[embed_mode].backlink_all_cross);\r\n                  tag_updated = updated.tags || tag_updated;\r\n                  scan.list_nup.got_200(th,lth); // patch for 8chan. 8chan has an inconsistency between catalog and threads,\r\n                                             // some threads which are there in catalog sometimes returns 404 if it gets as a thread.\r\n                                             // However, 8chan doesn't return 404, but fails at send(null), so system like watchdog is required.\r\n//                  if (pref.debug_mode['3']) console.log('Check tags: '+th.key+', '+lth.nof_posts);\r\n                  if (pref.threadStats.use && site2[th.domain].stats_ID && (refresh || tgt_th)) if (site2[th.domain].stats_ID(th, updated.posts, lth)) scan.list_nup.add(th.key, 0);\r\n                  if (archive_store) archiver.store(value, th, lth, updated.posts, updated.time_check_old, pf_store_1, ed_f, sb.localArchive);\r\n                } else { // if (!(th.parse_funcs.has_posts && !th.last_replies))\r\n                  /*if (pref.test_mode['166']) {post_updated = true; }// TEST\r\n                  else*/ scan.list_nup.add(th.key, sb.priority);\r\n//                  if (pref.debug_mode['3']) console.log('Schedule to check tags: '+th.key+', '+lth.nof_posts);\r\n                  if ((ed_f || force_store_ta) && archive_store) archiver.store(value, th, lth, undefined, undefined, pf_store_1, ed_f, true); // no archive, store posts only, because archiver MUST need full thread, or misclear flags in lth.archived and cause full archiving repeatedly.\r\n//                  if ((ed_f || (pref.test_mode['129'] && embed_mode==='page')) && archive_store) archiver.store(value, th, lth, undefined, undefined, pf_store_1, ed_f);\r\n                }\r\n              } else {\r\n                if (!sb.localArchive) scan.list_nup.got_200(th,lth);\r\n                if (pref.threadStats.use && site2[th.domain].stats_ID && (refresh || tgt_th)) {\r\n                  site2[th.domain].stats_ID(th, null, lth);\r\n                  if (pref.threadStats.retry && pref.threadStats.full && th.nof_posts<lth.nof_posts && th.type_source==='thread') scan.list_nup.add(th.key, 0); // for obsolete cache data, may cause infinite loop.\r\n                }\r\n//                  if (lth.nof_posts==th.nof_posts || !pref.network.fetch_actively || // only active when count is changed,\r\n//                      // 'th.parse_funcs.missing_info' doesn't have state if the thread is not stored(tgt_th===undefined),\r\n//                      //and all members will be fetched forever.\r\n//                    ((tgt_th)? !tgt_th[23] || th.type_source==='thread' : !th.parse_funcs.missing_info)) scan.list_nup.got_200(th,lth); // for threads which doesn't have posts.\r\n//                  else th.parse_funcs.missing_info_fetch(th);\r\n////                if (th.parse_funcs.has_editing) updated = {posts:th.posts.slice(lth.nof_posts || 0)}; // BUG, REDUNDANT.\r\n                if ((lth.rescan_dp || lth.force_ar || ed_f || force_store_ta && th.parse_funcs.has_posts) && archive_store)\r\n//                if (((pref.test_mode['129'] && embed_mode==='page') || lth.rescan_dp || lth.force_ar || ed_f || lth.nof_posts!=th.nof_posts && th.parse_funcs.has_posts) && archive_store)\r\n                  archiver.store(value, th, lth, undefined, undefined, pf_store_1, ed_f, sb.localArchive); // for initial if watched already // BUG!!! THIS DOESN'T WORK IF 304 IS RETURNED. // changed from 'lth.nof_posts<th.nof_posts'.\r\n////                if (lth.nof_posts!=th.nof_posts)\r\n////                  if(!th.parse_funcs.has_editing || th.parse_funcs.has_posts || embed_mode==='catalog') lth.nof_posts = th.nof_posts; // to get updated in next loop. // BUG, REDUNDANT.\r\n                var nof_new_posts = th.nof_posts - lth.nof_posts;\r\n                if (nof_new_posts) {\r\n                  site2[th.domain].check_reply.check(th, lth, watch, tgt_th, sb.ext_posts || [], nof_new_posts);\r\n                  if (pref3.stats.use && stats) stats.aggregate_passive(th, nof_new_posts, value.date);\r\n//                  if (lth.watched_p) lth.nr += nof_new_posts - (lth.nof_posts===0? watch[2] : 0);\r\n                  post_updated = true;\r\n                }\r\n//                lth.nof_posts = th.nof_posts;\r\n                lth.lastNo = lastNo; // for deletion\r\n              }\r\n////////              }\r\n              if (th.parse_funcs.has_editing) {\r\n                if (updated && pref.liveTag.from!=='post') { // share lth.ed_t always\r\n                  var ed_p = undefined;\r\n                  for (var j=0;j<updated.posts.length;j++) // update is reverse ordered.\r\n                    if (updated.posts[j].editing && updated.posts[j].no!=th.no)\r\n                      if (ed_p) ed_p[ed_p.length] = updated.posts[j];\r\n                      else ed_p = [updated.posts[j]];\r\n                  if (ed_p) {\r\n                    lth.ed_t = (lth.ed_t)? ed_p.concat(lth.ed_t) : ed_p;\r\n                    if (pref.debug_mode['24']) console.log(th.key+ ': lth.ed_t: '+ lth.ed_t.map(function(v){return (typeof(v)==='string')? v : v.no+'('+v.time+')';}));\r\n                  }\r\n                }\r\n//                if (updated && pref.liveTag.from!=='post') { // share lth.ed_t when pref.liveTag.from==='post'\r\n//                  var ed_p = undefined; // ed_p is used previously, so it must be cleared.\r\n//                  for (var j=0;j<updated.posts.length;j++) // update is reverse ordered.\r\n//                    if (updated.posts[j].editing)\r\n//                      if (ed_p) ed_p[ed_p.length] = updated.posts[j];\r\n//                      else ed_p = [updated.posts[j]];\r\n//                  if (ed_p) lth.ed_p = (lth.ed_p)? ed_p.concat(lth.ed_p) : ed_p;\r\n//                }\r\n//                if (updated) for (var j=updated.posts.length-1;j>=0;j--) // update is reverse ordered.\r\n//                  if (updated.posts[j].editing)\r\n//                    if (lth.ed_p) lth.ed_p[lth.ed_p.length] = updated.posts[j].no;\r\n//                    else lth.ed_p = [updated.posts[j].no];\r\n                if (th.type_source==='catalog' && (lth.ed_p || lth.ed_t) && (lth.archived || pref[embed_mode].t2h_sel!=='no' && tgt_th) &&\r\n                  lth.ed_u<th.replyTime) scan.list_nup.add(th.key, sb.priority);\r\n//                if (th.type_source==='catalog' && embed_mode!=='catalog' && tgt_th &&\r\n//                  (tgt_th[16].needs_update<th.replyTime || tgt_th[16].needs_update===null))) scan.list_nup.add(th.key, sb.priority);\r\n//                if (th.type_source==='catalog' && embed_mode!=='catalog' && tgt_th && lth.ed_p) scan.list_nup.add(th.key, sb.priority);\r\n              }\r\n//              if (th.domain==='meguca' && th.type_source==='catalog' && embed_mode!=='catalog' && tgt_th && tgt_th[16].needs_update<th.logCtr) scan.list_nup.add(th.key, sb.priority);\r\n////}\r\n//if (pref.test_mode['32'] && dbt[0]==='meguca1' && dbt[3]==='thread_json') continue;\r\n              if (lth.th) {\r\n                if (!tgt_th) delete lth.th;\r\n                else if (lth.th.missing_info && lth.th.missing_info>(th.missing_info|0)) {\r\n//                  if (lth.th.pn) th.pn = lth.th.pn; // Is this required???\r\n                  lth.th = th;\r\n                  // lth.th.posts SHOULD BE REDUCED HERE.\r\n                }\r\n              }\r\n////              if (tgt_th) { // working code.\r\n////                if (tgt_th[23]) {\r\n////                  for (var p in tgt_th[23]) {\r\n////                    if (p==='time_posted') {\r\n////                      if (th.time_posted) {tgt_th[8][4] = th.time_posted; delete tgt_th[23][p];}\r\n////                    } else if (p==='op_img_src_url') {\r\n////                      if (th.parse_funcs.get_op_src) {tgt_th[16].op_img_src_url = th.parse_funcs.get_op_src(th); delete tgt_th[23][p];}\r\n////                    }\r\n////                  }\r\n////                  if (Object.keys(tgt_th[23]).length===0) {\r\n////                    tgt_th[23] = null;\r\n//////                    if (missing_info[th.key]!==undefined) delete missing_info[th.key]\r\n////                  }\r\n////                }\r\n////              }\r\n////if (pref.test_mode['133']) {              \r\n              if (filter_needs_wrapping) site2[th.domain].wrap_to_parse.posts(th);\r\n////if (!pref.test_mode['133']) {              \r\n              for (var j=0;j<gClg.Clgs.length;j++) {\r\n                var clg = gClg.Clgs[j];\r\n//                var clg_refresh = refresh===clg ||\r\n//                                  refresh && refresh.pref[refresh.mode].board_list_sel===clg.pref[clg.mode].board_list_sel && clg.pref[clg.mode].accept_others_refresh ||\r\n//                                  clg.refresh_tgts[th.domain+th.board]===null;\r\n                var tgt_th_new = clg.insert_thread_1(th, lth, post_updated, tag_updated, clgs_args[j], value, nos, sb_merge);\r\n                if (!tgt_th && tgt_th_new) {\r\n//                if (tgt_th_status===undefined) { // BUG, this can't track proper number of posts when watcher's view is page and it is expanded.\r\n                  var pf_store_2 = get_nof_store_posts(pf_store, tgt_th_new); // depends on embed_mode, not this.mode, so all clg have the same number of stored poste.\r\n                  if (pf_store_1!==pf_store_2) archiver.store_th_to_mem(value, th,lth, pf_store_2, null);\r\n                  if (pf_notify_new_thread && clg.filter_test(th.key, tgt_th_new)) notifier.appeared(th, true); // 'appeared' was dropped.\r\n                  gClg.AllThreads[th.key] = tgt_th_new;\r\n                  tgt_th = tgt_th_new;\r\n                }\r\n              }\r\n////} else {\r\n////              var pick_up_for_search = th.type_source==='thread' && pref[embed_mode].storePosts==='ALL_agg';\r\n////              var picked_up_by_kwd_filter = filter_active_kwd && catalog_filter_query_keyword.kwd(pref.filter.kwd, th.posts, th.domain);\r\n////              var picked_up_by_tag_filter = filter_active_tag && liveTag.search_by_tags(th.tags);\r\n////              var picked_up_by_filter = picked_up_by_kwd_filter || picked_up_by_tag_filter;\r\n////              var tgt_th_status = (tgt_th===undefined)? undefined : tgt_th[9][0];\r\n//////              var force_update = (tgt_th && (tgt_th[16].expand_posts || (th.type_source==='thread' && (tgt_th[16].needs_update===true || tgt_th[16].needs_update===1)))) || pick_up_for_search;\r\n////              var force_update = (tgt_th && (tgt_th[16].expand_posts || (tgt_th[16].missing_info && tgt_th[16].missing_info>(th.missing_info||0)))) ||\r\n////                                 lth.ed_u<th.replyTime || pick_up_for_search;\r\n//////              var force_update = (tgt_th && (tgt_th[16].expand_posts || (th.type_source==='thread' &&\r\n//////                (tgt_th[16].needs_update===true || (tgt_th[16].needs_update<th.replyTime || tgt_th[16].needs_update===null))))) || pick_up_for_search;\r\n//////              if (refresh || (post_updated && tgt_th) || picked_up_by_filter || force_update) {\r\n//////              if (!sb.tag_only && (sb.refresh || (post_updated && tgt_th) || picked_up_by_filter)) {\r\n//////              if (!sb.tag_only && (sb.refresh || (filter_active && catalog_filter_query_scan(th.posts, th.tags)))) {\r\n////////////                if (insert_thread_with_test(th, dbt[3], value.date)) {// RUNS A REDUNDANT POST CHECK AT FIRST TIME....\r\n////              if (post_updated===null && tgt_th && (refresh || picked_up_by_filter)) {\r\n//////                if (post_updated===null && tgt_th) {\r\n////                var tgt_th8 = tgt_th[8];\r\n////                post_updated = !((((tgt_th8[0]>tgt_th8[4])? tgt_th8[0] : (tgt_th8[4] || tgt_th8[0])) >= ((th.time_bumped > th.time_posted)? th.time_bumped : (th.time_posted || th.time_bumped))) && // vichan has inconsistency in time between catalog.json and thread.json.\r\n////                                 tgt_th8[2]==th.nof_posts && tgt_th8[3]==th.nof_files) || th.type_source==='thread'; // pass thread to revise all of tgt_th[8]\r\n////              }\r\n////              if (post_updated && (tgt_th || pref[embed_mode].promiscuous) || (refresh || picked_up_by_filter) && !tgt_th || force_update) { // stop merging at preparing cross-thread popup\r\n//////              if (post_updated || (refresh || picked_up_by_filter) && !tgt_th || force_update) {\r\n//////              if (post_updated || picked_up_by_filter || tgt_th_status===undefined || force_update) {\r\n//////                if (!tgt_th) { // PATCH, WILL BE REMOVED BY CONSOLIDATING.\r\n//////                  var pf_store_th_2 = tgt_th16_proto.get_t2h_num_of_posts.call({lth:lth}) || 'no';\r\n//////                  if (pf_store!=='ALL' && (pf_store==='no' || pf_store==='passive' && pf_store_th_2!=='no'))\r\n//////                    if (pf_store_1!==pf_store_th_2) archiver.store_th_to_mem(value, th,lth, pf_store_th_2, null);\r\n//////                }\r\n////                if (pref[embed_mode].scroll_lock) pClg.show_catalog_scroll_lock.set();\r\n////                pClg.insert_thread(th, value.date, picked_up_by_kwd_filter, insert_thread_from_native_1); // insert_thread_from_native && ths[i].pn); // '&& ths[i].pn' for reentry.\r\n////                this.idx_reorder(th.key);\r\n////                tgts[th.key] = true;\r\n////                tgt_th = threads[th.key];\r\n////                if (tgt_th_status===undefined) {\r\n////                  var pf_store_2 = get_nof_store_posts(pf_store, tgt_th);\r\n////                  if (pf_store_1!==pf_store_2) archiver.store_th_to_mem(value, th,lth, pf_store_2, null);\r\n////                }\r\n////              } // else if (pref[embed_mode].load_on_demand) pClg.idx_reorder(th.key); // place thread before ODL. // changed. // implementation is changed.\r\n////              if (sb.from_auto && !tgt_th_status)\r\n////                if (pref.notify.desktop.notify || pref.notify.sound.notify) // lazy as much as possible\r\n////                  if (pClg.filter_test(th.key, tgt_th)) notifier.appeared(th,tgt_th_status===undefined);\r\n//////              if (sb.from_auto && !tgt_th_status && (pref.notify.desktop.notify || pref.notify.sound.notify)) {\r\n//////                if (tgt_th[9][0]===null) tgt_th[9] = catalog_filter_query(th.key, true); // tgt_th[9] is evaluated lazily.\r\n//////                if (tgt_th[9][0]) notifier.appeared(th,tgt_th_status===undefined);\r\n//////              }\r\n//////              if (sb.from_auto && (!tgt_th_status && tgt_th[9][0])) notifier.appeared(th,tgt_th_status===undefined);\r\n//////              } // else if (pref[embed_mode].load_on_demand && tgt_th) pClg.idx_reorder(th.key); // temporal, should be rewritten.  // place thread before ODL. // implementation is changed.\r\n//////              if (tgt_th_status!==undefined && tgt_th[16].expand_posts) insert_thread_format_html(th,th.key,false,false,th.type_data==='json'); // format_html.update_posts_in_page(th, th.key, true);\r\n////              if (tgt_th) {\r\n////                if (th.page) tgt_th[14] = th.page;\r\n////                gClg.footer.update(th.key, th.country && post_updated, (tgt_th_status!==undefined)? tag_updated : th.tags);\r\n////              }\r\n//////              if (tgt_th) insert_footer3(th.key,(post_updated)? th.flags:null, th.page, (tgt_th_status!==undefined)? tag_updated : th.tags, th);\r\n//////              if (pref.liveTag.use && i===0) scan.list_nup.add_board(th.domain+th.board, (th.type_source==='catalog')? value.date : null);\r\n//////              if (th.tags.q && th.parse_funcs.has_posts) site2[th.domain].popups_fetched(th); // stored AFTER modifying pn. // BUT, posts are deleted sometimes.\r\n////}\r\n//              sb.found_threads++;\r\n              if (post_updated && gClg.UnsyncedTriages[th.key]) triage_exe_pipe(gClg.UnsyncedTriages[th.key]); // temporarily patch\r\n////if (!pref.test_mode['133']) {\r\n////  ths_info[ths_info.length] = [th, lth, post_updated, tag_updated, insert_thread_from_native_1];\r\n////}\r\n            }\r\n            sb.found_threads += ths.length;\r\n////if (!pref.test_mode['133']) {\r\n////  for (var j=0;j<gClg.Clgs.length;j++) gClg.Clgs[j].insert_thread_1(ths, ths_info, refresh, sb, value.date, pf_store, value);\r\n////}\r\n////if (pref.test_mode['22']) {\r\n////            if (sb.scan_tag && from_catalog) tag_scan_board(ths, sb);\r\n////}\r\n//            for (var j=0;j<gClg.Clgs.length;j++) gClg.Clgs[j].idx_reorder_exe();\r\n            if (dbt[3]==='catalog_json' || dbt[3]==='catalog_html') {\r\n////              if (pref.liveTag.use) scan.list_nup.add_board(dbt[0]+dbt[1], value.date);\r\n              scan.list_nup.got_200_board(dbt[0],dbt[1]);\r\n              rm_items_404_check(dbt[0],dbt[1],ths, nos);\r\n              if (pref.test_mode['167'] && pref3.stats.use && stats) Object.defineProperty(liveTag.mems[dbt[0]][dbt[1]], 'st', {value:value.date, writable:true, configurable:true});\r\n//              if (pref[embed_mode].detect_sage && th.domain==='4chan' && dbt[3]==='catalog_json') site2['4chan'].sage_detect_all(ths);\r\n////              if (liveTag.mems[dbt[0]][dbt[1]] && liveTag.mems[dbt[0]][dbt[1]].f) { // 'liveTag.mems[dbt[0]][dbt[1]]' is for /popular/\r\n////                for (var i=0;i<ths.length;i++) scan.list_nup.add(ths[i].key);\r\n////                liveTag.mems[dbt[0]][dbt[1]].f = false;\r\n////              }\r\n//              if (liveTag.mems[dbt[0]][dbt[1]] && liveTag.mems[dbt[0]][dbt[1]].f) liveTag.mems[dbt[0]][dbt[1]].f = false; // 'liveTag.mems[dbt[0]][dbt[1]]' is for /popular/\r\n            }\r\n            if (pref.catalog_max_page_auto && (dbt[3]==='page_html' || (dbt[3]==='catalog_json' && site2[dbt[0]].parse_funcs[dbt[3]].get_max_page))) {\r\n              var max_page = site2[dbt[0]].parse_funcs[dbt[3]].get_max_page(value.response);\r\n              if (max_page) liveTag.mems[dbt[0]][dbt[1]].pgs = max_page;\r\n            }\r\n            if (pref[embed_mode].load_on_demand) {\r\n              var tgt = ths[ths.length-1];\r\n              if (tgt && tgt.type_source==='page' && (!site2[tgt.domain].all_boards || site2[tgt.domain].all_boards.indexOf(site.board)!=-1)) pClg.idx_raise_odl(tgt);\r\n            }\r\n            sb.found_boards++;\r\n////if (pref.test_mode['133']) {              \r\n////            if (Object.keys(tgts).length!==0) if (!sb.native_prep) show_catalog(tgts);\r\n////  //          if (pref.filter.tag_scan_auto) scan_tags();\r\n////} else {\r\n            /*if (!sb.native_prep)*/ for (var i=0;i<gClg.Clgs.length;i++) // show_catalog is requied to update footer even if sb.native_prep\r\n              if (gClg.Clgs[i].dirty) gClg.Clgs[i].show_catalog();\r\n//              if (gClg.Clgs[i].dirty) gClg.Clgs[i].show_catalog(undefined, null, null, gClg.Clgs[i].footer.query_update_without_data(dbt[3]!=='thread_json' && dbt[3]!=='thread_html')); // call even if tgts[i] is vacant\r\n//              if (gClg.Clgs[i].dirty) if (Object.keys(tgts[i]).length===0 || gClg.Clgs[i].show_catalog(tgts[i])) gClg.Clgs[i].footer.update_without_updated_data(dbt[3]!=='thread_json' && dbt[3]!=='thread_html');\r\n//              if (Object.keys(tgts[i]).length===0 || gClg.Clgs[i].show_catalog(tgts[i])) if (refresh===gClg.Clgs[i]) gClg.Clgs[i].footer.update_without_updated_data();\r\n            if (sb.key==='mergeAuto' && gGEH.time_jumped) for (var i=0;i<ths.length;i++) jump_to_time(ths[i], gGEH.time_jumped); // this has racing condition, see receive_message\r\n////}\r\n  \r\n////////            if ((dbt[3]==='thread_html' || dbt[3]==='thread_json') && threads[ths[0].key]) update_thread(dbt[0]+dbt[1]+dbt[2], ths[0], threads[ths[0].key][19]); // patch  // working code.\r\n//            if ((dbt[3]==='thread_html' || dbt[3]==='thread_json') && threads[ths[0].key] && threads[ths[0].key][23]) update_thread(dbt[0]+dbt[1]+dbt[2], ths[0], threads[ths[0].key][19]); // patch to delete threads[name][23]\r\n////            if (dbt[3]==='thread_html') {\r\n////              var name = dbt[0] + dbt[1] + dbt[2];\r\n////              if (threads[name]) { // patch for parallel entry.\r\n////                site2[dbt[0]].check_reply.do(value.response, dbt, threads[name][19], threads[name][8], dbt[3]); // SHOULD CONSOLIDATE TO CHECK_REPLY.CHECK().\r\n////\r\n//////                if (threads[name][20]!==sb.pool.sticky) { // working code.\r\n//////                  site2[dbt[0]].add_sticky_info(threads[name][0],threads[name][18],sb.pool.sticky);\r\n//////                  threads[name][20] = sb.pool.sticky;\r\n//////                }\r\n////                if (threads[name][23]) {\r\n////                  threads[name][23] = false;\r\n////                  threads[name][9] = catalog_filter_query(name);\r\n////                }\r\n//////                if (pref.catalog_footer_show_nof_rep) site2[dbt[0]].insert_footer2(threads[name][0],threads[name][18],threads[name][19],threads[name][8]);\r\n////                if (pref.catalog_footer_show_nof_rep) insert_footer3(threads[name][24],threads[name][19],threads[name][8],name);\r\n////                threads[name][21] = false;\r\n////                if (threads[name][19][0]>=0) notifier.changed(name,threads);\r\n////                threads[name][19][5] = false;\r\n////                threads[name][19][4] = null; // for GC.\r\n////                reorder_thread_idx(name);\r\n//////var debug = '';\r\n//////for (var d=0;d<10;d++) debug += threads_idx[d] + ', ';\r\n//////console.log('ddd :'+debug);\r\n//////              if (reorder_thread_idx(name)) {\r\n//////                tgts = {};\r\n//////                tgts[name] = true;\r\n//////                show_catalog(tgts);\r\n//////              }\r\n////              }\r\n////            }\r\n//            if (sb.native_prep) return ths;\r\n}\r\n          } else { // DON'T USE TH.XXX BECAUSE MEGUCA DOESN'T HAVE.\r\n            if (value.status==404 && (dbt[3]==='thread_json' || dbt[3]==='thread_html')) {\r\n              var lth = liveTag.mems.getFromName(dbt[0]+dbt[1]+dbt[2]);\r\n              if (pref.test_mode['146']) if (lth.q && lth.q.waiting) {\r\n                var lth_w = {domain_html:site.nickname, time:0, com:'PRUNED', type_source:'thread', __proto__:lth};\r\n                site2[dbt[0]].popups_fetched({posts:[lth_w], __proto__:lth_w}, lth);\r\n              }\r\n              rm_items_404_th(dbt[0],dbt[1],dbt[2]);\r\n//              liveTag.rm_404_1(dbt[0],dbt[1],dbt[2]);\r\n              scan.list_nup.got_404(dbt[0] + dbt[1] + dbt[2]);\r\n            }\r\n            if (sb.found_threads<sb.max_threads) {\r\n////////              sb.error += ((sb.error==='')? '' : ', ') + key;\r\n////////              sb.error_obj[key] = value.status;\r\n              if (value.status==404) comment_out_bookmark(key);\r\n////              if (sb.indicator) {\r\n////                sb.indicator.report({err_str:key+'('+value.status+')'});\r\n////                sb.indicator.set('orange');\r\n////              }\r\n            }\r\n            if (value.response===null && value.status==200) { // patch for 8chan's inconsistency.\r\n              if (pref.debug_mode['16']) console.log('ERROR!!! Inconsistency in server. Server returned null with status 200 for '+site2[dbt[0]].make_url4(dbt)[0]+' , '+key);\r\n              value.status=-200;\r\n            }\r\n            if (value.status==404 && pref.catalog_max_page_auto && (dbt[3]==='page_json' || dbt[3]==='page_html')) {\r\n              var max_page = parseInt(dbt[2].replace(/^[pq]/,''),10);\r\n              if (!liveTag.mems[dbt[0]][dbt[1]].pgs || max_page<liveTag.mems[dbt[0]][dbt[1]].pgs) liveTag.mems[dbt[0]][dbt[1]].pgs = max_page;\r\n            }\r\n          }\r\n////          scan_boards_keyword(args,value.status);\r\n          if (sb.refresh && !pref.test_mode['65'] && pref.archive.IDB.auto_restore && ((dbt[0]+dbt[1]) in gClg.IDB_req) &&\r\n              (dbt[3]=='catalog_json' || dbt[3]==='catalog_html' || dbt[3]=='page_json' || dbt[3]==='page_html') && !window.opener) {\r\n            restore_bd_from_IDB(dbt[0], dbt[1]);\r\n            delete gClg.IDB_req[dbt[0]+dbt[1]];\r\n          }\r\n//          if (sb.refresh && !pref.test_mode['65'] && pref.archive.IDB.auto_restore && (!threads_delayed_pruning[dbt[0]] || !threads_delayed_pruning[dbt[0]][dbt[1]]) &&\r\n//              (dbt[3]=='catalog_json' || dbt[3]==='catalog_html' || dbt[3]=='page_json' || dbt[3]==='page_html') && !window.opener) restore_bd_from_IDB(dbt[0], dbt[1]);\r\n          return ths;\r\n        }\r\n        cataLog.scan_boards_keyword_callback2 = scan_boards_keyword_callback2;\r\n        function get_nof_store_posts(pf_store, tgt_th){\r\n          var pf_store_th = tgt_th && tgt_th[16].get_t2h_num_of_posts() || 'no';\r\n          return (pf_store==='ALL' || (pf_store==='acc' || pref[embed_mode].storePosts==='ALL') && tgt_th)? -1\r\n            : (pf_store==='no' || pf_store==='passive' && pf_store_th!=='no')? pf_store_th : pf_store;\r\n        }\r\n\r\n////        Clg.prototype.insert_thread_1 = function(ths, ths_info, refresh, sb, value_date, pf_store, value){\r\n////          var pfm = this.pref[this.mode];\r\n////          var filter_active_kwd = this.pref.filter.kwd.active;\r\n////          var filter_active_tag = this.pref.filter.tag && this.liveTag.active.in; // for passive\r\n////          var tgts = {};\r\n////          for (var i=0;i<ths.length;i++) {\r\n////            var th = ths_info[i][0];\r\n////            var lth = ths_info[i][1];\r\n////            var post_updated = ths_info[i][2];\r\n////            var tag_updated = ths_info[i][3];\r\n////            var insert_thread_from_native_1 = ths_info[i][4];\r\n////            var tgt_th = this.threads[th.key];\r\n        Clg.prototype.insert_thread_1 = function(th, lth, post_updated, tag_updated, clg_args, value, nos, sb_merge){\r\n//          var pfm = pref[embed_mode]; // CAUTION: embed_mode is used intentionally. // this.pref[this.mode];\r\n//          var pfcm = this.pref[this.mode];\r\n          var th_key = th.key;\r\n          var tgt_th = this.threads[th_key];\r\n          var new_th = tgt_th===undefined;\r\n//          var undo = (th_key in this.ths_undo);\r\n//          if (undo) delete this.ths_undo[th_key];\r\n          var refresh_or_search = clg_args.refresh || this.refresh_tgts[th.domain+th.board]===null ||\r\n              this.view!=='thread' && (\r\n                                  clg_args.ALL_agg && th.type_source==='thread' || // pick_up_for_search\r\n                                  clg_args.pf_fKwd && catalog_filter_query_keyword.kwd(clg_args.pf_fKwd, th.posts, th.domain) || // picked_up_by_kwd_filter\r\n                                  clg_args.pf_fTag && liveTag.search_by_tags(lth)); // picked_up_by_tag_filter\r\n//              var pick_up_for_search = th.type_source==='thread' && pfm.storePosts==='ALL_agg';\r\n//              var picked_up_by_kwd_filter = this.pref.filter.kwd.active && catalog_filter_query_keyword.kwd(this.pref.filter.kwd, th.posts, th.domain);\r\n//              var picked_up_by_tag_filter = this.pref.filter.tag && this.liveTag.active.in && liveTag.search_by_tags(lth);\r\n//              var picked_up_by_filter = picked_up_by_kwd_filter || picked_up_by_tag_filter;\r\n//          tag_updated |= (tgt_th===undefined); // force update tags at initial\r\n//              var tgt_th_status = (tgt_th===undefined)? undefined : tgt_th[9][0];\r\n//              var force_update = (tgt_th && (tgt_th[16].expand_posts || (th.type_source==='thread' && (tgt_th[16].needs_update===true || tgt_th[16].needs_update===1)))) || pick_up_for_search;\r\n//          var force_update = (tgt_th && (tgt_th[16].expand_posts || (tgt_th[16].missing_info && tgt_th[16].missing_info>(th.missing_info|0)))) ||\r\n//                                 lth.ed_u<th.replyTime || pick_up_for_search;\r\n////              var force_update = (tgt_th && (tgt_th[16].expand_posts || (th.type_source==='thread' &&\r\n////                (tgt_th[16].needs_update===true || (tgt_th[16].needs_update<th.replyTime || tgt_th[16].needs_update===null))))) || pick_up_for_search;\r\n////              if (refresh || (post_updated && tgt_th) || picked_up_by_filter || force_update) {\r\n////              if (!sb.tag_only && (sb.refresh || (post_updated && tgt_th) || picked_up_by_filter)) {\r\n////              if (!sb.tag_only && (sb.refresh || (filter_active && catalog_filter_query_scan(th.posts, th.tags)))) {\r\n//////////                if (insert_thread_with_test(th, dbt[3], value.date)) {// RUNS A REDUNDANT POST CHECK AT FIRST TIME....\r\n////              if (tgt_th && (refresh || picked_up_by_filter) && (post_updated===null || pref.test_mode['166'] && post_updated===false)) { // doesn't work\r\n          if (tgt_th) {\r\n            if (post_updated===null) {\r\n//              if (post_updated===null && tgt_th) { // && refresh_or_search) {\r\n//              if (post_updated===null && tgt_th && (refresh || picked_up_by_filter)) {\r\n////                if (post_updated===null && tgt_th) {\r\n              var tgt_th8 = tgt_th[8]; // must be sonsolidated to lth\r\n              post_updated = !((((tgt_th8[0]>tgt_th8[4])? tgt_th8[0] : (tgt_th8[4] || tgt_th8[0])) >= ((th.time_bumped > th.time_posted)? th.time_bumped : (th.time_posted || th.time_bumped))) && // vichan has inconsistency in time between catalog.json and thread.json.\r\n                               tgt_th8[2]==th.nof_posts && tgt_th8[3]==th.nof_files); // || th.type_source==='thread'; // pass thread to revise all of tgt_th[8] // <- should use missing_info\r\n            }\r\n            if (!post_updated) {\r\n              var tgt_th16 = tgt_th[16];\r\n              post_updated |= tgt_th16.expand_posts || tgt_th16.missing_info && tgt_th16.missing_info>(th.missing_info|0) || lth.ed_u<th.replyTime; // ed_u msut be consolidated to missing_info or tgt_th8[4]\r\n            }\r\n          }\r\n          if (tgt_th && post_updated || !tgt_th && refresh_or_search) {\r\n//              if (post_updated && (tgt_th || pfcm.promiscuous) || (refresh || picked_up_by_filter) && !tgt_th || force_update) { // stop merging at preparing cross-thread popup\r\n////              if (post_updated || (refresh || picked_up_by_filter) && !tgt_th || force_update) {\r\n////              if (post_updated || picked_up_by_filter || tgt_th_status===undefined || force_update) {\r\n////                if (!tgt_th) { // PATCH, WILL BE REMOVED BY CONSOLIDATING.\r\n////                  var pf_store_th_2 = tgt_th16_proto.get_t2h_num_of_posts.call({lth:lth}) || 'no';\r\n////                  if (pf_store!=='ALL' && (pf_store==='no' || pf_store==='passive' && pf_store_th_2!=='no'))\r\n////                    if (pf_store_1!==pf_store_th_2) archiver.store_th_to_mem(value, th,lth, pf_store_th_2, null);\r\n////                }\r\n                /*if (pfm.scroll_lock) this.show_catalog_scroll_lock.set();*/\r\n//            this.idx_reorder(th_key, tgt_th? 0x03 : 0x01); // will be moved to here after removing pref_test.mode['169']\r\n            tgt_th = this.insert_thread(th, value.date, sb_merge, nos); // insert_thread_from_native && ths[i].pn); // '&& ths[i].pn' for reentry.\r\n            /*var order_new =*/ this.idx_reorder(th_key, new_th); // true);\r\n                /*tgts[th.key] = true;*/\r\n////                tgt_th = this.threads[th.key];\r\n//                if (!tgt_th_g && gClg.AllThreads[th_key]===undefined) {\r\n////                if (tgt_th_status===undefined) { // BUG, this can't track proper number of posts when watcher's view is page and it is expanded.\r\n//                  var pf_store_2 = get_nof_store_posts(pf_store, tgt_th); // depends on embed_mode, not this.mode, so all clg have the same number of stored poste.\r\n//                  if (pf_store_1!==pf_store_2) archiver.store_th_to_mem(value, th,lth, pf_store_2, null);\r\n//                  if (pf_notify_new_thread && this.filter_test(th_key, tgt_th)) notifier.appeared(th, true); // 'appeared' was dropped.\r\n////                    if (pref.notify.desktop.notify && pref.notify.desktop.new_thread || pref.notify.sound.notify && pref.notify.sound.new_thread) // lazy as much as possible\r\n////                      if (this.filter_test(th_key, tgt_th)) notifier.appeared(th, true); // 'appeared' was dropped.\r\n//                  gClg.AllThreads[th_key] = tgt_th;\r\n//                }\r\n          } // else if (undo && tgt_th) {/*order_new =*/ this.idx_reorder(th_key, true); /*tgts[th.key] = true;*/} // patch for rewinding watchtime\r\n//              if (undo) delete this.ths_undo[th_key];\r\n//              if (sb.from_auto && (!tgt_th_status && tgt_th[9][0])) notifier.appeared(th,tgt_th_status===undefined);\r\n//              } // else if (pfm.load_on_demand && tgt_th) pClg.idx_reorder(th.key); // temporal, should be rewritten.  // place thread before ODL. // implementation is changed.\r\n//              if (tgt_th_status!==undefined && tgt_th[16].expand_posts) insert_thread_format_html(th,th.key,false,false,th.type_data==='json'); // format_html.update_posts_in_page(th, th.key, true);\r\n          if (tgt_th) {\r\n            var page_updated = th.page && tgt_th[14]!=th.page;\r\n            if (page_updated) tgt_th[14] = th.page;\r\n            if (post_updated || new_th || clg_args.pf_foPg && page_updated) {\r\n              this.footer.update(th_key, post_updated && th.country, tag_updated || new_th); // , order_new);\r\n//                this.footer.update(th_key, post_updated && th.country, (tgt_th_status!==undefined)? tag_updated : th.tags); // , order_new);\r\n              this.dirty |= 0x01;\r\n            }\r\n          }\r\n          return tgt_th;\r\n//              if (tgt_th) insert_footer3(th.key,(post_updated)? th.flags:null, th.page, (tgt_th_status!==undefined)? tag_updated : th.tags, th);\r\n//              if (pref.liveTag.use && i===0) scan.list_nup.add_board(th.domain+th.board, (th.type_source==='catalog')? value.date : null);\r\n//              if (th.tags.q && th.parse_funcs.has_posts) site2[th.domain].popups_fetched(th); // stored AFTER modifying pn. // BUT, posts are deleted sometimes.\r\n\r\n////          }\r\n////          if (Object.keys(tgts).length!==0 && (!sb.native_prep || this!==pClg)) {\r\n////            sb.found_boards++;\r\n////            this.show_catalog(tgts);\r\n////  //        if (pref.filter.tag_scan_auto) scan_tags();\r\n////          }\r\n        };\r\n\r\n        ////        function tag_scan_extract_1(pn) { // working code.\r\n////          return pn[brwsr.innerText].match(tags_scan_regex);\r\n////        }\r\n////        function tag_scan_board(ths, sb) { // patch\r\n////          var ths_tag = {};\r\n////          for (var i=0;i<ths.length;i++) ths_tag[ths[i].key] = ths[i];\r\n////          scan_tags_common(ths_tag,'',sb.pool.tags);\r\n////        }\r\n\r\n////        function tag_scan_extract_1(key,pn,sb) {\r\n////          pn.tags = pn[brwsr.innerText].match(tags_scan_regex);\r\n////          var ths = {};\r\n////          ths[key] = pn;\r\n////          scan_tags_common(ths,'',sb.pool.tags);\r\n////  //        scan_tags_common({key:pn},'',sb.pool.tags,true);\r\n////  //        return pn.tags;\r\n////        }\r\n\r\n////////        function scan_boards_keyword_callback2(key,value,args){\r\n////////          var sb = args[1];\r\n////////          if (pref.scan.crawler_adaptive) scan_boards_crawler_timer_clear();\r\n////////          sb.pool.dbt = cnst.name2domainboardthread(key,true);\r\n////////          if (value.status==200 && sb.found_threads<sb.max_threads) {\r\n////////            if (sb.pool.dbt[2]=='j0' || sb.pool.dbt[2]=='c0') {\r\n////////              if (sb.pool.dbt[2]=='j0') {\r\n////////                sb.pool.type = 'catalog_json';\r\n////////                sb.pool.doc = ('response' in value)? value.response : JSON.parse(value.responseText);\r\n////////                var obj = sb.pool.doc;\r\n//////////                var obj = ('response' in value)? value.response : JSON.parse(value.responseText);\r\n////////    //            if (sb.scan_tag) {\r\n////////    //              for (var i=0;i<obj.length;i++) {\r\n////////    //                for (var j=0;j<obj[i].threads.length;j++) {\r\n////////    //                  sb.pool.div.innerHTML = obj[i].threads[j].com;\r\n////////    //                  obj[i].threads[j].tags = tag_scan_extract_1(sb.pool.dbt[0]+sb.pool.dbt[1]+obj[i].threads[j].no,sb.pool.div,sb);\r\n////////    //                }\r\n////////    //            }}\r\n////////                for (var i=0;i<obj.length;i++) {\r\n////////                  if (obj[i].threads) {\r\n////////                    sb.scanned += obj[i].threads.length;\r\n////////                    for (var j=0;j<obj[i].threads.length;j++) {\r\n////////                      sb.name = sb.pool.dbt[0]+sb.pool.dbt[1]+obj[i].threads[j].no;\r\n//////////                      if (threads[sb.name] && threads[sb.name][20]!==obj[i].threads[j].sticky) { // working code.\r\n//////////                        site2[sb.pool.dbt[0]].add_sticky_info(threads[sb.name][0],threads[sb.name][18],obj[i].threads[j].sticky);\r\n//////////                        threads[sb.name][20] = obj[i].threads[j].sticky;\r\n////////////                        reorder_thread_idx(sb.pool.dbt[0] + sb.pool.dbt[1] +sb.pool.dbt[2].substr(1)); doesn't prepared threads[];\r\n//////////                      }\r\n////////                      if (sb.scan_tag) {\r\n////////                        sb.pool.div.innerHTML = obj[i].threads[j].com + '\\n' + obj[i].threads[j].sub + '\\n' + obj[i].threads[j].name;\r\n////////                        tag_scan_extract_1(sb.pool.dbt[0]+sb.pool.dbt[1]+obj[i].threads[j].no,sb.pool.div,sb);\r\n////////                      }\r\n//////////                      var search_obj = [obj[i].threads[j].com, obj[i].threads[j].sub, obj[i].threads[j].name,'','','','',''];\r\n//////////                      if (!catalog_filter_query_scan(search_obj,sb.pool.div.tags)) {obj[i].threads.splice(j,1);j--;}\r\n////////                      if (!catalog_filter_query_scan(obj[i].threads[j],sb.pool.div.tags)) {obj[i].threads.splice(j,1);j--;}\r\n////////                    }\r\n////////                  }\r\n////////                }\r\n////////    //            for (var i=0;i<obj.length;i++) sb.scanned += obj[i].threads.length; // NOT SO FAST.\r\n////////    //            var kwd = pref.filter.kwd.str;\r\n////////    //            if (pref.filter.kwd && kwd!=='') {\r\n////////    //              if (!pref.filter.kwd.re) kwd = kwd.replace(/\\*/g,'.*');\r\n////////    //              if (pref.filter.kwd.ci) kwd = new RegExp(kwd,'i');\r\n////////    //              for (var i=0;i<obj.length;i++) {\r\n////////    //                for (var j=obj[i].threads.length-1;j>=0;j--) {\r\n////////    //                  var str = obj[i].threads[j].name + '\\n' + obj[i].threads[j].sub + '\\n' + obj[i].threads[j].com;\r\n////////    //                  var result = (str.search(kwd)!=-1);\r\n////////    //                  if (pref.filter.kwd.match==='unmatch') result = !result;\r\n////////    //                  if (!result) obj[i].threads.splice(j,1);\r\n////////    //                }\r\n////////    //              }\r\n////////    //            }\r\n////////                if ((pref.filter.kwd.use && pref.filter.kwd.str!=='') || (pref.filter.tag && filter_tags.length!=0))\r\n////////                  sb.pool.ths = site2[sb.pool.dbt[0]].catalog_from_json3(obj,sb.pool.dbt[1]); // heavy, and cause loading in chrome.\r\n////////                else sb.pool.ths = [];\r\n////////              } else {\r\n////////                sb.pool.type = 'catalog_html';\r\n////////                sb.pool.doc = ('response' in value)? value.response : sb.pool.parser.parseFromString(value.responseText, 'text/html');\r\n////////                sb.pool.ths = site2[sb.pool.dbt[0]].catalog_from_native(value.date,sb.pool.doc,sb.pool.dbt[1],sb.pool.type);\r\n////////    //            if (sb.scan_tag) for (var i=0;i<sb.pool.ths.length;i++) sb.pool.ths[i].tags = tag_scan_extract_1(sb.pool.dbt[0]+sb.pool.dbt[1]+sb.pool.ths[i].no,sb.pool.ths[i].pn,sb);\r\n////////                sb.scanned += sb.pool.ths.length;\r\n////////                for (var i=0;i<sb.pool.ths.length;i++) {\r\n////////                  if (sb.scan_tag) tag_scan_extract_1(sb.pool.dbt[0]+sb.pool.dbt[1]+sb.pool.ths[i].no,sb.pool.ths[i].pn,sb);\r\n////////                  if (!catalog_filter_query_scan(sb.pool.ths[i],sb.pool.ths[i].pn.tags)) {sb.pool.ths.splice(i,1);i--;}\r\n////////                }\r\n////////              }         \r\n////////              if (sb.pool.ths.length!=0 && ((pref.filter.kwd.use && pref.filter.kwd.str!=='') || (pref.filter.tag && filter_tags.length!=0))) {\r\n////////                sb.found_boards++;\r\n////////                sb.found_threads += sb.pool.ths.length;\r\n////////                sb.pool.tgts = {};\r\n////////                for (var i=0;i<sb.pool.ths.length;i++) {\r\n////////                  insert_thread_with_test(sb.pool.ths[i], sb.pool.type, value.date); // patch\r\n//////////                  insert_thread_from_native(sb.pool.ths[i], sb.pool.dbt[0], sb.pool.dbt[1], false, value.date);\r\n////////                  sb.pool.tgts[sb.pool.dbt[0]+sb.pool.dbt[1]+sb.pool.ths[i].no] = true;\r\n////////                }\r\n////////                show_catalog(sb.pool.tgts);\r\n////////    //            if (pref.filter.tag_scan_auto) scan_tags();\r\n////////              }\r\n////////            } else {\r\n////////              var name = sb.pool.dbt[0] + sb.pool.dbt[1] + ((sb.pool.dbt[2][0]==='t')? sb.pool.dbt[2].substr(1) : sb.pool.dbt[2]);\r\n////////              if (threads[name]) { // patch for parallel entry.\r\n////////                sb.pool.type = (sb.pool.dbt[2][0]!=='t')? 'thread_html' : 'thread_json';\r\n////////                if (sb.pool.dbt[2][0]!=='t') sb.pool.doc = ('response' in value)? value.response : sb.pool.parser.parseFromString(value.responseText, 'text/html');\r\n//////////                site2[sb.pool.dbt[0]].check_reply_to_me(name,sb.pool.dbt,threads[name][19],(sb.pool.dbt[2][0]!=='t')? sb.pool.doc : value);\r\n//////////var time_0 = performance.now();\r\n//////////                site2[sb.pool.dbt[0]].check_reply_to_me(name,sb.pool.dbt,threads[name][19],(sb.pool.dbt[2][0]!=='t')? sb.pool.doc : value,threads[name][8], sb.pool, sb.pool.type); // also checks sage.\r\n//////////                site2[sb.pool.dbt[0]].check_reply_to_me(name,sb.pool.dbt,threads[name][19],(sb.pool.dbt[2][0]!=='t')? sb.pool.doc : value.response, threads[name][8], sb.pool, sb.pool.type); // also checks sage.\r\n////////                site2[sb.pool.dbt[0]].check_reply.do((sb.pool.dbt[2][0]!=='t')? sb.pool.doc : value.response, sb.pool.dbt, threads[name][19], threads[name][8], sb.pool.type);\r\n////////\r\n//////////                if (threads[name][19][0]>threads[name][8][4]) threads[name][19][0] = -1; // 2015.05.01 removed, but I don't remember why I wrote this.\r\n////////\r\n//////////console.log('check_reply :'+name+', '+(performance.now()-time_0));\r\n//////////                if (threads[name][20]!==sb.pool.sticky) { // working code.\r\n//////////                  site2[sb.pool.dbt[0]].add_sticky_info(threads[name][0],threads[name][18],sb.pool.sticky);\r\n//////////                  threads[name][20] = sb.pool.sticky;\r\n//////////                }\r\n////////                if (threads[name][23]) {\r\n////////                  threads[name][23] = false;\r\n////////                  threads[name][9] = catalog_filter_query(name);\r\n////////                }\r\n//////////                if (pref.catalog_footer_show_nof_rep) site2[sb.pool.dbt[0]].insert_footer2(threads[name][0],threads[name][18],threads[name][19],threads[name][8]);\r\n////////                if (pref.catalog_footer_show_nof_rep) insert_footer3(threads[name][24],threads[name][19],threads[name][8],name);\r\n////////                threads[name][21] = false;\r\n////////                if (threads[name][19][0]>=0) notifier.changed(name,threads);\r\n////////                threads[name][19][5] = false;\r\n////////                threads[name][19][4] = null; // for GC.\r\n////////                reorder_thread_idx(name);\r\n//////////var debug = '';\r\n//////////for (var d=0;d<10;d++) debug += threads_idx[d] + ', ';\r\n//////////console.log('ddd :'+debug);\r\n//////////              if (reorder_thread_idx(name)) {\r\n//////////                sb.pool.tgts = {};\r\n//////////                sb.pool.tgts[name] = true;\r\n//////////                show_catalog(sb.pool.tgts);\r\n//////////              }\r\n////////              }\r\n////////            }\r\n////////          } else {\r\n////////            if (value.status==404 && (sb.pool.dbt[2][0]=='t' || sb.pool.dbt[2].search(/^[0-9]/)!=-1)) {\r\n////////              var name = sb.pool.dbt[0] + sb.pool.dbt[1] + ((sb.pool.dbt[2][0]==='t')? sb.pool.dbt[2].substr(1) : sb.pool.dbt[2]);\r\n////////              remove_thread(name);\r\n////////            }\r\n////////            if (sb.found_threads<sb.max_threads) sb.error += ((sb.error==='')? '' : ', ') + key;\r\n////////          }\r\n////////          sb.pool.doc = null;\r\n////////          scan_boards_keyword(args,value.status);\r\n////////        }\r\n////////  \r\n////////        function tag_scan_extract_1(key,pn,sb) {\r\n////////  //        sb.pool.tags[key] = {};\r\n////////  //        var tags = pn[brwsr.innerText].match(tags_scan_regex);\r\n////////  //        sb.pool.tags[key].tags = tags;\r\n////////  ////        var tags = div[brwsr.innerText].match(tags_scan_regex);\r\n////////  ////        if (tags) {\r\n////////  ////          var tags_uniq = {};\r\n////////  ////          for (var k=0;k<tags.length;k++) tags_uniq[tags[k]] = 1;\r\n////////  ////          for (var k in tags_uniq) {\r\n////////  ////            if (sb.pool.tags[k]===undefined) sb.pool.tags[k] = [];\r\n////////  ////            sb.pool.tags[k].push(key);\r\n////////  ////          }\r\n////////  ////        }\r\n////////  //        return tags;\r\n////////          pn.tags = pn[brwsr.innerText].match(tags_scan_regex);\r\n////////          var ths = {};\r\n////////          ths[key] = pn;\r\n////////          scan_tags_common(ths,'',sb.pool.tags);\r\n////////  //        scan_tags_common({key:pn},'',sb.pool.tags,true);\r\n////////  //        return pn.tags;\r\n////////        }\r\n        cataLog.scan_init = scan_init;\r\n        return {\r\n          scan_init: scan_init,\r\n          scan_abort: function(key){scan_init(key, {}, {});},\r\n          scan_boards_keyword_callback2: scan_boards_keyword_callback2,\r\n//          update_thread: update_thread,\r\n////          priority_up: crawler.priority_up,\r\n////          priority_release: crawler.priority_release,\r\n//          get_nof_store_posts: get_nof_store_posts,\r\n          args_proto: scan_boards.args_proto,\r\n        }\r\n      }());\r\n      cataLog.scan_boards = scan_boards;\r\n\r\n//      function catalog_resized(myself) {\r\n//        var tgt;\r\n//        if ((pref.catalog.text_mode.mode==='graphic' && (myself.name==='catalog_size_text_width' || myself.name==='catalog_size_text_height')) ||\r\n//            (pref.catalog.text_mode.mode==='text'    && (myself.name==='catalog_size_width'      || myself.name==='catalog_size_height'))) return;\r\n//        else tgt = myself.name.substr(myself.name.lastIndexOf('_')+1);\r\n//        var val = (pref[myself.name]==0)? '' : pref[myself.name] + 'px';\r\n//        for (var i in threads) threads[i][0].style[tgt] = val;\r\n////        for (var i in threads) {\r\n////          threads[i][0].style.width  = (pref.catalog_size_width==0 )? '' : pref.catalog_size_width  + 'px';\r\n////          threads[i][0].style.height = (pref.catalog_size_height==0)? '' : pref.catalog_size_height + 'px';\r\n////        }\r\n//      }\r\n//      var auto_update = (function(){ // working code\r\n//        var timer = null;\r\n//        var time_remains = 0;\r\n//        var timer_tgt = function(from_refresh_button){\r\n//          timer=null;\r\n//          catalog_refresh(true,null,!from_refresh_button);\r\n//          auto_update.set();\r\n//        }\r\n//        function stop_if_running(){\r\n//          if (timer) {clearTimeout(timer); timer=null;}\r\n//          if (pref.catalog_auto_update_countdown) health_indicator.pn_countdown.textContent = '';\r\n//        }\r\n//        function countdown(){\r\n//          health_indicator.pn_countdown.textContent = time_remains--;\r\n//          if (time_remains<0) timer_tgt();\r\n//          else timer = setTimeout(countdown,1000);\r\n//        }\r\n//        return {\r\n//          set : function(){\r\n//            stop_if_running();\r\n//            if (pref[embed_mode].auto_update) {\r\n//              var period = pref[embed_mode].auto_update_period || 0.5;\r\n//              if (!pref.catalog_auto_update_countdown) timer = setTimeout(timer_tgt,period*60000);\r\n//              else {\r\n//                time_remains = period*60;\r\n//                countdown();\r\n//              }\r\n//            }\r\n//          },\r\n//          stop_if_running: stop_if_running,\r\n//          timer_tgt : function(){\r\n//            if (timer) {clearTimeout(timer); timer=null;}\r\n//            timer_tgt(true);\r\n//          }\r\n//        }\r\n//      })();\r\n//      cataLog.auto_update = auto_update;\r\n//      if (site.whereami!=='archive') auto_update.set();\r\n//      var auto_update_timer = null; // working code.\r\n//      function set_auto_update(){\r\n//        if (auto_update_timer) {clearTimeout(auto_update_timer);auto_update_timer=null;}\r\n//        if (pref.catalog_auto_update) {\r\n//          var period = pref.catalog_auto_update_period;\r\n//          auto_update_timer=setTimeout(function(){auto_update_timer=null;catalog_refresh(true,null,true);},period*60000);\r\n//        }\r\n//      }\r\n//      set_auto_update();\r\n\r\n////      pn_filter.getElementsByTagName('*')['filter.tag_search.str'].onkeyup = function(){ // working code.\r\n////        pref_func.apply_prep(this,true);\r\n////        liveTag.filter_onchange();\r\n////      }\r\n////      if (!pref.filter.show) pn_filter.style.display = 'none';\r\n//      pn_filter.style.display = 'none';\r\n////      pn_filter.getElementsByTagName('*')['filter.kwd.str'].onkeyup = function(){ // working code.\r\n////        pref_func.apply_prep(this,true,true);\r\n////        if ((!pref.filter.kwd.use && this.value!=='') || (pref.filter.kwd.use && this.value==='')) {\r\n////          pref.filter.kwd.use = !pref.filter.kwd.use;\r\n////          var use = pn_filter.getElementsByTagName('*')['filter.kwd.use'];\r\n////          pref_func.apply_prep(use,false,true);\r\n////        }\r\n////      }\r\n\r\n//      var filter_time_str = pn_filter.getElementsByTagName('*')['filter.time_str'];\r\n////      pn_filter.getElementsByTagName('button')['now'].onclick = function(){set_time_str(Date.now());}\r\n////      var filter_time_ago_str = pn_filter.getElementsByTagName('*')['filter.time_ago_str'];\r\n////      filter_time_ago_str.onkeyup = ago_clicked;\r\n////      pn_filter.getElementsByTagName('button')['ago'].onclick= ago_clicked;\r\n//      function ago_clicked(e, time_in){\r\n////        if (time_in===undefined) {\r\n////          var str = filter_time_ago_str.value;\r\n////          var time_in = (parseInt(str.replace(/:.*/,''),10)*60+parseInt(str.replace(/[^:]*:/,''),10))*60000;\r\n////        }\r\n//        var time = Date.now() - time_in;\r\n//        filter_time_str.value = new Date(time).toLocaleString();\r\n//        pref_func.apply_prep(filter_time_str,true,true);\r\n//      }\r\n//      pn_filter.getElementsByTagName('button')['copy'].onclick =\r\n//        function(){\r\n//          pn_filter.getElementsByTagName('textarea')['filter.time_mark_str'].value=filter_time_str.value;\r\n//          pn_filter_changed();\r\n//        }\r\n//      var watch_list = pn_filter.getElementsByTagName('textarea')['filter.watch_list_str'];\r\n//      var search_ex_list = pn_filter.getElementsByTagName('textarea')['filter.list_str'];\r\n////      search_ex_list.onkeyup = pn_filter_changed;\r\n//      var attr_list = pn_filter.getElementsByTagName('textarea')['filter.attr_list_str'];\r\n//      attr_list.onkeyup = function(){if (pref.filter.attr_list) catalog_attr_changed();};\r\n//      pn_filter.onchange = pn_filter_changed;\r\n//      function pn_filter_changed(){\r\n//        pref_func.apply_prep(pn_filter,true);\r\n//        catalog_filter_changed();\r\n//      }\r\n\r\n////      function scan_tags(){ // working code.\r\n////        var ths = [];\r\n////        var j=0;\r\n////        for (var i in threads) {\r\n////          ths[j] = {};\r\n////          ths[j++].tags = threads[i][0][brwsr.innerText].match(tags_scan_regex); // ATTENTION. DESCRIPTION IS ALSO EXIST IN CATALOG_FILTER_QUERY().\r\n////        }\r\n////        var str2 = scan_tags_common(ths,'');\r\n////        scan_tags_init(str2,false);\r\n////      }\r\n\r\n//      function scan_tags_init(str2, reload){ // working code\r\n//if (pref.test_mode['22']) {\r\n//        var pn_tag_list = pn_filter.getElementsByTagName('div')['filter.tag_list'];\r\n//        if (reload!==null) pn_tag_list.onchange = function(){prep_tag_str(null, reload, true);};\r\n//        pn_tag_list.innerHTML = str2;\r\n//        if (pn_tag_list.style.height=='') pn_tag_list.style.height = '30px';\r\n//        if (pn_tag_list.style.width=='') pn_tag_list.style.width = '100px';\r\n////        prep_tag_str(true,reload);\r\n//        prep_tag_str(true,false);\r\n//}\r\n//      }\r\n//      var filter_tags = [];\r\n//      function prep_tag_str(keep,reload, from_onchange){\r\n//        var pn_tag_list = pn_filter.getElementsByTagName('div')['filter.tag_list'];\r\n//        var cbxes = pn_tag_list.getElementsByTagName('input');\r\n//        if (keep===true) {\r\n//          for (var i=0;i<filter_tags.length;i++) filter_tags[i] = filter_tags[i].toString().replace(/^\\//,'').replace(/\\(.*\\n*.*/,'');\r\n//          var tags = [];\r\n//          for (var i=0;i<cbxes.length;i++) tags[i] = cbxes[i].nextSibling.textContent.replace(/ [0-9]*: /,'');\r\n//          for (var i=0;i<filter_tags.length;i++)\r\n//            for (var j=0;j<cbxes.length;j++)\r\n//              if (tags[j]==filter_tags[i]) cbxes[j].checked = true;\r\n//        }\r\n//        filter_tags = [];\r\n//        var tgts = {};\r\n//        var flag = false;\r\n//        for (var i=0;i<cbxes.length;i++)\r\n//          if (cbxes[i].checked) {\r\n//            filter_tags.push(new RegExp(cbxes[i].nextSibling.textContent.replace(/ [0-9]*: /,'').replace(/$/,'(#|,| |\\\\.|:|;|\\n|$)'),(pref.filter.tag_ci)? 'i' : '')); // ATTENTION. REFER tag_scan_regex.\r\n//            if (reload) {\r\n//              var tags_tgt = (pref.filter.tag_ci)? site3[site.nickname].tags.ci[i].mem : site3[site.nickname].tags.cs[i].mem;\r\n//              for (var j in tags_tgt) tgts[j] = null;\r\n//            }\r\n//            flag = true;\r\n//          }\r\n//        if (from_onchange && flag) {\r\n//          pref.filter.tag = true;\r\n//          pref_func.apply_prep(pn12_0_4.getElementsByTagName('input')['filter.tag'],false);\r\n//        }\r\n//        if (pref.filter.tag) catalog_filter_changed();\r\n////        pn_filter_changed();\r\n//        if (reload) {\r\n////          for (var i in tgts) console.log(i);\r\n//\r\n////          load_list.tag.tgts = []; // working code.\r\n////          for (var i in tgts) load_list.tag.tgts.push(i+'c0');\r\n//////          load_list.tag.use_cache = !refresh;\r\n////          load_list.tag.idx = 0;\r\n////          load_list.tag.mutex = true;\r\n////          load_list.tag.from_auto = false;\r\n////          load_list.tag.tgts = trim_list(load_list.tag.tgts,false);\r\n////          if (pref.catalog_refresh_clear) catalog_clear_threads(pref.catalog.max_threads_at_refresh);\r\n////          if (load_list.tag.idx<load_list.tag.tgts.length) get_page(load_list.tag);\r\n//          scan_boards.scan_init('refresh_tag',tgts, {lifetime:pref.scan.lifetime*60, cache_write:true});\r\n////          set_auto_update();\r\n//          filter_tags_refresh_mem = tgts;\r\n//        }\r\n//      }\r\n\r\n//      function load_save_key(){\r\n//        return pref.script_prefix + '.catalog.adv_str.' + pref.catalog_board_list_obj[board_sel.selectedIndex][0].key;\r\n//      }\r\n//      pn_filter.getElementsByTagName('button')['load_adv_str'].onclick = function(){\r\n//        if (localStorage) {\r\n//          var tmp = JSON.parse(localStorage.getItem(load_save_key()));\r\n//          if (tmp) {\r\n//            search_ex_list.value = tmp[0];\r\n//            attr_list.value = tmp[1];\r\n//          }\r\n//        }\r\n//      };\r\n//      pn_filter.getElementsByTagName('button')['save_adv_str'].onclick = function(){if (localStorage) localStorage.setItem(load_save_key(),JSON.stringify([search_ex_list.value,attr_list.value]));};\r\n      \r\n//      pn_filter.childNodes[11].onclick= function(){\r\n//        var str = pn_filter.childNodes[10].value;\r\n//        var time = Date.now() - (parseInt(str.replace(/:.*/,''),10)*60+parseInt(str.replace(/[^:]*:/,''),10))*60000;\r\n//        pn_filter.childNodes[8].value = new Date(time).toLocaleString();\r\n//        pref_func.apply_prep(pn_filter,true);\r\n//        catalog_filter_changed();\r\n//      };\r\n//      if (pn12_0_2.childNodes[0].checked) cnst.show_hide(pn_filter);\r\n//      pn12_1.style.width  = '';\r\n//      pn12_1.style.height = '';\r\n\r\n      var scroll_event_src = (embed_embed)? ((site2[site.nickname].catalog_get_native_scroll_area)? site2[site.nickname].catalog_get_native_scroll_area() : window) :\r\n                                            triage_parent.parentNode;\r\n//      var scroll_event_src = (embed_embed)? window : triage_parent;\r\n      var triage_merge_base = null;\r\n      Clg.prototype.set_merge_base = function(name, attr, pn){\r\n        var pn_old = triage_merge_base && triage_merge_base.pn;\r\n        if (attr) attr.split(';').forEach(function(v){\r\n          var s = v.split(':');\r\n          pn.style[s[0]] = s[1];\r\n          if (pn_old) pn_old.style[s[0]] = ''; // must be the latter for toggle erase\r\n        });\r\n        triage_merge_base = {name:name, attr:attr, pn:(pn!==pn_old)? pn : null};\r\n      }\r\n      Clg.prototype.triage_event = function(key_base,cmd,attr, datetime, pn, et){ // , expanded){\r\n        var force_single = cmd.indexOf('s')!=-1;\r\n        if (force_single) {\r\n          cmd = cmd.replace(/s/,'');\r\n          if (typeof(key_base)!=='string') key_base = key_base.keys[0];\r\n        }\r\n        var name = (typeof(key_base)==='string')? key_base : key_base.keys[0];\r\n        if (cmd==='SPC') {return;}\r\n        if (cmd==='GO') {this.click_thread(name, 'force'); return;}\r\n        if (cmd==='MERGET' || cmd==='REMOVET' || cmd==='UNMERGET') {\r\n          var href = et.parentNode.previousSibling.getAttribute('href');\r\n          var tgt = site2[site.nickname].popups_href2dbtp(href).slice(0,3).join('');\r\n          et.parentNode.innerHTML = triage.htmls[cmd];\r\n          if (cmd==='MERGET') {\r\n            this.merge_bases.add_to_list_fromUI(site.key, tgt, this);\r\n            cmd = 'WATCH'; // return;\r\n          } else if (cmd==='REMOVET') {this.remove_thread(tgt); return;}\r\n          else cmd = cmd.slice(0,-1);\r\n        }\r\n        if (cmd==='MERGEN') {\r\n          var th = liveTag.mems.getFromName(name).th;\r\n          if (th.parse_funcs.near_threads) {\r\n            var args = th.parse_funcs.near_threads(th, this.idxs).map(function(v){return 'MERGEC,'+v.sub.replace(/,/g,'')+','+v.tgt+',MERGECR,\\u25c0,'+v.tgt;}).join('\\n') || 'SPC,NONE,';\r\n//            var args = th.parse_funcs.near_threads(th, this.idxs).join('\\nMERGEC,') || 'NONE';\r\n            triage.add_submenu(et.parentNode, args); // 'MERGEC,'+args+',');\r\n          }\r\n          return;\r\n        }\r\n        if (cmd==='MERGEB') {\r\n          this.set_merge_base(name, attr, pn);\r\n//          var pn_old = triage_merge_base && this.threads[triage_merge_base] && this.threads[triage_merge_base][0]; // pn of previous trial refers mergee itself at new merge of two.\r\n//          if (attr) attr.split(';').forEach(function(v){\r\n//            var s = v.split(':');\r\n//            pn.style[s[0]] = s[1];\r\n//            if (pn_old) pn_old.style[s[0]] = ''; // must be the latter for toggle erase\r\n//          });\r\n////          if (attr && pn_old) this.triage_multicast(triage_merge_base,'ATTR',attr.replace(/:[^;]*(;|$)/g,':;'), false, datetime, pn_old); // cause rollback to natural color sometime if merged\r\n//          triage_merge_base = name;\r\n////          if (attr) this.triage_multicast(name,'ATTR',attr, false, datetime, pn);\r\n          return;}\r\n        if (cmd.indexOf('MERGE')!=-1) {\r\n          var history = pref4.mergeHist.proto;\r\n          if (cmd==='UNDOMERGE') {\r\n            if (history.length==0) return;\r\n            var his = history.pop();\r\n            pref.proto.merge_lv_str = his[1];\r\n            pref_func.apply_prep_1n('proto.merge_lv_str', false, true, null, true); // make obj, call event\r\n            pref.proto.merge_list_str = his[0];\r\n            pref_func.apply_prep_1n('proto.merge_list_str', false, true, null, true); // make obj, call event\r\n            return;\r\n          } else {\r\n            if (history.length>=pref4.mergeHist.max) history.shift();\r\n            history.push([pref.proto.merge_list_str, pref.proto.merge_lv_str]);\r\n          }\r\n        }\r\n        if (cmd==='MERGEE') {\r\n          var key_tgt = triage.emb_get_key(et);\r\n          this.merge_bases.add_to_list_fromUI(key_tgt, key_base, this);\r\n          return;\r\n        }\r\n        var hist = cmd!=='MERGE' && cmd!=='UNMERGE' && cmd!=='MERGEOP';\r\n        this.triage_multicast(key_base,cmd,attr,hist, datetime, pn); // , expanded);\r\n        if (cmd==='MERGE') {\r\n          if (triage_merge_base && triage_merge_base.pn) {\r\n            var pn_base = this.threads[triage_merge_base.name] && this.threads[triage_merge_base.name][0]; // pn refers mergee itself at new merge of two in headline view\r\n            if (triage_merge_base.pn!==pn_base) this.set_merge_base(triage_merge_base.name, triage_merge_base.attr, pn_base);\r\n          }\r\n        }\r\n      };\r\n      Clg.prototype.triage_multicast = function(key_base,cmd,attr,hist, datetime, pn){ // , expanded){\r\n        var names = (typeof(key_base)==='string')? [key_base] : key_base.keys;\r\n//        var names = (expanded)? ((typeof(key_base)==='string')? [key_base] : key_base.keys) : this.merge_bases.query_merged_keys(key_base);\r\n        var mode_split = !pref.test_mode['189'] || cmd.indexOf('ARC')!==-1 || cmd.indexOf('MERGE')!==-1 || ['KILL','TIME','WATCH','UNWATCH','TRACK','KILL_N','TIME_N'].indexOf(cmd.replace(/m/,''))!=-1; // datetime has dependency on name.\r\n//        var mode_split = !pref.test_mode['189'] || cmd!=='NONE';\r\n        if (cmd!=='UNDO' && mode_split) for (var i=names.length-1;i>=1;i--) this.triage_exe_broadcast(names[i],cmd,attr, hist? 'multi' : hist, null, null, null, true, pn);\r\n        this.triage_exe_broadcast(mode_split? names[0] : names, cmd,attr,hist, datetime, undefined, undefined, undefined, pn);\r\n//        if (!this.pref[this.mode].merge && this.pref[this.mode].merge_list) { // working code\r\n//          var merged_others = this.merge_bases.query_others(name);\r\n//          if (merged_others) for (var i=0;i<merged_others.length;i++) this.triage_exe_broadcast(merged_others[i],cmd,attr, hist? 'multi' : hist, null, null, null, true);\r\n//        }\r\n//        this.triage_exe_broadcast(name,cmd,attr,hist);\r\n      };\r\n//      function triage_event(){ // working code.\r\n//        var flds = this.name.split(',');\r\n//        var i = parseInt(flds[0].replace(/[^\\(]*\\(/,''),10);\r\n//        var j = parseInt(flds[1].replace(/\\).*/,''),10);\r\n////      function triage(i,j){\r\n//        var name = triage.get_triaged_thread_name();\r\n//        var clg  = triage.get_triaged_catalog();\r\n////        triage_exe(name,triage_str[i][j],triage_str[i][j+2],true);\r\n//////        pref_func.apply_prep(search_ex_list,true);\r\n//////        pref_func.apply_prep(attr_list,true);\r\n//////        pref_func.apply_prep(watch_list,true);\r\n////        if (triage_str[i][j]==='UNDO') catalog_attr_changed();\r\n////        else catalog_attr_set(name,threads[name][0]);\r\n////        if (triage_str[i][j]==='WATCH' || triage_str[i][j]==='UNWATCH') show_catalog(name);\r\n////        else catalog_filter_changed();\r\n//////        catalog_triage_out();\r\n//        clg.triage_exe_broadcast(name,triage_str[i][j],triage_str[i][j+2],true);\r\n//      }\r\n      function triage_exe_pipe(args, stop_loop){\r\n        var name = args[0];\r\n        var lth = liveTag.mems.getFromName(name);\r\n        var time_last = gClg.AllThreads[name][8][4]||gClg.AllThreads[name][8][0];\r\n//        if (args[1]==='TRACK' && time_last===args[4]) return; // ignore TRACK at opening from child if equal // BUG, ignore the last TRACK also\r\n        if (time_last<args[4]) gClg.UnsyncedTriages[lth.key] = args;\r\n        else if (gClg.UnsyncedTriages[lth.key]) gClg.UnsyncedTriages[lth.key] = null;\r\n        gClg.triage_exe_broadcast(args[0],args[1],args[2],args[3],args[4], stop_loop); // gClg for broadcast always if there are watchers.\r\n      }\r\n//      function triage_exe_0(name,tri_str_ex,tri_str_attr,hist,datetime){\r\n//        pClg.triage_exe_broadcast(name,tri_str_ex,tri_str_attr,hist,datetime);\r\n//      };\r\n      Clg.prototype.Get_posted_time = function(tgt_th){\r\n        return tgt_th && (pref.test_mode['167']? tgt_th[8][2] : (tgt_th[8][4] || tgt_th[8][0]));\r\n      }\r\n      Clg.prototype.triage_exe_broadcast = function(name,cmd,attr,hist,datetime, stop_loop, from_auto, merged_broadcast, pn){\r\n//        if (cmd==='NONE_M') {var cmd_org = cmd; cmd = 'NONE';}\r\n        if (cmd==='MERGEC' || cmd==='MERGECR' || cmd==='MERGECU') {\r\n          var reverse = cmd==='MERGECR';\r\n          this.merge_bases.add_to_list_1(reverse? name : attr, reverse? attr : name, this, null, cmd==='MERGECU'? 'no_insert' : true);\r\n          triage.off();\r\n          return;\r\n        }\r\n        if (cmd==='MERGE') {this.merge_bases.add_to_list_1(triage_merge_base.name, name, this, null, true); triage.off(); if (attr) cmd='ATTR'; else return;}\r\n        if (cmd==='UNMERGE') {this.merge_bases.add_to_list_1(null, name, this); triage.off(); return;}\r\n        if (cmd==='UNMERGELV') {this.merge_bases.add_to_lv_list(name, null, this, true); triage.off(); return;}\r\n        if (cmd==='MERGEOP') {this.merge_cross_links_in_op_manually(name); triage.off(); return;}\r\n        if (['ARC','ARC1','UNARC'].indexOf(cmd)!=-1) {\r\n          if (!pref.test_mode['67']) archiver.start_1(cmd,liveTag.mems.getFromName(name),true); // test patch\r\n          return;\r\n        }\r\n        if (!datetime && cmd==='WATCH' && pref.common.consolidated_watch_list) datetime = this.Get_posted_time(this.threads[name]) || this.Get_posted_time(gClg.AllThreads[name]); // this.thread has priority.\r\n        var changed_watch = false;\r\n        for (var i=0;i<gClg.Clgs.length;i++) {\r\n          var clg = gClg.Clgs[i];\r\n          var broadcast = gClg.Clgs.length==1 || this===clg? false : this===gClg? true : this.pref[this.mode].board_list_sel==clg.pref[clg.mode].board_list_sel? 0 : true;\r\n//          var broadcast = this!==clg && this.pref[this.mode].board_list_sel!=clg.pref[clg.mode].board_list_sel);\r\n          var changed = clg.triage_exe(name,cmd,attr,hist,datetime, broadcast, stop_loop); // , from_pipe, stop_loop);\r\n          if (!from_auto && (cmd!=='TRACK' || this.mode!=='thread')) clg.triage_exe_view(changed.name, changed, cmd!=='UNDO' && broadcast===false? pn : undefined, cmd.indexOf('m')!=-1); // changed.name for undo // TRACK trips child->catalog->child\r\n          changed_watch |= changed.watch;\r\n//          if (cmd_org==='NONE_M') if (clg.view==='headline') if (clg.merge_bases.bases[name]) clg.view_attr_set(name, true, true, clg.threads[name][3]); // TEST\r\n        }\r\n        Tooltips.hide();\r\n        if (!stop_loop) if (changed_watch && pref.common.consolidated_watch_list && pref.common.sync_watch_list) gClg.Sync_watch_save([name,cmd,attr,hist,datetime], merged_broadcast); // Array.prototype.slice.call(arguments));\r\n        if (cmd==='WATCH' && pref.archive.store_watched && this.threads && this.threads[name]) { // checking this.threads for triage_exe_pipe, which calls through gClg.\r\n          var lth = liveTag.mems.getFromName(name);\r\n          if (!lth.archived) archiver.start_1('ARC',lth,true);\r\n        }\r\n      };\r\n      Clg.prototype.triage_exe_view = function(names, changeds, pn, cmd_m){ // , from_pipe, stop_loop){\r\n//        var changed = this.triage_exe(name,tri_str_ex,tri_str_attr,hist,datetime, broadcast);\r\n//        name = changed.name; // for undo\r\n//        if (!pref.triage.broadcast_attr && broadcast) changed.attr = false;\r\n//        if (!pref.triage.broadcast_time && broadcast) {\r\n//          changed.ex = false;\r\n//          changed.watch = false;\r\n//        }\r\n        var pf = this.pref[this.mode];\r\n        if (!Array.isArray(names)) names = [names];\r\n//        var req_acc = 0;\r\n//        var tgts = {};\r\n        for (var i=0;i<names.length;i++) {\r\n          var name = names[i];\r\n          var changed = Array.isArray(changeds)? changeds[i] : changeds;\r\n          var tgt_th = this.threads[name];\r\n          if (changed.watch && !tgt_th && pf.refresh_src!=='bg') this.clone_thread_1(name);\r\n          if (tgt_th) { // threads[name] might not exist at undo\r\n            if (changed.attr) {\r\n              if (cmd_m && this.view==='headline' && this.merge_bases.bases[name]) this.view_attr_set(name, true, true, tgt_th[3]);\r\n              this.view_attr_set(name, null, null, pn); // may be reorderd here\r\n//              var req = this.view_attr_set(name, null, true, pn); // may be reorderd here\r\n//              if (req) {\r\n//                tgts[name] = null;\r\n//                req_acc |= req;\r\n//              }\r\n            }\r\n            if (changed.ex) this.filter_dirtify(tgt_th);\r\n  //          if (changed.ex || changed.watch && pf.hide_unwatched) this.filter_dirtify(tgt_th);\r\n            if (changed.watch) {\r\n              var tmp;\r\n              if (pf.hide_unwatched && !tgt_th[16].lth.watched_p) {\r\n                this.func_hide_all((tmp = {}, tmp[name]=tgt_th, tmp));\r\n                this.idx_remove(name);\r\n              } else this.idx_reorder(name);\r\n              if (this.view==='page' || this.view==='thread') tgt_th[16].check_and_expand(tgt_th[16].posts,true); // calls mark_newer_posts2 which is for DRAW-ONLY, so WNWATCH can't erase new posts's mark.\r\n              if (pf.mark_new_posts) this.view_time_filter_changed(name); // to call mark_newer_posts2,\r\n            }\r\n            if (changed.ex || changed.watch) this.show_catalog_buf(name, true, true);\r\n//            if (changed.ex || changed.watch) {\r\n//              tgts[name] = null; // this.show_catalog(name, true, true); // redraw all tags to change color of them when threads are opened. // {this.show_catalog(name); triage.off();}\r\n//              req_acc = 0x7;\r\n//            }\r\n          } // else if (changed.watch) {} // when the thread is added to watch list now. THIS SHOULD BE IMPLEMENTED, now watch list requres to refresh to appear the thread.\r\n        }\r\n//        if (Object.keys(tgts).length>0) {\r\n//          this.show_catalog(tgts, req_acc&0x02, req_acc&0x04);\r\n//          triage.off();\r\n//        }\r\n//        return changed;\r\n//        if (broadcast===false) {\r\n//          if (triage.get_trg().format_tgt) triage.format_buttons(changed.name);\r\n//          pref_func.tooltips.hide();\r\n//        }\r\n//        if (!stop_loop) if (broadcast===false || from_pipe) // may issue multiple request if from_pipe===true, but OK.\r\n//          if (changed.watch && pref.common.consolidated_watch_list) gClg.Sync_watch_save(Array.prototype.slice.call(arguments));\r\n      };\r\n      Clg.prototype.triage_exe = function(name,cmd,attr,hist,datetime, broadcast, from_LSmirror){ // KILL,TIME,UNDO,NONE,WATCH,UNWATCH,DELETE,GO\r\n        var history = this.triage_history;\r\n        var attr_list = this.components.attr_list;\r\n        var watch_list = this.components.watch_list;\r\n        var ex_list = this.components.ex_list;\r\n//          if (cmd==='UNWATCH') common_func.modify_bookmark(name,false);\r\n        var changed = {ex:false, attr:false, watch:false, name:name};\r\n        if (cmd!=='UNDO') {\r\n          if (hist) {\r\n            var hist_last = history.length>0 && history[history.length-1];\r\n            if (hist_last && hist_last[0][3]==='multi') {\r\n              hist_last[4].push(name);\r\n              if (hist!=='multi') hist_last[0][3] = hist;\r\n            } else {\r\n              if (history.length>=pref.catalog_triage_hist) history.shift();\r\n              history.push([Array.prototype.slice.call(arguments), ex_list.value, attr_list.value, watch_list.value, hist==='multi'? [name] : null]);\r\n            }\r\n          }\r\n          var cmd_N = cmd==='KILL_N' || cmd==='TIME_N';\r\n          cmd = cmd.replace(/m/,'').replace(/_N$/,'');\r\n          if (Array.isArray(name)) {\r\n            var attr_buf = {value:attr_list.value}; \r\n            var watch_buf = {value:watch_list.value}; \r\n            var ex_buf = {value:ex_list.value}; \r\n            for (var i=0;i<name.length;i++) {\r\n              var c = changed[i] = this.triage_exe_1(name[i],cmd,attr,datetime, broadcast, from_LSmirror, attr_buf, watch_buf, ex_buf, this.threads[name[i]], cmd_N);\r\n              changed.ex |= c.ex;\r\n              changed.attr |= c.attr;\r\n              changed.watch |= c.watch;\r\n            }\r\n            attr_list.value = attr_buf.value;\r\n            watch_list.value = watch_buf.value;\r\n            ex_list.value = ex_buf.value;\r\n          } else changed = this.triage_exe_1(name,cmd,attr,datetime, broadcast, from_LSmirror, attr_list, watch_list, ex_list ,this.threads[name], cmd_N);\r\n        } else {\r\n          if (history.length==0) return changed;\r\n          var his = history.pop();\r\n          changed = {ex:ex_list.value!==his[1], attr:attr_list.value!==his[2], watch:watch_list.value!==his[3], name: his[0][0], names:his[4]};\r\n          watch_list.value = his[3];\r\n          attr_list.value = his[2];\r\n          ex_list.value = his[1];\r\n        }\r\n//        if (cmd==='DELETE') { \r\n//          if (attr===null) return changed; // called as child\r\n//          for (var i=0;i<attr.length;i++) {\r\n//            var changed_next = this.triage_exe(attr[i],cmd,null,hist,datetime); // not change source for broadcast\r\n//            changed.watch |= changed_next.watch;\r\n//            changed.ex    |= changed_next.ex;\r\n//            changed.attr  |= changed_next.attr;\r\n//          }\r\n////          if (attr===null) return changed; // recursive\r\n////          else {\r\n////            while (attr.length!=0) {\r\n////              var name_next = attr.shift();\r\n////              var changed_next = this.triage_exe(name_next,cmd,null,hist,datetime);\r\n////              changed.watch |= changed_next.watch;\r\n////              changed.ex    |= changed_next.ex;\r\n////              changed.attr  |= changed_next.attr;\r\n////            }\r\n////          }\r\n//        }\r\n//        if (cmd==='WATCH' && pref.archive.store_watched) {\r\n//          var lth = liveTag.mems.getFromName(name);\r\n//          if (!lth.archived) archiver.start_1('ARC',lth,true);\r\n//        }\r\n//        if (!pref.test_mode['134'] && cmd==='DELETE') return changed; // no need to remake obj\r\n        if (changed.watch && (!pref.test_mode['190'] || cmd==='UNDO')) pref_func.apply_prep(watch_list,this.pref);\r\n        if (changed.ex    && (!pref.test_mode['190'] || cmd==='UNDO')) pref_func.apply_prep(ex_list,this.pref);\r\n        if (changed.attr  && (!pref.test_mode['190'] || cmd==='UNDO')) pref_func.apply_prep(attr_list,this.pref);\r\n        if (cmd==='UNDO' && (changed.watch || his[0][1]==='KILL')) this.triage_rewind_watch(changed);\r\n//        if (cmd==='UNDO' && (changed.watch || his[0][1]==='KILL')) { // re-order, 'KILL' doesn't change watch-list. \r\n////        if (cmd==='UNDO' && changed.watch) { // re-order\r\n//          for (var i=0;i<names.length;i++) {\r\n//          if (threads[changed.name]) {\r\n//            site2['DEFAULT'].check_reply.set_watch_time(threads[changed.name][19], this.get_watch_time_of_a_thread(changed.name,threads[changed.name][8][1], null, true), changed.name);\r\n////            threads[changed.name][19][0] |= 0x00010000;\r\n//            scan_boards.scan_init('triage_undo', [changed.name], {refresh:true, priority:8});\r\n//          }\r\n//        }\r\n        return changed;\r\n      };\r\n      Clg.prototype.triage_exe_1 = function(name,cmd,attr,datetime, broadcast, from_LSmirror, attr_list, watch_list, ex_list, tgt_th, cmd_N){ // KILL,TIME,UNDO,NONE,WATCH,UNWATCH,DELETE,GO\r\n        var changed = {ex:false, attr:false, watch:false, name:name};\r\n        var key = new RegExp('(^|,)'+name.replace(/\\+/,'\\\\+')+'([\\\\^@;][^,\\n]*)*(,|\\n|$)','mg');\r\n//          var key = new RegExp('(^|,)'+name.replace(/\\+/,'\\\\+')+'([\\\\^@!][^,\\n]*)*(,|\\n|$)','mg');\r\n//          if (cmd.search(/KILL|TIME|WATCH/)!=-1) { // contains UNWATCH\r\n//if (!pref.test_mode['133'] && !broadcast /*|| tgt_th*/ || cmd==='DELETE' || cmd==='WATCH' && pref.common.consolidated_watch_list) { // TEMPORARILY PATCH FOR BROADCAST BEFORE MAKING this.threads\r\n        if (['KILL','TIME','WATCH','UNWATCH','TRACK',/*'DELETE',*/].indexOf(cmd)!=-1) {\r\n//            var datetime = tgt_th[8][0] + pref.localtime_offset*3600000; // NO BLOCK SCOPE\r\n//            var datetime = ((tgt_th[8][0]>tgt_th[8][4])? tgt_th[8][0] : tgt_th[8][4]) + pref.localtime_offset*3600000; // NO BLOCK SCOPE\r\n//            var datetime = (cmd!=='DELETE')? tgt_th[8][4] + pref.localtime_offset*3600000 : 0; // NO BLOCK SCOPE\r\n          if (!datetime) datetime = /*cmd!=='DELETE' && */ this.Get_posted_time(gClg.AllThreads[name]) || this.Get_posted_time(tgt_th) || 0; // to pass auto_list\r\n//            if (!datetime) datetime = cmd!=='DELETE' && (gClg.AllThreads[name][8][4] || gClg.AllThreads[name][8][0]) || 0; // auto_list doesn't work\r\n//            if (!datetime) datetime = (cmd!=='DELETE')? tgt_th[8][4]||tgt_th[8][0] : 0; // NO BLOCK SCOPE\r\n          var millisec = datetime%1000;\r\n          var time_str = '@' + new Date(datetime).toLocaleString() + (millisec? '.'+('00'+millisec).slice(-3) : '');\r\n          var wt_now = this.pref.filter.watch_list_str;\r\n          var wt_str = wt_now.replace(key,',');\r\n          var wt_has = wt_now.length !== wt_str.length \r\n          if (broadcast===false || wt_has || pref.common.consolidated_watch_list || pref.triage.sync_watch==='all' || broadcast===0 && pref.triage.sync_watch==='bg') {\r\n            var wt_add = '';\r\n//              if (cmd!=='DELETE') {\r\n            if (cmd==='WATCH' || cmd==='TRACK' || cmd==='TIME') { //  && pref.catalog.auto_watch) {\r\n              wt_add = name + time_str; // TIME or WATCH\r\n              if (/*broadcast===false ||*/ tgt_th) this.mark_read_thread(name, datetime, cmd==='TRACK' && attr); // attr has count of unread posts\r\n            } else {\r\n              if (cmd==='UNWATCH' && !wt_has) wt_add = name + '@0'; // explicit unwatch\r\n              if (/*broadcast===false ||*/ tgt_th) this.mark_read_thread(name, null);\r\n            }\r\n//              }\r\n            if (wt_add || wt_has) { // for spped up 'KILL'\r\n              watch_list.value = this.pref.filter.watch_list_str = pref_func.fmt4str2(wt_add? wt_str+','+wt_add+'\\n' : wt_str);\r\n              changed.watch = true;\r\n              if (pref.test_mode['190']) this.pref.filter.watch_list_obj2._revise(name, wt_add);\r\n            }\r\n          }\r\n        }\r\n//          if (cmd.search(/KILL|TIME|NONE/)!=-1) {\r\n        if (!from_LSmirror) if (['KILL','TIME','NONE',/*'DELETE',*/'UNWATCH'].indexOf(cmd)!=-1) {\r\n          if (broadcast===false || ex_list.value.search(key)!=-1 || pref.triage.sync_ex==='all' || broadcast===0 && pref.triage.sync_ex==='bg') {\r\n            var ex_now = this.pref.filter.list_str;\r\n            var ex_str = ex_now.replace(key,',');\r\n            var ex_add = (['KILL','TIME'].indexOf(cmd)!=-1 && tgt_th)? name + (cmd==='TIME'? time_str : '') : '';\r\n            if (ex_add || ex_now.length !== ex_str.length) {\r\n              ex_list.value = this.pref.filter.list_str = pref_func.fmt4str2(ex_add? ex_str+','+ex_add+'\\n' : ex_str);\r\n              changed.ex = true; // eliminate this flag as much as possible to speed up 'NONE'\r\n              if (pref.test_mode['190']) this.pref.filter.list_obj2._revise(name, ex_add);\r\n            }\r\n          }\r\n        }\r\n//}\r\n////          if (['KILL','TIME','NONE','DELETE'].indexOf(cmd)!=-1) {\r\n////            var at_str = attr_list.value.replace(key,',') + ((attr!=='')? ',' + name + '^' +attr : '') +'\\n';\r\n////            attr_list.value = at_str.replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,'');\r\n////            changed.attr = true;\r\n////          }\r\n        if (!from_LSmirror) if (!cmd_N && ['KILL','TIME','NONE',/*'DELETE',*/'ATTR','SHOW','UNSHOW','STICKY','UNSTICKY'].indexOf(cmd)!=-1 && (broadcast===false || pref.triage.sync_attr==='all' || broadcast===0 && pref.triage.sync_attr==='bg')) { //  || attr_list.value.search(key)!=-1)) {\r\n//            var at_str;\r\n//            if (cmd==='DELETE') at_str = '';\r\n//            else {\r\n////              var at_obj_all = pf.attr_list_obj2;\r\n          var at_now = this.pref.filter.attr_list_str;\r\n          if (tgt_th) {\r\n            var matched = at_now.match(key);\r\n            var at_desc = (matched? matched.join():'') + (cmd==='ATTR' && attr? (matched?',':'')+ name+';'+attr : '') || name;\r\n            var at_obj = pref_func.str2obj2(at_desc, {}, true)[name];\r\n//            var at_obj_all = pref_func.str2obj2((matched)? matched.join() : name, {}, true);\r\n//            if (cmd==='ATTR' && attr) at_obj_all = pref_func.str2obj2(name+';'+attr, at_obj_all, true);\r\n//            var at_obj = at_obj_all[name];\r\n            var at_style = at_obj.style || {};\r\n            var at_cmd = at_obj.cmd || {};\r\n            if (cmd==='SHOW') at_cmd['SHOW'] = true;\r\n            else if (cmd==='UNSHOW' || cmd==='KILL') delete at_cmd['SHOW'];\r\n            else if (cmd==='STICKY') {\r\n              if (tgt_th[16].systemSticky) delete at_cmd['STICKY'];\r\n              else at_cmd['STICKY'] = true;\r\n            } else if (cmd==='UNSTICKY')\r\n              if (tgt_th[16].systemSticky) at_cmd['STICKY'] = false;\r\n              else delete at_cmd['STICKY'];\r\n            var style_str = (['KILL','TIME','NONE'].indexOf(cmd)!=-1)? attr\r\n                : Object.keys(at_style).map(function(k){return k+':'+at_style[k];}).join(';');\r\n            var cmd_str = Object.keys(at_cmd).map(function(k){return k+(at_cmd[k]===true? '' : ':'+at_cmd[k]);}).join(';');\r\n            var at_add = (style_str || cmd_str)? name + (style_str? ';'+style_str:'') + (cmd_str? ';'+cmd_str:'') : '';\r\n//              at_str = name;\r\n//              if (['KILL','TIME','NONE'].indexOf(cmd)!=-1) {\r\n//                if (attr!=='') at_str += '^' +attr;\r\n//              } else { // 'ATTR'\r\n//                var at_obj_keys = Object.keys(at_obj.style);\r\n//                if (at_obj_keys.length!=0) {\r\n//                  for (var i=0;i<at_obj_keys.length;i++) at_obj_keys[i] += ':' + at_obj.style[at_obj_keys[i]];\r\n//                  at_str += '^' + at_obj_keys.join(';');\r\n//                }\r\n//              }\r\n//              at_obj_keys = Object.keys(at_obj.cmd);\r\n//              if (at_obj_keys.length!=0) {\r\n//                for (var i=0;i<at_obj_keys.length;i++) if (at_obj.cmd[at_obj_keys[i]]===false) at_obj_keys[i] += ':false';\r\n//                at_str += '!' + at_obj_keys.join(';');\r\n//              }\r\n//              at_str = (at_str === name)? '' : at_str + '\\n';\r\n          }\r\n          var at_str = (matched || !tgt_th)? at_now.replace(key,',') : at_now;\r\n          if (matched || at_add || at_now.length!==at_str.length) { // for 'KILL'\r\n            attr_list.value = this.pref.filter.attr_list_str = pref_func.fmt4str2(at_add? at_str+','+at_add+'\\n' : at_str);\r\n            changed.attr = true;\r\n            if (pref.test_mode['190']) this.pref.filter.attr_list_obj2._revise(name, at_add);\r\n          }\r\n        }\r\n        return changed;\r\n      };\r\n      Clg.prototype.triage_rewind_watch = function(changed){\r\n        var names = (changed.names || [changed.name]).filter(function(name){return this.threads[name];},this);\r\n        for (var i=names.length-1;i>=0;i--) {\r\n          var name = names[i];\r\n//          if (this.threads[name]) {\r\n          var watch_time = this.get_watch_time_of_a_thread(name,this.threads[name][8][1], null, true);\r\n          var lth = liveTag.mems.getFromName(name);\r\n          if (watch_time) site2['DEFAULT'].check_reply.set_watch_time(lth.wt, watch_time, name);\r\n          else site2['DEFAULT'].check_reply.set_unwatch(lth.wt);\r\n          liveTag.dirtify_ur(lth);\r\n//          if (i!==0) this.triage_exe_view(name, changed);\r\n//          this.idx_reorder(name); // slightly redundant because the first case will be executed in triage_exe_view, while no good way to avoid it because of following splice.\r\n////            this.footer.queue_update_force(name);\r\n////            this.ths_undo[name] = null; // too heavy in insert_thread_1, calling redundant idx_reorder is the better.\r\n//          } else names.splice(i,1);\r\n        }\r\n        if (names.length!=0) scan_boards.scan_init('triage_undo', names, {refresh:this, priority:8, callback:this.triage_undo_callback.bind(this,names)});\r\n      };\r\n      Clg.prototype.triage_undo_callback = function(names){ // Undo can't rewind number of unread posts, so scan is needed. But it doesn't call idx_reorder and footer.update when there is no updates.(usual case)\r\n        for (var i=0;i<names.length;i++) {\r\n          this.idx_reorder(names[i]);\r\n          this.footer.update_force(names[i]); // rewinds num of unread posts\r\n        }\r\n        this.show_catalog(0);\r\n      };\r\n      \r\n      var triage = (function(){\r\n        var trg_hover = null;\r\n        var trg_menu = null;\r\n        var trg_pMenu = null;\r\n        var trg_now = null;\r\n        var trg_submenu_root = null;\r\n        var trg_submenu_leaf = null;\r\n        function format_buttons(name, trg, clg){ // , expanded){\r\n          var tgt = trg.format_tgt;\r\n//          var tgt_th = clg.threads[name]; // get_clg().threads[name];\r\n//          if (!tgt_th) return; // this is a patch for clone_thread, this will be able to be removed.\r\n          var merge = typeof(name)==='string'? null : name;\r\n//          var merge = (expanded)? (typeof(name)==='string'? null : name) : clg.merge_bases.bases[name];\r\n          var lth = merge? null : liveTag.mems.getFromName(name);\r\n          var tgt_th = merge? null : clg.threads[name];\r\n          for (var i=0;i<tgt.length;i++) tgt[i][0].style.display = (merge? format_funcs.merge(merge.tgt_ths, merge.lths, tgt[i][1])\r\n                                                                         : format_funcs[tgt[i][1]](tgt_th,lth))? 'none' : '';\r\n//          if (merge) { // working code\r\n//            for (var i=0;i<tgt.length;i++) {\r\n//              for (var j=0;j<merge.lths.length;j++) if (!format_funcs[tgt[i][1]](merge.tgt_ths[j],merge.lths[j])) break;\r\n//              tgt[i][0].style.display = (j===merge.lths.length)? 'none' : '';\r\n//            }\r\n//          } else {\r\n//            var lth = liveTag.mems.getFromName(name);\r\n//            for (var i=0;i<tgt.length;i++) tgt[i][0].style.display = (format_funcs[tgt[i][1]](tgt_th,lth))? 'none' : '';\r\n//          }\r\n//          if (trg===trg_menu) for (var i=trg.brs.length-1;i>=0;i--) {\r\n//            var br = trg.brs[i];\r\n//            var p = br;\r\n//            while (1) {\r\n//              if (!p.previousSibling || (p = p.previousSibling).tagName==='BR') {br.style.display = 'none'; break;}\r\n//              if (p.style.display!=='none') {br.style.display = ''; break;}\r\n//            }\r\n//          }\r\n        }\r\n        var format_funcs = { // YOU MUST ALSO CHANGE toggles in Triage.\r\n          'WATCH': function(tgt_th){return (tgt_th[19][0]&0x040c0000) && tgt_th[19][1]===0;},\r\n          'UNWATCH': function(tgt_th){return !(tgt_th[19][0]&0x040c0000);},\r\n          'SHOW': function(tgt_th){return tgt_th[16].show_always;},\r\n          'UNSHOW': function(tgt_th){return !tgt_th[16].show_always;},\r\n          'STICKY': function(tgt_th){return tgt_th[20];},\r\n          'UNSTICKY': function(tgt_th){return !tgt_th[20];},\r\n          'ARC': function(tgt_th,lth){return lth.archived;},\r\n          'ARC1': function(tgt_th,lth){return lth.archived;},\r\n          'UNARC': function(tgt_th,lth){return !lth.archived;},\r\n          merge: function(tgt_ths, lths, cmd){\r\n            for (var j=0;j<lths.length;j++) if (!this[cmd](tgt_ths[j],lths[j])) return false;\r\n            return true;\r\n          },\r\n        };\r\n//        function get_triaged_catalog(){\r\n//          return triaged_catalog || (triaged_catalog = Clg.prototype.ppn2clg(ppn));\r\n//        }\r\n        var triaged_catalog = null; // pClg;\r\n        var triaged_name = null;\r\n        var tpn = pClg.ppn; // initial value for mode change\r\n        var on_off = (function(){\r\n          var triaged_pn = null;\r\n//          var db_thread_out = new DelayBuffer(thread_out,100);\r\n//          var thread_out_delayed = DelayBuffer.prototype.delayed_do.bind(db_thread_out);\r\n//          var db_triage_off = new DelayBuffer(triage_off,pref.triage.popdown_delay);\r\n          var triage_off_wdg = new Watchdog(triage_off, 100);\r\n          function set_triage_style(trg, clg, pn_th, pn_menu){\r\n            var style = trg.pn.style;\r\n//            if (trg_now!==trg) triage_off();\r\n//            trg_now = trg;\r\n//            if (!triaged_name) {\r\n//              if (mode) ppn.appendChild(trg.pn);\r\n//              else style.display = '';\r\n//            }\r\n            var left = pn_th.offsetLeft - clg.ppn.scrollLeft + (pn_menu? pn_menu.getBoundingClientRect().left - pn_th.getBoundingClientRect().left - 10 : 0);\r\n//            var left = pn_th.offsetLeft - clg.ppn.scrollLeft + (pn_menu? pn_menu.offsetLeft - 10 : 0);\r\n//            var left = pn_th.offsetLeft - clg.ppn.scrollLeft + (pn_menu? pn_menu.offsetLeft + pn_menu.offsetWidth : 0);\r\n            if (pn_menu || pref[clg.view].triage_place.slice(-4)==='Left') { // 'topLeft' || 'bottomLeft'\r\n              style.left = left + 'px';\r\n              style.right = null;\r\n            } else {\r\n              style.right = clg.ppn.offsetWidth - left - pn_th.offsetWidth + 'px';\r\n              style.left = null;\r\n            }\r\n            var mode_float = clg.mode==='float';\r\n            var top = pn_th.offsetTop - (mode_float? clg.pppn.scrollTop + clg.ppn.scrollTop : 0) + (pn_menu? pn_menu.getBoundingClientRect().top - pn_th.getBoundingClientRect().top + pn_menu.offsetHeight : 0);\r\n//            var top = pn_th.offsetTop - clg.pppn.scrollTop + (pn_menu? pn_menu.getBoundingClientRect().top - pn_th.getBoundingClientRect().top + pn_menu.offsetHeight : 0);\r\n//            var top = (!mode_float && pn_menu)? pn_menu.getBoundingClientRect().top + window.pageYOffset + (pn_menu? pn_menu.offsetHeight : 0)\r\n////                    : (!mode_float && pn_menu && pref[clg.mode].env.thread_pos_static)? pn_menu.offsetTop\r\n//                    : pn_th.offsetTop - clg.pppn.scrollTop + (!mode_float && pn_menu? pn_menu.offsetTop : 0);\r\n//            var top = pn.offsetTop - pppn.scrollTop;\r\n            if (pn_menu || pref[clg.view].triage_place[0]==='t') { // 'topLeft' || 'topRight'\r\n              style.top    = top + 'px';\r\n              style.bottom = null;\r\n            } else {\r\n              style.bottom = ((mode_float)? clg.pppn.offsetHeight + clg.ppn.offsetTop : window.innerHeight) - top - pn_th.offsetHeight + 'px';\r\n              style.top    = null;\r\n            }\r\n//            style.zIndex = pref.triage.zIndex;\r\n          }\r\n          function thread_in(e, name, pn_th, clg){\r\n//            triaged_catalog = clg;\r\n//            ppn = pref.test_mode['141']? clg.ppn.parentNode : clg.ppn;\r\n//          function thread_in(e, name, ppn_in){\r\n//            if (ppn!==ppn_in) triaged_catalog = null;\r\n//            ppn = ppn_in;\r\n            if (pref[clg.view].triage_hover) {\r\n//              if (!pref.test_mode['127']) {\r\n                if (triaged_pn===pn_th) return;\r\n                if (pref.triage.popdown) triage_off_wdg.restart(pref.triage.popdown_delay);\r\n                show_triage(trg_hover, name, pn_th, clg);\r\n//              } else { // working code\r\n//                var pn = e.currentTarget;\r\n//                db_thread_out.cancel();\r\n//                if (triaged_pn===pn) return; // for faster execution.\r\n//                if (!triaged_name) {\r\n//                  if (mode) pn12_triage = ppn.appendChild(pn12_triage);\r\n//                  else pn12_triage.style.display = '';\r\n//                }\r\n//                if (pref.triage.popdown) {db_triage_off.cancel();db_triage_off.delayed_do();}\r\n//                if (triaged_pn) triaged_pn.removeEventListener('mouseout', thread_out_delayed, false);\r\n//                var left = pn.offsetLeft - ppn.scrollLeft;\r\n//                if (pref.catalog_triage_place==='topLeft' || pref.catalog_triage_place==='bottomLeft') {\r\n//                  pn12_triage.style.left = left + 'px';\r\n//                  pn12_triage.style.right = null;\r\n//                } else {\r\n//                  pn12_triage.style.right = ppn.offsetWidth - left - pn.offsetWidth + 'px';\r\n//                  pn12_triage.style.left = null;\r\n//                }\r\n//                var top = pn.offsetTop  - ppn.scrollTop;\r\n//                if (pref.catalog_triage_place==='topLeft' || pref.catalog_triage_place==='topRight') {\r\n//                  if (top<ppn.offsetTop) top = ppn.offsetTop;\r\n//                  pn12_triage.style.top   = top + 'px';\r\n//                  pn12_triage.style.bottom = null;\r\n//                } else {\r\n//                  pn12_triage.style.bottom = window.innerHeight - top - pn.offsetHeight + 'px';\r\n//                  pn12_triage.style.top = null;\r\n//                }\r\n//                triaged_pn = e.currentTarget;\r\n//                triaged_name = triaged_pn.name;\r\n//                triaged_pn.addEventListener('mouseout', thread_out_delayed, false);\r\n//                if (trg_hover.format_tgt) format_buttons(triaged_name, trg_hover);\r\n//              }\r\n            } else if (triaged_pn!==pn_th) triage_off();\r\n          }\r\n//          function thread_out(){\r\n//            if (triaged_pn) {\r\n//              triaged_pn.removeEventListener('mouseout', thread_out_delayed, false);\r\n//              triaged_pn = null;\r\n//            }\r\n//            triage_off();\r\n//          }\r\n// CAUTION, change_mode DOESN'T WORK with watcher, NOT IMPRELEMTED YET.\r\n          var mode = true; // add/remove or show/hide\r\n          function change_mode(){\r\n            tpn.appendChild(trg_hover);\r\n            tpn.appendChild(trg_menu);\r\n            mode = false;\r\n          }\r\n          function triage_on(trg, name){\r\n            if (trg_now!==trg) triage_off();\r\n            trg_now = trg;\r\n            if (!triaged_name) {\r\n              if (mode) tpn.appendChild(trg.pn);\r\n              else trg.pn.style.display = '';\r\n            }\r\n            triaged_name = name;\r\n          }\r\n          function triage_off(){\r\n            Tooltips.hide_if(trg_now);\r\n            if (triaged_name) {\r\n              if (trg_submenu_root) {\r\n                trg_submenu_root.remove();\r\n                trg_submenu_root = null;\r\n              }\r\n              if (mode) trg_now.pn.parentNode.removeChild(trg_now.pn); // for reentry, triage_parent wasn't updated when !pref[embed_mode].embed, for example, catalog -> thread -> catalog wiil cause an error.\r\n//              if (mode) trg_now = triage_parent.removeChild(trg_now);\r\n              else trg_now.pn.style.display = 'none';\r\n              triaged_name = null;\r\n              trg_now = null;\r\n              if (pn_menuOpen) pn_menuOpen.classList.remove('menuOpen');\r\n              pn_menuOpen = null;\r\n            }\r\n          }\r\n          function thread_out2(e){\r\n            triaged_pn = null;\r\n            triaged_catalog = null;\r\n            triage_off();\r\n          }\r\n//          function onTriage_or_off(e){\r\n//            var pn = e.target;\r\n//            while (pn!=e.currentTarget){\r\n//              if (pn.className==='catalog_triage_parent') {\r\n//                triage_off_wdg.stop();\r\n//                return;\r\n//              } else pn = pn.parentNode;\r\n//            }\r\n//            triaged_pn = null;\r\n//            triage_off();\r\n//          }\r\n          var pn_menuOpen = null;\r\n          function make_menu(et, name, clg, pn_th, post){\r\n//            triaged_catalog = clg;\r\n//            ppn = pref.test_mode['141']? clg.ppn.parentNode : clg.ppn;\r\n            var trg = post? trg_pMenu : trg_menu;\r\n            if (triaged_pn===pn_th && trg_now===trg && name===triaged_name) {triage_off(); if (!post || pn_menuOpen===et) return;} // toggle\r\n            triage_off_wdg.stop();\r\n            show_triage(trg, name, pn_th, clg, et);\r\n            var ddEcW = document.documentElement.clientWidth;\r\n            var left = parseInt(trg.pn.style.left,10);\r\n            if (trg.pn.getBoundingClientRect().left + trg.pn.offsetWidth>=ddEcW) trg.pn.style.left = left - (trg.pn.offsetWidth - et.offsetWidth - 10*2)+'px'; // trg.pn.offsetWidth is reqiured this to be after displaying, it's 0 before show.\r\n//            if (left + trg.pn.offsetWidth>=ddEcW) {trg.pn.style.right = 0; trg.pn.style.left = null;} // trg.pn.offsetWidth is reqiured this to be after displaying, it's 0 before show.\r\n            var ddEcH = document.documentElement.clientHeight;\r\n            var top = parseInt(trg.pn.style.top,10);\r\n            if (trg.pn.getBoundingClientRect().top + trg.pn.offsetHeight>=ddEcH) trg.pn.style.top = top - trg.pn.offsetHeight - et.offsetHeight +'px'; // works fine.\r\n            pn_menuOpen = et;\r\n            et.classList.add('menuOpen');\r\n          }\r\n          function show_triage(trg, name, pn_th, clg, pn_menu){\r\n            triaged_catalog = clg;\r\n            tpn = pref.test_mode['141']? clg.pppn : clg.ppn;\r\n            set_triage_style(trg, clg, pn_th, pn_menu);\r\n            triaged_pn = pn_th; // SHOULD USE PN FOR MULTI CATALOG.\r\n            if (trg.format_tgt) format_buttons(name, trg, clg); // , pn_menu);\r\n            triage_on(trg, name);\r\n          }\r\n          return {\r\n            change_mode: change_mode,\r\n            thread_in:  thread_in,\r\n            off: triage_off,\r\n//            off_delay: (!pref.test_mode['127'])? null : function(){db_triage_off.delayed_do(500);},\r\n            triage_in: /* (!pref.test_mode['127'])?*/ function(e){triage_off_wdg.stop();e.stopPropagation();gGEH.triage_in2(e); if (gGEH.triage_in) gGEH.triage_in(e);}/*\r\n                                                : function(){                              db_triage_off.cancel();    db_thread_out.cancel();}*/,\r\n            triage_out: /*(!pref.test_mode['127'])?*/ function(){if (trg_now!==trg_menu) if (pref.triage.popdown) triage_off_wdg.restart(pref.triage.popdown_delay);}/*\r\n                                                : function(){if (pref.triage.popdown) db_triage_off.delayed_do();db_thread_out.delayed_do();}*/,\r\n//            onTriage_or_off: onTriage_or_off,\r\n            thread_out2: thread_out2,\r\n            make_menu: make_menu,\r\n            get triaged_pn(){return triaged_pn;},\r\n            get pn_menuOpen(){return pn_menuOpen;},\r\n          }\r\n        })();\r\n        function make_1(str, args){\r\n          var trg = new Triage(str, args);\r\n          trg.pn.onmouseover = on_off.triage_in;\r\n          trg.pn.onmouseout  = on_off.triage_out;\r\n          if (!pref.triage.hide_toggle) trg.format_tgt = null;\r\n          return trg;\r\n        }\r\n        function triage_wheel(e){ // patch\r\n          if (triaged_catalog.mode!=='float') return;\r\n          on_off.off();\r\n          Tooltips.hide();\r\n  //        triage_parent.dispatchEvent(e); // copy is required.\r\n          e.preventDefault();\r\n          var evt = document.createEvent('MouseEvents');\r\n          evt.initMouseEvent(e.type, e.canBubble, e.cancelable, e.view,\r\n                     e.detail, e.screenX, e.screenY, e.clientX, e.clientY,\r\n                     e.ctrlKey, e.altKey, e.shiftKey, e.metaKey,\r\n                     e.button, e.relatedTarget);\r\n          triaged_catalog.ppn.dispatchEvent(evt);\r\n        };\r\n        function triage_onclick(cmd,attr, et){\r\n          triage_event(triaged_catalog, triaged_name, cmd, attr, et);\r\n          if (cmd!=='MERGEN') on_off.off();\r\n        }\r\n        function triage_event(clg, key, cmd, attr, et, pn_th, e){\r\n          if (cmd==='MENU' || cmd==='PMENU') {\r\n            if (key) {\r\n              on_off.make_menu(et, key, clg, pn_th, cmd==='PMENU');\r\n              site2['DEFAULT'].popups_posts.pop_down_temporarily(e);\r\n            }\r\n          } else if (cmd[0]==='P') {\r\n//            while (pn_src.classList.contains(pref.script_prefix+'_postMenu')) pn_src = pn_src.parentNode; // this is needed when postMenu is configurable.\r\n            var keyTime = site2[site.nickname].general_event_handler[site.whereami].menu2keyTime(on_off.pn_menuOpen);\r\n//            var keyTime = on_off.pn_menuOpen.getAttribute('data-attr').split(/[#@]/);\r\n            if (cmd==='PWATCH') clg.triage_event(keyTime[0], 'WATCH', '', keyTime[2]);\r\n            else hiddenPosts.cmd(clg, keyTime[0], keyTime[1], on_off.pn_menuOpen, cmd); // keyTime[0] instead of key is for merge\r\n          } else clg.triage_event(key,cmd,attr, undefined, pn_th || on_off.triaged_pn, et); // trg_now!==trg_hover);\r\n        }\r\n        function make_triage(){\r\n          var args = {onclick:triage_onclick, onmousewheel:triage_wheel, style:'pointer-events:none;position:absolute'}; // , name:'pn_catalog_triage'}\r\n          trg_hover = make_1(pref.catalog_triage_str, args);\r\n          trg_menu  = make_1(pref.triage.menu_str, {menu:true, child_style:'width:100%;', class:'menu', __proto__:args});\r\n          trg_pMenu = make_1(pref.triage.postMenu_str, {menu:true, child_style:'width:100%;', class:'postMenu', __proto__:args});\r\n        }\r\n        make_triage();\r\n\r\n        function embTri(cmd, caption){\r\n          return '<a class=\"'+pref.script_prefix+'_embeddedTriage\" data-cmd=\"'+cmd+'\">'+caption+'</a>';\r\n        }\r\n        var htmls = {\r\n          'REMOVET': '['+embTri('MERGET','Merge')+']',\r\n          'MERGET': '['+embTri('REMOVET','Remove')+']['+embTri('UNMERGET','Unmerge')+']',\r\n          'UNMERGET': '['+embTri('MERGET','Merge')+']['+embTri('REMOVET','Remove')+']',\r\n//          mergee: ' <a class=\"'+pref.script_prefix+'_button\" data-type=\"triage\" data-cmd=\"MERGEE\">[M]</a>',\r\n        };\r\n        return {\r\n//          get_triaged_thread_name: function(){return triaged_name;},\r\n//          get_triaged_catalog: function(){return triaged_catalog;},\r\n          change_mode: on_off.change_mode,\r\n          thread_in:  on_off.thread_in,\r\n          off: on_off.off,\r\n//          off_delay: on_off.off_delay,\r\n          triage_in:  on_off.triage_in,\r\n          triage_out: on_off.triage_out,\r\n//          set_trg: function(trg){trg_hover = trg;},\r\n//          get_trg: function(){return trg_hover;},\r\n//          onTriage_or_off: on_off.onTriage_or_off,\r\n          thread_out2: on_off.thread_out2,\r\n          destroy: function(){\r\n            this.off();\r\n            trg_hover.destroy();\r\n            trg_menu.destroy();\r\n            trg_pMenu.destroy();\r\n          },\r\n          remake: function(){\r\n            this.destroy();\r\n            make_triage();\r\n          },\r\n//          make_menu: on_off.make_menu,\r\n          embedded_onclick: function(e,clg){\r\n            var key = gGEH.get_key_recursive(e.target, e.currentTarget, true);\r\n            var tr = Triage.prototype.et2tr(e.target);\r\n            var pn_th = cataLog.GEH.prototype.geh.recSearch_thread(e.target, e.currentTarget, clg.view==='headline'? pref.script_prefix+'_headline' : undefined); // copied from popups_posts.triage\r\n            triage_event(clg, key, tr.cmd, tr.attr, e.target, pn_th, e);\r\n//            if (tr.cmd==='MENU' || tr.cmd==='PMENU') {\r\n//              if (key) on_off.make_menu(e.target, key, clg, pn_th, tr.cmd==='PMENU');\r\n//            } else clg.triage_event(key,tr.cmd,tr.attr, undefined, pn_th);\r\n          },\r\n//          postMenu: function(attr){\r\n//            var pn = Triage.prototype.postMenu.cloneNode(true);\r\n//            pn.setAttribute('data-attr',attr);\r\n//            return pn;\r\n//          },\r\n          htmls: htmls,\r\n          doms: {\r\n            emMerge: cnst.dom('<span>'+htmls['REMOVET']+'</span>'),\r\n            postMenu: cnst.dom(embTri('PMENU','\\u25b6')),\r\n          },\r\n          emb_get_key: function(et){\r\n            var href;\r\n            while (!(et.getAttribute && (href = et.getAttribute('href')))) et = et.previousSibling;\r\n            var domain = site2['DEFAULT'].popups_posts.href2domain(href);\r\n            return site2[domain].popups_href2dbtp(href).slice(0,3).join('');\r\n          },\r\n          add_submenu(ppn, args){\r\n            var pn = make_1(args, {onclick:triage_onclick, onmousewheel:triage_wheel, style:'pointer-events:auto;position:absolute;top:0px;left:'+(ppn.offsetWidth-5)+'px;width:700px'}).pn; // width is temporarily\r\n            ppn.appendChild(pn);\r\n            trg_submenu_leaf = pn;\r\n            if (!trg_submenu_root) trg_submenu_root = pn;\r\n          },\r\n        };\r\n      })();\r\n      Triage.prototype.doms = triage.doms;\r\n      var pn12_triage;\r\n      cataLog.triage = triage;\r\n                \r\n\r\n//      function insert_thread_with_test_from_catalog_json(th, snoop, date_load){\r\n//        if (threads[th.key] && threads[th.key][8][0]>=th.time_bumped && threads[th.key][8][2]==th.nof_posts && threads[th.key][8][3]==th.nof_files) return false;\r\n//        site2[th.domain].parse_funcs['catalog_json'].entry(th,['key','pn']);\r\n//\r\n//        var date = [th.time_bumped, th.time_created, th.nof_posts, th.nof_files]; // temporal\r\n//        th.search_obj = [ th.com, th.sub, th.name, '', '', '', '', '']; // temporal\r\n//        var url = site2[th.domain].make_url3(th.board, th.no, '0'); // temporal\r\n//        insert_thread(th.pn, th.domain, th.page, date_load, th.key, th.pn.innerHTML, date, th.search_obj, url, true, th);\r\n//        return true;\r\n//      }\r\n//      function insert_thread_with_test_from_catalog_html(th, snoop, date_load){\r\n//        if (threads[th.key] && threads[th.key][8][0]>=th.time_bumped && threads[th.key][8][2]==th.nof_posts && threads[th.key][8][3]==th.nof_files) return false;\r\n////        var th2 = site2[th.domain].catalog_from_native_1(th.pn,th.board);\r\n////        insert_thread_from_native(th2, th.domain, th.board, snoop, date_load);\r\n//        site2[th.domain].parse_funcs['catalog_html'].entry(th,['sub','name','com','page']);\r\n//        var date = [th.time_bumped, th.time_created, th.nof_posts, th.nof_files]; // temporal\r\n//        th.search_obj = [ th.com, th.sub, th.name, '', '', '', '', '']; // temporal\r\n//        var url = site2[th.domain].make_url3(th.board, th.no, '0'); // temporal\r\n//        insert_thread(th.pn, th.domain, th.page, date_load, th.key, th.pn.innerHTML, date, th.search_obj, url, true, th);\r\n//        return true;\r\n//      }\r\n\r\n      function insert_thread_with_test(th, type, date_load){\r\n        var name = th.key;\r\n//        if (threads_candidates_of_deletion && threads_candidates_of_deletion[name]) delete threads_candidates_of_deletion[name];\r\n        if (threads[name] &&\r\n//            ((threads[name][8][4] || threads[name][8][0])>=(th.time_posted || th.time_bumped)) && // vichan has inconsistency in time between catalog.json and thread.json.\r\n            (((threads[name][8][0]>threads[name][8][4])? threads[name][8][0] : (threads[name][8][4] || threads[name][8][0])) >= ((th.time_bumped > th.time_posted)? th.time_bumped : (th.time_posted || th.time_bumped))) && // vichan has inconsistency in time between catalog.json and thread.json.\r\n            threads[name][8][2]==th.nof_posts && threads[name][8][3]==th.nof_files\r\n          && (!threads[name][21] || (th.type_parse!=='thread_html' && th.type_parse!=='thread_json'))) {\r\n//        if (threads[name] && threads[name][8][0]>=th.time_bumped && threads[name][8][2]==th.nof_posts && threads[name][8][3]>=th.nof_files) {\r\n////////          if (threads[name] && pref.catalog_footer_show_page && threads[name][24] && threads[name][24][2]!=th.page) insert_footer3(name,null,th.page);\r\n          return false;\r\n        }\r\nif (pref.test_mode['0']) {\r\n        site2[th.domain].parse_funcs[type].entry(th,site2[th.domain].parse_funcs[type]['after_test']);\r\n}\r\n        insert_thread_passed_test(th, type, date_load);\r\n        return true;\r\n      }\r\n      function insert_thread_passed_test(th, type, date_load){\r\n//        var date = [th.time_bumped, th.time_created, th.nof_posts, th.nof_files]; // temporal\r\n//        th.search_obj = [ (th.com)? th.com : '', (th.sub)? th.sub : '', (th.name)? th.name : '', '', '', '', '', '']; // temporal\r\n        var url = null;\r\n////        if (type==='thread_html' || type==='page_html') {\r\n//////          if (site.nickname!==th.domain) site2[th.domain].absolute_link(th.pn, th.board); // patch for url. BUT BUG.\r\n////          url = site2[th.domain].get_thread_link(th.pn,th.board,pref.catalog_click!='expand',th.key);\r\n////          th.html_org = th.pn.innerHTML; // patch, must be before trim.\r\n////if (!pref.test_mode['5']) {\r\n////          trim_html(th.pn, th.domain, pref.catalog_format.show, th.key); // temporal\r\n////}\r\n////        }\r\n//////        } else url = site2[th.domain].make_url3(th.board, th.no, '0'); // temporal\r\n//////        site2[th.domain].parse_funcs[type]['finisher'](th);\r\n//        insert_thread(null, th.domain, th.page, date_load, th.key, (th.html_org)? th.html_org : th.pn.innerHTML, date, th.search_obj, url, true, th, type);\r\n        pClg.insert_thread(null, th.domain, th.page, date_load, th.key, null, th.search_obj, url, true, th, type);\r\n      }\r\n\r\n////////      function insert_thread_from_native(th, nickname, board, snoop, date_load){\r\n////////        var name = nickname + board + th.no;\r\n////////        var date = [th.time_bumped, th.time_created, th.nof_posts, th.nof_files];\r\n////////        var url = site2[nickname].make_url3(board, th.no, '0');\r\n//////////        if (threads[name] && threads[name][8][0]>=date[0]) return 0;\r\n////////        if (threads[name] && threads[name][8][0]>=date[0] && threads[name][8][2]==th.nof_posts && threads[name][8][3]==th.nof_files) return 0;\r\n//////////        if (threads[name] && threads[name][8][0]==date[0] && threads[name][8][2]!=th.nof_posts && nickname==='8chan' && pref.catalog.order.find_sage_in_8chan) threads[name][21] = true; // for 8chan.\r\n////////        return insert_thread(th.pn, nickname, th.page_no, date_load, name, th.pn.innerHTML, date, th.search_obj, url, true, th);\r\n////////      }\r\n\r\n////////      function re_trim_html(){\r\n////////        for (var name in threads) {\r\n////////          var date = get_mark_time(name,pref.filter.time_mark,pref.filter.list_mark_time,pref.filter.watch_list_mark_time);\r\n////////          if (date===0) date = Infinity;\r\n////////          var dbt = cnst.name2domainboardthread(name,true);\r\n////////          site2[dbt[0]].mark_newer_posts(threads[name][0],date);\r\n////////        }\r\n////////      }\r\n////      function trim_html(src,nickname,format, name){ // working code\r\n////if (!pref.test_mode['7']) { // memory leak debug.\r\n////  if (!pref.test_mode['8']) {\r\n////    if (!pref.test_mode['9']) {// safe\r\n////      if (!pref.test_mode['10']) { // safe 30 min.\r\n////if (!pref.test_mode['11']) {\r\n////        if (!format.fileinfo) site2[nickname].remove_files_info(src);\r\n////}\r\n////if (!pref.test_mode['12']) {\r\n//////        if (!format.posts)    site2[nickname].remove_posts(src,0);\r\n////        if (pref[embed_mode].t2h_num_of_posts>=0) site2[nickname].remove_posts(src,(!format.posts)? 0 : pref[embed_mode].t2h_num_of_posts);\r\n////}\r\n////if (!pref.test_mode['13']) {\r\n////        if (format.contents)  site2[nickname].format_thread_contents(src);\r\n////}\r\n////      }\r\n////        if (format.layout)    site2[nickname].format_thread_layout(src);\r\n////        if (format.style)     site2[nickname].format_thread_style(src);\r\n////                              site2[nickname].format_thread_always(src);\r\n////    }\r\n////        if (pref[embed_mode].localtime) site2[nickname].localtime(src);\r\n////    //        if (pref.filter.time_mark) site2[nickname].mark_newer_posts(src,date);\r\n////  }\r\n////}\r\n////      }\r\n////      function trim_html_mark_time(src,nickname,format, name){\r\n////        var date = get_mark_time(name, pref[embed_mode].mark_new_posts, pref[embed_mode].mark_new_posts, pref[embed_mode].mark_new_posts);\r\n////        if (date>0) site2[nickname].mark_newer_posts(src,date);\r\n////        if (pref[embed_mode].format.thumb.resize) site2[nickname].format_remove_tn_area_size(src);\r\n////      }\r\n////////      function insert_thread_from_page(src, nickname, boardname, op_no, page_no, nof_posts, nof_files, snoop, date_load){\r\n////////        var name = nickname + boardname + op_no;\r\n////////        if (snoop && !pref.catalog_promiscuous && !threads[name]) {\r\n////////          var hit = false;\r\n////////          for (var i=0;i<load_list.refresh.tgts.length;i++)\r\n////////            if (load_list.refresh.tgts[i][0].indexOf(nickname+boardname+'p'+page_no)!=-1 ||\r\n////////                load_list.refresh.tgts[i][0].indexOf(nickname+boardname+op_no)!=-1) {hit=true;break;}\r\n////////          if (!hit) return 0;\r\n////////        }\r\n////////        var date = site2[nickname].get_time_of_posts(src);\r\n////////        if (threads[name] && threads[name][13]<date_load) update_page_in_footer(name,page_no,date_load);\r\n////////        if (threads[name] && threads[name][8][0]>=date[0]) return 0;\r\n//////////console.log('In :'+name);\r\n////////        var url = site2[nickname].get_thread_link(src,boardname,pref.catalog_click!='expand',name);\r\n//////////        var date_mark = Date.parse(pref.filter.time_str) - pref.localtime_offset*3600000;\r\n//////////        console.log(name+', '+date);\r\n//////////        var src1 = document.createElement('div');\r\n//////////        src1.innerHTML = src.innerHTML;\r\n////////        var html_org = src.innerHTML;\r\n////////        var src2 = document.createElement('div');\r\n////////        src2.innerHTML = src.innerHTML;\r\n////////        var cross_domain = pref.catalog_board_list_obj[board_sel.selectedIndex][0]['domain']!=nickname;\r\n////////        var cross_board  = pref.catalog_board_list_obj[board_sel.selectedIndex][0]['board']!=boardname;\r\n////////        date = date.concat(site2[nickname].insert_footer(src,page_no,((cross_domain)? nickname : '')+((cross_board)? boardname : ''),pref.catalog_footer,date,nof_posts,nof_files));\r\n//////////        trim_html(src,  nickname, pref.catalog_format.show, date_mark);\r\n////////////        trim_html(src1, nickname, pref.catalog_format.hover, date_mark);\r\n//////////        trim_html(src2, nickname, pref.catalog_format.search, date_mark);\r\n////////        trim_html(src,  nickname, pref.catalog_format.show, name);\r\n////////        trim_html(src2, nickname, pref.catalog_format.search, name);\r\n////////        return insert_thread(src, nickname, page_no, date_load, name, html_org, date, src2, url, false, {board:boardname});\r\n////////      }\r\n//      function convert_html(name,th){\r\n//        if (!embed_catalog && pref.catalog.text_mode.mode==='text') {\r\n//          var text = document.createElement('span');\r\n//          text.innerHTML = ((pref.catalog.text_mode.sub  && threads[name][4][1][0])? '&emsp;' + threads[name][4][1][0] : '') +\r\n//                           ((pref.catalog.text_mode.name && threads[name][4][2][0])? '&emsp;' + threads[name][4][2][0] : '') +\r\n//                           ((pref.catalog.text_mode.com  && threads[name][4][0][0])? '&emsp;' + threads[name][4][0][0] : '');\r\n//          var footer_new = document.createElement('span');\r\n//          footer_new.innerHTML = th.footer.innerHTML; // make footer on demand.\r\n//          th.footer = footer_new;\r\n//          th.pn.innerHTML = '';\r\n//          th.pn.appendChild(th.footer);\r\n//          th.pn.appendChild(text);\r\n//          threads[name][18] = 'text';\r\n//        } else {\r\n//          th.pn.innerHTML = threads[name][25][1];\r\n//          th.footer = threads[name][25][0];\r\n//        }\r\n//      }\r\n\r\n////////\r\n//////// safe758\r\n////////              page                  catalog + thread\r\n//////// adoptNode    works with errors     works with errors\r\n//////// importNode   works with errors     works with errors\r\n//////// None         works with no errors  works with no errors\r\n////////\r\n//////// Memory leak was found with None (document leaks when I read KC's one), but I'll go with None.\r\n////////\r\n//      function insert_thread(src, nickname, page_no, date_load, name, html_org, src2, url, from_native, th, type){\r\n      function merge_deleted_posts(lth, posts, num, t2h){\r\n        return site2[lth.domain].update_posts_merge_prep(posts, lth.pd, (num===false)? posts.length-1 : (num===-1)? -1 : num, true); // don't have to consider num of deleted posts, it's a sync issue between thread and catalog. Unread deleted posts are in unread posts always.\r\n//        return site2[lth.domain].update_posts_merge_prep(posts, lth.pd, (num===false)? posts.length-1 : (num===-1)? -1 : num + ((t2h==='unread' || t2h==='N_unread')? lth.pd.length : 0), true); // patch; count of unread posts doesn't contain deleted posts.\r\n      }\r\n      var tgt_th16_proto = {\r\n        get no(){return this.dbt[2];},\r\n        get board(){return this.dbt[1];},\r\n        get domain(){return this.dbt[0];},\r\n        get key(){return this.dbt.join('');},\r\n        get nof_posts(){return liveTag.mems.getFromName(this.key).nof_posts;},\r\n        get nof_files(){return this.threads[this.key][8][3];},\r\n//        get time(){return this.posts[0].time || threads[name][8][1];},\r\n////        get sub(){return threads[this.key][4].sub;}, // this.posts && this.posts[0].sub;}, // for reentry in meguca\r\n////        get com(){return threads[this.key][4].com;}, // this.posts && this.posts[0].com;}, // for reentry in meguca\r\n////        get txt(){return threads[this.key][4].txt;}, // this.posts && this.posts[0].txt;}, // for reentry in meguca\r\n        get tags(){return liveTag.mems.getFromName(this.key);},\r\n        recent_posts: function(num, posts_in) { // , remake){\r\n          if (num===undefined || num===null) num = this.get_t2h_num_of_posts();\r\n          var posts = posts_in;\r\n          if (num!==false && this.lth.ta) posts = site2[this.lth.domain].update_posts_replace_prep(null, this.lth.ta.posts, num); // cut // if (lth.ta) is required for merge/merge_list.\r\n////          if (num!==false && !remake) { // working code\r\n////            if (!pref.test_mode['113']) {\r\n////              if (this.lth.ta) posts = site2[this.lth.domain].update_posts_replace_prep(null, this.lth.ta.posts, num); // cut // if (lth.ta) is required for merge/merge_list.\r\n////            } else {\r\n////              if (this.th && this.th.posts) posts = site2[this.lth.domain].update_posts_replace_prep(posts || this.th.posts, this.th.posts, num); // merge, posts===this.th.posts occurs also.\r\n//////            var posts = this.th && this.th.posts;\r\n////              if (this.posts && (num!=-1 || this.posts!==posts)) posts = site2[this.lth.domain].update_posts_replace_prep(posts || this.posts, this.posts, num); // merge // MUST CHANGE ADDRESS OF th.posts, 'th.posts===th_old.posts' is used 'insert_thread_format_html'\r\n////            }\r\n////          } \r\n//          if (pref.test_mode['135']) if (!posts_in) {\r\n//            if (posts && this.lth.pd) posts = posts.filter(function(v){return !v.deleted_after;}); // posts may contain >num deleted posts.\r\n//            if ((!posts || num<0 || posts.length<=num) && this.lth.ta) posts = site2[this.lth.domain].update_posts_replace_prep(posts || this.lth.ta.posts, this.lth.ta.posts, num);\r\n//          }\r\n          if (!posts) posts = [this.op];\r\n//          var posts = this.th && this.th.posts || this.lth.ta && this.lth.ta.posts && site2[this.lth.domain].update_posts_replace_prep(this.posts || this.lth.ta.posts, this.lth.ta.posts, num) || this.posts;\r\n          return (!pref.test_mode['64'] && pref[embed_mode].deleted_posts.merge && this.lth.pd)? merge_deleted_posts(this.lth, posts, num, pref[embed_mode].t2h_sel) : posts;\r\n        },\r\n        get_t2h_num_of_posts: function(){\r\n          var t2h_sel = this.t2h_sel || pref[embed_mode].t2h_sel;\r\n          return (t2h_sel==='page')? this.t2h_page || pref[embed_mode].t2h_num_of_posts\r\n            : (t2h_sel==='L')? pref[embed_mode].t2h_L\r\n            : (t2h_sel==='M')? pref[embed_mode].t2h_M\r\n            : (t2h_sel==='N')? pref[embed_mode].t2h_num_of_posts\r\n            : (t2h_sel==='N_unread')? pref[embed_mode].t2h_num_of_posts + this.lth.nr\r\n            : (t2h_sel==='unread')? (this.lth.watched? this.lth.nr : this.t2h_page || pref[embed_mode].t2h_num_of_posts)\r\n            : (t2h_sel==='no')? 0 : -1; // 'ALL' // and 'ALL_agg'\r\n        },\r\n        expand_num: function(){\r\n          var num = this.get_t2h_num_of_posts()+1;\r\n          var nof_posts = this.lth.nof_posts || this.lth.th.nof_posts; // this.lth.th.nof_posts for initial condition in page without any refresh\r\n          return (num==0 || num>nof_posts)? nof_posts : num;\r\n        },\r\n        expand_event: function(idx, kwd_active){\r\n          this.t2h_sel = format_html.get_t2h_from_index(idx);\r\n          if (!kwd_active) if (this.check_and_expand(this.recent_posts(), true)) scan.scan_ui('expand_page', {tgts:[this.key], options:{refresh:this.clg}});\r\n        },\r\n        check_and_expand: function(posts, contract){\r\n          var expand = posts.length < this.expand_num();\r\n          if (expand) {\r\n            this.expand_posts = true;\r\n            scan.list_nup.add(this.key, 1); // for vichan which has only one post in catalog.\r\n//            scan.scan_ui('expand_page', {tgts:[this.key], options:{refresh:this.clg}});\r\n          } else if (contract) {\r\n            var th = {posts:posts, __proto__:this.threads[this.key][7]};\r\n//            site2[posts[0].domain_html].page_json2html3_add_omitted_info(th, this.posts, th.posts); // redundant, it's in 'update_posts_replace'.\r\n            this.clg.insert_thread_prepare_html_lazy(this.threads[this.key], false, false, null, th);\r\n            cataLog.show_catalog(this.key, true);\r\n          }\r\n          gClg.Maintain_AllThreads(this.key);\r\n          return expand;\r\n        },\r\n      };\r\n      Clg.prototype.insert_thread_dummy = function(domain, board, no){\r\n        var proto = site2['DEFAULT'].wrap_to_parse.get_getters();\r\n        var posts = [{domain:domain, board:board, no:no, key:domain+board+no,\r\n                      sub:'', com:'DUMMY, waiting for archive...', body:'', name:'', id:undefined, trip:undefined, country:undefined, flag:null, op_img_url:undefined,\r\n                      time_bumped:1, time_posted:1, time_created:1, nof_posts:1, nof_files:0,\r\n                      parse_funcs:{type_com:'html'},\r\n                      sticky:false,\r\n                      __proto__:proto}];\r\n        var th = {posts:posts, __proto__:posts[0]};\r\n        liveTag.prep_tags(th);\r\n        this.insert_thread(th, 0);\r\n        this.threads[domain+board+no][16].missing_info = 10000;\r\n      };\r\n      Clg.prototype.insert_thread = function(th, date_load, merge, nos){\r\n//        var date_load = date_load;\r\n        var name = th.key;\r\n        var insert_thread_from_native = th.insert_thread_from_native;\r\n////if (!pref.test_mode['28']) {\r\n////        if (site2[th.domain].preprocess_doc && !insert_thread_from_native) site2[th.domain].preprocess_doc(th.pn);\r\n////}\r\n////if (pref.test_mode['26']) { // Leak is caused by DOMParser itself.\r\n//////        if (!insert_thread_from_native && th.type_data==='html') document.adoptNode(th.pn);  // KC causes memory leak if I don't use adoptNode(). // causes error in page mixing.\r\n////        if (!insert_thread_from_native && th.type_data==='html') th.pn = document.adoptNode(th.pn);\r\n////}\r\n////if (pref.test_mode['27']) {\r\n////        if (!insert_thread_from_native && th.type_data==='html') th.pn = document.importNode(th.pn, true);\r\n////}\r\n//        if (th.pn.parentNode) th.pn.parentNode.removeChild(th.pn); // redundant.\r\n////        if (site.nickname!==th.domain && th.type_data==='html') site2[th.domain].absolute_link(th);\r\n//////        if (site.nickname!==th.domain) site2[th.domain].absolute_link(th); // make th.pn implicitly.\r\n        var init_new = false;\r\n        var tgt_th = this.threads[name];\r\n        var date = [th.time_bumped, th.time_created, th.nof_posts, th.nof_files, th.time_posted];\r\n        if (tgt_th && tgt_th[16].missing_info && (tgt_th[16].missing_info>((th.missing_info|0) - (site2[th.domain].revise_thread? 1:0)))) { // revise thread for BBC\r\n          if (!th.page && tgt_th[7]) th.page = tgt_th[7].page;\r\n          this.remove_thread(name, true); // , false, true);\r\n          tgt_th = undefined;\r\n          var flag_overwrite = true;\r\n        }\r\n        var lth = th.lth;\r\n        if (tgt_th==undefined) {\r\nif (pref.test_mode['19']) { // stability test.\r\n          if (th.parse_funcs_html.th_init) th.parse_funcs_html.th_init(th); // BUG, should be moved into show_catalog() because threads aren't shown all the time and cause memory leak.\r\n}\r\n          init_new = true;\r\n          tgt_th = [(insert_thread_from_native)? th.pn : false, // lazy generation, null may be returned by DOM, so 'false' is used here.\r\n                           insert_thread_from_native && site.whereami!=='archive',\r\n                           null, // not used // (!pref.test_mode['127'])? null : (embed_mode==='page' || !pref.test_mode['110'])? [triage.thread_in, null] : [func_in, func_pop_up]\r\n                           null, // 3: merge info at view==='catalog'\r\n//                           [html_org || th.pn.innerHTML, nickname], // PATCHED. THIS WILL BE REMOVED.\r\n                           null, // not used // th.posts && th.posts.slice(0,1), // 4 // {sub:th.sub, com:th.com, name:th.name, trip:th.trip, filename:th.filename}\r\n//                           click_thread, // 5, click function.\r\n                           [], // 5, click source\r\n                           null,\r\n                           null, // (!pref.test_mode['49'])? th : undefined, // 7, th, // test\r\n                           date,\r\n                           [null,0,null,0], // [true,0,true,0], // filter result\r\n//                           (from_native)? click_thread_native : click_thread, null, url, date, true,\r\n                           null, // timestamp for posts search\r\n                           null, null, date_load, th.page, 0,\r\n//                           (from_native && brwsr.ff)? th.init_func : null, // 16\r\n//                           null, // 16, NOT USED\r\n                           { dbt: common_func.name2domainboardthread(name,true),\r\n//                             th_destroy: th.parse_funcs_html.th_destroy,\r\n                             parse_funcs: th.parse_funcs,\r\n                             systemSticky: th.sticky,\r\n                             type_html: th.type_html, // for insert_thread_from_native\r\n                             domain_html: th.domain_html,\r\n                             parse_funcs_html: th.parse_funcs_html,\r\n                             icon_sticky: null,\r\n                             icon_show_always: null,\r\n                             show_always: null,\r\n//                             op_img_src_url: null,\r\n                             th: th,\r\n//                             popups: null, posts:null,\r\n                             lth: lth, // th.lth,\r\n                             op: th.posts && th.posts[0], // required in recent_posts to produce search source if no posts are stored in catalog mode. 'th.posts &&' must be redundant, but I haven't checked consistency yet.\r\n                             threads:this.threads,\r\n                             clg:this,\r\n                             __proto__: tgt_th16_proto\r\n                           }, // 16, others\r\n//                           ch[brwsr.innerText].match(tags_scan_regex), // 17, tag\r\n                           null, // 17, tag // NOT USED\r\n                           th.type_html, // 18, type of html\r\n                           null, // 19, tracking info\r\n//                           [0,0,0,0,null,false,-2, 0, true, [], 0], // debug\r\n                             // 19, time_of_checked, num_of_unread_replies_TO_ME, num_of_unread_replies,\r\n                             //     time_of_checked_time_internal, args_for_desktop_notification, init,\r\n                             //     time_of_checked_old, num_of_unread_old, inital_loop // for faster execution.\r\n                             //     tag_temp, num_of_checked_posts_so_far\r\n                           th.sticky, // 20 sticky.\r\n//                           (nickname==='8chan' && from_native && pref.catalog.order.find_sage_in_8chan), // 21, watch.\r\n                           false, // 21, watch.\r\n                           null, // 22, attr info for rollback. // not used \r\n                           null, // 23, for missing info\r\n                           null, // 24, footer.\r\n//                           null, // 25, text_mode [0]: footer, [1]: html_backup\r\n//                           th.op_img_url, // 26 op_iamge_url\r\n                           ];\r\n          if (th.missing_info) tgt_th[16].missing_info = th.missing_info;\r\n          if (flag_overwrite) { // patch for merge, keep threads[name]. see site2['DEFAULT'].update_posts_merge_bases.base_factory\r\n            for (var i=0;i<tgt_th.length;i++) this.threads[name][i] = tgt_th[i];\r\n            tgt_th = this.threads[name];\r\n          } else this.threads[name] = tgt_th;\r\n//          if (name in threads_last_deleted) tgt_th[8][4] = threads_last_deleted[name].last_post_time;\r\n//          tgt_th[17] = liveTag.prep_tags(th);\r\n          tgt_th[19] = lth.wt; // liveTag.mems[th.domain][th.board][th.no].wt;\r\n          if (!(embed_mode==='catalog' && th.domain===site.nickname) &&\r\n              ((th.domain==='KC' && th.type_source==='catalog') // doesn't have time info\r\n              || th.posts[0].editing // th.domain==='meguca' // doesn't have op. FIXED in v3.\r\n              )) {\r\n            tgt_th[16].missing_info = 10000;\r\n            if (th.type_source==='catalog') scan.list_nup.add(th.key);\r\n          } else if (th.type_source==='archive') { // for 4chan archive\r\n            tgt_th[16].missing_info = 10000;\r\n            scan.list_nup.add_scan(th.key);\r\n          }\r\n          if (th.archiveFile) tgt_th[16].archiveFile = th.archiveFile;\r\n////          if (th.parse_funcs.missing_info) { // working code.\r\n////            tgt_th[23] = common_func.shallow_copy_1(th.parse_funcs.missing_info);\r\n////            if (pref.network.fetch_actively) th.parse_funcs.missing_info_fetch(th);\r\n////          }\r\n\r\n////          if ((embed_mode==='page' || embed_mode==='thread') && th.nof_posts>1 && th.posts.length===1) {\r\n//////            cataLog.scan_init('refresh_inserted', [th.key], {refresh:true}); // DOESN'T WORK BECAUSE OF SO MANY REQUEST STOP PREVIOUS REQUESTS.\r\n////            catalog_liveTag_scan_ui('scan_ui', {tgts:[th.key], options:{refresh:true}});\r\n////          }\r\n//          if (!(tgt_th[19][0]&0x000c0000) && (tgt_th[19][0]&0x00010000) && tgt_th[19][2]===0) {\r\n//            var time_watch;\r\n//            if (date[4]||date[0]) time_watch = get_watch_time_of_a_thread(name,date[1],date[4]||date[0], true); // THIS MAY BE REDUNDANT, threads pass 'prep_tags' always.\r\n//            if (time_watch===0 && embed_mode==='thread' && pref.catalog.auto_watch) time_watch = (th.posts[th.posts.length-1].time || th.time);\r\n//            if (time_watch!==0) site2[th.domain].check_reply.set_watch_time(tgt_th[19], time_watch);\r\n//          }\r\n////          if (site2[site.nickname].historyAPI) { // for reentry\r\n////            tgt_th[16].tn_w = th.tn_w;\r\n////            tgt_th[16].tn_h = th.tn_h;\r\n////            tgt_th[16].op_img_url = th.op_img_url;\r\n////          }\r\n          if (this.mode==='thread') tgt_th[16].t2h_sel = (merge)? pref[embed_mode].t2h_sel : 'all'; // intentional lower leters, work as 'ALL' but distinguishable.\r\n//          if (this.mode==='thread' && merge) {\r\n//            tgt_th[16].t2h_page = tgt_th[16].get_t2h_num_of_posts();\r\n//            tgt_th[16].t2h_sel = 'page';\r\n//          }\r\n        }\r\n        if (!pref.test_mode['170']) if (th.parse_funcs.posts_full) th.parse_funcs.posts_full(th);\r\n        lth.th = th;\r\n        if (!date[0]) date[0] = tgt_th[8][0];\r\n        if (!date[4]) date[4] = (tgt_th[8][4]<date[0])? date[0] : (tgt_th[8][4])? tgt_th[8][4] : site2[th.domain].check_reply.get_checked_time(tgt_th[19]);\r\n        tgt_th[8] = date;\r\n//        if ((tgt_th[19][0]&0x00840000)===0x00800000 && (date[1]>0||date[4]>0)) { // moved to liveTag.prep_tags\r\n//          set_watch_time_thread(name, embed_mode, date[1],date[4], th, tgt_th[19]); // for meguca or those don't have time at first.\r\n////          if ((tgt_th[19][0]&0x00840000)!==0x00800000) scan.list_nup.add_scan(th.key); // patched by trim_list:'force_init'\r\n////            if (th.type_source==='thread') scan.list_nup.add_scan(th.key);\r\n////            else scan.list_nup.add_board(th.domain+th.board);\r\n//        }\r\n\r\n////        if (tgt_th[16].posts && tgt_th[16].posts.length===1 && (tgt_th[16].parse_funcs.missing_info > (th.parse_funcs.missing_info || -1))) { // PATCH\r\n////          th.posts[0].pn = tgt_th[16].posts[0].pn;\r\n////          tgt_th[16].posts = th.posts; // this cause inconsistency between posts shown and posts stored.\r\n////          tgt_th[16].parse_funcs = th.parse_funcs;\r\n////          tgt_th[16].parse_funcs_html = th.parse_funcs_html;\r\n////          format_html.prepare_html_prep_posts(th);\r\n////        }\r\n        \r\n//        var flag_posts_stored = embed_mode==='catalog' && pref[embed_mode].t2h_sel==='no' && th.parse_funcs.has_posts && pref.filter.kwd.posts_active && \r\n//          th.posts && // patch for 4chan catalog.\r\n//          (pref[embed_mode].popup2==='sr' || (pref[embed_mode].popup2==='srpv' && catalog_filter_query_keyword.kwd(pref.filter.kwd, th.posts, th.domain, th))); // for simple search with scan.\r\n//        if (flag_posts_stored) {\r\n//          th.posts = catalog_filter_query_keyword.kwd_make_result(th.posts, th.domain, th);\r\n//          if (th.posts) {\r\n//            th.posts[0].__proto__.search_result = th.posts[0].search_result; // patch. see 'catalog_filter_query_keyword.kwd_make_result'\r\n//            th.posts[0] = th.posts[0].__proto__;\r\n//          }\r\n//        }\r\n\r\n//        tgt_th[9] = (picked_up_by_kwd_filter)? [true] : catalog_filter_query(name); // moved to later to apply t2h_num_of_posts\r\n//        if (insert_thread_from_native) threads[name][16].posts = th.posts; // for reentry // BUG, html update exist in embed_thread.\r\n        if (insert_thread_from_native) tgt_th[16].posts = insert_thread_from_native.posts_shown;\r\n//        if (init_new && tgt_th[0]) threads[name][16].posts = th.posts;\r\n        if (th.type_source==='page' || th.domain==='4chan' && th.type_parse==='catalog_json') tgt_th[16].t2h_page = th.posts.length-1;\r\n\r\n        if (tgt_th[16].expand_posts && (tgt_th[16].expand_num<=th.nof_posts || th.type_source==='thread')) tgt_th[16].expand_posts = false; // prevent infinite loop caused by !tgt_th[1]\r\n//if (pref.test_mode['135']) {\r\n//        var t2h_num_of_posts = ((this.view!=='page' && this.view!=='thread') || (tgt_th[16].t2h_sel || pref[embed_mode].t2h_sel)!=='page')? tgt_th[16].get_t2h_num_of_posts() : false;\r\n//        if (t2h_num_of_posts!==false) {\r\n//          if (init_new && (t2h_num_of_posts<0 || t2h_num_of_posts+1>th.posts.length) && th.posts.length<th.nof_posts && (this.view==='page' || this.view==='thread')) { // load to add\r\n////          if (init_new && (t2h_num_of_posts<0 || t2h_num_of_posts+1>th.posts.length) && th.posts.length<th.nof_posts) { // doesn't work for short links(last 50 posts)\r\n//            tgt_th[16].expand_posts = true;\r\n//            scan.list_nup.add_scan(th.key);\r\n////            catalog_liveTag_scan_ui('scan_ui', {tgts:[name], options:{refresh:true}});\r\n//          }\r\n//        }\r\n////        var lth = th.lth;\r\n//        if (th.parse_funcs.has_posts) th.posts = tgt_th[16].recent_posts(t2h_num_of_posts, th.posts); // moved to 'update_posts_in_page'\r\n//} else {\r\n        if ((this.view==='page' || this.view==='thread') && init_new) tgt_th[16].check_and_expand(th.posts);\r\n//}\r\n//        if (th.parse_funcs.has_posts && (pref.test_mode['49'] || !flag_posts_stored)) th.posts = tgt_th[16].recent_posts(t2h_num_of_posts, th.posts);\r\n////        if (th.parse_funcs.has_posts && (pref.test_mode['49'] || !flag_posts_stored)) { // working code\r\n////          if (t2h_num_of_posts!==false) {\r\n////            if (tgt_th[16].th) th.posts = site2[th.domain].update_posts_replace_prep(th.posts, tgt_th[16].th.posts, t2h_num_of_posts); // merge\r\n////            if (tgt_th[16].posts) th.posts = site2[th.domain].update_posts_replace_prep(th.posts, tgt_th[16].posts, t2h_num_of_posts); // merge // MUST CHANGE ADDRESS OF th.posts, 'th.posts===th_old.posts' is used 'insert_thread_format_html'\r\n//////            if (embed_mode==='catalog' && th.posts.length<((t2h_num_of_posts>0)? t2h_num_of_posts : th.nof_posts) && lth.ta && lth.ta.posts.length>th.posts.length) th.posts = site2[th.domain].update_posts_replace_prep(th.posts, lth.ta.posts, t2h_num_of_posts); // merge, ONLY FOR FLAGS, CAN BE REMOVED AFTER CHANGING TO INCREMENTAL FLAGS.\r\n////            // CAUSE BUG??? may cayse mixing posts which should use different prototype, posts_html and posts_json.\r\n////          }\r\n////          if (!pref.test_mode['64'] && pref[embed_mode].deleted_posts.merge && lth.pd) th.posts = merge_deleted_posts(lth, th.posts, t2h_num_of_posts, pref[embed_mode].t2h_sel);\r\n//////            th.posts = site2[th.domain].update_posts_merge_prep(th.posts, th.lth.pd, \r\n//////              (t2h_num_of_posts===false)? th.posts.length-1 : t2h_num_of_posts + ((t2h_num_of_posts==='unread' || t2h_num_of_posts==='N_unread')? th.lth.pd.length : 0), true);\r\n////        }\r\n        if (!th.page && tgt_th[16].th) th.page = tgt_th[16].th.page;\r\n        if (!init_new && th.parse_funcs.has_posts && (this.view==='page' || this.view==='thread')) tgt_th[16].th = th;\r\n        if ((!pref.test_mode['49'] && pref[embed_mode].t2h_sel!=='no' || site2[site.nickname].historyAPI) && (!tgt_th[7] || th.parse_funcs.has_posts)) tgt_th[7] = th; // patch for reentry\r\n////        if (!pref.test_mode['49'] && pref[embed_mode].t2h_sel!=='no') tgt_th[7] = th;\r\n//        if (pref.test_mode['135']) if (pref[embed_mode].t2h_sel==='no') th.posts = th.posts.slice(0,1); // don't change th.posts itself, some other catalog may grep that. // moved to 'update_posts_in_page'\r\n////        if (!pref.test_mode['49'] && th.parse_funcs.has_posts && pref.filter.kwd.posts_active && !flag_posts_stored) tgt_th[7] = th; // BUG at catalog.\r\n        this.filter_dirtify(tgt_th,true);\r\n//        tgt_th[9][0] = null;\r\n//        tgt_th[9][2] = null;\r\n////        tgt_th[9] = (pref.filter.disLWKA && picked_up_by_kwd_filter)? [true] : catalog_filter_query(name);\r\n//        tgt_th[9] = catalog_filter_query(name, true); // slightly redundant.\r\n\r\n//        catalog_attr_set(th.key,tgt_th[0]); // for cmd '!show'.\r\n        var pff = this.pref.filter;\r\n        if (insert_thread_from_native || (tgt_th[16].expand_posts && tgt_th[1] && !pff.kwd.posts_active) || pref.test_mode['36']) this.insert_thread_prepare_html_lazy(tgt_th, init_new, insert_thread_from_native, null, th);\r\n////        else {\r\n////          var th_old = tgt_th[16].th;\r\n////          if (th_old.posts.length<=1 || th.posts.length>1 && th.posts[th.posts.length-1].no > th_old.posts[th_old.posts.length-1].no) tgt_th[16].th = th;\r\n////          else if (th.page) th_old.page = th.page;\r\n////          catalog_attr_set(th.key,tgt_th[0]); // for 'show'.\r\n////        }\r\n        if (init_new) {\r\n          if (pff.auto_list.use) { // must be after making html, because this may inboke show_catalog\r\n            if (!pff.list_obj2[th.key] && !pff.watch_list_obj2[th.key] && !pff.attr_list_obj2[th.key]) { // CAUTION, obj2 are accessed directly.\r\n              var auto_obj = pref_func.merge_obj5a(th,pff.auto_list.obj7,null);\r\n              if (auto_obj) this.apply_auto_list_filter(th, auto_obj);\r\n            }\r\n          }\r\n//          if (pref.test_mode['177']) pref3.proto.merge_list_obj2c_update(th.key); // DOESN'T WORK, tgts may NOT be registered yet.\r\n          var pfm = this.pref[this.mode];\r\n          if ((pfm.merge_list || pfm.merge_list_delayed) && pfm.merge_op_auto && (this.view==='catalog' || this.view==='headline')) { // merge_list_delayed for 4chan, see delayed_merge\r\n            if (!pref3.proto.merge_list_obj2[name] && !pref3.proto.merge_lv_obj2[name]) { // merge_lv is used as an end flag // CAUTION, obj2 are accessed directly.\r\n              if (th._links) for (var i=th._links.length-1;i>=0;i--) {\r\n                var link = th._links[i];\r\n                var tgt = link.slice(0,3).join('');\r\n                if (nos && link[0]===th.domain && link[1]===th.board && !(link[2] in nos)) {\r\n                  if (!pref.test_mode['147'] || !pfm.merge_op_auto_hop) continue;\r\n                  var hop = lth.mh || 0;\r\n                  if (hop >= pfm.merge_op_auto_hop) continue;\r\n                  scan.list_nup.add_scan(tgt); // BUG, REQUIRES REQUEST FLAG or promiscuous mode.\r\n                  var tgt_lth = liveTag.mems.getFromName(tgt);\r\n                  if (!tgt_lth.mh || tgt_lth.mh > hop +1) tgt_lth.mh = hop +1; // for racing condition\r\n                  nos[link[2]] = null; // add mask because rm_items_404_check will be run right after this.\r\n                }\r\n                if (pfm.merge_op_lv_add) this.merge_bases.add_to_lv_list(th.key, pfm.merge_btn_lv, this); // levelize old one, instead of new one.\r\n                this.merge_bases.add_to_list_1(tgt, th.key, this, true, true); // merge new one to old one to cascade.\r\n//              this.force_all_named = true;\r\n                if (pfm.merge_op_attr || pfm.merge_op_list) {\r\n                  var attr = (pfm.merge_op_attr)? this.view_attr_get_str(tgt) : null;\r\n                  var list = (pfm.merge_op_list)? pff.list_obj2[tgt] : null; // CAUTION, obj2 are accessed directly.\r\n                  if (attr || list) this.triage_exe_broadcast(th.key, !list? 'NONE' : list.time? 'TIME' : 'KILL', attr || '', false, list && list.time || null, false, true); // CAUTION: TRIAGE IS SLOW BECAUSE IT IS DESIGNED TO BE USED AS GUI, it redraws doms and remake objs always.\r\n                }\r\n                break;\r\n              }\r\n            }\r\n          }\r\n          this.view_attr_set(th.key, null, true); // after making html to remove redundant check of !footer in footer.draw. // for cmd '!show' and sticky:false\r\n        }\r\n\r\n        if (th.domain==='meguca') {\r\n//        if (th.domain==='meguca' && tgt_th[16].needs_update!==true) {\r\n          if (lth.ed_t) {\r\n            lth.ed_u = th.replyTime; // meguca don't update JSON while editing.\r\n//          var ed_p = lth.ed_p || lth.ed_t; // share lth.ed_t when pref.liveTag.from==='post'\r\n//          if (ed_p) {\r\n//            var i=0;\r\n//            while (i<ed_p.length && typeof(ed_p[i])==='string') i++;\r\n//            lth.ed_u = (!th.posts[1] || th.posts[1].no<=ed_p[i])? -1 : th.replyTime; // -1 for force update when editing posts are in scope. // 0 can't be used, because lth.ed_u becomes falsy.\r\n          } else if (lth.ed_u) lth.ed_u = undefined; // null can't be used because (null<123) is true.\r\n//          if (ed_p || tgt_th[16].needs_update<th.replyTime || tgt_th[16].needs_update===null)\r\n//            tgt_th[16].needs_update = (ed_p && !(th.posts[1] && th.posts[1].no<=ed_p[ed_p.length-1]))? null : th.replyTime; // null means 'in scope and force update'.\r\n//        if (th.domain==='meguca' && tgt_th[16].needs_update!==true) tgt_th[16].needs_update = th.lastUpdated || ((th.lth.ed_p)? null : undefined); // lastUpdated may be undefined.\r\n//        if (th.parse_funcs.has_editing && tgt_th[16].needs_update!==true) tgt_th[16].needs_update = (th.lth.ed_p)? 1 : null;\r\n        }\r\n//        if (!pref.test_mode['114'] && Clg.prototype.Clgs.length>=2 && pref.test_mode['133']) for (var i=1;i<Clg.prototype.Clgs.length;i++) clone_thread(Clg.prototype.Clgs[i],name);\r\n        return tgt_th;\r\n      };\r\n      Clg.prototype.apply_auto_list_filter = function(th, obj){\r\n        for (var i=0;i<obj.length;i++) {\r\n          if (obj[i].use!==false && catalog_filter_query_keyword.kwd({use:true, __proto__:obj[i]}, th.posts, th.domain)) {\r\n            var cmds = obj[i].cmds.split(',');\r\n            for (var j=0;j<cmds.length;j++) {\r\n              var idx = cmds[j].indexOf(':');\r\n              this.triage_exe_broadcast(th.key, idx===-1? cmds[j] : cmds[j].slice(0,idx), idx===-1? '' : cmds[j].slice(idx+1), false, null, false, true); // CAUTION: TRIAGE IS SLOW BECAUSE IT IS DESIGNED TO BE USED AS GUI, it redraws doms and remake objs always.\r\n            }\r\n          }\r\n        }\r\n      };\r\n      cataLog.set_watch_time_thread = function(name, embed_mode, time_created, time_posted, th, watch){\r\n        var time_watch = pClg.get_watch_time_of_a_thread(name,time_created,time_posted, true);\r\n        if (time_watch===0 && embed_mode==='thread' && pref.catalog.auto_watch && name===site.key) time_watch = time_posted || time_created;; // name===site.key for archive, which has a mode of store_watched\r\n        if (time_watch>0) site2['DEFAULT'].check_reply.set_watch_time(watch, time_watch, name);\r\n//        else if (time_watch===0 && embed_mode==='thread' && pref.catalog.auto_watch && name===site.key) site2['DEFAULT'].check_reply.set_watched_to_last(watch, time_posted || time_created, name); // name===site.key for archive, which has a mode of store_watched\r\n        else site2['DEFAULT'].check_reply.set_unwatch(watch);\r\n        // dirtify_ur() is not required here because this function is called only in initialization.\r\n      }\r\n//      function set_watch_time_thread(name, embed_mode, time_created, time_posted, th, tgt_th19){\r\n//        var time_watch = get_watch_time_of_a_thread(name,time_created,time_posted, true);\r\n//        if (time_watch===0 && embed_mode==='thread' && pref.catalog.auto_watch) time_watch = (th.posts[th.posts.length-1].time || th.time);\r\n//        site2[th.domain].check_reply.set_watch_time(tgt_th19, time_watch);\r\n//      }\r\n\r\n      Clg.prototype.insert_thread_prepare_html_lazy = function(tgt_th, init_new, insert_thread_from_native, from_lazy, th){\r\n//        var embed_mode_old = embed_mode;\r\n//        var threads_old = threads;\r\n//        threads = this.threads;\r\n        var th = tgt_th[16].th || th;\r\n        if (!from_lazy || !pref.filter.kwd.posts_active) if (this.view==='page' || this.view==='thread' && (th.lth.pd || (tgt_th[16].t2h_sel!=='ALL' && tgt_th[16].t2h_sel!=='all') || th.type_source!=='thread')) th.posts = tgt_th[16].recent_posts(undefined, th.posts); // merge deleted posts here // should be consolidated with 'format_html.replace_posts_by_search'\r\n//        if (!from_lazy || !pref.filter.kwd.posts_active) if (this.view==='page' || this.view==='thread' && (th.lth.pd || tgt_th[16].t2h_sel==='page')) th.posts = tgt_th[16].recent_posts(this.view==='thread' && tgt_th[16].t2h_sel!=='page'? -1 : undefined); // merge deleted posts here // should be consolidated with 'format_html.replace_posts_by_search'\r\n//        embed_mode = this.mode; // wrap to change the world // after recent_posts, because it uses embed_mode.\r\n        format_html.prepare_html_prep_posts(th); // need extraction for posts search // wrap always for popup2, including \"embed_mode==='catalog'\".\r\n//        site2[th.domain].wrap_to_parse.posts(th); // don't need extraction, or KC needs it??? // WILL BE this after on-demand extraction is implemented\r\n        if (init_new || (embed_mode==='page' || embed_mode==='thread')) format_html.prepare_html(tgt_th, th, init_new, this.view, this.mode);\r\n\r\n        if (init_new) this.insert_thread_format_th_pn(tgt_th, init_new, th);\r\n//          convert_html(name,th);\r\n//          threads[name][25] = [threads[name][24][0], threads[name][0].innerHTML, threads[name][18]];\r\n////////          insert_footer3(name,th.flags,th.page,threads[name][17]);\r\n        if (tgt_th[0]) this.insert_thread_format_html(th,th.key,init_new,insert_thread_from_native);\r\n//if (pref.test_mode['124']) { // must be redundant, but not debugged, so this is left as test code for a while.\r\n//        if (embed_mode==='catalog' && th.parse_funcs.has_posts) {\r\n//          var lth = th.lth;\r\n//          if (lth.ta && lth.ta.posts.length<th.posts) tgt_th[16].posts = th.posts; // patch for 4chan.\r\n//          else if (tgt_th[16].posts) tgt_th[16].posts = null;\r\n//        }\r\n//}\r\n        tgt_th[16].th = null;\r\n//        threads = threads_old;\r\n//        embed_mode = embed_mode_old;\r\n      };\r\n      Clg.prototype.insert_thread_format_th_pn = function(tgt_th, init_new, th){\r\n        if (init_new) {\r\n//          tgt_th[16].op_img_src_url = (th.parse_funcs.get_op_src)? th.parse_funcs.get_op_src(th) : th.op_img_url;\r\n          var ch = tgt_th[0];\r\n//          tgt_th[3] = [ch.innerHTML, th.domain]; // PATCHED. THIS WILL BE REMOVED.\r\n//          ch.name = th.key; // ch.setAttribute('name',name); // for native html // obsolete\r\n          gGEH.pns_all_keys.set(ch,th.key);\r\n//          if (this.mode==='float' && this.view==='catalog' && this.pref.float.format.fc.resize) { //  || (th.domain!==site.nickname && !pref.catalog.mimic_base_site)) {\r\n//            ch.style.width  = this.pref.float.format.fc.width  + 'px';\r\n//            ch.style.height = this.pref.float.format.fc.height + 'px';\r\n//            ch.style.height = this.pref.float.format.fc.height + 'px';\r\n////            ch.style.width  = ((pref.catalog.text_mode.mode==='text')? pref.catalog_size_text_width  : pref.catalog_size_width ) + 'px';\r\n////            ch.style.height = ((pref.catalog.text_mode.mode==='text')? pref.catalog_size_text_height : pref.catalog_size_height) + 'px';\r\n//            ch.style.float = 'left';\r\n//            ch.style.overflow = 'hidden';\r\n////            ch.style.background = '#e5ecf9';\r\n//          }\r\n//////          if (!ch.style) ch['style'] = {};\r\n\r\n//          if (pref.test_mode['127']) tgt_th[0].addEventListener('mouseover', tgt_th[2][0], false);\r\n\r\n//if (pref.test_mode['104']) { // working code\r\n//          common_func.dom_addEventListener(tgt_th[5], th.pn, 'click', click_thread_whole);\r\n//          common_func.dom_addAttribute(th.pn, 'class', pref.script_prefix+'_thread');\r\n//          var tn_as = th.parse_funcs_html.tn_as(th);\r\n//          if (this.mode!=='page' && this.mode!=='thread') for (var i=0;i<tn_as.length;i++) {\r\n//            tn_as[i].onclick = click_thread_tn; // preventDefault is in this event handler.\r\n//            common_func.dom_addAttribute(tn_as[i], 'class', pref.script_prefix+'_thumbnail');\r\n//          }\r\n//}\r\n          if (this.pref[this.mode].format.thumb.resize || th.domain!==site.nickname) this.image_resize_onload_add(th.parse_funcs_html.tn_imgs(th));\r\n//          if (pref[this.mode].format.thumb.resize) { // working code\r\n//            var tn_imgs = th.parse_funcs_html.tn_imgs(th);\r\n//            if (!this.image_resize1_onload_bound) this.image_resize1_onload_bound = image_resize1_onload.bind(this);\r\n//            if (!this.image_resize2_onload_bound) this.image_resize2_onload_bound = image_resize2_onload.bind(this);\r\n//            for (var i=0;i<tn_imgs.length;i++) tn_imgs[i].addEventListener('load',(i==0)?this.image_resize1_onload_bound : this.image_resize2_onload_bound, false);\r\n//          }\r\n\r\n//          if (tgt_th[20]===true) tgt_th[16].icon_sticky = (insert_thread_from_native)? site2[th.domain_html].get_icon(tgt_th[0],th.type_html, 'sticky', tgt_th[16]) :\r\n//                                                                                       site2[th.domain_html].add_icon(tgt_th[0],th.type_html, 'sticky', tgt_th[16]); // first time only.\r\n  \r\n////          if (embed_mode==='float' && pref.catalog.text_mode.mode==='text') { // place after th.op_img_url. // NEED TO MODIFY REMOVE_THREAD TO PREVENT MEMORY LEAK.\r\n////            var text = document.createElement('span');\r\n////            text.innerHTML = ((pref.catalog.text_mode.sub && th.sub)? '&emsp;' + th.sub : '') +\r\n////                             ((pref.catalog.text_mode.name && th.name)? '&emsp;' + th.name : '') +\r\n////                             ((pref.catalog.text_mode.com && th.com)? '&emsp;' + th.com : '');\r\n////            var footer = th.footer; // make footer on demand.\r\n////            var footer_new = document.createElement('span');\r\n////            footer_new.innerHTML = footer.innerHTML;\r\n////            th.footer = footer_new;\r\n////            th.pn.innerHTML = '';\r\n////            th.pn.appendChild(th.footer);\r\n////            th.pn.appendChild(text);\r\n////            tgt_th[18] = 'text';\r\n////          }\r\n          tgt_th[24] = this.footer.prep_footer3(th, tgt_th[24]); // for remake_html // for reentry in meguca\r\n//          if (from_lazy) insert_footer3(th.key, null, th.page, th.tags, th); // consolidated into show_catalog\r\n          this.view_attr_set(th.key, null, true); // required to be here to add style to html, catalog_attr_set in insert_thread might not add because of NO html.\r\n        }\r\n      }\r\n//      function image_resize(pn,w,h) { // working code\r\n//        var nw = pn.naturalWidth;\r\n//        var nh = pn.naturalHeight;\r\n//        var fw = (nw>w)? nw/w : 1;\r\n//        var fh = (nh>h)? nh/h : 1;\r\n////      if (fh>1 || fw>1) {\r\n//          pn.setAttribute('width', (fw>=fh)? w : nw/fh);\r\n//          pn.setAttribute('height',(fh>=fw)? h : nh/fw);\r\n////      }\r\n//////        var f  = (fw>fh)? fw : fh;\r\n//////        pn.setAttribute('width',  nw/f);\r\n//////        pn.setAttribute('height', nh/f);\r\n//      }\r\n//      function image_resize1_onload(e) {\r\n//        e.currentTarget.removeEventListener('load',this.image_resize1_onload_bound,false);\r\n//        image_resize(e.target, this.pref.float.format.thumb.w1, this.pref.float.format.thumb.h1);\r\n//      }\r\n//      function image_resize2_onload(e) {\r\n//        e.currentTarget.removeEventListener('load',this.image_resize2_onload_bound,false);\r\n//        image_resize(e.target, this.pref.float.format.thumb.w2, this.pref.float.format.thumb.h2);\r\n//      }\r\n\r\n      Clg.prototype.insert_thread_format_html = function(th,name,init_new,insert_thread_from_native){\r\n//        if (force_prep_html) format_html.prepare_html(th); // for json\r\n        site2['DEFAULT'].check_reply.set_own_posts(th);\r\n//        if (th.type_source==='page') threads[name][16].t2h_page = th.posts.length-1;\r\n        var init_or_refresh = init_new || insert_thread_from_native && site.nickname==='meguca'; // for reentry // TEMPORAL PATCH!!!\r\n        if (init_or_refresh) {\r\n//        if (init_new || insert_thread_from_native && site.nickname==='meguca') { // for reentry // TEMPORAL PATCH!!!\r\n//        if (init_new || insert_thread_from_native) { // for reentry // BUG, html update mode exist in embed_thread.\r\n//        if (init_new) {\r\n          if (th.type_html==='page' || th.type_html==='thread') {\r\n            var links = th.parse_funcs_html.get_thread_links(th.pn? th : {pn:this.threads[name][0], __proto__:th}); // for reentry. // THIS MUST BE HERE BEFORE update_posts_in_page, OP is also removed from th.pn at merge mode.\r\n//            var links = th.parse_funcs_html.get_thread_links(th); // THIS MUST BE HERE BEFORE update_posts_in_page, OP is also removed from th.pn at merge mode.\r\n            if (links) for (var i=0;i<links.length;i++) links[i].onclick = click_link;\r\n          }\r\n        }\r\n\r\n        var tgt_th = this.threads[name];\r\n        var mb = this.merge_bases;\r\n        var merge_base = mb.bases[th.key] || (init_new && (tgt_th[1] || !mb.initialized)) && mb.query(th.key, tgt_th, th, true, this); // !mb.initialized for initial kick\r\n//        var merge_base_tgts = (init_new && (tgt_th[1] || !mb.initialized))? mb.base_tgts(th.key) : null; // !mb.initialized for initial kick // working code\r\n//        var merge_base = (tgt_th[1] && merge_base_tgts)? mb.query(th.key, tgt_th, th, merge_base_tgts, true, this) : mb.bases[th.key];\r\n//        if (merge_base_tgts && !tgt_th[1] && !mb.initialized) mb.setup_hook();\r\n\r\n// working code, but BUG. this makes 'threads[name][16].posts === th.posts' BEFORE merging th.posts which contains deleted posts in 'embed_mode==='thread', so no merge will occur.\r\n// But I remember I had troubled here..., safe1309-1308.\r\n        if (this.view==='page' || this.view=='thread') {\r\n          var posts_used = this.update_posts_in_page(th,name, init_or_refresh, insert_thread_from_native, tgt_th, merge_base);\r\n          if (pref[embed_mode].popup) {\r\n            if ((!this.pref.filter.kwd.posts_active || pref.test_mode['125']) && !pref[this.mode].backlink_all) site2[th.domain].popups_release_all_not_exist(th.lth, tgt_th[16].posts);\r\n//            site2[th.domain].popups_add(tgt_th[16].posts, th, !this.pref.filter.kwd.posts_active);\r\n            if (pref[this.mode].merge_op_auto && posts_used[0]===tgt_th[16].posts[0]) this.merge_cross_links_in_op(th.lth, tgt_th[16].posts[0]);\r\n          }\r\n        }\r\n//        } else {\r\n//          if (pref.test_mode['147'] && init_new && this.pref[this.mode].merge_list && pref[this.mode].merge_op_auto) {\r\n////            site2[th.domain].popups_add_1(th, th, false, th.lth.q, false, insert_thread_from_native, true); // doesn't work\r\n//////            site2[th.domain].popups_add(tgt_th[16].posts, th, !this.pref.filter.kwd.posts_active); // doesn't work\r\n//            var btns = th.pn.getElementsByClassName(pref.script_prefix+'_button');\r\n//            for (var i=0;i<btns.length;i++) if (btns[i].dataset.type==='triage' && btns[i].dataset.cmd==='MERGEE') { // ATTENTION!!! behavior differs from clicking\r\n//              var tgt = Triage.prototype.MERGEE_get_key(btns[i]);\r\n//              if (pref.proto.merge_btn_lv_add) this.merge_bases.add_to_lv_list(tgt, pref[this.mode].merge_btn_lv, this); // levelize old one, instead of new one.\r\n//              this.merge_bases.add_to_list_1(tgt, th.key, this, true); // merge new one to old one to cascade.\r\n////                this.merge_bases.add_to_list_fromUI(Triage.prototype.MERGEE_get_key(btns[i]), th.key, this, true);\r\n////                  setTimeout(this.triage_event.bind(this, th.key, btns[i].dataset.cmd, btns[i].dataset.attr, 0, btns[i]),0);\r\n////                  this.triage_event(th.key, btns[i].dataset.cmd, btns[i].dataset.attr, 0, btns[i]);\r\n//            }\r\n//          }\r\n//        }\r\n//        } else if (pref.test_mode['124']) if (init_or_refresh) {\r\n//          this.threads[name][16].posts = th.posts;\r\n//          posts_used = th.posts;\r\n//        }\r\n//        if (!init_or_refresh) if (th.type_source!=='catalog' && embed_mode==='float') threads[name][3][0] = (th.pn)? th.pn.innerHTML : null; // PATCHED TEMPORARILY, this will be deleted.\r\n//        if (init_or_refresh) {\r\n//          if (embed_mode==='page' || embed_mode=='thread') posts_used = format_html.update_posts_in_page(th,name, true, insert_thread_from_native); // threads[name][16].posts!==th.posts is moved into 'update_posts_in_page'\r\n//          else {\r\n//            threads[name][16].posts = th.posts;\r\n//            posts_used = th.posts;\r\n//          }\r\n//////          if (embed_mode==='page' || embed_mode==='thread') {\r\n////          if (embed_mode==='page' && threads[name][16].posts && threads[name][16].posts!==th.posts) format_html.update_posts_in_page(th,name,null, true);\r\n////          else threads[name][16].posts = th.posts;\r\n////          if ((embed_mode==='page' || embed_mode==='thread') && !pref.test_mode['64'] && pref[embed_mode].deleted_posts.merge && th.lth.pd) format_html.update_posts_in_page(th,name,null, true);\r\n\r\n//          if (insert_thread_from_native && embed_mode==='page' && pref[embed_mode].use_expander_always) site2[th.domain_html].page_json2html3_replace_expander(th.posts, format_html.get_t2h_index(threads[name]), name);\r\n//          if (th.type_html==='page' || th.type_html==='thread') {\r\n////            var links = th.parse_funcs_html.get_thread_links(th);\r\n////            if (links) for (var i=0;i<links.length;i++) links[i].onclick = click_link;\r\n////            if (th.parse_funcs.time_unit!==1) { // BUG!!! REFER 'update_posts_1'\r\n////              var tu = th.parse_funcs.time_unit;\r\n////              for (var i=0;i<th.posts.length;i++) th.posts[i].time *= th.parse_funcs.time_unit;\r\n////            }\r\n//            var pref_env = (!insert_thread_from_native)? pref[embed_mode] :\r\n//                                                         {\r\n//                                                           colorID: pref[embed_mode].colorID && !pref[embed_mode].env.colorID_native,\r\n//                                                           backlink: pref[embed_mode].backlink && !pref[embed_mode].env.backlink_native, // do nothing because all posts don't have post.backlinks because this is before calling 'popups_add'.\r\n//                                                           localtime: pref[embed_mode].localtime && !pref[embed_mode].env.localtime_native,\r\n//                                                         };\r\n//            for (var i=0;i<th.posts.length;i++) format_html.prepare_html_post(th, th.posts[i], th.tags.q, pref_env);\r\n////            for (var i=0;i<th.posts.length;i++) site2[th.domain_html].format_pn(th.posts[i].pn, th.tags.q && th.tags.q[th.posts[i].no], pref_env, th.posts[i]);\r\n//          }\r\n//        } else {\r\n//          if (th.domain==='KC' && embed_mode==='page' && pref[embed_mode].use_expander_always) site2[th.domain_html].page_json2html3_replace_expander(th.posts, format_html.get_t2h_index(threads[name]), name); // test patch for KC, I don't know why but other than KC generates ERROR.\r\n//          if (embed_mode==='page' || embed_mode==='thread') if (th.parse_funcs.has_posts) posts_used = format_html.update_posts_in_page(th,name, null, insert_thread_from_native);\r\n//          if (th.type_source!=='catalog' && embed_mode==='float') threads[name][3][0] = (th.pn)? th.pn.innerHTML : null; // PATCHED TEMPORARILY, this will be deleted.\r\n//        }\r\n////        if (embed_mode==='page' && th.posts && th.posts[0].search_result!==undefined && threads[name][16].posts) site2[th.domain_html].update_posts0_class(threads[name][16].posts[0].pn, th.posts[0].search_result); // place here, because sometimes filter is given at initial, and that is 'init_new===true' // patch for 4chan catalog. moved to 'format_pn'\r\n////        if (th.posts && th.posts[0].search_result!==undefined && threads[name][16].posts) site2[th.domain_html].update_posts0_class(threads[name][16].posts[0].pn, th.posts[0].search_result); // place here, because sometimes filter is given at initial, and that is 'init_new===true'\r\n\r\n//if (pref.test_mode['124']) { // must be redundant, but not debugged, so this is left as test code for a while.\r\n//        var idx_new_post = (init_new)? 0 : 1;\r\n//        if (embed_mode=='page' && th.type_data==='json') { // TEMPORAL PATCH\r\n//          th.domain_html = site.nickname;\r\n//          th.parse_funcs_html = site2[th.domain_html].parse_funcs.page_html;\r\n//          for (var i=idx_new_post;i<th.posts.length;i++) if (!th.posts[i].pn) th.posts[i].pn = site2[th.domain_html].post_json2html(th.posts[i],th.board);\r\n//          for (var i=idx_new_post;i<th.posts.length;i++) th.posts[i].tn_imgs = th.parse_funcs_html.tn_imgs(th.posts[i]);\r\n//          posts_used = th.posts.slice(idx_new_post);\r\n//        }\r\n//}\r\n////        insert_thread_format_html_add_events(th, posts_used, insert_thread_from_native);\r\n//        if ((embed_mode==='page' || embed_mode==='thread') && pref[embed_mode].popup && th.type_html!=='catalog') site2[th.domain].popups_add(threads[name][16], th, insert_thread_from_native && pref[embed_mode].env.popup_native && !pref[embed_mode].env.event_dynamic, insert_thread_from_native);\r\n////        if (pref.filter.kwd.post && th.posts) threads[name][4] = th.posts;\r\n////        threads[name][9] = catalog_filter_query(name);\r\n////if (pref.test_mode['5']) {\r\n////        if (init_new && th.type_html!='catalog' && (type==='thread_html' || type==='page_html')) { // modify HTML at end because of DYNAMIC PARSE.\r\n//////          trim_html(threads[name][0], th.domain, pref[embed_mode].format.show, th.key);\r\n////          if (pref[embed_mode].localtime) site2[nickname].localtime(th.pn); // PATCH\r\n////        }\r\n////}\r\n        if (this.view==='page' || this.view==='thread') {\r\n          if (pref.test_mode['158'] && (pref.postFilter.use || pref.filter.postFilter.use)) format_html.postFilter(this, th, posts_used);\r\n          if (pref.test_mode['162']) hiddenPosts.hide_if_hit(th, posts_used);\r\n          if (pref[this.mode].hide_posts_without_images) format_html.hide_posts_without_images(this, posts_used);\r\n          this.view_update_draw(name, this.threads[name][16].posts);\r\n//        if (insert_thread_from_native) this.insert_thread_format_html_add_events(th, posts_used, insert_thread_from_native);\r\n        }\r\n        if (pref.test_mode['155'] && th.type_data==='json') pref.test_mode['136'] = false;\r\n      }\r\n      Clg.prototype.merge_cross_links_in_op = function(lth, post){\r\n        var hop = lth.mh || 0;\r\n        if (hop >= pref[this.mode].merge_op_auto_hop) return;\r\n        var quotes = lth.q[post.no].quotes;\r\n        var tgts = quotes && quotes.filter(function(v){return v[0]!==lth.q;}).map(function(v){return v[0].key;}).filter(function(v){return !this.threads[v];},this);\r\n        if (tgts && tgts.length!=0) {\r\n          scan.scan_ui('mergeAuto', {tgts:tgts, options:{refresh:this}});\r\n          this.merge_tgts(tgts, hop);\r\n        }\r\n      };\r\n      Clg.prototype.merge_tgts = function(tgts, hop){\r\n        if (pref[this.mode].merge_op_lv_add) this.merge_bases.add_to_lv_list(tgts, pref[this.mode].merge_op_lv + (pref[this.mode].merge_op_lv_inc? hop : 0), this);\r\n        for (var i=0;i<tgts.length;i++) {\r\n          var dbt = common_func.fullname2dbt(tgts[i]);\r\n          var lth = liveTag.mems.init({domain:dbt[0], board:dbt[1], no:dbt[2]});\r\n          if (!lth.mh || lth.mh > hop +1) lth.mh = hop +1; // for racing condition\r\n//          liveTag.mems.init({domain:dbt[0], board:dbt[1], no:dbt[2]}).mh = hop +1;\r\n        }\r\n      };\r\n      Clg.prototype.merge_cross_links_in_op_manually = function(name){\r\n        var lth = liveTag.mems.getFromName(name);\r\n        site2[lth.domain].popups_prep(lth);\r\n        format_html.prepare_html_post(lth.th, lth.th.posts[0]);\r\n        var quotes = lth.q[lth.th.posts[0].no].quotes;\r\n        var tgts = quotes && quotes.filter(function(v){return v[0]!==lth.q;}).map(function(v){return v[0].key;}).filter(function(v){return this.threads[v];},this);\r\n        if (tgts && tgts.length!=0) {\r\n          this.merge_tgts(tgts, lth.mh || 0);\r\n          for (var i=0;i<tgts.length;i++) this.merge_bases.add_to_list_1(name, tgts[i], this, null, true);\r\n        }\r\n      };\r\n//      Clg.prototype.insert_thread_format_html_add_events = function(th, posts_used, insert_thread_from_native){ // removed code for static(test_mode['104']) and simplified, Changed to format_html.prep_blacklist_click_tn\r\n//        if (posts_used && (this.mode==='page' || this.mode==='thread')) {\r\n//          if (insert_thread_from_native && pref[this.mode].env.expand_thumbnail_inline_native && !(pref[this.mode].env.event_dynamic && th.domain===site.nickname))\r\n////          var add_event = !pref[this.mode].env.expand_thumbnail_inline_native || !insert_thread_from_native; //  || (pref[this.mode].expand_thumbnail_inline_all_after && pref[this.mode].env.event_dynamic);\r\n////          var expand_now = pref[this.mode].expand_thumbnail_initial;\r\n////          var expand_on_demand = pref[this.mode].thumbnail.inline.ondemand;\r\n////          if (!add_event && !(pref[this.mode].env.event_dynamic && th.domain===site.nickname))\r\n//            for (var j=0;j<posts_used.length;j++) {\r\n//              var tn_imgs = th.parse_funcs_html.tn_imgs(posts_used[j]);\r\n//              if (tn_imgs) for (var i=0;i<tn_imgs.length;i++) GEH.prototype.blacklist_click.add(tn_imgs[i]);\r\n////              if (expand_now) {\r\n////                if (expand_on_demand) {\r\n////                  DIH.expand_thumbnail_on_demand(tn_imgs[i]);\r\n////                  expand_now = false;\r\n////                } else DIH.expand_thumbnail_inline.call(tn_imgs[i], null, true);\r\n////              }\r\n//            }\r\n//        }\r\n//      };\r\n//      Clg.prototype.insert_thread_format_html_add_events = function(th, posts_used, insert_thread_from_native){ // working code\r\n//        if (posts_used && (this.mode==='page' || this.mode==='thread')) {\r\n//          var add_event = !pref[this.mode].env.expand_thumbnail_inline_native || !insert_thread_from_native || (pref[this.mode].expand_thumbnail_inline_all_after && pref[this.mode].env.event_dynamic);\r\n//          var expand_now = pref[this.mode].expand_thumbnail_initial;\r\n//          var expand_on_demand = pref[this.mode].thumbnail.inline.ondemand;\r\n//          if (add_event || expand_now || !pref.test_mode['104'])\r\n//            for (var j=0;j<posts_used.length;j++) {\r\n//              var tn_imgs = th.parse_funcs_html.tn_imgs(posts_used[j]);\r\n//              if (tn_imgs) for (var i=0;i<tn_imgs.length;i++) {\r\n//                if (pref.test_mode['104']) tn_imgs[i].onclick = DIH.expand_thumbnail_inline;\r\n//                else if (!add_event && !(pref[this.mode].env.event_dynamic && th.domain===site.nickname)) GEH.prototype.blacklist_click.add(tn_imgs[i]);\r\n////                tn_imgs[i].onclick = (add_event)? expand_thumbnail_inline : expand_thumbnail_on_demand_set; // REDUNDANT???\r\n//                if (expand_now) {\r\n//                  if (expand_on_demand) {\r\n//                    DIH.expand_thumbnail_on_demand(tn_imgs[i]);\r\n////                    DIH.expand_thumbnail_queue_add(tn_imgs[i]);\r\n//                    expand_now = false;\r\n//                  } else DIH.expand_thumbnail_inline.call(tn_imgs[i], null, true);\r\n//                }\r\n//              }\r\n//            }\r\n//        }\r\n////        if (pref.test_mode['103']) if (posts_used && ((embed_mode==='catalog' && init_new) || (embed_mode==='page' || embed_mode==='thread')))  // working code, but static.\r\n////          if (pref[embed_mode].image_prefetch || (pref[embed_mode].image_hover && (!pref[embed_mode].env.image_hover_native || !insert_thread_from_native)))\r\n////            if (th.parse_funcs.has_posts && (embed_mode==='page' || embed_mode==='thread')) {\r\n////              for (var j=0;j<posts_used.length;j++) {\r\n////                var tn_imgs = th.parse_funcs_html.tn_imgs(posts_used[j]);\r\n////                if (tn_imgs) for (var i=0;i<tn_imgs.length;i++) tn_imgs[i].onmouseover = image_hover_add;\r\n////              }\r\n////            } else if (init_new && !th.parse_funcs_html.dynamic_image_hover) {\r\n////              var tn_imgs = th.parse_funcs_html.tn_imgs(th);\r\n////              for (var i=0;i<tn_imgs.length;i++) tn_imgs[i].onmouseover = image_hover_add;\r\n////            }\r\n//      };\r\n      var format_html = {\r\n        prepare_html_prep_posts: function(th, force){\r\n          site2[th.domain].wrap_to_parse.posts(th);\r\n//          if (th.parse_funcs.posts_full) th.parse_funcs.posts_full(th); // BUG, DOESN'T HIT FILTER BEFORE BEING SHOWN.\r\n          if (th.type_data==='html' && (force || th.domain!==site.nickname)) this.prepare_html_extract_params(th); // extraction function assumes that it has all of properties, this must be after 'posts_full'.\r\n        },\r\n        prepare_html_extract_params: function(th){\r\n          if (!th.extracted && th.pn) { // checking th.pn for changing view\r\n            if (th.parse_funcs) {\r\n              if (th.parse_funcs.filename) {\r\n                for (var i=0;i<th.posts.length;i++) if (th.posts[i].pn) th.posts[i].filename = th.parse_funcs.filename(th.posts[i]); // deleted posts may be merged.\r\n//                for (var i=0;i<th.posts.length;i++) th.posts[i].filename = th.parse_funcs.filename(th.posts[i]);\r\n                th.filename = th.parse_funcs.filename(th);\r\n              }\r\n              if (th.parse_funcs.prep_mimic) th.parse_funcs.prep_mimic(th);\r\n            }\r\n            if (th.posts) for (var i=0;i<th.posts.length;i++) if (th.posts[i].parse_funcs.prep_mimic && th.posts[i].pn) th.posts[i].parse_funcs.prep_mimic(th.posts[i]);\r\n            th.extracted = true;\r\n          }\r\n        },\r\n        prepare_html: function(tgt_th, th, init_new, view, mode){\r\n//          var tgt_th = threads[th.key];\r\n//        if ((th.domain!==site.nickname || site.whereami+'_html'!=type) && pref.catalog.mimic_base_site && th.pn && site2[site.nickname].catalog_json2html3) { // for KC.\r\n//        if ((th.domain!==site.nickname || site.whereami!='catalog') && pref.catalog.mimic_base_site && th.pn && site2[site.nickname].catalog_json2html3) { // cause document leak in KC\r\n//          site2[th.domain].wrap_to_parse.posts(th);\r\n//          if (th.parse_funcs.posts_full) th.parse_funcs.posts_full(th);\r\n          var mimic_force = th.domain!==site.nickname && th.type_data==='html'; // && th.domain_html!==site.nickname; // must be added this for consistency. // prioritize cloning is for popups_add_1's being called from popups_fetched_1 in advance. This is observable when thread+watcher is used, backlinks will be added to lth.q.pn, this way can track single entity, but can't track multiple entities.\r\n          var mimic_tgt = view==='thread'? 'page' : view; // (mode==='float' || pref.test_mode['144'] && mode!=='thread')? view : (mode==='page' || mode==='thread')? 'page' : 'catalog';\r\n          var mimic = !th.pn || ((th.domain!==site.nickname || mimic_tgt!==(th.type_mimic==='thread'? 'page' : th.type_mimic)) && pref.catalog.mimic_base_site) || mode==='float'; // !th.pn for reentry from unmerge with catalog_html data\r\n          if (pref.test_mode['92']) mimic_tgt = 'catalog'; // for 4chan-X catalog.\r\n//          if (init_new || !mimic)\r\n//            if (mimic_tgt==='page' && th.type_data==='html') this.prepare_html_extract_params(th); // for popup2, always wrapping is required.\r\n          if (mimic) { //  || th.hasOwnProperty('pn')) { // don't call getter of pn, TEMPORAL\r\n//            this.prepare_html_extract_paramsfunction(th); // WILL BE on-demand extraction\r\n            if (init_new) {\r\n              var tmp_pn = (mimic_tgt==='headline')? site2[site.nickname].headline_json2html(th)\r\n                         : (mimic_tgt==='page')? site2[site.nickname].page_json2html3(th, !mimic_force, tgt_th[16], pref[view].use_expander_always || mode==='thread' && tgt_th[16].t2h_sel!=='all') // t2h_sel for merge\r\n                         : site2[site.nickname].catalog_json2html3(th,th.board,th.op_img_url);\r\n              Object.defineProperty(th, 'pn', {value: tmp_pn, writable:true, enumerable:true, configurable:true});\r\n            }\r\n            th.type_html = mimic_tgt;\r\n            th.domain_html = site.nickname;\r\n            th.parse_funcs_html = site2[site.nickname].parse_funcs[th.type_html+'_html']; // overwrite.\r\n          } else if (th.type_data==='html') site2.common.remove_by_tagname(th.pn,'script');\r\n          if (init_new) {\r\n            if (pref[mode].popup && mimic_tgt==='page') site2[th.domain].popups_prep(th);\r\n            if (tgt_th[0]===false) { // patch\r\n              tgt_th[0] = th.pn;\r\n              tgt_th[16].type_html = th.type_html;\r\n              tgt_th[16].domain_html = th.domain_html;\r\n              tgt_th[16].parse_funcs_html = th.parse_funcs_html;\r\n            }\r\n            Object.defineProperty(th, 'footer', {value: th.parse_funcs_html.footer(th), writable:true, enumerable:true, configurable:true});\r\n            if (th.parse_funcs_html.footer2) Object.defineProperty(th, 'footer2', {value: th.parse_funcs_html.footer2(th), writable:true, enumerable:true, configurable:true});\r\n            this.prep_anchor_links(th.pn, th); // Files in op are out of posts[0].pn sometimes, so these must be called with 'th'.\r\n//            if (th.localArchive) if (!pref.test_mode['67']) archiver.url2file(th.localArchive, th); // merged to root html generator to prevent needless prefetch.\r\n//            if (th.parse_funcs.has_editing) for (var i=0;i<th.posts.length;i++) if (th.posts[i].editing)\r\n//              th.posts[i].pn.classList.add(pref.script_prefix+'_post_editing');\r\n//              th.posts[i].pn.style.background = '#cec952';\r\n          }\r\n//          else {\r\n//            var pfunc_pn = site2[th.domain_html].parse_funcs['post_json'].pn;\r\n//            for (var i=1;i<th.posts.length;i++) {\r\n//              if (!th.posts[i].pn) th.posts[i].pn = pfunc_pn(th.posts[i]);\r\n//              site2[th.domain].toplevel_anchor(th.posts[i], th.no);\r\n//              if (site.nickname!==th.domain) site2[th.domain].absolute_link(th.posts[i]);\r\n//              if (th.localArchive) if (!pref.test_mode['67']) archiver.url2file(th.localArchive, th.posts[i]);\r\n//              if (th.posts[i].editing) th.posts[i].pn.style.background = '#cec952';\r\n//            }\r\n//          }\r\n        },\r\n        prep_anchor_links: function(pn, th){\r\n          if ((!pref.test_mode['109'] || th.type_data==='html') && (th.no!=site.no || th.board!=site.board || th.domain!=site.nickname)) site2[th.domain].toplevel_anchor(pn, th);\r\n          if (site.nickname!==th.domain) site2[th.domain].absolute_link(pn, th);\r\n        },\r\n        prepare_html_post: function(th, post, thq, pref_env, not_anchor,  deactivate, from_not_popup, force){\r\n          if (pref.test_mode['161'] && !force && post.pn) { // requires synchronization with page_json2html3, this can be solved by using setter, but in case of type_data==='html' it is difficult.\r\n            if (post.type_data==='json' || post.extracted || th.domain===site.nickname) return;\r\n            post.extracted = true;\r\n//            this.prepare_html_extract_paramsfunction(th); // WILL BE on-demand extraction\r\n          }\r\n          if (!post.pn) {\r\n            post.pn = site2[th.domain_html].parse_funcs['post_json'].pn(post);\r\n            if (!thq) thq = th.lth.q; // for expand old posts, to add backlinks.\r\n          }\r\n          if (!not_anchor) this.prep_anchor_links(post.pn, th);\r\n//          if (th.localArchive) if (!pref.test_mode['67']) archiver.url2file(th.localArchive, post); // merged to root html generator to prevent needless prefetch.\r\n          site2[th.domain_html].format_pn(post.pn, (thq)? thq[post.no] : null, pref_env, post, th);\r\n          if (post.editing) post.pn.classList.add(pref.script_prefix+'_post_editing');\r\n//          if (post.editing) post.pn.style.background = '#cec952';\r\n          if (pref[embed_mode].popup) site2[th.domain].popups_add_1(th, post, deactivate, thq || th.lth.q, from_not_popup, (pref_env? pref_env : pref[cataLog.embed_mode]).backlink);\r\n          if (!post.pn_menu && pref[embed_mode].postMenu) post.pn_menu = this.add_postMenu(th, post);\r\n        },\r\n        add_postMenu(th, post){\r\n          var pn_menu = triage.doms.postMenu.cloneNode(true);\r\n//          var pn_menu = triage.postMenu(th.key+'#'+post.no+'@'+post.time_tu); // should be use pn2no and pn2time\r\n          var bks = site2[th.domain_html].add_backlinks_bks_query(post.pn);\r\n          if (bks) bks.parentNode.insertBefore(pn_menu, bks);\r\n          else site2[th.domain_html].add_backlinks_bks_append(post.pn, pn_menu);\r\n          return pn_menu;\r\n        },\r\n        get_t2h_from_index: function(idx){\r\n          return ['page','L','M','N','N_unread','unread','all'][idx];\r\n        },\r\n        get_t2h_index: function(tgt_th){\r\n          var t2h_sel = tgt_th[16].t2h_sel || pref[embed_mode].t2h_sel; \r\n          return (t2h_sel==='page')? 0 :\r\n                 (t2h_sel==='L')? 1 :\r\n                 (t2h_sel==='M')? 2 :\r\n                 (t2h_sel==='N')? 3 :\r\n                 (t2h_sel==='N_unread')? 4 :\r\n                 (t2h_sel==='unread')? 5 : 6;\r\n        },\r\n//        get_t2h_num_of_posts: function(tgt_th, type_source){ // moved to tgt_th[16].prototype\r\n//          var t2h_sel = tgt_th[16] && tgt_th[16].t2h_sel || pref[embed_mode].t2h_sel; \r\n//          if (t2h_sel!=='page' || type_source!=='page' || tgt_th[16].expand_posts) {\r\n//            return (t2h_sel==='page')? tgt_th[16].t2h_page || pref[embed_mode].t2h_num_of_posts :\r\n//                   (t2h_sel==='L')? pref[embed_mode].t2h_L :\r\n//                   (t2h_sel==='M')? pref[embed_mode].t2h_M :\r\n//                   (t2h_sel==='N')? pref[embed_mode].t2h_num_of_posts :\r\n//                   (t2h_sel==='N_unread')? pref[embed_mode].t2h_num_of_posts + ((tgt_th[19][0]&0x000c0000)? (tgt_th[19][1]&0x0000ffff) : 0) :\r\n//                   (t2h_sel==='unread')? ((tgt_th[19][0]&0x000c0000)? (tgt_th[19][1]&0x0000ffff) : tgt_th[16].t2h_page) :\r\n//                   (t2h_sel==='no')? 0 : -1; // 'ALL' and 'ALL_agg'\r\n//          } else return false;\r\n//        },\r\n        prep_blacklist_click_tn: function(th, posts, insert_thread_from_native, pf_mode){ // removed code for static(test_mode['104']) and simplified\r\n          if (insert_thread_from_native && pf_mode.env.expand_thumbnail_inline_native && !(pf_mode.env.event_dynamic && th.domain===site.nickname))\r\n            for (var j=0;j<posts.length;j++) {\r\n              var tn_imgs = th.parse_funcs_html.tn_imgs(posts[j]);\r\n              if (tn_imgs) for (var i=0;i<tn_imgs.length;i++) GEH.prototype.blacklist_click.add(tn_imgs[i]);\r\n            }\r\n        },\r\n      };\r\n      Clg.prototype.update_posts_in_page = function(th,name, init_new, insert_thread_from_native, tgt_th, merge_base){\r\n//        update_posts_in_page: function(th,name, force_prep_html, remove){\r\n//          if (!th.parse_funcs.has_posts && !remove) return;\r\n//          if (force_prep_html) this.prepare_html(th); // for json\r\n//          var tgt_th = this.threads[name];\r\n//          var posts_used = [];\r\n//          var mb = site2['DEFAULT'].update_posts_merge_bases; // working code, moved to upper hierarchy to be used for catalog also.\r\n//          var merge_base_tgts = (init_new && (tgt_th[1] || !mb.initialized))? mb.base_tgts(th.key) : null;\r\n//          var merge_base = (tgt_th[1] && merge_base_tgts)? mb.query(th.key, tgt_th, th, merge_base_tgts, true, this) : mb.bases[th.key];\r\n////          var merge_base = (tgt_th[1] && merge_base_tgts)? mb.query((tgt_th[16].posts && tgt_th[16].posts!==th.posts)? {pn:tgt_th[0], __proto__:tgt_th[16]} : th, merge_base_tgts, true) : mb.bases[th.key]; // redundant but for saster execution, shall works correctly if this doesn't exist. (not debugged.)\r\n//          if (merge_base_tgts && !tgt_th[1] && !mb.initialized) mb.setup_hook();\r\n////          var merge_base = (pref[embed_mode].merge && tgt_th[1])? site2['DEFAULT'].update_posts_merge_bases.query((tgt_th[16].posts && tgt_th[16].posts!==th.posts)? {pn:tgt_th[0], __proto__:tgt_th[16]} : th, 'ALL', true) : site2['DEFAULT'].update_posts_merge_bases.bases[th.key]; // redundant but for saster execution, shall works correctly if this doesn't exist. (not debugged.)\r\n////          if (init_new && merge_base && merge_base.pn!==th.pn) site2[th.domain_html].update_posts_merge_init(th, merge_base);\r\n\r\n          var pf = pref[embed_mode];\r\n          var pf_env = (!insert_thread_from_native)? pf\r\n              : {colorID: pf.colorID && !pf.env.colorID_native,\r\n                 backlink: pf.backlink && !pf.env.backlink_native,\r\n                 localtime: pf.localtime && !pf.env.localtime_native};\r\n          var not_anchor = init_new && th.key===site.key;\r\n          var deactivate = insert_thread_from_native && pref[this.mode].env.popup_native && !pref[this.mode].env.event_dynamic;\r\n          var posts_used = !insert_thread_from_native? (init_new? th.posts.slice() : [])// slice for merging deleted posts\r\n                         : insert_thread_from_native.init? insert_thread_from_native.posts_shown.slice() : insert_thread_from_native.posts_updated;// slice for merging deleted posts\r\n          for (var i=0;i<posts_used.length;i++) format_html.prepare_html_post(th, posts_used[i], th.lth.q, pf_env, not_anchor, deactivate, true, true);\r\n          if (insert_thread_from_native) format_html.prep_blacklist_click_tn(th, posts_used, insert_thread_from_native, pref[this.mode]);\r\n          if (merge_base || tgt_th[16].posts && tgt_th[16].posts!==th.posts) {\r\n//          if (merge_base || tgt_th[16].posts && ((!insert_thread_from_native || insert_thread_from_native.init) && tgt_th[16].posts!==th.posts)) {\r\n////          if (!init_new || tgt_th[16].posts && tgt_th[16].posts!==th.posts) {\r\n//            if (init_new) {\r\n//              posts_used = th.posts.slice(); // patch for merging deleted posts at initial.\r\n//              for (var i=0;i<th.posts.length;i++) format_html.prepare_html_post(th, th.posts[i], th.lth.q, pf_env, not_anchor, deactivate, true, insert_thread_from_native);\r\n//            }\r\n            if (merge_base && !tgt_th[16].posts) tgt_th[16].posts = th.posts.slice(); // patch for initial merge\r\n            site2[th.domain_html].update_posts_replace(th,tgt_th[16], tgt_th[0], merge_base, tgt_th[1], posts_used, this, deactivate);\r\n//          site2[th.domain_html].update_posts_replace(th,tgt_th[16],(pref[embed_mode].merge)? site2['DEFAULT'].update_posts_merge_base : tgt_th[0], pref[embed_mode].merge, tgt_th[1], posts_used);\r\n//            if (tgt_th[16].expand_posts) tgt_th[16].expand_posts = null;\r\n          } else { // by native update or initialize without merge\r\n            tgt_th[16].posts = th.posts.slice(); // slice for kwd filter of posts\r\n//            posts_used = th.posts;\r\n////            posts_used = !insert_thread_from_native? th.posts : (insert_thread_from_native.init)? insert_thread_from_native.posts_shown : insert_thread_from_native.posts_updated;\r\n//            for (var i=0;i<posts_used.length;i++) format_html.prepare_html_post(th, posts_used[i], th.lth.q, pf_env, not_anchor, deactivate, true, insert_thread_from_native);\r\n            if (!pref.test_mode['140']) if (init_new && insert_thread_from_native && pref[this.view].use_expander_always) site2[th.domain_html].page_json2html3_add_omitted_info(th,tgt_th[16], true, true);\r\n          }\r\n          if (pref.test_mode['140']) if (init_new && insert_thread_from_native && (this.view==='page' || this.view==='thread') && pref[embed_mode].use_expander_always) site2[th.domain_html].page_json2html3_replace_expander(th.posts, format_html.get_t2h_index(tgt_th), name);\r\n//          if (insert_thread_from_native) posts_used = (insert_thread_from_native.init)? insert_thread_from_native.posts_shown : insert_thread_from_native.posts_updated;\r\n\r\n          if (common_obj.thread_reader) common_obj.thread_reader.updated(posts_used, insert_thread_from_native && insert_thread_from_native.init); // for merge // BUG. can't call with init because thread_reader doesn't exist at the time of initial. own_posts_tracker in thread_reser doesn't work. // patched\r\n          return posts_used;\r\n      };\r\n      common_func.Object_defProps(format_html,{\r\n        replace_posts_by_search: function(tgt_th, pref){ // tgt_th[16].th may be set by updater. // pref for temporal\r\n          var th = tgt_th[7];\r\n          if (pref.filter.kwd.posts_active) {\r\n            if (tgt_th[10]!=pref.filter.kwd.timestamp || tgt_th[16].th) { // existence of tgt_th[16].th means thread is updated.\r\n              tgt_th[10] = pref.filter.kwd.timestamp;\r\n              var th_new = catalog_filter_query_keyword.kwd_make_result(tgt_th[16].recent_posts(pref[embed_mode].sourceOfSP==='auto'? -1 : null), th.domain);\r\n//              var th_new = catalog_filter_query_keyword.kwd_make_result(th.posts, th.domain, th);\r\n              if (!th_new) {\r\n                tgt_th[9][0] = false;\r\n                tgt_th[16].th = null;\r\n              } else {\r\n                var flag = (!tgt_th[16].posts || tgt_th[16].posts.length!==th_new.length);\r\n                if (!flag) {\r\n                  var i=th_new.length;\r\n                  while (--i>=0) if (tgt_th[16].posts[i].no!==th_new[i].no) {flag=true; break;} // for no OP\r\n//                  if (!flag && tgt_th[16].posts && tgt_th[16].posts[0] && tgt_th[16].posts[0].pn && // BUG in page mode, tgt_th[16].posts[0].pn exists always even if flag==true.\r\n//                      (tgt_th[16].posts[0].pn.classList.contains('CatChan_search_miss')==th_new[0].search_result))\r\n//                    site2[th.domain_html].update_posts0_class(tgt_th[16].posts[0].pn,th_new[0].search_result);\r\n                }\r\n                if (tgt_th[16].posts && tgt_th[16].posts[0] && tgt_th[16].posts[0].pn &&\r\n                    (tgt_th[16].posts[0].pn.classList.contains('CatChan_search_miss')==th_new[0].search_result))\r\n                  site2[th.domain_html].update_posts0_class(tgt_th[16].posts[0].pn,th_new[0].search_result);\r\n                if (flag) {    \r\n                  format_html.prepare_html_prep_posts(th);\r\n                  tgt_th[16].th = {posts:th_new, __proto__:th};\r\n//                  tgt_th[10] = pref.filter.kwd.timestamp;\r\n                } else if (tgt_th[16].th) tgt_th[16].th = null;\r\n              }\r\n            }\r\n          } else if (tgt_th[10] || tgt_th[16].th){ // rollback\r\n            if (!tgt_th[16].th) tgt_th[16].th = {posts:tgt_th[16].recent_posts(), __proto__:th}; // {posts:tgt_th[16].recent_posts(null,null,true), __proto__:th};\r\n//            if (!tgt_th[16].th) tgt_th[16].th = scopy_th(th);\r\n            tgt_th[10] = false;\r\n          }\r\n          if (tgt_th[16].th && tgt_th[7]) // updated by this or updater.\r\n            if (tgt_th[16].posts===tgt_th[7].posts) tgt_th[7].posts = tgt_th[7].posts.slice(); // backup\r\n          return !pref.filter.kwd.posts_active || tgt_th[9][0];\r\n        },\r\n        posts_search_inactivated: function(){\r\n          for (var name in threads) {\r\n            var th = threads[name][7];\r\n            var tgt_th16 = threads[name][16];\r\n            if (tgt_th16.posts && tgt_th16.posts[0] && tgt_th16.posts[0].pn && tgt_th16.posts[0].pn.classList.contains('CatChan_search_miss')) {\r\n              site2[th.domain_html].update_posts0_class(tgt_th16.posts[0].pn,true);\r\n//              delete th.posts[0].search_result; // can't update omitted info in page mode.\r\n            }\r\n          }\r\n          pClg.drawn_idx = 0; // lazy filter.\r\n        },\r\n        hide_posts_without_images: function(clg, posts){\r\n          var hide = clg.pref[clg.mode].hide_posts_without_images;\r\n          for (var i=0;i<posts.length;i++) {\r\n            if (posts[i].nofFiles===0)\r\n              if (hide) posts[i].pn.classList.add(pref.script_prefix+'_hiddenWOF');\r\n              else posts[i].pn.classList.remove(pref.script_prefix+'_hiddenWOF');\r\n          }\r\n        },\r\n//        hide_posts_without_images: function(th,name){\r\n//          var posts = threads[name][16].posts;\r\n//          for (var i=0;i<posts.length;i++) {\r\n//            var tn_imgs = th.parse_funcs_html.tn_imgs(th.posts[i]); // for test\r\n//            if (tn_imgs.length===0) posts[i].pn.style.display = 'none';\r\n//          }\r\n//        },\r\n        postFilter: function(clg, th, posts, obj_remove, obj_added, obj_remove_global){\r\n          var objs_global = (pref.postFilter.use || obj_remove_global)? pref_func.merge_obj5a(th, obj_remove_global||pref.postFilter.obj7, null) : null;\r\n          var objs = (clg.pref.filter.postFilter.use || obj_remove)? pref_func.merge_obj5a(th, obj_remove||obj_added||clg.pref.filter.postFilter.obj7, objs_global) : objs_global; //  || [{str:pref.filter.kwd.str, com:true, ci:true, match:0, style:{border:'10px solid red'}, get rexps(){return pref.filter.kwd.rexps;}}];\r\n          if (objs) for (var i=0;i<posts.length;i++) for (var j=0;j<objs.length;j++) {\r\n            var obj = objs[j];\r\n            if (obj.use!==false && (!obj.boards || obj.boards.indexOf(th.board.slice(1,-1))!=-1)) {\r\n              if (catalog_filter_query_keyword.kwd_1({use:true, __proto__:obj}, posts[i], th.domain)) {\r\n                var pn = posts[i].pn; // (site.hasPostContainer)? posts[i].pn.parentNode : posts[i].pn; // this is not slow critically, because filterd posts are not so many.\r\n                if (!pn) continue;\r\n                if (obj_remove) {\r\n                  if (obj.hide) pn.classList.remove(pref.script_prefix+'_hiddenAuto');\r\n                  if (obj.style) {\r\n                    if (obj.style[0]==='.') pn.classList.remove(obj.style.slice(1));\r\n                    else pn.removeAttribute('style',obj.style);\r\n                  }\r\n                } else {\r\n                  if (obj.hide) pn.classList.add(pref.script_prefix+'_hiddenAuto');\r\n                  if (obj.style) {\r\n                    if (obj.style[0]==='.') pn.classList.add(obj.style.slice(1));\r\n                    else pn.setAttribute('style',obj.style);\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        },\r\n      });\r\n      cataLog.format_html = format_html;\r\n      common_func.Object_defProps(Clg.prototype,{\r\n        view_update_draw_merged: function(th) { // from popup\r\n          if (this.pref[this.mode].mark_new_posts) {// draw only\r\n            var base = this.merge_bases.bases[th.key];\r\n            var mark_time = !base? (this.threads[th.key][19][0]&0x000c0000) && this.get_mark_time(th.key)\r\n              : base.lths.map(function(lth){return lth.watched && this.get_mark_time(lth.key);},this).reduce(function(a,c){return c>a? c : a;});\r\n            if (mark_time>0) site2[th.domain].mark_newer_posts2(th.posts, mark_time, this.mode==='thread' && pref.thread_reader.unmark_on_hover, true);\r\n          }\r\n        },\r\n        view_update_draw: function(name, posts) { // , pn, th){\r\n          if (this.pref[this.mode].mark_new_posts && (this.threads[name][19][0]&0x000c0000)) {// draw only\r\n            var mark_time = this.get_mark_time(name);\r\n            if (mark_time===0 && this.view==='thread') mark_time = site2['DEFAULT'].check_reply.get_checked_time(this.threads[name][19]);\r\n            if (mark_time>0) site2[this.threads[name][16].domain].mark_newer_posts2(posts, mark_time, this.mode==='thread' && pref.thread_reader.unmark_on_hover, true);\r\n          }\r\n        },\r\n        view_update: function(name){ // draw and ERASE.\r\n          if (!this.threads[name][16].posts) return;\r\n          var date = (this.pref[this.mode].mark_new_posts && (this.threads[name][19][0]&0x000c0000))? this.get_mark_time(name) : 0;\r\n          if (date===0) date = Infinity; // to erase mark\r\n          site2[this.threads[name][16].domain].mark_newer_posts2(this.threads[name][16].posts, date, this.mode==='thread' && pref.thread_reader.unmark_on_hover, false);\r\n        },\r\n        view_time_filter_changed: function(name){ // draw and ERASE.\r\n          if (this.view==='page' || this.view==='thread')\r\n            if (name) this.view_update(name);\r\n            else for (name in this.threads) this.view_update(name);\r\n        },\r\n      });\r\n\r\n      Clg.prototype.get_watch_time_of_a_thread = function(name, time_created, time_posted, extra_format){\r\n        var pf = this.pref.filter;\r\n        var ret_time = this.get_mark_time(name, extra_format);\r\n        return (extra_format && ret_time<0)? -ret_time :\r\n               (time_posted && ret_time>time_posted)? 0 :\r\n               (!pf.time_watch && pf.time_watch_creation && ret_time>time_created)? 0 :\r\n               ret_time;\r\n      };\r\n\r\n//      function func_in(e){pop_up_delay(e,this.name);triage.thread_in(e);}\r\n//      function func_pop_up(e){pop_up_delay(e,this.name);}\r\n\r\n// Footer was here\r\n\r\n      common_func.Object_defProps(Clg.prototype, (function(){ // threads_idx, threads_odl and drawn_idx must be separated.\r\n//        var threads_odl = {};\r\n//        var threads_odl_default = { '8': [0, undefined, undefined, undefined, undefined], // disable 'on demand mode' at indexing of 1,2,3\r\n        var threads_odl_default = { '8': [0, 0, 0, 0, 0],\r\n                                   '19': [0,0,0]};\r\n        function get_threads_odl_default(str){\r\n          var page = parseInt(str.substr(str.lastIndexOf('/')+2),10);\r\n          return (page===0)? {'8': [undefined, undefined, undefined, undefined, undefined], __proto__: threads_odl_default} : // force to top\r\n                             {'8': [-page, -page, -page, -page, -page], __proto__: threads_odl_default};  // force to last\r\n        }\r\n        var threads_odl,threads;\r\n        var start,end;\r\n        var kwd_odl = ':DL:';\r\n        var check_funcs = {\r\n          reply_to_me: function(tgt_th){return (tgt_th[19][0]&0x040c0000) && (tgt_th[19][1]>>16)!=0 && 3;},\r\n          reply: function(tgt_th){return (tgt_th[19][0]&0x040c0000) && tgt_th[19][1]!=0 && 2;},\r\n          watch_first: function(tgt_th){return tgt_th[19][0]&0x040c0000 && 1;},\r\n          watch_last: function(tgt_th){return !(tgt_th[19][0]&0x040c0000) && 1;},\r\n          sticky_first: function(tgt_th){return tgt_th[20] && 4;},\r\n          sticky_last: function(tgt_th){return !tgt_th[20] && 4;},\r\n          both_cascade: function(func, func_cas, func2_cas){ // for faster .sort()\r\n            return func && func2_cas? function(tgt_th){\r\n              return (func(tgt_th)|0) + (func2_cas(tgt_th)|0);} : func_cas || func2_cas || 0;\r\n          },\r\n//          both: function(val, func, func2){\r\n//            return func && func2? function(tgt_th){return func(tgt_th) && func2(tgt_th) && val;} : 0;\r\n//          },\r\n          cascade: function(func, func2){\r\n            return func && func2? function(tgt_th){return func(tgt_th) || func2(tgt_th);} : func || func2 || 0;\r\n          },\r\n          funcs_lvl: function(pf){\r\n            var arr = [0, this['watch_'+pf.watch] || 0, pf.reply && this.reply, pf.reply_to_me && this.reply_to_me, this['sticky_'+pf.sticky]];\r\n            var arr_raw4 = arr[4];\r\n            for (var i=2;i<4;i++) arr[i] = this.cascade(arr[i], arr[i-1]);\r\n            for (var i=5;i<8;i++) arr[i] = this.both_cascade(arr_raw4, arr[4], arr[i%4]);\r\n//            if (arr[4]) for (var i=5;i<8;i++) arr[i] = this.both(i, arr[4], arr[i%4]);\r\n//            for (var i=2;i<8;i++) arr[i] = this.cascade(arr[i], arr[i-1]);\r\n////            var arr = [0];\r\n////            arr[1] = this['watch_'+pf.watch] || 0;\r\n////            arr[2] = this.cascade(pf.reply && this.reply, arr[1]);\r\n////            arr[3] = this.cascade(pf.reply_to_me && this.reply_to_me, arr[2]);\r\n////            arr[4] = this.cascade(this['sticky_'+pf.sticky], arr[3]);\r\n////            arr[5] = this.cascade(this.both(5, 'sticky_'+pf.sticky, 'watch_'+pf.watch), arr[4]);\r\n////            arr[6] = this.cascade(this.both(6, 'sticky_'+pf.sticky, pf.reply && 'reply'), arr[5]);\r\n////            arr[7] = this.cascade(this.both(7, 'sticky_'+pf.sticky, pf.reply_to_me && 'reply_to_me'), arr[6]);\r\n            return arr;\r\n          },\r\n        }\r\n        function get_tgt_th(str){\r\n          return (str[0]===':')? (threads_odl[str] || get_threads_odl_default(str)) :\r\n                                  threads[str];\r\n        }\r\n        function check_sub(myself, check_func, idxs){\r\n          var ref = start;\r\n          while (ref<end && check_func(get_tgt_th(idxs[ref]))) ref++;\r\n          if (check_func(myself)) end = ref;\r\n          else start = ref;\r\n        }\r\n        var now;\r\n        var get_date;\r\n        var date;\r\n        var funcs_get_date = {\r\n          0: function(tgt_th8){return tgt_th8[0] || tgt_th8[4];},\r\n          4: function(tgt_th8){return tgt_th8[4] || tgt_th8[0];},\r\n          get 5(){now = Footer.ts_refresh; return this.f5;}, // for faster execution\r\n          f5: function(tgt_th8){return (now - tgt_th8[1])/tgt_th8[2];}, // this allows minus value, which is caused by unprecise local clock.\r\n//          get 5(){var now = Footer.ts_refresh; return function(tgt_th8){return (now - tgt_th8[1])/tgt_th8[2];}}, // this allows minus value, which is caused by unprecise local clock.\r\n//          get 5(){var now = Date.now(); return function(tgt_th8){return (now - tgt_th8[1])/tgt_th8[2];}}, // this allows minus value, which is caused by unprecise local clock.\r\n          1: function(tgt_th8){return tgt_th8[1];},\r\n          2: function(tgt_th8){return tgt_th8[2];},\r\n          3: function(tgt_th8){return tgt_th8[3];},\r\n          c0: function(tgt_th8){return date>=get_date(tgt_th8);},\r\n          c1: function(tgt_th8){return date<=get_date(tgt_th8);},\r\n          c0b: function(tgt_th8){return date>get_date(tgt_th8);}, // for backward insertion\r\n          c1b: function(tgt_th8){return date<get_date(tgt_th8);},\r\n        }\r\n        function insert(name, clg){\r\n//          if (pref.test_mode['169']) var ref_bulk = insert_bulk([name], {idxs: clg.idxs.slice(), __proto__:clg});\r\n          var idxs = clg.idxs;\r\n          threads = clg.threads;\r\n          threads_odl = clg.threads_odl;\r\n          start = 0;\r\n          end = idxs.length;\r\n          var pf = clg.order;\r\n          var myself = get_tgt_th(name);\r\n          if (pf.sticky!=='dont_care') check_sub(myself, (pf.sticky==='last')? check_funcs.sticky_last : check_funcs.sticky_first, idxs);\r\n          if (pf.reply_to_me) check_sub(myself, check_funcs.reply_to_me, idxs);\r\n          if (pf.reply) check_sub(myself, check_funcs.reply, idxs);\r\n          if (pf.watch!=='dont_care') check_sub(myself, (pf.watch==='last')? check_funcs.watch_last : check_funcs.watch_first, idxs);\r\n          get_date = funcs_get_date[pf.ordering%6];\r\n//          var indexing  = pref.catalog.indexing%6;\r\n//          var indexing2 = pref.catalog.indexing;\r\n//          var get_date = (indexing===0 || indexing===4)? function(tgt_th){return tgt_th[8][indexing] || tgt_th[8][(indexing===0)?4:0];} :\r\n//                         (indexing===5)?                 (function(){var now = Date.now(); return function(tgt_th){return (now - tgt_th[8][1])/tgt_th[8][2];}})() :\r\n//                                                         function(tgt_th){return tgt_th[8][indexing];};\r\n          date = get_date(myself[8]);\r\n          var check_func = (pf.ordering>=5 && pf.ordering<11)? funcs_get_date.c0 : funcs_get_date.c1;\r\n//          var check_func = (pf.ordering>=5 && pf.ordering<11)? function(tgt_th){return date>=get_date(tgt_th[8]);} : // not optimized: optimiezed too many times\r\n//                                                               function(tgt_th){return date<=get_date(tgt_th[8]);};\r\n          var ref = start;\r\n          while (ref<end && check_func(get_tgt_th(idxs[ref])[8])) ref++;\r\n  \r\n          if (ref==idxs.length) idxs[idxs.length] = name;\r\n          else idxs.splice(ref,0,name);\r\n  //        if (ref<=drawn_idx) drawn_idx = 0; // can't track by 'drawn_idx = ref; drawn_y = 0;'. drawn_xxx must be synchronized.\r\n          if (pref.test_mode['148']) { // base may not exist here because base is generated in show_catalog, but the thread will be appended at the case and order won't broken.\r\n            var base = clg.merge_bases.bases[name];\r\n            if (base) base.reorder_req |= 5; // base.reorder(key, clg); // direct call causes chattering\r\n          }\r\n//          if (pref.test_mode['169'] && ref_bulk!==ref) {\r\n//            console.log('ERROR: insert_bulk: bulk:'+ref_bulk+', single:'+ref);\r\n//            insert_bulk([name], {idxs: clg.idxs.slice(0,ref).concat(clg.idxs.slice(ref+1)), __proto__:clg});\r\n//          }\r\n          return ref;\r\n        }\r\n        var retval_first_idx;\r\n        function insert_bulk(names, clg, almost_sorted, from_merged, rm_dic,    checked){ // Merges unsorted names with sorted idxs.\r\n          if ((pref.test_mode['169'] || pref.test_mode['172']) && !checked) {\r\n            var idxs_before = almost_sorted? [] : clg.idxs;\r\n            var names_before = names.slice();\r\n            var rm_dic_before = rm_dic && Object.keys(rm_dic).reduce(dic_null,{});\r\n            var idxs_new = insert_bulk(names, clg, almost_sorted, from_merged, rm_dic, true);\r\n            check_bulk(idxs_new, clg.idxs_single, clg, clg.loose_check, idxs_before, names_before, almost_sorted, from_merged, rm_dic_before);\r\n            return idxs_new;\r\n          }\r\n          if (!from_merged && !pref.test_mode['169'] && pref.test_mode['148']) { // base may not exist here because base is generated in show_catalog, but the thread will be appended at the case and order won't broken.\r\n            var mb_base = clg.merge_bases.bases;\r\n            for (var i=0;i<names.length;i++) {\r\n              var base = mb_base[names[i]];\r\n              if (base) base.reorder_req |= 5; // base.reorder(key, clg); // direct call causes chattering\r\n            }\r\n          }\r\n          threads = clg.threads;\r\n          threads_odl = clg.threads_odl;\r\n          var pf = clg.order;\r\n          funcs_lvl = check_funcs.funcs_lvl(pf);\r\n//          funcs_0 = pf.sticky!=='dont_care'? [pf.sticky==='last'? check_funcs.sticky_last : check_funcs.sticky_first] : [];\r\n//          if (pf.reply_to_me) funcs_0[funcs_0.length] = check_funcs.reply_to_me;\r\n//          if (pf.reply) funcs_0[funcs_0.length] = check_funcs.reply;\r\n//          if (pf.watch!=='dont_care') funcs_0[funcs_0.length] = pf.watch==='last'? check_funcs.watch_last : check_funcs.watch_first;\r\n          get_date = funcs_get_date[pf.ordering%6];\r\n          var func_1f = (pf.ordering>=5 && pf.ordering<11)? funcs_get_date.c0 : funcs_get_date.c1;\r\n          var func_1b = (pf.ordering>=5 && pf.ordering<11)? funcs_get_date.c0b : funcs_get_date.c1b;\r\n          var func_1 = (!pref.test_mode['171'] || pf.ordering>=6)? func_1f : func_1b;\r\n\r\n          // SOULD I USE .sort() instead of implementing them by myself?\r\n          if (names.length===1 && !pref.test_mode['175'] && (!rm_dic || Object.keys(rm_dic).length===0)) return insert_bulk_1(clg.idxs, names[0], func_1, pf.ordering<6);\r\n          // 700 threads * 5 boards are merged with 3500 threads in 2 catalogs, ordering 'fast' and 'create' refresh:\r\n          //   insert_sort: 268.0ms, 167.6ms = 134.2ms +  33.4ms (insert_bulk_all + insert_bulk_1by1)\r\n          //                305.9ms, 686.9ms = 676.9ms +  10.3ms\r\n          //                 54.9ms, 162.6ms = 162.1ms +   0.5ms\r\n          //                274.6ms, 390.9ms = 352.5ms +  38.4ms\r\n          //                125.7ms, 391.4ms = 266.8ms + 124.6ms\r\n          //                 82.6ms,  66.8ms =  42.7ms +  24.1ms (insert_bulk_all(filter) + insert_bulk_1by1)\r\n          //                 99.0ms,  27.9ms =  21.4ms +   6.5ms\r\n          //                199.5ms,  35.2ms =  29.3ms +   5.9ms\r\n          //                146.6ms,  55.8ms =  46.9ms +   8.9ms\r\n          //                209.8ms, 107.5ms =  99.0ms +   8.5ms\r\n          //                293.5ms, 111.3ms =  88.1ms +  21.6ms + 1.6ms (insert_bulk_all(filter) + insert_bulk_1by1 + insert_sort(!pref.test_mode['174'])\r\n          //                 89.7ms,  37.3ms =  33.6ms +   2.8ms + 0.9ms\r\n          //                186.0ms,  57.9ms =  55.5ms +    ?    + 2.4ms // ? means under 0.4\r\n          //                208.8ms,  96.5ms =  77.6ms +  18.5ms + 0.4ms\r\n          //                312,4ms, 142.8ms = 120.0ms +  20.2ms + 2.6ms \r\n          if (pref.test_mode['173']) return (almost_sorted || from_merged)? insert_sort(names, null, clg) : insert_sort(clg.idxs, names, clg, rm_dic);\r\n//          if (pref.test_mode['173']) { // equivalent fast to insert_bulk_all even if 700 threads are merged with 3500 threads.\r\n//            if (almost_sorted || from_merged) return insert_sort(names, null, clg);\r\n//            var idxs_old = clg.idxs; // .slice(0, clg.drawn_idx===true? undefined : clg.drawn_idx); // clg.idxs is NOT changed, sort will be executed in a shallow copied array.\r\n//            var old_clean = clg.drawn_idx===true? idxs_old.length : clg.drawn_idx;\r\n//            var idxs_new = insert_sort(clg.idxs, names, clg, rm_dic);\r\n//            var has_posts = clg.view==='page' || clg.view==='thread';\r\n//            for (var i=0;i<old_clean;i++) if (idxs_old[i]!==idxs_new[i] || has_posts && (idxs_new[i] in rm_dic)) break;\r\n//            retval_first_idx = i;\r\n//            return idxs_new;\r\n//          }\r\n          if (almost_sorted) return !pref.test_mode['176']? insert_sort(names, null, clg) : insert_bulk_1by1(names, func_1b);\r\n          if (names.length===1) return insert_bulk_all(clg.idxs, names, func_1, rm_dic || true);\r\n          if (!pref.test_mode['174']) return insert_bulk_all(clg.idxs, insert_sort(names, null, clg), func_1, rm_dic || true);\r\n\r\n//          var step = names.length;  // in-place // not debugged.\r\n//          while (step>8) step = Math.ceil(step/2);\r\n//          for (var k=0;k<names.length;k+=step) arr_overwrite(names, insert_bulk_1by1(names.slice(k,step)), k);\r\n//          for (var s=step;s<names.length;s*=2)\r\n//            for (var k=0;k<names.length;k+=s*2) arr_overwrite(names, insert_bulk_all(names.slice(k,s), names.slices(k+s,k+s*2), func_1f), k);\r\n          var names_slices = []; // not in-place\r\n          while (names.length>0) names_slices[names_slices.length] = insert_bulk_1by1(names.splice(0,8), func_1b);\r\n//          var k=0;\r\n//          while (k<names.length) {\r\n//            var idxs_tmp = [names[k]];\r\n//            while (++k<names.length && k%8!=0) insert_bulk_init(idxs_tmp, names[k]);\r\n//            names_slices[names_slices.length] = idxs_tmp;\r\n//          }\r\n          while (names_slices.length>1) { // keep order\r\n            var k=0;\r\n            while (names_slices.length>k+1) {insert_bulk_all(names_slices[k],   names_slices.splice(k+1,1)[0], func_1f); k++;}\r\n            if (names_slices.length>k) insert_bulk_all(names_slices[k-1], names_slices.splice(k,1)[0], func_1f);\r\n          }\r\n//          while (names_slices.length>1) names_slices.push(insert_bulk_1.apply(null, names_slices.splice(0,2))); // shuffles order, not stable\r\n          return insert_bulk_all(clg.idxs, names_slices[0], func_1, rm_dic || true);\r\n        }\r\n//        function arr_overwrite(dst, src, start){ // not debugged.\r\n//          for (var i=0;i<src.length;i++) dst[start+i] = src[i];\r\n//        }\r\n        function insert_bulk_1(idxs, name, func_1, forward){ // in-place merge 1\r\n          var found = -1;\r\n          var func_lvl = funcs_lvl[7] || function(){return 0;};\r\n          var src_th = get_tgt_th(name);\r\n          var src_lvl = func_lvl(src_th)|0; // func_lvl() may return undefined or false\r\n          date = get_date(src_th[8]);\r\n          var p = forward? 0 : idxs.length-1;\r\n          var end = forward? idxs.length : -1;\r\n          var step = forward? 1 : -1;\r\n          while (p!=end) {\r\n            var tgt = idxs[p];\r\n            if (found==-1 && tgt===name) {found = p; p += step; continue;}\r\n            var tgt_th = get_tgt_th(tgt);\r\n            var tgt_lvl = func_lvl(tgt_th)|0;\r\n            if (forward ^ !(src_lvl==tgt_lvl && !func_1(tgt_th[8]) || src_lvl>tgt_lvl)) break;\r\n            p += step;\r\n          }\r\n          if (found===-1) {\r\n            found = forward? idxs.indexOf(name,p+1) : idxs.lastIndexOf(name,p-1);\r\n            if (found===-1) {\r\n              found = idxs.length;\r\n              if (!forward) p++;\r\n            }\r\n          } else {\r\n            p -= step;\r\n            if (found===p) return idxs; // p;\r\n          }\r\n          if (p<found) for (var i=found;i>p;i--) idxs[i] = idxs[i-1];\r\n          else for (var i=found;i<p;i++) idxs[i] = idxs[i+1];\r\n          idxs[p] = name;\r\n          retval_first_idx = p<found? p : found;\r\n          return idxs;\r\n        }\r\n//        function insert_bulk_1(idxs, name, func_1, forward){ // in-place merge 1\r\n//          var removed = -1;\r\n//          var func_lvl = funcs_lvl[7] || function(){return 0;};\r\n//          var src_th = get_tgt_th(name);\r\n//          var src_lvl = func_lvl(src_th)|0; // func_lvl() may return undefined or false\r\n//          date = get_date(src_th[8]);\r\n//          if (forward) {\r\n//            var p = -1;\r\n//            while (++p<idxs.length) {\r\n//              var tgt = idxs[p];\r\n//              if (removed==-1 && tgt===name) {removed = p; continue;}\r\n//              var tgt_th = get_tgt_th(tgt);\r\n//              var tgt_lvl = func_lvl(tgt_th)|0;\r\n//              if (src_lvl==tgt_lvl && !func_1(tgt_th[8]) || src_lvl>tgt_lvl) break;\r\n//            }\r\n////            if (removed==-1) removed = idxs.indexOf(name,p+1); // not debugged\r\n////            return insert_bulk_1_move(idxs, name, removed>=0? --p : p, removed);\r\n//////            if (removed>=0) return (removed===--p)? p : insert_bulk_1_move_b(idxs, name, removed, p); // -1 for removed // not debugged\r\n//////            else {\r\n//////              var e = idxs.indexOf(name,p+1);\r\n//////              return insert_bulk_1_move_f(idxs, name, p, e==-1? idxs.length : e);\r\n//////            }\r\n//            if (removed>=0) {\r\n//              p--; // -1 for removed\r\n//              if (removed===p) return p;\r\n//              for (var s=removed;s<p;s++) idxs[s] = idxs[s+1];\r\n//              idxs[p] = name;\r\n//              return removed;\r\n//            } else {\r\n//              var e = p;\r\n//              while (e<idxs.length && idxs[++e]!==name);\r\n//              for (var i=e;i>p;i--) idxs[i] = idxs[i-1];\r\n//              idxs[p] = name;\r\n//              return p;\r\n//            }\r\n//          } else {\r\n//            var p = idxs.length;\r\n//            while (--p>=0) {\r\n//              var tgt = idxs[p];\r\n//              if (removed==-1 && tgt===name) {removed = p; continue;}\r\n//              var tgt_th = get_tgt_th(tgt);\r\n//              var tgt_lvl = func_lvl(tgt_th)|0;\r\n//              if (src_lvl==tgt_lvl &&  func_1(tgt_th[8]) || src_lvl<tgt_lvl) break;\r\n//            }\r\n////            if (removed==-1) removed = idxs.lastIndexOf(name,p-1); // not debugged\r\n////            return insert_bulk_1_move(idxs, name, removed>=0? p : ++p, removed);\r\n//////            if (removed>=0) return (removed===++p)? p : insert_bulk_1_move_f(idxs, name, p, removed); // not debugged\r\n//////            else {\r\n//////              var s = idxs.lastIndexOf(name,p-1);\r\n//////              return (s>=0)? insert_bulk_1_move_b(idxs, name, s, p)\r\n//////                           : insert_bulk_1_move_f(idxs, name, ++p, idxs.length);\r\n//////            }\r\n//            if (removed>=0) {\r\n//              p++;\r\n//              if (removed===p) return p;\r\n//              for (var e=removed;e>p;e--) idxs[e] = idxs[e-1];\r\n//              idxs[p] = name;\r\n//              return p;\r\n//            } else {\r\n//              var s = p;\r\n//              while (--s>=0 && idxs[s]!==name);\r\n//              if (s>=0) for (var i=s;i<p;i++) idxs[i] = idxs[i+1];\r\n//              else {\r\n//                p++;\r\n//                for (var i=idxs.length;i>p;i--) idxs[i] = idxs[i-1];\r\n//              }\r\n//              idxs[p] = name;\r\n//              return s>=0? s : p;\r\n//            }\r\n//          }\r\n//        }\r\n////        function insert_bulk_1_move_b(idxs, name, start, end){ // not debugged\r\n////          for (var i=start;i<end;i++) idxs[i] = idxs[i+1];\r\n////          idxs[end] = name;\r\n////          return start;\r\n////        }\r\n////        function insert_bulk_1_move_f(idxs, name, start, end){ // not debugged\r\n////          for (var i=end;i>start;i--) idxs[i] = idxs[i-1];\r\n////          idxs[start] = name;\r\n////          return start;\r\n////        }\r\n        function filterInPlace(idxs, names, rm_dic){ // x5-10 faster than filter\r\n          if (idxs.length==0 || !rm_dic && names.length==0) return -1;\r\n          if (!rm_dic && names.length==1) {\r\n            var idx_old = idxs.indexOf(names[0]);\r\n            if (idx_old!=-1) idxs.splice(idx_old,1);\r\n            return idx_old;\r\n          }\r\n          if (!rm_dic || rm_dic===true) rm_dic = names.reduce(dic_null,{});\r\n          var i=-1;          \r\n          while (++i<idxs.length) if (idxs[i] in rm_dic) break;\r\n          if (i==idxs.length) return -1;\r\n          idx_old = i;\r\n          var p = i;\r\n          while (++i<idxs.length) if (!(idxs[i] in rm_dic)) idxs[p++] = idxs[i];\r\n          idxs.length = p;\r\n          return idx_old;\r\n        }\r\n        function insert_bulk_all(idxs, names, func_1, rm_dic){ // idxs and names must be sorted in advance\r\n          if (idxs.length==0) return names;\r\n          var idx_old = (rm_dic)? filterInPlace(idxs, names, rm_dic) : -1;\r\n//          if (clg && idxs.length>0) { // remove old entries\r\n//            if (names.length==1) {\r\n//              var idx_old = idxs.indexOf(names[0]);\r\n//              if (idx_old!=-1) idxs.splice(idx_old,1);\r\n//            } else {\r\n//              var rm_dic = names.reduce(function(a,c){a[c]=null;return a;},{});\r\n//              idx_old = filterInPlace(idxs, rm_dic);\r\n////              idxs = idxs.filter(function(v,i){var rm = (v in rm_dic); if (rm && idx_old===undefined) idx_old = i; return !rm;});\r\n////              clg.idxs = idxs;\r\n//////              var i=-1;\r\n//////              while (++i<idxs.length) if (idxs[i] in rm_list) {idx_old=i; idxs.splice(i--,1); break;} // splice is to heavy\r\n//////              var count = 1;\r\n//////              while (++i<idxs.length) if (idxs[i] in rm_list) {idxs.splice(i--,1); if (++count>=names.length) break;}\r\n//            }\r\n//          }\r\n          func_0 = funcs_lvl[7];\r\n          if (idxs.length==0 || !func_0(get_tgt_th(idxs[0])) && !func_0(get_tgt_th(names[0]))) func_0 = 0; // for faster execution in no-sticky boards\r\n          var i=1;\r\n          if (pref.test_mode['180']) { // in-place\r\n            idxs = Array(names.length).concat(idxs);\r\n            p_out = 0;\r\n            var pos = insert_bulk_111InPlace(idxs, names[0], names.length, func_1);\r\n            var idx_first = p_out -1;\r\n            while (i<names.length) pos = insert_bulk_111InPlace(idxs, names[i++], pos, func_1);\r\n          } else {\r\n            var pos = insert_bulk_111(idxs, names[0], 0, func_1);\r\n            var idx_first = pos;\r\n            while (++pos<idxs.length && i<names.length) pos = insert_bulk_111(idxs, names[i++], pos, func_1);\r\n            while (i<names.length) idxs[pos++] = names[i++];\r\n          }\r\n          retval_first_idx = (idx_old>0 && idx_old<idx_first)? idx_old : idx_first;\r\n          return idxs;\r\n        }\r\n        function insert_bulk_1by1(names, func_1b){\r\n          var idxs = [names[names.length-1]];\r\n          for (var i=names.length-2;i>=0;i--) {\r\n            func_0 = funcs_lvl[7];\r\n            insert_bulk_111(idxs, names[i], 0, func_1b);\r\n          }\r\n          return idxs;\r\n        }\r\n//        function insert_bulk_init(idxs, name, func_1){\r\n//          func_0 = funcs_lvl[7];\r\n//          if (idxs.length==0 || !func_0(get_tgt_th(name)) && !func_0(get_tgt_th(idxs[0]))) func_0 = 0; // for faster execution in no-sticky boards\r\n////          func_0 = funcs_0[0];\r\n////          j = 1;\r\n//          return insert_bulk_111(idxs, name, 0, func_1);\r\n//        }\r\n        var p_out;\r\n        function insert_bulk_111InPlace(idxs, name, pos, func_1){\r\n          var src_th = get_tgt_th(name);\r\n          var src_lvl = func_0 && func_0(src_th)|0; // func_0() may return undefined or false\r\n          date = get_date(src_th[8]);\r\n          while (pos<idxs.length) {\r\n            var tgt = idxs[pos];\r\n            var tgt_th = get_tgt_th(tgt);\r\n            var ref_lvl = func_0 && func_0(tgt_th)|0;\r\n            if (src_lvl!=ref_lvl) {\r\n              if (src_lvl<ref_lvl) {\r\n                idxs[p_out++] = tgt;\r\n                while (++pos<idxs.length && src_lvl<(func_0(get_tgt_th(idxs[pos]))|0)) idxs[p_out++] = idxs[pos];\r\n                func_0 = funcs_lvl[src_lvl];\r\n              } else { // 'if (src_lvl!=ref_lvl) if (src_lvl>ref_lvl)' is dangerous, this causes infinite loop if the values are undefined and false\r\n                func_0 = funcs_lvl[src_lvl];\r\n                idxs[p_out++] = name; // idxs.splice(pos,0,name);\r\n                return pos;\r\n              }\r\n            } else if (!func_1(tgt_th[8])) {\r\n              idxs[p_out++] = name; // idxs.splice(pos,0,name);\r\n              return pos;\r\n            } else {idxs[p_out++] = tgt; pos++;} // pos++;\r\n          }\r\n          idxs[p_out++] = name;\r\n          return pos;\r\n        }\r\n        var funcs_lvl;\r\n//        var func_1;\r\n//        var j;\r\n        var func_0;\r\n        function insert_bulk_111(idxs, name, pos, func_1){\r\n          var src_th = get_tgt_th(name);\r\n          var src_lvl = func_0 && func_0(src_th)|0; // func_0() may return undefined or false\r\n          date = get_date(src_th[8]);\r\n          while (pos<idxs.length) {\r\n            var tgt_th = get_tgt_th(idxs[pos]);\r\n            var ref_lvl = func_0 && func_0(tgt_th)|0;\r\n            if (src_lvl!=ref_lvl) {\r\n              if (src_lvl<ref_lvl) {\r\n                while (++pos<idxs.length && src_lvl<(func_0(get_tgt_th(idxs[pos]))|0));\r\n                func_0 = funcs_lvl[src_lvl];\r\n              } else { // 'if (src_lvl!=ref_lvl) if (src_lvl>ref_lvl)' is dangerous, this causes infinite loop if the values are undefined and false\r\n                func_0 = funcs_lvl[src_lvl];\r\n                idxs.splice(pos,0,name);\r\n                return pos;\r\n              }\r\n            } else if (!func_1(tgt_th[8])) {\r\n//              if (pos===0) idxs.unshift(name); else // should this be used for pre-sorted array?\r\n              idxs.splice(pos,0,name);\r\n              return pos;\r\n            } else pos++;\r\n          }\r\n          idxs[pos] = name;\r\n          return pos;\r\n        }\r\n//        function insert_bulk_111(idxs, name, pos){ // works, but BUG, different categorization.\r\n//          var tgt_th = get_tgt_th(name);\r\n//          var mine = func_0 && func_0(tgt_th);\r\n//          date = get_date(tgt_th[8]);\r\n//          while (pos<idxs.length) {\r\n//            tgt_th = get_tgt_th(idxs[pos]);\r\n//            if (func_0 && mine^func_0(tgt_th) && !mine) { // mine!=func_0(tgt_th) doesn't work, mine may be undefined // BUG, different categorization.\r\n//              while (++pos<idxs.length && func_0(get_tgt_th(idxs[pos])));\r\n//              func_0 = funcs_0[j++];\r\n//              mine = func_0 && func_0(get_tgt_th(name));\r\n//            } else if (func_0 && mine || !func_1(tgt_th[8])) {\r\n//              idxs.splice(pos,0,name);\r\n//              return pos;\r\n//            } else pos++;\r\n//          }\r\n//          idxs[pos] = name;\r\n//          return pos;\r\n//        }\r\n        function insert_sort_up(a,b)  {return b[0] - a[0] || a[1] - b[1] || a[2] - b[2];}\r\n        function insert_sort_down(a,b){return b[0] - a[0] || b[1] - a[1] || a[2] - b[2];}\r\n        function insert_sort(idxs, names, clg, rm_dic){\r\n          var func_lvl = funcs_lvl[7] || function(){return 0;};\r\n          var sort_func = (clg.order.ordering>=5 && clg.order.ordering<11)? insert_sort_up : insert_sort_down;\r\n//          var polarity = (clg.order.ordering>=5 && clg.order.ordering<11)? 1 : -1;\r\n////          var sort_func0 = func_lvl? function(v){return func_lvl(get_tgt_th(v))|0;} : function(){return 0;};\r\n////          var sort_func1 = function(v){return get_date(get_tgt_th(v)[8]);};\r\n//          var sort_func = function(a,b){return (b[0] - a[0]) || (a[1] - b[1])*polarity || a[2] - b[2];};\r\n          var sort_key = function(v,i){return [func_lvl(get_tgt_th(v))|0, get_date(get_tgt_th(v)[8]), i, v];};\r\n          if (rm_dic) idxs = idxs.filter(function(v){return !(v in rm_dic);}); // retains old idxs to use it later for making opt index of modified part.\r\n          if  (names) {\r\n            var offset = (!pref.test_mode['171'] || clg.order.ordering%4>=2)? idxs.length : -names.length; // takes 2,3,6,7,10,11\r\n            rm_dic = names.reduce(function(a,c,i){a[c] = i+offset; return a;}, {});\r\n          }\r\n          var idxs_key = idxs.map((names)? function(v,i){var idx = rm_dic[v]; return sort_key(v,idx? (rm_dic[v]=i,idx) : i);} : sort_key); // keep order as much as possible\r\n          return (!names? idxs_key : offset<0? names.reduce(function(a,c){var idx = rm_dic[c]; if (idx<0)       a[a.length] = sort_key(c,idx); return a;},[]).concat(idxs_key)\r\n                                             : names.reduce(function(a,c){var idx = rm_dic[c]; if (idx>=offset) a[a.length] = sort_key(c,idx); return a;}, idxs_key)\r\n                 ).sort(sort_func).map(function(v){return v[3];});\r\n//          if  (names) filterInPlace(idxs, names, rm_dic);\r\n//          return (!names? idxs : (!pref.test_mode['171'] || clg.order.ordering>=6)? idxs.concat(names) : names.concat(idxs)).map(function(v,i){return [sort_func0(v), sort_func1(v), i, v];}).sort(sort_func).map(function(v){return v[3];});\r\n////          if  (names) {\r\n////            if (!rm_dic) rm_dic = names.reduce(function(a,c){a[c] = null; return a;},{});\r\n////            var idxs_removed = idxs.filter(function(v){return !(v in rm_dic);});\r\n////          }\r\n////          return (!names? idxs : (!pref.test_mode['171'] || clg.order.ordering>=6)? idxs_removed.concat(names) : names.concat(idxs_removed)).map(function(v,i){return [sort_func0(v), sort_func1(v), i, v];}).sort(sort_func).map(function(v){return v[3];});\r\n        }\r\n        function check_bulk(idxs_bulk, idxs, clg, out_of_order, idxs_before, names, almost_sorted, from_merged, rm_dic){\r\n          var ref = insert_sort(idxs_before.slice(), names, clg, rm_dic);\r\n          if (idxs && idxs_bulk.length!==idxs.length) console.log('ERROR: check_bulk: length: bulk:'+idxs_bulk.length+', single:'+idxs.length);\r\n          if (idxs_bulk.length!==ref.length) console.log('ERROR: check_bulk: length: bulk:'+idxs_bulk.length+', ref:'+ref.length);\r\n//          var ref = idxs.slice().sort((a,b)=>((func_lvl(clg.threads[b])|0) - (func_lvl(clg.threads[a])|0) || get_date(clg.threads[a][8])-get_date(clg.threads[b][8]))*polarity);\r\n          var count = 0;\r\n          for (var i=0;i<idxs_bulk.length;i++) if (idxs && idxs_bulk[i]!==idxs[i] && (!out_of_order || get_date(clg.threads[idxs_bulk[i]][8])!=get_date(clg.threads[idxs[i]][8])) ||\r\n                                                           idxs_bulk[i]!==ref[i]) //   &&                   get_date(clg.threads[idxs_bulk[i]][8])!=get_date(clg.threads[ref[i]][8]))\r\n            if (count++<10) console.log('ERROR: idx_reorder_exe: '+i+', bulk:'+idxs_bulk[i]+': '+get_date(clg.threads[idxs_bulk[i]][8])+\r\n                                    (idxs && idxs_bulk[i]!==idxs[i]? ', single:'+idxs[i]+': '+get_date(clg.threads[idxs[i]][8]) : '')+\r\n                                                                     ', ref:'+ref[i]+': '+get_date(clg.threads[ref[i]][8])) + ', '+idxs_bulk.length;\r\n          if (count>10) console.log('Bailed out, too many errors. '+count+'/'+idxs_bulk.length);\r\n          if (count>0) insert_bulk(names, {idx:idxs_before, __proto__:clg}, almost_sorted, from_merged, rm_dic,    true); // for debug diving\r\n        }\r\n        function dic_null(a,c){a[c]=null;return a;}\r\n        return {\r\n          idx_raise_odl: function(th){\r\n            var i = this.idxs.indexOf(th.key);\r\n            if (i!=-1) {\r\n              var kwd_odldb = kwd_odl + th.domain + th.board;\r\n              while (++i<this.idxs.length) {\r\n                if (this.idxs[i].indexOf(kwd_odldb)===0) {\r\n                  this.threads_odl[this.idxs[i]] = {'8':[ (th.time_posted || th.time_bumped), th.time_created, th.nof_posts, th.nof_files, (th.time_bumped || th.time_posted) ],\r\n                                                 __proto__:threads_odl_default};\r\n                  insert(this.idxs.splice(i,1)[0], this);\r\n                  break;\r\n            }}}\r\n          },\r\n          idx_delete_odl: function(keys){\r\n            for (var i=0;i<keys.length;i++) delete this.threads_odl[kwd_odl+keys[i]];\r\n          },\r\n          idx_insert_odl: function(name){\r\n            delete this.threads_odl[kwd_odl+name];\r\n            this.idx_reorder(kwd_odl+name);\r\n          },\r\n//          clear: clear, // NEED TO BE IMPLEMENTED to clear 'threads_odl' to prevent memory from leaking.\r\n          idx_re_sort: function(start_pos, small_diff){\r\n            var odls = this.idxs.filter(function(v){return v[0]===':';});\r\n            if (pref.test_mode['169']) var idxs_bulk = this.idxs.slice();\r\n            var idxs = this.idxs;\r\n            this.idxs = [];\r\n            var hide_tgts = {};\r\n            var hide_unwatched = this.pref[this.mode].hide_unwatched\r\n            if (pref.test_mode['168'] || pref.test_mode['169']) {\r\n              if (small_diff) for (var i=idxs.length-1;i>=0;i--) {if (idxs[i][0]!==':') this.idx_re_sort_sub(hide_unwatched, idxs[i], hide_tgts);}\r\n              else for (var i in this.threads) this.idx_re_sort_sub(hide_unwatched, i, hide_tgts);\r\n            }\r\n            if (!pref.test_mode['168']) {\r\n              if (pref.test_mode['169']) idxs = idxs_bulk;\r\n              if (!small_diff) idxs = Object.keys(this.threads);\r\n              else filterInPlace(idxs, odls);\r\n              if (hide_unwatched) {\r\n                var hide_tgts = idxs.filter(function(v){return !this.threads[v][16].lth.watched_p;}, this);\r\n                filterInPlace(idxs, hide_tgts);\r\n              }\r\n//              for (var i=idxs.length-1;i>=0;i--) {\r\n//                var name = idxs[i];\r\n//                if (name[0]===':') {odls[odls.length] = name; idxs.splice(i,1);}\r\n//                else if (hide_unwatched && !this.threads[name][16].lth.watched_p) {hide_tgts[name] = this.threads[name]; idxs.splice(i,1);}\r\n//              }\r\n              if (idxs.length>0) this.idxs = insert_bulk(idxs, pref.test_mode['169']? {idxs:idxs_bulk, idxs_single:this.idxs, loose_check:true, __proto__:this} : this, small_diff || pref.test_mode['173'] || !pref.test_mode['176'], null, true);\r\n            }\r\n            if (hide_unwatched) this.func_hide_all(hide_tgts);\r\n            this.idxs = this.idxs.concat(odls);\r\n            this.show_catalog(start_pos || 0);\r\n          },\r\n          idx_re_sort_sub: function(hide_unwatched, name, hide_tgts){\r\n            if (!hide_unwatched || this.threads[name][16].lth.watched_p) insert(name, this);\r\n            else hide_tgts[name] = this.threads[name];\r\n          },\r\n          idx_rm_reorder_exe: function(){\r\n            if (pref.test_mode['168']) return;\r\n            if (this.idxs_req.size===0) return; //  && !this.idxs_rm_queue) return;\r\n            if (pref.test_mode['173']) var idxs_old = this.idxs; // .slice(0, this.drawn_idx===true? undefined : this.drawn_idx); // this.idxs is NOT changed, sort will be executed in a shallow copied array.\r\n            var names_unique = [];\r\n            var created_dic = {};\r\n            var names_dic = Object.create(created_dic);\r\n            var rm_dic = Object.create(pref.test_mode['173']? null : names_dic);\r\n            var idxs_req = this.idxs_req;\r\n            for (var i of idxs_req.keys()) { // too slow, overspec.\r\n              var val = idxs_req.get(i);\r\n              if (val>0) {\r\n                names_unique[names_unique.length] = i;\r\n                if (val>1) created_dic[i] = null;\r\n                else names_dic[i] = null;\r\n              } else rm_dic[i] = null;\r\n            }\r\n//            for (var i of this.idxs_req.keys()) names_unique[names_unique.length] = i;\r\n//            var names_dic = names_unique.reduce(dic_null,{});\r\n//            var names_unique = (this.dirty&0x08)? Object.keys(names_dic) : reqs; // this.idxs_req;\r\n//            var rm_dic_base = Object.create(pref.test_mode['173']? null : names_dic);\r\n//            var rm_dic = this.idxs_rm_queue? this.idxs_rm_queue.reduce(dic_null, rm_dic_base) : rm_dic_base;\r\n            if (pref.debug_mode['39']) {\r\n              var errors = [];\r\n              for (var i=0;i<this.idxs.length;i++) {\r\n                var name = this.idxs[i];\r\n                if (!(name in this.threads) && (!(name in rm_dic) || (name in names_dic))) errors.push(name);\r\n              }\r\n              if (errors.length>0) {\r\n                console.log('ERROR: idx_rm_reorder_exe: ',errors);\r\n                console.trace();\r\n                console.log(rm_dic, names_dic, names_unique, this.idxs_req);\r\n              }\r\n            }\r\n            this.idxs_req.clear(); //  = [];\r\n            if (names_unique.length===0) var idx_top = filterInPlace(pref.test_mode['169']? this.idxs_bulk : this.idxs, null, rm_dic);\r\n            else var idxs = insert_bulk(names_unique, pref.test_mode['169']? {idxs: this.idxs_bulk, idxs_single:this.idxs, __proto__:this} : this, false, false, rm_dic);\r\n//            this.idxs_rm_queue = null;\r\n            if (pref.test_mode['169']) this.idxs_bulk = null;\r\n            if (names_unique.length===0) return [idx_top, null];\r\n            if (!pref.test_mode['169']) this.idxs = idxs;\r\n            if (!pref.test_mode['173']) return [retval_first_idx, names_dic, created_dic];\r\n            var old_clean = this.drawn_idx===true? idxs_old.length : this.drawn_idx;\r\n            var has_posts = this.view==='page' || this.view==='thread';\r\n            for (var i=0;i<old_clean;i++) if (idxs_old[i]!==idxs[i] || has_posts && (idxs[i] in rm_dic)) break;\r\n            return [i, names_dic, created_dic];\r\n//            if ((idx_new !== idx_old || (this.view==='page' || this.view==='thread')) // this line can't be implemented.\r\n//              && (this.drawn_idx===true || idx_new < this.drawn_idx || idx_old!=-1 && idx_old < this.drawn_idx)) this.drawn_idx = 0;\r\n          },\r\n//          idx_reorder_exe: function(){\r\n//            if (pref.test_mode['168']) return;\r\n//            if (this.idxs_req.length==0) return;\r\n//            var names_unique = (this.dirty&0x08)? Object.keys(this.idxs_req.reduce(function(a,c){a[c]=null;return a;},{})) : this.idxs_req;\r\n//            var idxs = insert_bulk(names_unique, pref.test_mode['169']? {idxs: this.idxs_bulk, idxs_single:this.idxs, __proto__:this} : this);\r\n//            this.idxs_req = [];\r\n//            if (pref.test_mode['169']) this.idxs_bulk = null;\r\n//            else this.idxs = idxs;\r\n//            return retval_first_idx;\r\n////            if ((idx_new !== idx_old || (this.view==='page' || this.view==='thread')) // this line can't be implemented.\r\n////              && (this.drawn_idx===true || idx_new < this.drawn_idx || idx_old!=-1 && idx_old < this.drawn_idx)) this.drawn_idx = 0;\r\n//          },\r\n          idx_reorder: function(name, new_th, bulk){\r\n            if (this.pref[this.mode].hide_unwatched && !this.threads[name][16].lth.watched_p) return;\r\n            if (!pref.test_mode['168']) {\r\n              if (pref.test_mode['169'] && !this.idxs_bulk) this.idxs_bulk = this.idxs.slice();\r\n              var val_old = this.idxs_req.get(name);\r\n              if (val_old!==undefined) this.idxs_req.delete(name); // keep order\r\n              this.idxs_req.set(name, val_old | (new_th? 3:1));\r\n//              if (this.idxs_req.has(name)) this.idxs_req.delete(name); // keep order\r\n//              this.idxs_req.set(name, 1);\r\n//              this.idxs_req[this.idxs_req.length] = name;\r\n              this.dirty |= 0x02; // !bulk? 0x0a : 0x02;\r\n              if (!pref.test_mode['169'] /*|| this.idxs_rm_queue*/) return this.idxs.length; // dummy\r\n            }\r\n            if (pref.test_mode['168'] || pref.test_mode['169']) {\r\n//              if (this.idxs_rm_queue && this.idxs_rm_queue.indexOf(name)!=-1) return this.idxs.length; // for safe, this line is not hit probably. // this doewn't work, deleted thread is scanned at inserting other live threads.\r\n              if (pref.test_mode['169'] && !bulk) var idxs_bulk = this.idxs.slice();\r\n//              if (this.pref[this.mode].hide_unwatched && !this.threads[name][16].lth.watched) return this.idxs.length;\r\n//              var idx_old = initial? -1 : idxs.indexOf(name); // causes multiple entries if idx_reorder is called from view_attr_set\r\n              var idx_old = this.idxs.indexOf(name);\r\n              if (idx_old!=-1) this.idxs.splice(idx_old,1);\r\n////              if (this.pref[this.mode].hide_unwatched && !this.threads[name][16].lth.watched) return this.idxs.length;\r\n              var idx_new = insert(name, this);\r\n              if ((idx_new !== idx_old || (this.view==='page' || this.view==='thread'))\r\n                && (this.drawn_idx===true || idx_new < this.drawn_idx || idx_old!=-1 && idx_old < this.drawn_idx)) this.drawn_idx = 0;\r\n//                && (this.drawn_idx===true || idx_new < this.drawn_idx || idx_old < this.drawn_idx)) this.drawn_idx = 0;\r\n////              if ((idx_new !== idx_old || showing_posts) && (idx_new < this.drawn_idx || idx_old < this.drawn_idx)) this.drawn_idx = 0;\r\n////              else if (showing_posts && this.drawn_idx===true) this.drawn_idx = 0;\r\n//  //            else if (this.mode==='page' && this.drawn_idx===true) this.drawn_idx = idx_new; // BUG??? this doesn't track drawn_y and ref_count.\r\n//  //            if (idx_new !== idx_old && (idx_new < this.drawn_idx || idx_old < this.drawn_idx)) this.drawn_idx = 0; // BUG. doesn't redraw if its size is changed.\r\n            }\r\n            if (!pref.test_mode['168'] && !bulk && pref.test_mode['169']) {\r\n              var clg_tmp = {idxs:idxs_bulk, idxs_single:this.idxs, __proto__:this};\r\n              insert_bulk([name], clg_tmp);\r\n              if (retval_first_idx!==undefined && retval_first_idx!==idx_new && retval_first_idx!==idx_old && clg_tmp.idxs.indexOf(name)!==idx_new) console.log('ERROR: idx_reorder: bulk:'+retval_first_idx+', single:'+idx_new+', '+idx_old);\r\n            }\r\n            return idx_new;\r\n//            return (idx_new !==idx_old || (this.threads[name] && this.threads[name][9][0]!=this.threads[name][1])); // returns need to redraw.\r\n          },\r\n          idx_remove: function(name){\r\n            if (pref.test_mode['169'] && !this.idxs_bulk) this.idxs_bulk = this.idxs.slice();\r\n            if (pref.test_mode['168'] || pref.test_mode['169'] || pref.test_mode['181']) {\r\n              var idx = this.idxs.indexOf(name);\r\n              if (idx>=0) this.idxs.splice(idx,1);\r\n              if (pref.test_mode['168'] || pref.test_mode['181']) return;\r\n            }\r\n            if (this.idxs_req.has(name)) this.idxs_req.delete(name); // keep order, but redundant.\r\n            this.idxs_req.set(name,0);\r\n            this.dirty |= 0x04;\r\n//            if (this.idxs_rm_queue) this.idxs_rm_queue.push(name);\r\n//            else {\r\n//              this.idxs_rm_queue = [name];\r\n//              this.dirty |= 0x04;\r\n//            }\r\n          },\r\n//          idx_remove_exe: function(){\r\n//            var idx_top = filterInPlace(pref.test_mode['169']? this.idxs_bulk : this.idxs, this.idxs_rm_queue);\r\n//            this.idxs_rm_queue = null;\r\n//            if (pref.test_mode['169']) this.idxs_bulk = null;\r\n//            return [idx_top, null];\r\n//          },\r\n          idx_refresh: function(clg){\r\n            var start_pos = this.pref.INST.safety.hide? -1 : 0;\r\n            if (this.order.ordering%6===5) this.idx_re_sort(start_pos, true); // causes extra redraw, consider how to reduce this....\r\n            else if (clg===this) if (start_pos) this.show_catalog(start_pos)\r\n          },\r\n          idx_idxMergeAll: 7, // /Creation\r\n//          idx_insert: insert, // for merge\r\n          idx_insert_bulk: insert_bulk, // for merge\r\n        };\r\n      })());\r\n      \r\n//      var threads_index = !pref.test_mode['114']? pClg : (function(){ // threads_idx, threads_odl and drawn_idx must be separated. // working code.\r\n//        function re_sort(){\r\n//          var odl = [];\r\n//          for (var i=0;i<threads_idx.length;i++) if (threads_idx[i].substr(0,4)===':DL:') odl[odl.length] = threads_idx[i];\r\n//          threads_idx=[];\r\n//          for (var i in threads) insert(i);\r\n//          for (var i=0;i<odl.length;i++) threads_idx[threads_idx.length] = odl[i];\r\n//          drawn_idx = 0;\r\n//          show_catalog();\r\n//        }\r\n////      function reorder_threads_idx(names){\r\n////        for (var i in names) reorder_thread_idx(i);\r\n////      }\r\n//////      function reorder_thread_idx(name, skip_check){ // working code.\r\n////////        for (var i=0;i<threads_idx.length;i++) if (threads_idx[i]==name) {threads_idx.splice(i,1);break;}\r\n////////        insert_thread_idx(name);\r\n//////        var i;\r\n//////        if (!skip_check) {\r\n//////          i = 0;\r\n//////          while (i<threads_idx.length && threads_idx[i]!==name) i++;\r\n//////          if (i<threads_idx.length) threads_idx.splice(i,1);\r\n//////        } else i = -1;\r\n//////        return (i!=insert_thread_idx(name) || (threads[name] && threads[name][9][0]!=threads[name][1])); // returns need to redraw.\r\n//////      }\r\n//\r\n//////      function raise_threads_idx_odl(db,key){ // works, but blocked by stikies.\r\n//////        var idx = threads_idx.indexOf(key);\r\n//////        if (idx!=-1) {\r\n//////          var kwd_odldb = ':DL:'+db;\r\n//////          for (var i=idx+1;i<threads_idx.length;i++)\r\n//////            if (threads_idx[i].indexOf(kwd_odldb)===0) {\r\n//////              if (i!=idx+1) threads_idx.splice(idx+1,0,threads_idx.splice(i,1)[0]);\r\n//////              break;\r\n//////            }\r\n//////        }\r\n//////      }\r\n//////      function raise_threads_idx_odl(db){ // working, but blinks when there are 'watched and first' threads. (stickies can't be sticky)\r\n//////        for (var i=threads_idx.length-1;i>=0;i--)\r\n//////          if (threads_idx[i].indexOf(db)===0) {\r\n//////            if (i<threads_idx.length-2) {\r\n//////              var kwd_odldb = ':DL:'+db;\r\n//////              for (var j=i+1;j<threads_idx.length;j++)\r\n//////                if (threads_idx[j].indexOf(kwd_odldb)===0) {\r\n//////                  if (j!=i+1) threads_idx.splice(i+1,0,threads_idx.splice(j,1)[0]);\r\n//////                  break;\r\n//////                }\r\n//////            }\r\n//////            break;\r\n//////          }\r\n//////      }\r\n//        function reorder(name){\r\n//          var idx_old = threads_idx.indexOf(name);\r\n//          if (idx_old!=-1) threads_idx.splice(idx_old,1);\r\n//          var idx_new = insert(name);\r\n//          if ((idx_new !== idx_old || embed_mode==='page') && (idx_new < drawn_idx || idx_old < drawn_idx)) drawn_idx = 0;\r\n//          else if (embed_mode==='page' && drawn_idx===true) drawn_idx = 0;\r\n////          else if (embed_mode==='page' && drawn_idx===true) drawn_idx = idx_new; // BUG??? this doesn't track drawn_y and ref_count.\r\n////          if (idx_new !== idx_old && (idx_new < drawn_idx || idx_old < drawn_idx)) drawn_idx = 0; // BUG. doesn't redraw if its size is changed.\r\n//          return (idx_new !==idx_old || (threads[name] && threads[name][9][0]!=threads[name][1])); // returns need to redraw.\r\n//        }\r\n//        var threads_odl = {};\r\n////        var threads_odl_default = { '8': [0, undefined, undefined, undefined, undefined], // disable 'on demand mode' at indexing of 1,2,3\r\n//        var threads_odl_default = { '8': [0, 0, 0, 0, 0],\r\n//                                   '19': [0,0,0]};\r\n//        function get_threads_odl_default(str){\r\n//          var page = parseInt(str.substr(str.lastIndexOf('/')+2),10);\r\n//          return (page===0)? {'8': [undefined, undefined, undefined, undefined, undefined], __proto__: threads_odl_default} : // force to top\r\n//                             {'8': [-page, -page, -page, -page, -page], __proto__: threads_odl_default};  // force to last\r\n//        }\r\n//        var start,end;\r\n//        var kwd_odl = ':DL:';\r\n//        var check_funcs = {\r\n//          reply_to_me: function(tgt_th){return (tgt_th[19][0]&0x000c0000) && (tgt_th[19][1]>>16)!=0;},\r\n//          reply: function(tgt_th){return (tgt_th[19][0]&0x000c0000) && tgt_th[19][1]!=0;},\r\n//          watch_first: function(tgt_th){return tgt_th[19][0]&0x000c0000;},\r\n//          watch_last: function(tgt_th){return !(tgt_th[19][0]&0x000c0000);},\r\n//          sticky_first: function(tgt_th){return tgt_th[20];},\r\n//          sticky_last: function(tgt_th){return !tgt_th[20];},\r\n//        }\r\n//        function get_tgt_th(str){\r\n//          return (str.indexOf(kwd_odl)===0)? (threads_odl[str] || get_threads_odl_default(str)) :\r\n//                                             threads[str];\r\n//        }\r\n//        function check_sub(myself, check_func){\r\n//          var ref = start;\r\n//          while (ref<end && check_func(get_tgt_th(threads_idx[ref]))) ref++;\r\n//          if (check_func(myself)) end = ref;\r\n//          else start = ref;\r\n//        }\r\n//        var funcs_get_date = {\r\n//          0: function(tgt_th8){return tgt_th8[0] || tgt_th8[4];},\r\n//          4: function(tgt_th8){return tgt_th8[4] || tgt_th8[0];},\r\n//          get 5(){var now = Date.now(); return function(tgt_th8){return (now - tgt_th8[1])/tgt_th8[2];}},\r\n//          1: function(tgt_th8){return tgt_th8[1];},\r\n//          2: function(tgt_th8){return tgt_th8[2];},\r\n//          3: function(tgt_th8){return tgt_th8[3];},\r\n//        }\r\n//        function insert(name){\r\n//          start = 0;\r\n//          end = threads_idx.length;\r\n//          var pf = pref.catalog.order;\r\n//          var myself = get_tgt_th(name);\r\n//          if (pf.sticky!=='dont_care') check_sub(myself, (pf.sticky==='last')? check_funcs.sticky_last : check_funcs.sticky_first);\r\n//          if (pf.reply_to_me) check_sub(myself, check_funcs.reply_to_me);\r\n//          if (pf.reply) check_sub(myself, check_funcs.reply);\r\n//          if (pf.watch!=='dont_care') check_sub(myself, (pf.watch==='last')? check_funcs.watch_last : check_funcs.watch_first);\r\n//          var get_date = funcs_get_date[pref.catalog.indexing%6];\r\n////          var indexing  = pref.catalog.indexing%6;\r\n////          var indexing2 = pref.catalog.indexing;\r\n////          var get_date = (indexing===0 || indexing===4)? function(tgt_th){return tgt_th[8][indexing] || tgt_th[8][(indexing===0)?4:0];} :\r\n////                         (indexing===5)?                 (function(){var now = Date.now(); return function(tgt_th){return (now - tgt_th[8][1])/tgt_th[8][2];}})() :\r\n////                                                         function(tgt_th){return tgt_th[8][indexing];};\r\n//          var date = get_date(myself[8]);\r\n//          var check_func = (pref.catalog.indexing>=5 && pref.catalog.indexing<11)? function(tgt_th){return date>=get_date(tgt_th[8]);} :\r\n//                                                                                   function(tgt_th){return date<=get_date(tgt_th[8]);};\r\n//          var ref = start;\r\n//          while (ref<end && check_func(get_tgt_th(threads_idx[ref]))) ref++;\r\n//  \r\n//          if (ref==threads_idx.length) threads_idx[threads_idx.length] = name;\r\n//          else threads_idx.splice(ref,0,name);\r\n//  //        if (ref<=drawn_idx) drawn_idx = 0; // can't track by 'drawn_idx = ref; drawn_y = 0;'. drawn_xxx must be synchronized.\r\n//          return ref;\r\n//        }\r\n//        function raise_odl(th){\r\n//          var i = threads_idx.indexOf(th.key);\r\n//          if (i!=-1) {\r\n//            var kwd_odldb = ':DL:'+ th.domain + th.board;\r\n//            while (++i<threads_idx.length) {\r\n//              if (threads_idx[i].indexOf(kwd_odldb)===0) {\r\n//                threads_odl[threads_idx[i]] = {'8':[ (th.time_posted || th.time_bumped), th.time_created, th.nof_posts, th.nof_files, (th.time_bumped || th.time_posted) ],\r\n//                                               __proto__:threads_odl_default};\r\n//                insert(threads_idx.splice(i,1)[0]);\r\n//                break;\r\n//          }}}\r\n//        }\r\n//        function delete_odl(keys){\r\n//          for (var i=0;i<keys.length;i++) delete threads_odl[kwd_odl+keys[i]];\r\n//        } \r\n//        function insert_odl(name){\r\n//          delete threads_odl[kwd_odl+name];\r\n//          reorder(kwd_odl+name);\r\n//        }\r\n//        return {\r\n//          idx_insert: insert,\r\n//          idx_raise_odl: raise_odl,\r\n//          idx_delete_odl: delete_odl,\r\n//          idx_insert_odl: insert_odl,\r\n////          clear: clear, // NEED TO BE IMPLEMENTED to clear 'threads_odl' to prevent memory from leaking.\r\n//          idx_reorder: reorder,\r\n//          idx_re_sort: re_sort,\r\n//        }\r\n//      })();\r\n////////      function insert_thread_idx(name){ // working code.\r\n////////        var indexing = pref.catalog.indexing;\r\n////////        var ref=0;\r\n////////        var end = threads_idx.length;\r\n////////        var dbt = common_func.fullname2dbt(name);\r\n////////        var kwd_odl   = ':DL:';\r\n////////        var kwd_odldb = kwd_odl+dbt[0]+dbt[1];\r\n////////        var check_func;\r\n////////        function skip_odl_th(ref){\r\n////////          var str = threads_idx[ref];\r\n////////          if (str.indexOf(kwd_odl)===0) return str.indexOf(kwd_odldb)!==0;\r\n////////          else return check_func(threads[str]);\r\n////////        }\r\n//////////console.log(name+', S: '+threads[name][19][1]+'/'+(threads[name][8][2]-threads[name][19][2])+', '+threads[name][8][2]+', '+threads[name][8][3]);\r\n////////        if (pref.catalog.order.reply_to_me) {\r\n////////          check_func = function(tgt_th){return tgt_th[19][0]!==0 && tgt_th[19][1]!=0;};\r\n////////          while (ref<end && skip_odl_th(ref)) ref++;\r\n////////          if (threads[name][19][0]!==0 && threads[name][19][1]!=0) {end=ref;ref=0;}\r\n//////////console.log(name+', M: '+ref+'/'+end+', '+threads[name][19][1]);\r\n////////        }\r\n////////        if (pref.catalog.order.reply) {\r\n////////          var ref2 = ref;\r\n//////////          while (ref2<end && threads_idx[ref2].substr(0,4)!==':DL:' && threads[threads_idx[ref2]][19][2]!=threads[threads_idx[ref2]][8][2]) ref2++;\r\n//////////          while (ref2<end && threads_idx[ref2].substr(0,4)!==':DL:' && threads[threads_idx[ref2]][19][2]!=0 && threads[threads_idx[ref2]][19][2]!=threads[threads_idx[ref2]][8][2]) ref2++;\r\n//////////          if (threads[name][19][2]!=0 && threads[name][19][2]!=threads[name][8][2]) end = ref2;\r\n////////          check_func = function(tgt_th){return tgt_th[19][0]!==0 && tgt_th[19][2]>0;};\r\n////////          while (ref2<end && skip_odl_th(ref2)) ref2++;\r\n////////          if (threads[name][19][0]!==0 && threads[name][19][2]>0) end = ref2;\r\n////////          else ref = ref2;\r\n//////////console.log(name+', N: '+ref+'/'+end+', '+(threads[name][8][2]-threads[name][19][2]));\r\n////////        }\r\n//////////        if (pref.catalog.order.watch) { // working code.\r\n//////////          var ref2 = ref;\r\n//////////          while (ref2<end && threads_idx[ref2].substr(0,4)!==':DL:' && threads[threads_idx[ref2]][19][0]!==0) ref2++;\r\n//////////          if (threads[name][19][0]!==0) end = ref2;\r\n////////////          while (ref2<end && threads_idx[ref2].substr(0,4)!==':DL:' && threads[threads_idx[ref2]][19][2]!=0) ref2++;\r\n////////////          if (threads[name][19][2]!=0) end = ref2;\r\n//////////          else ref = ref2;\r\n////////////console.log(name+', R: '+ref+'/'+end);\r\n//////////        }\r\n////////        if (pref.catalog.order.watch!=='dont_care') { // working code.\r\n////////          var polarity = (pref.catalog.order.watch==='last');\r\n////////          var ref2 = ref;\r\n////////          check_func = function(tgt_th){return polarity ^ tgt_th[19][0]!==0;};\r\n////////          while (ref2<end && skip_odl_th(ref2)) ref2++;\r\n////////          if (polarity ^ threads[name][19][0]!==0) end = ref2;\r\n////////          else ref = ref2;\r\n//////////console.log(name+', R: '+ref+'/'+end);\r\n////////        }\r\n////////        if (pref.catalog.order.sticky!=='dont_care') {\r\n////////          var polarity = (pref.catalog.order.sticky==='last');\r\n////////          var ref2 = ref;\r\n////////          check_func = function(tgt_th){return polarity ^ tgt_th[20];};\r\n////////          while (ref2<end && skip_odl_th(ref2)) ref2++;\r\n////////          if (polarity ^ threads[name][20]) end = ref2;\r\n////////          else ref = ref2;\r\n//////////console.log(name+', T: '+ref+'/'+end);\r\n////////        }\r\n////////        var date = threads[name][8][indexing] || threads[name][8][(indexing===0)?4:0];\r\n////////        check_func = function(tgt_th){return date<=(tgt_th[8][indexing] || tgt_th[8][(indexing===0)?4:0]);};\r\n////////        while (ref<end && skip_odl_th(ref)) ref++;\r\n////////        if (ref==threads_idx.length) threads_idx[threads_idx.length] = name;\r\n////////        else threads_idx.splice(ref,0,name);\r\n//////////console.log(name+', F: '+ref+'/'+end+', '+threads_idx.length);\r\n//////////        if (ref<=drawn_idx) drawn_idx = 0; // can't track by 'drawn_idx = ref; drawn_y = 0;'. drawn_xxx must be synchronized.\r\n////////        return ref;\r\n////////      }\r\n\r\n      function expand_shrink_thread(name){\r\n        if (threads[name][0].style.width=='') {\r\n          if (pref.catalog_expand_with_hr && embed_mode!=='catalog') show_catalog_hr(name,'shrink');\r\n          threads[name][0].style.width = pref.float.format.fc.width + 'px';\r\n          threads[name][0].style.height = pref.float.format.fc.height + 'px';\r\n        } else {\r\n          threads[name][0].style.width = '';\r\n          threads[name][0].style.height = '';\r\n          if (pref.catalog_expand_with_hr && embed_mode!=='catalog') show_catalog_hr(name,'add');\r\n        }\r\n      }\r\n\r\n      var DIH = (function(){ // Dynamic Image Handler\r\n        var hover_ex = null;\r\n        var hover_pf = null;\r\n        var hover_ex_mousemoved = false;\r\n        var image_expanding = [];\r\n        function hover_prep(tn, src, prefetch, e){\r\n          var img_ex = clone_img(tn, src, 'hover', null, e);\r\n          if (!img_ex) return;\r\n          img_ex.style.position = 'fixed';\r\n          img_ex.style.top = '0px';\r\n          img_ex.style.right = '0px';\r\n          if (prefetch) img_ex.style.display = 'none';\r\n          else img_ex.style.zIndex = pref[embed_mode].thumbnail.hover.popup_zIndex;\r\n          img_ex.style.pointerEvents = 'none';\r\n  //        if (pref.test_mode['69']) archiver.test_dl(img_ex.src);\r\n          var hover_obj = {pn:img_ex, tn:tn, loaded:false};\r\n          img_ex.draggable = true;\r\n          img_ex.ondragstart = zoom_dragstart;\r\n//          img_ex.ondragend = zoom_dragend;\r\n          img_ex.onclick = zoom_inout;\r\n          img_ex.onmousemove = hover_ex_mousemove;\r\n          var pf = pref[embed_mode].thumbnail.hover;\r\n          if (pf.zoom_dblC) img_ex.ondblclick = image_hover_remove;\r\n          if (pf.zoom_mW) img_ex['on'+brwsr.mousewheel] = cnst.div_scroll;\r\n          img_ex.onload = hover_onload.bind(hover_obj); // for racing of onload\r\n          img_ex.onerror = httpd.pause_cancel;\r\n          httpd.pause_req();\r\n          site.script_body.appendChild(img_ex);\r\n          return hover_obj;\r\n        }\r\n        function hover_ex_mousemove(e){\r\n          if (e.movementX!==0 || e.movementY!==0) hover_ex_mousemoved = true; // e.movement* for zoom-in which generates mousemove event always.\r\n        }\r\n        function hover_onload(e){\r\n          httpd.pause_cancel();\r\n          if (hover_ex && e.target===hover_ex.pn) format_hover_ex();\r\n          else this.loaded = true;\r\n        }\r\n//        function get_mode(e){\r\n//          return e.currentTarget===site.popup_body? 'page' : embed_mode;\r\n//        }\r\n        function image_hover_add(e,src){\r\nif (pref.test_mode['163'] && pref[embed_mode].thumbnail.inline.stopHover && site.nickname==='4chan' && e.target.classList.contains('expanded-thumb')) return;\r\n          var tn = e.target; //  : this; // e.currentTarget;\r\n          if (pref[embed_mode].image_hover) {\r\n            if (hover_ex && hover_ex.tn===tn && pref[embed_mode].thumbnail['hover'].zoom_over) return; // reentry from hover_zoom\r\n            var hover_ex_old = hover_ex;\r\n            if (hover_pf && hover_pf.tn===tn) { // snatches the prefetched one\r\n              hover_ex = hover_pf;\r\n              hover_ex.pn.style.display = '';\r\n              hover_ex.pn.style.zIndex = pref[embed_mode].thumbnail.hover.popup_zIndex; // refrects the newest value\r\n              if (hover_ex.loaded) format_hover_ex();\r\n            } else {\r\n              hover_ex = hover_prep(tn, src, null, e);\r\n              if (!hover_ex) return;\r\n              if (hover_pf) hover_pf.pn.remove();;\r\n            }\r\n            e.preventDefault();\r\n            if (hover_ex_old) hover_ex_old.pn.remove(); // placed after show to reduce redraw.\r\n            hover_ex_mousemoved = false;\r\n          }\r\n          if (pref[embed_mode].image_prefetch) {\r\n            var img_next = site2[site.nickname].get_next_image(tn);\r\n            hover_pf = img_next? hover_prep(img_next, null, true) : null;\r\n          } else hover_pf = null;\r\n        }\r\n//        function image_hover_remove_tn(e){\r\n//          hover_tn.removeEventListener('mouseout', image_hover_remove_tn, false);\r\n//          image_hover_remove();\r\n//        }\r\n        function image_hover_remove(e){\r\n          if (e.type!=='dblclick') if (e && hover_ex && (e.target===hover_ex.pn || e.target===hover_ex.tn)) return; // for zoom\r\n          if (hover_ex) hover_ex.pn.remove();\r\n          hover_ex = null;\r\n        }\r\n        function format_hover_ex(){ // must allow multiple entry for expanded image\r\n          var pf = pref[embed_mode].thumbnail['hover'];\r\n          var pn = hover_ex.pn;\r\n          if (zoom_required(pn)) {\r\n            pn.style.cursor = 'zoom-in';\r\n            if (pref[embed_mode].thumbnail['hover'].zoom_over) pn.style.pointerEvents = null;\r\n//            pn.onclick = image_hover_zoom_in;\r\n//            if (pf.zoom_over || pf.zoom_click) pn.onmouseover = zoom_entered;\r\n            var tn = hover_ex.tn;\r\n            tn.style.cursor = 'zoom-in';\r\n            tn.addEventListener('mouseout', hover_ex_tn_out, false);\r\n//            tn.addEventListener('mousemove', tn_mousemove, false);\r\n            tn.addEventListener('click', zoom_start, false);\r\n//            zoom = {x:document.documentElement.clientWidth - img.clientWidth, y:img.clientHeight, state:null};\r\n////            zoom = {x:document.documentElement.clientWidth - parseInt(s.maxWidth,10), y:parseInt(s.maxHeight,10), state:null};\r\n          }\r\n        }\r\n        function zoom_required(img){\r\n          var pf = pref[embed_mode].thumbnail['hover'];\r\n//          if (check && !pf.zoom) return false;\r\n          var s = img.style;\r\n          return pf.limit_width && (img.naturalWidth > parseInt(s.maxWidth,10)) || pf.limit_height && (img.naturalHeight > parseInt(s.maxHeight,10));\r\n        }\r\n        function zoom_start(e){\r\n          if (pref[embed_mode].thumbnail['hover'].zoom_click) {\r\n            zoom_inout({target:hover_ex.pn, clientX:document.documentElement.clientWidth, clientY:0});\r\n            hover_ex.pn.style.pointerEvents = null;\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n          }\r\n//          if (zoom_included(e)) {\r\n//            e.stopPropagation();\r\n//            e.preventDefault();\r\n//            image_hover_zoom_end(e);\r\n////            e.currentTarget.removeEventListener('mouseout', image_hover_remove_tn, false);\r\n//            hover_ex.onmouseout = image_hover_remove;\r\n//            image_hover_zoom_in({target:hover_ex, clientX:e.clientX, clientY:e.clientY});\r\n//            image_hover_draggable(hover_ex);\r\n//          }\r\n        }\r\n//        function zoom_included(e){\r\n//          return e.clientX>zoom.x && e.clientY<zoom.y;\r\n//        }\r\n//        function image_hover_zoom_prep(e){\r\n//          if (zoom_included(e)) {\r\n//            if (!zoom.state) {\r\n//              e.target.style.cursor = 'zoom-in';\r\n//              zoom.state = true;\r\n//            }\r\n//          } else if (zoom.state) {\r\n//            e.target.style.cursor = 'auto';\r\n//            zoom.state = false;\r\n//          }\r\n//        }\r\n        function hover_ex_tn_out(e){\r\n          var tn = e.currentTarget;\r\n          tn.removeEventListener('mouseout', hover_ex_tn_out, false);\r\n//          tn.removeEventListener('mousemove', tn_mousemove, false);\r\n          tn.removeEventListener('click', zoom_start, false);\r\n          tn.style.cursor = null;\r\n        }\r\n//        function zoom_entered(e){\r\n//          hover_ex.pn.onmouseover = null;\r\n////          hover_ex.pn.onmouseout = zoom_left;\r\n//          hover_ex.pn.draggable = true;\r\n//          hover_ex.pn.ondragstart = zoom_dragstart;\r\n//          hover_ex.pn.ondragend = zoom_dragend;\r\n//        }\r\n//        function zoom_left(e){ // recycling hover image here\r\n//          if (e && e.relatedTarget===hover_zoom.tn && pref[embed_mode].thumbnail['hover'].zoom_over) {\r\n//            hover_ex = hover_zoom;\r\n//            if (hover_ex.loaded) format_hover_ex();\r\n//          } else hover_zoom.pn.remove();\r\n//          hover_zoom = null;\r\n//        }\r\n//        function image_hover_draggable(pn){\r\n//          pn.style.pointerEvents = 'auto';\r\n//          pn.draggable = true;\r\n//          pn.ondragstart = cnst.div_dragstart;\r\n//          pn['on'+brwsr.mousewheel] = cnst.div_scroll;\r\n//        }\r\n        function maxWidth(inline_or_hover){\r\n          return document.documentElement.clientWidth  - pref[embed_mode].thumbnail[inline_or_hover].margin_width;\r\n        }\r\n        function maxHeight(inline_or_hover){\r\n          return document.documentElement.clientHeight - pref[embed_mode].thumbnail[inline_or_hover].margin_height;\r\n        }\r\n        function zoom_factor(img){\r\n          var fx = img.naturalWidth/(parseInt(img.style.maxWidth,10) || maxWidth('hover'));\r\n          var fy = img.naturalHeight/(parseInt(img.style.maxHeight,10) || maxHeight('hover'));\r\n          return (fx>fy)? fx : fy;\r\n        }\r\n        function zoom_in_place(e, s, f, force_zero){\r\n          if (!s.top) {\r\n            s = e.target.parentNode.parentNode.style;\r\n            var oT = e.target.offsetTop;\r\n            var oR = e.target.offsetLeft; // e.target.parentNode.parentNode.offsetWidth - e.target.offsetWidth - e.target.offsetLeft; // PATCH\r\n          }\r\n          s.top = (force_zero? 0 : parseInt(s.top,10)*f + ((oT||0)-e.clientY)*(f-1)) + 'px';\r\n          s.right = (force_zero? 0 : parseInt(s.right,10)*f - (document.documentElement.clientWidth - (oR||0) - e.clientX) * (f-1)) + 'px';\r\n        }\r\n        function zoom_inout(e){\r\n          var et = e.target;\r\n          var s = et.style;\r\n          if (s.cursor!=='zoom-in' && s.cursor!=='zoom-out') return;\r\n          var zin = s.cursor==='zoom-in';\r\n          zoom_in_place(e, s, zin? zoom_factor(et) : 1/zoom_factor(et), (hover_ex && hover_ex.pn===et)? !hover_ex_mousemoved : false);\r\n          s.maxWidth  = zin? 'none' : maxWidth('hover')+'px';\r\n          s.maxHeight = zin? 'none' : maxHeight('hover')+'px';\r\n          s.cursor  = zin? 'zoom-out' : 'zoom-in';\r\n        }\r\n        function zoom_dragstart(e){\r\n          gGEH.drag.started(e, null, 'move', true);\r\n        }\r\n//        function zoom_dragend(e, dx, dy){\r\n//          var pn = e.target;\r\n//          pn.style.right = (parseInt(pn.style.right,10) - dx) + 'px';\r\n//          pn.style.top = (parseInt(pn.style.top,10) + dy) + 'px';\r\n//          e.stopPropagation();\r\n//        }\r\n//        var drag_sx, drag_sy;\r\n//        function zoom_dragstart(e){\r\n//          drag_sx = e.screenX;\r\n//          drag_sy = e.screenY;\r\n//          site.script_body.addEventListener('dragover',zoom_dragover,false);\r\n//        }\r\n//        function zoom_dragover(e){ // http://www.html5rocks.com/ja/tutorials/dnd/basics/\r\n//          e.preventDefault();\r\n//          e.dataTransfer.dropEffect = 'move';\r\n//        }\r\n//        function zoom_dragend(e, sx, sy){\r\n//          if (sx===undefined) site.script_body.removeEventListener('dragover',zoom_dragover,false);\r\n//          var pn = e.target;\r\n//          pn.style.right = parseInt(pn.style.right,10) - (sx!==undefined? sx : e.screenX - drag_sx) + 'px';\r\n//          pn.style.top = parseInt(pn.style.top,10) + (sy!==undefined? sy : e.screenY - drag_sy) + 'px';\r\n//          e.stopPropagation();\r\n//        }\r\n        function image_hover_snatch(e, dx, dy){\r\n          if (!hover_ex || !pref[embed_mode].thumbnail.hover.dragfloat || e.target!==hover_ex.tn) return;\r\n//          zoom_dragend(e, sx, sy);\r\n          var obj = cnst.init3({\r\n            func_str:'right:'+(-dx)+'px:top:'+dy+'px:ftb:overflow:hidden:Show'});\r\n//            func_str:'right:'+right+'px:top:'+top+'px:tb:ftb:overflow:auto:Show'}).cn;\r\n          var pn = obj.cn.appendChild(snatch_hover_ex()); // shatch at the last to reduce redraw\r\n          if (pn.tagName==='VIDEO') pn.play(); // continue playing\r\n////          hover_tn.removeEventListener('mouseout', image_hover_remove_tn, false);\r\n//          if (zoom_required(hover_ex)) {\r\n//            hover_ex.style.cursor = 'zoom-in';\r\n//            hover_ex.onclick = image_hover_zoom_in;\r\n//          }\r\n//          return hover_ex;\r\n//        }\r\n//        function image_hover_snatch_end(){\r\n          var pf = pref[cataLog.embed_mode].thumbnail.hover;\r\n          if (pf.df_dblC) obj.cn.ondblclick = cnst.tb_funcs.evfunc_factory(obj, 'exit');\r\n          if (pf.df_mW) obj.pn['on'+brwsr.mousewheel] = cnst.div_scroll;\r\n        }\r\n        function snatch_hover_ex(){\r\n          var pn = hover_ex.pn;\r\n          var s = pn.style;\r\n          s.position = null;\r\n          s.pointerEvents = null;\r\n          s.zIndex = null;\r\n          s.top = null;\r\n          s.right = null;\r\n          pn.onmouseover = null;\r\n          pn.ondblclick = null;\r\n          pn['on'+brwsr.mousewheel] = null;\r\n          pn.ondragstart = null;\r\n//          pn.ondragend = null;\r\n          pn.onmousemove = null;\r\n          hover_ex = null;\r\n          return pn;\r\n        }\r\n\r\n        function clone_img_make_src(img, inline_or_hover, from_initial){\r\n          var name = gGEH.get_key_recursive(img);\r\n          if (!from_initial && pref[embed_mode].env.event_dynamic && inline_or_hover!==undefined &&\r\n            ((inline_or_hover==='inline')? pref[embed_mode].env.expand_thumbnail_inline_native : pref[embed_mode].env.image_hover_native)) return;\r\n  //        &&  common_func.fullname2dbt(name)[0]===site.nickname) return;\r\n          if (!name && pref.test_mode['106'] && pref.test_mode['107']) return img.src; // patch for expand all at initial in 4chan, BUT I DON'T KNOW WHY...\r\n          var tgt_domain_html = (pref.catalog.mimic_base_site)? site.nickname : threads[name][16].domain_html;\r\n  //        var tgt_th16 = threads[name][16];\r\n  ////      var src = ((tgt_th16.type_html==='catalog')? tgt_th16.op_img_src_url : img.parentNode.href) || pn.src;\r\n  //        return ((tgt_th16.type_html==='catalog')? // working code\r\n  //          site2[tgt_th16.domain_html].parse_funcs.catalog_html.img2src && site2[tgt_th16.domain_html].parse_funcs.catalog_html.img2src(img) :\r\n  //          site2[tgt_th16.domain_html].parse_funcs.post_html.img2src(img)) || img.src;\r\n          var mode = site2[tgt_domain_html].general_event_handler[site.whereami].image_hover_check_mode(img);\r\n          if (mode!=='catalog') return site2[tgt_domain_html].parse_funcs.post_html.img2src(img) || img.src; // working code, but cause an error at merging when the base is lost.\r\n  //        if (embed_mode!=='catalog') return site2[tgt_th16.domain_html].parse_funcs.post_html.img2src(img) || img.src; // working code, but cause an error at merging when the base is lost.\r\n          else if (site.nickname==='4chan') {\r\n            var domain = site2['DEFAULT'].popups_posts.href2domain(img.src);\r\n            return domain && site2[domain].parse_funcs[mode+'_html'].img2src(img) || img.src; // domain check for banners\r\n          } else {\r\n            if (!name) return;\r\n            var lth = liveTag.mems.getFromName(name);\r\n            return site2[lth.domain].parse_funcs[lth.th.type_parse].get_op_src(lth.th, img);\r\n          }\r\n        }\r\n        function clone_img(img, src, inline_or_hover, from_odl, e){\r\n          var pn;\r\n          var pfih = pref[embed_mode].thumbnail[inline_or_hover];\r\n  //        pn.src = (embed_mode==='page')? img.parentNode.href : pn.src; // TEMPORARILY!!!\r\n          if (!src) src = clone_img_make_src(img, inline_or_hover, from_odl);\r\n          if (!src) return; // return when native dynamic function works.\r\n          var ext = (src.search(/^blob/)===0)? site2['DEFAULT'].parse_funcs.post_html.img2ext(img) : '';\r\n          if (src.indexOf('data-ext')!=-1) { // PATCH for archive\r\n            ext = src.slice(src.indexOf('data-ext')+10).replace(/\".*/,'');\r\n            src = src.replace(/\".*/,'');\r\n          }\r\n          if (src.substr(-5,5)==='.webm' || ext==='.webm' || img.getAttribute('data-ext')==='.webm') {\r\n            if (pfih.webm || pfih.webm_ctrl && e.ctrlKey) {\r\n              if (hover_ex && hover_ex.pn.src===src) pn = snatch_hover_ex();\r\n              else {\r\n                pn = document.createElement('video');\r\n                pn.controls = true;\r\n                pn.autoplay = !from_odl;\r\n                //  <video controls=\"\" loop=\"\" autoplay=\"\" class=\"expandedWebm\" src=\"xxx.webm\" style=\"max-width: 957px; max-height: 587px;\"></video> // 4chan\r\n              }\r\n              pn.loop  = pfih.webm_loop;\r\n              pn.muted = pfih.webm_mute;\r\n            } else return null;\r\n          } else pn = img.cloneNode();\r\n          pn.src = src;\r\n          pn.style.width = 'auto';\r\n          pn.style.height = 'auto';\r\n          if (pfih.limit_width)  pn.style.maxWidth  = maxWidth(inline_or_hover) + 'px';\r\n          if (pfih.limit_height) pn.style.maxHeight = maxHeight(inline_or_hover) + 'px';\r\n          return pn;\r\n        }\r\n        function expand_thumbnail_inline(e, from_odl){\r\n//          var mode = get_mode(e || {currentTarget:this});\r\n          if (pref[embed_mode].expand_thumbnail_inline && image_expanding.indexOf(this)==-1) {\r\n            var img_ex = clone_img(this, null, 'inline', from_odl);\r\n            if (!img_ex) {expand_thumbnail_on_demand_set(this);return;}\r\n  //          if (!img_ex) return;\r\n            if (img_ex.tagName!=='VIDEO') {\r\n              img_ex.style.display = 'none';\r\n              img_ex.addEventListener('load',expand_thumbnail_inline_load, false);\r\n              this.style.opacity = 0.5;\r\n            }\r\n            this.parentNode.insertBefore(img_ex,this.nextSibling);\r\n  //          this.onclick = null; // can't track event accurately because 'on demand expand' mode adds click event to images which have a native expansion event.\r\n            image_expanding.push(img_ex);\r\n            \r\n            if (e) e.preventDefault();\r\n            if (img_ex.tagName==='VIDEO') {\r\n              expand_thumbnail_inline_load.call(img_ex);\r\n              if (!from_odl) img_ex.play(); // may be diverted from image_hover\r\n            }\r\n          }\r\n        }\r\n        function expand_thumbnail_inline_stopHover(e){\r\n          e.stopPropagation();\r\n        }\r\n        function expand_thumbnail_inline_load(){\r\n          this.previousSibling.style.display = 'none';\r\n          this.style.display = '';\r\n          this.previousSibling.style.opacity = '';\r\n          this.removeEventListener('load',expand_thumbnail_inline_load, false);\r\n          this.onclick = shrink_thumbnail_inline;\r\n          if (pref[embed_mode].thumbnail.inline.stopHover) this.onmouseover = expand_thumbnail_inline_stopHover;\r\n          if (site2[site.nickname].format_expanded_thumbnail) site2[site.nickname].format_expanded_thumbnail(this);\r\n          var idx = image_expanding.indexOf(this);\r\n          if (idx>=0) image_expanding.splice(idx,1);\r\n  \r\n          if (site.patch.expand_thumbnail_inline_load) site.patch.expand_thumbnail_inline_load.call(this);\r\n          expand_thumbnail_on_demand_set(this);\r\n        }\r\n        function expand_thumbnail_on_demand_set(tn){\r\n          if (pref[embed_mode].expand_thumbnail_inline && pref[embed_mode].expand_thumbnail_inline_all_after) {\r\n//          if (pref[embed_mode].expand_thumbnail_inline && (pref[embed_mode].expand_thumbnail_initial || pref[embed_mode].expand_thumbnail_inline_all_after)) {\r\n            var img_next = site2[site.nickname].get_next_image(tn,get_now_height()); // now_height for jump scroll\r\n            if (img_next && img_next.style.display!=='none') expand_thumbnail_on_demand(img_next);\r\n          }\r\n        }\r\n        var image_expand_on_demand_instance = null;\r\n        function expand_thumbnail_on_demand(img){\r\n          var ref_height = pClg.get_ref_height(pref[embed_mode].thumbnail.inline.ref_height/100);\r\n          var offsetTop;\r\n          if (Array.isArray(img)) {\r\n            var tgt;\r\n            var nowHeight = get_now_height();\r\n            for (var i=0;i<img.length;i++) {\r\n              var ot = img[i].offsetTop;\r\n              if (ot>=nowHeight && ot<offsetTop || i===0) {\r\n                tgt = img[i];\r\n                offsetTop = ot;\r\n              }\r\n            }\r\n            img = tgt;\r\n          } else offsetTop = img.offsetTop;\r\n          if (offsetTop<ref_height) { //  || !pref[embed_mode].thumbnail.inline.ondemand) {\r\n            image_expand_on_demand_instance = null;\r\n            expand_thumbnail_inline.call(img, null, true);\r\n          } else image_expand_on_demand_instance = img;\r\n        }\r\n//        function expand_thumbnail_queue_add(img){\r\n//          if (pref.test_mode['130']) {expand_thumbnail_on_demand(img); return;}\r\n//          if (!image_expand_on_demand_instance) image_expand_on_demand_instance = img;\r\n//          else if (Array.isArray(image_expand_on_demand_instance)) image_expand_on_demand_instance[image_expand_on_demand_instance.length] = img;\r\n//          else image_expand_on_demand_instance = [image_expand_on_demand_instance, img];\r\n//          show_catalog_cont(); // patch, delayed 200ms\r\n//        }\r\n        function shrink_thumbnail_inline(e){\r\n  //        this.previousSibling.onclick = expand_thumbnail_inline;\r\n          this.previousSibling.style.display = '';\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          if (pref[embed_mode].thumbnail.inline.ondemandStop) image_expand_on_demand_instance = null;\r\n          \r\n          if (this.getAttribute('data-originalWidth')) {\r\n            var pnode = this.parentNode.parentNode;\r\n            pnode.style.width = this.getAttribute('data-originalWidth');\r\n          }\r\n          this.parentNode.removeChild(this);\r\n        }\r\n        return {\r\n//          get_mode: function(e){return e.currentTarget===site.popup_body? 'page' : embed_mode;},\r\n          image_hover_add: image_hover_add,\r\n          image_hover_remove: image_hover_remove,\r\n          image_hover_reentry: function(img){\r\n//            if (!mode) mode = embed_mode; // TEMPORAL PATCH. all reentry func in GIH must be revised.\r\n            if (hover_ex && hover_ex.pn.src===img.src) hover_ex.pn.src = clone_img_make_src(img);\r\n          },\r\n          image_hover_snatch: image_hover_snatch,\r\n//          image_hover_snatch_end: image_hover_snatch_end,\r\n//          get hover_ex(){return hover_ex && hover_ex.pn;},\r\n          expand_thumbnail_inline: expand_thumbnail_inline,\r\n          expand_thumbnail_on_demand_kick: function(){\r\n            if (image_expand_on_demand_instance) expand_thumbnail_on_demand(image_expand_on_demand_instance);\r\n          },\r\n//          expand_thumbnail_on_demand: expand_thumbnail_on_demand,\r\n////          expand_thumbnail_queue_add: expand_thumbnail_queue_add,\r\n          fetch_and_reentry: function(tgts, img){\r\n            scan.scan_ui('image_hover', {tgts: tgts, options:{callback:function(){cataLog.DIH.image_hover_reentry(img);}, priority:6}});\r\n          },\r\n          expand_thumbnail_clicked_but_ineffective: function(tn){\r\n            if (pref[embed_mode].expand_thumbnail_inline_all_after) {\r\n              if (site.nickname==='4chan' && tn.classList.contains('expanded-thumb')) {\r\n                if (pref[embed_mode].thumbnail.inline.ondemandStop) image_expand_on_demand_instance = null;\r\n              } else expand_thumbnail_on_demand_set(tn);\r\n            }\r\n          },\r\n//          expand_thumbnail_on_demand_set: expand_thumbnail_on_demand_set,\r\n        };\r\n      })();\r\n//      function image_hover_add(e,src){\r\n//        DIH.image_hover_add.call(this,e,src);\r\n//      }\r\n      cataLog.DIH = DIH;\r\n//      cataLog.image_hover_add = image_hover_add;\r\n      cataLog.image_hover_reentry = DIH.image_hover_reentry;\r\n\r\n      cataLog.InfoPv = (function(){\r\n        var pn = document.createElement('div');\r\n        pn.setAttribute('class',pref.script_prefix+'_infoPv');\r\n        pn.style.position = 'absolute';\r\n        function fmt(val, str, check){\r\n          var v = parseInt(val,10);\r\n          return (!check || val!=='00')? (check? ' and ':'') + v + ' ' + str + (v!=1? 's':'') : '';\r\n        }\r\n        function rel_time(rt){\r\n          var strs = Footer.format_relative_time(rt).split(/:|d/);\r\n          var s0 = strs[0].slice(1);\r\n          return (strs[0][0]=='+')? 'Just now' : (strs[0] = strs.slice(1), \r\n            (strs.length===1)? fmt(s0,'second')\r\n            : (strs.length===2)? fmt(s0,'munute') // +fmt(strs[1],'second', true)\r\n            : (strs.length===3)? fmt(s0,'hour')+fmt(strs[1],'minute', true)\r\n            :                    fmt(s0,'day')+fmt(strs[1],'hour', true));\r\n        }\r\n        var shown = false;\r\n        return {\r\n          show: function(e){\r\n            var name = gGEH.get_key_recursive(e.target);\r\n            var rect = e.target.getBoundingClientRect();\r\n            var cW = document.documentElement.clientWidth;\r\n            var left = e.clientX - cW*0.5 <0; \r\n            pn.style.left  = (left)? rect.right + 5 + 'px' : null;\r\n            pn.style.right = (left)? null : cW - rect.left + 5 + 'px';\r\n            pn.style.top = rect.top + window.scrollY + (pref.test_mode['143']? 100 : 0) + 'px';\r\n            var th = liveTag.mems.getFromName(name).th;\r\n            var last_no = th.posts.length>=2 || th.last_no;\r\n            var last_name = th.posts.length>=2 && th.posts[th.posts.length-1].name || th.last_name;\r\n//          show: function(top, left, sub, name_op, time_created, page, name_posted, time_posted){\r\n            var now = Date.now();\r\n            pn.innerHTML = (th.sub? '<span class=\"post-subject\">'+th.sub+'</span>' : 'Posted')+' by <span class=\"post-author\">'+th.name+'</span> <span class=\"post-ago\">'+rel_time(th.time_created - now)+' ago</span><span class=\"post-page\">Page '+gClg.AllThreads[name][14]+'</span>'+(last_no?'<div class=\"post-last\">Last reply by <span class=\"post-author\">'+last_name+'</span> <span class=\"post-ago\">'+rel_time(th.time_posted - now)+' ago</span></div>':'');\r\n            if (!shown) site.script_body.appendChild(pn);\r\n            shown = true;\r\n          },\r\n          hide: function(){\r\n            if (!shown) return;\r\n            site.script_body.removeChild(pn);\r\n            shown = false;\r\n          }\r\n        };\r\n      })();\r\n\r\n//      function get_name_recursive(pn){\r\n//        while (pn && !pn.name) pn = pn.parentNode;\r\n//        return pn && pn.name;\r\n//      }\r\n//      function click_thread_tn(e){ // working code\r\n//        if (pref[embed_mode].click==='none') return;\r\n//        e.preventDefault();\r\n//        if (pref[embed_mode].click_area==='entire') return;\r\n//        click_thread(get_name_recursive(e.target), (e.target.classList.contains(pref.script_prefix+'_link'))? e.target.getAttribute('href') : null);\r\n//      }\r\n//      function click_thread_whole(){\r\n//        if (pref[embed_mode].click_area==='entire') click_thread(this.name);\r\n//      }\r\n      Clg.prototype.click_thread = function(name, url){\r\n        if (url) open_new_thread((url==='force')? null : url, name, this);\r\n        else if (pref[this.mode].click==='open') open_new_thread(null, name, this);\r\n        else if (threads[name][18]!=='catalog' && pref[embed_mode].click==='expand') expand_shrink_thread(name);\r\n      }\r\n      function click_link(e){\r\n        e.preventDefault();\r\n        if (e.target.href) open_new_thread(e.target.href, gGEH.get_key_recursive(e.target));\r\n      }\r\n//      function click_thread(name){\r\n//        if (typeof(name)==='object') name= this.name;\r\n//        var name = this.name;\r\n//        if (pref.click=='expand') expand_shrink_thread(name);\r\n//        else open_new_thread(threads[name][7], name);\r\n//      }\r\n\r\n      function add_open_new_thread_event(name,args){\r\n        for (var i=0;i<args.length;i++) {\r\n          var elem = args[i][0];\r\n          var url  = args[i][1];\r\n          var func = function(){open_new_thread(url, name);if (pref[embed_mode].click==='expand') expand_shrink_thread(name);};\r\n          elem.addEventListener('click', func, false);\r\n          args[i][1] = func;\r\n        }\r\n        return args;\r\n      }\r\n      function remove_open_new_thread_event(args){\r\n        for (var i=0;i<args.length;i++) args[i][0].removeEventListener('click', args[i][1], false);\r\n        return null;\r\n      }\r\n      Clg.prototype.get_mark_time = function(name, extra_format){\r\n        var pf = this.pref.filter;\r\n//        if (watch) {\r\n        var val = pref_func.merge_obj5(name,pf.watch_list_obj2,null);\r\n        if (val && ('time' in val)) return (extra_format)? -val.time : val.time;\r\n//        }\r\n//        if (list) {\r\n        val = pref_func.merge_obj5(name,pf.list_obj2,null);\r\n        if (val) return val.time || 0; \r\n//          date_mark = pref_func.merge_obj5(name,pref.filter.list_obj2,{hit:false});\r\n//          if ('time' in date_mark) return date_mark.time;\r\n//          else if (date_mark.hit) return 0;\r\n//        }\r\n        if ((pf.time_watch || pf.time_watch_creation) && pf.time_str!=='') return Date.parse(pf.time_str);\r\n        else return 0;\r\n      };\r\n      function open_new_thread(url, name, clg){\r\n        if (!clg) clg = pClg;\r\n        var threads = clg.threads;\r\n        var dbt = common_func.fullname2dbt(name);\r\n        if (threads[name][16].archiveFile) url = site2[(pref.archive.open_local)? site.nickname : dbt[0]].make_url4([site.nickname, site.board, '0','page_html'])[0];\r\n//        if (threads[name][16].archiveFile) url = site2[dbt[0]].make_url4(common_func.name2dbt(name).slice(0,2).concat(['0','page_html']))[0];\r\n        else {\r\n          if (url===null) {\r\n            url = site2[dbt[0]].make_url4(common_func.name2dbt(name))[0]; // temporal\r\n            if (pref.catalog_open_last50!=='no') {\r\n              var short_link = document.createElement('div');\r\n              short_link.innerHTML = site2[dbt[0]].short_link(name, threads[name][8][2], null, '', '');\r\n              var as = short_link.getElementsByTagName('a');\r\n              for (var i=0;i<as.length;i++) {\r\n                if (pref.catalog_open_last50==='exist' || !(threads[name][19][0]&0x000c0000) || (parseInt(as[i].textContent,10)>(threads[name][19][1]&0x0000ffff))) {\r\n                  url = as[i].getAttribute('href');\r\n                  break;\r\n          }}}}\r\n        }\r\n//////////        if (url===null) url = site2[threads[name][16].dbt[0]].make_url3(threads[name][16].dbt[1], threads[name][16].dbt[2], '0'); // temporal // working code.\r\n////////        if (url===null) url = site2[threads[name][16].dbt[0]].make_url4(common_func.name2dbt(name))[0]; // temporal\r\n////////        if (typeof(url)==='string') url = [url];\r\n////////        var idx = 0;\r\n////////        var unread50 = (threads[name][19][0]!==0 && threads[name][19][2]<=50);\r\n////////        if      (pref.catalog_open_last50==='no')    idx = 0;\r\n////////        else if (pref.catalog_open_last50==='exist') idx = url.length-1;\r\n////////        else if (pref.catalog_open_last50==='exist_watch') idx = (unread50)? url.length-1 : 0;\r\n////////        else {\r\n////////          var dbt = common_func.fullname2dbt(name); // patch\r\n////////if (dbt[0]==='8chan' || dbt[0]==='lain') { // patch.\r\n////////          if (url.length==1 && threads[name][8][2]>100) url[1] = url[0].replace(/.html/,'+50.html');\r\n////////          if (pref.catalog_open_last50==='speculative') idx = (threads[name][8][2]>100)? url.length-1 : 0;\r\n////////          else if (pref.catalog_open_last50==='spec_watch') idx = (unread50)? url.length-1 : 0;\r\n////////}\r\n////////        }\r\n////////        url = url[idx];\r\n\r\n//console.log(url);\r\n//        var cw = window.open(url,(pref.catalog_open_in_new_tab)? '_blank' : '_self');\r\n        var window_name = (site.embed_frame_win)? site.embed_frame\r\n                        : (pref.catalog_open_where==='named')? name + ((threads[name][16].archiveFile)? 'A' : '')\r\n                        : (pref.catalog_open_where==='_blank')? name + '_' + Date.now() : pref.catalog_open_where;\r\n//                        : (pref.catalog_open_in_new_tab)? ((pref.catalog_use_named_window)? name : '_blank') : '_self';\r\n\r\n        var names = pref['thread'].merge_auto_list? clg.merge_bases.query_merged_keys(name) : [name];\r\n        var time_marked = (pref[embed_mode].mark_new_posts)? names.map(function(name){return clg.get_watch_time_of_a_thread(name,threads[name][8][1], null, true);}).reduce(function(a,c){return c>a? c : a;}) : 0;\r\n//        var time_marked = (pref[embed_mode].mark_new_posts)? clg.get_watch_time_of_a_thread(name,threads[name][8][1], null, true) : 0; // working code.\r\n//        if (time_marked && pref['thread'].merge_auto_list) {\r\n//          var merged_others = clg.merge_bases.query_others(name);\r\n//          if (merged_others) for (var i=0;i<merged_others.length;i++) {\r\n//            var time_marked_tmp = clg.get_watch_time_of_a_thread(merged_others[i],threads[merged_others[i]][8][1], null, true);\r\n//            if (time_marked_tmp && time_marked<time_marked_tmp) time_marked = time_marked_tmp;\r\n//          }\r\n//        }\r\n        var message = ['MARK',time_marked];\r\n        if (!site2[site.nickname].historyAPI || !site2[dbt[0]].historyAPI || !pref.pref2.meguca.historyAPI) {\r\n          var cw = window.open(url,window_name);\r\n          send_message(window_name, message,cw);\r\n          if (pref.uip_tracker.on) {\r\n            var lth = liveTag.mems.getFromName(name);\r\n            if (pref.uip_tracker.sage.annotate) {\r\n              if (pref.uip_tracker.sage.annotate_page && lth.pgh) send_message(window_name, ['UIP', ['page',JSON.stringify(lth.pgh)]]);\r\n              if (lth.sg && lth.sg.size) send_message(window_name, ['UIP', ['sage'].concat(Array.from(lth.sg))]);\r\n            }\r\n            if (pref.uip_tracker.annotate) if (lth.sID && lth.sID.h) send_message(window_name, ['UIP',lth.sID.h]);\r\n          }\r\n          if (threads[name][16].archiveFile) {\r\n            var file = threads[name][16].archiveFile;\r\n            send_message(window_name, ['ARCHIVER',['SUB_INIT',(file==='IDB')? {IDB:true, domain:dbt[0], board:(pref.test_mode['80'])? dbt[1].slice(0,-5)+'/' : dbt[1], no:dbt[2]} : // cut '_IDB'\r\n                                                                              {name:file.name, size:file.size, lastModified:file.lastModified, files_sel:pref.archive.files_sel} ]]);\r\n          }\r\n        } else {\r\n          if (site2[site.nickname].historyAPI_blocking) return; // patch for meguca, killing click, but this is dangerous.\r\n          send_message_emu.push(message);\r\n        }\r\n        if (pref.catalog.auto_watch) {\r\n          if (!pref.catalog.auto_watch_override) clg.triage_event(name,'WATCH',''); // ,true);\r\n          else {\r\n            var triages = pref.catalog.auto_watch_override_str.split(',');\r\n            while (triages.length>0) {\r\n              if (triages[0]) clg.triage_event(name,triages[0], triages[2]||''); // , triages.length<4);\r\n              triages.splice(0,3);\r\n            }\r\n          }\r\n        }\r\n      }\r\n      Clg.prototype.mark_read_thread = function(name,time, track){\r\n        var lth = liveTag.mems.getFromName(name);\r\n        if (time!==null) site2['DEFAULT'].check_reply.set_watched_to_last(lth.wt, time, name, track);\r\n        else site2['DEFAULT'].check_reply.set_unwatch(lth.wt);\r\n        liveTag.dirtify_ur(lth);\r\n        if (pref.liveTag.style.use) liveTag.update_ur(lth,0,true);\r\n//        site2[cnst.name2domainboardthread(name,true)[0]].insert_footer2(threads[name][0],threads[name][18],threads[name][19],threads[name][8]);\r\n        this.footer.update_force(name, this.pref[this.mode].footer.flag);\r\n//        gClg.footer.update_force(name, gClg.Clgs.length==1? pref.catalog.footer.flag : true);\r\n//        if (reorder_thread_idx(name)) show_catalog(name); // called in triage_exe\r\n        if (pref.notify.favicon) notifier.favicon.set(threads);\r\n      };\r\n\r\n//      var show_catalog_init_funcs;\r\n//    Clg.prototype.show_catalog_scroll_lock_factory = function(clg){\r\n//        var marks = null;\r\n////        var set = Watchdog.prototype.restart.bind(new Watchdog(scroll_back, 5));\r\n//        var wdg  = new Watchdog(scroll_back, 5);\r\n//        var wdg2 = new Watchdog(tgt_lock_cancel, 100); // 500ms scroll lock and watchdog for oscillation.\r\n//        var set = Watchdog.prototype.restart.bind(wdg);\r\n////        var last_viewed = null;\r\n//        function tgt_lock_cancel(){\r\n//          wdg.cancel();\r\n//          marks = null;\r\n//        }\r\n//        function scroll_back(){\r\n//          var mark_top = marks[0].offsetTop || 0;\r\n//          var abs_top = mark_top - marks[1] + marks[2];\r\n//          if (abs_top<0) abs_top = 0;\r\n//          if (!mark_top || clg.get_now_height()===abs_top) { // may cause oscillation\r\n////            marks = null;\r\n////             wdg2.stop(); // scroll lock\r\n//            return;\r\n//          }\r\n//          window.scrollTo(0, abs_top);\r\n//          set();\r\n//        }\r\n//        var last_viewed = null;\r\n//        function start(pn){\r\n//          if (marks===null || pn) {\r\n////            if (marks && pn) scroll_back();\r\n//            if (!pn) {\r\n//              pn = (wdg2.id)? last_viewed : // scroll locked\r\n//                              clg.GEH.get_last_viewed() || last_viewed; // return null when initial or deleted\r\n//              if (!pn) return;\r\n//            }\r\n//            marks = [pn, pn.offsetTop, clg.get_now_height()];\r\n//            last_viewed = pn;\r\n//////            if (last_viewed) { // working code.\r\n//////              marks = [last_viewed, last_viewed.offsetTop, get_now_height()];\r\n//////              set();\r\n//////            }\r\n////            var now_height = get_now_height();\r\n////            var last_top; // working code.\r\n////            if (last_viewed) last_top = last_viewed.offsetTop;\r\n////            if (last_viewed && last_top >= now_height && last_top <= now_height + window.innerHeight) marks = [last_viewed, last_top, now_height];\r\n////            else { // scrolled\r\n////              var posts = (embed_mode==='thread')? site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'thread_html', {thread:site.no})[0].posts :\r\n////                                                   site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'page_html', {page:0})[0].posts;\r\n////              var step = posts.length >> 1;\r\n////              var i = 0;\r\n////              while (step>0) {\r\n////                if (posts[i+step].pn.offsetTop<now_height) i += step;\r\n////                step >>= 1;\r\n////              }\r\n////              while (i<posts.length-1 && posts[i].pn.offsetTop<now_height) i++;\r\n////              marks = [posts[i].pn, posts[i].pn.offsetTop, now_height];\r\n////            }\r\n//          }\r\n//          wdg2.restart();\r\n//          set();\r\n//        }\r\n//        return {\r\n//          modified: function(tgt){\r\n////            start((tgt.pn && marks[0]===tgt.pn)? site2[site.nickname].general_event_handler[site.whereami].get_prev_mark(tgt.pn) : null); // fail if get_prev_mark returns undefined;\r\n//            if (tgt.pn && marks && marks[0]===tgt.pn) {\r\n//              scroll_back();\r\n//              marks = null; // get_prev_mark may return undefined\r\n////              start(site2[site.nickname].general_event_handler[site.whereami].get_prev_mark(tgt.pn));\r\n//              start(site2[site.nickname].general_event_handler[site.whereami].get_mark_from_height(tgt.pn.offsetTop));\r\n//              this.GEH.clear_last_viewed();\r\n//            } else start();\r\n//          },\r\n//          set: start,\r\n////          viewed: function(tgt){if (!marks) last_viewed = tgt;},\r\n////          viewed: function(tgt){\r\n////            if (!wdg2.id)\r\n////              last_viewed = tgt;}, // scroll lock\r\n//        }\r\n//      };\r\n//      cataLog.show_catalog_scroll_lock = show_catalog_scroll_lock;\r\n//      var drawn_idx = 0;\r\n//      var show_catalog_cont = new DelayBuffer(show_catalog_delayed, 200).get_bound_func(); // working code\r\n//      cataLog.show_catalog_cont = show_catalog_cont;\r\n//      function show_catalog_delayed(){\r\n//        ref_heights = null;\r\n//        if (pClg.drawn_idx!==true) show_catalog();\r\n//        else if (cataLog.catalog_obj2.lazy_draw) cataLog.catalog_obj2.lazy_draw();\r\n//        cataLog.DIH.expand_thumbnail_on_demand();\r\n//      }\r\n//      var ref_heights = null;\r\n//      function get_ref_height(threshold){\r\n//        if (!threshold) threshold = 1.5;\r\n////        return (embed_embed)? brwsr.document_body.scrollTop + window.innerHeight * threshold // slow.\r\n////                            : triage_parent.scrollTop + triage_parent.clientHeight * threshold;\r\n//        if (!ref_heights) ref_heights = {scrollTop: (scroll_event_src===window)? brwsr.document_body.scrollTop : scroll_event_src.scrollTop,\r\n//                                         innerHeight: (scroll_event_src===window)? window.innerHeight : scroll_event_src.clientHeight}; // BUG, NEED TO ADD EVENTLISTENER TO TRIAGE_PARENT.'resize'.\r\n//        return ref_heights.scrollTop + ref_heights.innerHeight * threshold;\r\n//      }\r\n//      cataLog.get_ref_height = get_ref_height;\r\n      function get_now_height(){\r\n        return (embed_embed)? brwsr.document_body.scrollTop : triage_parent.scrollTop;\r\n      }\r\n      function scopy_th(th){\r\n         var dst = {posts:[], __proto__:th};\r\n         for (var i=0;i<th.posts.length;i++) dst.posts[i] = {__proto__:th.posts[i]};\r\n         return dst;\r\n      }\r\nvar debug_str2;\r\n//      function show_catalog(tgts_in,sound){\r\n    var catalog_obj2_proto = {\r\n      rolledup: 0,\r\n      show_catalog: function(tgts_in, force_all_named, may_bump_down){ // , force_all_footer){\r\n        var drawn_idx_old = this.drawn_idx;\r\nvar debug_count = 0;\r\n        if (this.dirty) {\r\n          if (this.dirty&0x06) {\r\n            var retvals_idx = this.idx_rm_reorder_exe(); // (this.dirty&0x02)? this.idx_rm_reorder_exe() : this.idx_remove_exe();\r\n            if (retvals_idx[0]<this.drawn_idx) this.func_track_reset();\r\n            var tgts_from_idx = retvals_idx[1];\r\n            var created_from_idx = this.dirty&0x10? null : retvals_idx[2] && Object.keys(retvals_idx[2]);\r\n//            var created_from_idx = this.dirty&0x10? null : (cr_keys_from_idx = Object.keys(retvals_idx[2])).length==0? true : pref.test_mode['184']? cr_keys_from_idx : retvals_idx[2];\r\n          }\r\n          if (this.dirty&0x01) {\r\n            this.footer.clean_idx = 0; // footer.draw checks footer.timestamp, I don't have to check them here.\r\n//            this.footer.clean_idx = this.footer.seek_clean_idx(this.drawn_idx);\r\n//            if (this.drawn_idx<this.footer.clean_idx) this.func_track_reset();\r\n          }\r\n          this.dirty &= ~0x0f; // 0x10 is kept as a flag for a case of being rolled up.\r\n//          if (this.dirty&0x04) if (this.drawn_idx>this.idx_remove_exe()) this.func_track_reset();\r\n//          if (this.dirty&0x02) if (this.drawn_idx>this.idx_reorder_exe()) this.func_track_reset();\r\n        }\r\n        if (this.rolledup) {this.rolledup = 2; return;}\r\n//        force_all_named |= this.force_all_named;\r\n        if (tgts_in===0 || tgts_in===-1) {var hide_tails = tgts_in===-1; this.drawn_idx = 0; tgts_in=undefined;}\r\n//        if (this.masked) {this.updated_but_masked = true; return;} // test patch for meguca.\r\nif (pref.debug_mode['11']) {\r\n  var debug_str = threads_idx_debug(this.drawn_idx, this.drawn_y, this.ref_count, this.idxs);\r\n}\r\nif (pref.test_mode['23']) this.drawn_idx = 0;\r\n        var draw_on_demand = pref[embed_mode].draw_on_demand && this.permit_draw_on_demand;\r\n        if (draw_on_demand) {\r\n          var ref_height = this.get_ref_height((pref[cataLog.embed_mode].merge)? 4 : (this.disp_th20)? 0.2 : (this.disp_th100)? 1 : 1.5);\r\n          if (this.drawn_idx!==0 && this.drawn_y>=ref_height)\r\n            if (this.ppn.offsetTop + this.ppn.offsetHeight<this.drawn_y) this.drawn_y = -1; // for expanding posts or images. // (this.ppn.offsetHeight||this.ppn.getBoundingClientRect().height) is required to scale <small> in 2ch.\r\n//            if (this.ppn.offsetHeight<this.drawn_y) this.drawn_idx = 0; // for expanding posts or images.\r\n            else if (tgts_in===undefined && created_from_idx===undefined) return true;\r\n//            else if (tgts_in===undefined) return true;\r\n//          if (drawn_idx!==0 && this.drawn_y>=ref_height) return;\r\n        }\r\n        var draw_adaptive = draw_on_demand && pref.network.adaptive;\r\n        var draw_count = 0;\r\n        if (pref[embed_mode].scroll_lock) this.show_catalog_scroll_lock.set();\r\n//        if (common_obj.thread_reader && common_obj.thread_reader.observer_IDinfo) common_obj.thread_reader.observer_IDinfo.disconnect();\r\n        if (this.observer_myself) this.observer_myself.disconnect(); \r\n        var tgts;\r\n        if (typeof(tgts_in)==='string') {\r\n          tgts = tgts_from_idx || {};\r\n          tgts[tgts_in] = null;\r\n//        } else if (Array.isArray(tgts_in)) {\r\n//          tgts = {};\r\n//          for (var i=0;i<tgts_in.length;i++) tgts[tgts_in[i]] = null;\r\n        } else {\r\n          tgts = tgts_from_idx || tgts_in;\r\n          if (tgts_in && tgts_from_idx) for (var i in tgts_in) tgts[i] = tgts_in[i];\r\n        }\r\n        var tgts_count = (tgts)? Object.keys(tgts).length : -1; // may be called with tgts==={} (vacant object; tgts_count===0 from initial), see scan_boards_keyword_callback2\r\n//        if (embed_catalog) {show_catalog_native();return;}\r\n//        if (tgts) for (var name in tgts) if (threads[name] && threads[name][0].parentNode) threads[name][0].parentNode.removeChild(threads[name][0]); // this is required when the thread is moved to later. // THIS CAUSES A BLINK.\r\n////////        catalog_triage_out();\r\n//        var triage_thread = triage.get_triaged_thread_name();\r\n//        pref_func.tooltips.hide();\r\n        var catalog_expand_with_hr = (embed_mode==='float' && pref.catalog_expand_with_hr) || pref[embed_mode].env.disp_filler;\r\n        if (tgts!==undefined) for (var i=0;i<this.drawn_idx;i++) if (this.idxs[i] in tgts) {this.drawn_idx = i; this.drawn_y = -1; break;}\r\n        this.ref_count_init = pref[embed_mode].env.disp_offset;\r\n        if (catalog_expand_with_hr) this.ref_count_init = show_catalog_skip_hs(this.ref_count_init);\r\n        var mode_merge = this.func_lazy_draw;\r\n        var mode_merge_tails = (mode_merge && this.pref[this.mode].merge_list && !this.pref[this.mode].merge)? null : false;\r\n        var merge_tails = mode_merge_tails===null && (!pref.test_mode['183'] || (this.dirty&0x10) /*|| tgts_count>=0*/ || may_bump_down);\r\n        var try_all = tgts===undefined || !draw_on_demand || !pref.test_mode['132'] && (!pref.test_mode['151'] || tgts_count!==1); // test_mode['132'] causes problem at merge mode, see func_track_shown // test_mode['151'] doesn't work if redraw request comes from 'MERGE' triage.\r\n        if (tgts!==undefined && try_all || this.drawn_idx===0 || this.drawn_idx===true) {\r\n          this.func_track_reset(); // called with drawn_idx===true from 'release_draw'.\r\n          if (mode_merge) try_all = true; // tracking info about merge was cleared by func_track_reset\r\n//          cataLog.Footer.timestamp_trial_prep();\r\n        }\r\n        var shown_count = 0;\r\n        var load_tgt = '';\r\n//        this.drawn_idx_mb = -1;\r\n//        var appeared = [];\r\n//var debug = '';\r\n//for (var d=0;d<threads_idx.length;d++) if (threads_idx[d]!=='ODL:' && threads[threads_idx[d]][9][0]) debug += threads_idx[d] + ', ';\r\n//console.log(debug);\r\n        var i_start = this.drawn_idx;\r\n        var lazy_step = this.view==='catalog'? pref.proto.lazyDraw.step : pref.proto.lazyDraw.merge_step; // pref[cataLog.embed_mode].lazyDraw.step;\r\n        var lazy_next = Math.floor(ref_height*this.lazy_avgSizeInv) + lazy_step;\r\n//        var lazy_check = lazy_step <= i_start;\r\n        var footer_clean_idx = this.footer.clean_idx;\r\n//        var i_start = (draw_on_demand && drawn_idx!==true)? drawn_idx : 0;\r\n//        var retval = false;\r\n        var i=-1;\r\n        while (++i<this.idxs.length) {\r\n//console.log(this.drawn_y+', '+triage_parent.scrollTop+', '+triage_parent.clientHeight*1.5+', '+ref_height);\r\n          var name = this.idxs[i];\r\n          var tgt_th = this.threads[name];\r\n          if (name.substr(0,4)===':DL:') {\r\n            if (load_tgt==='') {\r\n              load_tgt = name;\r\n              if (this.load_on_demand_try_load([load_tgt.substr(4)])) this.idxs.splice(i,1);\r\n              break;\r\n            }\r\n          } else {\r\n            if (draw_on_demand && this.drawn_y>=ref_height && (!force_all_named || tgts_count<=0)) {\r\n              if (mode_merge_tails===false || !merge_tails) {\r\n                if (!hide_tails) break; // {cataLog.Footer.timestamp_inc(); break;}\r\n                if (tgt_th[1]) if (this.func_hide(name,catalog_expand_with_hr)) tgt_th[1] = false;\r\n                continue;\r\n              }\r\n              if (mode_merge_tails===null) {\r\n//                if (pref.test_mode['183'] && created_from_idx===true) break;\r\n                if (pref.test_mode['183'] && created_from_idx && created_from_idx.length>=0) {\r\n//                if (pref.test_mode['183'] && created_from_idx) {\r\n//                  if (created_from_idx.length===0) break; // can't merge with threads in other boards\r\n                  if (i + created_from_idx.length>=this.idxs.length) created_from_idx = null;\r\n                  else {\r\n                    var i_merge_tails = i;\r\n                    var merge_tails_idx = created_from_idx.length;\r\n                  }\r\n                }\r\n                mode_merge_tails = i + 1; // be true\r\n                draw_adaptive = false;\r\n              }\r\n              if (pref.test_mode['183'] && merge_tails_idx>=0) {\r\n//              if (pref.test_mode['183'] && created_from_idx) {\r\n////                if (pref.test_mode['184']) {\r\n//                if (merge_tails_idx<=0) break; // can't merge with threads in other boards\r\n                i = i_merge_tails; // keep looping\r\n                name = --merge_tails_idx>=0? created_from_idx[merge_tails_idx] : this.idxs[i];\r\n//                } else if (!(name in created_from_idx)) {\r\n//                  while (++i<this.idxs.length && !(this.idxs[i] in created_from_idx));\r\n//                  name = this.idxs[i];\r\n//                }\r\n                tgt_th = this.threads[name];\r\n              }\r\ndebug_count++;\r\n              if (!this.merge_bases.isShownForTails(name)) {\r\n                if (hide_tails && tgt_th[1]) if (this.func_hide(name,catalog_expand_with_hr)) tgt_th[1] = false;\r\n                continue;\r\n              }\r\n            } // else if (tgts_count===0 && !force_all_footer) break; // can't keep valid area clean if the thread is chenged NOT to be shown using MERGE or KILL.\r\n//            if (tgts_count===0 && mode_merge_tails===false) {retval = true; break;}\r\n            if (i>=i_start) {\r\n//              if (i%lazy_step===0) lazy_check = true;\r\n              if (try_all || tgts_count===0 || (name in tgts) || mode_merge_tails) {\r\n//              if (try_all || tgts_count!==0 && (name in tgts) || mode_merge_tails) {\r\n                var to_show = this.filter_test(name, tgt_th); // use differentAPI===true if wrapped posts are required\r\n                if (to_show && (this.view==='page' || this.view==='thread') && !pref.test_mode['52']) to_show = format_html.replace_posts_by_search(tgt_th, this.pref); // may change tgt_th[9][0]\r\n                if (to_show) {\r\n                  if (!tgt_th[0] || tgt_th[16].th) {\r\n                    this.insert_thread_prepare_html_lazy(tgt_th, !tgt_th[0], false, true, null);\r\n                    if (draw_adaptive && (!force_all_named || tgts_count<=0)) {\r\n                      if (++draw_count==pref.network.th100) {\r\n                        ref_height = this.get_ref_height(1);\r\n                        if (!this.disp_th100) {this.disp_th100 = setTimeout(function(){this.disp_th100 = null; this.show_catalog();}.bind(this), pref.network.th100_delay);}\r\n                      } else if (draw_count===pref.network.th20) {\r\n                        ref_height = this.get_ref_height(0.2);\r\n                        if (!this.disp_th20) {\r\n                          clearTimeout(this.disp_th100);\r\n                          this.disp_th100 = null;\r\n                          this.disp_th20 = setTimeout(function(){this.disp_th20 = null; this.show_catalog();}.bind(this), pref.network.th20_delay);}\r\n                        draw_adaptive = false; // close\r\n                      }\r\n                    }\r\n                  }\r\n                  this.footer.draw(tgt_th, name);\r\n                  if (mode_merge_tails && !this.func_check_overrated(name)) { // overrating is only happen with !try_all probably.\r\n                    this.func_search_ref_idx(name,null,true); \r\n                    if (!tgt_th[1]) tgt_th[1] = true;\r\n//                    if (!tgt_th[1]) if (this.func_show(name,null,catalog_expand_with_hr)) tgt_th[1] = true;\r\n                    continue;\r\n                  }\r\n////                  if (tgts!==undefined) { // working code.\r\n////                    ref_count = 0;\r\n////                    for (var j=0;j<i;j++) if (threads_idx[j].substr(0,4)!=='ODL:' && threads[threads_idx[j]][1]) ref_count++;\r\n////                  }\r\n////                  if (catalog_expand_with_hr) {\r\n////                    var j = 0;\r\n////                    var j_max = triage_parent.childNodes.length;\r\n////                    while (j<=ref_count && j<j_max) if (triage_parent.childNodes[j++].tagName!=='DIV') ref_count++;\r\n////                  }\r\n                  var ref;\r\n                  if (tgts!==undefined || mode_merge) {\r\n                    if (tgts && pref.test_mode['132'] && mode_merge) this.func_check_reorder(name,i);\r\n                    var j = (mode_merge? this.func_search_ref_idx(name,i) : i) -1; // bump up here in mode_merge\r\n                    while (j>=0 && (this.idxs[j].substr(0,4)===':DL:' || !this.threads[this.idxs[j]][1] || (mode_merge && this.func_search_ref(this.idxs[j])))) j--;\r\n                    if (j>=0) {\r\n                      ref = this.threads[this.idxs[j]][0].nextSibling;\r\n                      if (catalog_expand_with_hr && ref) ref = ref.nextSibling;\r\n                    } else ref = this.ppn.childNodes[this.ref_count_init];\r\n//                    delete tgts[name];\r\n//                    if (Object.keys(tgts).length===0) tgts='END';\r\n                  } else ref = this.ppn.childNodes[this.ref_count];\r\n                  if (ref!==tgt_th[0] || !tgt_th[1]) {\r\n                    if (this.func_show(name,ref,catalog_expand_with_hr)) tgt_th[1] = true;\r\n//                    if (pref.test_mode['127']) if (triage_thread) {triage.off_delay();triage_thread=null;}\r\n                  }\r\n//                  if (this.lazy_draw) this.lazy_draw(name);\r\n//                  if (this.lazy_draw) if (this.lazy_draw(name, get_ref_height(4)) this.backup_mb_state(i);\r\n                  if (tgt_th[1]) {\r\n                    var update_y = draw_on_demand && try_all && (this.drawn_y<ref_height) && (shown_count>=lazy_next); // try_all should be removed???\r\n                    merge_tails |= this.func_track_shown(name, update_y, i);\r\n                    if (update_y) { // check for merge\r\n                      lazy_next += lazy_step;\r\n                      if (try_all && pref.test_mode['150']) {\r\n                        this.lazy_avgSizeInv = this.drawn_y>0? shown_count/this.drawn_y : 0;\r\n                        lazy_next = Math.max(lazy_next, Math.floor(ref_height*this.lazy_avgSizeInv)+lazy_step);\r\n                      }\r\n                    }\r\n                  }\r\n                  \r\n//                  if (threads[name][1]) { // working code.\r\n//                    if (draw_on_demand) drawn_y = threads[name][0].offsetTop; // for faster execution. DOM function is too heavy.\r\n//                    ref_count += this.ref_step;\r\n//                    if (catalog_expand_with_hr) ref_count = show_catalog_skip_hs(ref_count);\r\n//                  }\r\n                } else if (tgt_th[1]) {\r\n//                  if (pop_up_status[name]) pop_down_event(name);\r\n//                  threads[name][11] = remove_open_new_thread_event(threads[name][11]);\r\n                  if (this.func_hide(name,catalog_expand_with_hr)) tgt_th[1] = false; // BUG. catalog_expand_with_hr must be removed to be consistent with site2['DEFAULT'].merge_bases.hide_merge_tgts, which can't give catalog_expand_with_hr\r\n//                  if (pref.test_mode['127']) if (triage_thread) {triage.off_delay();triage_thread=null;}\r\n                }\r\n// BUG\r\n//              } else {\r\n////                var ref = triage_parent.childNodes[ref_count];\r\n////                for (var name in tgts) if (threads[name] && ref===threads[name][0]) {ref.parentNode.removeChild(ref);break;} // this is required when the thread is moved to later. // threads[name] may not exist when it is snoop, that contains redundant threads.\r\n//                while (1) {\r\n//                  var flag = true;\r\n//                  var ref2 = triage_parent.childNodes[ref_count];\r\n//                  for (var name2 in tgts) if (threads[name2] && ref2===threads[name2][0]) {\r\n//                    ref2.parentNode.removeChild(ref2);\r\n//                    flag=false;\r\n//                    break;\r\n//                  } // this is required when the thread is moved to later. // threads[name] may not exist when it is snoop, that contains redundant threads.\r\n//                  if (flag) break;\r\n//                }\r\n//                if (threads[name][9][0]) ref_count++; // name must proceed by the count of eliminated in above.  THIS IS A BUG.\r\n// BUG\r\n                if (tgts && (name in tgts)) tgts_count--;\r\n              } else if (i>=footer_clean_idx && tgt_th[1]) this.footer.draw(tgt_th, name);\r\n            } else if (i>=footer_clean_idx && tgt_th[1]) this.footer.draw(tgt_th, name); // always check, this is slow but better than others.\r\n            if (tgt_th[1]) if (!mode_merge || !this.func_search_ref(name)) shown_count += (this.view==='catalog' || this.view==='headline')? 1 : tgt_th[16].posts.length;\r\n          }\r\n//          if (triage_thread===name) triage_thread = null;\r\n        }\r\n        if (mode_merge_tails) i = mode_merge_tails -1;\r\n        if (try_all || tgts_count==0 && drawn_idx_old<i) this.drawn_idx = (!draw_on_demand || i==this.idxs.length)? true : (i<i_start)? i_start : i;\r\n        this.footer.clean_idx = i;\r\n        if (mode_merge) this.func_lazy_draw();\r\n        if (this.observer_myself) this.observer_myself.observe(); \r\n//        if (common_obj.thread_reader && common_obj.thread_reader.observer_IDinfo) common_obj.thread_reader.observer_IDinfo.observe();\r\n        this.dirty = 0;\r\n        if (pref.test_mode['184']) console.log('show_catalog: '+debug_count+'/'+(created_from_idx && created_from_idx.length)+' at '+i_merge_tails+'/'+this.idxs.length)\r\n//        this.force_all_named = false;\r\n//        if (this.drawn_idx_mb!=-1) this.restore_mb_state();\r\n//        if (appeared.length!=0 && sound) notifier.appeared(appeared,threads);\r\n//var str_debug = '';\r\n//for (var d=0;d<threads_idx.length;d++) if (threads[threads_idx[d]][1] && threads[threads_idx[d]][9][0]) str_debug += threads_idx[d] + threads[threads_idx[d]][8][pref.catalog.indexing] + ',';\r\n//console.log(str_debug);\r\n////        if (catalog_expand_with_hr)\r\n////          for (var i=triage_parent.childNodes.length-2;i>=0;i--)\r\n////            if (triage_parent.childNodes[i].tagName==='HR' && triage_parent.childNodes[i+1].tagName==='HR') triage_parent.removeChild(triage_parent.childNodes[i+1]);\r\nif (pref.debug_mode['11'] && embed_mode!=='thread' && !pref[embed_mode].merge) {\r\n        var flag = -1;\r\n        var d_count = 0;\r\n        for (var d=0;d<i;d++) {\r\n          if (this.idxs[d][0]!=='O' && this.threads[this.idxs[d]][1]) {\r\n            var dbt = common_func.fullname2dbt(this.idxs[d]);\r\n            var tgt,tgt_bt;\r\n            if (embed_mode==='page' && site.nickname==='4chan') {\r\n              tgt = this.ppn.getElementsByClassName('CatChan_thread')[d_count++];\r\n              tgt_bt = site.board + tgt.id.substr(1);\r\n            } else if (embed_mode==='page' && site.nickname==='8chan') {\r\n              tgt = this.ppn.getElementsByClassName('CatChan_thread')[d_count++];\r\n              tgt_bt = '/' + tgt.getAttribute('data-board') + '/' + tgt.id.substr(7);\r\n            } else {\r\n              tgt = this.ppn.childNodes[pref[embed_mode].env.disp_offset + d_count++];\r\n              tgt_bt = (embed_mode==='page')? '/' + tgt.getAttribute('data-board') + '/' + tgt.id.substr(7) :\r\n                                              tgt.getElementsByTagName('a')[0].getAttribute('href').replace('res/','').replace('.html','').replace(/.*lainchan.org/,'').replace(/.*8kun.top/,'').replace('thread/','').replace(/.*4chan.org/,'').replace(/.*meguca.org/,'').replace(/.*krautchan.net/,'').replace(/thread\\-/,'');\r\n              if (dbt[0]==='4chan' && embed_mode==='catalog') tgt_bt = tgt_bt.substr(0,tgt_bt.lastIndexOf('/'));\r\n            }\r\n            if (dbt[1]+dbt[2]!==tgt_bt) {\r\n              var debug_str4='';\r\n              for (var j=d+1;j<d+5;j++) debug_str4 += this.idxs[j]+', ';\r\n              console.log('ERROR: '+d+', '+tgt_bt+', '+this.idxs[d]+': '+i+', '+debug_str4);\r\n              flag = i;\r\n            }\r\n          }\r\n        }\r\n        var debug_str3 = threads_idx_debug(this.drawn_idx, this.drawn_y, this.ref_count, this.idxs);\r\n        if (flag!=-1) {\r\n          console.log('PREV: '+debug_str2);\r\n          console.log('IN:   '+debug_str);\r\n          for (var i=0;i<flag+5;i++) if (this.ppn.childNodes[i]) console.log(this.ppn.childNodes[i]);\r\n          console.log('OUT:  '+debug_str3);\r\n//          console.trace();\r\n        } else {\r\n//          console.log('OK: '+debug_str);\r\n        }\r\n        debug_str2 = debug_str3;\r\n}\r\n        if (pref.debug_mode['36']) {\r\n          if (debugWindow && !this.debug) this.debug = debugWindow.connect();\r\n          if (this.debug) {\r\n            var i=-1;\r\n            var i1=-1;\r\n            var footer0 = null;\r\n            var footer1 = null;\r\n            while (++i<this.idxs.length) {\r\n              if (this.threads[this.idxs[i]]) {\r\n                if (footer0 = this.footer.test_dirty(this.idxs[i])) break;\r\n                footer1 = this.threads[this.idxs[i]][24] || footer1;\r\n                i1 = i;\r\n              }\r\n            }\r\n            this.debug.innerHTML = this.name+':<br>'+\r\n              'drawn_idx: '+this.drawn_idx+'<br>'+\r\n              'drawn_y: '+this.drawn_y+'<br>'+\r\n              'last_clean_footer: '+this.idxs[i1]+', offsetTop: '+(footer1 && footer1[0].parentNode.offsetTop)+'<br>'+\r\n              'first_dirty_footer: '+this.idxs[i]+', offsetTop: '+(footer0 && footer0[0].parentNode.offsetTop);\r\n          }\r\n        }\r\n//        return retval;\r\n      },\r\n      func_show: function(name,ref){\r\n        this.ppn.insertBefore(this.threads[name][0],(ref && ref.parentNode===this.ppn)? ref : null); // if many threads are removed, ref refers horizontal splitter.\r\n        return true;\r\n      },\r\n      func_hide: /*(site.whereami!=='archive')?*/ function(name){\r\n        this.ppn.removeChild(this.threads[name][0]);\r\n        return true;\r\n//      } : function(name){ // patch\r\n//        threads[name][0].parentNode.removeChild(threads[name][0]);\r\n//        return true;\r\n      },\r\n      func_hide_all: function(threads){\r\n        var catalog_expand_with_hr = (this.mode==='float' && pref.catalog_expand_with_hr) || pref[this.mode].env.disp_filler;\r\n        if (Array.isArray(threads)) {\r\n          for (var i=0;i<threads.length;i++) {\r\n            var tgt_th = this.threads[threads[i]];\r\n            if (tgt_th[1]) if (this.func_hide(threads[i],catalog_expand_with_hr)) tgt_th[1] = false;\r\n          }\r\n        } else for (var name in threads) {\r\n          var tgt_th = threads[name];\r\n          if (tgt_th[1]) if (this.func_hide(name,catalog_expand_with_hr)) tgt_th[1] = false;\r\n        }\r\n      },\r\n      func_track_shown: function(name, update_drawn_y){\r\n        if (update_drawn_y) this.drawn_y = this.threads[name][0].offsetTop; // - this.pppn.offsetTop; // for consistency of this.drawn_y, but slow, so this is handled in 'get_ref_height' // for faster execution. DOM function is too heavy.\r\n        this.ref_count += this.ref_step;\r\n//        return update_drawn_y;\r\n      },\r\n      func_track_reset: function(){\r\n        this.ref_count = this.ref_count_init;\r\n        this.drawn_y = -1;\r\n        this.drawn_idx= 0; // temporal patch, should be this.drawn_idx\r\n//        cataLog.Footer.timestamp_inc();\r\n      },\r\n//      backup_mb_state: function(idx){\r\n//        if (this.drawn_idx_mb==-1) {\r\n//          this.drawn_idx_mb = idx;\r\n//          this.ref_count_mb = this.ref_count;\r\n//        }\r\n//      },\r\n//      restore_mb_state: function(){\r\n//        drawn_idx = this.drawn_idx_mb;\r\n//        this.ref_count = this.ref_count_mb;\r\n//      },\r\n      permit_draw_on_demand: true,\r\n      ref_step: 1,\r\n      drawn_y: -1, // for floating catalog\r\n      ref_count: 0,\r\n      ref_count_init: 0,\r\n      dirty: 0x11, // [0]:updated(footer), [1]:reordered, [2]:removed, [3]:may contain duplicated entries, [4]: merge_list was changed.\r\n      lazy_avgSizeInv: 0,\r\n//      drawn_idx_mb: -1,\r\n//      ref_count_mb: 0,\r\n    };\r\n    common_func.Object_defProps(Clg.prototype, catalog_obj2_proto);\r\n\r\n////      if (pref.test_mode['96'] && embed_mode==='catalog') { // test for faster execution, removes redundant queries of offsetTop // working code\r\n////        catalog_obj2_proto = {\r\n////          func_track_shown: (function(func_org){\r\n////            return function(name, update_drawn_y){\r\n////              var y_old = this.drawn_y;\r\n////              var check_y = this.od_count%this.od_width==0;\r\n////              var retval = func_org.call(this, name, update_drawn_y && check_y);\r\n////              if (check_y && y_old==this.drawn_y) this.od_width++;\r\n////              this.od_count++;\r\n////              return retval;\r\n////            }\r\n////          })(catalog_obj2_proto.func_track_shown),\r\n////          func_track_reset: (function(func_org){\r\n////            return function(){\r\n////              func_org.call(this);\r\n////              this.od_count = 0;\r\n////            };\r\n////          })(catalog_obj2_proto.func_track_reset),\r\n////          func_od_reset: function(){\r\n////            this.od_width = 1;\r\n////            this.show_catalog_cont();\r\n////          },\r\n////          od_width: 1, // on_demand_mode\r\n////          od_count: 0,\r\n////          __proto__: catalog_obj2_proto\r\n////        };\r\n////      }\r\n//////      scroll_event_src.addEventListener('scroll', show_catalog_cont, false);\r\n////      if (pref.test_mode['96'] && embed_mode==='catalog') window.addEventListener('resize', catalog_obj2_proto.func_od_reset.bind(catalog_obj2_proto), false);\r\n//////      window.addEventListener('resize', (pref.test_mode['96'] && embed_mode==='catalog')? catalog_obj2_proto.func_od_reset.bind(catalog_obj2_proto) : show_catalog_cont, false);\r\n      var catalog_obj2 = catalog_obj2_proto;\r\n      if (embed_mode==='page' && site2[site.nickname].all_boards && site2[site.nickname].all_boards.indexOf(site.board)!=-1) { // PATCH\r\n        catalog_obj2 = {\r\n          func_show: function(name){\r\n            var ch = this.threads[name][0];\r\n            if (ch.previousSibling && ch.previousSibling.tagName==='H2') {\r\n              ch.previousSibling.style.display = '';\r\n              ch.style.display = '';\r\n              return true;\r\n            } else return false;\r\n          },\r\n          func_hide: function(name){\r\n            var ch = this.threads[name][0];\r\n            if (ch.previousSibling && ch.previousSibling.tagName==='H2') {\r\n              ch.previousSibling.style.display = 'none';\r\n              ch.style.display = 'none';\r\n              return true;\r\n            } else return false;\r\n          },\r\n          permit_draw_on_demand: false,\r\n          __proto__: catalog_obj2_proto\r\n        }\r\n////////      } else if (pref[embed_mode].merge) { // TEST // working code, but very slow because of basesd on HTML.\r\n////////        var base_name = site.nickname + site.board + site.no;\r\n////////        catalog_obj2 = {\r\n////////          func_show_hide: function(name, show_or_hide){\r\n////////            if (embed_mode==='thread' && base_name===name) return true;\r\n////////            var myself = site2[site.nickname].update_posts_prep_merge();\r\n////////            var dst = myself.posts;\r\n////////            var pnode = myself.pn;\r\n////////            var dbt = name.split('/');\r\n////////            var posts = threads[name][16].posts;\r\n////////            var src = {domain:dbt[0], board:dbt[1], no:dbt[2], posts:posts};\r\n////////            if (show_or_hide) {\r\n//////////////////              var j = dst.posts.length-1;\r\n//////////////////              var i = posts.length-1;\r\n//////////////////              while (i>=0) {\r\n//////////////////                while (j>0 && dst.posts[j].time>posts[i].time) j--;\r\n//////////////////                if (dst.posts[j].com===posts[i].com) break;\r\n//////////////////                else i--;\r\n//////////////////              }\r\n//////////////////              while (++i<posts.length) {\r\n//////////////////                while (j<dst.posts.length && dst.posts[j].time<posts[i].time) j++;\r\n//////////////////                site2[site.nickname].update_posts_insert(src, dst, i, j, pnode);\r\n//////////////////              }\r\n////////////              var time_merged = threads[name][16].time_merged || 0; // working code.\r\n////////////              var i = 0;\r\n////////////              var j = 0;\r\n//////////////              var scroll_add = 0;\r\n//////////////              var now_height = (pref[embed_mode].scroll_lock && !init)? get_now_height() : 0;\r\n//////////////              var now_height_tmp = now_height;\r\n////////////              if (time_merged!==0) {\r\n////////////                i = posts.length;\r\n////////////                while (i>0 && posts[i-1].time>time_merged) i--;\r\n////////////                j = dst.posts.length;\r\n////////////                while (j>0 && dst.posts[j-1].time>time_merged) j--;\r\n////////////              }\r\n////////////              while (i<posts.length) {\r\n////////////                while (j<dst.posts.length && (dst.posts[j].time<posts[i].time || dst.posts[j].time==posts[i].time && dst.posts[j].no<=posts[i].no)) j++;\r\n////////////                site2[site.nickname].update_posts_insert(src, dst, i++, j, pnode);\r\n//////////////                var add_val = site2[site.nickname].update_posts_insert(src, dst, i++, j, pnode, now_height_tmp); // slow\r\n//////////////                if (add_val!==null) scroll_add += add_val;\r\n//////////////                else now_height_tmp = 0;\r\n////////////                if (pref[embed_mode].scroll_lock) show_catalog_scroll_lock.modified(src.posts[i-1]);\r\n////////////              }\r\n////////////              threads[name][16].time_merged = posts[posts.length-1].time;\r\n//////////////              if (scroll_add) window.scrollTo(0,now_height + scroll_add);\r\n////////              site2[site.nickname].update_posts_insert_merge(src.posts,0);\r\n////////            } else {\r\n//////////              var back = 0;\r\n//////////              var now_height;\r\n//////////              if (pref[embed_mode].scroll_lock) now_height = get_now_height();\r\n////////              for (var i=posts.length-1;i>=0;i--) {\r\n//////////                if (pref[embed_mode].scroll_lock) if (src.posts[i].offsetTop<now_height) back += src.posts[i].offsetHeight; // TEST, SHOULD INCLUDE container.\r\n////////                if (src.posts[i].pn) site2[site.nickname].update_posts_remove(src, i, pnode, true);\r\n////////              }\r\n//////////              if (back) window.scrollTo(0,now_height-back);\r\n////////              threads[name][16].time_merged = 0;\r\n////////            }\r\n////////            return true;\r\n////////          },\r\n////////          func_show: function(name){if (!threads[name][1]) this.func_show_hide(name, true); return true;},\r\n////////          func_hide: function(name){if ( threads[name][1]) this.func_show_hide(name, false);return true;},\r\n////////          permit_draw_on_demand: false,\r\n////////          __proto__: catalog_obj2_proto\r\n////////        }\r\n////////        if (embed_mode==='page') {\r\n////////          var top = site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'page_html', {page:0})[0];\r\n////////          catalog_obj2.base_name = site.nickname + site.board + top.no;\r\n////////          site2['DEFAULT'].update_posts_merge_base = top.pn;\r\n////////        }\r\n//////////        if (pref[embed_mode].scroll_lock && site2[site.nickname].update_posts_remove_lock) {// TEST // TOO SLOW\r\n//////////          site2[site.nickname].update_posts_remove = site2[site.nickname].update_posts_remove_lock;\r\n//////////          site2[site.nickname].update_posts_insert = site2[site.nickname].update_posts_insert_lock;\r\n//////////        }\r\n////////        show_catalog_init_funcs = (embed_mode==='page')? function(){\r\n////////          for (var name in threads)\r\n////////          if (threads[name][0]!==site2['DEFAULT'].update_posts_merge_base && threads[name][0].parentNode===triage_parent) {\r\n////////            if (threads[name][0].nextSibling.tagName==='HR') triage_parent.removeChild(threads[name][0].nextSibling);\r\n////////            triage_parent.removeChild(threads[name][0]);\r\n////////            catalog_obj2.func_show_hide(name, true);\r\n////////          }\r\n////////        } : null;\r\n      } else if (pref[embed_mode].env.disp_filler) {\r\n        catalog_obj2 = catalog_obj2_factory_filler((pref[embed_mode].env.disp_filler[0]==='<')? document.createElement('hr') : document.createTextNode(pref[embed_mode].env.disp_filler));\r\n      } else if (embed_mode==='float' && pref.catalog_expand_with_hr) {\r\n        catalog_obj2 = {\r\n          func_show: function(name,ref){\r\n            if (this.threads[name][1]) show_catalog_hr(name,'remove');\r\n            this.ppn.insertBefore(this.threads[name][0],(ref && ref.parentNode===this.ppn)? ref : null); // if many threads are removed, ref refers horizontal splitter.\r\n            show_catalog_hr(name,'add');\r\n            return true;\r\n          },\r\n          func_hide: function(name){\r\n            show_catalog_hr(name,'remove');\r\n            this.ppn.removeChild(this.threads[name][0]);\r\n            return true;\r\n          },\r\n          func_track_shown: function(name, update_drawn_y){\r\n            this.__proto__.func_track_shown.call(this, name, update_drawn_y);\r\n            this.ref_count = show_catalog_skip_hs(this.ref_count);\r\n//            return retval;\r\n          },\r\n          __proto__: catalog_obj2_proto\r\n        }\r\n//        var pctrls = triage_parent;\r\n//        for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.removeChild(pctrls.childNodes[i]);\r\n//        pctrls.parentNode.insertBefore(document.createElement('hr'),pctrls.nextSibling);\r\n      }\r\n      function catalog_obj2_factory_filler(filler){\r\n        return {\r\n          func_show: function(name,ref){\r\n            var hr = this.threads[name][1] && this.threads[name][0].nextSibling || this.filler.cloneNode(false); // for 4chan, lastChild.nextSibling === null.\r\n//            var hr = (threads[name][1])? threads[name][0].nextSibling : this.filler.cloneNode(false);\r\n            this.ppn.insertBefore(this.threads[name][0],ref);\r\n            this.ppn.insertBefore(hr,ref);\r\n            return true;\r\n          },\r\n          func_hide: function(name){\r\n            this.ppn.removeChild(this.threads[name][0].nextSibling);\r\n            this.ppn.removeChild(this.threads[name][0]);\r\n            return true;\r\n          },\r\n          ref_step: 2,\r\n          filler: filler,\r\n          __proto__: catalog_obj2_proto\r\n        };\r\n      }\r\n      common_func.Object_defProps(pClg, catalog_obj2);\r\n//      common_func.Object_defProps(Clg.prototype, catalog_obj2);\r\n      var show_catalog = pClg.show_catalog.bind(pClg);\r\n//      var show_catalog = (catalog_obj2)? catalog_obj2.show_catalog.bind(catalog_obj2) :\r\n//                                         catalog_obj2_proto.show_catalog.bind(catalog_obj2_proto);\r\n      cataLog.show_catalog = show_catalog;\r\n      cataLog.catalog_obj2 = pClg; // Clg.prototype;\r\n//      cataLog.catalog_obj2 = catalog_obj2;\r\n//      var show_catalog_db_th100 = new DelayBuffer(show_catalog, pref.network.th100_delay);\r\n//      var show_catalog_db_th20 = new DelayBuffer(show_catalog, pref.network.th20_delay);\r\n\r\nfunction threads_idx_debug(idx,y,count, threads_idx){\r\n  var str = 'drawn_idx:'+idx+', drawn_y:'+y+', ref_count:'+count+' ';\r\n  for (var i=0;i<threads_idx.length;i++) if (!threads[threads_idx[i]] || threads[threads_idx[i]][1]) str += threads_idx[i]+', ';\r\n  str += '::: '+JSON.stringify(threads_idx);\r\n  return str;\r\n}\r\n      Clg.prototype.load_on_demand_timer = null; // means mutex also\r\n      Clg.prototype.load_on_demand_release = function(){\r\n        if (this.load_on_demand_timer!==null) clearTimeout(this.load_on_demand_timer);\r\n        this.load_on_demand_timer = null;\r\n      };\r\n      Clg.prototype.load_on_demand_try_load = function(tgts){\r\n        if (this.load_on_demand_try_get_mutex()) {\r\n          this.idx_delete_odl(tgts);\r\n          scan_boards.scan_init('on_demand_load', tgts, {refresh:this, crawler_max:1, callback:this.load_on_demand_release_draw.bind(this)});\r\n          return true;\r\n        } else return false;\r\n      };\r\n      Clg.prototype.load_on_demand_release_draw = function(){\r\n        this.load_on_demand_release();\r\n        this.show_catalog();\r\n      };\r\n      Clg.prototype.load_on_demand_try_get_mutex = function(){\r\n        if (this.load_on_demand_timer!==null) return false;\r\n        this.load_on_demand_timer = setTimeout(this.load_on_demand_release.bind(this), pref.proto.load_on_demand_timeout*1000);\r\n        return true;\r\n      };\r\n//      var load_on_demand = (function(){ // working code\r\n//        var mutex = true;\r\n//        var timer = null;\r\n//        function release(){\r\n//          if (timer) {\r\n//            clearTimeout(timer);\r\n//            timer = null;\r\n//          }\r\n//          mutex = true;\r\n//        }\r\n//        return {\r\n//          call: function(clg,tgts){\r\n//            if (this.get()) {\r\n//              pClg.idx_delete_odl(tgts);\r\n//              scan_boards.scan_init('on_demand_load', tgts, {refresh:clg, crawler_max:1, callback:load_on_demand.release_draw});\r\n//              return true;\r\n//            } else return false;\r\n//          },\r\n//          release: release,\r\n//          release_draw: function(){release();show_catalog();},\r\n//          get: function(){\r\n//            var retval = mutex;\r\n//            if (retval) timer = setTimeout(release, pref.proto.load_on_demand_timeout*1000);\r\n//            mutex = false;\r\n//            return retval;\r\n//          }\r\n//        }\r\n//      })();\r\n\r\n      function show_catalog_skip_hs(ref_count){\r\n        var c_len = triage_parent.childNodes.length;\r\n        var class_hs = pref.script_prefix+'_hs';\r\n//        while (ref_count<c_len && triage_parent.childNodes[ref_count].className===class_hs) ref_count++;\r\n        if (ref_count<c_len && triage_parent.childNodes[ref_count].className===class_hs) ref_count++;\r\n        return ref_count;\r\n      }\r\n      function show_catalog_hr(name,func){\r\n        if (embed_mode==='catalog') return;\r\n        var pn = threads[name][0];\r\n        var class_hs = pref.script_prefix+'_hs';\r\n        if (func==='add' && pn.style.width==='' && pn.style.height==='') {\r\n          if (pn.previousSibling && pn.previousSibling.className!==class_hs) pn.parentNode.insertBefore(site2[site.nickname].horizontal_separator_in_index(),pn);\r\n          if (pn.nextSibling && pn.nextSibling.className!==class_hs) pn.parentNode.insertBefore(site2[site.nickname].horizontal_separator_in_index(),pn.nextSibling);\r\n        }\r\n        if (func==='shrink' || func==='remove' && pn.style.width==='' && pn.style.height==='' || func==='add' && (pn.style.width!=='' || pn.style.height!=='')) {\r\n          var pn_test = (pn.previousSibling && pn.previousSibling.className===class_hs)? pn.previousSibling.previousSibling : null;\r\n          if (pn_test && (pn_test.style.width!=='' || pn_test.style.height!=='')) pn.parentNode.removeChild(pn.previousSibling);\r\n          var pn_test = (pn.nextSibling && pn.nextSibling.className===class_hs)? pn.nextSibling.nextSibling : null;\r\n          if (pn_test && (pn_test.style.width!=='' || pn_test.style.height!=='')) pn.parentNode.removeChild(pn.nextSibling);\r\n        }\r\n        if (func==='remove') {\r\n//          if (pn.previousSibling && pn.previousSibling.className===class_hs && pn.nextSibling && pn.nextSibling.className===class_hs) pn.parentNode.removeChild(pn.previousSibling); // BUG IN 8ch page mode, remoev first br and 'ref' becomes null.\r\n          if (pn.previousSibling && pn.previousSibling.className===class_hs && pn.nextSibling && pn.nextSibling.className===class_hs) pn.parentNode.removeChild(pn.nextSibling);\r\n//          if (pn.nextSibling && pn.nextSibling.className===class_hs && pn.nextSibling.nextSibling && pn.nextSibling.nextSibling.className===class_hs) pn.parentNode.removeChild(pn.nextSibling);\r\n        }\r\n      }\r\n\r\n////      function show_catalog_hr(name,func){ // working code.\r\n////        var pn = threads[name][0];\r\n//////        var sibls = ['previousSibling', 'nextSibling'];\r\n//////        if (pn.style.width==='' && pn.style.height==='') {\r\n//////          for (var i=0;i<sibls.length;i++)\r\n//////            while (pn[sibls[i]] && pn[sibls[i]].tagName==='HR' && pn[sibls[i]][sibls[i]].tagName==='HR') pn.parentNode.removeChild(pn[sibls[i]]);\r\n////        if (func==='add' && pn.style.width==='' && pn.style.height==='') {\r\n////          if (pn.previousSibling && pn.previousSibling.tagName!=='HR') pn.parentNode.insertBefore(document.createElement('hr'),pn);\r\n////          if (pn.nextSibling && pn.nextSibling.tagName!=='HR') pn.parentNode.insertBefore(document.createElement('hr'),pn.nextSibling);\r\n////        }\r\n////        if (func==='shrink' || func==='remove' && pn.style.width==='' && pn.style.height==='' || func==='add' && (pn.style.width!=='' || pn.style.height!=='')) {\r\n////          var pn_test = (pn.previousSibling && pn.previousSibling.tagName==='HR')? pn.previousSibling.previousSibling : null;\r\n////          if (pn_test && (pn_test.style.width!=='' || pn_test.style.height!=='')) pn.parentNode.removeChild(pn.previousSibling);\r\n////          var pn_test = (pn.nextSibling && pn.nextSibling.tagName==='HR')? pn.nextSibling.nextSibling : null;\r\n////          if (pn_test && (pn_test.style.width!=='' || pn_test.style.height!=='')) pn.parentNode.removeChild(pn.nextSibling);\r\n////        }\r\n////        if (func==='remove') {\r\n////          if (pn.previousSibling && pn.previousSibling.tagName==='HR' && pn.nextSibling && pn.nextSibling.tagName==='HR') pn.parentNode.removeChild(pn.previousSibling);\r\n//////          for (var i=0;i<sibls.length;i++) {\r\n//////            var pn_test = pn[sibls[i]][sibls[i]];\r\n//////            if (pn_test.tagName==='DIV' && pn_test.style && (pn_test.style.width!=='' || pn_test.style.height!=='')) pn.parentNode.removeChild(pn[sibls[i]]);\r\n//////          }\r\n////        }\r\n////      }\r\n\r\n      Clg.prototype.view_attr_changed = function(){\r\n        for (var name in this.threads) this.view_attr_set(name);\r\n      };\r\n//      Clg.prototype.view_attr_changed = function(){ // working code\r\n//        var tgts = {};\r\n//        var req_acc = 0;\r\n//        for (var name in this.threads) {\r\n//          var req = this.view_attr_set(name, null, true);\r\n//          if (req) {\r\n//            tgts[name] = null;\r\n//            req_acc |= req;\r\n//          }\r\n//        }\r\n//        this.show_catalog(tgts, req_acc&0x02, req_acc&0x04);\r\n//      };\r\n      var RollbackInfo = new WeakMap();\r\n      Clg.prototype.view_attr_set = function(name, style_only, skip_showing, pn_in, force_unroll){\r\n        var tgt_th = this.threads[name];\r\n        var pf = this.pref.filter;\r\n        var pn = pn_in || tgt_th[0];\r\n        var val = null;\r\n        if (pf.attr_list) {\r\n          var wlc;\r\n          if (pref.common.blur_404 && (wlc=pf.watch_list_obj2[name]) && (wlc=wlc.cmd) && wlc['PRUNED'] && this.mode!=='thread' && !this.noBlur) val = {style:{opacity:0.4}}; // view is one of catalog, headline and page, never 'thread' // CAUTION: obj2 is accessed directly.\r\n          if (pref.catalog.style_general_list) val = pref_func.merge_obj5(name,pref.catalog.style_general_list_obj2,val);\r\n          if (pf.attr_list) val = pref_func.merge_obj5(name,pf.attr_list_obj2,val);\r\n        }\r\n//        if (val && val.style) {\r\n////          var styles = val.style.split(';');\r\n////          for (var i=0;i<styles.length;i++) {\r\n////            var stl = styles[i].split(':');\r\n////            pn.style[stl[0]] = stl[1];\r\n////          }\r\n////console.log('catalog_attr_set :'+name+', '+val.toSource());\r\n////          for (var stl in val)\r\n////            if (stl.indexOf('style')==0) pn.style[stl.substr(6)] = val[stl];\r\n////          for (var stl in val) {\r\n////            if (stl.indexOf('style')==0 && stl.length>6) pn.style[stl.substr(6)] = val[stl];\r\n////            if (stl.indexOf('style')==0 && stl.length>6) {\r\n////              pn.setAttribute('style',pn.getAttribute('style')+stl.substr(6)+':'+val[stl]+';');\r\n////              console.log('catalog_attr_set_1 :'+name+', '+pn.getAttribute('style')+';'+stl.substr(6)+val[stl]+':');\r\n////            }\r\n////          }\r\n//          for (var stl in val.style) pn.style[stl] = val.style[stl];\r\n        //        }\r\n        if (pn) {\r\n          var rollback_info = RollbackInfo.get(pn); // tgt_th[22];\r\n          if (!force_unroll && val && val.style) {\r\n            if (!rollback_info) rollback_info = {};\r\n            for (var stl in val.style) {\r\n              if (!(stl in rollback_info)) rollback_info[stl] = pn.style[stl];\r\n              pn.style[stl] = val.style[stl];\r\n            }\r\n            RollbackInfo.set(pn,rollback_info); // tgt_th[22] = rollback_info;\r\n          }\r\n          if (rollback_info) for (var stl in rollback_info) {\r\n            if (!val || !val.style || !(stl in val.style)) {\r\n              if (rollback_info[stl]===undefined) delete pn.style[stl];\r\n              else pn.style[stl] = rollback_info[stl];\r\n              delete rollback_info[stl];\r\n            }\r\n          }\r\n        }\r\n        if (style_only) return;\r\n//        var request_for_show = 0; // stores boolean values of arguments at calling show_catalog from LSB\r\n        if (val && val.cmd || tgt_th[20] || tgt_th[16].show_always || tgt_th[16].icon_sticky || tgt_th[16].icon_show_always || tgt_th[16].systemSticky) {\r\n//        if (val && val.cmd || tgt_th[16].icon_sticky || tgt_th[16].icon_show_always || tgt_th[16].systemSticky) {\r\n          var sticky = !!((val && val.cmd && val.cmd['STICKY']!==undefined)? val.cmd['STICKY'] : tgt_th[16].systemSticky); // !! for ^\r\n          if (sticky ^ tgt_th[20]) {\r\n            tgt_th[20] = sticky;\r\n            this.idx_reorder(name);\r\n            if (!skip_showing) this.show_catalog_buf(name, null, true); // too slow, issues multiple show_catalog\r\n//            request_for_show |= 0x5;\r\n//            if (show_catalog) this.show_catalog(name); // 'if (show_catalog)' is a patch.\r\n//            if (show_catalog && tgt_th[24]) this.show_catalog(name); // 'if (show_catalog)' is a patch. // tgt[24] means completion of making html, 'auto_list' may call here before making html\r\n//            if (show_catalog && tgt_th[0]) this.show_catalog(name); // 'if (show_catalog)' is a patch.\r\n          }\r\n          // FUCKING JAVASCRIPT!!!, false != null become true.\r\n          if (tgt_th[24] && sticky != !!tgt_th[16].icon_sticky || tgt_th[16].systemSticky) tgt_th[16].icon_sticky = site2[site.nickname].set_icon(tgt_th[0], this.view, 'sticky', tgt_th[16], sticky); // pass always because of lazy draw, pn was not prepared at initial. // tgt_th[24] means completion of making html\r\n\r\n          var showAlways = !!(val && val.cmd && val.cmd['SHOW']);\r\n          if (showAlways ^ tgt_th[16].show_always) { // show\r\n//            tgt_th[16].icon_show_always = site2[site.nickname].set_icon(tgt_th[0],tgt_th[16].type_html, 'show_always', tgt_th[16]);\r\n            tgt_th[16].show_always = showAlways; // for lazy pn generation.\r\n            this.filter_dirtify(tgt_th);\r\n            if (!skip_showing) this.show_catalog_buf(name, true); // too slow, issues multiple show_catalog\r\n//            request_for_show |= 0x3;\r\n//            if (show_catalog) this.show_catalog(name, true); // 'if (show_catalog)' is a patch.\r\n//            if (show_catalog && tgt_th[24]) this.show_catalog(name); // 'if (show_catalog)' is a patch. // tgt[24] means completion of making html, 'auto_list' may call here before making html\r\n//            if (show_catalog && tgt_th[0]) this.show_catalog(name); // 'if (show_catalog)' is a patch.\r\n          }\r\n          if (tgt_th[24] && showAlways != !!tgt_th[16].icon_show_always) tgt_th[16].icon_show_always = site2[site.nickname].set_icon(tgt_th[0], this.view, 'show_always', tgt_th[16], showAlways); // tgt_th[24] means completion of making html\r\n        }\r\n//        return request_for_show;\r\n      }\r\n      Clg.prototype.view_attr_get_str = function(name){\r\n        var val = this.pref.filter.attr_list_obj2[name]; // CAUTION, obj2 are accessed directly.\r\n        if (!val) return null;\r\n        var str = '';\r\n        if (val && val.style) for (var stl in val.style) str += stl + ':' + val.style[stl] + ';';\r\n        var tgt_th = this.threads[name];\r\n        var sticky = !!((val && val.cmd && val.cmd['STICKY']!==undefined)? val.cmd['STICKY'] : tgt_th && tgt_th[16].systemSticky);\r\n        if (sticky) str += 'STICKY;';\r\n        var showAlways = !!(val && val.cmd && val.cmd['SHOW']);\r\n        if (sticky) str += 'SHOW;';\r\n        return str? str : null;\r\n      };\r\n    \r\n      var catalog_filter_query_keyword = (function(){\r\n        function query_1p(kwd, post, domain, unmatch, any_or_all){ // for in-post strict mode, returns if meets THE criteria, including any or all\r\n          for (var i=0;i<kwd.rexps.length;i++) if (any_or_all==(unmatch ^ query_11(kwd, kwd.rexps[i], post, domain))) return any_or_all; // must be == instead of ===\r\n          return !any_or_all;\r\n        }\r\n        function query_1t(kwd, rexp, posts, domain, unmatch){ // for thread, returns if any post meets ANY PARTS of criteria, 'all' is treated as 'any'\r\n          if (kwd.op) if (unmatch ^ query_11(kwd, rexp, posts[0], domain)) return true;\r\n          if (kwd.post) for (var j=1;j<posts.length;j++) if (unmatch ^ query_11(kwd, rexp, posts[j], domain)) return true;\r\n          return false;\r\n        }\r\n//        function query_1(kwd, rexp, posts, domain, th){ // working code.\r\n//          var post_array = Array.isArray(posts);\r\n//          var start = (!post_array || kwd.op)? 0 : 1; // temporarily\r\n//          var end   = ( post_array && kwd.post)? posts.length : 1; // tamporarily\r\n//          for (var j=start;j<end;j++) {\r\n//            var pst = (post_array)? posts[j] : (j==0)? posts : null;\r\n//            if (pst && query_11(kwd, rexp, pst, domain)) return true; // if posts are not exist, th.posts becomes 'undefined'.\r\n//          }\r\n//          return false;\r\n//        }\r\n////        var com2txt_flag = false; // SLOW.\r\n////        var com2txt_rexp = /<[^>]*>|&([#\\w\\d]*);/g\r\n////        var com2txt_subs = {\r\n////          gt : '>',\r\n////          lt : '<',\r\n////          amp: '&',\r\n////          hellip: '\\u2026',\r\n////          larr: '\\u2190',\r\n////          rarr: '\\u2192',\r\n////          mdash: '\\u2014',\r\n////          ndash: '\\u2013',\r\n////          qout:'\"', // 4chan\r\n////          '#039':\"'\", // 4chan\r\n////          '#044':',', // 4chan\r\n////          '#44' :',', // 4chan\r\n////        };\r\n////        function com2txt(match,p1,offset,string){\r\n////          if (match[0]==='&') {\r\n////            var retval = com2txt_subs[p1];\r\n////            if (retval) return retval;\r\n////            com2txt_flag = true;\r\n////            if (pref.debug_mode['17']) console.log('not interpreted html: '+match+', '+string);\r\n////          }\r\n////          return ' '; // case of <[^>]*> or not interpreetd.\r\n////        }\r\n//        var pn_com = document.createElement('div');\r\n//        var pn_com = document.createElement('textarea'); // preserve tags in HTML. // slower than div.\r\n        function query_11(kwd, rexp, pst, domain){\r\n          if (kwd.sub)  if (pst.sub  && rexp.test(pst.sub )) return true;\r\n          if (kwd.name) if (pst.name && rexp.test(pst.name)) return true;\r\n//          if (kwd.com)  if (pst.com) {\r\n          if (kwd.com) {\r\n            if (pst.parse_funcs && pst.parse_funcs.type_com==='txt') { //  || pref.test_mode['53']) {\r\n              if (rexp.test(pst.body || pst.com)) return true; // fastest, speed ratio: part/total = 1/1.\r\n            } else {\r\n//              if (!pref.test_mode['54']) {\r\n////                if (!pref.test_mode['57']) {\r\n              var txt = site2[domain].post_com2txt(pst); // 9.4/1.99 for lainchan, 13.07/2.38 for 4chan.\r\n              if (txt && rexp.test(txt)) return true;\r\n//                var txt = site2[domain].post_com2txt(pst); // 9.4/1.99 for lainchan, 13.07/2.38 for 4chan.\r\n//                if (txt) {\r\n//                  if (txt.search(/&[#\\w\\d]+;/)!=-1 && !pref.test_mode['58']) {\r\n//                    if (pref.debug_mode['17']) console.log('not interpreted html: '+txt);\r\n//                    pn_com.innerHTML = pst.com; // giving com is faster than giving txt.\r\n//                    txt = pn_com[brwsr.innerText];\r\n//                  }\r\n//                  if (rexp.test(txt)) return true;\r\n//                }\r\n//////                } else { // SLOW.\r\n//////                  com2txt_flag = false;\r\n////////                  var txt = pst.com.replace(com2txt_rexp, com2txt); // StringReplaceGlobalRegexpWithfunction is heavy. 19.76/3.33\r\n//////                  var txt = pst.com.replace(/<[^>]*>|&([#\\w\\d]*);/g, com2txt); // This still outs StringReplaceGlobalRegexpWithfunction.\r\n//////                  if (com2txt_flag) {\r\n//////                    pn_com.innerHTML = pst.com;\r\n//////                    txt = pn_com[brwsr.innerText];\r\n//////                  }\r\n//////                  if (rexp.test(txt)) return true;\r\n//////                }\r\n////              } else {\r\n////                pn_com.innerHTML = (!pref.test_mode['55'])? pst.com :  // TOO SLOW!!!. 53.72/7.65\r\n////                                                            pst.com.replace(/<[^>]*>/g,' ');  // TOO SLOW, FURTHER!!!. 60.51/8.21\r\n////                if (rexp.test(pn_com[brwsr.innerText])) return true;\r\n////              }\r\n            }\r\n          }\r\n          if (kwd.trip) if (pst.trip && rexp.test(pst.trip)) return true;\r\n          if (kwd.id) if (pst.id && rexp.test(pst.id)) return true;\r\n          if (kwd.file) {\r\n            if (pst.filename && rexp.test(pst.filename)) return true;\r\n            if (pst.extra_files)\r\n              for (var k=pst.extra_files.length-1;k>=0;k--)\r\n                if (pst.extra_files[k].filename && rexp.test(pst.extra_files[k].filename)) return true;\r\n          }\r\n          if (kwd.meta) if (pst.no && rexp.test(pst.no)) return true;\r\n          if (kwd.flag) if (pst.country && rexp.test(pst.country)) return true;\r\n          if (kwd.id2) if (pst.id2 && rexp.test(pst.id2)) return true;\r\n          return false;\r\n        }\r\n        return {\r\n          kwd: function(kwd,posts, domain){ // for entire thread\r\n            if (!kwd.use || !kwd.rexps) return true;\r\n            var any_or_all = kwd.match%2===1; // undefined means all [false, true, false, true]\r\n            var unmatch = kwd.match>=2;\r\n            if (kwd.inPost) {\r\n              if (kwd.op) if (query_1p(kwd, posts[0], domain, unmatch, any_or_all)) return true;\r\n              if (kwd.post) for (var j=1;j<posts.length;j++) if (query_1p(kwd, posts[j], domain, unmatch, any_or_all)) return true;\r\n              return false;\r\n            } \r\n            for (var i=0;i<kwd.rexps.length;i++) if (any_or_all===query_1t(kwd, kwd.rexps[i], posts, domain, unmatch)) return any_or_all;\r\n//            var testval = !!((kwd.match>=2) ^ any_or_all); //      [false, true,  true,false] // value for short-cut\r\n//            for (var i=0;i<kwd.rexps.length;i++) if (testval===query_1(kwd, kwd.rexps[i], posts, domain, th)) return any_or_all;  // BUG, can't handle unmatch if posts search\r\n            return !any_or_all;\r\n//            var retval = kwd.match<2; // working code.\r\n//            if (kwd.match%2===0) { // all\r\n//              for (var i=0;i<kwd.rexps.length;i++) if (retval!==query_1()) return false;\r\n//              return true;\r\n//            } else {\r\n//              for (var i=0;i<kwd.rexps.length;i++) if (retval===query_1()) return true;\r\n//              return false;\r\n//            }\r\n          },\r\n          kwd_1: function(kwd, post, domain){ // for single post\r\n            var val_detect = (kwd.inPost)? kwd.match%2===1 | 0 : 1; // numerify for ===\r\n            var unmatch = kwd.match>=2 |0;\r\n            for (var i=0;i<kwd.rexps.length;i++) if (val_detect===(unmatch ^ query_11(kwd, kwd.rexps[i], post, domain))) return val_detect;\r\n            return !val_detect;\r\n//            var any_or_all = kwd.match%2===1 | 0; // numerify // working, but debugged not so long...\r\n//            var unmatch = kwd.match>=2 | 0;\r\n//            if (kwd.inPost) { // meets whole criteria in a post.\r\n//              for (var i=0;i<kwd.rexps.length;i++) if (any_or_all===(unmatch ^ query_11(kwd, kwd.rexps[i], post, domain))) return any_or_all; // OK.\r\n//              return !any_or_all;\r\n//            } else { // meets ANY match/unmatch\r\n//              for (var i=0;i<kwd.rexps.length;i++) if (              unmatch ^ query_11(kwd, kwd.rexps[i], post, domain)) return true; // OK.\r\n//              return false;\r\n//            }\r\n          },\r\n          kwd_make_result: function(posts, domain, kwd){\r\n            if (!kwd) kwd = pref.filter.kwd;\r\n            var result = [Object.create(posts[0])]; // not to change source for 'posts_search_miss'. // BUG. wrapper just add protptpye to itself, it doesn't take this into account, but patched.\r\n//            var result = [posts[0]]; // can't update omitted info in page mode.\r\n            result[0].search_result = this.kwd_1(kwd, posts[0], domain);\r\n            for (var i=1;i<posts.length;i++) if (this.kwd_1(kwd, posts[i], domain)) result[result.length] = posts[i];\r\n            return (result.length!=1 || result[0].search_result)? result : null;\r\n          },\r\n//          auto_list: function(th, obj, clg){\r\n//            for (var i=0;i<obj.length;i++)\r\n//              if (obj[i].use!==false && this.kwd({use:true, __proto__:obj[i]}, th.posts, th.domain, th)) {\r\n//                var cmds = obj[i].cmds.split(',');\r\n//                for (var j=0;j<cmds.length;j++) {\r\n//                  var idx = cmds[j].indexOf(':');\r\n//                  if (idx===-1) clg.triage_exe(th.key, cmds[j], '', false, null, false); // CAUTION: TRIAGE IS SLOW BECAUSE IT IS DESIGNED TO BE USED AS GUI, it redraws doms and remake objs always.\r\n//                  else clg.triage_exe(th.key, cmds[j].slice(0,idx), cmds[j].slice(idx+1), false, null, false);\r\n//                }\r\n//              }\r\n//          },\r\n        };\r\n      })();\r\n      cataLog.catalog_filter_query_keyword = catalog_filter_query_keyword;\r\n//        for (var i=0;i<kwd.kwds.length;i++) { // OR\r\n//          for (var j=start;j<end;j++) {\r\n//            var pst = (post_array)? posts[j] : (j==0)? posts : null;\r\n//            if (pst!==null) {\r\n//              if (kwd.sub)  if (pst.sub  && kwd.kwds[i].test(pst.sub )) return retval;\r\n//              if (kwd.com)  if (pst.com  && kwd.kwds[i].test(pst.com )) return retval;\r\n//              if (kwd.name) if (pst.name && kwd.kwds[i].test(pst.name)) return retval;\r\n//              if (kwd.trip) if (pst.trip && kwd.kwds[i].test(pst.trip)) return retval;\r\n//              if (kwd.file) {\r\n//                if (pst.filename && kwd.kwds[i].test(pst.filename)) return retval;\r\n//                if (pst.extra_files)\r\n//                  for (var k=pst.extra_files.length-1;k>=0;k--) \r\n//                    if (pst.extra_files[k].filename && kwd.kwds[i].test(pst.extra_files[k].filename)) return retval;\r\n//              }\r\n//            }\r\n//          }\r\n//        }\r\n//        return !retval;\r\n//      function catalog_filter_query_keyword(str_in){\r\n//        if (!pref.filter.kwd.use) return true;\r\n//        var kwd = pref.filter.kwd.str;\r\n//        if (kwd==='') return true;\r\n//        var str = ((pref.filter.kwd.op       )? str_in[0]+'\\n' : '')\r\n//                + ((pref.filter.kwd.op_sub   )? str_in[1]+'\\n' : '')\r\n//                + ((pref.filter.kwd.op_name  )? str_in[2]+'\\n' : '')\r\n//                + ((pref.filter.kwd.op_file  )? str_in[3]+'\\n' : '')\r\n//                + ((pref.filter.kwd.post     )? str_in[4]+'\\n' : '')\r\n//                + ((pref.filter.kwd.post_sub )? str_in[5]+'\\n' : '')\r\n//                + ((pref.filter.kwd.post_name)? str_in[6]+'\\n' : '')\r\n//                + ((pref.filter.kwd.post_file)? str_in[7]+'\\n' : '');\r\n//        if (str==='') return true;\r\n//\r\n//        var flag = true;\r\n//        var kwds = kwd.split(' ');\r\n//        for (var i=0;i<kwds.length;i++) {\r\n//          if (kwds[i]==='') continue;\r\n//          kwd = kwds[i];\r\n//          if (!pref.filter.kwd.re) kwd = kwd.replace(/[\\.\\(\\)\\[\\]\\+\\?\\^\\$\\{\\}]/g,'\\\\$&').replace(/\\*/g,'.*');\r\n//          if (pref.filter.kwd.ci) kwd = new RegExp(kwd,'i');\r\n//          var result = (str.search(kwd)!=-1);\r\n//          if (pref.filter.kwd.match==='unmatch') result = !result;\r\n//          flag = flag & result;\r\n//        }\r\n//        return flag;\r\n//      }\r\n////////      function catalog_filter_query_tag(tags){ // working code.\r\n//////////        if (!pref.filter.tag || filter_tags.length==0) return true;\r\n////////        if (!pref.filter.tag) return true;\r\n////////if (pref.test_mode['22']) {\r\n////////        if (filter_tags.length==0) return false;\r\n////////        if (!tags) return false;\r\n//////////console.log(tags);\r\n////////        for (var i=0;i<tags.length;i++)\r\n////////          for (var j=0;j<filter_tags.length;j++)\r\n////////            if (tags[i].search(filter_tags[j])!=-1) return true;\r\n////////        return false;\r\n////////} else {\r\n////////        return liveTag.search_by_tags(tags);\r\n////////}\r\n////////      }\r\n      Clg.prototype.filter_dirtify = function(tgt_th, updated){\r\n        tgt_th[9][0] = null;\r\n        if (updated) tgt_th[9][2] = null;\r\n      }\r\n      Clg.prototype.filter_test = function(name, tgt_th){\r\n        var retval = tgt_th[9][0];\r\n        return (retval!==null)? retval : this.filter_query(name, tgt_th); // for lazy query\r\n      }\r\n//      function catalog_filter_query(name, no_reset){\r\n//        return pClg.filter_query(name, no_reset);\r\n//      }\r\n      Clg.prototype.filter_query = function(name, tgt_th){\r\n        return (tgt_th[9][0] = this.filter_query_1(name, tgt_th));\r\n//        var val_old = tgt_th[9][0];\r\n//        var val_new = this.filter_query_1(name, tgt_th);\r\n//        tgt_th[9][0] = val_new;\r\n//        if (!no_reset && val_old !== val_new) this.drawn_idx = 0;\r\n//        return val_new;\r\n      };\r\n      Clg.prototype.filter_query_1 = function(name, tgt_th){\r\n        var pf = this.pref.filter; // this.pref && this.pref.catalog && this.pref.filter || pref.filter;\r\n        if (tgt_th[16].show_always && !pf.kwd.active) return true; // can't set 'tgt_th[16].icon_show_always' if (tgt_th[0]===null)\r\n//        if (this.pref[this.mode].hide_unwatched && !tgt_th[16].lth.watched) return false;\r\n        if (pf.tag && (!pf.kwd.active || !pf.disTWKA)) if (!this.liveTag.search_by_tags(tgt_th[16].lth)) return false;\r\n        if (pf.time)          if ((tgt_th[8][4]||tgt_th[8][0])<=pf.time_obj6) return false;\r\n        if (pf.time_creation) if ( tgt_th[8][1]               <=pf.time_obj6) return false;\r\n//        if (pf.time) { // working code.\r\n//          var time = Date.parse(pf.time_str);\r\n////          if (tgt_th[8][0]<=time && tgt_th[8][4]<=time) return [false];\r\n//          if ((tgt_th[8][4]||tgt_th[8][0])<=time) {tgt_th[9][0] = false; return;}\r\n//        }\r\n        if (pf.list && (!pf.kwd.active || !pf.disLWKA)) { // use [1]\r\n          var val = pref_func.merge_obj5(name, this.pref.filter.list_obj2,null);\r\n          if (val!==null && (val.time===undefined || !(val.time<(tgt_th[8][4]||tgt_th[8][0])))) return false; // !(val.time is for compatibility for safe, but may be redundant.\r\n//          var retval = this.filter_list(name, tgt_th);\r\n//          if (retval[0]===false) {tgt_th[9] = retval; return tgt_th[9][0];}\r\n        }\r\n//        else if (pf.list_mark_time) [true, get_mark_time(name)];\r\n        if (pf.kwd.active) { // use [2],[3]\r\n          var tgt_posts = tgt_th[16].recent_posts((pf.kwd.post)? (pref[embed_mode].sourceOfSP==='auto'? -1 : null) : 0);\r\nif (pref.test_mode['59']) { // BUG. THIS DOESN'T WORK WITH OTHER FILTERS, NEEDS TO BE SPLITTED. \r\n          if (!catalog_filter_query_keyword.kwd(pf.kwd, tgt_posts, common_func.fullname2dbt(name)[0])) return false;\r\n} else {\r\n          if (!((pf.kwd.fail_list[tgt_th[9][3]] && tgt_th[9][2]===false) ||\r\n                (pf.kwd.suc_list[tgt_th[9][3]]  && tgt_th[9][2]===true ))) {\r\n            tgt_th[9][3] = pf.kwd.timestamp;\r\n            tgt_th[9][2] = catalog_filter_query_keyword.kwd(pf.kwd, tgt_posts, common_func.fullname2dbt(name)[0]);\r\n          } else {\r\n            if (pref.debug_mode['18'] && tgt_th[9][2]!==catalog_filter_query_keyword.kwd(pf.kwd, tgt_posts, common_func.fullname2dbt(name)[0])) console.log('BUG, test59, '+name);\r\n          }\r\n          if (!tgt_th[9][2]) return false;\r\n}\r\n//          else if (pref[embed_mode].popup2==='sr' || pref[embed_mode].popup2==='srpv') tgt_th[10] = catalog_filter_query_keyword.kwd_make_result(tgt_posts);\r\n        }\r\n        return true;\r\n      }\r\n////      cataLog.catalog_filter_query = catalog_filter_query;\r\n////      Clg.prototype.filter_list = function(name, tgt_th){ // working code\r\n////          var val = pref_func.merge_obj5(name, this.pref.filter.list_obj2,null);\r\n////        return (!val)? [true] : (val.time)? [(val.time<(tgt_th[8][4]||tgt_th[8][0])), val.time] : [false];\r\n////      }\r\n//      function catalog_filter_changed(){ // patch // working code\r\n//        var clgs = Clg.prototype.Clgs;\r\n//        for (var i=0;i<clgs.length;i++) clgs[i].filter_changed();\r\n//      }\r\n//      Clg.prototype.filter_changed = function(){ // working code\r\n////if (pref.test_mode['60']) {        \r\n////        if (pref.filter.kwd.use || pref.filter.tag || pref.filter.time || pref.filter.list) for (var th in threads) threads[th][9] = catalog_filter_query(th);\r\n////        else {\r\n//////          for (var th in threads) threads[th][9] = [true];\r\n////          for (var th in threads) threads[th][9][0] = true;\r\n////          gClg.drawn_idx = 0;\r\n////        }\r\n////} else {\r\n//        var pf = this.pref.filter;\r\n//        var val = (pf.kwd.use || pf.tag || pf.time || pf.list)? null : true;\r\n//        for (var th in this.threads) this.threads[th][9][0] = val;\r\n////        this.drawn_idx = 0;\r\n////}  \r\n//        if (show_catalog) this.show_catalog(0); // 'if (show_catalog)' is a patch.\r\n////console.log('filter_changed');\r\n////        catalog_refresh_gather_info(); // cut at 2015.05.15.\r\n//      }\r\n//      cataLog.catalog_filter_changed = catalog_filter_changed;\r\n\r\n////      var pop_up_delay_id = {}; // working code\r\n////      function pop_up_delay(e,name){\r\n////        if (pref[embed_mode].popup2==='no' || pref[embed_mode].popup2==='sr' && !pref.filter.kwd.active) return; \r\n//////        if (threads[name][0].style.width=='' && threads[name][0].style.height=='' && pref.catalog_no_popup_at_expanded) return;\r\n////        if (pref.catalog_popdown=='imm' || pop_up_status[name]) pop_up_op(e,name); // patch\r\n////        else {\r\n////          if (pop_up_delay_id[name]) clearTimeout(pop_up_delay_id[name]);\r\n////          else { // init\r\n////            threads[name][0].addEventListener('mousemove' , threads[name][2][1]);\r\n////            threads[name][6] = function(){clearTimeout(pop_up_delay_id[name]);};\r\n////            threads[name][0].addEventListener('mouseout'  , threads[name][6]);\r\n////          }\r\n////          pop_up_delay_id[name] = setTimeout(function(){pop_up_op(e,name);},pref.catalog_popup_delay);\r\n////        } \r\n////      }\r\n////      function pop_up_op(e,name){\r\n////        if (pop_up_status[name]) {\r\n////          pop_keep_event(name);\r\n////          return;\r\n////        }\r\n////        var ch = threads[name][0];\r\n////        if (pop_up_delay_id[name]) {\r\n////          ch.removeEventListener('mousemove' , threads[name][2][1]);\r\n////          ch.removeEventListener('mouseout'  , threads[name][6]);\r\n////          delete pop_up_delay_id[name];\r\n////        }\r\n////        var pn = pop_up_set_contents(null, pref[embed_mode].popup2, name);\r\n////        if (pn) {\r\n////          site2['DEFAULT'].popups_posts.set_pos(pn,e);\r\n////          site.popup_body.appendChild(pn);\r\n////        }\r\n////        if (pref.catalog_popup_size_fix) { \r\n////          pn.style.width  = pn.offsetWidth + 'px';\r\n////          pn.style.height = pn.offsetHeight + 'px';\r\n////        }\r\n////        pop_up_status[name] = [null, function(){pop_down_event(name);}, function(){pop_keep_event(name);}, ch, pn];\r\n////        if (pref[embed_mode].popup2==='chart') {\r\n////          if (chart_obj && pref3.stats.use) {\r\n////            pop_up_status[name][5] = new chart_obj.PostChart(pn,[name]); // must be after appendChild to draw. (just to call destroy?)\r\n////          } else pn.innerHTML = 'Statistics needs to be activated.';\r\n////        }\r\n////        if (pref.catalog_popdown=='imm') {\r\n////          if (document.documentElement.clientHeight/2-e.clientY>0) {\r\n////            if (parseInt(pn.style.top.replace(/px/,''),10) + pn.offsetHeight > document.documentElement.clientHeight) {\r\n////              if (pn.offsetHeight > document.documentElement.clientHeight) pn.style.top = '0px';\r\n////              else {pn.style.top = null; pn.style.bottom = '0px';}\r\n////            }\r\n////          } else if (parseInt(pn.style.bottom.replace(/px/,''),10) + pn.offsetHeight > document.documentElement.clientHeight) {pn.style.bottom = ''; pn.style.top = '0px';}\r\n////        } else {\r\n////          pn.addEventListener('mouseover', pop_up_status[name][2], false);\r\n////          pn.addEventListener('mouseout', pop_up_status[name][1], false);\r\n////        }\r\n////        ch.addEventListener('mouseout', pop_up_status[name][1], false);\r\n////      }\r\n////      function pop_keep_event(name){\r\n////        if (pop_up_status[name][0]) {clearTimeout(pop_up_status[name][0]);pop_up_status[name][0]=null;}\r\n////      }\r\n////      function pop_down_event(name){\r\n////        if (!pop_up_status[name][0]) pop_up_status[name][0] = setTimeout(function(){pop_down_op(name);},(pref.catalog_popdown=='imm')? 0 : pref.catalog_popdown_delay);\r\n////      }\r\n////      function pop_down_op(name){\r\n////        if (pop_up_status[name][5]) pop_up_status[name][5].destroy();\r\n//////        if (pop_up_status[name]==undefined) return;\r\n////        var ch = pop_up_status[name][3];\r\n////        var pn = pop_up_status[name][4];\r\n////        ch.removeEventListener('mouseout' , pop_up_status[name][1], false);\r\n////        if (pref.catalog_popdown!='imm') {\r\n////          pn.removeEventListener('mouseover', pop_up_status[name][2], false);\r\n////          pn.removeEventListener('mouseout' , pop_up_status[name][1], false);\r\n////        }\r\n////        if (threads[name][12]) threads[name][12] = remove_open_new_thread_event(threads[name][12]);\r\n////        pn = cnst.div_destroy(pn,true);\r\n////        delete pop_up_status[name]; //prevent memory leak.\r\n////      }\r\n      Clg.prototype.pop_up_set_contents = function(pn, kind, name, kwd){\r\n        var flag_search = kind==='sr' || kind==='srpv';\r\n        var posts_active = kwd || pref.filter.kwd.posts_active;\r\n        var tgt_th = this.merge_bases.bases[name] || this.threads[name];\r\n        var posts = tgt_th[16].recent_posts(flag_search && posts_active && pref[embed_mode].sourceOfSP==='auto'? -1 : null);\r\n        var th = {posts: posts, __proto__:posts[0]};\r\n//        var th = {posts: threads[name][16].recent_posts(flag_search && posts_active && pref[embed_mode].sourceOfSP==='auto'? -1 : null),\r\n////          type_data: 'json', // BUG, lth.ta.posts may contain different type of data, see archiver.store_th_to_mem and archiver.check_deleted_posts. // NEED TO BE MODIFIED\r\n//          __proto__:threads[name][7] || threads[name][16]};\r\n////        var th = threads[name][7] || threads[name][16];\r\n////        var th = threads[name][7];\r\nif (!pref.test_mode['49'] && posts_active && th) {\r\n        format_html.prepare_html_prep_posts(th); // REDUNDANT for 2nd times or later.\r\n        var search_result = (flag_search)? catalog_filter_query_keyword.kwd_make_result(th.posts, th.domain, kwd) : null; // lazy\r\n}\r\n        if (kind==='sr' && !search_result) return;\r\n        if ((this.view==='page' || this.view==='thread') && (kind==='pv' || kind==='srpv' && !search_result)) return;\r\n//        if (!pn) pn = cnst.init('pop:border:1px solid blue');\r\n//        if (kind!=='chart') {\r\n//////if (!pref.test_mode['49']) {\r\n////          if (th) {\r\n            var lth = th.lth;\r\n            th = (kind==='dp')? {posts:[{search_result:false, __proto__:th.posts[0]}].concat(lth && lth.pd || []), __proto__:th} :\r\n  (kind!=='pv' && search_result && {posts:search_result, __proto__:th}) || (th.posts = th.posts.slice(), th); // slice for wrapping; th contains lth.ta.posts itself when posts are less than required.\r\n            if (kind==='dp' || !(kind!=='pv' && search_result)) format_html.prepare_html_prep_posts(th); // REDUNDANT for 2nd times or later.\r\n//            insert_thread_prepare_html_lazy(threads[name], !threads[name][0], false, true); // is this the better? not debugged yet.\r\n//            for (var i=0;i<th.posts.length;i++) th.posts[i] = Object.create(lth.q && lth.q[th.posts[i].no] || th.posts[i]); // wrap for re-assining pn, otherwise this causes a problem when popupX in embed_mode===page. // Backlink tracking system tries to add backlinks to lth.q[no].pn instead of th.posts[i].pn. lth.q stores oldest shown pn, while th.posts stores newest loaded posts. This might ought to be consolidated, but I haven't resolved how it should be handled. // BUG, THIS DOESN'T WORK ALSO, BECAUSE th.posts[i] is wrapped but the function popups_add tries to add backlinks to thq[no] directly.\r\n            site2[th.domain].popups_prep(lth); // lth instead of th, but ok\r\n            for (var i=0;i<th.posts.length;i++) th.posts[i] = Object.create(th.posts[i]); // wrap for re-assining pn, otherwise this causes a problem when popupX in embed_mode===page.\r\n            var pn_result = site2[site.nickname].page_json2html3(th, kwd, {}, null, kwd);\r\n            site2['DEFAULT'].check_reply.set_own_posts(th); // must before add_you in prepare_html_post\r\n            for (var i=0;i<th.posts.length;i++) cataLog.format_html.prepare_html_post(th, th.posts[i], lth.q);\r\n//            if (!pref.test_mode['98'] && pref[embed_mode].popup) format_html.prep_anchor_links(pn_result, th);\r\n//            if (!pref.test_mode['98'] && pref[embed_mode].popup) site2[th.domain].popups_add(th.posts, th, !kwd); // !kwd for test_mode['121'] // make backlink data beforehand. This prepares html for thq[no] in vain, but acceptable. This is required after prep_anchor_links and before format_pn, because internal function popups_href2dbtp requires thread.no in href, and the function backlink() in format_pn will add backlinks according to the data which is generated by popups_add.\r\n//            if ((search_result || kind==='dp') && th.posts[0].search_result===false) site2[th.domain_html].update_posts0_class(th.posts[0].pn, th.posts[0].search_result);\r\n//            for (var i=0;i<th.posts.length;i++) site2[th.domain_html].format_pn(th.posts[i].pn, lth && lth.q && lth.q[th.posts[i].no], null, th.posts[i], th); // SHOULD CHANGE TO USE prepare_html_post to mark editing and consolidate control flow.\r\n            if (pref[embed_mode].mark_new_posts) this.view_update_draw_merged(th);\r\n//            if (!pref.test_mode['98'] && pref[embed_mode].popup) site2[th.domain].popups_add(th.posts, th, false, false, !kwd); // !kwd for test_mode['121']\r\n            if (kwd && !th.posts[0].search_result) Array.prototype.forEach.call(pn_result.getElementsByClassName('CatChan_search_miss'), function(v){v.style.display = 'none';});\r\n//            pn.name = th.key; // obsolete\r\n            gGEH.pns_all_keys.set(pn,th.key);\r\n//          } else pn_result = document.createTextNode('You must be set to store posts at least 1, see \\'Catalog\\' tab in settings.');\r\n          pn.appendChild(pn_result);\r\n          var obj = {threads:{}, pref:pref, noBlur:true};\r\n          obj.threads[name] = {0:pn.childNodes[0]}; // , 22:null};\r\n          Clg.prototype.view_attr_set.call(obj, name, true);\r\n//          catalog_attr_set(name,pn.childNodes[0]);\r\n////} else {\r\n////          pn.innerHTML = threads[name][3][0];\r\n////          trim_html(pn, threads[name][3][1], pref[embed_mode].format.hover, name);\r\n////          trim_html_mark_time(pn, threads[name][3][1], pref[embed_mode].format.hover, name);\r\n////          var nickname = name.replace(/\\/.*/,'');\r\n//////        if (pref.filter.list_mark_time && threads[name][9][1]) site2[nickname].mark_newer_posts(pn,threads[name][9][1]);\r\n////          var date = get_mark_time(name, pref[embed_mode].mark_new_posts, pref[embed_mode].mark_new_posts, pref[embed_mode].mark_new_posts);\r\n////          if (date>0) site2[nickname].mark_newer_posts(pn,date);\r\n////          threads[name][12] = add_open_new_thread_event(name,site2[nickname].modify_thread_link(pn));\r\n////          catalog_attr_set(name,pn);\r\n////}\r\n//        }\r\n        return pn;\r\n      }\r\n\r\n//      var page_delim = [];\r\n//      for (var i=0;i<site.max_page;i++) page_delim[i] = null;\r\n//      var page_delim_idx = [];\r\n\r\n      var load_list = {refresh: {key:'',    idx:0, tgts:null, mutex:true, use_cache:false, from_auto:false, page_check:true },\r\n                       ondemand:{key:'odl', idx:0, tgts:null, mutex:true, use_cache:false, from_auto:false, page_check:false},\r\n                       tag:     {key:'tag', idx:0, tgts:null, mutex:true, use_cache:true,  from_auto:false, page_check:false}};\r\n      var filter_tags_refresh_mem = {};\r\n      var refresh_use_cache = false;\r\n      Clg.prototype.prep_reserved_tags = function(set,idx, not_initial){\r\n        var tags = pref.catalog_board_list_obj[idx] && pref.catalog_board_list_obj[idx][0].tags || null;\r\n        if (tags && not_initial) tags = tags.filter(function(v){return v[0]==='#' && v[1]==='#';});\r\n//        if (tags && not_initial) for (var i=tags.length-1;i>=0;i--) if (tags[i][1]!=='#') tags.splice(i,1);\r\n        return (tags)? this.liveTag.tags_reserved_init(tags,set) : null;\r\n      };\r\n//      function prep_reserved_tags(set,idx){ // working code.\r\n//        var tags = pref.catalog_board_list_obj[idx][0].tags || null;\r\n//        if (tags) {\r\n//          tags = tags.slice();\r\n//          liveTag.set_reserved_tags(tags,set);\r\n//          if (set) liveTag.reserved = (tags.length!==0)? tags : null;\r\n//        }\r\n//      }\r\n      Clg.prototype.make_refresh_list_from_watch_list = function(){\r\n        var tgts = []\r\n        var obj2 = this.pref.filter.watch_list_obj2;\r\n        var obj = obj2[':REV'];\r\n        for (var db in obj) {\r\n          var tgts_db = [];\r\n          for (var t in obj[db]) if (obj2[db+t].time>0) {\r\n            if (obj2[db+t].cmd && obj2[db+t].cmd['PRUNED'] && this.threads[db+t]===undefined) {\r\n              var idx = db.indexOf('/');\r\n              var domain = db.slice(0,idx);\r\n              var board = db.slice(idx);\r\n              this.insert_thread_dummy(domain, board, t);\r\n              if (pref.archive.IDB.auto_restore_watch) restore_th_from_IDB(domain, board, t, this);\r\n            }\r\n            else tgts_db[tgts_db.length] = db+t;\r\n          }\r\n          if (tgts_db.length>=pref[this.mode].refresh_src_th) tgts[tgts.length] = db;\r\n          else tgts = tgts.concat(tgts_db);\r\n        }\r\n//        for (var db in obj) if (Object.keys(obj[db]).length>=pref.float.refresh_src_th) tgts[tgts.length] = db;\r\n//        else for (var t in obj[db]) tgts[tgts.length] = db+t;\r\n        return {tgts:tgts};\r\n//        var obj = this.pref.filter.watch_list_obj2;\r\n//        for (var name in obj) if (name!==':REV') tgts[tgts.length] = name;\r\n//        return {tgts:tgts};\r\n      };\r\n      function make_refresh_list(sel,bookmark_list_str, refresh, not_initial){\r\n//      function make_refresh_list(remove_attr){\r\n        var tgts = [];\r\n        var tgt_domains = {};\r\n        if (site.whereami==='boards' && sel==0) pref_func.str2obj('catalog_board_list_str');\r\n        var blist = pref.catalog_board_list_obj[sel].slice();\r\n        var domains = blist[0].domains_for_all_boards;\r\n        if (domains) {\r\n          for (var i=0;i<domains.length;i++) {\r\n            var domain = domains[i];\r\n            if (!site3[domain].boards) return function(callback){ // singlelined because this may cause infinite loop if reading boards_json is failed.\r\n              site2[domain].get_boards_json('refresh_boards_json',callback,false,health_indicator);};\r\n//            if (!site3[domain].boards) {\r\n//              site2[domain].get_boards_json('refresh_boards_json',reentry_func,false,health_indicator);\r\n//              return tgts; // singlelined because this may cause infinite loop if reading boards_json is failed.\r\n//            }\r\n          }\r\n          for (var i=0;i<domains.length;i++)\r\n            if (refresh && site2[domains[i]].utilize_boards_json && pref.pref2[domains[i]].utilize_boards_json && pref.pref2[domains[i]].utilize_boards_json_domain)\r\n              tgt_domains[domains[i]] = null;\r\n            else for (var j in liveTag.mems[domains[i]]) blist[blist.length] = liveTag.mems[domains[i]][j];\r\n        }\r\n        var bds_picked_up_by_tags = pClg.prep_reserved_tags(true,sel, not_initial);\r\n        for (var bd in bds_picked_up_by_tags) {\r\n          for (var j=1;j<blist.length;j++) if (blist[j].key===bd) break;\r\n          if (j==blist.length) blist[blist.length] = liveTag.mems.getFromName(bd); // scan.add_board(bd);\r\n        }\r\n        if (bookmark_list_str) tgts = bookmark_list_str.replace(/\\s*\\/\\/.*$/mg,',').replace(/\\n/g,',').replace(/,,+/g,',').replace(/^,/,'').replace(/,$/,'').split(',');\r\n        if (tgts[0]==='') tgts = [];\r\n//        var page_str = (pref.catalog.design==='page')? 'p' : 'c';\r\n        var j = 0;\r\n        while (blist.length>1) {\r\n          for (var i=1;i<blist.length;i++) {\r\n            var key = blist[i].key.replace(/\\s/g,''); // replace... is redundant\r\n            var dbt = cnst.name2domainboardthread(key,true);\r\n            var max_page_bd = pref.catalog_max_page_select==='auto' && liveTag.mems[dbt[0]] && liveTag.mems[dbt[0]][dbt[1]] && liveTag.mems[dbt[0]][dbt[1]].pgs || pref.catalog_max_page;\r\n            if (dbt[2]) {\r\n              if (j==0) tgts.push(key);\r\n              else blist.splice(i--,1)\r\n            } else if ((!blist[i].max_page || j<blist[i].max_page) && j<max_page_bd) tgts.push(key+ ((pref.catalog.catalog_json)? 'q':'p') +j);\r\n            else blist.splice(i--,1)\r\n          }\r\n          j++;\r\n        }\r\n\r\n////        for (var j=0;j<pref.catalog_max_page;j++) // working code.\r\n////          for (var i=1;i<blist.length;i++) {\r\n//////            if (blist[i]['key'].search(/[^\\/]*\\/[^\\/]*\\/[0-9]+/)!=-1) {if (j==0) tgts.push(blist[i]['key']);} // working code.\r\n////            var key = blist[i].key.replace(/\\s/g,''); // replace... is redundant\r\n////            if (common_func.fullname2dbt(key)[2]) {if (j==0) tgts.push(key);}\r\n////            else if (!blist[i].max_page || j<blist[i].max_page) tgts.push(key+ ((pref.catalog.catalog_json)? 'q':'p') +j);\r\n////          }\r\n//////        if (remove_attr) for (var i=0;i<tgts.length;i++) tgts[i] = tgts[i].replace(/!.*/,'');\r\n//////        for (var i=tgts.length-1;i>=0;i--) { // working code\r\n//////          var dbt = cnst.name2domainboardthread(tgts[i],true);\r\n//////          if (tgts[i].indexOf(dbt[1])==-1) tgts[i] = dbt[0] + dbt[1] + tgts[i];\r\n//////          else if (tgts[i].indexOf(dbt[0])==-1) tgts[i] = dbt[0] + tgts[i];\r\n//////        }\r\n        return {tgts:tgts, tgt_domains:tgt_domains};\r\n      }\r\n      function trim_list(tgts,embed_init, mode){\r\n        if (pref.catalog.board.ex_list) {\r\n          for (var i=tgts.length-1;i>=0;i--) {\r\n            var val = pref_func.merge_obj5(tgts[i],pref.catalog.board.ex_list_obj2,null);\r\n            if (val) tgts.splice(i,1);\r\n          }\r\n        }\r\n        if (pref.catalog.design==='catalog' || (pref.catalog.design==='auto' && mode==='catalog') || mode==='chart') {\r\n          for (var i=tgts.length-1;i>=0;i--) {\r\n            var dbt = cnst.name2domainboardthread(tgts[i],true);\r\n            if ((site2[dbt[0]].trim_list!=='no' || mode==='chart') && tgts[i].search(/\\/[pq][0-9]*/)!=-1) {\r\n//            if ((dbt[0]==='8chan' ||dbt[0]==='4chan') && tgts[i].search(/\\/p[0-9]*/)!=-1) {\r\n//            if (dbt[0]==='8chan' && tgts[i].search(/\\/p[0-9]*/)!=-1) {\r\n//              if (tgts[i].search(/\\/p0$/)!=-1 && (!embed_init || dbt[1]!=site.board)) tgts[i] = tgts[i].replace(/p0/,(pref.catalog.catalog_json)? 'j0' : 'c0');\r\n              if (tgts[i].search(/\\/[pq]0$/)!=-1 && (!embed_init || dbt[1]!=site.board || dbt[0]!=site.nickname || (site2[dbt[0]].trim_list==='force_init' || pref3.stats.use)))\r\n                tgts[i] = tgts[i].replace(/[pq]0$/,(pref.catalog.catalog_json || site2[dbt[0]].trim_list==='force_init')? 'j0' : 'c0');\r\n              else if (tgts[i].search(/\\/[pq]\\d+$/)!=-1) tgts.splice(i,1); // ratain thread\r\n            }\r\n          }\r\n        }\r\n        if (mode==='page' && embed_init) { // patch\r\n          if (pref.liveTag.use) {\r\n            var bds = {};\r\n            for (var i=0;i<tgts.length;i++) {\r\n              var dbt = cnst.name2domainboardthread(tgts[i],true);\r\n              bds[dbt[0]+dbt[1]+((pref.catalog.catalog_json)? 'j0':'c0')] = null; // add a catalog for scan all thread.\r\n            }\r\n            for (var i in bds) tgts[tgts.length] = i;\r\n//            cataLog.scan_init('init_tag',bds, {tag_only:true});\r\n          }\r\n//          if (pref.liveTag.use) { // working code.\r\n//            for (var i=0;i<tgts.length;i++) {\r\n//              var dbt = cnst.name2domainboardthread(tgts[i],true);\r\n//              scan.list_nup.add_board(dbt[0]+dbt[1]);\r\n//            }\r\n//          }\r\n          if (tgts[0] && tgts[0].search(site.nickname+site.board+'[pq]0')===0) tgts.splice(0,1);\r\n////          var site_db = site.nickname+site.board;\r\n////          for (var i=0;i<tgts.length;i++) { // working code, but obsolete.\r\n////            if (tgts[i].indexOf(site_db)===0) {\r\n////              if (tgts[i].search(site_db+'[pq]0')===0) tgts.splice(i--,1)[0];\r\n////              else if (pref[mode].load_on_demand) threads_idx[threads_idx.length] = ':DL:'+tgts.splice(i--,1)[0];\r\n////            }\r\n////          }\r\n          if (pref[mode].load_on_demand) pClg.drawn_idx = 0;\r\n        }\r\n//        if (mode==='thread') { // patch\r\n//          if (board_sel.selectedIndex===0) {\r\n//            if (embed_init) tgts.splice(0,1);\r\n//            else tgts = [site.nickname + site.board + site.no];\r\n//          }\r\n//        }\r\n        for (var i=tgts.length-1;i>=0;i--) {\r\n          var dbt = common_func.name2dbt(tgts[i]);\r\n          var url = site2[dbt[0]] && site2[dbt[0]].make_url4(dbt, pref.catalog.design!=='page' && (pref.catalog.order.ordering!==0 || pref.liveTag.from!=='none')); // trim for 4chan. // !=='none' IS ALWAYS TRUE, WHY... // site2[dbt[0]] check for testing new domains\r\n          if (!url) tgts.splice(i,1);\r\n          else if (url[2] && url[2]!==tgts[i]) {\r\n            if (tgts.indexOf(url[2])!=-1) tgts.splice(i,1);\r\n            else tgts[i] = url[2];\r\n          }\r\n//          if (!site2[dbt[0]].make_url4(dbt)) tgts.splice(i,1);\r\n        }\r\n        return tgts;\r\n      }\r\n\r\n\r\n//      function remove_threads_events(name){\r\n//        if (pref.test_mode['127']) if (threads[name][0]) threads[name][0].removeEventListener('mouseover', threads[name][2][0], false);\r\n//        if (pref.test_mode['104']) common_func.dom_removeEventListener(threads[name][5]);\r\n//        if (threads[name][11]) threads[name][11] = remove_open_new_thread_event(threads[name][11]);\r\n//      }\r\n//      function remove_thread(name, pn_only){\r\n//        var ref = threads_idx.indexOf(name);\r\n//        if (name.substr(0,4)!==':DL:') {\r\n//          if (!threads[name]) return;\r\n//          var dbt = common_func.fullname2dbt(name);\r\n//          var lth = liveTag.mems.getFromName(name);\r\n//          if (!pn_only) if (lth.q) site2[dbt[0]].popups_release_all(lth, {}); // remove cross thread/board links.\r\n////          if (!pn_only) if (threads[name][16].popups) for (var i in threads[name][16].popups) site2[dbt[0]].popups_release(lth, i); // remove cross thread/board links.\r\n//          remove_threads_events(name);\r\n//          if (threads[name][1]) {\r\n//            if (pop_up_status[name]) pop_down_op(name);\r\n////            if (threads[name][0].parentNode===triage_parent) { // working code.\r\n//////              if (pref.catalog_expand_with_hr && !embed_catalog) show_catalog_hr(name,'remove');\r\n//////              triage_parent.removeChild(threads[name][0]); // for 4chan's native\r\n////              catalog_obj2.func_hide(name);\r\n////            }\r\n//            if (threads[name][0] && threads[name][0].parentNode===triage_parent) pClg.func_hide(name); // parent check is for on_demand_draw\r\n//            site2['DEFAULT'].update_posts_merge_bases.remove_th(threads[name][16], true);\r\n////            if (threads[name][0] && threads[name][0].parentNode===triage_parent || pref[embed_mode].merge) // parent check is for on_demand_draw and merging threads.\r\n////              catalog_obj2.func_hide(name);\r\n//            if (ref<pClg.drawn_idx) pClg.drawn_idx = 0;\r\n//          }\r\n////          if (threads[16].archiveFile) {\r\n////            if (threads[16].archiveFile==='IDB') {\r\n////            } else {\r\n////              var files = threads[16].archiveFile;\r\n////              while (files) {\r\n////                for (var i in files) if (files[i].url) window.URL.revokeObjectURL(files[i].url);\r\n////                files = Object.getPrototypeOf(files);\r\n////              }\r\n////            }\r\n////          }\r\n////          if (lth) {\r\n////            delete lth.th;\r\n////            delete lth.ta;\r\n////            delete lth.pd;\r\n////          }\r\n//        }\r\n//        if (pn_only) {\r\n//          threads[name][0] = false;\r\n//          threads[name][1] = false;\r\n//          threads[name][16].th = threads[name][7];\r\n//          threads[name][16].posts = null;\r\n////          if (!threads[name][16].th) threads[name][16].th = threads[name][16];\r\n//          if (threads[name][24]) threads[name][24][0] = null;\r\n//          return;\r\n//        }\r\n//        delete threads[name]; // remove ':DL:' also\r\n//if (pref.debug_mode['2']) console.log('removed: '+name);\r\n////        for (var i=threads_idx.length-1;i>=0;i--) if (threads_idx[i]===name) {threads_idx.splice(i,1);break;}\r\n//        if (ref>=0) threads_idx.splice(ref,1);\r\n//if (pref.test_mode['95'] && site.nickname==='dist') site2[site.nickname].testPoster(name);\r\n//      }\r\n//      cataLog.remove_thread = remove_thread;\r\n//////      function remove_thread(name){ // working code.\r\n//////        if (name.substr(0,4)!==':DL:' && threads[name]) { // BUG. SHOULD WORK WITHOUT CHECKING threads[name]\r\n//////          var dbt = common_func.fullname2dbt(name);\r\n//////          if (threads[name][16].popups) for (var i=0;i<threads[name][16].popups.length;i++) site2[dbt[0]].popups_release(threads[name][16].popups[i]);\r\n////////        if (name.substr(0,4)!==':DL:') {\r\n////////          if (threads[name][16].th_destroy) threads[name][16].th_destroy(threads[name][0], threads[name][16].parse_funcs);\r\n//////          threads[name][0].removeEventListener('mouseover', threads[name][2][0], false);\r\n////////          threads[name][0].removeEventListener('click', threads[name][5], false);\r\n////////          for (var i=0;i<threads[name][5].length;i++) threads[name][5][i].removeEventListener('click', click_thread, false);\r\n//////          common_func.dom_removeEventListener(threads[name][5]);\r\n//////          if (threads[name][11]) remove_open_new_thread_event(threads[name][11]);\r\n//////          if (threads[name][1]) {\r\n////////            if (threads[name][12]) remove_open_new_thread_event(threads[name][12]);\r\n//////            if (pop_up_status[name]) pop_down_op(name);\r\n////////            triage_parent.removeChild(threads[name][0]);\r\n//////            if (threads[name][0].parentNode===triage_parent) triage_parent.removeChild(threads[name][0]); // for 4chan's native\r\n//////          }\r\n////////          if (threads[name][17][0][0].length!=0) liveTag.remove_tags_in_th(threads[name][17][0][0], name);\r\n////////          if (threads[name][17][1][0].length!=0) liveTag.remove_tags_in_th(threads[name][17][1][0], name);\r\n////////          liveTag.remove_tags_in_th(name);\r\n//////        }\r\n//////        delete threads[name]; // remove ':DL:' also\r\n//////if (pref.debug_mode['2']) console.log('removed: '+name);\r\n//////        for (var i=threads_idx.length-1;i>=0;i--) if (threads_idx[i]===name) {threads_idx.splice(i,1);break;}\r\n//////      }\r\n////////      function remake_boards(){\r\n////////        boards = {};\r\n////////        for (var name in threads) {\r\n////////          var dbt = cnst.name2domainboardthread(name,true);\r\n////////          boards[dbt[0]+dbt[1]] = null;\r\n////////        }\r\n////////      }\r\n      function catalog_refresh(refresh, embed_init, from_auto, from_switch) {\r\n        return pClg.refresh(refresh, embed_init, from_auto, from_switch);\r\n      }\r\n      Clg.prototype.refresh = function(refresh, embed_init, from_auto, from_switch) {\r\n        pref4.refresh.count++;\r\n        Footer.refresh_start();\r\n        for (var j=0;j<gClg.Clgs.length;j++) gClg.Clgs[j].footer.timestamp_set();\r\n//        this.footer.timestamp_set();\r\n        for (var j=0;j<gClg.Clgs.length;j++) gClg.Clgs[j].idx_refresh(this); // update timestamps in footer\r\n//        this.idx_refresh(this);\r\n//        gClg.footer.refresh_start();\r\n        if (!pref.test_mode['67'] && !embed_init) archiver.refresh_start();\r\n        if (!from_switch && !embed_init && pref.catalog.auto_save_filter_at_refresh) this.onchange_funcs['save']();\r\n        var result = this.refresh_1(embed_mode, refresh && this, embed_init, from_auto, 'refresh_'+this.serialNo, this.pref[this.mode].board_list_sel, this.pref.filter.bookmark_list_str, false, undefined, from_switch);\r\n        if (typeof(result)==='function') result(function(){catalog_refresh(refresh, embed_init, from_auto);});\r\n        else this.refresh_tgts = result;\r\n      }\r\n      Clg.prototype.refresh_1 = function(mode, refresh, embed_init, from_auto, scan_name, sel, bookmark_list_str, get_board_list, callback, from_switch) {\r\n        var tgts_bg = typeof(refresh)!=='object' || refresh.pref[refresh.mode].refresh_src.slice(0,2)==='bg'? make_refresh_list(sel, bookmark_list_str, refresh, !embed_init && !from_switch) : null;\r\n        var tgts_wl = typeof(refresh)==='object' && refresh.pref[refresh.mode].refresh_src.slice(-2)==='wl'? this.make_refresh_list_from_watch_list() : null;\r\n        var tgts_all = tgts_bg && tgts_wl? (tgts_bg.tgts = tgts_bg.tgts.concat(tgts_wl.tgts), tgts_bg) : tgts_bg || tgts_wl;\r\n//        var tgts_all = (typeof(refresh)==='object' && refresh.pref[refresh.mode].refresh_by_watchlist)? this.make_refresh_list_from_watch_list()\r\n//          : make_refresh_list(sel, bookmark_list_str, refresh, !embed_init && !from_switch);\r\n        if (typeof(tgts_all)==='function') return tgts_all; // must be reentried.\r\n        var tgts = tgts_all.tgts;\r\n        if (get_board_list) {\r\n          var bds = {};\r\n          for (var i=0;i<tgts.length;i++) {\r\n            var dbt = common_func.name2domainboardthread(tgts[i],true);\r\n            if (dbt[2][0].search(/^[pqcj]/)!=-1) bds[dbt[0]+dbt[1]] = null;\r\n            else bds[dbt[0]+dbt[1]+dbt[2].replace(/^t/,'')] = null; // patch\r\n          }\r\n        }\r\n        if (scan_name && pref3.stats.use && pref.stats.auto_acquisition_all) stats.register_auto_acquisition(sel);\r\n        tgts = trim_list(tgts,embed_init, mode);\r\n        var priority = (!refresh)? 0 : (from_auto)? 2:4;\r\n        var hi = refresh && refresh.health_indicator || health_indicator\r\n        if (tgts.length===0) {if (refresh) scan.scan_refresh(hi, tgts, priority, tgts_all.tgt_domains); return tgts;}\r\n        if (refresh) if (this.pref.INST.safety.remove && !embed_init) this.clear_threads(pref4.scan.max_threads_at_refresh(this), true);\r\n////////        load_on_demand.release(); // prevent from hanging up.\r\n        if (scan_name) scan_boards.scan_init(scan_name, tgts,\r\n                                             {refresh:refresh, indicator: hi,\r\n                                              callback: function(){scan.scan_refresh(hi, tgts, priority, tgts_all.tgt_domains);\r\n                                                                   if (callback) callback();},\r\n                                              from_auto:from_auto, load_on_demand:pref[mode].load_on_demand, priority:priority});\r\n        return (get_board_list)? Object.keys(bds) : tgts;\r\n      };\r\n      \r\n////      function catalog_refresh(refresh, embed_init, from_auto, indicator) { // working code.\r\n//////if (pref.debug_mode['0']) console.log(new Date().toLocaleTimeString() + ', refresh: start: ');\r\n//////        set_auto_update();\r\n////        if (pref.filter.time_ago_str_sync_at_refresh) ago_clicked();\r\n////        load_list.refresh.use_cache = !refresh;\r\n////        load_list.refresh.idx = 0;\r\n////        load_list.refresh.mutex = true;\r\n////        load_list.refresh.from_auto = from_auto;\r\n////        load_list.refresh.tgts = trim_list(make_refresh_list(board_sel,pref.filter.bookmark_list),embed_init);\r\n////        if (load_list.refresh.tgts.length===0) return;\r\n////        if (threads_candidates_of_deletion!==null) {\r\n////          for (var name in threads_candidates_of_deletion)\r\n////           if (threads[name] && threads_candidates_of_deletion[name]===((threads[name][8][0]>threads[name][8][4])? threads[name][8][0] : (threads[name][8][4] || threads[name][8][0]))) remove_thread(name);\r\n////          threads_candidates_of_deletion = null;\r\n////////////          remake_boards();\r\n////        }\r\n////        if (refresh && pref.catalog_refresh_clear && !embed_init) catalog_clear_threads(pref.catalog.max_threads_at_refresh, true);\r\n//////        for (var i=0;i<load_list.refresh.tgts.length;i++) load_list.refresh.tgts[i] = [load_list.refresh.tgts[i], from_auto];\r\n////////////        load_on_demand.release(); // prevent from hanging up.\r\n////        if (load_list.refresh.idx<load_list.refresh.tgts.length) {\r\n//////if (!pref.test_mode['15']) scan_boards.scan_init('refresh', load_list.refresh.tgts, {refresh:true, crawler_max:1, indicator:indicator, callback:catalog_refresh_watch});\r\n//////if (!pref.test_mode['15']) scan_boards.scan_init('refresh', load_list.refresh.tgts, {refresh:true, indicator:indicator, callback:catalog_refresh_watch, from_auto:from_auto, load_on_demand:pref[embed_mode].load_on_demand});\r\n////if (!pref.test_mode['15']) scan_boards.scan_init('refresh', load_list.refresh.tgts, {refresh:true, callback:catalog_refresh_watch, from_auto:from_auto, load_on_demand:pref[embed_mode].load_on_demand, priority:(from_auto)?2:4});\r\n////else {\r\n//////          health_indicator.shift('limegreen','0');\r\n////          load_list.refresh.indicator = indicator;\r\n////          get_page(load_list.refresh);\r\n////}\r\n////        } else catalog_refresh_watch();\r\n//////        scan_boards.scan_init('refresh_tag',filter_tags_refresh_mem,(refresh)? 0 : pref.scan.lifetime*60, catalog_refresh_watch);\r\n////if (pref.test_mode['22'])\r\n////        scan_boards.scan_init('refresh_tag', filter_tags_refresh_mem, {lifetime:((refresh)? 0 : pref.scan.lifetime*60), cache_write:true});\r\n////      }\r\n////      \r\n////////      function catalog_refresh_watch() { // working code.\r\n//////////console.log('test');\r\n////////        var tgts = {};\r\n////////        for (var name in threads) if (threads[name][21]) tgts[name] = null;\r\n////////        scan_boards.scan_init('refresh_watch', tgts, {callback:catalog_refresh_gather_info, refresh:true});\r\n//////////console.time('refresh_watch');\r\n//////////        scan_boards.scan_init('refresh_watch', tgts, {callback:catalog_refresh_gather_info, force_json:pref.catalog.order.find_sage_in_8chan});\r\n////////      }\r\n////////      cataLog.catalog_refresh_watch = catalog_refresh_watch;\r\n////      function catalog_refresh_watch() { // working code, @safe1080\r\n////        catalog_refresh_gather_info();\r\n////      }\r\n////      var missing_info = {};\r\n////      function catalog_refresh_gather_info() {\r\n////        var tgts = missing_info;\r\n////        missing_info = {};\r\n//////////////console.timeEnd('refresh_watch');\r\n////////////        var tgts = {};\r\n////////////        for (var name in threads) {\r\n////////////          if (!pref.filter.time && !pref.filter.list && !threads[name][9][0]) continue;\r\n//////////////          var dbt = common_func.name2domainboardthread(name);\r\n//////////////          if (dbt[0]==='8chan' && pref.catalog.indexing==4 && threads[name][23]) tgts[name] = true; // get time of sage post in 8chan from json.\r\n//////////////          if (pref.catalog.indexing==4 && threads[name][23] && threads[name][23].time_posted===null) tgts[name] = true; // get time_posted\r\n////////////          if (pref.catalog.indexing==4 && threads[name][8][4]===undefined) tgts[name] = true; // get time_posted\r\n//////////////          if (!threads[name][9][0]) continue;\r\n//////////////          if (dbt[0]==='8chan' && pref.catalog.order.sticky!=='dont_care' && threads[name][20]===null) tgts[dbt[0]+dbt[1]] = true; // get sticky in 8chan from json.\r\n////////////        }\r\n//////////////console.log(tgts);\r\n////        scan_boards.scan_init('refresh_watch', tgts, {tgt_raw: true,\r\n////                                                      callback: function(){scan.scan_refresh(health_indicator);}});\r\n//////                                                      callback: (pref.liveTag.utilize_boards_json)? catalog_refresh_boards : catalog_liveTag_scan_boards,\r\n//////                                                      callback_args: (pref.liveTag.utilize_boards_json)? 'refresh_watch' : null});\r\n//////        if (pref.liveTag.utilize_boards_json && embed_mode==='catalog') catalog_liveTag_scan_threads(); // patch for 8chan, boards_json is too heavy.\r\n////      }\r\n////\r\n////      function catalog_refresh_boards() { // patch for 8chan // working code, @safe1069\r\n//////        if (liveTag.mems['8chan']) {\r\n//////          var tgts = scan.list_nup.get_list_board('8chan',true);\r\n////////          if (tgts.length!=0) http_req.get('refresh_watch','8chan,boards_json,boards_json,boards_json',site2['8chan'].url_boards_json(),catalog_refresh_boards_callback,0,true,catalog_liveTag_scan_boards);\r\n//////          if (tgts.length!=0) site2['8chan'].get_boards_json('refresh_watch',catalog_liveTag_scan_boards,true,health_indicator);\r\n//////          else catalog_liveTag_scan_boards();\r\n//////        } else catalog_liveTag_scan_boards();\r\n////        if (scan.list_nup.query_list_board('8chan')) {\r\n////          site2['8chan'].get_boards_json('refresh_watch',catalog_liveTag_scan_boards,true,health_indicator);\r\n////          return;\r\n////        }\r\n////        catalog_liveTag_scan_boards();\r\n////      }\r\n////////////      function catalog_refresh_boards_callback(key,value,callback){\r\n//////////////if (pref.debug_mode['7']) console.log('boards_json:');\r\n////////////        if (value.status==200) {\r\n////////////          var dbt = key.split(',');\r\n////////////          site2[dbt[0]].postprocess_board(value.response);\r\n////////////////          site3[dbt[0]].boards = value.response.boards || value.response; // patch for 8chan. WHY DO THEY CHANGE THE SPEC REPEATEDLY WITHOUT A PARTICULAR REASON??? // working code.\r\n////////////////          site3[dbt[0]].boards_to_scan = null;\r\n////////////////          if (site2[dbt[0]].make_site3_bds) site2[dbt[0]].make_site3_bds();\r\n////////////        }\r\n////////////        if (callback) callback();\r\n////////////      }\r\n////\r\n////      var mutex_wd_liveTag_scan_boards = new MutexWatchdog('scan');\r\n////      function catalog_liveTag_scan_boards(domain) {\r\n////        if (pref.liveTag.use) {\r\n////          if (!mutex_wd_liveTag_scan_boards.get()) {catalog_refresh_end(); return;}\r\n////          if (pref.debug_mode['7']) var d_str = '';\r\n////          var tgts = scan.list_nup.get_list_board(domain);\r\n////////          var tgts = []; // working code.\r\n////////          var time_th = Date.now()-pref.liveTag.pickup_interval*1000;\r\n////////          for (var i in scan.list_nup_boards) {\r\n////////            var dbt = common_func.fullname2dbt(i);\r\n////////            if (scan.list_nup_boards[i].time<time_th && (!scan.list_nup_boards[i].max || scan.list_nup_boards[i].max<liveTag.mems[dbt[0]][dbt[1]].max)) {\r\n////////              tgts[tgts.length] = i;\r\n////////              if (pref.debug_mode['7']) d_str += i + ':' +scan.list_nup_boards[i].max+'/'+liveTag.mems[dbt[0]][dbt[1]].max+', ';\r\n////////            }\r\n////////          }\r\n////          if (pref.debug_mode['7']) for (var i=0;i<tgts.length;i++) d_str += tgts[i].key + ':' +tgts[i].read_max+'/'+tgts[i].max+', ';\r\n////          if (Object.keys(tgts).length!=0) {\r\n////            scan_boards.scan_init('scan', tgts, {callback: catalog_liveTag_scan_boards_cont,\r\n////                                                 watchdog: mutex_wd_liveTag_scan_boards.restart.bind(mutex_wd_liveTag_scan_boards),\r\n////////////                                                 crawler_watchdog: true\r\n//////                                                 priority: 1,\r\n////                                                });\r\n////            if (pref.debug_mode['7']) console.log('catalog_liveTag_scan_boards: '+tgts.length+', '+d_str);\r\n////          } else {\r\n////            mutex_wd_liveTag_scan_boards.stop();\r\n////            catalog_liveTag_scan_threads();\r\n////          }\r\n////        } else catalog_liveTag_scan_threads();\r\n////      }\r\n////      function catalog_liveTag_scan_boards_cont() {\r\n////        mutex_wd_liveTag_scan_boards.stop();\r\n////        if (mutex_wd_liveTag_scan_boards.query_req()) catalog_liveTag_scan_boards();\r\n////        else catalog_liveTag_scan_threads();\r\n////      }\r\n////      function catalog_liveTag_scan_cancel() {\r\n////        mutex_wd_liveTag_scan_boards.abort();\r\n////        scan_boards.scan_abort('scan');\r\n////        mutex_wd_liveTag_scan_threads.abort();\r\n////        scan_boards.scan_abort('scan_threads');\r\n////      }\r\n////\r\n////      var catalog_liveTag_scan_threads_delayed_do = DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(catalog_liveTag_scan_threads, 200));\r\n////      var mutex_wd_liveTag_scan_threads = new MutexWatchdog('scan_threads');\r\n////      function catalog_liveTag_scan_threads() {\r\n////        if (!mutex_wd_liveTag_scan_threads.get()) {catalog_refresh_end();return;} // multi entry.\r\n////////        var tgts = []; // working code.\r\n////////        for (var i in scan.list_nup)\r\n////////////          if (scan.list_nup[i]!==null) {\r\n////////////            scan.list_nup[i] = null;\r\n////////////            tgts[tgts.length] = i;\r\n////////////          } else delete scan.list_nup[i];\r\n//////////          if (--scan.list_nup[i]>=0) tgts[tgts.length] = i; // leave nodes of <0 as black listed, patch for 8chan.\r\n////////          if (scan.list_nup[i]>0) tgts[tgts.length] = i;\r\n////        var tgts = scan.list_nup.get_list_thread();\r\n////        if (Object.keys(tgts).length!=0) scan_boards.scan_init('scan_threads', tgts, {callback: catalog_liveTag_scan_threads_cont,\r\n////                                                                                      watchdog: mutex_wd_liveTag_scan_threads.restart.bind(mutex_wd_liveTag_scan_threads),\r\n////////////                                                                                      crawler_watchdog: true\r\n////                                                                                     });\r\n////        else {\r\n////          mutex_wd_liveTag_scan_threads.stop();\r\n////          catalog_refresh_end();\r\n////        }\r\n////      }\r\n////      function catalog_liveTag_scan_threads_cont() {\r\n////        mutex_wd_liveTag_scan_threads.stop();\r\n////        if (mutex_wd_liveTag_scan_threads.query_req()) catalog_liveTag_scan_threads();\r\n////        else catalog_refresh_end();\r\n////      }\r\n////      cataLog.catalog_liveTag_scan_threads = catalog_liveTag_scan_threads;\r\n////      cataLog.catalog_liveTag_scan_threads_delayed_do = catalog_liveTag_scan_threads_delayed_do;\r\n\r\n      function catalog_refresh_end(){\r\n        if (pref.notify.favicon || pref.notify.title.notify) notifier.favicon.set(threads);\r\n//        if (pref.liveTag.style) liveTag.refresh_end_proc();\r\n//if (pref.debug_mode['9']) for (var i in scan.list_nup) if (scan.list_nup[i]<=0) console.log('list_nup: '+i+', '+scan.list_nup[i]);\r\n        if (pref.debug_mode['3']) {\r\n          var th_count = 0;\r\n          for (var d in liveTag.mems) for (var b in liveTag.mems[d]) for (var t in liveTag.mems[d][b]) th_count++;\r\n          var ths = {};\r\n          for (var i in liveTag.tags_ci) for (var j of liveTag.tags_ci[i].mems.keys()) ths[j.key] = null;\r\n          console.log('refresh_end: tags_ci+tags: '+Object.keys(liveTag.tags_ci).length+'+'+Object.keys(liveTag.tags).length+', threads:'+th_count+', '+Object.keys(ths).length);\r\n        }\r\n        if (pref[embed_mode].load_on_demand) show_catalog();\r\n      }\r\n      cataLog.catalog_refresh_end = catalog_refresh_end;\r\n\r\n////      var mutex_wd_liveTag_scan_ui = new MutexWatchdog('scan_ui'); // working code, @safe1069\r\n////      var liveTag_scan_ui_queue = {};\r\n////      function catalog_liveTag_scan_ui(key,arg) { // arg is {tgts:, options:}\r\n////        if (arg) {\r\n////          if (!liveTag_scan_ui_queue[key]) liveTag_scan_ui_queue[key] = {queue:[], mutex: new MutexWatchdog(key)};\r\n////          liveTag_scan_ui_queue[key].queue.push(arg);\r\n////        }\r\n////        var mutex = liveTag_scan_ui_queue[key].mutex;\r\n////        var queue = liveTag_scan_ui_queue[key].queue;\r\n////        if (!mutex.get()) return; // multi entry.\r\n////        if (queue.length>0) {\r\n////          var tgt = queue.shift();\r\n////          var scan_obj = {\r\n////            callback: catalog_liveTag_scan_ui_cont,\r\n////            callback_args: key,\r\n////            watchdog: mutex.restart.bind(mutex),\r\n////////////            crawler_watchdog: true,\r\n////            __proto__: tgt.options};\r\n////          scan_boards.scan_init(key, tgt.tgts, scan_obj);\r\n////        } else mutex.stop();\r\n////      }\r\n////      function catalog_liveTag_scan_ui_cont(key) {\r\n////        liveTag_scan_ui_queue[key].mutex.stop();\r\n////        catalog_liveTag_scan_ui(key);\r\n////      }\r\n\r\n//      function catalog_refresh_gather_info() {\r\n//        if (pref.catalog.order.sticky!=='dont_care') {\r\n//          var tgts = {};\r\n//          for (var name in threads) if (threads[name][20]===null) {\r\n//            var dbt = common_func.name2domainboardthread(name);\r\n//            tgts[dbt[0]+dbt[1]] = null;\r\n//          }\r\n//          if (Object.keys(tgts).length!=0) scan_boards.scan_init('refresh_watch', tgts, {force_json:true, callback:re_sort_thread});\r\n//        }\r\n//      }\r\n//      var flag_initial_refresh = (site.whereami==='boards') && pref.catalog.refresh.except_bt;\r\n\r\n      if (embed_frame) site2[site.nickname].catalog_frame_prep(pn12);\r\n//      else if (embed_mode==='float') pn12_0.getElementsByTagName('button')[pref.catalog.appearance.initial.state].onclick();\r\n//      else if (embed_mode==='float') {\r\n//        if (pref.catalog.appearance.initial.state==='maximized') pn12_0.childNodes[1].childNodes[3].onclick();\r\n//        else if (pref.catalog.appearance.initial.state==='top') pn12_0.childNodes[1].childNodes[0].onclick();\r\n//        else if (pref.catalog.appearance.initial.state==='bottom') pn12_0.childNodes[1].childNodes[1].onclick();\r\n///      }\r\n      var exe_embed = function(){\r\n//          cnst.tb_prep_for_embed(pn12_0);\r\n          pn12_0.appendChild(pn12_0_4); // for simplest catalog_native_prep\r\nif (!pref.test_mode['160']) site2[site.nickname].catalog_native_prep(pn12_0_4,pn12_0, pClg.health_indicator.pn2, pClg);\r\n        var ths = insert_myself(null,null, true);\r\n        if (pClg.pref.filter.kwd.post) {pref4.search_posts_active_once = false; pClg.pref.filter.kwd.posts_active = false; pClg.filter_kwd_active({target:{name:'filter.kwd.post'}});} // patch for posts scan\r\n//          if (site.whereami==='catalog') site2[site.nickname].clean_up_LS(ths);\r\n          if ((embed_mode==='page' && site2[site.nickname].all_boards && site2[site.nickname].all_boards.indexOf(site.board)!=-1) ||\r\n              (embed_mode==='thread' && pref.thread.env.auto_update_native)) { // BUG(,but patched), this cause conflicts, because insert_myself doesn't take merge_mode into account.\r\n            var observer = new MutationObserver(insert_myself);\r\n//            var observer = new MutationObserver(function(){setTimeout(insert_myself,10);}); // wait native script for 4chan, but doesn't work.\r\n//            observer.observe(triage_parent, {childList: true});\r\n            var observe_tgt = (embed_mode==='page')? ths[0].pn.parentNode : ths[0].pn;\r\n            pClg.observer_myself = { // for merge\r\n              observe: function(){observer.observe(observe_tgt, {childList: true});},\r\n              disconnect: function(){observer.disconnect();}\r\n            };\r\n            pClg.observer_myself.observe();\r\n            if (pref.test_mode['137']) triage.change_mode();\r\n          }\r\n//          if (show_catalog_init_funcs) show_catalog_init_funcs();\r\n          if (pref.filter.kwd.active && (embed_mode==='page' || embed_mode==='catalog')) show_catalog();\r\n          if (pref.catalog_board_list_sel!==0 && !(pref.catalog.board.all_boards && pref.catalog_board_list_sel===pref.catalog_board_list_obj.length-1)) {\r\n            var tgts = pClg.refresh_1(embed_mode, false, false, false, false, pref.catalog_board_list_sel, false, false, null, true);\r\n            var key_me = site.nickname+site.board+((embed_mode==='catalog')? 'c0' : (embed_mode==='page')? 'p0' : site.no);\r\n            var key_me2= site.nickname+site.board+((embed_mode==='catalog')? 'j0' : (embed_mode==='page')? 'q0' : 't'+site.no);\r\n            if (Array.isArray(tgts) && pref.catalog.refresh.at_switch && tgts.indexOf(key_me)===-1 && tgts.indexOf(key_me2)===-1) pClg.clear_threads(0);\r\n          }\r\n//          if (pref.catalog_board_list_sel!==0 && pref.catalog.refresh.at_switch) catalog_clear_threads(0);\r\n          if (pref[embed_mode].merge_auto_list) site2['DEFAULT'].update_posts_merge_bases.auto_merge_list(site.key, pClg);\r\n      };\r\n      if (embed_embed) {  // for native catalog\r\n        var pfunc = site2[site.nickname].parse_funcs[site.whereami+'_html'];\r\n        if (pfunc.ths_hook) pfunc.ths_hook(exe_embed); else setTimeout(exe_embed, 0); // required for 4chan, causes too many deleted posts sometimes\r\n      }\r\n      function insert_myself(e,observer,init,force_annotate){\r\n//          var ths = scan_boards.scan_boards_keyword_callback2(site.nickname+','+site.board+','+site.no+','+((embed_catalog)?'catalog':'page')+'_html',\r\n        var new_posts = [];\r\n//        if (!pref.test_mode['122'] || init) {\r\n//          if (!init && (pref[embed_mode].merge || pref[embed_mode].merge_list)) return; // patch\r\n          if (e) {\r\n            var pfunc = site2[site.nickname].parse_funcs['post_html'].nativeUpdate2pn;\r\n            var posts_updated = {};\r\n            for (var i=0;i<e.length;i++) if (e[i].addedNodes) for (var j=0;j<e[i].addedNodes.length;j++) {\r\n              var key = (site.whereami==='thread')? site.key : gGEH.get_key_recursive(e[i].addedNodes[j], document);\r\n              var post = {pn:pfunc(e[i].addedNodes[j])};\r\n              if (!posts_updated[key]) posts_updated[key] = [post];\r\n              else posts_updated[key][posts_updated[key].length] = post;\r\n            }\r\n            for (var key in posts_updated) posts_updated[key].sort(function(a,b){return a.no - b.no;});\r\n          }\r\n          var insert_thread_from_native = {init:init, posts_updated:init? null : posts_updated};\r\n          var site_no = site.whereami==='thread'? site.no : site.page;\r\n          var parse_options = {}; // {native_prep:true};\r\n          parse_options[site.whereami==='thread'? 'thread' : 'page'] = site_no; // emulation of callback2\r\n          var ths = site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, site.whereami+'_html', parse_options);\r\n          for (var i=0;i<ths.length;i++) ths[i].insert_thread_from_native = insert_thread_from_native_prep(ths[i], liveTag.mems.init(ths[i]), insert_thread_from_native);\r\n          scan_boards.scan_boards_keyword_callback2(site.nickname+','+site.board+','+site_no+','+site.whereami+'_html',\r\n                                                              {date:Date.now(), status:200, response:document},\r\n                                                              ['native_prep',{ext_posts:new_posts, force_annotate:force_annotate, refresh:pClg,\r\n                                                                              __proto__:cataLog.scan_boards_keyword_callback2_default_args}], ths);\r\n          if (site.whereami==='thread') Object.defineProperty(site,'myself',{value:ths[0], writable:true, enumerable:true, configurable:true});\r\n          if (init) pClg.show_catalog();\r\n          if (pref.test_mode['155']) pref.test_mode['136'] = true;\r\n          if (pref.debug_mode['38']) {\r\n            var arr = Array.prototype.slice.call(document.querySelectorAll('.thread>.postContainer>.post')).map(function(v){return v.id.substr(1);}); // test in 4chan\r\n            var nos = {};\r\n            arr.forEach(function(v){nos[v] = (nos[v]||0)+1;});\r\n            if (Object.keys(nos).length!==arr.length) console.log('ERROR: doubles: '+arr.filter(function(v){return nos[v]!=1 && nos[v]--;}));\r\n          }\r\n//        } else { // TEST PATCH\r\n//          // DATA PROCESSING IS REQUIRED HERE, tag extraction, favicon and archiving.\r\n//          var pfunc = site2[site.nickname].parse_funcs['post_html'].nativeUpdate2pn;\r\n//          if (e) for (var i=0;i<e.length;i++) if (e[i].addedNodes) for (var j=0;j<e[i].addedNodes.length;j++) new_posts[new_posts.length] = {pn:pfunc(e[i].addedNodes[j])};\r\n//          site2[site.myself.domain].wrap_to_parse.posts({posts:new_posts, __proto__:site.myself});\r\n//          for (var i=0;i<new_posts.length;i++) format_html.prepare_html_post(site.myself, new_posts[i]);\r\n//          for (var i=0;i<new_posts.length;i++) site.myself.posts[site.myself.posts.length] = new_posts[i];\r\n//          insert_thread_format_html_add_events(site.myself, new_posts, true);\r\n//          threads[site.myself.key][7] = site.myself;\r\n//          threads[site.myself.key][16].posts = site.myself.posts;\r\n//        }\r\n//        if (common_obj.thread_reader && new_posts.length!==0) common_obj.thread_reader.updated(new_posts,init);\r\n        return ths;\r\n      }\r\n      cataLog.insert_myself = insert_myself;\r\n        \r\n      function insert_thread_from_native_prep(th, lth, obj){\r\n        var posts_updated = obj.posts_updated && obj.posts_updated[th.key];\r\n        if (posts_updated) site2[th.domain].wrap_to_parse.posts({posts:posts_updated, __proto__:th});\r\n        var merge = pClg.mode==='thread' && pClg.merge_bases.bases[th.key];\r\n        if (merge) {\r\n          var posts_others = {};\r\n          for (var i=0;i<merge.lths.length;i++) if (lth!==merge.lths[i]) {\r\n            var posts = merge.tgt_ths[i][16].posts;\r\n            for (var j=0;j<posts.length;j++) posts_others[posts[j].key] = null;\r\n          }\r\n          th.posts = th.posts.filter(function(v){return posts_others[v.key]===undefined;});\r\n        }\r\n        var retval = {init: obj.init, posts_shown:lth.pd? th.posts.slice():th.posts, posts_updated: posts_updated}; // posts_shown===th.posts is for tgt_th[16].posts===th.posts in update_posts_in_page, requests of merging deleted posts.\r\n        var merge_dp = pref[pClg.mode].deleted_posts.merge;\r\n        if (lth.pd && merge_dp && !obj.init) {\r\n          var recovered = 0;\r\n          if (site.myself && posts_updated && site.myself.posts.length + posts_updated.length == th.posts.length) th.posts = site.myself.posts.concat(posts_updated); // prevent from re-parsing in thread.\r\n          else {\r\n            var nos_updated = {};\r\n            if (pref.test_mode['157']) for (var i=0;i<posts_updated.length;i++) nos_updated[posts_updated[i].no] = null;\r\n            var i=1; // doesn't contain OP\r\n            var j=0;\r\n            while (i<th.posts.length && j<lth.pd.length) { // lower posts may be parsed already.\r\n              if (th.posts[i].no==lth.pd[j].no) {if (pref.test_mode['157'] && (lth.pd[j].no in nos_updated)) {recovered++;i++;} else th.posts.splice(i,1); j++;}\r\n              else if (th.posts[i].no>lth.pd[j].no) j++;\r\n              else i++; // for broken data, i++ for default is the robustest.\r\n            }\r\n          }\r\n          th.nof_posts -= lth.pd.length - recovered;\r\n          th.nof_files -= lth.pd.map(function(v){return v.tn_imgs.length;}).reduce(function(a,v){return a+v;});\r\n        }\r\n        return retval;\r\n      }\r\n////////      if (embed_catalog || embed_page) {  // for native catalog // working code.\r\n////////        pn12.style.display = 'none';\r\n////////        setTimeout(function(){ // patch for liveTag.\r\n////////          var date = Date.now();\r\n////////          site2[site.nickname].catalog_native_prep(date,pn12_0_4,pn12_0, embed_catalog);\r\n////////          insert_thread_from_native = true;\r\n//////////          var ths = scan_boards.scan_boards_keyword_callback2(site.nickname+','+site.board+','+site.no+','+((embed_catalog)?'catalog':'page')+'_html',\r\n////////          var ths = scan_boards.scan_boards_keyword_callback2(site.nickname+','+site.board+',0,'+((embed_catalog)?'catalog':'page')+'_html',\r\n////////                                                              {date:date, status:200, response:document},\r\n////////                                                              ['native_prep',{native_prep:true, found_threads: 0, max_threads:500, found_board:0, scanned:0, refresh:true}]);\r\n////////          insert_thread_from_native = false;\r\n////////          if (pref.thread_reader.own_posts_tracker && pref.thread_reader.clean_up_own_posts && site.whereami==='catalog') site2[site.nickname].clean_up_own_posts(ths,site.board);\r\n////////        },0);\r\n////////      }\r\n\r\n//    if (embed_mode!=='thread') setTimeout(function(){ // patch for liveTag.\r\n      if ((!window.opener || !window.name || window.name.slice(-1)!=='A') && site.whereami!=='archive') setTimeout(function(){ // patch for liveTag and archive.\r\n//    if (!window.opener) setTimeout(function(){ // patch for liveTag and archive. // THIS CAUSE WRONG BEHAVIOR when the page was load by clicking [catalog]\r\n        if (pref.catalog_board_list_sel!=0 || pref[embed_mode].env.refresh_initial) catalog_refresh(site.whereami!=='boards', embed_embed, false);\r\n      },1);\r\n//      if (pref[embed_mode].merge || pref[embed_mode].merge_list)\r\n//        setTimeout(pref_func.settings.onchange_funcs['*w/.merge'+(pref[embed_mode].merge?'':'_list')],2);\r\n\r\n      function catalog_insert(key) {\r\n        var dbt = key.split(',');\r\n        if (pref.catalog_promiscuous || (dbt[0]+dbt[1] in boards)) scan_boards.scan_init('snoop', [key], {lifetime:3600, crawler_max:1, tgt_raw:true});\r\n      }\r\n      function catalog_insert_snoop(key,value) {\r\n        catalog_insert2(key,value,true,true);\r\n      }\r\n      function catalog_insert2(key,value,snoop,from_auto) {\r\n//var check_perf = ['catalog_refresh :', performance.now()];\r\n        var dbt = key.split(',');\r\n        var nickname = dbt[0];\r\n        var board = dbt[1];\r\n        var read_type = dbt[3];\r\n        var page_no = dbt[2];\r\n        var thread = dbt[2];\r\n////////        var dbt = cnst.name2domainboardthread(key,true);\r\n////////        var nickname = dbt[0];\r\n////////        var board = dbt[1];\r\n////////        var read_type = (dbt[2][0]==='p')? 'page_html' : ((dbt[2][0]==='c')? 'catalog_html' : ((dbt[2][0]==='j')? 'catalog_json' : 'thread_html'));\r\n////////        var page_no = (read_type==='thread_html')? '?' : dbt[2].substr(1);\r\n////////        var thread = dbt[2];\r\n        if (snoop && !pref.catalog_promiscuous && read_type==='thread_html' && !threads[name]) {\r\n          var hit = false;\r\n          for (var i=0;i<load_list.refresh.tgts.length;i++) if (load_list.refresh.tgts[i][0].indexOf(name)!=-1) {hit=true;break;}\r\n          if (!hit) return 0; // return if no interest.\r\n        }\r\nif (pref.test_mode['3']) return;\r\n        if (!('response' in value)) value.response = (read_type==='catalog_json')? JSON.parse(value.responseText)\r\n                                                                                 : new DOMParser().parseFromString(value.responseText, 'text/html'); // cause memory leak at KC/int/.\r\nif (pref.test_mode['2']) return;\r\n//check_perf.push(performance.now());\r\n        var tgts_show = {};\r\n//        catalog_clear_threads(pref.catalog.max_threads);\r\n////////        if ((read_type==='page_html' || read_type==='thread_html') && nickname==='NONE') { // for debug\r\n//////////        if ((read_type==='page_html' || read_type==='thread_html') && nickname==='KC') { // for debug\r\n//////////        if ((read_type==='page_html' || read_type==='thread_html') && nickname!=='8chan') { // for debug\r\n//////////        if ((read_type==='page_html' && nickname!=='8chan') || read_type==='thread_html') { // for debug\r\n//////////        if (read_type==='page_html' || read_type==='thread_html') {\r\n////////          var name = nickname + board + thread;\r\n////////          if (snoop && !pref.catalog_promiscuous && read_type==='thread_html' && !threads[name]) {\r\n////////            var hit = false;\r\n////////            for (var i=0;i<load_list.refresh.tgts.length;i++) if (load_list.refresh.tgts[i][0].indexOf(name)!=-1) {hit=true;break;}\r\n////////            if (!hit) return 0; // return if no interest.\r\n////////          }\r\n//////////          value.responseText = site2[nickname].preprocess_html(value.responseText,read_type==='page_html'); // cause memory leak.\r\n//////////          var doc = ('response' in value)? value.response : new DOMParser().parseFromString(value.responseText, 'text/html');\r\n////////          var doc = value.response;\r\n////////          site2[nickname].preprocess_doc(doc);\r\n////////          var nof_posts = 0;\r\n////////          var nof_files = 0;\r\n////////          if (read_type==='thread_html') {\r\n////////            var nof_pi = site2[nickname].thread2headline(doc);\r\n////////            nof_posts  = nof_pi[0];\r\n////////            nof_files = nof_pi[1];\r\n////////            nof_pi = null; // for test\r\n////////            site2[nickname].add_thread_link(doc,site2[nickname].make_url3(board,thread));\r\n////////          }\r\n////////          if (site.nickname!=nickname || site.board!=board) site2[nickname].absolute_link(doc,board);\r\n////////          var threads_in_page = site2[nickname].catalog_threads_in_page(doc);\r\n////////          var th_no = site2[nickname].get_ops(doc);\r\n////////\r\n////////          for (var i=0;i<threads_in_page.length;i++) {\r\n////////            var p_node = threads_in_page[i].parentNode;\r\n////////            insert_thread_from_page(threads_in_page[i], nickname, board, th_no[i], page_no+((read_type==='page_html' && pref.show_page_fraction)? '.'+i : ''), (i==0)?nof_posts : 0, (i==0)?nof_files : 0, snoop, value.date);\r\n//////////          if (threads_in_page[i].parentNode==p_node) threads_in_page[i].parentNode.removeChild(threads_in_page[i]);\r\n////////            tgts_show[nickname+board+th_no[i]]=true;\r\n////////          }\r\n////////        } else {\r\n//          if (read_type==='thread_html') site2[nickname].add_thread_link(value.response,site2[nickname].make_url3(board,thread));\r\n//          if (read_type==='page_html' || read_type==='thread_html') site2[nickname].preprocess_doc(value.response);\r\n          var ths;\r\nif (pref.test_mode['0']) {\r\n          ths = {domain:nickname, board:board, page:page_no};\r\n          if (read_type==='catalog_json') ths.obj = value.response;\r\n          else ths.pn = value.response;\r\n          site2[ths.domain].parse_funcs[read_type].entry(ths,site2[ths.domain].parse_funcs[read_type]['before_test']);\r\n          ths = ths.ths;\r\n} else {\r\n//////          ths = Object.create({domain:nickname, board:board, page:page_no, parse_funcs:site2[nickname].parse_funcs[read_type], __proto__:site4.parse_funcs_on_demand});\r\n//////          if (read_type==='catalog_json') ths.obj = value.response;\r\n//////          else Object.defineProperty(ths,'pn',{value:value.response, enumerable:true, configurable:true, writable:true});\r\n////          var parse_obj = Object.create({domain:nickname, board:board, page:page_no, parse_funcs:site2[nickname].parse_funcs[read_type], __proto__:site4.parse_funcs_on_demand});\r\n////          ths = (read_type==='catalog_json')? {obj:value.response, __proto__:parse_obj} : {pn:value.response, __proto__:parse_obj};\r\n////          ths = ths.ths;\r\n          ths = site2[nickname].wrap_to_parse.get(value.response, nickname, board, read_type, {page:page_no});\r\n}\r\n          if (read_type==='catalog_json' || read_type==='catalog_html') rm_items_404_check(nickname,board,ths); // consumes 15-40 ms, too slow.\r\n          if (snoop && !pref.catalog_promiscuous) for (var i=ths.length-1;i>=0;i--) if (!(ths[i].key in threads)) ths.splice(i,1);\r\n//check_perf.push(performance.now());\r\n          for (var i=0;i<ths.length;i++) {\r\n//            if (read_type!=='catalog_json' && ths[i].pn.parentNode) ths[i].pn.parentNode.removeChild(ths[i].pn); // patch for memory leak issue, but probably fixed.\r\n            if (insert_thread_with_test(ths[i], read_type, value.date)) tgts_show[ths[i].key]=true;\r\n          }\r\n////////        }\r\n//check_perf.push(performance.now());\r\n        if (Object.keys(tgts_show).length!=0) {\r\n          show_catalog(tgts_show,from_auto);\r\n//          if (pref.filter.tag_scan_auto) scan_tags();\r\n        }\r\n//check_perf.push(performance.now());\r\n//check_perf.push('num: '+Object.keys(tgts_show).length);\r\n//common_func.perf_out(check_perf);\r\n      }\r\n\r\n//      var threads_delayed_pruning = Object.create(null);\r\n      function restore_bd_from_IDB(domain, board){\r\n//        if (!threads_delayed_pruning[domain]) threads_delayed_pruning[domain] = {};\r\n//        if (!threads_delayed_pruning[domain][board]) threads_delayed_pruning[domain][board] = {};\r\n        IDB.req(domain, board, null, null, restore_bd_from_IDB_1, 'list_os');\r\n      }\r\n      function restore_bd_from_IDB_1(domain, board, nos){\r\n        for (var i=0;i<nos.length;i++) if (pref.test_mode['80'] || !threads[domain+board+nos[i]]) restore_th_from_IDB(domain, board, nos[i]);\r\n      }\r\n      function restore_th_from_IDB(domain, board, no, tgt){\r\n        IDB.req(domain, board, no, null, function(d,b,n,r){archiver.event_funcs['restore3'](d,b,n,r,tgt);}, 'get_all');\r\n//        IDB.req(domain, board, no, null, archiver.event_funcs['restore3'].bind(archiver.event_funcs), 'get_all');\r\n//        if (!threads_delayed_pruning[domain]) threads_delayed_pruning[domain] = {}; // BUG, if a 404 thread is loaded before catalog, since this is used as a flag in above 'restore_bd_from_IDB' function.\r\n//        if (!threads_delayed_pruning[domain][board]) threads_delayed_pruning[domain][board] = {};\r\n//        threads_delayed_pruning[domain][board][no] = true;\r\n      }\r\n      cataLog.restore_th_from_IDB = restore_th_from_IDB;\r\n      function rm_items_404_check(domain, board, ths, nos){\r\n        if (pref.test_mode['136'] && embed_mode==='thread') return;\r\n        if (pref.patch.rm_404_blacklist.indexOf(domain)!=-1) return; // PATCH for 8chan, 8chan sends corrupted data.\r\n////        if (pref.catalog.bookmark_list_rm404) {\r\n////          var val = catalog_obj_merge(db,pref.filter.list_obj3,null);\r\n////          val = catalog_obj_merge(db,pref.filter.attr_list_obj3,val);\r\n////          if (val.hit) return true;\r\n////        }\r\n////        return false;\r\n////        return pref.catalog.bookmark_list_rm404\r\n////            && ((db in pref.filter.list_obj3) || (db in pref.filter.attr_list_obj3) || (db in pref.filter.watch_list_obj3));\r\n//        var nos = Object.create(null);\r\n////        var nos = Object.create(pref.archive.IDB.auto_restore && threads_delayed_pruning[domain] && threads_delayed_pruning[domain][board] || null);\r\n//        for (var i=0;i<ths.length;i++) nos[ths[i].no] = null;\r\n        var tgts = liveTag.rm_404_list(domain, board, nos);\r\n        var nos_recovered = rm_items_404_0(domain, board, nos, tgts);\r\n//        var nos_recovered = Object.create(nos);\r\n//        for (var no in tgts) if (gClg.Remove_thread_refresh(domain + board + no, tgts[no])) nos_recovered[no] = null;\r\n//        for (var i=0;i<gClg.Clgs.length;i++) rm_items_404_1(domain, board, nos, nos_recovered, gClg.Clgs[i]);\r\n//        for (var no in tgts) liveTag.rm_404_1(domain, board, no, (no in nos_recovered));\r\n////        var db = domain + board;\r\n////        var flag_item = (pref.catalog.bookmark_list_rm404\r\n////            && ((db in pref.filter.list_obj3) || (db in pref.filter.attr_list_obj3) || (db in pref.filter.watch_list_obj3)));\r\n////        if (flag_item) rm_items_404(db,nos);\r\n////        if (!pref.test_mode['67']) archiver.clean_list_all(domain, board, nos); // 'archiver.clean_list' is called in liveTag.rm_404_1\r\n        var lbd = liveTag.mems[domain][board];\r\n        if (!lbd.LS_synced) {\r\n          site2[domain].clean_up_LS(domain, board, nos_recovered);\r\n          lbd.LS_synced = 1;\r\n        }\r\n        if (!pref.test_mode['65'] && !lbd.IDB_synced && pref.archive.IDB.auto_clean_init) IDB.clean_up(domain, board, nos_recovered); // BUG, thread in IDB is removed even nos_recovered is used instead of nos, since 'prunied_time' is always recorded in liveTag.rm_404_1.\r\n//        var keys = Object.keys(nos_recovered);\r\n//        for (var j=0;j<keys.length;j++) {\r\n//          var name = nos_recovered[keys[j]];\r\n//          if (name) for (var i=0;i<gClg.Clgs.length;i++) if (gClg.Clgs[i].threads[name]) gClg.Clgs[i].view_attr_set(name);\r\n//        }\r\n      }\r\n      Clg.prototype.Remove_thread_refresh = function(name, lth, force, recovered){\r\n        if (gClg.AllThreads[name]) {\r\n          var pf = pref.liveTag.rm_404;\r\n          var keep = recovered || pf==='no' || pf!=='imm' && lth && lth.watched && (pf==='watched' || lth.nr);\r\n          for (var i=0;i<gClg.Clgs.length;i++) {\r\n            var tgt_th = gClg.Clgs[i].threads[name];\r\n            if (!tgt_th) continue;\r\n            var from_archive = tgt_th[14]==='IDB' || tgt_th[14]==='FILE';\r\n            if (keep || !force && from_archive) {\r\n              if (!from_archive) if (tgt_th[14]!=='x') {\r\n                tgt_th[14]='x';\r\n                gClg.Clgs[i].footer.update_force(name);\r\n              }\r\n            } else gClg.Clgs[i].remove_thread(name, false, true);\r\n          }\r\n          if (!keep) delete gClg.AllThreads[name]; // gClg.Maintain_AllThreads(name);\r\n        }\r\n        return keep;\r\n      }\r\n      Clg.prototype.rm_items_404_clearPRUNEDs = function(){\r\n        var nos = Object.create(null);\r\n        var nos_recovered = Object.create(nos);\r\n        var gpf = {common:{watch_list_rm404:'imm'}, liveTag:{rm_404:'imm'}};\r\n        var pf = this.pref.filter;\r\n        var obj2s = [pf.watch_list_obj2, pf.attr_list_obj2, pf.list_obj2];\r\n        for (var i=0;i<obj2s.length;i++) {\r\n          var obj2 = obj2s[i];\r\n          for (var name in obj2) if (obj2[name].cmd && obj2[name].cmd['PRUNED']) {\r\n            var dbt = common_func.fullname2dbt(name);\r\n            rm_items_404_1(dbt[0], dbt[1], nos, nos_recovered, this, dbt[2], gpf);\r\n          }\r\n        }\r\n        if (pref.common.consolidated_watch_list && pref.common.sync_watch_list) gClg.Sync_watch_save([null, 'PRUNED', pf.watch_list_str]); // be here to prevent from sending multiple requests in 'rm_items_404_1'\r\n      };\r\n      function rm_items_404_th(domain, board, no){\r\n        var lth = (lth = liveTag.mems[domain]) && (lth = lth[board]) && lth[no]; // don't use getFromName, lth may not exist.\r\n        if (lth) rm_items_404_0(domain, board, {}, {no:lth}, no);\r\n//        if (!lth) return;\r\n//        var nos = {};\r\n//        var nos_recovered = Object.create(nos);\r\n//        if (gClg.Remove_thread_refresh(domain + board + no, lth)) nos_recovered[no] = null;\r\n//        for (var i=0;i<gClg.Clgs.length;i++) rm_items_404_1(domain, board, nos, nos_recovered, gClg.Clgs[i], no);\r\n//        liveTag.rm_404_1(domain, board, no, (no in nos_recovered));\r\n      }\r\n      function rm_items_404_0(domain, board, nos, tgts, no_in){\r\n        var nos_recovered = Object.create(nos);\r\n        for (var i=0;i<gClg.Clgs.length;i++) rm_items_404_1(domain, board, nos, nos_recovered, gClg.Clgs[i], no_in);\r\n        for (var no in tgts) if (gClg.Remove_thread_refresh(domain + board + no, tgts[no], null, (no in nos_recovered)) && !(no in nos_recovered)) nos_recovered[no] = null;\r\n        for (var no in tgts) liveTag.rm_404_1(domain, board, no, (no in nos_recovered));\r\n        if (no_in===undefined) {\r\n          var str;\r\n          if ((str = rm_items_404_2(domain, board, nos, nos_recovered, no_in, pref3.proto.merge_list_obj2, pref.proto.merge_list_str, null))!==null) pref_func.settings.pnOrDummy('proto.merge_list_str').value = pref.proto.merge_list_str = str;\r\n          if ((str = rm_items_404_2(domain, board, nos, nos_recovered, no_in, pref3.proto.merge_lv_obj2,   pref.proto.merge_lv_str,   null))!==null) pref_func.settings.pnOrDummy('proto.merge_lv_str').value   = pref.proto.merge_lv_str   = str;\r\n        }\r\n        var keys = Object.keys(nos_recovered); // .map(function(k){nos_recovered[k];}).filter(function(v){return v;});\r\n        for (var j=0;j<keys.length;j++) {\r\n          var name = nos_recovered[keys[j]];\r\n          if (name) for (var i=0;i<gClg.Clgs.length;i++) if (gClg.Clgs[i].threads[name]) gClg.Clgs[i].view_attr_set(name, true);\r\n        }\r\n//        if (keys.filter(function(v){return nos_recovered[v];}).length>0 && pref.common.consolidated_watch_list && pref.common.sync_watch_list) gClg.Sync_watch_save([null, 'PRUNED', pClg.pref.filter.watch_list_str]);\r\n//        if (keys.length>0 && pref.common.consolidated_watch_list && pref.common.sync_watch_list) gClg.Sync_watch_save([keys, 'PRUNED', keys.map(function(k){nos_recovered[k];})]);\r\n        return nos_recovered;\r\n      }\r\n      function rm_items_404_1(domain, board, nos, nos_recovered, clg, no, gpf){\r\n        if (!gpf) gpf = pref;\r\n        var pf_merged = (gpf.common.watch_list_rm404==='no' || gpf.liveTag.rm_404==='no')? 'no'\r\n                      : (gpf.common.watch_list_rm404==='unread' || gpf.liveTag.rm_404==='unread')? 'unread'\r\n                      : gpf.liveTag.rm_404;\r\n        var pf = clg.pref.filter;\r\n        var str;\r\n        if ((str = rm_items_404_2(domain, board, nos, nos_recovered, no, pf.watch_list_obj2, pf.watch_list_str, pf_merged))!==null) {\r\n          clg.components.watch_list.value = pf.watch_list_str = str; // must be first to get priority.\r\n          if (clg===pClg && gpf.common.consolidated_watch_list && gpf.common.sync_watch_list) gClg.Sync_watch_save([null, 'PRUNED', str]);\r\n//          if (pref.common.consolidated_watch_list) gClg.Sync_watch_save(null); // may be issued multitimes, but OK.\r\n        }\r\n        if ((str = rm_items_404_2(domain, board, nos, nos_recovered, no, pf.attr_list_obj2, pf.attr_list_str, gpf.liveTag.rm_404))!==null) clg.components.attr_list.value = pf.attr_list_str  = str;\r\n        if ((str = rm_items_404_2(domain, board, nos, nos_recovered, no, pf.list_obj2,      pf.list_str,      gpf.liveTag.rm_404))!==null) clg.components.ex_list.value   = pf.list_str       = str;\r\n      }\r\n      function rm_items_404_2(domain, board, nos, nos_recovered, no, obj2, str_in, pf){\r\n        var func = pf? rm_items_404_delete : rm_items_404_delete_merge;\r\n        var db = domain + board;\r\n        var str = null;\r\n        var obj_r = obj2[':REV'] && obj2[':REV'][db];\r\n        if (obj_r)\r\n          if (no===undefined) {for (var n in obj_r) if (!(n in nos)) str = func(domain, board, db+n,  nos_recovered, n,  obj2, obj_r, str, str_in, pf);}\r\n          else if (nos[no]===undefined)             if (no in obj_r) str = func(domain, board, db+no, nos_recovered, no, obj2, obj_r, str, str_in, pf);\r\n        return str && pref_func.fmt4str2(str);\r\n      }\r\n      function rm_items_404_delete(domain, board, name, nos_recovered, no, obj2, obj_r, str, str_in, pf){\r\n        var recovered = (no in nos_recovered);\r\n        var lth = (!recovered && pf==='imm')? null : ((lth = liveTag.mems[domain]) && (lth = lth[board]) && lth[no]); // don't use getFromName since watchlist may contain threads which don't exist in liveTag.mems\r\n        var keep = recovered || pf==='no' || pf!=='imm' && (lth && lth.watched && (pf==='watched' || lth.nr)); // can't catch unread posts during offline\r\n        if (keep) {\r\n          nos_recovered[no] = null; // prior results are accumulated here\r\n          var nr = lth && (lth.nrtm +'/'+lth.nr) || '?/?';\r\n          if (!obj2[name].cmd) obj2[name].cmd = {'PRUNED':nr};\r\n          else if (obj2[name].cmd['PRUNED']===undefined) obj2[name].cmd['PRUNED'] = nr;\r\n          else return str; // keep str value\r\n          nos_recovered[no] = name; // overwritten for change view\r\n        } else {\r\n          delete obj2[name];\r\n          delete obj_r[no];\r\n        }\r\n        if (pref.debug_mode['2']) console.log('rm_items_404_delete: ' + name);\r\n        var key = new RegExp('(^|,)'+name.replace(/\\+/,'\\\\+')+'([\\\\^@;][^,\\n]*)*(,|\\n|$)','mg'); // see 'triage_exe'\r\n        return (str||str_in).replace(key,!keep?',':'$1'+name+'$2;PRUNED:'+nr+'$3');\r\n      }\r\n      function rm_items_404_delete_merge(domain, board, name, nos_recovered, no, obj2, obj_r, str, str_in, pf){\r\n        if (pref.debug_mode['2']) console.log('rm_items_404_delete_merge: ' + name);\r\n        return obj2._rm(name,obj_r,no,(str||str_in));\r\n//        var tgt = obj2[name];\r\n//        if (tgt.length>1) tgt.splice(tgt.indexOf(name),1);\r\n//        delete obj2[name];\r\n//        delete obj_r[no];\r\n//        var key = name.replace(/\\+/,'\\\\+')+'([\\\\^@;:][^,\\n]*)*'; // see 'triage_exe' // moved to str2obj2, working code\r\n//        return str.replace(new RegExp('(^|,)'+key+'([,\\n]+\\\\s*\\\\+*|$|\\\\+)','mg'),'$1').replace(new RegExp('\\\\+\\\\s*'+key+'(,|\\n|$|\\\\s*\\\\+)','mg'),'$2');\r\n      }\r\n//      function rm_items_404_1(domain, board, nos, clg, func){ // working code\r\n//        var db = domain + board;\r\n//        var pf = clg.pref.filter;\r\n//        var result = {};\r\n//        if (!pref.test_mode['134']) {\r\n//          func(result, db, nos, pf.list_obj2);\r\n//          func(result, db, nos, pf.attr_list_obj2);\r\n//          func(result, db, nos, pf.watch_list_obj2);\r\n//        } else {\r\n//          if (db in pf.list_obj3)       rm_items_404_11(result, db, nos, pf.list_obj2);\r\n//          if (db in pf.attr_list_obj3)  rm_items_404_11(result, db, nos, pf.attr_list_obj2);\r\n//          if (db in pf.watch_list_obj3) rm_items_404_11(result, db, nos, pf.watch_list_obj2);\r\n//        }\r\n//        var list = Object.keys(result);\r\n//        if (list.length>0) clg.triage_exe(list[0],'DELETE',list.slice(1),false); // don't broadcast\r\n//        if (pref.debug_mode['2']) if (list.length>0) console.log('rm_items_404: ' + list);\r\n//      }\r\n//      function rm_items_404_1_bd(result, db, nos, obj2){\r\n//        var obj_r = obj2[':REV'] && obj2[':REV'][db];\r\n//        if (obj_r) for (var no in obj_r) if (!(no in nos)) {\r\n//          result[db+no] = null;\r\n//          delete obj2[db+no];\r\n//          delete obj_r[no];\r\n//        }\r\n//      }\r\n//      function rm_items_404_1_th(result, db, no, obj2){\r\n//        var obj_r = obj2[':REV'] && obj2[':REV'][db];\r\n//        if (obj_r && obj_r[no]) {\r\n//          result[db+no] = null;\r\n//          delete obj2[db+no];\r\n//          delete obj_r[no];\r\n//        }\r\n//      }\r\n//      function rm_items_404_11(result, db, nos, obj2){\r\n//        var db_len = db.length;\r\n//        for (var name in obj2)\r\n//          if (name.length>db_len && name.indexOf(db)===0 && !(name.substr(db_len) in nos)) result[name] = null;\r\n//      }\r\n      \r\n//      function rm_items_404(db,nos){ // working code\r\n////console.log('rrr');\r\n//        var tgts = [[pref.filter.list_str,      pref.filter.list_obj2,      search_ex_list],\r\n//                    [pref.filter.attr_list_str, pref.filter.attr_list_obj2, attr_list],\r\n//                    [pref.filter.watch_list_str, pref.filter.watch_list_obj2, watch_list]];\r\n//        var db_len = db.length;\r\n//        for (var i=0;i<tgts.length;i++) {\r\n////          var changed = false;\r\n//////          for (var name in tgts[i][1]) { // too slow\r\n//////            var dbt = common_func.name2domainboardthread(name,true);\r\n////////            if (dbt[0]===nickname && dbt[1]===board && dbt[2]!=='') {\r\n////////              var flag = false;\r\n////////              for (var j=0;j<ths.length;j++) if (dbt[2]==ths[j].no) {flag=true;break;}\r\n////////              if (!flag) {\r\n//////            if (dbt[0]+dbt[1]===db && dbt[2]!=='') {\r\n//////              if (nos[dbt[2]]===undefined) {\r\n//////                if (pref.debug_mode['0']) console.log(name);\r\n//////                triage_exe(name,'DELETE','',false);\r\n//////                changed = true;\r\n//////                if (threads[name]) remove_thread(name);\r\n//////              }\r\n//////            }\r\n//////          }\r\n////          for (var name in tgts[i][1]) {\r\n//////            if (!(name in nos) && name.indexOf(db)==0) {\r\n////            if (name.indexOf(db)==0 && name.length!=db.length && !(name in nos)) {\r\n////              if (pref.debug_mode['2']) console.log('rm_items_404: ' + name);\r\n////              triage_exe(name,'DELETE','',false); // BUG, this changes tgts[i][1], so inconsistency occurs, and requires redundant sequences.\r\n////              changed = true;\r\n////              if (threads[name]) remove_thread(name);\r\n////            }\r\n////          }\r\n////          if (changed) { // seems to be redundant.\r\n////            tgts[0][2].value = tgts[0][2].value.replace(/\\n\\n+/g,'\\n'); // triage_exe executes both.\r\n////            tgts[1][2].value = tgts[1][2].value.replace(/\\n\\n+/g,'\\n');\r\n////            tgts[2][2].value = tgts[2][2].value.replace(/\\n\\n+/g,'\\n');\r\n////            pref_func.apply_prep(tgts[i][2],true);\r\n////            pref_func.apply_prep(tgts[i][2],false);\r\n////          }\r\n//          var list = [];\r\n//          for (var name in tgts[i][1]) {\r\n//            if (name.length>db_len && name.indexOf(db)===0 && !(name.substr(db_len) in nos)) {\r\n//              if (pref.debug_mode['2']) console.log('rm_items_404: ' + name);\r\n//              list[list.length] = name;\r\n//            }\r\n//          }\r\n//          if (list.length>0) pClg.triage_exe(list[0],'DELETE',list.slice(1),false); // BUG, this changes tgts[i][1], so inconsistency occurs, and requires redundant sequences.\r\n//        }\r\n//      }\r\n\r\n//      function req_events(key,value,list) { // working code.\r\n//        list.mutex = true;\r\n////if (pref.debug_mode['0']) console.log(new Date().toLocaleTimeString() + ', refresh: callback: '+load_list.refresh.tgts[load_list.refresh.idx]+', '+load_list.refresh.idx);\r\n//        if (value.status==200 && (value.responseText || value.response)) catalog_insert2(key,value,false,list.from_auto);\r\n//        else {\r\n//          if (value.status==404) comment_out_bookmark(key);\r\n//          list.indicator.set('orange');\r\n//        }\r\n//        if (list.idx<list.tgts.length && value.status<500) {\r\n//          if (!pref[embed_mode].load_on_demand) get_page(list);\r\n//        } else {\r\n//          if (list.idx==1 && value.status!=200) list.indicator.set('red','X');\r\n//          else if (list.idx==list.tgts.length) list.indicator.set(null,'\\u25cf');\r\n//          else list.indicator.set(null,'\\u25b2');\r\n//          if (list.check_page) {\r\n//            refresh_idx_page = 0;\r\n//            page_check_entry();\r\n//          } else http_req.close('catalog'+list.key);\r\n//          catalog_refresh_watch();\r\n//        }\r\n//      }\r\n//      function get_page(list){\r\n////if (pref.debug_mode['0']) console.log(new Date().toLocaleTimeString() + ', refresh: get: '+list.tgts[list.idx]+', '+list.idx);\r\n//        if (pref[embed_mode].load_on_demand && list.idx==0) \r\n//          for (var i=list.tgts.length-1;i>=1;i--) {\r\n//            var name = ':DL:'+list.tgts[i];\r\n//            if (threads[name]) remove_thread(name);\r\n//            threads_idx.unshift(name);\r\n//          }\r\n////        if (tgt===undefined) tgt = list.tgts[list.idx];\r\n////        else tgt = [tgt,false];\r\n//        if (list.idx==0 && !list.indicator) list.indicator = health_indicator.shift('limegreen','0');\r\n//        list.indicator.set(null,(list.idx+1)+'/'+list.tgts.length);\r\n//        http_req.get('catalog'+list.key,list.tgts[list.idx].replace(/!.*/,''),'',req_events,list.use_cache,true,list);\r\n//        list.idx++;\r\n//        list.mutex = false;\r\n//      }\r\n//\r\n////      function req_events(key,value,args) {\r\n//////if (pref.debug_mode['0']) console.log(new Date().toLocaleTimeString() + ', refresh: callback: '+refresh_tgts[refresh_idx][0]+', '+refresh_idx);\r\n////        var inserted_idx = 0;\r\n//////        var key = refresh_tgts[refresh_idx][0].replace(/!.*/,'');\r\n//////        var key = args[0].replace(/!.*/,'');\r\n////        if (value.status==200 && value.responseText) {\r\n////          inserted_idx = catalog_insert2(key,value,false,args[1]);\r\n////        } else {\r\n////          if (value.status==404) comment_out_bookmark(key);\r\n////          health_indicator.set('orange');\r\n////        }\r\n////        refresh_idx++;\r\n////        if (refresh_idx<refresh_tgts.length && value.status<500) {\r\n////          if (!pref[embed_mode].load_on_demand) get_page();\r\n////          else {\r\n////            if (threads_idx.length==inserted_idx+1) threads_idx.push('url');\r\n////            else threads_idx.splice(inserted_idx+1,0,'url');\r\n//////            threads_idx.splice(page_delim_idx[refresh_idx],0,'url'); // THIS MAKES SUBTLE BUG, insert point slides from here at snoop refresh, but ok to use, so I'll omit.\r\n////            show_catalog();\r\n////          }\r\n////        } else {\r\n////          if (refresh_idx==1 && value.status!=200) health_indicator.set('red','X');\r\n////          else if (refresh_idx==refresh_tgts.length) health_indicator.set(null,'\\u25cf');\r\n////          else health_indicator.set(null,'\\u25b2');\r\n////          refresh_idx_page = 0;\r\n////          page_check_entry();\r\n////        }\r\n////      }\r\n////      function get_page(){\r\n//////if (pref.debug_mode['0']) console.log(new Date().toLocaleTimeString() + ', refresh: get: '+refresh_tgts[refresh_idx][0]+', '+refresh_idx);\r\n////        health_indicator.set(null,(refresh_idx+1)+'/'+refresh_tgts.length);\r\n////        http_req.get('catalog',refresh_tgts[refresh_idx][0].replace(/!.*/,''),'',req_events,refresh_use_cache,true,refresh_tgts[refresh_idx]);\r\n////      }\r\n\r\n      var refresh_idx_page;\r\n      function page_check_entry(){\r\n        while (refresh_idx_page<load_list.refresh.tgts.length) {\r\n          if (load_list.refresh.tgts[refresh_idx_page][0].search(/!page/)==-1) refresh_idx_page++;\r\n          else {\r\n            var name = load_list.refresh.tgts[refresh_idx_page++][0].replace(/!.*/,'');\r\n            if (threads[name]) {\r\n              if (threads[name][14].toString()[0]=='?') {\r\n                var page_no_old = parseInt(threads[name][15].toString().replace(/\\..*/,''),10);\r\n                if (isNaN(page_no_old)) page_no_old = 0;\r\n                page_check(name,page_no_old,page_check_callback);\r\n                break;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      function page_check_callback(name,str,date){\r\n//console.log('Callback : '+name+', '+str);\r\n        update_page_in_footer(name,str,date); // to show Dead.\r\n        page_check_entry();\r\n      }\r\n      function update_page_in_footer(name,str,date){\r\n//        if (threads[name]) {\r\n        if (threads[name] && threads[name][0].getElementsByTagName('div')['catalog_footer']) { // patch for threads, this will be removed.\r\n          var pn = threads[name][0].getElementsByTagName('div')['catalog_footer'].childNodes[0];\r\n          if (pn) {\r\n//            var str = str + '@' + new Date(date).toLocaleTimeString();\r\n            pn.innerHTML = pn.innerHTML.replace(/[^\\/]*$/,str);\r\n          }\r\n          threads[name][13]=date;\r\n          threads[name][15]=threads[name][14];\r\n          threads[name][14]=str;\r\n        }\r\n      }\r\n \r\n      function page_check(name,page_ini,callback){\r\n        var dbt = cnst.name2domainboardthread(name,true);\r\n        var domain = dbt[0];\r\n        var board = dbt[1];\r\n        var thread = dbt[2];\r\n        var page_idx = [];\r\n        var max_page = site2[domain].max_page(dbt[1]);\r\n        page_idx[0] = page_ini;\r\n        page_idx[1] = (page_ini+1)%(max_page+1);\r\n        for (var i=0;i<=max_page;i++) if (i!=page_idx[0] && i!=page_idx[1] && (!refresh_use_cache || i!=max_page)) page_idx.push(i);\r\n//        if (!refresh_use_cache) for (var i=0;i<5;i++) page_idx.push(page_idx[i]); // for retry, but live cache working...\r\n        var page_no;\r\n        var key;\r\n      \r\n        function page_check(){\r\n          page_no = page_idx.shift();\r\n          key = (page_no==max_page)? domain+board+thread : domain+board+'p'+page_no;\r\n//          http_req.get('catalog',key,url,req_events_page_check,refresh_use_cache);\r\n          http_req.get('catalog',key,'',req_events_page_check,refresh_use_cache,true);\r\n        }\r\n        page_check();\r\n        function req_events_page_check(key,value) {\r\n//console.log('Read : '+name+', '+key+', '+value.status);\r\n          var callback_str = null;\r\n          if (value.status!=200) {\r\n            if (page_no==max_page && value.status==404) callback_str = 'Dead';\r\n            else callback_str = 'HTTP'+value.status;\r\n          } else {\r\n            var doc = ('response' in value)? value.response : new DOMParser().parseFromString(value.responseText, 'text/html');\r\n            var ops = site2[domain].get_ops(doc);\r\n            var hit = false;\r\n            if (page_no!=max_page) for (var i=0;i<ops.length;i++) if (thread==ops[i]) {hit=true;callback_str = page_no+((pref.show_page_fraction)? '.'+i : '');}\r\n            if (!hit) {\r\n              if (value.responseText != null && page_idx.length!=0) setTimeout(page_check, 0); // live cache make racing condition with this. I don't know why.\r\n              else callback_str = '?' + ((!refresh_use_cache)? '(missing)' : '');\r\n              if (site2[domain].check_thread_archived(doc)) callback_str = 'Archived';\r\n            }\r\n          }\r\n          if (value.status==200) catalog_insert2(key,value,true); // update\r\n          if (callback_str!==null) {\r\n            if (callback_str==='Dead' || callback_str==='Archived') {\r\n              comment_out_bookmark(name);\r\n//              var tgt = pn12_0_4.getElementsByTagName('textarea')['filter.bookmark_list_str'];\r\n//              tgt.value = comment_out_key(name,tgt.value);\r\n//              pref_func.apply_prep(tgt,true);\r\n            }\r\n            callback(name,callback_str,value.date);\r\n          }\r\n//console.log('Out : '+name+', '+key+', '+value.status);\r\n        }\r\n      }\r\n      function comment_out_bookmark(name){\r\n        var tgt = pn12_0_4.getElementsByTagName('textarea')['filter.bookmark_list_str'];\r\n        tgt.value = comment_out_key(name,tgt.value);\r\n        pref_func.apply_prep(tgt,true);\r\n      }\r\n      function comment_out_key(key,str){\r\n////        var comments = [];\r\n////        var str_ret = '';\r\n////        var comment = new RegExp('//.*$','m');\r\n////        while (1) {\r\n////          var idx = str.search(comment);\r\n////          if (idx!=-1) comments.push([idx,str.match(comment)[0]]);\r\n////          else break;\r\n////        }\r\n//        return str.replace(key,'//$&');\r\n        var rep_str = (pref.catalog.bookmark_list_rm404)? '' : '//$&';\r\n////        return str.replace(new RegExp(key+'(!page)*(,|\\n|$)','g'),rep_str); // working code.\r\n        var dbt = key.split(',');\r\n        return str.replace(new RegExp(dbt[0]+dbt[1]+dbt[2]+'(!page)*(,|\\n|$)','g'),rep_str);\r\n      }\r\n\r\n      pref_func.mirror_targets.pn12_0_2 = pn12_0_2;\r\n      pref_func.mirror_targets.pn12_0_4 = pn12_0_4;\r\n\r\n      var GEH = function(clg){ // GeneralEventHandler\r\n        this.ppn = clg.ppn;\r\n        this.subscribers = [];\r\n        this.valid = null;\r\n        this.last_viewed = null;\r\n        this.last_Y = 0;\r\n        this.init2(clg);\r\n      };\r\n      GEH.prototype = {\r\n        setup: function(reset){\r\n          if (pref[embed_mode].scroll_lock && !this.valid && !reset){\r\n            this.valid = this.mouseover_lock.bind(this);\r\n            this.ppn.addEventListener('mouseover', this.valid, true);\r\n          } else if (this.valid) {\r\n            this.ppn.removeEventListener('mouseover', this.valid, true);\r\n            this.valid = null;\r\n          }\r\n        },\r\n//        var geh = site2[site.nickname].general_event_handler[site.whereami];\r\n        mouseover_lock: function(e){\r\n//if (pref.debug_mode['14']) if (last_viewed) site2[site.nickname].general_event_handler[site.whereami].get_mark(last_viewed, get_now_height()+last_Y).style.border = 'none';\r\n          this.last_viewed = e.target;\r\n          this.last_Y = e.clientY;\r\n////          if (geh.last_viewed.call(this,e)) show_catalog_scroll_lock.viewed(e.target);\r\n//          //          e.stopPropagation();\r\n//if (pref.debug_mode['14']) {\r\n//  var pn = site2[site.nickname].general_event_handler[site.whereami].get_mark(e.target, get_now_height()+last_Y);\r\n//  if (!pn.classList.contains('post')) console.log(e.target, pn)\r\n//  pn.style.border = '1px solid blue';\r\n//}\r\n        },\r\n        change: (function(){\r\n          var class_expander = pref.script_prefix + '_expander';\r\n          return function(e){\r\n            if (e.target.className===class_expander) {\r\n              var clg = this['.'];\r\n              var name = e.target.getAttribute('data-key');\r\n              clg.threads[name][16].expand_event(e.target.selectedIndex, clg.threads[name][10]);\r\n//              threads[name][16].t2h_sel = format_html.get_t2h_from_index(e.target.selectedIndex);\r\n//              threads[name][16].expand_posts = true;\r\n////            drawn_idx = 0; // patched in 'show_catalog', because this is required when images are expanded.\r\n//              scan.scan_ui('expand_page', {tgts:[name], options:{refresh:true}});\r\n              e.target.blur();\r\n            }\r\n          };\r\n        })(),\r\n        blacklist_click: new WeakSet(),\r\n        geh: site2[site.nickname].general_event_handler[site.whereami],\r\n        click_bl: function(e){\r\n          var et = e.target;\r\n          if (e.target.className===pref.script_prefix+'_tag') liveTag.boardlist_click_entry(e);\r\n        },\r\n        click: function(e){\r\n          var et = e.target;\r\n          var clg = this['.'] || pClg;\r\n          if (e.target.className===pref.script_prefix+'_tag') {\r\n            clg.liveTag.tag_node_onclick(e);\r\n//          } else if (e.target.className===pref.script_prefix+'_footerMenu') { // working code\r\n//            site2['DEFAULT'].popups_posts.menu_click.call(this,e,e.target);\r\n////            var geh = GEH.prototype.geh;\r\n////            var tgt = geh.recSearch_thread(e.target, e.currentTarget) || geh.recSearch_thread(e.target, e.currentTarget, pref.script_prefix+'_headline'); // copied from popups_posts.triage\r\n////            var name = gGEH.pns_all_keys.get(tgt) || gGEH.pns_all_keys.get(tgt.parentNode); // tgt.parentNode for vichan catalog\r\n////            if (name) return cataLog.triage.thread_in(e, name, tgt, clg.ppn, clg, clg.mode==='float', e.target);\r\n          } else if (e.target.className===pref.script_prefix+'_button') {\r\n            if (e.target.dataset.type==='triage') triage.embedded_onclick(e,clg);\r\n            else {\r\n              var name = e.target.getAttribute('name');\r\n              var key = gGEH.get_key_recursive(e.target, e.currentTarget);\r\n              var onchange_funcs = this['.'].onchange_funcs;\r\n              if (onchange_funcs[name]) onchange_funcs[name].call(onchange_funcs, e, name, key);\r\n            }\r\n//            else if (e.target.dataset.type==='triage') {\r\n//              var key = gGEH.get_key_recursive(e.target, e.currentTarget);\r\n//              clg.triage_event(key, e.target.dataset.cmd, e.target.dataset.attr || '', null, e.target);\r\n//            }\r\n            e.stopPropagation();\r\n          } else if (e.target.classList.contains(pref.script_prefix+'_embeddedTriage')) {\r\n            triage.embedded_onclick(e,clg);\r\n            return stop_prevent(e);\r\n////            var key = gGEH.get_key_recursive(e.target, e.currentTarget);\r\n////            Triage.prototype.prep_func_onclick(function(cmd,attr){\r\n////              if (cmd==='MENU') {if (key) triage.make_menu(e,key,clg);}\r\n////              else clg.triage_event(key,cmd,attr);})(e);\r\n//          } else if (e.target.className===pref.script_prefix+'_UImerge') {\r\n//            var key = gGEH.get_key_recursive(e.target, e.currentTarget);\r\n//            var href = e.target.previousSibling.previousSibling.getAttribute('href');\r\n//            var dbt = site2[site.nickname].popups_href2dbtp(href);\r\n//            clg.merge_bases.add_to_list_fromUI(key, dbt.slice(0,3).join(''), clg);\r\n          } else if (!pref.test_mode['104']) {\r\n            var isThumbnail = GEH.prototype.geh.isThumbnail(e);\r\n            if (clg.view==='catalog' && (isThumbnail || pref[clg.view].click_area==='entire') || clg.view==='headline' && et.className!==pref.script_prefix+'_tag') { // this['.'] check for popup\r\n              e.preventDefault();\r\n              if (clg.view==='headline' && !window.getSelection().isCollapsed) return;\r\n              var key = gGEH.get_key_recursive(e.target, e.currentTarget);\r\n//              if (typeof(key)!=='string') key = key.lths[0].key;\r\n              if (key) clg.click_thread(key, null);\r\n//              var tgt = GEH.prototype.geh.recSearch_thread(e.target, e.currentTarget);\r\n//              if (tgt) click_thread(tgt.name);\r\n            } else if (isThumbnail) {\r\n              var domain = site2['DEFAULT'].popups_posts.href2domain(et.getAttribute('src'));\r\n              if (!GEH.prototype.blacklist_click.has(et) && (!pref[embed_mode].env.expand_thumbnail_inline_native || !(pref[embed_mode].env.event_dynamic && domain===site.nickname)))\r\n                DIH.expand_thumbnail_inline.call(e.target, e);\r\n              else if (pref.test_mode['163']) DIH.expand_thumbnail_clicked_but_ineffective(e.target);\r\n            }\r\n//          if (!pref.test_mode['104'] && GEH.prototype.geh.isThumbnail(e)) {\r\n//            if (cataLog.embed_mode==='catalog') click_thread_tn(e);\r\n//            else {\r\n//              var domain = site2['DEFAULT'].popups_posts.href2domain(et.getAttribute('src'));\r\n//              if (!GEH.prototype.blacklist_click.has(et) && (!pref[embed_mode].env.expand_thumbnail_inline_native || !(pref[embed_mode].env.event_dynamic && domain===site.nickname)))\r\n//                DIH.expand_thumbnail_inline.call(e.target, e);\r\n            //            }\r\n            triage.off();\r\n          }\r\n          if (et.tagName==='A') {\r\n            if (pref.test_mode['147'] && clg.view==='catalog') {\r\n              var key = gGEH.get_key_recursive(e.target, e.currentTarget);\r\n              var href = e.target.getAttribute('href');\r\n              var domain = site2['DEFAULT'].popups_posts.href2domain(href);\r\n              var dbtp = site2[domain].popups_href2dbtp(href);\r\n              var tgt = dbtp.slice(0,3).join('');\r\n              if (key && tgt && dbtp[2] && key!==tgt) clg.triage_event(key, 'MERGEC', tgt);\r\n              if (!clg.threads[tgt]) scan.scan_ui('mergeClicked', {tgts:[tgt], options:{refresh:clg}});\r\n              return stop_prevent(e);\r\n            }\r\n            if (pref[clg.mode].inline_post!=='no' && site2['DEFAULT'].popups_link_regex.test(et.textContent)) {\r\n              site2['DEFAULT'].popups_posts.inline_post(e, clg);\r\n              return stop_prevent(e);\r\n            }\r\n            if (pref.test_mode['93']) {\r\n              var filename = et.getAttribute('download');\r\n              if (filename) {\r\n                var href = et.getAttribute('href');\r\n                var tgt_domain = href.search(/^(https*:)*\\/\\//)!=-1 && href.replace(/^(https*:)*\\/\\//,'').match(/^([^/]*)\\//)[1];\r\n                if (site2['ALL'][tgt_domain]) tgt_domain = site2[site2['ALL'][tgt_domain]].nickname;\r\n                if (tgt_domain!=site2[site.nickname].domain_url) {\r\n                  httpd.req({tgts:[{url:href, domain:tgt_domain, archive:filename, responseType:'blob'}], max:1, initiator:'download', callback_1:function(){}},6);\r\n                  return stop_prevent(e);\r\n                }\r\n              }\r\n            }\r\n            if (pref.test_mode['87']) {\r\n              if (et.href.indexOf('//www.youtube.com')!==-1) insert_iframe_youtube(et.href.replace(/watch\\?v=/,'embed/'), e);\r\n              else if (et.href.indexOf('//youtu.be')!==-1)   insert_iframe_youtube(et.href.replace(/youtu.be/,'youtube.com/embed'), e);\r\n              else {\r\n                var cmd = et.getAttribute('data-cmd');\r\n                if (cmd && cmd.indexOf(pref.script_prefix)===0) {\r\n                  cmd = cmd.substr(pref.script_prefix.length+1);\r\n                  if (cmd==='remove_next') remove_next(e);\r\n                }\r\n              }\r\n            }\r\n          }\r\n          function insert_iframe_youtube(url, e, et){\r\n            var et = e.target;\r\n            var close_button = document.createElement('span');\r\n            close_button.innerHTML = ' [<a data-cmd=\"'+pref.script_prefix+'_remove_next\">Remove</a>] ';\r\n            if (!et.nextSibling || et.nextSibling.innerHTML!==close_button.innerHTML) {\r\n              e.target.parentNode.insertBefore(close_button,et.nextSibling);\r\n              var div = document.createElement('div');\r\n              div.innerHTML = '<iframe src=\"' + url + '\" width=\"640\" height=\"360\" frameborder=\"0\" allowfullscreen=\"\"></iframe>';\r\n              div.classList.add('media-embed');\r\n              et.parentNode.insertBefore(div,close_button.nextSibling);\r\n            }\r\n            stop_prevent(e);\r\n          }\r\n          function remove_next(e){\r\n            e.target.parentNode.parentNode.removeChild(e.target.parentNode.nextSibling);\r\n            e.target.parentNode.parentNode.removeChild(e.target.parentNode);\r\n          }\r\n          function stop_prevent(e){\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n          }\r\n        },\r\n        get_last_viewed: function(){\r\n          return (this.last_viewed)? site2[site.nickname].general_event_handler[site.whereami].get_mark(this.last_viewed, get_now_height()+this.last_Y) : null;\r\n        },\r\n        clear_last_viewed: function(){this.last_viewed = null;},\r\n        init: function(){\r\n          var dynamic_image_hover = site2[site.nickname].parse_funcs[site.whereami+'_html'].dynamic_image_hover;\r\n          var geh = site2[site.nickname].general_event_handler[site.whereami];\r\n//          if (geh && geh.mouseover && (geh.add_mouseover || dynamic_image_hover)) if (pref.test_mode['103']) common_func.dom_addEventListener(this.subscribers, this.parent, 'mouseover', geh.mouseover);\r\n//          common_func.dom_addEventListener(this.subscribers, this.ppn, 'change', this.change);\r\n//          if (pref.test_mode['87'] || pref.test_mode['93'] || !pref.test_mode['104']) common_func.dom_addEventListener(this.subscribers, this.ppn, 'click', this.click);\r\n          if (!pref.test_mode['104']) site.popup_body.addEventListener('click', this.click, false);\r\n          this.setup();\r\n////          if (!pref.test_mode['98']) if (pref.test_mode['103']) site.popup_body.addEventListener('mouseover', site2[site.nickname].general_event_handler['page'].mouseover, false);\r\n//          site.root_body.addEventListener('dragstart', this.dragstart, false);\r\n//          site.root_body.addEventListener('dragend', this.dragend, false);\r\n////          this.ppn.addEventListener('dragstart', this.dragstart, false);\r\n////          this.ppn.addEventListener('dragend', this.dragend, false);\r\n////          site.popup_body.addEventListener('dragstart', this.dragstart, false);\r\n////          site.popup_body.addEventListener('dragend', this.dragend, false);\r\n        },\r\n        init2: function(clg){\r\n          var tgt = {'.':clg, __proto__:this};\r\n          if (pref.test_mode['87'] || pref.test_mode['93'] || !pref.test_mode['104']) common_func.dom_addEventListener(this.subscribers, this.ppn, 'click', this.click.bind(tgt));\r\n          common_func.dom_addEventListener(this.subscribers, this.ppn, 'change', this.change.bind(tgt));\r\n          site2['DEFAULT'].popups_posts.init2(pref.test_mode['141']? clg.pppn : clg.ppn, tgt);\r\n          common_func.dom_addEventListener(this.subscribers, site.root_body, 'dragstart', this.dragstart.bind(tgt));\r\n          if (pref.test_mode['188']) common_func.dom_addEventListener(this.subscribers, this.ppn, 'mousedown', this.dnd_merge_mousedown.bind(tgt));\r\n        },\r\n        destroy: function(){\r\n          this.setup(true);\r\n          common_func.dom_removeEventListener(this.subscribers);\r\n        },\r\n        mouseover: function(e, force){\r\n          var et = e.target;\r\n          site2['DEFAULT'].popups_posts.over(e, force);\r\n          if (pref.liveTag.info && pref.tooltips['info'].show)\r\n            if (et.className===pref.script_prefix+'_tag') Tooltips.req_show('info', e, liveTag.tag_onmouseover); // mouseover only for faster execution. mouseleave is needed strictly.\r\n            else Tooltips.hide_if(e.currentTarget); // hide2();\r\n          \r\n        },\r\n        mouseleave_bl: function(e){\r\n          if (pref.liveTag.info) Tooltips.hide_if(e.currentTarget); // hide2();\r\n        },\r\n        dragstart: (function(){ // snatch image hover and merge by drag'n'dropping thumbnails\r\n          var clg = null;\r\n          var src = null;\r\n          var dst = null;\r\n          var hover = null;\r\n          function dragenter(e){\r\n            dst = gGEH.get_key_rec(e); // must calculate here, e at dragend is the same as e at dragstart.\r\n            if (hover && src!==dst) {\r\n              DIH.image_hover_remove(e);\r\n              hover = null;\r\n            }\r\n          }\r\n          function dragend(e,dx,dy){\r\n            document.body.removeEventListener('dragenter',dragenter,false);\r\n            if (hover) DIH.image_hover_snatch(e,dx,dy);\r\n            else if (src && pref.test_mode['188']) {\r\n//              var dst = gGEH.get_key_rec(e); // can't calculate dst here, e.target is the same as e at dragstart.\r\n              if (dst!==src) clg.triage_event(src, 'MERGECU', dst||null); // 'dst||null' for unmerge\r\n            }\r\n          }\r\n          return function(e){\r\n            if (!GEH.prototype.geh.isThumbnail(e)) return;\r\n            clg = this['.'];\r\n            var pfm = clg.pref[clg.mode];\r\n            if (clg.view==='catalog' && pfm.merge_list && !pfm.merge) {\r\n              src = gGEH.get_key_rec(e);\r\n              hover = src;\r\n              document.body.addEventListener('dragenter',dragenter,false);\r\n              gGEH.drag.started(e, dragend, 'copy');\r\n            } else gGEH.drag.started(e, DIH.image_hover_snatch, 'copy');\r\n            site2['DEFAULT'].popups_posts.pop_down_temporarily(e);\r\n          };\r\n        })(),\r\n//        dragstart: function(e){ // working code\r\n//          if (GEH.prototype.geh.isThumbnail(e)) gGEH.drag.started(e, DIH.image_hover_snatch, 'copy');\r\n//          site2['DEFAULT'].popups_posts.pop_down_temporarily(e);\r\n//        },\r\n//        drag_sx: 0,\r\n//        drag_sy: 0,\r\n//        drag_effect: null,\r\n//        dragstart: function(e){\r\n//          var myself = GEH.prototype;\r\n//          myself.drag_sx = e.screenX;\r\n//          myself.drag_sy = e.screenY;\r\n//          if (myself.geh.isThumbnail(e)) {\r\n//            document.body.addEventListener('dragover',myself.dragover,false);\r\n//            myself.drag_effect = 'copy';\r\n//          }\r\n//        },\r\n//        dragover: function(e){\r\n//          e.preventDefault();\r\n//          e.dataTransfer.dropEffect = GEH.prototype.drag_effect;\r\n//        },\r\n//        dragend: function(e){\r\n////          if (!pref[embed_mode].thumbnail.hover.dragfloat || (!DIH.hover_ex && e.target.tagName!=='IMG')) return;\r\n//          var myself = GEH.prototype;\r\n//          if (myself.drag_effect) {\r\n//            document.body.removeEventListener('dragover',myself.dragover,false);\r\n//            myself.drag_effect = null;\r\n//          }\r\n//          DIH.image_hover_snatch(e, myself.drag_sx, myself.drag_sy);\r\n////          var img = DIH.image_hover_snatch();\r\n////          var right = ((img)? parseInt(img.style.right,10) : cnst.left2right(e.clientX - e.offsetX, e.target)) - (e.screenX - myself.drag_sx);\r\n////          var top = ((img)? parseInt(img.style.right,10) : e.clientY - e.offsetY) + e.screenY - myself.drag_sy;\r\n////          var cn = cnst.init3({\r\n////            func_str:'right:'+right+'px:top:'+top+'px:ftb:overflow:hidden:Show'}).cn;\r\n//////            func_str:'right:'+right+'px:top:'+top+'px:tb:ftb:overflow:auto:Show'}).cn;\r\n////          cn.appendChild(img || e.target.cloneNode());\r\n////          if (img) DIH.image_hover_snatch_end();\r\n//        },\r\n        dnd_merge_mousedown: (function(){\r\n          var pn_th = null;\r\n          var clg = null;\r\n          var sx = 0;\r\n          var sy = 0;\r\n          var pn_dragEffect = null;\r\n          var pn_th_oL = 0;\r\n          var pn_th_oT = 0;\r\n          var syo = 0;\r\n          function mouseleave(e){\r\n            var dx = e.screenX - sx;\r\n            var dy = e.screenY - sy;\r\n            if (Math.abs(dy)<Math.abs(dx)) return; // vertical +-45 degree\r\n            var pn = pn_th.cloneNode(true);\r\n            pn.style.width = pn_th.offsetWidth;\r\n            pn.style.height = pn_th.offsetHeight;\r\n            pn.style.position = 'fixed';\r\n            pn.style.opacity = 0.4;\r\n            pn.style.pointerEvents = 'none';\r\n            var bcr = pn_th.getBoundingClientRect();\r\n            pn_th_oL = bcr.left; // pn_th.offsetLeft;\r\n            pn_th_oT = bcr.top; // pn_th.offsetTop;\r\n            pn_dragEffect = pn;\r\n            mousemove(e);\r\n            clg.ppn.appendChild(pn);\r\n//            pn_th.removeEventListener('mouseleave', mouseleave, false);\r\n            clg.ppn.addEventListener('mousemove', mousemove, false);\r\n//            var evt = document.createEvent('MouseEvents'); // doesn't work\r\n//            evt.initMouseEvent(e.type, e.canBubble, e.cancelable, e.view,\r\n//                               e.detail, sx, sy, e.clientX - dx, e.clientY - dy,\r\n//                               e.ctrlKey, e.altKey, e.shiftKey, e.metaKey,\r\n//                               e.button, e.relatedTarget);\r\n//            pn_th.dispatchEvent(evt);\r\n//            pn_th.draggable = true;\r\n//            evt.initMouseEvent(e.type, e.canBubble, e.cancelable, e.view,\r\n//                               e.detail, e.screenX, e.screenY, e.clientX, e.clientY,\r\n//                               e.ctrlKey, e.altKey, e.shiftKey, e.metaKey,\r\n//                               e.button, e.relatedTarget);\r\n//            pn_th.dispatchEvent(evt);\r\n//            gGEH.drag.started(e, merge, 'move');\r\n          }\r\n          function mouseenter(e){ // reentry\r\n            if (!pn_dragEffect) return; // chrome51 doesn't fire 'mouseleave' while selection is continueing, but fire 'mouseenter'\r\n            clg.ppn.removeChild(pn_dragEffect);\r\n            clg.ppn.removeEventListener('mousemove', mousemove, false);\r\n            pn_dragEffect = null;\r\n            window.getSelection().removeAllRanges();\r\n          }\r\n          function mousemove(e){\r\n            window.getSelection().removeAllRanges();\r\n            var dx = e.screenX - sx;\r\n            var dy = e.screenY - sy;\r\n            if (!pn_dragEffect) return; // for racing\r\n            pn_dragEffect.style.left = pn_th_oL + dx + 'px';\r\n            pn_dragEffect.style.top = pn_th_oT + syo + dy + 'px';\r\n          }\r\n          function end_proc(e){\r\n            clg.ppn.removeEventListener('mouseup', mouseup, false);\r\n            clg.ppn.removeEventListener('mouseleave', end_proc, false);\r\n//            if (pn_dragEffect) return (mouseenter(e), true);\r\n//            else\r\n            pn_th.removeEventListener('mouseleave', mouseleave, false);\r\n            pn_th.removeEventListener('mouseenter', mouseenter, false);\r\n//            pn_th.draggable = false;\r\n            site2['DEFAULT'].popups_posts.pop_up_unlock();\r\n            return pn_dragEffect && (mouseenter(e), true);\r\n          }\r\n          function mouseup(e){\r\n            if (!end_proc(e)) return;\r\n            var src = gGEH.get_key_recursive(pn_th, clg.ppn, true);\r\n            var dst = gGEH.get_key_rec(e);\r\n            if (src && dst!==src) clg.triage_event(src, 'MERGECU', dst||null); // 'dst||null' for unmerge\r\n          }\r\n          return function(e){ // mousedown\r\n            clg = this['.'];\r\n            var pfm = clg.pref[clg.mode];\r\n            if (clg.view!=='headline' || !pfm.merge_list || pfm.merge) return;\r\n            pn_th = this.geh.recSearch_thread(e.target, clg.ppn, clg.view==='headline'? pref.script_prefix+'_headline' : undefined);\r\n            if (!pn_th) return;\r\n            sx = e.screenX;\r\n            sy = e.screenY;\r\n            syo = e.offsetY - pn_th.offsetHeight/2;\r\n            clg.ppn.addEventListener('mouseup', mouseup, false);\r\n            clg.ppn.addEventListener('mouseleave', end_proc, false);\r\n            pn_th.addEventListener('mouseleave', mouseleave, false);\r\n            pn_th.addEventListener('mouseenter', mouseenter, false);\r\n            site2['DEFAULT'].popups_posts.pop_down_temporarily(e, true);\r\n          };\r\n        })(),\r\n      };\r\n      cataLog.GEH = GEH;\r\n      cataLog.general_event_handler = new GEH(pClg); // triage_parent);\r\n//      cataLog.general_event_handler.last_viewed = gGEH.last_viewed; // avoids racing condition of 'receive_message'\r\n      setTimeout(cataLog.general_event_handler.init.bind(cataLog.general_event_handler), 500); // WHY 500ms delay?\r\n\r\n      var GEH_mouseover_force = (function(func){return function(e){func(e,true);e.stopPropagation()};})(GEH.prototype.mouseover);\r\n//      var GEH_mouseover_force = (function(func){return function(e){func(e,true);};})(GEH.prototype.mouseover);\r\n      if (!pref.test_mode['98']) site.popup_body.addEventListener('mouseover',GEH_mouseover_force,false);\r\n      site.root_body.addEventListener('mouseover', GEH.prototype.mouseover, false);\r\n//      triage_parent.addEventListener('mouseover', (embed_mode==='float')? GEH_mouseover_force : GEH.prototype.mouseover, false);\r\n//      triage_parent.addEventListener('mouseleave', site2['DEFAULT'].popups_posts.leave, false);\r\n      if (site.components.boardlist) {\r\n        site.components.boardlist.addEventListener('click',GEH.prototype.click_bl,false);\r\n//        site.components.boardlist.addEventListener('mouseover',GEH.prototype.mouseover,false);\r\n//        site.components.boardlist.addEventListener('mouseleave',GEH.prototype.mouseleave_bl,false);\r\n      }\r\n      site2['DEFAULT'].popups_posts.init(pClg.ppn); // triage_parent);\r\n\r\n      if (!pref.test_mode['114']) {\r\n        pClg.GEH = cataLog.general_event_handler;\r\n      }\r\n      function make_watcher(){\r\n//        var pn_test = document.createElement('div');\r\n        var clg = new Clg(false,'float', true);\r\n        if (pref.float.clone) {\r\n          var clone_clg = Clg.prototype.Clgs.filter(function(v){return clg.pref.float.board_list_sel===v.pref[v.mode].board_list_sel;})[0]; // hits myself always\r\n          if (clone_clg!==clg) clg.clone_threads(clone_clg);\r\n        }\r\n//        if (pref.test_mode['133']) for (var name in pClg.threads) clg.clone_thread(name);\r\n//        clg.ppn.setAttribute('style','white-space:nowrap');\r\n//        clg.ppn.setAttribute('style','text-overflow:ellipsis;white-space:nowrap;width:100%');\r\n        clg.GEH = new GEH(clg);\r\n        if (site2[site.nickname].catalog_native_prep_watcher) {\r\n          site2[site.nickname].catalog_native_prep(clg.components.pn12_0_4, clg.components.pn12_0, clg.health_indicator.pn2, clg);\r\n          if (clg.native.viewChanged) clg.native.viewChanged();\r\n        }\r\n        clg.show_catalog();\r\n      }\r\n      Clg.prototype.clone_threads = function(clg){\r\n        for (var name in clg.threads) if (!this.threads[name]) {\r\n          this.clone_thread_1(name);\r\n          this.view_attr_set(name, null, true);\r\n          this.idx_reorder(name, true);\r\n        }\r\n//        this.idx_reorder_exe();\r\n      }\r\n      Clg.prototype.clone_thread_1 = function(name){\r\n//          var max_txt = 500;\r\n          var lth = liveTag.mems.getFromName(name);\r\n//          var pn = document.createElement('div');\r\n//          pn.className = pref.script_prefix+'_headline'; // +' thread'; // might cause CSS problem so much.\r\n////          pn.setAttribute('style','white-space:nowrap;text-overflow:ellipsis;overflow:hidden;width:100%');\r\n//          gGEH.pns_all_keys.set(pn,name);\r\n//          var txt = site2[lth.domain].post_com2txt(lth.th);\r\n//          var sub_com = ((lth.th.sub? '<b>'+lth.th.sub+'</b>: ': '') + txt);\r\n//          var sub_com_max = max_txt - (lth.th.sub? 2:0);\r\n//          if (sub_com.length>=sub_com_max) sub_com = sub_com.slice(0, sub_com_max) + '...';\r\n//          pn.innerHTML = '<span></span> '+sub_com;\r\n//          clg.view_attr_set(name,pn);\r\n          var pth = gClg.AllThreads[name]; // pClg.threads[name];\r\n          var keys = Object.keys(pth[16]);\r\n          var tgt16 = {th:{pn:null, __proto__:lth.th}, __proto__:tgt_th16_proto};\r\n          var nocopy = ['th', 'icon_sticky', 'icon_show_always', 'show_always', 'clg', 'threads'];\r\n          for (var i=0;i<keys.length;i++) if (nocopy.indexOf(keys[i])==-1) tgt16[keys[i]] = pth[16][keys[i]];\r\n        this.threads[name] = {0:false, 1:false, 9:[null,0,null,0], 10:null, 16:tgt16, 20:pth[20], /*22:null,*/ 24:null, __proto__:pth};\r\n//          clg.threads[name] = {0:false, 1:false, 9:[null,0,null,0], 16:{th:{pn:null, __proto__:lth.th}, __proto__:pClg.threads[name][16]}, 22:null, 24:null, __proto__:pClg.threads[name]};\r\n//          clg.threads[name] = {0:pn, 1:false, 9:[null,0,null,0], 16:{__proto__:pClg.threads[name][16]}, 22:null, 24:[pn.firstChild, null,null,null,0x06], __proto__:pClg.threads[name]};\r\n      }\r\n      window.addEventListener('storage', Clg.prototype.Sync_watch_load, false); // debug\r\n      if (pClg.mode!=='float' && pref.float.auto_launch) setTimeout(make_watcher,1000); // 1000 for dummy, this works without delay.\r\n      \r\n      if (stats && pref.stats.auto_acquisition_scan && site.whereami!=='archive') setTimeout(stats.auto_acquisition_init, pref.stats.auto_acquisition_scan_delay*1000);\r\n      return {\r\n        destroy: function(){ // destructor\r\n//          if (!pref.test_mode['114']) {\r\n//            styleSheet.register_cc('headline','white-space:nowrap;text-overflow:ellipsis;overflow:hidden;width:100%');\r\n//            make_watcher();\r\n//            return this;\r\n//          }\r\n\r\n          cataLog.general_event_handler.destroy();\r\n//          for (var name in threads) gClg.remove_thread(name);\r\n//          pref_func.remove_onchange(pn12_0_2); // prevent leak.\r\n//          pref_func.remove_onchange(pn12_0_4); // prevent leak.\r\n          pref_func.mirror_targets.pn12_0_2 = null;\r\n          pref_func.mirror_targets.pn12_0_4 = null;\r\n//          catalog_clear_threads(0);\r\n          if (brwsr.sw_cache && brwsr.sw_cache.subscribe) brwsr.sw_cache.subscribe(false);\r\n//          pref_func.health_indicator = null;\r\n          health_indicator.destroy();\r\n//          if (embed_catalog) if (catalog_native_destroy) catalog_native_destroy();\r\n          cnst.auto_shrink_board_selector.destroy(board_sel);\r\n          window_beforeunload();\r\n//          pref_func.tooltips.remove_hier(pn12_triage);\r\n          triage.destroy();\r\n//          pref_func.tooltips.remove_hier(pn12_0_4);\r\n          Tooltips.remove_root(pn12_0_4);\r\n          Tooltips.hide();\r\n//          clearTimeout(auto_update_timer);\r\n//          auto_update.stop_if_running();\r\n          pn12.parentNode.removeChild(pn12);\r\n          window.removeEventListener('storage', site2[site.nickname].prep_own_posts_event, false); // debug\r\n          pn12 = null;\r\n          liveTag.pn = null;\r\n          for (var i in cataLog) cataLog[i] = null;\r\n          window.removeEventListener('storage', Clg.prototype.Sync_watch_load, false); // will be deleted.\r\n          return null;\r\n        },\r\n        triage_exe_pipe: triage_exe_pipe,\r\n        catalog_insert: catalog_insert,\r\n        pn12_0_4: pn12_0_4,\r\n        pn12_0_2: pn12_0_2,\r\n//        catalog_resized: catalog_resized,\r\n        get_threads: function(){return threads;},\r\n//        catalog_filter_changed: catalog_filter_changed,\r\n        scan_boards: scan_boards,\r\n        show_catalog: show_catalog,\r\n//        threads: threads,\r\n        catalog_liveTag_scan_site: onchange_funcs['scanSite'],\r\n        make_watcher: make_watcher,\r\n      }\r\n    }\r\n    return {\r\n      catalog_func: function(){return catalog_func;},\r\n//      scan_tags_common: scan_tags_common,\r\n      show_hide: show_hide,\r\n    }\r\n  }\r\n\r\n  var stats = (pref3.stats.use && !site0.isStep)? (function(){\r\n    var tree_404 = {};\r\n    function thread_removed(dbt){\r\n      var lth = liveTag.mems[dbt[0]][dbt[1]][dbt[2]];\r\n      if (lth.ss) {\r\n        if (Array.isArray(lth.ss)) for (var i=0;i<lth.ss.length;i++) {if (lth.ss[i].rm) lth.ss[i].rm.update_thread(lth.s, 0, true);}\r\n        else if (lth.ss.rm) lth.ss.rm.update_thread(lth.s, 0, true);\r\n      }\r\n      if (pref.stats.retain_404 && lth.s) {\r\n        if (!tree_404[dbt[0]]) tree_404[dbt[0]] = {};\r\n        if (!tree_404[dbt[0]][dbt[1]]) tree_404[dbt[0]][dbt[1]] = {};\r\n        tree_404[dbt[0]][dbt[1]][dbt[2]] = liveTag.mems[dbt[0]][dbt[1]][dbt[2]];\r\n//        if (tree_404[dbt[0]][dbt[1]].sr || Object.keys(tree_404[dbt[0]][dbt[1]]).length>64) update_board_rm(tree_404[dbt[0]][dbt[1]]);\r\n        if (pref.test_mode['44'] || tree_404[dbt[0]][dbt[1]].sr || Object.keys(tree_404[dbt[0]][dbt[1]]).length>64) update_board_rm(tree_404[dbt[0]][dbt[1]]);\r\n      }\r\n    }\r\n    \r\n    var label_funcs = {\r\n      hour: function(t){return new Date(t*60000).toString().split(' ')[4].replace(/:\\d*$/,'');},\r\n      day: function(t){return new Date(t*60000).toString().replace(/\\s\\d{4}.*/,'');},\r\n      sunday : function(t){\r\n        var str = new Date(t*60000).toString();\r\n        return (str.split(' ')[0]=='Sun')? str.replace(/\\s\\d{4}.*/,'') : '';\r\n      },\r\n      month : function(t){\r\n        var str = new Date(t*60000).toString();\r\n        return (str.split(' ')[2]=='01')? str.replace(/\\s\\d{4}.*/,'') : '';\r\n      },\r\n      quarter_year : function(t){\r\n        var strs = new Date(t*60000).toString().split(' ');\r\n        return (strs[2]<=7 && ['Jan','Apr','Jul','Oct'].indexOf(strs[1])!=-1)? strs.slice(1,4).join(' ') : '';\r\n      },\r\n    }\r\n    label_funcs['1'] = [60, label_funcs.hour, 1];\r\n//    label_funcs['2'] = [60, label_funcs.hour, 1]; // debug\r\n    label_funcs['10'] = [60, label_funcs.hour, 1];\r\n    label_funcs['60'] = [1440, label_funcs.day, 1];\r\n    label_funcs['1440'] = [1440, label_funcs.sunday, 0];\r\n    label_funcs['10080'] = [1440, label_funcs.quarter_year, 0];\r\n//    var time_unit_arr = [1,2,60,1440,10080]; // debug\r\n    var time_unit_arr = [1,10,60,1440,10080];\r\n\r\n    function thread_created(lth){\r\n      for (var i=0;i<instances.length;i++) {\r\n        var result = pref_func.merge_obj5(lth.key, instances[i].tgts_obj2,null);\r\n        if (result) instances[i].check_and_add_thread(lth);\r\n      }\r\n    }\r\n    var time_root = Math.floor(Date.now()/60000);\r\n    var instances= [];\r\n//    var count = 0;\r\n    var Stats = function(chart, tgts, key){\r\n      instances.push(this);\r\n      this.chart = chart;\r\n      this.tolerance = 0;\r\n//      this.name = 'graph_'+ count++;\r\n      this.draw = DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(this.refresh.bind(this), pref.stats.draw_delay*1000));\r\n      this.wdg_tick = new Watchdog(this.prep_time.bind(this), 60000);\r\n      this.fromNo = (pref3.stats.estimate_posts)? new StatsFromNo(this) : null; // for subscribe, this pointer can't be changed.\r\n      this.tgts_changed(tgts, key, true); // this.tgts, this.key\r\n      this.time_unit_changed(pref.chart.inst.time_sel, true); // this.time_base, this.time_unit, this.time_last, time_sel\r\n      this.len_changed((this.chart && this.chart.len>pref.stats.len_capture)? this.chart.len : pref.stats.len_capture); // this.len, this.data_p, this.data_t, this.data_l, this.min_idx, this.data_p_old, this.data_t_old, this.shift, this.rm.data_p, this.rm.data_t\r\n    };\r\n    Stats.prototype = {\r\n      destroy: function(){\r\n        this.chart = null;\r\n        this.save_all_unsubscribe(true);\r\n        this.wdg_tick.stop();\r\n        instances.splice(instances.indexOf(this),1);\r\n      },\r\n      merge_1: function(dst,src){\r\n        if (src) for (var i=0;i<src.length;i++) if (dst[i]<src[i]) dst[i] = src[i]; // src[i] may be undefined.\r\n        return dst;\r\n      },\r\n      merge_1_hier: function(dst,src, lower){\r\n        var num = this.time_unit/lower.time_unit;\r\n        var start = Math.ceil((lower.time_base - this.time_base)/this.time_unit);\r\n        var i = (num - (lower.time_base%this.time_unit)/lower.time_unit)%num; // start offset\r\n        while (i<src.length) {\r\n          this.merge_1_hier_1(dst, src, start, i, num, lower);\r\n          i+=num;\r\n          start++;\r\n        }\r\n      },\r\n      merge_1_hier_1: function(dst,src,idx_d,idx_s,num, lower){\r\n        var data = 0;\r\n        var end = (src.length>=idx_s+num)? num : src.length - idx_s;\r\n        for (var j=0;j<end;j++) data += src[idx_s+j];\r\n        if (pref.debug_mode['15'])\r\n          if (data>dst[idx_d])\r\n            console.log('merge_1_hier_1: '+this.time_unit+': '+idx_d+', '+dst[idx_d]+'->'+data+', '+\r\n                        new Date((this.time_base+idx_d*this.time_unit)*60000).toLocaleString()+', '+\r\n                        new Date((lower.time_base+idx_s*lower.time_unit)*60000).toLocaleString()+', '+num);\r\n        if (data>dst[idx_d]) dst[idx_d] = data;\r\n      },\r\n      save_all_unsubscribe: function(from_destructor){ // destructive\r\n        if (this.tgts && pref.stats.save && auto_acquisition_keys['@'+this.key]!==undefined) {\r\n          var timestamp = Math.floor(Date.now()/60000);\r\n          if (auto_acquisition_keys['@'+this.key]!==timestamp) { // prevent from saving twice in auto_acquisition\r\n            var chart_bak = this.chart;\r\n            this.chart = null; // don't draw\r\n            var idx = time_unit_arr.indexOf(this.time_unit);\r\n////            this.save();\r\n////            for (var i=1;i<time_unit_arr.length;i++) {\r\n////              this.time_unit_changed((idx+i)%time_unit_arr.length);\r\n////              this.save();\r\n////            }\r\n            var data_lower = null;\r\n            for (var i=0;i<time_unit_arr.length;i++) {\r\n              this.time_unit_changed(i);\r\n              this.save(data_lower);\r\n              data_lower = {data_p:this.data_p, data_t:this.data_t, time_unit:this.time_unit, time_base:this.time_base};\r\n            }\r\n            if (!from_destructor) this.time_unit_changed(idx);\r\n            this.chart = chart_bak;\r\n            auto_acquisition_keys['@'+this.key] = timestamp;\r\n          }\r\n        }\r\n        if (this.tgts) {\r\n          this.prep('both',this.prep_thread_unsubscribe);\r\n          if (this.fromNo) this.fromNo.prep('live',this.fromNo.prep_board_unsubscribe);\r\n        }\r\n      },\r\n      Zcompress: function(str){\r\n        return str.replace(/0,(0,)+/g,function(match){return 'z'+match.length/2+',';});\r\n//        var test2 = this.Zdecompress(test);\r\n//        if (test2!==str) console.log('ERROR: '+str+', '+test+', '+test2);\r\n//        return str;\r\n      },\r\n      Zdecompress: function(str){\r\n        return str.replace(/z(\\d+),/g,function(match,p1){\r\n          var str = '';\r\n          var len = parseInt(p1,10);\r\n          for(var i=0;i<len;i++) str+='0,';\r\n          return str;\r\n        });\r\n      },\r\n      get_ls_key: function(){\r\n        if (pref.test_mode['38']) return pref.script_prefix + '.graph.' + this.time_unit + '.' + this.key+'_test38';\r\n        return pref.script_prefix + '.graph.' + this.time_unit + '.' + this.key;\r\n      },\r\n      save: function(data_lower){ // destructive\r\n        if (this.data_p && pref.stats.load && pref.stats.save && localStorage) {\r\n          this.merge_1(this.data_p, this.data_p_old);\r\n          this.merge_1(this.data_t, this.data_t_old);\r\n          if (data_lower) {\r\n            this.merge_1_hier(this.data_p, data_lower.data_p, data_lower);\r\n            this.merge_1_hier(this.data_t, data_lower.data_t, data_lower);\r\n          }\r\n          var i=0;\r\n          while (i<this.data_p.length && this.data_p[i]===0 && this.data_t[i]===0) i++;\r\n          var data_save = [this.time_base+i*this.time_unit, this.data_p.slice(0,this.len+1).slice(i), this.data_t.slice(0,this.len+1).slice(i)];\r\nif (!pref.test_mode['42']) {\r\n          if (this.fromNo) {\r\n            var fN = this.fromNo;\r\n            fN.valid = true;\r\n            fN.prep('live',fN.prep_board_check_valid);\r\n            if (!fN.valid) for (var j=0;j<fN.data_p.length;j++) fN.data_p[j] = 0;\r\n            else if (fN.data_p_old) {\r\n              var idx_last = fN.data_p_old.length-1;\r\n              if (fN.data_p[idx_last]>fN.data_p_old[idx_last]) fN.data_p_old[idx_last] = fN.data_p[idx_last]; // overwrite last data, because last data may NOT complete its period.\r\n            }\r\n            if (fN.data_p_old) fN.data_p = fN.data_p_old.concat(fN.data_p.slice(fN.data_p_old.length));\r\n            for (var j=fN.data_p.length-2-this.tolerance;j<fN.data_p.length;j++) fN.data_p[j] = 0; // fill 0 to last 2 or more.\r\n            data_save[3] = fN.data_p.slice(0,this.len+1).slice(i);\r\n          }\r\n}\r\n          localStorage[this.get_ls_key()] = this.Zcompress(JSON.stringify(data_save));\r\n          if (pref.debug_mode['15']) console.log('saved: '+this.get_ls_key());\r\n        }\r\n      },\r\n      load: function(){\r\n        if (pref.stats.load && localStorage) {\r\n          var data = localStorage[this.get_ls_key()];\r\n          if (data) {\r\n            data = JSON.parse(this.Zdecompress(data));\r\n            var start = (this.time_base - data[0])/this.time_unit;\r\n            var end   = Math.floor((time_root - this.time_last)/this.time_unit); // negative value.\r\n            if (end===0) end = undefined;\r\n            if (start>=0) {\r\n              this.data_p_old = data[1].slice(start, end);\r\n              this.data_t_old = data[2].slice(start, end);\r\n              if (this.fromNo && data[3]) this.fromNo.data_p_old = data[3].slice(start, end);\r\n            } else {\r\n              this.data_p_old = this.array_init([],0,0).slice(0,-start).concat(data[1].slice(0,end));\r\n              this.data_t_old = this.array_init([],0,0).slice(0,-start).concat(data[2].slice(0,end));\r\n              if (this.fromNo && data[3]) this.fromNo.data_p_old = this.array_init([],0,0).slice(0,-start).concat(data[3].slice(0,end));\r\n            }\r\n            if (this.fromNo && this.fromNo.data_p_old) while (this.fromNo.data_p_old[this.fromNo.data_p_old.length-1]===0) this.fromNo.data_p_old.pop();\r\n          } else {\r\n            this.data_p_old = null;\r\n            this.data_t_old = null;\r\n          }\r\n        } \r\n      },\r\n      tgts_changed: function(tgts, key, skip_init){\r\n        this.save_all_unsubscribe();\r\n        this.tgts = tgts;\r\n        this.key = key;\r\n        this.tgts_obj2 = pref_func.str2obj2(tgts.join(','),null,true);\r\n        this.prep('both',this.prep_thread_subscribe);\r\n        if (!skip_init) this.init();\r\n      },\r\n      time_unit_changed: function(sel, skip_init){\r\n        if (this.fromNo) this.fromNo.prep('live',this.fromNo.prep_board_unsubscribe);\r\n//        this.save();\r\n//        if (typeof(sel)!=='number') sel = sel.target.selectedIndex;\r\n        this.time_sel = sel;\r\n        this.time_unit = time_unit_arr[sel];\r\n        if (!skip_init) this.init();\r\n      },\r\n      len_changed: function(len){\r\n//        this.save();\r\n        this.len = len;\r\n        this.init();\r\n      },\r\n      init: function(){\r\n        this.time_last = null; // force to remake\r\n        this.data_p = [];\r\n        this.data_t = [];\r\n        this.data_l = [];\r\n        this.rm = (this.chart && (this.chart.show.ep || this.chart.show.et))? new StatsRm(this) : null;\r\n        if (this.fromNo) {\r\n          this.fromNo.data_p = [];\r\n          this.fromNo.data_p_old = [];\r\n          this.fromNo.min_idx = 0;\r\n        }\r\n        this.refresh(true);\r\n      },\r\n      array_init: function(arr,start,val){\r\n        for (var i=start;i<this.len+2;i++) if (arr[i]===undefined) arr[i] = val; // len+2\r\n        return arr;\r\n      },\r\n      tz_offset: new Date().getTimezoneOffset(),\r\n      label_init: function(start){\r\n        var lfunc = label_funcs[this.time_unit];\r\n        var i = (lfunc[2])? Math.floor((Math.floor(((this.time_base-this.tz_offset) + (this.len+2)*this.time_unit)/lfunc[0])*lfunc[0] - (this.time_base-this.tz_offset))/this.time_unit) :\r\n                            this.len+2;\r\n        while (i>=start) {\r\n          this.data_l[i] = lfunc[1](this.time_base + i*this.time_unit);\r\n          i -= (lfunc[2])? lfunc[0]/this.time_unit : 1;\r\n        }\r\n      },\r\n      prep_time: function(init){\r\n        var time_now = Math.floor((Date.now()/60000+this.tolerance)/this.time_unit)*this.time_unit;\r\n        if (this.time_last!==time_now) {\r\n          var distance = (time_now - this.time_last)/this.time_unit;\r\n          this.time_last = time_now;\r\n          this.time_base = time_now - this.time_unit * this.len;\r\n          var start = 0;\r\n          if (!init && distance!==0) {\r\n            if (distance>this.len) distance = this.len;\r\n            this.data_p.splice(0,distance);\r\n            this.data_t.splice(0,distance);\r\n            this.data_l.splice(0,distance);\r\n            if (this.rm) {\r\n              this.rm.data_p.splice(0,distance);\r\n              this.rm.data_t.splice(0,distance);\r\n            }\r\n            if (this.fromNo) {\r\n              this.fromNo.data_p.splice(0,distance);\r\n              if (this.fromNo.data_p_old) {this.fromNo.data_p_old.splice(0,distance); if (this.fromNo.data_p_old.length===0) this.fromNo.data_p_old = null;}\r\n              this.fromNo.min_idx -= distance;\r\n            }\r\n            if (this.data_p_old) {this.data_p_old.splice(0,distance); if (this.data_p_old.length===0) this.data_p_old = null;}\r\n            if (this.data_t_old) {this.data_t_old.splice(0,distance); if (this.data_t_old.length===0) this.data_t_old = null;}\r\n            start = this.len - distance;\r\n            this.min_idx -= distance;\r\n            if (this.min_idx<0) this.min_idx = 0; // this.min_idx <= this.len, therefore this may occur.\r\n          }\r\n          this.array_init(this.data_p,start,0);\r\n          this.array_init(this.data_t,start,0);\r\n          this.array_init(this.data_l,start,'');\r\n          if (this.rm) {\r\n            this.array_init(this.rm.data_p,start,0);\r\n            this.array_init(this.rm.data_t,start,0);\r\n          }\r\n          if (this.fromNo) this.array_init(this.fromNo.data_p,start,0);\r\n          this.label_init(start);\r\n          this.shift = (init)? 0 : this.shift + distance;\r\n        }\r\n        this.wdg_tick.restart(this.time_unit*60000);\r\n      },\r\n      prep: function(tree, func, func_t){\r\n        for (var i=0;i<this.tgts.length;i++) {\r\n          var dbt = common_func.name2domainboardthread(this.tgts[i],true);\r\n          if (tree==='live' || tree==='both') this.prep_1(liveTag.mems, dbt, func, func_t);\r\n          if (tree==='dead' || tree==='both') this.prep_1(tree_404, dbt, func, func_t);\r\n        }\r\n      },\r\n      prep_1: function(tree, dbt, func, func_t){\r\n        if (dbt[2]) {\r\n          if (tree[dbt[0]] && tree[dbt[0]][dbt[1]] && tree[dbt[0]][dbt[1]][dbt[2]] && func_t!==null) ((func_t)? func_t : func).call(this,tree[dbt[0]][dbt[1]][dbt[2]]);\r\n        } else if (dbt[1]) {\r\n          if (tree[dbt[0]] && tree[dbt[0]][dbt[1]]) this.prep_board(tree[dbt[0]][dbt[1]],func, func_t);\r\n        } else {\r\n          if (tree[dbt[0]]) this.prep_domain(tree[dbt[0]],func, func_t);\r\n        }\r\n      },\r\n      prep_domain: function(ld,func){\r\n        for (var b in ld) this.prep_board(ld[b],func, func_t);\r\n      },\r\n      prep_board: function(ldb,func){\r\n        for (var t in ldb) func.call(this,ldb[t]);\r\n      },\r\n      prep_thread_init: function(ldbt){\r\n        if (ldbt.s) this.update_thread(ldbt.s, 0);\r\n      },\r\n      check_and_add_thread: function(ldbt){\r\n        if (ldbt.s && !this.prep_thread_unsubscribe(ldbt,true)) {\r\n          this.update_thread(ldbt.s, 0, true);\r\n          this.prep_thread_subscribe(ldbt);\r\n        }\r\n      },\r\n      prep_thread_subscribe: function(ldbt){\r\n        if (Array.isArray(ldbt.ss)) ldbt.ss.push(this);\r\n        else if (ldbt.ss) ldbt.ss = [ldbt.ss, this];\r\n        else ldbt.ss = this;\r\n      },\r\n      prep_thread_unsubscribe: function(ldbt, check_only){\r\n        if (Array.isArray(ldbt.ss)) {\r\n          var idx = ldbt.ss.indexOf(this);\r\n          if (check_only) return (idx!==-1);\r\n          if (idx!=-1) {\r\n            ldbt.ss.splice(idx,1);\r\n            if (ldbt.ss.length===1) ldbt.ss = ldbt.ss[0];\r\n          }\r\n        } else if (ldbt.ss===this) {\r\n          if (check_only) return true;\r\n          delete ldbt.ss;\r\n        } else return false;\r\n      },\r\n      refresh: function(init){\r\n        if (pref.debug_mode['15']) console.log('updated: '+this.data_p.slice(this.len-10).toString()+', '+this.min_idx);\r\n        this.prep_time(init);\r\n        if (init) {\r\n          this.prep('live',this.prep_thread_init);\r\n          this.rm_tmp = new StatsRm(this, this.data_p, this.data_t);\r\n          this.rm_tmp.prep('dead',this.rm_tmp.prep_board_init, this.prep_thread_init);\r\n          if (this.rm) this.rm.prep('dead',this.rm.prep_board_init, this.prep_thread_init);\r\n          if (this.fromNo) this.fromNo.prep('live',this.fromNo.prep_board_init, true);\r\n          this.load();\r\n          if (this.chart) this.chart.replace_data(this);\r\n        } else if (this.shift!==0 || this.min_idx!==this.data_p.length) {\r\n          if (this.fromNo) this.fromNo.prep('live',this.fromNo.prep_board_init, false, true);\r\n          if (this.chart) this.chart.update_data2(this);\r\n        }\r\n        this.min_idx = this.data_p.length; // 'this.min_idx = this.len-1;' is suitable if local and server clocks are synced.\r\n      },\r\n//      remove_thread: function(s, start, from_thread){\r\n//        this.update_thread(s, start, from_thread);\r\n//        if (this.min_idx!==undefined) {\r\n//          this.__proto__.min_idx = this.min_idx;\r\n//          delete this.min_idx;\r\n//        }\r\n//      },\r\n      update_thread: function(s, start, from_thread){\r\n        if (!s) return;\r\n        if (start===0) this.update_thread_1(this.data_t, s, 0, 0);\r\n        this.update_thread_1(this.data_p, s, start, s.length-1);\r\n        if (from_thread) this.draw();\r\n      },\r\n      update_thread_1: function(data, s, start, end){\r\n        for (var j=end;j>=start;j--) {\r\n          var idx = Math.floor((s[j]-this.time_base)/this.time_unit);\r\n          var idx_over = idx - this.len -1;\r\n          if (idx_over>0) {\r\n            if (pref.stats.tolerant) {\r\n              this.tolerance = idx_over*this.time_unit + this.tolerance;\r\n              if (this.tolerance>pref.stats.tolerance) this.tolerance = pref.stats.tolerance;\r\n              this.prep_time(false);\r\n            }\r\n            idx = this.len+1;\r\n          }\r\n          if (idx>=0) {\r\n//            data[(idx<=this.len)? idx : this.len+1]++;\r\n            data[idx]++;\r\n            if (idx<this.min_idx) this.min_idx = idx;\r\n          } else break;\r\n        }\r\n      },\r\n    };\r\n    var StatsRm = function(parent, data_p, data_t){\r\n      this.data_p = data_p || [];\r\n      this.data_t = data_t || [];\r\n      Object.defineProperty(this,'min_idx',{set: function(val){this.__proto__.min_idx = val;},\r\n                                            get: function(){return this.__proto__.min_idx;}, // necessary\r\n                                            configurable:true, enumerable:true});\r\n      for (var i in StatsRm_prototype) this[i] = StatsRm_prototype[i];\r\n      this.__proto__ = parent;\r\n    };\r\n    var StatsRm_prototype = {\r\n      prep_board: function(ldb,func, func_t){\r\n        if (ldb.sr) func.call(this,ldb);\r\n        else for (var t in ldb) func_t.call(this,ldb[t]);\r\n      },\r\n      prep_board_init: function(ldb){ // for initial only\r\n        this.prep_board_init_1(ldb.sr, this.data_p);\r\n        this.prep_board_init_1(ldb.srt,this.data_t);\r\n      },\r\n      prep_board_init_1: function(ldbs,dst){ // for initial only\r\n        var data = ldbs[this.time_sel][1];\r\n        var offset = (this.time_base - ldbs[this.time_sel][0])/this.time_unit; // offset>=0 is always true.\r\n        var i = offset;\r\n        while (i<data.length) {\r\n          if (data[i]) dst[i-offset] += data[i];\r\n          i++;\r\n        }\r\n      },\r\n    };\r\n    var StatsFromNo = function(parent){\r\n      this.data_p = [];\r\n      this.min_idx = 0;\r\n      for (var i in StatsFromNo_prototype) this[i] = StatsFromNo_prototype[i];\r\n      this.__proto__ = parent;\r\n    };\r\n    var StatsFromNo_prototype = {\r\n      prep_board_subscribe: function(ldb){\r\n        if (!ldb.s) setup_board_no(ldb,'s');\r\n        ldb.s[this.time_sel][2].push(this);\r\n      },\r\n      prep_board_unsubscribe: function(ldb){\r\n        if (ldb.s && this.time_sel) {\r\n          var idx = ldb.s[this.time_sel][2].indexOf(this);\r\n          if (idx!=-1) ldb.s[this.time_sel][2].splice(idx,1);\r\n        }\r\n      },\r\n      prep: function(tree, func, subscribe, aggregate){\r\n        if (subscribe) this.__proto__.prep.call(this.fromNo,'live',this.fromNo.prep_board_subscribe, null);\r\n        if (aggregate) for (var i=this.min_idx;i<this.data_p.length;i++) this.data_p[i] = 0;\r\n        this.new_vals = {};\r\n        this.__proto__.prep.call(this, 'live', func, null);\r\n        for (var i in this.new_vals) this[i] = this.new_vals[i];\r\n        delete this.new_vals;\r\n      },\r\n      prep_board: function(ldb,func){\r\n        func.call(this,ldb);\r\n      },\r\n      prep_board_init: function(ldb,func){\r\n        var data = ldb.s[this.time_sel][1];\r\n        var offset = (this.time_base - ldb.s[this.time_sel][0])/this.time_unit; // offset>=0 is always true.\r\n        var i = this.min_idx + offset;\r\n        if (i<2) i = 2; // skip [0], because [0] contains old data.\r\n        var data_last;\r\n        var j=i-1;\r\n        while (j>0 && !data[j]) j--;\r\n        if (j>0) data_last = data[j];\r\n        else {\r\n          while (i<data.length && !data[i]) i++;\r\n          data_last = data[i++];\r\n        }\r\n        if (pref.stats.patch_tm) {\r\n          var idx_last = ((j>0)? j : i-1)-offset;\r\n          var idx_last2 = idx_last; // for not writing any data\r\n          while (i<data.length) {\r\n            if (data[i]) {\r\n              this.data_p[idx_last] += data[i] - data_last;\r\n              data_last = data[i];\r\n              idx_last2 = idx_last;\r\n              idx_last = i-offset;\r\n            }\r\n            i++;\r\n          }\r\n          if (this.new_vals.min_idx===undefined || this.new_vals.min_idx > idx_last2) this.new_vals.min_idx = idx_last2;\r\n        } else {\r\n          while (i<data.length) {\r\n            if (data[i]) {\r\n              this.data_p[i-offset] += data[i] - data_last;\r\n              data_last = data[i];\r\n            }\r\n            i++;\r\n          }\r\n          if (this.new_vals.min_idx===undefined || this.new_vals.min_idx > i - offset) this.new_vals.min_idx = i - offset;\r\n        }\r\n      },\r\n      update_posts_no: function(time_base,idx_in){\r\n        var idx = (time_base-this.time_base)/this.time_unit + idx_in;\r\n        if (idx>=0 && idx<this.min_idx) this.min_idx = idx;\r\n      },\r\n      prep_board_check_valid: function(ldb,func){\r\n        this.valid &= ldb.s[time_unit_arr.length]>=0;\r\n      },\r\n//      __proto__: Stats.prototype\r\n    };\r\n////    function setup_board_no(ldb, data, time_sel){\r\n////      for (var t in ldb) if (ldb[t].s) update_posts_no_1(ldb[t].s, ldb[t].sn, 0, ldb, time_sel);\r\n////      var j=0;\r\n////      while (j<data.length && !data[j]) j++;\r\n////      if (j!==0 && j!=data.length) for (var i=0;i<j;i++) data[i] = data[j];\r\n////if (pref.test_mode['43']) {\r\n////      while (j<data.length) {if (!data[j]) data[j] = data[j-1];j++;} // cause spike\r\n////} else {  \r\n////      while (j<data.length) { // average, not debugged.\r\n////        var j_old = j++;\r\n////        while (j<data.length && !data[j]) j++;\r\n////        if (j_old+1===j) continue;\r\n////        if (j<data.length) {\r\n//////console.log('setup_board_no: averaging: '+j_old+', '+j);\r\n////          var step = (data[j]-data[j_old])/(j-j_old);\r\n////          for (var i=1;i<j-j_old;i++) data[j_old+i] = data[j_old]+Math.floor(step*i);\r\n////        }\r\n////      }\r\n////}\r\n////    }\r\n    function update_board_rm(ldb){\r\n      if (!ldb.sr) {\r\n        setup_board_no(ldb,'sr');\r\n        setup_board_no(ldb,'srt');\r\n//        for (var i=0;i<time_unit_arr.length;i++) for (var j=0;j<pref.stats.len_capture+2;j++) ldb.sr[i][1][j] = 0;\r\n      }\r\n      for (var t in ldb) {\r\n        if (ldb[t].s) for (var i=0;i<time_unit_arr.length;i++) {\r\n          update_posts_no_1(ldb.sr[i],  null, 0, ldb[t].s.length, ldb[t].s, time_unit_arr[i], update_posts_rm_1_func, 0);\r\n          update_posts_no_1(ldb.srt[i], null, 0, 1,               ldb[t].s, time_unit_arr[i], update_posts_rm_1_func, 0);\r\n        }\r\n        delete ldb[t];\r\n      }\r\n    }\r\n    function setup_board_no(ldb,key){\r\n      Object.defineProperty(ldb, key, {value:[], configurable:true, writable:false});\r\n      for (var i=0;i<time_unit_arr.length;i++) {\r\n//        ldb[key][i] = [null,[],[],0]; // [time_base, data, subscribers, tolerance]\r\n        ldb[key][i] = [null,(i<3)?[]:{length:pref.stats.len_capture+2, __proto__:Array.prototype},[],0];\r\n//        ldb[key][i] = [null,{length:pref.stats.len_capture+2, __proto__:Array.prototype},[],0]; // debug // length isn't updated automatically after 'splice' shorten it.\r\n        update_posts_no_time(ldb[key][i], time_unit_arr[i]);\r\n      }\r\n      if (key==='s') ldb[key][time_unit_arr.length] = -Object.keys(ldb).length; // count\r\n    }\r\n    function update_posts_no_time(ldbst, time_unit, idx_over){\r\n      var time_now = Math.floor((Date.now()/60000 + ldbst[3])/time_unit)*time_unit;\r\n      var time_base = time_now - time_unit * pref.stats.len_capture;\r\n      if (!ldbst[0]) {ldbst[0] = time_base;return;} // initialize\r\n      else if (time_base!==ldbst[0] || idx_over) {\r\n        var shift = (time_base-ldbst[0])/time_unit;\r\n        var shift_add = 0;\r\n        if (idx_over>shift && pref.stats.tolerant) {\r\n          if (ldbst[3] + (idx_over-shift)*time_unit<pref.stats.tolerance) {\r\n            ldbst[3] = idx_over*time_unit;\r\n            shift_add = idx_over - shift;\r\n          } else {\r\n            ldbst[3] = pref.stats.tolerance;\r\n            shift_add = Math.floor((pref.stats.tolerance-ldbst[3])/time_unit);\r\n          }\r\n        }\r\n        ldbst[1].splice(0, shift + shift_add);\r\n        if (!Array.isArray(ldbst[1])) ldbst[1].length = pref.stats.len_capture+2;\r\n//        var last_data = ldbst[1][ldbst[1].length-1];\r\n//        for (var i=0;i<shift+shift_add;i++) ldbst[1][ldbst[1].length] = last_data;\r\n        ldbst[0] = time_base + shift_add*time_unit;\r\n        return shift + shift_add;\r\n      }\r\n    }\r\n    function update_posts_rm_1_func(data,idx){\r\n      data[idx] = (data[idx] || 0) +1;\r\n    }\r\n    function update_posts_no_1_func(data,idx,th,j){\r\n      var post_no = th.posts[j].no || th.no;\r\n      if (data[idx]===undefined || data[idx]<post_no) data[idx] = post_no;\r\n    }\r\n    function update_posts_no_1_func_min(data,idx,th,j){ // for 4chan's bug, corrupted timeline when a thread is moved from other board.\r\n      var post_no = th.posts[j].no || th.no;\r\n      if (data[idx]===undefined || data[idx]>post_no) data[idx] = post_no; // THIS REQUIRES IN-ORDER OR FULL SCAN in update_posts_no_1 and PICKUP in ??? must be shifted by 1.\r\n    }\r\n    function update_posts_no(ldb, th, start, lths){\r\n      if (!ldb.s) setup_board_no(ldb,'s');\r\n      for (var i=0;i<time_unit_arr.length;i++) update_posts_no_1(ldb.s[i], th, start, lths.length, lths, time_unit_arr[i],\r\n        (pref.stats.patch_tm)? update_posts_no_1_func_min : update_posts_no_1_func, th.posts.length);\r\n      ldb.s[time_unit_arr.length]++;\r\n    }\r\n    function update_posts_no_1(ldbst, th, start, end, lths, time_unit, func, j){\r\n      var time_base = ldbst[0];\r\n      var data = ldbst[1];\r\n      var idx_old;\r\n      for (var p=end-1;p>=start;p--) {\r\n        var idx = Math.floor((lths[p]-time_base)/time_unit);\r\n        if (--j>=0 && idx===idx_old && !pref.stats.patch_tm) continue; // full scan at patch_tm\r\n        var idx_over = idx - pref.stats.len_capture -1;\r\n        if (idx_over>0) {\r\n          idx -= update_posts_no_time(ldbst, time_unit, idx_over);\r\n          if (idx>pref.stats.len_capture+1) idx = pref.stats.len_capture+1;\r\n          time_base = ldbst[0];\r\n        } else if (idx<0) idx = 0;\r\n        func(data,idx,th,j);\r\n        if (idx===0 && !pref.stats.patch_tm) break;\r\n        idx_old = idx;\r\n      }\r\n      for (var k=0;k<ldbst[2].length;k++) ldbst[2][k].update_posts_no(time_base,idx);\r\n    }\r\n        \r\n    var auto_acquisition_keys = {};\r\n    function get_ac_key(sel){return pref.catalog_board_list_obj[sel][0].key;} // key is a user string.\r\n    function auto_acquisition_beforeunload(){\r\n      if (pref.stats.auto_acquisition && cataLog.embed_mode!=='thread')\r\n        for (var i=pref.catalog_board_list_obj.length-1;i>=0;i--)\r\n          if (auto_acquisition_keys['@'+get_ac_key(i)]!==undefined) {\r\n            var tgts = pClg.refresh_1('chart', false, false, false, false, i, false, true);\r\n            if (typeof(tgts)!=='function') new Stats(null, tgts, get_ac_key(i), false).destroy();\r\n          }\r\n    }\r\n    window.addEventListener('beforeunload', auto_acquisition_beforeunload, false);\r\n    function auto_acquisition_init(idx){\r\n      if (pref.stats.auto_acquisition && pClg && pClg.refresh_1 && cataLog.embed_mode!=='thread') {\r\n        if (idx===undefined) idx = pref.catalog_board_list_obj.length-1;\r\n        while (idx>=0 && (!pref.catalog_board_list_obj[idx][0].cmds || pref.catalog_board_list_obj[idx][0].cmds.indexOf('stats')===-1)) idx--;\r\n        if (idx>=0) {\r\n          if (pref.stats.auto_acquisition) stats.register_auto_acquisition(idx);\r\n          var result = pClg.refresh_1('chart', false, false, false, 'stats_ac', idx, false, true, function(){auto_acquisition_init(idx-1);});\r\n          if (typeof(result)==='function') result(function(){auto_acquisition_init(idx);});\r\n        }\r\n      }\r\n    }\r\n//    if (pref.stats.auto_acquisition_scan && site.whereami!=='archive') setTimeout(auto_acquisition_init, pref.stats.auto_acquisition_scan_delay*1000);\r\n    return {\r\n      aggregate: function(th, posts, passive){\r\n        var ldb = liveTag.mems[th.domain][th.board];\r\n        var lth = ldb[th.no];\r\n        if (!lth.s) {\r\n          lth.s = []; // stat\r\n          if (!passive) posts = (lth.pd && pref.test_mode['128'])? site2[lth.domain].update_posts_merge_prep(th.posts, lth.pd, -1, true) : th.posts;\r\n          else if (posts.next) posts.step = (posts.next - posts.start)/posts.length;\r\n        }\r\n        var tu = th.parse_funcs.time_unit;\r\n        var start = lth.s.length;\r\n        var p = start;\r\n        var i = 0; // can count deleted posts\r\n        if (!passive)       while (i<posts.length) lth.s[p++] = Math.floor(posts[i++].time * tu / 60000);\r\n        else {\r\n          var period = (posts.next||posts.now) - th.time;\r\n          var base = pref.test_mode.num || 3600000;\r\n          if (p<=1 && period>base) { // assumes geometric sequence // 'p<=1' is patch for RSS\r\n            var multiple = Math.pow(2,Math.log2((period+base)/base)/posts.length);\r\n            var tn = p? base*multiple : base;\r\n            while (p<posts.length) {\r\n              lth.s[p++] = Math.floor((posts.start + tn-base) / 60000);\r\n              tn *= multiple;\r\n            }\r\n          } else while (i<posts.length) lth.s[p++] = Math.floor((posts.start + posts.step*i++) / 60000);\r\n        }\r\n//        else          while (i<posts.length) lth.s[p++] = Math.floor(posts[i++]           / 60000);\r\n//        var i = th.posts.length - (th.nof_posts - lth.s.length); // working, but can't count deleted posts\r\n//        if (i<0) return; // i=0; // {p=-i; i=0;} // patch for short thread (last 50 replies) at embed_mode==='thread'.\r\n//        while (i<th.posts.length) lth.s[p++] = Math.floor(th.posts[i++].time * tu / 60000);\r\n        if (lth.ss) { // subscribers\r\n          if (Array.isArray(lth.ss)) for (var i=0;i<lth.ss.length;i++) lth.ss[i].update_thread(lth.s,start, true);\r\n          else lth.ss.update_thread(lth.s,start, true);\r\n        } else if (start===0) thread_created(lth);\r\n        if (pref3.stats.estimate_posts && !passive) update_posts_no(ldb, th, start, lth.s, th.posts.length);\r\n      },\r\n      aggregate_passive: function(th, nof_new_posts, time_now){\r\n        var time_prev = liveTag.mems[th.domain][th.board].st || th.time_tu;\r\n        var time_step = (time_now - time_prev)/nof_new_posts;\r\n        var posts = {start:time_prev, step:time_step, length:nof_new_posts, next:th.time_nextThread, now:time_now}; // putting this into function call causes 'Not optimized:' on chrome50\r\n        this.aggregate(th, posts, true);\r\n//        var posts = [];\r\n//        for (var i=0;i<nof_new_posts;i++) posts[i] = time_prev + i*time_step;\r\n//        this.aggregate(th, posts, true);\r\n      },\r\n      thread_removed: thread_removed,\r\n      Stats: Stats,\r\n      register_auto_acquisition: function(sel){\r\n        auto_acquisition_keys['@'+get_ac_key(sel)] = null;\r\n        cnst.auto_shrink_board_selector.color();\r\n      },\r\n      query_auto_acquisition: function(sel){\r\n        return auto_acquisition_keys['@'+get_ac_key(sel)]!==undefined;\r\n      },\r\n//      redraw_all: function(){\r\n//        for (var i=0;i<instances.length;i++) instances[i].init();\r\n//      }\r\n      auto_acquisition_init: auto_acquisition_init,\r\n    };\r\n  })() : null;\r\n               \r\n\r\n  function make_chart_obj(pn1){\r\n//    var pref_graph = {key: null, pipe: null}; // working code.\r\n//    pn1.addEventListener('click', show_hide, false);\r\n//    var data = chart_data_init();\r\n//    pref_graph.key = pref.script_prefix + '.graph.' + site.board;\r\n//    if (localStorage && pref.load_data && localStorage.getItem(pref_graph.key)!==null) data = brwsr.JSON_parse(localStorage.getItem(pref_graph.key));\r\n//\r\n//    var pn2_func = null;\r\n//    function show_hide(){  // Toggle Show/Hide\r\n//      if (pn2_func==null) pn2_func = prep_pn2();\r\n//      else pn2_func = pn2_func.destroy();\r\n//    }\r\n//    var size_loc = ['400px', '400px', '5px', '50px', '120px', '390px'];\r\n\r\n    var time_unit_sel_html =\r\n      '<select name=\"chart.inst.time_sel\">'+\r\n        '<option>1 min</option>'+\r\n        '<option>10 mins</option>'+\r\n        '<option>1 hour</option>'+\r\n        '<option>1 day</option>'+\r\n        '<option>1 week</option>'+\r\n      '<select>';\r\n    var chart_options_str = [\r\n        'Number of points: <ITB3\"chart.inst.len\"><br>',\r\n        'Scale of new thread: <ITB3\"chart.inst.scale_thread\"><br>',\r\n//        '<input type=\"checkbox\" name=\"chart.inst.separate\">Separate estimated, observed and alive<br>',\r\n        'Show: Posts/Threads:<br>',\r\n        '&emsp;&emsp;<IC\"chart.inst.show.np\"><IC\"chart.inst.show.nt\" disabled style=\"visibility:hidden\">Estimated, <IC\"chart.inst.clip_np\">Clip:<ITB4\"chart.inst.clip_np_val\"><br>',\r\n        '&emsp;&emsp;<IC\"chart.inst.show.p\"><IC\"chart.inst.show.t\">Observed<br>',\r\n        '&emsp;&emsp;<IC\"chart.inst.show.ep\"><IC\"chart.inst.show.et\">Alive<br>',\r\n        '<IC\"chart.inst.show_legend\">Legend<br>',\r\n        '<IC\"chart.inst.options.animation\">Animation (Doesn\\'t work on FF)<br>',\r\n        '<IC\"chart.inst.options.pointDot\">Point dot: radius <ITB1\"chart.inst.options.pointDotRadius\"><br>'\r\n      ];\r\n    if (!pn1) return {\r\n      time_unit_sel_html: time_unit_sel_html,\r\n      chart_options_str: chart_options_str,\r\n    }\r\n\r\n    pn1.addEventListener('click', make_new_chart, false);\r\n    var charts = [];\r\n    function make_new_chart(){\r\n      new PostChart();\r\n    }\r\n    function window_focus(){\r\n      cnst.foreach(charts, function(inst){inst.chart_posts.options.animation = inst.options.animation;});\r\n    }\r\n    function window_blur(){\r\n      if (pref.chart.off_anime_blur) cnst.foreach(charts, function(inst){inst.chart_posts.options.animation = false;});\r\n    }\r\n    function destroy_all(){\r\n      cnst.foreach(charts, function(inst){inst.destroy();});\r\n    }\r\n    window.addEventListener('beforeunload', destroy_all, false);\r\n\r\n    var chartCount = 0;\r\n    var PostChart = function(pn_popup, tgts, skelton){\r\n//      this.data_graph;\r\n//      this.chart_posts;\r\n      if (!skelton) common_func.deep_copy(this,pref.chart.inst);\r\n      if (!pn_popup) {\r\n        cnst.subscribe(charts,this);\r\n        if (chartCount.length===0) {\r\n          common_func.dom_addEventListener(common_obj.events_beforeunload, window, 'focus', window_focus);\r\n          common_func.dom_addEventListener(common_obj.events_beforeunload, window, 'blur', window_blur);\r\n        }\r\n        this.name = 'graph_' + chartCount++;\r\n\r\n        this.pn2_obj = cnst.init3({\r\n          this_obj:this,\r\n          __proto__:this.pn2_template});\r\n        var pn2 = this.pn2_obj.pn;\r\n        var pn2_2 = cnst.add_to_tb(pn2, time_unit_sel_html + (!skelton? '<select name=\"chart.inst.board_sel\"><select>' : '')+ cnst.icons.button_settings());\r\n        pn2.childNodes[1].innerHTML = pref_func.format_html_str(\r\n          '<div style=\"display:none\">'+\r\n            '<div style=\"float:right\">'+ chart_options_str.join('') + '</div>'+\r\n            '<div style=\"clear:both\"></div>'+\r\n          '</div>'+\r\n          '<div style=\"position:relative\"></div>');\r\n        pref_func.apply_prep(pn2,false, undefined, undefined, undefined, skelton? {chart:{inst:this}} : undefined);\r\n        var sels = pn2.getElementsByTagName('select');\r\n        cnst.auto_shrink_selector(sels['chart.inst.time_sel']);\r\n        this.legend = cnst.init3({func_str:'border:1px solid lightblue:cursor:move:position:absolute:left:80px:top:40px'}); // :dragStopProp'});\r\n        this.legend.pn.style.zIndex = null;\r\n        this.pn2 = pn2;\r\n        this.set_legend_str();\r\n        var onchange_entry_bound = this.onchange_entry.bind(this);\r\n        pn2.childNodes[0].onchange = onchange_entry_bound;\r\n        pn2.childNodes[1].childNodes[0].onchange = onchange_entry_bound;\r\n        if (skelton) {\r\n          cnst.bottom_top(pn2);\r\n////          pn2.style.top = parseInt(skelton.pn_canvas_root.style.top,10) - pn2.offsetHeight + 'px';\r\n////          pn2.style.left = skelton.pn_canvas_root.style.left;\r\n//          this.show_legend = false;\r\n//          var pns = pn2.querySelectorAll('input[name],textarea[name],select[name]');\r\n//          for (var i=0;i<pns.length;i++) {\r\n//            var tgt_hier = pref_func.get_tgt(pns[i].getAttribute('name').replace(/chart.inst./,''),this);\r\n//            pref_func.apply_prep_load(pns[i],tgt_hier[0], tgt_hier[1]);\r\n//          }\r\n////          pn2.childNodes[1].replaceChild(skelton.pn_canvas_root, pn2.childNodes[1].childNodes[1]);\r\n          return pn2;\r\n        }\r\n        this.pn_board_sel = sels['chart.inst.board_sel'];\r\n        cnst.auto_shrink_board_selector.setup(this.pn_board_sel, pref.catalog_board_list_sel);\r\n        this.board_sel = pref.catalog_board_list_sel;\r\n        this.pn_canvas_root = pn2.childNodes[1].childNodes[1];\r\n      } else {\r\n        this.pn_canvas_root = pn_popup;\r\n        this.show_legend = false;\r\n        this.show = {np:false, p:true, ep:false, nt:false, t:true, et:false};\r\n      }\r\n      this.pn_canvas_root.style.width = pref.chart.window_width + 'px';\r\n      this.pn_canvas_root.style.height = pref.chart.window_height + 'px';\r\n      this.pn_canvas_root.style.resize = 'both';\r\n      this.pn_canvas_root.style.overflow = 'hidden';\r\n      this.pn_canvas = document.createElement('canvas');\r\n      this.pn_canvas_root.appendChild(this.pn_canvas);\r\n      this.chart_size_changed(true); // patch\r\n  //      this.chart_create_draw(); called from stats\r\n      this.stats = (!pn_popup)? new stats.Stats(this, this.get_tgts(), pref.catalog_board_list_obj[this.board_sel][0].key) : // call 'chart_create_draw' in this.\r\n                                new stats.Stats(this, tgts, 'popup');\r\n  //      this.track_legend_pos();\r\n  ////      pn2.addEventListener('resize',  //) // can't get.\r\n      this.canvas_active = true;\r\n      this.pn_canvas_root.onmousemove = this.deactivate_canvas_if_mouse_on_corner.bind(this);\r\n      this.pn_canvas_root.onclick = this.chart_size_changed.bind(this);\r\n  //      pn2.ondragover = this.dragover_pn2.bind(this);\r\n  //      pn2.ondrop = this.drop_pn2.bind(this);\r\n  //      this.legend.pn.ondragend = function(e){e.stopPropagation();};\r\n      if (this.show_legend) this.append_legend();\r\n      if (!pn_popup) cnst.bottom_top(pn2);\r\n    };\r\n    PostChart.prototype = {\r\n      get_tgts: function(scan_name){\r\n        return (!pClg.refresh_1)? [site.nickname+site.board]\r\n                                : pClg.refresh_1('chart', false, false, false, scan_name, this.board_sel, false, true);\r\n      },\r\n      board_sel_changed: function(e){\r\n        e.target.blur();\r\n        var tgts = this.get_tgts((pref.chart.instant_scan)? this.name : null); // also scan\r\n        if (typeof(tgts)==='function') tgts(this.board_sel_changed.bind(this));\r\n        else this.stats.tgts_changed(tgts, pref.catalog_board_list_obj[this.board_sel][0].key);\r\n      },\r\n      len_changed: function(){\r\n        if (this.len>this.stats.len) this.stats.len_changed.call(this.stats, this.len); // call redraw\r\n        else if (this.stats.len!=pref.stats.len_capture) this.stats.len_changed.call(this.stats, pref.stats.len_capture); // call redraw\r\n        else this.replace_data(this.data_src);\r\n      },\r\n      deactivate_canvas_if_mouse_on_corner: function(e){\r\n        var ecTs = e.currentTarget.style;\r\n        if ((parseInt(ecTs.width,10) - e.offsetX<=10 && parseInt(ecTs.height,10) - e.offsetY<=10) ^ !this.canvas_active) {\r\n          this.pn_canvas.style.pointerEvents = this.canvas_active? 'none' : 'auto';\r\n          this.canvas_active = !this.canvas_active;\r\n        }\r\n      },\r\n      chart_size_changed: function(init){ // patch\r\n//        if (str==='top' || str==='bottom') this.pn_canvas_root.style.overflow = '';\r\n//        else if (typeof(str)==='string') this.pn_canvas_root.style.overflow = 'hidden';\r\n//        this.pn_canvas_root.style.resize = 'both';\r\n//        if (this.pn_canvas_root.style.overflow==='hidden') {\r\n//        if (this.pn2_obj.maximize_state_str==='float') {\r\n        this.pn_canvas.style.width  = this.pn_canvas_root.style.width;\r\n        this.pn_canvas.style.height = this.pn_canvas_root.style.height; // (this.pn_canvas_root.style.height.replace(/px/,'')-10)+'px';\r\n        this.pn_canvas.width  = this.pn_canvas_root.clientWidth;\r\n        this.pn_canvas.height = this.pn_canvas_root.clientHeight; // - 10;\r\n//        }\r\n        if (init!==true) this.chart_redraw();\r\n      },\r\n      chart_redraw: function(){ // old 'chart_create_draw' in this.\r\n        if (this.chart_posts) this.chart_posts.destroy();\r\n        \r\n        this.data_graph = chart_data_init(); // deep copy always.\r\n        var dd = this.data_graph.datasets;\r\n        var fN = this.data_src.fromNo;\r\n        var dr = this.data_src.rm;\r\n        var ds = this.data_src;\r\n//        this.idxs  = (dr)? ((fN)? {p:1, t:3, ep:2, et:4, np:0} : {p:0, t:2, ep:1, et:3}) :\r\n//                           ((fN)? {t:1, np:0} : {t:1, p:0});\r\n        var layer = 0;\r\n        this.idxs = {};\r\n        var idxs = this.idxs;\r\n        idxs.np = (fN && this.show.np)? layer++ : -1;\r\n        idxs.p  = (      this.show.p )? layer++ : -1;\r\n        idxs.ep = (dr && this.show.ep)? layer++ : -1;\r\n        idxs.t  = (      this.show.t )? layer++ : -1;\r\n        idxs.et = (dr && this.show.et)? layer++ : -1;\r\n\r\n        if (idxs.np!=-1) dd[idxs.np] = chart_data_init_1('post_fromNo','151,187,205',0.2);\r\n        if (idxs.p !=-1) dd[idxs.p ] = chart_data_init_1('Posts','98,152,179', 0.2);\r\n        if (idxs.ep!=-1) dd[idxs.ep] = chart_data_init_1('exist_p','66,119,136',0.15); // '151,187,205',0.2\r\n        if (idxs.t !=-1) dd[idxs.t ] = chart_data_init_1('Threads','204,0,0', 0.2);\r\n        if (idxs.et!=-1) dd[idxs.et] = chart_data_init_1('exist_t','140,0,0',0.2); // '204,128,128',0.2\r\n\r\nif (pref.test_mode['39'] && dd[pref.test_mode.num]) dd[pref.test_mode.num] = chart_data_init_1(dd[pref.test_mode.num].label,pref.test_mode.test_str, pref.test_mode.num_f);\r\n        var start = (this.len<this.stats.len)? this.stats.len - this.len : 0;\r\n        this.data_graph.labels = ds.data_l.slice(start); // I don't know why, but shallow copy is required, I can't use source array directly.\r\n        if (idxs.p !=-1) dd[idxs.p].data = this.stats.merge_1(ds.data_p.slice(start), (ds.data_p_old)? ds.data_p_old.slice(start) : null);\r\n        if (idxs.t !=-1) {\r\n          dd[idxs.t].data = this.stats.merge_1(ds.data_t.slice(start), (ds.data_t_old)? ds.data_t_old.slice(start) : null);\r\n          if (this.scale_thread!=1) this.scale_setup(dd[idxs.t].data);\r\n        }\r\n        if (dr) {\r\n//          dd[5] = chart_data_init_1('old_t','204,0,0');\r\n//          dd[0].data = ds.data_p.slice(start);\r\n//          dd[1].data = ds.data_t.slice(start);\r\n//          dd[2].data = dr.data_p.slice(start); // raw\r\n//          dd[3].data = dr.data_t.slice(start);\r\n          if (idxs.ep!=-1) dd[idxs.ep].data = this.arr_dec_slice(ds.data_p, dr.data_p, start);\r\n          if (idxs.et!=-1) {\r\n            dd[idxs.et].data = this.arr_dec_slice(ds.data_t, dr.data_t, start);\r\n            if (this.scale_thread!=1) this.scale_setup(dd[idxs.et].data);\r\n          }\r\n//          dd[2].data = ds.data_p.map(function(v,i){return v - this[i];}.bind(dr.data_p)); // TOO SLOW...\r\n//          dd[3].data = ds.data_t.map(function(v,i){return v - this[i];}.bind(dr.data_t));\r\nif (pref.test_mode['40']) {\r\n//          dd[4] = chart_data_init_1('old_p','98,152,179');\r\n//          dd[4].fillColor = 'rgba(0,255,0,0.2)';\r\n          dd[layer] = chart_data_init_1('old_p','0,255,0',0.1);\r\n          dd[layer++].data = ds.data_p_old.slice(start);\r\n          dd[layer] = chart_data_init_1('p_raw','98,152,179',0.2);\r\n          dd[layer++].data = ds.data_p.slice(start);\r\n//          dd[5].data = ds.data_t_old.slice(start);\r\n}\r\n        }\r\n        if (fN && idxs.np!=-1) {\r\n          dd[idxs.np].data = (fN.data_p_old)? fN.data_p_old.concat(fN.data_p.slice(fN.data_p_old.length)).slice(start) : fN.data_p.slice(start);\r\n          if (fN.data_p_old) {\r\n            var idx_last = fN.data_p_old.length-1;\r\n            if (fN.data_p[idx_last]>fN.data_p_old[idx_last]) if (idx_last-start>=0) dd[idxs.np].data[idx_last-start] = fN.data_p[idx_last]; // overwrite last data, because last data may NOT complete its period.\r\n          }\r\n          if (this.clip_np) {\r\n            var data_np = dd[idxs.np].data;\r\n            for (var i=0;i<data_np.length;i++) data_np[i] = this.clip_np_func(data_np[i]);\r\n          }\r\n//          if (pref.stats.patch_tm) dd[idxs.np].data = dd[idxs.np].data.slice(1).concat(0); // shift only at initial\r\n//          dd[idxs.np].data = fN.data_p.slice(start);\r\n//          var old_sliced = fN.data_p_old.slice(start);\r\n//          for (var i=0;i<old_sliced.length;i++)\r\n//            if (old_sliced[i])\r\n//              dd[idxs.np].data[i] = old_sliced[i];\r\nif (pref.test_mode['41']) {\r\n          dd[layer] = chart_data_init_1('post_fromNo_old','0,255,0',0.2);\r\n          dd[layer++].data = fN.data_p_old.slice(start);\r\n          dd[layer] = chart_data_init_1('post_fromNo','0,128,0',0);\r\n          dd[layer++].data = fN.data_p.slice(start);\r\n}\r\n        }\r\n//        Chart.defaults.global.animation = pref.stats.animation;\r\n        this.scale_thread_old = this.scale_thread;\r\n        var ctx = this.pn_canvas.getContext('2d');\r\n        this.chart_posts = new Chart(ctx).Line(this.data_graph, this.options);\r\n      },\r\n      clip_np_func: function(data){\r\n        return (data<0)? 0 :\r\n               (data>this.clip_np_val)? this.clip_np_val : data;\r\n      },\r\n      arr_dec_slice: function(src, dec, start){\r\n        var arr = [];\r\n        var p = 0;\r\n        for (var i=start;i<src.length;i++) arr[p++] = src[i] - dec[i];\r\n        return arr;\r\n      },\r\n      scale_setup: function(dst,old){\r\n        if (old!==undefined) for (var i=0;i<dst.length;i++) dst[i].value = dst[i].value/old*this.scale_thread;\r\n        else for (var i=0;i<dst.length;i++) dst[i] *= this.scale_thread;\r\n        return dst;\r\n      },\r\n      scale_changed: function(){\r\n        this.set_legend_str();\r\n        if (this.scale_thread_old!==0) {\r\n          this.scale_setup(this.chart_posts.datasets[this.idxs.t].points, this.scale_thread_old);\r\n          if (this.idxs.et!==undefined && this.data_graph.datasets[this.idxs.et]) this.scale_setup(this.chart_posts.datasets[this.idxs.et].points, this.scale_thread_old);\r\n          this.chart_posts.update();\r\n        } else this.chart_redraw();\r\n        this.scale_thread_old = this.scale_thread;\r\n      },\r\n      set_legend_str: function(){\r\n//        var str = '<ul class=\"line-legend\"><li style=\"color:rgba(98,152,179,1)\"><span style=\"color: black;\">Posts</span></li><li style=\"color:rgba(204,0,0,1)\"><span style=\"color: black;\">Threads ' + ((this.scale_thread==1)? '' : 'x'+ this.scale_thread) + '</span></li></ul>'\r\n        var str = '<span style=\"color:rgba(98,152,179,1)\">\\u25cf</span><span style=\"color: black;\"> Posts</span><br>'+\r\n                  '<span style=\"color:rgba(204,0,0,1)\">\\u25cf</span><span style=\"color: black;\"> Threads ' + ((this.scale_thread==1)? '' : 'x'+ this.scale_thread+' ') + '</span>'\r\n        this.legend.pn.innerHTML = str;\r\n      },\r\n//      dragover_pn2: function(e) {e.preventDefault();}, // working code.\r\n//      drop_pn2: function (e) {\r\n//        e.preventDefault(); // FF require this.\r\n//        var str = e.dataTransfer.getData('text');\r\n//        if (str!='') {\r\n//          if (pref.import_format=='obj') data = JSON.parse(str);\r\n//          else {\r\n//            var str_s = str.split(/\\r\\n|\\r|\\n|\\\\n/);\r\n//            data.labels = str_s[0].split(',');\r\n//            for (var i=0;i<2;i++) {\r\n//              var str_sc = str_s[i+1].split(',');\r\n//              for (var j=0;j<str_sc.length;j++) data.datasets[i].data[j] = (str_sc[j]!='')? parseInt(str_sc[j],10) : 0;\r\n//            }\r\n//          }\r\n//        }\r\n//        chart_redraw();\r\n//      },\r\n//      toggle_settings: function(e){ // working code\r\n//        cnst.show_hide(this.pn2_settings, null, this.legend.pn);\r\n//        cnst.toggleButton(e.currentTarget);\r\n//      },\r\n      destroy : function (){\r\n        if (!brwsr.ff) this.chart_posts.stop();\r\n        this.chart_posts.destroy();\r\n//        pn2.removeEventListener('click', chart_redraw, false);\r\n//        pn2.removeEventListener('dragover', dragover_pn2, false);\r\n//        pn2.removeEventListener('drop', drop_pn2, false);\r\n//        pn2.removeEventListener('dragend', div_dragend_pn2, false);\r\n//        pn6.removeEventListener('dragend', function(e){e.stopPropagation();}, false);\r\n        //        size_loc = [pn2.style.width, pn2.style.height, pn2.style.left, pn2.style.bottom, pn6.style.left, pn6.style.bottom];\r\n        this.stats.destroy();\r\n        this.stats = null;\r\n        if (this.pn2) {\r\n          cnst.div_destroy(this.legend.pn, false, this.legend);\r\n          cnst.div_destroy(this.pn2, true, this.pn2_obj);\r\n          cnst.auto_shrink_board_selector.destroy(this.pn_board_sel);\r\n          cnst.unsubscribe(charts, this);\r\n        }\r\n        return null;\r\n      },\r\n//      clear : function () {this.chart_redraw();}, // working code.\r\n//      update_data : function(time_str, posts, threads){\r\n//        while (data_graph.labels.length>=pref.max_graph) chart_posts.removeData();\r\n//        chart_posts.addData([posts,threads*pref.scale_thread],time_str);\r\n//        chart_posts.update();\r\n//      },\r\n//      update: function(){\r\n//        chart_redraw();\r\n//      },\r\n      replace_data: function(src){\r\n        if (!this.stats) this.stats = src; // patch\r\n        this.data_src = src;\r\n        this.chart_redraw();\r\n      },\r\n      update_data2 : function(src){\r\n        var i = src.shift;\r\n        while (i>0) {this.chart_posts.removeData();i--;}\r\n        var data = [];\r\n        for (var i=src.data_p.length-src.shift;i<src.data_p.length;i++) {\r\n          if (src.fromNo && this.idxs.np!=-1) data[this.idxs.np] = (this.clip_np)? this.clip_np_func(src.fromNo.data_p[i]) : src.fromNo.data_p[i];\r\n          if (this.idxs.p!=-1) data[this.idxs.p] = src.data_p[i];\r\n          if (this.idxs.t!=-1) data[this.idxs.t] = src.data_t[i]*this.scale_thread;\r\n          if (src.rm) {\r\n            if (this.idxs.ep!=-1) data[this.idxs.ep] =  src.data_p[i] - src.rm.data_p[i];\r\n            if (this.idxs.et!=-1) data[this.idxs.et] = (src.data_t[i] - src.rm.data_t[i])*this.scale_thread;\r\n          }\r\n          this.chart_posts.addData(data, src.data_l[i]);\r\n        }\r\n        var tgt_p = (this.idxs.p!=-1)? this.chart_posts.datasets[this.idxs.p] : null;\r\n        var tgt_t = (this.idxs.t!=-1)? this.chart_posts.datasets[this.idxs.t] : null;\r\n        var tgt_ep = (this.idxs.ep!=-1 && src.rm)? this.chart_posts.datasets[this.idxs.ep] : null;\r\n        var tgt_et = (this.idxs.et!=-1 && src.rm)? this.chart_posts.datasets[this.idxs.et] : null;\r\n        var tgt_np = (this.idxs.np!=-1 && src.fromNo)? this.chart_posts.datasets[this.idxs.np] : null;\r\n        var p = src.min_idx - (this.stats.len - this.len);\r\n        var i = src.min_idx;\r\n        if (p<0) {\r\n          i += -p;\r\n          p=0;\r\n        }\r\n        if (pref.stats.patch_tm && tgt_np && p>0 && i>0) tgt_np.points[p-1].value = (this.clip_np)? this.clip_np_func(src.fromNo.data_p[i-1]) : src.fromNo.data_p[i-1];\r\n        while (i<src.data_p.length-src.shift) {\r\n          if (tgt_p) tgt_p.points[p].value =  (src.data_p_old && src.data_p_old[i]>src.data_p[i])? src.data_p_old[i] : src.data_p[i];\r\n          if (tgt_t) tgt_t.points[p].value = ((src.data_t_old && src.data_t_old[i]>src.data_t[i])? src.data_t_old[i] : src.data_t[i]) *this.scale_thread;\r\n//            chart_posts.label.points[p].value = src.data_l[i];\r\n          if (tgt_ep) tgt_ep.points[p].value =  src.data_p[i] - src.rm.data_p[i];\r\n          if (tgt_et) tgt_et.points[p].value = (src.data_t[i] - src.rm.data_t[i]) *this.scale_thread;\r\n          if (tgt_np) tgt_np.points[p].value = (this.clip_np)? this.clip_np_func(src.fromNo.data_p[i]) : src.fromNo.data_p[i];\r\n          p++;\r\n          i++;\r\n        }\r\n        src.shift = 0;\r\n        this.chart_posts.update();\r\n      },\r\n      append_legend: function(){this.pn_canvas_root.appendChild(this.legend.pn);},\r\n      remove_legend: function(){this.pn_canvas_root.removeChild(this.legend.pn);},\r\n    }\r\n    PostChart.prototype.pn2_template = {\r\n      get func_str(){return 'left:' +(((chartCount-1)%5)*20)+ 'px:tile2:get:bottom:' +(((chartCount-1)%5)*20)+ ':Show:tb'}, // ':resize:both:float:left:Show:tb:width:' +\r\n//        pref.chart.window_width + 'px:height:' + pref.chart.window_height + 'px:resize:both:overflow:hidden';},\r\n//      rolldown: PostChart.prototype.append_legend,\r\n//      rollup: PostChart.prototype.remove_legend,\r\n      maximize: PostChart.prototype.chart_size_changed,\r\n//      maximize_embed_style_pn: {left:'auto', top:'auto', position:'relative', resize:'none'}, //  {left:'auto', top:'auto', position:'static', resize:'none'}\r\n      maximize_embed_style_pnch1: {}, //  {width:'auto', height:'auto', resize:'none'}\r\n      maximize_float_style_pnch1: {}, //  {width:state[3], height:state[4], resize:'both'}\r\n      exit: PostChart.prototype.destroy,\r\n      get maximize_tgt(){return this.this_obj.pn_canvas_root;}, \r\n    };\r\n    PostChart.prototype.onchange_entry = function(e){\r\n      var tgt_hier = pref_func.get_tgt(e.target.name.replace(/chart.inst./,''),this);\r\n      var prop = tgt_hier[1];\r\n//      var val = (e.target.type==='checkbox')? e.target.checked : (e.target.type==='text')? parseInt(e.target.value,10) : e.target.selectedIndex;\r\n//      target_hier[0][prop] = val;\r\n      pref_func.apply_prep_set(tgt_hier[0], tgt_hier[1], e.target);\r\n      if (this.onchange_funcs[prop]) this.onchange_funcs[prop].call(this,e);\r\n    };\r\n    PostChart.prototype.onchange_funcs = {\r\n      pointDot: PostChart.prototype.chart_redraw,\r\n      pointDotRadius: PostChart.prototype.chart_redraw,\r\n      scale_thread: PostChart.prototype.scale_changed,\r\n      animation: function(){this.chart_posts.options.animation = this.options.animation;},\r\n      len: PostChart.prototype.len_changed,\r\n      separate: function(){this.stats.init();},\r\n      time_sel: function(e){e.target.blur();this.stats.time_unit_changed(this.time_sel);},\r\n      board_sel: PostChart.prototype.board_sel_changed,\r\n      show_legend: function(e){if (e.target.checked) this.append_legend(); else this.remove_legend();},\r\n      clip_np: PostChart.prototype.chart_redraw,\r\n      clip_np_val: function(){\r\n        if (!this.clip_np) {\r\n          this.clip_np = true;\r\n          this.pn2.querySelector('input[name=\"chart.inst.clip_np\"]').checked = true;\r\n        }\r\n        PostChart.prototype.chart_redraw.call(this);\r\n      },\r\n    };\r\n    PostChart.prototype.onchange_funcs.np = PostChart.prototype.onchange_funcs.separate;\r\n    PostChart.prototype.onchange_funcs.p  = PostChart.prototype.onchange_funcs.separate;\r\n    PostChart.prototype.onchange_funcs.ep = PostChart.prototype.onchange_funcs.separate;\r\n    PostChart.prototype.onchange_funcs.t  = PostChart.prototype.onchange_funcs.separate;\r\n    PostChart.prototype.onchange_funcs.et = PostChart.prototype.onchange_funcs.separate;\r\n\r\n    return {\r\n      clear: function(){}, // dummys\r\n      dump: function(format){},\r\n      data_update: function(time_str, posts, threads){},\r\n      PostChart: PostChart,\r\n//      clear: function(){ // working code.\r\n//        data = chart_data_init();\r\n//        if (pn2_func!=null) pn2_func.clear();\r\n//      },\r\n//      dump: function(format){ // http://stackoverflow.com/questions/22055598/writing-a-json-object-to-a-text-file-in-javascript\r\n//        var url;\r\n//        if (format=='csv') {\r\n//          var out_labels = data.labels;\r\n//          var out_data0 = data.datasets[0].data;\r\n//          var out_data1 = data.datasets[1].data;\r\n//          url = 'data:text/json;charset=utf8,' + encodeURIComponent(out_labels) + '\\\\n' + encodeURIComponent(out_data0) + '\\\\n' + encodeURIComponent(out_data1);\r\n//        } else if (format=='obj') url = 'data:text/json;charset=utf8,' + JSON.stringify(data);\r\n//        window.open(url, '_blank');\r\n//        window.focus();\r\n//      },\r\n//      data_update: function(time_str, posts, threads){\r\n//        if (pn2_func!=null) pn2_func.data_update(time_str, posts, threads);\r\n//        if (data.labels.length>=pref.max_capture) {\r\n//          data.datasets[0].data.slice(-pref.max_capture+1);\r\n//          data.datasets[1].data.slice(-pref.max_capture+1);\r\n//          data.labels.slice(-pref.max_capture+1); // labels are copied shallowly, but now made deep copy manually.\r\n//        }\r\n//        data.labels.push(time_str);\r\n//        data.datasets[0].data.push(posts);\r\n//        data.datasets[1].data.push(threads);\r\n//        if (pref.aggregator=='true' && pref.write_to_ls && localStorage) {\r\n//          localStorage.setItem(pipe_name,  JSON.stringify([time_str, posts, threads]));\r\n//          localStorage.setItem(pref_graph.key, JSON.stringify(data));\r\n//        }\r\n      //      },\r\n      time_unit_sel_html: time_unit_sel_html,\r\n      chart_options_str: chart_options_str,\r\n      make: make_new_chart,\r\n    }\r\n    function chart_data_init() {\r\n      return {\r\n        labels: ['dummy','dummy'], // at least 2 data required at first, or filling collapse. This is probably a BUG in Chart.js.\r\n        datasets: []\r\n      };\r\n    }\r\n    function chart_data_init_1(label, color, alpha) {\r\n      return {\r\n        label: label,\r\n        fillColor: 'rgba(' + color + ',' + alpha + ')',\r\n        strokeColor: 'rgba(' + color + ',1)',\r\n        pointColor: 'rgba(' + color + ',1)',\r\n        pointStrokeColor: '#fff',\r\n        pointHighlightFill: '#fff',\r\n        pointHighlightStroke: 'rgba(' + color + ',1)',\r\n        data: [0,0]\r\n      };\r\n    }\r\n  }\r\n\r\n  function make_setting_obj(pn8){\r\n//  var setting = (function(){\r\n//    var pn8 = div_init(8,'55px','30px','button','settings');\r\n//    var pn8 = cnst.init('left:55px:bottom:30px:button:settings:Show');\r\n    pn8.addEventListener('click', show_hide, false);\r\n    var pn7 = null;\r\n    var pn7_1 = null;\r\n    function show_hide(){  // Toggle Show/Hide\r\n      pn7 = prep_pn7(pn7==null);\r\n    }\r\n    function prep_pn7(make){\r\n      if (make) {\r\n//        pn7 = div_init(7,'5px','50px','div','');\r\n//        pn7 = cnst.init('left:5px:bottom:50px:Show:tb',cnst.void_func,cnst.void_func,show_hide,cnst.void_func);\r\n//if (pref.test_mode['17']) pn7 = cnst.init('left:0px:tile:get:bottom:Show',cnst.void_func,cnst.void_func,show_hide,cnst.void_func); // leaks nodes.\r\nif (pref.test_mode['17']) {pn7 = document.createElement('div');pn7.innerHTML='<div></div><div></div>';site.root_body.appendChild(pn7);} // leaks nodes.\r\nelse \r\n        pn7 = cnst.init('left:0px:tile:get:bottom:Show:tb',cnst.void_func,cnst.void_func,show_hide,cnst.void_func);\r\nif (pref.test_mode['17']) pn7_1 = pn7;\r\nelse \r\n        pn7_1 = pn7.childNodes[1];\r\n        pn7_1.innerHTML = '<div><div style=\"float:left\">\\\r\nStatistics:<br>\\\r\n&emsp;Interval: <input type=\"text\" name=\"interval_found\" size=\"6\" style=\"text-align: right;\">min<br>\\\r\n&emsp;<input type=\"checkbox\" name=\"check_page\"> Show page no. of this thread<br>\\\r\n&emsp;&emsp;<input type=\"checkbox\" name=\"show_page_fraction\"> Show fraction of page No.<br>\\\r\n&emsp;<input type=\"checkbox\" name=\"check_post\"> Show num of new posts in this board<br>\\\r\n&emsp;<input type=\"checkbox\" name=\"check_thread\"> Show num of new threads in this board<br>\\\r\n&emsp;&emsp; Max_capture: <input type=\"text\" name=\"max_capture\" size=\"6\" style=\"text-align: right;\"> points<br>\\\r\n&emsp;&emsp;&emsp;Show recent : <input type=\"text\" name=\"max_graph\" size=\"6\" style=\"text-align: right;\"> points in graph<br>\\\r\n&emsp;&emsp;&emsp;Scale of #threads in graph: <input type=\"text\" name=\"scale_thread\" size=\"6\" style=\"text-align: right;\"><br>\\\r\n<!-- &emsp;&emsp;<input type=\"radio\" name=\"autoconf\" value=\"auto\"> Automatic configuration<br>\\\r\n&emsp;&emsp;<input type=\"radio\" name=\"autoconf\" value=\"manual\"> Manual configuration<br> -->\\\r\n&emsp;&emsp;&emsp;<input type=\"radio\" name=\"aggregator\" value=\"true\"> Aggregate data<br>\\\r\n&emsp;&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"write_to_ls\"> Write to localStrage (server)<br>\\\r\n&emsp;&emsp;&emsp;<input type=\"radio\" name=\"aggregator\" value=\"false\"> Listen from localStrage (client)<br>\\\r\n&emsp;&emsp;<input type=\"checkbox\" name=\"load_data\"> Load data from localStrage at the start<br>\\\r\n&emsp;&emsp;Import format (drop whole text on graph)<br>\\\r\n&emsp;&emsp;&emsp;<input type=\"radio\" name=\"import_format\" value=\"csv\"> csv<br>\\\r\n&emsp;&emsp;&emsp;<input type=\"radio\" name=\"import_format\" value=\"obj\"> obj<br>\\\r\n&emsp;&emsp;<input type=\"button\" value=\"Dump(csv)\"><input type=\"button\" value=\"Dump(obj)\">&emsp;<input type=\"button\" value=\"Clear data\"><br>\\\r\n<input type=\"checkbox\" name=\"auto_start\"> Start automatically (Delayed 10sec.)<br>\\\r\n<br>'+\r\n//          'UIP tracker for 4chan:<br>'+\r\n//          '&emsp;<input type=\"checkbox\" name=\"uip_tracker.on\"> Show num of unique IPs after post No.<br>'+\r\n//          '&emsp;&emsp;<input type=\"checkbox\" name=\"uip_tracker.posts\"> Show num of posts(checking for deletion timing)<br>'+\r\n//          '&emsp;&emsp;Interval: <input type=\"text\" name=\"uip_tracker.interval\" size=\"3\" style=\"text-align: right;\">sec'+\r\n//          '&emsp;<input type=\"checkbox\" name=\"uip_tracker.adaptive\"> Adaptive<br>'+\r\n//          '&emsp;<input type=\"checkbox\" name=\"uip_tracker.auto_open\"> Open next thread automatically<br>'+\r\n//          '&emsp;&emsp;Conditions:<br>'+\r\n//          '&emsp;&emsp;&emsp;After <input type=\"text\" name=\"uip_tracker.auto_open_th\" size=\"3\" style=\"text-align: right;\">th post<br>'+\r\n//          '&emsp;&emsp;&emsp;OP contains <textarea style=\"height:1em\" cols=\"20\" name=\"uip_tracker.auto_open_kwd\"></textarea><br>'+\r\n//          '<br>'+\r\n//'For dollchan: (workaround for bugs)<br>\\\r\n//&emsp;<input type=\"checkbox\" name=\"workaround_for_dollchan\"> Consistency checker for thubmnails of attached images<br>\\\r\n//&emsp;&emsp;runs at<br>\\\r\n//&emsp;&emsp;<input type=\"radio\" name=\"wafd_tb\" value=\"tb\">every time when mouse leaves from thumbnail\\'s area<br>\\\r\n//&emsp;&emsp;<input type=\"radio\" name=\"wafd_tb\" value=\"reply\">only when mouse hovers on the reply button<br>\\\r\n//&emsp;<input type=\"checkbox\" name=\"wafd_open_spoiler\"> Open text spoilers<br>\\\r\n//&emsp;&emsp;(You must turn off the same function in dollchan beforehand)<br>\\\r\n'<!-- Post form:<br>\\\r\n&emsp;<input type=\"checkbox\" name=\"hide_rules\"> Hide rules<br>\\\r\n&emsp;<input type=\"checkbox\" name=\"hide_Go\"> Hide \\'Go\\'<br> -->\\\r\n<br>\\\r\n<br>'+\r\n//Share loaded html with other tabs to update<br>\\\r\n//&emsp;<input type=\"checkbox\" name=\"info_server\"> Broadcast loaded html to other tabs (server)<br>\\\r\n//&emsp;<input type=\"checkbox\" name=\"info_client\"> Listen other tab\\'s broadcasting (client)<br>\\\r\n//<br>\\\r\n//Command interface for overwriting site preference<br>\\\r\n//&emsp;<textarea style=\"height:1em\" cols=\"40\" name=\"cli.json_str\"></textarea><br>\\\r\n//&emsp;<input type=\"button\" value=\"JSON\"><br>\\\r\n//&emsp;<textarea style=\"height:1em\" cols=\"40\" name=\"cli.eval_str\"></textarea><br>\\\r\n//&emsp;<input type=\"button\" value=\"EVAL\"><br>\\\r\n//</div><div style=\"float:left\">&emsp;&emsp;&emsp;</div><div style=\"float:left\">'+\r\n//Catalog:<br>\\\r\n//&emsp;Cross domain connection:<br>\\\r\n//&emsp;&emsp;<input type=\"radio\" name=\"catalog_cross_domain_connection\" value=\"direct\"> Direct connection<br>\\\r\n//&emsp;&emsp;<input type=\"radio\" name=\"catalog_cross_domain_connection\" value=\"indirect\"> Indirect connection<br>\\\r\n//<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"catalog_fake_access\"> Fake access made by human to avoid poor administration<br>\\\r\n//&emsp;&emsp;&emsp;(This causes heavier network traffic and server load,<br>\\\r\n//&emsp;&emsp;&emsp;but administrators can\\'t see what script you are using)<br>\\\r\n//&emsp;Configuration:<br>\\\r\n//&emsp;&emsp;(To get faster feeling, you should check them all.)<br> -->\\\r\n//&emsp;Networking: load on demand for reducing initial network traffic<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_draw_on_demand\"> Threads<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_load_on_demand\"> HTMLs<br>\\\r\n//&emsp;Localtime offset<input type=\"text\" name=\"localtime_offset\" size=\"2\" style=\"text-align: right;\"><br>'+\r\n//          '&emsp;Tagging:<br>'+\r\n//          '&emsp;&emsp;Ignore tags latter than <input type=\"text\" name=\"catalog.tag.ignore\" size=\"2\" style=\"text-align: right;\">th in a board/thread<br>'+\r\n//          '&emsp;&emsp;Ignore boards/threads which have more than <input type=\"text\" name=\"catalog.tag.max\" size=\"2\" style=\"text-align: right;\"> tags<br>'+\r\n//          '&emsp;Board group configuration:<br>'+\r\n//          '&emsp;&emsp;<textarea rows=\"9\" cols=\"60\" name=\"catalog_board_list_str\"></textarea><br>'+\r\n//          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.board.owners_recommendation\"> Read owner\\'s recommendation<br>'+\r\n////          '&emsp;&emsp;<input type=\"button\" value=\"Scan\"> Scan board tags<br>'+\r\n//          '&emsp;&emsp;<input type=\"button\" value=\"Generate\"> Generate board groups from tags<br>'+\r\n//          '&emsp;<input type=\"checkbox\" name=\"catalog.style_general_list\"> Use general style<br>'+\r\n//          '&emsp;&emsp;<textarea rows=\"4\" cols=\"40\" name=\"catalog.style_general_list_str\"></textarea><br>'+\r\n//'&emsp;Catalog/Pop-up/Search<br>\\\r\n//<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"catalog_format.show.images_2nd\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.hover.images_2nd\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.search.images_2nd\"> 2nd or more images in OP<br> -->\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_format.show.posts\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.hover.posts\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.search.posts\"> Posts<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_format.show.fileinfo\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.hover.fileinfo\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.search.fileinfo\"> File information<br>\\\r\n//<!--&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_checkbox_deletion_show\">\\\r\n//<input type=\"checkbox\" name=\"catalog_checkbox_deletion_hover\">\\\r\n//<input type=\"checkbox\" name=\"catalog_checkbox_deletion_search\"> Checkbox for deletion<br> -->\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_format.show.contents\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.hover.contents\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.search.contents\"> Format contents<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_format.show.layout\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.hover.layout\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.search.layout\"> Format layout<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_format.show.style\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.hover.style\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.search.style\"> Format style<br>\\\r\n//<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"catalog_border_show\">&emsp;&emsp;&emsp; Show border<br> -->\\\r\n//<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"catalog_enable_background\">&emsp;&emsp;&emsp; Use backgfound color<br> -->\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_footer\"> Info(num of posts, images and page)<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_footer_br\"> always over/under the image<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_popup\"> Use pop-up window<br>\\\r\n//&emsp;&emsp;&emsp;appear/disappear:<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"radio\" name=\"catalog_popdown\" value=\"imm\">immediately<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"radio\" name=\"catalog_popdown\" value=\"delay\">delayed \\\r\n//<input type=\"text\" name=\"catalog_popup_delay\" size=\"6\" style=\"text-align: right;\">\\\r\n//<input type=\"text\" name=\"catalog_popdown_delay\" size=\"6\" style=\"text-align: right;\"> ms<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_popup_size_fix\"> Fix size when you move it<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_localtime\"> Localtime<br>\\\r\n//&emsp;&emsp;Num of posts in thread headline: <input type=\"text\" name=\"catalog_t2h_num_of_posts\" size=\"3\" style=\"text-align: right;\"><br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_triage\"> Enable triage pop-up<br>\\\r\n//&emsp;&emsp;&emsp; Style:<textarea style=\"height:1em\" cols=\"40\" name=\"catalog_triage_str\"></textarea><br>\\\r\n//<!-- &emsp;<input type=\"checkbox\" name=\"catalog_enable_cross_board\"> Enable cross-board catalog<br> -->\\\r\n//<!-- &emsp;<input type=\"checkbox\" name=\"catalog_enable_cross_domain\"> Enable cross-domain catalog<br> -->\\\r\n//<!-- &emsp;&emsp; Cache working in <textarea style=\"height:1em\" cols=\"20\" name=\"catalog_sw_domain\"></textarea><br> -->'+\r\n//&emsp;Click to:<br>\\\r\n//&emsp;&emsp;<input type=\"radio\" name=\"catalog_click\" value=\"open\">Go to/Open the thread<br>\\\r\n//&emsp;&emsp;<input type=\"radio\" name=\"catalog_click\" value=\"expand\">Expand/shrink the OP in catalog<br>\\\r\n//&emsp;&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_expand_at_initial\"> Expand at initial<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_no_popup_at_expanded\"> Don\\'t popup when the catalog is expanded<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_open_in_new_tab\"> Open the thread in new tab<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_use_named_window\"> Prevent opening a thread in multiple tabs<br>\\\r\n//<br>\\\r\n'</div></div><div style=\"clear: both\">\\\r\n<input type=\"button\" value=\"cancel\">\\\r\n<input type=\"button\" value=\"apply\">\\\r\n<input type=\"button\" value=\"ok\">\\\r\n&emsp;<input type=\"button\" value=\"apply+save\">\\\r\n<input type=\"button\" value=\"load_default\">\\\r\n<input type=\"button\" value=\"load_samples\">'+\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"debug_mode\"> Debug mode\\\r\n//<input type=\"checkbox\" name=\"show_tooltip\"> Show tooltips\\\r\n'</div>';\r\nif (!pref.test_mode['17']) { // node leak test.\r\n        pref_apply_prep(false);\r\n//        if (brwsr.ff) pn7.draggable = false;\r\n        cnst.bottom_top(pn7);\r\n}\r\n      }\r\nif (!pref.test_mode['17']) {\r\n      var fm = pn7_1.getElementsByTagName('input');\r\n      for (var i=0;i<fm.length;i++) {\r\n        if (fm[i].type=='button') {\r\n          if (make) fm[i].addEventListener('click', button_action, false);\r\n          else fm[i].removeEventListener('click', button_action, false);\r\n        }\r\n      }\r\n}\r\n      if (make) return pn7;\r\n      else {\r\nif (pref.test_mode['17']) {\r\n  pn7_1.innerHTML = '';\r\n  pn7.parentNode.removeChild(pn7);\r\n  return null;\r\n} else\r\n        pn7_1 = null;\r\n        return cnst.div_destroy(pn7, true); // returns null\r\n      }\r\n\r\n//      function pref_apply_prep(set){\r\n//        var fm = pn7_1.getElementsByTagName('input');\r\n//        for (var i=0;i<fm.length;i++) {\r\n//          if (fm[i].type=='button') continue;\r\n//          var tgt = fm[i].name;\r\n//          if (set) {\r\n//            if      (typeof(pref[tgt])=='number' ) pref[tgt] = parseInt(fm[i].value,10);\r\n//            else if (typeof(pref[tgt])=='boolean') pref[tgt] = fm[i].checked;\r\n//            else if (typeof(pref[tgt])=='string' ) if (fm[i].checked) pref[tgt] = fm[i].value;\r\n//          } else {\r\n//            if      (typeof(pref[tgt])=='number' ) fm[i].value = pref[tgt];\r\n//            else if (typeof(pref[tgt])=='boolean') fm[i].checked = pref[tgt];\r\n//            else if (typeof(pref[tgt])=='string' ) if (pref[tgt] == fm[i].value) fm[i].checked = true;\r\n//          }\r\n//        }\r\n//        if (set) {\r\n//          sessionStorage.pref = JSON.stringify(pref);\r\n//          listener();\r\n//          timer_obj.init();\r\n//        }\r\n//      }\r\n      function pref_apply_prep(set){\r\n        pref_func.apply_prep(pn7_1,set);\r\n        if (set) {\r\n          listener();\r\n          timer_obj.init();\r\n//          if (wafd!=null) wafd.workaround_for_dollchan_pref_changed();\r\n        }\r\n      }\r\n      function button_action(e){\r\n//        console.log(e);\r\n        var src = e.currentTarget.value;\r\n        if      (src=='apply'       ) pref_apply_prep(true);\r\n        else if (src=='cancel'      ) show_hide();\r\n        else if (src=='ok'          ) {pref_apply_prep(true);show_hide();}\r\n        else if (src=='apply+save'  ) {pref_apply_prep(true);if (localStorage) localStorage[pref.script_prefix+'.pref']=JSON.stringify(pref);}\r\n        else if (src=='load_default') {pref = pref_default();pref_apply_prep(false);pref_apply_prep(true);pref_func.obj_init();} // last pref_apply_prep is for writing to sessionStrage.\r\n//        else if (src=='load_backwash_style') {pref_func.pref_overwrite(pref,pref_func.pref_samples['backwash']);pref_apply_prep(false);}\r\n        else if (src=='load_samples') {pref_func.pref_samples.init();}\r\n        else if (src=='Dump(csv)'   ) chart_obj.dump('csv');\r\n        else if (src=='Dump(obj)'   ) chart_obj.dump('obj');\r\n        else if (src=='Clear data'  ) chart_obj.clear();\r\n        else if (src=='JSON'        ) {pref_func.apply_prep(pn7_1.getElementsByTagName('TEXTAREA')['cli.json_str'],true);pref_func.site2_json();}\r\n        else if (src=='EVAL'        ) {pref_func.apply_prep(pn7_1.getElementsByTagName('TEXTAREA')['cli.eval_str'],true);pref_func.site2_eval();}\r\n      }\r\n    }\r\n//  })();\r\n  }\r\n\r\n//  var listener = (function(){\r\n  function make_listener(){\r\n    var on = false;\r\n    var value_old;\r\n    function listen_event(e){\r\n//      console.log('EVENT:'+e.key);\r\n      if (e.newValue===null) return;\r\n      if (e.key===pipe_name && pref.aggregator==='false') {\r\n        var tmp = brwsr.JSON_parse(e.newValue);\r\n        if (tmp[0]!=value_old) {\r\n          value_old = tmp[0];\r\n          chart_obj.data_update(tmp[0], tmp[1], tmp[2]);\r\n          timer_obj.show_page([null, '+'+tmp[1]+'+'+tmp[2]+'@'+tmp[0]]);\r\n        }\r\n//      } else if (e.key.search(info_raw)!=-1 && pref.info_client) {\r\n//        var page_no = e.key.substr(info_raw.length);\r\n//        var timer = timer_obj.timer();\r\n//        if (timer!=null) {\r\n//          var value = JSON.parse(e.newValue);\r\n//          timer.page_check4(value[0], page_no, new DOMParser().parseFromString(value[1],'text/html'));\r\n//        }\r\n      }\r\n    }\r\n    function setup(){\r\n      if (!on && pref.aggregator==='false') {\r\n        window.addEventListener   ('storage', listen_event, false);\r\n        on = true;\r\n      } else if (on && pref.aggregator==='true') {\r\n        window.removeEventListener('storage', listen_event, false);\r\n        on = false;\r\n      }\r\n    }\r\n    setup();\r\n    return setup;\r\n  };\r\n//  })();\r\n  var listener = null;\r\n  if (site.features.listener && pref.features.listener) listener = make_listener();\r\n\r\n  function make_timer_obj(pn0){\r\n//  var timer_obj = (function(){\r\n////    var pn0 = div_init(0,'5px',  '5px' ,'txt','init');\r\n//    var pn0 = cnst.init('left:0px:bottom:0px:txt:init:fontSize:24px:Show:tile:set:left:tile:set:bottom');\r\n    pn0.addEventListener('click', function(){init(false);}, false);  // Toggle ON/OFF\r\n    var timer_obj2 = null;\r\n    function init(property_changed){\r\n      if (timer_obj2 == null && (pref.check_page || (pref.aggregator=='true' && (pref.check_thread || pref.check_post)))) timer_obj2 = make_timer(pn0);\r\n      else if (timer_obj2 != null) {\r\n        if (!property_changed || (!pref.check_page && (pref.aggregator=='false' || (!pref.check_thread && !pref.check_post)))) stop_destroy();\r\n        else if (property_changed) timer_obj2.timer().restart(false);\r\n      }\r\n    }\r\n    function stop_destroy(){\r\n      timer_obj2 = timer_obj2.destroy();\r\n      pn0.style.color = 'gray';\r\n    }\r\n//    if (pref.auto_start) init(false);\r\n    if (pref.auto_start) setTimeout(function(){init(false);},10000);\r\n    var pn0_str = ['',''];\r\n    return {\r\n      init : function(){init(true);},\r\n      finished : function(){stop_destroy();},\r\n      timer: function(){return timer_obj2;},\r\n      show_page : function(str){\r\n//        pn0.appendChild(document.createTextNode(str+'@'+cnst.get_time()));\r\n//        pn0.textContent = str+'@'+cnst.get_time();\r\n        if (                 str[0]!=null) pn0_str[0] = str[0]+'@'+cnst.get_time();\r\n        if (str.length>=2 && str[1]!=null) pn0_str[1] = str[1];\r\n        if (str.length>=3 && str[2]!=null) pn0_str[0] = str[2];\r\n//        pn0.textContent = pn0_str1 +', '+ pn0_str2 +', '+pn0_str3;\r\n        if (pn0_str[0]!='' && pn0_str[1]!='') pn0.textContent = pn0_str[0] +', '+ pn0_str[1];\r\n        else pn0.textContent = pn0_str[0] + pn0_str[1];\r\n      }\r\n    }\r\n//  })();\r\n  }\r\n\r\n  function make_timer(pn0){\r\n    var page = (function(){\r\n      var idx = [];\r\n      var p = 0;\r\n      var now = 0;\r\n      var str_place='';\r\n      var check_page = pref.check_page;\r\n      if (window.location.href.search(site.thread_keyword)==-1) check_page = false;\r\n//      var flag = [false,false,mode_graph_only]; // top, last, myself, to be got.\r\n      \r\n//      idx[0] = 0;\r\n//      idx[1] = site.max_page -1; // last page\r\n//      for (var i=2;i<site.max_page;i++) idx[i]=i-1;\r\n//      idx[site.max_page] = site.max_page; // +1 for myself.\r\n      function init(){\r\n        var j=0;\r\n        idx[0] = -1; // -1 for mot match.\r\n        idx[1] = -1;\r\n        if (pref.check_post) idx[j++] = 0;\r\n        if (pref.check_thread) idx[j++] = site.max_page-1;\r\n        var next = (now+1)%(site.max_page+1);\r\n        if (now !=idx[0] && now !=idx[1]) idx[j++] = now;  // idx[2] for page_no.\r\n        if (next!=idx[0] && next!=idx[1]) idx[j++] = next; // idx[3] for next_page.\r\n        for (var i=0;i<=site.max_page;i++)\r\n          if (i!=now && i!=next && i!=idx[0] && i!=idx[1]) idx[j++] = i;\r\n        flag = [!pref.check_post, !pref.check_thread, !check_page];\r\n        p=0;\r\n//        if (flag[0] && flag[1] && flag[2]) timer.stop();\r\n      }\r\n      init();\r\n  \r\n      return {\r\n        no   : function() {return idx[p];},\r\n        step : function() {p=(p+1)%(site.max_page+1);},\r\n        prep_next : function() {init();},\r\n        flag_set : function(i) {flag[i]=true;},\r\n        all_got  : function() {return flag[0] && flag[1] && flag[2];},\r\n        str_set  : function(i,j) {if (check_page && i!=site.max_page) {str_place = i + '.' + j; now=i;}}, // patch for a bug of showing '20.0'.\r\n        str_get  : function() {return str_place;},\r\n        init : function(){init();}\r\n      }\r\n    })();\r\n\r\n    var last_post_old = 0;\r\n    var last_post = 0;\r\n    var last_ops_old = [];\r\n    var num_of_new_threads = 0;\r\n    var timer = (function(){\r\n      var req = new XMLHttpRequest();\r\n      req.addEventListener('load',  req_events, false);\r\n      req.addEventListener('error', req_events, false);\r\n      req.addEventListener('abort', req_events, false);\r\n    \r\n      function req_events(evt) {\r\n        var parser = new DOMParser();\r\n        if (req.status==404) timer.dead();\r\n        else {\r\n          var date = Date.now();\r\n          if (pref.info_server && page.no()!=site.max_page && brwsr.sw_cache)\r\n            brwsr.sw_cache.setItem(info_raw+'p'+page.no(),{date: date, status: req.status, responseText: req.responseText});\r\n          if (pref.catalog_snoop_refresh && catalog_obj.catalog_func()!=null)\r\n            catalog_obj.catalog_func().catalog_insert(info_raw+'p'+page.no(),{date: date, status: req.status, responseText: req.responseText});\r\n          page_check2(parser.parseFromString(req.responseText, 'text/html'));\r\n        }\r\n      }\r\n      function get_page(url) {\r\n        req.open('GET', url, true);\r\n        req.send(null);\r\n      }\r\n      var checking = false;\r\n      var time_str;\r\n      function page_check3(){\r\n        if (!checking) {\r\n          checking = true;\r\n          time_str = cnst.get_time();\r\n          page_check();\r\n        }\r\n      }\r\n      function page_check(){\r\n//        timer.stop(false);\r\n//        var url = site.url_prefix + page.no() + '.html';\r\n//        var url = site.make_url([site.board, page.no(), 'p')[0];\r\n        var url = site2[site.nickname].make_url4([site.nickname, site.board, page.no(), 'page_html'])[0];\r\n        if (page.no()==site.max_page) url = window.location.href;\r\n        get_page(url);\r\n      }\r\n\r\n      var interval_missing = 1000;\r\n//      var interval_found   = 60000 * 10;\r\n//      var interval_error   = 60000 * 10; // 10 min.\r\n      var retry_count = 0;\r\n      var retry_limit = (site.max_page+1)+5;\r\n      var id = null;\r\n      var interval_old = 0;\r\n      function timer_restart(force){\r\n        if (force || interval_old != pref.interval_found) {\r\n          timer_stop(false);\r\n          id = setInterval(page_check3, pref.interval_found*60000);\r\n        }\r\n        interval_old = pref.interval_found;\r\n      }\r\n      timer_restart(true);\r\n      page_check3();\r\n      pn0.style.color = '#000000';\r\n\r\n      function timer_stop(end){\r\n        if (id!=null) clearInterval(id);\r\n        id = null;\r\n        if (end) pn0.style.color = 'gray';\r\n      }\r\n\r\n//      var myself = get_nos(document,-1,-1);\r\n      var myself = (window.location.href.search(site.thread_keyword)!=-1)? get_nos(document,-1,-1) :-2;\r\n      return {\r\n//        req : function(){return req;}, // for debug\r\n        req : req, // for debug\r\n        found: function(){\r\n          retry_count = 0;\r\n//          id = setInterval(page_check3, pref.interval_found*60000);\r\n          checking = false;\r\n        },\r\n        missing: function(){\r\n          if (req.status==200 && retry_count++<retry_limit) setTimeout(page_check, interval_missing);\r\n          else {\r\n            retry_count = 0;\r\n//            id = setInterval(page_check, interval_error);\r\n            checking = false;\r\n          }\r\n        },\r\n        stop:  function(end){timer_stop(end);},\r\n        dead:  function(){timer_obj.show_page(['Dead']);timer_stop(true);timer_obj.finished();},\r\n        myself: function(){return myself;},\r\n        restart: function(force){timer_restart(force)},\r\n        timestr: function(){return time_str;},\r\n        destroy: function(){\r\n          req.removeEventListener('load',  req_events, false);\r\n          req.removeEventListener('error', req_events, false);\r\n          req.removeEventListener('abort', req_events, false);\r\n        }\r\n      }\r\n    })();\r\n\r\n    if (brwsr.sw_cache && pref.info_client) brwsr.sw_cache.subscribe(true);\r\n    return {\r\n      destroy: function(){\r\n        if (brwsr.sw_cache) brwsr.sw_cache.subscribe(false);\r\n        timer.stop(true);\r\n        timer.destroy();\r\n        return null;\r\n      },\r\n      timer: function(){return timer;},\r\n//      page_check4: page_check4\r\n      page_check5: page_check5\r\n    }\r\n\r\n    function page_check5(key,value,args){\r\n      var page_no = common_func.name2domainboardthread(key,true)[2].substr(1);\r\n      page_check4(value.date, page_no, new DOMParser().parseFromString(value.responseText,'text/html'));\r\n    }\r\n    function page_check4(time_stamp, page_no, doc){\r\n      var ops = site.get_ops(doc);\r\n      var myself = timer.myself();\r\n      for (var i=0;i<ops.length;i++) {\r\n        if (myself==ops[i]) {\r\n          page.str_set(page_no,i);\r\n          var str = page.str_get() + '@' + new Date(time_stamp).toLocaleTimeString();\r\n          timer_obj.show_page([null,null,str]);\r\n          page.prep_next();\r\n          timer.restart(true);\r\n          if (pref.check_page) options.func0_exe(page.str_get());\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    function page_check2(doc){\r\n      var page_no = page.no();\r\n      get_nos(doc,timer.myself(),page_no);\r\n      if (page.all_got() && page.no()!=site.max_page) {\r\n        var increase_posts = (last_post_old==0)? 0 : last_post-last_post_old;\r\n        var str = '';\r\n        if (pref.check_page)   str = page.str_get();\r\n        if (pref.check_post)   str = str + '+' + increase_posts;\r\n        if (pref.check_thread) str = str + '+' + num_of_new_threads;\r\n        timer_obj.show_page([str]);\r\n        page.prep_next();\r\n        timer.found();\r\n        increase_posts = parseInt(increase_posts,10);\r\n        if (isNaN(increase_posts) || increase_posts==null) increase_posts = 0;\r\n        if (pref.check_post || pref.check_thread) chart_obj.data_update(timer.timestr(),increase_posts, num_of_new_threads);\r\n        last_post_old = last_post;\r\n        if (pref.check_page) options.func0_exe(page.str_get());\r\n      } else {\r\n        timer_obj.show_page([page_no+'?']);\r\n        page.step();\r\n        timer.missing();\r\n      }\r\n    }\r\n\r\n    function get_nos(tgt_doc,myself,page_no){\r\n//      var ops = [];\r\n//      var num = 0;\r\n//      var divs = tgt_doc.getElementsByTagName('div');\r\n//      for (var i=0;i<divs.length;i++) {\r\n//        if (divs[i].className == 'thread' || divs[i].className == 'thread kc_showReplies') {\r\n//          var op_no = divs[i].id.substring(7); // substring(7) for removing 'thread_'\r\n//          if (myself==op_no) {str_place = page.str_set(page_no,num); page.flag_set(2);}\r\n//          ops[num++] = op_no;\r\n//        }\r\n//      }\r\n      var ops = site.get_ops(tgt_doc);\r\n      for (var i=0;i<ops.length;i++) if (myself==ops[i]) {page.str_set(page_no,i); page.flag_set(2);break;}\r\n      if (myself==-1) return ops[0];\r\n      if (page_no==0) {\r\n        page.flag_set(0);\r\n        last_post = get_last_post(tgt_doc);\r\n      }\r\n      if (page_no==site.max_page-1) {\r\n        page.flag_set(1);\r\n        var len = last_ops_old.length\r\n        if (len!=0) {\r\n          var last_op = ops[ops.length-1];\r\n          var i=0;\r\n          while (i<len && last_op!=last_ops_old[len-i-1]) i++;\r\n          num_of_new_threads = i;\r\n        } else num_of_new_threads = 0;\r\n        last_ops_old = ops;\r\n      }\r\n    }\r\n\r\n    function get_last_post(tgt_doc){\r\n      var posts = site.get_posts(tgt_doc);\r\n//      var posts = [];\r\n//      var anchors = tgt_doc.getElementsByTagName('a');\r\n//      var num = 0;\r\n//      for (var i=0;i<anchors.length;i++)\r\n//        if (anchors[i].name != '') posts[num++] = anchors[i].name;\r\n      var last_post = posts[0];\r\n      for (var i=1;i<posts.length;i++) {\r\n        if (posts[i]>last_post) last_post=posts[i];\r\n//      else break; // Cause a bug when a post had made in a sunk thread and immediately deleted.\r\n      }\r\n      return last_post;\r\n    }\r\n  }\r\n\r\n////function make_wafd(){ // deleted 2018.10.23\r\n////    function on_change_workaround_for_dollchan(exe){\r\n//////      pref.workaround_for_dollchan = workaround_for_dollchan.checked;\r\n////      if (pref.workaround_for_dollchan == true) {\r\n//////        document.getElementById('postform_row_files').style.display = '';\r\n//////        var tmp = document.getElementsByTagName('input');\r\n//////        for (var i=0;i<tmp.length;i++) if (tmp[i].type=='file') tmp[i].parentNode.style.display = '';\r\n////        if (exe) on_change_workaround_for_dollchan_2(); // temporarily.\r\n////        if (pref.wafd_tb=='tb') document.getElementById('postform_label_comment').addEventListener('mouseout', on_change_workaround_for_dollchan, false);\r\n////        else site.components.postform_submit.addEventListener('mouseenter', on_change_workaround_for_dollchan, false);\r\n////      } else {\r\n//////        document.getElementById('postform_row_files').style.display = 'none';\r\n////        if (pref.wafd_tb=='tb') document.getElementById('postform_label_comment').removeEventListener('mouseout', on_change_workaround_for_dollchan, false);\r\n////        else site.components.postform_submit.removeEventListener('mouseenter', on_change_workaround_for_dollchan, false);\r\n////      }\r\n////    }\r\n////    function workaround_for_dollchan_pref_changed(){\r\n////      if (pref.workaround_for_dollchan == true) {\r\n////        pref.workaround_for_dollchan = false;\r\n////        pref.wafd_tb = (pref.wafd_tb=='tb')? 'reply' : 'tb';\r\n////        on_change_workaround_for_dollchan(null);\r\n////        pref.workaround_for_dollchan = true;\r\n////        pref.wafd_tb = (pref.wafd_tb=='tb')? 'reply' : 'tb';\r\n////        on_change_workaround_for_dollchan(null);\r\n////      }\r\n////      open_spoiler();\r\n////    }\r\n////    function on_change_workaround_for_dollchan_2(){\r\n////      var inputs = document.getElementsByTagName('input');\r\n////      var files = [];\r\n////      for (var i=0;i<inputs.length;i++) if (inputs[i].type=='file') files.push(inputs[i]);\r\n////      var grand_parent = document.getElementById('postform_row_files');\r\n////      var parent;\r\n////      for (var i=0;i<grand_parent.childNodes.length;i++) if (grand_parent.childNodes[i].align=='left') parent = grand_parent.childNodes[i];\r\n//////      for (var i=0;i<4;i++) for (var j=0;j<4;j++) if (files[i].name==('file_'+j)) parent.childNodes[i].appendChild(files[i]);\r\n////      for (var i=0;i<files.length;i++) {\r\n////        var no = parseInt(files[i].name.replace(/file_/,\"\"));\r\n////        parent.childNodes[no].appendChild(files[i]);\r\n//////        parent.childNodes[no].style.display = '';\r\n//////        files[i].addEventListener('change', on_change_workaround_for_dollchan_3, false);\r\n////        var evt = document.createEvent('UIEvents');\r\n////        evt.initUIEvent('change', false, true, window, 1);\r\n////        files[i].dispatchEvent(evt);\r\n////      }\r\n////\r\n//////      var images = images = document.getElementsByClassName('de-file-img');\r\n//////      var thumbnails = [];\r\n//////      for (var i=0;i<images.length;i++) if (images[i].tagName=='IMG') thumbnails.push(images[i]);\r\n////      var thumbnails_parent = document.getElementById('postform_label_comment');\r\n////      var show_thumbnails = true;\r\n////      for (var i=0;i<files.length;i++) {\r\n//////        if (files[i].value=='' && thumbnails[i]!=undefined) thumbnails[i].parentNode.removeChild(thumbnails[i]);\r\n////        if (files[i].value=='') {\r\n////          var thumbnail = thumbnails_parent.getElementsByTagName('img')[0];\r\n////          if (thumbnail!=undefined) thumbnail.parentNode.removeChild(thumbnail);          \r\n////        }\r\n////        if (files[i].value!='' || show_thumbnails) {\r\n////          thumbnails_parent.childNodes[i].style.display = '';\r\n////          if (files[i].value=='') show_thumbnails = false;\r\n////        } else thumbnails_parent.childNodes[i].style.display = 'none';\r\n//////        console.log(i + ': '+ files[i].value);\r\n////      }\r\n////    }\r\n//////    function on_change_workaround_for_dollchan_3(){\r\n//////      console.log('change');\r\n//////    }\r\n////    if (pref.workaround_for_dollchan == true) on_change_workaround_for_dollchan(false); // initial\r\n////\r\n////    var spoiler_org = null;\r\n////    var rule = [];\r\n////    function open_spoiler(){\r\n////      if (pref.wafd_open_spoiler == true) {\r\n////        rule = [];\r\n////        for (var j=0;j<document.styleSheets.length;j++)\r\n////          for (var i=0;i<document.styleSheets[j].cssRules.length;i++)\r\n////            if (document.styleSheets[j].cssRules[i].selectorText && document.styleSheets[j].cssRules[i].selectorText.search(/spoiler/)!=-1) rule.push(j,i)\r\n////        if (document.styleSheets[rule[0]].cssRules[rule[1]].selectorText.search(/hover/)!=-1) {rule.push(rule.shift());rule.push(rule.shift());}\r\n////        spoiler_org = document.styleSheets[rule[0]].cssRules[rule[1]].style.cssText;\r\n////        document.styleSheets[rule[0]].cssRules[rule[1]].style.cssText = document.styleSheets[rule[2]].cssRules[rule[3]].style.cssText;\r\n////      } else if (spoiler_org!=null) document.styleSheets[rule[0]].cssRules[rule[1]].style.cssText = spoiler_org;\r\n////    }\r\n////    if (pref.wafd_open_spoiler == true) open_spoiler(); // initial\r\n////    return{\r\n//////      on_change_workaround_for_dollchan: function(exe){on_change_workaround_for_dollchan(exe);},\r\n////      workaround_for_dollchan_pref_changed: function(){workaround_for_dollchan_pref_changed();}\r\n////    }\r\n////  }\r\n\r\n  function make_post_form_obj(pn9){\r\n//  var post_form = (function(){\r\n//    var pn9 = div_init(9,'120px','30px','button','post_form');\r\n//    var pn9 = cnst.init('left:120px:bottom:30px:button:post_form:Show');\r\n    var tack;\r\n    pn9.addEventListener('click', show_hide2, false);\r\n    if (site2[site.nickname].postform) {\r\n      tack = site2[site.nickname].postform.init();\r\n      if (tack) cnst.set_tack_float(tack, postform_float, postform_dock);\r\n//      if (tack) tack.addEventListener('click', show_hide, false);\r\n    }\r\n    function postform_focus(){\r\n      site.components.postform_comment.focus();\r\n    }\r\n    function postform_float(e){\r\n      if (site2[site.nickname].postform.activation) site2[site.nickname].postform.activation();\r\n      var obj = cnst.tack_float_nSblgs(e);\r\n      obj.rolldown = postform_focus;\r\n      pn10 = obj.pn;\r\n      obj.cn.childNodes[0].innerHTML = \r\n        '<div>'+\r\n          '<input type=\"checkbox\" name=\"prevent_redirection\">prevent redirection'+\r\n        '</div>'+\r\n        '<div></div>';\r\n      pn10_2 = obj.cn.childNodes[0];\r\n      pref_func.apply_prep(pn10_2,false);\r\n      pn10_2.getElementsByTagName('input')['prevent_redirection'].onchange = on_change_redirection;\r\n      options.func0_prep(obj.cn.childNodes[0].childNodes[1],obj.pn, obj.cn);\r\n      postform_focus();\r\n      if (site.postform.getAttribute('name') === pref.script_prefix + '_draft') {\r\n        site.postform.style.display = null;\r\n        obj.pn.style.top = '0px';\r\n        obj.pn.style.left = '0px';\r\n      }\r\n    }\r\n    function postform_dock(e){\r\n      cnst.tack_dock_nSblgs(e);\r\n      if (site.postform.getAttribute('name') === pref.script_prefix + '_draft') site.postform.style.display = 'none';\r\n    }\r\n    function show_hide2(){\r\n      if (tack.style.display!=='none') postform_float({currentTarget:tack});\r\n      else postform_dock({currentTarget:pn10.childNodes[0]});\r\n    }\r\n    var pn10 = null;\r\n    var pn10_2 = null;\r\n//    var pn10_2 = cnst.add_to_tb(pn10,'<input type=\"checkbox\">workaround for dollchan<input type=\"checkbox\">prevent redirection');\r\n//    var pn10_2 = document.createElement('div');\r\n//    pn10_2.style.float = 'right'; // doesn't work on FF\r\n//    pn10_2.innerHTML = '<input type=\"checkbox\">workaround for dollchan<input type=\"checkbox\">prevent redirection'\r\n//    var prevent_redirection = pn10_2.childNodes[2];\r\n//    prevent_redirection.onchange = on_change_redirection;\r\n//    var workaround_for_dollchan = pn10_2.childNodes[0];\r\n//    workaround_for_dollchan.onchange = on_change_workaround_for_dollchan;\r\n//    var workaround_for_dollchan;\r\n//    var on = false; // working code\r\n////    var hidden_elements = [];\r\n//    function show_hide(){\r\n//      if (site2[site.nickname].postform.activation) site2[site.nickname].postform.activation();\r\n//      var tgt    = site.postform;\r\n//      if (!on) {\r\n//        if (pn10==null) {\r\n//          var left = tgt.offsetLeft - tgt.scrollLeft;\r\n//          var top = tgt.offsetTop - tgt.scrollTop + site.header_height();\r\n//          pn10 = cnst.init('left:'+left+'px:top:'+top+'px:overflow:hidden:Show:tb',function(){site.components.postform_comment.focus();},cnst.void_func,show_hide,cnst.void_func);\r\n////          pn10 = cnst.init('left:0px:tile:get:bottom:overflow:hidden:Show:tb',function(){site.components.postform_comment.focus();},cnst.void_func,show_hide,cnst.void_func)[0];\r\n//          pn10.id = 'pn10_debug';\r\n////          pn10_2 = cnst.add_to_tb(pn10,'<input type=\"checkbox\" name=\"workaround_for_dollchan\">workaround for dollchan<input type=\"checkbox\" name=\"prevent_redirection\">prevent redirection');\r\n//          pn10_2 = cnst.add_to_tb(pn10,'<input type=\"checkbox\" name=\"prevent_redirection\">prevent redirection');\r\n//          pref_func.apply_prep(pn10_2,false);\r\n////          prevent_redirection = pn10_2.childNodes[2];\r\n//          prevent_redirection = pn10_2.childNodes[0];\r\n//          prevent_redirection.onchange = on_change_redirection;\r\n////          workaround_for_dollchan = pn10_2.childNodes[0];\r\n////          workaround_for_dollchan.onchange = on_change_workaround_for_dollchan;\r\n////          pn10.childNodes[0].insertBefore(pn10_2,pn10.childNodes[0].childNodes[2]);\r\n////          if (brwsr.ff)  pn10.childNodes[0].childNodes[2].style.float = 'right'; // doesn't work\r\n////          if (brwsr.ff) pn10.childNodes[0].childNodes[2].outerHTML = pn10.childNodes[0].childNodes[2].outerHTML.replace(/<div/,\"<div style=\\\"float: right\\\"\"); // discard events configuration\r\n////          if (brwsr.ff) pn10.childNodes[0].childNodes[2].setAttribute('style','float: right');\r\n//          pn10.childNodes[1].innerHTML = '<div style=\"display: none\"></div><div></div>';\r\n////          options.func0_prep(pn10.childNodes[1].childNodes[0],pn10.childNodes[0]);\r\n//          options.func0_prep(pn10.childNodes[1].childNodes[0],pn10);\r\n//        }\r\n////        parent = tgt.parentNode; // working code\r\n////        no = 0;\r\n////        while (parent.childNodes[no]!=tgt && no < parent.childNodes.length) no++;\r\n////        pn10.childNodes[1].childNodes[1].appendChild(tgt);\r\n////        site.root_body.appendChild(pn10);\r\n//        tgt.parentNode.insertBefore(pn10,tgt);\r\n//        pn10.childNodes[1].childNodes[1].appendChild(tgt);\r\n////        var labels = document.getElementsByClassName('label'); // working code for KC, but dangerous.\r\n////        for (var i=0;i<labels.length;i++) {\r\n////          if (labels[i].innerHTML==\"Go to:\" || labels[i].innerHTML==\"Password:\") {\r\n////            if (labels[i].parentNode.style.display != 'none'){\r\n////              labels[i].parentNode.style.display = 'none';\r\n////              hidden_elements.push(labels[i].parentNode);\r\n////            }\r\n////          }\r\n////        }\r\n////        if (site.postform_rules!=null) {\r\n////          site.postform_rules.style.display = 'none';\r\n////          hidden_elements.push(site.postform_rules);\r\n////        }\r\n//        if (site2[site.nickname].postform) site2[site.nickname].postform.on(site.postform);\r\n//        site.components.postform_comment.focus();\r\n////        cnst.bottom_top(pn10);\r\n//      } else {\r\n//        if (site2[site.nickname].postform) site2[site.nickname].postform.off(pn10);\r\n////        while (hidden_elements.length!=0) hidden_elements.pop().style.display = '';\r\n//        pn10.parentNode.insertBefore(pn10.childNodes[1].childNodes[1].lastChild,pn10);\r\n//        pn10.parentNode.removeChild(pn10);\r\n//      }\r\n//      on = !on;\r\n//      if (tgt.getAttribute('name') === pref.script_prefix + '_draft') tgt.style.display = (on)? '' : 'none';\r\n//    }\r\n\r\n    var submits = [];\r\n    var forms_post = [];\r\n    var forms = document.getElementsByTagName('form');\r\n//    for (var i=0;i<forms.length;i++) if (forms[i].method!='post') forms.splice(i,1); // post, delete, report // doesn't work.\r\n    for (var i=0;i<forms.length;i++) if (forms[i].method=='post') forms_post.push(forms[i]); // post, delete, report\r\n    for (var i=0;i<forms_post.length;i++) {\r\n      var inputs = forms_post[i].getElementsByTagName('input');\r\n      for (var j=0;j<inputs.length;j++) if (inputs[j].type=='submit') submits.push(inputs[j]);\r\n    }\r\n//    var posted = [];\r\n//    for (var i=0;i<submits.length;i++) {posted.push(false); submits[i].addEventListener('click', function(){posted[i] = true;}, false);} // doesn't work because of closure.\r\n//    for (let i=0;i<submits.length;i++) {posted.push(false); submits[i].addEventListener('click', function(){posted[i] = true;}, false);} // 'let' can't be used in chrome script.\r\n    var posted = false;\r\n    var targets = [];\r\n    for (var i=0;i<submits.length;i++) submits[i].addEventListener('click', function(){posted = true;}, false);\r\n//    window.addEventListener('beforeunload', on_beforeunload, false);\r\n    var pn11;\r\n    function on_change_redirection(){\r\n//      pref.prevent_redirection = prevent_redirection.checked;\r\n      if (pn10_2!=null) pref_func.apply_prep(pn10_2,true);\r\n      if (pref.prevent_redirection == true) {\r\n        if (!pn11) {\r\n          pn11 = cnst.make_iframe('redirect_target');\r\n          pn11.onload = function(){if (pn11.location && pn11.location.href!='about:blank') pn11.location.replace('about:blank');}; // clear always.\r\n        }\r\n        for (var i=0;i<submits.length;i++) {\r\n          targets[i] = forms[i].target;\r\n          forms[i].target = 'redirect_target';\r\n        }\r\n      } else for (var i=0;i<submits.length;i++) forms[i].target = targets[i];\r\n    }\r\n    if (pref.prevent_redirection == true) on_change_redirection(); // initial\r\n//    function on_beforeunload(e){ // doesn't work. too late?\r\n//      if (prevent_redirection.checked == true) {\r\n//        console.log('beforeunload: ' + e);\r\n////        for (var i=0;i<submits.length;i++) {\r\n////          if (posted[i]) forms[i].target = 'rediret_target';\r\n////          posted[i] = false;\r\n////        }\r\n//        if (posted) for (var i=0;i<submits.length;i++) {\r\n//          targets[i] = forms[i].target;\r\n//          forms[i].target = 'redirect_target';\r\n//        }\r\n//      }\r\n//    }\r\n\r\n//    function on_change_workaround_for_dollchan(){\r\n////      pref.workaround_for_dollchan = workaround_for_dollchan.checked;\r\n//      if (pn10_2!=null) pref_func.apply_prep(pn10_2,true);\r\n//      if (pref.workaround_for_dollchan == true) {\r\n////        document.getElementById('postform_row_files').style.display = '';\r\n////        var tmp = document.getElementsByTagName('input');\r\n////        for (var i=0;i<tmp.length;i++) if (tmp[i].type=='file') tmp[i].parentNode.style.display = '';\r\n//        if (pn10_2!=null) on_change_workaround_for_dollchan_2(); // temporarily.\r\n//        if (pref.wafd_tb=='tb') document.getElementById('postform_label_comment').addEventListener('mouseout', on_change_workaround_for_dollchan, false);\r\n//        else site.components.postform_submit.addEventListener('mouseenter', on_change_workaround_for_dollchan, false);\r\n//      } else {\r\n////        document.getElementById('postform_row_files').style.display = 'none';\r\n//        if (pref.wafd_tb=='tb') document.getElementById('postform_label_comment').removeEventListener('mouseout', on_change_workaround_for_dollchan, false);\r\n//        else site.components.postform_submit.removeEventListener('mouseenter', on_change_workaround_for_dollchan, false);\r\n//      }\r\n//    }\r\n//    if (pref.workaround_for_dollchan == true) on_change_workaround_for_dollchan(); // initial\r\n//    function on_change_workaround_for_dollchan(){\r\n//      if (pn10_2!=null) pref_func.apply_prep(pn10_2,true);\r\n//      wafd.on_change_workaround_for_dollchan(true);\r\n//    }\r\n//    if (pref.workaround_for_dollchan == true) wafd.on_change_workaround_for_dollchan(false); // initial\r\n\r\n//    function on_change_workaround_for_dollchan_2(){\r\n//      var inputs = document.getElementsByTagName('input');\r\n//      var files = [];\r\n//      for (var i=0;i<inputs.length;i++) if (inputs[i].type=='file') files.push(inputs[i]);\r\n//      var grand_parent = document.getElementById('postform_row_files');\r\n//      var parent;\r\n//      for (var i=0;i<grand_parent.childNodes.length;i++) if (grand_parent.childNodes[i].align=='left') parent = grand_parent.childNodes[i];\r\n////      for (var i=0;i<4;i++) for (var j=0;j<4;j++) if (files[i].name==('file_'+j)) parent.childNodes[i].appendChild(files[i]);\r\n//      for (var i=0;i<files.length;i++) {\r\n//        var no = parseInt(files[i].name.replace(/file_/,\"\"));\r\n//        parent.childNodes[no].appendChild(files[i]);\r\n////        parent.childNodes[no].style.display = '';\r\n////        files[i].addEventListener('change', on_change_workaround_for_dollchan_3, false);\r\n//        var evt = document.createEvent('UIEvents');\r\n//        evt.initUIEvent('change', false, true, window, 1);\r\n//        files[i].dispatchEvent(evt);\r\n//      }\r\n//\r\n////      var images = images = document.getElementsByClassName('de-file-img');\r\n////      var thumbnails = [];\r\n////      for (var i=0;i<images.length;i++) if (images[i].tagName=='IMG') thumbnails.push(images[i]);\r\n//      var thumbnails_parent = document.getElementById('postform_label_comment');\r\n//      var show_thumbnails = true;\r\n//      for (var i=0;i<files.length;i++) {\r\n////        if (files[i].value=='' && thumbnails[i]!=undefined) thumbnails[i].parentNode.removeChild(thumbnails[i]);\r\n//        if (files[i].value=='') {\r\n//          var thumbnail = thumbnails_parent.getElementsByTagName('img')[0];\r\n//          if (thumbnail!=undefined) thumbnail.parentNode.removeChild(thumbnail);          \r\n//        }\r\n//        if (files[i].value!='' || show_thumbnails) {\r\n//          thumbnails_parent.childNodes[i].style.display = '';\r\n//          if (files[i].value=='') show_thumbnails = false;\r\n//        } else thumbnails_parent.childNodes[i].style.display = 'none';\r\n////        console.log(i + ': '+ files[i].value);\r\n//      }\r\n//    }\r\n////    function on_change_workaround_for_dollchan_3(){\r\n////      console.log('change');\r\n////    }\r\n\r\n//    var pn11 = cnst.make_iframe('redirect_target');\r\n//    pn11.onload = function(){if (pn11.location && pn11.location.href!='about:blank') pn11.location.replace('about:blank');}; // clear always.\r\n//////    var pn11 = div_init(11,'100px','100px','div'); // working code.\r\n//////    pn11.style.display = 'none';\r\n////    var pn11 = cnst.init('left:100px:bottom:100px:display:none:Show');\r\n////    pn11.id = 'pn11_debug';\r\n////    pn11.addEventListener('click', function(){on_load('parent_click');}, false);\r\n////    // delete contents for preventing from getting new posts by auto-updater.\r\n//////    function pn11_init(){ // works on Chrome, but causes infinite loop on FF.\r\n////      pn11.innerHTML = '<iframe name=\"redirect_target\" id=\"redirect_target\"></iframe>';\r\n////////      document.getElementsByName('redirect_target')[0].setAttribute('onload','alert(\"AAA\");return false;'); // work\r\n////////      document.getElementsByName('redirect_target')[0].setAttribute('onload','on_load();'); // fail;\r\n////////      document.getElementsByName('redirect_target')[0].onload  = function(){on_load('child_load')}; // work\r\n////////      document.getElementsByName('redirect_target')[0].onclick = function(){on_load('child_click')}; // for debug.\r\n////      pn11.childNodes[0].onload  = function(){on_load('child_load')}; // work\r\n////      pn11.childNodes[0].onclick = function(){on_load('child_click')}; // for debug.\r\n//////    }\r\n//////    pn11_init();\r\n////    function on_load(from_where){\r\n////      console.log('load: '+from_where);\r\n////      site.components.postform_submit.disabled = false;\r\n//////      top.redirect_target.document\r\n//////      if (posted) for (var i=0;i<submits.length;i++) forms[i].target = targets[i];\r\n//////      posted = false;\r\n//////      if (pn11.style.display=='none') pn11_init();\r\n//////      if (pn11.style.display=='none') frames['redirect_target'].location.replace('about:blank');\r\n////      if (pn11.style.display=='none') if (frames['redirect_target'].location.href!='about:blank') frames['redirect_target'].location.replace('about:blank');\r\n////    }\r\n//////    var pn11_on = false;\r\n////    function debug(){\r\n//////      if (!pn11_on) site.root_body.appendChild(pn11);\r\n//////      else site.root_body.removeChild(pn11); // can't prevent redirection.\r\n////      if (pn11.style.display=='none') pn11.style.display = '';\r\n////      else {\r\n////        pn11.style.display = 'none';\r\n//////      pn11_on = !pn11_on;\r\n//////      frames['redirect_target'].document.open();\r\n//////      frames['redirect_target'].document.write('deleted');\r\n//////      frames['redirect_target'].document.close();  // delete contents for preventing from getting new posts by auto-updater.\r\n//////        pn11_init();\r\n////        if (frames['redirect_target'].location.href!='about:blank') frames['redirect_target'].location.replace('about:blank');\r\n////      }\r\n////    }\r\n////    \r\n//////// working code\r\n//////    var pn11 = div_init(11,'100px','100px','div');\r\n//////    pn11.id = 'pn11_debug';\r\n//////    pn11.innerHTML = '<iframe name=\"redirect_target\" id=\"redirect_target\"></iframe>'\r\n//////    pn11.addEventListener('click', function(){on_load('parent_click');}, false);\r\n////////    document.getElementsByName('redirect_target')[0].setAttribute('onload','alert(\"AAA\");return false;'); // work\r\n////////    document.getElementsByName('redirect_target')[0].setAttribute('onload','on_load();'); // fail;\r\n//////    document.getElementsByName('redirect_target')[0].onload  = function(){on_load('child_load')};\r\n//////    document.getElementsByName('redirect_target')[0].onclick = function(){on_load('child_click')}; // for debug.\r\n//////    var forms = document.getElementsByTagName('form');\r\n//////    for (var i=0;i<forms.length;i++) {\r\n//////      if (forms[i].method=='post') forms[i].target = 'redirect_target'; // post, delete, report\r\n//////    }\r\n////////    window.addEventListener('load', on_load, false);\r\n//////    pn11.addEventListener('load', on_load, false);\r\n////////    pn11.redirect_target.addEventListener('load', on_load, false);\r\n//////    function on_load(from_where){\r\n//////      console.log('load: '+from_where);\r\n//////      site.components.postform_submit.disabled = false;\r\n////////      top.redirect_target.document\r\n//////    }\r\n    return show_hide2;\r\n//  })();\r\n  };\r\n\r\n\r\n  var pn_debug = 0;\r\n//  var pn_debug_button = div_init(-1,'200px','30px','button','debug');\r\n//  var pn_debug_button = cnst.init('left:200px:bottom:30px:button:debug:Show');\r\n//  var pn_debug_out    = div_init(2,'200px','50px','txt','debug_out');\r\n//  var pn_debug_out    = cnst.init('left:200px:bottom:50px:txt:debug_out');\r\n  function make_debug_obj(pn_debug_button){\r\n    pn_debug_button.addEventListener('click', debug, false);\r\n    function debug(e){\r\n      console.log('debug');\r\n      if (site.components.postform_submit!=null) site.components.postform_submit.disabled = false;\r\n//      pn_debug_out.textContent += 'debug';\r\n//      if (post_form_obj) post_form_obj.debug();\r\n//      worker.port.postMessage(\"Scott\");\r\n//      worker.port.postMessage(JSON.stringify(['SET','test2','Scott']));\r\n//      worker.port.postMessage(JSON.stringify(['GET','test2']));\r\n//      var str = timer_obj.timer().timer().req.responseText;\r\n//      console.log(str);\r\n//      worker.port.postMessage(JSON.stringify(['ECHO','ON']));\r\n//      brwsr.sw_cache.setItem(site.nickname+site.board+'0',JSON.stringify([cnst.get_time(), str]));\r\n\r\n    }\r\n    return make_debug_obj;\r\n  }\r\n\r\n  // can't use sw_cache in 8chan because of 'Content Security Policy' header\r\n  brwsr.sw_cache = (brwsr.sw_cache && window.SharedWorker && (pref.info_server || pref.info_client))? (function(){\r\n// working code.\r\n//    script = 'self.onmessage = function(e){self.postMessage(e.data);};'\r\n//    var blob = new Blob([script], {type: 'text/javascript'});\r\n//    var blobURL = URL.createObjectURL(blob);\r\n//    var echoWorker = new unsafeWindow.Worker(blobURL);\r\n//    URL.revokeObjectURL(blobURL);\r\n//    echoWorker.onmessage = function (oEvent) {\r\n//      console.log(\"Worker said : \" + oEvent.data);\r\n//    };\r\n//    echoWorker.postMessage(\"ali\");\r\n\r\n// http://www.sitepoint.com/javascript-shared-web-workers-html5/\r\n    if (!localStorage) return null;\r\n    var worker = null;\r\n    var sw_alive = false;\r\n    var key_ls = pref.script_prefix+'.bs'; // backing store\r\n    var url = localStorage[key_ls]; // should use cookie instead of localStorage.\r\n    if (url) {\r\n      if (!prep_sw(url)) prep_sw();\r\n    } else prep_sw();\r\n    function prep_sw(blobURL) {\r\n      if (!blobURL) {\r\n        var script = '\\\r\n          var ports = [];\\\r\n          var store = {};\\\r\n          var connections = 0;\\\r\n          self.addEventListener(\"connect\", function(e){\\\r\n            var port = e.ports[0];\\\r\n            var no = connections++;\\\r\n            var func = function(e){msg_parser(e,port,no)};\\\r\n            port.addEventListener(\"message\", func, false);\\\r\n            port.start();\\\r\n            port.postMessage(JSON.stringify([\"INFO\",\"Connected: #\" + no]));\\\r\n            ports.push({port:port, func:func, echo:true, subscribe:false});\\\r\n          }, false);\\\r\n          function msg_parser(e,port,no){\\\r\n            if (ports[no].echo) port.postMessage(e.data);\\\r\n            var fields = JSON.parse(e.data);\\\r\n            if (fields[0]==\"ECHO\") ports[no].echo = fields[1];\\\r\n            else if (fields[0]==\"GET\") port.postMessage(JSON.stringify([\"ACK\",fields[1],store[fields[1]]]));\\\r\n            else if (fields[0]==\"CLOSE\") {\\\r\n              port.removeEventListener(\"message\", ports[no].func, false);\\\r\n              ports[no] = null;\\\r\n            }\\\r\n/*            else if (fields[0]==\"SET\") store[fields[1]]=fields[2];*/\\\r\n            else if (fields[0]==\"SET\") {\\\r\n              var old_val = store[fields[1]];\\\r\n              if (old_val!=fields[2]) {\\\r\n                var msg = JSON.stringify([\"EVENT\",fields[1]]);\\\r\n                for (var i=0;i<ports.length;i++)\\\r\n                  if (i==no) store[fields[1]]=fields[2];\\\r\n                  else if (ports[i] && ports[i].subscribe) ports[i].port.postMessage(msg);\\\r\n              }\\\r\n            } else if (fields[0]==\"STAT\") stat_post(port,\"STAT_ACK\",fields[1]);'+\r\n           'else if (fields[0]==\"SUBSCRIBE\") ports[no].subscribe = fields[1];'+\r\n         '}'+\r\n         'var gc = setInterval(gc_func, 600000);'+\r\n         'function gc_func(){'+\r\n           'var date = Date.now() - 3600000;'+\r\n           'for (var i in store) if (store[i].date < date) delete store[i];'+\r\n//           'stat_post(ports[0].port,\"STAT_REP\",false);'+\r\n//           'for (var i in store) ports[0].port.postMessage(JSON.stringify([i,store[i].date,store[i].date-date]));'+\r\n         '}'+\r\n         'function stat_post(port,str,dump){'+\r\n           'var live = 0;'+\r\n           'for (var i=0;i<ports.length;i++) if (ports[i]) live++;'+\r\n//           'var count = 0;'+\r\n//           'for (var i in store) count++;'+\r\n//           'var msg = JSON.stringify([str,\"Connected: \"+live+\"/\"+connections+\", Stored: \"+count]);'+\r\n           'var msg = JSON.stringify([str,\"Connected: \"+live+\"/\"+connections+\", Stored: \"+Object.keys(store).length]);'+\r\n           'port.postMessage(msg);'+\r\n           'var count = 0;'+\r\n           'if (dump) for (var i in store) port.postMessage(JSON.stringify([\"DUMP_ACK\",(count++)+\": \"+i+\", \"+JSON.stringify(store[i])]));'+\r\n         '}\\\r\n        ';\r\n        var blob = new Blob([script], {type: 'text/javascript'});\r\n        blobURL = URL.createObjectURL(blob);\r\n        localStorage[key_ls] = blobURL;\r\n      }\r\n      try {\r\n        worker = new unsafeWindow.SharedWorker(blobURL); // FF throws exception when blobURL is invalid. But chorome doesn't throw.\r\n//        worker = new unsafeWindow.SharedWorker('blob:https%3A//krautchan.net/87996484-6a43-44c8-ab11-efe455fd2b2b');\r\n//        URL.revokeObjectURL(blobURL); // Chrome need several secondss to invoke. If you place this here, it doesn't work on chrome.\r\n        worker.port.addEventListener('message', sw_out, false);\r\n//        worker.port.addEventListener('message', sw_get, false);\r\n        worker.port.addEventListener('message', sw_tryget, false);\r\n        worker.port.start();\r\n//        worker.port.postMessage(\"Alyssa\");\r\n//        worker.port.postMessage(JSON.stringify(['ECHO','Alyssa']));\r\n//        worker.port.postMessage(JSON.stringify(['SET','test0','val_0']));\r\n//        worker.port.postMessage(JSON.stringify(['SET','test1','val_1']));\r\n//        worker.port.postMessage(JSON.stringify(['GET','test0']));\r\n//        worker.port.postMessage(JSON.stringify(['GET','test1']));\r\n//        console.log(url);\r\n        return true;\r\n      } catch(e) {\r\n//        console.log('catch error at making worker');\r\n//        prep_sw(undefined); // FF with 'Content Security Policy' header will make infinite loop.\r\n        return false;\r\n      }\r\n    }\r\n    function sw_out(e){\r\n//      alert('Worker said : ' + e.data);\r\n//      console.log('Worker said : ' + e.data);\r\n      console.log(new Date().toLocaleTimeString() + ', Worker said : ' + e.data.substr(0,120));\r\n      if (!sw_alive) {\r\n        worker.port.postMessage(JSON.stringify(['STAT']));\r\n//        worker.port.postMessage(JSON.stringify(['STAT',true]));\r\n        if (!pref.debug_mode['0']) worker.port.postMessage(JSON.stringify(['ECHO',false]));\r\n//        worker.port.postMessage(JSON.stringify(['ECHO',true]));\r\n//        worker.port.postMessage(JSON.stringify(['ECHO',false]));\r\n        window.addEventListener('beforeunload',\r\n          function(){\r\n            worker.port.postMessage(JSON.stringify(['CLOSE']));\r\n            worker.port.close();\r\n          }, false);\r\n      }\r\n      sw_alive = true;\r\n      if (!pref.debug_mode['0']) worker.port.removeEventListener('message', sw_out, false);\r\n    }\r\n    if (!brwsr.ff && worker) setTimeout(function(){\r\n//      console.log('alive = '+ sw_alive);\r\n      if (url!==null && !sw_alive) {\r\n        worker.port.removeEventListener('message', sw_out, false);\r\n        worker.port.close();\r\n        if (!prep_sw()) brwsr.sw_cache = null; // kill myself\r\n      }\r\n    },5000);\r\n//    var store = [];\r\n//    function sw_get(e){\r\n//      var fields = JSON.parse(e.data);\r\n//      if (fields[0]==\"ACK\") store[fields[1]]=fields[2];\r\n//    }\r\n    var callbacks = [];\r\n    var tryget_ids = [];\r\n    var fields = null; // static object for scan.\r\n    function sw_tryget(e){\r\n      fields = JSON.parse(e.data);\r\n      if (fields[0]==\"ACK\") {\r\n        var key = fields[1];\r\n        clearTimeout(tryget_ids[key]);\r\n        if (callbacks[key]) {\r\n          callbacks[key][0](key,fields[2],callbacks[key][1]); // callback with value.\r\n          delete callbacks[key];\r\n        }\r\n      } else if (fields[0]==\"EVENT\") {\r\n        if (pref.info_client && fields[1].search(info_raw)!=-1 && fields[1].substr(info_raw.length,1)=='p') {\r\n          var page_no = fields[1].substr(info_raw.length+1);\r\n          var timer = (timer_obj)? timer_obj.timer() : null;\r\n          if (timer!=null) {\r\n//            var value = JSON.parse(fields[2]);\r\n//            timer.page_check4(value[0], page_no, new DOMParser().parseFromString(value[1],'text/html'));\r\n            brwsr.sw_cache.trygetItem(fields[1],timer.page_check5);\r\n          }\r\n        }\r\n        if (pref.info_client && catalog_obj && catalog_obj.catalog_func()!=null && pref.catalog_snoop_refresh)\r\n          catalog_obj.catalog_func().catalog_insert(fields[1]);\r\n      }\r\n      fields = null;\r\n    }\r\n    function tryget_timeout(key){ // timeout is sequential always.\r\n      callbacks[key][0](key,null,callbacks[key][1]); // callback with null.\r\n      delete callbacks[key];\r\n    }\r\n    return (!worker)? null : {\r\n      setItem: function(key,value){worker.port.postMessage(JSON.stringify(['SET',key,value]));},\r\n//      getItem: function(key){\r\n//        worker.port.postMessage(JSON.stringify(['GET',key]));\r\n//        while (store[key]==undefined) sleep(0);\r\n//        var retval = store[key];\r\n//        delete store[key];\r\n//        return retval;\r\n//      },\r\n      trygetItem: function(key,callback,args){\r\n        callbacks[key] = [callback,args];\r\n        tryget_ids[key] = setTimeout(function(){tryget_timeout(key);},2000); // timeout 2sec\r\n        worker.port.postMessage(JSON.stringify(['GET',key]));\r\n      },\r\n      subscribe: function(sub){worker.port.postMessage(JSON.stringify(['SUBSCRIBE',sub]));},\r\n      addEventListener: function(){\r\n      }\r\n    }\r\n  })() : null;\r\n\r\n  if (!site0.isStep) (function(){\r\n    var key = 'CatChan_archive_'+window.name;\r\n    var func_invoke = (pref.catalog.embed_page && site.whereami==='page' && sessionStorage && sessionStorage[key])? function(){\r\n      catalog_obj.show_hide();\r\n      setTimeout(function(){\r\n        var data = JSON.parse(sessionStorage[key]);\r\n        if (sessionStorage[key+'M']) data[2] = function(){\r\n          send_message_emu = JSON.parse(sessionStorage[key+'M']);\r\n          receive_message_emu(window.name);\r\n          if (pref.archive.IDB.redirect_404_CSP) {\r\n            var str = document.head.innerHTML + document.body.innerHTML;\r\n            var blob = new Blob([str],{type:'text/html'});\r\n            var url = URL.createObjectURL(blob);\r\n            window.open(url,window.name+'B');\r\n          }\r\n        };\r\n        send_message_emu = [data];\r\n        receive_message_emu(window.name);\r\n      },100);\r\n    } : catalog_obj && catalog_obj.show_hide;\r\n    if (site.whereami==='404' && pref.archive.IDB.redirect_404) {\r\n      if (sessionStorage) setTimeout(function(){\r\n        var key_a = key+'A';\r\n        if (!sessionStorage[key_a]) {\r\n          var dbt = common_func.fullname2dbt(window.name);\r\n          sessionStorage[key_a] = JSON.stringify(['ARCHIVER',['SUB_INIT', {IDB:true, domain:dbt[0], board:dbt[1], no:dbt[2]}]]);\r\n          if (received_messages_404) sessionStorage[key_a+'M'] = JSON.stringify(received_messages_404); // this requires message pump(setTimeout)\r\n          var url = site2[site.nickname].make_url4([site.nickname, site.board, '0','page_html'])[0];\r\n          window.name = window.name+'A';\r\n//          setTimeout(function(){window.open(url,'_self');},5000); // for debug\r\n          window.open(url,'_self');\r\n        } else delete sessionStorage[key_a];\r\n      },5000);\r\n    } else if ((pref.catalog.embed && site.whereami==='catalog') || (pref.catalog.embed_page && site.whereami==='page') || (pref.thread.embed && site.whereami==='thread') || (pref.catalog.embed_archive && site.whereami==='archive')) { //patch\r\n      if (catalog_obj) {\r\n        if (site2[site.nickname].catalog_native_prep_wait_loop) site2[site.nickname].catalog_native_prep_wait_loop(site.whereami, func_invoke);\r\n        else if (pref.patch.delayed_invoke.use) setTimeout(func_invoke, pref.patch.delayed_invoke.sec*1000);\r\n        else func_invoke();\r\n      }\r\n    }\r\n    setTimeout(thread_reader_init,0); // invoke after catalog to reduce times of making site.myself\r\n    setTimeout(uip_tracker_init,0);\r\n  })();\r\n// console debug commands for SharedWorker.\r\n//\r\n// var url = localStorage['CatChan.backing_store'];\r\n// var worker = new window.SharedWorker(url);\r\n// worker.port.onmessage = function(e){console.log(e.data.substr(0.120));};\r\n// worker.port.start();\r\n// worker.port.postMessage(JSON.stringify(['STAT']));\r\n\r\n\r\n//  function test_sw_cache(){\r\n//    sw_cache.setItem('/int/','aaa');\r\n//    sw_cache.trygetItem('/int/',sw_dummy);\r\n//    function sw_dummy(key,val){\r\n//      console.log(key,val);\r\n//    }\r\n//  }\r\n//  setTimeout(test_sw_cache,10000);\r\n\r\n// OPTIONS FROM HERE\r\n  options.func0_prep = function(pn,tb, ppn){ // schedule poster.\r\n    var tb_0 = cnst.add_to_tb(tb,cnst.icons.button_settings());\r\n//    tb_0.childNodes[0].onchange = function(){cnst.show_hide(pn);};\r\n    pn.innerHTML = '<div style=\"float:left\"><input type=\"checkbox\">autobumper</div><div style=\"float:right\"><input type=\"button\" value=\"Schedule\"><select name=\"time_sel\"><option>at</option><option>later</option></select><input type=\"time\" name=\"time\" value=\"08:41\"></div><div style=\"float:right\"></div>';\r\n    pn.childNodes[1].childNodes[0].addEventListener('click', schedule_post, false);\r\n//// working code for relative time.\r\n////    var cd_id = null;\r\n////    var cd_id_m = null;\r\n////    var cd_id_30s = null;\r\n////    var bg_back     = pn.parentNode.style.background;\r\n//////    var bg_back_org = bg_back;\r\n////    var time_to_post;\r\n////    function schedule_post(){\r\n////      if (cd_id==null && cd_id_30s==null) {\r\n//////        pn.childNodes[1].childNodes[0].value = 'Cancel';\r\n////        var sel_id = pn.childNodes[1].childNodes[1].selectedIndex;\r\n////        var time_val = pn.childNodes[1].childNodes[2].value;\r\n////        \r\n////        time_to_post = parseInt(time_val.substr(0,2),10)*3600 + parseInt(time_val.substr(3,2),10)*60;\r\n////        if (sel_id==0) {\r\n////          var time_str = cnst.get_time();\r\n////          time_to_post -= parseInt(time_str.substr(0,2),10)*3600 + parseInt(time_str.substr(3,2),10)*60 + parseInt(time_str.substr(6,2),10);\r\n////        }\r\n////        if (time_to_post<=0) time_to_post += 86400;\r\n////        cd_id = setTimeout(countdown_post_30s,(time_to_post-30)*1000); // NOT ACCURATE. slip 70s for 5h.\r\n////        countdown_m(time_to_post%60);\r\n////        set_background_and_button_value();\r\n//////        pn.parentNode.style.background = '#f5ecf9';\r\n////      } else {\r\n////        if (cd_id    !=null) {clearTimeout(cd_id); cd_id = null;}\r\n////        if (cd_id_m  !=null) {clearTimeout(cd_id_m);cd_id_m = null;}\r\n////        if (cd_id_30s!=null) cd_id_30s = cd_id_30s();\r\n//////        pn.parentNode.style.background = bg_back;\r\n////        cd_txt.innerHTML = '';\r\n//////        pn.childNodes[1].childNodes[0].value = 'Schedule';\r\n////        set_background_and_button_value();\r\n////      }\r\n////    }\r\n////    var cd_txt = pn.childNodes[2];\r\n////    function countdown_m(dec){\r\n////      var str = '';\r\n////      if (time_to_post%60!=0) str = time_to_post%60 + 's';\r\n////      if (time_to_post>=60)   str = Math.round((time_to_post%3600)/60) + 'm' + str;\r\n////      if (time_to_post>=3600) str = Math.round(time_to_post/3600) + 'h' + str;\r\n////      cd_txt.innerHTML = str;\r\n////      time_to_post -= dec;\r\n////      cd_id_m = setTimeout(function(){countdown_m(60);},dec*1000);\r\n////    }\r\n////    function countdown_post_30s(){\r\n////      cd_id_30s = countdown_post(30);\r\n////      clearInterval(cd_id_m);\r\n////      cd_id = null;\r\n////      cd_id_m = null;\r\n////    }\r\n\r\n    var cd_id = null;\r\n    var cd_id_s = null;\r\n    var bg_back     = pn.parentNode.style.background;\r\n    var time_at_post;\r\n    function schedule_post(){\r\n      if (cd_id==null && cd_id_s==null) {\r\n        var sel_id = pn.childNodes[1].childNodes[1].selectedIndex;\r\n        var time_val = pn.childNodes[1].childNodes[2].value;\r\n        var hour = parseInt(time_val.substr(0,time_val.indexOf(':')),10);\r\n        var min  = parseInt(time_val.substr(time_val.indexOf(':')+1),10);\r\n        var time_now = Date.now();\r\n        if (sel_id==0) {\r\n          time_at_post = new Date().setHours(hour,min,0);\r\n          if (time_at_post<time_now) time_at_post+=86400*1000;\r\n        } else time_at_post = time_now + (hour*3600+min*60)*1000;\r\n        countdown_m();\r\n      } else {\r\n        if (cd_id  !=null) {clearTimeout(cd_id);cd_id=null;}\r\n        if (cd_id_s!=null) {clearInterval(cd_id_s);cd_id_s=null;}\r\n        cd_txt.innerHTML = '';\r\n      }\r\n      set_background_and_button_value(false);\r\n    }\r\n    var cd_txt = pn.childNodes[2];\r\n    function countdown_m(){\r\n      var time_now = Date.now();\r\n      var time_till_post = time_at_post-time_now;\r\n      if (time_till_post%60000>=1000 && time_till_post>60000) cd_id = setTimeout(countdown_m,time_till_post%60000);\r\n      else if (time_till_post<90000) cd_id = setTimeout(function(){cd_id_s=countdown_post(30);cd_id=null;},time_till_post-30*1000);\r\n      else cd_id = setTimeout(countdown_m,(time_till_post+30000)%60000+30000);\r\n      var str = '';\r\n//      if (time_till_post %60000) str = (time_till_post%60000)/1000 + 's'; // debug\r\n      if (time_till_post %60000>=1000 && time_till_post%60000<=59499) str = Math.round((time_till_post%60000)/1000) + 's';\r\n      if (time_till_post>=59500)   str = Math.floor(((time_till_post+500)%3600000)/60000) + 'm' + str;\r\n      if (time_till_post>=3599500) str = Math.floor( (time_till_post+500)/3600000) + 'h' + str;\r\n      cd_txt.innerHTML = str;\r\n    }\r\n\r\n    function countdown_post(sec){\r\n      cd_txt.innerHTML = sec + 's';\r\n      set_background_and_button_value(true);\r\n      return setInterval(countdown_s, 1000);\r\n\r\n      function countdown_s(){\r\n        sec -= 1;\r\n        cd_txt.innerHTML = sec + 's';\r\n        if (sec==0) {\r\n//          alert('post at '+ Date());\r\n          var evt = document.createEvent('MouseEvents');\r\n          evt.initUIEvent('click', false, true, window, 1);\r\n          site.components.postform_submit.dispatchEvent(evt);\r\n          schedule_post(); // cancel procedure\r\n        }\r\n      }\r\n    }\r\n\r\n    var autobumper = pn.childNodes[0].childNodes[0];\r\n    autobumper.onchange = function(){set_background_and_button_value(false);};\r\n    function set_background_and_button_value(cd_s){\r\n      ppn.style.background = (cd_s)? '#ffc0cb' : ((cd_id!=null)? '#f5ecf9' : ((autobumper.checked)? '#e5f4f9' : bg_back));\r\n      var value = (cd_s || cd_id!=null)? 'Cancel' : 'Schedule';\r\n      pn.childNodes[1].childNodes[0].value = value;\r\n    }\r\n    var timer_deadtime = null;\r\n    options.func0_exe = function(page){\r\n      var posts_itt = document.getElementsByClassName('postreply').length - document.getElementsByClassName('de-post-deleted').length;\r\n      if (parseFloat(page)>=site.max_page-1 && autobumper.checked && timer_deadtime==null && posts_itt < site.autosage) {\r\n//      if (parseFloat(page)>=1 && autobumper.checked && timer_deadtime==null) { // for debug }\r\n        cd_id_s = countdown_post(30);\r\n        timer_deadtime = setTimeout(function(){timer_deadtime=null;},3600*1000); // 1h\r\n      }\r\n    }\r\n  }\r\n// NEXT TIME PASSWORD fDEPJ9Uo\r\n// OPTIONS TO HERE\r\n\r\n})();\r\n"]}