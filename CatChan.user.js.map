{"version":3,"sources":["CatChan.user.js"],"names":["pref_default","proto","image_hover","image_hover_zIndex","image_prefetch","click","click_area","format","show","style","contents","layout","posts","fileinfo","images_2nd","hover","search","thumb","resize","footer","ctime","btime","ptime","br","prate","archived","nd","nl","draw_on_demand","load_on_demand","t2h_sel","t2h_L","t2h_M","t2h_N","this","t2h_num_of_posts","save_board_list_sel","board_list_sel","mark_new_posts","auto_update","auto_update_period","auto_update_countdown","popup","colorID","backlink","popup_truncated","link_show_op","expand_thumbnail_inline","localtime","expand_thumbnail_inline_all_after","expand_thumbnail_initial","hide_posts_without_images","thumbnail","inline","limit_width","limit_height","margin_width","margin_height","webm","webm_mute","webm_loop","ondemand","ref_height","open_spoiler_text","open_spoiler_image","merge","scroll_lock","use_expander_always","popup2","posts_search_op","posts_search_op_opacity","deleted_posts","detect","store","auto_clean","auto_config_posts_search","env","disp_offset","popup_native","expand_thumbnail_inline_native","image_hover_native","colorID_native","backlink_native","localtime_native","auto_update_native","event_dynamic","pref_new","script_prefix","features","page","graph","setting","setting2","postform","catalog","listener","uip_tracker","thread_reader","debug","notify","desktop","sound","favicon","recovery","max_capture","interval_found","write_to_ls","aggregator","server","load_pref","load_data","check_page","check_post","check_thread","import_format","max_graph","scale_thread","auto_start","workaround_for_dollchan","prevent_redirection","graph_animation","autoconf","info_server","info_client","wafd_tb","wafd_open_spoiler","show_page_fraction","catalog_max_page","catalog_max_page_auto","catalog_max_page_select","catalog_snoop_refresh","catalog_auto_rollup_when_moving","catalog_size_width","catalog_size_height","catalog_size_text_width","catalog_size_text_height","catalog_size_tn1_width","catalog_size_tn1_height","catalog_size_tn2_width","catalog_size_tn2_height","catalog_size_frame0_width","catalog_size_frame1_width","catalog_load_on_demand_timeout","catalog_2nd_images_show","catalog_2nd_images_hover","catalog_2nd_images_search","catalog_posts_on_demand","catalog_refresh_clear","catalog_popdown","catalog_popup_delay","catalog_popdown_delay","catalog_popup_size_fix","catalog_open_last50","catalog_board_list_str","catalog_board_list_obj","catalog_promiscuous","catalog_board_list_sel","cataLog","embed_mode","val","localtime_offset","Date","getTimezoneOffset","catalog_footer","catalog_footer_show_site_name","catalog_footer_show_board_name","catalog_footer_show_thread_no","catalog_footer_show_nof_rep_to_me","catalog_footer_show_nof_rep","catalog_footer_ignore_my_own_posts","catalog_footer_show_flag","catalog_footer_show_page","catalog_footer_show_tag","catalog_footer_tag_letters","catalog_footer_design","catalog_no_popup_at_expanded","catalog_open_in_new_tab","catalog_open_where","catalog_open_where_click","catalog_triage","catalog_triage_place","catalog_triage_hist","triage","show_always","popdown_delay","hide_toggle","catalog_triage_str","catalog_cross_domain_connection","catalog_auto_update_countdown","catalog_expand_at_initial","catalog_expand_at_initial_embed","catalog_expand_with_hr","overwrite_site2_json_str","overwrite_site2_eval_str","tooltips","help","popup_delay","info","indexing","max_threads_at_refresh","filter","kwd","use","str","re","ci","match","op","post","sub","name","trip","com","file","kwds","meta","sentence","tag","tag_ci","time","time_creation","time_str","now","toLocaleString","time_obj","time_ago_str","time_ago_str_sync_at_refresh","time_track","desktopime_mark_str","time_watch","time_watch_creation","list_time_scroll","list","list_str","list_obj2","attr_list","attr_list_str","attr_list_obj2","bookmark_list","bookmark_list_str","bookmark_list_obj2","watch_list_str","watch_list_obj2","tag_search","pref","liveTag","rexps","bookmark_list_rm404","auto_load_filter","auto_save_filter","auto_save_filter_at_refresh","ignore","max","board","recommendation","all_boards","board_tags","ex_list","ex_list_str","ex_list_obj2","board_tags_same","style_general_list","style_general_list_str","style_general_list_obj2","refresh","initial","except_bt","at_switch","design","catalog_json","embed","embed_page","embed_frame","order","reply_to_me","reply","watch","sticky","auto_watch","unmark_on_hover","mimic_base_site","text_mode","mode","appearance","titleBar","settings","num_of_pages","boards_selector","state","width","height","Object","create","__proto__","disable_list_when_kwd_active","infinite","thread","float","common","clear_at_manual_scan","on","deletion","interval","adaptive","auto_open","auto_open_th","auto_open_kwd","sync","triage_close","check_num_of_children","own_posts_tracker","show_own_post_by","show_reply_to_me_by","clean_up_own_posts","gen","gen_str","cloudflare","auto_reload","auto_reload_time","scan","lifetime","crawler","max_threads","crawler_adaptive","crawler_idle_time_to_spawn","src","beep_freq","beep_length_f","beep_volume_f","new_thread","appear","show_last","limit","brwsr","ff","delay","title","hide_zero","maxstr","from","lock_tags_in_op","inherit_board_name","lock_board_name","inherit_board_tags","lock_board_tags","show_info_onmouseover","style_urtm_str","style_ur_str","style_in_str","style_urtm_obj4","style_ur_obj4","style_in_obj4","pickup_interval","rm_404_immediately","disp_delay","fg","bg","click_func","click_func_bl","watch_all","utilize_boards_json","ex_list_obj5","rm_list","rm_list_str","rm_list_obj5","virtualBoard","scanDelay","p_board","p_remove","v_remove","scan_domains","meguca","lain","8chan","4chan","KC","instant_scan","sel","fix","titleBar_str","window_str","popUp_str","copy","post_editing","comment","healthIndicator","expand_running","dont_retire_running","cancel","network","fetch_actively","th100","th100_delay","th20","th20_delay","stats","retain_404","draw_delay","estimate_posts","save","load","len_capture","auto_acquisition","auto_acquisition_scan","auto_acquisition_scan_delay","auto_acquisition_all","tolerant","tolerance","chart","off_anime_blur","window_width","window_height","inst","len","time_sel","board_sel","show_legend","np","p","ep","nt","t","et","clip_np","clip_np_val","options","bezierCurve","animation","pointDot","pointDotRadius","archive","json","dir","load_img","restore_auto","clear_threads","clear_files","domain","store_auto","dir_dled","oneshot","tn","img","post_idb","tn_idb","img_idb","webm_idb","live","deleted","IDB","prune","check_every","list_obj6","list_inherit","tar","tarsize","debug_mode","unread_count","parse_error","site2func","site2func_expand","pfunc","pfunc_expand","pfunc_all","pfunc_all_expand","pfunc_comp","pfunc_comp_expand_same","pfunc_comp_expand_diff","pfunc_comp_proto","test_mode","tips","num","num_f","test_str","js_file","patch","delayed_invoke","sec","rm_404_blacklist","pref2","summer_time","remove_history_class","easy","posts_ago","threads_ago","max_boards","easy2","reset","presets","time_post","time_op","basics","VB","local","global","LTfrom","limits","i","site","site2","nickname","pref_func","pref_overwrite","make_port_parent","win","initialize","e","console","log","window","data","source","RegExp","nicknames","join","test","embed_frame_win","whereami","indexOf","init_receive_port","ports","removeEventListener","init_func","send_message","messages_to_send","addEventListener","make_port_child","parent","postMessage","channel","MessageChannel","port1","port2","port","receive_func","receive_message","onmessage","start","close_connection","close","length","push","toString","substr","JSON","stringify","parse","marked_first_post","common_obj","mark_newer_posts","document","scrollTo","offsetTop","header_height","body","clientHeight","innerHeight","mark_posts_from_parent","http_req","remote","sub_get","sub_ack","sub_dest","prep_own_posts_event_received","site3","own_posts","catalog_obj","catalog_func","triage_exe_pipe","setTimeout","close_all","make_uip_tracker","uip_check","uip_tracker_id","uip_show","uip_auto_open","key","value","obj","parse_json_catalog","responseText","threads","j","no","uip_auto_open_check","threads_req_mutex","add_dom_event_listener","observer","observe","base_thread","pn","childList","remove_dom_event_listener","disconnect","threads_req","undefined","threads_opened","flag","open","make_url4","keys","get","url2","uip_show_2","uip_show_from_doc","uip_show_3","post_uip","tgt_post","uip_tgt_post","post_nums","uip_post_num","pn_uip","createElement","innerHTML","childNodes","setAttribute","pn_posts","insertBefore","appendChild","splice","from_http","waste_count","status","parse_json_thread","response","uips","last_updated","pn_test","pn_a","getElementsByTagName","tgt","textContent","k","date","toLocaleTimeString","post_hilight","posts_deleted","posts_no_new","posts_no","interval_pref","p0","uip_tracker_destroy","wrap_to_parse","myself","get_json_url_catalog","MutationObserver","uip_tracker_init","isthread","clearTimeout","make_thread_reader","add_event_to_submit","check_reply","remake_own_posts","get_my_posts_no","remove_event_from_submit","ignore_scroll","favicon_obj","favicon_obj_trim","target","site_live","th","parse_funcs","end","slice","concat","updated","new_posts","init","update_own_posts","favicon_check","document_body","scrollTop","ref_height_checked","shift","currentTarget","notifier","set","opener","retval","marked","triage_event","flds","split","parseInt","replace","triage_exe","com0","com1","get_checked_time","setup_submit","inst_submit","postform_submit","mems","get_flag","localStorage","my_posts","pn_name","parse_funcs_html","parentNode","createTextNode","nextSibling","add_you","event_submit","components","buttons","buttons_collection","onclick","common_func","modify_bookmark","pn_ref","embed_to","Triage","wheelpatch","add_hier","inst_submit2","postform_submit2","destroy","setup_submit2","thread_reader_init","make_catalog_obj","pn12_button","show_hide","make_catalog","scan_tags_common","ths","html_str","tags_obj","acc","cs","tags_th","tags","dbt","cnst","name2domainboardthread","tags_th_uniq","tag_test","toLowerCase","mem","scan_tags_common_b","tag_ref","n","sort","a","b","scan_tags_common_c","tags_tgt","str2","item","auto_hide_catalog","pn12_1","display","pn12_rollup_func","autorollup_state","window_beforeunload","onchange_funcs","catalog_resized","lastIndexOf","ago_clicked","time_in","filter_time_str","apply_prep","scan_tags_init","reload","pn_tag_list","pn_filter","onchange","prep_tag_str","keep","from_onchange","cbxes","filter_tags","checked","tgts","pn12_0_4","catalog_filter_changed","scan_boards","scan_init","cache_write","filter_tags_refresh_mem","remake_triage","off","remove_hier","pn12_triage","make_triage_entry","pn12_triage_all","embed_embed","triage_wheel","triage_str","position","onmouseover","triage_in","onmouseout","triage_out","format_tgt","set_trg","hide","preventDefault","evt","createEvent","initMouseEvent","type","canBubble","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","triage_parent","dispatchEvent","get_triaged_thread_name","triage_exe_0","args","tri_str_ex","tri_str_attr","hist","datetime","archiver","start_1","getFromName","changed","attr","catalog_attr_set","ex","catalog_filter_query","reorder_thread_idx","format_html","update","show_catalog","get_trg","format_buttons","click_thread","triage_history","arguments","search_ex_list","watch_list","millisec","wat_str","unwatch_explicitly","mark_read_thread","ex_str","at_str","at_obj","val_obj2","val_obj3","str2obj2","cmd","systemSticky","at_obj_keys","pop","undo_args","name_next","changed_next","set_watch_time","get_watch_time_of_a_thread","priority","trim_html","remove_files_info","remove_posts","format_thread_contents","format_thread_layout","format_thread_style","format_thread_always","trim_html_mark_time","get_mark_time","format_remove_tn_area_size","image_resize1_onload","image_resize","image_resize2_onload","insert_thread","date_load","picked_up_by_kwd_filter","preprocess_doc","insert_thread_from_native","type_data","adoptNode","importNode","init_new","tgt_th","time_bumped","time_created","nof_posts","nof_files","time_posted","needs_update","remove_thread","th_init","thread_in","func_in","func_pop_up","filename","type_html","domain_html","icon_sticky","icon_show_always","prep_tags","type_source","list_nup","add","posts_full","set_watch_time_thread","flag_posts_stored","has_posts","posts_active","catalog_filter_query_keyword","kwd_make_result","search_result","type_parse","t2h_page","get_t2h_num_of_posts","expand_posts","add_scan","update_posts_replace_prep","lth","pd","update_posts_merge_prep","insert_thread_prepare_html_lazy","lastUpdated","ed_p","set_watched_to_last","set_unwatch","from_lazy","prepare_html_prep_posts","prepare_html","ch","overflow","dom_addEventListener","click_thread_whole","dom_addAttribute","tn_as","click_thread_tn","tn_imgs","get_icon","add_icon","text","footer_new","prep_footer3","insert_footer3","insert_thread_format_html","force_prep_html","set_own_posts","update_posts_in_page","page_json2html3_replace_expander","get_t2h_index","links","get_thread_links","click_link","pref_env","prepare_html_post","q","idx_new_post","page_html","post_json2html","add_event","expand_now","expand_on_demand","expand_thumbnail_queue_add","call","dynamic_image_hover","image_hover_add","popups_add","update_draw","extra_format","ret_time","pop_up_delay","classList","footer_clear","footer_style","getAttribute","flags","nums2","str_nr","nrtm","nr","str_nl","ta","str_nd","watched","date_string","toLocaleDateString","Math","floor","update_tag_string","tag_node_onclick","removeChild","update_all_footers","re_sort_thread","odl","threads_idx","threads_index","insert","drawn_idx","idx_old","idx_new","expand_shrink_thread","show_catalog_hr","image_hover_prep","img_ex","clone_img","top","right","pointerEvents","divert","image_prefetched_instance","zIndex","image_hover_remove","script_body","priority_up","onload","priority_release","onerror","image_hover_instance","img_next","get_name_recursive","get_next_image","img_pf","image_hover_reentry","clone_img_make_src","inline_or_hover","from_initial","tgt_th16","post_html","img2src","get_op_src","cloneNode","ext","img2ext","controls","autoplay","loop","muted","maxWidth","innerWidth","maxHeight","image_expanding","expand_thumbnail_on_demand_set","tagName","expand_thumbnail_inline_load","opacity","play","previousSibling","shrink_thumbnail_inline","format_expanded_thumbnail","idx","get_now_height","expand_thumbnail_on_demand","get_ref_height","Array","isArray","nowHeight","ot","image_expand_on_demand_instance","show_catalog_cont","pnode","contains","url","open_new_thread","href","add_open_new_thread_event","elem","func","remove_open_new_thread_event","date_mark","merge_obj5","hit","fullname2dbt","name2dbt","short_link","as","window_name","cw","time_marked","read","update_ur","show_catalog_delayed","ref_heights","threshold","scroll_event_src","scopy_th","dst","threads_idx_debug","y","count","show_catalog_skip_hs","ref_count","c_len","class_hs","className","horizontal_separator_in_index","rollback_info","stl","filter_kwd_prep_init","str_old","fail_list","suc_list","filter_kwd_prep","kwd_prep_regexp","filter_kwd_active","val_old","basic_active","active","posts_search_inactivated","timestamp","filter_kwd_count","no_reset","catalog_filter_query_1","search_by_tags","pref3","catalog_filter_query_time_list","tgt_posts","catalog_attr_changed","pop_up_status","pop_up_op","pop_up_delay_id","pop_keep_event","documentElement","clientWidth","left","bottom","modify_thread_link","pn_result","page_json2html3","op_img_url","format_pn","root_body","offsetWidth","offsetHeight","pop_down_event","chart_obj","PostChart","pop_down_op","div_destroy","prep_reserved_tags","tags_reserved_init","make_refresh_list","str2obj","blist","domains","domains_for_all_boards","boards","callback","get_boards_json","health_indicator","bds_picked_up_by_tags","bd","max_page_bd","pgs","max_page","trim_list","embed_init","bds","selectedIndex","remove_threads_events","dom_removeEventListener","ref","popups","popups_release","catalog_obj2","func_hide","catalog_clear_threads_candidates_of_deletion","schedule","threads_candidates_of_deletion","catalog_clear_threads","off_delay","catalog_refresh","from_auto","refresh_start","result","catalog_refresh_1","scan_name","get_board_list","register_auto_acquisition","scan_refresh","catalog_refresh_end","th_count","d","tags_ci","insert_myself","scan_boards_keyword_callback2","native_prep","found_threads","found_board","scanned","ext_posts","insert_myself_init_flag","catalog_insert","crawler_max","tgt_raw","rm_items_404_check","db","flag_item","list_obj3","attr_list_obj3","watch_list_obj3","nos","rm_items_404","rm_404","clean_list_all","LS_synced","clean_up_LS","comment_out_bookmark","comment_out_key","rep_str","styleSheet","sw_cache","subscribe","initialize_loop","pn12_whole","pn12","bottom_top","pn12_0","id","pn12_0_2","add_to_tb","icons","auto_shrink_board_selector","setup","pn12_0_2_childs","mouseover","show_tooltip","stat","prog","prog_str","found_boards","cancel_button","html","initiator","err_str","abort_str","show_1","tooltip_func","mouseout","cancel_scan","scan_abort","disp","his","shrink_running","elems","HealthIndicator","pn_countdown","pn_hi","prototype","col","remove_from_parent","HealthIndicatorElement","firstChild","show_tooltip_delayed","DelayBuffer","bind","get_binded_delayed_do","remove","report","error_obj","format_html_str","html_funcs","rollup_radio","make_sel","catalog_native_frame_prep","hide_target","add_root","pn12_0_4_selectors","auto_shrink_selector","catalog_board_list_sel_old","oninput_funcs","catalog.filter.kwd.str","pn_use","catalog.filter.list_str","time_filter_changed","catalog.filter.attr_list_str","catalog.filter.tag_search.str","filter_onchange","toggleButton","pn_setting","timer_tgt","blur","catalog.indexing","*.auto_update","*.auto_update_period","getItem","load_save_key","pf","save_str","obj_elim_the_same","setItem","load_default","row_obj","catalog.filter.kwd.use","catalog.filter.kwd.match","catalog.filter.kwd.re","catalog.filter.kwd.ci","catalog.filter.kwd.sentence","catalog.filter.kwd.op","catalog.filter.kwd.sub","catalog.filter.kwd.name","catalog.filter.kwd.file","catalog.filter.kwd.com","catalog.filter.kwd.trip","catalog.filter.kwd.meta","catalog.filter.kwd.post","scanBoard","pref_def","mirror_targets","pn13_1","catalog.filter.tag","catalog.filter.time","catalog.filter.time_creation","catalog.filter.time_str","catalog.filter.list","catalog.filter.watch_list_str","catalog.filter.attr_list","keyword_load_1","scanSite","keyword_load","catalog.order.reply_to_me","catalog.order.reply","catalog.order.watch","catalog.order.sticky","catalog.filter.time_quick_sel","catalog.filter.tag_search.re","add_onchange_format","add_onchange","event_func","prep_own_posts_event","make_own_posts","catalog_get_native_area","tags_scan_regex","scan_boards_check_pre","indicator","watchdog","abort","callback_args","scan_boards_init","pool","div","parser","DOMParser","doc","wrapper_obj","senders_returned","tgts_iterator","sb","scan_boards_keyword_make_tgt","insert_odl","func_old","release","spawn","next","force_json","u","scan_boards_keyword","sender","report_alive","check_priority","issued","spawn_req","finish","store_tag","ret_obj","finish_all","clear_req","threads_meguca","got_200_board","parse_options","localArchive","tgt_pn","from_catalog","filter_active_kwd","filter_active_tag","in","tgt_th_meguca","post_updated_static","has_editing","time_loaded","got_200","scan_tag","innerText","tag_updated","post_updated","ed_t","update_tags_in_editing_posts","posts_obj","editing","waiting","popups_fetched","dont_have_com","check","time_check_old","rescan_dp","force_ar","missing_info","pick_up_for_search","picked_up_by_tag_filter","picked_up_by_filter","tgt_th_status","force_update","tgt_th8","show_catalog_scroll_lock","appeared","tag_scan_board","f","get_max_page","raise_odl","rm_404_1","got_404","ths_tag","wdg_spawn","stop","sbs","wdg","restart","respawn","priority_wdg","priority_count","Watchdog","stop_if_running","timer","countdown","time_remains","from_refresh_button","period","catalog_get_native_scroll_area","trg","format_funcs","WATCH","UNWATCH","SHOW","UNSHOW","STICKY","UNSTICKY","ARC","ARC1","UARC","on_off","change_mode","db_thread_out","triaged_pn","triaged_name","db_triage_off","delayed_do","thread_out_delayed","offsetLeft","scrollLeft","triage_off","thread_out","trg_new","prepare_html_extract_params","extracted","prep_mimic","mimic","mimic_tgt","tmp_pn","catalog_json2html3","defineProperty","writable","enumerable","configurable","remove_by_tagname","toplevel_anchor","absolute_link","thq","get_t2h_from_index","update_posts_replace","update_posts_merge_base","replace_posts_by_search","th_new","update_posts0_class","adrawn_idx","mark_time","Infinity","get_threads_odl_default","8","threads_odl_default","get_tgt_th","kwd_odl","threads_odl","check_sub","check_func","check_funcs","watch_last","watch_first","sticky_last","sticky_first","indexing2","get_date","kwd_odldb","delete_odl","19","show_catalog_init_funcs","tgt_lock_calcel","marks","scroll_back","mark_top","abs_top","wdg2","last_viewed","general_event_handler","get_last_viewed","modified","get_mark_from_height","clear_last_viewed","debug_str2","drawn_y","drawn_ref_count","catalog_obj2_proto","tgts_in","debug_str","permit_draw_on_demand","draw_adaptive","draw_count","show_catalog_db_th20","triage_thread","ref_count_init","load_tgt","i_start","show_catalog_db_th100","func_show","ref_step","d_count","tgt_bt","getElementsByClassName","debug_str4","debug_str3","base_name","func_show_hide","show_or_hide","update_posts_prep_merge","update_posts_insert_merge","update_posts_remove","time_merged","hr","mutex","release_draw","query_1","rexp","query_11","DUMMY","pst","type_com","pn_com","txt","post_com2txt","extra_files","all_or_any","testval","kwd_1","match_or_unmatch","catalog_frame_prep","catalog_native_prep","valid","get_mark","last_Y","border","change","class_expander","scan_ui","geh","subscribers","add_mouseover","remove_root","get_threads","catalog_liveTag_scan_site","make_chart_obj","pn1","make_new_chart","charts","events_beforeunload","window_focus","window_blur","foreach","chart_posts","destroy_all","chart_data_init","labels","datasets","chart_data_init_1","label","color","alpha","fillColor","strokeColor","pointColor","pointStrokeColor","pointHighlightFill","pointHighlightStroke","time_unit_sel_html","chart_options_str","pn_popup","deep_copy","pn_canvas_root","pn2_obj","init3","this_obj","pn2_template","pn2","pn2_settings","pns","pn_board_sel","pn_canvas","chart_size_changed","legend","func_str","set_legend_str","append_legend","Stats","get_tgts","onchange_entry","toggle_settings","board_sel_changed","tgts_changed","len_changed","replace_data","data_src","chart_redraw","data_graph","dd","fN","fromNo","dr","rm","ds","layer","idxs","data_l","merge_1","data_p","data_p_old","data_t","data_t_old","scale_setup","arr_dec_slice","idx_last","data_np","clip_np_func","scale_thread_old","ctx","getContext","Chart","Line","dec","arr","old","scale_changed","points","unsubscribe","update_data2","removeData","addData","tgt_p","tgt_t","tgt_ep","tgt_et","tgt_np","min_idx","remove_legend","rolldown","rollup","maximize","maximize_embed_style_pn","maximize_embed_style_pnch1","maximize_float_style_pnch1","exit","target_hier","get_tgt","prop","separate","time_unit_changed","clear","dump","data_update","make_setting_obj","pn8","pn7","prep_pn7","make","pref_apply_prep","pn7_1","timer_obj","wafd","workaround_for_dollchan_pref_changed","button_action","obj_init","pref_samples","site2_json","site2_eval","void_func","fm","make_listener","listen_event","newValue","pipe_name","tmp","JSON_parse","value_old","show_page","make_timer_obj","pn0","property_changed","timer_obj2","make_timer","stop_destroy","pn0_str","finished","get_time","page_check5","page_no","page_check4","parseFromString","time_stamp","ops","get_ops","str_set","str_get","prep_next","func0_exe","page_check2","get_nos","all_got","increase_posts","last_post_old","last_post","num_of_new_threads","found","isNaN","timestr","step","missing","tgt_doc","flag_set","get_last_post","last_ops_old","last_op","get_posts","str_place","location","thread_keyword","req_events","req","dead","info_raw","get_page","send","page_check3","checking","page_check","timer_restart","force","interval_old","timer_stop","setInterval","clearInterval","XMLHttpRequest","interval_missing","retry_count","retry_limit","make_wafd","on_change_workaround_for_dollchan","exe","on_change_workaround_for_dollchan_2","getElementById","open_spoiler","inputs","files","grand_parent","align","initUIEvent","thumbnails_parent","show_thumbnails","rule","styleSheets","cssRules","selectorText","spoiler_org","cssText","make_post_form_obj","pn9","postform_activation","hidden_elements","pn10","lastChild","postform_comment","focus","pn10_2","on_change_redirection","func0_prep","postform_rules","pn11","make_iframe","submits","targets","forms","forms_post","method","posted","make_debug_obj","pn_debug_button","disabled","post_form_obj","self","navigator","userAgent","Date_parse","mousewheel","do_tgt","hasFocus","reload_required","oninput","working","propagate","mirror","make_obj","fm_tmp","query_str","querySelectorAll","apply_prep_2","parseFloat","str2obj4","str2obj6","str2obj5","apply_prep_2_str","v","toUpperCase","sessionStorage","t2h_sel:L","t2h_sel:M","t2h_sel:N","t2h_sel:N_unread","t2h_sel:unread","posts_search_op:opaque","popup2:sr","popup2:srpv","popup2:pv","popup2:chart","popup2:dp","catalog_board_list_str_or","catalog_board_list_str_bt","catalog_board_list_str_bt_same","func_obj","func_obj2","set_event_target","add_onchange_entry_func","prep_beforeunload","inst_while_input","set_val_beforeunload","tgt_wrapped","bg_str","boards_sel_from_tags","or","get_owners_recommendation","lines","bn","fields","cmds","dm","exact","set_vals","vals_in","completion","vals","obj2_only","key3","tgt3","style2obj","coms","merge_obj5_all","merge_obj5_1","merge_obj5a","merge_obj5_1a","obj_key","obj_hier","obj_init_hier","not_root","site2_json_ex_remove","pref_test","site2_json_ex","full","strict","pref_query","query","disable_others","disable_site3","pn_out","getElementsByName","ex_count","str_out","eval","all","hasAttribute","hasOwnProperty","str_tooltip","str_hier","info_tips","kind_of_tips","tooltip","hide_timer","tooltip_on","show_timer","show_exe","hide_exe","root","fontWeight","catalog.filter.tag_list","liveTag.rm_list_str","TagExLists","liveTag.ex_list_str","GeneralRules","catalog.style_general_list_str","catalog.board.recommendation","thread_reader.buttons.B","thread_reader.buttons.UB","thread_reader.buttons.X","thread_reader.buttons.v","virtualBoard.scan_domains.*","style.fix.*","style.copy.*","dummy","#*","simple","backwash","recommend","easy2.presets","vb_kwd","easy2.limits","easy.virtualBoard_10_passive","easy.virtualBoard_10","easy.virtualBoard_1","easy.virtualBoard_8_50","easy.virtualBoard_8_all","easy.virtualBoard_interSite","easy.posts_0h","easy.posts_24h","easy.threads_24h","easy.embed_index","easy.embed_index_lazy","easy.light","easy.embed_index_infinite","easy.embed_index_backwash","easy.stat_activate","triage_simple_kill","triage_simple","triage_basic","triage_basic_color","triage_colorful","triage_borders","triage_samples","triage_test","pn_samples","make_popup","onclick_event","get_name","names","pn13","pos","pn13_0_2","onchange_funcs_formatted","files_store","apply_pn13_1","insert_menu","menu","htmls","show_hide_all_to_header","show_hide_all","str_show","str_hide","str_inner","expand_thumbnail_1","expand_thumbnail_hover","op_in_search_result","deleted_posts_detection","radios","indent","sep_h","header","middler","trailer","inner","format_posts","updates","vb_domains","sites","get_domains","unshift","html_common","tag_gen","SHOWALL","TOGGLE","forEach","HIDEALL","HIDE","dst_dom","tgt_dom","SHOW2","TOGGLE2","HIDE2","SHOW3","HIDE3","SHOW2_I","SUB","uip_tracker.on","healthIndicator.show","healthIndicator.expand_running","settings.indexing","pn13_1_warning_reload","pn13_1_warning","tag.scan","tag.same_tag_refresh","tag.generate_caller","domain_url","tag.generate_callback","arg","tag.re_generate","uri","m","tag.gen","str_name","tag.gen_add","tag.recommendation_add","tag.add_to_list","board_sel_refresh","str_changed","stats.use","stats.estimate_posts","stats.auto_acquisition","stats.auto_acquisition_all","catalog.board.board_tags","catalog.board.all_boards","JSON_query","JSON_ex","JSON_ex_full","JSON_ex_filter","EVAL","nodes","load_default_of_this_page","load_samples","triage.hide_toggle","catalog.footer.*","thread_reader.use","catalog.appearance.titleBar.settings","catalog.appearance.titleBar.refresh","catalog.appearance.titleBar.num_of_pages","catalog.appearance.titleBar.boards_selector","catalog.appearance.titleBar.filter","catalog.click_area","make_rule_click_area","style.sel","styles_changed","style.fix.titleBar_str","style.fix.window_str","style.fix.popUp_str","style.copy.titleBar_str","style.copy.window_str","style.copy.popUp_str","style.fix.reset","style.copy.reset","virtualBoard.p_board","update_boardlist","virtualBoard.p_remove","virtualBoard.max","virtualBoard.show","easy.virtualBoard_8_100","easy.virtualBoard_8_500","easy2.beginner","easy2.apply","force_reset","virtualBoard.scanStart","virtualBoard.scanStop","virtualBoard.search.show","boardlist","tgt_name","bar","size","update_pn","virtualBoard.search.str","debug_site2","debug_site2func","debug_pfunc","debug_parse_funcs_entry","debug_pfunc_comp","debug_pfunc_all","debug_parse_funcs_all","ex_list_changed","liveTag.inherit_board_name","inherit_board_name_changed","liveTag.inherit_board_tags","inherit_board_tags_changed","page.mark_new_posts","recovery.comment","*.open_spoiler_text","*.scroll_lock","button_test","*.posts_search_op","register","*.posts_search_op_opacity","style.post_editing","archive.restore","imgs","restore_entry","archive.dir","archive.json","archive.clear_files_button","doms","dom_new","archive.start","store_entry","archive.oneshot","archive.kwd.*","test_mode.js_load","URL","createObjectURL","scr","bind_myself","p1","replace_rule","rule_str","ss","deleteRule","insertRule","make_styles","rules","rules_str","doc_rules","trim_rules","add_to_watch","dummy_add","attributes","dummy_remove","desc","spoiler_text","spoiler","spoiler_open","sText","open_rule","selector","registry","head","sheet","overwrite_prop","fill","c","ary","dom","NONE","ATTR","KILL","TIME","UNDO","GO","toggles","triage_style_replace_list","triage_button","triage_styles","style_str","onmousewheel","perf_out","performance","last_ts","debug_show_proto_func_pool","debug_show_proto","ex_keys","search_key","expand","debug_parse_funcs","pool_0","dp","start_point","proto_org","pool_1","same","types","srcs","objs","s","src_type","strs","idx_s","hier_str","root_str","obj_root","funcs","init_set_style","shallow_copy_1","w","h","nw","naturalWidth","nh","naturalHeight","fw","fh","escape","entities","<",">","&","\"","'","escape_text","autosage","board_name","url_prefix","url_prefix2","server_name","protocol","catalog_threads_in_page","remove_checkboxes","get_time_of_last_post","query_set_component","query_word","comp","querySelector","config","keyword","url_site","url_board","decodeURI","owners_recommendation","root_body2","home","postform_prep","postform_submit2_observer","postform_submit2_find","setup2","catalog_root","getElementByTagName","now_height","get_time_of_posts","get_time_of_post_in_utc","url_boards_json","get_boards_json_indicator","callback_always","boards_json","get_boards_json_callback","postprocess_board","update_pn_buf","o","pages","postprocess_board_add_btag","show_boardlist_boards","show_boardlist_physical_board","func_onclick","show_boardlist_physical_extract_func","boardlist_hit","show_boardlist","sbl","absolute_link_1","ls_key_own_posts","prep_own_posts_1","prep_own_posts","bt","clean_up_LS_th","ls_key_deletedPosts","ls_key_comment","clean_up","clean_up_deleted_posts_1","ls_key","ls_key_bd","add_name","to_me","regexp_anchor_txt_1","own_posts_cb","regexp_anchor_cb_txt_1","check_1","extracted_tags","extracted_posts","of_mine","reply_of_mine","anchors","regexp_anchor","regexp_anchor_len","regexp_anchor_cb","check_t1","com_or_txt","mail","pn_tags","str_rm_list","scan_regex","tag_ex_list","prep_check_1","regexp_anchor_txt","regexp_anchor_cb_txt","regexp_anchor_com","regexp_anchor_cb_com","prep_check_t1","check_t1_op","tag_init","time_check","watchtime_changed","omitted_posts","time_unit","ur_old","generate_ur","watching","extract_tags","ur","aggregate","get_post_offsetTop","time_revised_check","nof_ths","style_mark","style_unmark","class_or_tag","unmark","mark","unmark_post_from_event","thq_no","deleted_after","preprocess_html","doc_txt","check_thread_archived","get_board_tags","depend_on_site","insert_remove_frame","ifrm","disgorge_children","pn_catalog","absorb_children","catalog_native_frame_prep_frame","ref_node","margin","contentWindow","catalog_embed_prep","thread2search_obj","popups_op_func_set","popups_op_func_use","popup_info","popups_post_entry","out","th_q","popups_href2th_q","node","func_out","isOP","borderStyle","boxShadow","popups_debug","popups_href2dbtp","hrefs","activate","posts_exist","post_no","popups_add_1","popups_link_regex","quote","op_regexp","quotes","as_txt","a_class","backlink_class","lthq_no","popups_add_backlink","popups_set","popups_set_waiting","backlinks","add_backlinks","popups_remove_backlink","remove_if_no_backlinks","popups_remove_waiting","th_key","popups_fetched_html","proto_obj","d_str","th_no","link_dbtp2href","get_getters","site4","parse_funcs_on_demand_debug","parse_funcs_on_demand","prep_pfunc","key_table","pfunc_root","mimic_always","th_regexp","doc_obj","parse_obj","parse_pn_dummy","finisher","catalog_json2html3_thumbnail","ths_array","ths_col","get_lth_from_node","catalog_html","exlist","exe_sub","exe_sub2","fname","tim","posts_array","pts","idx0","idx1","get0","posts_get0","get1","posts_get1","insert_footer4","html_org","replace_omitted_info","replace_omitted_info2","page_json","thread_html","thread_json","email","replies","images","has_nof_files","prep_to_archive","post_json","catalog_json_template","page_json_template","thread_json_template","post_json_template","parse_parts","add_op_img_url","posts_m","by_no","posts_ret","posts_old","first_no","th_old","info_old","get_omitted_info","info_new","page_json2html3_add_omitted_info","set_omitted_info","update_posts_add","update_posts_1","update_posts_insert","src0_pn","time_tu","post_json2html_fname_server","post_json2html_fname","container","remove_by_classname","classname","remove_br","tagname","remove_by_attribute","attr_name","attr_val","remove_attribute","removeAttribute","add_attribute_by_classname","add_attribute_by_tagname","add_attribute_by_attribute","attr_name2","attr_val2","move_up_and_delete_parent","g_parent","remove_last_hrs_and_brs","last_node","remove_brs","remove_double_br","outerHTML","remove_double_tags","change_utc_to_local","utc_str","tb_prep_for_embed","tb","draggable","ondblclick","parse_funcs_getters","parse_funcs_no_cache","parse_funcs_one_time","trace","read_max","frame_menu","frame_main","preprocess_doc2","before_test","after_test","full_hier","mixs","pn_child","catalog_native_size","filenames","spans","postform_comment2","et_tagName","op_containers","substring","kind","del_tgt","icon","get_favicon","none","get_title","times","file_style","blotter","or_str","aggregate_info","op_idx","subs","files_in_post","uids","nof_uids","unique_ips","pn_tb","embed_catalog","node_ref","selector_native","catalog_native_size_changed","pn_tb_new","pctrls","selector_catchan","last_modified","omitted_images","before_test_post","entry","om_info","op_img_url2","fsize","tn_w","tn_h","txt2com_spoiler_replace_txt","update_posts_insert_pack","ref_pnode","post_container","update_posts_insert_unpack","update_posts_insert_pack_iter","prev","prev_prev","fchild","bks","dbtp","blk","backlink_onclick","highlightReply","bg_r","bg_g","bg_b","post_pn","kwd_head","kwd_tail","capcode","country","country_name","toISOString","post_json2html_file","multifile","fsize_str","fname_server","furl","catalog_json2html3_src","turl","url2file","thumb_url","assign_pn","omit_info","expander","config_expander","nof_files_omitted","nof_posts_omitted","catalog_from_json3","force_https","max_page_kc","main","navigation","/int/","/b/","/trv/","/m/","divs","time_offset","postdates","offsetParent","trim","filename_server","balls","ball","ft","html_file","update_posts_insert_1","ref_pnode2","post_flag","tns","catalog_json2html3_onload","catalog_posts_in_thread","trim_page","post_containers","link","filethumbs","prep_own_posts_reg","getComputedStyle","qf","qf2","clear_func","catalog_native_prep_clonenode","deep","cn","catalog_json2html3_size_changed","ts","class_thread","class_thumbnail","last_replies","bumplimit","txt2com_anchor_class","backlink_parent_class","backlink_parent_prevSib","blk2","op_no","tn_f","file_html","md5","th_w","page_json2html3_add_expander","th_url","th_class_tn","th_class","getPrototypeOf","image","imgnm","subject","anchor_regex","anchor_func","dims","ar","imgctr","time_node","catalog_native_prep_wait_loop_timeout","catalog_native_prep_wait_loop","ctlg","search2","SHA1","fileType","no_in","postCtr","replyTime","bumpTime","imageCtr","arrow","anchor_class","command2txt","c2t_count","spoiler_replace_txt","commands","previousElementSibling","backgroundColor","max_page_futaba","may/b/","jun/b/","dec/b/","responds","format_thread","getOwnPropertyDescriptor","tgt_obj","SharedWorker","make_beep","header_prep_monaural8","header_add","big_endian","wav_str","dl","header_size","data_prep_monaural8","freq","vol","pi2","sin","audio","Audio","make_beep_play","src_changed","pause","favicon_set","favicon_next","favicon_current","sum","CountNR","sum_sub","title_set","title_current","title_org","Notification","get_permission","permission","requestPermission","dtns","dtns_queue","show_1_queued","show_1_queued_delayed","dtn","win_focus","close_1","tgt_th19_4","sound_flag","dt","new_therad","cf_error","get_make_Req","reqs","Req","destroy_httpd","iframes","onload_from_sw_cache_check","onload_text","get_req","from_cache","data_type","onload_local","value_sw_cache","serializer","serializeToString","callback_arg","trygetItem","httpd","responseType","XMLSerializer","onabort","sw_cache_write","increase","maximize_state","state_str","state_arr","state_old_str","maximize_state_str","div_dragstart","drag_sx","drag_sy","dataTransfer","setData","effectAllowed","dropEffect","stopPropagation","div_dragend_caller","div_dragend","div_dragover","dragend","div_scroll","wheelDelta","tile","last_pn","pn_st","init2","rolldown_func","rollup_func","exit_func","maximize_func","site_settings","options_is_given","padding","rollup_func_tb","cursor","background","event_funcs","dragstart","tile_set_bottom","tile_set_left","child_of_body","pn_2","pn3","hour","getHours","min","getMinutes","getSeconds","make_destroy","func_make","func_destroy","onchange_func","prep","onblur","query_auto_acquisition","sels","onfocus","opts","make_opts","setting_obj","cnst_obj","pn12_str","pn_board","pk","prep_domain","prep_board","btag","ref_tag","update_tags_in_th_sub","prep_thread","1","2","0","btags","tl","btag2","time_checked","inherit_board_tags_changed_1","retag","retag_db","retag_in_th_sub","tags_len","exclude_tags","delete_tags","key_dirty_creation","key_dirty","tags_array_old","tags_proto","mems_keys_obj","mems_keys","mems_keys_length","mems_keys_length_and_set_top","mems_boards","keys_fix","clean","k_ci","mems_map","Map","has","me","tags_reserved","tags_reserved_found_scan","tags_reserved_found","delete","update_tags_in_th","src_new","src_old","check_update_tags_color","remove_tags_in_th","thread_removed","clean_list","buffered_deletion","update_ur_1","delete_tags_buffered_list","Set","keys_tags","tags_ci_obj","delete_tags_buffered","update_tag_node","suffix","make_info","myDomain","boardlist_click_entry","cbx_changed","nth","all_case","mems_objs","count_ur","nof_th","counter","nof_bds","nums","tag_onmouseover","no_scan","node_in_boardlist","cbx_onchange","in_old","pref_obj","func_pk","add_board","bds_pickup","tag_pk","update_pn_last_filter_active","sort_func","update_pn_disp_func","from_filter","cbx_onchange_entry","tags_array","dirty_count","dirty_count_deleted","historical_filter_active","docfrag","createDocumentFragment","pos_insert","key_ci","dirty","tag_obj","tags_old","prep_deleted_posts","check_op","tag_idx","tags_b","retag_editing","retag_editing_noexe","ex_tags_keep","t0","tag_1","tags_boardlist","force_redraw","search_valid","update_boardlist_1","buf","update_tag_node_1","color_tag_node","sep","func_click","pn_1","IDBRequest_onerror","db_info","last_closed","IDBRequest_onblocked","oldVersion","newVersion","IDBTransaction_onabort","error","webkitStorageInfo","queryUsageAndQuota","TEMPORARY","IDBTransaction_onerror","IDBRequest_onupgradeneeded","onsuccess","IDBRequest_onsuccess_open","from_upgrade","version","reqs_vc","reqs_rw","debug_coms","map","tr_count","tr","transaction","objectStoreNames","re_req","make_1","IDBRequest_close","delete_th_1","req_end","loop_func","complete_func","req_1","put_1","delete_1","check_cleaned","reqs_re","open_db","tr_inc","deleteObjectStore","tr_set","func_prev","oncomplete","createObjectStore","objectStore","put","store_json_func","clean_1","clean_1_onsuccess_prune","clean_1_onsuccess","db_name","req_obj","ver","indexedDB","onupgradeneeded","onblocked","sums","store_posts","content","set_timestamp","download_url3","Blob","blob","add_blob","download_url4","download_url","revokeObjectURL","a_link","month","download_url2","reqs_in","xhrs","xhr","download_url2_1_onload","download_url2_1","list_all_obj_downloading","responseURL","to_file","to_idb","flush_all","img_dl","restore","th_obj","archive_no","list_all","list_all_obj","tgt_tmp","load_list","ls_key_archive","save_list","make_header","Uint8Array","encode_filename","set_header","checksum","numstr","charCodeAt","encodeURIComponent","tars","tarfile","tfile","flush","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","flush_req","sanitize","wlist","A","SPAN","DIV","BLOCKQUOTE","BR","WBR","U","S","STRIKE","B","I","BIG","SMALL","TT","SUP","EM","STRONG","string","list_all_obj_bd","check_archived_time","update_archived_time","downloaded_files","store_th_to_mem","posts_saved","last_no","check_deleted_posts","thp","othp","post_deleted","othpd","deleted_before","posts_wrapped","storage","posts_new","deletedPosts","live_active","oneshot_active","suffix_dbt","posts_all","store_rescan","posts_src","fileReader","FileReader","readAsText","th_deleted","com_changed","delayed_check","check_com","com_new","delayed_save","save_at_exit","rec_inst","key_old","rec_inst2","get_key","get_highest_priority","key_pre","scanner","Scanner","scanners","force_thread","get_th","scan_threads_delayed_do","priority_th","get_list_thread","req_th","get_list_thread2","get_list_board","get_list_board2","add_domain","use_boards_json","upper_bits","scan_boards_enumerate","func_entry","func_scan","func_cont","aborted","priority_next","key_next","ScannerUI","queue","scan_refresh_ex_list","scan_refresh_1","update_thread","tree_404","sr","update_board_rm","thread_created","instances","tgts_obj2","check_and_add_thread","ldb","setup_board_no","time_unit_arr","update_posts_no_1","update_posts_rm_1_func","srt","update_posts_no_time","ldbst","idx_over","time_now","time_base","shift_add","update_posts_no_1_func","update_posts_no","lths","get_ac_key","auto_acquisition_beforeunload","auto_acquisition_keys","auto_acquisition_init","label_funcs","day","sunday","quarter_year","time_root","draw","wdg_tick","prep_time","StatsFromNo","save_all_unsubscribe","merge_1_hier","lower","ceil","merge_1_hier_1","idx_d","from_destructor","chart_bak","data_lower","prep_thread_unsubscribe","prep_board_unsubscribe","Zcompress","Zdecompress","get_ls_key","data_save","prep_board_check_valid","time_last","array_init","skip_init","prep_thread_subscribe","StatsRm","tz_offset","label_init","lfunc","distance","tree","func_t","prep_1","ld","prep_thread_init","ldbt","check_only","rm_tmp","prep_board_init","from_thread","update_thread_1","StatsRm_prototype","prep_board_init_1","ldbs","offset","StatsFromNo_prototype","prep_board_subscribe","new_vals","data_last","idx_in","tu","pn_debug","prep_sw","blobURL","script","key_ls","worker","unsafeWindow","sw_out","sw_tryget","sw_alive","tryget_ids","callbacks","tryget_timeout","schedule_post","cd_id","cd_id_s","sel_id","time_val","time_at_post","setHours","countdown_m","cd_txt","set_background_and_button_value","time_till_post","countdown_post","round","countdown_s","cd_s","autobumper","bg_back","tb_0","timer_deadtime","posts_itt"],"mappings":"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","file":"CatChan.user.js","sourcesContent":["// ==UserScript==\r\n// @name CatChan\r\n// @version 2016.10.16.3\r\n// @description Cross domain catalog for imageboards\r\n// @include http*://*krautchan.net/*\r\n// @include http*://boards.4chan.org/*\r\n// @include http://*.2chan.net/*\r\n// @include http*://8chan.co/*\r\n// @include http*://8ch.net/*\r\n// @include http*://lainchan.org/*\r\n// @include http*://meguca.org/*\r\n// @require https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.1-beta.4/Chart.min.js\r\n// @updateURL https://raw.github.com/Dogman8/CatChan/master/CatChan.meta.js\r\n// @grant unsafeWindow\r\n// ==/UserScript==\r\n//\r\n//    Copyright 2014 DogMan8\r\n//\r\n//    This program is free software: you can redistribute it and/or modify\r\n//    it under the terms of the GNU General Public License as published by\r\n//    the Free Software Foundation, version 3 of the License.\r\n//\r\n//    This program is distributed in the hope that it will be useful,\r\n//    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n//    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n//    GNU General Public License for more details.\r\n//\r\n//    You should have received a copy of the GNU General Public License\r\n//    along with this program.  If not, see <http://www.gnu.org/licenses/>.\r\n//\r\n\r\n\r\n(function (){\r\n//  if (window.top != window.self) return; //don't run on frames or iframes\r\n//if (window.top != window.self && window.name!='KC' && window.name!='4chan' && window.name!='8chan') return; //don't run on frames or iframes\r\nif (window.top != window.self && window.name==='') return; //don't run on frames or iframes\r\n\r\n\r\n\r\n\r\n//  http://stackoverflow.com/questions/9791489/greasemonkey-require-does-not-work-in-chrome\r\n//  http://stackoverflow.com/questions/2246901/how-can-i-use-jquery-in-greasemonkey-scripts-in-google-chrome\r\n//  http://stackoverflow.com/questions/17341122/link-and-execute-external-javascript-file-hosted-on-github\r\n\r\n  var brwsr = {\r\n    ff: (navigator.userAgent.indexOf(\"Firefox\") != -1),\r\n    sw_cache: true,\r\n    JSON_parse: function(val){ // patch for Tampermonkey.\r\n                       var retval = JSON.parse(val);\r\n//                       if (GM_setValue)\r\n//                       if (typeof(retval)==='object')\r\n//                       for (var i in retval) if (typeof(retval[i])==='string' && retval[i].startsWith('[') && retval[i].endsWith(']')) retval[i] = brwsr.JSON_parse(retval[i]);}\r\n                       for (var i in retval) if (typeof(retval[i])==='string' && retval[i].search(/^\\[.*\\]$/)!=-1) retval[i] = brwsr.JSON_parse(retval[i]);\r\n                       return retval;\r\n                     },\r\n  };\r\n  brwsr.innerText  = (!brwsr.ff)? 'innerText' : 'textContent';\r\n  brwsr.Date_parse = (!brwsr.ff)? Date.parse : function(str){return Date.parse(str.replace(/ /,'T'));};\r\n  brwsr.document_body = (!brwsr.ff)? document.body : document.documentElement;\r\n  brwsr.mousewheel = (!brwsr.ff)? 'mousewheel' : 'DOMMouseScroll';\r\n\r\n  var DelayBuffer = function(tgt, delay){\r\n    this.tgt = tgt;\r\n    this.delay = delay;\r\n    this.id = null;\r\n  };\r\n  DelayBuffer.prototype = {\r\n//    constructor: DelayBuffer,\r\n    do_tgt: function(){this.id = null; this.tgt();}, \r\n    delayed_do: function(delay){\r\n      if (this.id===null) {\r\n        if (delay===undefined) delay = this.delay;\r\n        this.id = setTimeout(this.do_tgt.bind(this),\r\n                             (typeof(delay)==='number')? delay : (this.hasFocus)? delay.fg : delay.bg);\r\n      }\r\n    },\r\n    cancel: function(){if (this.id!==null) {clearTimeout(this.id);this.id=null;}},\r\n    get_binded_delayed_do: function(){return this.delayed_do.bind(this);},\r\n    hasFocus: true\r\n  };\r\n \r\n  var Watchdog = function(tgt, delay){\r\n    DelayBuffer.call(this, tgt, delay);\r\n  };\r\n  Watchdog.prototype = {\r\n//    constructor: Watchdog,\r\n    start: function(delay){this.delayed_do(delay);},\r\n    stop: function(){this.cancel();},\r\n    restart: function(delay){this.cancel();this.delayed_do(delay);},\r\n    __proto__: DelayBuffer.prototype\r\n  };\r\n\r\n////  var MutexWatchdog = function(name){ // watchdog for 8chan's unstability. // working code, @safe1069\r\n////    this.mutex = true;\r\n////    this.req = false;\r\n////    this.name = name;\r\n////    this.abort_req = false;\r\n////    this.wdg = new Watchdog(this.fire.bind(this), 30000);\r\n//////    this.wdg = new DelayBuffer(function(){ // working code.\r\n//////      this.mutex = true;\r\n//////      if (pref.debug_mode['7']) console.log('watchdog: '+this.name);}.bind(this), 30000);\r\n////  }\r\n////  MutexWatchdog.prototype = {\r\n////    get: function(){\r\n////      if (this.mutex && !this.abort_req) {\r\n////        this.mutex = false;\r\n////        this.wdg.start();\r\n////        if (pref.debug_mode['5']) console.log('mutex: get: '+this.name);\r\n////        this.req = false;\r\n////        return true;\r\n////      } else {\r\n////        if (!this.abort_req) this.req = true;\r\n////        if (pref.debug_mode['5']) console.log('mutex: fail: '+this.name);\r\n////        this.abort_req = false;\r\n////        return false;\r\n////      }\r\n////    },\r\n////    restart: function(delay){\r\n////      this.wdg.restart(delay);\r\n////    },\r\n////    stop: function(){\r\n////      this.wdg.stop();\r\n////      this.mutex = true;\r\n////      if (pref.debug_mode['5']) console.log('mutex: release: '+this.name);\r\n////    },\r\n////    fire: function(){\r\n////      this.mutex = true;\r\n////      cataLog.scan_boards.scan_abort(this.name);\r\n////      if (pref.debug_mode['7']) console.log('watchdog: '+this.name);\r\n////    },\r\n////    abort: function(){\r\n////      this.abort_req = true;\r\n////      this.stop();\r\n////    },\r\n////    query_req: function(){\r\n////      return this.req;\r\n////    }\r\n////  }\r\n\r\n  var pref = pref_default();\r\n  function pref_default() {\r\n    var proto = {\r\n      image_hover:false,\r\n      image_hover_zIndex:101,\r\n      image_prefetch:false,\r\n      click: 'none',\r\n      click_area: 'thumbnail',\r\n      format: {show:  {style:  true, contents:  true, layout:  true, posts: false, fileinfo: false, images_2nd: true},\r\n               hover: {style:  true, contents: false, layout: false, posts:  true, fileinfo:  true, images_2nd: true},\r\n               search:{style: false, contents: false, layout: false, posts:  true, fileinfo:  true, images_2nd: true},\r\n               thumb: {resize: false},\r\n      },\r\n      footer: {ctime:false, btime:false, ptime:false, br:true, prate:false, archived:true, nd:false, nl:false},\r\n      draw_on_demand: true,\r\n      load_on_demand: false,\r\n      t2h_sel: 'page',\r\n      t2h_L: 100,\r\n      t2h_M: 50,\r\n      get t2h_N(){return this.t2h_num_of_posts},\r\n      t2h_num_of_posts : 5,\r\n      save_board_list_sel: false,\r\n      board_list_sel: 0,\r\n      mark_new_posts: true,\r\n      auto_update : false,\r\n      auto_update_period : 10,\r\n      auto_update_countdown : true,\r\n\r\n      popup:true, colorID:true, backlink:true, popup_truncated:true,\r\n      link_show_op:true,\r\n      expand_thumbnail_inline:true, localtime:true,\r\n      expand_thumbnail_inline_all_after:false,\r\n      expand_thumbnail_initial:false,\r\n      hide_posts_without_images:false,\r\n      thumbnail:{\r\n        inline:{limit_width: true, limit_height:false, margin_width: 40, margin_height: 0, webm: true, webm_mute:false, webm_loop:false, ondemand:true, ref_height:400},\r\n        hover: {limit_width: true, limit_height: true, margin_width: 40, margin_height: 0, webm:false, webm_mute: true, webm_loop:false},\r\n      },\r\n      open_spoiler_text: false,\r\n      open_spoiler_image: false,\r\n      merge: false,\r\n      scroll_lock: false,\r\n      use_expander_always: false,\r\n      popup2:'no',\r\n      posts_search_op: 'opaque',\r\n      posts_search_op_opacity: 40,\r\n      deleted_posts: {detect:'acc', store:'LS', merge:true, auto_clean:true},\r\n      auto_config_posts_search: true,\r\n\r\n      env: {\r\n        disp_offset:0,\r\n        popup_native:true,\r\n        expand_thumbnail_inline_native:true,\r\n        image_hover_native:false,\r\n        colorID_native:true,\r\n        backlink_native:true,\r\n        localtime_native:true,\r\n        auto_update_native:false,\r\n        event_dynamic:false,\r\n      },\r\n    };\r\n    var pref_new = {\r\n      script_prefix: 'CatChan',\r\n      features: {\r\n        page: true, graph: true, setting: true, setting2: true, postform: true, catalog: true, listener : true, uip_tracker: true, thread_reader: true, debug: false,\r\n        notify:{desktop:true, sound:true, favicon:true},\r\n        recovery: true,\r\n      },\r\n      max_capture: 576,\r\n      interval_found: 10,\r\n      write_to_ls: true,\r\n      aggregator: 'true', // radiobutton\r\n      server: true,\r\n      load_pref: true,\r\n      load_data: true,\r\n      check_page: false,\r\n      check_post: false,\r\n      check_thread: false,\r\n      import_format: 'obj', // radiobutton\r\n      max_graph: 576, // radiobutton\r\n      scale_thread: 10,\r\n      auto_start: true,\r\n      workaround_for_dollchan: false,\r\n      prevent_redirection: false,\r\n      graph_animation: false,\r\n      autoconf: 'auto',\r\n      info_server: false,\r\n      info_client: false,\r\n      wafd_tb: 'tb',\r\n      wafd_open_spoiler: false,\r\n      show_page_fraction : true,\r\n      catalog_max_page: 5,\r\n      catalog_max_page_auto: true,\r\n      catalog_max_page_select: 'auto',\r\n      catalog_snoop_refresh: true,\r\n      catalog_auto_rollup_when_moving: true,\r\n      catalog_size_width: 240,\r\n      catalog_size_height: 350,\r\n      catalog_size_text_width: 400,\r\n      catalog_size_text_height: 16,\r\n      catalog_size_tn1_width: 240,\r\n      catalog_size_tn1_height: 240,\r\n      catalog_size_tn2_width: 80,\r\n      catalog_size_tn2_height: 80,\r\n      catalog_size_frame0_width: 30,\r\n      catalog_size_frame1_width: 69,\r\n//      catalog_enable_cross_board: true,\r\n//      catalog_enable_cross_domain: true,\r\n      catalog_load_on_demand_timeout: 10,\r\n      catalog_2nd_images_show: false,\r\n      catalog_2nd_images_hover: true,\r\n      catalog_2nd_images_search: true,\r\n      catalog_posts_on_demand: true,\r\n      catalog_refresh_clear: true,\r\n//      catalog_checkbox_deletion_show: false,\r\n//      catalog_checkbox_deletion_hover: true,\r\n//      catalog_checkbox_deletion_search: true,\r\n//      catalog_popup: true,\r\n      catalog_popdown: 'delay',\r\n      catalog_popup_delay: 300,\r\n      catalog_popdown_delay: 500,\r\n      catalog_popup_size_fix: true,\r\n      catalog_open_last50: 'exist_watch',\r\n      catalog_board_list_str: '//sample of board group\\n' +\r\n//        '//board_name[,nickname+board_name[+thread No.] | \\'*\\'+up to X page | \\'^\\'+style]...\\n'+\r\n        '//board_name[,nickname+board_name[+thread No.][\\'*\\'+up to X page]]..., [#Tag|##Tag]..., [!stats]\\n'+\r\n        'Global/int/,8chan/int/,KC/int/,4chan/int/\\n'+\r\n        'Global/b/,8chan/b/,KC/b/,4chan/b/\\n'+\r\n        'v+gg,8chan/v/,8chan/gamergatehq/,4chan/v/\\n'+\r\n        'Inter/pol/,8chan/pol/,4chan/pol/\\n'+\r\n        'JapanShoppingMall,8chan/jpck/,8chan/japan2/\\n'+\r\n        'tech,meguca/g/,lain/tech/,8chan/tech/,4chan/g/,KC/t/\\n',\r\n//        'ScriptHome,8chan/scriptcdc/,KC/jp/35003\\n',\r\n//        'script_home,8chan/scriptcdc/,KC/jp/35003,KC/kc/41434\\n',\r\n      catalog_board_list_obj: [],\r\n      catalog_promiscuous: false,\r\n//      catalog_board_list_sel: 0,\r\n      get catalog_board_list_sel() {return (cataLog && cataLog.embed_mode && this[cataLog.embed_mode])? this[cataLog.embed_mode].board_list_sel : 0;},\r\n      set catalog_board_list_sel(val) {if (cataLog && cataLog.embed_mode && this[cataLog.embed_mode]) this[cataLog.embed_mode].board_list_sel = val;},\r\n//      catalog_sw_domain: 'https://8chan.co',\r\n      localtime_offset : -(new Date().getTimezoneOffset()/60),\r\n//      catalog_localtime : true,\r\n//      catalog_border_show : false,\r\n//      catalog_border : '1px solid',\r\n//      catalog_enable_background : false,\r\n      catalog_footer : true,\r\n      catalog_footer_show_site_name : false,\r\n      catalog_footer_show_board_name : true,\r\n      catalog_footer_show_thread_no : false,\r\n      catalog_footer_show_nof_rep_to_me : true,\r\n      catalog_footer_show_nof_rep       : true,\r\n      catalog_footer_ignore_my_own_posts : true,\r\n      catalog_footer_show_flag : true,\r\n      catalog_footer_show_page : true,\r\n      catalog_footer_show_tag : true,\r\n      catalog_footer_tag_letters : 3,\r\n      catalog_footer_design : 'native',\r\n      catalog_no_popup_at_expanded : true,\r\n      catalog_open_in_new_tab : true,\r\n      catalog_open_where : 'named',\r\n      catalog_open_where_click : true,\r\n//      catalog_use_named_window : true,\r\n      catalog_triage : true,\r\n      catalog_triage_place : 'topLeft',\r\n      catalog_triage_hist : 16,\r\n      triage:{ show_always:false, popdown_delay:2000, hide_toggle:true},\r\n//      catalog_triage_str : '[\"background:#e5ecf9\",\"background:#c3dcf9\",\"background:#b8efc2\",'+\r\n//        '\"background:#efedbe\",\"background:#fbd5fb\",\"background:#fac2c5\"]// defalut\\n' +\r\n//        '//[\"background:#e5ecf9;border:none\",\"background:#c3dcf9;border:1px solid #a3bcd9\",'+\r\n//        '\"background:#b8efc2;border:1px solid #98cfa2\",\"background:#efedbe;border:1px solid #cfcd9e\",' +\r\n//        '\"background:#fbd5fb;border:1px solid #ebb5db\",\"background:#fac2c5;border:1px solid #daa2a5\"]// backgroud+border',\r\n      catalog_triage_str: 'KILL,X,,TIME,v,,WATCH,W,,UNWATCH,UW,,UNDO,U,',\r\n//      catalog_triage_str : '//default\\n'+\r\n//        'KILL,X,,KILL,X,background:#c3dcf9,KILL,X,background:#b8efc2,'+\r\n//        'KILL,X,background:#efedbe,KILL,X,background:#fbd5fb,KILL,X,background:#fac2c5\\n'+\r\n//        'TIME,v,,TIME,v,background:#c3dcf9,TIME,v,background:#b8efc2,'+\r\n//        'TIME,v,background:#efedbe,TIME,v,background:#fbd5fb,TIME,v,background:#fac2c5\\n'+\r\n//        'NONE,O,,NONE,O,background:#c3dcf9,NONE,O,background:#b8efc2,'+\r\n//        'NONE,O,background:#efedbe,NONE,O,background:#fbd5fb,NONE,O,background:#fac2c5\\n'+\r\n//        'UNDO,U,,WATCH,Watch,,UNWATCH,UnWatch,\\n'+\r\n//        '// sample\\n'+\r\n//        '//KILL,back_to_default,,NONE,border,background:#c3dcf9;border:3px solid blue,NONE,transparent,background:,NONE,shrink,width:100px;height:100px\\n'+\r\n//        '//\\n'+\r\n//        '// 1st column :\\n'+\r\n//        '//   KILL : delete forever.\\n'+\r\n//        '//   TIME : delete until the thread gets new replies.\\n'+\r\n//        '//   NONE : just change its appearance.\\n'+\r\n//        '// 2nd column : strings in the button.\\n'+\r\n//        '// 3rd column : style in HTML.\\n'+\r\n//        '// Repeat these as you wish.\\n',\r\n//        'KILL,'\\u2715',,TIME,'\\u2713',,NONE,'O',\r\n      catalog_cross_domain_connection : 'indirect',\r\n//      catalog_auto_update : false,\r\n//      catalog_auto_update_period : 10,\r\n      catalog_auto_update_countdown : true,\r\n//      catalog_show_setting : false,\r\n      catalog_expand_at_initial : false,\r\n      catalog_expand_at_initial_embed : true,\r\n      catalog_expand_with_hr : false,\r\n      overwrite_site2_json_str:\r\n        '//{\"site2\":{\"KC\":{\"time_offset\":2}}} // summer time for KC.\\n'+\r\n        '//{\"site2\":{\"4chan\":{\"protocol\":\"https:\"}}} // use https to 4chan.\\n'+\r\n        '//{\"pref\":{\"patch\":{\"rm_404_blacklist\":[\"8chan\"]}}} // 8chan sends corrupted data.\\n',\r\n      overwrite_site2_eval_str: '',\r\n//      show_tooltip : true,\r\n      tooltips: {help: {show: true, popup_delay:2000, popdown_delay:1000},\r\n                 info: {show: true, popup_delay:300,  popdown_delay:500}},\r\n      catalog: {\r\n        indexing: 0,\r\n//        max_threads : 512,\r\n        max_threads_at_refresh : 500,\r\n        filter: {\r\n//          show : false,\r\n          kwd : {use: false, str: '', re: false, ci: true, match: 0, op: true, post: false,\r\n                 sub: true, name: true, trip: false, com: true, file: false, kwds: [], meta:false, sentence:false},\r\n          tag      : false,\r\n//          tag_list_str : '',\r\n//          tag_scan_auto : false,\r\n          tag_ci   : false,\r\n          time     : false,\r\n          time_creation : false,\r\n          time_str : new Date(Date.now()-86400000).toLocaleString(),\r\n          time_obj : true,\r\n//          time_ago_str : '24:00',\r\n          time_ago_str : '0:00',\r\n          time_ago_str_sync_at_refresh : false,\r\n          time_track : false,\r\n//          time_mark : false,\r\n          desktopime_mark_str : '',\r\n          time_watch : false,\r\n          time_watch_creation : false,\r\n          list_time_scroll: true,\r\n          list : true,\r\n//          list_mark_time : true,\r\n          list_str : '',\r\n//          list_obj : [],\r\n          list_obj2 : {},\r\n          attr_list : true,\r\n          attr_list_str : '',\r\n          attr_list_obj2 : {},\r\n          bookmark_list : true,\r\n          bookmark_list_str : '',\r\n          bookmark_list_obj2 : {},\r\n          watch_list_str : '',\r\n          watch_list_obj2 : {},\r\n//          watch_list_mark_time : true,\r\n//          tag_scansite : true,\r\n          tag_search: {str:'', re:false, get ci(){return pref.liveTag.ci;}, sentence:false, rexps:[]},\r\n        },\r\n        bookmark_list_rm404 : true,\r\n        auto_load_filter : false,\r\n        auto_save_filter : false,\r\n        auto_save_filter_at_refresh : false,\r\n        tag : {ignore:12, max:12},\r\n        board: {recommendation: true, all_boards:false, board_tags: false, ex_list: false, ex_list_str: '', ex_list_obj2: {}, board_tags_same: false},\r\n        style_general_list : true,\r\n        style_general_list_str : \r\n          '//^background:#e5ecf9\\n'+\r\n          '//^border:1px solid black\\n'+\r\n          '//8chan^background:#eef2ff;border:1px solid #d6daf0\\n'+\r\n          '//8chan^background:#eef2ff\\n'+\r\n          '//KC^background:#e0e0fc;border:1px solid #aaaacc\\n'+\r\n          '//4chan^background:#ffffee;border:1px solid #f0e0d6\\n',\r\n        style_general_list_obj2 : {},\r\n        refresh : {initial : true, except_bt : true, at_switch: true},\r\n        design : 'auto',\r\n        catalog_json : true,\r\n        embed : true,\r\n        embed_page: true,\r\n        embed_frame : true,\r\n//        order : {reply_to_me: true, reply: true, watch: 'dont_care', sticky:'dont_care', find_sage_in_8chan: false},\r\n        order : {reply_to_me: true, reply: true, watch: 'dont_care', sticky:'dont_care'},\r\n//        health_indicator: {on: true, max:10},\r\n        auto_watch: true,\r\n        unmark_on_hover: true,\r\n        mimic_base_site: true,\r\n        text_mode: {mode:'graphic', sub:true, name:false, com:true},\r\n        appearance: {\r\n          titleBar: {filter: true, settings: true, refresh: true, num_of_pages: true, boards_selector: true},\r\n          initial: {state: 'maximized', width: 400, height: 400}\r\n        },\r\n\r\n        t2h_sel: 'no',\r\n        click: 'open',\r\n        env:Object.create(proto.env),\r\n        __proto__: proto},\r\n      filter: {disable_list_when_kwd_active:true},\r\n      page: {\r\n        infinite: false, \r\n//        scan_tag:true,\r\n        format: {show:{style:false, contents:false, layout:false, posts:true, fileinfo:true, images_2nd:true},\r\n                 __proto__:proto.format},\r\n        image_hover:true,\r\n        footer: {br:false, __proto__:proto.footer},\r\n        draw_on_demand: true,\r\n        load_on_demand: true,\r\n        env:Object.create(proto.env),\r\n        __proto__: proto},\r\n      thread: {\r\n        embed: false,\r\n        format: {show:{style:false, contents:false, layout:false, posts:true, fileinfo:true, images_2nd:true},\r\n                 __proto__:proto.format},\r\n        image_hover:true,\r\n        footer: {br:false, __proto__:proto.footer},\r\n        env:{auto_update_native:true, __proto__:proto.env},\r\n        t2h_num_of_posts : -1,\r\n        auto_update: false,\r\n        __proto__: proto},\r\n      float: {\r\n        click: 'open',\r\n        format: {thumb: {resize: true},\r\n                 __proto__:proto.format},\r\n        save_board_list_sel: true,\r\n        env:Object.create(proto.env),\r\n        __proto__: proto},\r\n      common: {\r\n        clear_at_manual_scan : false,\r\n      },\r\n\r\n//      graph : {key: null, pipe: null},\r\n      uip_tracker: {on : false, posts: true, deletion: true, interval: 10, adaptive: true, auto_open:false, auto_open_th:300, auto_open_kwd:''},\r\n      thread_reader: {use: true, sync: true, triage: true, triage_close: true, check_num_of_children: true,\r\n        own_posts_tracker: false, show_own_post_by: 'anchor', show_reply_to_me_by: 'anchor', clean_up_own_posts: true},\r\n      settings: {indexing: 0},\r\n      tag : {gen: false, gen_str:''}, // dummy for checkbox and textarea.\r\n      cloudflare: {auto_reload: true, auto_reload_time: 5},\r\n      scan: {max:10000, lifetime:20, crawler:50, max_threads:1000, crawler_adaptive:true, crawler_idle_time_to_spawn:100},\r\n      notify : {sound: {notify: false, file:null, src:'beep', beep_freq:1000, beep_length_f:0.2, beep_volume_f:1, reply_to_me: true, reply: true, new_thread: true, appear: true},\r\n                desktop: {notify: true, reply_to_me: true, reply: true, new_thread:true, appear:true, lifetime:30, show_last:false,\r\n                          limit:(brwsr.ff)? 10 : 30, delay:(brwsr.ff)? 500 : 0},\r\n                favicon: true,\r\n                title: {notify:true, hide_zero: true},\r\n               },\r\n      liveTag: {\r\n        use: true, max: 12, maxstr: 25, from:'post', lock_tags_in_op: true, ci: true,\r\n        inherit_board_name: true, lock_board_name: true, inherit_board_tags: true, lock_board_tags: true,\r\n        show_info_onmouseover: true, style: true,\r\n        style_urtm_str:'color:lime;font-weight:bold', style_ur_str:'color:limegreen;font-weight:bold', style_in_str:'color:red',\r\n        style_urtm_obj4:{},                           style_ur_obj4:{},                                style_in_obj4:{},\r\n        pickup_interval: 10, rm_404_immediately: true, disp_delay:{fg:500, bg:5000}, click_func: 'in', click_func_bl: 'pkin',\r\n        watch_all: true, utilize_boards_json:true,\r\n        ex_list: true, ex_list_str:'8chan:#selection\\n', ex_list_obj5:[],\r\n        rm_list: true, rm_list_str:'http*\\n', rm_list_obj5:[]},\r\n      virtualBoard: {\r\n        show: true, max:20, scan: false, scanDelay: 5, p_board: 'replace', p_remove: false, v_remove:true,\r\n        scan_domains: {meguca:'none', lain:'none', '8chan':'none', '4chan':'none', KC:'none'},\r\n        instant_scan: true,\r\n        search: {show: true,  str:'', re:false, get ci(){return pref.liveTag.ci;}, sentence:false, rexps:[]},\r\n      },\r\n      style:{\r\n        sel: 'fix',\r\n        fix:{titleBar_str:'background:#b5ccf9', window_str:'background:#e5ecf9;color:#000000;', popUp_str:'background:#e5f4f9;color:#000000;border:2px solid blue;'},\r\n        copy:{titleBar_str:'body', window_str:'body', popUp_str:''},\r\n        post_editing: 'background:#cec952 !important',\r\n      },\r\n      recovery:{comment:true, interval:10, auto_clean:true},\r\n      healthIndicator: {show:true, max:10, expand_running:false, dont_retire_running:true, cancel:true},\r\n      network: {fetch_actively:true, adaptive:true, th100:5, th100_delay:500, th20:10, th20_delay:100},\r\n      stats: {use:false, retain_404:true, draw_delay:10, estimate_posts:true,\r\n              save:true, load:true, len_capture:1440, auto_acquisition:true, auto_acquisition_scan:true, auto_acquisition_scan_delay:120, auto_acquisition_all:false, \r\n              tolerant:true, tolerance:90,},\r\n      chart: {off_anime_blur:true, window_width:400, window_height:400, instant_scan:true, load_on_demand:false,\r\n              inst:{len:120, scale_thread:10, time_sel:1, board_sel:0, show_legend:true, // separate:false, \r\n                    show: {np:true, p:false, ep:false, nt:false, t:true, et:false}, clip_np:false, clip_np_val:0,\r\n                    options: {bezierCurve: false, animation:false, pointDot:true, pointDotRadius:4}}},\r\n      archive:{json:null, dir:null, load_img:true, restore_auto:true, clear_threads:true, clear_files:true, format:'auto', domain:0, board:'',\r\n               src:'shown', store_auto:false, dir_dled:null,\r\n               oneshot: {post:true, tn:true, img:true,  webm:true , post_idb:true, tn_idb:true, img_idb:true,  webm_idb:true},\r\n               live:    {post:true, tn:true, img:false, webm:false, post_idb:true, tn_idb:true, img_idb:false, webm_idb:false},\r\n               deleted: {post:true, tn:true, img:false, webm:false, post_idb:true, tn_idb:true, img_idb:false, webm_idb:false},\r\n               IDB:     {post:true, thumbnail:true, img:true,  webm:true, auto_clean:true, prune:1, check_every:1},\r\n               kwd: {use:true, str:'', re:false, ci:true, match:0, op:true, post:false, sub:true, name:true, trip:false, com:true, file:false, meta:false, sentence:false},\r\n               list:true,\r\n               list_str:'', list_obj6:null, list_inherit:true,\r\n               tar: true, tarsize: 100,\r\n//               get list_str(){return pref3.archive.list_str_get();},\r\n//               set list_str(val){pref3.archive.list_str_set(val);},\r\n              },\r\n      debug_mode : {unread_count:'', parse_error:false, site2func:'', site2func_expand:true, pfunc:'', pfunc_expand: true, pfunc_all:'', pfunc_all_expand: true,\r\n                    pfunc_comp:'', pfunc_comp_expand_same:true, pfunc_comp_expand_diff:true, pfunc_comp_proto:'',},\r\n      test_mode: {tips:false, num:0, num_f:0, test_str:'', js_file:null},\r\n      patch: {\r\n        delayed_invoke: {use: false, sec: 10},\r\n        rm_404_blacklist: [], //['8chan'], // 8chan sends corrupted data.\r\n      },\r\n      pref2: {\r\n        KC: {summer_time: false},\r\n        meguca: {remove_history_class: true},\r\n      },\r\n      easy: {posts_ago:24, threads_ago:24, max_boards:50,},\r\n      easy2: {\r\n        reset: true, presets: 0, time_post:24, time_op:24, basics:true, // easy2 local parameters.\r\n        auto_update:false, auto_update_period:10, // easy2 local parameters.\r\n        VB: {local:0, global:0}, LTfrom: 0, limits:0, // easy2 local parameters.\r\n        virtualBoard: {show:true, scan:true, max:100},\r\n        liveTag: {use:false, from:'op'},\r\n        catalog: {embed:true, embed_page:true, max_threads_at_refresh:500,\r\n                  auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:10,\r\n                  filter: {time_watch:false, time_watch_creation:false},\r\n                 },\r\n        page:{auto_update:true, auto_update_period:10},\r\n        thread: {embed:false, auto_update:true, auto_update_period:10},\r\n        notify:{desktop:{notify:true}},\r\n        stats: {use:false},\r\n        scan:{max:100, max_threads:1000},\r\n        network:{fetch_actively:false},\r\n        healthIndicator:{expand_running:false},\r\n      },\r\n      proto: proto, // for overwrite from pref_default.\r\n    };\r\n    for (var i=0;i<30;i++) pref_new.debug_mode[i] = false;\r\n    for (var i=0;i<80;i++) pref_new.test_mode[i] = false;\r\n    if (site) {\r\n      if (site2[site.nickname].pref_default) pref_func.pref_overwrite(pref_new,site2[site.nickname].pref_default);\r\n    }\r\n    return pref_new;\r\n  }\r\n  var pref3 = {\r\n    stats: {use:null, estimate_posts:null},\r\n    reload_required: false,\r\n    catalog: {\r\n      filter: {\r\n        time_str: function(parent,key,val){parent[key.replace(/str$/,'obj')] = Date.parse(val);},\r\n        time_obj: 0,\r\n        kwd: {\r\n          str: function(e){if (this.obj) this.obj[(this.obj[0]===e.target)? 1 : 0].value = pref.catalog.filter.kwd.str;},\r\n          obj: null,\r\n          clear: function(){\r\n            if (!this.obj) return; // patch for obj_init_hier\r\n            this.obj[1].value = '';\r\n            this.obj[1].oninput({target:this.obj[1],currentTarget:this.obj[1]});\r\n          }\r\n        },\r\n      },\r\n    },\r\n    archive: {\r\n      working: false,\r\n      list_str: function(parent,key,val){pref_func.str2obj2(parent,key.replace(/str$/,'obj2'),val);},\r\n      list_obj2: null,\r\n      list_obj3: null,\r\n//      list_str_set: function(val){\r\n//        pref3.archive.list_str = val;\r\n//        pref_func.str2obj2(pref3.archive,'list_obj2',val);\r\n//      },\r\n//      list_str_get: function(){\r\n//        var lm = liveTag.mems;\r\n//        for (var name in pref3.archive.list_obj2) {\r\n//          var dbt = common_func.name2domainboardthread(name);\r\n//          if (!dbt[2]) continue;\r\n//          if (lm[dbt[0]] && lm[dbt[0]][dbt[1]]) var lth = lm[dbt[0]][dbt[1]][dbt[2]];\r\n//          if (lth && lth.archived && lth.time_checked !== pref3.archive.list_obj2[name].time) pref3.archive.list_str = list_func_1(pref3.archive.list_str, name, lth.time_checked); // BUG. NOT implemented yet.\r\n//        }\r\n//        return pref3.archive.list_str;\r\n//        function list_func_1(str,name,datetime){ // refer 'triage_exe'\r\n//          var key = new RegExp('(^|,)'+name.replace(/\\+/,'\\\\+')+'([\\\\^@!][^,\\n]*)*(,|\\n|$)','mg');\r\n////          var millisec = datetime%1000;\r\n////          var time_str = '@' + new Date(datetime).toLocaleString() + ((datetime%1000==0)? '' : '.'+millisec);\r\n////          str = str.value.replace(key,',') + ',' + name + time_str + '\\n';\r\n//          str = str.value.replace(key,',') + ',' + name + '\\n'; // remove time_str\r\n//          return str.replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,'');\r\n//        }\r\n//      },\r\n    },\r\n  };\r\n  \r\n  var cataLog = {\r\n    threads: null,\r\n    insert_footer3: null,\r\n    scan_boards: null,\r\n    scan_init: null,\r\n    catalog_filter_query: null,\r\n    embed_mode: null,\r\n////    catalog_refresh_watch: null,\r\n    format_html: null,\r\n    show_catalog: null,\r\n    healthIndicator: null,\r\n    parent: null, // triage_parent\r\n    open_spoiler_text: null,\r\n    show_catalog_scroll_lock: null,\r\n    general_event_handler: null,\r\n    catalog_refresh_1: null,\r\n    catalog_refresh_end: null,\r\n    catalog_filter_changed: null,\r\n    image_hover_add: null,\r\n    image_hover_reentry: null,\r\n    scan_boards_keyword_callback2: null,\r\n    catalog_clear_threads: null,\r\n    catalog_filter_query_keyword: null,\r\n    set_watch_time_thread: null,\r\n    get_watch_time_of_a_thread: null,\r\n    remove_thread: null,\r\n    event_func: null,\r\n  }\r\n\r\n  var pref_func = (function(){\r\n//    var tooltip = document.createElement('div');\r\n//    var tooltip_txt = tooltip.appendChild(document.createTextNode('help'));\r\n////    var tooltip_txt = tooltip.appendChild(document.createElement('textarea'));\r\n//    tooltip.style.position = 'fixed';\r\n//    tooltip.style.background = '#e5f4f9';\r\n//    tooltip.style.color = '#000000';\r\n//    tooltip.style.border = '2px solid blue';\r\n//    tooltip.style.fontWeight = 'normal';\r\n//    var tooltip_on = false;\r\n    return {\r\n      mirror_targets: {\r\n        pn12_0_2: null,\r\n        pn12_0_4: null,\r\n        pn13_1: null,\r\n      },\r\n////////      style_sheet: null,\r\n      apply_prep: function(pn,set,propagate, mirror, make_obj){\r\n        if (!pn) return; // reject mirroring to null, // patch for attr_changed.\r\n        var fm;\r\n        if (!mirror) {\r\n          if (Array.isArray(pn)) fm = pn;\r\n          else {\r\n            var query_str = 'input,textarea,select'+ ((set)? '' : ',span[data-class=show_value]');\r\n            fm = Array.prototype.slice.call(pn.querySelectorAll(query_str));\r\n            if (fm.length==0) fm = [pn];\r\n          }\r\n////          if (!set)\r\n////            for (var j in this.mirror_targets)\r\n////              if (this.mirror_targets[j])\r\n////                fm = fm.concat(Array.prototype.slice.call(this.mirror_targets[j].querySelectorAll(query_str)));\r\n//          fm = Array.prototype.slice.call(pn.getElementsByTagName('input')); // working code.\r\n//          fm = fm.concat(Array.prototype.slice.call(pn.getElementsByTagName('textarea')));\r\n//          fm = fm.concat(Array.prototype.slice.call(pn.getElementsByTagName('select')));\r\n//          if (!set) fm = fm.concat(Array.prototype.slice.call(pn.querySelectorAll('span[data-class=show_value]')));\r\n////          var fm = pn.getElementsByTagName('*'); // this doesn't work because a select contains its options in it.\r\n//          if (fm.length==0) fm = [pn];\r\n        } else {\r\n          fm = [];\r\n          for (var j in this.mirror_targets) {\r\n            if (this.mirror_targets[j]) {\r\n              var fm_tmp = this.mirror_targets[j].getElementsByTagName('input')[pn.name];\r\n              if (fm_tmp)\r\n                if (Array.isArray(fm_tmp)) fm = fm.concat(Array.prototype.slice.call(fm_tmp));\r\n                else fm[fm.length] = fm_tmp;\r\n            }\r\n          }\r\n          for (var j=fm.length-1;j>=0;j--) if (fm[j]===pn) fm.splice(j,1);\r\n          if (fm.length==0) return;\r\n        }\r\n        this.apply_prep_2(fm,set,propagate, mirror, make_obj);\r\n      },\r\n      apply_prep_2: function(fm,set,propagate, mirror, make_obj){\r\n        for (var i=0;i<fm.length;i++) {\r\n          var name = fm[i].getAttribute('name');\r\n          if (!name) continue; // for <span> //  if (!fm[i].name) continue;\r\n          if (fm[i].type=='button') continue;\r\n          var target_hier = pref_func.get_tgt(name);\r\n          var parent = target_hier[0];\r\n          var tgt    = target_hier[1];\r\n//          var parent = pref;\r\n//          var tgt = fm[i].name;\r\n//          if (tgt.indexOf('.')!=-1) {\r\n//            var tgts = tgt.split('.');\r\n//            for (var j=0;j<tgts.length-1;j++) parent = parent[tgts[j]];\r\n//            tgt = tgts[tgts.length-1];\r\n          //          }\r\n          var tagName = fm[i].tagName;\r\n          if (tagName==='INPUT') {\r\n            if (fm[i].type==='file') {\r\n              if (set) parent[tgt] = fm[i];\r\n              else if (parent[tgt] && parent[tgt]!==fm[i]) {\r\n                fm[i].parentNode.insertBefore(parent[tgt],fm[i]);\r\n                fm[i].parentNode.removeChild(fm[i]);\r\n              }\r\n            } else if (set) {\r\n              if      (typeof(parent[tgt])==='number' ) {\r\n                if (fm[i].name.substr(-2,2)==='_f') parent[tgt] = (isNaN(parseFloat(fm[i].value)))? 0 : parseFloat(fm[i].value);\r\n                else                                parent[tgt] = (isNaN(parseInt(fm[i].value,10)))? 0 : parseInt(fm[i].value,10);\r\n              } else if (typeof(parent[tgt])==='boolean') parent[tgt] = fm[i].checked;\r\n              else if (typeof(parent[tgt])==='string' ) if (fm[i].type==='text'|| fm[i].checked) parent[tgt] = fm[i].value;\r\n              if (!mirror && fm[i].type!=='radio') this.apply_prep(fm[i],false,false,true); // !mirror for cutting infinite loop. // radio has multiple elements.\r\n            } else {\r\n              if      (typeof(parent[tgt])=='number' ) fm[i].value = parent[tgt];\r\n              else if (typeof(parent[tgt])=='boolean') fm[i].checked = parent[tgt];\r\n              else if (typeof(parent[tgt])=='string' ) if (fm[i].type==='text') fm[i].value = parent[tgt]; else if (parent[tgt] === fm[i].value) fm[i].checked = true;\r\n            }\r\n            if (set || make_obj)\r\n              if (typeof(parent[tgt])==='string' )\r\n                if (fm[i].type==='text') {\r\n                  if (tgt.substr(-3,3)==='str' && parent[tgt.substr(0,tgt.length-3)+'obj4']) pref_func.str2obj4(parent,tgt.substr(0,tgt.length-3)+'obj4',fm[i].value);\r\n                  if (tgt.substr(-3,3)==='str' && parent[tgt.substr(0,tgt.length-3)+'obj']) pref_func.str2obj6(parent,tgt,fm[i].value,name);\r\n                }\r\n          } else if (tagName==='TEXTAREA') {\r\n            if (set) parent[tgt] = fm[i].value;\r\n            else fm[i].value = parent[tgt];\r\n            if (set || make_obj) {\r\n              if (tgt.search(/str$/)!=-1 && parent[tgt.replace(/str$/,'obj')]) pref_func.str2obj(tgt);\r\n              if (tgt.search(/str$/)!=-1 && parent[tgt.replace(/str$/,'obj2')]) pref_func.str2obj2(parent,tgt.replace(/str$/,'obj2'),fm[i].value);\r\n//              if (tgt.substr(-3,3)==='str' && parent[tgt.substr(0,tgt.length-3)+'obj4']) pref_func.str2obj4(parent,tgt.substr(0,tgt.length-3)+'obj4',fm[i].value);\r\n              if (tgt.substr(-3,3)==='str' && parent[tgt.substr(0,tgt.length-3)+'obj5']) pref_func.str2obj5(parent,tgt.substr(0,tgt.length-3)+'obj5',fm[i].value);\r\n              if (tgt.substr(-3,3)==='str' && parent[tgt.substr(0,tgt.length-3)+'obj6']===null) pref_func.str2obj6(parent,tgt,fm[i].value,name);\r\n            }\r\n          } else if (tagName==='SELECT') {\r\n            if (set) {\r\n              if (parent[tgt]!==undefined) parent[tgt] = fm[i].selectedIndex;\r\n            } else {\r\n//              var tgt_obj = (tgt.search(/sel/)!=-1)? tgt.replace(/sel/,'obj') : null;\r\n//              if (parent[tgt_obj]) {\r\n//                fm[i].length=0;\r\n//                for (var j=0;j<parent[tgt_obj].length;j++) {\r\n//                  fm[i].length++;\r\n//                  fm[i].options[fm[i].length-1].text = parent[tgt_obj][j][0]['key'];\r\n//                }\r\n//              }\r\n              if (parent[tgt]>=fm[i].length) parent[tgt] = 0;\r\n              fm[i].selectedIndex = parent[tgt];\r\n            }\r\n          } else if (tagName==='SPAN') {\r\n            if (!set && fm[i].getAttribute('data-class')==='show_value') {\r\n              var val = parent[tgt];\r\n              var func_str = this.apply_prep_2_str[tgt+':'+parent[tgt]];\r\n              if (func_str) val = (typeof(func_str)==='string')? func_str : func_str(parent);\r\n//              if (fm[i].getAttribute('name').substr(-7,7)==='t2h_sel' && ['L','M','N'].indexOf(parent[tgt])!=-1) val = parent['t2h_'+parent[tgt]];\r\n              fm[i].textContent = val.toString().replace(/^./,function(v){return v.toUpperCase();});\r\n            }\r\n          }\r\n          if (propagate) {\r\n            if (fm[i].oninput)  fm[i].oninput.call(fm[i], {currentTarget:fm[i], target:fm[i]}, true);\r\n            if (fm[i].onchange) fm[i].onchange.call(fm[i], {currentTarget:fm[i], target:fm[i]}, true);\r\n          }\r\n        }\r\n        if (sessionStorage && (set||make_obj)) sessionStorage[pref.script_prefix+'.pref'] = JSON.stringify(pref);\r\n      },\r\n      apply_prep_2_str: {\r\n        't2h_sel:L': function(parent){return parent['t2h_L'];},\r\n        't2h_sel:M': function(parent){return parent['t2h_M'];},\r\n        't2h_sel:N': function(parent){return parent['t2h_N'];},\r\n        't2h_sel:N_unread': function(parent){return parent['t2h_N']+'+unread';},\r\n        't2h_sel:unread': 'All unread',\r\n        'posts_search_op:opaque': function(parent){return 'opaque '+parent['posts_search_op_opacity']+'%';},\r\n        'popup2:sr': 'SearchResult',\r\n        'popup2:srpv': 'SearchResult/Preview',\r\n        'popup2:pv': 'Preview',\r\n        'popup2:chart': 'PostRateChart',\r\n        'popup2:dp': 'DeletedPosts',\r\n      },\r\n//      make_pref_obj : function(name){ // copy of part of apply_prep.\r\n//        var target_hier = pref_func.get_tgt(name);\r\n//        var parent = target_hier[0];\r\n//        var tgt    = target_hier[1];\r\n//        if (tgt.search(/str$/)!=-1 && parent[tgt.replace(/str$/,'obj')]) pref_func.str2obj(tgt);\r\n//        if (tgt.search(/str$/)!=-1 && parent[tgt.replace(/str$/,'obj2')]) pref_func.str2obj2(parent,tgt.replace(/str$/,'obj2'),parent[tgt]);\r\n//      },\r\n      catalog_board_list_str_or: '',\r\n      catalog_board_list_str_bt: '',\r\n      catalog_board_list_str_bt_same: '',\r\n      add_onchange: function(pn,func_obj, func_obj2){ // obj2 for oninput\r\n        return this.set_event_target(pn, this.add_onchange_entry_func.bind(func_obj), func_obj2);\r\n      },\r\n      add_onchange_entry_func: function(e, propagate){ // always used after binded.\r\n        var pn_name = e.currentTarget.getAttribute('name'); // for <span>\r\n        if (!propagate && ['INPUT','TEXTAREA','SELECT'].indexOf(e.currentTarget.tagName)!=-1) pref_func.apply_prep(e.currentTarget,true);\r\n        if (this[pn_name]) this[pn_name].call(e.currentTarget,e);\r\n        else if (pn_name.indexOf('.')!=-1) {\r\n          var name = '*'+pn_name.substr(pn_name.indexOf('.')); // *.XXX\r\n          if (this[name]) this[name].call(e.currentTarget,e);\r\n          else if (pn_name.lastIndexOf('.')!=-1) {\r\n            var name = pn_name.substr(0,pn_name.lastIndexOf('.')+1)+'*'; // XXX.YYY.*\r\n            if (this[name]) this[name].call(e.currentTarget,e);\r\n          }\r\n        }\r\n//        var pn = e.target.parentNode; // 'Filter' doesn't have stopper.\r\n//        while (pn && pn!==site.script_body) {\r\n//          if (pn.getAttribute('name')==='SUB') this['SUB'].call(pn,{currentTarget:pn});\r\n//          pn = pn.parentNode;\r\n//        }\r\n      },\r\n      add_onchange_format: function(func_obj){\r\n        var keys = Object.keys(func_obj);\r\n        for (var i=0;i<keys.length;i++) if (typeof(func_obj[keys[i]])==='string') func_obj[keys[i]] = func_obj[func_obj[keys[i]]];\r\n        return func_obj;\r\n      },\r\n////      add_onchange: function(pn,func_obj, func_obj2){ // obj2 for oninput // working code.\r\n////        var call_tgt = func_obj;\r\n////        if (typeof(func_obj)!=='function') { // object\r\n////          for (var i in func_obj) if (typeof(func_obj[i])==='string') func_obj[i] = func_obj[func_obj[i]];\r\n////          if (func_obj2) for (var i in func_obj2) if (typeof(func_obj2[i])==='string') func_obj2[i] = func_obj2[func_obj2[i]];\r\n//////          func_obj.func_default = function(){ // cause EventListener leak.\r\n//////            pref_func.apply_prep(this,true);\r\n//////            if (func_obj[this.name]) func_obj[this.name](this);\r\n//////          };\r\n//////          call_tgt = func_obj.func_default;\r\n////          call_tgt = func_obj.entry_func;\r\n////        }\r\n////        this.set_event_target(pn,call_tgt, func_obj2);\r\n////      },\r\n      set_event_target: (function(){\r\n        var inst_while_input = null;\r\n        function prep_beforeunload(e){\r\n          inst_while_input = (e)? e.target : null;\r\n        }\r\n        function set_val_beforeunload(){\r\n          if (inst_while_input) pref_func.apply_prep(inst_while_input,true);\r\n        }\r\n        window.addEventListener('beforeunload', set_val_beforeunload, false);\r\n        return function(pn,tgt, func_obj2){\r\n          var tgt_wrapped = function(e, propagate){inst_while_input=null;tgt.call(this,e, propagate);};\r\n          var fm = pn.getElementsByTagName('*');\r\n          if (fm.length==0) fm = [pn];\r\n          for (var i=0;i<fm.length;i++) {\r\n            var name = fm[i].getAttribute('name');\r\n            if (!name) continue; // for span // if (!fm[i].name) continue;\r\n            var tagName = fm[i].tagName;\r\n            if (tagName==='INPUT' || tagName==='TEXTAREA' || tagName==='SELECT') {\r\n              if (func_obj2 && func_obj2[fm[i].name]) fm[i].oninput = tgt_wrapped;\r\n              else {\r\n                fm[i].onchange = tgt_wrapped;\r\n                if (tagName==='INPUT' && fm[i].type==='text') fm[i].oninput = prep_beforeunload;\r\n              }\r\n            } else if (tagName==='BUTTON') fm[i].onclick = tgt_wrapped; // OK.\r\n            else if (tagName==='A') {\r\n              if (name==='SHOW' || name==='SHOWALL' || name==='HIDEALL' || name==='SHOW2' || name==='SHOW3' || name==='HIDE3') fm[i].onclick = tgt;\r\n            } else if (tagName==='SPAN') {\r\n//              if (name==='NEXT') fm[i].onclick = tgt;\r\n              if (name==='SUB') fm[i].onchange = tgt; // called twice times when INPUT in SUB is changed.\r\n              if (name==='SHOW2_I') fm[i].onclick = tgt;\r\n            }\r\n          }\r\n          return tgt_wrapped;\r\n        };\r\n      })(),\r\n//      remove_onchange: function(pn){this.set_event_target(pn,null);},\r\n//      invoke_onchange: function(pn){\r\n//        var evt = document.createEvent('UIEvents');\r\n//        evt.initUIEvent('change', false, true, window, 1);\r\n//        pn.dispatchEvent(evt);\r\n//      },\r\n      str2obj: function(key) {\r\n//        var tgt = key+'_obj';\r\n        var tgt = key.replace(/str$/,'obj');\r\n        pref[tgt] = [];\r\n        tgt = pref[tgt];\r\n        var bg_str = (site.whereami==='boards')? site2[site.nickname].boards_sel_from_tags() :\r\n                     site.board + ((site.whereami==='thread')? site.no : '');\r\n        bg_str += ',' + bg_str + '\\n' + pref[key] + '\\n';\r\n        if (pref.catalog.board.recommendation) {\r\n//          var blotter = document.getElementsByClassName('blotter')[0];\r\n//          if (blotter) {\r\n//            or_str = document.getElementsByClassName('blotter')[0][brwsr.innerText];\r\n//            var kwd = 'Recommendation: ';\r\n//            var idx = or_str.indexOf(kwd);\r\n//            if (idx!=-1) {\r\n//              var or = or_str.substr(idx+kwd.length);\r\n//              pref_func.catalog_board_list_str_or = or;\r\n//              lines.push(or);\r\n//            }\r\n//          }\r\n          var or = site2[site.nickname].get_owners_recommendation();\r\n          pref_func.catalog_board_list_str_or = or;\r\n//          lines.push(or);\r\n          bg_str = bg_str + or + '\\n';\r\n        }\r\n//        if (pref.catalog.board.board_tags && pref_func.catalog_board_list_str_bt!=='') lines.push(pref_func.catalog_board_list_str_bt);\r\n//        if (pref.catalog.board.board_tags_same && pref_func.catalog_board_list_str_bt_same!=='') lines.push(pref_func.catalog_board_list_str_bt_same);\r\n        if (pref.catalog.board.board_tags && pref_func.catalog_board_list_str_bt!=='') bg_str = bg_str + pref_func.catalog_board_list_str_bt + '\\n';\r\n        if (pref.catalog.board.board_tags_same && pref_func.catalog_board_list_str_bt_same!=='') bg_str = bg_str + pref_func.catalog_board_list_str_bt_same + '\\n';\r\n        var lines = bg_str.split('\\n');\r\n        var bn = -1;\r\n        for (var i=0;i<lines.length;i++) {\r\n          var fields = lines[i].replace(/\\/\\/.*/,'').replace(/, +/g,',').split(',');\r\n          var j=0;\r\n          while (j<fields.length && fields[j]=='') j++;\r\n          if (fields[j]) {\r\n            tgt[++bn] = [];\r\n            tgt[bn][0] = {};\r\n            tgt[bn][0].key = fields[j++];\r\n            var idx=0;\r\n            while (j<fields.length) {\r\n              if (fields[j]!==''){\r\n                if (fields[j].search(/^\\s*#/)!==-1) {\r\n                  if (!tgt[bn][0].tags) tgt[bn][0].tags=[];\r\n                  tgt[bn][0].tags[tgt[bn][0].tags.length] = fields[j].replace(/\\s/g,'');\r\n                } else if (fields[j].search(/^\\s*!/)!==-1) {\r\n                  if (!tgt[bn][0].cmds) tgt[bn][0].cmds=[];\r\n                  tgt[bn][0].cmds[tgt[bn][0].cmds.length] = fields[j].replace(/\\s/g,'').substr(1);\r\n                } else {\r\n                  tgt[bn][++idx] = {};\r\n                  tgt[bn][idx].key = fields[j].replace(/[\\*\\^!].*/,'').replace(/\\s/g,'')\r\n                  if (fields[j].search(/\\*/)!=-1) tgt[bn][idx].max_page  = parseInt(fields[j].replace(/[^\\*\\^!]*[\\*\\^!]/,'').replace(/[\\^!].*/,''),10);\r\n                  if (fields[j].search(/\\^/)!=-1) tgt[bn][idx]['style' ] = fields[j].replace(/[^\\*\\^!]*[\\*\\^!]/,'').replace(/[\\*!].*/,'');\r\n//                  if (fields[j].search(/\\!/)!=-1) tgt[bn][idx]['search'] = fields[j].replace(/[^\\*\\^!]*[\\*\\^!]/,'').replace(/[\\*\\^].*/,'');\r\n//                  tgt[bn][idx].key = fields[j].replace(/[\\*%!].*/,''); // working code..., but '%' is used in URL...\r\n//                  if (fields[j].search(/\\*/)!=-1) tgt[bn][idx]['num'   ] = fields[j].replace(/[^\\*%!]*[\\*%!]/,'').replace(/[%!].*/,'');\r\n//                  if (fields[j].search(/\\%/)!=-1) tgt[bn][idx]['style' ] = fields[j].replace(/[^\\*%!]*[\\*%!]/,'').replace(/[\\*!].*/,'');\r\n//                  if (fields[j].search(/\\!/)!=-1) tgt[bn][idx]['search'] = fields[j].replace(/[^\\*%!]*[\\*%!]/,'').replace(/[\\*%].*/,'');\r\n                }\r\n              }\r\n              j++;\r\n            }\r\n          }\r\n        }\r\n        if (pref.catalog.board.all_boards) tgt[tgt.length] = [{key:'ALL'},{key:site.nickname}];\r\n        for (var i=0;i<tgt.length;i++) {\r\n          for (var j=1;j<tgt[i].length;j++) {\r\n            var dm = tgt[i][j].key.replace(/\\/.*/,'');\r\n            if (dm=='') dm=site.nickname;\r\n            var bd = '/'+ tgt[i][j].key.replace(/[^\\/]*\\//,'').replace(/\\/.*/,'') +'/';\r\n            if (j==1) {\r\n              tgt[i][0]['domain']= dm;\r\n              tgt[i][0]['board' ]= bd;\r\n            } else {\r\n              if (tgt[i][0]['domain']!=dm) tgt[i][0]['domain']=null;\r\n              if (tgt[i][0]['board' ]!=bd) tgt[i][0]['board' ]=null;\r\n            }\r\n          }\r\n        }\r\n        for (var i=0;i<tgt.length;i++)\r\n          for (var j=1;j<tgt[i].length;j++) {\r\n            var dbt = common_func.name2domainboardthread(tgt[i][j].key,false);\r\n            tgt[i][j].key = common_func.name2domainboardthread(tgt[i][j].key,true).join(''); // patch\r\n            if (dbt[1]==='' && dbt[2]==='') {\r\n              if (!tgt[i][0].domains_for_all_boards) tgt[i][0].domains_for_all_boards = [];\r\n              tgt[i][0].domains_for_all_boards[tgt[i][0].domains_for_all_boards.length] = dbt[0];\r\n              tgt[i].splice(j--,1);\r\n            }\r\n          }\r\n      },\r\n      get_tgt: function(name, parent, exact){\r\n        if (!parent) parent = (name[0]==='#')? liveTag.tags : pref;\r\n        var tgts = name.split('.');\r\n        for (var j=0;j<tgts.length;j++)\r\n          if (!exact || parent[tgts[j]]!==undefined) {\r\n            if (j!=tgts.length-1) parent = parent[tgts[j]];\r\n            else return [parent,tgts[j]];\r\n          } else return null;\r\n      },\r\n      str2obj2: (function(){\r\n        function set_vals(tgt,key,vals_in,completion){\r\n          if (vals_in) {\r\n            if (!tgt[key]) tgt[key] = {};\r\n            var vals = vals_in[0].substr(1).split(';');\r\n            for (var j=0;j<vals.length;j++) {\r\n              var val = vals[j].split(':');\r\n              if (completion) {\r\n                if (val.length===1 || val[1]==='true') val[1] = true;\r\n                else if (val[1]==='false') val[1] = false;\r\n              }\r\n              tgt[key][val[0]] = val[1];\r\n            }\r\n          }\r\n        }\r\n        return function(parent,key,str, keep, obj2_only){\r\n          if (!keep) parent[key] = {};\r\n          tgt = parent[key];\r\n          var fields = str.replace(/\\/\\/.*/mg,'').replace(/\\n/g,',').split(/\\s*,\\s*/);\r\n          for (var i=0;i<fields.length;i++) {\r\n            if (fields[i]=='') continue;\r\n            var name = fields[i].replace(/[@\\^!].*/,'') || 'DEFAULT';\r\n            if (tgt[name]===undefined) tgt[name] = {};\r\n//            var time = fields[i].match(/@[^\\^!]*/);\r\n//            if (time) tgt[name].time = Date.parse(time[0].replace(/@/,''));\r\n            var time = fields[i].match(/@([^\\^!]*)/);\r\n            if (time) tgt[name].time = (time[1]==0)? 0 : Date.parse(time[1]); // Date.parse(0) returns 2000/1/1 0:00. '==0' is intended, 0 is string in this case.\r\n            set_vals(tgt[name],'style',fields[i].match(/\\^[^@!]*/));\r\n            set_vals(tgt[name],'cmd'  ,fields[i].match(/![^@\\^]*/),true);\r\n          }\r\n          if (obj2_only) return tgt;\r\n          var key3 = key.replace(/_obj2/,'_obj3');\r\n          parent[key3] = {};\r\n          var tgt3 = parent[key3];\r\n          for (var i in tgt) tgt3[i.replace(/\\/[0-9]+$/,'/')] = true;\r\n        }\r\n      })(),\r\n////      str2obj2: function(parent,key,str){ // working code.\r\n////        parent[key] = {};\r\n////        tgt = parent[key];\r\n////        var fields = str.replace(/\\/\\/.*/mg,'').replace(/\\n/g,',').split(',');\r\n////        for (var i=0;i<fields.length;i++) {\r\n////          if (fields[i]=='') continue;\r\n////          var name  = fields[i].replace(/[@%].*/,'');\r\n////          if (name=='') name = 'DEFAULT';\r\n////          var attr  = fields[i].match(/[@%].*/);\r\n////          var time  = (attr!=null)? attr[0].replace(/%[^@]*(@|$)/,'').replace(/@/,'') : null;\r\n////          var style = (attr!=null)? attr[0].replace(/@[^%]*(%|$)/,'').replace(/%/,'') : null;\r\n////          if (tgt[name]===undefined) tgt[name] = {};\r\n////          if (time ) tgt[name]['time']  = Date.parse(time);\r\n//////          if (style) tgt[name]['style'] = style;\r\n////          if (style) {\r\n////            if (!tgt[name].style) tgt[name].style = {};\r\n////            var styles = style.split(';');\r\n////            for (var j=0;j<styles.length;j++) {\r\n////              var stl = styles[j].split(':');\r\n////              tgt[name].style[stl[0]] = stl[1];\r\n////            }\r\n//////            tgt[name]['style'] = true;\r\n//////            var styles = style.split(';');\r\n//////            for (var j=0;j<styles.length;j++) {\r\n//////              var stl = styles[j].split(':');\r\n//////              tgt[name]['style.'+stl[0]] = stl[1];\r\n//////            }\r\n////          }\r\n////        }\r\n////        var key3 = key.replace(/_obj2/,'_obj3');\r\n////        parent[key3] = {};\r\n////        var tgt3 = parent[key3];\r\n////        for (var i in tgt) tgt3[i.replace(/\\/[0-9]+$/,'/')] = true;\r\n////      },\r\n      str2obj4: function(parent,key,str) {\r\n        parent[key] = this.style2obj(str);\r\n      },\r\n      style2obj: function(str) {\r\n        var fields  = str.split(';');\r\n        for (var i=fields.length-1;i>=0;i--) {\r\n          if (fields[i]) {\r\n            var coms = fields[i].replace(/\\s/g,'').split(':');\r\n            fields[i] = '\"'+coms[0]+'\":\"'+coms[1]+'\"';\r\n          } else fields.splice(i,1);\r\n        }\r\n        return JSON.parse('{' + fields.join(',') + '}');\r\n      },\r\n      str2obj5: function(parent,key,str){\r\n        parent[key] = {};\r\n        tgt = parent[key];\r\n        var fields = str.replace(/\\/\\/.*/mg,'').replace(/\\n/g,',').split(',');\r\n        for (var i=0;i<fields.length;i++) {\r\n          if (fields[i]=='') continue;\r\n          var idx = fields[i].indexOf(':'); // tags never contains ':'\r\n          var name = (idx!=-1)? fields[i].substr(0,idx) : 'DEFAULT';\r\n          if (tgt[name]===undefined) tgt[name] = [];\r\n          tgt[name][tgt[name].length] = (fields[i][idx+1]==='/')? new RegExp(fields[i].substr(idx+2,fields[i].lastIndexOf('/')-idx-2),fields[i].substr(fields[i].lastIndexOf('/')+1)) :\r\n                                        (key==='ex_list_obj5')? new RegExp(fields[i].substr(idx+1).replace(/\\*/g,'.*')) :\r\n                                                                new RegExp(fields[i].substr(idx+1).replace(/\\*/g,'\\\\S*(\\\\s|$)'),'g');\r\n//          tgt[name][tgt[name].length] = new RegExp('#'+(fields[i][idx]==='/')? fields[i].substr(idx+1) :\r\n//                                                                               fields[i].substr(idx+1).replace(/\\*/,'.*'));\r\n        }\r\n      },\r\n      merge_obj5: function(name,obj,val){\r\n        return this.merge_obj5_all(name,obj,val,this.merge_obj5_1);\r\n      },\r\n      merge_obj5a: function(name,obj,val){\r\n        return this.merge_obj5_all(name,obj,val,this.merge_obj5_1a);\r\n      },\r\n      merge_obj5_all: function(name,obj,val,func){\r\n        var dbt = common_func.fullname2dbt(name);\r\n        val = func(val,obj,'DEFAULT');\r\n        val = func(val,obj,dbt[0]); // domain\r\n        val = func(val,obj,dbt[1]); // board\r\n        val = func(val,obj,dbt[0]+dbt[1]); // domain+board\r\n        val = func(val,obj,dbt[2]); // thread\r\n        val = func(val,obj,dbt[0]+dbt[2]); // domain+thread\r\n        val = func(val,obj,dbt[1]+dbt[2]); // board+thread\r\n        val = func(val,obj,name);\r\n        return val;\r\n      },\r\n      merge_obj5_1: function(val,obj,key){\r\n        if (obj[key]) {\r\n          var obj_key = obj[key];\r\n//          if (Array.isArray(obj_key)) return obj_key.concat(val || []);\r\n          if (!val) val = {};\r\n          if (val.hit!==undefined) val.hit = true;\r\n          for (var i in obj_key)\r\n            if (typeof(obj_key[i])!=='object') val[i] = obj_key[i];\r\n            else {\r\n              if (val[i]===undefined) val[i]={};\r\n              for (var j in obj_key[i]) val[i][j] = obj_key[i][j]; // 2nd level.\r\n            }\r\n        }\r\n        return val;\r\n      },\r\n      merge_obj5_1a: function(val,obj,key){\r\n        return (obj[key])? obj[key].concat(val || []) : val;\r\n      },\r\n      str2obj6: function(parent,key,val,name){\r\n        var obj_hier  = pref_func.get_tgt(name, pref3);\r\n        obj_hier[0][obj_hier[1]](obj_hier[0],key,val);\r\n      },\r\n      obj_init_hier: function(dst, src){\r\n        for (var i in dst) {\r\n          if (typeof(dst[i])==='object' && src[i]) this.obj_init_hier(dst[i], src[i]); // stopped by null.\r\n          else if (typeof(dst[i])==='function') dst[i](dst, i, src[i]);\r\n        }\r\n      },\r\n      obj_init: function(){\r\n        pref_func.str2obj('catalog_board_list_str');\r\n        pref_func.str2obj2(pref.catalog,'style_general_list_obj2',pref.catalog.style_general_list_str);\r\n        pref_func.str2obj2(pref.catalog.board,'ex_list_obj2',pref.catalog.board.ex_list_str);\r\n        pref_func.str2obj4(pref.liveTag, 'style_urtm_obj4', pref.liveTag.style_urtm_str);\r\n        pref_func.str2obj4(pref.liveTag, 'style_ur_obj4',   pref.liveTag.style_ur_str);\r\n        pref_func.str2obj4(pref.liveTag, 'style_in_obj4',   pref.liveTag.style_in_str);\r\n        pref_func.str2obj5(pref.liveTag, 'ex_list_obj5',    pref.liveTag.ex_list_str);\r\n        pref_func.str2obj5(pref.liveTag, 'rm_list_obj5',    pref.liveTag.rm_list_str);\r\n        pref_func.settings.onchange_funcs['archive.kwd.*']();\r\n        this.obj_init_hier(pref3, pref);\r\n      },\r\n      obj_elim_the_same: function(dst,src, not_root){\r\n        var flag = true;\r\n        for (var i in dst) {\r\n          if (typeof(dst[i])==='object' && src[i] && typeof(src[i])==='object') { // eliminates objects made by program automatically because original object are vacant.\r\n            if (pref_func.obj_elim_the_same(dst[i],src[i],true)) delete dst[i];\r\n            else {\r\n              flag = false;\r\n              if (Array.isArray(dst[i]) || Array.isArray(src[i])) dst[i] = src[i];\r\n            }\r\n          } else {\r\n            if (dst[i]===src[i]) delete dst[i];\r\n            else {dst[i]=src[i];flag = false;}\r\n          }\r\n        }\r\n        if ((Array.isArray(dst) || Array.isArray(src)) && dst.length!==src.length) flag = false;\r\n        return (not_root)? flag : dst;\r\n      },\r\n      site2_json_ex_remove: function(){\r\n        var pref_test = pref_default();\r\n        delete pref_test.catalog_board_list_obj;\r\n        delete pref_test.catalog.style_general_list_obj2;\r\n        delete pref_test.catalog.board.ex_list_obj2;\r\n        delete pref_test.liveTag.style_urtm_obj4;\r\n        delete pref_test.liveTag.style_ur_obj4;\r\n        delete pref_test.liveTag.style_in_obj4;\r\n        delete pref_test.liveTag.ex_list_obj5;\r\n        delete pref_test.liveTag.rm_list_obj5;\r\n        delete pref_test.notify.sound.file;\r\n        delete pref_test.archive.json;\r\n        delete pref_test.archive.dir;\r\n        delete pref_test.archive.dir_dled;\r\n        if (pref_test.settings) delete pref_test.settings;\r\n//        if (pref_test.graph) delete pref_test.graph;\r\n        pref_func.obj_elim_the_same(pref_test,pref);\r\n        return pref_test;\r\n      },\r\n      site2_json_ex: function(full, filter){\r\n        var pref_test = this.site2_json_ex_remove();\r\n        if (!filter) if (pref_test.catalog.filter) delete pref_test.catalog.filter;\r\n        if (!full) if (pref_test.catalog_board_list_str) delete pref_test.catalog_board_list_str;\r\n        if (pref_test.overwrite_site2_json_str) delete pref_test.overwrite_site2_json_str;\r\n        if (!filter) pref.overwrite_site2_json_str = '{\"pref\":' + JSON.stringify(pref_test) + '}';\r\n        else pref.overwrite_site2_json_str = '{\"pref\":{\"catalog\":{\"filter\":' + JSON.stringify(pref_test.catalog.filter) + '}}}';\r\n      },\r\n      pref_overwrite: function(dst,src,strict){\r\n        for (var i in src)\r\n          if (dst[i]!==undefined) {\r\n            if (strict && typeof(src[i])!==typeof(dst[i])) continue;\r\n            if (typeof(src[i])==='object' && !Array.isArray(src[i])) pref_func.pref_overwrite(dst[i],src[i],strict);\r\n//            else dst[i] = src[i];\r\n            else if (dst[i]!==src[i]) dst[i] = src[i]; // utilize prototype\r\n          }\r\n      },\r\n      pref_query: function(ref,src){\r\n        var str = '';\r\n        for (var i in src) {\r\n          if (ref[i]!==undefined) {\r\n            str += '\"' + i + '\":' +\r\n                   ((typeof(src[i])==='object' && !Array.isArray(src[i]))? pref_func.pref_query(ref[i],src[i]) :\r\n                                                                           JSON.stringify(ref[i]))\r\n                 + ',';\r\n          }\r\n        }\r\n        return '{' + str.substr(0,str.length-1) + '}';\r\n      },\r\n      site2_json: function(query, disable_others, disable_site3){\r\n        var pn_out = document.getElementsByName('JSON_result')[0];\r\n        if (pn_out) pn_out.style = {};\r\n        try { \r\n          if (pref.overwrite_site2_json_str!=='') {\r\n            var fields = pref.overwrite_site2_json_str.split('\"');\r\n            var i=0;\r\n            while (i<fields.length) {\r\n              if (fields[i].search(/\\/\\/.*/)!=-1) {\r\n                while (i+1<fields.length && fields[i].search(/\\/\\/[^\\n]*\\n/)==-1) fields[i] += fields.splice(i+1,1);\r\n                fields[i] = fields[i].replace(/\\/\\/[^\\n]*(\\n|$)/,'');\r\n              } else i+=2;\r\n            }\r\n            var str = fields.join('\"');\r\n            var ex_count = 0;\r\n            var str_out = '';\r\n            var count = 0;\r\n            var start = 0;\r\n            for (var j=0;j<str.length;j++) { // can handle multiple JSON.\r\n              if (count==0 && str[j]!=='{' && str[j]!==' ' && str[j]!=='\\n') ex_count++;\r\n              if (str[j]==='{') count++;\r\n              if (str[j]==='}' && --count==0) {\r\n                var obj = JSON.parse(str.substr(start,j-start+1))\r\n                for (var i in obj)\r\n                  if ((!disable_others && (i==='site2' || i==='pref' || i==='pref_func' || i=='liveTag')) || (!disable_site3 && i==='site3'))\r\n                    if (!query) pref_func.pref_overwrite(eval(i),obj[i]);\r\n                    else str_out = '{\"' + i + '\":' + pref_func.pref_query(eval(i),obj[i]) + '}';\r\n                start = j+1;\r\n              }\r\n            }\r\n\r\n//            if (str!=='') { // working code.\r\n//            if (str.indexOf('{')!=-1) {\r\n//              var obj = JSON.parse(str);\r\n//              for (var i in obj)\r\n//                if (i==='site2' || i==='pref' || i==='pref_func') pref_func.pref_overwrite(eval(i),obj[i]);\r\n//            }\r\n////          if (pref.overwrite_site2_json_str!=='') { // working code\r\n//////            var str = pref.overwrite_site2_json_str.replace(/\\/\\/.*/mg,'').replace(/\\n/g,'');\r\n////            var fields = pref.overwrite_site2_json_str.split('\"');\r\n////            for (var i=0;i<fields.length;i+=2) {\r\n////              if (fields[i].search(/\\/\\/.*/)!=-1) {\r\n////                if (fields[i].search(/\\n/)!=-1 || i+1==fields.length) fields[i] = fields[i].replace(/\\/\\/[^\\n]*(\\n|$)/,'');\r\n////                else {\r\n//////                  while (i+1<fields.length && fields[i].search(/\\n/)==-1) fields[i++]='';\r\n////                  while (i+1<fields.length && fields[i].search(/\\n/)==-1) fields.splice(i,1);\r\n////                  if (i<fields.length) fields[i] = fields[i].replace(/[^\\n]*(\\n|$)/,'');\r\n////                }\r\n////              }\r\n////            }\r\n////            var str = fields.join('\"');\r\n////            var count = 0;\r\n////            var start = 0;\r\n////            for (var j=0;j<str.length;j++) {\r\n////              if (str[j]==='{') count++;\r\n////              if (str[j]==='}') {\r\n////                count--;\r\n////                if (count==0) {\r\n////                  var str_tmp = str.substr(start,j-start+1);\r\n////                  if (str_tmp!=='') {\r\n////                    var obj = JSON.parse(str_tmp);\r\n////                    for (var i in obj)\r\n////                      if (i==='site2' || i==='pref' || i==='pref_func') pref_func.pref_overwrite(eval(i),obj[i]);\r\n////                  }\r\n////                  start = j+1;\r\n////                }\r\n////              }\r\n////            }\r\n//////            if (str!=='') pref_func.pref_overwrite(site2,JSON.parse(str));\r\n//////            if (str!=='') {\r\n//////              var obj = JSON.parse(str);\r\n//////              for (var i in obj)\r\n//////                if (i==='site2' || i==='pref' || i==='pref_func') pref_func.pref_overwrite(eval(i),obj[i]);\r\n//////            }\r\n            if (pn_out) {\r\n              pn_out.textContent = ((ex_count!=0)? 'OK, but there are extra useless strings, ' :\r\n                                    (count!=0)? 'OK, but there are non-closed brackets, ' :\r\n                                    'OK, ') + new Date().toLocaleString();\r\n              pn_out.style.color = '';\r\n              if (str_out!=='') {\r\n                document.getElementsByName('overwrite_site2_json_str')[0].value = str_out;\r\n                pref.overwrite_site2_json_str = str_out;\r\n              }\r\n            }\r\n          }\r\n        } catch (e) {\r\n          if (pn_out) {\r\n            pn_out.textContent = 'ERROR!!!, ' + new Date().toLocaleString();\r\n            pn_out.style.color = 'red';\r\n          }\r\n          console.log('ERROR in overwtite strings:');\r\n          console.log(pref.overwrite_site2_json_str);\r\n          console.log(e);\r\n        }\r\n      },\r\n      site2_eval: function(){\r\n//        try { \r\n//          if (pref.overwrite_site2_eval_str!=='') eval(pref.overwrite_site2_eval_str);\r\n//        } catch (e) {\r\n//          console.log('ERROR in overwtite strings:');\r\n//          console.log(pref.overwrite_site2_eval_str);\r\n//          console.log(e);\r\n//        }\r\n      },\r\n      tooltips: (function(){\r\n        var tooltip = document.createElement('div');\r\n        tooltip.style.position = 'fixed';\r\n////        tooltip.style.background = '#e5f4f9';\r\n////        tooltip.style.color = '#000000';\r\n////        tooltip.style.border = '2px solid blue';\r\n        tooltip.setAttribute('class', pref.script_prefix+'_popUp');\r\n        tooltip.style.fontWeight = 'normal';\r\n        tooltip.style.zIndex = 100;\r\n        var tooltip_on = null;\r\n        var kind_of_tips = 'help';\r\n        var func = {};\r\n        var show_timer = null;\r\n        var hide_timer = null;\r\n//        var str_tooltip = '';\r\n\r\n        function add_hier(pn){\r\n          var all = pn.getElementsByTagName('*');\r\n//          if (pref.test_mode.tips) for (var i=0;i<all.length;i++) if (!str[all[i].name]) str[all[i].name] = 'Name: ' + all[i].name;\r\n//          for (var i=0;i<all.length;i++) if (all[i].name) add(all[i]); // span can't return if .name\r\n          for (var i=0;i<all.length;i++) {\r\n            var name = all[i].getAttribute('name');\r\n            if (name && (str[name] || (str[name]!==false && pref.test_mode.tips))) add(all[i]);\r\n          }\r\n        }\r\n        function remove_hier(pn){\r\n          var all = pn.getElementsByTagName('*');\r\n//          for (var i=0;i<all.length;i++) if (all[i].name) remove(all[i]);\r\n          for (var i=0;i<all.length;i++) if (all[i].hasAttribute('name')) remove(all[i]);\r\n        }\r\n        function add(elem){\r\n////          if (str.hasOwnProperty(elem.name)) {\r\n            if (!func.hasOwnProperty(elem.name)) func[elem.name] = [];\r\n            func[elem.name].push(elem);\r\n            elem.addEventListener('mouseover', show, false);\r\n////          }\r\n        }\r\n        function remove(elem){\r\n          if (func.hasOwnProperty(elem.name)) {\r\n            var elems = func[elem.name];\r\n            for (var i=0;i<elems.length;i++) {\r\n              if (elem===elems[i]) {\r\n                elem.removeEventListener('mouseover', show, false);\r\n                elems.splice(i,1);\r\n                if (elems.length==0) delete func[elem.name];\r\n                break;\r\n              }\r\n            }\r\n//            for (var i=0;i<elems.length;i++) {\r\n//              var elem = func[elem.name][i];\r\n//              elem.removeEventListener('mouseover', show, false);\r\n//            }\r\n//            delete func[elem.name];\r\n          }\r\n        }\r\n        function add_root(elem){\r\n          elem.addEventListener('mouseover', show, false);\r\n        }\r\n        function remove_root(elem){\r\n          elem.removeEventListener('mouseover', show, false);\r\n        }\r\n        function show(e){\r\n          if (!pref.tooltips.help.show) return;\r\n          var str_tooltip = null;\r\n          var name = e && (e.target.name || e.target.getAttribute('name')) || this.name;\r\n          if (!name && e.target.tagName==='LABEL') name = e.target.childNodes[0].name;\r\n          if (name==='SHOW2_I') name = e.target.previousSibling.childNodes[1].getAttribute('name');\r\n          if (name==='SHOW2') name = e.target.childNodes[1].getAttribute('name');\r\n          if (!name) return; // for add_root\r\n//          var name = this.name || this.getAttribute('name')); // for add_hier\r\n////          for (var i in str_func) if (this.name.indexOf(i)==0) {\r\n////            str_tooltip = str_func[i](this,e);\r\n////            break;\r\n////          }\r\n          if (str_tooltip===null) {\r\n            str_tooltip = (typeof(str[name])==='function')? str[name]() : str[name];\r\n//            if (!str_tooltip) str_tooltip = str[this.parentNode.name];\r\n            if (!str_tooltip) str_tooltip = str[name.substr(0,name.lastIndexOf('.')+1)+'*'];\r\n            if (!str_tooltip) str_tooltip = str_hier(str,name,'') || '';\r\n            if (pref.test_mode.tips) str_tooltip = 'Name: ' + name + '\\n' + str_tooltip;\r\n            str_tooltip = str_tooltip.replace(/\\n/mg,'<br>').replace(/  /g,'&emsp;');\r\n          }\r\n          if (name[0]==='#') {str['#*'](e, str_tooltip);return;}\r\n          if (str_tooltip) show_1.call(this,e,str_tooltip);\r\n        }\r\n        function show_1(e,str_tooltip, callback, info_tips){\r\n          kind_of_tips = (info_tips)? 'info' : 'help';\r\n          if (!pref.tooltips[kind_of_tips].show) return;\r\n          tooltip.innerHTML = str_tooltip;\r\n          if (callback) callback(tooltip);\r\n          if (hide_timer!==null) {clearTimeout(hide_timer);hide_timer=null;} // test\r\n          if (!e || tooltip_on===e.target) return;\r\n          tooltip.style.left = e.clientX + 20 + 'px';\r\n          tooltip.style.top  = e.clientY + 20 + 'px';\r\n//          if (hide_timer!==null) {clearTimeout(hide_timer);hide_timer=null;}\r\n          if (tooltip_on) tooltip_on.removeEventListener('mouseout' ,hide, false);\r\n          else {\r\n            if (show_timer!==null) clearTimeout(show_timer);\r\n            show_timer = setTimeout(show_exe,pref.tooltips[kind_of_tips].popup_delay);\r\n          }\r\n          tooltip_on = e.target;\r\n          this.addEventListener('mouseout' , hide, false);\r\n        }\r\n        function show_exe(elem){\r\n          site.root_body.appendChild(tooltip);\r\n          show_timer = null;\r\n        }\r\n//        function show(e){\r\n//          tooltip.style.left = e.clientX + 20 + 'px';\r\n//          tooltip.style.top  = e.clientY + 20 + 'px';\r\n//          tooltip.innerHTML = str[this.name].replace(/\\n/mg,'<br>').replace(/  /g,'&emsp;');\r\n//          if (!tooltip_on) site.root_body.appendChild(tooltip);\r\n//          else {\r\n//            if (hide_timer!==null) {clearTimeout(hide_timer);hide_timer=null;}\r\n//            tooltip_on.removeEventListener('mouseout' ,hide, false);\r\n//          }\r\n//          tooltip_on = this;\r\n//          this.addEventListener('mouseout' , hide, false);\r\n//        }\r\n        function hide(){ // called from both event and external function.\r\n          if (hide_timer===null) hide_timer = setTimeout(hide_exe,pref.tooltips[kind_of_tips].popdown_delay);\r\n        }\r\n        function hide_exe(){\r\n          if (tooltip_on) {\r\n            if (show_timer===null) tooltip.parentNode.removeChild(tooltip);\r\n            else {clearTimeout(show_timer);show_timer=null;}\r\n            tooltip_on.removeEventListener('mouseout' ,hide, false);\r\n            tooltip_on = null;\r\n          }\r\n          hide_timer = null;\r\n        }\r\n//        add_hier: function(pn){\r\n//          var all = pn.getElementsByTagName('*');\r\n////          for (var i=0;i<all.length;i++) if (!pref_func.tooltips.str[all[i].name]) pref_func.tooltips.str[all[i].name] = 'Name: ' + all[i].name;\r\n//          for (var i=0;i<all.length;i++) if (all[i].name) pref_func.tooltips.add(all[i]);\r\n//        },\r\n//        remove_hier: function(pn){\r\n//          var all = pn.getElementsByTagName('*');\r\n//          for (var i=0;i<all.length;i++) if (all[i].name) pref_func.tooltips.remove(all[i]);\r\n//        },\r\n//        add: function(elem){\r\n//          if (elem.name in pref_func.tooltips.str) {\r\n//            if (!(elem.name in pref_func.tooltips.func)) pref_func.tooltips.func[elem.name] = [];\r\n//            pref_func.tooltips.func[elem.name].push(elem);\r\n//            elem.addEventListener('mouseover',pref_func.tooltips.show,false);\r\n//            elem.addEventListener('mouseout' ,pref_func.tooltips.hide,false);\r\n//          }\r\n//        },\r\n//        remove: function(elem){\r\n//          if (pref_func.tooltips.func[elem.name]) {\r\n//            var elems = pref_func.tooltips.func[elem.name];\r\n//            for (var i=0;i<elems.length;i++) {\r\n//              var elem = pref_func.tooltips.func[elem.name][i];\r\n//              elem.removeEventListener('mouseover',pref_func.tooltips.show,false);\r\n//              elem.removeEventListener('mouseout' ,pref_func.tooltips.hide,false);\r\n//            }\r\n//            delete pref_func.tooltips.func[elem.name];\r\n//          }\r\n//        },\r\n//        show: function(e){\r\n//          tooltip.style.left = e.clientX + 20 + 'px';\r\n//          tooltip.style.top  = e.clientY + 20 + 'px';\r\n//          tooltip.innerHTML = pref_func.tooltips.str[this.name].replace(/\\n/mg,'<br>').replace(/  /g,'&emsp;');\r\n//          if (!tooltip_on) site.root_body.appendChild(tooltip);\r\n//          tooltip_on = this.name;\r\n//        },\r\n//        hide: function(){\r\n//          if (tooltip_on) site.root_body.removeChild(tooltip);\r\n//          tooltip_on = null;\r\n//        },\r\n////        var str_func = {\r\n////          '#': function(sender,e){return liveTag.tooltip(sender,e);},\r\n////        };\r\n        function str_hier(root,name){\r\n          if (!root) return null; // cancel if miss\r\n          var idx = name.indexOf('.');\r\n          return (idx==-1)? root[name] || root['*'] || null :\r\n                            str_hier(root[name.substr(0,idx)],name.substr(idx+1));\r\n        }\r\n//        function str_hier(root,name,str){ // working code.\r\n//          if (!root) return null; // cancel if miss\r\n//          var idx = name.indexOf('.');\r\n//          if (idx==-1 || root['*']) {\r\n//            var val = root[name] || root['*'];\r\n//            return (val)? str + name + ': ' + val : null; // cancel if miss\r\n//          } else {\r\n//            var pfx = name.substr(0,idx);\r\n//            return str_hier(root[pfx],name.substr(idx+1),str+pfx+'.');\r\n//          }\r\n//        }\r\n        var str = {\r\n//          'pn_catalog_triage': 'hide forever, hide until new replies, watch, unwatch, undo.\\n'+\r\n//                               'You can customize this in settings -> Catalog: Appearance (in top selector) -> Style:',\r\n////          'pn_catalog_triage': '1st row: Hide it forever.\\n2nd row: Hide it now, but it will appear again when the thread gets new replies,\\n' +\r\n////            '  and new replies are marked.\\n3rd row: Don\\'t hide it, just change its appearance.\\n' +\r\n////            'Each column shows appearance the thread will get.\\n' +\r\n////            'Don\\'t forget checking \\'Exclusive list\\' and \\'Attribute list\\' for using this function.\\n' +\r\n////            'In other words, you can appear it again by unckecking them.\\nAnd you can configure these appearance in \\'Attribute list\\' and \\'Triage styles\\'.',\r\n          'catalog_refresh_clear': 'Clear all threads at update.',\r\n          'catalog_promiscuous': 'Gather information whatever.',\r\n          catalog: {\r\n            filter: {\r\n              kwd: {\r\n                re: 'Regular Expression.',\r\n                ci: 'Case insensitive. Don\\'t distinguish uppercase and lowercase.',\r\n                sentence: '\"XXXX YYYY\" matches itself instead of matching \"XXXX\" and/or \"YYYY\"',\r\n              },\r\n              time: 'Time : Hide threads which have no posts after the time.',\r\n              time_creation: 'Time(Creation Time) : Hide threads which are created before the time.',\r\n              time_watch: 'Watch: watch threads which have posts after the time.',\r\n              time_watch_creation: 'Watch(Creation Time): watch threads which are created after the time.',\r\n            }\r\n          },\r\n//          'catalog.filter.time_mark': 'Mark: mark newer posts and scrool to them when it\\'s opened.',\r\n          'catalog.filter.tag_search.str': 'String for searching tags.',\r\n          'catalog.filter.tag_list': false,\r\n          'catalog_cross_domain_connection': 'Use \\'direct\\' if you could, because it\\'s quite light, but it doesn\\'t work in almost of all environments.\\n\\'indirect\\' usually works well.',\r\n          'debug_mode' : 'Debug mode.',\r\n          'show_tooltip' : 'Show this tooltip.',\r\n          'liveTag.rm_list_str': function(){return this.TagExLists();},\r\n          'liveTag.ex_list_str': function(){return this.TagExLists();},\r\n          'TagExLists': function(){return 'String, ...  or\\n/RegularExpression/, ... or \\nIdentifier:String, ... or \\nIdentifier:/RegularExpression/, ...\\n'+\r\n            '\\nRegularExpression must be embraced by shashes.\\n'+\r\n            'String list is applied BEFORE extraction, so it costs more than tag list which is applied AFTER extraction. Regular expression in string list accepts flags, so don\\'t forgot to add \\'g\\' flag for usual work, like /some_regexp/g, or it removes the first match only. You can remove both cases using \\'i\\' flag.\\n'+this.GeneralRules;},\r\n          'catalog_board_list_str': function(){return 'How to write \\'Board groups\\'.\\n'+\r\n            '\\nName,Identifier, ...\\n\\n'+\r\n            'First column is a name of board group. The name is shown on the top right corner of catalog and become a key when you store its filter setting to local Storage.\\n'+\r\n            'Second or later columns are members. Each member is expressed by \\'Identifier\\'. Each line becomes each board group.\\n'+\r\n            'You can add tags for filtering or picking up threads. Single # means filter, double #(##) means pick up and filter. For example,\\n\\n'+\r\n            'CC, lain/\\u03bb/, #CatChan // load lain/\\u03bb/ and filter by #CatChan, then shows a thread for CatChan in lain/\\u03bb/.\\n'+\r\n            'lain#lainchan, lain, #lainchan // load all boards of lain and filter by #lainchan, then show all threads which have the tag(#lainchan).\\n'+\r\n            '#tech, ##tech // load all boards which have #tech from sites which are set in VirtualBoard, and filter by #tech, then show all threads which have the tag(#tech) from sites.\\n'+\r\n            'And you can add commands to the last of each line. \\'!stats\\' takes statistics if the function is enabled.\\n'+\r\n            this.GeneralRules;},\r\n          'GeneralRules': 'Double slash(//) is a beginning of comment.\\n\\n'+\r\n            'Identifier:\\n'+\r\n            'Identifier is a string which contains domain, board and/or thread. You can omit some of them. When some identifiers are dropped, it\\'ll be interpreted as follows. Upper case has the priority.\\n'+\r\n            '\\n'+\r\n            'domain/board/thread\\n'+\r\n            '/board/thread\\n'+\r\n            'domain/thread\\n'+\r\n            'thread\\n'+\r\n            'domain/board/\\n'+\r\n            '/board/\\n'+\r\n            'domain\\n'+\r\n            '\\n'+\r\n            '\\'Board identifier\\' must be expressed in a couple of slashes, like /int/. \\'Thread identifier\\' must be numeric. If the identifier is a word, it\\'ll be treated as a \\'Thread identifier\\' if it is numeric, or it\\'ll be a \\'Domain identifier\\'. '+\r\n            'Domain identifiers must be one of meguca, lain, 4chan, 8chan or KC',\r\n          'catalog.style_general_list_str' : function(){return 'Identifier^Style_string\\n'+\r\n            'Style_string is a string and set to its object.style.XXXX. Therefore you can use all of styles in CSS, which ranges from \\'background\\' or \\'border\\' to \\'fontSize\\', \\'width\\' or \\'height\\'\\n'+ this.GeneralRules;},\r\n//            'About Identifier, see \\'board group\\'.',\r\n          'catalog.board.recommendation' : 'Scans \\'board announcement\\' and gets owner\\'s recommendation. This recommendation must be start \\'Recommendation: \\', and the following part of the line is treated as a line of board groups. The recommendation can be seen in a last line of board groups.',\r\n          'catalog_triage_str': '// 1st column :\\n'+\r\n            '//   KILL : delete forever, and set its style.\\n'+\r\n            '//   TIME : delete until the thread gets new replies, and set its style.\\n'+\r\n            '//   NONE : Don\\'t hide the thread and set its style.\\n'+\r\n            '//   KILL_N : delete forever.\\n'+\r\n            '//   TIME_N : delete until the thread gets new replies.\\n'+\r\n            '//   ATTR : Set its style additionally.\\n'+\r\n            '//   UNDO : undo the last modification.\\n'+\r\n            '//   WATCH : watch this thread, or I\\'ve read all replies in this thread.\\n'+\r\n            '//   UNWATCH : unwatch this thread.\\n'+\r\n            '//   STICKY : sticky this thread.\\n'+\r\n            '//   UNSTICKY : unsticky this thread.\\n'+\r\n            '//   SHOW : show this thread always without regard to filter setteings.\\n'+\r\n            '//   UNSHOW : remove \\'show\\' mark.\\n'+\r\n            '// 2nd column : strings in the button.\\n'+\r\n            '// 3rd column : style in HTML.\\n'+\r\n            '// Repeat these as you wish.',\r\n          'overwrite_site2_eval_str' : 'For developers. This function is killed by security reason. If you want to use, you must uncomment the function \\'pref_func.site2_eval\\' by yourself.',\r\n          'thread_reader.buttons.B' : 'Bookmark this thread to current catalog.',\r\n          'thread_reader.buttons.UB': 'Unbookmark this thread from current catalog.',\r\n          'thread_reader.buttons.X' : function(){return 'Kill this thread from parent catalog' + ((pref.thread_reader.triage_close)? ', and close.' : '.');},\r\n          'thread_reader.buttons.v' : function(){return 'Hide this thread from parent catalog untill it gets new posts' + ((pref.thread_reader.triage_close)? ', and close.' : '.');},\r\n          'catalog_open_where' : 'this tab: open the thread in this tab, and catalog will be closed.\\nnew tab always: this enables you to open a thread in multiple tabs.\\nnamed tab: this prevents you from opening a thread in multiple tabs.\\na fixed tab: this enables you to use a catalog window as a dashboard.',\r\n          'virtualBoard.scan_domains.*': 'None: Don\\'t scan.\\nBoard: Read boards.json and set them to boardlist, not scan threads at startup. Threads are scanned when you read them.\\nThread: Scan all threads at startup.',\r\n          'scanBoard': 'Scan selected virtual boards.\\nScan this physical board if no virtual board is selected.',\r\n          'scanSite': 'Scan all virtual boards.\\nScan all boards in this site if no virtual board is selected.',\r\n          'style.fix.*': 'Write style strings.',\r\n          'style.copy.*': 'Write exact selectorText in CSS, then its styles are copied.',\r\n          debug_mode:['pipe','','removed threads from catalog'],\r\n          dummy: '',\r\n          archive: {kwd: null},\r\n          '#*': function(e, str){liveTag.tooltip(e, str);},\r\n        };\r\n        str.archive.kwd = str.catalog.filter.kwd;\r\n        str['catalog.filter.tag_search.re'] = str.catalog.filter.kwd.re;\r\n        Object.defineProperty(str,'catalog_triage_str',{value:str['catalog_triage_str'], enumerable:true, configurable:true, writable:false});\r\n        return {\r\n          add_hier: add_hier,\r\n          remove_hier: remove_hier,\r\n          add_root: add_root,\r\n          remove_root: remove_root,\r\n//          add: add,\r\n//          remove: remove,\r\n          show: show,\r\n          show_1: show_1,\r\n          hide: hide,\r\n          str: str\r\n        }\r\n      })(),\r\n      pref_samples : {\r\n        simple: {\r\n          catalog_triage_str: 'KILL,X,',\r\n          catalog : {style_general_list_str:'%border:4px solid #d6daf0\\n%margin:4px',\r\n                     format : {show:{posts:true}}},\r\n        },\r\n        backwash: {\r\n          catalog_triage_str :\r\n            'NONE,O,width:;height:,NONE,O,border:4px solid #ff0000;width:100px;height:100px,NONE,O,border:4px solid #00ff00;width:100px;height:100px,'+\r\n            'NONE,O,border:4px solid #0000ff;width:100px;height:100px,NONE,O,border:4px solid #ffff00;width:100px;height:100px,'+\r\n            'NONE,O,border:4px solid #ff00ff;width:100px;height:100px,NONE,O,border:4px solid #00ffff;width:100px;height:100px',\r\n          catalog_expand_at_initial : true,\r\n          page:{click:'expand'},\r\n          catalog:{format: {show:  {style:  true, contents:  true, layout:  true, posts: true, fileinfo: true, images_2nd: true}}},\r\n        },\r\n        recommend: {\r\n          max_threads_at_refresh : 500,\r\n          catalog: {\r\n            auto_load_filter: true,\r\n            auto_save_filter: true,\r\n            auto_save_filter_at_refresh: true,\r\n            order: {\r\n              sticky:'first',\r\n//              find_sage_in_8chan: true\r\n            },\r\n            board: {board_tags_same: true},\r\n            auto_update : true,\r\n            auto_update_period : 1,\r\n          },\r\n          page:{auto_update:true, auto_update_period:1},\r\n          float:{auto_update:true, auto_update_period:1},\r\n        },\r\n        get easy2(){return pref.easy2;},\r\n        'easy2.presets': (function(){\r\n          var presets = [\r\n            {liveTag: {use:false, scan:false}, LTfrom:0, VB:{local:0, global:0}, network:{fetch_actively:false}},\r\n            {liveTag: {use:false, scan:true }, LTfrom:0, VB:{local:1, global:0}, network:{fetch_actively:false}},\r\n            {liveTag: {use:false, scan:true }, LTfrom:0, VB:{local:1, global:1}, network:{fetch_actively:false}},\r\n            {liveTag: {use:true,  scan:true }, LTfrom:0, VB:{local:2, global:0}, network:{fetch_actively:true }},\r\n            {liveTag: {use:true,  scan:true }, LTfrom:0, VB:{local:2, global:1}, network:{fetch_actively:true }},\r\n            {liveTag: {use:true,  scan:true }, LTfrom:0, VB:{local:2, global:2}, network:{fetch_actively:true }},\r\n            {liveTag: {use:true,  scan:true }, LTfrom:1, VB:{local:2, global:0}, network:{fetch_actively:true }},\r\n            {liveTag: {use:true,  scan:true }, LTfrom:1, VB:{local:2, global:1}, network:{fetch_actively:true }},\r\n            {liveTag: {use:true,  scan:true }, LTfrom:1, VB:{local:2, global:2}, network:{fetch_actively:true }},\r\n          ];\r\n          var vb_kwd = ['none','board','thread'];\r\n          var basics = {\r\n            catalog:{auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, draw_on_demand:true,},\r\n            page:{draw_on_demand:true, load_on_demand:true},\r\n          };\r\n          return function(idx){\r\n            var easy2 = pref.easy2;\r\n            if (idx!==undefined) pref_func.pref_overwrite(easy2, presets[idx]);\r\n            easy2.virtualBoard.scan_domains = {};\r\n            for (var i in pref.virtualBoard.scan_domains) easy2.virtualBoard.scan_domains[i] = vb_kwd[((i===site.nickname)? easy2.VB.local : easy2.VB.global)];\r\n            easy2.liveTag.from = (easy2.LTfrom===0)? 'op' : 'post';\r\n            var auto_update = {auto_update:pref.easy2.auto_update, auto_update_period:pref.easy2.auto_update_period};\r\n            if (easy2.catalog.embed)      pref_func.pref_overwrite(easy2,{catalog:auto_update});\r\n            if (easy2.catalog.embed_page) pref_func.pref_overwrite(easy2,{page:   auto_update});\r\n            if (easy2.thread.embed)       pref_func.pref_overwrite(easy2,{thread: auto_update});\r\n            if (easy2.catalog.filter.time_watch || easy2.catalog.filter.time_watch_creation)\r\n              easy2.catalog.filter.time_str = new Date(Date.now()-((easy2.catalog.filter.time_watch)?easy2.time_post:easy2.time_op)*3600000).toLocaleString();\r\n            if (pref.easy2.basics) pref_func.pref_overwrite(easy2, basics);\r\n            return easy2;\r\n          };\r\n        })(),\r\n        'easy2.limits': (function(){\r\n          var limits = [\r\n            {virtualBoard:{max:100}, scan:{max:  100, max_threads:  1000}, catalog:{max_threads_at_refresh:  500}}, // general\r\n            {virtualBoard:{max: 50}, scan:{max:  100, max_threads:  1500}, catalog:{max_threads_at_refresh: 1500}}, // lain, meguca\r\n            {virtualBoard:{max:150}, scan:{max:  100, max_threads: 15000}, catalog:{max_threads_at_refresh:15000}}, // 4chan\r\n            {virtualBoard:{max:100}, scan:{max:   50, max_threads: 15000}, catalog:{max_threads_at_refresh:15000}}, // 8chan, top 50\r\n            {virtualBoard:{max:150}, scan:{max:  100, max_threads: 30000}, catalog:{max_threads_at_refresh:15000}}, // 8chan, top 100\r\n            {virtualBoard:{max:200}, scan:{max:  500, max_threads:100000}, catalog:{max_threads_at_refresh:15000}}, // 8chan, top 500\r\n            {virtualBoard:{max:200}, scan:{max:10000, max_threads:100000}, catalog:{max_threads_at_refresh:15000}}, // 8chan, all\r\n            {virtualBoard:{max:150}, scan:{max:  100, max_threads: 15000}, catalog:{max_threads_at_refresh:15000}}, // KC\r\n          ];\r\n          return function(){\r\n            pref_func.pref_overwrite(pref.easy2, limits[pref.easy2.limits]);\r\n          }\r\n        })(),\r\n        'easy.virtualBoard_10_passive': {\r\n          virtualBoard: {show: true, scan: true, max:20},\r\n          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:10},\r\n          page:{auto_update:true, auto_update_period:10},\r\n          float:{auto_update:true, auto_update_period:10},\r\n          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'board' : 'none';},\r\n        },\r\n        'easy.virtualBoard_10': {\r\n          virtualBoard: {show: true, scan: true, max:20},\r\n          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:10},\r\n          page:{auto_update:true, auto_update_period:10},\r\n          float:{auto_update:true, auto_update_period:10},\r\n          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'none';},\r\n        },\r\n        'easy.virtualBoard_1': {\r\n          virtualBoard: {show: true, scan: true, max:100, scanDelay: 20},\r\n          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:1},\r\n          page:{auto_update:true, auto_update_period:1},\r\n          float:{auto_update:true, auto_update_period:1},\r\n          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'none';},\r\n        },\r\n        'easy.virtualBoard_8_50': {\r\n          virtualBoard: {show: true, scan: true, max:100, scanDelay: 20},\r\n//          scan:{max:50},\r\n          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:5},\r\n          page:{auto_update:true, auto_update_period:5},\r\n          float:{auto_update:true, auto_update_period:5},\r\n          func: function(){\r\n            pref.scan.max = pref.easy.max_boards;\r\n            for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'none';\r\n          },\r\n        },\r\n////        'easy.virtualBoard_8_100': {\r\n////          catalog_auto_update : true,\r\n////          catalog_auto_update_period : 5,\r\n////          virtualBoard: {show: true, scan: true, max:100, scanDelay: 20},\r\n////          scan:{max:100},\r\n////          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true},\r\n////          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'none';},\r\n////        },\r\n////        'easy.virtualBoard_8_500': {\r\n////          catalog_auto_update : true,\r\n////          catalog_auto_update_period : 5,\r\n////          virtualBoard: {show: true, scan: true, max:100, scanDelay: 20},\r\n////          scan:{max:500},\r\n////          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true},\r\n////          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'none';},\r\n////        },\r\n        'easy.virtualBoard_8_all': {\r\n          virtualBoard: {show: true, scan: true, max:100, scanDelay: 20},\r\n          scan:{max:10000},\r\n          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:5},\r\n          page:{auto_update:true, auto_update_period:5},\r\n          float:{auto_update:true, auto_update_period:5},\r\n          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'none';},\r\n        },\r\n        'easy.virtualBoard_interSite': {\r\n          virtualBoard: {show: true, scan: true, max:100, scanDelay: 20},\r\n          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:10},\r\n          page:{auto_update:true, auto_update_period:10},\r\n          float:{auto_update:true, auto_update_period:10},\r\n          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'board';},\r\n//          func: function(){for (var i in pref.virtualBoard.scan_domains) if (i!==site.nickname && pref.virtualBoard.scan_domains[i]==='none') pref.virtualBoard.scan_domains[i] = 'board';},\r\n        },\r\n        'easy.posts_0h': {\r\n          catalog:{filter:{time_str:null, time_watch:true}},\r\n          func: function(){pref_func.pref_samples['easy.posts_0h'].catalog.filter.time_str = new Date().toLocaleString();}\r\n        },\r\n        'easy.posts_24h': {\r\n          catalog:{filter:{time_str:null, time_watch:true}},\r\n          func: function(){pref_func.pref_samples['easy.posts_24h'].catalog.filter.time_str = new Date(Date.now()-pref.easy.posts_ago*3600000).toLocaleString();}\r\n        },\r\n        'easy.threads_24h': {\r\n          catalog:{filter:{time_str:null, time_watch_creation:true}},\r\n          func: function(){pref_func.pref_samples['easy.threads_24h'].catalog.filter.time_str = new Date(Date.now()-pref.easy.threads_ago*3600000).toLocaleString();}\r\n        },\r\n////        'easy.posts_48h': {\r\n////          catalog:{filter:{time_str:null, time_watch:true}},\r\n////          func: function(){pref_func.pref_samples['easy.posts_48h'].catalog.filter.time_str = new Date(Date.now()-48*3600000).toLocaleString();}\r\n////        },\r\n        'easy.embed_index': {\r\n          catalog:{embed_page:true, auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true},\r\n//          page:{draw_on_demand: false, load_on_demand: false},\r\n        },\r\n        'easy.embed_index_lazy': {\r\n          catalog:{embed_page:true, auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_watch:false},\r\n//          catalog_footer_show_nof_rep_to_me:false,\r\n          //          catalog_footer_show_nof_rep:false,\r\n          liveTag:{use:false},\r\n          notify:{desktop:{notify:false}},\r\n          network:{fetch_actively:false},\r\n//          page:{scan_tag:false},\r\n        },\r\n        'easy.light': {\r\n          catalog:{embed_page:true, auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true,\r\n                   draw_on_demand: true,\r\n                   filter:{time_watch:false, time_watch_creation:false},\r\n                  },\r\n          liveTag:{use:false},\r\n          stats:{use:false},\r\n          network:{fetch_actively:false},\r\n//          page:{scan_tag:false},\r\n        },\r\n        'easy.embed_index_infinite': {\r\n          catalog_max_page_auto:true,\r\n          catalog:{embed_page:true, auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true},\r\n        },\r\n        'easy.embed_index_backwash': {\r\n          catalog_max_page_auto:true,\r\n          catalog:{embed_page:true, auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:0},\r\n          page:{auto_update:true, auto_update_period:0},\r\n          float:{auto_update:true, auto_update_period:0},\r\n        },\r\n        'easy.stat_activate': {\r\n          stats:{use:true},\r\n          virtualBoard:{scan:true, scan_domains:{}},\r\n          liveTag:{use:true, from:'post'},\r\n          func: function(){this.virtualBoard.scan_domains[site.nickname] = 'board';},\r\n        },\r\n        triage_simple_kill: {\r\n          catalog_triage_str: 'KILL,X,',\r\n//          'pn_catalog_triage': 'hide forever.'\r\n        },\r\n        triage_simple: {\r\n          catalog_triage_str: 'KILL,X,,TIME,v,,WATCH,W,,UNWATCH,UW,,UNDO,U,',\r\n//          'pn_catalog_triage': 'hide forever, hide until new replies, watch, unwatch, undo.'\r\n        },\r\n        triage_basic: {\r\n          catalog_triage_str: 'KILL,X,,TIME,v,,WATCH,W,,UNWATCH,UW,,SHOW,\\u2605,,UNSHOW,\\u2606,,STICKY,S,,UNSTICKY,US,,UNDO,U,',\r\n        },\r\n        triage_basic_color: {\r\n          catalog_triage_str: 'KILL_N,X,,TIME_N,v,,WATCH,W,,UNWATCH,UW,,SHOW,\\u2605,,UNSHOW,\\u2606,,STICKY,S,,UNSTICKY,US,,UNDO,U,\\n'+\r\n            'NONE,O,,ATTR,O,background:#c3dcf9,ATTR,O,background:#b8efc2,'+\r\n            'ATTR,O,background:#efedbe,ATTR,O,background:#fbd5fb,ATTR,O,background:#fac2c5\\n'+\r\n            'ATTR,O,border:3px solid blue,ATTR,O,border:3px solid lime,'+\r\n            'ATTR,O,border:3px solid yellow,ATTR,O,border:3px solid orange,ATTR,O,border:3px solid red\\n',\r\n        },\r\n        triage_colorful: {\r\n          catalog_triage_str:\r\n            'KILL,X,,KILL,X,background:#c3dcf9,KILL,X,background:#b8efc2,'+\r\n            'KILL,X,background:#efedbe,KILL,X,background:#fbd5fb,KILL,X,background:#fac2c5\\n'+\r\n            'TIME,v,,TIME,v,background:#c3dcf9,TIME,v,background:#b8efc2,'+\r\n            'TIME,v,background:#efedbe,TIME,v,background:#fbd5fb,TIME,v,background:#fac2c5\\n'+\r\n            'NONE,O,,NONE,O,background:#c3dcf9,NONE,O,background:#b8efc2,'+\r\n            'NONE,O,background:#efedbe,NONE,O,background:#fbd5fb,NONE,O,background:#fac2c5\\n'+\r\n            'UNDO,U,,WATCH,W,,UNWATCH,UW,,GO,G,\\n',\r\n//          'pn_catalog_triage': '1st row: Hide it forever.\\n'+\r\n//            '2nd row: Hide until new replies\\n' +\r\n//            '3rd row: Change its appearance.\\n' +\r\n//            'Undo, Watch, UnWatch.\\n'\r\n        },\r\n        triage_borders: {\r\n          catalog_triage_str:\r\n            'KILL,X,,KILL,X,border:3px solid blue,KILL,X,border:3px solid lime,'+\r\n            'KILL,X,border:3px solid yellow,KILL,X,border:3px solid orange,KILL,X,border:3px solid red\\n'+\r\n            'TIME,v,,TIME,v,border:3px solid blue,TIME,v,border:3px solid lime,'+\r\n            'TIME,v,border:3px solid yellow,TIME,v,border:3px solid orange,TIME,v,border:3px solid red\\n'+\r\n            'NONE,O,,NONE,O,border:3px solid blue,NONE,O,border:3px solid lime,'+\r\n            'NONE,O,border:3px solid yellow,NONE,O,border:3px solid orange,NONE,O,border:3px solid red\\n'+\r\n            'UNDO,U,,WATCH,W,,UNWATCH,UW,,GO,G,\\n',\r\n//          'pn_catalog_triage': '1st row: Hide it forever.\\n'+\r\n//            '2nd row: Hide until new replies\\n' +\r\n//            '3rd row: Change its appearance.\\n' +\r\n//            'Undo, Watch, UnWatch.\\n'\r\n        },\r\n        triage_samples: {\r\n          catalog_triage_str: \r\n            'KILL,delete forever,\\n'+\r\n            'TIME,hide until new replies,\\n'+\r\n            'NONE,back to default design,background:;border:;\\n'+\r\n            'NONE,border and background,background:#c3dcf9;border:3px solid blue\\n'+\r\n            'NONE,border 3px,border:3px solid blue\\n'+\r\n            'NONE,background,background:#c3dcf9\\n'+\r\n            'NONE,border 5px,border:5px solid blue\\n'+\r\n            'NONE,border 1px,border:1px solid blue\\n'+\r\n            'NONE,transparent,background:\\n'+\r\n            'NONE,shrink,width:100px;height:100px\\n'+\r\n            'GO,open this thread,\\n',\r\n//          'pn_catalog_triage': 'samples\\n'\r\n        },\r\n        triage_test: {\r\n          catalog_triage_str: 'KILL,X,,TIME,v,,WATCH,W,,UNWATCH,UW,,SHOW,\\u2605,,UNSHOW,\\u2606,,STICKY,S,,UNSTICKY,US,,UNDO,U,,ARC,A+,,ARC1,A1,,UARC,A-,',\r\n        },\r\n        pn_samples : null,\r\n        init : function(){\r\n          if (pref_func.pref_samples.pn_samples) return;\r\n          var html = 'General samples:<br>'+\r\n                     '<button name=\"simple\">simple</button><br>'+\r\n                     '<button name=\"backwash\">backwash</button><br>'+\r\n                     '<button name=\"recommend\">recommend for desktop/note</button><br>'+\r\n                     'Triages:<br>'+\r\n                     '<button name=\"triage_simple_kill\">simple_kill</button><br>'+\r\n                     '<button name=\"triage_simple\">simple</button><br>'+\r\n                     '<button name=\"triage_basic\">basic</button><br>'+\r\n                     '<button name=\"triage_basic_color\">basic_color</button><br>'+\r\n                     '<button name=\"triage_colorful\">colorful</button><br>'+\r\n                     '<button name=\"triage_borders\">borders</button><br>'+\r\n                     '<button name=\"triage_samples\">samples</button><br>'+\r\n                     '<button name=\"triage_test\">test</button><br>';\r\n          cnst.make_popup(pref_func.pref_samples,'pn_samples',html,pref_func.pref_samples.onclick_event);\r\n//          pref_func.pref_samples.pn_samples = cnst.init('left:0px:tile:get:bottom:Show:tb',cnst.void_func,cnst.void_func,pref_func.pref_samples.destroy,cnst.void_func)[0];\r\n//          var pn_smpl = pref_func.pref_samples.pn_samples;\r\n//          pn_smpl.childNodes[1].innerHTML = '<button name=\"backwash\">backwash</button>';\r\n//          var buttons = pn_smpl.childNodes[1].getElementsByTagName('BUTTON');\r\n//          for (var i=0;i<buttons.length;i++) buttons[i].onclick = pref_func.pref_samples.onclick_event;\r\n        },\r\n//        destroy : function() {\r\n//          pref_func.pref_samples.pn_samples = cnst.div_destroy(pref_func.pref_samples.pn_samples, true);\r\n//        },\r\n        get_name: function(src,names,str){\r\n          for (var i in src) {\r\n            if (typeof(src[i])!=='object') names.push(str+i);\r\n            else pref_func.pref_samples.get_name(src[i],names,str+i+'.');\r\n          }\r\n          return names;\r\n        },\r\n        onclick_event : function(e, src) {\r\n          if (!src) src = pref_func.pref_samples[this.name];\r\n          if (src.func && typeof(src.func)==='function') src.func();\r\n          pref_func.pref_overwrite(pref,src);\r\n          pref_func.pref_overwrite(pref_func.tooltips.str,src);\r\n          var names = pref_func.pref_samples.get_name(src,[],'');\r\n          var pns = Array.prototype.slice.call(document.querySelectorAll('*[name]'));\r\n          for (var i=pns.length-1;i>=0;i--) if (names.indexOf(pns[i].name)==-1) pns.splice(i,1);\r\n          if (pns.length>0) pref_func.apply_prep(pns, false, true, null, true);  // refresh appearance, make object, trigger event.\r\n//          for (var i=0;i<names.length;i++) { // worknig code, but has a bug...\r\n//            var pn = document.getElementsByName(names[i])[0];\r\n//            if (pn) pref_func.apply_prep(document.getElementsByName(names[i])[0], false, true, null, true);  // refresh appearance, make object, trigger event.\r\n//          }\r\n////          for (var i=0;i<names.length;i++) { // working code.\r\n////            var pn = document.getElementsByName(names[i])[0];\r\n////            if (pn) {\r\n////              pref_func.apply_prep(pn,false);  // refresh appearance.\r\n//////            pref_func.apply_prep(pn,true);   // make obj.\r\n//////              pref_func.invoke_onchange(pn,true);   // make obj.\r\n////            }\r\n////            pref_func.make_pref_obj(names[i]); // make obj.\r\n//////            if (pref_func.settings.onchange_funcs[names[i]]) pref_func.settings.onchange_funcs[names[i]].call(pn);\r\n////            if (pn && pref_func.settings.onchange_funcs[names[i]]) pref_func.settings.onchange_funcs[names[i]].call(pn);\r\n////          }\r\n////          if (sessionStorage) sessionStorage.pref = JSON.stringify(pref);\r\n        }\r\n      },\r\n      settings: {\r\n        pn13 : null,\r\n        show_hide : function(e){\r\n          if (pref_func.settings.pn13===null) {\r\n            var pos = ((e.clientX*2>window.innerWidth)? 'right':'left') + ':0px:' + ((e.clientY*2>window.innerHeight)? 'bottom:0':'top:'+site.header_height())+'px';\r\n            var pn13 = cnst.init(pos+':Show:tb',cnst.void_func,cnst.void_func,pref_func.settings.show_hide,cnst.void_func)[0];\r\n            var pn13_0_2 = cnst.add_to_tb(pn13,\r\n              '<select name=\"settings.indexing\">'+\r\n                '<option>' + pref_func.settings.options.join('</option><option>') + '</option>'+\r\n              '</select>');\r\n            pn13_0_2.getElementsByTagName('select')['settings.indexing'].selectedIndex = pref.settings.indexing;\r\n            pref_func.settings.pn13 = pn13; // for onchange func.\r\n            pref_func.mirror_targets.pn13_1 = pn13.childNodes[1]; // for mirror.\r\n            pref_func.settings.onchange_funcs['settings.indexing'](); // leaks 1 EventLister, but call add_onchange in this.\r\n            pref_func.add_onchange(pn13_0_2,pref_func.settings.onchange_funcs_formatted); // leaks 1.\r\n            cnst.bottom_top(pn13);\r\n          } else {\r\n            pref_func.mirror_targets.pn13_1 = null;\r\n            pref_func.settings.files_store();\r\n            pref_func.settings.pn13 = cnst.div_destroy(pref_func.settings.pn13, true); // returns null\r\n          }\r\n        },\r\n////        show_hide : function(){cnst.make_destroy(pref_func.settings,'pn13',pref_func.settings.prep_pn13,pref_func.settings.destroy_pn13);}, // working code.\r\n////        prep_pn13 : function(){\r\n////          var pn13 = cnst.init('left:0px:tile:get:bottom:Show:tb',cnst.void_func,cnst.void_func,pref_func.settings.show_hide,cnst.void_func)[0];\r\n////          var pn13_0_2 = cnst.add_to_tb(pn13,\r\n////            '<select name=\"settings.indexing\">'+\r\n////              pref_func.settings.options.join('') + \r\n////////              '<option>Catalog: General 0</option>'+\r\n////////              '<option>Catalog: General 1</option>'+\r\n////////              '<option>Catalog: Board Group</option>'+\r\n////////              '<option>Catalog: Appearance</option>'+\r\n////////              '<option>Catalog: Design</option>'+\r\n////////              '<option>Catalog: Footer/PopUp</option>'+\r\n////////              '<option>Watcher / Notifiers</option>'+\r\n//////////              '<option>Statistics:</option>'+\r\n////////              '<option>UIP tracker for 4chan</option>'+\r\n////////              '<option>Command Line Interface</option>'+\r\n//////////              '<option>Workaround for dollchan</option>'+\r\n////////              '<option>General</option>'+\r\n////////              '<option>About</option>'+\r\n////            '</select>');\r\n////          pn13_0_2.getElementsByTagName('*')['settings.indexing'].selectedIndex = pref.settings.indexing;\r\n////          pref_func.settings.pn13 = pn13; // for onchange func.\r\n////          pref_func.mirror_targets.pn13_1 = pn13.childNodes[1]; // for mirror.\r\n////          pref_func.settings.onchange_funcs['settings.indexing'](); // leaks 1 EventLister, but call add_onchange in this.\r\n////          pref_func.add_onchange(pn13_0_2,pref_func.settings.onchange_funcs); // leaks 1.\r\n////          cnst.bottom_top(pn13);\r\n////          return pn13;\r\n////        },\r\n////        destroy_pn13 : function(){\r\n////          pref_func.mirror_targets.pn13_1 = null;\r\n////          pref_func.settings.files_store();\r\n////          pref_func.settings.pn13 = cnst.div_destroy(pref_func.settings.pn13, true); // returns null\r\n////        },\r\n        apply_pn13_1: function(set,propagate){\r\n          pref_func.apply_prep(pref_func.settings.pn13.childNodes[1],set,propagate);\r\n          pref_func.settings.onchange_funcs['pn13_1_warning']();\r\n        },\r\n        files_store: function(){\r\n          var files = pref_func.settings.pn13.querySelectorAll('input[type=file]');\r\n          if (files.length>0) pref_func.apply_prep_2(files,true);\r\n        },\r\n        insert_menu: function(menu,html){\r\n          var idx = pref_func.settings.options.length-1;\r\n          pref_func.settings.options.splice(idx,0,menu);\r\n          pref_func.settings.htmls.splice(idx,0,html);\r\n        },\r\n        html_funcs: {\r\n          show_hide_all_to_header: function(str){\r\n            return '<span>' + str + '<a name=\"SHOWALL\" style=\"float:right;cursor:pointer\" data-str=\"[all\\u25b2]\">[all\\u25bc]</a></span>';\r\n          },\r\n//          show_hide_all_to_header: function(str){\r\n//            return '<span>' + str + '<span style=\"float:right\">' + this.show_hide_all('all\\u25bc', 'all\\u25b2') + '</span></span>';\r\n//          },\r\n          show_hide_all: function(str_show, str_hide){\r\n            return '<a name=\"SHOWALL\" style=\"cursor:pointer\">[' +str_show+ ']</a><a name=\"HIDEALL\" style=\"cursor:pointer\">[' +str_hide+ ']</a>';\r\n          },\r\n          show_hide: function(str_show, str_hide, str_inner){\r\n            return '<a name=\"SHOW\" style=\"cursor:pointer\" data-str=\"' +str_hide+ '\">' +str_show+ '</a><span style=\"display:none\" name=\"SUB\"><br>' +str_inner+ '</span>';\r\n          },\r\n//          show_hide: function(str_show, str_hide, str_inner){\r\n//            return '<a name=\"SHOW\" style=\"cursor:pointer\">[' +str_show+ ']</a><a name=\"HIDE\" style=\"cursor:pointer;display:none\">[' +str_hide+ ']</a><span style=\"display:none\" name=\"SUB\"><br>' +str_inner+ '</span>';\r\n//          },\r\n          expand_thumbnail_inline: function(mode){\r\n            return '2,<ICBX\"' +mode+ '.expand_thumbnail_inline\"> Image expansion at click'+ this.rollup(\r\n              '3,<ICBX\"' +mode+ '.expand_thumbnail_initial\"> Expand all images at initial<br>'+\r\n              '3,<ICBX\"' +mode+ '.expand_thumbnail_inline_all_after\"> Expand all images after clicked one<br>'+\r\n              '4,<ICBX\"' +mode+ '.thumbnail.inline.ondemand\"> On demand loading: '+\r\n              '<ITB3\"' +mode+ '.thumbnail.inline.ref_height\"> % of browser<br>'+\r\n              this.expand_thumbnail_1(mode,'inline'))+ '<br>';\r\n          },\r\n          expand_thumbnail_hover: function(mode){\r\n            return '2,<ICBX\"' +mode+ '.image_hover\"> Image hover'+ this.rollup(\r\n              '3,<ICBX\"' +mode+ '.image_prefetch\"> Prefetch next image<br>'+\r\n              this.expand_thumbnail_1(mode,'hover')+'<br>'+\r\n              '3,zIndex: <ITB3\"' +mode+ '.image_hover_zIndex\">')+'<br>';\r\n          },\r\n          expand_thumbnail_1: function(mode,inline_or_hover){\r\n            var pref = mode+'.thumbnail.'+inline_or_hover+'.';\r\n            return '3,<ICBX\"' +pref+ 'webm\"> Play webm<br>'+\r\n              '4,<ICBX\"' +pref+ 'webm_loop\"> Loop<br>'+\r\n              '4,<ICBX\"' +pref+ 'webm_mute\"> Mute<br>'+\r\n              '3,<ICBX\"' +pref+ 'limit_width\"> Limit to browser\\'s width - '+\r\n              '<ITB3\"' +pref+ 'margin_width\"> px<br>'+\r\n              '3,<ICBX\"' +pref+ 'limit_height\"> Limit to browser\\'s height - '+\r\n              '<ITB3\"' +pref+ 'margin_height\"> px';\r\n          },\r\n          env: function(mode, str_inner){\r\n            return '1,Environment values:(advanced option)'+ this.rollup(\r\n              '2,You are using native function of:<br>'+\r\n              '3,<ICBX\"' +mode+ '.popup_native\"> Pop up reply<br>'+\r\n              '3,<ICBX\"' +mode+ '.expand_thumbnail_inline_native\"> Image expansion<br>'+\r\n              '3,<ICBX\"' +mode+ '.image_hover_native\"> Image hover<br>'+\r\n              '3,<ICBX\"' +mode+ '.colorID_native\"> Color ID<br>'+\r\n              '3,<ICBX\"' +mode+ '.backlink_native\"> Backlink<br>'+\r\n              '3,<ICBX\"' +mode+ '.localtime_native\"> Local time'+\r\n              str_inner) + '<br>';\r\n          },\r\n          op_in_search_result: function(mode){\r\n            return '2,' + this.rollup_radio(mode+'.posts_search_op', ' :Unmatched OP in search result', 3, '',\r\n                ['show:Show', 'opaque:Opaque: <ITB3\"' +mode+ '.posts_search_op_opacity\"> %','hide:Hide']) + '<br>'+\r\n              '2,<ICBX\"' + mode + '.auto_config_posts_search\"> Auto config and scan at searching posts<br>';\r\n\r\n          },\r\n          deleted_posts_detection: function(mode){\r\n            return '2,' + this.rollup_radio(mode+'.deleted_posts.detect', ' :Detect deleted posts', 4, '3,Detection:<br>',\r\n                ['no:No', 'passive:Passive detection. Don\\'t make any request',\r\n                 'acc:Best effort without any additional requests', 'full:Full detection, read all posts at first'],\r\n              '<br>'+\r\n              '3,<ICBX\"' + mode + '.deleted_posts.merge\"> Merge deleted posts with live posts<br>'+\r\n              this.radios(mode+'.deleted_posts.store',4,\r\n                ['LS:Store to LocalStorage to share with other tabs<br>5,<ICBX\"' + mode + '.deleted_posts.auto_clean\"> Clean up automatically',\r\n                 'SS:Store to SessionStorage to get higher security', 'MC:Use ChannelMessage for security']));\r\n\r\n          },\r\n//          show_val_rollup: function(pref, inner){\r\n//            return '<SSV\"' +pref+ '\">'+ '&emsp;' + this.show_hide('change...', 'hide', '', inner);\r\n//          },\r\n          radios: function(pref, indent, args){\r\n            var sep_h = indent+ ',<IR\"' +pref+ ',';\r\n            for (var i=0;i<args.length;i++) args[i] = sep_h + args[i].replace(/:/,'\">');\r\n            return args.join('<br>');\r\n          },\r\n          rollup_radio: function(pref, header, indent, middler, args, trailer){\r\n            return '<a name=\"SHOW2\" style=\"cursor:pointer\" data-str=\"\\u25b2]\">[<SSV\"' +pref+ '\"></span>\\u25bc]</a>'+\r\n                   '<span name=\"SHOW2_I\">' + header + '</span><span style=\"display:none\" name=\"SUB\"><br>' +middler + this.radios(pref,indent,args)+ (trailer || '') + '</span>';\r\n//            return '<span name=\"NEXT\" style=\"cursor:pointer\">[<SSV\"' +pref+ '\"></span>' + this.show_hide('\\u25bc]', '\\u25b2]', header, middler + args.join('<br>'));\r\n//            return '<SSV\"' +pref+ '\">'+ header + '&emsp;' + this.show_hide('change...', 'hide', '', middler + args.join('<br>'));\r\n          },\r\n          rollup: function(inner){\r\n            return '&emsp;' + this.show_hide('[\\u25bc]', '[\\u25b2]', inner);\r\n          },\r\n          format_posts: function(mode){\r\n            return '2,<ICBX\"' +mode+ '.open_spoiler_text\"> Open text spoiler<br>'+\r\n              '2,<ICBX\"' +mode+ '.colorID\"> Color ID<br>'+\r\n              '2,<ICBX\"' +mode+ '.backlink\"> Backlink<br>'+\r\n              '2,<ICBX\"' +mode+ '.localtime\"> Local time<br>'+\r\n              '2,<ICBX\"' +mode+ '.mark_new_posts\"> Mark new posts<br>';\r\n          },\r\n          updates: function(mode){\r\n            return '2,<ICBX\"' +mode+ '.auto_update\"> Auto update, every <ITB2\"' +mode+ '.auto_update_period\"> min.<br>'+\r\n              '2,<ICBX\"' +mode+ '.hide_posts_without_images\"> Hide posts without images<br>'+\r\n              '2,<ICBX\"' +mode+ '.merge\"> Merge threads<br>';\r\n          },\r\n          vb_domains: function(){\r\n//            var str = '<span name=\"virtualBoard.scan_domains\">'+\r\n            var str = '2,Scan targets:<br>'+\r\n                      '3,None/Board/Thread(No/Passive/Active)<br>';\r\n            var sites = this.get_domains();\r\n            for (var i=0;i<sites.length;i++) {\r\n              str += '3,<input type=\"radio\" name=\"virtualBoard.scan_domains.'+sites[i]+'\" value=\"none\">'+  // 'apply_prep' can't recognize ['domain'] notation.\r\n                     '<input type=\"radio\" name=\"virtualBoard.scan_domains.'+sites[i]+'\" value=\"board\">'+\r\n                     '<input type=\"radio\" name=\"virtualBoard.scan_domains.'+sites[i]+'\" value=\"thread\"> '+ sites[i] +'<br>';\r\n            }\r\n            return str;\r\n          },\r\n          get_domains: function(){\r\n            var sites = Object.keys(pref.virtualBoard.scan_domains);\r\n            sites.unshift(sites.splice(sites.indexOf(site.nickname),1)[0]);\r\n            return sites;\r\n          },\r\n          make_sel: function(pref,args){\r\n            var str = '<select name=\"' + pref + '\" style=\"float:none\">';\r\n            for (var i=0;i<args.length;i++) str += '<option>' + args[i] + '</option>';\r\n            return str + '</select>';\r\n          },\r\n        },\r\n////        options: [\r\n////          '<option>Easy Setting:</option>',\r\n////          '<option>Virtual board:</option>',\r\n////          '<option>Initialization:</option>',\r\n////          '<option>Catalog: General 1</option>',\r\n////          '<option>Catalog: Board Group</option>',\r\n////          '<option>Catalog: Live Tag</option>',\r\n////          '<option>Catalog: Appearance</option>',\r\n////          '<option>Catalog: Design</option>',\r\n////          '<option>Catalog: Footer/PopUp</option>',\r\n////          '<option>Watcher</option>',\r\n////          '<option>Notifiers</option>',\r\n//////          '<option>Statistics:</option>',\r\n////          '<option>UIP tracker for 4chan</option>',\r\n////          '<option>Command Line Interface</option>',\r\n//////          '<option>Workaround for dollchan</option>',\r\n////          '<option>Networking</option>',\r\n////          '<option>General</option>',\r\n////          '<option>About</option>'\r\n        ////        ],\r\n        options: [\r\n          'Easy Setting2:',\r\n          'Easy Setting:',\r\n          'Virtual Board:',\r\n          'Catalog:',\r\n          'Index Page:',\r\n          'Thread:',\r\n          'Floating Catalog:',\r\n          'Gerenal 0',\r\n          'General 1',\r\n          'Board Group',\r\n          'Live Tag',\r\n          'Statistics',\r\n          'Design of FC',\r\n          'Footer',\r\n          'Watcher',\r\n          'Notifiers',\r\n          'JSON Archiver: Store',\r\n          'JSON Archiver: Restore',\r\n          'UIP tracker for 4chan',\r\n          'Command Line Interface',\r\n//          'Workaround for dollchan',\r\n          'Networking',\r\n          'General 2',\r\n          'Styles',\r\n          'Features',\r\n          'About'\r\n        ],\r\n        htmls: [\r\n          'Easy Setting2: --- Welcome to CatChan! ---<br>'+\r\n          '<br>'+\r\n          '1,0. <button name=\"easy2.beginner\">I\\'m a beginner and I just want to try</button>, click this.<br>'+\r\n          '2,Then a reload will be occur after loading settings for beginner.<br>'+\r\n          '2,(This will be default after a certain period of test.)<br>'+\r\n          '2,Or follow next steps to choose your favorite settings.<br>'+\r\n          '<br>'+\r\n          '1,1. <input type=\"checkbox\" name=\"easy2.reset\"> Reset all settings before loading new one if you prefer.<br>'+\r\n          '1,2. Select a preset: '+\r\n          '<select name=\"easy2.presets\" style=\"float:none\">'+\r\n            '<option>Safe default</option>'+\r\n            '<option>Silent inter-board operability (for beginner)</option>'+ // passive/No/No. works silently.\r\n            '<option>Silent inter-site operability</option>'+  // passive/passive/No, works silently.\r\n//            '<option>Silent in-board operability with tags from OP</option>'+    // active/No/liveTag-OP\r\n            '<option>Active inter-board operability</option>'+ // active/No/LiveTag-OP, scans all catalogs.\r\n            '<option>Active inter-site ondemand operability</option>'+ // active/passive/LiveTag-OP, scans all catalogs, but ondemand for other site.\r\n            '<option>Active inter-site operability</option>'+ // active/active/LiveTag-OP, scans all catalogs.\r\n            '<option>Active in-board operability with LiveTag</option>'+    // active/No/liveTag-Post, scans all threads.\r\n            '<option>Active inter-board operability with LiveTag</option>'+ // active/passive/liveTag-Post, scans all threads.\r\n            '<option>Active inter-site operability with LiveTag</option>'+ // active/active/liveTag-Post, scans all threads.\r\n          '</select><br>'+\r\n          '1,3. Select limits for safe: '+\r\n          '<select name=\"easy2.limits\" style=\"float:none\">'+\r\n            '<option>General</option>'+\r\n            '<option>/all/ for lain, meguca</option>'+\r\n            '<option>/all/ for 4chan</option>'+\r\n            '<option>8chan with top 50 boards</option>'+\r\n            '<option>8chan with top 100 boards</option>'+\r\n            '<option>8chan with top 500 boards</option>'+\r\n            '<option>8chan with all boards</option>'+\r\n            '<option>/all/ for KC</option>'+\r\n          '</select><br>'+\r\n          '1,4. Modify details if you want.<br>'+\r\n          '2,<input type=\"checkbox\" name=\"easy2.virtualBoard.show\"> VirtualBoards, shows '+\r\n          '<input type=\"text\" name=\"easy2.virtualBoard.max\" size=\"3\" style=\"text-align: right;\"> virtual boards<br>'+\r\n          '4,Local: <select name=\"easy2.VB.local\" style=\"float:none\">'+\r\n            '<option>No</option>'+\r\n            '<option>Passive</option>'+\r\n            '<option>Active</option>'+\r\n          '</select>'+\r\n          '&emsp;Global: <select name=\"easy2.VB.global\" style=\"float:none\">'+\r\n            '<option>No</option>'+\r\n            '<option>Passive</option>'+\r\n            '<option>Active</option>'+\r\n          '</select><br>'+\r\n          '2,<input type=\"checkbox\" name=\"easy2.liveTag.use\"> LiveTag, '+\r\n          'from: <select name=\"easy2.LTfrom\" style=\"float:none\">'+\r\n            '<option>OP</option>'+\r\n            '<option>Posts</option>'+\r\n          '</select><br>'+\r\n          '2,<input type=\"checkbox\" name=\"easy2.catalog.embed\"> Use CatChan in catalog<br>'+\r\n          '2,<input type=\"checkbox\" name=\"easy2.catalog.embed_page\"> Use CatChan in index page<br>'+\r\n          '2,<input type=\"checkbox\" name=\"easy2.thread.embed\"> Use CatChan in thread<br>'+\r\n          '2,<input type=\"checkbox\" name=\"easy2.auto_update\"> Auto update, every '+\r\n          '<input type=\"text\" name=\"easy2.auto_update_period\" size=\"2\" style=\"text-align: right;\"> min.<br>'+\r\n          '2,<input type=\"checkbox\" name=\"easy2.notify.desktop.notify\"> Desktop notification<br>'+\r\n          '2,<input type=\"checkbox\" name=\"easy2.catalog.filter.time_watch\"> Hide all threads which have no posts in recent '+\r\n          '<input type=\"text\" name=\"easy2.time_post\" size=\"3\" style=\"text-align: right;\"> hours<br>'+\r\n          '2,<input type=\"checkbox\" name=\"easy2.catalog.filter.time_watch_creation\"> Hide all threads which are created before '+\r\n          '<input type=\"text\" name=\"easy2.time_op\" size=\"3\" style=\"text-align: right;\"> hours ago<br>'+\r\n          '2,<input type=\"checkbox\" name=\"easy2.stats.use\"> Statistics<br>'+\r\n          '2,<input type=\"checkbox\" name=\"easy2.healthIndicator.expand_running\"> Show details of running indicators<br>'+\r\n          '2,<input type=\"checkbox\" name=\"easy2.network.fetch_actively\"> Fetch missing info actively<br>'+\r\n//          '2,<input type=\"checkbox\" name=\"easy2.basics\"> Other basic settings, which depends on preset<br>'+\r\n          '2,<input type=\"checkbox\" name=\"easy2.basics\"> Other basic settings<br>'+\r\n          '2,Limits for safe: <br>'+\r\n          '3,At scan: <ITB6\"easy2.scan.max\"> boards, <ITB6\"easy2.scan.max_threads\"> threads.<br>'+\r\n          '3,In a catalog: <ITB6\"easy2.catalog.max_threads_at_refresh\"> threads.<br>'+\r\n          '1,5. Click <button name=\"easy2.apply\">Apply</button><br>'+\r\n          '1,6. Click <button name=\"save\">Save</button> if you want to save your settings to localStorage<br>'+\r\n          '1,7. Click <button name=\"reload\">Reload</button>, because some setting may need<br>'+\r\n          '',\r\n          'Easy Setting:<br>'+\r\n          '&emsp;VBs: virtual boards<br>'+\r\n          '&emsp;AU: auto update every X min<br>'+\r\n          '&emsp;<button name=\"easy.virtualBoard_10_passive\">Click</button> 20 VBs / AU 10 min. / passive scan. (for all)<br>'+\r\n          '&emsp;<button name=\"easy.virtualBoard_10\">Click</button> 20 VBs / AU 10 min. (for lainchan and meguca)<br>'+\r\n          '&emsp;<button name=\"easy.virtualBoard_1\">Click</button> 100 VBs / AU 1 min. (for 4chan)<br>'+\r\n          '&emsp;<button name=\"easy.virtualBoard_8_50\">Click</button> 100 VBs / AU 5 min from top '+\r\n          '<input type=\"text\" name=\"easy.max_boards\" size=\"3\" style=\"text-align: right;\">'+\r\n          ' boards. (for 8chan)<br>'+\r\n//          '&emsp;<button name=\"easy.virtualBoard_8_100\">Click</button> 100 VBs / AU 5 min from top 100 boards. (for 8chan)<br>'+\r\n//          '&emsp;<button name=\"easy.virtualBoard_8_500\">Click</button> 100 VBs / AU 5 min from top 500 boards. (for 8chan)<br>'+\r\n          '&emsp;<button name=\"easy.virtualBoard_8_all\">Click</button> 100 VBs / AU 5 min from all boards. (for 8chan)<br>'+\r\n          '&emsp;<button name=\"easy.virtualBoard_interSite\">Click</button> 100 VBs / AU 10 min from all sites. / passive scan. (for all)<br>'+\r\n          '<br>'+\r\n          '&emsp;<button name=\"easy.posts_0h\">Click</button> I want to check all new posts from now.<br>'+\r\n          '&emsp;<button name=\"easy.posts_24h\">Click</button> I want to check all posts from '+\r\n          '<input type=\"text\" name=\"easy.posts_ago\" size=\"3\" style=\"text-align: right;\">'+\r\n          ' hours ago.<br>'+\r\n          '&emsp;<button name=\"easy.threads_24h\">Click</button> I want to check all new threads from '+\r\n          '<input type=\"text\" name=\"easy.threads_ago\" size=\"3\" style=\"text-align: right;\">'+\r\n          ' hours ago.<br>'+\r\n          '<br>'+\r\n//          '&emsp;<button name=\"easy.embed_index\">Click</button> Use CatChan in index page without infinite scroll.<br>'+\r\n          '&emsp;<button name=\"easy.embed_index_lazy\">Click</button> Setup for narrow band.<br>'+\r\n          '&emsp;<button name=\"easy.embed_index_infinite\">Click</button> Setup for infinite scroll.<br>'+\r\n          '&emsp;<button name=\"easy.embed_index_backwash\">Click</button> Backwash style. (infinite scroll/quick auto update)<br>'+\r\n          '<br>'+\r\n          '&emsp;<button name=\"easy.light\">Click</button> Setup for light start up.<br>'+\r\n          '',\r\n          function(html_funcs){return 'Virtual Board:<br>'+\r\n            '&emsp;<input type=\"checkbox\" name=\"virtualBoard.show\"> Show virtual boards'+\r\n            ', up to: <input type=\"text\" name=\"virtualBoard.max\" size=\"3\" style=\"text-align: right;\"><br>'+\r\n            '2,<ICBX\"virtualBoard.search.show\"> Show search bar in boardlist<br>'+\r\n            '3,<ICBX\"virtualBoard.search.re\"> Regular Expression<br>'+\r\n            '&emsp;<input type=\"checkbox\" name=\"virtualBoard.scan\"> Scan at start up'+\r\n            ', delay: <input type=\"text\" name=\"virtualBoard.scanDelay\" size=\"2\" style=\"text-align: right;\">s<br>'+\r\n            '&emsp;&emsp;&emsp;Scan: <button name=\"virtualBoard.scanStart\">Start</button>'+\r\n            '&emsp;<button name=\"virtualBoard.scanStop\">Stop</button><br>'+\r\n            html_funcs.vb_domains()+\r\n            '&emsp;&emsp;<input type=\"checkbox\" name=\"virtualBoard.instant_scan\"> Instant scan<br>'+\r\n            '&emsp;Physical boards in boardlist:<br>'+\r\n            '&emsp;&emsp;<input type=\"radio\" name=\"virtualBoard.p_board\" value=\"both\"> Show as they are<br>'+\r\n            '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"virtualBoard.p_remove\"> Remove virtual boards of the same name<br>'+\r\n            '&emsp;&emsp;<input type=\"radio\" name=\"virtualBoard.p_board\" value=\"replace\"> Replace with virtual boards<br>'+\r\n//            '3,<ICBX\"virtualBoard.v_remove\"> Remove filtered virtual boards<br>'+\r\n            '&emsp;<input type=\"checkbox\" name=\"liveTag.show_info_onmouseover\"> Show infomation on hover<br>'+\r\n  //          '&emsp;Style of selected board:<textarea rows=\"1\" cols=\"20\" name=\"liveTag.style_in_str\"></textarea><br>'+\r\n            '&emsp;Style of selected board:<input type=\"text\" name=\"liveTag.style_in_str\" size=\"30\"><br>'+\r\n            '&emsp;<input type=\"checkbox\" name=\"liveTag.style\"> Add style:<br>'+\r\n  //          '&emsp;&emsp;Unread replies to me:<textarea rows=\"1\" cols=\"20\" name=\"liveTag.style_urtm_str\"></textarea><br>'+\r\n  //          '&emsp;&emsp;Unread replies:<textarea rows=\"1\" cols=\"20\" name=\"liveTag.style_ur_str\"></textarea><br>'+\r\n            '&emsp;&emsp;Unread replies to me:<input type=\"text\" name=\"liveTag.style_urtm_str\" size=\"30\"><br>'+\r\n            '&emsp;&emsp;Unread replies:<input type=\"text\" name=\"liveTag.style_ur_str\" size=\"30\"><br>'+\r\n            '';},\r\n          function(html_funcs){\r\n            return html_funcs.show_hide_all_to_header('Catalog:') + '<br>'+\r\n              '&emsp;<input type=\"checkbox\" name=\"catalog.embed\"> Use CatChan in catalog<br>'+\r\n              html_funcs.expand_thumbnail_hover('catalog')+\r\n              '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.open_spoiler_text\"> Open text spoiler<br>'+\r\n              '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.auto_update\"> Auto update, every '+\r\n              '<input type=\"text\" name=\"catalog.auto_update_period\" size=\"2\" style=\"text-align: right;\"> min.<br>'+\r\n              '&emsp;&emsp;<input type=\"checkbox\" name=\"page.mark_new_posts\"> Mark new posts when you open a thread<br>'+\r\n              '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.save_board_list_sel\"> Save board group index<br>'+\r\n              '2,'+ html_funcs.rollup_radio('catalog.click_area', ' :Click to open the thread', 3, '',\r\n                ['thumbnail:Thumbnail','entire:Entire thread card'])+ '<br>'+\r\n              '2,'+ html_funcs.rollup_radio('catalog.popup2',' :Pop up', 3, '',\r\n                ['no:No','sr:Search result','srpv:Search result or preview','pv:Preview','chart:Post rate chart (statistics must be activated)','dp:Deleted posts'])+ '<br>'+\r\n              '2,'+ html_funcs.rollup_radio('catalog.t2h_sel',' :Num of posts to store for search/preview', 3,\r\n                '3,Posts are stored after the thread was shown at once,<br>'+\r\n                '3,and you can utilize them to search or get preview.<br>'+\r\n                '3,The last option is for incremental search for posts.<br>',\r\n                ['no:No (Need a scan for every search)','N:Last <ITB3\"catalog.t2h_num_of_posts\"> posts (N posts)',\r\n                 'N_unread:N + all unread posts', 'unread:All unread posts', 'ALL:All posts', 'ALL_agg:All posts from all scanned threads']) +'<br>'+\r\n              html_funcs.op_in_search_result('catalog')+\r\n              html_funcs.deleted_posts_detection('catalog')+'<br>'+\r\n              '<br>'+\r\n              '1,Environment values:(advanced option)'+ html_funcs.rollup(\r\n                '2,Native has:<br>'+\r\n                '3,<ICBX\"catalog.env.image_hover_native\"> Image hover')+'<br>';},\r\n          function(html_funcs){\r\n            return html_funcs.show_hide_all_to_header('Index Page:') + '<br>'+\r\n              '&emsp;<input type=\"checkbox\" name=\"catalog.embed_page\"> Use CatChan in index page' + html_funcs.rollup(\r\n                '3,Refresh up to:<br>'+\r\n                '4,<IR\"catalog_max_page_select,manual\"> <ITB2\"catalog_max_page\"> pages<br>'+\r\n                '4,<IR\"catalog_max_page_select,auto\"> Max pages<br>'+\r\n                '5,<ICBX\"catalog_max_page_auto\"> Update automatically') +'<br>'+\r\n    //          '&emsp;&emsp;<input type=\"checkbox\" name=\"page.infinite\"> Infinite scroll<br>'+\r\n              '&emsp;&emsp;<input type=\"checkbox\" name=\"page.popup\"> Pop up reply<br>'+\r\n              html_funcs.expand_thumbnail_inline('page')+\r\n              html_funcs.expand_thumbnail_hover('page')+\r\n              html_funcs.format_posts('page')+\r\n    //          '&emsp;&emsp;<input type=\"checkbox\" name=\"page.scan_tag\"> Scan tags at initial<br>'+\r\n    //          '&emsp;&emsp;<input type=\"checkbox\" name=\"page.format.show.posts\"> Show posts<br>'+\r\n              '2,<ICBX\"page.use_expander_always\"> Use CatChan\\'s expander always<br>'+\r\n              '2,' + html_funcs.rollup_radio('page.t2h_sel', ' :Num of posts to show or search', 3, '',\r\n                ['page:Inherit from index page',\r\n                 'L: <ITB3\"page.t2h_L\"> posts(L posts)',\r\n                 'M: <ITB3\"page.t2h_M\"> posts(M posts)',\r\n                 'N: <ITB3\"page.t2h_num_of_posts\"> posts(N posts)',\r\n                 'N_unread:N + all unread posts',\r\n                 'unread:All unread posts',\r\n                 'ALL:All posts',\r\n                 'ALL_agg:All posts (for incremental posts search)']) +'<br>'+\r\n              html_funcs.op_in_search_result('page')+\r\n              html_funcs.updates('page')+\r\n              '&emsp;&emsp;<input type=\"checkbox\" name=\"page.scroll_lock\"> Don\\'t scroll at update<br>'+\r\n              '&emsp;<input type=\"checkbox\" name=\"page.save_board_list_sel\"> Save board group index<br>'+\r\n              '<br>'+\r\n              html_funcs.env('page.env','');},\r\n          function(html_funcs){\r\n            return html_funcs.show_hide_all_to_header('Thread:') + '<br>'+\r\n              '&emsp;<input type=\"checkbox\" name=\"thread.embed\"> Use CatChan in thread<br>'+\r\n              '&emsp;&emsp;<input type=\"checkbox\" name=\"thread.popup\"> Pop up reply<br>'+\r\n              html_funcs.expand_thumbnail_inline('thread')+\r\n              html_funcs.expand_thumbnail_hover('thread')+\r\n              html_funcs.format_posts('thread')+\r\n              html_funcs.updates('thread')+\r\n    //          '&emsp;<input type=\"checkbox\" name=\"thread.save_board_list_sel\"> Save board group index<br>'+\r\n              '<br>'+\r\n              html_funcs.env('thread.env', '<br>3,<input type=\"checkbox\" name=\"thread.env.auto_update_native\"> Auto update');},\r\n          'Floating Catalog:<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"float.auto_update\"> Auto update, every '+\r\n          '<input type=\"text\" name=\"float.auto_update_period\" size=\"2\" style=\"text-align: right;\"> min.<br>'+\r\n          '&emsp;Click to:<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"float.click\" value=\"open\">Go to/open the thread<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"float.click\" value=\"expand\">Expand/shrink the OP in catalog<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_expand_at_initial\"> Expand at initial<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_expand_at_initial_embed\"> Expand at initial in index.<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_expand_with_hr\"> Insert horizontal splitter when it is expanded<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_no_popup_at_expanded\"> Don\\'t popup when the catalog is expanded<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"float.click\" value=\"none\">None<br>'+\r\n          '&emsp;Click area:<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"float.click_area\" value=\"thumbnail\">Thumbnail<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"float.click_area\" value=\"entire\">Entire thread card<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"float.popup2\"> Use pop-up window<br>'+\r\n          '&emsp;&emsp;appear/disappear:<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"radio\" name=\"catalog_popdown\" value=\"imm\">immediately<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"radio\" name=\"catalog_popdown\" value=\"delay\">delayed '+\r\n          '<input type=\"text\" name=\"catalog_popup_delay\" size=\"6\" style=\"text-align: right;\">'+\r\n          '<input type=\"text\" name=\"catalog_popdown_delay\" size=\"6\" style=\"text-align: right;\"> ms<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_popup_size_fix\"> Fix size when you move it<br>'+\r\n//          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_localtime\"> Localtime<br>'+\r\n          '&emsp;At initial:<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog.appearance.initial.state\" value=\"maximized\">Maximized<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog.appearance.initial.state\" value=\"floating\">Floating '+\r\n          '<input type=\"text\" name=\"catalog.appearance.initial.width\" size=\"4\" style=\"text-align: right;\"> x '+\r\n          '<input type=\"text\" name=\"catalog.appearance.initial.height\" size=\"4\" style=\"text-align: right;\"><br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog.appearance.initial.state\" value=\"top\">Embed to top<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog.appearance.initial.state\" value=\"bottom\">Embed to bottom<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"float.save_board_list_sel\"> Save board group index<br>'+\r\n          '',\r\n          'General 0:<br>'+\r\n          '&emsp; Open short link<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_last50\" value=\"no\">No. Open entire thread<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_last50\" value=\"exist\">If it exists<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_last50\" value=\"exist_watch\">If it exists and all unread posts are in it<br>'+\r\n////          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_last50\" value=\"speculative\">If it is estimated to exist<br>'+\r\n////          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_last50\" value=\"spec_watch\">If it is estimated to exist and unread posts are less than 50<br>'+\r\n          '&emsp; Open the thread in<br>'+\r\n//          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_open_where_click\"> Apply to reply links in index page<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_where\" value=\"_self\">this tab<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_where\" value=\"_blank\">new tab always<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_where\" value=\"named\">named tab<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_where\" value=\"CatChan_tgt\">a fixed tab<br>'+\r\n//          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_use_named_window\"> Prevent opening a thread in multiple tabs<br>'+\r\n          '<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog_triage\"> Enable triage pop-up<br>'+\r\n          '&emsp;&emsp;Where to show triage:<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"radio\" name=\"catalog_triage_place\" value=\"topLeft\"> Top left'+\r\n          '&emsp;&emsp;&emsp;<input type=\"radio\" name=\"catalog_triage_place\" value=\"topRight\"> Top right<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"radio\" name=\"catalog_triage_place\" value=\"bottomLeft\"> Bottom left'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_triage_place\" value=\"bottomRight\"> Bottom right<br>'+\r\n          '&emsp;&emsp;pop down delay: <input type=\"text\" name=\"triage.popdown_delay\" size=\"4\" style=\"text-align: right;\">ms<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"triage.show_always\"> Don\\'t pop down while the mouse is on the thread<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"triage.hide_toggle\"> Hide useless toggle buttons<br>'+\r\n          '&emsp;&emsp;Style:<br>'+\r\n          '&emsp;&emsp;&emsp;<textarea style=\"height:1em\" cols=\"40\" name=\"catalog_triage_str\"></textarea><br>'+\r\n          '<!-- &emsp;<input type=\"checkbox\" name=\"catalog_enable_cross_board\"> Enable cross-board catalog<br> -->'+\r\n          '<!-- &emsp;<input type=\"checkbox\" name=\"catalog_enable_cross_domain\"> Enable cross-domain catalog<br> -->'+\r\n          '<!-- &emsp;&emsp; Cache working in <textarea style=\"height:1em\" cols=\"20\" name=\"catalog_sw_domain\"></textarea><br> -->'+\r\n          '&emsp;&emsp;Sample triage:<br>'+\r\n          '&emsp;&emsp;&emsp;<button name=\"triage_simple_kill\">simple_kill</button>'+\r\n          '&emsp;<button name=\"triage_simple\">simple</button>'+\r\n          '&emsp;<button name=\"triage_basic\">basic</button>'+\r\n          '&emsp;<button name=\"triage_basic_color\">basic_color</button><br>'+\r\n          '&emsp;&emsp;&emsp;<button name=\"triage_colorful\">colorful</button>'+\r\n          '&emsp;<button name=\"triage_borders\">borders</button>'+\r\n          '&emsp;<button name=\"triage_samples\">samples</button>'+\r\n          '&emsp;<button name=\"triage_test\">test</button>'+\r\n          '<br>'+\r\n          '',\r\n          'General 1:<br>'+\r\n          '&emsp;Shows in title bar:<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.appearance.titleBar.filter\">Checkbox to show filter<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.appearance.titleBar.settings\">Checkbox to show settings<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.appearance.titleBar.refresh\">Refresh button<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.appearance.titleBar.num_of_pages\">Num of pages to refresh<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.appearance.titleBar.boards_selector\">Boards selector<br>'+\r\n          '<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.embed_frame\"> Embed to frame<br>'+\r\n          '&emsp;&emsp;Frame size : '+\r\n          '&emsp;&emsp;<input type=\"text\" name=\"catalog_size_frame0_width\" size=\"4\" style=\"text-align: right;\">%, '+\r\n          '&emsp;&emsp;<input type=\"text\" name=\"catalog_size_frame1_width\" size=\"4\" style=\"text-align: right;\">%<br>'+\r\n//          '&emsp;Max threads in catalog: <input type=\"text\" name=\"catalog.max_threads\" size=\"4\" style=\"text-align: right;\"><br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.refresh.initial\"> Refresh at initial<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.refresh.except_bt\"> Except the page of selecting boards\\' tag.<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.refresh.at_switch\"> Clear and refresh when boards are switched<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"common.clear_at_manual_scan\"> Clear all threads at manual scan<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"liveTag.rm_404_immediately\"> Remove 404 threads immediately<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.bookmark_list_rm404\"> Remove 404 threads from bookmark<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"liveTag.utilize_boards_json\"> Utilize boards.json in 8chan<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"filter.disable_list_when_kwd_active\"> Disable list filter when keyword filter is active<br>'+\r\n          '',\r\n          'Board Group:<br>'+\r\n          '&emsp;configuration:<br>'+\r\n          '&emsp;&emsp;<textarea rows=\"1\" cols=\"60\" name=\"catalog_board_list_str\"></textarea><br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.board.recommendation\"> Read owner\\'s recommendation '+\r\n          '&emsp;&emsp;<button name=\"tag.recommendation_add\">Add to list</button><br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.board.all_boards\"> Generate all boards group<br>'+\r\n//          '&emsp;&emsp;<input type=\"button\" value=\"Scan\"> Scan board tags<br>'+\r\n//          '&emsp;&emsp;<input type=\"button\" value=\"Generate\" name=\"tag.generate\"> Generate board groups from tags <br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.board.board_tags\"> Generate board groups from tags '+\r\n          '&emsp;&emsp;<button name=\"tag.scan\">Scan</button><br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.board.board_tags_same\"> Pick up boards which have the same tag'+\r\n          '&emsp;&emsp;<button name=\"tag.same_tag_refresh\">Refresh</button><br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.board.ex_list\"> Use exclusive list<br>'+\r\n          '&emsp;&emsp;<textarea rows=\"1\" cols=\"40\" name=\"catalog.board.ex_list_str\"></textarea><br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.style_general_list\"> Use general style<br>'+\r\n          '&emsp;&emsp;<textarea rows=\"1\" cols=\"40\" name=\"catalog.style_general_list_str\"></textarea><br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.mimic_base_site\"> Mimic base site<br>'+\r\n////////          '&emsp;Tagging:<br>'+\r\n////////          '&emsp;&emsp;Ignore tags latter than <input type=\"text\" name=\"catalog.tag.ignore\" size=\"2\" style=\"text-align: right;\">th in a board/thread<br>'+\r\n////////          '&emsp;&emsp;Ignore boards/threads which have more than <input type=\"text\" name=\"catalog.tag.max\" size=\"2\" style=\"text-align: right;\"> tags<br>'+\r\n          '&emsp;Scan:<br>'+\r\n          '&emsp;&emsp;Max scan boards <input type=\"text\" name=\"scan.max\" size=\"6\" style=\"text-align: right;\"><br>'+\r\n          '&emsp;&emsp;Max found threads <input type=\"text\" name=\"scan.max_threads\" size=\"6\" style=\"text-align: right;\"><br>'+\r\n////////          '&emsp;&emsp;Reload older than <input type=\"text\" name=\"scan.lifetime\" size=\"6\" style=\"text-align: right;\"> minutes old<br>'+\r\n          '&emsp;&emsp;Num of crawler: <input type=\"text\" name=\"scan.crawler\" size=\"2\" style=\"text-align: right;\"><br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"scan.crawler_adaptive\"> Spawn adaptively at idle' + \r\n          '<input type=\"text\" name=\"scan.crawler_idle_time_to_spawn\" size=\"2\" style=\"text-align: right;\">ms<br>'+\r\n          '',\r\n          'Live Tag:<br>'+\r\n          '1,From:<br>'+\r\n          '2,<IR\"liveTag.from,op\">OP<br>'+\r\n          '2,<IR\"liveTag.from,post\">All posts<br>'+\r\n          '3,<ICBX\"liveTag.use\"> Live<br>'+\r\n//          '4,<ICBX\"stats.use\"> Take statistics<br>'+\r\n          '1,max: <ITB2\"liveTag.max\">'+\r\n          ', max string length: <ITB2\"liveTag.maxstr\"><br>'+\r\n          '1,<ICBX\"liveTag.ci\"> Case insensitive<br>'+\r\n          '1,<ICBX\"liveTag.inherit_board_name\"> Inherits board\\'s name<br>'+\r\n          '2,<ICBX\"liveTag.lock_board_name\"> Lock & sticky<br>'+\r\n          '1,<ICBX\"liveTag.inherit_board_tags\"> Inherits board\\'s tags<br>'+\r\n          '2,<ICBX\"liveTag.lock_board_tags\"> Lock & sticky<br>'+\r\n          '1,<ICBX\"liveTag.lock_tags_in_op\"> Lock & sticky tags in OP<br>'+\r\n          '1,<ICBX\"liveTag.ex_list\"> Use exclusive list<br>'+\r\n          '2,String list to remove before extracting tags<br>'+\r\n          '3,<textarea rows=\"1\" cols=\"40\" name=\"liveTag.rm_list_str\"></textarea><br>'+\r\n          '2,Tag list to remove after extracting tags<br>'+\r\n          '3,<textarea rows=\"1\" cols=\"40\" name=\"liveTag.ex_list_str\"></textarea><br>'+\r\n          '1,Delay to display:<br>'+\r\n          '2,Foreground: <ITB4\"liveTag.disp_delay.fg\">ms<br>'+\r\n          '2,Background: <ITB4\"liveTag.disp_delay.bg\">ms<br>'+\r\n          '1,Click function: tags in <br>'+\r\n          '2,boardlist / threads<br>'+\r\n          '2,<IR\"liveTag.click_func_bl,pkin\">'+\r\n          '<IR\"liveTag.click_func,pkin\">None -> Pickup/Include -> None<br>'+\r\n          '2,<IR\"liveTag.click_func_bl,in\">'+\r\n          '<IR\"liveTag.click_func,in\">None -> Include -> None<br>'+\r\n          '2,<IR\"liveTag.click_func_bl,inex\">'+\r\n          '<IR\"liveTag.click_func,inex\">None -> Include -> Exclude -> None<br>'+\r\n          '2,<IR\"liveTag.click_func_bl,ex\">'+\r\n          '<IR\"liveTag.click_func,ex\">None -> Exclude -> None<br>'+\r\n          '',\r\n          function(html_funcs){\r\n            return 'Statistics:<br>'+\r\n////            '&emsp;&emsp;Statistics is a subfunction of the LiveTag,<br>'+\r\n////            '&emsp;&emsp;You must activate it beforehand and RELOAD to start.<br>'+\r\n////            '&emsp;&emsp;Then, the \"Graph\" button will appear in the setting button([CC])<br>'+\r\n//////            '&emsp;&emsp;And this function uses both local and server timestamps,<br>'+\r\n//////            '&emsp;&emsp;your local clock must be accurate.<br>'+\r\n////            '<span style=\"float:left\">&emsp;&emsp;<button name=\"easy.stat_activate\">Activate</button></span>'+\r\n////            '<span>'+\r\n////              '&emsp;<input type=\"checkbox\" name=\"stats.use\"> Take statistics<br>'+\r\n////              '&emsp;<input type=\"checkbox\" name=\"stats.estimate_posts\"> Estimate num of posts from posts\\' No.<br>'+\r\n////            '</span>'+\r\n////            '<br>'+\r\n            '1,<ICBX\"stats.use\"> Take statistics<br>'+\r\n            '2,<ICBX\"stats.estimate_posts\"> Estimate num of posts from posts\\' No.<br>'+\r\n            '2,Default settings:<br>'+\r\n            '3,Time unit: '+ chart_obj.time_unit_sel_html + '<br>' +\r\n            '3,' + chart_obj.chart_options_str.join('&emsp;&emsp;&emsp;') +\r\n            '3,Size of window: <ITB4\"chart.window_width\"> x <ITB4\"chart.window_height\"><br>'+\r\n            '<br>'+\r\n//            '&emsp;Data of pruned threads:<br>'+\r\n//            '&emsp;&emsp;<input type=\"checkbox\" name=\"stats.retain_404\"> Retain values of pruned thread<br>'+\r\n            '2,Accumulation:<br>'+\r\n            '3,<ICBX\"stats.load\"> Load data<br>'+\r\n            '4,<ICBX\"stats.save\"> Save data: <ITB4\"stats.len_capture\"> points<br>'+\r\n            '4,Auto acquisition of data:<br>'+\r\n            '5,<ICBX\"stats.auto_acquisition_all\"> All board groups which you saw once<br>'+\r\n            '5,<ICBX\"stats.auto_acquisition\"> Board groups with \\'!stats\\'<br>'+\r\n            '6,<ICBX\"stats.auto_acquisition_scan\"> Scan all targets at startup with '+\r\n            '<ITB2\"stats.auto_acquisition_scan_delay\"> secs delay<br>'+\r\n            '5,(Targets are colored <span style=\"background:#b5fbda\">green</span> in board selector)<br>'+\r\n            '<br>'+\r\n            '2,<ICBX\"chart.instant_scan\"> Instant scan at switching board group<br>'+\r\n            '2,Delay to draw: <ITB2\"stats.draw_delay\"> sec.<br>'+\r\n            '2,<ICBX\"chart.off_anime_blur\"> Off animation in background<br>'+\r\n            '2,<ICBX\"stats.tolerant\"> Tolerant of inaccuracy of server and local clocks<br>'+\r\n            '5,up to <input type=\"text\" name=\"stats.tolerance\" size=\"2\" style=\"text-align: right;\"> min<br>'+\r\n            '';\r\n          },\r\n          'Design of Floating Catalog:<br>'+\r\n          '<input type=\"radio\" name=\"catalog.text_mode.mode\" value=\"graphic\"> Graphical mode: '+\r\n          '<input type=\"text\" name=\"catalog_size_width\" size=\"4\" style=\"text-align: right;\"> x '+\r\n          '<input type=\"text\" name=\"catalog_size_height\" size=\"4\" style=\"text-align: right;\"><br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.format.thumb.resize\">Resize thumbnails in embed catalog<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"page.format.thumb.resize\">Resize thumbnails in embed page<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"float.format.thumb.resize\">Resize thumbnails in float catalog<br>'+\r\n          '&emsp;&emsp;&emsp;1st thumbnail: '+\r\n          '<input type=\"text\" name=\"catalog_size_tn1_width\" size=\"4\" style=\"text-align: right;\"> x '+\r\n          '<input type=\"text\" name=\"catalog_size_tn1_height\" size=\"4\" style=\"text-align: right;\"><br>'+\r\n          '&emsp;&emsp;&emsp;2nd and later: '+\r\n          '<input type=\"text\" name=\"catalog_size_tn2_width\" size=\"4\" style=\"text-align: right;\"> x '+\r\n          '<input type=\"text\" name=\"catalog_size_tn2_height\" size=\"4\" style=\"text-align: right;\"><br>'+\r\n          '&emsp;Catalog/Pop-up/Search<br>'+\r\n          '<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"float.format.show.images_2nd\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.hover.images_2nd\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.search.images_2nd\"> 2nd or more images in OP<br> -->'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"float.format.show.posts\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.hover.posts\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.search.posts\"> Posts<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"float.format.show.fileinfo\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.hover.fileinfo\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.search.fileinfo\"> File information<br>'+\r\n          '<!--&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_checkbox_deletion_show\">'+\r\n          '<input type=\"checkbox\" name=\"catalog_checkbox_deletion_hover\">'+\r\n          '<input type=\"checkbox\" name=\"catalog_checkbox_deletion_search\"> Checkbox for deletion<br> -->'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"float.format.show.contents\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.hover.contents\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.search.contents\"> Format contents<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"float.format.show.layout\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.hover.layout\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.search.layout\"> Format layout<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"float.format.show.style\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.hover.style\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.search.style\"> Format style<br>'+\r\n          '<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"catalog_border_show\">&emsp;&emsp;&emsp; Show border<br> -->'+\r\n          '<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"catalog_enable_background\">&emsp;&emsp;&emsp; Use backgfound color<br> -->'+\r\n          '&emsp;Num of posts in thread headline: <input type=\"text\" name=\"float.t2h_num_of_posts\" size=\"3\" style=\"text-align: right;\"><br>'+\r\n          '<input type=\"radio\" name=\"catalog.text_mode.mode\" value=\"text\"> Text mode: '+\r\n          '<input type=\"text\" name=\"catalog_size_text_width\" size=\"4\" style=\"text-align: right;\"> x '+\r\n          '<input type=\"text\" name=\"catalog_size_text_height\" size=\"4\" style=\"text-align: right;\"><br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.text_mode.sub\"> Show title<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.text_mode.name\"> Show op\\'s name<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.text_mode.com\"> Show op\\'s comment<br>'+\r\n          '',\r\n          'Footer:<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog_footer\"> Show information footer<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.footer.br\"> Always over/under the image<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_footer_show_site_name\"> Show site\\'s name(site)<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_footer_show_board_name\"> Show board\\'s name(board)<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_footer_show_thread_no\"> Show thread\\'s no(thread)<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_footer_show_nof_rep\"> Show num of new replies(nr)<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_footer_show_nof_rep_to_me\"> Show num of new replies to me(nrtm)<br>'+\r\n          '2,<ICBX\"catalog.footer.nl\"> Show num of stored live posts(nl)<br>'+\r\n          '2,<ICBX\"catalog.footer.nd\"> Show num of deleted posts(nd)<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.footer.ctime\"> Show created time(ctime)<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.footer.btime\"> Show bumped time(btime)<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.footer.ptime\"> Show last posted time(ptime)<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.footer.prate\"> Show post rate(prate)<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_footer_show_flag\"> Show recent flags(flags)<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_footer_show_page\"> Show page No.(page)<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_footer_show_tag\"> Show tags'+\r\n//          ', in <input type=\"text\" name=\"catalog_footer_tag_letters\" size=\"2\" style=\"text-align: right;\"> letters'+\r\n          '<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.footer.archived\"> Show archived<br>'+\r\n          '&emsp;&emsp;Design:<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"radio\" name=\"catalog_footer_design\" value=\"native\"> U: nrtm/nr / R: r / I: i / P: page site/board/ flags<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"radio\" name=\"catalog_footer_design\" value=\"condensed\"> nrtm/nr/r/i/page site/board/ flags<br>'+\r\n          '',\r\n          'Watcher:<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"liveTag.watch_all\"> Watch all boards<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.auto_watch\"> Auto add to watch list<br>'+\r\n//          '&emsp;<input type=\"checkbox\" name=\"catalog.order.find_sage_in_8chan\"> Find sage post in native catalog in 8chan<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.unmark_on_hover\"> Unmark post on hover<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"thread_reader.use\"> Thread reader<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"thread_reader.own_posts_tracker\"> Own posts tracker<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;>> (You)<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;<input type=\"radio\" name=\"thread_reader.show_reply_to_me_by\" value=\"anchor\"> anchor text<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;<input type=\"radio\" name=\"thread_reader.show_reply_to_me_by\" value=\"plain\"> plain text (for dollchan)<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;(You) in name field<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;<input type=\"radio\" name=\"thread_reader.show_own_post_by\" value=\"anchor\"> name string<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;<input type=\"radio\" name=\"thread_reader.show_own_post_by\" value=\"plain\"> plain text<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"thread_reader.clean_up_own_posts\"> Clean up localStorage at loading embed native catalog<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"thread_reader.sync\"> Sync with parent catalog<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"thread_reader.triage\"> Show triage to parent catalog<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"thread_reader.triage_close\"> Close window when triage is clicked<br>',\r\n          'Notifiers:<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"notify.desktop.notify\"> Desktop<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"text\" name=\"notify.desktop.lifetime\" size=\"3\" style=\"text-align: right;\"> secs (0 means permanent)<br>'+\r\n          '&emsp;&emsp;&emsp;max: <input type=\"text\" name=\"notify.desktop.limit\" size=\"3\" style=\"text-align: right;\">, '+\r\n          'delay: <input type=\"text\" name=\"notify.desktop.delay\" size=\"3\" style=\"text-align: right;\">ms<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"notify.desktop.show_last\"> Show the last post only<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"notify.desktop.reply_to_me\"> New replies to me<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"notify.desktop.reply\"> New replies<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"notify.desktop.new_thread\"> New threads<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"notify.desktop.appear\"> Appear threads<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"notify.favicon\"> Favicon<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"notify.title.notify\"> Show number of unread replies in title<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"notify.title.hide_zero\"> Hide unread count in title bar when it is zero<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"notify.sound.notify\"> Sound'+\r\n          '&emsp;&emsp;<button name=\"notify.sound.pause\">Pause</button><br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"radio\" name=\"notify.sound.src\" value=\"beep\">Beep '+\r\n          '&emsp;freq:<input type=\"text\" name=\"notify.sound.beep_freq\" size=\"4\" style=\"text-align: right;\"> '+\r\n          'length:<input type=\"text\" name=\"notify.sound.beep_length_f\" size=\"4\" style=\"text-align: right;\"> '+\r\n          'volume:<input type=\"text\" name=\"notify.sound.beep_volume_f\" size=\"4\" style=\"text-align: right;\"><br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"radio\" name=\"notify.sound.src\" value=\"file\">File '+\r\n          '&emsp;<input type=\"file\" accept=\"audio/*\" name=\"notify.sound.file\"><br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"notify.sound.reply_to_me\"> New replies to me<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"notify.sound.reply\"> New replies<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"notify.sound.new_thread\"> New threads<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"notify.sound.appear\"> Appear threads<br>',\r\n//          '3',\r\n          function(html_funcs){return 'JSON Archiver: Store (under implementation)<br>'+\r\n            '1,Store:<br>'+\r\n            '2,1. Make sure DOWNLOAD DIRECTORY to be set correctly.<br>'+\r\n            '3,All files will be into the directory.<br>'+\r\n            '3,And also, make sure each download doesn\\'t ask you anything.<br>'+\r\n            '3,So many files will be downloaded.<br>'+\r\n            '2,2. Select sources:<br>'+\r\n            '3,Manual/AutoLive/AutoDeleted<br>'+\r\n            '4,<ICBX\"archive.oneshot.post\">&emsp;<ICBX\"archive.live.post\"><ICBX\"archive.deleted.post\"> Posts<br>'+\r\n            '4,<ICBX\"archive.oneshot.tn\">&emsp;<ICBX\"archive.live.tn\"><ICBX\"archive.deleted.tn\"> Thumbnails<br>'+\r\n            '4,<ICBX\"archive.oneshot.img\">&emsp;<ICBX\"archive.live.img\"><ICBX\"archive.deleted.img\"> Images (original size)<br>'+\r\n            '4,<ICBX\"archive.oneshot.webm\">&emsp;<ICBX\"archive.live.webm\"><ICBX\"archive.deleted.webm\"> Webms<br>'+\r\n            '3,Manual/AutoLive/AutoDeleted<br>'+\r\n            '4,<ICBX\"archive.oneshot.post_idb\">&emsp;<ICBX\"archive.live.post_idb\"><ICBX\"archive.deleted.post_idb\"> Posts<br>'+\r\n            '4,<ICBX\"archive.oneshot.tn_idb\">&emsp;<ICBX\"archive.live.tn_idb\"><ICBX\"archive.deleted.tn_idb\"> Thumbnails<br>'+\r\n            '4,<ICBX\"archive.oneshot.img_idb\">&emsp;<ICBX\"archive.live.img_idb\"><ICBX\"archive.deleted.img_idb\"> Images (original size)<br>'+\r\n            '4,<ICBX\"archive.oneshot.webm_idb\">&emsp;<ICBX\"archive.live.webm_idb\"><ICBX\"archive.deleted.webm_idb\"> Webms<br>'+\r\n            '2,3. Select files which will be skipped downloading<br>'+\r\n            '3,Downloaded files: <IF\"archive.dir_dled\" multiple directory><br>'+\r\n            '2,4a. <BTN\"archive.oneshot,OneShotArchive\"> or <BTN\"archive.start,StartArchiving\"><br>'+\r\n            '4,<IR\"archive.src,shown\"> All shown threads<br>'+\r\n            '4,<IR\"archive.src,watched\"> All watched threads<br>'+\r\n            '4,<IR\"archive.src,stored\"> All stored threads<br>'+\r\n//            '3,<IR\"archive.src\"\"scanned\"> All scanned threads for automatic archiving<br>'+\r\n            '2,4b. <ICBX\"archive.store_auto\"> Auto archiving if OP matches:<br>'+\r\n            '3,Keyword: <input type=\"text\" name=\"archive.kwd.str\" size=\"25\">'+\r\n            pref_func.settings.html_funcs.make_sel('archive.kwd.match', ['match all','match any','unmatch all','unmatch any'])+ '<br>'+\r\n            '4,<ICBX\"archive.kwd.sub\">Subject '+\r\n            '<ICBX\"archive.kwd.name\">Name '+\r\n            '<ICBX\"archive.kwd.com\">Comment <br>'+\r\n            '4,<ICBX\"archive.kwd.ci\">CI'+\r\n            ' <ICBX\"archive.kwd.sentence\">Sentence'+\r\n            ' <ICBX\"archive.kwd.re\">RE<br>'+\r\n            '2,4c. <ICBX\"archive.list\"> List picker<br>'+\r\n            '3,<textarea rows=\"1\" cols=\"40\" name=\"archive.list_str\" placeholder=\"lain  // whole lainchan\\n/tech/  // whole /tech/\\n/q/1234  // thread /q/1234\"></textarea><br>'+\r\n            '2,4d. <ICBX\"archive.list_inherit\"> Inherit previous archiving list<br>'+\r\n            '2,4e. You can select target threads individually using triage<br>';},\r\n          function(html_funcs){return 'JSON Archiver: Restore (under implementation)<br>'+\r\n            '1,Restore:<br>'+\r\n            '2,1. Open a live catalog, index page or thread to be overriden.<br>'+\r\n            '4,CatChan must be used in it.<br>'+\r\n            '2,2. Select format<br>'+\r\n            '3,<IR\"archive.format,auto\">Extract from filename: Domain-Board-No_Sub.json<br>'+\r\n            '3,<IR\"archive.format,manual\">Set manually: '+ html_funcs.make_sel('archive.domain',html_funcs.get_domains()) + '/<ITB5\"archive.board\">/No.<br>'+\r\n            '2,3. Select JSON and image files<br>'+\r\n            '3,JSON/HTML files: <IF\"archive.json\" multiple accept=\".html,.json,text/*\"><br>'+\r\n//            '3,<ICBX\"archive.load_img\"> Image files: <IF\"archive.dir\" multiple directory><br>'+\r\n//            '3,<ICBX\"archive.load_img\"> Image files: <IF\"archive.dir\" webkitdirectory directory><br>'+\r\n            '3,<ICBX\"archive.load_img\"> Image files: <IF\"archive.dir\" multiple webkitdirectory directory><br>'+\r\n            '2,4. <BTN\"archive.restore,Restore\"> <ICBX\"archive.restore_auto\"> Auto restore after selection<br>'+\r\n            '4,<ICBX\"archive.clear_threads\"> Clear all threads at opening an archive<br>'+\r\n            '2,5. <BTN\"archive.clear_files_button,Clear Files\"> <ICBX\"archive.clear_files\"> Auto clear after open<br>';},\r\n          'UIP tracker for 4chan:<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"uip_tracker.on\"> Show num of unique IPs after post No.<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"uip_tracker.posts\"> Show num of posts<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"uip_tracker.deletion\"> Show deleted posts\\' No.<br>'+\r\n          '&emsp;&emsp;Interval: <input type=\"text\" name=\"uip_tracker.interval\" size=\"3\" style=\"text-align: right;\">sec'+\r\n          '&emsp;<input type=\"checkbox\" name=\"uip_tracker.adaptive\"> Adaptive<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"uip_tracker.auto_open\"> Open next thread automatically<br>'+\r\n          '&emsp;&emsp;Conditions:<br>'+\r\n          '&emsp;&emsp;&emsp;After <input type=\"text\" name=\"uip_tracker.auto_open_th\" size=\"3\" style=\"text-align: right;\">th post<br>'+\r\n          '&emsp;&emsp;&emsp;OP contains <textarea style=\"height:1em\" cols=\"20\" name=\"uip_tracker.auto_open_kwd\"></textarea><br>',\r\n          'Command interface for overwriting preference<br>'+\r\n          '&emsp;<textarea style=\"height:1em\" cols=\"40\" name=\"overwrite_site2_json_str\"></textarea><br>'+\r\n          '&emsp;<button name=\"JSON_ex\">extract</button>'+\r\n          '<button name=\"JSON_ex_full\">extract_full</button>'+\r\n          '<button name=\"JSON_ex_filter\">extract_current_filter</button>'+\r\n          '&emsp;<button name=\"JSON_query\">query</button>'+\r\n          '&emsp;&emsp;<button name=\"JSON\">JSON</button>'+\r\n          '<span name=\"JSON_result\"></span><br>'+\r\n          '&emsp;<textarea style=\"height:1em\" cols=\"40\" name=\"overwrite_site2_eval_str\"></textarea><br>'+\r\n          '&emsp;<button name=\"EVAL\">EVAL</button><br>',\r\n//          '5',\r\n          'Networking:<br>'+\r\n          '&emsp;Cross domain connection:<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_cross_domain_connection\" value=\"direct\"> Direct connection<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_cross_domain_connection\" value=\"indirect\"> Indirect connection<br>'+\r\n//          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_fake_access\"> Fake access made by human to avoid poor administration<br>'+\r\n//          '&emsp;&emsp;&emsp;(This causes heavier network traffic and server load,<br>'+\r\n//          '&emsp;&emsp;&emsp;but administrators can\\'t see what script you are using)<br>'+\r\n//          '&emsp;Configuration:<br>'+\r\n//          '&emsp;&emsp;(To get faster feeling, you should check them all.)<br>'+\r\n          '&emsp;Data source:<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog.design\" value=\"page\">Page<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog.design\" value=\"auto\">Auto<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog.design\" value=\"catalog\">Catalog<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.catalog_json\"> From json file<br>'+\r\n          '1,Lazy load/draw<br>'+\r\n          '2,Catalog/IndexPage/Float <br>'+\r\n          '3,<input type=\"checkbox\" name=\"catalog.draw_on_demand\">'+\r\n          '<input type=\"checkbox\" name=\"page.draw_on_demand\">'+\r\n          '<input type=\"checkbox\" name=\"float.draw_on_demand\"> Draw threads<br>'+\r\n          '3,<input type=\"checkbox\" name=\"catalog.load_on_demand\">'+\r\n          '<input type=\"checkbox\" name=\"page.load_on_demand\">'+\r\n          '<input type=\"checkbox\" name=\"float.load_on_demand\"> Load HTMLs/JSONs<br>'+\r\n          '2,<input type=\"checkbox\" name=\"network.adaptive\"> Adaptive<br>'+\r\n          '3,100%: new <input type=\"text\" name=\"network.th100\" size=\"3\" style=\"text-align: right;\"> threads, '+\r\n          '<input type=\"text\" name=\"network.th100_delay\" size=\"4\" style=\"text-align: right;\"> ms delay<br>'+\r\n          '3,20%: new <input type=\"text\" name=\"network.th20\" size=\"3\" style=\"text-align: right;\"> threads, '+\r\n          '<input type=\"text\" name=\"network.th20_delay\" size=\"4\" style=\"text-align: right;\"> ms delay<br>'+\r\n          '1,<input type=\"checkbox\" name=\"network.fetch_actively\"> Fetch missing info actively<br>'+\r\n          '1,<input type=\"checkbox\" name=\"healthIndicator.show\"> Health indicator, '+\r\n          'history: <input type=\"text\" name=\"healthIndicator.max\" size=\"2\" style=\"text-align: right;\"><br>'+\r\n          '2,<input type=\"checkbox\" name=\"healthIndicator.expand_running\"> Show details of running indicators<br>'+\r\n          '2,<input type=\"checkbox\" name=\"healthIndicator.dont_retire_running\"> Don\\'t retire running indicators<br>'+\r\n          '2,<input type=\"checkbox\" name=\"healthIndicator.cancel\"> Cancel scan when it is clicked<br>'+\r\n          '',\r\n          'General 2:<br>'+\r\n          '&emsp;Localtime offset<input type=\"text\" name=\"localtime_offset\" size=\"2\" style=\"text-align: right;\"><br>'+\r\n          'Share loaded html with other tabs to update<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"info_server\"> Broadcast loaded html to other tabs (server)<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"info_client\"> Listen other tab\\'s broadcasting (client)<br>'+\r\n          'Cloudflare<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"cloudflare.auto_reload\"> Auto reload at server error<br>'+\r\n          '&emsp;&emsp;<input type=\"text\" name=\"cloudflare.auto_reload_time\" size=\"2\" style=\"text-align: right;\"> minutes after<br>'+\r\n          '<br>'+\r\n          '<input type=\"checkbox\" name=\"tooltips.info.show\"> Show infotips<br>'+\r\n          '&emsp;pop up delay: <input type=\"text\" name=\"tooltips.info.popup_delay\" size=\"4\" style=\"text-align: right;\"> ms<br>'+\r\n          '&emsp;pop down delay: <input type=\"text\" name=\"tooltips.info.popdown_delay\" size=\"4\" style=\"text-align: right;\"> ms<br>'+\r\n          '<input type=\"checkbox\" name=\"tooltips.help.show\"> Show tooltips<br>'+\r\n          '&emsp;pop up delay: <input type=\"text\" name=\"tooltips.help.popup_delay\" size=\"4\" style=\"text-align: right;\"> ms<br>'+\r\n          '&emsp;pop down delay: <input type=\"text\" name=\"tooltips.help.popdown_delay\" size=\"4\" style=\"text-align: right;\"> ms<br>'+\r\n          'Misc.<br>'+\r\n          '<input type=\"checkbox\" name=\"recovery.comment\"> Recover comment when browser was crashed<br>'+\r\n          '<input type=\"checkbox\" name=\"catalog_auto_update_countdown\"> Show count down to auto update<br>'+\r\n          '<input type=\"checkbox\" name=\"catalog_footer_ignore_my_own_posts\"> Ignore my own posts at counting unread posts<br>'+\r\n          '<input type=\"checkbox\" name=\"pref2.KC.summer_time\"> Summer time in KC<br>'+\r\n          '<br>'+\r\n          'Patches<br>'+\r\n          '<input type=\"checkbox\" name=\"patch.delayed_invoke.use\"> Delayed invoke for 4chan on FF, '+\r\n          '<input type=\"text\" name=\"patch.delayed_invoke.sec\" size=\"2\" style=\"text-align: right;\">sec.<br>'+\r\n          '<input type=\"checkbox\" name=\"pref2.meguca.remove_history_class\"> Remove history class in meguca'+\r\n          '',\r\n          'Styles:<br>'+\r\n          '1,Windows and popups:<br>'+\r\n          '2,<IR\"style.sel,fix\"> Fixed <BTN\"style.fix.reset,reset\"><br>'+\r\n          '3,Title bar:<ITBL30\"style.fix.titleBar_str\"><br>'+\r\n          '3,Window:<ITBL30\"style.fix.window_str\"><br>'+\r\n          '3,Pop up:<ITBL30\"style.fix.popUp_str\"><br>'+\r\n          '2,<IR\"style.sel,copy\"> Copy from CSS <BTN\"style.copy.reset,reset\"><br>'+\r\n          '3,Title bar:<ITBL30\"style.copy.titleBar_str\"><br>'+\r\n          '3,Window:<ITBL30\"style.copy.window_str\"><br>'+\r\n          '3,Pop up:<ITBL30\"style.copy.popUp_str\"><br>'+\r\n          '1,Others:<br>'+\r\n          '2,Editing post:<ITBL30\"style.post_editing\"><br>'+\r\n          '',\r\n          'Features:<br>'+\r\n          '<input type=\"checkbox\" name=\"features.page\"> Page<br>'+\r\n          '<input type=\"checkbox\" name=\"features.graph\"> Graph<br>'+\r\n//          '<input type=\"checkbox\" name=\"features.setting\"> Setting<br>'+\r\n          '<input type=\"checkbox\" name=\"features.setting2\"> Setting2<br>'+\r\n          '<input type=\"checkbox\" name=\"features.postform\"> Postform<br>'+\r\n          '<input type=\"checkbox\" name=\"features.catalog\"> Catalog<br>'+\r\n          '<input type=\"checkbox\" name=\"features.listener\"> Listener<br>'+\r\n          '<input type=\"checkbox\" name=\"features.uip_tracker\"> UIP_tracker<br>'+\r\n          '<input type=\"checkbox\" name=\"features.thread_reader\"> Thread Reader<br>'+\r\n          '<input type=\"checkbox\" name=\"features.recovery\"> Recovery comment<br>'+\r\n//          '<input type=\"checkbox\" name=\"features.debug\"> Debug<br>'+\r\n          'Notifications:<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"features.notify.desktop\"> DesktopNotification<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"features.notify.sound\"> Sound<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"features.notify.favicon\"> Favicon<br>'+\r\n          '',\r\n          'CatChan<br>'+\r\n          'Version 2016.10.16.3<br>'+\r\n          '<a href=\"https://github.com/DogMan8/CatChan\">GitHub</a><br>'+\r\n          '<a href=\"https://github.com/DogMan8/CatChan/raw/master/CatChan.user.js\">Get stable release</a><br>'+\r\n          '<a href=\"https://github.com/DogMan8/CatChan/raw/develop/CatChan.user.js\">Get BETA release</a><br>'+\r\n          '<br><br>'+\r\n          'Debug mode<br>'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.0\">'+\r\n          '<input type=\"text\" name=\"debug_mode.unread_count\" size=\"30\" style=\"text-align: right;\">'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.2\">'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.3\">'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.4\">&emsp;'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.5\">'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.parse_error\">'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.7\"><br>'+\r\n          '<input type=\"text\" name=\"debug_mode.site2func\" size=\"15\" style=\"text-align: right;\" placeholder=\"catalog_json2html3\">'+\r\n          '<button name=\"debug_site2\">dump_site2</button>'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.site2func_expand\">func<br>'+\r\n          '<input type=\"text\" name=\"debug_mode.pfunc\" size=\"15\" style=\"text-align: right;\" placeholder=\"4chan:catalog_json\">'+\r\n          '<button name=\"debug_pfunc\">dump_parse_funcs</button>'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.pfunc_expand\">func<br>'+\r\n          '<input type=\"text\" name=\"debug_mode.pfunc_comp\" size=\"15\" style=\"text-align: right;\" placeholder=\"4chan:catalog_json\">'+\r\n          '<button name=\"debug_pfunc_comp\">compare_parse_funcs</button>'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.pfunc_comp_expand_same\"><input type=\"checkbox\" name=\"debug_mode.pfunc_comp_expand_diff\">func <br>'+\r\n          '1,<input type=\"text\" name=\"debug_mode.pfunc_comp_proto\" size=\"40\" style=\"text-align: right;\" placeholder=\"temporal prototype, DEFAULT:catalog_json\"><br>'+\r\n          '<input type=\"text\" name=\"debug_mode.pfunc_all\" size=\"15\" style=\"text-align: right;\"  placeholder=\"op_img_url\">'+\r\n          '<button name=\"debug_pfunc_all\">find_parse_funcs</button>'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.pfunc_all_expand\">func<br>'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.9\"><br>'+\r\n          (function(){\r\n            var str = '';\r\n            for (var i=10;i<30;i++) str += '<input type=\"checkbox\" name=\"debug_mode.'+i+'\">' + ((i%10===4)? '&emsp;' : (i%10===9)? '<br>' : '');\r\n            return str;\r\n          })() +\r\n          'Test mode<br>'+\r\n          (function(){\r\n            var str = '';\r\n            var i=-1;\r\n            while (pref.test_mode[++i]!==undefined) str += '<input type=\"checkbox\" name=\"test_mode.'+i+'\">' + ((i%10===4)? '&emsp;' : (i%10===9)? '<br>' : '');\r\n            return str;\r\n          })() +\r\n          '<input type=\"checkbox\" name=\"test_mode.tips\">'+\r\n          '<input type=\"text\" name=\"test_mode.num\" size=\"6\" style=\"text-align: right;\">'+\r\n          '<input type=\"text\" name=\"test_mode.test_str\" size=\"30\" style=\"text-align: right;\">'+\r\n          '<input type=\"text\" name=\"test_mode.num_f\" size=\"6\" style=\"text-align: right;\">'+\r\n          '&emsp;<button name=\"button_test\">test</button><br>'+\r\n          '&emsp;<button name=\"load_samples\">setting_samples</button><br>'+\r\n          '<IF\"test_mode.js_file\" accept=\".js,text/*\"><BTN\"test_mode.js_load,JS_load\"><br>',\r\n        ],\r\n        html_common:\r\n          '<span name=\"reload_recommended\" style=\"display:none;background:yellow\">&emsp;&emsp;RELOAD IS REQUIRED TO GET LIGHT FEELING&emsp;&emsp;<br></span>'+\r\n          '<span name=\"reload_required\" style=\"display:none;background:red;color:white\">&emsp;&emsp;RELOAD IS REQUIRED&emsp;&emsp;</span>'+\r\n          '<br><button name=\"close\">close</button>'+\r\n          '&emsp;<button name=\"save\">save</button>'+\r\n          '<button name=\"load_default\">load_default</button>'+\r\n          '<button name=\"load_default_of_this_page\">load_default_of_this_page</button>',\r\n//        onchange_event : function(){\r\n//          pref_func.apply_prep(this,true);\r\n//          if (pref_func.settings.onchange_funcs[this.name]) pref_func.settings.onchange_funcs[this.name]();\r\n//        },\r\n        tag_gen: null,\r\n//        health_indicator: null,\r\n        get onchange_funcs_formatted(){\r\n          Object.defineProperty(this,'onchange_funcs_formatted',{value:pref_func.add_onchange_format(this.onchange_funcs), writable:true, enumerable:true, configurable:true});\r\n          return this.onchange_funcs_formatted;\r\n        },\r\n        onchange_funcs : {\r\n          __proto__: {\r\n            SHOWALL: function(e){ // bound later.\r\n              this.TOGGLE(e.target,'HIDEALL','',null,'no');\r\n              Array.prototype.slice.call(e.target.parentNode.parentNode.querySelectorAll('[name=SHOW],[name=SHOW2],[name=SHOW3]')).forEach(function(v){v.onclick({target:v, currentTarget:v});});\r\n//              Array.prototype.slice.call(e.target.parentNode.parentNode.parentNode.querySelectorAll('[name=SHOW],[name=SHOW2]')).forEach(function(v){v.onclick({target:v});});\r\n            },\r\n            HIDEALL: function(e){ // bound later.\r\n              this.TOGGLE(e.target,'SHOWALL','',null,'no');\r\n              Array.prototype.slice.call(e.target.parentNode.parentNode.querySelectorAll('[name=HIDE],[name=HIDE2],[name=HIDE3]')).forEach(function(v){v.onclick({target:v, currentTarget:v});});\r\n//              Array.prototype.slice.call(e.target.parentNode.parentNode.parentNode.querySelectorAll('[name=HIDE],[name=HIDE2]')).forEach(function(v){v.onclick({target:v});});\r\n            },\r\n            SHOW: function(e){this.TOGGLE(e.target,'HIDE','');}, // bound later.\r\n            HIDE: function(e){this.TOGGLE(e.target,'SHOW','none');}, // bound later.\r\n            TOGGLE: function(et,name,disp, dst_dom, tgt_dom){\r\n              if (!dst_dom) dst_dom = et;\r\n              var str = et.getAttribute('data-str');\r\n              et.setAttribute('data-str',dst_dom.textContent);\r\n              dst_dom.textContent = str;\r\n              et.setAttribute('name',name);\r\n              if (tgt_dom==='no') return;\r\n              if (!tgt_dom) tgt_dom = et.nextSibling;\r\n              tgt_dom.style.display = disp;\r\n            },\r\n//            NEXT: function(e){e.currentTarget.nextSibling.onclick({target:e.currentTarget.nextSibling});},\r\n            SHOW2: function(e){this.TOGGLE2(e.target,'HIDE2','');}, // bound later.\r\n            HIDE2: function(e){this.TOGGLE2(e.target,'SHOW2','none');}, // bound later.\r\n            TOGGLE2: function(et,name,disp){ // bound later.\r\n              if (et.tagName!=='A') et = et.parentNode;\r\n              this.TOGGLE(et,name,disp,et.childNodes[2], et.nextSibling.nextSibling);\r\n            },\r\n//            SHOW3: function(e){ // bound later.\r\n//              if (e.target.previousSibling) {\r\n//                var div = document.createElement('div');\r\n//                div.setAttribute('style','clear:both');\r\n//                e.target.parentNode.insertBefore(div,e.target);\r\n//              }\r\n//              e.target.nextSibling.style.display = '';\r\n//              e.target.style.display = 'none';\r\n//            },\r\n//            HIDE3: function(e){ // bound later.\r\n//              e.target.parentNode.previousSibling.style.display = '';\r\n//              e.target.parentNode.style.display = 'none';\r\n//              var etPpp = e.target.parentNode.previousSibling.previousSibling;\r\n//              if (etPpp) e.target.parentNode.parentNode.removeChild(etPpp);\r\n//            },\r\n            SHOW3: function(e){ // bound later.\r\n              var label = e.target.getAttribute('data-show3');\r\n              var tgt = e.target.previousSibling;\r\n              while (tgt.getAttribute('data-show3')!==label) tgt = tgt.previousSibling;\r\n              tgt.style.display = '';\r\n              e.target.style.display = 'none';\r\n            },\r\n            HIDE3: function(e){ // bound later.\r\n              var label = e.target.parentNode.getAttribute('data-show3');\r\n              var tgt = e.target.parentNode.nextSibling;\r\n              while (tgt.getAttribute('data-show3')!==label) tgt = tgt.nextSibling;\r\n              tgt.style.display = '';\r\n              e.target.parentNode.style.display = 'none';\r\n            },\r\n            SHOW2_I: function(e){e.target.previousSibling.onclick({target:e.target.previousSibling});},\r\n//            SHOW: function(e){\r\n//              e.target.style.display = 'none';\r\n//              e.target.nextSibling.style.display = '';\r\n//              e.target.nextSibling.nextSibling.style.display = '';\r\n//            },\r\n//            HIDE: function(e){\r\n//              e.target.style.display = 'none';\r\n//              e.target.nextSibling.style.display = 'none';\r\n//              e.target.previousSibling.style.display = '';\r\n//            },\r\n            SUB: function(e){\r\n//              var pns = e.currentTarget.parentNode.querySelectorAll('span[name=\"' +e.target.getAttribute('name')+ '\"]');\r\n              var pn = e.currentTarget.previousSibling.previousSibling;\r\n              if (pn && pn.querySelectorAll) {\r\n                var pns = pn.querySelectorAll('span[data-class=show_value]');\r\n                if (pns.length>0) pref_func.apply_prep_2(pns, false);\r\n              }\r\n            }\r\n          },\r\n          'uip_tracker.on' : uip_tracker_init,\r\n          'healthIndicator.show' : function(){cataLog.healthIndicator.show();},\r\n          'healthIndicator.expand_running' : function(){cataLog.healthIndicator.shrink_running();},\r\n          'settings.indexing' : function(e){\r\n            var this_obj = pref_func.settings;\r\n            var pn13_1 = pref_func.settings.pn13.childNodes[1];\r\n            if (pn13_1.innerHTML) pref_func.tooltips.remove_hier(pn13_1);\r\n            pref_func.settings.files_store();\r\n            var html = (((typeof(this_obj.htmls[pref.settings.indexing])==='function')? this_obj.htmls[pref.settings.indexing](this_obj.html_funcs) :\r\n                                                                                        this_obj.htmls[pref.settings.indexing]   )+\r\n                       this_obj.html_common);\r\n            pn13_1.innerHTML = pref_func.format_html_str(html);\r\n            pref_func.add_onchange(pn13_1,pref_func.settings.onchange_funcs_formatted);\r\n            pref_func.settings.apply_pn13_1();\r\n//            pref_func.tooltips.add_hier(pn13_1);\r\n            pref_func.tooltips.add_root(pn13_1);\r\n          },\r\n          'pn13_1_warning_reload': function(){\r\n            pref3.reload_required = true;\r\n            pref_func.settings.onchange_funcs['pn13_1_warning']();\r\n          },\r\n          'pn13_1_warning': function(){\r\n            var pn13_1 = pref_func.settings.pn13.childNodes[1];\r\n            var pn = pn13_1.getElementsByTagName('span')['reload_required'];\r\n            pn.style.display = (pref3.reload_required || pref3.stats.use!==pref.stats.use || pref.stats.estimate_posts && !pref3.stats.estimate_posts)? '' : 'none';\r\n            var pn = pn13_1.getElementsByTagName('span')['reload_recommended'];\r\n            pn.style.display = (!pref.stats.estimate_posts && pref3.stats.estimate_posts)? '' : 'none';\r\n          },\r\n          'tag.scan' : function(){\r\n            pref.catalog.board.board_tags = true;\r\n            pref_func.settings.onchange_funcs['tag.generate_caller']('tag.scan');\r\n          },\r\n          'tag.same_tag_refresh' : function(){\r\n            pref.catalog.board.board_tags_same = true;\r\n            pref_func.settings.onchange_funcs['tag.generate_caller']('tag.same_tag_refresh');\r\n          },\r\n          'tag.generate_caller' : function(src){\r\n            http_req.get('tag','8chan','https://'+site2['8chan'].domain_url+'/boards.json',pref_func.settings.onchange_funcs['tag.generate_callback'],false,false,src);\r\n            if (pref_func.settings.pn13) pref_func.settings.apply_pn13_1();\r\n          },\r\n          'tag.generate_callback' : function(key,value,arg){\r\n            site3['8chan'].boards = ('response' in value)? value.response : JSON.parse(value.responseText);\r\n            pref_func.settings.onchange_funcs['tag.re_generate'](arg);\r\n          },\r\n          'tag.re_generate' : function(arg){\r\n            var str = catalog_obj.scan_tags_common(site3['8chan'].boards,'name=\"tag.gen\"');\r\n            if (!pref_func.settings['tag_gen']) {\r\n              if (arg!=='tag.same_tag_refresh') {\r\n                var html = '<div><button name=\"tag.scan\">Refresh</button><br>'+\r\n                  '<textarea style=\"height:1em\" cols=\"20\" name=\"tag.gen_str\"></textarea>'+\r\n                  '<button name=\"tag.gen_add\">Add to list</button></div><div>' + str +'</div>';\r\n                cnst.make_popup(pref_func.settings,'tag_gen',html,pref_func.settings.onchange_funcs);\r\n                var pn = pref_func.settings['tag_gen'].childNodes[1];\r\n//                pn.getElementsByTagName('textarea')[0].value='board_group_name';\r\n                pn.style.height = '200px';\r\n                pn.style.width  = '200px';\r\n                pn.style.overflow = 'auto';\r\n                pn.style.resize = 'both';\r\n                cnst.bottom_top(pn);\r\n              }\r\n            } else pref_func.settings['tag_gen'].childNodes[1].childNodes[1].innerHTML = str;\r\n            if (pref_func.settings['tag_gen']) pref_func.add_onchange(pref_func.settings['tag_gen'].childNodes[1].childNodes[1],pref_func.settings.onchange_funcs_formatted);\r\n\r\n            var str = ''\r\n            var obj = site3['8chan'].boards;\r\n            var myself = 0;\r\n            while (myself<obj.length-1 && site.board!=='/'+obj[myself].uri+'/') myself++;\r\n            for (var i=0;i<obj[myself].tags.length;i++) {\r\n              var key = obj[myself].tags[i];\r\n              str = str + '#' + key;\r\n              for (var j=0;j<obj.length;j++)\r\n                for (var m=0;m<obj[j].tags.length;m++)\r\n                  if (obj[j].tags[m]===key) str = str + ',8chan/' + obj[j].uri + '/';\r\n              str = str + '\\n';\r\n            }\r\n            pref_func.catalog_board_list_str_bt_same = str;\r\n\r\n            pref_func.catalog_board_list_str_bt = '';\r\n            pref_func.settings.onchange_funcs['board_sel_refresh']();\r\n          },\r\n//          'catalog.tag.ignore' : function(){pref_func.settings.onchange_funcs['tag.re_generate']();},\r\n//          'catalog.tag.max' : function(){pref_func.settings.onchange_funcs['tag.re_generate']();},\r\n//          'tag.gen_str' : function(){pref_func.settings.onchange_funcs['tag.gen']();},\r\n          'tag.gen' : function(){\r\n            var cbxes = pref_func.settings['tag_gen'].childNodes[1].getElementsByTagName('input');\r\n            var str = '';\r\n            var str_name = pref_func.settings['tag_gen'].childNodes[1].getElementsByTagName('textarea')[0].value;\r\n            var obj = site3['8chan'].boards;\r\n            for (var i=0;i<cbxes.length;i++)\r\n              if (cbxes[i].checked) {\r\n                var key = cbxes[i].nextSibling.textContent.replace(/ [0-9]*: /,'');\r\n                if (str_name==='') str_name = '#' + key;\r\n                for (var j=0;j<obj.length;j++)\r\n                  for (var m=0;m<obj[j].tags.length;m++)\r\n                    if (obj[j].tags[m]==key) str = str + '8chan/' + obj[j].uri + '/,';\r\n              }\r\n            pref_func.catalog_board_list_str_bt = str_name + ',' + str;\r\n            pref_func.settings.onchange_funcs['board_sel_refresh']();\r\n//            pref_func.str2obj('catalog_board_list_str');\r\n//            if (pref_func.board_sel) pref_func.apply_prep(pref_func.board_sel,false);\r\n          },\r\n          'tag.gen_add' : function(){\r\n            pref_func.settings.onchange_funcs['tag.gen']();\r\n            pref_func.settings.onchange_funcs['tag.add_to_list'](pref_func.catalog_board_list_str_bt);\r\n          },\r\n          'tag.recommendation_add' : function(){\r\n            pref_func.settings.onchange_funcs['tag.add_to_list'](pref_func.catalog_board_list_str_or);\r\n          },\r\n          'tag.add_to_list' : function(str){\r\n            if (str!=='') {\r\n              if (pref.catalog_board_list_str.search(/\\n$/)==-1) pref.catalog_board_list_str = pref.catalog_board_list_str + '\\n';\r\n              pref.catalog_board_list_str = pref.catalog_board_list_str + str + '\\n';\r\n              if (pref_func.settings.pn13) pref_func.settings.apply_pn13_1();\r\n//              pref_func.str2obj('catalog_board_list_str');\r\n//              if (pref_func.board_sel) pref_func.apply_prep(pref_func.board_sel,false);\r\n              pref_func.settings.onchange_funcs['board_sel_refresh']();\r\n            }\r\n          },\r\n          'board_sel_refresh' : function(){\r\n            pref_func.str2obj('catalog_board_list_str');\r\n            cnst.auto_shrink_board_selector.str_changed();\r\n          },\r\n          'stats.use' : 'pn13_1_warning',\r\n          'stats.estimate_posts' : 'pn13_1_warning',\r\n          'stats.auto_acquisition' : function(){cnst.auto_shrink_board_selector.color();},\r\n          'stats.auto_acquisition_all' : 'stats.auto_acquisition',\r\n          'catalog.board.recommendation': 'board_sel_refresh',\r\n          'catalog.board.board_tags': 'board_sel_refresh',\r\n          'catalog_board_list_str': 'board_sel_refresh',\r\n          'catalog.board.all_boards': 'board_sel_refresh',\r\n          'JSON' : function() {\r\n//          pref_func.apply_prep(pref_func.settings.pn13.getElementsByTagName('TEXTAREA')['overwrite_site2_json_str'],true);\r\n            pref_func.site2_json();\r\n          },\r\n          'JSON_query' : function() {\r\n            pref_func.site2_json(true);\r\n          },\r\n          'JSON_ex' : function() {\r\n            pref_func.site2_json_ex(false);\r\n            pref_func.settings.apply_pn13_1();\r\n          },\r\n          'JSON_ex_full' : function() {\r\n            pref_func.site2_json_ex(true);\r\n            pref_func.settings.apply_pn13_1();\r\n          },\r\n          'JSON_ex_filter' : function() {\r\n            pref_func.site2_json_ex(false, true);\r\n            pref_func.settings.apply_pn13_1();\r\n          },\r\n          'EVAL' : function() {\r\n//            pref_func.apply_prep(pref_func.settings.pn13.getElementsByTagName('TEXTAREA')['overwrite_site2_eval_str'],true);\r\n            pref_func.site2_eval();\r\n          },\r\n          'close': function(){pref_func.settings.show_hide();},\r\n//          'save' : function(){if (localStorage) localStorage[pref.script_prefix+'.pref']=JSON.stringify(pref);},\r\n          'save' : function(){\r\n            if (localStorage) localStorage[pref.script_prefix+'.pref']=JSON.stringify(pref_func.site2_json_ex_remove());\r\n          },\r\n          'load_default' : function(e){\r\n            var pref_def = pref_default();\r\n            delete pref_def.settings.indexing;\r\n            delete pref_def.catalog_board_list_sel;\r\n            delete pref_def.catalog.filter;\r\n            if (e.target.name==='load_default_of_this_page') {\r\n              var nodes = e.target.parentNode.getElementsByTagName('*');\r\n              for (var i=0;i<nodes.length;i++)\r\n                if (nodes[i].name) {\r\n                  var src = pref_func.get_tgt(nodes[i].name, pref_def, true);\r\n                  if (src) {\r\n                    var dst = pref_func.get_tgt(nodes[i].name);\r\n                    dst[0][dst[1]] = src[0][src[1]];\r\n                  }\r\n                }\r\n            } else {\r\n              if (e.target.name.indexOf('easy2')===0) delete pref_def.easy2;\r\n              pref_func.pref_overwrite(pref,pref_def);\r\n              pref3.reload_required = true;\r\n            }\r\n//            var idx = pref.settings.indexing;\r\n//            pref = pref_default();\r\n            pref_func.obj_init();\r\n//            pref.settings.indexing = idx;\r\n//            pref_func.settings.onchange_funcs['settings.indexing']();\r\n            pref_func.settings.apply_pn13_1();\r\n            pref_func.settings.apply_pn13_1(true, e.target.name==='load_default_of_this_page' && cataLog.threads);  // writing to sessionStrage.\r\n          },\r\n          'load_default_of_this_page' : 'load_default',\r\n          'load_samples' : function(){pref_func.pref_samples.init();},\r\n          'catalog_triage_str' : function(){\r\n            if (catalog_obj && catalog_obj.catalog_func()!==null) catalog_obj.catalog_func().remake_triage();\r\n          },\r\n          'triage.hide_toggle': 'catalog_triage_str',\r\n          'catalog_footer_show_nof_rep'       : 'catalog_footer',\r\n          'catalog_footer_show_nof_rep_to_me' : 'catalog_footer',\r\n          'catalog_footer_show_site_name'     : 'catalog_footer',\r\n          'catalog_footer_show_board_name'    : 'catalog_footer',\r\n          'catalog_footer_show_thread_no'     : 'catalog_footer',\r\n          'catalog_footer_show_flag'          : 'catalog_footer',\r\n          'catalog_footer_show_page'          : 'catalog_footer',\r\n          'catalog_footer_design'             : 'catalog_footer',\r\n          'catalog_footer_show_tag'           : 'catalog_footer',\r\n          'catalog.footer.*'                  : 'catalog_footer',\r\n          'catalog_footer' : function(){\r\n            if (catalog_obj && catalog_obj.catalog_func()!==null) catalog_obj.catalog_func().update_all_footers();\r\n          },\r\n          'thread_reader.use' : thread_reader_init,\r\n          'catalog.appearance.titleBar.settings'        : 'catalog.appearance.titleBar.filter',\r\n          'catalog.appearance.titleBar.refresh'         : 'catalog.appearance.titleBar.filter',\r\n          'catalog.appearance.titleBar.num_of_pages'    : 'catalog.appearance.titleBar.filter',\r\n          'catalog.appearance.titleBar.boards_selector' : 'catalog.appearance.titleBar.filter',\r\n          'catalog.appearance.titleBar.filter' : function(){\r\n            if (catalog_obj && catalog_obj.catalog_func()!==null) catalog_obj.catalog_func().pn12_0_2.getElementsByTagName('*')[this.name.substr(this.name.lastIndexOf('.')+1)].style.display = (this.checked)? '' : 'none';\r\n          },\r\n          'catalog_size_text_height': 'catalog_size_width', \r\n          'catalog_size_text_width': 'catalog_size_width',\r\n          'catalog_size_height': 'catalog_size_width',\r\n          'catalog_size_width': function(){\r\n            if (catalog_obj && catalog_obj.catalog_func()!==null) catalog_obj.catalog_func().catalog_resized(this);\r\n          },\r\n          'catalog.click_area': function(){styleSheet.make_rule_click_area();},\r\n          'style.sel': function(){styleSheet.styles_changed();},\r\n          'style.fix.titleBar_str': 'style.sel',\r\n          'style.fix.window_str': 'style.sel',\r\n          'style.fix.popUp_str': 'style.sel',\r\n          'style.copy.titleBar_str': 'style.sel',\r\n          'style.copy.window_str': 'style.sel',\r\n          'style.copy.popUp_str': 'style.sel',\r\n          'style.fix.reset': function(){\r\n            var pref_def = pref_default();\r\n            var tgt = this.name.split('.')[1];\r\n            pref_func.pref_overwrite(pref.style[tgt], pref_def.style[tgt]);\r\n            pref_func.settings.apply_pn13_1();\r\n            pref_func.settings.onchange_funcs['style.sel']();\r\n          },\r\n          'style.copy.reset': 'style.fix.reset',\r\n////////          'catalog.click_area': function(){ // working code.\r\n////////            if (pref_func.style_sheet) {\r\n////////              if (pref_func.style_sheet.cssRules[2]) pref_func.style_sheet.deleteRule(2);\r\n////////              pref_func.settings.onchange_funcs['catalog.click_area_add_rule']();\r\n////////            }\r\n////////          },\r\n////////          'catalog.click_area_add_rule': function(){\r\n////////////            var tgt  = site2[site.nickname].parse_funcs[site.whereami+'_html']['class_'+((pref.catalog.click_area==='entire')? 'thread' : 'thumbnail')]; // working code.\r\n////////////            if (!tgt) tgt = 'dummy';\r\n////////////            pref_func.style_sheet.insertRule('.'+tgt+' {cursor: pointer}',2);\r\n////////            pref_func.style_sheet.insertRule('.'+pref.script_prefix+((pref.catalog.click_area==='entire')? '_thread' : '_thumbnail')+' {cursor: pointer}',2);\r\n////////          },\r\n//          'sound.beep_length_f' : notifier.sound.make_beep,\r\n//          'sound.beep_volume_f' : notifier.sound.make_beep,\r\n//          'sound.beep_freq'     : notifier.sound.make_beep,\r\n//          'sound.src'           : notifier.sound.src,\r\n//          'catalog.order.reply_to_me' : catalog_func.onchange_funcs['catalog.indexing'](),\r\n//          'catalog.order.reply'  : catalog_func.onchange_funcs['catalog.indexing'](),\r\n//          'catalog.order.watch'  : catalog_func.onchange_funcs['catalog.indexing'](),\r\n//          'catalog.order.sticky' : catalog_func.onchange_funcs['catalog.indexing'](),\r\n          'virtualBoard.p_board' : function(){liveTag.update_boardlist(true);},\r\n          'virtualBoard.p_remove' : 'virtualBoard.p_board',\r\n          'virtualBoard.max' : 'virtualBoard.p_board',\r\n          'virtualBoard.show' : 'virtualBoard.p_board',\r\n          'easy.virtualBoard_10_passive' : 'easy.virtualBoard_10',\r\n          'easy.virtualBoard_10' : function(){pref_func.settings.onchange_funcs['pn13_1_warning_reload'](); pref_func.pref_samples.onclick_event.call(this);},\r\n          'easy.virtualBoard_1' : 'easy.virtualBoard_10',\r\n          'easy.virtualBoard_8_50' : 'easy.virtualBoard_10',\r\n          'easy.virtualBoard_8_100' : 'easy.virtualBoard_10',\r\n          'easy.virtualBoard_8_500' : 'easy.virtualBoard_10',\r\n          'easy.virtualBoard_8_all' : 'easy.virtualBoard_10',\r\n          'easy.virtualBoard_interSite' : 'easy.virtualBoard_10',\r\n          'easy.posts_0h' : 'easy.virtualBoard_10',\r\n          'easy.posts_24h' : 'easy.virtualBoard_10',\r\n          'easy.threads_24h' : 'easy.virtualBoard_10',\r\n          'easy.embed_index' : 'easy.virtualBoard_10',\r\n          'easy.embed_index_lazy' : 'easy.virtualBoard_10',\r\n          'easy.embed_index_infinite' : 'easy.virtualBoard_10',\r\n          'easy.embed_index_backwash' : 'easy.virtualBoard_10',\r\n          'easy.light' : 'easy.virtualBoard_10',\r\n          'easy.stat_activate' : 'easy.virtualBoard_10',\r\n          'easy2.beginner' : function(e){\r\n            pref.easy2.presets = 1;\r\n            pref_func.settings.onchange_funcs['easy2.presets'](e,pref.easy2.presets);\r\n            pref_func.settings.onchange_funcs['easy2.apply'](e, true);\r\n            pref_func.settings.onchange_funcs['reload'](e);\r\n          },\r\n          'easy2.presets' : function(e,idx){\r\n            pref_func.pref_samples['easy2.presets']((idx!==undefined)? idx : pref.easy2.presets);\r\n            pref_func.settings.apply_pn13_1();\r\n          },\r\n          'easy2.limits' : function(e,idx){\r\n            pref_func.pref_samples['easy2.limits']();\r\n            pref_func.settings.apply_pn13_1();\r\n          },\r\n          'easy2.apply' : function(e, force_reset){\r\n            if (pref.easy2.reset || force_reset) pref_func.settings.onchange_funcs['load_default'](e);\r\n            pref_func.pref_samples['easy2.presets']();\r\n            pref_func.settings.onchange_funcs['pn13_1_warning_reload']();\r\n            pref_func.pref_samples.onclick_event(null,pref.easy2);\r\n          },\r\n          'reload' : function(){location.reload();},\r\n          'triage_simple_kill' : 'triage_simple',\r\n          'triage_simple' : function(){pref_func.pref_samples.onclick_event.call(this);},\r\n          'triage_basic' : 'triage_simple',\r\n          'triage_basic_color' : 'triage_simple',\r\n          'triage_colorful' : 'triage_simple',\r\n          'triage_borders' : 'triage_simple',\r\n          'triage_samples' : 'triage_simple',\r\n          'triage_test' : 'triage_simple',\r\n          'virtualBoard.scanStart' : function(){if (catalog_obj && catalog_obj.catalog_func()!==null) catalog_obj.catalog_func().catalog_liveTag_scan_site();},\r\n          'virtualBoard.scanStop' : function(){scan.abort();},\r\n          'virtualBoard.scan_domains.*': function(){\r\n            if (pref.virtualBoard.instant_scan) {\r\n              var domain = this.name.replace('virtualBoard.scan_domains.','');\r\n              scan.keyword_load_1(domain);\r\n            }},\r\n          'virtualBoard.search.show': function(e, init){\r\n            if (!site.components.boardlist) return;\r\n            var tgt_name = 'virtualBoard.search.str';\r\n            var bar = site.components.boardlist.getElementsByTagName('input')[tgt_name];\r\n            if (pref.virtualBoard.search.show) {\r\n              if (!bar) {\r\n                bar = document.createElement('input');\r\n                bar.type = 'text';\r\n                bar.name = tgt_name;\r\n                bar.size = 10;\r\n                bar.style= 'float:right';\r\n                bar.value = pref.virtualBoard.search.str;\r\n                pref_func.add_onchange(bar, pref_func.settings.onchange_funcs_formatted, pref_func.settings.onchange_funcs_formatted);\r\n//                bar.oninput = function(e){pref.virtualBoard.search.str = e.target.value;liveTag.filter_onchange(pref.virtualBoard.search);}; // not storing to sessionStorage\r\n                site.settings.parentNode.insertBefore(bar, site.settings);\r\n                if (!init) liveTag.update_pn(); // activate filter\r\n              }\r\n            } else if (bar) {\r\n              site.settings.parentNode.removeChild(bar); // 'if' for initialj\r\n              liveTag.update_pn(); // disable filter\r\n            }\r\n          },\r\n          'virtualBoard.search.str': function(){liveTag.filter_onchange(pref.virtualBoard.search);},\r\n          'debug_site2': function(){if (pref.debug_mode.site2func) common_func.debug_site2func(pref.debug_mode.site2func);},\r\n          'debug_pfunc': function(){if (pref.debug_mode.pfunc) common_func.debug_parse_funcs_entry(pref.debug_mode.pfunc);},\r\n          'debug_pfunc_comp': function(){if (pref.debug_mode.pfunc_comp) common_func.debug_parse_funcs_entry(pref.debug_mode.pfunc, pref.debug_mode.pfunc_comp);},\r\n          'debug_pfunc_all': function(){if (pref.debug_mode.pfunc_all) common_func.debug_parse_funcs_all(pref.debug_mode.pfunc_all);},\r\n          'liveTag.ex_list_str' : function(){liveTag.ex_list_changed();},\r\n          'liveTag.inherit_board_name' : function(){liveTag.inherit_board_name_changed();},\r\n          'liveTag.inherit_board_tags' : function(){liveTag.inherit_board_tags_changed();},\r\n          'page.mark_new_posts' : function(){if (cataLog.format_html) cataLog.format_html.time_filter_changed();},\r\n          'recovery.comment' : function(){recovery.setup();},\r\n          '*.open_spoiler_text': function(){styleSheet.open_spoiler_text();},\r\n          '*.scroll_lock': function(){cataLog.general_event_handler.setup();},\r\n          'button_test': function(){stats.refresh();},\r\n          '*.posts_search_op': function(e,embed_mode){\r\n            if (!embed_mode) embed_mode = cataLog.embed_mode;\r\n            styleSheet.register('.CatChan_search_miss', (pref[embed_mode].posts_search_op==='opaque')? 'opacity:'+pref[embed_mode].posts_search_op_opacity/100+' !important' :\r\n                                (pref[embed_mode].posts_search_op==='hide')? 'display:none !important' : null);},\r\n          '*.posts_search_op_opacity': '*.posts_search_op',\r\n          'style.post_editing': function(){styleSheet.register('.'+pref.script_prefix+'_post_editing', pref.style.post_editing);},\r\n          'archive.restore': function(e){ // bound this later.\r\n            if (!cataLog.threads) return;\r\n            if (!pref.archive.restore_auto && e.target.name!=='archive.restore') return;\r\n            var files= pref_func.settings.pn13.getElementsByTagName('input')['archive.json'].files;\r\n            var imgs = pref_func.settings.pn13.getElementsByTagName('input')['archive.dir'].files;\r\n//            if (pref.archive.force_json) files = Array.prototype.filter.call(files,function(v){return v.name.substr(-5,5)==='.json';});\r\n            if (files.length===0 || (pref.archive.load_img && imgs.length===0)) return;\r\n            archiver.restore_entry(files,imgs, this['archive.clear_files_button']);\r\n          },\r\n          'archive.dir': 'archive.restore',\r\n          'archive.json': 'archive.restore',\r\n          'archive.clear_files_button': function(){\r\n            var doms = [pref_func.settings.pn13.getElementsByTagName('input')['archive.json'],\r\n                        pref_func.settings.pn13.getElementsByTagName('input')['archive.dir']];\r\n            for (var i=0;i<doms.length;i++) {\r\n              var dom_new = doms[i].parentNode.insertBefore(doms[i].cloneNode(doms[i]),doms[i]);\r\n              dom_new.onchange = doms[i].onchange;\r\n              doms[i].parentNode.removeChild(doms[i]);\r\n              dom_new.onchange();\r\n            }\r\n          },\r\n          'archive.start': function(){archiver.store_entry((this.name==='archive.start')? 'ARC' : 'ARC1');},\r\n          'archive.oneshot': 'archive.start',\r\n          'archive.kwd.*': function(){pref.archive.kwd.kwds = common_func.kwd_prep_regexp(pref.archive.kwd);},\r\n          'test_mode.js_load': function(){\r\n            var file = pref_func.settings.pn13.getElementsByTagName('input')['test_mode.js_file'].files[0];\r\n            var url = window.URL.createObjectURL(file);\r\n            var scr = document.createElement('script');\r\n            scr.src = url;\r\n            site.script_body.appendChild(scr);\r\n          },\r\n        }\r\n      },\r\n      bind_myself: function(obj, args){for (var i of args) obj[i] = obj[i].bind(obj);},\r\n      format_html_str: function(html){\r\n        html = html.replace(/<br>([1-9]),/g,function(match,p1){ // function myself(match,p1){return (!p1)? '<br>' : myself(null,p1-1)+'&emsp;';}\r\n                                              var str = '<br>';\r\n                                              for (var i=0;i<p1;i++) str += '&emsp;';\r\n                                              return str;\r\n                                            });\r\n        html = html.replace(/<ICBX\"/g,'<input type=\"checkbox\" name=\"');\r\n        html = html.replace(/<ITBL(\\d+)\"/g,'<input type=\"text\" size=\"$1\" name=\"');\r\n        html = html.replace(/<ITB(\\d+)\"/g,'<input type=\"text\" style=\"text-align: right;\" size=\"$1\" name=\"');\r\n//        html = html.replace(/<IR(\"[\\w\\.]+):([^:]+):([^\"]+)\">/g,'<input type=\"radio\" name=$1\" value=\"$2\">$3');\r\n        html = html.replace(/<IR\"([\\w\\.]+),([^\"]+)\">/g,'<input type=\"radio\" name=\"$1\" value=\"$2\">');\r\n        html = html.replace(/<SSV(\"[\\w\\.]+\")>/g,'<span data-class=\"show_value\" style=\"font-weight:bold\" name=$1></span>');\r\n        html = html.replace(/<BTN\"([\\w.]+),([^\"]+)\">/g,'<button name=\"$1\">$2</button>');\r\n        html = html.replace(/<IF\"/g,'<input type=\"file\" name=\"');\r\n        return html.replace(/<input type=\"(checkbox|radio)[^>]+>[^<]+/g,'<label>$&</label>');\r\n      },\r\n    };\r\n  })();\r\n///  pref_func.settings.onchange_funcs.entry_func = (function(myself){ // working code.\r\n///    return function(e){\r\n///      pref_func.apply_prep(this,true);\r\n///      var pn_name = this.getAttribute('name'); // for <span>\r\n///      if (myself[pn_name]) myself[pn_name].call(this,e);\r\n///      else if (pn_name.indexOf('.')!=-1) {\r\n///        var name = '*'+pn_name.substr(pn_name.indexOf('.')); // *.XXX\r\n///        if (myself[name]) myself[name].call(this,e);\r\n///        else if (pn_name.lastIndexOf('.')!=-1) {\r\n///          var name = pn_name.substr(0,pn_name.lastIndexOf('.')+1)+'*'; // XXX.YYY.*\r\n///          if (myself[name]) myself[name].call(this,e);\r\n///        }\r\n///      }\r\n///      var pn = e.target.parentNode;\r\n///      while (pn && pn!==site.script_body) {\r\n///        if (pn.getAttribute('name')==='SUB') myself['SUB'].call(pn,{currentTarget:pn});\r\n///        pn = pn.parentNode;\r\n///      }\r\n///    }\r\n///  })(pref_func.settings.onchange_funcs);\r\n\r\n  pref_func.settings.onchange_funcs['catalog.tag.ignore'] = pref_func.settings.onchange_funcs['tag.re_generate'];\r\n  pref_func.settings.onchange_funcs['catalog.tag.max']    = pref_func.settings.onchange_funcs['tag.re_generate'];\r\n  pref_func.settings.onchange_funcs['tag.gen_str']        = pref_func.settings.onchange_funcs['tag.gen'];\r\n  pref_func.bind_myself(pref_func.settings.onchange_funcs.__proto__, ['SHOW','HIDE','SHOW2','HIDE2','SHOW3','HIDE3','TOGGLE2','SHOWALL','HIDEALL']);\r\n  pref_func.bind_myself(pref_func.settings.onchange_funcs, ['archive.restore']);\r\n\r\n  var styleSheet = (function(){\r\n    var ss;\r\n    function replace_rule(rule_str,idx){\r\n      if (ss.cssRules[idx]) ss.deleteRule(idx);\r\n      ss.insertRule(rule_str,idx);\r\n    }\r\n    function make_rule_click_area(){\r\n      replace_rule('.'+pref.script_prefix+((pref.catalog.click_area==='entire')? '_thread' : '_thumbnail')+' {cursor: pointer}',2);\r\n    }\r\n    function make_styles(){\r\n      var rules = [pref.style.fix.titleBar_str, pref.style.fix.window_str, pref.style.fix.popUp_str];\r\n      if (pref.style.sel==='copy') {\r\n        var rules_str = [pref.style.copy.titleBar_str, pref.style.copy.window_str, pref.style.copy.popUp_str];\r\n        for (var i=document.styleSheets.length-1;i>=0;i--) {\r\n          var doc_rules = document.styleSheets[i].cssRules;\r\n          if (!doc_rules) continue;\r\n          for (var j=doc_rules.length-1;j>=0;j--) {\r\n            for (var k=0;k<3;k++) {\r\n              if (rules_str[k] && doc_rules[j].selectorText===rules_str[k]) {\r\n                rules[k] = trim_rules(doc_rules[j].cssText);\r\n                rules_str[k] = null;\r\n              }\r\n            }\r\n            if (!rules[0] && !rules[1] && !rules[2]) break;\r\n          }\r\n          if (!rules[0] && !rules[1] && !rules[2]) break;\r\n        }\r\n      }\r\n      replace_rule('.'+pref.script_prefix+'_titleBar'+' {' + rules[0] + '}',4);\r\n      replace_rule('.'+pref.script_prefix+'_window'  +' {' + rules[1] + '}',5);\r\n      replace_rule('.'+pref.script_prefix+'_popUp'   +' {' + rules[2] + '}',6);\r\n    }\r\n    function trim_rules(str){\r\n      var rules = str.replace(/.*\\{/,'').replace(/\\}.*/,'').split(';');\r\n      for (var i=rules.length-1;i>=0;i--) if (rules[i].split(':')[0].search(/\\s*(background|color)/)==-1) rules.splice(i,1);\r\n      return rules.join(';');\r\n    }\r\n    function add_to_watch(elem){ // http://stackoverflow.com/questions/2635814/javascript-capturing-load-event-on-link\r\n//      elem.addEventListener('change', dummy_add, false); // doesn't work.\r\n      new MutationObserver(dummy_add).observe(elem, {attributes:true});\r\n    }\r\n    function dummy_add(){\r\n      if (!ss) return;\r\n      var dummy = document.createElement('img');\r\n      dummy.src = this.href;\r\n      dummy.onerror = dummy_remove;\r\n      document.getElementsByTagName('body')[0].appendChild(dummy);\r\n    }\r\n    function dummy_remove(){\r\n      this.parentNode.removeChild(this);\r\n      make_styles();\r\n    }\r\n    var spoiler_org = null;\r\n    var spoiler_open = null;\r\n    function open_spoiler_text(){\r\n      if (!cataLog.embed_mode) return;\r\n      var desc = site2[site.nickname].spoiler_text;\r\n      if (desc.spoiler) {\r\n        if (!spoiler_org && !spoiler_open) {\r\n          if (desc && pref[cataLog.embed_mode].open_spoiler_text) {\r\n            for (var j=0;j<document.styleSheets.length;j++)\r\n              if (document.styleSheets[j].cssRules)\r\n                for (var i=0;i<document.styleSheets[j].cssRules.length;i++) {\r\n                  var sText = document.styleSheets[j].cssRules[i].selectorText;\r\n                  if (sText) {\r\n                    if (sText.search(desc.spoiler)!=-1) spoiler_org  = [j,i,document.styleSheets[j].cssRules[i].style.cssText];\r\n                    if (sText.search(desc.open   )!=-1) spoiler_open = [j,i,document.styleSheets[j].cssRules[i].style.cssText];\r\n                  }\r\n                }\r\n          }\r\n        }\r\n        if (spoiler_org && spoiler_open)\r\n          document.styleSheets[spoiler_org[0]].cssRules[spoiler_org[1]].style.cssText = spoiler_org[2] + ((pref[cataLog.embed_mode].open_spoiler_text)? spoiler_open[2] : '');\r\n      } else { // cssRules is null when stylesheet is placed in other domain. http://hakuhin.jp/js/style_sheet.html#STYLE_SHEET_04\r\n        if (pref[cataLog.embed_mode].open_spoiler_text) {\r\n          spoiler_open = [document.styleSheets.length-1, document.styleSheets[document.styleSheets.length-1].cssRules.length, desc.open_rule];\r\n          document.styleSheets[spoiler_open[0]].insertRule(spoiler_open[2],spoiler_open[1]);\r\n        } else if (spoiler_open) document.styleSheets[spoiler_open[0]].deleteRule(spoiler_open[1]);\r\n      }\r\n    }\r\n    var registry = ['dummy','dummy','dummy','dummy','dummy','dummy','dummy'];\r\n    function register(selector, rule){\r\n      var idx = registry.indexOf(selector);\r\n      if (idx!=-1) ss.deleteRule(idx);\r\n      if (rule===null || rule==='') {\r\n        if (idx!=-1) registry.splice(idx,1);\r\n      } else {\r\n        if (idx===-1) {\r\n          idx = registry.length;\r\n          registry[idx] = selector;\r\n        }\r\n        ss.insertRule(selector+' {'+rule+'}', idx);\r\n      }\r\n    }\r\n    return {\r\n      init: function(embed_mode){\r\n        ss = document.head.appendChild(document.createElement('style')).sheet;\r\n        ss.insertRule('.catalog_triage_parent {pointer-events: none;}',0); \r\n        ss.insertRule('.catalog_triage_button {pointer-events: auto;}',1);\r\n        make_rule_click_area(); // rule 2.\r\n        ss.insertRule('.'+pref.script_prefix+'_tag {cursor:pointer;}',3);\r\n        make_styles(); // rule4,5,6\r\n        pref_func.settings.onchange_funcs['*.posts_search_op'](null,embed_mode);\r\n        pref_func.settings.onchange_funcs['style.post_editing']();\r\n      },\r\n      make_rule_click_area: function(){if (ss) make_rule_click_area();},\r\n      styles_changed: function(){if (ss) make_styles();},\r\n      add_to_watch: add_to_watch,\r\n      open_spoiler_text: open_spoiler_text,\r\n      register: register,\r\n    }\r\n  })();\r\n\r\n  var options = {\r\n    func0_prep: function(){},\r\n    func0_exe : function(){}\r\n  };\r\n\r\n  var common_func = {\r\n    overwrite_prop: function(dst,src){\r\n      for (var i in src) {\r\n        if (src[i]===undefined && dst[i]) delete dst[i];\r\n        else if (typeof(dst[i])==='object' && typeof(src[i])==='object') common_func.overwrite_prop(dst[i],src[i]);\r\n        else dst[i] = src[i];\r\n      }\r\n    },\r\n    name2domainboardthread: function(name,fill){\r\n//      var thread = name.replace(/[^\\/]*\\//g,'');\r\n//      var domain = name.replace(/\\/.*/,'');\r\n//      var board  = name.replace(new RegExp('^'+domain),'').replace(new RegExp(thread+'$'),'');\r\n\r\n//      name = new String(name); // not tested.\r\n      var thread = name.substr(name.lastIndexOf('/')+1);\r\n      var domain = name.substr(0,name.indexOf('/'));\r\n      var board  = name.substr(domain.length,name.length-thread.length-domain.length);\r\n      if (name===thread && thread.search(/[^0-9]/)!=-1) {\r\n        domain = thread;\r\n        thread = '';\r\n      }\r\n//      if (thread===domain) // BUG PATCH, SHOULD BE REMOVED.\r\n//        if (thread.search(/[^0-9]/)!=-1) thread ='';\r\n//        else domain = '';\r\n      if (fill) {\r\n        if (domain==='') domain = site.nickname;\r\n        if (board==='') board = site.board;\r\n      }\r\n      return [domain,board,thread];\r\n    },\r\n    name2dbt: (function(){\r\n      var type = { c:'catalog_html',\r\n                   j:'catalog_json',\r\n                   p:'page_html',\r\n                   q:'page_json',\r\n                   t:'thread_json',\r\n//                   0:'thread_html' // default\r\n                 };\r\n      return function(name){\r\n        var dbt = this.name2domainboardthread(name,true);\r\n        if (dbt[2][0].search(/[A-z]/)!=-1) {\r\n          dbt[3] = type[dbt[2][0]];\r\n          dbt[2] = dbt[2].substr(1);\r\n        } else dbt[3] = 'thread_html';\r\n        return dbt;\r\n      }\r\n    })(),\r\n//    fullname2dbt: function(name){ // slow\r\n//      var dbt = name.split('/');\r\n//      dbt[1] = '/'+dbt[1]+'/';\r\n//      return dbt;\r\n//    },\r\n    fullname2dbt: function(name){\r\n      var thread = name.substr(name.lastIndexOf('/')+1);\r\n      var domain = name.substr(0,name.indexOf('/'));\r\n      var board  = name.substr(domain.length,name.length-thread.length-domain.length);\r\n      return [domain,board,thread];\r\n    },\r\n    dom_addEventListener: function(ary, dom, kwd, func){\r\n      dom.addEventListener(kwd, func, false);\r\n      ary[ary.length] = [dom, kwd, func];\r\n    },\r\n    dom_removeEventListener: function(ary, dom, kwd, func){\r\n      for (var i=ary.length-1;i>=0;i--) {\r\n        if ((!dom || dom===ary[i][0]) && (!kwd || kwd===ary[i][1]) && (!func || func===ary[i][2])) {\r\n          ary[i][0].removeEventListener(ary[i][1], ary[i][2], false);\r\n          ary.splice(i,1);\r\n        }\r\n      }\r\n    },\r\n    dom_addAttribute: function(dom,attr,val){\r\n      var val_old = dom.getAttribute(attr);\r\n      if (val_old) val = val_old + ' ' + val;\r\n      dom.setAttribute(attr,val);\r\n    },\r\n    Triage: function(str,args){\r\n      var tooltips = {\r\n        'NONE': ['Don\\'t hide this thread and set its style.',true],\r\n        'ATTR': ['Set style additionally.',true],\r\n        'KILL': ['Hide this thread permanently.',true],\r\n        'TIME': ['Hide this thread until it gets new replies.',true],\r\n        'WATCH': ['Watch this thread and mark as I\\'ve read all posts so far.', false],\r\n        'UNWATCH': ['Unwatch this thread.', false],\r\n        'SHOW': ['Show this thread always without regard to filter setting.', false],\r\n        'UNSHOW': ['Remove \\'show\\' marks.', false],\r\n        'STICKY': ['Sticky this thread.', false],\r\n        'UNSTICKY': ['Unsticky this thread.', false],\r\n        'UNDO': ['Undo last modification.', false],\r\n        'GO': ['Open this thread.', false],\r\n        'ARC': ['Start archiving this thread.', false],\r\n        'ARC1': ['Archive this thread one time.', false],\r\n        'UARC': ['Unarchive this thread.', false],\r\n      };\r\n      tooltips['KILL_N'] = [tooltips['KILL'][0],false];\r\n      tooltips['TIME_N'] = [tooltips['TIME'][0],false];\r\n        var format_tgt = [];\r\n        var toggles = ['WATCH','UNWATCH','SHOW','UNSHOW','STICKY','UNSTICKY','ARC','ARC1','UARC'];\r\n        var pn = document.createElement('div');\r\n        pn.name = (args.name)? args.name : '';\r\n//        pn_triage.style.position = 'absolute';\r\n//        pn_triage.name = 'pn_catalog_triage';\r\n        pn.className = 'catalog_triage_parent';\r\n        var lines = str.replace(/\\/\\/.*/mg,'').split('\\n');\r\n        str = [];\r\n        for (var i=lines.length-1;i>=0;i--) if (lines[i]==='') lines.splice(i,1);\r\n        var triage_style_replace_list = (!brwsr.ff)? ['background','background-color'] : [];\r\n        for (var i=0;i<lines.length;i++) str[i] = lines[i].split(',');\r\n        for (var i=0;i<str.length;i++) {\r\n          for (var j=0;j<str[i].length;j+=3) {\r\n            var triage_button = document.createElement('button');\r\n            triage_button.innerHTML = str[i][j+1];\r\n            triage_button.name = pn.name + '('+i+','+j+')';\r\n            triage_button.className = 'catalog_triage_button';\r\n            triage_button.type = 'button';\r\n            var triage_styles = (str[i][j+2])? str[i][j+2].split(';') : [];\r\n            for (var k=0;k<triage_styles.length;k++) {\r\n              var style_str = triage_styles[k].replace(/:.*/,'');\r\n              for (var m=0;m<triage_style_replace_list.length;m+=2) style_str = style_str.replace(triage_style_replace_list[m],triage_style_replace_list[m+1]);\r\n              triage_button.style[style_str] = triage_styles[k].replace(/[^:]*:/,'');\r\n            }\r\n//            triage_button.onclick = triage_factory(i,j);\r\n            triage_button.onclick = args.onclick;\r\n            pn.appendChild(triage_button);\r\n            if (args.wheelpatch) triage_button.onmousewheel = args.wheelpatch;\r\n            if (pn.name) pref_func.tooltips.str[triage_button.name] = ((tooltips[str[i][j]])? tooltips[str[i][j]][0] +\r\n                                                                       ((tooltips[str[i][j]][1])? '\\nSet style ' + ((str[i][j+2])? str[i][j+2] : 'default') + '.' : '') : '');\r\n            if (toggles.indexOf(str[i][j])!=-1) format_tgt[format_tgt.length] = [triage_button, str[i][j]];\r\n          }\r\n          pn.appendChild(document.createElement('br'));\r\n        }\r\n//        pn.onclick = function(e){  // also works, but CSS is the better.\r\n//          e.preventDefault();\r\n//          var evt = document.createEvent('MouseEvents');\r\n//          evt.initUIEvent('click', false, true, window, 1);\r\n//          threads[pn12_triage_thread][0].dispatchEvent(evt);\r\n//        };\r\n        this.str = str;\r\n        this.pn  = pn;\r\n        this.format_tgt = (format_tgt.length!==0)? format_tgt : null;    \r\n      },\r\n//    make_triage: function(args){\r\n//        var triage_str = [];\r\n//        var pn_triage = document.createElement('div');\r\n////        pn_triage.style.position = 'absolute';\r\n////        pn_triage.name = 'pn_catalog_triage';\r\n//        pn_triage.className = 'catalog_triage_parent';\r\n//        var triage_str_lines = pref.catalog_triage_str.replace(/\\/\\/.*/mg,'').split('\\n');\r\n//        for (var i=triage_str_lines.length-1;i>=0;i--) if (triage_str_lines[i]==='') triage_str_lines.splice(i,1);\r\n//        var triage_style_replace_list = (!brwsr.ff)? ['background','background-color'] : [];\r\n//        for (var i=0;i<triage_str_lines.length;i++)\r\n//          triage_str[i] = triage_str_lines[i].split(',');\r\n//        for (var i=0;i<triage_str.length;i++) {\r\n//          for (var j=0;j<triage_str[i].length;j+=3) {\r\n//            var triage_button = document.createElement('button');\r\n//            triage_button.innerHTML = triage_str[i][j+1];\r\n//            triage_button.name = i+','+j;\r\n//            triage_button.className = 'catalog_triage_button';\r\n//            var triage_styles = (triage_str[i][j+2])? triage_str[i][j+2].split(';') : [];\r\n//            for (var k=0;k<triage_styles.length;k++) {\r\n//              var style_str = triage_styles[k].replace(/:.*/,'');\r\n//              for (var m=0;m<triage_style_replace_list.length;m+=2) style_str = style_str.replace(triage_style_replace_list[m],triage_style_replace_list[m+1]);\r\n//              triage_button.style[style_str] = triage_styles[k].replace(/[^:]*:/,'');\r\n//            }\r\n////            triage_button.onclick = triage_factory(i,j);\r\n//            triage_button.onclick = args.onclick;\r\n//            pn_triage.appendChild(triage_button);\r\n//            if (args.wheelpatch) triage_button.onmousewheel = args.wheelpatch;\r\n//          }\r\n//          pn_triage.appendChild(document.createElement('br'));\r\n//        }\r\n////        pn_triage.onclick = function(e){  // also works, but CSS is the better.\r\n////          e.preventDefault();\r\n////          var evt = document.createEvent('MouseEvents');\r\n////          evt.initUIEvent('click', false, true, window, 1);\r\n////          threads[pn12_triage_thread][0].dispatchEvent(evt);\r\n//////console.log('aaa');\r\n////        };\r\n//        return {pn:pn_triage, str:triage_str};\r\n//    },\r\n    modify_bookmark: function(name,add){\r\n      var key = new RegExp('(^|,)'+name.replace(/\\+/,'\\\\+')+'([\\^@*!][^,\\n]*)*(,|\\n|$)','mg');\r\n      var str = pref.catalog.filter.bookmark_list_str;\r\n      str = str.replace(key,',') + ((add)? ','+name+'\\n' : '');\r\n      pref.catalog.filter.bookmark_list_str = str.replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,'')\r\n      if (catalog_obj.catalog_func()) {\r\n        var tgt = catalog_obj.catalog_func().pn12_0_4.getElementsByTagName('textarea')['catalog.filter.bookmark_list_str'];\r\n        pref_func.apply_prep(tgt,false);\r\n      } else if (pref.catalog.auto_save_filter) { // see 'save' in catalog.\r\n        if (localStorage) {\r\n          key = pref.script_prefix + '.catalog.filter.' + pref.catalog_board_list_obj[pref.catalog_board_list_sel][0].key;\r\n          var obj = JSON.parse(localStorage.getItem(key));\r\n          obj.bookmark_list_str = pref.catalog.filter.bookmark_list_str;\r\n          localStorage.setItem(key,JSON.stringify(obj));\r\n        }\r\n      }\r\n    },\r\n    perf_out: function(obj){\r\n      obj.push(performance.now());\r\n      var str = '';\r\n      var last_ts = null;\r\n      for (var i=0;i<obj.length;i++) {\r\n        if (typeof(obj[i])==='number') {\r\n          if (last_ts) str += (obj[i]-last_ts) + ', ';\r\n          last_ts = obj[i];\r\n        } else str += obj[i] + ', ';\r\n      }\r\n      console.log(str);\r\n    },\r\n    debug_show_proto_func_pool: null,\r\n    debug_show_proto: function(name,obj,ex_keys,search_key) {\r\n      if (!search_key) search_key='proto';\r\n      if (!ex_keys) ex_keys = ['proto'];\r\n      var str = name + ':';\r\n      var keys = Object.keys(obj);\r\n      for (var i=0;i<keys.length;i++) if (ex_keys.indexOf(keys[i])==-1) {\r\n        str += keys[i] + ',';\r\n        ex_keys.push(keys[i]);\r\n        if (this.debug_show_proto_func_pool) this.debug_show_proto_func_pool[keys[i]] = obj[keys[i]];\r\n      }\r\n//      if (obj.hasOwnProperty(search_key)) str += '/' + this.debug_show_proto(obj[search_key], obj.__proto__, ex_keys, search_key); // for 'proto'\r\n      if (obj.hasOwnProperty(search_key)) str += '/' + this.debug_show_proto(obj.__proto__[search_key], obj.__proto__, ex_keys, search_key); // for 'debug____proto'\r\n      return str;\r\n    },\r\n    debug_parse_funcs_entry: function(str, str2) {\r\n      var expand = (!str2)? pref.debug_mode.pfunc_expand : pref.debug_mode.pfunc_comp_expand_same || pref.debug_mode.pfunc_comp_expand_diff;\r\n      if (expand) this.debug_show_proto_func_pool = {};\r\n      console.log(this.debug_parse_funcs(str));\r\n      if (str2) {\r\n        var pool_0 = this.debug_show_proto_func_pool;\r\n        this.debug_show_proto_func_pool = {};\r\n        if (pref.debug_mode.pfunc_comp_proto) {\r\n          var dp = str2.split(':');\r\n          var start_point = site2[dp[0]].parse_funcs[dp[1]];\r\n          var proto_org = start_point.__proto__;\r\n          dp = pref.debug_mode.pfunc_comp_proto.split(':');\r\n          dp = site2[dp[0]].parse_funcs[dp[1]];\r\n          if (dp) start_point.__proto__ = dp;\r\n        }\r\n        console.log(this.debug_parse_funcs(str2));\r\n        var pool_1 = this.debug_show_proto_func_pool;\r\n      }\r\n      if (this.debug_show_proto_func_pool)\r\n        if (!str2) for (var i in this.debug_show_proto_func_pool) console.log(i+': '+this.debug_show_proto_func_pool[i]);\r\n      else {\r\n        for (var i in pool_1) {\r\n          var same = pool_0[i] === pool_1[i];\r\n          if (pref.debug_mode.pfunc_comp_expand_same && same || pref.debug_mode.pfunc_comp_expand_diff && !same) {\r\n            console.log(i+': '+ (same? 'same':'differ') + ': '+ pool_0[i]);\r\n            if (!same) console.log(i+': '+ (same? 'same':'differ') + ': '+ pool_1[i]);\r\n          }\r\n          delete pool_0[i];\r\n        }\r\n        for (var i in pool_0) console.log(i+': only_in_orgnal: '+ pool_0[i]);\r\n      }\r\n      this.debug_show_proto_func_pool = null;\r\n      if (proto_org) start_point.__proto__ = proto_org;\r\n    },\r\n    debug_parse_funcs: function(str) {\r\n      for (var i in site2) for (var j in site2[i].parse_funcs) if (site2[i].hasOwnProperty('parse_funcs') && site2[i].parse_funcs.hasOwnProperty(j)) site2[i].parse_funcs[j]['debug____proto'] = i+'.'+j;\r\n      var str2 = str.split(':');\r\n      var start_point = site2[str2[0]].parse_funcs[str2[1]];\r\n      return str+'::'+ ((start_point)? this.debug_show_proto('/'+start_point['debug____proto'],start_point, ['debug____proto','proto'], 'debug____proto') :\r\n                                      'NONE');\r\n    },\r\n    debug_parse_funcs_all: function(str) {\r\n      var domains = ['DEFAULT','4chan','vichan','lain','8chan','KC','meguca','meguca1'];\r\n      var types = ['','_json','_html'];\r\n      var srcs = ['common','post','thread','page','catalog'];\r\n      var objs = {};\r\n      for (var d=0;d<domains.length;d++)\r\n        for (var t=0;t<types.length;t++) {\r\n          if (domains[d]==='KC' && types[t]==='_json') continue;\r\n          for (var s=0;s<srcs.length;s++) {\r\n            if (domains[d]!=='DEFAULT' && srcs[s]==='common') continue;\r\n            var src_type = srcs[s]+types[t];\r\n            if (site2[domains[d]].parse_funcs[src_type]) {\r\n              var strs = this.debug_parse_funcs(domains[d]+':'+src_type).split(',');\r\n              for (var i=0;i<strs.length;i++) {\r\n                var idx_s = strs[i].lastIndexOf(':');\r\n                if (strs[i].substr(idx_s+1)===str) {\r\n                  strs.splice(i+1,strs.length-i-1);\r\n                  var hier_str = strs[(i>0)?i-1:i].replace(/[^\\/]*\\//g,'').replace(/:[^:]*$/,'').replace(/\\./,':');\r\n                  var root_str = strs[0].replace(/::.*/,'');\r\n                  if (hier_str!==root_str) strs[strs.length] = ' (==='+hier_str+')';\r\n                  break;\r\n                }\r\n                if (idx_s===-1) strs.splice(i--,1);\r\n                else strs[i]=strs[i].substr(0,idx_s+1);\r\n              }\r\n              var obj_root = site2[domains[d]].parse_funcs[src_type];\r\n              if (obj_root) {\r\n                var obj = obj_root[str];\r\n                var flag = true;\r\n                for (var i in objs) if (objs[i][0]===obj) {strs[strs.length] = ' (==='+i+')'; flag=false; objs[i][1]++; break;}\r\n//                if (flag) objs[domains[d]+':'+src_type] = obj;\r\n                if (flag) objs[hier_str] = [obj,1];\r\n              }\r\n              if ((typeof(obj_root[str])==='string' || typeof(obj_root[str])==='number')) strs[str.length] = ', '+obj_root[str];\r\n              console.log(strs.join(''));\r\n            }\r\n          }\r\n        }\r\n      var num = 0;\r\n      if (pref.debug_mode.pfunc_all_expand) for (var i in objs) console.log((num++)+'('+objs[i][1]+'): '+ i +': '+objs[i][0]);\r\n    },\r\n    debug_site2func: function(name) {\r\n      for (var i in site2) if(site2[i].hasOwnProperty(name)) site2[i]['debug____'+name] = i;\r\n      var str = '';\r\n      var funcs = {};\r\n      for (var i in site2) {\r\n        str += i+': '+site2[i]['debug____'+name]+', ';\r\n        funcs[site2[i]['debug____'+name]] = site2[i][name];\r\n      }\r\n      console.log(str);\r\n      if (pref.debug_mode.site2func_expand) for (var i in funcs) console.log(i+': '+funcs[i]);\r\n    },\r\n//    obj_scopy_from_key: function(obj){\r\n//      for (var i in obj)\r\n//        if (typeof(i)==='string' && Object.prototype.hasOwnProperty.call(obj,obj[i])) obj[i] = obj[obj[i]];\r\n//      return obj;\r\n//    },\r\n//    set_value_to_root: function(leaf,key,val){ // working code.\r\n//      if (Object.prototype.hasOwnProperty.call(leaf,key)) leaf[key] = val;\r\n//      else this.set_value_to_root(Object.getPrototypeOf(leaf),key,val);\r\n//    },\r\n    init_set_style: function(dom,src){\r\n      dom.style = {};\r\n      if (src) for (var i in src) dom.style[i] = src[i];\r\n      if (src===null) {\r\n        src = dom.getAttribute('style');\r\n        if (src) {\r\n          src = pref_func.style2obj(src);\r\n          for (var i in src) dom.style[i] = null;\r\n        }\r\n      }\r\n    },\r\n    shallow_copy_1: function(src){\r\n      var dst = Object.create(null);  \r\n      for (var i in src) if (src.hasOwnProperty(i)) dst[i] = src[i];\r\n      return dst;\r\n    },\r\n    deep_copy: function(dst,src){\r\n      for (var i in src)\r\n        if (src.hasOwnProperty(i))\r\n          if (Array.isArray(src[i])) dst[i] = src[i].slice();\r\n          else if (typeof(src[i])==='object') dst[i] = this.deep_copy({},src[i]);\r\n          else dst[i] = src[i];\r\n      return dst\r\n    },\r\n    image_resize : function(pn,w,h) {\r\n      var nw = pn.naturalWidth;\r\n      var nh = pn.naturalHeight;\r\n      var fw = (nw>w)? nw/w : 1;\r\n      var fh = (nh>h)? nh/h : 1;\r\n      if (fh>1) pn.setAttribute('width', (fw>=fh)? w : nw/fh);\r\n      if (fw>1) pn.setAttribute('height',(fh>=fw)? h : nh/fw);\r\n//      var f  = (fw>fh)? fw : fh;\r\n//      pn.setAttribute('width',  nw/f);\r\n//      pn.setAttribute('height', nh/f);\r\n    },\r\n    kwd_prep_regexp: function(kwd) {\r\n      if (!kwd.str) return [];\r\n      var kwds = (kwd.sentence)? [kwd.str] : kwd.str.split(' ');\r\n      for (var i=kwds.length-1;i>=0;i--) {\r\n        if (kwds[i]==='') kwds.splice(i,1);\r\n        else {\r\n          if (!kwd.re) kwds[i] = kwds[i].replace(/[\\.\\(\\)\\[\\]\\+\\?\\^\\$\\{\\}]/g,'\\\\$&').replace(/\\*/g,'.+');\r\n          try {\r\n            kwds[i] = new RegExp(kwds[i],(kwd.ci)? 'i' : '');\r\n          } catch(e) {\r\n            kwds.splice(i,1);\r\n          }\r\n//          kwds[i] = new RegExp(kwds[i].replace(/[^\\\\]\\\\$/,''),(kwd.ci)? 'i' : ''); // trailing '\\' cause error\r\n        }\r\n      }\r\n      return kwds;\r\n    },\r\n    escape:(function(){\r\n      var entities = {\r\n        '<': '&lt;',\r\n        '>': '&gt;',\r\n        '&': '&amp;',\r\n        '\"': '&quot;',\r\n        '\\'':'&#039;', // '&apos;'\r\n      };\r\n      function escape(str){\r\n        return entities[str];\r\n      }\r\n      return function(txt){\r\n        return txt.replace(/[<>\"'&]/g,escape);\r\n      }\r\n    })(),\r\n    escape_text: function(txt){ // http://d.hatena.ne.jp/ockeghem/20070510/1178813849\r\n      return txt.replace(/&/g,'&amp;').replace(/</g,'&lt;');\r\n    },\r\n  }\r\n\r\n  var common_obj = {\r\n    thread_reader: null,\r\n    events_beforeunload: [],\r\n  };\r\n  common_func.dom_addEventListener(common_obj.events_beforeunload, window, 'beforeunload', function(){common_func.dom_removeEventListener(common_obj.events_beforeunload)});\r\n  common_func.dom_addEventListener(common_obj.events_beforeunload, window, 'focus', function(){DelayBuffer.prototype.hasFocus = true;});\r\n  common_func.dom_addEventListener(common_obj.events_beforeunload, window, 'blur', function(){DelayBuffer.prototype.hasFocus = false;});\r\n\r\n  var site = { // krautchan/int/\r\n    max_page   : 20,\r\n    autosage   : 300,\r\n    board_name : '/int/',\r\n    url_prefix : 'https://krautchan.net/int/',\r\n    url_prefix2 : {},\r\n    nickname   : 'KC',\r\n    nicknames  : ['CatChan_tgt'],\r\n    thread_keyword: 'thread',\r\n    postform: null,\r\n    postform_rules: null,\r\n    get_ops    : null,\r\n    get_posts  : null,\r\n////////    make_url   : null,\r\n////////    make_url2  : function(bn,idx){\r\n////////      var nickname  = (bn.indexOf('/')==0)? site.nickname : bn.substr(0,bn.indexOf('/'));\r\n////////      var boardname = '/' + bn.replace(/[^\\/]*\\//,'').replace(/\\/.*/,'/');\r\n////////      return [nickname, boardname, idx, site2[nickname].make_url(boardname,idx)];\r\n////////    },\r\n    server_name : null, // optional for 2chan.\r\n    protocol : (document.location.href.search(/https/)!=-1)? 'https:' : 'http:',\r\n    catalog_threads_in_page : null,\r\n//    catalog_posts_in_thread : null,\r\n    remove_posts : function(src){return src;},\r\n    remove_files_info : function(src){return src;},\r\n    remove_checkboxes : function(src){return src;},\r\n////////    get_thread_link : function(src){return '_blank';},\r\n    get_time_of_last_post : function(doc){return null;},\r\n    header_height : function(){return 0;},\r\n    patch: null,\r\n    components: {},\r\n    query_set_component: function(name){\r\n      var query_word = site2[site.nickname].components[name];\r\n      var comp = (typeof(query_word)==='string')? document.querySelector(query_word) :\r\n                                                  document.querySelectorAll(query_word[0])[query_word[1]];\r\n      if (comp) site.components[name] = comp;\r\n      else delete site.components[name];\r\n    },\r\n    config     : function(keyword,nickname){ // url='*site/board/etc', keyword='site'\r\n      var href = window.location.href;\r\n      var url_site = href.substr(0,href.indexOf(keyword)+keyword.length);\r\n      var url_board = decodeURI(href.substr(url_site.length+1)) + '/'; // add '/' to the last for case of ending without slash.\r\n      site.board = '/' + url_board.substr(0,url_board.indexOf('/')+1);\r\n      site.url_prefix = url_site + site.board;\r\n      site.server_name  = href.substr(0,href.indexOf(keyword)-1).replace(/https*:\\/\\/*/,'');\r\n      site.nickname = nickname;\r\n      site.isthread = window.location.href.search(site2[nickname].thread_keyword)!=-1;\r\n//      for (var i in site2[nickname]) site[i] = site2[nickname][i];\r\n//      site.features = site2[site.nickname].features;\r\n      if (site2[nickname].features) pref_func.pref_overwrite(site.features,site2[nickname].features);\r\n      site.myself = site2[site.nickname].get_ops(document)[0];\r\n      site.no = (site.whereami==='thread')? site.myself : '';\r\n//      site.key = site.nickname + site.board + ((site.whereami==='thread')? site.no : '');\r\n      for (var i in site2[site.nickname].components) site.query_set_component(i);\r\n      if (!site.settings && site.components.boardlist) site.settings = site.components.boardlist.appendChild(document.createElement('span'));\r\n//      if (site2[site.nickname].pref_default) pref_func.pref_overwrite(pref,site2[site.nickname].pref_default);\r\n      site.patch = site2[site.nickname].patch;\r\n    },\r\n    features : {page: false, graph: true, setting: true, setting2: true, postform: true, catalog: true, listener : false, uip_tracker: false, thread_reader: true, debug: false},\r\n    owners_recommendation: '',\r\n    catalog : false,\r\n    whereami: null,\r\n    embed_to: {},\r\n    root_body : document.getElementsByTagName('body')[0],\r\n//    root_body : (document.getElementsByTagName('body')[0])? document.getElementsByTagName('body')[0] :\r\n//                                                            document.getElementsByTagName('frame')[0].contentDocument.getElementsByTagName('body')[0] // KC root\r\n    embed_frame:'CatChan_embed_frame',\r\n    embed_frame_win: null,\r\n    boardlist: null,\r\n    settings: null\r\n  };\r\n  site.protocol = (document.location.href.search(/https/)!=-1)? 'https:' : 'http:'; // patch for Tampermonkey.\r\n  site.root_body2 = site.root_body;\r\n\r\n  var site2 = {};\r\n  site2['DEFAULT'] = { // skeleton for default\r\n    nickname : 'DEFAULT',\r\n    home : '', // home is used url for iframe, so it MUST BE THE SAME ORIGIN, OR LEAVE IT BLANK.\r\n    check_func : function(){return false;}, // return true if the script is running in this site.\r\n    boards_sel_from_tags : function(){return '';}, // return boards selection strings.\r\n    protocol: site.protocol,\r\n    components: {},\r\n    spoiler_text: {\r\n      spoiler: /span.spoiler$/,\r\n      open: /span.spoiler:hover/,\r\n    },\r\n    postform_prep: function(){ // the same as vichan.\r\n      site.components.postform_submit2 = null;\r\n      site.components.postform_submit2_observer = new MutationObserver(this.postform_submit2_find);\r\n      site.components.postform_submit2_observer.observe(document.getElementsByTagName('body')[0], {childList: true});\r\n    },\r\n    postform_submit2_find: function(){\r\n      var state_old = site.components.postform_submit2;\r\n      site.query_set_component('postform_submit2');\r\n      site.query_set_component('postform_comment2');\r\n      if (common_obj.thread_reader) common_obj.thread_reader.setup_submit2();\r\n      if (pref.features.recovery) recovery.setup2();\r\n    },\r\n    general_event_handler:(function(){\r\n//      function func_false(){return false;}\r\n      var obj = {\r\n        common: {\r\n          subscribe: function(catalog_root){\r\n            if (this.mouseover) catalog_root.addEventListener('mouseover',this.mouseover,false);\r\n          },\r\n          unsubscribe: function(catalog_root){\r\n            if (this.mouseover) catalog_root.removeEventListener('mouseover',this.mouseover,false);\r\n          },\r\n          get_mark: function(pn, clientY){\r\n            return this.get_mark_from_height(clientY, document.getElementByTagName('div'));\r\n          },\r\n          get_mark_from_height: function(now_height, pns){\r\n            var len = pns.length;\r\n            var step = len >> 1;\r\n            var i = 0;\r\n            while (step>0) {\r\n              if (pns[i+step].offsetTop<now_height) i += step;\r\n              step >>= 1;\r\n            }\r\n            while (i+1<len && pns[i+1].offsetTop<now_height) i++;\r\n            return pns[i];\r\n          },\r\n        },\r\n      };\r\n      obj.thread = Object.create(obj.common);\r\n      obj.page = Object.create(obj.common);\r\n      obj.catalog = Object.create(obj.common);\r\n      return obj;\r\n    })(),\r\n//    catalog_background : '#b5ccf9',\r\n//    catalog_bordercolor : '#000000',\r\n    horizontal_separator_in_index: function(){\r\n//      var pn = document.createElement('div');\r\n//      pn.innerHTML = '<br><br class=\"clear\"><hr>';\r\n      var pn = document.createElement('hr');\r\n      pn.setAttribute('class', pref.script_prefix+'_hs');\r\n      return pn;\r\n    },\r\n//    get_next_image: function(img,name){return null;}, // return next image for prefetch3\r\n    get_next_image: function(img,top, imgs){\r\n      if (!imgs) imgs = cataLog.parent.getElementsByTagName('img');\r\n      var idx = Array.prototype.indexOf.call(imgs,img);\r\n      if (top) while (imgs[idx+1] && imgs[idx+1].offsetTop<top) idx++;\r\n      return (idx>=0)? imgs[idx+1] : null;\r\n    },\r\n    get_time_of_posts : function(thread){return [0,0];}, // returns parsed UTC time of last and op posts from element of the thread.\r\n    get_time_of_post_in_utc : function(post){return 0;}, // returns parsed UTC time of posts.\r\n////////    get_thread_link : function(thread){return null;}, // returns href from element of the thread. THIS SHOULD BE MERGED WITH modify_thread_link.\r\n    catalog_threads_in_page : function(doc){return [];}, // returns array of thread elements in the page from the document.\r\n    remove_posts : function(thread,end){}, // removes posts from the thread with a certain remains.\r\n    remove_files_info : function(thread){return thread;}, // removes file information from the thread, and returns itself.\r\n//    remove_checkboxes : function(thread){return thread;}, // removes checkboxes from the thread, and returns itself.\r\n    postform_rules : null,\r\n    thread_keyword : 'thread', // thread keyword in URL.\r\n    max_page : function(board){return 10;}, // returns max_page\r\n//    max_page : 10, // maximum page number.\r\n//    make_url : function(board,no,key){return ['_blank','raw'];}, // returns URL and type from board name and page number.\r\n//    make_url3: function(board,th){return '_blank';}, // returns URL from board name and thread number.\r\n//    make_url4: function(dbt){return '_blank';}, // returns URL from dbt.\r\n////////////    enumerate_boards_to_scan:function(){ // 4chan // working code.\r\n////////////      var obj = [];\r\n////////////      var end = (site3[site.nickname].boards.length > pref.scan.max)? pref.scan.max : site3[site.nickname].boards.length;\r\n////////////      for (var i=0;i<end;i++) obj[obj.length] = '/'+site3[site.nickname].boards[i].board+'/';\r\n////////////      return obj;\r\n////////////    },\r\n////////    enumerate_boards_to_scan:function(){ // working code.(2016.01.09)\r\n////////      var obj = [];\r\n////////      var end = (site3[site.nickname].boards.length > pref.scan.max)? pref.scan.max : site3[site.nickname].boards.length;\r\n////////      for (var i=0;i<end;i++) obj[obj.length] = site3[site.nickname].boards[i];\r\n////////      return obj;\r\n////////    },\r\n    url_boards_json: function(){return '';}, // returns url of boards.json.\r\n    get_boards_json_indicator: null,\r\n    get_boards_json: function(key,callback,callback_always,health_indicator){\r\n      var key = 'boards_json_'+this.nickname;\r\n      if (this.get_boards_json_indicator) {\r\n        this.get_boards_json_indicator.report({end:Date.now(), prog_str:'Aborted.', err_str:'Aborted by next request.'});\r\n        this.get_boards_json_indicator = null;\r\n      }\r\n      if (this.boards_json) this.get_boards_json_callback(this.nickname,{status:200, response:this.boards_json},[callback,callback_always]);\r\n      else {\r\n        var indicator;\r\n        if (health_indicator) { // patch\r\n          indicator = health_indicator.shift('limegreen','b',key);\r\n          indicator.report({start:Date.now(), prog_str:'Loading boards\\' information'});\r\n          this.get_boards_json_indicator = indicator;\r\n        }\r\n        http_req.get(key,this.nickname+',dummy,dummy',this.url_boards_json(),this.get_boards_json_callback.bind(this),0,true,[callback,callback_always,indicator,key]);\r\n      }\r\n    },\r\n    get_boards_json_callback: function(key,value,args){\r\n      if (value.status==200) {\r\n        this.postprocess_board(value.response);\r\n        if (!site3[this.nickname].boards) liveTag.update_pn_buf.do_tgt();\r\n        site3[this.nickname].boards = true;\r\n      }\r\n      if (args[2]) {\r\n        args[2].report({end:Date.now(), prog_str: (value.status==200)? 'boards.json is loaded.' : '',\r\n                        err_str:  (value.status==200)? '' : 'Error at loading board\\'s infomation.'});\r\n        this.get_boards_json_indicator = null;\r\n      }\r\n      if (args[3]) http_req.close(args[3]);\r\n      if (args[0] && (args[1] || value.status===200))\r\n        if (args[2]) args[0]();\r\n        else setTimeout(args[0],0);\r\n    },\r\n    postprocess_board: function(val){ // for 4chan and all \r\n      for (var i=0;i<val.boards.length;i++) {\r\n        var bd = liveTag.mems.init({domain:this.nickname, board:'/'+val.boards[i].board+'/'});\r\n        bd.o = i;\r\n        if (val.boards[i].pages && !bd.pgs) bd.pgs = val.boards[i].pages;\r\n        if (val.boards[i].tags && val.boards[i].tags.length!=0) liveTag.postprocess_board_add_btag(val.boards[i].tags,bd);\r\n      }\r\n    },\r\n////////    postprocess_board: function(val){ // 4chan // working code.\r\n////////      site3[this.nickname].boards = [];\r\n////////      for (var i=0;i<val.boards.length;i++) {\r\n////////        var bd = liveTag.mems.init({domain:this.nickname, board:'/'+val.boards[i].board+'/'});\r\n////////        site3[this.nickname].boards.push(bd); // BUG. increase length forever.\r\n//////////        Object.defineProperty(bd,'bump_limit',{value:val.boards.bump_limit});\r\n////////      }\r\n////////    },\r\n\r\n////    show_boardlist_replaced: false, // working code.\r\n////    show_boardlist_physical_board: function(tags,func_onclick){\r\n////      var as = site.components.boardlist.getElementsByTagName('a');\r\n////      if (pref.virtualBoard.p_board==='replace') {\r\n////        for (var i=pn.childNodes.length-2;i>=0;i-=2) { // skip every delimiter // working code.\r\n//////          var key = pn.childNodes[i].textContent.substr(1); // working code.\r\n//////          for (var j=0;j<as.length;j++) {\r\n//////            if (as[j].textContent===key) {\r\n//////              if (!as[j].style) as[j].style = {};\r\n//////              if (as[j].style.display!=='none') {\r\n//////                as[j].style.display='none';\r\n//////                pn.childNodes[i].tagName = 'a'; // can't change by specification.\r\n//////                pn.childNodes[i].setAttribute('href',as[j].getAttribute('href'));\r\n//////                as[j].parentNode.insertBefore(pn.childNodes[i],as[j]);\r\n//////              } else pn.removeChild(pn.childNodes[i]); // remove '#XXX'(tag)\r\n//////              pn.removeChild(pn.childNodes[i]); // remove '/'(delimiter)\r\n//////            }\r\n//////          }\r\n////          var key = pn.childNodes[i].textContent;\r\n////          for (var j=0;j<as.length;j++) {\r\n////            if (as[j].textContent===key || as[j].textContent===key.substr(1)) {\r\n////              if (!as[j].classList.contains(pref.script_prefix+'_tag')) {\r\n////                var tmp_node = liveTag.update_tag_string([pn.childNodes[i].textContent], '', pn.childNodes[i].onclick, 'a').childNodes[0];\r\n////                tmp_node.setAttribute('href',as[j].getAttribute('href'));\r\n////                as[j].parentNode.insertBefore(tmp_node,as[j]);\r\n////                as[j].parentNode.removeChild(tmp_node.nextSibling);\r\n////              } else pn.removeChild(pn.childNodes[i]); // remove '#XXX'(tag)\r\n////              pn.removeChild(pn.childNodes[i]); // remove '/'(delimiter)\r\n////            }\r\n////          }\r\n////        }\r\n////        this.boardlist_replaced = true;\r\n////      } else if (this.boardlist_replaced) {\r\n////        for (var i=0;i<as.length;i++) {\r\n////          if (as[i].style && as[i].style.display==='none') {\r\n////            as[i].style.display='';\r\n////            as[i].parentNode.removeChild(as[i].previousSibling);\r\n////          }\r\n////        }\r\n////        this.boardlist_replaced = false;\r\n////      }\r\n////    },\r\n    show_boardlist_boards: Object.create(null,{sel:{value:null, writable:true}}),\r\n    show_boardlist_physical_board: function(tags,func_onclick){ // tuned for 8chan\r\n      var tgts = this.show_boardlist_boards;\r\n      if ((tgts.sel===true  && pref.virtualBoard.p_board==='replace') ||\r\n          (tgts.sel===false && pref.virtualBoard.p_board==='both')) {\r\n        var src = (tgts.sel)? 'v' : 'p';\r\n        var dst = (tgts.sel)? 'p' : 'v';\r\n        for (var i in tgts) {\r\n          var tgt = tgts[i];\r\n          if (tgt[src] && tgt[dst]) {\r\n            tgt[dst].parentNode.insertBefore(tgt[src],tgt[dst]);\r\n            tgt[dst].parentNode.removeChild(tgt[dst]);\r\n          }\r\n        }\r\n        tgts.sel = !tgts.sel;\r\n      }\r\n      if (this.show_boardlist_boards.sel===null && pref.virtualBoard.p_board==='replace') {\r\n        var as = site.components.boardlist.getElementsByTagName('a');\r\n        for (var i=0;i<as.length;i++) {\r\n          var key = as[i].textContent;\r\n          if (this.show_boardlist_physical_extract_func) key = this.show_boardlist_physical_extract_func(key);\r\n          if (key[0]!=='#') this.show_boardlist_boards['#'+ ((pref.liveTag.ci)? key.toLowerCase() : key)] = {p:as[i]};\r\n        }\r\n        this.show_boardlist_boards.sel = false;\r\n      }\r\n      if (pref.virtualBoard.p_board==='replace') {\r\n        var boardlist_hit = {};\r\n        for (var i=tags.length-1;i>=0;i--) {\r\n          var key = (pref.liveTag.ci)? tags[i].toLowerCase() : tags[i];\r\n          var tgt = this.show_boardlist_boards[key];\r\n          if (tgt) {\r\n            if (!tgt.v) {\r\n              var p = tgt.p;\r\n              var v = liveTag.update_tag_string([key], '', func_onclick, 'a').childNodes[0];\r\n              v.setAttribute('href',p.getAttribute('href'));\r\n              p.parentNode.insertBefore(v,p);\r\n              p.parentNode.removeChild(p);\r\n              tgt.v = v;\r\n            }\r\n            tags.splice(i,1);\r\n            boardlist_hit[key] = null;\r\n          }\r\n        }\r\n        if (pref.virtualBoard.v_remove) {\r\n          for (var i in this.show_boardlist_boards)\r\n            if (this.show_boardlist_boards[i].v && boardlist_hit[i]===undefined) {\r\n              var p = this.show_boardlist_boards[i].p;\r\n              var v = this.show_boardlist_boards[i].v;\r\n              v.parentNode.insertBefore(p,v);\r\n              v.parentNode.removeChild(v);\r\n              delete this.show_boardlist_boards[i].v;\r\n            }\r\n        }\r\n      }\r\n    },\r\n    show_boardlist: function(tags,func_onclick){\r\n//      for (var i=0;i<site.boardlist.length;i++) {\r\n//        if (site.boardlist[i].lastChild.className===pref.script_prefix+'_tag') site.boardlist[i].removeChild(site.boardlist[i].lastChild);\r\n//        site.boardlist[i].appendChild(pn); // can't clone events.\r\n//      }\r\n      var sbl = site.components.boardlist;\r\n      this.show_boardlist_physical_board(tags,func_onclick);\r\n\r\n//      if (sbl.lastChild.className===pref.script_prefix+'_tag') sbl.removeChild(sbl.lastChild);\r\n//      if (sbl.lastChild.name===pref.script_prefix+'_tag_parent') sbl.removeChild(sbl.lastChild); // ERROR. <span> can't get name attribute.\r\n      if (sbl.lastChild.getAttribute && sbl.lastChild.getAttribute('name')===pref.script_prefix+'_tag_parent') sbl.removeChild(sbl.lastChild);\r\n      if (pref.virtualBoard.show && tags.length!==0) {\r\n        var pn = liveTag.update_tag_string(tags, ' / ', func_onclick);\r\n        pn.insertBefore(document.createTextNode('[ '),pn.firstChild);\r\n        pn.lastChild.textContent = ' ]';\r\n        sbl.appendChild(pn); // can't clone events.\r\n      }\r\n    },\r\n    get_ops : function(doc){return [];}, // returns array of op numbers from the document.\r\n    get_posts : function(doc) {return [];}, // returns array of posts numbers from the document.\r\n//    absolute_link : function(doc){}, // change link from relative to absolute which includes site URL.\r\n    absolute_link : function(doc){\r\n      var tgts = ['src','href'];\r\n      var all = doc.pn.getElementsByTagName('*'); //'*[src],*[href]'\r\n      for (var i=0;i<all.length;i++) {\r\n        for (var j=0;j<tgts.length;j++) {\r\n          var tgt = all[i].getAttribute(tgts[j]);\r\n          if (tgt && tgt.indexOf('http')!=0 && tgt.indexOf('mailto:')!=0 && tgt.indexOf('blob')!=0 && tgt.substr(0,2)!='//')\r\n            all[i].setAttribute(tgts[j],this.protocol + '//' + this.domain_url + tgt); // working code.\r\n//            all[i].setAttribute(tgts[j],site2[doc.domain].protocol + '//' + site2[doc.domain].domain_url + tgt); // working code.\r\n        }\r\n      }\r\n    },\r\n    absolute_link_1: function(href){return site2[this.nickname].protocol + '//' + site2[this.nickname].domain_url + href;},\r\n////////    insert_footer : function(thread,page_no,boardname,insert,date,nof_posts,nof_files){return [nof_posts,nof_files];}, // insert information footer, and returns count of posts and images.\r\n\r\n////////    insert_footer2: function(thread,type,nums,nums2){}, // insert num of new replies to me, num of new replies.\r\n//    prep_footer3 : function(){return null;}, // prepare footer\r\n//    insert_footer3: function(thread,nums,nums2){}, // insert footer.\r\n\r\n//    prep_own_posts: function(){}, // prepare own_post object.\r\n//    prep_own_posts_event: function(e){}, // event entry for preparing own_post object.\r\n    ls_key_own_posts: pref.script_prefix + '.own_posts.',\r\n    prep_own_posts_event : function(e){\r\n      if (e) site2[site.nickname].prep_own_posts_1(e.key); // gives 'this' value to 'prep_own_posts_1'. MUST BE site2[site.nickname].\r\n      if (window.name===site.nickname) send_message('parent',[['OWN_POSTS', window.name, site3[window.name].own_posts]]);\r\n    },\r\n    prep_own_posts : function(bt){\r\n      site3[this.nickname].own_posts = {};\r\n      if (localStorage) {\r\n        var keys = (bt)? [this.ls_key_own_posts + bt] : Object.keys(localStorage);\r\n        for (var i=0;i<keys.length;i++) this.prep_own_posts_1(keys[i]);\r\n      }\r\n//console.log(site3[this.nickname].own_posts);\r\n    },\r\n    prep_own_posts_1 : function(key){\r\n      if (key.indexOf(this.ls_key_own_posts)==0) {\r\n        var bt = key.substr(this.ls_key_own_posts.length);\r\n        var board = bt.substr(0,bt.lastIndexOf('/')+1);\r\n        if (!site3[this.nickname].own_posts[board]) site3[this.nickname].own_posts[board] = {};\r\n        var nos = JSON.parse(localStorage[key] || '[]');\r\n        for (var j=0;j<nos.length;j++) site3[this.nickname].own_posts[board][nos[j]] = null;\r\n      }\r\n    },\r\n//    clean_up_own_posts : function(ths,board){ // working code.\r\n////console.log('clean up');\r\n//      if (localStorage) {\r\n//        var nos = {};\r\n//        for (var i=0;i<ths.length;i++) nos[ths[i].key.substr(ths[i].key.lastIndexOf('/')+1)] = null;\r\n//        var own_key_bd = this.ls_key_own_posts + board;\r\n//        var keys = Object.keys(localStorage);\r\n//        for (var i=0;i<keys.length;i++)\r\n//          if (keys[i].indexOf(own_key_bd)==0 && nos[keys[i].substr(own_key_bd.length)]!==null) delete localStorage[keys[i]]\r\n//      }\r\n////console.log(site3[this.nickname].own_posts);\r\n//    },\r\n    clean_up_LS: function(domain, board, nos){\r\n      if (domain!==site.nickname) return; // PATCH.\r\n      if (localStorage) {\r\n        if (pref.thread_reader.own_posts_tracker && pref.thread_reader.clean_up_own_posts) this.clean_up_LS_th(this.ls_key_own_posts, board, nos);\r\n        if (pref[cataLog.embed_mode].deleted_posts.auto_clean) this.clean_up_LS_th(this.ls_key_deletedPosts, board, nos);\r\n        if (pref.recovery.auto_clean) {\r\n          this.clean_up_LS_th(this.ls_key_comment, board, nos);\r\n          this.clean_up_LS_th(pref.script_prefix+'.comment.'+site.nickname, board, nos); // patch for half year, from 2016.09\r\n        }\r\n        if (pref.test_mode['67']) archiver.clean_list_all(nos, domain, board);\r\n      }\r\n      if (pref.test_mode['65'] && pref.archive.IDB.auto_clean) IDB.clean_up(site.nickname, site.board, nos);\r\n      liveTag.mems[domain][board].LS_synced = true;\r\n    },\r\n    ls_key_deletedPosts: pref.script_prefix + '.deletedPosts.',\r\n    clean_up_deleted_posts_1: function(bt){if (localStorage) delete localStorage[this.ls_key_deletedPosts + bt];},\r\n//    ls_key_comment: pref.script_prefix + '.draft.',\r\n    ls_key_comment: pref.script_prefix + '.draft.',\r\n    clean_up_LS_th: function(ls_key, board, nos){\r\n      var ls_key_bd = ls_key + board;\r\n      var keys = Object.keys(localStorage);\r\n      for (var i=0;i<keys.length;i++)\r\n        if (keys[i].indexOf(ls_key_bd)==0 && nos[keys[i].substr(ls_key_bd.length)]!==null) delete localStorage[keys[i]];\r\n    },\r\n\r\n    check_reply: (function(){\r\n      var com_or_txt = false;\r\n      var pn_tags = document.createElement('div');\r\n      var regexp_anchor      = '';\r\n      var regexp_anchor_len  = 0;\r\n      var regexp_anchor_cb   = '';\r\n      var regexp_anchor_txt_1  = /^>>[0-9]+/; // RegExp.test executes RegExp.exec once.\r\n      var regexp_anchor_txt    = />>[0-9]+/g;\r\n      var regexp_anchor_cb_txt_1 = /^>>>\\/[0-9A-z_\\+]+\\/[0-9]+/;\r\n      var regexp_anchor_cb_txt = />>>\\/[0-9A-z_\\+]+\\/[0-9]+/g;\r\n      var regexp_anchor_com    = /&gt;&gt;[0-9]+/g;\r\n      var regexp_anchor_cb_com = /&gt;&gt;&gt;\\/[0-9A-z_\\+]+\\/[0-9]+/g;\r\n      var remake_own_posts = true;\r\n      var own_posts;\r\n      var own_posts_cb;\r\n      var tag_ex_list;\r\n      var str_rm_list;\r\n//      var time_offset = Math.floor(Date.now()/1000)*1000; // BUG.\r\n////////      var count_replies = 0; // for direct call to check_t1 from native catalog.\r\n      function add_you(post, add_name){\r\n        var as = post.pn.getElementsByTagName('a');\r\n        for (var i=0;i<as.length;i++) {\r\n          var to_me = false;\r\n          var txt = as[i].textContent;\r\n          if (own_posts && own_posts[txt.substr(2)]===null && regexp_anchor_txt_1.test(txt)) to_me = true; // SHOULD USE SEARCH INSTEAD OF TEST TO KEEP CONSISTENCY.\r\n          if (!to_me && own_posts_cb && regexp_anchor_cb_txt_1.test(txt)) {\r\n            var tgt = txt.split('/');\r\n            var bd = '/'+tgt[1]+'/';\r\n            if (own_posts_cb[bd] && own_posts_cb[bd][tgt[2]]===null) to_me = true;\r\n          }\r\n          if (to_me) {\r\n            if (pref.thread_reader.show_reply_to_me_by==='plain') as[i].parentNode.insertBefore(document.createTextNode(' (You)'), as[i].nextSibling);\r\n            else as[i].textContent = as[i].textContent + ' (You)'; // break dollchan.\r\n          }\r\n        }\r\n        if (add_name && own_posts && own_posts[post.no]===null) {\r\n          var pn_name = post.parse_funcs_html.pn_name(post);\r\n          if (pref.thread_reader.show_own_post_by==='plain') pn_name.parentNode.insertBefore(document.createTextNode(' (You)'), pn_name.nextSibling);\r\n          else pn_name.innerHTML = pn_name.innerHTML + ' (You)';\r\n        }\r\n      }\r\n      function check_1(post, watch, extracted_tags, extracted_posts){\r\n        var of_mine = own_posts && (post.no in own_posts);\r\n        if (of_mine) post.reply_of_mine = true;\r\n        if (!of_mine || !pref.catalog_footer_ignore_my_own_posts) {\r\n          var com = post.com;\r\n          if (com) {\r\n            var to_me  = false;\r\n            if (own_posts) {\r\n              var anchors = com.match(regexp_anchor);\r\n              if (anchors!==null) {\r\n                for (var j=0;j<anchors.length;j++) {\r\n                  var tgt = anchors[j].substr(regexp_anchor_len);\r\n                  if (own_posts[tgt]===null) {to_me = true; break;}\r\n            }}}\r\n            if (!to_me && own_posts_cb) {\r\n              anchors = com.match(regexp_anchor_cb);\r\n              if (anchors!==null) {\r\n                for (var j=0;j<anchors.length;j++) {\r\n                  var tgt = anchors[j].split('/');\r\n                  var bd = '/'+tgt[1]+'/';\r\n                  if (own_posts_cb[bd] && own_posts_cb[bd][tgt[2]]===null) {to_me = true; break;}\r\n            }}}\r\n            if (to_me) {\r\n              post.reply_to_me = true;\r\n              watch[1]+=0x10000;\r\n            }\r\n          }\r\n          watch[1]++;\r\n        }\r\n        extracted_posts[extracted_posts.length] = post;\r\n        if (extracted_tags) check_t1(post, extracted_tags);\r\n      }\r\n      function check_t1(post, extracted_tags){\r\n        if (com_or_txt) {\r\n          var mail = post.com; // 4chan doesn't have 'mail'.\r\n          if (!mail) return;\r\n          mail = mail.replace(/<[^>]*>|&[^;]*;/g,' ');\r\n          if (pref.test_mode['47']) {\r\n            pn_tags.innerHTML = mail;\r\n            mail = pn_tags[brwsr.innerText];\r\n          }\r\n        } else {\r\n          if (post.editing) {\r\n            extracted_tags[extracted_tags.length] = post.no;\r\n            return;\r\n          }\r\n          mail = post.body || post.com;\r\n          if (!mail) return;\r\n        }\r\n        if (mail.indexOf('#')===-1) return; // short cut.\r\n        if (str_rm_list) for (var i=0;i<str_rm_list.length;i++) mail = mail.replace(str_rm_list[i],'\\n');\r\n        var tags = mail.match(liveTag.scan_regex);\r\n//        if (tags!==null) extracted_tags = extracted_tags.concat(tags);\r\n        if (tags!==null)\r\n          for (var i=0;i<tags.length;i++)\r\n            if (tags[i].length<=pref.liveTag.maxstr) {\r\n              if (tag_ex_list) {\r\n                for (var j=tag_ex_list.length-1;j>=0;j--) if (tag_ex_list[j].test(tags[i])) break;\r\n                if (j>=0) continue;\r\n              }\r\n              extracted_tags[extracted_tags.length] = tags[i];\r\n            }\r\n      }\r\n      function prep_check_1(th){\r\n        if (th.parse_funcs.type_com==='txt') {\r\n          regexp_anchor     = regexp_anchor_txt;\r\n          regexp_anchor_len = 2;\r\n          regexp_anchor_cb  = regexp_anchor_cb_txt;\r\n          com_or_txt        = false;\r\n        } else {\r\n          regexp_anchor     = regexp_anchor_com;\r\n          regexp_anchor_len = 8;\r\n          regexp_anchor_cb  = regexp_anchor_cb_com;\r\n          com_or_txt        = true;\r\n        }\r\n      }\r\n      function prep_check_t1(th){\r\n        if (pref.liveTag.ex_list) {\r\n          tag_ex_list = pref_func.merge_obj5a(th.key,pref.liveTag.ex_list_obj5,null);\r\n          str_rm_list = pref_func.merge_obj5a(th.key,pref.liveTag.rm_list_obj5,null);\r\n        } else {\r\n          tag_ex_list = null;\r\n          str_rm_list = null;\r\n        }\r\n//        tag_ex_list = (pref.liveTag.ex_list)? pref_func.merge_obj5(th.key,pref.liveTag.ex_list_obj5,null) : null;\r\n      }\r\n      return {\r\n        remake_own_posts : function(){remake_own_posts = true;}, // couldn't get an event from myself, so don't miss posts from my thread.\r\n        make_own_posts : function(){  // called also from catalog initialializer, prevent from being called twice at initial.\r\n          site2[site.nickname].prep_own_posts();\r\n          remake_own_posts = false;\r\n        },\r\n        add_you: add_you,\r\n        set_own_posts: function(th){\r\n          own_posts_cb = site3[th.domain].own_posts;\r\n          own_posts = own_posts_cb[th.board];\r\n          if (Object.keys(own_posts_cb).length==0) own_posts_cb = undefined; // patch for faster execution.\r\n        },\r\n//        check_t1: check_t1,\r\n        check_t1_op: function(th){\r\n          prep_check_1(th);\r\n          prep_check_t1(th);\r\n          var extracted_tags = [];\r\n          check_t1(th, extracted_tags);\r\n////          watch[0] = (watch[0]&0xfffe0000) | 1; // BUG, WHY???\r\n//          watch[0] = (watch[0]&0xfffe0000);\r\n////          watch[2] = th.time; // requires many changes\r\n////          watch[2] = th.time_created; // requires many changes // BUG, WHY???\r\n          return extracted_tags;\r\n        },\r\n        get_checked_time: function(watch){\r\n//          return watch[2] + time_offset; // BUG.\r\n          return watch[2];\r\n        },\r\n        set_watch_time: function(watch, time, key){\r\n          if (time>0) {\r\n            watch[0] |= 0x00040000;\r\n////          watch[2]  = time - time_offset; // to reduce memory usage, but doesn't effect. // BUG!!! watch[2] is initialized to 0, and not watched thread will enter with this. all threads must be initialized to '-time_offset'.\r\n//            watch[2]  = time;\r\n            if (watch[0]&0x00800000) watch[2] = time; // to reduce memory churn, this may require 'double' instead of Int32 for watch[2], CAUTION for compression.\r\n            else {\r\n              this.time_watch[key] = time;\r\n              watch[0] &= 0xff7fffff;\r\n            }\r\n          }\r\n        },\r\n        set_watched_to_last: function(watch, time, key){\r\n          this.set_watch_time(watch, time, key);\r\n          watch[1] = 0;\r\n        },\r\n        set_unwatch: function(watch){\r\n          watch[0] &= 0xff73ffff;\r\n          watch[1] = 0;\r\n        },\r\n        time_watch:{},\r\n//        check: function(th, watch, make_pn){\r\n        check: function(th, watch, notify, ext_posts){ // watch[0]>0 && watch[3]>0 : usual check,\r\n          // watch[0]>0 && watch[3]<0 : retag, initialize tag but doesn't show new replies. (watch[3] must retain its value), and entry\r\n          // watch[0]<0 && watch[3]>0 : watchtime is updated. rescan new replies and show them. (watch[0] can be destroyed), BUG, can't entry.\r\n          // watch[0]<0 && watch[3]<0 : not used.\r\n          //\r\n          // watch[0] [15:0]: num of posts so far,\r\n          //          [16]: initial,\r\n          //          [17]: initial tag, retag,\r\n          //          [18]: watch_req, [19]:watching, [22:20]:archive,\r\n          //          [23]: watch time not initialized. (23,18) -> 10: not initialized, 11: watch_req, use watch[2], 01: watch_req, use tiem_watch, 00: usual state.\r\n          //          [24]: reentry of detection of deleted posts\r\n          // watch[1] number of unread replies to me << 16 + number of unread replies\r\n          // watch[2] checked time'\r\n          var tag_init = watch[0]&0x00020000; // patch for retag.\r\n//          var init = (watch[3]<0); // patch for retag.\r\n//          if (watch[3]<0) watch[3] = -watch[3];\r\n//          var time_check = watch[3];\r\n//          var time_check = watch[2] + time_offset; // BUG.\r\n          var time_check = watch[2];\r\n          var watchtime_changed = false;\r\n//          var time_lastsaw = (watch[3]>0)? watch[3] : watch[0];\r\n//          var time_lastsaw = (watch[3]>watch[0])? watch[3] : watch[0]; // redundant anymore.\r\n//          if (watch[0]<0) { // initial\r\n//            watch[0] = -watch[0];\r\n//            time_check = watch[0];\r\n//            watch[1] = 0;\r\n//            watch[2] = (watch[2]&0xfffe0000) + ((th.omitted_posts)? th.omitted_posts+1 : 0); // number of replies so far, patch for 4chan catalog_json.\r\n//            init     = true;\r\n//            watchtime_changed = true;\r\n//          }\r\n          var time_watch = watch[2];\r\n          if (watch[0]&0x00040000) { // initial\r\n//            time_watch = cataLog.get_watch_time_of_a_thread(th.key,th.time_created,null, true); // BUG, can't handle if time_watch===0(not watched).\r\n            if (watch[0]&0x00800000) {\r\n              time_check = 0;\r\n              watch[2] = 0;\r\n            } else {\r\n              time_watch = this.time_watch[th.key];\r\n              delete this.time_watch[th.key];\r\n            }\r\n//            watch[2] = 0;\r\n            watch[1] = 0;\r\n            watch[0] = ((watch[0]&0xfffb0000) | 0x00080000)+ ((th.omitted_posts)? th.omitted_posts+1 : 0); // number of replies so far, patch for 4chan catalog_json.\r\n//            init     = true;\r\n            watchtime_changed = true;\r\n          }\r\n          var time_check_old = time_check;\r\n//console.log('start: '+dbt[0]+dbt[1]+dbt[2],watch[5]);\r\n          var i = th.posts.length-1;\r\n//          if (remake_own_posts) { // working code.\r\n//            site2[site.nickname].prep_own_posts(); // couldn't get an event from myself, so don't miss posts from my thread.\r\n//            remake_own_posts = false;\r\n//          }\r\n          if (i>=0) {\r\n//            watch[2] = (th.posts[i].time*th.parse_funcs.time_unit || watch[2]) - time_offset; // BUG.\r\n            watch[2] = th.posts[i].time*th.parse_funcs.time_unit || watch[2];\r\n            if (th.parse_funcs.time_unit!=1) {\r\n              time_check = Math.floor(time_check/th.parse_funcs.time_unit);\r\n              time_watch = (watchtime_changed)? Math.floor(time_watch/th.parse_funcs.time_unit) : time_check;\r\n            }\r\n            var extracted_tags = (pref.liveTag.from==='post')? [] : null;\r\n            if (extracted_tags) prep_check_t1(th);\r\n            var ur_old = liveTag.generate_ur(watch[1]);\r\n            var watching = watch[0]&0x000c0000;\r\n            if (watching || extracted_tags) prep_check_1(th);\r\n            if (watching) {\r\n              if (remake_own_posts) this.make_own_posts();\r\n              liveTag.mems[th.domain][th.board].nr = -1; // mark as dirty.\r\n              prep_check_1(th);\r\n              this.set_own_posts(th);\r\n              while (i>=0 && th.posts[i].time>time_watch) check_1(th.posts[i--], watch, extracted_tags, ext_posts); // extracting tags in op is redundant, because they are ALWAYS extracted.\r\n            }\r\n            if (extracted_tags) while (i>0 && (tag_init || th.posts[i].time>time_check)) check_t1(th.posts[i--], extracted_tags); // tuned for initial loop. don't extract tags in op.\r\n            if (!common_obj.thread_reader) {\r\n              if (extracted_tags && extracted_tags.length!=0) var tags = liveTag.extract_tags(th, extracted_tags, null, !tag_init); // 'check_update_tags_color' is called in this.\r\n              else if (pref.liveTag.style && watching) {\r\n                var ur = liveTag.generate_ur(watch[1]);\r\n                if (ur_old!=ur) liveTag.update_ur(th.key,ur,ur_old!=0 && watchtime_changed); // can choose faster function if ur==0.\r\n              }\r\n            }\r\n            if (pref3.stats.use && stats) stats.aggregate(th); // '&& stats' is a patch for embed_thread.\r\n            if (time_watch!==time_check || !watching) {\r\n              i = th.posts.length;\r\n              while (i>0 && th.posts[i-1].time>time_check) i--;\r\n              var new_posts = th.posts.slice(i);\r\n            }\r\n          }\r\n          watch[0] = (watch[0]&0xfff90000) + th.nof_posts;\r\n//console.log('end:   '+dbt[0]+dbt[1]+dbt[2]);\r\n//if (pref.debug_mode['3'] && extracted_tags.length!=0) console.log(th.key+': '+extracted_tags);\r\n////////          if (cataLog.threads && cataLog.threads[th.key]) { // working code.\r\n//////////            if (!cataLog.threads[th.key][9][0]) cataLog.threads[th.key][9] = cataLog.catalog_filter_query(th.key); // doesn't work because threads[name][8] is NOT updated.\r\n////////            cataLog.insert_footer3(th.key,null,th.page,tags);\r\n////////          }\r\n          if (notify && (watch[0]&0x000c0000)) {\r\n//            if (ext_posts.length!=0 && pref.notify.desktop.notify && th.parse_funcs.add_op_img_url) th.parse_funcs.add_op_img_url(ext_posts,th.board,th.domain); // can't get 'com' if 'meguca'\r\n            if (ext_posts.length!=0 && pref.notify.desktop.notify) site2[th.domain].wrap_to_parse.posts({posts:ext_posts, __proto__:th});\r\n            notifier.changed(th, ext_posts);\r\n          }\r\n          return {tags:tags, posts:new_posts || ext_posts, time_check_old:time_check_old};\r\n        },\r\n      }\r\n    })(),\r\n\r\n////////    get_posts2 : function(doc,pool){return {}}, // subfunction of check_reply_to_me, parse html to json.\r\n    get_post_offsetTop : function(doc,num) {}, // get offsetTop of Nth object.\r\n    favicon: {}, // object for favicon\r\n//    get_op_image_url: function(th,type){}, // get op image's url.\r\n    get_icon : function(){}, // get sticky icon.\r\n    add_icon : function(){}, // add sticky icon.\r\n//    embed_to: {\r\n//      'page'  : {'top' : null, 'bottom' : null},\r\n//      'thread': {'top' : null, 'bottom' : null}\r\n//    },\r\n    time_revised_check: function(nof_ths){return false;},\r\n\r\n    format_thread_layout   : function(thread){}, // formats its layout   for catalog.\r\n    format_thread_style    : function(thread){}, // formats its style    for catalog.\r\n    format_thread_contents : function(thread){}, // formats its contents for catalog.\r\n    format_thread_always   : function(thread){}, // formats its contents for catalog, always executed.\r\n////////    format_time            : function(thread){}, // formats its timestamp to local time.\r\n    format_remove_tn_area_size: function(thread){}, // remove thumbnail area size\r\n//    mark_newer_posts       : function(thread,time){return null;},  // mark newer posts, and returns marked first post.\r\n//    unmark_post_from_event : function(post){},  // unmark post.\r\n    mark_newer_posts : function(nickname,posts,date,style_mark,style_unmark,class_or_tag,key,unmark){\r\n//      var offset_top = 0;\r\n      var marked_first_post = null;\r\n      for (var i=posts.length-1;i>=0;i--) {\r\n        var mark = date<site2[nickname].get_time_of_post_in_utc(posts[i]);\r\n        var reply = posts[i];\r\n//        posts[i] = posts[i].parentNode;\r\n//        if (class_or_tag=='class') while (posts[i].className.search(key)==-1) posts[i] = posts[i].parentNode;\r\n//        if (class_or_tag=='tag') while (posts[i].tagName.search(key)==-1) posts[i] = posts[i].parentNode;\r\n        if (class_or_tag=='class') reply = posts[i].getElementsByClassName(key)[0];\r\n        if (class_or_tag=='tag')  reply = posts[i].getElementsByTagName(key)[0];\r\n        if (reply)\r\n          if (mark) {\r\n//            reply.setAttribute('style',style_mark);\r\n            if (!reply.style) reply.style = {};\r\n            reply.style.border = '2px solid red';\r\n            if (unmark) reply.addEventListener('mouseover', site2[nickname].unmark_post_from_event, false);\r\n//            offset_top = reply.offsetTop;\r\n            marked_first_post = reply;\r\n          } else {\r\n//            reply.setAttribute('style',style_unmark);\r\n            if (reply.style) reply.style.border = 'none';\r\n          }\r\n      }\r\n//      return offset_top;\r\n      return marked_first_post;\r\n    },\r\n    format_pn: function(pn,thq_no, pref_env, post){\r\n      if (!pref_env) pref_env = pref[cataLog.embed_mode];\r\n      if (pref_env.colorID) this.colorID(pn);\r\n      if (pref_env.backlink) this.backlink(pn,thq_no);\r\n      if (pref_env.localtime) this.localtime(pn);\r\n      if (post) { // BUG, CALLED TWISE TIMES for deleted posts in embed_mode==='thread'\r\n        if (cataLog.embed_mode==='page' || cataLog.embed_mode==='thread') site2['DEFAULT'].check_reply.add_you(post, true); // \"cataLog.embed_mode==='page'\" is a patch.\r\n        if (post.deleted_after) pn.classList.add('CatChan_search_miss');\r\n        if (post.search_result!==undefined) site2[post.domain_html].update_posts0_class(pn, post.search_result);\r\n      }\r\n    },\r\n    colorID: function(){},\r\n    backlink: function(){},\r\n    localtime: function(){},\r\n    unmark_post_from_event: function() {\r\n      this.setAttribute('style','border: none');\r\n      this.removeEventListener('mouseover', site2['common'].unmark_post_from_event, false);\r\n    },\r\n    modify_thread_link     : function(thread){return [];}, // modify thread link and returns information to add event listener.\r\n    preprocess_html        : function(doc_txt){return doc_txt;},  // pre-process document from txt. // cause memory leak.\r\n    preprocess_doc         : null, //function(doc){},  // pre-process document.\r\n////////    thread2headline : function(doc){return [0,0];},  // make headline from entire thread, returns num of [posts, images].\r\n//    add_thread_link : function(doc,url){}, // add link to this thread.\r\n    check_thread_archived : function(thread){return false;}, // check the thread is archived.\r\n    get_owners_recommendation: function(){return '';}, // return string of owner's recommendation.\r\n    get_board_tags : function(){return {};}, // return object of board tags.\r\n//    get_json_url_thread : function(board,thread){return '';}, // return url of JSON API.\r\n    get_json_url_catalog : function(board){return '';}, // return url of JSON API.\r\n//    parse_json_thread: function(txt,from_http){return JSON.parse(txt);}, // parser of JSON API.\r\n    parse_json_thread: function(obj,from_http){}, // parser of JSON API.\r\n    parse_json_catalog: function(txt){return JSON.parse(txt);},  // parser of JSON API.\r\n    uip_tgt_post : function(no){return null;}, // returns uip target post.\r\n    uip_post_num : function(post){return null;}, // returns num in posts.\r\n    uip_check: function(callback){}, // hook for uip_tracker.\r\n    catalog_native_prep: function(depend_on_site){return []}, // prepare for native catalog.\r\n    catalog_frame_prep: function(pn12){}, // prepare for frame mode.\r\n    catalog_native_frame_prep: function(pn12,pn12_button){ // prepare for frame mode in native catalog.\r\n      var mode = false;\r\n      var ifrm;\r\n      var pn_catalog;\r\n      function insert_remove_frame(){\r\n        if (!mode) {\r\n          pn_catalog = site2['common'].absorb_children(site.root_body);\r\n          pn_catalog.style.width = pref.catalog_size_frame0_width + '%';\r\n          pn_catalog.style.float = 'left';\r\n          pn_catalog.style.height = '' + window.innerHeight + 'px';\r\n          pn_catalog.style.overflow = 'scroll';\r\n          ifrm = site2[site.nickname].catalog_native_frame_prep_frame(site.root_body,null);\r\n        } else {\r\n          site.root_body.removeChild(ifrm);\r\n          ifrm = null;\r\n          site.embed_frame_win = null;\r\n          site2['common'].disgorge_children(pn_catalog);\r\n//          this.removeEventListener('click', insert_remove_frame, false);\r\n        }\r\n        mode = !mode;\r\n      }\r\n      pn12_button.addEventListener('click', insert_remove_frame, false);\r\n    },\r\n    catalog_native_frame_prep_frame: function(parent,ref_node){\r\n      ifrm = document.createElement('iframe');\r\n      ifrm.setAttribute('name',site.embed_frame);\r\n      ifrm.style.height = '' + window.innerHeight + 'px';\r\n      ifrm.style.margin = '0px';\r\n      ifrm.style.width = pref.catalog_size_frame1_width + '%';\r\n      parent.insertBefore(ifrm,ref_node);\r\n      site.embed_frame_win = ifrm.contentWindow;\r\n      return ifrm;\r\n    },\r\n    catalog_embed_prep: function(pn12){\r\n      pn12.style.position = '';\r\n      pn12.childNodes[1].style.width = '';\r\n      pn12.childNodes[1].style.height = '' + window.innerHeight + 'px';\r\n      pn12.childNodes[0].childNodes[0].style.display = 'none';\r\n      pn12.childNodes[0].childNodes[1].style.display = 'none';\r\n      pn12.style.border = '';\r\n      pn12.style.left = '';\r\n      pn12.style.resize = '';\r\n      pn12.style.top = '';\r\n    },\r\n    thread2search_obj : function(thread){return [thread[brwsr.innerText],'','','','','','',''];}, // return search_obj from thread.\r\n////    get_click_area: function(pn){\r\n////      var img = pn.getElementsByTagName('img');\r\n////      return (img.length!=0)? img : pn;\r\n////    },\r\n//    get_click_area: function(pn){\r\n//      var img0 = pn.getElementsByTagName('img')[0];\r\n//      return (img0)? img0 : pn;\r\n//    }\r\n    popups_op_func_set: function(){return 1;}, // vichan\r\n    popups_op_func_use: function(pn,thq,no){ // vichan\r\n      pn.setAttribute('class',pn.getAttribute('class')+' reply');\r\n//      pn.insertBefore(thq[no].pn.parentNode.querySelector('.files').cloneNode(true),pn.firstChild);\r\n    },\r\n    popup_info:null,\r\n    popups_post_entry: function(e){\r\n//      var th_q = site2[site.nickname].popups_href2th_q(this.getAttribute('href')); // TEMPORAL\r\n      var et = e.target;\r\n      var href = et.href;\r\n      var th = {};\r\n      if (href[0]==='/') th.domain = site.nickname;\r\n      else {\r\n        for (var d in site2) if (href.indexOf(site2[d].domain_url)!=-1) {th.domain = site2[d].nickname; break;}\r\n        href = href.replace(new RegExp('(http)*s*(://)*.*'+site2[th.domain].domain_url),'');\r\n      }\r\n      th.domain_html = (pref.catalog.mimic_base_site)? site.nickname : th.domain;\r\n      var th_q = site2[th.domain].popups_href2th_q(et.getAttribute('href'));\r\n      var dbt = th_q[2];\r\n      if (!th_q) return;\r\n      if (pref[cataLog.embed_mode].env.event_dynamic && pref[cataLog.embed_mode].env.popup_native && site.nickname===th.domain) return;\r\n      var pn;\r\n      var pnode = et;\r\n      function out(){\r\n        et.onmouseout=null;\r\n        pnode.removeChild(pn);\r\n        site2['DEFAULT'].popup_info = null;\r\n      }\r\n      if (th_q[0][th_q[1]]===undefined || Array.isArray(th_q[0][th_q[1]])) { // 'th_q[0][th_q[1]]===undefined' for multilevel popups.\r\n        cataLog.scan_init('popup',[th.domain+dbt[1]+((pref.catalog.catalog_json)? 't':'')+dbt[2]], {priority:8});\r\n        pn = site2[th.domain_html].post_json2html({time: 0, com:'Loading...'}, dbt[1]);\r\n        site2['DEFAULT'].popup_info = {node:et, clientX:e.clientX, clientY:e.clientY, key:dbt[0]+dbt[1]+dbt[2]+'#'+dbt[3], func_out:out};\r\n      } else {\r\n        if (site2['DEFAULT'].popup_info) site2['DEFAULT'].popup_info.func_out();\r\n//        if (site2['DEFAULT'].popup_info) et.onmouseout(); // BUG at editing, sometimes out is never issued because of being replaced.\r\n//        if (!th_q[0][th_q[1]].pn || th_q[0][th_q[1]].isOP || th_q[0][th_q[1]].type_data==='html') {\r\n        if (!th_q[0][th_q[1]].pn || th_q[0][th_q[1]].isOP) { // test\r\n          if (!th_q[0][th_q[1]].domain) { // PATCH, use prototype of liveTag.mems.\r\n            var tgt = th_q[0][th_q[1]];\r\n            tgt.domain = th.domain;\r\n            if (tgt.extra_files) for (var i=0;i<tgt.extra_files.length;i++) tgt.extra_files[i].domain = th.domain;\r\n          }\r\n          pn = site2[th.domain_html].post_json2html(th_q[0][th_q[1]], dbt[1]);\r\n        } else pn = th_q[0][th_q[1]].pn.cloneNode(true);\r\n        site2[th.domain_html].format_pn(pn, th_q[0][th_q[1]]);\r\n      }\r\n      pn.style = {};\r\n      pn.style.position = 'fixed';\r\n      pn.style.left = e.clientX + 10 + 'px';\r\n      if (!pref.test_mode['25']) pn.style.top  = e.clientY -15 + 'px';\r\n      else pn.style.bottom  = window.innerHeight - e.clientY + 20 + 'px';\r\n      pn.style.zIndex = 1;\r\n      if (site.nickname!=='KC') pn.style.borderStyle = 'solid';\r\n      pn.style.boxShadow = 'rgb(153, 153, 153) 1px 1px 1px';\r\n      if (site.nickname==='4chan') pn.classList.add('preview');\r\n//      if (th_q[0][th_q[1]].isOP) site2[th.domain_html].popups_op_func_use(pn,th_q[0], th_q[1]);\r\n      while ((pnode.getAttribute('class') || '').indexOf('post')==-1 && pnode.parentNode) pnode = pnode.parentNode;\r\n      pnode.appendChild(pn);\r\n      et.onmouseout = out;\r\n      pn.onmouseover = out;\r\n//      site2['DEFAULT'].popup_info = null;\r\n      if (pref.debug_mode['10']) site2[th.domain].popups_debug('popup: '+th_q[1]+': ',th_q[0]);\r\n//      }\r\n    },\r\n//    popups_post: function(sender,e){\r\n//      this.post_json2html(sender\r\n//    },\r\n\r\n    popups_href2dbtp: function(href, src, th){\r\n      if (href[0]==='#') {\r\n        href = th.board+'res/'+th.no+'.html'+href;\r\n        src.setAttribute('href',href);\r\n      }\r\n      var hrefs = href.split('/');\r\n      var p = hrefs[hrefs.length-1].substr(hrefs[hrefs.length-1].indexOf('#')+1);\r\n      var t = hrefs[hrefs.length-1].substr(0,hrefs[hrefs.length-1].indexOf('.'));\r\n      var b = (hrefs.length>=3)? '/'+hrefs[hrefs.length-3]+'/' : site.board;\r\n      var d = this.nickname;\r\n      return [d,b,t,p];\r\n    },\r\n    popups_href2th_q: function(href,src,th){\r\n      var dbt = this.popups_href2dbtp(href,src,th);\r\n//      var th = liveTag.mems[d][b][t];\r\n      var th = liveTag.mems.init({domain:dbt[0], board:dbt[1], no:dbt[2]});\r\n      if (th.q===undefined) th.q = {};\r\n      if (!liveTag.mems[dbt[0]][dbt[1]][dbt[2]] || !liveTag.mems[dbt[0]][dbt[1]][dbt[2]].q) return null; // patch for accessibility check. 'if (!th)' doesn't work.\r\n      return [liveTag.mems[dbt[0]][dbt[1]][dbt[2]].q, dbt[3], dbt];\r\n    },\r\n////    popups_add: function(posts, posts_old, th){ // working code.\r\n////      if (!posts_old) posts_old = [];\r\n////      var th_q0 = liveTag.mems[th.domain][th.board][th.no];\r\n////      if (th_q0.q===undefined) th_q0.q = {};\r\n////      var thq = th_q0.q;\r\n////      if (posts) for (var i=0;i<posts.length;i++) Object.defineProperty(posts[i],'no',{value:th.parse_funcs.no(posts[i])});\r\n////      if (posts && posts.length!=0) {\r\n//////        for (var i=0;i<posts.length;i++) Object.defineProperty(posts[i],'no',{value:parseInt(posts[i].pn.getElementsByClassName('post_no')[1].textContent,10)});\r\n//////        if (posts_old.length!=0) while (posts_old[0].no<posts[0].no) this.popups_release(posts_old.shift()); // [0] is OP\r\n////        if (posts.length>1) while (posts_old.length>1 && posts_old[1].no<posts[1].no) this.popups_release(posts_old.splice(1,1)[0]);\r\n////      }\r\n////      if (posts) {\r\n////        for (var i=0;i<posts.length;i++) {\r\n////          var flag_old = posts_old.length!=0 && posts_old[posts_old.length-1].no>posts[i].no;\r\n////          var tgts = [];\r\n////          var as = posts[i].pn.getElementsByTagName('a');\r\n////          for (var j=0;j<as.length;j++)\r\n////            if (as[j].textContent.search(/>>[0-9]+$/)!=-1) {\r\n////              as[j].onmouseover = this.popups_post_entry;\r\n////              if (!flag_old) {\r\n////                var th_q = site2[th.domain].popups_href2th_q(as[j].getAttribute('href'),as[j],th);\r\n////                if (th_q) {\r\n////                  tgts[tgts.length] = as[j].getAttribute('href');\r\n////                  this.popups_grep(th_q[0],th_q[1]);\r\n////                }\r\n////              }\r\n////            }\r\n////          if (!flag_old) {\r\n////            posts_old[posts_old.length] = (tgts.length!==0)? {no:posts[i].no, tgts:tgts, thq:thq} : {no:posts[i].no, thq:thq};\r\n////            this.popups_grep(thq,posts[i].no);\r\n////            this.popups_set(thq,posts[i].no,posts[i]);\r\n////            if (i===0) thq[posts[i].no].isOP = 1;\r\n////          }\r\n////        }\r\n////      } else while (posts_old.length>1) this.popups_release(posts_old.shift());\r\n////      if (pref.debug_mode['10']) {\r\n////        var d_str = '';\r\n////        for (var i in thq) d_str += i+':'+((thq[i].reffered)? thq[i].reffered : thq[i])+', ';\r\n////        console.log('popups_add :'+th.key+': '+d_str);\r\n////      }\r\n////      return posts_old;\r\n////    },\r\n////    popups_grep: function(thq, no){\r\n////      if (thq[no]===undefined) thq[no] = 1; // waiting to be filled, but not make requests.\r\n////      else if (typeof(thq[no])==='number') thq[no] = thq[no] + ((thq[no]<0)? -1 : 1);\r\n////      else ++thq[no].reffered;\r\n////    },\r\n////    popups_set: function(thq, no, val){\r\n////      if (typeof(thq[no])==='number') {\r\n////        thq[no] = val;\r\n////        thq[no].reffered = (val_old>=0)? val_old : -val_old;\r\n////      }\r\n////    },\r\n////    popups_release_1: function(th_q){\r\n////      if (th_q) {\r\n////        if (typeof(th_q[0][th_q[1]])==='number') {\r\n////          th_q[0][th_q[1]] -= (th_q[0][th_q[1]]<0)? -1 : 1;\r\n////          if (th_q[0][th_q[1]]===0) delete th_q[0][th_q[1]];\r\n////        } else if (--th_q[0][th_q[1]].reffered===0) delete th_q[0][th_q[1]];\r\n////      }\r\n////    },\r\n////    popups_release: function(post){\r\n////      if (post.tgts)\r\n////        for (var i=0;i<post.tgts.length;i++)\r\n////          this.popups_release_1(site2[site.nickname].popups_href2th_q(post.tgts[i])); // TEMPORAL\r\n////      this.popups_release_1([post.thq, post.no]);\r\n////      if (pref.debug_mode['10']) {\r\n////        var d_str = '';\r\n////        for (var i in thq) d_str += i+':'+((thq[i].reffered)? thq[i].reffered : thq[i])+', ';\r\n////        console.log('popups_release :'+post.no+': '+d_str);\r\n////       }\r\n////    },\r\n    popups_add: function(tgt_th16, th, activate){\r\n      var posts = tgt_th16.posts;\r\n      if (!tgt_th16.popups) tgt_th16.popups = Object.create(null);\r\n      var popups = tgt_th16.popups;\r\n      var lth = liveTag.mems[th.domain][th.board][th.no];\r\n      if (lth.q===undefined) lth.q = {};\r\n      if (posts) if (th.type_data==='html') {for (var i=0;i<posts.length;i++) if (!posts[i].no) Object.defineProperty(posts[i],'no',{value:th.parse_funcs.no(posts[i])});}\r\n//                 else for (var i=0;i<posts.length;i++) if (!posts[i].pn) posts[i].pn = this.post_json2html(posts[i],th.board);\r\n      var posts_exist = {};\r\n      if (posts) {\r\n        for (var i=0;i<posts.length;i++) {\r\n          var post_no = posts[i].no;\r\n          posts_exist[post_no] = null;\r\n          if (popups[post_no]===undefined) {\r\n            this.popups_add_1(th, posts[i], activate, lth.q, i===0, true);\r\n//            var quotes = [];\r\n//            var as = posts[i].pn.getElementsByTagName('a');\r\n//            for (var j=0;j<as.length;j++)\r\n////              if (as[j].textContent.search(/>>[0-9]+$/)!=-1) {\r\n//              if (as[j].textContent.search(link_regex)!=-1) {\r\n//                if (activate) as[j].onmouseover = this.popups_post_entry;\r\n//                var th_q = site2[th.domain].popups_href2th_q(as[j].getAttribute('href'),as[j],th);\r\n//                var a_class = as[j].parentNode.getAttribute('class');\r\n//                if (!a_class || a_class.indexOf(site2[th.domain_html].backlink_class)==-1) { // skip backlinks\r\n//                  if (th_q) {\r\n//                    quotes[quotes.length] = [th_q[0], th_q[1]];\r\n//                    site2[th.domain_html].popups_add_backlink(th_q[0],th_q[1],th.key+'#'+post_no, th);\r\n//                  }\r\n//                }\r\n//              }\r\n//            this.popups_set(thq,post_no,posts[i],quotes);\r\n//            if (i===0) thq[post_no].isOP = site2[th.domain_html].popups_op_func_set(posts[i].pn);\r\n            popups[post_no] = null;\r\n          }\r\n        }\r\n      }\r\n      for (var i in popups) {\r\n        if (posts_exist[i]===undefined) {\r\n//          this.popups_release(popups[i], i, th.key); // BUG???\r\n          this.popups_release(lth.q, i, th.key);\r\n          delete popups[i];\r\n        }\r\n      }\r\n//      if (posts) site2[th.domain_html].format_pn(posts[0].pn, lth.q[th.no]); // PROBABLY THIS IS REDUNDANT, BUT NOT DEBUGGED.\r\n//      if (pref.debug_mode['10']) this.popups_debug('popups_add: '+th.no+': ', lth.q);\r\n    },\r\n//        var link_regex = />>[0-9]+$|>>>\\/[0-z_]+\\/[0-9]+$/;\r\n//        var link_regex = />>(>\\/.+\\/)*[0-9]+$/;\r\n//    popups_link_regex: />>(>\\/.+\\/)*[0-9]+(\\s\\(You\\))*$/, // patch for '(You)'\r\n    popups_link_regex: /^>>(>\\/.+\\/)*[0-9]+/, // patch for '(You)' and '(OP)'\r\n    popups_add_1: function(th, post, activate, thq, op, quote){\r\n      var op_regexp = /^>>/+th.no+'(\\\\s|\\\\(|$)/';\r\n      var quotes = [];\r\n      if (!post.pn) post.pn = site2[th.domain_html].post_json2html(post,th.board);\r\n      var as = post.pn.getElementsByTagName('a');\r\n      for (var j=0;j<as.length;j++) {\r\n//        if (as[j].textContent.search(/>>[0-9]+$/)!=-1) {\r\n        var as_txt = as[j].textContent;\r\n        if (as_txt.search(this.popups_link_regex)!=-1) {\r\n          if (activate) as[j].onmouseover = this.popups_post_entry;\r\n          var th_q = site2[th.domain].popups_href2th_q(as[j].getAttribute('href'),as[j],th); // this may change href, so this must be here.\r\n          if (pref[cataLog.embed_mode].link_show_op && as_txt.search(op_regexp)===0 && as_txt.indexOf('(OP)')==-1) as[j].textContent += ' (OP)';\r\n          var a_class = as[j].parentNode.getAttribute('class');\r\n          if (!a_class || a_class.indexOf(site2[th.domain_html].backlink_class)==-1) { // skip backlinks\r\n            if (th_q) {\r\n              var lthq_no = parseInt(th_q[1],10);\r\n              quotes[quotes.length] = [th_q[0], lthq_no]; // quotes may be multiple.\r\n              site2[th.domain_html].popups_add_backlink(th_q[0],lthq_no,th.key+'#'+post.no, th); // backlinks keep being unique using object key.\r\n            }\r\n          }\r\n        }\r\n      }\r\n      this.popups_set(thq,post.no,post, quote && quotes.length!=0 && quotes);\r\n      if (op) thq[post.no].isOP = site2[th.domain_html].popups_op_func_set(post.pn);\r\n    },\r\n    popups_add_backlink: function(thq, no, key, th){\r\n      if (thq[no]===undefined) {\r\n        thq[no] = [key];\r\n        this.popups_set_waiting(thq,no);\r\n      } else if (Array.isArray(thq[no])) {\r\n        if (thq[no].indexOf(key)==-1) thq[no][thq[no].length] = key;\r\n      } else {\r\n        if (!thq[no].backlinks) thq[no].backlinks = [];\r\n        if (thq[no].backlinks.indexOf(key)==-1) {\r\n          thq[no].backlinks[thq[no].backlinks.length] = key;\r\n          if (thq[no].pn) if (pref[cataLog.embed_mode].backlink) site2[th.domain_html].add_backlinks(thq[no].pn,thq[no].backlinks,thq[no].backlinks.length-1, th);\r\n        }\r\n      }\r\n    },\r\n    popups_remove_backlink: function(thq, no, key){\r\n      if (!thq[no]) return; // 'quotes' may be multiple, then hit this line.\r\n      var ary = (Array.isArray(thq[no]))? thq[no] : thq[no].backlinks;\r\n//if (pref.debug_mode['12'] && !ary) {\r\n//  console.log('error in popups_remove_backlinks:');\r\n//  console.log(thq);\r\n//  console.log(no);\r\n//  console.log(key);\r\n//}\r\n      var idx = ary.indexOf(key);\r\n      if (idx>=0) ary.splice(idx,1);\r\n//      else console.log('ERROR in handling popups ' + no+', '+key+', '+thq[no].backlinks); // quotes allows multiple, but backlink doesn't, delettioni of a post which has multiple links to a post hits this line.\r\n      if (ary.length===0 && thq[no].remove_if_no_backlinks) delete thq[no];\r\n      if (pref.debug_mode['10']) this.popups_debug('popups_remove_backlinks: '+no+': '+key+': ', thq);\r\n    },\r\n    popups_set: function(thq, no, val, quotes){\r\n      if (thq[no]===undefined) {\r\n        thq[no] = val;\r\n        thq[no].backlinks = undefined; // PATCH FOR MEGUCA, meguca has backlinks in native.\r\n      } else if (Array.isArray(thq[no])) {\r\n        val.backlinks = thq[no];\r\n        thq[no] = val;\r\n      } else { // for multiple entry at editing===true, update thq[no].\r\n        val.backlinks = thq[no].backlinks;\r\n        thq[no] = val;\r\n      }\r\n      if (quotes) thq[no].quotes = quotes;\r\n      if (val.editing) this.popups_set_waiting(thq,no); // keep updating while editing by 'popups_fetched'\r\n      else if (thq.waiting) this.popups_remove_waiting(thq,no);\r\n    },\r\n    popups_release: function(thq, no, th_key){\r\n      var thq_no = thq[no];\r\n      if (thq_no.quotes)\r\n        for (var i=0;i<thq_no.quotes.length;i++)\r\n          this.popups_remove_backlink(thq_no.quotes[i][0], thq_no.quotes[i][1], th_key+'#'+no);\r\n      if (!thq_no.backlinks || thq_no.backlinks.length===0) delete thq[no];\r\n      else thq_no.remove_if_no_backlinks = 1;\r\n      if (pref.debug_mode['10']) this.popups_debug('popups_release: '+no+': ', thq);\r\n    },\r\n    popups_set_waiting: function(thq,no){\r\n      if (!thq.waiting) thq.waiting = [no];\r\n      else {\r\n        var i=0;\r\n        while (i<thq.waiting.length && thq.waiting[i]<no) i++;\r\n        if (thq.waiting[i]!=no) thq.waiting.splice(i,0,no);\r\n      }\r\n    },\r\n    popups_remove_waiting: function(thq,no){\r\n      var idx = thq.waiting.indexOf(no);\r\n      if (idx!=-1) thq.waiting.splice(idx,1);\r\n      if (thq.waiting.length===0) delete thq.waiting;\r\n    },\r\n    popups_fetched: function(th, lth){ // 'if (lth.q && lth.q.waiting)' is checked by caller.\r\n      var j=th.posts.length-1;\r\n      for (var i=lth.q.waiting.length-1;i>=0;i--) {\r\n        var no = lth.q.waiting[i];\r\n        while (j>0 && no<th.posts[j].no) j--;\r\n        if (no===th.posts[j].no) {\r\n          th.posts[j].parse_funcs = th.parse_funcs; // redundant??? \r\n          if (th.type_data==='html') this.popups_fetched_html(th.posts[j], th); // wrap_to_parse.post and prepare_html_extract_params should be used, but not debugged, left this.\r\n          site2[th.domain].wrap_to_parse.posts({posts:[th.posts[j]], __proto__:th});\r\n          cataLog.format_html.prepare_html_post(th, th.posts[j]);\r\n          this.popups_add_1(th, th.posts[j], pref[cataLog.embed_mode].popup, lth.q, no===th.no, false); // cut quote link.\r\n//          this.popups_set(lth.q, no, th.posts[j]); // BUG, this doesn't update quotes, in multiple popup mode, this will be appear, use popups_add_1.\r\n//                                                   // In single popup mode, thie cut quote links and reduce memory consumption.\r\n////          this.popups_set(lth.q, i, (th.type_data==='json')? th.posts[j] : this.popups_fetched_html(th.posts[j], th)); // BUG, this deletes quote.\r\n        } else if (th.type_source==='thread') {\r\n          if (!pref.test_mode['64']) this.popups_set(lth.q, no, {time: 0, com:'DELETED'});\r\n          else this.popups_set(lth.q, no, {time: 0, com:'DELETED'}); // referring deleted posts should be here.\r\n        } else if (j===0) break;\r\n        if (this.popup_info && this.popup_info.key===th.key+'#'+th.posts[j].no) this.popups_post_entry({target:this.popup_info.node, __proto__:this.popup_info});\r\n      }\r\n    },\r\n\r\n\r\n\r\n    popups_fetched_html: function(post, th){ // PATCH, WILL BE REMOVED.\r\n//      if (th.domain!==site.nickname && pref.catalog.mimic_base_site && th.domain_html!==site.nickname) {\r\n//        var post_new = common_func.shallow_copy_1(post); // MAY COLLIDE???\r\n\r\n//        site2[th.domain].wrap_to_parse_posts(th); // TEMPORAL\r\n        var proto_obj = {domain:th.domain, board:th.board, domain_html:th.domain_html, parse_funcs:th.parse_funcs};\r\n        if (post.extra_files) for (var j=0;j<post.extra_files.length;j++) for (var k in proto_obj) post.extra_files[j][k] = proto_obj[k];\r\n        for (var k in proto_obj) post[k] = proto_obj[k];\r\n\r\n//        if (th.parse_funcs.posts_full) th.parse_funcs.posts_full(th);\r\n        if (post.parse_funcs.filename) post.filename = post.parse_funcs.filename(post);\r\n//        if (th.parse_funcs.prep_mimic) th.parse_funcs.prep_mimic(th);\r\n\r\n        var dummy = post.time; // invoke getter\r\n        dummy = post.sub;\r\n        dummy = post.com;\r\n        dummy = post.name;\r\n        dummy = post.no;\r\n        dummy = post.op_img_url;\r\n        post.type_data = th.type_data;\r\n//      }\r\n      return post;\r\n    },\r\n    backlink: function(pn,thq_no){\r\n      var backlinks = (thq_no)? ((Array.isArray(thq_no))? thq_no : thq_no.backlinks) : null;\r\n      if (backlinks) this.add_backlinks(pn,backlinks);\r\n    },\r\n\r\n    popups_debug: function(kwd, thq){\r\n      var d_str = '';\r\n      for (var i in thq) d_str += i+':'+((Array.isArray(thq[i]))? thq[i] : (thq[i].backlinks || thq[i].remove_if_no_backlinks))+', ';\r\n      console.log(kwd+d_str);\r\n    },\r\n    toplevel_anchor: function(th, th_no){\r\n      var as = th.pn.getElementsByTagName('a');\r\n      for (var i=0;i<as.length;i++) {\r\n        var href = as[i].getAttribute('href');\r\n        if (href && href[0]==='#') as[i].setAttribute('href',this.link_dbtp2href([th.domain, th.board, th_no, href.substr(1), 'href']));\r\n      }\r\n    },\r\n\r\n    wrap_to_parse: (function(){\r\n      var th_regexp = /[A-z]/;\r\n//      var parse_objs = {};\r\n      var key_table = { // to reduce memory consumption.\r\n        catalog: 'c',\r\n        page:    'i',\r\n        thread:  't',\r\n        post:    'p',\r\n        html:    'h',\r\n        json:    'j',\r\n      };\r\n      function get_getters(){\r\n//        if (pref.test_mode['6']) return site4.parse_funcs_no_cache; // no cache parse to reduce memory consumption.\r\n//        if (pref.test_mode['6']) return site4.parse_funcs_one_time; // one time parse for faster execution.\r\n        return (pref.debug_mode.parse_error)? site4.parse_funcs_on_demand_debug : site4.parse_funcs_on_demand;\r\n      }\r\n      function prep_pfunc(domain, board, type){\r\n//        var key = domain+board+type +'/'+pref.test_mode['6']+pref.debug_mode.parse_error;\r\n//        var key = domain+board+type;\r\n//        var parse_obj = parse_objs[key];\r\n        var type_source = type.substr(0,type.indexOf('_'));\r\n        var type_data   = type.substr(type.indexOf('_')+1);\r\n        var key = key_table[type_source] + key_table[type_data] + ((pref.debug_mode.parse_error)? '_debug':'');\r\n        var pfunc = liveTag.mems.init({domain:domain, board:board}).p[key];\r\n        if (!pfunc) {\r\n          var pfunc_root = liveTag.mems[domain].p;\r\n          var pfunc = pfunc_root[key];\r\n          if (!pfunc) {\r\n            var proto = site2[domain].parse_funcs[type+'_template'] || get_getters();\r\n            pfunc_root[key] = {domain: domain,\r\n                       parse_funcs: site2[domain].parse_funcs[type],\r\n                       parse_funcs_html: site2[domain].parse_funcs[type_source+'_html'],\r\n                       type_parse: type,\r\n                       type_source: type_source,\r\n                       type_data: type_data,\r\n                       type_html: type_source,\r\n                       domain_html: (site2[domain].mimic_always || pref.catalog.mimic_base_site)? site.nickname : domain,\r\n//                       thread: null, // for faster execution.\r\n//                       page_no: null,\r\n//                       __proto__:site4.parse_funcs_on_demand\r\n                       __proto__:proto\r\n                              };\r\n            pfunc = pfunc_root[key];\r\n////            var template = site2[domain].parse_funcs[type+'_template'];\r\n////            if (template) {\r\n////////              var keys = Object.keys(template);\r\n////////              for (var i=0;i<keys.length;i++) Object.defineProperty(pfunc, keys[i], {value:template[keys[i]], enumerable:true, configurable:true, writable:true});\r\n//////              for (var i in template) Object.defineProperty(pfunc, i, {value:template[i], enumerable:true, configurable:true, writable:true}); // search in prototype, overwrite getters\r\n////              for (var i in template) // search in prototype, overwrite getters\r\n////                if (typeof(template[i])==='function') Object.defineProperty(pfunc, i, {get:template[i], enumerable:true, configurable:true});\r\n////                else Object.defineProperty(pfunc, i, {value:template[i], enumerable:true, configurable:true, writable:true});\r\n////            }\r\n          }\r\n          liveTag.mems[domain][board].p[key] = {\r\n            board: board,\r\n            __proto__: pfunc\r\n          };\r\n          pfunc = liveTag.mems[domain][board].p[key];\r\n        }\r\n        return pfunc;\r\n      }\r\n      return {\r\n        get_getters: get_getters,\r\n        get: function(doc_obj, domain, board, type, options){\r\n          var parse_obj = prep_pfunc(domain, board, type);\r\n          if (options) {\r\n            if (options.thread!==undefined && th_regexp.test(options.thread)) options.thread = options.thread.substr(1);\r\n            options.__proto__ = parse_obj;\r\n            parse_obj = options;\r\n          }\r\n//          if (options) {  // working code.\r\n//            if (options.thread) parse_obj.thread = (th_regexp.test(options.thread))? options.thread.substr(1): options.thread;\r\n//            if (options.page) parse_obj.page = options.page;\r\n//          }\r\n          return (type.indexOf('_json')==-1)? site2[domain].parse_funcs[type].ths({pn:doc_obj, __proto__:parse_obj}) : \r\n                                              site2[domain].parse_funcs[type].ths(doc_obj, parse_obj);\r\n        },\r\n////        clean: function(boards){\r\n////          var keys = Object.keys(parse_objs);\r\n////          for (var i=0;i<keys.length;i++) {\r\n////            var key_split = keys[i].split('/');\r\n////            if (boards[key_split[0]+key_split[1]]===undefined) parse_objs[keys[i]] = null;\r\n////          }\r\n////        }\r\n        posts: function(th){\r\n          var proto_obj = prep_pfunc(th.domain, th.board, 'post_'+th.type_data);\r\n          if (th.localArchive) proto_obj = {localArchive:th.localArchive, __proto__:proto_obj};\r\n//          var proto_obj = {domain:th.domain, board:th.board, domain_html:th.domain_html, parse_funcs:th.parse_funcs};\r\n          if (th.posts) for (var i=0;i<th.posts.length;i++) {\r\n            if (th.posts[i].extra_files) for (var j=0;j<th.posts[i].extra_files.length;j++)\r\n              if (!th.posts[i].extra_files.domain) th.posts[i].extra_files[j].__proto__ = proto_obj;\r\n           if (!th.posts[i].domain) th.posts[i].__proto__ = proto_obj;\r\n          }\r\n         if (th.extra_files) for (var j=0;j<th.extra_files.length;j++) if (!th.extra_files[j].domain) th.extra_files[j].__proto__ = proto_obj;\r\n////      if (th.posts) for (var i=0;i<th.posts.length;i++) {\r\n////        if (th.posts[i].extra_files) for (var j=0;j<th.posts[i].extra_files.length;j++) th.posts[i].extra_files[j].__proto__ = th.__proto__;\r\n////        th.posts[i].__proto__ = th.__proto__;\r\n////      }\r\n////      if (th.extra_files) for (var j=0;j<th.extra_files.length;j++) th.extra_files[j].__proto__ = th.__proto__;\r\n        },\r\n      }\r\n    })(),\r\n    parse_pn_dummy: document.createElement('div'),\r\n    parse_funcs: { // DEFAULT\r\n      'common': {\r\n////        entry : function(dtpo,req) { // doc, thread, post, object // working code.\r\n////          for (var i=0;i<req.length;i++) {\r\n////            if (req[i]===':ITER') {\r\n////              if (req[i+1]===':ALL') for (var j=0;j<dtpo[req[i+2]].length;j++) this.exe_sub(dtpo,req,i,j);\r\n////              else if (req[i+1]===':FL') {\r\n////                this.exe_sub(dtpo,req,i,0);\r\n////                this.exe_sub(dtpo,req,i,dtpo[req[i+2]].length-1);\r\n////              } else if (req[i+1]===':FLx' || req[i+1]===':GFLx' || req[i+1]===':GALL') {\r\n////                var j = dtpo[req[i+2]].length - pref[cataLog.embed_mode].t2h_num_of_posts;\r\n////                if (j<1 || req[i+1]===':GALL') j=1;\r\n////                if (req[i+1]===':FLx') {\r\n////                  this.exe_sub(dtpo,req,i,0);\r\n////                  while (j<dtpo[req[i+2]].length) this.exe_sub(dtpo,req,i,j++);\r\n////                } else {\r\n////  //                dtpo[req[i+3][0]] = [];\r\n////                  Object.defineProperty(dtpo,req[i+3][0], {value:[], enumerable:true, configurable:true, writable:true});\r\n////                  dtpo[req[i+3][0]].push(dtpo[req[i+2]][0][req[i+3][1]]);\r\n////                  while (j<dtpo[req[i+2]].length) dtpo[req[i+3][0]].push(dtpo[req[i+2]][j++][req[i+3][1]]);\r\n////                  for (var j=dtpo[req[i+3][0]].length-1;j>=0;j--) if (!dtpo[req[i+3][0]][j]) dtpo[req[i+3][0]].splice(j,1);\r\n////                }\r\n////              }\r\n////              i += 3;\r\n////  //          } else dtpo[req[i]] = this[req[i]](dtpo,req);\r\n////            } else Object.defineProperty(dtpo,req[i], {value:this[req[i]](dtpo,req), enumerable:true, configurable:true, writable:true});\r\n////          }\r\n////        },\r\n////        exe_sub : function(dtpo,req,i,j) {\r\n////          dtpo[req[i+2]][j].domain = dtpo.domain;\r\n////          dtpo[req[i+2]][j].board  = dtpo.board;\r\n////          this.entry(dtpo[req[i+2]][j],req[i+3]);\r\n////        },\r\n        finisher : function(){return;},\r\n        posts: function(){return undefined;},\r\n        com: function(){return undefined;},\r\n        flags: function(){return undefined;},\r\n        flag: function(){return undefined;},\r\n//        op_img_url: function() {return undefined;},\r\n//        preventDefault:function(e){e.preventDefault();},\r\n        th_init: null,\r\n//        th_destroy: null,\r\n        tn_as: function(th){return th.pn.getElementsByTagName('a');},\r\n        tn_imgs: function(th){\r\n          var imgs = [];\r\n//          for (var i=0;i<as.length;i++) imgs[i] = as[i].getElementsByTagName('img')[0];\r\n          var as = th.pn.getElementsByTagName('a');\r\n          for (var i=0;i<as.length;i++) {\r\n            var tmp = as[i].getElementsByTagName('img')[0];\r\n            if (tmp) imgs[imgs.length] = tmp;\r\n          }\r\n          return imgs;\r\n        },\r\n        key: function(th){return th.domain + th.board + th.no;},\r\n        pn: function(th){return site2[th.domain_html].catalog_json2html3(th,th.board, this.op_img_url(th));},\r\n        op_img_url: function(th) {return site2[th.domain].catalog_json2html3_thumbnail(th, th.board);},\r\n        get_op_src: function(th) {return th.op_img_url;},\r\n        ths_array: function(doc,ths_col){\r\n          var ths = [];\r\n          if (ths_col)\r\n            for (var i=ths_col.length-1;i>=0;i--) {\r\n              var page = (doc.type_html==='catalog')? Math.floor(i/15)+'.'+i%15\r\n                                                    : (doc.type_html==='page')? doc.page + '.' + i : undefined; // page_html\r\n              ths[i] = {\r\n                pn: ths_col[i],\r\n                page: page,\r\n                __proto__: doc.__proto__};\r\n            }\r\n          return ths;\r\n        },\r\n        time: function(th){return undefined;},\r\n        time_posted : function(th){return undefined;},\r\n        time_unit: 1,\r\n        has_posts: true,\r\n//        last_replies: function(th){return th.posts.slice(1);},\r\n////        post_no: function(post){return post.no;},\r\n        txt: function(th){\r\n          site2['DEFAULT'].parse_pn_dummy.innerHTML = th.com;\r\n          return site2['DEFAULT'].parse_pn_dummy[brwsr.innerText];\r\n        },\r\n        type_com: 'html',\r\n        footer_clear: function(th){},\r\n//        adopt_pn: function(th){\r\n////          for (var i=0;i<th.posts.length;i++) Object.defineProperty(th.posts[i], 'pn', {value:document.adoptNode(th.posts[i].pn), enumerable:true, configurable:true, writable:true});\r\n//          Object.defineProperty(th, 'pn', {value:document.adoptNode(th.pn), enumerable:true, configurable:true, writable:true});\r\n//        },\r\n        get_lth_from_node: function(pn){\r\n          while (pn && !pn.name) pn = pn.parentNode;\r\n          return pn && liveTag.mems.getFromName(pn.name) || null;\r\n        },\r\n//        txt2com: function(txt){return txt;},\r\n      },    \r\n      'catalog_html': {\r\n        posts: function(th){return [{sub:th.sub, com:th.com, name:th.name, pn:th.pn}];},\r\n        time: function(th){return th.time_created;},\r\n        posts_full: (function(){\r\n          var exlist = {posts:null, pn:null, flag:null, flags:null, footer:null, pn_name:null, ths:null, page:null,\r\n                        tn_as:null, tn_imgs:null, txt:null,\r\n                        parse_funcs:null, parse_funcs_html:null, type_parse:null, type_source:null, type_data:null, type_html:null,\r\n                        domain:null, board:null, domain_html:null, exe_sub:null, exe_sub2:null};\r\n          return function(th){\r\n//            for (var prop in th) if (exlist[prop]===undefined) th.posts[0][prop] = th[prop]; // invoke getters.\r\n            for (var prop in th) if (exlist[prop]===undefined)\r\n              if (th.parse_funcs[prop]) Object.defineProperty(th.posts[0], prop, {value:th[prop], enumerable:true, configurable:true, writable:true}); // invoke getters to cut reference to pn(whole html), and also set th[prop].\r\n          };\r\n        })(),\r\n        has_posts: false,\r\n        type_com: 'txt',\r\n        filename: function(th){\r\n          var fname = th.op_img_url.replace(/.*\\//,'');\r\n          var idx = fname.indexOf('.');\r\n          th.tim = fname.substr(0,idx);\r\n//          th.ext = fname.substr(  idx);\r\n          return th.tim;\r\n        },\r\n      },\r\n      'catalog_json': {\r\n        ths: function(obj, parse_obj) {\r\n          var ths = [];\r\n          for (var i=0;i<obj.length;i++)\r\n            if (obj[i].threads) for (var j=0;j<obj[i].threads.length;j++) {\r\n              obj[i].threads[j].page = i + '.' + j;\r\n              obj[i].threads[j].sticky = obj[i].threads[j].sticky===1; // overwrite property of the same name before setting prototype to use polarity.\r\n              obj[i].threads[j].type_html = 'catalog';\r\n              obj[i].threads[j].__proto__ = parse_obj;\r\n              ths[ths.length] = obj[i].threads[j];\r\n            }\r\n          return ths;\r\n        },\r\n//        posts: function(th){return [{sub:th.sub, com:th.com, name:th.name, trip:th.trip, pn:th.pn, time:th.time_created}];}, // time for post_json2html\r\n//        posts: function(th){return [{sub:th.sub, com:th.com, name:th.name, time:th.time}];}, // this is used at scan, so the lighter is the best. 'time' is only for 'check_reply' and 'stats'. And this removes prototype chain to reduce memory consumption instead of using '[{__proto__:th}]'.\r\n        posts: function(th){return [{time:th.time, DUMMY:true}];}, // 'time' is for 'check_reply' and 'stats'. And this removes prototype chain to reduce memory consumption instead of using '[{__proto__:th}]'.\r\n        posts_full: function(th){\r\n//          th.posts[0] = {}; // BUG NEVER DO THIS. posts_full is called AFTER SETTING PROTOTYPE in wrap_to_parse.posts in format_html.prepafe_html_prep_posts\r\n            delete th.posts[0].DUMMY;\r\n////          th.posts[0].no = th.no; // works\r\n////          th.posts[0].time = th.time;\r\n          var keys = Object.keys(th);\r\n//          var exlist = ['obj','posts'];\r\n//          for (var i=0;i<keys.length;i++) if (exlist.indexOf(prop)==-1) th.posts[0][keys[i]] = th[keys[i]]; // remove props in prototype chain. // will be this.\r\n          for (var i=0;i<keys.length;i++) if (keys[i]!=='posts' && keys[i]!=='pn') th.posts[0][keys[i]] = th[keys[i]]; // remove props in prototype chain.\r\n        },\r\n        has_posts: false,\r\n      },\r\n//      'catalog_html': {\r\n//        ths_array: function(doc,ths_col){ // working code.\r\n//          var ths = [];\r\n//          if (ths_col)\r\n////            if (site.nickname!==doc.domain) site2[doc.domain].absolute_link(doc.pn, doc.board);\r\n//            for (var i=ths_col.length-1;i>=0;i--) {\r\n//              var page = Math.floor(i/15)+'.'+i%15;\r\n//              ths[i] = {\r\n//                pn: ths_col[i],\r\n//                type_html: 'catalog_html',\r\n////                page: Math.floor(i/15)+'.'+i%15, // cause warning of 'Object literal with complex property' in V8.\r\n//                page: page,\r\n//                __proto__: doc.__proto__};\r\n//            }\r\n//          return ths;\r\n//        },\r\n//      },\r\n      'page_html': {\r\n//        ths_array: function(doc,ths_col){ // working code.\r\n//          var ths = [];\r\n//          if (ths_col)\r\n////            if (site.nickname!==doc.domain) site2[doc.domain].absolute_link(doc.pn, doc.board);\r\n//            for (var i=ths_col.length-1;i>=0;i--) {\r\n//              var page = (doc.page!=='?')? doc.page + '.' + i : doc.page;\r\n//              ths[i] = {\r\n//                pn: ths_col[i],\r\n//                type_html: 'page_html',\r\n////                page: (doc.page!=='?')? doc.page + '.' + i : doc.page, // cause warning of 'Object literal with complex property' in V8.\r\n//                page: page,\r\n//                __proto__: doc.__proto__};\r\n//            }\r\n//          return ths;\r\n//        },\r\n        posts_array: function(th,posts){ // working code.\r\n          var pts = [];\r\n//          var proto_kwd = 'post_' + th.type_data; // working code, WILL BE THIS.\r\n//          var proto = (site2[th.domain].parse_funcs.hasOwnProperty(proto_kwd))? site2[th.domain].parse_funcs[proto_kwd] : th.__proto__; \r\n          var proto = th.__proto__; \r\nif (!pref.test_mode['5']) { // faster, because object creation is light,,,orz,,,\r\n          for (var i=0;i<posts.length;i++) pts[pts.length] = {pn:posts[i], __proto__:proto};\r\n} else {\r\n          pts.pns = posts;\r\n          pts.idx0 = 0;\r\n          pts.idx1 = posts.length-1;\r\n          pts.get0 = this.posts_get0;\r\n          pts.get1 = this.posts_get1;\r\n          pts.proto = proto;\r\n//          var pts = {pn:posts, idx0:0, idx1:posts.length-1, length:posts.length, __proto__:proto};\r\n          Object.defineProperty(pts, pts.idx0, {get: pts.get0, enumerable:true, configurable:true});\r\n          Object.defineProperty(pts, pts.idx1, {get: pts.get1, enumerable:true, configurable:true});\r\n}\r\n          return pts;\r\n        },\r\n        posts_get0: function(){\r\n//console.log('get0: '+this.idx0);\r\n          var val = {pn:this.pns[this.idx0],  __proto__:this.proto}; // this.__proto__ reffers Array, doesn't work.\r\n          Object.defineProperty(this, this.idx0, {value: val, enumerable:true, configurable:true, writable:true});\r\n          if (++this.idx0<this.idx1) Object.defineProperty(this, this.idx0, {get: this.get0, enumerable:true, configurable:true});\r\n          return val;\r\n        },\r\n        posts_get1: function(){\r\n//console.log('get1: '+this.idx1);\r\n//console.log('this.pns: ');\r\n//console.log(this.pns);\r\n          var val = {pn:this.pns[this.idx1],  __proto__:this.proto};\r\n          Object.defineProperty(this, this.idx1, {value: val, enumerable:true, configurable:true, writable:true});\r\n          if (--this.idx1>this.idx0) Object.defineProperty(this, this.idx1, {get: this.get1, enumerable:true, configurable:true});\r\n          return val;\r\n        },\r\n//        posts_array: function(th,posts){ // working code.\r\n//          var pts = [];\r\n//          for (var i=0;i<posts.length;i++) pts[pts.length] = {pn:posts[i], __proto__:th.__proto__};\r\n//          return pts;\r\n//        },\r\n        posts: function(th){return this.posts_array(th, th.pn.getElementsByClassName('post'));},\r\n////////        posts_pn: function(th){return th.pn.getElementsByClassName('post');},\r\n        time_posted: 'thread_html',\r\n        time_bumped: function(th){ // TO BE FIXED.\r\n          return th.posts[th.posts.length-1].time;\r\n        },\r\n        time_created: function(th){return th.posts[0].time;},\r\n        key: function(th){return th.domain + th.board + th.no;},\r\n        insert_footer4: function(ref){\r\n          var footer = document.createElement('div');\r\n          return ref.parentNode.insertBefore(footer,ref);\r\n        },\r\n        flags: function(th){ // for on demand access.\r\n          var flags = [];\r\n          var i = th.posts.length -1;\r\n          var n = pref[cataLog.embed_mode].t2h_num_of_posts -1;\r\n          if (i<n) { // POSTS MUST BE ACCESSED FROM HEAD OR TAIL.\r\n            n=0;\r\n            while (n<=i) {\r\n//console.log('up: '+n+', '+i);\r\n              if (th.posts[n]) flags[n] = th.posts[n].flag; // 8chan doesn't show 5 posts all the time.\r\n              n++;\r\n            }\r\n          } else {\r\n            while (n>=0) {\r\n//console.log('down: '+n+', '+i);\r\n//console.log(th.posts[i]);\r\n              if (th.posts[i]) flags[n--] = th.posts[i--].flag;\r\n              if (n==0) i=0;\r\n            }\r\n          }\r\n          return flags;\r\n        },\r\n////        flags: function(th){ // for on demand access. // worked code, but post was changed to had to be accessed from top or end.\r\n////          var flags = [];\r\n////          var i = th.posts.length - pref.catalog_t2h_num_of_posts;\r\n////          if (i<1) i=1;\r\n////          if (th.posts.length!=0) flags[0] = th.posts[0].flag;\r\n////          while (i<th.posts.length) {\r\n////            if (th.posts[i]) flags[i] = th.posts[i].flag;\r\n////            i++;\r\n////          }\r\n////          return flags;\r\n////        },\r\n        html_org: function(th){return th.pn.innerHTML;},\r\n        sticky: function(){return false;},\r\n////        pop_post_prep: function(th){ // working code.\r\n////          th.children = th.pn.childNodes;\r\n////          th.idx_pop = th.pn.childNodes.length-1;\r\n////        },\r\n        type_com: 'txt',\r\n        replace_omitted_info : function(dst, src){dst.textContent = src.textContent;},\r\n        replace_omitted_info2: 'replace_omitted_info',\r\n        posts_full: 'catalog_html',\r\n        get_max_page: function(doc){\r\n          var pns = doc.getElementsByClassName('pages')[0];\r\n          if (!pns) return;\r\n          pns = pns.childNodes;\r\n          var max = 0;\r\n          for (var i=0;i<pns.length;i++) if (max+1 == pns[i].textContent) max++; // == used intentionally.\r\n          return max;\r\n        },\r\n      },\r\n      'page_json': {\r\n        ths: function(obj, parse_obj){\r\n          var ths = [];\r\n          if (obj && obj.threads) for (var i=0;i<obj.threads.length;i++) { // patch for 8chan\r\n//          for (var i=0;i<obj.threads.length;i++) {\r\n            var tgt = obj.threads[i];\r\n            if (tgt) { // patch for 8chan\r\n              tgt.page = (parse_obj.page)? parse_obj.page + '.' + i : undefined;\r\n              tgt.key = parse_obj.domain + parse_obj.board + tgt.posts[0].no;\r\n              tgt.posts[0].__proto__ = parse_obj;\r\n              tgt.__proto__ = tgt.posts[0];\r\n              ths[i] = tgt;\r\n            }\r\n////            if (tgt) { // patch for 8chan // working code.\r\n////              ths[i] = {obj: tgt, // buffered, because if obj is used, change of obj's contents will affect to this program directly.\r\n////                        posts: tgt.posts, ext: tgt.posts[0].ext, tim:tgt.posts[0].tim,\r\n////                        time: tgt.posts[0].time, // for 'check_reply.check_t1_op'\r\n////                        key: parse_obj.domain + parse_obj.board + tgt.posts[0].no, no: tgt.posts[0].no,\r\n////                        page: (parse_obj.page)? parse_obj.page + '.' + i : undefined,\r\n////                        __proto__:parse_obj};\r\n////            }\r\n////            tgt.posts = null; // cut the reference, if leave this, cutting th.posts.length in 'update_posts_replace_prep' doesn't affect to tgt.posts and tgt.posts keep containing all posts.\r\n          }\r\n          return ths;\r\n        },\r\n      },\r\n      'thread_html'  : {\r\n        ths_array: function(doc, ths_col){\r\n          return [{pn:ths_col,\r\n//                   type_html: 'thread_html',\r\n                   page: '?',\r\n                   __proto__: doc.__proto__}];\r\n        },\r\n        time_posted : function(th){return th.posts[th.posts.length-1].time;},\r\n        posts_full: 'catalog_html',\r\n        type_com: 'txt',\r\n      },\r\n      'thread_json'  : {\r\n        ths: function(obj, parse_obj){\r\n          obj.key = parse_obj.domain + parse_obj.board + obj.posts[0].no;\r\n          obj.posts[0].__proto__ = parse_obj;\r\n          obj.__proto__ = obj.posts[0];\r\n          return [obj];\r\n        },\r\n//        ths: function(obj, parse_obj){return site2['DEFAULT'].parse_funcs.page_json.ths({threads:[obj]}, parse_obj);}, // working code.\r\n////        ths: function(obj, parse_obj){\r\n////          return [{obj:obj, posts: obj.posts, ext: obj.posts[0].ext, tim:obj.posts[0].tim,\r\n////                   key: parse_obj.domain + parse_obj.board + parse_obj.thread, no: parse_obj.thread, __proto__:parse_obj}];\r\n////        },\r\n\r\n////        pop_post_prep: function(obj){ // working code.\r\n////          obj.idx_pop = obj.posts.length-1;\r\n////        },\r\n////        pop_post: function(obj){\r\n////          if (obj.idx_pop>=0) {\r\n////            obj.post = obj.posts[obj.idx_pop--];\r\n//////            obj.post.parse_funcs = this;\r\n//////            obj.post.__proto__ = obj.__proto__;\r\n////            obj.post.time *= 1000; // DESTRUCTIVE\r\n////            return true;\r\n////          } else return false;\r\n////        },\r\n////        preprocess: function(obj){ // working code, but deleted.\r\n////          if (!obj.preprocessed) {\r\n////            obj.preprocessed = true;\r\n////            for (var i=obj.posts.length-1;i>=0;i--) obj.posts[i].time *= 1000;\r\n////          }\r\n////        },\r\n////        time_created : function(obj){return obj.posts[0].time;}, // preprocessed\r\n////        time_bumped : function(obj){return obj.posts[obj.posts.length-1].time;}, // preprocessed\r\n        time_created : function(obj){return obj.posts[0].time*1000;},\r\n        time_bumped : function(obj){\r\n          var i = obj.posts.length-1;\r\n          while (i>0 && obj.posts[i].email && obj.posts[i].email==='sage') i--;\r\n          return obj.posts[i].time*1000;\r\n        },\r\n        time_posted : function(obj){return obj.posts[obj.posts.length-1].time*1000;},\r\n        nof_posts: function(obj){return obj.posts[0].replies+1;},\r\n        nof_files: function(obj){return obj.posts[0].images+1;},\r\n        has_nof_files: true,\r\n        sub: function(obj){return (obj.posts[0].sub || '');},\r\n        name: function(obj){return (obj.posts[0].name || '');},\r\n        com: function(obj){return (obj.posts[0].com || '');},\r\n        sticky: function(obj){return obj.posts[0].sticky===1;},\r\n        time_unit: 1000,\r\n        prep_to_archive: function(obj){return {posts:obj};},\r\n//        proto: 'page_json'\r\n      },\r\n      'post_html': {\r\n        sub: function(post){\r\n          var sub = post.pn.getElementsByClassName('subject')[0];\r\n          return (sub)? sub.textContent : '';\r\n        },\r\n        img2src: function(img){return img.parentNode.href;},\r\n        img2ext: function(img){return img.parentNode.getAttribute('data-ext');},\r\n      },\r\n      'post_json': {\r\n        time_unit: 1000,\r\n        pn: function(post){return site2[post.domain_html].post_json2html(post,post.board);}, // blocked by template\r\n      },\r\n      'catalog_json_template': 'post_json_template',\r\n      'page_json_template': 'post_json_template',\r\n      'thread_json_template': 'post_json_template',\r\n      'post_json_template': {\r\n        sub: '',\r\n        name: 'Anonymous',\r\n        com: '',\r\n        sticky: undefined,\r\n        pn: undefined, // block getter\r\n        no: undefined, // patch\r\n        time: undefined, // patch\r\n      },\r\n    },\r\n//    parse_funcs : function(dtp,req) { // doc, thread, post, use .call() to call with 'this'.\r\n//      for (var i=0;i<req.length;i++) {\r\n//        if (this[req[i]]) dtp[req[i]] = this[req[i]](dtp,req);\r\n//        if (req[i]==='ths') i++;\r\n//      }\r\n//    },\r\n    parse_parts:{\r\n      add_op_img_url: function(posts,board,domain){\r\n         for (var i=0;i<posts.length;i++)\r\n          posts[i].op_img_url = site2[domain].catalog_json2html3_thumbnail(posts[i], board);\r\n      },\r\n    },\r\n////    update_posts_replace: function(th,th_old,pnode) { // working code.\r\n////      if (th_old.posts) {\r\n////        th_old.posts[0].pn.innerHTML = th.posts[0].pn.innerHTML;\r\n////        for (var i=th_old.posts.length-1;i>=1;i--) this.update_posts_remove(th_old,i,pnode);\r\n////      }\r\n////      th_old.posts = [th_old.posts[0]];\r\n////      this.update_posts_add(th,th_old,pnode);\r\n////    },\r\n    update_posts_merge_prep: function(posts, posts_m, num, by_no) { // merge posts by time\r\n      if (posts) {\r\n        num = (num>=0)? num+1 : ((posts_m && posts_m.length)? posts_m.length : 0) + posts.length;\r\n        if (num<posts.length) posts = posts.slice(0,1).concat(posts.slice(posts.length - num + 1)); // cut\r\n        var i=1;\r\n        var j=0;\r\n        var posts_ret = [posts[0]];\r\n        if (by_no) // by no.\r\n          while (i<posts.length && j<posts_m.length) {\r\n            if (posts[i].no === posts_m[j].no) {posts_ret[posts_ret.length] = posts[i++]; j++; continue;}\r\n            posts_ret[posts_ret.length] = (posts[i].no < posts_m[j].no)? posts[i++] : posts_m[j++];\r\n          }\r\n        else\r\n          while (i<posts.length && j<posts_m.length)\r\n            posts_ret[posts_ret.length] = (posts[i].time * posts[i].parse_funcs.time_unit < posts_m[j].time * posts_m[j].parse_funcs.time_unit)? posts[i++] : posts_m[j++];;\r\n        posts_ret = posts_ret.concat((i<posts.length)? posts.slice(i) : posts_m.slice(j));\r\n        return (posts_ret.length<=num)? posts_ret :\r\n                                        posts_ret.slice(0,1).concat(posts_ret.slice(posts_ret.length-num+1,posts_ret.length));\r\n      }\r\n    },\r\n    update_posts_merge_base: null,\r\n    update_posts_replace_prep: function(posts,posts_old,num) { // concate posts by no. existence of posts_old was checked in caller.\r\n      if (!posts || posts.length<=1) return posts_old;\r\n      num = (num>=0)? num+1 : posts_old.length + posts.length -1;\r\n      if (num==posts.length) return posts;\r\n      if (num< posts.length) return posts.slice(0,1).concat(posts.slice(posts.length - num + 1)); // cut\r\n      var first_no = posts[1].no;\r\n      var i=1;\r\n      while (i<posts_old.length && posts_old[i].no<first_no) i++;\r\n      if (i===1) return posts;\r\n      var start = (i>num-posts.length)? i-(num-posts.length) : 1;\r\n      return posts.slice(0,1).concat(posts_old.slice(start,i),posts.slice(1));\r\n    },\r\n    update_posts0_class: function(pn,search_result) {\r\n      if (search_result) pn.classList.remove('CatChan_search_miss');\r\n      else               pn.classList.add('CatChan_search_miss');\r\n    },\r\n    update_posts_replace: function(th,th_old,pnode,merge,show) {\r\n      if (th_old.posts) {\r\n        var info_old = th_old.parse_funcs_html.get_omitted_info(th_old.posts[0]);\r\n        var info_new = (th.posts[0].pn)? th.parse_funcs_html.get_omitted_info(th.posts[0]) : site2[th.domain_html].page_json2html3_add_omitted_info(th,null,th.posts);\r\n        if (info_old) {\r\n//          if (info_new) th_old.parse_funcs_html.replace_omitted_info(info_old, info_new);\r\n//          else info_old.parentNode.removeChild(info_old);\r\n          th_old.parse_funcs_html.replace_omitted_info2(info_old, info_new, th);\r\n        } else if (info_new) th_old.parse_funcs_html.set_omitted_info(th_old.posts[0], info_new);\r\n////        var nos = {}; // working code.\r\n////        for (var i=1;i<th.posts.length;i++) nos[th.posts[i].no] = null;\r\n////        for (var i=th_old.posts.length-1;i>=1;i--) \r\n////          if (nos[th_old.posts[i].no]===undefined) {\r\n////            this.update_posts_remove(th_old,i,pnode);\r\n////            th_old.posts.splice(i,1);\r\n////          }\r\n        var j = th.posts.length-1;\r\n//        var scroll_back = 0;\r\n//        var now_height = (scroll_lock)? brwsr.document_body.scrollTop : 0; // WILL BE CHANGED TO get_now_height for multi inscance\r\n        for (var i=th_old.posts.length-1;i>=1;i--) {\r\n          while (j>1 && th.posts[j].no>th_old.posts[i].no) j--;\r\n          if (th.posts[j].no!=th_old.posts[i].no) {\r\n            if (pref[cataLog.embed_mode].scroll_lock) cataLog.show_catalog_scroll_lock.modified(th_old.posts[i]);\r\n            if (!merge || show) if (th_old.posts[i].pn) this.update_posts_remove(th_old,i,pnode);\r\n//            scroll_back += this.update_posts_remove(th_old,i,pnode,now_height); // SLOW.\r\n            th_old.posts.splice(i,1);\r\n          } else if (th_old.posts[i].editing && (!merge || show) && (th_old.posts[i].pn)) {\r\n            var thq = liveTag.mems[th.domain][th.board][th.no].q;\r\n            cataLog.format_html.prepare_html_post(th, th.posts[j]);\r\n            this.popups_add_1(th, th.posts[j], true, thq, j===0, true);\r\n            if (pref[cataLog.embed_mode].backlink) if (thq[th.posts[j].no].backlinks) site2[th.domain_html].add_backlinks(th.posts[j].pn,thq[th.posts[j].no].backlinks, undefined, th);\r\n            th_old.posts[i].pn.parentNode.insertBefore(th.posts[j].pn,th_old.posts[i].pn);\r\n            th_old.posts[i].pn.parentNode.removeChild(th_old.posts[i].pn);\r\n            th_old.posts[i] = th.posts[j];\r\n          }\r\n        }\r\n//        if (scroll_back) window.scrollTo(0,now_height + scroll_back);\r\n      }\r\n      this.update_posts_add(th,th_old,pnode,merge,show);\r\n    },\r\n    update_posts_add: function(th,th_old,pnode,merge,show) {\r\n      if (th_old.posts && th.posts) {\r\n        var thq = liveTag.mems[th.domain][th.board][th.no].q;\r\n        var time_unit = (merge)? th.parse_funcs.time_unit : 1; // (merge)? for safety.\r\n//        var first_no = th_old.posts[1].no; // working, but not verified enough.\r\n//        if (th.posts[1].no<first_no) {\r\n//          var end=1;\r\n//          while (end+1<th.posts.length && th.posts[end+1].no<first_no) end++;\r\n//          var i=end;\r\n//          while (i>=1) {\r\n//            this.update_posts_1(th,th_old,pnode,merge, i, 1, time_unit, thq); // inset before\r\n//            th_old.posts.splice(1,0,th.posts[i--]);\r\n//          }\r\n//          if (merge && show) this.update_posts_insert_merge(th.posts.splice(0,end+1),1);\r\n//        }\r\n//        var th_old_posts_length = th_old.posts.length;\r\n//        for (var i=th_old_posts_length;i<th.posts.length;i++) {\r\n//          this.update_posts_1(th,th_old,pnode,merge, i, th_old.posts.length, time_unit, thq); // th_old.posts.length is live count, always add to end. // add after\r\n//          th_old.posts[th_old.posts.length] = th.posts[i];\r\n//        }\r\n//        if (th.posts.length>1 && merge && show) this.update_posts_insert_merge(th.posts,th_old_posts_length);\r\n\r\n        var j=1; // for filter output, random insert.\r\n        for (var i=1;i<th.posts.length;i++) {\r\n          while (j<th_old.posts.length && th.posts[i].no>th_old.posts[j].no) j++;\r\n          if (j>=th_old.posts.length || th.posts[i].no!=th_old.posts[j].no) {\r\n            cataLog.format_html.prepare_html_post(th, th.posts[i]);\r\n            this.update_posts_1(th,th_old,pnode,merge, i, j, time_unit, thq); // th_old.posts.length is live count.\r\n            if (j<th_old.posts.length) th_old.posts.splice(j,0,th.posts[i]); // live array\r\n            else th_old.posts[th_old.posts.length] = th.posts[i];\r\n          }\r\n          if (j<th_old.posts.length) j++;\r\n        }\r\n        if (th.posts.length>1 && merge && show) this.update_posts_insert_merge(th.posts,0, th_old.posts[0].pn);\r\n      }\r\n    },\r\n    update_posts_1: function(th,th_old,pnode,merge, tgt, pos, time_unit, thq) {\r\n      if (!merge) this.update_posts_insert(th.posts,th_old.posts,tgt,pos,pnode,merge); // th_old.posts.length is live count, always add to end.\r\n//      this.format_pn(th.posts[tgt].pn, th_old.q[th.posts[tgt].no]); // WILL BE THIS.\r\n//      if (time_unit!==1) th.posts[tgt].time *= time_unit; // BUG!!!, THIS DOESN'T ALLOW MULTIPLE ENTRY, CAN'T BE USED FOR POSTS SEARCH.\r\n    },\r\n////    update_posts_add: function(th,th_old,pnode,merge,show) { // working code.\r\n////      if (th_old.posts && th.posts) {\r\n////        var thq = liveTag.mems[th.domain][th.board][th.no].q;\r\n////        var last_no = th_old.posts[th_old.posts.length-1].no;\r\n////        if (th.posts[th.posts.length-1].no==last_no || th.posts.length<=1) return;\r\n////        //        var i=1;\r\n////        //        while (i<th.posts.length && th.posts[i].no<=last_no) i++;\r\n////        var i=th.posts.length;\r\n////        while (i>1 && th.posts[i-1].no>last_no) i--;\r\n////        if (i>1) th.posts.splice(1,i-1);\r\n////        if (pref[cataLog.embed_mode].t2h_num_of_posts>=0 && th.posts.length > pref[cataLog.embed_mode].t2h_num_of_posts+1) {\r\n////          th.posts.splice(1,th.posts.length - pref[cataLog.embed_mode].t2h_num_of_posts -1);\r\n////          this.page_json2html3_add_omitted_info(th, th_old.posts, th.posts);\r\n////        }\r\n////        var time_unit = (merge)? th.parse_funcs.time_unit : 1; // (merge)? for safety.\r\n////        for (var i=1;i<th.posts.length;i++) {\r\n////          if (!merge) this.update_posts_insert(th.posts,th_old.posts,i,th_old.posts.length,pnode,merge); // th_old.posts.length is live count, always add to end.\r\n////            this.format_pn(th.posts[i].pn, (thq)? thq[th.posts[i].no] : null);\r\n////          //          this.format_pn(th.posts[i].pn, th_old.q[th.posts[i].no]); // WILL BE THIS.\r\n////          if (time_unit!==1) th.posts[i].time *= time_unit;\r\n////          th_old.posts[th_old.posts.length] = th.posts[i];\r\n////        }\r\n////        if (th.posts.length>1 && merge && show) this.update_posts_insert_merge(th.posts,1);\r\n////      }\r\n////    },\r\n    update_posts_insert_merge: function(src,start, src0_pn) {\r\n      if (pref[cataLog.embed_mode].scroll_lock) cataLog.show_catalog_scroll_lock.set();\r\n      var i,j;\r\n      var myself = this.update_posts_prep_merge();\r\n      var dst = myself.posts;\r\n      var pnode = myself.pn;\r\n      src = src.slice();\r\n      src[0].pn = src0_pn; // patch for posts search\r\n      for (var i=src.length-1;i>=0;i--) // sort by timestamp only, so if there is, that is already sorted.\r\n        if (src[i].pn) {\r\n          var tgt = src[i].pn.parentNode;\r\n          while (tgt) {\r\n            if (tgt===pnode) {src.splice(i,1);break;} // if other sorting scheme is needed, change this to 'update_posts_remove'\r\n            else tgt = tgt.parentNode;\r\n          }\r\n        }\r\n      if (src.length===0) return;\r\n      if (start===0) {\r\n        i = start;\r\n        j = 0;\r\n        var step = dst.length & 0x7ffffff0;\r\n        while (i<src.length) {\r\n          if (step>1) while (j+step<dst.length && (dst[j+step].time_tu<src[i].time_tu || dst[j+step].time_tu==src[i].time_tu && dst[j+step].no<=src[i].no)) j += step+1;\r\n          while (j<dst.length && (dst[j].time_tu<src[i].time_tu || dst[j].time_tu==src[i].time_tu && dst[j].no<=src[i].no)) j++;\r\n          if (j<dst.length) site2[site.nickname].update_posts_insert(src, dst, i++, j, pnode);\r\n          else { // can't refer nodes after inserted one.\r\n            var k = src.length-1;\r\n            site2[site.nickname].update_posts_insert(src, dst, k--, j, pnode);\r\n            while (k>=i) {\r\n              site2[site.nickname].update_posts_insert(src, src, k, k+1, pnode); // can't refer nodes after inserted one.\r\n              k--;\r\n            }\r\n            break;\r\n          }\r\n        }\r\n      } else {\r\n        i = src.length-1;\r\n        j = dst.length;\r\n        while (i>=start) {\r\n          while (j>0 && (dst[j-1].time_tu>src[i].time_tu || dst[j-1].time_tu==src[i].time_tu && dst[j-1].no>src[i].no)) j--;\r\n          site2[site.nickname].update_posts_insert(src, dst, i--, j, pnode);\r\n          while (i>=start && !(j>0 && (dst[j-1].time_tu>src[i].time_tu || dst[j-1].time_tu==src[i].time_tu && dst[j-1].no>src[i].no))) { // dst is NOT updated. It's an object, not a live list.\r\n            site2[site.nickname].update_posts_insert(src, src, i, i+1, pnode);\r\n            i--;\r\n          }\r\n        }\r\n      }\r\n    },\r\n    update_posts_prep_merge: function() {\r\n      return (cataLog.embed_mode==='thread')? this.wrap_to_parse.get(document, site.nickname, site.board, 'thread_html', {thread:site.no})[0] :\r\n                                              this.wrap_to_parse.get(document, site.nickname, site.board, 'page_html', {page:0})[0];\r\n    },\r\n////    update_posts_add: function(th,th_old,pnode) { // working code.\r\n////      if (th_old.posts && th.posts) {\r\n////        var thq = liveTag.mems[th.domain][th.board][th.no].q;\r\n////        for (var i=1;i<th.posts.length;i++) {\r\n////          if (th.posts[i].no>th_old.posts[th_old.posts.length-1].no) {\r\n////            this.update_posts_insert(th,th_old,i,pnode);\r\n////            this.format_pn(th.posts[i].pn, (thq)? thq[th.posts[i].no] : null);\r\n//////            this.format_pn(th.posts[i].pn, th_old.q[th.posts[i].no]); // WILL BE THIS.\r\n////            th_old.posts[th_old.posts.length] = th.posts[i];\r\n////          }\r\n////        }\r\n////      }\r\n////    },\r\n////////    update_posts_add: function(th,th_old,pnode) { // working code.\r\n////////      var ref = th_old.posts[0].nextSibling || null;\r\n////////      for (var i=0;i<th.posts.length;i++) {\r\n////////        if (th.posts[i].no>th_old.posts[th_old.posts.length-1].no) {\r\n////////          pnode.appendChild(document.createElement('br'));\r\n////////          pnode.appendChild(this.post_container(th.posts[i].pn || this.post_json2html(th.posts[i],th.posts.board),th.posts[i].no));\r\n////////          th_old.posts[th_old.posts.length] = th.posts[i];\r\n////////        }\r\n////////      }\r\n////////    },\r\n    short_link:function(){return '';},\r\n    page_json2html3_replace_expander: function(){}, // temporal\r\n    page_json2html3_add_omitted_info: function(){}, // temporal\r\n    post_json2html_fname_server: function(post){return post.tim+post.ext;},\r\n    post_json2html_fname: function(post){return post.filename+post.ext;},\r\n    post_com2txt: function(com){\r\n      return com.replace(/<[^>]*>/g,' ').replace(/&gt;/g,'>').replace(/&lt;/g,'<').replace(/&amp;/g,'&'); // most of lainchan, speed: 9.4/1.99, misshit 4%\r\n    },\r\n    patch:{},\r\n  };\r\n  site2['common'] = { // common functions\r\n    absorb_children: function(pn){\r\n      var container = document.createElement('div');\r\n      while (pn.childNodes.length!=0) container.appendChild(pn.childNodes[0]);\r\n      pn.appendChild(container);\r\n      return container;\r\n    },\r\n    disgorge_children: function(pn){\r\n      while (pn.childNodes.length!=0) pn.parentNode.appendChild(pn.childNodes[0]);\r\n      pn.parentNode.removeChild(pn);\r\n    },\r\n    remove_by_classname : function(pn,classname,end,remove_br){\r\n      if (end===undefined) end = 0;\r\n      var tgts = pn.getElementsByClassName(classname);\r\n      for (var i=tgts.length-1-end;i>=0;i--) {\r\n        if (remove_br && tgts[i].nextSibling && tgts[i].nextSibling.tagName==='BR') tgts[i].parentNode.removeChild(tgts[i].nextSibling);\r\n//if (!pref.test_mode['14']) tgts[i].setAttribute('style','display:none;'+(tgts[i].getAttribute('style') || ''));\r\n//else\r\n        tgts[i].parentNode.removeChild(tgts[i]);\r\n      }\r\n    },\r\n//    remove_by_classname : function(pn,classname,end,remove_br){ // cause document leak in Chrome at 4chan/a/.\r\n//      if (end===undefined) end = 0;\r\n//      var tgts = pn.getElementsByClassName(classname);\r\n//      for (var i=tgts.length-1-end;i>=0;i--) {\r\n//        if (remove_br && tgts[i].nextSibling && tgts[i].nextSibling.outerHTML==='<br>') tgts[i].parentNode.removeChild(tgts[i].nextSibling);\r\n//        tgts[i].parentNode.removeChild(tgts[i]);\r\n//      }\r\n//    },\r\n    remove_by_tagname : function(pn,tagname,end){\r\n      if (end===undefined) end = 0;\r\n      var tgts = pn.getElementsByTagName(tagname);\r\n      for (var i=tgts.length-1-end;i>=0;i--) tgts[i].parentNode.removeChild(tgts[i]);\r\n    },\r\n    remove_by_attribute : function(pns,attr_name,attr_val){ // pns must be array.\r\n      for (var i=pns.length-1;i>=0;i--)\r\n        for (var j=pns[i].childNodes.length-1;j>=0;j--)\r\n          if (pns[i].childNodes[j].getAttribute)\r\n            if (pns[i].childNodes[j].getAttribute(attr_name))\r\n              if (pns[i].childNodes[j].getAttribute(attr_name).search(attr_val)!=-1) pns[i].removeChild(pns[i].childNodes[j]);\r\n    },\r\n    remove_attribute : function(doc,attr_name){\r\n      var pns = doc.getElementsByTagName('*');\r\n      for (var i=pns.length-1;i>=0;i--)\r\n        if (pns[i].getAttribute && pns[i].getAttribute(attr_name)) pns[i].removeAttribute(attr_name);\r\n    },\r\n    add_attribute_by_classname : function(pn,classname,attr_name,attr_val){\r\n      var tgts = pn.getElementsByClassName(classname);\r\n      for (var i=tgts.length-1;i>=0;i--) tgts[i].setAttribute(attr_name,attr_val);\r\n    },\r\n    add_attribute_by_tagname : function(pn,tagname,attr_name,attr_val){\r\n      var tgts = pn.getElementsByTagName(tagname);\r\n      for (var i=tgts.length-1;i>=0;i--) tgts[i].setAttribute(attr_name,attr_val);\r\n    },\r\n    add_attribute_by_attribute : function(pns,attr_name,attr_val,attr_name2,attr_val2){ // pns must be array.\r\n      for (var i=pns.length-1;i>=0;i--)\r\n        for (var j=pns[i].childNodes.length-1;j>=0;j--)\r\n          if (pns[i].childNodes[j].getAttribute)\r\n            if (pns[i].childNodes[j].getAttribute(attr_name))\r\n              if (pns[i].childNodes[j].getAttribute(attr_name).search(attr_val)!=-1) pns[i].setAttribute(attr_name2,attr_val2);\r\n    },\r\n    move_up_and_delete_parent : function(pns){\r\n      for (var i=0;i<pns.length;i++) {\r\n        var parent = pns[i].parentNode;\r\n        var g_parent = parent.parentNode;\r\n        g_parent.insertBefore(pns[i],parent);\r\n        g_parent.removeChild(parent);\r\n      }\r\n    },\r\n    remove_last_hrs_and_brs : function(th){\r\n      while (1) {\r\n        var last_node = th.childNodes[th.childNodes.length-1];\r\n        if (last_node.tagName !== 'HR' && last_node.tagName !== 'BR') break;\r\n        else th.removeChild(last_node);\r\n      }\r\n    },\r\n    remove_brs : function(elem){\r\n      var tgts = elem.getElementsByTagName('br');\r\n      for (var i=tgts.length-1;i>=0;i--) tgts[i].parentNode.removeChild(tgts[i]);\r\n    },\r\n    remove_double_br : function(elem){\r\n      var elems = elem.getElementsByTagName('*');\r\n      for (var i=elems.length-2;i>=0;i--)\r\n//        if (elems[i].outerHTML=='<br>' && elems[i+1].outerHTML=='<br>') elems[i+1].parentNode.removeChild(elems[i+1]); // CAN'T FIND STRINGS WITHOUT TAGS.\r\n        if (elems[i].outerHTML==='<br>' && elems[i].nextSibling && elems[i].nextSibling.tagName==='BR') elems[i].parentNode.removeChild(elems[i].nextSibling);\r\n    },\r\n    remove_double_tags : function(elem,tag){\r\n      var elems = elem.getElementsByTagName('*');\r\n      for (var i=elems.length-2;i>=0;i--) {\r\n        if (elems[i].tagName===tag && elems[i+1].tagName===tag) elems[i+1].parentNode.removeChild(elems[i+1]);\r\n      }\r\n    },\r\n    change_utc_to_local : function(utc_str){\r\n      var date = new Date(utc_str);\r\n//      return date.toString().replace(/\\ GMT.*/,'');\r\n      return date.toLocaleString().replace(/\\ /,' ('+date.toString().replace(/\\ .*/,'')+') ');\r\n    },\r\n////////    thread2headline : function(doc,nickname){\r\n////////      var retval  = site2[nickname].insert_footer(doc,0,'t2h',false,0,0,0);\r\n////////      site2[nickname].remove_posts(doc,pref.catalog_t2h_num_of_posts);\r\n////////      site2.common.remove_double_br(doc);\r\n////////      var retval2 = site2[nickname].insert_footer(doc,0,'t2h',false,0,0,0);\r\n////////      return [retval[0]-retval2[0], retval[1]-retval2[1]];\r\n////////    },\r\n  };\r\n  site4 = {\r\n   tb_prep_for_embed: function(tb){\r\n     tb.childNodes[0].innerHTML = '';\r\n     tb.childNodes[1].innerHTML = '';\r\n     tb.childNodes[0].draggable = false;\r\n     tb.childNodes[3].ondblclick = null;\r\n     tb.childNodes[3].draggable = false;\r\n     tb.childNodes[3].removeAttribute('style');\r\n   },\r\n////////\r\n//////// TUNING RESULTS to parse entire 4chan by chrome, (avarage of 3 times), 2015/10/5 on XXX.\r\n////////     TYPE1: written in flat with 'exe_sub'. (traditional)\r\n////////     TYPE2: written in array with 'exe_sub'.\r\n////////     TYPE3: written in array.\r\n////////     TYPE4: written in array systematically.\r\n////////     TYPE5: written in flat.\r\n////////   results(ms): (idle), (program), (anonymous_function), usage. \r\n////////     TYPE1: 179164.7, 24936.9, 12598.6, 17.3%\r\n////////     TYPE2: 165382.5, 35503.6, 14546.3, 23.2%\r\n////////     TYPE3: 169261.9, 23509.1, 13727.0, 18.0%\r\n////////     TYPE4: 159156.4, 37429.6, 14104.5, 24.5%\r\n////////     TYPE5: 159990.8, 32805.5, 14998.7, 23.0%\r\n////////\r\n//////// TUNING RESULTS use TYPE1 to parse entire 4chan 2015/12/19 on chrome 47.0.2526.106m. Just one trial.\r\n////////     rev_547: 12min05s\r\n////////     rev_714: 11min30s, why does 4chan become so slow? lainchan is not so slow.\r\n////\r\n////    parse_funcs_getters: {}, // works.\r\n////    parse_funcs_getters: Object.create(null), // THIS DOESN'T WORK.\r\n////    parse_funcs_getters: (function(){ // works if '{}'\r\n//////      var obj = Object.create(null); // DOESN'T WORK, probably introduce problem to make prototype chain using '__proto__'.\r\n////      var obj = {}; // works.\r\n////      var props=['no','ths','key','time_bumped','nof_posts','nof_files','time_created','posts','sub','name','com','flag','flags',\r\n////                 'footer','sticky','format','pn','pn_name','time','time_posted','tn_as','tn_imgs','op_img_url','post_no'];\r\n////      for (var i=0;i<props.length;i++) Object.defineProperty(obj,props[i],{get:(function(prop){return function(){return this.exe_sub(prop);}})(props[i]), enumerable:true});\r\n////      return obj;\r\n////    })(),\r\n////\r\n    parse_funcs_getters: { // working code. // TYPE1\r\n      get no() {return this.exe_sub('no');},\r\n//      get ths() {return this.exe_sub('ths');}, // removed to get faster.\r\n      get key() {return this.exe_sub('key');},\r\n      get time_bumped() {return this.exe_sub('time_bumped');},\r\n      get nof_posts() {return this.exe_sub('nof_posts');},\r\n      get nof_files() {return this.exe_sub('nof_files');},\r\n      get time_created() {return this.exe_sub('time_created');},\r\n      get posts() {return this.exe_sub('posts');},\r\n      get sub() {return this.exe_sub('sub');},\r\n      get name() {return this.exe_sub('name');},\r\n      get com() {return this.exe_sub('com');},\r\n      get flag() {return this.exe_sub('flag');},\r\n      get flags() {return this.exe_sub('flags');},\r\n      get footer() {return this.exe_sub('footer');},\r\n      get sticky() {return this.exe_sub('sticky');},\r\n//      get format() {return this.exe_sub('format');},\r\n      get pn() {return this.exe_sub('pn');},\r\n//      get pn_name() {return this.exe_sub2('pn_name');},\r\n      get time() {return this.exe_sub('time');},\r\n      get time_posted() {return this.exe_sub('time_posted');},\r\n//      get html_org() {return this.exe_sub('html_org');},\r\n      get tn_as() {return this.exe_sub2('tn_as');},  // CAUTION. ADDED AFTER TUNING.\r\n      get tn_imgs() {return this.exe_sub2('tn_imgs');},  // CAUTION. ADDED AFTER TUNING.\r\n      get op_img_url() {return this.exe_sub('op_img_url');},\r\n////      get post_no() {return this.exe_sub('post_no');},\r\n//      get last_replies() {return this.exe_sub('last_replies');},   // CAUTION. ADDED AFTER TUNING.\r\n      get txt() {return this.exe_sub('txt');},   // CAUTION. ADDED AFTER TUNING.\r\n\r\n      get time_tu() {return this.time * this.parse_funcs.time_unit;},   // CAUTION. ADDED AFTER TUNING. THIS IS NOT A CALLER.\r\n      get lth() {return liveTag.mems[this.domain][this.board][this.no];},   // CAUTION. ADDED AFTER TUNING. THIS IS NOT A CALLER.\r\n    },\r\n////    parse_funcs_on_demand : { // TYPE5\r\n////      get no() {return Object.defineProperty(this,'no',{value:this.parse_funcs['no'](this), enumerable:true, configurable:true, writable:true})['no'];},\r\n////      get ths() {return Object.defineProperty(this,'ths',{value:this.parse_funcs['ths'](this), enumerable:true, configurable:true, writable:true})['ths'];},\r\n////      get key() {return Object.defineProperty(this,'key',{value:this.parse_funcs['key'](this), enumerable:true, configurable:true, writable:true})['key'];},\r\n////      get time_bumped() {return Object.defineProperty(this,'time_bumped',{value:this.parse_funcs['time_bumped'](this), enumerable:true, configurable:true, writable:true})['time_bumped'];},\r\n////      get nof_posts() {return Object.defineProperty(this,'nof_posts',{value:this.parse_funcs['nof_posts'](this), enumerable:true, configurable:true, writable:true})['nof_posts'];},\r\n////      get nof_files() {return Object.defineProperty(this,'nof_files',{value:this.parse_funcs['nof_files'](this), enumerable:true, configurable:true, writable:true})['nof_files'];},\r\n////      get time_created() {return Object.defineProperty(this,'time_created',{value:this.parse_funcs['time_created'](this), enumerable:true, configurable:true, writable:true})['time_created'];},\r\n////      get posts() {return Object.defineProperty(this,'posts',{value:this.parse_funcs['posts'](this), enumerable:true, configurable:true, writable:true})['posts'];},\r\n////      get sub() {return Object.defineProperty(this,'sub',{value:this.parse_funcs['sub'](this), enumerable:true, configurable:true, writable:true})['sub'];},\r\n////      get name() {return Object.defineProperty(this,'name',{value:this.parse_funcs['name'](this), enumerable:true, configurable:true, writable:true})['name'];},\r\n////      get com() {return Object.defineProperty(this,'com',{value:this.parse_funcs['com'](this), enumerable:true, configurable:true, writable:true})['com'];},\r\n////      get flag() {return Object.defineProperty(this,'flag',{value:this.parse_funcs['flag'](this), enumerable:true, configurable:true, writable:true})['flag'];},\r\n////      get flags() {return Object.defineProperty(this,'flags',{value:this.parse_funcs['flags'](this), enumerable:true, configurable:true, writable:true})['flags'];},\r\n////      get footer() {return Object.defineProperty(this,'footer',{value:this.parse_funcs['footer'](this), enumerable:true, configurable:true, writable:true})['footer'];},\r\n////      get sticky() {return Object.defineProperty(this,'sticky',{value:this.parse_funcs['sticky'](this), enumerable:true, configurable:true, writable:true})['sticky'];},\r\n////      get format() {return Object.defineProperty(this,'format',{value:this.parse_funcs['format'](this), enumerable:true, configurable:true, writable:true})['format'];},\r\n////      get pn() {return Object.defineProperty(this,'pn',{value:this.parse_funcs['pn'](this), enumerable:true, configurable:true, writable:true})['pn'];},\r\n////      get pn_name() {return Object.defineProperty(this,'pn_name',{value:this.parse_funcs['pn_name'](this), enumerable:true, configurable:true, writable:true})['pn_name'];},\r\n////      get time() {return Object.defineProperty(this,'time',{value:this.parse_funcs['time'](this), enumerable:true, configurable:true, writable:true})['time'];},\r\n////      get time_posted() {return Object.defineProperty(this,'time_posted',{value:this.parse_funcs['time_posted'](this), enumerable:true, configurable:true, writable:true})['time_posted'];},\r\n//////      get html_org() {return Object.defineProperty(this,'html_org',{value:this.parse_funcs['html_org'](this), enumerable:true, configurable:true, writable:true})['html_org'];},\r\n////      get tn_as() {return Object.defineProperty(this,'tn_as',{value:this.parse_funcs['tn_as'](this), enumerable:true, configurable:true, writable:true})['tn_as'];},\r\n////      get tn_imgs() {return Object.defineProperty(this,'tn_imgs',{value:this.parse_funcs['tn_imgs'](this), enumerable:true, configurable:true, writable:true})['tn_imgs'];},\r\n////      get op_img_url() {return Object.defineProperty(this,'op_img_url',{value:this.parse_funcs['op_img_url'](this), enumerable:true, configurable:true, writable:true})['op_img_url'];},\r\n////      get post_no() {return Object.defineProperty(this,'post_no',{value:this.parse_funcs['post_no'](this), enumerable:true, configurable:true, writable:true})['post_no'];},\r\n////    },\r\n    parse_funcs_on_demand : {},\r\n    parse_funcs_on_demand_debug : {},\r\n    parse_funcs_no_cache: {},\r\n    parse_funcs_one_time: {}\r\n  };\r\n////  var props=['no','ths','key','time_bumped','nof_posts','nof_files','time_created','posts','sub','name','com','flag','flags', // works.\r\n////             'footer','sticky','format','pn','pn_name','time','time_posted','tn_as','tn_imgs','op_img_url','post_no'];\r\n////  for (var i=0;i<props.length;i++)\r\n//////    Object.defineProperty(site4.parse_funcs_getters,props[i],{get:(function(prop){return function(){return this.exe_sub(prop);}})(props[i]), enumerable:true}); // TYPE2\r\n////    Object.defineProperty(site4.parse_funcs_on_demand,props[i],{get:(function(prop){ // WORKS // TYPE3\r\n////      return function(){\r\n////        return Object.defineProperty(this,prop,{value:this.parse_funcs[prop](this), enumerable:true, configurable:true, writable:true})[prop];\r\n////      }})(props[i]), enumerable:true});\r\n  site4.parse_funcs_on_demand = { // working code. // TYPE1,2\r\n    exe_sub : function(prop){return Object.defineProperty(this,prop,{value:this.parse_funcs[prop](this), enumerable:true, configurable:true, writable:true})[prop];},\r\n    exe_sub2 : function(prop){return this.parse_funcs_html[prop](this);}, // no cache\r\n    __proto__: site4.parse_funcs_getters\r\n  }\r\n  site4.parse_funcs_on_demand_debug = {\r\n    exe_sub : function(prop){\r\n      try {\r\n        return Object.defineProperty(this,prop,{value:this.parse_funcs[prop](this), enumerable:true, configurable:true, writable:true})[prop];\r\n      } catch(e) {\r\n        console.log('parse_error: '+this.key+', '+this.type_parse+', '+prop);\r\n        console.trace();\r\n        console.log(this);\r\n      }\r\n    },\r\n    exe_sub2 : function(prop){\r\n      try {\r\n        return this.parse_funcs_html[prop](this); // no cache\r\n      } catch(e) {\r\n        console.log('parse_error: '+this.key+', '+this.type_parse+', '+prop);\r\n        console.trace();\r\n        console.log(this);\r\n      }\r\n    },\r\n    __proto__: site4.parse_funcs_getters\r\n  }\r\n  site4.parse_funcs_no_cache = {\r\n    exe_sub : function(prop){return this.parse_funcs[prop](this);},\r\n    exe_sub2 : function(prop){return this.parse_funcs_html[prop](this);},\r\n    __proto__: site4.parse_funcs_getters\r\n  }\r\n  site4.parse_funcs_one_time = {\r\n    get posts() {return Object.defineProperty(this,'posts',{value:this.parse_funcs['posts'](this), enumerable:true, configurable:true, writable:true})['posts'];},\r\n    exe_sub : function(prop){return this.parse_funcs[prop](this);},\r\n    exe_sub2 : function(prop){return this.parse_funcs_html[prop](this);},\r\n    __proto__: site4.parse_funcs_getters\r\n  }\r\n\r\n////  (function (){ // WORKS, BUT TOO SLOW // TYPE4\r\n////    var props=['no','ths','key','time_bumped','nof_posts','nof_files','time_created','posts','sub','name','com','flag','flags', // works.\r\n////               'footer','sticky','format','pn','pn_name','time','time_posted','tn_as','tn_imgs','op_img_url','post_no'];\r\n////    for (var i=0;i<props.length;i++) {\r\n////      var func = (function(prop){return function(){\r\n////                   return Object.defineProperty(this,prop,{value:this.parse_funcs[prop](this), enumerable:true, configurable:true, writable:true})[prop];\r\n////                 }})(props[i]);\r\n////      var func_no_cache = (function(prop){return function(){\r\n////                   return this.parse_funcs[prop](this);\r\n////                 }})(props[i]);\r\n////      var func_debug = (function(func,prop){return function(){\r\n////                         try {\r\n//////                           return func();  // THIS DOESN'T WORK, WHY???\r\n////                           return Object.defineProperty(this,prop,{value:this.parse_funcs[prop](this), enumerable:true, configurable:true, writable:true})[prop]; // works.\r\n////                         } catch(e) {\r\n////                           console.log('parse_error: '+this.key+', '+this.type_parse);\r\n////                         }\r\n////                       }})(func,props[i]);\r\n////      Object.defineProperty(site4.parse_funcs_on_demand,props[i],{get:func, enumerable:true});\r\n////      Object.defineProperty(site4.parse_funcs_on_demand_debug,props[i],{get:func_debug, enumerable:true});  // NOT DEBUGGED YET\r\n////      Object.defineProperty(site4.parse_funcs_no_cache,props[i],{get:func_no_cache, enumerable:true});  // NOT DEBUGGED YET\r\n////      if (props[i]!=='posts') Object.defineProperty(site4.parse_funcs_one_time,props[i],{get:func, enumerable:true});  // NOT DEBUGGED YET\r\n////      else Object.defineProperty(site4.parse_funcs_one_time,props[i],{get:func_no_cache, enumerable:true});\r\n////    }\r\n////  })();\r\n\r\n  site2['8chan'] = {\r\n    nickname : '8chan',\r\n    domain_url : '8ch.net',\r\n//    home : site.protocol + '//8chan.co/faq.html', // stop twitter and IRC access.\r\n//    home : site.protocol + '//8ch.net/faq.html', // stop twitter and IRC access.\r\n//    home : site.protocol + '//8ch.net/favicon.ico', // can't work in FF.\r\n    home: site.protocol + '//8ch.net' + ((brwsr.ff)? '/faq.html' : '/favicon.ico'),\r\n//    protocol : 'https:',\r\n    protocol : site.protocol,\r\n    features : {uip_tracker: true},\r\n    pref_default: {\r\n      catalog_expand_with_hr: true,\r\n      page:{ env:{ disp_offset:1}},\r\n    },\r\n    utilize_boards_json: true,\r\n    check_func : function(){\r\n      var href = window.location.href;\r\n      if (href.search(/8chan.co|8ch.net/)!=-1) { // 8chan\r\n        site2['8chan'].domain_url = (href.search(/8ch.net/)!=-1)? '8ch.net' : '8chan.co';\r\n        this.home = site.protocol + '//' + this.domain_url + this.home.substr(this.home.lastIndexOf('/')); // FF doesn't work on favicon.\r\n        var header = document.getElementsByTagName('header')[0];\r\n        site.whereami = (header && header.innerHTML.indexOf('404 Not Found')!=-1)? '404'\r\n                      : (href.search(/8ch\\.net\\/?$/)!=-1)? 'frame'\r\n                      : (href.search(/catalog\\.html/)!=-1)? 'catalog'\r\n                      : (href.search(/res\\/[0-9\\+]*\\.html/)!=-1)? 'thread'\r\n                      : (href.search(/\\/$|(index|[0-9]+)\\.html|\\/#all$/)!=-1)? 'page'\r\n                      : (href.search(/boards.html/)!=-1)? 'boards'\r\n                      : 'other';\r\n        site.config(site2['8chan'].domain_url,'8chan');\r\n        site.header_height = function(){\r\n          var header = document.getElementsByClassName('boardlist')[0];\r\n          if (header) return header.offsetHeight;\r\n          else return 0;\r\n        }\r\n        site.postform = document.getElementsByTagName('form')[0];\r\n//        site.postform_comment = document.getElementById('body');\r\n        if (site.postform) this.postform_prep();\r\n        site.max_page = site2['8chan'].max_page(site.board);\r\n        site.catalog = href.search(/catalog\\.html/)!=-1;\r\n        if (site.whereami==='thread' || site.whereami==='page') {\r\n          site.embed_to['top']    = document.getElementsByName('postcontrols')[0];\r\n          site.embed_to['bottom'] = document.getElementsByClassName('boardlist bottom')[0];\r\n        } else if (site.whereami==='catalog') {\r\n          site.embed_to['top']    = document.getElementsByClassName('thumbnail')[0].nextSibling;\r\n//          site.embed_to['top']    = header.nextSibling;\r\n          site.embed_to['bottom'] = document.getElementsByTagName('footer')[0];\r\n        }\r\n        if (site.components.boardlist) site.components.boardlist.style.zIndex = 0;\r\n        return true;\r\n      } else {\r\n        if (!brwsr.ff) {\r\n          this.protocol = 'https:';\r\n          this.home = this.protocol + '//' + this.domain_url + this.home.substr(this.home.lastIndexOf('/'));\r\n        }\r\n        return false;\r\n      }\r\n    },\r\n    postprocess_board: function(val){\r\n      for (var i=0;i<val.length;i++) {\r\n        if (val[i].max>0) { // val[i].max is string, but this is ok.\r\n          var bd = liveTag.mems.init({domain:this.nickname, board:'/'+val[i].uri+'/'});\r\n          bd.o = i;\r\n          if (val[i].pages && !bd.pgs) bd.pgs = val[i].pages;\r\n////          site3[this.nickname].boards.push(bd); // BUG. increase length forever.\r\n          Object.defineProperty(bd,'max',{value:parseInt(val[i].max,10), writable:true});\r\n          if (bd.read_max===undefined) Object.defineProperty(bd,'read_max',{value:0, writable:true});\r\n          if (val[i].tags && val[i].tags.length!=0) liveTag.postprocess_board_add_btag(val[i].tags,bd);\r\n        }\r\n      }\r\n    },\r\n////    enumerate_boards_to_scan:function(){\r\n////      var obj = [];\r\n////      var end = (site3[site.nickname].boards.length > pref.scan.max)? pref.scan.max : site3[site.nickname].boards.length;\r\n////      for (var i=0;i<end;i++) \r\n////        if (site3[site.nickname].boards[i].max) obj[obj.length] = '/'+site3[site.nickname].boards[i].uri+'/';\r\n////      return obj;\r\n////    },\r\n////    make_site3_bds:function(){ // working code.\r\n////      var tgts = site3[site.nickname].boards;\r\n////      for (var i=0;i<tgts.length;i++) site3[this.nickname].bds['/'+tgts[i].uri+'/'] = tgts[i].max;\r\n////    },\r\n    catalog_frame_prep: function(pn12){\r\n      document.getElementsByTagName('header')[0].style.display='none';\r\n      document.getElementsByClassName('footer')[0].style.display = 'none';\r\n      var frame_menu = document.getElementsByClassName('menuCol')[0];\r\n      frame_menu.firstChild.style.display='none';\r\n      var frame_main = document.getElementsByClassName('bodyCol')[0];\r\n      frame_main.firstChild.style.display = 'none';\r\n      frame_menu.insertBefore(pn12,frame_menu.firstChild);\r\n      var ifrm = this.catalog_native_frame_prep_frame(frame_main,frame_main.firstChild);\r\n      this.catalog_embed_prep(pn12);\r\n    },\r\n    prep_own_posts_event : function(e){\r\n      if (e && e.key==='own_posts') site2['8chan'].prep_own_posts();\r\n      if (window.name==='8chan') send_message('parent',[['OWN_POSTS', window.name, site3[window.name].own_posts]]);\r\n    },\r\n    prep_own_posts : function(){\r\n      var own_posts = {};\r\n      var obj = JSON.parse(localStorage.getItem('own_posts'));\r\n      for (var i in obj) {\r\n        var board = '/'+i+'/';\r\n        own_posts[board] = {};\r\n        for (var j=0;j<obj[i].length;j++) own_posts[board][obj[i][j]] = null;\r\n      }\r\n//      for (var i in obj)\r\n//        for (var j=0;j<obj[i].length;j++)\r\n//          own_posts['/'+i+'/'+obj[i][j]] = null;\r\n//console.log(own_posts);\r\n      site3['8chan'].own_posts = own_posts;\r\n    },\r\n////    format_thread_always : function(th){\r\n////////      site2.common.remove_last_hrs_and_brs(th); // working code.\r\n////      if (th.nextSibling && th.nextSibling.tagName==='HR') th.appendChild(th.nextSibling);\r\n////      else th.appendChild(document.createElement('hr'));\r\n////    },\r\n    preprocess_doc2: {\r\n      thread_html: function(doc){\r\n        var head = doc.getElementsByTagName('head')[0];\r\n        while (head.firstChild) head.removeChild(head.firstChild);\r\n        var body = doc.getElementsByTagName('body')[0];\r\n        for (var i=body.childNodes.length-1;i>=0;i--) if (body.childNodes[i].name!=='postcontrols') body.removeChild(body.childNodes[i]);\r\n      }\r\n    },\r\n\r\n    parse_funcs : { // 8chan\r\n      'catalog_html' : {\r\n//        ths: function(doc,req){\r\n//          var req2 = req[req.indexOf('ths')+1];\r\n//          var mixs = doc.pn.getElementsByClassName('mix');\r\n//          var ths = [];\r\n//          for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV') {\r\n//            ths.push({pn:mixs[i], board:doc.board, domain:doc.domain});\r\n//            site2['DEFAULT'].parse_funcs.call(this,ths[ths.length-1],req2);\r\n//          }\r\n//          return ths;\r\n//        },\r\n        before_test : ['ths',':ITER',':ALL','ths',['key','time_bumped','nof_posts','nof_files']],\r\n        after_test  : ['time_created','sub','name','com','footer','sticky','format'],\r\n        full_hier   : ['ths',':ITER',':ALL','ths',['key','time_bumped','nof_posts','nof_files','time_created','sub','name','com','footer','sticky','format']],\r\n//        full_th     : ['key','time_bumped','nof_posts','nof_files','sub','name','com','footer','sticky'],\r\n        ths: function(doc) {\r\n          var mixs = doc.pn.getElementsByClassName('mix');\r\n          var ths = [];\r\nif (pref.test_mode['0']) {\r\n          for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV') ths[ths.length] = {pn:mixs[i], page:Math.floor(i/15)+'.'+i%15};\r\n} else { \r\n          for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV') ths[ths.length] = mixs[i];\r\n          ths = this.ths_array(doc,ths);\r\n}\r\n//          for (var i=0;i<ths.length;i++) ths[i].pn.getElementsByTagName('a')[0].addEventListener('click',this.preventDefault,false); // TEST, works.\r\n          return ths;\r\n        },\r\n        th_init: function(th){\r\n          var pn_child = th.pn.getElementsByTagName('div')[0];\r\n//          pn_child.className = pn_child.className.replace(/grid\\-size\\-[a-z]*/,'grid-size-'+site2[th.domain].catalog_native_size); // BUG WHEN MIMICED.\r\n          pn_child.className = pn_child.className.replace(/grid\\-size\\-[a-z]*/,'grid-size-'+site2['8chan'].catalog_native_size);\r\n//          th.pn.getElementsByTagName('a')[0].removeAttribute('href');\r\n//          th.pn.getElementsByTagName('a')[0].addEventListener('click',th.parse_funcs.preventDefault,false); // TEST\r\n        },\r\n//        th_destroy: function(pn, parse_funcs){\r\n////          pn.getElementsByTagName('a')[0].removeEventListener('click',parse_funcs.preventDefault,false); // TEST\r\n//        },\r\n////        ths: function(doc) {\r\n////          var mixs = doc.pn.getElementsByClassName('mix');\r\n////          var ths = [];\r\n////if (pref.test_mode['0']) {\r\n////          for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV') ths[ths.length] = {pn:mixs[i], page:Math.floor(i/15)+'.'+i%15};\r\n////} else { \r\n//////          for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV')\r\n//////            ths[ths.length] = {pn:mixs[i], page:Math.floor(i/15)+'.'+i%15, type_html: 'catalog_html', __proto__:doc.__proto__};\r\n////          for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV') ths[ths.length] = mixs[i];\r\n////          ths = this.ths_array(doc,ths);\r\n////}\r\n////          for (var i=0;i<ths.length;i++) {\r\n////            var pn_child = ths[i].pn.getElementsByTagName('div')[0];\r\n////            pn_child.className = pn_child.className.replace(/grid\\-size\\-[a-z]*/,'grid-size-'+site2['8chan'].catalog_native_size);\r\n////          }\r\n////          for (var i=0;i<ths.length;i++) ths[i].pn.getElementsByTagName('a')[0].removeAttribute('href');\r\n//////          for (var i=0;i<ths.length;i++) ths[i].pn.getElementsByTagName('a')[0].addEventListener('click',this.preventDefault,false); // TEST\r\n////          return ths;\r\n//////          for (var i=mixs.length-1;i>=0;i--) if (mixs[i].tagName==='DIV') mixs[i]={pn:mixs[i]}; // CAN'T WRITE TO COLLECTION.\r\n//////                                             else Array.prototype.splice.call(mixs,i,1);\r\n//////          return mixs; // return collection\r\n////        },\r\n//        no : function(th){return th.pn.getElementsByTagName('img')[0].id.replace(/img\\-/,'');},\r\n        no : function(th){return parseInt(th.pn.getAttribute('data-id'),10);},\r\n        sticky: function(th){return th.pn.getAttribute('data-sticky')==='true';},\r\n        posts: 'DEFAULT.catalog_html',\r\n        proto: 'vichan.catalog_html'\r\n      },\r\n      'catalog_json' : {\r\n////        op_img_url: function(obj) { // working code.\r\n////          return (obj.ext==='.jpg' || obj.ext==='.png' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.webm' || obj.ext==='.mp4')?\r\n////                   'https://' + site2['8chan'].domain_url + obj.board + 'thumb/' + obj.tim + '.jpg' :\r\n////                 (obj.embed)? 'https:' + obj.embed.replace(/.*src=\"/,'').replace(/\".*/,'') :\r\n////                 (obj.ext==undefined)? 'https://' + site2['8chan'].domain_url + '/static/no-file.png' :\r\n//////                 (obj.ext==undefined)? 'https://' + site2['8chan'].domain_url + '/static/assets' + obj.board + 'no-file.png' :\r\n////                 '';\r\n//////          return ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://' + site2['8chan'].domain_url + obj.board + 'thumb/' + obj.tim + obj.ext : '');\r\n////        },\r\n        get_op_src: 'thread_json',\r\n        proto: 'vichan.catalog_json'\r\n      },\r\n      'page_html'    : {\r\n        ths: function(doc) {\r\n//          var pc = doc.pn.getElementsByName('postcontrols')[0].childNodes;\r\n//          var ths = [];\r\n//          if (pc) for (var i=0;i<pc.length;i++) if (pc[i].id && pc[i].id.substr(0,6)=='thread') ths[ths.length] = pc[i];\r\n//          ths = this.ths_array(doc,ths);\r\n          var ths = this.ths_array(doc,doc.pn.getElementsByClassName('thread')); // 2015.04.26 changed to the same as 4chan.\r\n          if (site.whereami!=='page' || !pref.catalog.embed_page) for (var i=0;i<ths.length;i++) ths[i].pn.removeAttribute('class');\r\n//          for (var i=0;i<ths.length;i++) if (ths[i].pn.nextSibling && ths[i].pn.nextSibling.tagName==='HR') ths[i].pn.appendChild(ths[i].pn.nextSibling);\r\n////          for (var i=0;i<ths.length;i++) {\r\n////            var as = ths[i].pn.getElementsByTagName('a');\r\n////            as[0].removeAttribute('href'); // changed 2015.04.26\r\n////            as[1].removeAttribute('href'); // changed 2015.04.26\r\n////          }\r\n          return ths;\r\n        },\r\n//        no : function(th){return parseInt(th.pn.getElementsByClassName('post op')[0].id.substring(3),10);},\r\n          pn: 'page_json', // for mimic\r\n        filename: 'thread_html',\r\n        proto: 'vichan.page_html'\r\n      },\r\n      'page_json'  : {\r\n        has_posts: true,\r\n//pn: function(th){return site2[th.domain_html].catalog_json2html3(th,th.board, this.op_img_url(th));}, // TEMPORAL PATCH\r\n        proto: 'vichan.page_json'\r\n      },\r\n      'thread_html'  : {\r\n////        qsel_th2posts: ':scope>.post.reply', // working code.\r\n////        pop_post_prep: function(th){\r\n////          th.posts_col = th.pn.querySelectorAll(this.qsel_th2posts);\r\n////          th.idx_pop = th.posts_col.length-1;\r\n////        },\r\n////        pop_post: function(th){\r\n////          while (th.idx_pop>=0) {\r\n////            var pn = th.posts_col[th.idx_pop--];\r\n////            if (pn.className && pn.className.indexOf('post')!=-1 && pn.className.indexOf('reply')!=-1) {\r\n////              th.post = {pn:pn, parse_funcs:this, __proto__:th.__proto__};\r\n////              return true;\r\n////            }\r\n////          }\r\n////          return false;\r\n////        },\r\n        filename: function (th){ // post can be accepted.\r\n          var filenames = [];\r\n          var files = ((th.pn.classList.contains('op'))? th.pn.parentNode : th.pn).getElementsByClassName('files')[0];\r\n          if (files) {\r\n            var spans = files.getElementsByClassName('postfilename');\r\n            for (var i=0;i<spans.length;i++) filenames[i] = spans[i].textContent;\r\n//            files = files.getElementsByClassName('file');\r\n//            for (var i=0;i<files.length;i++) {\r\n//              var as = files[i].getElementsByTagName('a');\r\n//              for (var j=0;j<as.length;j++) if (as[j].getAttribute('title')==='Save as original filename') filenames[filenames.length] = as[j].textContent;\r\n//            }\r\n          }\r\n          if (filenames.length>1) {\r\n            th.extra_files = [];\r\n            for (var i=1;i<filenames.length;i++) th.extra_files[i-1] = {filename:filenames[i], __proto__:th.__proto__};\r\n          }\r\n          return filenames[0];\r\n        },\r\n        get_op_src: 'thread_json',\r\n        proto: 'vichan.thread_html'\r\n      },\r\n      'thread_json'  : {\r\n        get_op_src: function(th){return th.op_img_url.replace('thumb','src').replace('.jpg',th.ext);},\r\n        proto: 'vichan.thread_json'\r\n      },\r\n    },\r\n\r\n//    popups_op_func_set: function(pn){return pn.parentNode.querySelector('.files');},\r\n    popups_op_func_set: function(pn){return pn.querySelector('.files');}, // MUST BE CONSISTENT OF page_json2html\r\n    popups_op_func_use: function(pn,thq,no){\r\n      pn.setAttribute('class',pn.getAttribute('class')+' reply');\r\n      pn.insertBefore(thq[no].isOP.cloneNode(true),pn.firstChild);\r\n    },\r\n    update_posts_remove: function(th_old,i,pnode){\r\n      pnode.removeChild(th_old.posts[i].pn.nextSibling);\r\n      pnode.removeChild(th_old.posts[i].pn);\r\n    },\r\n    update_posts_insert: function(src,dst,i,j,pnode){\r\n      var ref = (j==1)? (dst[0].pn.nextSibling || null) :\r\n                (j<dst.length)? (dst[j].pn.nextSibling && dst[j].pn.nextSibling.nextSibling || null) : null;\r\n      if (!src[i].pn) src[i].pn = this.post_json2html(src[i],src[i].board);\r\n      pnode.insertBefore(src[i].pn, ref);\r\n      pnode.insertBefore(document.createElement('br'),ref);\r\n    },\r\n\r\n    catalog_json2html3_thumbnail: function(obj, board) {\r\n      return (obj.ext==='.jpg' || obj.ext==='.png' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.webm' || obj.ext==='.mp4')?\r\n               site2['8chan'].protocol + '//' + site2['8chan'].domain_url + board + 'thumb/' + obj.tim + '.jpg' :\r\n             (obj.embed)? 'https:' + obj.embed.replace(/.*src=\"/,'').replace(/\".*/,'') :\r\n//             (obj.ext===undefined)? site2['8chan'].protocol + site2['8chan'].domain_url + '/static/no-file.png' :\r\n////             (obj.ext===undefined)? 'https://' + site2['8chan'].domain_url + '/static/assets' + board + 'no-file.png' :\r\n             '';\r\n//      return ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://' + site2['8chan'].domain_url + board + 'thumb/' + obj.tim + obj.ext : '');\r\n    },\r\n    short_link:function(){return '';},\r\n    proto : 'vichan'\r\n  };\r\n  site2['8chan_live'] = {\r\n    parse_funcs : {\r\n      'thread_html'  : {\r\n        posts: function(th){return this.posts_array(th, th.pn.querySelectorAll(':scope>.post.reply'));},\r\n        proto: '8chan.thread_html'\r\n      }\r\n    },\r\n    proto : '8chan'\r\n  };\r\n  site2['vichan'] = {\r\n    components: {\r\n      boardlist: '.boardlist',\r\n      postform_comment: ['textarea[name=\"body\"]',0],\r\n      postform_comment2: ['textarea[name=\"body\"]',1],\r\n      postform_submit: ['input[name=\"post\"]',0],\r\n      postform_submit2: ['input[name=\"post\"]',1],\r\n    },\r\n////    postform_prep: function(){\r\n////      site.components.postform_submit2 = null;\r\n////      site.components.postform_submit2_observer = new MutationObserver(this.postform_submit2_find);\r\n////      site.components.postform_submit2_observer.observe(document.getElementsByTagName('body')[0], {childList: true});\r\n////    },\r\n////    postform_submit2_find: function(){\r\n////      var postform_qr = document.querySelectorAll('input[name=post]')[1]; // quick reply\r\n////      if (!site.components.postform_submit2 && postform_qr) {\r\n////        site.components.postform_submit2 = postform_qr;\r\n//////        site.components.postform_submit2_observer.disconnect();\r\n//////        delete site.components.postform_submit2_observer;\r\n////        if (common_obj.thread_reader) common_obj.thread_reader.add_event_to_submit(site.components.postform_submit2);\r\n////      } else if (site.components.postform_submit2 && !postform_qr) {\r\n////        if (common_obj.thread_reader) common_obj.thread_reader.remove_event_from_submit(site.components.postform_submit2);\r\n////        site.components.postform_submit2 = null;\r\n////      }\r\n////      site.query_set_component('postform_comment2');\r\n////      recovery.setup2();\r\n////    },\r\n    general_event_handler:(function(){\r\n      var obj = {\r\n        thread: {\r\n          get_mark: function(pn, clientY){\r\n            while (pn && pn!== cataLog.parent) {\r\n              if (pn.tagName==='BR' || !pn.classList) {pn = pn.previousSibling || pn.parentNode; continue;}\r\n              if (pn.classList.contains('post')) return pn;\r\n              if (pn.classList.contains('postcontainer')) return pn.getElementsByClassName('post')[0];\r\n              if (pn.parentNode && pn.parentNode.id && pn.parentNode.id.search(/^thread/)!=-1) {\r\n                pn = pn.previousSibling;\r\n                if (pn) continue;\r\n                else break;\r\n              }\r\n              if (pn.id && pn.id.search(/^thread/)!=-1) break;\r\n              pn = pn.parentNode;\r\n            }\r\n            return this.get_mark_from_height(clientY);\r\n          },\r\n          get_mark_from_height: function(now_height){\r\n            return this.__proto__.get_mark_from_height(now_height, document.getElementsByClassName('post'));\r\n          },\r\n          __proto__: site2['DEFAULT'].general_event_handler.common,\r\n        },\r\n      };\r\n      obj.page = {\r\n        add_mouseover: pref.test_mode['68'], // true,\r\n        mouseover: function(e){\r\n          var et = e.target;\r\n          var et_tagName = et.tagName;\r\n          if (et_tagName==='A')\r\n            if (pref[cataLog.embed_mode].popup_truncated && et.parentNode.className==='toolong') site2['DEFAULT'].popups_post_entry(e);\r\n        },\r\n        __proto__:obj.thread\r\n      },\r\n      obj.catalog = {\r\n        mouseover: function(e){\r\n          var et = e.target;\r\n          var et_tagName = et.tagName;\r\n          if (et_tagName==='IMG')\r\n            if (pref[cataLog.embed_mode].image_hover && et.parentNode.tagName==='A') cataLog.image_hover_add.call(et, e);\r\n        },\r\n        __proto__:obj.thread\r\n      };\r\n      return obj;\r\n    })(),\r\n    boards_sel_from_tags : function(){\r\n      var boards = document.getElementsByClassName('board-list-tbody')[0];\r\n      var str = 'SELECTED_BOARDS,';\r\n      for (var i=0;i<boards.childNodes.length;i++)\r\n        if (boards.childNodes[i].style.display!=='none') str = str + '8chan' + boards.childNodes[i].getElementsByClassName('board-uri')[0].getElementsByTagName('a')[0].getAttribute('href') + ',';\r\n      return str+'\\n';\r\n    },\r\n//    catalog_background : '#eef2ff',\r\n//    catalog_bordercolor : '#d6daf0',\r\n    get_next_image: function(img,top){\r\n      var imgs = Array.prototype.slice.call(cataLog.parent.getElementsByClassName('post-image')).filter(function(v){return v.src.substr(-5,5)!=='.webm';});\r\n//      var imgs = cataLog.parent.getElementsByClassName('post-image');\r\n//      var imgs = cataLog.parent.querySelectorAll('img[id^=\"thumbnail\"]');\r\n      return site2['DEFAULT'].get_next_image(img,top,imgs);\r\n    },\r\n    get_time_of_posts : function(doc){\r\n      var posts = doc.getElementsByClassName('post');\r\n      return [Date.parse(posts[posts.length-1].getElementsByTagName('time')[0].getAttribute('datetime')),\r\n              Date.parse(posts[0             ].getElementsByTagName('time')[0].getAttribute('datetime'))];\r\n    },\r\n////////    get_thread_link : function(pn,bn,del,name){\r\n////////      var as = pn.getElementsByClassName('post op')[0].getElementsByTagName('a');\r\n////////      var hrefs = [];\r\n////////      var href;\r\n////////      for (var i=as.length-1;i>=0;i--) if (as[i].innerHTML==='[Reply]' || as[i].innerHTML==='[Last 50 Posts]') {\r\n////////        var href = as[i].getAttribute('href');\r\n////////        if (hrefs.length==0 || as[i].innerHTML==='[Reply]') hrefs.unshift(href);\r\n////////        else hrefs.push(href);\r\n////////        if (del) as[i].parentNode.removeChild(as[i]);\r\n////////        else {\r\n//////////          as[i].setAttribute('target',(pref.catalog_open_in_new_tab)? '_blank' : '_self');\r\n//////////          as[i].setAttribute('onclick','open_new_thread('+as[i].getAttribute('href')+','+name+')');\r\n////////          as[i].addEventListener('click', function(){open_new_thread(as[i].getAttribute('href'),name);}, false);\r\n//////////          as[i].removeAttribute('href');\r\n////////        }\r\n////////      }\r\n////////      return (hrefs.length!=0)? hrefs : null;\r\n////////    },\r\n    modify_thread_link : function(pn){\r\n      var as = pn.getElementsByClassName('post op');\r\n      if (as.length==0) return [];\r\n      var retval = [];\r\n      as = as[0].getElementsByTagName('a');\r\n      for (var i=as.length-1;i>=0;i--) \r\n        if (as[i].innerHTML=='[Reply]' || as[i].innerHTML=='[Last 50 Posts]') {\r\n          var href = as[i].getAttribute('href');\r\n          if (href) {\r\n            retval.push([as[i],href]);\r\n//            as[i].addEventListener('click', make_open_new_thread_callback(href,name), false);\r\n//            as[i].addEventListener('click', function(){open_new_thread(href,name);}, false);\r\n            as[i].removeAttribute('href');\r\n          }\r\n        }\r\n      return retval;\r\n    },\r\n//    add_thread_link : function(doc,url){\r\n//      var pn = document.createElement('a');\r\n//      pn.href = url.replace(new RegExp('/https*:\\/\\/'+site2['8chan'].domain_url+'/'),'');\r\n//      pn.innerHTML = '[Reply]';\r\n//      var th = doc.getElementsByClassName('post op')[0];\r\n//      if (th) th.insertBefore(pn,th.firstChild);\r\n//    },\r\n    catalog_threads_in_page : function(doc){ // patch\r\n      var doc_obj = {domain:site.nickname, pn:doc};\r\n      var ths = this.parse_funcs['page_html'].ths(doc_obj);\r\n      for (var i=0;i<ths.length;i++) ths[i] = ths[i].pn;\r\n      return ths;\r\n    },\r\n//    catalog_threads_in_page : function(doc){return this.parse_funcs['page_html'].ths(doc);},\r\n//    catalog_threads_in_page : function(doc){\r\n//      var pc = doc.getElementsByName('postcontrols');\r\n//      th = [];\r\n//      if (pc.length!=0)\r\n//        for (var i=0;i<pc[0].childNodes.length;i++)\r\n//          if (pc[0].childNodes[i].id && pc[0].childNodes[i].id.substr(0,6)=='thread') th.push(pc[0].childNodes[i]);\r\n//      return th;\r\n//    },\r\n    remove_posts : function(th,end){\r\n      site2.common.remove_by_classname(th,'post reply',end,true);\r\n//      site2.common.remove_double_br(th);\r\n    },\r\n    remove_files_info : function(th){\r\n      site2.common.remove_by_classname(th,'fileinfo');\r\n      site2.common.move_up_and_delete_parent(th.getElementsByClassName('post-image'));\r\n    },\r\n//    site.catalog_files_info = function(doc){return doc.getElementsByClassName('fileinfo');};\r\n//    site.catalog_delete_checkboxs = function(doc){return doc.getElementsByClassName('delete');};\r\n//    remove_checkboxes : function(doc){\r\n//      var cbxs = doc.getElementsByClassName('delete');\r\n//      for (var i=cbxs.length-1;i>=0;i--) cbxs[i].outerHTML = '';\r\n//      return doc;\r\n//    },\r\n    postform_rules : null,\r\n    thread_keyword : 'res',\r\n    max_page : function(){return 15;},\r\n    make_url4 : function(dbt){\r\n      var url_prefix = this.protocol + '//' + this.domain_url + dbt[1];\r\n//      if (dbt[3]==='page_json') dbt[3] = 'page_html'; // TEMPORAL PATCH\r\n      if      (dbt[3]==='page_html')    return [url_prefix + ((dbt[2]!=0)? (parseInt(dbt[2],10)+1) :'index')+'.html', 'html'];\r\n      else if (dbt[3]==='page_json')    return [url_prefix +                parseInt(dbt[2],10)             +'.json', 'json'];\r\n      else if (dbt[3]==='catalog_json') return [url_prefix + 'catalog.json', 'json'];  // Doesn't contain information about webm thumbnail.\r\n      else if (dbt[3]==='catalog_html') return [url_prefix + 'catalog.html', 'html'];\r\n      else if (dbt[3]==='thread_html')  return [url_prefix + 'res/' + dbt[2] + '.html', 'html'];\r\n      else if (dbt[3]==='thread_json')  return [url_prefix + 'res/' + dbt[2] + '.json', 'json'];\r\n    },\r\n////////    make_url : function(board,no,key){ // working code.\r\n////////      var url_prefix = site2['8chan'].protocol + '//' + site2['8chan'].domain_url + board;\r\n////////      if (key==='p') return [url_prefix + ((no!=0)? (no+1) :'index')+'.html', 'html'];\r\n////////      else if (key==='j') return [url_prefix + 'catalog.json', 'json'];  // Doesn't contain information about webm thumbnail.\r\n////////      else return [url_prefix + 'catalog.html', 'html'];\r\n////////    },\r\n//////////    make_url3: function(board,th){return site2['8chan'].protocol + '//' + site2['8chan'].domain_url + board + 'res/' + th + '.html';},\r\n////////    make_url3: function(board,th){return site2['8chan'].protocol + '//' + site2['8chan'].domain_url + board + 'res/' + ((th[0]!=='t')? (th + '.html') : (th.substr(1) + '.json'));},\r\n//////////    make_url3: function(board,th){\r\n//////////      return [site2['8chan'].protocol + '//' + site2['8chan'].domain_url + board + 'res/' + ((th[0]!=='t')? (th + '.html') : (th.substr(1) + '.json')), (th[0]!=='t')? 'html' : 'json'];\r\n//////////    },\r\n    url_boards_json : function(){return [site2['8chan'].protocol + '//' + site2['8chan'].domain_url + '/boards.json','json'];},\r\n//    enumerate_boards_to_scan:function(){\r\n//      var obj = [];\r\n//      var end = (site3[site.nickname].boards.length > pref.scan.max)? pref.scan.max : site3[site.nickname].boards.length;\r\n//      for (var i=0;i<end;i++) \r\n//        if (site3[site.nickname].boards[i].max) obj[obj.length] = '/'+site3[site.nickname].boards[i].uri+'/';\r\n//      return obj;\r\n//    },\r\n    get_ops : function(doc){\r\n      var op_containers = doc.getElementsByClassName('post op');\r\n      var ops = [];\r\n//      for (var i=0;i<op_containers.length;i++) ops.push(op_containers[i].getElementsByTagName('input')[0].id.substring(7));\r\n      for (var i=0;i<op_containers.length;i++) ops.push(parseInt(op_containers[i].id.substring(3),10));\r\n      return ops;\r\n    },\r\n    get_posts : function(doc) {\r\n      var posts = [];\r\n//      var deletes = doc.getElementsByClassName('delete');\r\n//      for (var i=0;i<deletes.length;i++) posts.push(deletes[i].id.substr(7));\r\n      var nos = doc.getElementsByClassName('post_no');\r\n      for (var i=0;i<nos.length;i++) if (nos[i].id) posts.push(parseInt(nos[i].id.substr(8),10));\r\n      return posts;\r\n    },\r\n//    absolute_link : function(doc){\r\n//      var all = doc.getElementsByTagName('*');\r\n//      var tgts = ['src','href'];\r\n//      for (var i=0;i<all.length;i++) {\r\n//        for (var j=0;j<tgts.length;j++) {\r\n//          var tgt = all[i].getAttribute(tgts[j]);\r\n//          if (tgt && tgt.indexOf('http')!=0  && tgt.substr(0,2)!='//')  all[i].setAttribute(tgts[j],site2['8chan'].protocol + '//' + site2['8chan'].domain_url + tgt);\r\n//        }\r\n//      }\r\n//    },\r\n//    absolute_link : function(doc){\r\n//      var all = doc.getElementsByTagName('*');\r\n//      for (var i=0;i<all.length;i++) {\r\n//        if (all[i].getAttribute('src')  && all[i].getAttribute('src').indexOf('http')!=0  && all[i].getAttribute('src').substr(0,2)!='//')  all[i].setAttribute('src',site2['8chan'].protocol + '//' + site2['8chan'].domain_url + all[i].getAttribute('src'));\r\n//        if (all[i].getAttribute('href') && all[i].getAttribute('href').indexOf('http')!=0 && all[i].getAttribute('href').substr(0,2)!='//') all[i].setAttribute('href',site2['8chan'].protocol + '//' + site2['8chan'].domain_url + all[i].getAttribute('href'));\r\n//      }\r\n//    },\r\n////////    insert_footer : function(th,page_no,bn,exe,date,nof_posts,nof_files){\r\n////////      var key = (!brwsr.ff)? 'innerText' : 'innerHTML';\r\n////////      nof_posts += th.getElementsByClassName('post').length;\r\n////////      nof_files += th.getElementsByClassName('fileinfo').length;\r\n////////      var om_info = th.getElementsByClassName('omitted');\r\n////////      if (om_info[0]) {\r\n////////        var str = om_info[0][key].replace(/\\n/g,'');\r\n////////        nof_posts += parseInt(str.replace(/\\ post.*/,''),10);\r\n////////        nof_files += parseInt('0'+str.replace(/\\ image.*/,'').replace(/[^\\ ]*\\ /g,''),10);\r\n////////      }\r\n////////      if (exe) {\r\n////////        var pn = document.createElement('div');\r\n////////        pn.setAttribute('name','catalog_footer');\r\n////////        if (pref.catalog_footer_br) pn.setAttribute('style','clear:both');\r\n////////        pn.innerHTML = '<span>' + bn + '  ' + nof_posts + '/' + nof_files + '/' + page_no + '  </span>';\r\n//////////        pn.innerHTML = '<span><span>' + bn + '  </span><span></span><span>' + nof_posts + '/' + nof_files + '/' + page_no + '  </span></span>';\r\n////////        var flags = th.getElementsByClassName('flag');\r\n////////        for (var i=0;i<flags.length;i++) {\r\n////////          pn.appendChild(flags[i].cloneNode(false));\r\n//////////          pn.appendChild(document.createTextNode(' '));\r\n////////        }\r\n////////        th.insertBefore(pn,th.getElementsByClassName('post op')[0]);\r\n////////      }\r\n////////      return [nof_posts,nof_files];\r\n////////    },\r\n////////    insert_footer2 : function(th,type,nums,nums2){\r\n////////      var str_add = ((pref.catalog_footer_show_nof_rep_to_me)? nums[1]+'/' : '' ) +(nums2[2]-nums[2]);\r\n////////      if (type==='page') {\r\n////////        var footer = th.getElementsByTagName('div')['catalog_footer'];\r\n//////////        footer.childNodes[0].childNodes[1].innerHTML = nums[1] + '/' + (nums2[2]-nums[2]) + '/';\r\n//////////        footer.childNodes[0].innerHTML = footer.childNodes[0].innerHTML.replace(/  /,'  '+ nums[1] + '/' + (nums2[2]-nums[2]) + '/');\r\n////////        var str = footer.childNodes[0].innerHTML;\r\n////////        var fields = str.replace(/[^ ]*  /,'').split('/');\r\n////////        if (fields.length>3) fields.splice(0,fields.length-3);\r\n////////        footer.childNodes[0].innerHTML = str.replace(/  .*/,'  ') + ((nums[0]>=0)? str_add + '/' :'') + fields.join('/');\r\n////////      } else {\r\n////////        var footer = th.getElementsByTagName('strong')[0];\r\n////////        footer.childNodes[0].innerHTML = (nums[0]>=0)? 'U: '+ str_add + ' / ' : '';\r\n////////      } \r\n////////    },\r\n//    prep_footer3 : function(footer,board){\r\n////      th.footer.setAttribute('name',pref.script_prefix+'_footer');\r\n//      if (pref.catalog_footer_show_board_name) {\r\n////        footer.innerHTML = '<span name=\"'+pref.script_prefix+'_footer\">' + footer.innerHTML +'</span>' + '&emsp;' + board;\r\n//        footer.innerHTML = '<span>' + footer.innerHTML + '</span>' + '&emsp;' + board;\r\n//        footer = footer.childNodes[0];\r\n//      }\r\n//      return footer;\r\n//    },\r\n//    insert_footer3 : function(footer,nums,nums2){\r\n//      var str_add = ((pref.catalog_footer_show_nof_rep_to_me)? nums[1]+'/' : '' ) +(nums2[2]-nums[2]);\r\n//      var str = (pref.catalog_footer_design==='native')? ((nums[0]>=0)? 'U: '+ str_add + ' / ' : '') + 'R: '+(nums2[2]-1) + ' / I: '+nums2[3]\r\n//                                                       : ((nums[0]>=0)? str_add + '/' : '') + nums2[2] + '/'+nums2[3]; // trial.\r\n//      footer.innerHTML = str;\r\n//    },\r\n////////    check_reply_to_me : function(name,dbt,nums,value,date,pool){\r\n////////      var obj ;\r\n////////      var time_check = (nums[6]==nums[0])? nums[3] : nums[0];\r\n////////      if (dbt[2][0]==='t') {\r\n////////        obj = ('response' in value)? value.response.posts : JSON.parse(value.responseText).posts;\r\n////////        var images = 0;\r\n////////        for (var i=0;i<obj.length;i++) {\r\n////////          if ('filename' in obj[i]) images++;\r\n////////          if (obj[i].extra_files) for (var j=0;j<obj[i].extra_files.length;j++) if ('filename' in obj[i].extra_files[j]) images++;\r\n////////          obj[i].time *= 1000;\r\n//////////obj[i].time += - pref.localtime_offset*3600000; // BUG PATCH.\r\n////////          if (obj[i].ext==='.jpeg' || obj[i].ext==='.gif') obj[i].ext = '.jpg';\r\n////////          if (obj[i].filename) obj[i].icon =  'https://' + site2['8chan'].domain_url + dbt[1] + 'thumb/' + obj[i].tim + obj[i].ext;\r\n////////        }\r\n////////        obj[0].images = images;\r\n//////////        if (obj[obj.length-1].ext==='.jpeg' || obj[obj.length-1].ext==='.gif') obj[obj.length-1].ext = '.jpg';\r\n//////////        if (obj[obj.length-1].filename) obj[obj.length-1].icon =  'https://' + site2['8chan'].domain_url + dbt[1] + 'thumb/' + obj[obj.length-1].tim + obj[obj.length-1].ext;\r\n////////        pool.sticky = obj[0].sticky;\r\n////////      } else obj = site2['8chan'].get_posts2(value,pool,time_check);\r\n//////////      date = [obj[obj.length-1].time, date[1], obj.length, obj[0].images];\r\n//////////      date[0] = obj[obj.length-1].time; // CAUSE BUG IN PAGE, THIS PREVENT REVISING POST'S INFO FOR POPUPS. AND MUST BE FIXED TIMEZONE MISUNDERSTOOD.\r\n//////////if (date[4] != obj[obj.length-1].time) console.log('find: '+name+', '+date[4]+' -> '+obj[obj.length-1].time+', '+(obj[obj.length-1].time-date[4]));\r\n////////      date[4] = obj[obj.length-1].time;\r\n//////////                            IF UNCOMMENT, CAUSE BLINKS BECAUSE USING DIFFERENT METHOD TO EVALUATE,\r\n//////////                            IF COMMENT, DELAYS UPDATE AND CAUSE BUG IN PAGE MODE.\r\n//////////      date[2] = obj.length; // CAUSE BUG IN PAGE, THIS CAUSE INCONSISTENCY BETWEEN FOOTER AND POPUP COMMENTS.\r\n//////////      date[3] = obj[0].images; // CAUSE BUG IN PAGE, THIS CAUSE INCONSISTENCY BETWEEN FOOTER AND POPUP COMMENTS.\r\n////////\r\n//////////      var i = 0;\r\n//////////      while (i<obj.length && (!obj[i] || obj[i].time<=time_check)) i++;\r\n////////      var i = obj.length;\r\n////////      while (i-1>=0 && obj[i-1] && obj[i-1].time>time_check) i--;\r\n//////////console.log(name+', '+obj.length+', '+(obj.length-i));\r\n//////////      nums[2] = i;\r\n////////      var rep_to_me = (nums[6]==nums[0])? nums[1] : 0;\r\n////////      var rep       = (nums[6]==nums[0])? nums[7] : 0;\r\n////////      nums[4] = [];\r\n////////      if (nums[3]<nums[0]) nums[3]=nums[0];\r\n////////      if (i<obj.length ) {\r\n////////        while (i<obj.length) {\r\n////////          if (pref.catalog_footer_ignore_my_own_posts && (dbt[1]+obj[i].no in site3['8chan'].own_posts)) {i++;continue;}\r\n////////          rep++;\r\n//////////          if (obj[i].time>nums[3]) nums[4].push({icon:obj[obj.length-1].icon, body:obj[obj.length-1].com, time:obj[obj.length-1].time, to_me:false});\r\n////////          if (obj[i].time>nums[3]) nums[4].push({icon:obj[i].icon, body:obj[i].com, time:obj[i].time, to_me:false});\r\n////////          var tgts = [];\r\n////////          if (obj[i].com) {\r\n////////            var anchors = obj[i].com.match(/&gt;&gt;[0-9]+/g);\r\n////////            if (anchors) for (var j=0;j<anchors.length;j++) tgts.push(dbt[1]+anchors[j].substr(8));\r\n////////            anchors = obj[i].com.match(/&gt;&gt;&gt;\\/[0-9A-z_\\+]+\\/[0-9]+/g);\r\n////////            if (anchors) for (var j=0;j<anchors.length;j++) tgts.push(anchors[j].substr(12));\r\n//////////console.log(tgts);\r\n////////            for (var j=0;j<tgts.length;j++) {\r\n////////              if (site3['8chan'].own_posts[tgts[j]]===null) {\r\n////////                rep_to_me++;\r\n////////                if (obj[i].time>nums[3]) nums[4][nums[4].length-1].to_me = true;\r\n//////////console.log(dbt[2]+', >>'+tgts[j]);\r\n////////                break;\r\n////////          }}}\r\n//////////          var anchors = (obj[i].com)? obj[i].com.match(/&gt;&gt;[0-9]+/g) : null; // working code.\r\n//////////          if (anchors) {\r\n//////////            for (var j=0;j<anchors.length;j++) {\r\n//////////              var tgt = anchors[j].substr(8);\r\n//////////              if (site3['8chan'].own_posts[dbt[1]+tgt]===null) {\r\n//////////                rep_to_me++;\r\n//////////                if (obj[i].time>nums[3]) nums[4][nums[4].length-1].to_me = true;\r\n////////////console.log(dbt[2]+', >>'+tgt);\r\n//////////                break;\r\n//////////          }}}\r\n//////////          anchors = (obj[i].com)? obj[i].com.match(/&gt;&gt;&gt;\\/[0-9A-z_\\+]+\\/[0-9]+/g) : null;\r\n//////////          if (anchors) {\r\n//////////            for (var j=0;j<anchors.length;j++) {\r\n//////////              var tgt = anchors[j].substr(12);\r\n//////////              if (site3['8chan'].own_posts[tgt]===null) {\r\n//////////                rep_to_me++;\r\n//////////                if (obj[i].time>nums[3]) nums[4][nums[4].length-1].to_me = true;\r\n//////////                break;\r\n//////////          }}} \r\n////////          i++;\r\n////////        }\r\n////////      }\r\n////////      nums[2] = obj.length - rep;\r\n////////      nums[1] = rep_to_me;\r\n////////      nums[3] = obj[obj.length-1].time;\r\n////////      nums[6] = nums[0];\r\n////////      nums[7] = rep;\r\n////////    },\r\n////////    get_posts2 : function(doc,pool,time_check) {\r\n////////      var obj = [];\r\n////////      var posts = doc.getElementsByClassName('post');\r\n//////////      for (var i=0;i<posts.length;i++) {\r\n////////      var i=posts.length-1;\r\n////////      while (i>=0) {\r\n////////        var image = posts[i].getElementsByClassName('post-image');\r\n////////        image = (image[0])? image[0].getAttribute('src') : undefined;\r\n////////        var time = Date.parse(posts[i].getElementsByTagName('time')[0].getAttribute('datetime'));\r\n////////        obj[i] = {\r\n////////          time: time,\r\n////////          com:  posts[i].getElementsByClassName('body')[0].innerHTML,\r\n////////          no:   parseInt(posts[i].getElementsByClassName('post_no')[0].id.substr(8),10),\r\n////////          icon: image\r\n////////        }\r\n////////        if (time<=time_check && i!=0) i=0;\r\n////////        else i--;\r\n////////      }\r\n//////////      var image = posts[posts.length-1].getElementsByClassName('post-image');\r\n//////////      obj[obj.length-1].icon = (image[0])? image[0].src : undefined;\r\n////////      var files = doc.getElementsByClassName('thread')[0].getElementsByClassName('file');\r\n//////////      for (var i=files.length-1;i>=0;i--) if (files[i].tagName!=='DIV') files[i].remove(); // slow?\r\n////////      var nof_files = 0;\r\n////////      for (var i=files.length-1;i>=0;i--) if (files[i].tagName==='DIV') nof_files++;\r\n////////      var op_images = doc.getElementsByClassName('thread')[0].getElementsByClassName('files');\r\n////////      op_images = (!op_images[0])? 0 : op_images[0].getElementsByClassName('file').length;\r\n//////////      obj[0].images = files.length - op_images;\r\n////////      obj[0].images = nof_files - op_images;\r\n////////      pool.sticky = doc.getElementsByClassName('fa-thumb-tack').length!=0\r\n////////      return obj;\r\n////////    },\r\n    get_post_offsetTop : function(doc,num) {\r\n      return doc.getElementsByClassName('post')[num].offsetTop;\r\n    },\r\n    get_icon : function(pn,type,kind,tgt_th16){\r\n      return (type==='catalog')? this.add_icon(pn,type,kind,tgt_th16) :\r\n             (kind==='sticky')? pn.getElementsByClassName('fa-thumb-tack')[0] :\r\n             null;\r\n    },\r\n    add_icon : function(pn,type,kind,tgt_th16){\r\n      if (pn) {\r\n        var del_tgt = tgt_th16['icon_'+kind];\r\n        if (!del_tgt) {\r\n          var count = 0;\r\n          if (tgt_th16['icon_sticky']) count++;\r\n          if (tgt_th16['icon_show_always']) count++;\r\n          var icon = document.createElement('i');\r\n          icon.setAttribute('class',(kind==='sticky')? 'fa fa-thumb-tack' : 'fa');\r\n          if (kind==='show_always') icon.textContent = '\\u2605';\r\n          var ref;\r\n          if (type==='catalog') {\r\n            icon.setAttribute('style','position:absolute;left:' + (16*count) + 'px');\r\n            ref = pn.getElementsByClassName('thread')[0];\r\n            ref.insertBefore(icon,ref.firstChild);\r\n          } else {\r\n            var op = pn.getElementsByClassName('op')[0];\r\n            ref = op.getElementsByClassName('mentioned')[0] || op.getElementsByClassName('post_no')[1].nextSibling;\r\n//            ref = pn.getElementsByClassName('mentioned')[0] || Array.prototype.filter.call(pn.getElementsByTagName('a'),function(dom){return dom.textContent==='[Reply]';})[0];\r\n            ref.parentNode.insertBefore(icon,ref);\r\n          }\r\n          return icon;\r\n        } else del_tgt.parentNode.removeChild(del_tgt);\r\n      }\r\n      return null;\r\n    },\r\n//    add_icon : function(th,type,kind,tgt_th16){\r\n//      if (type==='catalog') {\r\n//        var parent = th.getElementsByClassName('thread')[0];\r\n//        if (parent) {\r\n//          var del_tgt = tgt_th16['icon_'+kind];\r\n//          if (!del_tgt) {\r\n//            var count = 0;\r\n//            if (tgt_th16['icon_sticky']) count++;\r\n//            if (tgt_th16['icon_show_always']) count++;\r\n//            var icon = document.createElement('i');\r\n//            icon.setAttribute('class',(kind==='sticky')? 'fa fa-thumb-tack' : 'fa');\r\n//            icon.setAttribute('style','position:absolute;left:' + (16*count) + 'px');\r\n//            if (kind==='show_always') icon.textContent = '\\u2605';\r\n//            parent.insertBefore(icon,parent.firstChild);\r\n//            return icon;\r\n//          } else del_tgt.parentNode.removeChild(del_tgt);\r\n//        }\r\n//      }\r\n//      return null;\r\n//    },\r\n    favicon: {\r\n      get_favicon: function(){\r\n        var links = document.getElementsByTagName('head')[0].getElementsByTagName('link');\r\n        for (var i=0;i<links.length;i++) if (links[i].getAttribute('rel')=='shortcut icon') return links[i];\r\n        var pn = document.createElement('link');\r\n        pn.setAttribute('rel','shortcut icon');\r\n        pn.setAttribute('href',this.none);\r\n        pn.setAttribute('type','image/x-icon');\r\n        return document.getElementsByTagName('head')[0].appendChild(pn);\r\n      },\r\n      get_title: function(){\r\n        var title = document.getElementsByTagName('head')[0].getElementsByTagName('title')[0];\r\n        if (!title){\r\n          title = document.createElement('title');\r\n          title = document.getElementsByTagName('head')[0].appendChild(title);\r\n        }\r\n        return title;\r\n      },\r\n      none: '/favicon.ico',\r\n      reply: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAQElEQVR42mNgGEbg/5n/GJgYORQFDQ0IjK4BmxxWzehsQnJYBdFtxCWH1QBcrkKWw2sAWS6gKAwojgWqpIORDQBVkjfW5KYpFQAAAABJRU5ErkJggg==',\r\n      reply_to_me: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAWUlEQVR42mNgAIH/Z/4zNDRgYpA4UQBqADIYZAaAaHRMtAEwjB42cEPQFaCzCclhFcQWK9jk0A1A8QJW2xgYiDeAJBdQFAbYAhLdRryxgByVuOKaYDoY2QAAcHCIXLRHYMUAAAAASUVORK5CYII='\r\n    },\r\n//    get_op_image_url: function(th,type){\r\n//      var img = th.getElementsByTagName('img')[0];\r\n//      return (img)? img.src : undefined; // patch.\r\n//    },\r\n    time_revised_check: function(nof_ths){return nof_ths>300;},\r\n    format_thread_layout : function(th){\r\n      site2.common.add_attribute_by_tagname(th,'img','style','margin:0px');\r\n      site2.common.add_attribute_by_tagname(th,'iframe','style','margin:0px');\r\n      site2.common.add_attribute_by_classname(th,'post','style','padding:0px');\r\n      site2.common.add_attribute_by_classname(th,'intro','style','margin:0px');\r\n      site2.common.add_attribute_by_classname(th,'body','style','margin:12px 5px');\r\n    },\r\n    format_thread_contents : function(th){\r\n      site2.common.remove_by_classname(th,'delete');\r\n//      site2.common.remove_by_tagname(th,'hr');\r\n//      site2.common.remove_by_tagname(th,'br');\r\n      site2.common.remove_by_classname(th,'omitted');\r\n    },\r\n    localtime: function(pn){\r\n      var times = pn.getElementsByTagName('time');\r\n      for (var i=0;i<times.length;i++) times[i].textContent = site2.common.change_utc_to_local(times[i].getAttribute('datetime'));\r\n    },\r\n    format_remove_tn_area_size: function(th){\r\n      var files = th.getElementsByClassName('file');\r\n      for (var i=0;i<files.length;i++){\r\n        var file_style = files[i].getAttribute('style');\r\n        if (file_style) {\r\n          file_style = ((file_style)? file_style + ';' : '') + 'float:left;';\r\n          if (file_style.indexOf('width')!=-1) file_style = file_style.replace(/width:[^;]*(;|$)/,'');\r\n          if (file_style.indexOf('height')!=-1) file_style = file_style.replace(/height:[^;]*(;|$)/,'');\r\n          files[i].setAttribute('style',file_style);\r\n        }\r\n      }\r\n    },\r\n    get_time_of_post_in_utc : function(post){\r\n      return Date.parse(post.getElementsByTagName('time')[0].getAttribute('datetime'));\r\n    },\r\n    mark_newer_posts: function(th,date,unmark) {\r\n//      return site2.common.mark_newer_posts('8chan',th.getElementsByClassName('post'),date,'border:2px solid red','border: none','class','post');\r\n      return site2['DEFAULT'].mark_newer_posts('8chan',th.getElementsByClassName('post'),date,'border:2px solid red','border: none',null,null,unmark);\r\n    },\r\n//    unmark_post_from_event: function() {\r\n//      this.setAttribute('style','border: none');\r\n//      this.removeEventListener('mouseover', site2['8chan'].unmark_post_from_event, false);\r\n//    },\r\n//    mark_newer_posts : function(th,date){\r\n//      var marked_first_post = null;\r\n////      var offset_top = 0;\r\n//      var times = th.getElementsByTagName('time');\r\n//      for (var i=times.length-1;i>=0;i--) {\r\n//        var mark = date<Date.parse(times[i].getAttribute('datetime'))-pref.localtime_offset*3600000;\r\n//        var reply = times[i].parentNode;\r\n//        while (reply.className.search(/post/)==-1) reply = reply.parentNode;\r\n//        if (mark) {\r\n//          reply.setAttribute('style','border: 2px solid red');\r\n//          marked_first_post = reply;\r\n////          offset_top = reply.offsetTop;\r\n//        } else reply.setAttribute('style','border: none');\r\n//      }\r\n////      return offset_top;\r\n//      return marked_first_post;\r\n//    },\r\n    get_owners_recommendation: function(){\r\n      var blotter = document.getElementsByClassName('blotter')[0];\r\n      if (blotter) {\r\n        or_str = document.getElementsByClassName('blotter')[0][brwsr.innerText];\r\n        var kwd = 'Recommendation: ';\r\n        var idx = or_str.indexOf(kwd);\r\n        if (idx!=-1) return or_str.substr(idx+kwd.length);\r\n      }\r\n      return '';\r\n    },\r\n////////    thread2headline : function(doc){\r\n////////      return site2.common.thread2headline(doc,'8chan');\r\n////////    },\r\n//    get_json_url_thread: function(board,thread){\r\n//      return site2['8chan'].protocol + '//8chan.co' + board +'res/' + thread + '.json';\r\n//    },\r\n    get_json_url_catalog: function(board){\r\n      return site2['8chan'].protocol + '//' + site2['8chan'].domain_url + board +'catalog.json';\r\n    },\r\n    thread2search_obj: function(th){\r\n      var coms  = aggregate_info(th.getElementsByClassName('body'));\r\n      var subs  = aggregate_info(th.getElementsByClassName('subject'));\r\n      var names = aggregate_info(th.getElementsByClassName('name'));\r\n\r\n      var files = th.getElementsByClassName('files');\r\n      var filenames = ['',''];\r\n      if (files.length!=0) {\r\n        for (var i=0;i<files.length;i++) {\r\n          var files_in_post = files[i].getElementsByClassName('unimportant');\r\n          filenames[i] = '';\r\n          for (var j=0;j<files_in_post.length;j++) {\r\n            if (files_in_post[j].getElementsByTagName('a').length!=0) filenames[i] = filenames[i] + files_in_post[j].getElementsByTagName('a')[0][brwsr.innerText] + '\\n';\r\n            if (files_in_post[j].getElementsByTagName('span').length!=0) filenames[i] = filenames[i] + files_in_post[j].getElementsByTagName('span')[0][brwsr.innerText] + '\\n';\r\n          }\r\n        }\r\n        for (var i=2;i<filenames.length;i++) filenames[1] = filenames[1] + filenames[i] + '\\n';\r\n        if (files[0].parentNode!=th) {\r\n          filenames[1] = filenames[0] + '\\n' + filenames[1];\r\n          filenames[0] = '';\r\n        }\r\n      }\r\n      return [coms[0], subs[0], names[0], filenames[0], coms[1], subs[1], names[1], filenames[1]];\r\n\r\n      function aggregate_info(pns){\r\n        if (pns.length!=0) {\r\n          var parent = pns[0].parentNode;\r\n          while (parent.classList.contains('post')) parent = parent.parentNode;\r\n          var op_idx = (!parent.classList.contains('op'))? 0 : -1;\r\n          var op = (op_idx>=0)? pns[0][brwsr.innerText] : '';\r\n          var posts = '';\r\n          for (var i=op_idx+1;i<pns.length;i++) posts = posts + pns[i][brwsr.innerText] + '\\n';\r\n          return [op, posts];\r\n        } return ['',''];\r\n      }\r\n    },\r\n    parse_json_thread: function(txt,from_http){\r\n      var obj = {posts: []};\r\n      var uids = {};\r\n      var nof_uids = 0;\r\n      var posts = document.getElementsByClassName('post');\r\n      for (var i=0;i<posts.length;i++) {\r\n        obj.posts[i] = {};\r\n        obj.posts[i].no = posts[i].id.replace(/op_/,'').replace(/reply_/,'');\r\n        var id = posts[i].getElementsByClassName('poster_id')[0].textContent;\r\n        obj.posts[i].id = id;\r\n        if (uids[id]===undefined) {\r\n          nof_uids++;\r\n          uids[id] = 1;\r\n        }\r\n        obj.posts[i].unique_ips = nof_uids;\r\n      }\r\n      return obj;\r\n    },\r\n    uip_check: function(callback){\r\n      callback(0,200,'');\r\n    },\r\n    uip_tgt_post : function(no){\r\n      var pn = document.getElementById('reply_'+no);\r\n      if (pn) return pn;\r\n      else return document.getElementById('op_'+no);\r\n    },\r\n    uip_post_num : function(tgt_post){\r\n      return tgt_post.getElementsByClassName('intro');\r\n    },\r\n//    catalog_native_prep0: function(threads,callback,pn_filter,pn_tb,func_sel){\r\n////      var node_ref = document.getElementsByClassName('catalog_search')[0].nextSibling;  // FF doesn't work.\r\n//      var node_ref = document.getElementsByClassName('threads')[0];\r\n//      node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n//      node_ref.parentNode.insertBefore(pn_filter,node_ref);\r\n//\r\n//      site2['8chan'].catalog_from_native(Date.now(),document,threads,null);\r\n//\r\n//      document.getElementById('sort_by').addEventListener('change',func_event,false);\r\n//      return function(){document.getElementById('sort_by').removeEventListener('change',func_event,false);};\r\n//      function func_event(){\r\n//        pref.catalog.indexing = document.getElementById('sort_by').selectedIndex;\r\n//        func_sel();\r\n//      }\r\n//\r\n////      var mixs = document.getElementsByClassName('mix');\r\n////      var date_load = Date.now();\r\n////      for (var i=0;i<mixs.length;i++) site2['8chan'].catalog_from_native_1(threads,mixs[i],date_load);\r\n////      for (var i=0;i<mixs.length;i++) {\r\n////        var url  = mixs[i].getElementsByTagName('a')[0].href;\r\n////        mixs[i].getElementsByTagName('a')[0].removeAttribute('href');\r\n////        var name = url.replace(/.*8chan\\.co/,'8chan').replace(/res\\//,'').replace(/\\.html/,'');\r\n////        var date = [0,0,0,0];\r\n////        var date_load = 0;\r\n////        var page_no = 0;\r\n////        threads[name] = [mixs[i], false, null,\r\n////                         [mixs[i].innerHTML, '8chan'],\r\n////                         mixs[i][brwsr.innerText], null, null, url, date, true,\r\n////                         null,\r\n////                         null, null, date_load, page_no, 0];\r\n////      }\r\n////      http_req.get('catalog',site.nickname+site.board,site.protocol+'//8chan.co'+site.board+'catalog.json',site2['8chan'].catalog_from_json,false,false,[threads,callback,null,site.board]);\r\n//    },\r\n    catalog_native_prep: function(date,pn_filter,pn_tb,pn_hi, embed_catalog){\r\n//      var node_ref = document.getElementsByClassName('catalog_search')[0].nextSibling;  // FF doesn't work.\r\n      var node_ref = (site.whereami==='catalog')? document.getElementsByClassName('threads')[0]\r\n                                                : document.getElementsByName('postcontrols')[0];\r\n      site4.tb_prep_for_embed(pn_tb);\r\n      if (site.whereami==='catalog') {\r\n        var selector_native = document.getElementById('sort_by');\r\n        if (selector_native.selectedIndex!=0) {\r\n          selector_native.selectedIndex = 0;\r\n          var evt = document.createEvent('UIEvents');\r\n          evt.initUIEvent('change', false, true, window, 1);\r\n          selector_native.dispatchEvent(evt);\r\n        }\r\n        selector_native.style.display = 'none';\r\n        document.getElementById('image_size').addEventListener('change', site2['8chan'].catalog_native_size_changed, false);\r\n        var pn_tb_new = document.createElement('span');\r\n        while (pn_tb.firstChild) pn_tb_new.appendChild(pn_tb.firstChild);\r\n        pn_tb = pn_tb_new;\r\n        pn_tb.appendChild(pn_tb.removeChild(pn_tb.childNodes[3]).firstChild);\r\n      } else if (site.whereami==='page') {\r\n        var pctrls = document.getElementsByName('postcontrols')[0];\r\n        if (!pref.catalog_expand_with_hr || embed_catalog) {for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.removeChild(pctrls.childNodes[i]);}\r\n        else for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.childNodes[i].setAttribute('class',pref.script_prefix+'_hs');\r\n        pctrls.parentNode.insertBefore(document.createElement('hr'),pctrls.nextSibling);\r\n      }\r\n//      node_ref.parentNode.insertBefore(pn_hi,node_ref);\r\n      node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n      node_ref.parentNode.insertBefore(pn_filter,node_ref);\r\n      var selector_catchan = pn_filter.getElementsByTagName('select')['catalog.indexing'];\r\n      if (site.whereami==='catalog') selector_native.parentNode.insertBefore(selector_catchan,selector_native);\r\n      else pn_tb.childNodes[3].insertBefore(selector_catchan,pn_tb.childNodes[3].firstChild);\r\n//      pn_tb.childNodes[0].setAttribute('style',pn_tb.childNodes[0].getAttribute('style')+';display:none');\r\n//      pn_tb.childNodes[1].setAttribute('style',pn_tb.childNodes[1].getAttribute('style')+';display:none');\r\n////////      return site2['8chan'].catalog_from_native(date,document,site.board,site.whereami+'_html');\r\n    },\r\n    catalog_native_size: (document.getElementById('image_size'))? document.getElementById('image_size').value : 'small',\r\n    catalog_native_size_changed: function(){site2['8chan'].catalog_native_size = this.value;},\r\n    catalog_get_native_area: function(){\r\n      if (site.whereami==='catalog') return document.getElementById('Grid');\r\n      return document.getElementsByName('postcontrols')[0];\r\n////      else { // working code.\r\n////        var pc = document.getElementsByName('postcontrols')[0];\r\n////        return pc.insertBefore(document.createElement('div'),pc.firstChild);\r\n////      }\r\n    },\r\n////////    catalog_from_native : function(date,doc,board,type) { // working code.\r\n////////      var ths;\r\n////////if (pref.test_mode['0']) {\r\n////////      ths = {domain:'8chan', board:board, pn:doc};\r\n////////      this.parse_funcs['catalog_html'].entry(ths,this.parse_funcs['catalog_html']['full_hier']);\r\n////////      return ths.ths;\r\n////////} else {\r\n////////////      var parse_obj = {domain:'8chan', board:board, parse_funcs:site2['8chan'].parse_funcs[type], __proto__:site4.parse_funcs_on_demand};\r\n////////////      ths = {pn:doc, __proto__:parse_obj};\r\n////////////      return ths.ths;\r\n////////      return site2[this.nickname].wrap_to_parse.get(doc, this.nickname, board, type);\r\n////////}\r\n////////    },\r\n//    catalog_from_native : function(date,doc,board) {\r\n//      var ths;\r\n//if (pref.test_mode['0']) {\r\n//      ths = {domain:'8chan', board:board, pn:doc};\r\n//      this.parse_funcs['catalog_html'].entry(ths,this.parse_funcs['catalog_html']['full_hier']);\r\n//} else {\r\n////      ths = {domain:'8chan', board:board, pn:doc, parse_funcs:this.parse_funcs['catalog_html'], __proto__:site4.parse_funcs_on_demand};\r\n//      var parse_obj = {domain:'8chan', board:board, parse_funcs:site2['8chan'].parse_funcs['catalog_html'], __proto__:site4.parse_funcs_on_demand};\r\n//      ths = {pn:doc, __proto__:parse_obj};\r\n//}\r\n//      return ths.ths;\r\n//    },\r\n//    catalog_from_native : function(date,doc,board) {\r\n//      var mixs = doc.getElementsByClassName('mix');\r\n//      var ths = [];\r\n////      for (var i=0;i<mixs.length;i++) {\r\n////        ths.push(site2['8chan'].catalog_from_native_1(mixs[i]));\r\n////        if (mixs[i].parentNode) mixs[i].parentNode.removeChild(mixs[i]);\r\n////      }\r\n////var time_in = Date.now();\r\n//      for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV') ths.push(site2['8chan'].catalog_from_native_1(mixs[i],board));\r\n////console.log('aaa: '+(Date.now()-time_in));\r\n////      for (var i=0;i<ths.length;i++) if (ths[i].pn.parentNode) ths[i].pn.parentNode.removeChild(ths[i].pn);\r\n//      return ths;\r\n//    },\r\n//    catalog_from_native_1 : function(th,board) {\r\n//      th.getElementsByTagName('a')[0].removeAttribute('href');\r\n//      var sub = th.getElementsByClassName('subject');\r\n//      sub = (sub[0])? sub[0].textContent : '';\r\n//      var opn = th.getElementsByTagName('img')[0].getAttribute('data-name');\r\n//      var op = th[brwsr['innerText']].replace(th.getElementsByTagName('strong')[0][brwsr['innerText']],'');\r\n//      if (sub!=='') op = op.replace(sub,'');\r\n////      if (pref.catalog_footer_show_board_name) th.getElementsByTagName('strong')[0].innerHTML = '<span></span>' + th.getElementsByTagName('strong')[0].innerHTML + '&emsp;' + board;\r\n//      return {\r\n//        pn: th,\r\n//        exist: false,\r\n//        no: th.getElementsByTagName('img')[0].id.replace(/img\\-/,''),\r\n//        search_obj: [ op, sub, opn, '', '', '', '', ''],\r\n//        page_no: '?',\r\n//        time_bumped: (parseInt(th.getAttribute('data-bump'),10)-pref.localtime_offset*3600)*1000,\r\n//        time_created : (parseInt(th.getAttribute('data-time'),10)-pref.localtime_offset*3600)*1000,\r\n//        nof_posts: parseInt(th.getAttribute('data-reply'),10) +1,\r\n//        nof_files: parseInt(th.getElementsByClassName('replies')[0].getElementsByTagName('strong')[0].textContent.replace(/.*I: */,''),10),\r\n////        init_func: site2['8chan'].catalog_from_native_init_elem_func,\r\n//        update_func: site2['8chan'].catalog_from_native_update_elem_func,\r\n//        board: board,\r\n//        footer: th.getElementsByTagName('strong')[0], // temporal\r\n//        domain: '8chan', // temporal\r\n//        sticky: th.getAttribute('data-sticky')==='true', // temporal\r\n//      }\r\n//    },\r\n//    catalog_from_native_init_elem_func : function(th) {\r\n//      th.setAttribute('class','mix');\r\n//      th.setAttribute('style','display: inline-block;');\r\n//    },\r\n//    catalog_from_native_update_elem_func : function(th,src) {\r\n//      th.setAttribute('data-reply',src.nof_posts);\r\n//      th.setAttribute('data-bump',src.time_bumped);\r\n//      th.setAttribute('data-time',src.time_created);\r\n//    },\r\n//    catalog_from_native_1 : function(th,board) { // working code\r\n//      var th2 = {domain:'8chan', board:board, pn:th};\r\n//      this.parse_funcs['catalog_html'].entry(th2,this.parse_funcs['catalog_html']['full_th']);\r\n//      return th2;\r\n//    },\r\n    parse_funcs : { // vichan\r\n      'catalog_html' : {\r\n//        ths: function(doc) {\r\n//          var ths = this.ths_array(doc,doc.pn.getElementsByClassName('mix'));\r\n//          for (var i=0;i<ths.length;i++) ths[i].pn.getElementsByTagName('a')[0].removeAttribute('href');\r\n//          return ths;\r\n//        },\r\n        ths: function(doc) {return this.ths_array(doc,doc.pn.getElementsByClassName('mix'));},\r\n        no : function(th){return parseInt(th.pn.getElementsByTagName('img')[0].id.substr(4),10);},\r\n        time_bumped: function(th){return parseInt(th.pn.getAttribute('data-bump'),10)*1000;},\r\n        time_created : function(th){return parseInt(th.pn.getAttribute('data-time'),10)*1000;},\r\n        nof_posts: function(th){return parseInt(th.pn.getAttribute('data-reply'),10) +1;},\r\n//        nof_files: function(th){return parseInt(th.pn.getElementsByClassName('replies')[0].getElementsByTagName('strong')[0].textContent.replace(/.*I: */,''),10);},\r\n        nof_files: function(th){return parseInt(th.pn.getElementsByTagName('strong')[0].textContent.replace(/.*I: */,''),10) +1;}, // assumes OP has 1 pic.\r\n        key: function(th){\r\n//          if (!th.hasOwnProperty('no')) th['no'] = this['no'](th);\r\nif (pref.test_mode['0']) {\r\n          if (!th.hasOwnProperty('no')) Object.defineProperty(th,'no',{value:this['no'](th), enumerable:true, configurable:true, writable:true});\r\n}\r\n          return th.domain + th.board + th.no;\r\n        },\r\n        sub: 'DEFAULT.post_html',\r\n        name: function(th){return th.pn.getElementsByTagName('img')[0].getAttribute('data-name');},\r\n        com: function(th){\r\nif (pref.test_mode['0']) {\r\n          if (!th.hasOwnProperty('sub')) th.sub = this.sub(th);\r\n}\r\n          return th.pn[brwsr.innerText].replace(th.pn.getElementsByTagName('strong')[0][brwsr.innerText],'').replace(th.sub,'');\r\n        },\r\n        footer: function(th){return th.pn.getElementsByTagName('strong')[0];},\r\n        sticky: function(th){return null;}, // patch\r\n//        format: function(th){th.pn.getElementsByTagName('a')[0].removeAttribute('href');return null;},\r\n        op_img_url: function(th){\r\n          var img = th.pn.getElementsByTagName('img')[0];\r\n          return (img)? img.getAttribute('src') : undefined; // patch.\r\n        },\r\n//        filename: function(th){return th.op_img_url;},\r\n//        missing_info: {time_posted: null, op_img_src_url: null},\r\n////        missing_info_fetch: function(th){scan.list_nup.add_board(th.domain+th.board,0,null,null,true);scan.scan('b',this.nickname)}, // BUG. catalog doesn't contain time_posted.\r\n//        missing_info_fetch: function(th){scan.list_nup.add(th.key,0);scan.scan('t',this.nickname)}, // BUG. catalog doesn't contain time_posted.\r\n        dynamic_image_hover: true,\r\n        missing_info: 2,\r\n        img2src: function(img){\r\n          var lth = this.get_lth_from_node(img);\r\n          if (!lth) return null;\r\n          var src = img.src;\r\n          if (lth.th && lth.th.ext) src = src.replace(/thumb/,'src').replace(/.[^\\.]*$/,lth.th.ext);\r\n          else if (lth.th.parse_funcs.missing_info) scan.scan_ui('image_hover', {tgts: [lth.domain+lth.board+'j0'], options:{callback:function(){cataLog.image_hover_reentry(img);}, priority:6}});\r\n          return src;\r\n        },\r\n        get_op_src: 'thread_json',\r\n      },\r\n      'catalog_json' : {\r\n        before_test : ['ths',':ITER',':ALL','ths',['key','time_bumped','nof_posts','nof_files']],\r\n        after_test  : ['time_created','pn','footer'],\r\n        full_hier   : ['ths',':ITER',':ALL','ths',['key','time_bumped','nof_posts','nof_files','pn','footer']],\r\n        ths: 'DEFAULT.catalog_json',\r\n        time_bumped: function(th){return th.last_modified*1000;},\r\n        time_created : function(th){return th.time*1000;},\r\n        nof_posts: function(th){return th.replies+1;},\r\n        nof_files: function(th){return th.images+th.omitted_images;},\r\n        key: function(th){return th.domain + th.board + th.no;},\r\n//        sub: function(th){return ('sub' in th)? th.sub : '';},\r\n//        name: function(th){return ('name' in th)? th.name : '';},\r\n//        com: function(th){return ('com' in th)? th.com : '';},\r\n//        sticky: function(th){return (th.sticky===1);}, // prevent memory leak.\r\n        sub: function(th){return (th.hasOwnProperty('sub'))? th.sub : '';},\r\n        name: function(th){return (th.hasOwnProperty('name'))? th.name : '';},\r\n        com: function(th){return (th.hasOwnProperty('com'))? th.com : '';},\r\n//        sticky: function(th){return (th.hasOwnProperty('sticky'))? th.sticky==='1' : false;},\r\n        op_img_url: 'DEFAULT.common',\r\n////        op_img_url: function(obj) { // working code.\r\n////          return site2[obj.domain].protocol + '//' + site2[obj.domain].domain_url + obj.board + 'thumb/' + obj.tim + ((obj.ext==='.jpg')? '.png' : obj.ext);\r\n//////          return this.protocol+ '//' + site2[obj.domain].domain_url + obj.board + 'thumb/' + obj.tim + ((obj.ext==='.jpg')? '.png' : obj.ext);\r\n////        },\r\n        missing_info: 1,\r\n//        missing_info: null,\r\n//        posts: 'DEFAULT.catalog_json', // DOESN'T WORK\r\n        get_op_src: 'thread_json',\r\n        time_unit: 1000,\r\n        type_com: 'html',\r\n        posts: 'DEFAULT.catalog_json',\r\n        posts_full: 'DEFAULT.catalog_json',\r\n        get_max_page: function(doc){return doc.length;},\r\n        proto: 'catalog_html',\r\n      },\r\n      'page_json' : {\r\n        has_posts: true,\r\n        nof_posts: 'DEFAULT.thread_json', // VICHAN HAS A INCONSISTENCY, thread_json doesn't provide 'replies'.\r\n        nof_files: function(th){return th.posts[0].images+th.posts[0].omitted_images;},\r\n        ths: 'DEFAULT.page_json',\r\n        proto:'thread_json'\r\n      },\r\n      'page_html' : {\r\n        before_test : ['ths',':ITER',':ALL','ths',['key','time_bumped','nof_posts','nof_files']],\r\n//        after_test  : [':ITER',':ALL','posts',['sub','name','com'],'flags'],\r\n        after_test  : ['time_created',':ITER',':ALL','posts',['sub','name','com','flag'],':ITER',':GALL','posts',['flags','flag']],\r\n        before_test_post : ['posts',':ITER',':FL','posts',['time'],'html_org','footer'],\r\n        ths: function(doc) {return this.ths_array(doc,doc.pn.querySelectorAll('div[id^=thread_]'));},\r\n        th_init: function(th){\r\n          if (site.whereami!=='page' || !pref.catalog.embed_page) th.pn.removeAttribute('class');\r\n//          var as = th.pn.querySelectorAll('.files a');\r\n//          for (var j=0;j<as.length;j++) as[j].removeAttribute('href');\r\n////          for (var j=0;j<as.length;j++) as[j].addEventListener('click',th.parse_funcs.preventDefault,false); // not debugged.\r\n        },\r\n//        th_destroy: function(pn, parse_funcs){\r\n////          var as = pn.querySelectorAll('.files a');\r\n////          for (var j=0;j<as.length;j++) as[j].removeEventListener('click',parse_funcs.preventDefault,false); // not debugged.\r\n//        },\r\n//        ths: function(doc) {\r\n//          var ths = this.ths_array(doc,doc.pn.querySelectorAll('div[id^=thread_]'));\r\n//          if (site.whereami!=='page' || !pref.catalog.embed_page) for (var i=0;i<ths.length;i++) ths[i].pn.removeAttribute('class');\r\n//          for (var i=0;i<ths.length;i++) {\r\n//            var as = ths[i].pn.querySelectorAll('.files a');\r\n//            for (var j=0;j<as.length;j++) as[j].removeAttribute('href');\r\n//          }\r\n//          return ths;\r\n//        },\r\n        no : function(th){return parseInt(th.pn.id.substring(th.pn.id.indexOf('_')+1),10);},\r\n////        post_no: 'page_html.no',\r\n        time: function(post){return Date.parse(post.pn.getElementsByTagName('time')[0].getAttribute('datetime'));},\r\n////////        time_posted: function(th){\r\n////////if (pref.test_mode['0']) {\r\n////////          if (!th.hasOwnProperty('posts')) this.entry(th,this.before_test_post);\r\n////////}\r\n////////          return th.posts[th.posts.length-1].time;\r\n////////        },\r\n        time_bumped: function(th){ // TO BE FIXED.\r\n////if (pref.test_mode['0']) {\r\n////          if (!th.hasOwnProperty('posts')) this.entry(th,this.before_test_post);\r\n////}\r\n////          return th.posts[th.posts.length-1].time;\r\n          var i=th.posts.length-1;\r\n          while (i>=0) {\r\n            var mail = th.posts[i].pn.getElementsByClassName('email')[0];\r\n            if (!mail || mail.href!=='mailto:sage') return th.posts[i].time;\r\n            i--;\r\n          }\r\n          return undefined;\r\n        },\r\n        time_created : function(th){\r\nif (pref.test_mode['0']) {\r\n          if (!th.hasOwnProperty('posts')) this.entry(th,this.before_test_post);\r\n}\r\n          return th.posts[0].time;\r\n        },\r\n        nof_posts: function(th){\r\n          var nof_posts = th.pn.getElementsByClassName('post').length;\r\n          var nof_files = th.pn.getElementsByClassName('fileinfo').length;\r\n          var om_info   = th.pn.getElementsByClassName('omitted')[0];\r\n          if (om_info) {\r\n            var str = om_info.childNodes[0].textContent.replace(/\\n/g,'');\r\n            nof_posts += parseInt(str.replace(/\\ post.*/,''),10) || 0;\r\n            nof_files += parseInt('0'+str.replace(/\\ image.*/,'').replace(/[^\\ ]*\\ /g,''),10) || 0;\r\n          }\r\n//          th.nof_files = nof_files;\r\n          Object.defineProperty(th,'nof_files',{value:nof_files, enumerable:true, configurable:true, writable:true});\r\n          return nof_posts;\r\n        },\r\n        nof_files: function(th){\r\n          if (!th.hasOwnProperty('nof_posts')) this['nof_posts'](th);\r\n          return th.nof_files;\r\n        },\r\n        key: function(th){\r\n//          if (!th.hasOwnProperty(('no')) th.no = this.no(th);\r\nif (pref.test_mode['0']) {\r\n          if (!th.hasOwnProperty('no')) Object.defineProperty(th,'no',{value:this['no'](th), enumerable:true, configurable:true, writable:true});\r\n}\r\n          return th.domain + th.board + th.no;\r\n        },\r\n        sub: 'DEFAULT.post_html',\r\n        name: function(post){\r\n          var name = post.pn.getElementsByClassName('name')[0];\r\n          return (name)? name[brwsr.innerText] : '';\r\n        },\r\n        pn_name: 'post_html',\r\n        com:  function(post){\r\n          var com = post.pn.getElementsByClassName('body')[0];\r\n          return (com)? com[brwsr.innerText] : '';\r\n        },\r\n        footer: function(th){return this.insert_footer4(th.pn.getElementsByClassName('post op')[0]);},\r\n//        footer: function(th){\r\n//          var footer = document.createElement('div');\r\n//          footer = th.pn.insertBefore(footer,th.pn.getElementsByClassName('post op')[0]);\r\n//          return footer;\r\n//        },\r\n        sticky: function(th){return (th.pn.getElementsByClassName('fa-thumb-tack').length!=0);},\r\n//        flag: function(post){return post.pn.getElementsByClassName('flag')[0];},\r\n        flag: function(post){\r\n          var flags = post.pn.getElementsByClassName('flag');\r\n          return (flags.length!=0)? document.importNode(flags[0],false) : null;\r\n        },\r\n//        flags: function(th){\r\n//          var flags = th.pn.getElementsByClassName('flag');\r\n//          var pn_flags = [];\r\n//          for (var i=0;i<flags.length;i++) pn_flags.push(flags[i].cloneNode(false));\r\n//          return pn_flags;\r\n//        },\r\n//        flags: function(th){ // for on demand access.\r\n//          var flags = [];\r\n//          var i = th.posts.length - pref.catalog_t2h_num_of_posts;\r\n//          if (i<1) i=1;\r\n//          if (th.posts.length!=0) flags[0] = th.posts[0].flag;\r\n//          while (i<th.posts.length) {\r\n//            if (th.posts[i]) flags[i] = th.posts[i].flag;\r\n//            i++;\r\n//          }\r\n//          return flags;\r\n//        },\r\n        op_img_url: function(th){\r\n          var img = th.pn.getElementsByTagName('img');\r\n          if (img.length>=2) {\r\n            th.op_img_url2 = [];\r\n            for (var i=1;i<img.length;i++) {\r\n              var url2 = img[i].getAttribute('src');\r\n              if (url2) th.op_img_url2[th.op_img_url2.length] = url2;\r\n            }\r\n          }\r\n          return (img && img[0])? img[0].getAttribute('src') : undefined; // patch.\r\n        },\r\n        tn_as: function(th){return th.tn_imgs;},\r\n//        tn_imgs: function(th){\r\n//          var imgs = [];\r\n//          var files = th.pn.getElementsByClassName('file');\r\n//          for (var i=0;i<files.length;i++) imgs[i] = files[i].getElementsByTagName('img')[0];\r\n//          return imgs;\r\n//        },\r\n        tn_imgs: function (th){ // post can be accepted.\r\n          var imgs = [];\r\n          var files = ((th.pn.classList.contains('op'))? th.pn.parentNode : th.pn).getElementsByClassName('files')[0];\r\n          if (files) {\r\n            files = files.getElementsByClassName('file');\r\n            for (var i=0;i<files.length;i++) {\r\n              var tmp = files[i].getElementsByTagName('img')[0] || files[i].getElementsByTagName('video')[0];\r\n//              var tmp = files[i].getElementsByTagName('img')[0];\r\n              if (tmp) imgs[imgs.length] = tmp;\r\n            }\r\n          }\r\n          return imgs;\r\n        },\r\n        get_thread_links : function(th){\r\n          var links = [];\r\n          var as = th.pn.getElementsByClassName('post op')[0].getElementsByTagName('a');\r\n          for (var i=0;i<as.length;i++) {\r\n            if (as[i].textContent==='[Reply]') links.unshift(as[i]);\r\n            if (as[i].textContent==='[Last 50 Posts]') links.push(as[i]);\r\n            if (as[i].classList.contains(pref.script_prefix+'_link')) links.push(as[i]);\r\n          }\r\n          return links;\r\n        },\r\n        get_omitted_info : function(post){return post.pn.getElementsByClassName('omitted')[0];},\r\n        set_omitted_info : function(post, info){post.pn.lastChild.appendChild(info);},\r\n//        replace_omitted_info : function(dst, src){dst.childNodes[0].textContent = src.childNodes[0].textContent;},\r\n        replace_omitted_info2 : function(dst, src){dst.childNodes[0].textContent = (src)? src.childNodes[0].textContent : '';},\r\n        filename: 'thread_html',\r\n        get_op_src: 'thread_json',\r\n      },\r\n      'thread_html' : {\r\n        after_test  : ['time_created',':ITER',':FLx','posts',['sub','name','com','flag'],':ITER',':GFLx','posts',['flags','flag']],\r\n//        'finisher' : function(th){site2['8chan'].remove_posts(th.pn,pref.catalog_t2h_num_of_posts);},\r\n////        pop_post: function(th){ // working code.\r\n////          while (th.idx_pop>=0) {\r\n////            var pn = th.children[th.idx_pop--];\r\n////            if (pn.className && pn.className.indexOf('post')!=-1 && pn.className.indexOf('reply')!=-1) {\r\n////              th.post = {pn:pn, parse_funcs:this, __proto__:th.__proto__};\r\n////              return true;\r\n////            }\r\n////          }\r\n////          return false;\r\n////        },\r\n        get_op_src: 'thread_json',\r\n        filename: function(th){\r\n          var files = ((th.pn.classList.contains('op'))? th.pn.parentNode : th.pn).getElementsByClassName('files')[0];\r\n          if (files) {\r\n            files = files.querySelectorAll(':scope>.file');\r\n            for (var i=0;i<files.length;i++) {\r\n              var fname = files[i].getElementsByTagName('a')[0];\r\n              if (!fname) continue; // file may be deleted.\r\n              fname = fname.textContent;\r\n              if (i===1) th.extra_files = [];\r\n              if (i>=1) th.extra_files[i-1] = {domain:th.domain, board:th.board};\r\n              var tgt = (i===0)? th : th.extra_files[i-1];\r\n              tgt.filename = files[i].getElementsByClassName('postfilename')[0].textContent.replace(/\\..*/,'');\r\n              tgt.ext = fname.substr(  fname.indexOf('.'));\r\n              tgt.tim = fname.substr(0,fname.indexOf('.'));\r\n              var info = files[i].getElementsByClassName('details')[0].textContent.split(',');\r\n              tgt.w = parseInt(info[1].substr(0,info[1].indexOf('x')  ),10);\r\n              tgt.h = parseInt(info[1].substr(  info[1].indexOf('x')+1),10);\r\n              var fsize = info[0].split(/\\s/);\r\n              fsize[1] = (fsize[1]==='KB')? 1024 : (fsize[1]==='MB')? 1024*1024 : 1;\r\n              tgt.fsize = parseFloat(fsize[0].replace(/\\(/,'')) * fsize[1];\r\n              var tn = files[i].querySelector('img.post-image');\r\n              if (tn) {\r\n                tgt.tn_w = parseInt(tn.style.width,10);\r\n                tgt.tn_h = parseInt(tn.style.height,10);\r\n              }\r\n            }\r\n          }\r\n          return (files)? th.filename : undefined;\r\n        },\r\n        proto: 'page_html',\r\n      },\r\n      'thread_json' : {\r\n        nof_posts: function(obj){return obj.posts.length;},\r\n        nof_files: function(obj){\r\n          var count=0;\r\n          for (var i=1;i<obj.posts.length;i++) {\r\n            if (obj.posts[i].filename) count++;\r\n            if (obj.posts[i].extra_files) count += obj.posts[i].extra_files.length;\r\n          }\r\n          return count;\r\n        },\r\n        add_op_img_url: site2['DEFAULT'].parse_parts.add_op_img_url,\r\n//        get_op_src: function(th){return th.op_img_url.replace('thumb','src').replace('.png',th.ext);},\r\n        get_op_src: function(th, img){\r\n          if (!th.ext && th.parse_funcs.missing_info) scan.scan_ui('image_hover', {tgts: [th.domain+th.board+'j0'], options:{callback:function(){cataLog.image_hover_reentry(img);}, priority:6}});\r\n          return (th.ext)? th.op_img_url.replace('thumb','src').replace('.png',th.ext) : img.src;\r\n        },\r\n        pn_name: 'post_html',\r\n        proto: 'DEFAULT.thread_json',\r\n      },\r\n      'post_html': {\r\n        pn_name: function(post){return post.pn.getElementsByClassName('name')[0];},\r\n//        txt2com: function(txt){\r\n//          txt = txt.replace(/(^>[^>].*$)/mg,'<span class=\"quote\">$1</span>');\r\n//          txt = txt.replace(/\\*\\*([^(\\*\\*)]*)((\\*\\*)|$)/g,'<span class=\"spoiler\">$1</span>');\r\n//          return txt.replace(/\\n/g,'<br>');},\r\n        txt2com_spoiler_replace_txt: '<span class=\"spoiler\">$1</span>',\r\n        proto: 'DEFAULT.post_html',\r\n      },\r\n      'post_json': {\r\n        proto: 'DEFAULT.post_json'\r\n      },\r\n    },\r\n    update_posts_remove: function(th_old,i,pnode,merge){\r\n      var tgt = th_old.posts[i].pn;\r\n      if (!merge || tgt.parentNode!==pnode) tgt = tgt.parentNode;\r\n      else this.update_posts_insert_pack(tgt);\r\n      pnode.removeChild(tgt.nextSibling);\r\n      pnode.removeChild(tgt);\r\n    },\r\n    update_posts_insert: function(src,dst,i,j,pnode){\r\n////      var ref = (j==1)? (dst[0].pn.getElementsByClassName('op')[0].nextSibling || null) :\r\n//      var ref = (i==1)? (dst[0].pn.nextSibling || null) :\r\n//                        (dst[dst.length-1].pn.parentNode.nextSibling || null);\r\n//      var ref = (j==0)? (dst[0].pn || null) :\r\n//                (j==1)? (dst[0].pn.nextSibling || null) :\r\n//                (j<dst.length)? (dst[j].pn.parentNode.nextSibling || null) :\r\n//                (dst[dst.length-1].pn.parentNode.nextSibling &&\r\n//                 dst[dst.length-1].pn.parentNode.nextSibling.nextSibling || null);\r\n      var ref = dst[(j<dst.length)? j : dst.length-1];\r\n      ref = (ref)? ref.pn : null;\r\n      var ref_pnode = ref && ref.parentNode;\r\n      if (ref_pnode && ref_pnode!==pnode) ref = ref_pnode; // remove container\r\n//      if (j>=1 && (!merge || ref.parentNode!==pnode)) ref = ref.parentNode; // remove container\r\n      if (j>=dst.length) ref = ref && ref.nextSibling && ref.nextSibling.nextSibling || null;\r\n      if (!src[i].pn) src[i].pn = this.post_json2html(src[i],src[i].board);\r\n//      pnode.insertBefore(this.post_container(src[i].pn,src[i].no), ref); // working code.\r\n//      pnode.insertBefore(document.createElement('br'),ref);\r\n//      if (ref && ref.parentNode!==pnode) ref = ref.parentNode; // patch for thread merging.\r\n      if (i===0) this.update_posts_insert_pack(src[0].pn);\r\n      if (j===0 && ref) this.update_posts_insert_pack(dst[0].pn);\r\n      var tgt = (j===0 && i===0)? src[i].pn : this.post_container(src[i].pn,src[i].no); // patch for thread merging.\r\n      pnode.insertBefore(tgt, ref);\r\n      pnode.insertBefore(document.createElement('br'),ref);\r\n      if (i===0 && j===0) this.update_posts_insert_unpack(src[0].pn);\r\n//      if (j===0) {\r\n//        ref = dst[0].pn.nextSibling;\r\n//        pnode.insertBefore(this.post_container(dst[0].pn,dst[0].no), ref);\r\n//      }\r\n    },\r\n    update_posts0_class: function(pn,search_result) {\r\n      site2['DEFAULT'].update_posts0_class(pn,search_result);\r\n      this.update_posts_insert_pack_iter(pn, (search_result)? function(prev){prev.classList.remove('CatChan_search_miss');} : \r\n                                                              function(prev){prev.classList.add('CatChan_search_miss');});\r\n    },\r\n    update_posts_insert_pack: function(pn){\r\n      this.update_posts_insert_pack_iter(pn, function(prev){pn.insertBefore(prev, pn.firstChild);});\r\n    },\r\n    update_posts_insert_pack_iter: function(pn, func){\r\n      var prev = pn.previousSibling;\r\n      while (prev) {\r\n        var prev_prev = prev.previousSibling; // prev is livelist.\r\n        if (prev.classList && (prev.classList.contains(pref.script_prefix+'_footer') || prev.classList.contains('files'))) func(prev);\r\n        if (prev.classList &&  prev.classList.contains('op')) break;\r\n        prev = prev_prev;\r\n      }\r\n    },\r\n    update_posts_insert_unpack: function(pn){\r\n      while (1) {\r\n        var fchild = pn.firstChild;\r\n        if (fchild && fchild.classList && (fchild.classList.contains(pref.script_prefix+'_footer') || fchild.classList.contains('files'))) pn.parentNode.insertBefore(fchild, pn);\r\n        else break;\r\n      }\r\n    },\r\n    add_backlinks: function(pn,backlinks,target,th){\r\n      var bks = pn.getElementsByClassName('mentioned')[0];\r\n      if (!bks) {\r\n        var bks = document.createElement('span');\r\n        bks.setAttribute('class','mentioned unimportant');\r\n        var ref = pn.getElementsByClassName('post_no')[1];\r\n        var pnode = ref.parentNode;\r\n        do {ref = ref.nextSibling;} while (ref && ref.tagName==='I');\r\n        pnode.insertBefore(bks,ref);\r\n      }\r\n      if (!target) bks.innerHTML = '';\r\n      for (var i=(target || 0);i<backlinks.length;i++) {\r\n        var dbtp = backlinks[i].split(/[\\/#]/);\r\n        dbtp[1] = '/' + dbtp[1] + '/';\r\n        var domain = dbtp[0];\r\n        var board = dbtp[1];\r\n        var post_no = dbtp[3];\r\n        var href = site2[domain].link_dbtp2href(dbtp);\r\n        if (domain!==site.nickname) href = site2[domain].absolute_link_1(href);\r\n////        var href = backlinks[i].split('/');\r\n////        var post_no = href[href.length-1].substr(href[href.length-1].indexOf('#')+1);\r\n////        href[href.length-1] = 'res/'+href[href.length-1].replace('#','.html#');\r\n////        var domain = href[0];\r\n////        href[0] = '';\r\n////        href = href.join('/');\r\n////        if (domain!==site.nickname) href = this.absolute_link_1(href);\r\n//////        bk_str += '<a class=\"mentioned\" onclick=\"highlightReply(\\''+post_no+'\\');\" href=\"'+href+'\">&gt;&gt;'+post_no+'</a>';\r\n        var blk = null;\r\n        if (target!==undefined)\r\n          for (var j=0;j<bks.childNodes.length;j++)\r\n            if (bks.childNodes[j].textContent==='>>'+post_no) {\r\n              blk = bks.childNodes[j];\r\n              break;\r\n            }\r\n        if (!blk) {\r\n          blk = document.createElement('a');\r\n          blk.setAttribute('class','mentioned');\r\n          blk.setAttribute('href',href);\r\n          blk.textContent = (th && domain!==th.domain)? '>>>>'+domain+board+post_no :\r\n                            (th && board!==th.board)? '>>>'+board+post_no :\r\n                            '>>'+post_no;\r\n          blk.onclick = this.backlink_onclick;\r\n          bks.appendChild(blk);\r\n          blk.onmouseover = this.popups_post_entry;\r\n        }\r\n        if (target) break;\r\n      }\r\n    },\r\n////    link_get_dbt: function(href){ // /a/res/no.html#post\r\n////      var href = href.split('/');\r\n////      var p = href[href.length-1].substr(href[href.length-1].indexOf('#')+1);\r\n////      var t = href[href.length-1].substr(0,href[href.length-1].indexOf('.html'));\r\n////      var b  = href[href.length-3] || site.board;\r\n////      var d  = '8chan';\r\n////      return [d,'/'+b+'/',t,p];\r\n////    },\r\n    link_dbtp2href: function(dbtp){\r\n      return dbtp[1] + 'res/' + dbtp[2] + '.html#' + dbtp[3];\r\n    },\r\n    backlink_onclick: function(){\r\n      highlightReply.call(this,parseInt(this.textContent.substr(2),10));\r\n    },\r\n    backlink_class: 'mentioned',\r\n    colorID: function(pn) {\r\n      var id = pn.getElementsByClassName('poster_id')[0];\r\n      if (id) {\r\n        var bg = id.textContent;\r\n        var bg_r = parseInt(bg.substr(0,2),16);\r\n        var bg_g = parseInt(bg.substr(2,2),16);\r\n        var bg_b = parseInt(bg.substr(4,2),16);\r\n        var fg = (bg_r + bg_g + bg_b>384)? 0 : 255;\r\n        id.setAttribute('style','padding: 0px 5px; border-radius: 8px; color: rgb('+fg+','+fg+','+fg+'); background-color: rgb('+bg_r+','+bg_g+','+bg_b+');');\r\n      }\r\n    },\r\n//    localtime: function(pn) {\r\n//      var pn_time = pn.getElementsByTagName('time');\r\n//      for (var i=0;i<pn_time.length;i++)\r\n//        pn_time[i].textContent = site2.common.change_utc_to_local(pn_time[i].getAttribute('datetime'));\r\n//    },\r\n//    post_com2txt: function(com){\r\n//      return com.replace(/<[^>]*>/g,' ').replace(/&gt;/g,'>').replace(/&lt;/g,'<').replace(/&amp;/g,'&').replace(/&hellip;/g,'\\u2026'); // most of lainchan, speed: 10.62/2.02\r\n//    },\r\n    post_container : function(post_pn,no) {\r\n      var pn = document.createElement('div');\r\n      pn.setAttribute('id','pc'+no);\r\n      pn.setAttribute('class','postcontainer');\r\n      pn.innerHTML = '<div class=\"sidearrows\">&gt;&gt;</div>';\r\n      pn.appendChild(post_pn);\r\n      return pn;\r\n    },\r\n    short_link: function(name, nof_posts, num, kwd_head, kwd_tail){\r\n      var dbt = common_func.fullname2dbt(name);\r\n      return (nof_posts>100)? '<a href=\"' +dbt[1]+ 'res/' +dbt[2]+ '+50.html\" class=\"' + pref.script_prefix + '_link' + '\">'+kwd_head+'50'+kwd_tail+'</a>' : '';\r\n    },\r\n    post_json2html : function(post, board, op, short_link) {\r\n      var pn = document.createElement('div');\r\n      var time_unit = (post.parse_funcs && post.parse_funcs.time_unit) || 1;\r\n      var date = new Date((post.time || 0) * time_unit);\r\n      var html_str =\r\n        '<div class=\"post ' +((op)? 'op':'reply')+ '\" id=\"reply_'+post.no+'\" style=\"border: none\">'+\r\n//        '<div class=\"post reply\" id=\"reply_'+post.no+'\" style=\"border: none\">'+\r\n          '<p class=\"intro\">'+\r\n//////////                     '<input type=\"checkbox\" class=\"delete\" name=\"delete_12486\" id=\"delete_12486\">'+\r\n            '<label for=\"delete_'+post.no+'\">'+\r\n              ((post.sub)? '<span class=\"subject\">'+post.sub+ ' </span>' : '')+\r\n              ((post.email)? '<a class=\"email\" href=\"mailto:' + post.email + '\">' : '') +\r\n                '<span class=\"name\">'+(post.name || '')+'</span>'+\r\n                ((post.trip)? '<span class=\"trip\">' + post.trip + '</span>' : '') +\r\n              ((post.capcode)? '<span class=\"capcode\" style=\"color:orange;font-weight:bold\">## ' + post.capcode + '</span>' : '') +\r\n              ((post.email)? '</a> ' : ' ') +\r\n              ((post.country)? '<img class=\"flag flag-' + post.country.toLowerCase() + '\" src=\"/static/blank.gif\" style=\"width:16px;height:11px;\" alt=\"' + post.country_name + '\" title=\"' + post.country_name +'\"> ' : ' ')+\r\n              '<time datetime=\"'+ date.toISOString() + '\">' + date.toLocaleString()+'</time>'+\r\n            '</label>'+\r\n            ((post.id)? '<span class=\"poster_id\">'+post.id+'</span>' : '')+\r\n            '&nbsp;'+\r\n            '<a class=\"post_no\" id=\"post_no_'+post.no+'\">No.</a>'+\r\n//            '<a class=\"post_no\" onclick=\"citeReply(12486)\" href=\"/tech/res/12393.html#q12486\">12486</a>'+\r\n            '<a class=\"post_no\">'+post.no+'</a>'+\r\n            ((op)? ('<a href=\"' + site2[post.domain].make_url4([post.domain, board, post.no, 'thread_html'])[0] +'\">[Reply]</a>'+\r\n//            ((op)? ('<a href=\"' +board+ 'res/' +post.no+ '.html\">[Reply]</a>'+\r\n                   ((short_link)? short_link : '')) : '') +\r\n//////////            '<span class=\"mentioned unimportant\"><a class=\"mentioned-12497\" onclick=\"highlightReply('12497');\" href=\"#12497\">&gt;&gt;12497</a></span>'+\r\n          '</p>';\r\n      if (post.filename) {\r\n        html_str += '<div class=\"files\">' +\r\n                    this.post_json2html_file(post,board, post.extra_files);\r\n        if (post.extra_files) for (var i=0;i<post.extra_files.length;i++) html_str += this.post_json2html_file(post.extra_files[i],board, true);\r\n        html_str += '</div>';\r\n      }\r\n      html_str +=\r\n          '<div class=\"body\">'+ ((post.com)? post.com : '') +\r\n//////////            '<a onclick=\"highlightReply('12446');\" href=\"/tech/res/12393.html#12446\">&gt;&gt;12446</a><br>'+\r\n//////////            '<a onclick=\"highlightReply('12403');\" href=\"/tech/res/12393.html#12403\">&gt;&gt;12403</a><br>'+\r\n//////////            '<span class=\"quote\"><br>&gt;people saying nice things about openstack</span><br><br>Thanks, lainons. I work on developing openstack and people seem to love complaining about it, so it's heartening to hear somewhat happy people.'+\r\n          '</div>'+\r\n        '</div>';\r\n      pn.innerHTML = html_str;\r\n      return pn.childNodes[0];\r\n    },\r\n    post_json2html_file : function(post, board, multifile) {\r\n      var fsize_str = (((post.fsize>1048576)? post.fsize/1048576 : post.fsize/1024)+0.005).toString();\r\n      fsize_str = fsize_str.substr(0,fsize_str.indexOf('.')+3) + ((post.fsize>1048576)? ' MB' : ' KB');\r\n      var fname_server = site2[post.domain].post_json2html_fname_server(post);\r\n      var fname = site2[post.domain].post_json2html_fname(post);\r\n      var furl = site2[post.domain].catalog_json2html3_src(post,board);\r\n      var turl = site2[post.domain].catalog_json2html3_thumbnail(post,board);\r\n      if (post.localArchive) {\r\n        furl = archiver.url2file(post.localArchive, furl);\r\n        turl = archiver.url2file(post.localArchive, turl);\r\n      }\r\n      var html_str = \r\n              '<div class=\"file' + ((multifile)?' multifile':'')+'\"' +((multifile)?' style=\"width:'+(post.tn_w+40)+'px\"':'') +'>'+\r\n                '<p class=\"fileinfo\">File: '+\r\n                  '<a href=\"'+furl+'\">'+fname_server+'</a> '+\r\n                  '<span class=\"details\">('+fsize_str+', '+post.w+'x'+post.h+', '+\r\n                    '<span class=\"postfilename\">'+fname+'</span>) '+\r\n////////                  '<span class=\"unimportant image_id\">'+\r\n//////////                    '<a href=\"http://imgops.com/https://lainchan.org/tech/src/1445201930315.jpg\" target=\"_blank\">ImgOps</a>'+\r\n//////////                    '<a href=\"http://regex.info/exif.cgi?url=https://lainchan.org/tech/src/1445201930315.jpg\" target=\"_blank\">Exif</a>'+\r\n//////////                    '<a href=\"http://iqdb.org/?url=https://lainchan.org/tech/src/1445201930315.jpg\" target=\"_blank\">iqdb</a>'+\r\n////////                  '</span>'+\r\n                  '</span>'+\r\n                '</p>'+\r\n                '<a href=\"'+furl+'\" target=\"_blank\">'+\r\n                  ((post.ext!=='.webm')? '<img class=\"post-image\" src=\"'+turl+'\" style=\"width: '+post.tn_w+'px; height: '+post.tn_h+'px; max-width: 98%;\" alt=\"\"'+\r\n                                         ((post.tn_w===128 && post.tn_h===128)? 'onerror=\"this.onerror=null;this.src=\\'/static/spoiler.png\\';\"' : '')+ '>' : // vichan doesn't have any information about spoilered.\r\n                                         '<video class=\"post-image\" src=\"'+furl+'\" style=\"width: '+post.tn_w+'px; height: '+post.tn_h+'px; max-width: 98%;\">')+\r\n                '</a>'+\r\n              '</div>';\r\n      return html_str;\r\n    },\r\n    page_json2html3 : function(obj,board,thumb_url, assign_pn) { // TEMPORAL, USE thumb_url TO MIMIC.\r\n      var th = document.createElement('div');\r\n      th.setAttribute('id','thread_'+obj.no);\r\n      th.setAttribute('data-board',board.substr(1,board.length-2));\r\n//      th.setAttribute('style','float: left; overflow: hidden;');\r\n      var op = this.post_json2html((obj.posts && obj.posts[0])? obj.posts[0] : obj, board, true, site2[obj.domain].short_link(obj.key, obj.nof_posts, 2, '[Last ',' Posts]'));\r\n      var files = op.getElementsByClassName('files')[0];\r\n      if (files) th.appendChild(files);\r\n      op.setAttribute('class','post op');\r\n      if (obj.posts && obj.posts[0] && obj.posts[0].extra_files) op.setAttribute('style','clear:both;');\r\n      th.appendChild(op);\r\n//      if (assign_pn) obj.posts[0].pn = th;\r\n      if (assign_pn || !obj.posts[0].pn) obj.posts[0].pn = op;\r\n      if (obj.posts) {\r\n        for (var i=1;i<obj.posts.length;i++) {\r\n//          th.appendChild(this.post_json2html(obj.posts[i], board));\r\n          var pn = this.post_json2html(obj.posts[i], board);\r\n          th.appendChild(this.post_container(pn,obj.posts[i].no));\r\n          th.appendChild(document.createElement('br'));\r\n          if (assign_pn || !obj.posts[i].pn) obj.posts[i].pn = pn;\r\n        }\r\n        this.page_json2html3_add_omitted_info(obj,obj.posts,obj.posts);\r\n////////      } else { // WILL BE REDUNDANT\r\n////////        var keys = Object.keys(obj); // obj.posts===undefined, but it is defined as undefined, so key contains 'posts'. \r\n////////        obj.posts = [];\r\n////////        obj.posts[0] = {};\r\n////////        for (var i=0;i<keys.length;i++) if (keys[i]!=='posts') obj.posts[0][keys[i]] = obj[keys[i]]; // remove props in prototype chain.\r\n////////        obj.posts[0].pn = op;\r\n      }\r\n      var br = document.createElement('br');\r\n      br.setAttribute('class','clear');\r\n      th.appendChild(br);\r\n      th.appendChild(document.createElement('hr'));\r\n      return th;\r\n    },\r\n    page_json2html3_replace_expander : function(posts_old, idx) {\r\n      var omit_info = posts_old[0].pn.getElementsByClassName('omitted')[0];\r\n      if (omit_info) {\r\n        var expander = document.createElement('select');\r\n        cnst.config_expander(expander, idx);\r\n        if (omit_info.childNodes.length>=3) omit_info.removeChild(omit_info.childNodes[2]);\r\n        if (omit_info.childNodes.length>=2) omit_info.removeChild(omit_info.childNodes[1]); // 'if ()' is a parch for a bug in lainchan, inconsistency between usual boards and /mega/\r\n//        omit_info.removeChild(omit_info.childNodes[1]);\r\n        omit_info.appendChild(expander);\r\n      }\r\n    },\r\n    page_json2html3_add_omitted_info : function(th,posts_old,posts) {\r\n      var nof_files = 0;\r\n      for (var i=1;i<posts.length;i++) nof_files += (posts[i].type_data==='html')? posts[i].pn.getElementsByClassName('file').length :\r\n                                                    (!posts[i].filename)? 0 :\r\n                                                    (posts[i].extra_files)? posts[i].extra_files.length+1 : 1;\r\n      var nof_files_omitted = th.nof_files - nof_files;\r\n      var nof_posts_omitted = th.nof_posts - posts.length;\r\n\r\n      var omit_info = (posts_old)? posts_old[0].pn.getElementsByClassName('omitted')[0] : null;\r\n      if (nof_posts_omitted!=0) {\r\n//      if (th.nof_posts>1) {\r\n        if (!omit_info) {\r\n          omit_info = document.createElement('span');\r\n          omit_info.setAttribute('class','omitted');\r\n//          omit_info.innerHTML = 'dummy<a href=\"javascript:void(0)\">Click to expand</a>.';\r\n          omit_info.innerHTML = 'dummy<select></select>';\r\n          cnst.config_expander(omit_info.childNodes[1]);\r\n          if (posts_old) posts_old[0].pn.appendChild(omit_info);\r\n        }\r\n//        omit_info.childNodes[0].textContent = (nof_posts_omitted!==0)? (nof_posts_omitted +' post' + ((nof_posts_omitted!==1)? 's':'') +\r\n//          ((nof_files_omitted)? ' and ' + nof_files_omitted + ' image repl'+ ((nof_files_omitted===1)? 'y' : 'ies') : '') + ' omitted. ') : '';\r\n        omit_info.childNodes[0].textContent = nof_posts_omitted +' post' + ((nof_posts_omitted!==1)? 's':'') +\r\n          ((nof_files_omitted)? ' and ' + nof_files_omitted + ' image repl'+ ((nof_files_omitted===1)? 'y' : 'ies') : '') + ' omitted. ';\r\n      } else if (omit_info && posts_old) posts_old[0].pn.removeChild(omit_info);\r\n      return omit_info;\r\n    },\r\n    catalog_json2html3_thumbnail: function(obj, board) {\r\n      return ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://' + site2[obj.domain].domain_url + board + 'thumb/' + obj.tim + obj.ext : '');\r\n    },\r\n    catalog_json2html3_src: function(obj, board) {\r\n      return ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png' || obj.ext==='.webm')? 'https://' + site2[obj.domain].domain_url + board + 'src/' + obj.tim + obj.ext : '');\r\n    },\r\n    catalog_json2html3 : function(obj,board,thumb_url) {\r\n      var th = document.createElement('div');\r\n      th.setAttribute('class','mix');\r\n      th.setAttribute('style','display: inline-block;');\r\n//      if (obj.ext==='.gif' || obj.ext==='.png') obj.ext='.jpg';\r\n//      if (obj.ext==='.gif' || obj.ext==='.jpeg') obj.ext='.jpg';\r\n      th.innerHTML = '<div class=\"thread grid-li grid-size-' + site2[site.nickname].catalog_native_size + '\">' +\r\n                     '<a href=\"' + site2[obj.domain].make_url4([obj.domain,obj.board,obj.no,'thread_html'])[0] + '\">' +\r\n//                     '<a href=\"' + thumb_url + '\">' +\r\n//                     '<a>' +\r\n                       '<img src=\"' + thumb_url +\r\n                       '\" id=\"img-' + obj.no +\r\n                       '\" data-subject=\"' + obj.sub +\r\n                       '\" data-name=\"' + obj.name +\r\n                       '\" data-muhdifference=\"\" data-last-reply=\"\" data-last-subject=\"\" data-last-name=\"\" data-last-difference=\"\"' +\r\n                       'class=\"' + board + ' thread-image\" title=\"' + new Date(obj.last_modified*1000).toLocaleString() + ' '+obj.ext + '\"></a>' +\r\n                     '<div class=\"replies\"><strong>R: ' + (obj.nof_posts-1) +' / I: ' + obj.nof_files +\r\n//                     ((pref.catalog_footer_show_board_name)? ' '+board : '')\r\n                     '</strong>' + \r\n                     ((obj.sub)? '<p class=\"intro\"><span class=\"subject\">' + obj.sub + '</span></p>' : '<br>') +\r\n                     obj.com + '</div></div>';\r\n      return th;\r\n    },\r\n//    catalog_json2html3 : function(obj,board) {\r\n//      th = document.createElement('div');\r\n////      if (obj.ext==='.gif' || obj.ext==='.png') obj.ext='.jpg';\r\n//      if (obj.ext==='.gif' || obj.ext==='.jpeg') obj.ext='.jpg';\r\n//      th.innerHTML = '<div class=\"thread grid-li grid-size-small\"><a href=\"'\r\n//                   + site2['8chan'].make_url3(board,obj.no) + '\"><img src=\"'\r\n//                   + ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://' + site2['8chan'].domain_url + board + 'thumb/' + obj.tim + obj.ext : '')\r\n//                   + '\" id=\"img-'\r\n//                   + obj.no  + '\" data-subject=\"'\r\n//                   + obj.sub + '\" data-name=\"'\r\n//                   + obj.name+ '\" data-muhdifference=\"\" data-last-reply=\"\" data-last-subject=\"\" data-last-name=\"\" data-last-difference=\"\"'\r\n////                   + 'class=\"scriptcdc thread-image\" title=\"' + new Date(obj.last_modified*1000).toLocaleString() +'\"></a>'\r\n//                   + 'class=\"'+board+' thread-image\" title=\"' + new Date(obj.last_modified*1000).toLocaleString() + ' '+obj.ext + '\"></a>'\r\n//                   + '<div class=\"replies\"><strong>R: '\r\n//                   + obj.replies +' / I: '\r\n//                   + (obj.images+obj.omitted_images)\r\n////                   + ((pref.catalog_footer_show_board_name)? ' '+board : '')\r\n//                   + '</strong>'\r\n//                   + ((obj.sub)? '<p class=\"intro\"><span class=\"subject\">' + obj.sub + '</span></p>' : '')\r\n//                   + obj.com + '</div></div>';\r\n//      return th;\r\n//    },\r\n    catalog_from_json3 : function(obj,board) {\r\n      var ths;\r\nif (pref.test_mode['0']) {\r\n      ths = {domain:'8chan', board:site.board, obj:obj};\r\n      this.parse_funcs['catalog_json'].entry(ths,this.parse_funcs['catalog_json']['full_hier']);\r\n} else {\r\n//      ths = {domain:'8chan', board:board, obj:obj, parse_funcs:this.parse_funcs['catalog_json'], __proto__:site4.parse_funcs_on_demand};\r\n////      var parse_obj = {domain:'8chan', board:board, parse_funcs:this.parse_funcs['catalog_json'], __proto__:site4.parse_funcs_on_demand};\r\n////      ths = {obj:obj, __proto__:parse_obj};\r\n      return site2[this.nickname].wrap_to_parse.get(obj, this.nickname, board, 'catalog_json');\r\n}\r\n      return ths.ths;\r\n    },\r\n//    catalog_json2html2 : function(obj,board) {\r\n//      th = document.createElement('div');\r\n//      th.setAttribute('data-reply',obj.replies);\r\n//      th.setAttribute('data-bump',obj.last_modified);\r\n//      th.setAttribute('data-time',obj.time);\r\n////      if (obj.ext==='.gif' || obj.ext==='.png') obj.ext='.jpg';\r\n//      if (obj.ext==='.gif' || obj.ext==='.jpeg') obj.ext='.jpg';\r\n//      th.innerHTML = '<div class=\"thread grid-li grid-size-small\"><a href=\"'\r\n//                   + site2['8chan'].make_url3(board,obj.no) + '\"><img src=\"'\r\n////                   + ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://media.' + site2['8chan'].domain_url + board + 'thumb/' + obj.tim + obj.ext : '')\r\n//                   + ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://' + site2['8chan'].domain_url + board + 'thumb/' + obj.tim + obj.ext : '')\r\n//                   + '\" id=\"img-'\r\n//                   + obj.no  + '\" data-subject=\"'\r\n//                   + obj.sub + '\" data-name=\"'\r\n//                   + obj.name+ '\" data-muhdifference=\"\" data-last-reply=\"\" data-last-subject=\"\" data-last-name=\"\" data-last-difference=\"\"'\r\n////                   + 'class=\"scriptcdc thread-image\" title=\"' + new Date(obj.last_modified*1000).toLocaleString() +'\"></a>'\r\n//                   + 'class=\"scriptcdc thread-image\" title=\"' + new Date(obj.last_modified*1000).toLocaleString() + ' '+obj.ext + '\"></a>'\r\n//                   + '<div class=\"replies\"><strong>R: '\r\n//                   + obj.replies +' / I: '\r\n//                   + (obj.images+obj.omitted_images)\r\n////                   + ((pref.catalog_footer_show_board_name)? ' '+board : '')\r\n//                   + '</strong>'\r\n//                   + ((obj.sub)? '<p class=\"intro\"><span class=\"subject\">' + obj.sub + '</span></p>' : '')\r\n//                   + obj.com + '</div></div>';\r\n//      return th;\r\n//    },\r\n//    catalog_from_json2 : function(doc_json,board) {\r\n//    catalog_from_json2 : function(obj,board) {\r\n////      var obj = JSON.parse(doc_json);\r\n//      var ths = [];\r\n//      for (var i=0;i<obj.length;i++)\r\n//        for (var j=0;j<obj[i].threads.length;j++) {\r\n//          var name = '8chan' + board + obj[i].threads[j].no;\r\n//          var pn = site2['8chan'].catalog_json2html2(obj[i].threads[j],board);\r\n//          ths.push(site2['8chan'].catalog_from_native_1(pn,board));\r\n//          ths[ths.length-1][14] = i + '.' +j;\r\n//        }\r\n//      return ths;\r\n//    },\r\n    patch:{\r\n      expand_thumbnail_inline_load: function(){\r\n        var pnode = this.parentNode && this.parentNode.parentNode;\r\n        if (pnode && pnode.classList && pnode.classList.contains('multifile') && pnode.style.width) { // patch for multifile in vichan\r\n          this.setAttribute('data-originalWidth',pnode.style.width);\r\n          pnode.style = '';\r\n        }\r\n      },\r\n    },\r\n    proto : 'DEFAULT'\r\n  };\r\n  site2['KC'] = {\r\n    nickname : 'KC',\r\n    domain_url: 'krautchan.net',\r\n//    features : {thread_reader: true},\r\n    components: {\r\n      boardlist: '.menu',\r\n      postform_comment: '#postform_comment',\r\n      postform_submit: '#postform_submit',\r\n    },\r\n    pref_default: {\r\n      thread_reader:{own_posts_tracker:true, check_num_of_children: false},\r\n      proto:{\r\n        env:{\r\n          popup_native:false,\r\n          expand_thumbnail_inline_native:false,\r\n          image_hover_native:false,\r\n          colorID_native:false,\r\n          backlink_native:false,\r\n          localtime_native:false,\r\n          auto_update_native:false,\r\n        },\r\n      },\r\n    },\r\n    boards_json:(function(){\r\n      var proto = {pages:10};\r\n      var obj = {boards:[{board:'b', pages:15},{board:'int', pages:20},{board:'vip'},\r\n                         {board:'a'},{board:'c'},{board:'co'},{board:'d'},{board:'e'},{board:'f'},{board:'fb'},{board:'fe'},{board:'fit'},{board:'jp'},\r\n                         {board:'k'},{board:'l'},{board:'li'},{board:'m', pages:5},{board:'n'},{board:'ng'},{board:'p'},{board:'ph'},{board:'prog'},{board:'sp'},\r\n                         {board:'t'},{board:'trv', pages:18},{board:'tu'},{board:'tv'},{board:'v'},{board:'w'},{board:'we'},{board:'wk'},{board:'wp'},{board:'z'},{board:'zp'},\r\n                         {board:'ft'},{board:'r'},{board:'h', pages:8},{board:'s'},{board:'bans'},{board:'kc'},{board:'rfk'},{board:'rvss', pages:15}]};\r\n      for (var i of obj.boards) i.__proto__ = proto;\r\n      return obj;\r\n    })(),\r\n    check_func : function(){\r\n      if (!site2['KC'].force_https) site2['KC'].protocol = site.protocol;\r\n      var href = window.location.href;\r\n      if (href.search(/krautchan.net/)!=-1) { // Krautchan\r\n        site.whereami = (document.getElementsByTagName('head')[0].innerHTML.indexOf('404 Not Found')!=-1)? '404'\r\n                      : (href.search(/krautchan\\.net\\/?$/)!=-1)? 'frame'\r\n                      : (href.search(/catalog/)!=-1)? 'catalog'\r\n                      : (href.search(/thread/)!=-1)? 'thread'\r\n                      : (href.search(/\\/$|(index|[0-9]+)\\.html|\\/#all$/)!=-1)? 'page'\r\n                      : 'other';\r\n        if (site.whereami==='page' || site.whereami==='thread') {\r\n          this.components.boardlist = 'body > div:nth-child(3)';\r\n          delete this.show_boardlist_physical_extract_func;\r\n        }\r\n        site.config('krautchan.net','KC');\r\n        site.max_page  = (site2['KC'].max_page_kc[site.board]==undefined)? 10 : site2['KC'].max_page_kc[site.board];\r\n        if (site.whereami==='catalog') {\r\n          if (href[href.length-1]==='/') href = href.substr(0,href.length-1);\r\n          site.board = href.substr(href.lastIndexOf('/'))+'/';\r\n        }\r\n        if (site.whereami==='frame') {\r\n          site.root_body2 = document.createElement('div');\r\n          site.embed_frame = 'main';\r\n          site.embed_frame_win = main;\r\n          navigation.onload = function(){\r\n            site.root_body = navigation.document.body;\r\n            site.root_body.appendChild(site.root_body2);\r\n          };\r\n        }\r\n        if (site.whereami==='thread' || site.whereami==='page') {\r\n          site.embed_to['top']    = document.querySelector('form[action=\"/delete\"]');\r\n          site.embed_to['bottom'] = document.querySelector('form[action=\"/delete\"]').nextSibling;\r\n//        } else if (site.whereami==='catalog') {\r\n//          site.embed_to['top']    = document.getElementsByTagName('header')[0].nextSibling;\r\n//          site.embed_to['bottom'] = document.getElementsByTagName('footer')[0];\r\n        }\r\n        site.postform = document.getElementById('postform');\r\n        site.postform_rules = document.getElementById('rules_row');\r\n////        this.pref_default(pref); // working code.\r\n        return true;\r\n      } else return false;\r\n    },\r\n////    pref_default: function(pref){ // working code.\r\n////      pref.thread_reader.own_posts_tracker = true;\r\n////      pref.thread_reader.check_num_of_children = false;\r\n////    },\r\n    force_https : false,\r\n    protocol : 'https:',\r\n//    home : site.protocol + '//krautchan.net', // cause memory leak\r\n    home : site.protocol + '//krautchan.net/regeln.html',\r\n//    home : site.protocol + '//krautchan.net/favicon.ico',\r\n    show_boardlist_physical_extract_func: function(key){return key.substr(1,key.length-2);},\r\n    catalog_frame_prep: function(pn12){\r\n      var source = [navigation.document.body, main.document.body];\r\n//      for (var i=0;i<2;i++) {\r\n//        var container = document.createElement('div');\r\n//        container.style.display = 'none';\r\n//        while (source[i].childNodes.length!=0) container.appendChild(source[i].childNodes[0]);\r\n//        source[i].appendChild(container);\r\n//      }\r\n      site2['common'].absorb_children(source[0]).style.display = 'none';\r\n      site2['common'].absorb_children(source[1]).style.display = 'none';\r\n      source[0].insertBefore(pn12,source[0].firstChild);\r\n      source[0].insertBefore(pn12,source[0].firstChild);\r\n      site.root_body.appendChild(site.root_body2);\r\n      this.catalog_embed_prep(pn12);\r\n    },\r\n////    catalog_background : '#cfcede',\r\n////    catalog_background : '#dadafc',\r\n//    catalog_background : '#e0e0fc',\r\n//    catalog_bordercolor : '#aaaacc',\r\n//    catalog_threads_in_page : function(doc){return doc.getElementsByClassName('thread');},\r\n    catalog_threads_in_page : function(doc){return doc.getElementsByClassName('thread_body');},\r\n//    remove_posts : function(doc){\r\n//      var threads_body = doc.getElementsByClassName('thread_body');\r\n//      var posts = [];\r\n//      for (var i=0;i<threads_body.length;i++) {\r\n//        posts_in_thread = threads_body[i].getElementsByTagName('table');\r\n//        for (var j=0;j<posts_in_thread.length;j++) posts.push(posts_in_thread[j]);\r\n//      }\r\n//      for (var i=posts.length-1;i>=0;i--) posts[i].innerHTML = '';\r\n//      return doc;\r\n//    },\r\n    max_page_kc : {\r\n      '/int/' : 20,\r\n      '/b/'   : 15,\r\n      '/trv/' : 13,\r\n      '/m/'   : 5\r\n    },\r\n    max_page: function(bn){return site2['KC'].max_page_kc[bn];},\r\n    make_url4 : function(dbt){\r\n      var url_prefix = this.protocol + '//' + this.domain_url;\r\n      dbt[3] = dbt[3].replace(/_json/,'_html');\r\n      if      (dbt[3]==='page_html')    return [url_prefix + dbt[1] + ((dbt[2]==0)? '' : dbt[2] + '.html'), 'html'];\r\n      else if (dbt[3]==='catalog_html') return [url_prefix + '/catalog' + dbt[1].substr(0,dbt[1].length-1), 'html'];\r\n      else if (dbt[3]==='thread_html')  return [url_prefix + dbt[1] + 'thread-' + dbt[2] + '.html', 'html'];\r\n    },\r\n//////////    make_url : function(board,no){return [site2['KC'].protocol + '//krautchan.net' + board + ((no==0)? '' : no + '.html'), 'html'];}, // working code.\r\n////////    make_url : function(board,no,key){\r\n////////      var url_prefix = site2['KC'].protocol + '//krautchan.net';\r\n////////      return (key==='p')? [url_prefix + board + ((no==0)? '' : no + '.html'), 'html'] : \r\n////////                          [url_prefix + '/catalog' + board.substr(0,board.length-1),'html'];\r\n////////    },\r\n////////    make_url3: function(board,th){return  site2['KC'].protocol + '//krautchan.net' + board + 'thread-' + th + '.html';},\r\n    get_next_image: function(img,top){\r\n      var imgs = Array.prototype.slice.call(document.querySelectorAll('img[id^=thumbnail]')).filter(function(v){return v.src.substr(-5,5)!=='.webm';});\r\n//      var imgs = cataLog.parent.querySelectorAll('img[id^=\"thumbnail\"]');\r\n      return site2['DEFAULT'].get_next_image(img,top,imgs);\r\n    },\r\n    get_ops : function(doc){\r\n      var ops = [];\r\n      var divs = doc.getElementsByTagName('div');\r\n      for (var i=0;i<divs.length;i++)\r\n        if (divs[i].className == 'thread' || divs[i].className == 'thread kc_showReplies')\r\n          ops.push(divs[i].id.substring(7)); // substring(7) for removing 'thread_'\r\n      return ops;\r\n    },\r\n    get_posts : function(doc) {\r\n      var posts = [];\r\n      var anchors = doc.getElementsByTagName('a');\r\n      for (var i=0;i<anchors.length;i++) if (anchors[i].name != '') posts.push(anchors[i].name);\r\n      return posts;\r\n    },\r\n////////    get_thread_link : function(pn,boardname,del){\r\n//////////      var keyword = (boardname=='/int/')? 'Reply' : 'Antworten';\r\n////////      var as = pn.getElementsByClassName('postheader')[0].getElementsByTagName('a');\r\n//////////      for (var i=0;i<as.length;i++) if (as[i][brwsr.innerText]==keyword) return as[i].getAttribute('href');\r\n//////////      for (var i=0;i<as.length;i++) if (as[i].innerHTML==keyword) {\r\n////////      for (var i=0;i<as.length;i++) if (as[i][brwsr.innerText]=='Reply' || as[i][brwsr.innerText]=='Antworten') {\r\n////////        var href = as[i].getAttribute('href');\r\n////////        if (del) {\r\n////////          var j=0;\r\n////////          var parent = as[i].parentNode;\r\n////////          while (parent.childNodes[j]!=as[i]) j++;\r\n////////          parent.removeChild(parent.childNodes[j+1]);\r\n////////          parent.removeChild(as[i]);\r\n////////          parent.removeChild(parent.childNodes[j-1]);\r\n////////        } else as[i].setAttribute('target',(pref.catalog_open_in_new_tab)? '_blank' : '_self');\r\n////////        return href;\r\n////////      }\r\n////////      return null;\r\n////////    },\r\n    modify_thread_link : function(pn){\r\n      var retval = [];\r\n      var as = pn.getElementsByClassName('postheader')[0].getElementsByTagName('a');\r\n      for (var i=0;i<as.length;i++) if (as[i][brwsr.innerText]=='Reply' || as[i][brwsr.innerText]=='Antworten') {\r\n        var href = as[i].getAttribute('href');\r\n        retval.push([as[i],href]);\r\n        as[i].removeAttribute('href');\r\n      }\r\n      return retval;\r\n    },\r\n//    add_thread_link : function(doc,url){\r\n//      var pn = document.createElement('a');\r\n//      pn.href = url.replace(/https*:\\/\\/krautchan\\.net/,'');\r\n//      pn.innerHTML = 'Reply';\r\n//      var th = doc.getElementsByClassName('postheader')[0];\r\n//      if (th) {\r\n//        th.insertBefore(pn,th.firstChild);\r\n//        th.insertBefore(document.createTextNode('['),pn);\r\n//        th.insertBefore(document.createTextNode(']'),pn.nextSibling);\r\n//      }\r\n//    },\r\n    time_offset : 1, // 1 for usual, 2 for summer time.\r\n    get_time_of_posts : function(doc){\r\n      var postdates = doc.getElementsByClassName('postdate');\r\n      return [parseInt(brwsr.Date_parse(postdates[postdates.length-1][brwsr.innerText]),10) - site2['KC'].time_offset*3600000,\r\n              parseInt(brwsr.Date_parse(postdates[0                 ][brwsr.innerText]),10) - site2['KC'].time_offset*3600000];\r\n    },\r\n//    get_time_of_posts : function(th){ // cause error\r\n//      var posts = th.getElementsByTagName('table');\r\n//      return [site2['KC'].get_time_of_post_in_utc(posts[posts.length-1]),site2['KC'].get_time_of_post_in_utc(posts[0])];\r\n//    },\r\n    get_time_of_post_in_utc : function(post){\r\n      var postdates = post.getElementsByClassName('postdate');\r\n      if (postdates[0]) return parseInt(brwsr.Date_parse(postdates[0][brwsr.innerText]),10) - site2['KC'].time_offset*3600000;\r\n    },\r\n    mark_newer_posts: function(th,date,unmark) {\r\n      var pn = site2['DEFAULT'].mark_newer_posts('KC',th.getElementsByTagName('table'),date,'border:2px solid red','border: none','class','postreply',unmark);\r\n      return (pn!=null)? pn.offsetParent : null;\r\n    },\r\n    localtime: function(pn){\r\n      var times = pn.getElementsByClassName('postdate');\r\n      for (var i=0;i<times.length;i++) times[i].textContent = site2.common.change_utc_to_local(Date.parse(times[i][brwsr.innerText])-site2['KC'].time_offset*3600000);\r\n//      for (var i=0;i<times.length;i++) times[i].textContent = site2.common.change_utc_to_local(brwsr.Date_parse(times[i][brwsr.innerText])-site2['KC'].time_offset*3600000);\r\n    },\r\n    remove_files_info : function(th){\r\n      site2.common.remove_by_classname(th,'filename');\r\n      site2.common.remove_by_classname(th,'fileinfo');\r\n      var imgs = th.getElementsByTagName('img');\r\n      for (var i=0;i<imgs.length;i++) if (imgs[i].id && imgs[i].id.search('thumbnail')!=-1) {\r\n        imgs[i].removeAttribute('onmouseover');\r\n        imgs[i].removeAttribute('onmouseout');\r\n        imgs[i].removeAttribute('onload');\r\n        site2.common.move_up_and_delete_parent([imgs[i]]);\r\n      }\r\n      var files = th.getElementsByClassName('file_thread');\r\n      for (var i=0;i<files.length;i++) site2.common.remove_brs(files[i]);\r\n      for (var i=0;i<files.length;i++) site2.common.remove_by_attribute([files[i]],'id','filename');\r\n//      site2.common.remove_by_classname(th,'file_thread');\r\n//      site2.common.remove_by_classname(th,'postbody');\r\n    },\r\n////////    insert_footer : function(th,page_no,bn,exe,date,nof_posts,nof_files){\r\n////////      var key = (!brwsr.ff)? 'innerText' : 'innerHTML';\r\n////////      var posts = th.getElementsByTagName('table');\r\n////////      nof_posts += posts.length +1; // +1 for OP.\r\n////////      var files = th.getElementsByClassName('file_thread');\r\n////////      nof_files += th.getElementsByClassName('filename').length;\r\n////////      var om_info = th.getElementsByClassName('omittedinfo');\r\n////////      if (om_info[0]) {\r\n////////        var str = om_info[0][key].replace(/\\n/g,'');\r\n////////        nof_posts += parseInt(str.replace(/\\ post.*/,''),10);\r\n////////        nof_files += parseInt('0'+str.replace(/\\ file.*/,'').replace(/[^\\ ]*\\ /g,''),10);\r\n////////      }\r\n////////      if (exe) {\r\n////////        var pn = document.createElement('div');\r\n//////////        pn.name = 'catalog_footer';\r\n////////        pn.setAttribute('name','catalog_footer');\r\n//////////        pn[key] = bn + '  ' + nof_posts + '/' + nof_files + '/' + page_no + '  ';\r\n////////        pn.innerHTML = '<span>' + bn + '  ' + nof_posts + '/' + nof_files + '/' + page_no + '  </span>';\r\n////////        var imgs = th.getElementsByTagName('img');\r\n////////        for (var i=0;i<imgs.length;i++) {\r\n//////////          if (imgs[i].src && imgs[i].getAttribute('src').search(/images\\/balls/)!=-1) pn.appendChild(imgs[i].cloneNode(false)); // doesn't work in KC.\r\n////////          if (imgs[i].getAttribute('src') && imgs[i].getAttribute('src').search(/images\\/balls/)!=-1) pn.appendChild(imgs[i].cloneNode(false));\r\n////////        }\r\n////////        th.insertBefore(pn,files[0]);\r\n////////      }\r\n////////      return [nof_posts,nof_files];\r\n////////    },\r\n    remove_posts : function(th,end){\r\n//      site2.common.remove_by_tagname(th,'table',end);\r\n//      site2.common.remove_double_tags(th,'A');\r\n      var tgts = th.getElementsByTagName('table');\r\n      for (var i=tgts.length-1-end;i>=0;i--) {\r\n        if (tgts[i].previousSibling.previousSibling) tgts[i].parentNode.removeChild(tgts[i].previousSibling.previousSibling); // a tags\r\n        tgts[i].parentNode.removeChild(tgts[i].previousSibling); // text\r\n//if (!pref.test_mode['14']) tgts[i].setAttribute('style','display:none;'+(tgts[i].getAttribute('style') || ''));\r\n//else\r\n        tgts[i].parentNode.removeChild(tgts[i]);\r\n      }\r\n    },\r\n////////    absolute_link : function(doc){\r\n////////      var all = doc.pn.getElementsByTagName('*');\r\n////////      for (var i=0;i<all.length;i++) {\r\n////////        if (all[i].getAttribute('src'))  all[i].setAttribute('src', site2['KC'].protocol + '//krautchan.net'+all[i].getAttribute('src'));\r\n////////        if (all[i].getAttribute('href')) all[i].setAttribute('href',site2['KC'].protocol + '//krautchan.net'+all[i].getAttribute('href'));\r\n////////      }\r\n////////    },\r\n    format_thread_layout : function(th){\r\n      site2.common.add_attribute_by_classname(th,'file_thread','style','float:left;margin:5px');\r\n      site2.common.add_attribute_by_classname(th,'file_reply','style','float:left;margin:5px');\r\n      th.getElementsByTagName('blockquote')[0].setAttribute('style','margin:5px;clear:both');\r\n//      var ph = th.getElementsByClassName('postheader');\r\n//      th.insertBefore(ph,th.getElementsByClassName('postbody')[0]);\r\n    },\r\n    format_thread_style : function(th){\r\n      site2.common.add_attribute_by_classname(th,'postreply','style','background:#cacaec');\r\n    },\r\n    format_thread_contents : function(th){\r\n      site2.common.remove_by_tagname(th,'input');\r\n      site2.common.remove_by_classname(th,'report_parent');\r\n      site2.common.remove_by_attribute(th.getElementsByClassName('postheader'),'onclick','hideThread');\r\n      site2.common.remove_by_attribute(th.getElementsByClassName('file_thread'),'onclick','toggleThumbnail');\r\n//      site2.common.add_attribute_by_attribute(th.getElementsByClassName('file_thread'),'onclick','toggleThumbnail','style','display:none');\r\n      site2.common.remove_by_attribute(th.getElementsByClassName('file_thread'),'href','shipainter');\r\n//      site2.common.remove_by_classname(th,'thread_hidden');\r\n      site2.common.remove_by_tagname(th,'hr');\r\n//      site2.common.remove_by_tagname(th,'br');\r\n      site2.common.remove_by_classname(th,'omittedinfo');\r\n    },\r\n    preprocess_html : function(doc_txt,page){ // cause memory leak in chrome, but fail without this in FF or GreaseMonkey.\r\n      if (doc_txt) {\r\n//        if (page) while (doc_txt.search(/<script[>\\ ](.|\\n)*<\\/script>/)!=-1) doc_txt = doc_txt.replace(/<script[>\\ ](.|\\n)*<\\/script>/,''); // slower execution.\r\n//        while (doc_txt.search(/onload=\"imageFinishedLoading\\([0-9]*\\)\"/)!=-1) doc_txt = doc_txt.replace(/onload=\"imageFinishedLoading\\([0-9]*\\)\"/,''); // slower execution.\r\n//        if (page) doc_txt = doc_txt.replace(/<script[>\\ ](.|\\n)*<\\/script>/mg,''); // cause leak in Chrome, probably a bug.\r\n        if (page) doc_txt = doc_txt.replace(/<script[> ].*<\\/script>/mg,''); // cause leak in Chrome, probably a bug. (remove \\n)\r\n        doc_txt = doc_txt.replace(/onload=\"imageFinishedLoading\\([0-9]*\\)\"/mg,''); // cause leak in Chrome, probably a bug.\r\n// sanitize\r\n        doc_txt = doc_txt.replace(/onmouseover=\"[^\"]*\"/mg,'');\r\n        doc_txt = doc_txt.replace(/onmouseout=\"[^\"]*\"/mg,'');\r\n        doc_txt = doc_txt.replace(/onclick=\"[^\"]*\"/mg,'');\r\n      }\r\n      return doc_txt;\r\n    },\r\n    preprocess_doc : function(doc){\r\n//      site2.common.remove_by_tagname(doc,'script');\r\n      site2.common.remove_attribute(doc,'onload');\r\n      site2.common.remove_attribute(doc,'onmouseover');\r\n      site2.common.remove_attribute(doc,'onmouseout');\r\n      site2.common.remove_attribute(doc,'onclick');\r\n\r\n      site2.common.remove_attribute(doc,'onchange');\r\n      site2.common.remove_attribute(doc,'onfocus');\r\n      site2.common.remove_attribute(doc,'onsubmit');\r\nvar pns = doc.getElementsByTagName('*');\r\nfor (var i=pns.length-1;i>=0;i--)\r\n  if (pns[i].getAttribute && pns[i].getAttribute('href') && pns[i].getAttribute('href').indexOf('javascript:')==0) pns[i].removeAttribute('href');\r\n\r\nif (pref.test_mode['28']) {\r\n      doc.getElementsByTagName('html')[0].innerHTML = doc.getElementsByTagName('html')[0].innerHTML; // remake to sanitize.\r\n}\r\n    },\r\n////////    thread2headline : function(doc){\r\n////////      return site2.common.thread2headline(doc,'KC');\r\n////////    },\r\n    catalog_native_prep: function(date,pn_filter,pn_tb,pn_hi){\r\n      var node_ref = (site.whereami==='catalog')? document.getElementsByClassName('catalog')[0]\r\n                                                : document.querySelector('form[action=\"/delete\"]');\r\n//      var node_ref = (site.whereami==='catalog')? document.getElementById('settings')\r\n//                                                : document.getElementsByName('postcontrols')[0];\r\n//      pn_tb.setAttribute('style', 'float:right');\r\n      site4.tb_prep_for_embed(pn_tb);\r\n//      if (site.whereami==='catalog') {\r\n      var selector_catchan = pn_filter.getElementsByTagName('select')['catalog.indexing'];\r\n      selector_catchan.setAttribute('style','float:left');\r\n      node_ref.parentNode.insertBefore(selector_catchan,node_ref);\r\n      pn_tb.childNodes[3].setAttribute('style','float:left');\r\n      node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n////////      return site2['KC'].catalog_from_native(date,document,site.board,site.whereami+'_html');\r\n    },\r\n////////    catalog_from_native : function(date,doc,board,type) { // working code.\r\n////////      return site2[this.nickname].wrap_to_parse.get(doc, this.nickname, board, type);\r\n////////////      var parse_obj = {domain:'KC', board:board, parse_funcs:site2['KC'].parse_funcs[type], __proto__:site4.parse_funcs_on_demand};\r\n////////////      var ths = {pn:doc, __proto__:parse_obj};\r\n////////////      return ths.ths;\r\n////////    },\r\n    catalog_get_native_area: function(){\r\n      if (site.whereami==='page') return document.querySelector('form[action=\"/delete\"]');\r\n      else return document.getElementsByClassName('catalog')[0];\r\n    },\r\n////    get_click_area: function(pn, th){\r\n////      var areas = [];\r\n////      if (th.type_html==='catalog_html') {\r\n////        var tn = pn.getElementsByClassName('thumbnail');\r\n////        for (var i=0;i<tn.length;i++) areas.push(tn[i].getElementsByTagName('img')[0]);\r\n////      } else if (th.type_html==='page_html') {\r\n////        var fths = pn.getElementsByClassName('file_thread');\r\n////        for (var i=0;i<fths.length;i++) {\r\n////          var imgs = fths[i].getElementsByTagName('img');\r\n////          areas.push(imgs[imgs.length-1]);\r\n////        }\r\n////      }\r\n////      return (areas.length!=0)? areas : [pn]; \r\n////    },\r\n//    get_click_area: function(pn, th){\r\n//      if (th.type_html==='catalog_html') {\r\n//        var tn = pn.getElementsByClassName('thumbnail');\r\n//        return (tn[0])? tn[0].getElementsByTagName('img')[0] : pn;\r\n//      } else if (th.type_html==='page_html') {\r\n//        var imgs = pn.getElementsByClassName('file_thread')[0].getElementsByTagName('img');\r\n//        return imgs[imgs.length-1];\r\n//      }\r\n//    },\r\n    parse_funcs : { // KC\r\n      'catalog_html' : {\r\n        ths: function(doc) {\r\n          var ths = this.ths_array(doc,doc.pn.getElementsByClassName('thread'));\r\n          var t = Date.now() - pref.localtime_offset*3600000; // patch\r\n          for (var i=0;i<ths.length;i++) {\r\n            if (ths[i].time_bumped<0) ths[i].time_bumped += t;\r\n//            var as = ths[i].pn.getElementsByTagName('a');\r\n//            for (var j=0;j<as.length;j++) as[j].removeAttribute('href');\r\n          }\r\n          return ths;\r\n        },\r\n//        th_init: function(th) {\r\n//          var as = th.pn.getElementsByTagName('a');\r\n//          for (var j=0;j<as.length;j++) as[j].addEventListener('click',th.parse_funcs.preventDefault,false);\r\n//        },\r\n//        th_destroy: function(pn, parse_funcs){\r\n//          var as = pn.getElementsByTagName('a');\r\n//          for (var j=0;j<as.length;j++) as[j].removeEventListener('click',parse_funcs.preventDefault,false);\r\n//        },\r\n\r\n        no : function(th){return parseInt(th.pn.getAttribute('id').substr(7),10);}, // the same as 4chan.\r\n//        time_bumped: function(th){return 0;},\r\n        time_bumped: function(th){\r\n          return -1 -parseInt(th.page.substr(0,th.page.indexOf('.')),10)*16 - parseInt(th.page.substr(th.page.indexOf('.')+1));},\r\n        time_created : function(th){return 0;},\r\n        nof_posts: function(th){\r\n          var footer = th.pn.getElementsByClassName('omitted_text')[0];\r\n//          Object.defineProperty(th, 'footer', {value:footer, enumerable:true, writable:true, configurable:true});\r\n//          footer.innerHTML = '';\r\n          var nof_posts = (footer)? parseInt(footer.textContent.match(/[0-9]+/),10) : 0;\r\n          return (isNaN(nof_posts))? 1 : nof_posts + 1;\r\n        },\r\n        nof_files: function(th){return 0;},\r\n        key: function(th){return th.domain + th.board + th.no;},\r\n        sub: function(th){\r\n          var sub = th.pn.getElementsByTagName('header')[0].textContent.trim();\r\n          return (sub.search(/^#[0-9]+$/)==0)? '' : sub;\r\n        },\r\n        name: function(th){return '';},\r\n//        com: function(th){return th.pn.getElementsByTagName('section')[0][brwsr.innerText];},\r\n        com: function(th){return th.pn.getElementsByTagName('section')[0].innerHTML;},\r\n        type_com: 'html',\r\n        footer: function(th){\r\n          var footer = th.pn.getElementsByClassName('omitted_text')[0]; // must parse pn because of mimic mode.\r\n          footer.innerHTML = '';\r\n          return footer;\r\n        },\r\n        sticky: function(th){return false;},\r\n//        format: function(th){th.pn.getElementsByTagName('a')[0].removeAttribute('href');return null;},\r\n        op_img_url:function(th){\r\n//          var img = th.pn.getElementsByClassName('thumbnail')[0].getElementsByTagName('img');\r\n          var tn  = th.pn.getElementsByClassName('thumbnail');\r\n          var img = (tn[0])? tn[0].getElementsByTagName('img') : null; // parse other site's html\r\n          var url = (img && img[img.length-1])? img[img.length-1].getAttribute('src') : undefined;\r\n          return url;\r\n        },\r\n        get_op_src: 'thread_html',\r\n        filename: function (th){ // post can be accepted.\r\n          var op = th.pn.classList.contains('thread') || th.pn.classList.contains('thread_body');\r\n          var files = th.pn.getElementsByClassName('post_files')[0].getElementsByTagName('figure');\r\n          if (files) \r\n            for (var i=0;i<files.length;i++) {\r\n              var href = files[i].getElementsByTagName('img')[0].getAttribute('src');\r\n              if (i===1) th.extra_files = [];\r\n              if (i>=1) th.extra_files[i-1] = {domain:th.domain, board:th.board};\r\n              var idx = href.lastIndexOf('/');\r\n              var tgt = (i===0)? th : th.extra_files[i-1];\r\n//              tgt.filename = href.substr(idx+1);\r\n              tgt.filename = files[i].getElementsByTagName('img')[0].getAttribute('alt');\r\n//              tgt.filename_server = href.substr(0,idx).replace(/[^\\/]*\\//g,'');\r\n              tgt.filename_server = href.substr(idx+1);\r\n            }\r\n          return th.filename;\r\n        },\r\n        prep_mimic: 'page_html',\r\n        tn_imgs: function(){return [];}, // dynamic, or function(th){return th.pn.getElementsByClassName('thumbnail');},\r\n        img2src: function(img){return th.op_img_url.replace('thumbnails','files');},\r\n        dynamic_image_hover: true,\r\n      },\r\n      'catalog_json' : {\r\n        proto: 'catalog_html',\r\n      },\r\n      'page_html' : {\r\n        ths: function(doc) {return this.ths_array(doc, doc.pn.getElementsByClassName('thread'));},\r\n        th_init: function(th) {\r\n          th.pn.removeAttribute('class');\r\n          th.pn.style.clear = 'none';\r\n        },\r\n//        th_destroy: function(pn, parse_funcs){},\r\n//        no : function(th){return th.pn.id.substr(7);},\r\n//        no : function(th){return parseInt(th.pn.id.substr((th.pn.classList.contains('thread'))? 7:5),10);}, // page and posts\r\n        no : function(th){ // page and posts\r\n          return parseInt((th.pn.id)? th.pn.id.replace(/[^_\\-]*./,'') : // /int/\r\n                                      th.pn.getElementsByClassName('postnumber')[0].getElementsByTagName('a')[1].textContent, 10);}, // other boards.\r\n//        ths: function(doc) { // working code.\r\n//          var ths = this.ths_array(doc, doc.pn.getElementsByClassName('thread'));\r\n//          for (var i=0;i<ths.length;i++) {\r\n//            Object.defineProperty(ths[i], 'no', {value:ths[i].pn.id.substr(7), enumerable:true, writable:true, configurable:true});\r\n//            ths[i].pn.removeAttribute('class'); // collection ISN'T writable? and if wrote, its enumerator doesn't work.\r\n//            ths[i].pn.style.clear = 'none';\r\n//          }\r\n//          return ths;\r\n//        },\r\n//        no : function(th){return parseInt(th.pn.getElementsByClassName('quotelink')[0][brwsr.innerText],10);},\r\n        posts: function(th){return this.posts_array(th, th.pn.querySelectorAll('.thread_body, td.postreply'));},\r\n//        posts: function(th){return this.posts_array(th, th.pn.querySelectorAll('.thread_body, .postreply'));}, // doesn't work for thread_reader.\r\n//        posts: function(th){ // working code.\r\n//          var posts = [];\r\n//          posts[0] = {pn:th.pn.getElementsByClassName('thread_body')[0], __proto__:th.__proto__}; // OP\r\n//          var replies = th.pn.getElementsByClassName('postreply');\r\n//          for (var i=0;i<replies.length;i++) posts[posts.length] = {pn:replies[i], __proto__:th.__proto__};\r\n//          return posts;\r\n//        },\r\n        time: function(post){\r\nreturn parseInt(brwsr.Date_parse(post.pn.getElementsByClassName('postdate')[0][brwsr.innerText]),10) + (pref.localtime_offset - site2['KC'].time_offset)*3600000;\r\n},\r\n        nof_posts: function(th){\r\n          var nof_posts = th.pn.getElementsByTagName('table').length +1; // +1 for OP.\r\n          var nof_files = th.pn.getElementsByClassName('filename').length;\r\n          var om_info = th.pn.getElementsByClassName('omittedinfo');\r\n          if (om_info[0]) {\r\n            var str = om_info[0][brwsr.innerText].replace(/\\n/g,'');\r\n            nof_posts += parseInt(str.replace(/\\ post.*/,''),10);\r\n            nof_files += parseInt('0'+str.replace(/\\ file.*/,'').replace(/[^\\ ]*\\ /g,''),10);\r\n          }\r\n          Object.defineProperty(th,'nof_files',{value:nof_files, enumerable:true, configurable:true, writable:true});\r\n          return nof_posts;\r\n        },\r\n        nof_files: function(th){\r\n          if (!th.hasOwnProperty('nof_posts')) this['nof_posts'](th);\r\n          return th.nof_files;\r\n        },\r\n        sub:  function(post){\r\n          var sub = post.pn.getElementsByClassName('postsubject')[0];\r\n          return (sub)? sub.textContent : '';},\r\n        name: function(post){return post.pn.getElementsByClassName('postername')[0][brwsr.innerText];},\r\n        pn_name: function(post){return post.pn.getElementsByClassName('postername')[0];},\r\n//        com:  function(post){return (post.pn.getElementsByClassName('postbody')[0] || post.pn).getElementsByTagName('p')[0][brwsr.innerText];},\r\n        com:  function(post){return (post.pn.getElementsByClassName('postbody')[0] || post.pn).getElementsByTagName('p')[0].innerHTML.replace(/^\\s*/,'').replace(/\\s*$/,'');},\r\n        type_com: 'html',\r\n        footer: function(th){return this.insert_footer4(th.pn.getElementsByClassName('file_thread')[0]);},\r\n//        sticky: function(th){return (th.pn.getElementsByClassName('stickyIcon').length!=0);},\r\n        flag: function(post){  // same as 8chan\r\n          var balls = post.pn.getElementsByTagName('img');\r\n          for (var i=0;i<balls.length;i++) if (balls[i].getAttribute('src').search(/images\\/balls/)!=-1) break;\r\n//          return (i<balls.length)? balls[i].cloneNode(false) : null; // may cause memory leak\r\n//          return (i<balls.length)? document.importNode(balls[i],false) : null;\r\n          if (i<balls.length) {\r\n            var ball = document.importNode(balls[i],false);\r\n            ball.setAttribute('src', site2['KC'].absolute_link_1(ball.getAttribute('src')));\r\n            return ball;\r\n          } else return null;\r\n//          if (i<balls.length) { // didn't stop memory leak.\r\n//            var ball = document.createElement('img');\r\n//            ball.setAttribute('src',balls[i].getAttribute('src'));\r\n//            return ball;\r\n//          } else return null;\r\n        },\r\n        op_img_url:function(th){\r\n//          var img = th.pn.getElementsByClassName('file_thread')[0].getElementsByTagName('img');\r\n          var ft  = th.pn.getElementsByClassName('file_thread');\r\n          var img = (ft[0])? ft[0].getElementsByTagName('img') : null; // parse other site's html\r\n          var url = (img && img[img.length-1])? img[img.length-1].getAttribute('src') : undefined;\r\n          if (ft.length>=2) {\r\n            th.op_img_url2 = [];\r\n            for (var i=1;i<ft.length;i++) {\r\n              img = ft[i].getElementsByTagName('img');\r\n              var url2 = (img && img[img.length-1])? img[img.length-1].getAttribute('src') : undefined;\r\n              if (url2) th.op_img_url2[th.op_img_url2.length] = url2;\r\n            }\r\n          }\r\n//          return url;\r\n          return site2[th.domain].protocol + '//' + site2[th.domain].domain_url + url; // patch\r\n        },\r\n////        post_no: function(post){return parseInt(post.pn.getElementsByClassName('quotelink')[1][brwsr.innerText],10);},\r\n        get_op_src: 'thread_html',\r\n        get_thread_links : function(th){\r\n          var as = th.pn.getElementsByClassName('postheader')[0].getElementsByTagName('a');\r\n          for (var i=0;i<as.length;i++) \r\n            if (as[i].textContent==='Reply' || as[i].textContent==='Antworten') return [as[i]];\r\n        },\r\n        get_omitted_info : function(post){return post.pn.getElementsByClassName('omittedinfo')[0];},\r\n        set_omitted_info : function(post, info){post.pn.insertBefore(info,post.pn.getElementsByClassName('postbody')[0].nextSibling);},\r\n        replace_omitted_info2 : function(dst, src){dst.childNodes[0].textContent = (src)? src.childNodes[0].textContent : '';},\r\n        filename: function (th){ // post can be accepted.\r\n          var op = th.pn.classList.contains('thread') || th.pn.classList.contains('thread_body');\r\n          var files = th.pn.getElementsByClassName((op)? 'file_thread' : 'file_reply');\r\n          if (files) \r\n            for (var i=0;i<files.length;i++) {\r\n              var href = files[i].getElementsByClassName('filename')[0].getElementsByTagName('a')[0].getAttribute('href');\r\n              if (i===1) th.extra_files = [];\r\n              if (i>=1) th.extra_files[i-1] = {domain:th.domain, board:th.board};\r\n              var idx = href.lastIndexOf('/');\r\n              var tgt = (i===0)? th : th.extra_files[i-1];\r\n              tgt.filename = href.substr(idx+1);\r\n//              tgt.filename_server = href.substr(0,idx).replace(/[^\\/]*\\//g,'');\r\n              tgt.filename_server = href.substr(0,idx).replace(/[^\\/]*\\//g,'').replace(/jpeg$/,'jpg');\r\n              var info = files[i].getElementsByClassName('fileinfo')[0].textContent.replace(/\\s/g,'').split(',');\r\n              tgt.w = parseInt(info[1].substr(0,info[1].indexOf('x')  ),10);\r\n              tgt.h = parseInt(info[1].substr(  info[1].indexOf('x')+1),10);\r\n              var fsize = info[1].split(/\\s/);\r\n              fsize[1] = (fsize[1]==='kB')? 1000 : (fsize[1]==='MB')? 1000000 : 1;\r\n              tgt.fsize = parseInt(fsize[0],10) * fsize[1];\r\n              var tn = files[i].querySelector('img[id^=thumbnail]');\r\n              if (tn) {\r\n                tgt.tn_w = parseInt(tn.getAttribute('width'),10);\r\n                tgt.tn_h = parseInt(tn.getAttribute('height'),10);\r\n              }\r\n            }\r\n          return th.filename;\r\n        },\r\n        tn_imgs: function(th){return th.pn.querySelectorAll('img[id^=thumbnail]');},\r\n        prep_mimic: function (th){\r\n//          th.posts[0].no = th.no; // doesn't work because posts[0].no has getter.\r\n//          for (var i=0;i<th.posts.length;i++) Object.defineProperty(th.posts[i],'no',{value:th.no}); // test patch\r\n          th.op_img_url = th.parse_funcs.op_img_url(th);\r\n        },\r\n        get_op_src: function(th){return site2['KC'].catalog_json2html3_src(th);},\r\n        get_max_page: function(doc){\r\n//          var pns = doc.querySelectorAll('form[action*=delete]')[0].lastChild.previousSibling.previousSibling.previousSibling.getElementsByTagName('*'); // CAN'T GET [1] because it's a text node.\r\n          var pns = doc.querySelectorAll('form[action*=delete]')[0].lastChild.previousSibling.previousSibling.previousSibling.childNodes[1].childNodes[1].childNodes[0].childNodes[3].childNodes; // WORKS ONLY PAGE 0.\r\n          var max = 0;\r\n          for (var i=0;i<pns.length;i++) {\r\n            var text = pns[i].textContent.replace(/\\s+/g,'');\r\n            if (max+1 == text || '['+(max+1)+']'===text) max++; // == used intentionally.\r\n          }\r\n          return max;\r\n        },\r\n      },\r\n      'thread_html' : {\r\n//        ths: function(doc) {return this.ths_array(doc, doc.pn.getElementsByClassName('thread_body'));}, // patch, but for what???, de-patched for trial.\r\n//        com:  function(post){return post.pn.getElementsByTagName('blockquote')[0][brwsr.innerText];},\r\n        com:  function(post){return post.pn.getElementsByTagName('blockquote')[0].innerHTML.replace(/^\\s*/,'').replace(/\\s*$/,'');},\r\n        type_com: 'html',\r\n        time_created: function(th){\r\nreturn th.parse_funcs.time(th.posts[0]);},\r\n        time_bumped: function(th){\r\nreturn th.parse_funcs.time(th.posts[th.posts.length-1]);},\r\n////        pop_post_prep: function(th){ // working code.\r\n////          th.children = th.pn.getElementsByClassName('postreply');\r\n////          th.idx_pop = th.children.length-1;\r\n////        },\r\n////        pop_post: function(th){\r\n////          if (th.idx_pop>=0) {\r\n////            th.post = {pn:th.children[th.idx_pop--], parse_funcs:this, __proto__:th.__proto__};\r\n////            return true;\r\n////          }\r\n////          return false;\r\n////        },\r\n        get_op_src: function(th){return th.op_img_url.replace('thumbnails','files');},\r\n        proto: 'page_html',\r\n      },\r\n      'post_html' : {\r\n        flag: 'page_html',\r\n      },\r\n    },\r\n\r\n    general_event_handler:{\r\n      catalog:{\r\n        mouseover: function(e){\r\n          var et = e.target;\r\n          var et_tagName = et.tagName;\r\n          if (et_tagName==='IMG')\r\n            if (pref[cataLog.embed_mode].image_hover && et.parentNode.className==='thumbnail') cataLog.image_hover_add.call(e.target,e, e.target.src.replace(/thumbnail/,'file'));\r\n        },\r\n        __proto__: site2['DEFAULT'].general_event_handler.catalog\r\n      },\r\n    },\r\n\r\n    popups_href2dbtp: function(href, src, th){\r\n      if (href[0]==='#' && th) {\r\n        href = this.link_dbtp2href([th.domain, th.board, th.no, href.substr(1)]);\r\n        src.setAttribute('href',href);\r\n      }\r\n      var hrefs = href.split(/[\\/#]/);\r\n      var p = hrefs[hrefs.length-1];\r\n      var t = hrefs[hrefs.length-2].replace('thread-','').replace('.html','');\r\n      var b = (hrefs.length>=3)? '/'+hrefs[hrefs.length-3]+'/' : site.board;\r\n      return ['KC',b,t,p]\r\n    },\r\n    link_dbtp2href: function(dbtp){\r\n      return dbtp[1] + 'thread-' + dbtp[2] + '.html#' + dbtp[3];\r\n    },\r\n\r\n    post_json2html_fname_server: function(post){return post.filename_server;},\r\n    post_json2html_fname: function(post){return post.filename;},\r\n    catalog_json2html3_src: function(obj) {return site.protocol + '//' + site2[obj.domain].domain_url + '/files/' + obj.filename_server;},\r\n    catalog_json2html3_thumbnail: function(obj) {return site.protocol + '//' + site2[obj.domain].domain_url + '/thumbnails/' + obj.filename_server;},\r\n//    catalog_json2html3_thumbnail: function(obj, board) {\r\n//      var ext = (obj.ext==='.jpg' || obj.ext==='.png' || obj.ext==='.gif' || obj.ext==='.webm')? '.jpg' : obj.ext;\r\n//      return (obj.ext)? 'http://i.4cdn.org' + obj.board + obj.tim + 's' + ext : '';\r\n//    },\r\n\r\n\r\n\r\n\r\n    \r\n    post_json2html : function(post, board, op, short_link, th_no) {\r\n      var pn = document.createElement('div');\r\n      var time_unit = (post.parse_funcs && post.parse_funcs.time_unit) || 1;\r\n      var date = new Date((post.time || 0) * time_unit);\r\n      var html_file = '';\r\n      if (post.filename) {\r\n        html_file += this.post_json2html_file(post,board, post.extra_files);\r\n        if (post.extra_files) for (var i=0;i<post.extra_files.length;i++) html_file += this.post_json2html_file(post.extra_files[i],board, true);\r\n      }\r\n      pn.innerHTML =\r\n        '<div class=\"' +((op)? 'thread_body' : 'postreply\" id=\"post-' +post.no) + '\">'+ // <td> can't be used alone.\r\n          '<div class=\"postheader\">'+\r\n            '<input name=\"post_' + post.no+ '\" value=\"delete\" type=\"checkbox\">'+\r\n            ((post.flag)? post.flag.innerHTML : '')+ //  '<img src=\"/images/balls/ca.png\">'+\r\n            '<span class=\"postsubject\">' +post.sub+ '</span> '+\r\n            '<span class=\"postername\">' +post.name+ '</span> '+\r\n            '<span class=\"postdate\">' + date.toLocaleString()+ '</span> '+\r\n            '<span class=\"postnumber\">'+\r\n              '<a href=\"/int/thread-' +th_no+ '.html#' +post.no+ '\" class=\"quotelink\">No.</a>'+\r\n              '<a href=\"/int/thread-' +th_no+ '.html#q'+post.no+ '\" class=\"quotelink\">' +post.no+ '</a>'+\r\n            '</span> '+\r\n            '<div class=\"report_parent\"><a href=\"/report/int/' +th_no +'\" class=\"report_link\"><img src=\"/images/icon-report.png\"></a></div>'+\r\n          '</div>'+\r\n          html_file+\r\n          '<div' + ((op)? ' class=\"postbody\"' : '') + '>'+\r\n            '<blockquote>'+\r\n              '<p id=\"post_text_' +post.no+ '\">'+ post.com + '</p>'+\r\n            '</blockquote>'+\r\n          '</div>'+\r\n        '</div>'; //'<td>';\r\n      return pn.childNodes[0];\r\n    },\r\n    post_json2html_file : function(post, board, multifile) {\r\n      var fsize_str = (((post.fsize>1048576)? post.fsize/1048576 : post.fsize/1024)+0.005).toString();\r\n      fsize_str = fsize_str.substr(0,fsize_str.indexOf('.')+3) + ((post.fsize>1048576)? ' MB' : ' KB');\r\n      var fname_server = site2[post.domain].post_json2html_fname_server(post);\r\n      var fname = site2[post.domain].post_json2html_fname(post);\r\n      var furl = site2[post.domain].catalog_json2html3_src(post,board);\r\n      var turl = site2[post.domain].catalog_json2html3_thumbnail(post,board);\r\n      var html_str =\r\n        '<div class=\"file_thread\">'+\r\n          '<span class=\"filename\">'+\r\n            '<a href=\"/download/' +fname_server+ '/' +fname+ '\">' +fname+ '</a>'+\r\n          '</span>'+\r\n//          '<img id=\"button_expand_image_185478186\" src=\"/images/button-expand.gif\" style=\"cursor: pointer\">'+\r\n//          '<a href=\"/paint?action=new&amp;board=int&amp;thread=35608887&amp;modify=185478186&amp;applet=shipainter\" onmouseover=\"helpTip('Modify picture')\" onmouseout=\"UnTip()\">'+\r\n//            '<img src=\"/images/button-paint.gif\" border=\"0\" width=\"15\" height=\"15\"></a>\r\n          '<br>'+\r\n          '<span class=\"fileinfo\"> '+ fname.substr(fname.lastIndexOf('.')+1).toUpperCase()+ ', ' +post.w+ 'x' +post.h+ ', ' + fsize_str + '</span><br>'+\r\n          '<a href=\"' +furl+ '\" target=\"_blank\">'+\r\n           '<img style=\"display: block\" id=\"thumbnail_' +fname_server+ '\" src=\"' +turl+ '\" width=\"' +post.tn_w+ '\" height=\"' +post.tn_h+ '\">'+\r\n          '</a>'+\r\n//          '<span id=\"filename_XXXXXXXXX\" style=\"display: none; margin-top: 0px; margin-left: 0px;\">iPhone-SE-vs-iPhone-6S.jpg</span>'+\r\n        '</div>'\r\n      return html_str;\r\n    },\r\n    page_json2html3 : function(obj,board,thumb_url, assign_pn) { // TEMPORAL, USE thumb_url TO MIMIC. // copied from vichan.\r\n      assign_pn = true; // test patch\r\n      var th = document.createElement('div');\r\n      th.setAttribute('id','thread_'+obj.no);\r\n      th.setAttribute('style','clear:both');\r\n      th.innerHTML = '<hr><a name=' +obj.no+ '></a>';\r\n//      th.setAttribute('style','float: left; overflow: hidden;');\r\n      var op = this.post_json2html((obj.posts && obj.posts[0])? obj.posts[0] : obj, board, true, site2[obj.domain].short_link(obj.key, obj.nof_posts, 2, '[Last ',' Posts]'), obj.no);\r\n//      var files = op.getElementsByClassName('file_thread');\r\n//      if (files.length>0) for (i=0;i<files.length;i++) th.appendChild(files[i]);\r\n//      if (obj.posts && obj.posts[0] && obj.posts[0].extra_files) op.setAttribute('style','clear:both;');\r\n      th.appendChild(op);\r\n//      if (assign_pn) obj.posts[0].pn = th;\r\n      if (assign_pn || !obj.posts[0].pn) obj.posts[0].pn = op;\r\n      if (obj.posts) {\r\n        for (var i=1;i<obj.posts.length;i++) {\r\n//          th.appendChild(this.post_json2html(obj.posts[i], board));\r\n          var pn = this.post_container(this.post_json2html(obj.posts[i], board),obj.posts[i].no);\r\n          this.update_posts_insert_1(pn, obj.posts[i].no, null, th);\r\n//          th.appendChild(document.createElement('br'));\r\n          if (assign_pn || !obj.posts[i].pn) obj.posts[i].pn = pn;\r\n        }\r\n        this.page_json2html3_add_omitted_info(obj,obj.posts,obj.posts);\r\n////////      } else { // WILL BE REDUNDANT\r\n////////        var keys = Object.keys(obj); // obj.posts===undefined, but it is defined as undefined, so key contains 'posts'. \r\n////////        obj.posts = [];\r\n////////        obj.posts[0] = {};\r\n////////        for (var i=0;i<keys.length;i++) if (keys[i]!=='posts') obj.posts[0][keys[i]] = obj[keys[i]]; // remove props in prototype chain.\r\n////////        obj.posts[0].pn = op;\r\n      }\r\n//      var br = document.createElement('br');\r\n//      br.setAttribute('class','clear');\r\n//      th.appendChild(br);\r\n//      th.appendChild(document.createElement('hr'));\r\n      return th;\r\n    },\r\n    page_json2html3_replace_expander : function(posts_old, idx) {\r\n      var omit_info = posts_old[0].pn.getElementsByClassName('omittedinfo')[0];\r\n      if (omit_info) {\r\n        var expander = document.createElement('select');\r\n        cnst.config_expander(expander, idx);\r\n//        omit_info.removeChild(omit_info.childNodes[1]);\r\n        omit_info.appendChild(expander);\r\n      }\r\n    },\r\n    page_json2html3_add_omitted_info : function(th,posts_old,posts) {\r\n      var nof_files = 0;\r\n      for (var i=1;i<posts.length;i++) nof_files += (posts[i].type_data==='html')? posts[i].pn.getElementsByClassName('file_thread').length :\r\n                                                    (!posts[i].filename)? 0 :\r\n                                                    (posts[i].extra_files)? posts[i].extra_files.length+1 : 1;\r\n      var nof_files_omitted = th.nof_files - nof_files;\r\n      var nof_posts_omitted = th.nof_posts - posts.length;\r\n\r\n      var omit_info = (posts_old)? posts_old[0].pn.getElementsByClassName('omittedinfo')[0] : null;\r\n      if (th.nof_posts>1) { // for expand ALL\r\n        if (!omit_info) {\r\n          omit_info = document.createElement('span');\r\n          omit_info.setAttribute('class','omittedinfo');\r\n//          omit_info.innerHTML = 'dummy<a href=\"javascript:void(0)\">Click to expand</a>.';\r\n          omit_info.innerHTML = 'dummy<select></select>';\r\n          cnst.config_expander(omit_info.childNodes[1]);\r\n          if (posts_old) posts_old[0].pn.insertBefore(omit_info, posts_old[0].pn.getElementsByClassName('postbody')[0].nextSibling);\r\n        }\r\n        omit_info.childNodes[0].textContent = (nof_posts_omitted!==0)? (nof_posts_omitted +' post' + ((nof_posts_omitted!==1)? 's':'') +\r\n          ((nof_files_omitted)? ' and ' + nof_files_omitted + ' file'+ ((nof_files_omitted===1)? '' : 's') : '') + ' are not shown. ') : '';\r\n      } else if (omit_info && posts_old) posts_old[0].pn.removeChild(omit_info);\r\n      return omit_info;\r\n    },\r\n    update_posts_remove: function(th_old,i,pnode,merge){\r\n      pnode = pnode.getElementsByClassName('thread_body')[0];\r\n      var tgt = th_old.posts[i].pn;\r\n      if (!merge || tgt.parentNode!==pnode) tgt = tgt.parentNode.parentNode.parentNode;\r\n      else this.update_posts_insert_pack(tgt);\r\n      if (tgt.previousSibling && tgt.previousSibling.tagName==='A') pnode.removeChild(tgt.previousSibling); // <a>\r\n      pnode.removeChild(tgt);\r\n    },\r\n    update_posts_insert: function(src,dst,i,j,pnode){\r\n      var ref = dst[j];\r\n//      var ref = dst[(j<dst.length)? j : dst.length-1];\r\n      ref = (ref)? ref.pn : null;\r\n      var ref_pnode2 = ref && ref.parentNode && ref.parentNode.parentNode && ref.parentNode.parentNode.parentNode;\r\n      if (ref_pnode2 && ref_pnode2.parentNode && ref_pnode2.parentNode.parentNode===pnode) ref = ref_pnode2; // remove container\r\n//      if (j>=dst.length) ref = ref && ref.nextSibling && ref.nextSibling.nextSibling || null;\r\n      if (!src[i].pn) src[i].pn = this.post_json2html(src[i],src[i].board);\r\n      if (i===0) this.update_posts_insert_pack(src[0].pn);\r\n      if (j===0 && ref) this.update_posts_insert_pack(dst[0].pn);\r\n      var tgt = (j===0 && i===0)? src[i].pn : this.post_container(src[i].pn,src[i].no); // patch for thread merging.\r\n      this.update_posts_insert_1(tgt,src[i].no,ref,pnode);\r\n      if (i===0 && j===0) this.update_posts_insert_unpack(src[0].pn);\r\n    },\r\n    update_posts_insert_1: function(tgt,no,ref,pnode){\r\n      pnode = pnode.getElementsByClassName('thread_body')[0];\r\n      var pn_a = document.createElement('a');\r\n      pn_a.setAttribute('name',no);\r\n      pnode.insertBefore(pn_a,ref);\r\n      pnode.insertBefore(tgt, ref);\r\n    },\r\n    update_posts0_class: site2['vichan'].update_posts0_class,\r\n    update_posts_insert_pack: site2['vichan'].update_posts_insert_pack,\r\n    update_posts_insert_pack_iter: function(pn, func){\r\n      var prev = pn.previousSibling;\r\n      while (prev) {\r\n        var prev_prev = prev.previousSibling; // prev is livelist.\r\n        if (prev.classList && (prev.classList.contains(pref.script_prefix+'_footer') || prev.classList.contains('file_thread') || prev.classList.contains('post_header'))) func(prev);\r\n        if (prev.classList &&  prev.classList.contains('postbody')) break;\r\n        prev = prev_prev;\r\n      }\r\n    },\r\n    update_posts_insert_unpack: function(pn){\r\n      while (1) {\r\n        var fchild = pn.firstChild;\r\n        if (fchild && fchild.classList && (fchild.classList.contains(pref.script_prefix+'_footer') || fchild.classList.contains('file_thread') || fchild.classList.contains('post_header'))) pn.parentNode.insertBefore(fchild, pn);\r\n        else break;\r\n      }\r\n    },\r\n    post_container : function(post_pn,no) {\r\n      var pn = document.createElement('table');\r\n      pn.innerHTML = '<tbody><tr><td valign=\"top\">&gt;&gt;</td></tr></tbody>';\r\n      pn.childNodes[0].childNodes[0].appendChild(post_pn);\r\n      return pn;\r\n    },\r\n\r\n\r\n\r\n\r\n    catalog_json2html3 : function(obj,board,thumb_url) {\r\n      var th = document.createElement('article');\r\n      th.setAttribute('class','thread teaser');\r\n      th.setAttribute('id','thread-'+obj.no);\r\n      var post_flag = null;\r\n      if (obj.flags && obj.flags[0]) {\r\n//        post_flag = obj.flags[0].cloneNode(false);\r\n        post_flag = document.importNode(obj.flags[0],false);\r\n        post_flag.setAttribute('class','post_country');\r\n      }\r\n//      th.innerHTML = '<a href=\"http://boards.4chan.org' + obj.board + 'thread/' + obj.no + ((obj.sub)? '/'+obj.sub.replace(/ /,'-') : '') + '\">' + // cause direct jump\r\n\r\n        th.innerHTML =\r\n//          '<article tabindex=\"0\" id=\"thread_' + obj.no + '\" class=\"thread teaser\">'+\r\n            '<article class=\"thread_OP\" id=\"' + obj.no + '\">'+\r\n              '<div class=\"post\">'+\r\n                '<header>'+\r\n                  '<a><h1>'+\r\n                    ((post_flag)? post_flag.outerHTML : '') + \r\n//                    '<img class=\"post_country\" src=\"http://krautchan.net/images/balls/kz.png\" style=\"cursor:pointer\" name=\"KC/catalog/01234567\">/+\r\n                        ((obj.sub)? obj.sub : '#'+obj.no )+ \r\n//                        obj.sub + \r\n                  '</h1></a>'+\r\n                '</header>'+\r\n                '<div class=\"post_body\">'+\r\n                  '<a>'+\r\n                    '<div class=\"post_files multiple\">'+\r\n                      '<figure>'+\r\n                        '<div class=\"thumbnail\">'+\r\n                          '<img src=\"' + obj.op_img_url + '\">'+\r\n                        '</div>'+\r\n                      '</figure>'+\r\n                      ((obj.op_img_url2 && obj.op_img_url2[0])? (\r\n                        '<figure>'+\r\n                          '<div class=\"thumbnail\">'+\r\n                            '<img src=\"' + obj.op_img_url2[0] + '\">'+\r\n                          '</div>'+\r\n                        '</figure>'+\r\n                        ((obj.op_img_url2 && obj.op_img_url2[1])? (\r\n                          '<figure>'+\r\n                            '<div class=\"thumbnail\">'+\r\n                              '<img src=\"' + obj.op_img_url2[1] +'\">'+\r\n                            '</div>'+\r\n                          '</figure>'+\r\n                          ((obj.op_img_url2 && obj.op_img_url2[2])? (\r\n                            '<figure>'+\r\n                              '<div class=\"thumbnail\">'+\r\n                                '<img src=\"' + obj.op_img_url2[2] + '\">'+\r\n                              '</div>'+\r\n                            '</figure>') :\r\n                          '')) :\r\n                       '')) : '') +\r\n                    '</div>'+\r\n                  '</a>'+\r\n                  '<div class=\"omittedposts\">'+\r\n                    '<span class=\"omitted_text\">R: 0 / I: 0 / P: 0.0&emsp;/catalog/</span>'+\r\n                  '</div>'+\r\n                  '<div class=\"post_text\"><section>'+\r\n                    obj.com +\r\n                  '</section></div>'+\r\n                '</div>'+\r\n              '</div>'+\r\n            '</article>';\r\n//          '</article>';\r\n      var tns = th.getElementsByClassName('thumbnail');\r\n      tns[0].childNodes[0].addEventListener('load',site2['KC'].catalog_json2html3_onload,false);\r\n      return th;\r\n    },\r\n    catalog_json2html3_onload : function() {\r\n      this.removeEventListener('load',site2['KC'].catalog_json2html3_onload,false);\r\n      var w = this.naturalWidth;\r\n      var h = this.naturalHeight;\r\n      var f = ((w>h)? w : h) / 200;\r\n      this.setAttribute('width', w/f);\r\n      this.setAttribute('height', h/f);\r\n    },\r\n    favicon : {\r\n      __proto__: site2['vichan'].favicon,\r\n      none: '/favicon.ico',\r\n      reply: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAKJJREFUOE9jZPh/hgECfv4yts59/PgxlAujZGVlzx6dzMDOBhMAaoCjtEA01SAuUBBZDQrnwEwsGoCCKBp+HEPwPx6QkZFB1gPifjyAUABUbGxsDLIUaAxEItQFxRIgFygIlAIqSAsEKYYDkGGhLpaWlsgaQNxQFxRrxcTEsLgbhxBI8SDUQLKnSQ9WUiOO9KRBfuL7cQzoH2C0oAGQJ5GcDQBwM6RhinByrgAAAABJRU5ErkJggg==',\r\n      reply_to_me: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAMxJREFUOE9jZPh/hgECfv4yts59/PgxlAujZGVlzx6dzMDOBhMAavh/5j8MoKkGcdMCQYbCEYSFT8OBmagafhxD1iAjI4NsCYj78QBCA1CxsbEx0FKEDaEuKK4CcoFOAOoB2pMWCFIMAXANlpaWyBpA3FAXFGvFxMSQNWDxNJIQSDFEA5EAoQFfKGG1gQQNcP0gn4W6EPY0JFhBoQYJb8LBCo44KPp4gHDEoUQ70B5MgJ40kBMW0G2YAGviA9nz4xjQP8CQRgMgTyI5GwD2xdfU779fsgAAAABJRU5ErkJggg=='\r\n    },\r\n    add_backlinks: function(pn,backlinks,target,th){}, // dummy\r\n  };\r\n  site2['4chan'] = {\r\n    nickname : '4chan',\r\n//    home : site.protocol + '//boards.4chan.org/int/',\r\n    home : site.protocol + '//boards.4chan.org/favicon.ico',\r\n    protocol: 'http:',\r\n    postform: document.getElementsByClassName('postForm')[0],\r\n    postform_rules: null,\r\n    postform_activation : function(){\r\n      document.getElementById('togglePostFormLink').getElementsByTagName('a')[0].click();\r\n      site.postform = document.getElementsByClassName('postForm')[0];\r\n    },\r\n    features : {uip_tracker: true},\r\n    components: {\r\n      boardlist: '.boardList',\r\n      postform_comment: 'textarea[name=\"com\"]',\r\n      postform_submit: 'input[type=\"submit\"]',\r\n      postform_comment2: ['textarea[name=\"com\"]',1],\r\n      postform_submit2: ['input[type=\"submit\"]',2],\r\n    },\r\n    pref_default: {\r\n      catalog_expand_with_hr: true,\r\n      patch: {delayed_invoke: {use: brwsr.ff}},\r\n      catalog: {t2h_sel:'N', image_hover_zIndex:100001},\r\n      proto:{\r\n        env:{\r\n          event_dynamic: true,\r\n        }\r\n      },\r\n      easy2:{limits:2},\r\n    },\r\n    spoiler_text: {\r\n      open_rule: 's,s a:not(:hover) {color: #fff!important;}',\r\n    },\r\n    general_event_handler:(function(){\r\n      var obj = {\r\n        thread: {\r\n////          last_viewed: function(e){return e.target.classList && e.target.classList.contains('post');}, // working code, but not used.\r\n////          get_next_mark: function(pn){\r\n////            var parent_next = pn.parentNode && pn.parentNode.nextSibling;\r\n////            if (parent_next.tagName==='SPAN') parent_next = parent_next.nextSibling;\r\n////            var next_post = parent_next && parent_next.getElementsByClassName('post')[0];\r\n////            if (!next_post) {\r\n////              var parent_parent_next = pn.parentNode.parentNode.nextSibling;\r\n////              next_post = parent_parent_next.getElementsByClassName('post')[0];\r\n////            }\r\n////            return next_post;\r\n////          },\r\n////          get_prev_mark: function(pn){\r\n////            var parent_prev = pn.parentNode && pn.parentNode.previousSibling;\r\n////            if (parent_prev.tagName==='SPAN') parent_prev = parent_prev.previousSibling;\r\n////            var prev_post = parent_prev && parent_prev.getElementsByClassName('post')[0];\r\n////            if (!prev_post) {\r\n////              var parent_parent_prev = pn.parentNode.parentNode.previousSibling;\r\n////              prev_post = parent_parent_prev.getElementsByClassName('post')[0];\r\n////            }\r\n////            return prev_post;\r\n////          },\r\n          get_mark: function(pn, clientY){\r\n            while (pn && pn!== cataLog.parent) {\r\n              if (pn.classList.contains('post')) return pn;\r\n              if (pn.classList.contains('postContainer')) return pn.getElementsByClassName('post')[0];\r\n              if (pn.parentNode && pn.parentNode.classList.contains('thread')) {\r\n                pn = pn.previousSibling;\r\n                if (pn) continue;\r\n                else break;\r\n              }\r\n              if (pn.classList.contains('thread')) break;\r\n              pn = pn.parentNode;\r\n            }\r\n            return this.get_mark_from_height(clientY);\r\n          },\r\n          get_mark_from_height: function(now_height){\r\n            return this.__proto__.get_mark_from_height(now_height, document.getElementsByClassName('post'));\r\n          },\r\n          __proto__: site2['DEFAULT'].general_event_handler.common,\r\n        },\r\n      };\r\n      obj.page = Object.create(obj.thread);\r\n      obj.catalog = {\r\n        mouseover: function(e){\r\n          var et = e.target;\r\n          var et_tagName = et.tagName;\r\n          if (et_tagName==='IMG')\r\n            if (pref[cataLog.embed_mode].image_hover && et.parentNode.tagName==='A') cataLog.image_hover_add.call(et, e);\r\n        },\r\n        __proto__:obj.thread\r\n      };\r\n      return obj;\r\n    })(),\r\n    domain_url: 'boards.4chan.org',\r\n    check_func : function(){\r\n      if (window.location.href.search(/4chan.org/)!=-1) { // 4chan\r\n        site.whereami = (document.getElementsByTagName('head')[0].innerHTML.indexOf('404 Not Found')!=-1)? '404'\r\n                      : (window.location.href.search(/catalog/)!=-1)? 'catalog'\r\n                      : (window.location.href.search(/thread\\/[0-9]+/)!=-1)? 'thread'\r\n                      : (window.location.href.search(/archive/)!=-1)? 'archive'\r\n                      : (window.location.href.search(/\\/$|(index|[0-9]+)(\\.html)*|\\/#all$/)!=-1)? 'page'\r\n                      : 'other';\r\n        site.config('4chan.org','4chan');\r\n        this.postform_prep();\r\n        site.max_page = site2['4chan'].max_page(site.board);\r\n        site.header_height = function(){\r\n          var header = document.getElementById('header');\r\n          if (header) return header.offsetHeight;\r\n          else return 0;\r\n        }\r\n        if (site.whereami==='thread') { // || site.whereami==='page') {\r\n          site.embed_to['top']    = document.getElementsByClassName('navLinks')[0];\r\n          site.embed_to['bottom'] = document.getElementsByClassName('bottomad')[0] || document.getElementById('boardNavDesktopFoot');\r\n//          site.embed_to['bottom'] = document.getElementsByClassName('bottomad')[0];\r\n        } else if (site.whereami==='page') {\r\n          site.embed_to['top']    = document.getElementById('ctrl-top');\r\n//          site.embed_to['bottom'] = document.getElementsByClassName('board')[0].nextSibling; // fail\r\n          site.embed_to['bottom'] = document.getElementsByClassName('pagelist')[0];\r\n        } else if (site.whereami==='catalog') {\r\n          site.embed_to['top']    = document.getElementById('content').previousSibling;\r\n          site.embed_to['bottom'] = document.getElementsByClassName('navLinksBottom')[0].nextSibling;\r\n        }\r\n        return true;\r\n      } else return false;\r\n    },\r\n//    catalog_background : '#ffffee',\r\n    //    catalog_bordercolor : '#f0e0d6',\r\n    get_next_image: function(img,top){\r\n      var imgs = cataLog.parent.querySelectorAll('img[data-md5]');\r\n      var idx = Array.prototype.indexOf.call(imgs,img.previousSibling);\r\n      if (top) while (imgs[idx+1] && imgs[idx+1].offsetTop<top) idx++;\r\n      if (idx>=0) {\r\n        while (imgs[idx+1] && imgs[idx+1].parentNode.getAttribute('href').search(/\\.webm$/)!=-1) idx++;\r\n        return imgs[idx+1];\r\n      } else return null;\r\n    },\r\n    format_expanded_thumbnail: function(img){\r\n      img.removeAttribute('data-md5');\r\n      img.className = 'expanded-thumb';\r\n    },\r\n    catalog_threads_in_page : function(doc){return doc.getElementsByClassName('thread');},\r\n    catalog_posts_in_thread : function(doc){return doc.getElementsByClassName('replyContainer');},\r\n    max_page : function(){return 10;},\r\n    make_url4 : function(dbt, trim_page){ // dbt[2] is string.\r\n      var url_prefix  = site.protocol + '//' + this.domain_url + dbt[1];\r\n      var url_prefix2 = site.protocol + '//' + 'a.4cdn.org' + dbt[1];\r\n      if (dbt[3]==='catalog_html' || (trim_page && dbt[2]==0 && dbt[3]==='page_json')) dbt[3] = 'catalog_json'; // catalog_html is a skelton.\r\n      return (dbt[3]==='page_json')?       [url_prefix2 + (parseInt(dbt[2],10)+1) + '.json', 'json', (trim_page)? '4chan'+dbt[1]+'j0' : undefined] : // dbt[2] is string.\r\n             (dbt[3]==='catalog_json')?    [url_prefix2 + 'catalog.json', 'json', '4chan'+dbt[1]+'j0'] :\r\n             (dbt[3]==='thread_json')?     [url_prefix2 + 'thread/' + dbt[2] + '.json', 'json'] :\r\n             (dbt[3]==='page_html')?       [url_prefix  + ((dbt[2]!=0)? (parseInt(dbt[2],10)+1) :''), 'html'] :\r\n             (dbt[3]==='thread_html')?     [url_prefix  + 'thread/' + dbt[2], 'html'] : null;\r\n    },\r\n//////////    make_url : function(board,no){return [site.protocol+'//boards.4chan.org' + board + ((no!=0)? (no+1) :''), 'html'];},  // worling code.\r\n//////////    make_url3: function(board,th){return  site.protocol+'//boards.4chan.org' + board + 'thread/' + th;},\r\n////////    make_url : function(board,no,key){\r\n////////      var url_prefix = site.protocol+'//boards.4chan.org' + board;\r\n////////      return (key==='p')? [url_prefix + ((no!=0)? (no+1) :''), 'html'] :\r\n////////                          [url_prefix + 'catalog.json'       , 'json']; // 4chan's html is skelton.\r\n//////////             (key==='j')? [url_prefix + 'catalog.json'       , 'json'] :\r\n//////////                          [url_prefix + 'catalog'            , 'html'];\r\n////////    },\r\n////////    make_url3: function(board,th){return site.protocol+'//boards.4chan.org' + board + 'thread/' + ((th[0]!=='t')? th : th.substr(1)+'.json');},\r\n    url_boards_json : function(){return [site.protocol+'//a.4cdn.org/boards.json', 'json'];},\r\n    get_ops : function(doc){\r\n      var ops = [];\r\n      var threads = doc.getElementsByClassName('thread');\r\n      for (var i=0;i<threads.length;i++) ops.push(threads[i].id.substring(1));\r\n      return ops;\r\n    },\r\n    get_posts : function(doc) {\r\n      var posts = [];\r\n      var post_containers = doc.getElementsByClassName('postContainer');\r\n      for (var i=0;i<post_containers.length;i++) posts.push(parseInt(post_containers[i].id.substring(2),10));\r\n      return posts;\r\n    },\r\n////////    get_thread_link : function(pn,bn,del){\r\n////////      var link = pn.getElementsByClassName('replylink')[0];\r\n////////      if (link) {\r\n//////////        if (del) link.parentNode.parentNode.removeChild(link.parentNode);\r\n////////        if (del) {\r\n////////          link.parentNode.removeChild(link.nextSibling);\r\n////////          link.parentNode.removeChild(link.previousSibling);\r\n////////          link.parentNode.removeChild(link);\r\n////////        } else if (pref.catalog_open_in_new_tab) link.setAttribute('target','_blank');\r\n////////        return link.getAttribute('href');\r\n////////      } else return null;\r\n////////    },\r\n    modify_thread_link : function(pn){\r\n      var link = pn.getElementsByClassName('replylink')[0];\r\n      if (link) {\r\n        var href = link.getAttribute('href');\r\n        link.removeAttribute('href');\r\n        return [[link, href]];\r\n      } else return [];\r\n    },\r\n//    add_thread_link : function(doc,url){\r\n////      <a href=\"thread/32599218/finland-general\" class=\"replylink\" rel=\"canonical\">Reply</a>\r\n//      var pn = document.createElement('a');\r\n//      var prefix = new RegExp('https*://boards\\.4chan\\.org/[^/]*/');\r\n//      pn.href = url.replace(prefix,'');\r\n//      pn.className = 'replylink';\r\n//      pn.rel = 'canonical';\r\n//      pn.innerHTML = 'Reply';\r\n//      var th = doc.getElementsByClassName('thread')[0];\r\n//      if (th) {\r\n//        th.insertBefore(pn,th.firstChild);\r\n//        th.insertBefore(document.createTextNode('['),pn);\r\n//        th.insertBefore(document.createTextNode(']'),pn.nextSibling);\r\n//      }\r\n//    },\r\n    check_thread_archived : function(th){\r\n      return (th.getElementsByClassName('archivedIcon').length!=0);\r\n    },\r\n//    get_time_of_posts : function(doc){\r\n//      var posts = doc.getElementsByClassName('postContainer');\r\n//      var last_post = posts[posts.length-1];\r\n//      return [(parseInt(posts[posts.length-1].getElementsByClassName('dateTime')[0].getAttribute('data-utc'),10)- pref.localtime_offset*3600)*1000,\r\n//              (parseInt(posts[0             ].getElementsByClassName('dateTime')[0].getAttribute('data-utc'),10)- pref.localtime_offset*3600)*1000];\r\n//    },\r\n    get_time_of_posts : function(th){\r\n      var posts = th.getElementsByClassName('postContainer');\r\n      return [site2['4chan'].get_time_of_post_in_utc(posts[posts.length-1]),site2['4chan'].get_time_of_post_in_utc(posts[0])];\r\n    },\r\n    get_time_of_post_in_utc : function(post){\r\n      return parseInt(post.getElementsByClassName('dateTime')[0].getAttribute('data-utc'),10)*1000;\r\n    },\r\n    mark_newer_posts: function(th,date,unmark) {\r\n      return site2['DEFAULT'].mark_newer_posts('4chan',th.getElementsByClassName('postContainer'),date,'border:2px solid red','border: none','class','post reply',unmark);\r\n    },\r\n    localtime: function(pn){\r\n      var times = pn.getElementsByClassName('dateTime');\r\n      for (var i=0;i<times.length;i++) times[i].textContent = site2.common.change_utc_to_local(parseInt(times[i].getAttribute('data-utc'),10)*1000);\r\n    },\r\n    remove_files_info : function(th){\r\n      site2.common.remove_by_classname(th,'fileText');\r\n      site2.common.remove_by_classname(th,'mFileInfo');\r\n      var filethumbs = th.getElementsByClassName('fileThumb');\r\n      for (var i=0;i<filethumbs.length;i++) site2.common.move_up_and_delete_parent([filethumbs[i].childNodes[0]]);\r\n    },\r\n//    remove_checkboxes : function(doc){\r\n//      var cbxs = doc.getElementsByTagName('input');\r\n//      for (var i=cbxs.length-1;i>=0;i--) cbxs[i].outerHTML = '';\r\n//      return doc;\r\n//    },\r\n    remove_posts : function(th,end){\r\n      site2.common.remove_by_classname(th,'postContainer replyContainer',end,true);\r\n//      site2.common.remove_double_br(th);\r\n    },\r\n//    absolute_link : site2['DEFAULT'].absolute_link.bind({protocol:'http:',domain_url:'http://boards.4chan.org'}), // working code.\r\n////    absolute_link : function(doc,board){\r\n////      var url_prefix = 'http://boards.4chan.org';\r\n////      var protocol   = 'http:';\r\n////      var all = doc.getElementsByTagName('*');\r\n////      for (var i=0;i<all.length;i++) {\r\n////        if (all[i].getAttribute('src')) \r\n////          if (all[i].getAttribute('src').substr(0,2)!='//') all[i].setAttribute('src', url_prefix+board+all[i].getAttribute('src'));\r\n////          else all[i].setAttribute('src', protocol+all[i].getAttribute('src'));\r\n////        if (all[i].getAttribute('href'))\r\n////          if (all[i].getAttribute('href').substr(0,2)!='//') all[i].setAttribute('href',url_prefix+board+all[i].getAttribute('href'));\r\n////          else all[i].setAttribute('href',protocol+all[i].getAttribute('href'));\r\n////      }\r\n////    },\r\n////////    insert_footer : function(th,page_no,bn,exe,date,nof_posts,nof_files){\r\n////////      var key = (!brwsr.ff)? 'innerText' : 'innerHTML';\r\n////////      nof_posts += th.getElementsByClassName('postContainer').length;\r\n////////      nof_files += th.getElementsByClassName('fileText').length;\r\n////////      var om_info = th.getElementsByClassName('summary desktop');\r\n////////      if (om_info[0]) {\r\n////////        var str = om_info[0][key].replace(/\\n/g,'');\r\n////////        nof_posts += parseInt(str.replace(/\\ post.*/,''),10);\r\n////////        nof_files += parseInt('0'+str.replace(/\\ image.*/,'').replace(/[^\\ ]*\\ /g,''),10);\r\n////////      }\r\n////////      if (exe) {\r\n////////        var pn = document.createElement('div');\r\n////////        pn.setAttribute('name','catalog_footer');\r\n////////        pn.innerHTML = '<span>' + bn + '  ' + nof_posts + '/' + nof_files + '/' + page_no + '  </span>';\r\n////////        var flags = th.getElementsByClassName('flag');\r\n////////        for (var i=0;i<flags.length;i+=2) { // contains both mobile and desktop.\r\n////////          pn.appendChild(flags[i].cloneNode(false));\r\n//////////          pn.appendChild(document.createTextNode(' '));\r\n////////        }\r\n////////        var op_info = th.getElementsByClassName('postInfo desktop')[0];\r\n////////        op_info.parentNode.insertBefore(pn,op_info);\r\n////////      }\r\n////////      return [nof_posts,nof_files];\r\n////////    },\r\n    format_thread_layout : function(th){\r\n      site2.common.add_attribute_by_classname(th,'post op','style','padding:0px');\r\n//      site2.common.add_attribute_by_classname(th,'file','style','float:left');\r\n      site2.common.add_attribute_by_tagname(th,'blockquote','style','margin:12px 5px');\r\n    },\r\n    format_thread_contents : function(th){\r\n      site2.common.remove_by_tagname(th,'input');\r\n      site2.common.remove_by_classname(th,'mobile');\r\n//      site2.common.remove_by_classname(th,'postLink mobile');\r\n//      site2.common.remove_by_classname(th,'postInfoM mobile');\r\n      site2.common.remove_by_classname(th,'sideArrows');\r\n      site2.common.remove_by_classname(th,'summary');\r\n    },\r\n////////    thread2headline : function(doc){\r\n////////      return site2.common.thread2headline(doc,'4chan');\r\n////////    },\r\n//    get_json_url_thread: function(board,thread){\r\n//      return site.protocol + '//a.4cdn.org' + board +'thread/' + thread + '.json';\r\n//    },\r\n    get_json_url_catalog: function(board){\r\n      return site.protocol + '//a.4cdn.org' + board +'catalog.json';\r\n    },\r\n    uip_check: function(callback){\r\n      var url = [site.protocol + '//a.4cdn.org' + site.board +'thread/' + site.no + '.json', 'json'];\r\n      var key = site.nickname + site.board + site.no;\r\n      http_req.get('uip',key,url,callback,false,false);\r\n    },\r\n    parse_json_thread: function(obj,from_http){\r\n      if (from_http) {\r\n//        var obj = JSON.parse(txt);\r\n        obj.posts[obj.posts.length-1]['unique_ips'] = obj.posts[0]['unique_ips'];\r\n        return obj;\r\n      } else {\r\n        var obj = {posts: []};\r\n        var uids = {};\r\n        var nof_uids = 0;\r\n        var posts = document.getElementsByClassName('postContainer');\r\n        for (var i=0;i<posts.length;i++) {\r\n          obj.posts[i] = {};\r\n          obj.posts[i].no = posts[i].id.replace(/pc/,'');\r\n          var id = posts[i].getElementsByClassName('posteruid')[0];\r\n          if (id) {\r\n            id = id.textContent;\r\n            obj.posts[i].id = id;\r\n            if (uids[id]===undefined) {\r\n              nof_uids++;\r\n              uids[id] = 1;\r\n            }\r\n          }\r\n          obj.posts[i].unique_ips = nof_uids;\r\n        }\r\n//        obj.posts[posts.length-1].unique_ips = document.getElementById('unique-ips').textContent; // not refreshed.\r\n        obj.posts[posts.length-1].unique_ips = 0;\r\n        return obj;\r\n      }\r\n    },\r\n    uip_tgt_post : function(no){\r\n      return document.getElementById('pc'+no);\r\n    },\r\n    uip_post_num : function(tgt_post){\r\n      return tgt_post.getElementsByClassName('postNum');\r\n    },\r\n    prep_own_posts_reg: /^4chan\\-track\\-[0-9A-z]+\\-[0-9]+$/,\r\n    prep_own_posts_event : function(e){\r\n      if (e) site2['4chan'].prep_own_posts_1(e.key);\r\n      if (window.name==='4chan') send_message('parent',[['OWN_POSTS', window.name, site3[window.name].own_posts]]);\r\n    },\r\n    prep_own_posts : function(bt){\r\n      site3[this.nickname].own_posts = {};\r\n      if (localStorage) {\r\n        var keys = (bt)? [('4chan-track'+bt).replace(/\\//g,'-')] :\r\n                         Object.keys(localStorage || '{}');\r\n        for (var i=0;i<keys.length;i++) this.prep_own_posts_1(keys[i]);\r\n      }\r\n//console.log(site3[this.nickname].own_posts);\r\n    },\r\n    prep_own_posts_1 : function(key){\r\n      if (this.prep_own_posts_reg.test(key)) {\r\n        var board = '/' + key.replace(/^4chan\\-track\\-/,'').replace(/\\-[0-9]+$/,'') + '/';\r\n        if (!site3[this.nickname].own_posts[board]) site3[this.nickname].own_posts[board] = {};\r\n        var nos = JSON.parse(localStorage[key] || '{}');\r\n        for (var j in nos) site3[this.nickname].own_posts[board][j.substr(2)] = null;\r\n      }\r\n    },\r\n\r\n    catalog_native_prep: function(date,pn_filter,pn_tb,pn_hi){\r\n      var node_ref = (site.whereami==='catalog')? document.getElementById('ctrl') :\r\n                                                  document.getElementById('ctrl-top');\r\n      if (site.whereami==='thread') {\r\n        var node_ref = document.getElementsByClassName('navLinks');\r\n        for (var i=0;i<node_ref.length;i++)\r\n          if (window.getComputedStyle(node_ref[i]).display!=='none') {node_ref = node_ref[i]; break;}\r\n      }\r\n//      pn_tb.setAttribute('style', 'float:right');\r\n      site4.tb_prep_for_embed(pn_tb);\r\n      if (site.whereami==='catalog') {\r\n        var selector_native = document.getElementById('order-ctrl');\r\n        if (selector_native.selectedIndex!=0) {\r\n          selector_native.selectedIndex = 0;\r\n          var evt = document.createEvent('UIEvents');\r\n          evt.initUIEvent('change', false, true, window, 1);\r\n          selector_native.dispatchEvent(evt);\r\n        }\r\n        selector_native.style.display = 'none';\r\n        document.getElementById('size-ctrl').addEventListener('change', site2['4chan'].catalog_native_size_changed, false);\r\n\r\n////        var fl = document.getElementById('filters-ctrl'); // working code.\r\n////        fl.parentNode.setAttribute('style','display:none');\r\n////        var qf2 = this.catalog_native_prep_clonenode(document.getElementById('qf-box'));\r\n//////        var qf = document.getElementById('qf-box');\r\n//////        var qf2= qf.cloneNode();\r\n//////        qf2.name = 'CatChan_qf2';\r\n//////        qf.parentNode.insertBefore(qf2,qf.nextSibling);\r\n//////        qf.setAttribute('style','display:none');\r\n////        var kwd_str = document.getElementsByName('catalog.filter.kwd.str')[0];\r\n////        if (kwd_str.value!=='') {\r\n////          kwd_str.value = '';\r\n////          pref_func.apply_prep(kwd_str,true,true);\r\n////        }\r\n////        qf2.onkeyup = function(){\r\n////          pref.catalog.filter.kwd.str = this.value;\r\n////          pref_func.apply_prep(kwd_str,false);\r\n////          kwd_str.onkeyup();\r\n////        }\r\n////        var qfctrl = this.catalog_native_prep_clonenode(document.getElementById('qf-ctrl'),true);\r\n////        qfctrl.onclick = function(){\r\n////          var qf_cnt = document.getElementById('qf-cnt');\r\n////          if (qf_cnt.style.display==='none') qf_cnt.style.display = 'inline';\r\n////          else {\r\n////            qf_cnt.style.display = 'none';\r\n////            qf2.value = '';\r\n////            qf2.onkeyup();\r\n////          }\r\n////        }\r\n////        var qfc = this.catalog_native_prep_clonenode(document.getElementById('qf-clear'),true);\r\n////        qfc.onclick = function(){\r\n////          qfctrl.onclick();\r\n////        }\r\n        var qf = document.getElementById('qf-box');\r\n        var qf2 = qf.cloneNode(false);\r\n        qf2.name = 'catalog.filter.kwd.str';\r\n        qf2.id = null;\r\n        qf2.oninput = cataLog.event_func;\r\n        qf.parentNode.insertBefore(qf2,qf);\r\n        qf.setAttribute('style','display:none');\r\n        pref3.catalog.filter.kwd.obj = [pn_filter.getElementsByTagName('input')['catalog.filter.kwd.str'], qf2];\r\n        var clear_func = pref3.catalog.filter.kwd.clear.bind(pref3.catalog.filter.kwd);\r\n        document.getElementById('qf-ctrl').addEventListener('click',clear_func,false);\r\n        document.getElementById('qf-clear').addEventListener('click',clear_func,false);\r\n        clear_func();\r\n//        var pn_tb_new = document.createElement('span');\r\n//        while (pn_tb.firstChild) pn_tb_new.appendChild(pn_tb.firstChild);\r\n//        pn_tb = pn_tb_new;\r\n//        pn_tb.appendChild(pn_tb.removeChild(pn_tb.childNodes[3]).firstChild);\r\n      } else if (site.whereami==='page') {\r\n//        var pctrls = document.getElementsByClassName('board')[0]; // test patch\r\n//        for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.removeChild(pctrls.childNodes[i]);\r\n//        pctrls.parentNode.insertBefore(document.createElement('hr'),pctrls.nextSibling);\r\n      }\r\n//      node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n      node_ref.appendChild(pn_tb);\r\n//      node_ref.parentNode.insertBefore(pn_filter,node_ref);\r\n      var selector_catchan = pn_filter.getElementsByTagName('select')['catalog.indexing'];\r\n      if (site.whereami==='catalog') selector_native.parentNode.insertBefore(selector_catchan,selector_native);\r\n      else pn_tb.childNodes[3].insertBefore(selector_catchan,pn_tb.childNodes[3].firstChild);\r\n////////      return site2['4chan'].catalog_from_native(date,document,site.board,site.whereami+'_html');\r\n    },\r\n    catalog_native_prep_clonenode : function(node,deep) {\r\n      var cn = node.cloneNode(deep);\r\n      cn.setAttribute('name',((cn.name)? cn.name : 'clone_node') + '_CatChan');\r\n      node.parentNode.insertBefore(cn,node.nextSibling);\r\n      node.setAttribute('style','display:none');\r\n      return cn;\r\n    },\r\n////////    catalog_from_native : function(date,doc,board,type) { // working code.\r\n////////      return this.wrap_to_parse.get(doc, this.nickname, board, type);\r\n////////    },\r\n//    catalog_from_native : function(date,doc,board,type) { // working code.\r\n//      var parse_obj = {domain:'4chan', board:board, parse_funcs:site2['4chan'].parse_funcs[type], __proto__:site4.parse_funcs_on_demand};\r\n//      var ths = {pn:doc, __proto__:parse_obj};\r\n//      return ths.ths;\r\n//    },\r\n    catalog_get_native_area: function(){\r\n      if (site.whereami==='catalog') return document.getElementById('threads');\r\n      else return document.getElementsByClassName('board')[0];\r\n    },\r\n    catalog_native_size: (document.getElementById('size-ctrl'))? document.getElementById('size-ctrl').value : 'small',\r\n    catalog_native_size_changed: function(){\r\n      site2['4chan'].catalog_native_size = this.value;\r\n      var threads = catalog_obj.catalog_func().get_threads();\r\n      for (var name in threads) if (threads[name][0]) site2['4chan'].catalog_json2html3_size_changed(threads[name][0].getElementsByTagName('img')[0]);\r\n      catalog_obj.catalog_func().show_catalog();\r\n    },\r\n    parse_funcs : { // 4chan\r\n      'catalog_html' : {\r\n        ths: 'thread_html',\r\n//        th_init: function(th) {\r\n//          th.pn.getElementsByTagName('a')[0].addEventListener('click',th.parse_funcs.preventDefault,false);\r\n//        },\r\n//        th_destroy: function(pn, parse_funcs){\r\n//          pn.getElementsByTagName('a')[0].removeEventListener('click',parse_funcs.preventDefault,false);\r\n//        },\r\n//        ths: function(doc) {\r\n//          var ths = this.ths_array(doc,doc.pn.getElementsByClassName('thread'));\r\n//          for (var i=0;i<ths.length;i++)\r\n//            ths[i].pn.getElementsByTagName('a')[0].removeAttribute('href');\r\n//          return ths;\r\n//        },\r\n        no : function(th){return parseInt(th.pn.getAttribute('id').substr(7),10);},\r\n        time_bumped: function(th){return -1;},\r\n        time_created : function(th){return -1;},\r\n        nof_posts: function(th){\r\n          var footer = th.pn.getElementsByClassName('meta')[0];\r\n          var tmp = footer.textContent.match(/[0-9]+/g);\r\n          if (tmp===null) tmp = [0,0];\r\n          else if (tmp.length==1) tmp[1]=0;\r\n          Object.defineProperty(th, 'nof_files', {value:parseInt(tmp[1],10), enumerable:true, writable:true, configurable:true});\r\n          Object.defineProperty(th, 'footer', {value:footer, enumerable:true, writable:true, configurable:true});\r\n          footer.innerHTML = '';\r\n          return parseInt(tmp[0],10);\r\n        },\r\n        nof_files: function(th){\r\n          if (!th.hasOwnProperty('nof_posts')) th['nof_posts'] = this['nof_posts'](th);\r\n          return th.nof_files;\r\n        },\r\n        key: function(th){return th.domain + th.board + th.no;},\r\n        sub: function(th){\r\n          var ts = th.pn.getElementsByClassName('teaser')[0];\r\n          var sub = (ts)? ts.getElementsByTagName('b') : null;\r\n          var com = (!ts)? '' : (sub && sub[0])? ((ts.childNodes[1])? ts.childNodes[1].textContent : '') : ts.childNodes[0].textContent;\r\n          Object.defineProperty(th, 'com', {value:com, enumerable:true, writable:true, configurable:true});\r\n          return (sub && sub[0])? sub[0].textContent : '';\r\n        },\r\n        name: function(th){return '';},\r\n        com: function(th){\r\n          if (!th.hasOwnProperty('sub')) Object.defineProperty(th, 'sub', {value:this['sub'](th), enumerable:true, writable:true, configurable:true});\r\n          return th.com;\r\n        },\r\n        footer: function(th){\r\n//          if (!th.hasOwnProperty('nof_posts')) Object.defineProperty(th, 'nof_posts', {value:this['nof_posts'](th), enumerable:true, writable:true, configurable:true});\r\n//          return th.footer;\r\n          var footer = th.pn.getElementsByClassName('meta')[0]; // must parse pn because of mimic mode.\r\n          footer.innerHTML = '';\r\n          return footer;\r\n        },\r\n        sticky: function(th){return th.pn.getElementsByClassName('stickyIcon')[0]!==undefined;},\r\n//        format: function(th){th.pn.getElementsByTagName('a')[0].removeAttribute('href');return null;},\r\n        tn_as: function(th){return th.pn.getElementsByTagName('a');},\r\n        tn_imgs: function(th){return (th.tn_as[0])? [th.tn_as[0].getElementsByTagName('img')[0]] : [];},\r\n        class_thread: 'thread',\r\n        class_thumbnail: 'thumb',\r\n//        op_img_url: function(th){ // working code.\r\n//          var img = th.pn.getElementsByTagName('img')[0];\r\n//          return (img)? img.getAttribute('src') : undefined; // patch.\r\n//        },\r\n        op_img_url: function(th){return (th.tn_imgs[0])? th.tn_imgs[0].getAttribute('src') : undefined;}, // patch. // BUG IN MIMIC MODE, BECAUSE THIS REQURES TH.PN AND TH.PN WILL BE WRITTEN AFTERWARDS. // moved from DEFAULT.common\r\n        get_op_src: 'thread_json',\r\n//        get_op_src: function(th){ // working code.\r\n//          return (th.op_img_url.indexOf('s.4cdn.org')!=-1)? th.op_img_url : th.op_img_url.replace(/s(\\.\\w+)$/,'$1');}, // TEMPORAL PATCH\r\n        dynamic_image_hover: true,\r\n        missing_info: 1,\r\n        img2src: function(img){\r\n          var lth = this.get_lth_from_node(img);\r\n          if (!lth) return null;\r\n          var src = img.src;\r\n          if (lth.th && lth.th.ext) src = src.replace(/thumb/,'src').replace(/s\\.[^\\.]*$/,lth.th.ext);\r\n          else if (lth.th.parse_funcs.missing_info) scan.scan_ui('image_hover', {tgts: [lth.domain+lth.board], options:{callback:function(){cataLog.image_hover_reentry(img);}, priority:6}}); // NEVER ACTIVATED because catalog.json is read always at initial\r\n          return src;\r\n        },\r\n      },\r\n      'catalog_json' : {\r\n        ths: function(obj, parse_obj) {\r\n          var ths = [];\r\n          for (var i=0;i<obj.length;i++)\r\n            if (obj[i].threads) for (var j=0;j<obj[i].threads.length;j++) {\r\n              var tgt = obj[i].threads[j];\r\n              tgt.__proto__ = parse_obj;\r\n              ths[ths.length] = {\r\n                page: i + '.' + j,\r\n                key: parse_obj.domain + parse_obj.board + tgt.no,\r\n                __proto__: tgt,\r\n              }\r\n            }\r\n          return ths;\r\n        },\r\n//        ths: 'DEFAULT.catalog_json',\r\n        time_posted: function(th){return (th.last_replies)? th.last_replies[th.last_replies.length-1].time*1000 : th.time_created;},\r\n        time_bumped: function(th){return (th.bumplimit)? undefined : th.time_posted;},\r\n        time_created : function(th){return th.time*1000;},\r\n        nof_posts: function(th){return th.replies+1;}, // same as 8chan\r\n        nof_files: function(th){return th.images+1;},\r\n////        key: function(th){return th.domain + th.board + th.no;}, // same as 8chan\r\n////        sub: function(th){return (th.hasOwnProperty('sub'))? th.sub : '';},\r\n////        name: function(th){return (th.hasOwnProperty('name'))? th.name : '';},\r\n////        com: function(th){return (th.hasOwnProperty('com'))? th.com : '';},\r\n        op_img_url: 'DEFAULT.common',\r\n////        op_img_url: function(th) {\r\n////          return site2['4chan'].catalog_json2html3_thumbnail(th, th.board);},\r\n        //        footer: function(th){return th.pn.getElementsByClassName('meta')[0];},\r\n        posts: function(th){\r\n          return (th.last_replies)? [th.__proto__].concat(th.last_replies) : [th.__proto__];\r\n        },\r\n////        posts: function(th){\r\n////          var posts = site2['DEFAULT'].parse_funcs.catalog_json.posts(th);\r\n////          if (th.last_replies) posts = posts.concat(th.last_replies);\r\n////          return posts;\r\n////        },\r\n//////        posts: function(th){return th.last_replies;}, // can't show icon in desktop notification. // BUG, don't hit at search.\r\n//////        posts: function(th){ // work, but parse redundantly\r\n//////          if (th.last_replies) for (var i=0;i<th.last_replies.length;i++)\r\n//////            th.last_replies[i].op_img_url = site2['4chan'].catalog_json2html3_thumbnail(th.last_replies[i], th.board);\r\n//////          return th.last_replies;\r\n//////        },\r\n        has_posts: true,\r\n////        last_replies: function(th){return undefined;}, // stop parsing loop between 'posts' and 'last_replies'\r\n//        add_op_img_url: function(th){  // slow in chrome because of making needless prefetch.\r\n//          for (var i=0;i<th.posts.length;i++)\r\n//            th.posts[i].op_img_url = site2['4chan'].catalog_json2html3_thumbnail(th.posts[i], th.board);\r\n//        },\r\n//        add_op_img_url: function(posts,board){\r\n//          for (var i=0;i<posts.length;i++)\r\n//            posts[i].op_img_url = site2['4chan'].catalog_json2html3_thumbnail(posts[i], board);\r\n//        },\r\n        add_op_img_url: site2['DEFAULT'].parse_parts.add_op_img_url,\r\n        time_unit: 1000,\r\n        get_op_src: 'thread_json',\r\n        type_com: 'html',\r\n        posts_full: null,\r\n////        posts_full: 'DEFAULT.catalog_json',\r\n        missing_info: undefined,\r\n        tn_as: 'catalog_html',\r\n        tn_imgs: 'catalog_html',\r\n        footer: 'catalog_html',\r\n        class_thread: 'catalog_html',\r\n        class_thumbnail: 'catalog_html',\r\n        proto: 'DEFAULT.catalog_json',\r\n      },\r\n      'page_html' : {\r\n        ths: 'thread_html',\r\n        th_init: function(th) {th.pn.removeAttribute('class');},\r\n//        th_destroy: function(pn, parse_funcs){},\r\n        no: 'post_html',\r\n//        ths: function(doc) { // working code.\r\n//          var ths = this.ths_array(doc, doc.pn.getElementsByClassName('thread'));\r\n//          for (var i=0;i<ths.length;i++) {\r\n//            Object.defineProperty(ths[i], 'no', {value:ths[i].pn.id.substr(1), enumerable:true, writable:true, configurable:true});\r\n//            ths[i].pn.removeAttribute('class'); // collection ISN'T writable? and if wrote, its enumerator doesn't work.\r\n//          }\r\n//          return ths;\r\n//        },\r\n//        no : function(th){return parseInt(th.pn.getElementsByClassName('postContainer')[0].id.substring(2),10);},\r\n//        last_replies: 'catalog_json',\r\n        time: 'post_html',\r\n        nof_posts: function(th){\r\n          var nof_posts = th.pn.getElementsByClassName('postContainer').length;\r\n          var nof_files = th.pn.getElementsByClassName('fileText').length;\r\n          var om_info   = th.pn.getElementsByClassName('summary desktop')[0];\r\n          if (om_info) {\r\n            var str = om_info[brwsr.innerText].replace(/\\n/g,'');\r\n            nof_posts += parseInt(str.replace(/\\ post.*/,''),10);\r\n            nof_files += parseInt('0'+str.replace(/\\ image.*/,'').replace(/[^\\ ]*\\ /g,''),10);\r\n          }\r\n          Object.defineProperty(th,'nof_files',{value:nof_files, enumerable:true, configurable:true, writable:true});\r\n          return nof_posts;\r\n        },\r\n        nof_files: function(th){\r\n          if (!th.hasOwnProperty('nof_posts')) this['nof_posts'](th);\r\n          return th.nof_files;\r\n        },\r\n        sub: 'DEFAULT.post_html',\r\n        name: function(post){return post.pn.getElementsByClassName('name')[0][brwsr.innerText];}, // same as 8chan\r\n        com:  function(post){return post.pn.getElementsByClassName('postMessage')[0][brwsr.innerText];},\r\n        footer: function(th){return this.insert_footer4(th.pn.getElementsByClassName('postInfo desktop')[0]);},\r\n        sticky: function(th){return (th.pn.getElementsByClassName('stickyIcon').length!=0);},\r\n        flag: 'post_html',\r\n        op_img_url:function(th){\r\n          var img = th.pn.getElementsByTagName('img')[0];\r\n          var url = (img)? img.getAttribute('src') : undefined;\r\n          return url;\r\n        },\r\n        get_thread_links : function(th){return th.pn.querySelectorAll('.replylink,.'+pref.script_prefix+'_link');}, // PATCH\r\n//        get_thread_links : function(th){return th.pn.getElementsByClassName('replylink');}, \r\n//        get_omitted_info : function(post){return post.pn.getElementsByClassName('summary')[0];},\r\n        get_omitted_info : function(post){\r\n          var omit_info = post.pn.parentNode.nextSibling;\r\n          return (omit_info && omit_info.classList.contains('summary'))? omit_info : undefined;\r\n//          var omit_info = post.pn.parentNode.parentNode; // working, but slow.\r\n//          if (omit_info) omit_info = omit_info.getElementsByClassName('summary')[0];\r\n////          if (omit_info && omit_info.childNodes[1]) omit_info = omit_info.childNodes[1];\r\n//          return omit_info;\r\n        },\r\n        set_omitted_info : function(post, info){post.pn.parentNode.parentNode.insertBefore(info, post.pn.parentNode.nextSibling);},\r\n        replace_omitted_info : function(dst, src){dst.childNodes[1].textContent = src.childNodes[1].textContent;},\r\n        replace_omitted_info2 : function(dst, src, th){\r\n//          if (!src) dst.parentNode.removeChild(dst); // BUG, when I choose ALL in expander, the expander will disappear.\r\n          if (!src) {\r\n            dst.childNodes[0].setAttribute('style','display:none');\r\n            dst.childNodes[1].setAttribute('style','display:none');\r\n          } else {\r\n            if (dst.childNodes[1].style.display==='none') {\r\n              if (th.domain===site.nickname) dst.childNodes[0].removeAttribute('style');\r\n              dst.childNodes[1].removeAttribute('style');\r\n            }\r\n            this.replace_omitted_info(dst,src);\r\n          }\r\n        },\r\n        get_op_src: 'thread_json',\r\n      },\r\n      'page_json'  : {\r\n        ths: 'DEFAULT.page_json',\r\n        get_op_src: 'thread_json',\r\n        proto: 'thread_json'\r\n      },\r\n      'thread_html' : {\r\n        ths: function(doc) {return this.ths_array(doc, doc.pn.getElementsByClassName('thread'));},\r\n//        ths: function(doc) {return site2['DEFAULT'].parse_funcs['thread_html'].ths_array(doc, doc.pn.getElementById('t'+doc.thread));}, // working code.\r\n//        ths: function(doc) { // working code.\r\n//          return [{pn:doc.pn.getElementById('t'+doc.thread),\r\n//                   type_html: 'thread_html',\r\n//                   page: '?',\r\n//                   __proto__: doc.__proto__}];\r\n//        },\r\n\r\n//        pop_post: function(th){ // debuging code.\r\n//          th.post = th.posts[--th.idx_pop];\r\n//          return th.post;\r\n//        },\r\n//        pop_post_prep: function(th){\r\n//          delete th.posts;\r\n//          th.idx_pop = th.posts.length;\r\n//        },\r\n////        pop_post: function(th){ // working code\r\n////          while (th.idx_pop>=0) {\r\n////            var pn = th.children[th.idx_pop--];\r\n////            if (pn.className && pn.className.indexOf('postContainer')!=-1) {\r\n////              th.post = {pn:pn, parse_funcs:this, __proto__:th.__proto__};\r\n////              return true;\r\n////            }\r\n////          }\r\n////          return false;\r\n////        },\r\n//////        post_no: function(post){return parseInt(post.pn.id.substr(3),10);},\r\n////        post_no: function(post){return parseInt(post.pn.id.substr(2),10);}, // 2015.05.12, maybe depends on baord???\r\n        get_op_src: 'thread_json',\r\n        proto: 'page_html',\r\n      },\r\n      'thread_json'  : {\r\n////        op_img_url: function(th){\r\n////          return site2[th.domain].catalog_json2html3_thumbnail(th.posts[0],th.board);},\r\n        tn_as: 'catalog_html.tn_as',\r\n        sticky: function(th){return th.posts[0].sticky;},\r\n        time_bumped : function(obj){return (obj.posts[0].bumplimit)? undefined : obj.posts[obj.posts.length-1].time*1000;}, // 4chan doesn't have email field.\r\n//                   obj.posts[site3[this.domain].boards[this.board].bump_limit-2].time*1000 :   // for safety, 2.\r\n//        get_op_src: function(th){return th.op_img_url.replace(/s\\..*/,th.ext);},\r\n        get_op_src: function(th, img){\r\n          if (th.op_img_url.indexOf('s.4cdn.org')!=-1) return th.op_img_url;\r\n          if (!th.ext && th.parse_funcs.missing_info) scan.scan_ui('image_hover', {tgts: [th.domain+th.board+'j0'], options:{callback:function(){cataLog.image_hover_reentry(img);}, priority:6}}); // NEVER ACTIVATED because catalog.json is read always at initial\r\n          return (th.ext)? th.op_img_url.replace(/s(\\.\\w+)$/, th.ext) : img.src;\r\n        },\r\n        proto: 'DEFAULT.thread_json'\r\n      },\r\n      'post_html': {\r\n        no : function(th){return parseInt(th.pn.id.substr(1),10) || parseInt(th.pn.id.substr(2),10)},\r\n        time: function(post){\r\n          return parseInt(post.pn.getElementsByClassName('dateTime')[0].getAttribute('data-utc'),10) * 1000;\r\n        },\r\n        flag: function(post){  // same as 8chan\r\n          var flags = post.pn.getElementsByClassName('flag');\r\n          return (flags.length!=0)? document.importNode(flags[0],false) : null;\r\n        },\r\n//        txt2com: function(txt){\r\n//          txt = txt.replace(/(^>[^>].*$)/mg,'<span class=\"quote\">$1</span>');\r\n//          txt = txt.replace(/\\*\\*([^(\\*\\*)]*)((\\*\\*)|$)/g,'<s>$1</s>');\r\n//          return txt.replace(/\\n/g,'<br>');},\r\n        txt2com_anchor_class: 'quotelink',\r\n        txt2com_spoiler_replace_txt: '<s>$1</s>',\r\n        proto: 'DEFAULT.post_html',\r\n      },\r\n      'post_json': {\r\n        proto: 'DEFAULT.post_json',\r\n      },\r\n    },\r\n////    toplevel_anchor: function(th){\r\n////      var as = th.pn.getElementsByTagName('a');\r\n////      for (var i=0;i<as.length;i++) {\r\n////        var href = as[i].getAttribute('href');\r\n////        if (href && href[0]==='#') as[i].setAttribute('href',th.board + 'thread/' + th.no + href);\r\n////      }\r\n////    },\r\n    popups_href2dbtp: function(href, src, th){\r\n      if (href[0]==='#' && th) {\r\n        href = this.link_dbtp2href([th.domain, th.board, th.no, href.substr(1)]);\r\n        src.setAttribute('href',href);\r\n      }\r\n      var hrefs = href.split(/[\\/#]/);\r\n      var p = hrefs[hrefs.length-1].substr(1);\r\n      var t = hrefs[hrefs.length-2];\r\n      var b = (hrefs.length>=4)? '/'+hrefs[hrefs.length-4]+'/' : site.board;\r\n      return ['4chan',b,t,p]\r\n    },\r\n\r\n    update_posts_remove: function(th_old,i,pnode){\r\nif (pref.debug_mode['13'] && th_old.posts[i].pn.parentNode.parentNode!==pnode) console.log(th_old.posts[i].pn);\r\n      pnode.removeChild(th_old.posts[i].pn.parentNode);\r\n    },\r\n////    update_posts_remove_lock: function(th_old,i,pnode, now_height){ // TEST, slow implementation\r\n////      var ref, ref_pos;\r\n////      var tgt = th_old.posts[i].pn.parentNode;\r\n////      if (now_height && tgt.offsetTop<now_height) ref = tgt.nextSibling || tgt.parentNode.nextSibling;\r\n////      if (ref) ref_pos = ref.offsetTop;\r\n////      pnode.removeChild(th_old.posts[i].pn.parentNode);\r\n////      return (ref)? ref.offsetTop - ref_pos : 0;\r\n////    },\r\n    update_posts_insert: function(src,dst,i,j,pnode){\r\n      var ref;\r\n      if (j<dst.length) {\r\n        ref = dst[j].pn.parentNode;\r\n        if (ref.tagName==='SPAN') ref = ref.nextSibling; // skip summary, don't see j===1 for merge.\r\n      } else ref = null;\r\n      if (!src[i].pn) src[i].pn = this.post_json2html(src[i], src[i].board);\r\n      var tgt = src[i].pn.parentNode || this.post_container(src[i].pn,src[i].no);\r\n      pnode.insertBefore(tgt, ref);\r\n    },\r\n////    update_posts_insert: function(th,th_old,i,j,pnode){ // working code.\r\n//////      var ref = (j==1)? (th_old.posts[0].pn.parentNode.nextSibling || th_old.posts[0].pn.parentNode) : \r\n//////                         th_old.posts[th_old.posts.length-1].pn.parentNode;\r\n////      var ref;\r\n////      if (j<th_old.posts.length) {\r\n////        ref = th_old.posts[j].pn.parentNode;\r\n////        if (ref.tagName==='SPAN') ref = ref.nextSibling; // skip summary, don't see j===1 for merge.\r\n////      } else ref = null;\r\n////      if (!th.posts[i].pn) th.posts[i].pn = this.post_json2html(th.posts[i],th.board);\r\n////      pnode.insertBefore(this.post_container(th.posts[i].pn,th.posts[i].no), ref);\r\n////    },\r\n////    update_posts_insert_lock: function(th,th_old,i,j,pnode, now_height){ // TOO SLOW\r\n////      var ref, ref_pos;\r\n////      if (j<th_old.posts.length) {\r\n////        ref = th_old.posts[j].pn.parentNode;\r\n////        if (ref.tagName==='SPAN') ref = ref.nextSibling; // skip summary, don't see j===1 for merge.\r\n////      } else ref = null;\r\n////      if (now_height && ref) ref_pos = ref.offsetTop;\r\n////      if (!th.posts[i].pn) th.posts[i].pn = this.post_json2html(th.posts[i],th.board);\r\n////      pnode.insertBefore(this.post_container(th.posts[i].pn,th.posts[i].no), ref);\r\n////      return (ref_pos<now_height)? ref.offsetTop - ref_pos : null;\r\n////    },\r\n    post_container : function(post_pn,no, op) {\r\n      var pn = document.createElement('div');\r\n      pn.setAttribute('id','pc'+no);\r\n      pn.setAttribute('class','postContainer ' + ((op)? 'op' : 'reply') + 'Container');\r\n      if (op) {\r\n//<div class=\"postLink mobile\"><span class=\"info\">97 Replies / 26 Images</span><a href=\"thread/138122016\" class=\"button\">View Thread</a></div>\r\n      } else {\r\n        pn.innerHTML = '<div class=\"sideArrows\" id=\"sa'+no+'\">&gt;&gt;</div>';\r\n      }\r\n      pn.appendChild(post_pn);\r\n      return pn;\r\n    },\r\n    add_backlinks: function(pn,backlinks,target){\r\nif (pref.test_mode['35']) return;\r\n      var bks = pn.getElementsByClassName(this.backlink_parent_class)[0];\r\n      if (!bks) {\r\n        var bks = document.createElement('div'); // why div???\r\n        bks.setAttribute('class',this.backlink_parent_class);\r\n        var ref = this.backlink_parent_prevSib(pn);\r\n        ref.parentNode.insertBefore(bks,ref.nextSibling);\r\n      }\r\n      if (!target) bks.innerHTML = '';\r\n      for (var i=(target || 0);i<backlinks.length;i++) {\r\n        var dbtp = backlinks[i].split(/[\\/#]/);\r\n        dbtp[1] = '/' + dbtp[1] + '/';\r\n        var domain = dbtp[0];\r\n        var board = dbtp[1];\r\n        var post_no = dbtp[3];\r\n        var href = site2[domain].link_dbtp2href(dbtp);\r\n////        var href = backlinks[i].split('/');\r\n////        var post_no = href[href.length-1].substr(href[href.length-1].indexOf('#')+1);\r\n////        href[href.length-1] = 'thread/'+href[href.length-1];\r\n////        var domain = href[0];\r\n////        href[0] = '';\r\n////        href = href.join('/');\r\n        var href = site2[domain].link_dbtp2href(dbtp);\r\n        if (domain!==site.nickname) href = site2[domain].absolute_link_1(href);\r\n\r\n        var blk = null;\r\n////        if (target!==undefined) // may be working in page???\r\n////          for (var j=0;j<bks.childNodes.length;j++)\r\n////            if (bks.childNodes[j].textContent==='>>'+post_no) {\r\n////              blk = bks.childNodes[j];\r\n////              break;\r\n////            }\r\n        if (target!==undefined) {\r\n          var as = bks.getElementsByTagName('a');\r\n          for (var j=0;j<as.length;j++)\r\n            if (as[j].textContent==='>>'+post_no) {\r\n              blk = as[j];\r\n              break;\r\n            }\r\n        }\r\n        if (!blk) {\r\n          blk = document.createElement('a');\r\n          blk.setAttribute('class',this.backlink_class);\r\n          blk.setAttribute('href',href);\r\n          blk.textContent = '>>'+post_no;\r\n          blk.onclick = this.backlink_onclick;\r\n          blk.onmouseover = this.popups_post_entry;\r\n          var blk2 = document.createElement('span');\r\n          blk2.appendChild(blk);\r\n          blk2.appendChild(document.createTextNode(' '));\r\n          bks.appendChild(blk2);\r\n        }\r\n        if (target) break;\r\n      }\r\n    },\r\n    link_dbtp2href: function(dbtp){\r\n      return dbtp[1] + 'thread/' + dbtp[2] + ((dbtp[4]==='href')? '#' : '#p') + dbtp[3];\r\n    },\r\n    backlink_onclick: function(){\r\n      highlightReply.call(this,parseInt(this.textContent.substr(2),10));\r\n    },\r\n    backlink_class: 'quotelink',\r\n    backlink_parent_class: 'backlink',\r\n    backlink_parent_prevSib: function(pn){return pn.getElementsByClassName('postNum')[1];},\r\n\r\n//    post_json2html : site2['vichan'].post_json2html,\r\n    //    post_json2html_file : site2['vichan'].post_json2html_file,\r\n    post_com2txt: function(com){\r\n      return com.replace(/<[^>]*>/g,' ').replace(/&gt;/g,'>').replace(/&lt;/g,'<').replace(/&quot;/g,'\"').replace(/&#039;/g,\"'\").replace(/&#0*44;/g,',').replace(/&amp;/g,'&'); // most of 4chan. speed: 13.07/2.38 inlainchan.\r\n    },\r\n    post_json2html : function(post, board, op, short_link, op_no) {\r\n      var pn = document.createElement('div');\r\n      var time_unit = (post.parse_funcs && post.parse_funcs.time_unit) || 1;\r\n      var date = new Date((post.time || 0) * time_unit);\r\n      var name = post.name || 'Anonymous';\r\n      if (post.ext) {\r\n        var fsize_str = (((post.fsize>1048576)? post.fsize/1048576 : post.fsize/1024)+0.005).toString();\r\n        fsize_str = fsize_str.substr(0,fsize_str.indexOf('.')+3) + ((post.fsize>1048576)? ' MB' : ' KB');\r\n//        var fname_server = site2[post.domain].post_json2html_fname_server(post);\r\n//        var fname = site2[post.domain].post_json2html_fname(post);\r\n        var furl = site2[post.domain].catalog_json2html3_src(post,board);\r\n        var turl = site2[post.domain].catalog_json2html3_thumbnail(post,board);\r\n        var tn_f = (op)? 1 : ((post.tn_w>post.tn_h)? post.tn_w : post.tn_h) / 150;\r\n        var file_html = \r\n          '<div class=\"file\" id=\"f' + post.no + '\">'+\r\n            '<div class=\"fileText\" id=\"fT' + post.no + '\">File: <a href=\"' + furl + '\" target=\"_blank\">' + post.filename + '</a>'+\r\n              ' (' + fsize_str + ', ' + post.w + 'x' + post.h + ')</div>'+\r\n            '<a class=\"fileThumb\" href=\"' +furl + '\" target=\"_blank\">'+\r\n              '<img src=\"' + turl + '\" alt=\"' + fsize_str + '\" data-md5=\"' + post.md5 + '\" style=\"height: ' + ((op)? post.tn_h : post.tn_h / tn_f) + 'px; width:' + ((op)? post.th_w : post.tn_w/tn_f) +'px;\">'+\r\n              '<div data-tip=\"\" data-tip-cb=\"mShowFull\" class=\"mFileInfo mobile\">' + fsize_str + ' ' + post.ext.substr(1).toUpperCase() + '</div>'+\r\n            '</a>'+\r\n          '</div>';\r\n      }\r\n      pn.innerHTML =\r\n        '<div id=\"p' + post.no + '\" class=\"post reply\">'+\r\n          '<div class=\"postInfoM mobile\" id=\"pim' + post.no + '\">'+\r\n            '<span class=\"nameBlock\">'+\r\n              '<span class=\"name\">' + name + '</span>'+\r\n            '<br></span>'+\r\n            '<span class=\"dateTime postNum\" data-utc=\"' + post.time + '\">' + site2['common'].change_utc_to_local(date) + '</span>'+\r\n          '</div>'+\r\n          ((post.ext && op)? file_html : '') +\r\n          '<div class=\"postInfo desktop\" id=\"pi' + post.no + '\">'+\r\n            '<input type=\"checkbox\" name=\"' + post.no +'\" value=\"delete\"> '+ // a blank is here\r\n            ((post.sub)? '<span class=\"subject\">' + post.sub + '</span> ' : '')+\r\n            '<span class=\"nameBlock\">'+\r\n              '<span class=\"name\">' + name + '</span> </span> '+\r\n              ((post.trip)? '<span class=\"postertrip\">' + post.trip + '</span> ' : '') +\r\n            '<span class=\"dateTime\" data-utc=\"' + post.time + '\">' + site2['common'].change_utc_to_local(date) + '</span> '+\r\n            '<span class=\"postNum desktop\">'+\r\n              '<a href=\"thread/' + op_no + '#p' + post.no + '\" title=\"Link to this post\">No.</a>'+\r\n              '<a href=\"thread/' + op_no + '#q' + post.no + '\" title=\"Reply to this post\">' + post.no + '</a>'+\r\n            '</span>'+\r\n            ' &nbsp; '+\r\n//            ((op)? '<span>[<a href=\"thread/' + op_no + ((post.sub)? '/' + post.sub.replace(/\\s/g,'-').toLowerCase() +' ': '') + '\" class=\"replylink\">Reply</a>]</span>' : '') +\r\n            ((op)? ('<span>[<a href=\"' + site2[post.domain].make_url4([post.domain, board, post.no, 'thread_html'])[0] +'\" class=\"replylink\">Reply</a>]</span>'+\r\n                   ((short_link)? short_link.replace(/>\\[/g,'>').replace(/<a/g,'<span>[<a').replace(/\\]<\\/a/g,'</a>]</span') : '')) : '') +\r\n          '</div>' +\r\n          ((post.ext && !op)? file_html : '') +\r\n          '<blockquote class=\"postMessage\" id=\"m' + post.no + '\">'+ (post.com || '') + '</blockquote>'+ \r\n        '</div>';\r\n      return pn.removeChild(pn.childNodes[0]);\r\n    },\r\n    page_json2html3 : function(obj,board,thumb_url, assign_pn) { // TEMPORAL, USE thumb_url TO MIMIC.\r\n      var th = document.createElement('div');\r\n      th.setAttribute('id','t'+obj.no);\r\n      var op = this.post_json2html((obj.posts && obj.posts[0])? obj.posts[0] : obj, board, true, site2[obj.domain].short_link(obj.key, obj.nof_posts, 2, '[Last ',' Posts]'), obj.posts[0].no);\r\n//      var files = op.getElementsByClassName('file')[0];\r\n//      if (file) th.insertBefore(file, op.getElementsByclassName('desktop')[0]);\r\n      op.setAttribute('class','post op');\r\n//      if (obj.posts && obj.posts[0] && obj.posts[0].extra_files) op.setAttribute('style','clear:both;');\r\n      th.appendChild(this.post_container(op,obj.posts[0].no,true));\r\n//      if (assign_pn) obj.posts[0].pn = th;\r\n//      if (assign_pn || !obj.posts[0].pn) Object.defineProperty(obj.posts[0], 'pn', {value:op, enumerable:true, configurable:true, writable:true});\r\n      if (assign_pn || !obj.posts[0].pn) obj.posts[0].pn = op;\r\n      if (obj.posts) {\r\n        for (var i=1;i<obj.posts.length;i++) {\r\n//          th.appendChild(this.post_json2html(obj.posts[i], board));\r\n          var pn = this.post_json2html(obj.posts[i], board);\r\n          th.appendChild(this.post_container(pn,obj.posts[i].no));\r\n//          th.appendChild(document.createElement('br'));\r\n//          if (assign_pn || obj.posts[i].pn) Object.defineProperty(obj.posts[i], 'pn', {value:pn, enumerable:true, configurable:true, writable:true}); // temporal, overwrite getter.\r\n          if (assign_pn || !obj.posts[i].pn) obj.posts[i].pn = pn;\r\n        }\r\n        this.page_json2html3_add_omitted_info(obj,obj.posts,obj.posts);\r\n      }\r\n//      var br = document.createElement('br');\r\n//      br.setAttribute('class','clear');\r\n//      th.appendChild(br);\r\n//      th.appendChild(document.createElement('hr'));\r\n      return th;\r\n    },\r\n    page_json2html3_replace_expander : function(posts_old, idx) {\r\n      var omit_info = posts_old[0].pn.parentNode.parentNode.getElementsByClassName('summary')[0];\r\n      if (omit_info) this.page_json2html3_add_expander(omit_info, idx);\r\n    },\r\n    page_json2html3_add_expander: function(omit_info, idx) {\r\n      var expander = document.createElement('select');\r\n      cnst.config_expander(expander, idx);\r\n      omit_info.appendChild(expander);\r\n    },\r\n    page_json2html3_add_omitted_info : function(th,posts_old,posts) {\r\n      var nof_files = 0;\r\n      for (var i=1;i<posts.length;i++) nof_files += (posts[i].type_data==='html')? posts[i].pn.getElementsByClassName('file').length :\r\n                                                    (posts[i].filename)? 1 : 0;\r\n      var nof_files_omitted = th.nof_files - nof_files;\r\n      var nof_posts_omitted = th.nof_posts - posts.length;\r\n\r\n      var omit_info = (posts_old)? this.parse_funcs['page_html'].get_omitted_info(posts_old[0]) : null;\r\n      if (nof_posts_omitted!=0) {\r\n        if (!omit_info) {\r\n          omit_info = document.createElement('span');\r\n          omit_info.setAttribute('class','summary');\r\n          omit_info.innerHTML = '<img class=\"extButton expbtn\" title=\"Expand thread\" alt=\"+\" data-cmd=\"expand\" data-id=\"' + posts[0].no + '\" ' + \r\n            'src=\"//s.4cdn.org/image/buttons/burichan/post_expand_plus.png\">' +\r\n            '<span class=\"summary\"></span><span style=\"display: none;\">Showing all replies.</span>';\r\n          if (th.domain!=='4chan' || pref[cataLog.embed_mode].use_expander_always) this.page_json2html3_add_expander(omit_info);\r\n          if (posts_old) this.parse_funcs['page_html'].set_omitted_info(posts_old[0],omit_info);\r\n        }\r\n        omit_info.childNodes[1].textContent = nof_posts_omitted + ((nof_posts_omitted==1)? ' reply' : ' replies') +\r\n                                ((nof_files_omitted)? ' and ' + nof_files_omitted + ' image' + ((nof_posts_omitted!==1)? 's' : '') : '') + ' omitted.';\r\n        if (th.domain!==site.nickname) omit_info.childNodes[0].style.display = 'none';\r\n      } else if (omit_info && posts_old) posts_old[0].pn.removeChild(omit_info);\r\n      return omit_info;\r\n    },\r\n    catalog_json2html3_thumbnail: function(obj, board) {\r\n      return (obj.ext)? this.protocol+'//i.4cdn.org' + board + obj.tim + 's'  // not 'obj.board' but 'board' is for thread_json.\r\n                          + ((obj.ext==='.jpg' || obj.ext==='.png' || obj.ext==='.gif' || obj.ext==='.webm')? '.jpg' : obj.ext)\r\n                      : '';\r\n    },\r\n    catalog_json2html3_src: function(obj, board) {\r\n      return (obj.ext)? this.protocol+'//i.4cdn.org' + board + obj.tim + obj.ext : // not 'obj.board' but 'board' is for thread_json.\r\n                        '';\r\n    },\r\n//    catalog_json2html3_src: function(obj, board) { // working code.\r\n//      return (obj.ext)? this.protocol+'//i.4cdn.org' + board + obj.tim  // not 'obj.board' but 'board' is for thread_json.\r\n//                          + ((obj.ext==='.jpg' || obj.ext==='.webm')? '.jpg' : obj.ext)\r\n//                      : '';\r\n//    },\r\n    catalog_json2html3 : function(obj,board,thumb_url) {\r\n      var th = document.createElement('div');\r\n      th.setAttribute('class','thread');\r\n      th.setAttribute('id','thread-'+obj.no);\r\n      th.innerHTML = '<a href=\"' + this.protocol + '//boards.4chan.org' + obj.board + 'thread/' + obj.no + ((obj.sub)? '/'+obj.sub.replace(/ /,'-') : '') + '\">' + // (cause direct jump) fixed.\r\n//      th.innerHTML = '<a>' +\r\n                       '<img alt=\"\" id=\"thumb-' + obj.no + '\" class=\"thumb\"' + // cause popup error\r\n//                       '<img alt=\"\" id=\"thumb-' + obj.no + // don't load image.\r\n                         ((obj.tn_w)? 'width=\"' + ((this.catalog_native_size==='small')? obj.tn_w*3/5 : obj.tn_w) + '\"' : '' ) +\r\n                         ((obj.tn_h)? 'height=\"' + ((this.catalog_native_size==='small')? obj.tn_h*3/5 : obj.tn_h) + '\"' : '' ) +\r\n                         'src=' + thumb_url + ' data-id=\"' + obj.no + '\">' +\r\n                     '</a>' +\r\n                     '<div title=\"(R)eplies / (I)mages\" id=\"meta-' + obj.no + '\" class=\"meta\">' +\r\n                       'R: <b>' + obj.nof_posts + '</b> / I: <b>' + obj.nof_files + '</b></div>' +\r\n                     '<div class=\"teaser\">' + ((obj.sub)?'<b>'+obj.sub+'</b>':'') + ((obj.com)? ((obj.sub)? ': ' : '' ) + obj.com : '') + '</div>';\r\n//      if (!obj.tn_w || !obj.tn_h) {\r\n        th.childNodes[0].childNodes[0].addEventListener('load',site2['4chan'].catalog_json2html3_onload,false);\r\n//      }\r\n      return th;\r\n    },\r\n    catalog_json2html3_onload : function() {\r\n      this.removeEventListener('load',site2['4chan'].catalog_json2html3_onload,false);\r\n      if (!this.tn_w || !this.tn_h) site2['4chan'].catalog_json2html3_size_changed(this);\r\n      this.removeAttribute('class'); // remove popup.\r\n    },\r\n    catalog_json2html3_size_changed : function(myself) {\r\n      var w = myself.naturalWidth;\r\n      var h = myself.naturalHeight;\r\n      var f = ((w>h)? w : h) / ((site2['4chan'].catalog_native_size==='small')? 150 : 250);\r\n      myself.setAttribute('width', w/f);\r\n      myself.setAttribute('height', h/f);\r\n    },\r\n    favicon : {\r\n      __proto__: site2['vichan'].favicon,\r\n      none: '/favicon.ico',\r\n      reply: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAoUlEQVQ4T61TwRGAMAiTmexMDuVMOlM1XOEoAj60L20gDUlLy8dF6Kd+dM/TqTEmK6shAe4GW8zfQlLVMAGat2NVgr2dUDWJymomBRlJdUCoAEdbFZ7A4qEHw9jHCM5U/k1TiEyMkiqj8ikIgY1YCXxUUQp2NCW3F8malZno9kk9qKLKMKj4nwAScaGiETw2KRix8RWG5MhEjynB24usXusFrlPCCCmAi/UAAAAASUVORK5CYII=',\r\n      reply_to_me: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAvUlEQVQ4T61TXRrDIAiDXWmeabvTzlSvVGb8hFIK3ct8aeUnJkSZxmLZBF+/hBvHWLafRQDY6Wn5B3WKANUhrIkIADQF0Zqxt0NGbP5PACREDhXMDFZREr22g+Wn9VmTMnj3RlqwmKTNJYNfAGi8MPD61mAvEnzAZlDZmA0xs7q08Q7AW5wCVC54aWaxl4A5qFWVCyE+DF830Tf7Kd/ZCBb/BwBFyMgkxNyJgVKFv5CTXeWYM4DqLsTHlD33Lx2GzAg15eTiAAAAAElFTkSuQmCC'\r\n    },\r\n  };\r\n\r\n  site2['meguca1'] = { // meguca.org v1\r\n    nickname : 'meguca',\r\n    protocol: 'https:',\r\n    home : 'https://meguca.org/favicon.ico',\r\n    domain_url: 'meguca.org',\r\n    features : {page: false, graph: false, setting2: false, thread_reader:false},\r\n//    features : {page: false, graph: false, setting2: false, thread_reader:false, catalog:false, setting: false}, // temporal\r\n    components: {\r\n      boardlist: '#navTop'\r\n    },\r\n    pref_default: {\r\n//      patch: {delayed_invoke: {use: true, sec:10}},\r\n      catalog:{image_hover:true},\r\n    },\r\n    boards_json:{boards:[{board:'a'}, {board:'an'}, {board:'cr'}, {board:'g'}, {board:'v'}]},\r\n    check_func : function(){\r\n      var href = window.location.href;\r\n      if (href.indexOf('/meguca.org/')!=-1) {\r\n        site.whereami = (href.indexOf('/catalog')!=-1)? 'catalog'\r\n                      : (href.search(/page[0-9]/)!=-1)? 'page'\r\n                      : (href.search(/[0-9]+$/)!=-1)? 'thread'\r\n//                      : (document.getElementsByTagName('title')[0] && document.getElementsByTagName('title')[0].textContent==='404')? '404' \r\n                      : 'other';\r\n        site.config('meguca.org',this.nickname);\r\n        site.max_page = 3;\r\n        site.header_height = function(){\r\n          var header = document.getElementById('banner');\r\n          if (header) return header.offsetHeight;\r\n          else return 0;\r\n        }\r\n////        site.myself = (site.whereami==='thread')? parseInt(href.replace(/.*res\\//,'').replace(/\\.html/,''),10) : 0;\r\n////        if (site.whereami==='thread' || site.whereami==='page') {\r\n////          site.embed_to['top']    = document.getElementsByName('postcontrols')[0];\r\n////          site.embed_to['bottom'] = document.getElementsByTagName('footer')[0];\r\n////        } else if (site.whereami==='catalog') {\r\n////          site.embed_to['top']    = document.getElementsByTagName('header')[0].nextSibling;\r\n////          site.embed_to['bottom'] = document.getElementsByTagName('footer')[0];\r\n////        }\r\n////        if (site.whereami==='thread' || site.whereami==='page') {\r\n//////          site.postform = document.getElementsByTagName('form')['post'].getElementsByTagName('tbody')[0];\r\n////          site.postform = document.getElementsByTagName('form')['post'];\r\n////          site.postform_comment = document.getElementById('body');\r\n////          this.postform_prep();\r\n////\r\n//////          var bar_bottom = document.getElementsByClassName('bottom')[0];\r\n//////////          site.root_body2 = bar_bottom.insertBefore(document.createElement('span'),bar_bottom.childNodes[1]); // working code.\r\n////////          site.root_body2 = document.getElementsByClassName('pages')[0];\r\n////////          site.root_body2.setAttribute('style','width:auto');\r\n//////////          site.root_body2 = document.getElementById('style-select');\r\n////        }\r\n////        pref.thread_reader.own_posts_tracker = true;\r\n////        setTimeout(function(){this.postprocess_board(this.boards_json)}.bind(this),0);\r\n        return true;\r\n      } else {\r\n        this.prep_own_posts(); // make own_posts structure WITH PROTOTYPE.\r\n        return false;\r\n      }\r\n    },\r\n    make_url4 : function(dbt){\r\n      var url_prefix  = this.protocol + '//' + this.domain_url; // force to use https:\r\n      if (dbt[3]==='page_json' && dbt[2]==0) dbt[3] = 'catalog_json'; // dbt[2] is string, === can't be used.\r\n      if      (dbt[3]==='page_html')    return [url_prefix + ((dbt[2]!=0)? (parseInt(dbt[2],10)+1) :''), 'html'];\r\n      else if (dbt[3]==='catalog_json') return [url_prefix + '/api/board'+ dbt[1].substr(0,dbt[1].length-1), 'json'];\r\n      else if (dbt[3]==='thread_html')  return [url_prefix + dbt[1] + dbt[2], 'html'];\r\n      else if (dbt[3]==='thread_json')  return [url_prefix + '/api/thread/' + dbt[2], 'json'];\r\n    },\r\n////    prep_own_posts_reg: /^4chan\\-track\\-[0-9A-z]+\\-[0-9]+$/,\r\n\r\n\r\n\r\n    catalog_get_native_area: function(){\r\n      return (site.whereami==='catalog')? document.getElementById('catalog') :\r\n                                          document.getElementsByName('postcontrols')[0];\r\n    },\r\n    catalog_native_prep: function(date,pn_filter,pn_tb,pn_hi){\r\n//      var node_ref = document.getElementsByClassName('catalog_search')[0].nextSibling;  // FF doesn't work.\r\n      var node_ref = (site.whereami==='catalog')? document.getElementsByTagName('threads')[0].getElementsByTagName('aside')[0] :\r\n                                                  document.getElementsByName('postcontrols')[0];\r\n      site4.tb_prep_for_embed(pn_tb);\r\n      if (site.whereami==='catalog') {\r\n////        var selector_native = document.getElementById('sort_by');\r\n////        if (selector_native.selectedIndex!=0) {\r\n////          selector_native.selectedIndex = 0;\r\n////          var evt = document.createEvent('UIEvents');\r\n////          evt.initUIEvent('change', false, true, window, 1);\r\n////          selector_native.dispatchEvent(evt);\r\n////        }\r\n////        selector_native.style.display = 'none';\r\n////        document.getElementById('image_size').addEventListener('change', site2['lain'].catalog_native_size_changed, false);\r\n        var pn_tb_new = document.createElement('span');\r\n        while (pn_tb.firstChild) pn_tb_new.appendChild(pn_tb.firstChild);\r\n        pn_tb = pn_tb_new;\r\n        pn_tb.appendChild(pn_tb.removeChild(pn_tb.childNodes[3]).firstChild);\r\n        pn_tb.setAttribute('style','float:right');\r\n      } else if (site.whereami==='page') {\r\n        var pctrls = document.getElementsByName('postcontrols')[0];\r\n//        for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.removeChild(pctrls.childNodes[i]);\r\n        pctrls.parentNode.insertBefore(document.createElement('hr'),pctrls.nextSibling);\r\n      }\r\n//      node_ref.parentNode.insertBefore(pn_hi,node_ref);\r\n      if (site.whereami==='catalog') node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n      else node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n      node_ref.parentNode.insertBefore(pn_filter,document.getElementById('catalog'));\r\n      var selector_catchan = pn_filter.getElementsByTagName('select')['catalog.indexing'];\r\n      selector_catchan.setAttribute('style','float:left');\r\n      if (site.whereami==='catalog') node_ref.parentNode.insertBefore(selector_catchan,node_ref);\r\n      else pn_tb.childNodes[3].insertBefore(selector_catchan,pn_tb.childNodes[3].firstChild);\r\n//      pn_tb.childNodes[0].setAttribute('style',pn_tb.childNodes[0].getAttribute('style')+';display:none');\r\n//      pn_tb.childNodes[1].setAttribute('style',pn_tb.childNodes[1].getAttribute('style')+';display:none');\r\n\r\n      node_ref.setAttribute('style','float:left');\r\n      node_ref.parentNode.insertBefore(pn_tb.childNodes[3],node_ref.nextSibling);\r\n//      if (site.whereami==='catalog') document.getElementById('catalog').innerHTML = ''; // clear all thread.\r\n    },\r\n    catalog_json2html3 : function(obj,board,thumb_url) {\r\n      var th = document.createElement('article');\r\n      var th_url = site2[obj.domain].make_url4([obj.domain,obj.board,obj.no,'thread_html'])[0];\r\n      var tn_w = obj.tn_w || obj.posts[0].tn_w;\r\n      var tn_h = obj.tn_h || obj.posts[0].tn_h;\r\n      var tn_f = 150 / ((tn_w>tn_h)? tn_w : tn_h);\r\n      var th_class_tn = (pref.pref2.meguca.remove_history_class)? '' : 'history';\r\n      var th_class    = th_class_tn + ' ' + pref.script_prefix +'_link';\r\n      var short_link = site2[obj.domain].short_link(obj.key, obj.nof_posts, 1, 'Last ', '');\r\n      th.innerHTML = '<a target=\"_blank\" rel=\"nofollow\" href=\"' + th_url + '\"' + ((th_class_tn)?' class=\"' + th_class_tn + '\"' : '') +'>'+\r\n                        '<img src=\"' + thumb_url + '\" width=\"' + (tn_w * tn_f) + '\" height=\"' + (tn_h * tn_f) + '\" class=\"expanded\">'+\r\n                     '</a>'+\r\n                     '<br>'+\r\n                     '<small>'+\r\n                       '<span title=\"Replies/Images\">'+ (obj.nof_posts-1) + '/' + (obj.nof_files-1) + '</span>'+\r\n                       '<span class=\"act expansionLinks\">'+\r\n                         '<a href=\"' + th_url + '\" class=\"' + th_class + '\">Expand</a>'+\r\n//                         '] [<a href=\"' + th_url + '?last=100\" class=\"' + th_class + '\">Last 100</a>'+\r\n                         ((short_link)? '] [' + short_link : '')+\r\n                       '</span>'+\r\n                     '</small>'+\r\n                     '<br>'+\r\n                     ((obj.sub)? '<h3>' + obj.sub + ' </h3>' : '')+\r\n                     ((obj.com)? obj.com : '');\r\n      return th;\r\n    },\r\n    mark_newer_posts: function(th,date,unmark) {\r\n      return site2['DEFAULT'].mark_newer_posts('meguca',th.getElementsByTagName('article'),date,'border:2px solid red','border: none',null,null,unmark);\r\n    },\r\n    get_time_of_post_in_utc: function(post){return this.parse_funcs.post_html.time(post);}, // TEMPORAL\r\n////////    mark_newer_posts : function(nickname,posts,date,style_mark,style_unmark,class_or_tag,key,unmark){\r\n//////////      var offset_top = 0;\r\n////////      var marked_first_post = null;\r\n////////      for (var i=posts.length-1;i>=0;i--) {\r\n////////        var mark = date<site2[nickname].get_time_of_post_in_utc(posts[i]);\r\n////////        var reply = posts[i];\r\n//////////        posts[i] = posts[i].parentNode;\r\n//////////        if (class_or_tag=='class') while (posts[i].className.search(key)==-1) posts[i] = posts[i].parentNode;\r\n//////////        if (class_or_tag=='tag') while (posts[i].tagName.search(key)==-1) posts[i] = posts[i].parentNode;\r\n////////        if (class_or_tag=='class') reply = posts[i].getElementsByClassName(key)[0];\r\n////////        if (class_or_tag=='tag')  reply = posts[i].getElementsByTagName(key)[0];\r\n////////        if (reply)\r\n////////          if (mark) {\r\n////////            reply.setAttribute('style',style_mark);\r\n////////            if (unmark) reply.addEventListener('mouseover', site2[nickname].unmark_post_from_event, false);\r\n//////////            offset_top = reply.offsetTop;\r\n////////            marked_first_post = reply;\r\n////////          } else reply.setAttribute('style',style_unmark);\r\n////////      }\r\n//////////      return offset_top;\r\n////////      return marked_first_post;\r\n////////    },\r\n////////    unmark_post_from_event: function() {\r\n////////      this.setAttribute('style','border: none');\r\n////////      this.removeEventListener('mouseover', site2['common'].unmark_post_from_event, false);\r\n////////    },\r\n\r\n\r\n    prep_own_posts_event : function(e){\r\n      if (e && e.key==='mine') site2['meguca'].prep_own_posts();\r\n      if (window.name==='meguca') send_message('parent',[['OWN_POSTS', window.name, site3[window.name].own_posts['ALL']]]);\r\n    },\r\n    prep_own_posts_event_received : function(val){\r\n      for (var i in val) site3[this.nickname].own_posts['ALL'][i] = null;\r\n    },\r\n    prep_own_posts : function(bt){\r\n      if (!site3[this.nickname].own_posts['ALL']) {\r\n        site3[this.nickname].own_posts['ALL'] = {};\r\n        var boards = ['/a/','/an/','/cr/','/g/'];\r\n        for (var i=0;i<boards.length;i++) site3[this.nickname].own_posts[boards[i]] = Object.create(site3[this.nickname].own_posts['ALL']);\r\n      }\r\n      if (localStorage) {\r\n        var nos = JSON.parse(localStorage['mine'] || '{}');\r\n        for (var j in nos) site3[this.nickname].own_posts['ALL'][j] = null;\r\n      }\r\n    },\r\n    wrap_to_parse: {\r\n      get: site2['DEFAULT'].wrap_to_parse.get,\r\n      posts: function(th){\r\n        delete Object.getPrototypeOf(th.posts[0]).com; // PATCH\r\n      },\r\n    },\r\n    short_link:function(name, nof_posts, num, kwd_head, kwd_tail){\r\n      var url = this.make_url4(common_func.name2dbt(name))[0];\r\n      var th_class = pref.script_prefix +'_link';\r\n      return ((!num || num>1)? '<a href=\"' + url + '?last=50' + '\" class=\"' + th_class + '\">' + kwd_head + '50' + kwd_tail + '</a>' : '') +\r\n             '<a href=\"' + url + '?last=100' + '\" class=\"' + th_class + '\">' + kwd_head + '100' + kwd_tail + '</a>';\r\n    },\r\n    catalog_json2html3_src: function(post){return (post.image)? '/static/src/'+post.image.src : undefined}, // TEMPORAL\r\n//    catalog_json2html3_thumbnail: function(post){return (post.image)? '/static/thumb/'+post.image.thumb : undefined}, // TEMPORAL\r\n    catalog_json2html3_thumbnail: function(post){\r\n      return (post.image)? '/static/'+ ((post.image.spoiler!==undefined && !pref[cataLog.embed_mode].open_spoiler_image)? 'spoil/spoilers'+post.image.spoiler+'.png' :\r\n                                        (post.image.thumb!==undefined)? 'thumb/' + post.image.thumb :\r\n                                                                        'src/' + post.image.src) : undefined;\r\n    },\r\n    post_json2html_fname_server: function(post){return (post.image)? post.image.src : undefined;},\r\n    post_json2html_fname: function(post){return (post.image)? post.image.imgnm : undefined;},\r\n    popups_href2dbtp: function(href, src, th){\r\n      if (href[0]==='#' && th) {\r\n        href = th.board+href;\r\n        src.setAttribute('href',href);\r\n      }\r\n      var hrefs = href.split(/[\\/#]/);\r\n      var p = hrefs[hrefs.length-1];\r\n      var t = hrefs[hrefs.length-2];\r\n      var b = '/'+hrefs[hrefs.length-3]+'/';\r\n      return ['meguca',b,t,p]\r\n    },\r\n    link_dbtp2href: function(dbtp){\r\n      return dbtp[1] + dbtp[2] + '#' + dbtp[3];\r\n    },\r\n    time_offset: -5,\r\n    parse_funcs : { // meguca\r\n      'post_json' : {\r\n        get no()  {return this.num;},\r\n        get sub() {return this.subject;},\r\n//        get name() {return this.name;},\r\n        name:'Anonymous', // default value\r\n        get txt() {return this.body;},\r\n        get com() {return (this.body)? this.body.replace(this.anchor_regex,this.anchor_func) : '';},\r\n        get filename() {return (this.image)? this.image.imgnm : undefined;},\r\n        get w() {return (this.image)? this.image.dims[0] : undefined;},\r\n        get h() {return (this.image)? this.image.dims[1] : undefined;},\r\n        get tn_w() {return (this.image)? ((this.image.spoiler!==undefined && !pref[cataLog.embed_mode].open_spoiler_image)? 250 : this.image.dims[2]) : undefined;},\r\n        get tn_h() {return (this.image)? ((this.image.spoiler!==undefined && !pref[cataLog.embed_mode].open_spoiler_image)? 250 : this.image.dims[3]) : undefined;},\r\n        get fsize() {return (this.image)? this.image.size : undefined;},\r\n        get ext() {return (this.image)? this.image.ext : undefined;},\r\n        domain:'meguca',\r\n//        type_html: site.whereami,\r\n        get domain_html() {return site.nickname}, // mimic always\r\n        get parse_funcs_html() {return site2[site.nickname].parse_funcs[site.whereami+'_html'];},\r\n        anchor_regex: /(>>)([0-9]+)/g,\r\n        pn: undefined, // stop prototype chain.\r\n      },\r\n      'thread_json' : {\r\n        ths: function(obj, parse_obj){\r\n          var proto_obj = {\r\n            board: parse_obj.board,\r\n            anchor_func: (function(){\r\n              var htmls = ['<a href=\"' + parse_obj.board + parse_obj.thread + '#', '\">&gt;&gt;', '</a>'];\r\n              return function(str,ar,no){\r\n                return htmls[0] + no + htmls[1] + no + htmls[2];\r\n              };\r\n            })(),\r\n            get com() {return this.body;}, // PATCH\r\n            __proto__:site2[parse_obj.domain].parse_funcs.post_json\r\n          };\r\n////          for (var i=0;i<obj.length;i++) obj[i].__proto__ = site2[parse_obj.domain].parse_funcs.post_json;\r\n          var i=0;\r\n          while (i<obj.length && obj[i].state===undefined) obj[i++].__proto__ = proto_obj; // 'state' shows that a post is being typed.\r\n          if (i!==obj.length) obj.splice(i,obj.length-i);\r\n          return [{posts: obj, // ext: obj[0].ext, tim:obj[0].time, obj:null,\r\n                   nof_posts:obj.length,\r\n                   key: parse_obj.domain + parse_obj.board + parse_obj.thread, no: parse_obj.thread,\r\n                   __proto__:parse_obj}];\r\n        },\r\n        get_op_src: function(obj){return site2[obj.domain].protocol + '//' + site2[obj.domain].domain_url + '/static/'+ 'src/' + obj.posts[0].image.src;},\r\n        op_img_url: function(obj){return site2[obj.domain].protocol + '//' + site2[obj.domain].domain_url + '/static/'+ site2['meguca'].catalog_json2html3_thumbnail(obj.posts[0]);},\r\n//        op_img_url: function(obj){return site2[obj.domain].protocol + '//' + site2[obj.domain].domain_url + '/static/'+ // working code.\r\n//                                         ((obj.posts[0].image.spoiler!==undefined)? 'spoil/spoilers'+obj.posts[0].image.spoiler+'.png' :\r\n//                                          (obj.posts[0].image.thumb!==undefined)?   'thumb/' + obj.posts[0].image.thumb :\r\n//                                                                                    'src/' + obj.posts[0].image.src);},\r\n//        nof_posts: function(obj){return obj.posts.length;},\r\n        nof_files: function(obj){return obj.posts[0].imgctr -1;}, // patch\r\n////        nof_files: function(obj){\r\n////          var num = 0;\r\n////          for (var i=0;i<obj.posts.length;i++) if (obj.posts[i].image) num++;\r\n////          return num;\r\n////        },\r\n        time: function(obj){return obj.posts[0].time;},\r\n        time_posted: function(obj){return obj.posts[obj.posts.length-1].time;},\r\n        time_created: function(obj){return obj.posts[0].time;},\r\n        time_bumped: function(obj){\r\n          var i=obj.posts.length-1;\r\n          while (i>0) if (!obj.posts[i].email || obj.posts[i].email!=='sage') return obj.posts[i].time; else i++;\r\n          return obj.posts[0].time;\r\n        },\r\n        sticky: function(th){return false;},\r\n        com: function(obj){return obj.posts[0].body;},\r\n        sub: function(obj){return obj.posts[0].sub;},\r\n        name: function(obj){return obj.posts[0].name;},\r\n        filename: function(obj){return obj.posts[0].image.imgnm;},\r\n//        tn_w: function(obj){return obj.posts[0].tn_w;},\r\n//        tn_h: function(obj){return obj.posts[0].tn_h;},\r\n\r\n        type_com: 'txt',\r\n//        type_com: 'html',\r\n        time_unit: 1,\r\n\r\n//        tn_as: function(th){return th.pn.getElementsByTagName('a');}, // the same as DEFAULT\r\n        //        footer: function(th){return th.pn.getElementsByClassName('meta')[0];},\r\n\r\n//        add_op_img_url: site2['DEFAULT'].parse_parts.add_op_img_url,\r\n        add_op_img_url: function(posts,board,domain){\r\n          for (var i=0;i<posts.length;i++)\r\n            if (posts[i].image) posts[i].op_img_url = site2[domain].protocol + '//' + site2[domain].domain_url + '/static/thumb/' + posts[i].image.thumb;\r\n        },\r\n\r\n        footer: 'catalog_html',\r\n        footer_clear: 'catalog_html',\r\n        proto: 'DEFAULT.thread_json'\r\n      },\r\n      'catalog_html' : {\r\n        footer: function(th){return th.pn.getElementsByTagName('small')[0].getElementsByTagName('span')[0];},\r\n        footer_clear: function(th){th.footer.textContent = '';},\r\n        ths: function(doc) {\r\n          var hist = doc.pn.getElementsByClassName('history');\r\n          for (var i=hist.length-1;i>=0;i--) {\r\n            if (hist[i].textContent==='Expand' || hist[i].textContent==='Last 100') hist[i].setAttribute('class',pref.script_prefix+'_link');\r\n            else hist[i].removeAttribute('class');\r\n          }\r\n          return this.ths_array(doc,doc.pn.getElementsByTagName('article'));\r\n        },\r\n        no : function(th){return th.pn.getElementsByTagName('a')[0].getAttribute('href');},\r\n        time_bumped: function(th){return undefined;},\r\n        time_created : function(th){return undefined;},\r\n        nof_posts: function(th){return parseInt(th.footer.textContent.split('/')[0],10);},\r\n        nof_files: function(th){return parseInt(th.footer.textContent.split('/')[1],10);},\r\n        sub: function(th){\r\n          var sub = th.pn.getElementsByTagName('h3')[0];\r\n          return (sub)? common_func.escape(sub.textContent) : undefined;\r\n        },\r\n        name: function(th){return undefined;},\r\n        com: function(th){return th.pn.childNodes[th.pn.childNodes.length-1].textContent;},\r\n        sticky: function(th){return false;},\r\n////////        tn_as: function(th){return th.pn.getElementsByTagName('a');},\r\n////////        tn_imgs: function(th){return (th.tn_as[0])? [th.tn_as[0].getElementsByTagName('imgs')[0]] : [];},\r\n////////        class_thread: 'thread',\r\n////////        class_thumbnail: 'thumb',\r\n//////////        op_img_url: function(th){ // working code.\r\n//////////          var img = th.pn.getElementsByTagName('img')[0];\r\n//////////          return (img)? img.getAttribute('src') : undefined; // patch.\r\n//////////        },\r\n        op_img_url: function(th){return th.pn.getElementsByTagName('img')[0].getAttribute('src');},\r\n        get_op_src: function(th){return th.op_img_url.replace(/thumb/,'src');}, // patch\r\n        dynamic_image_hover: true,\r\n        missing_info: 1,\r\n        img2src: function(img, lth){\r\n          if (!lth) lth = this.get_lth_from_node(img);\r\n          if (!lth) return null;\r\n          var src = img.src;\r\n          if (lth.th && lth.th.posts[0].ext) src = src.replace(/thumb/,'src').replace(/\\.\\w+$/,lth.th.posts[0].ext);\r\n          else if (lth.th.parse_funcs.missing_info) scan.scan_ui('image_hover', {tgts: [lth.key], options:{callback:function(){cataLog.image_hover_reentry(img);}, priority:6}}); // NEVER ACTIVATED because catalog.json is read always at initial\r\n          return src;\r\n        },\r\n      },\r\n      'post_html' : {\r\n        time: function(post){\r\n          var time_node = post.getElementsByTagName('time')[0];\r\n          return Date.parse(time_node.title || time_node.textContent) + (pref.localtime_offset - site2['meguca'].time_offset) * 3600000;}, // timezone -5\r\n      },\r\n////////      'page_html' : {\r\n////////        ths: function(doc) {return this.ths_array(doc, doc.pn.getElementsByClassName('thread'));},\r\n////////        th_init: function(th) {th.pn.removeAttribute('class');},\r\n//////////        th_destroy: function(pn, parse_funcs){},\r\n////////        no : function(th){return parseInt(th.pn.id.substr(1),10) || parseInt(th.pn.id.substr(2),10)},\r\n//////////        ths: function(doc) { // working code.\r\n//////////          var ths = this.ths_array(doc, doc.pn.getElementsByClassName('thread'));\r\n//////////          for (var i=0;i<ths.length;i++) {\r\n//////////            Object.defineProperty(ths[i], 'no', {value:ths[i].pn.id.substr(1), enumerable:true, writable:true, configurable:true});\r\n//////////            ths[i].pn.removeAttribute('class'); // collection ISN'T writable? and if wrote, its enumerator doesn't work.\r\n//////////          }\r\n//////////          return ths;\r\n//////////        },\r\n//////////        no : function(th){return parseInt(th.pn.getElementsByClassName('postContainer')[0].id.substring(2),10);},\r\n////////        last_replies: 'catalog_json',\r\n////////        time: function(post){\r\n////////          return parseInt(post.pn.getElementsByClassName('dateTime')[0].getAttribute('data-utc'),10) * 1000;\r\n////////        },\r\n////////        nof_posts: function(th){\r\n////////          var nof_posts = th.pn.getElementsByClassName('postContainer').length;\r\n////////          var nof_files = th.pn.getElementsByClassName('fileText').length;\r\n////////          var om_info   = th.pn.getElementsByClassName('summary desktop')[0];\r\n////////          if (om_info) {\r\n////////            var str = om_info[brwsr.innerText].replace(/\\n/g,'');\r\n////////            nof_posts += parseInt(str.replace(/\\ post.*/,''),10);\r\n////////            nof_files += parseInt('0'+str.replace(/\\ image.*/,'').replace(/[^\\ ]*\\ /g,''),10);\r\n////////          }\r\n////////          Object.defineProperty(th,'nof_files',{value:nof_files, enumerable:true, configurable:true, writable:true});\r\n////////          return nof_posts;\r\n////////        },\r\n////////        nof_files: function(th){\r\n////////          if (!th.hasOwnProperty('nof_posts')) this['nof_posts'](th);\r\n////////          return th.nof_files;\r\n////////        },\r\n////////        sub:  function(post){return post.pn.getElementsByClassName('subject')[0][brwsr.innerText];}, // same as 8chan\r\n////////        name: function(post){return post.pn.getElementsByClassName('name')[0][brwsr.innerText];}, // same as 8chan\r\n////////        com:  function(post){return post.pn.getElementsByClassName('postMessage')[0][brwsr.innerText];},\r\n////////        footer: function(th){return this.insert_footer4(th.pn.getElementsByClassName('postInfo desktop')[0]);},\r\n////////        sticky: function(th){return (th.pn.getElementsByClassName('stickyIcon').length!=0);},\r\n////////        flag: function(post){  // same as 8chan\r\n////////          var flags = post.pn.getElementsByClassName('flag');\r\n////////          return (flags.length!=0)? document.importNode(flags[0],false) : null;\r\n////////        },\r\n////////        op_img_url:function(th){\r\n////////          var img = th.pn.getElementsByTagName('img')[0];\r\n////////          var url = (img)? img.getAttribute('src') : undefined;\r\n////////          return url;\r\n////////        },\r\n////////        get_thread_links : function(th){return pn.getElementsByClassName('replylink')[0];},\r\n////////        get_omitted_info : function(post){return post.pn.getElementsByClassName('summary')[0];},\r\n////////      },\r\n////////      'page_json'  : {\r\n////////        proto: 'catalog_json'\r\n////////      },\r\n////////      'thread_html' : {\r\n////////        ths: function(doc) {return site2['DEFAULT'].parse_funcs['thread_html'].ths_array(doc, doc.pn.getElementById('t'+doc.thread));},\r\n//////////        ths: function(doc) { // working code.\r\n//////////          return [{pn:doc.pn.getElementById('t'+doc.thread),\r\n//////////                   type_html: 'thread_html',\r\n//////////                   page: '?',\r\n//////////                   __proto__: doc.__proto__}];\r\n//////////        },\r\n////////\r\n//////////        pop_post: function(th){ // debuging code.\r\n//////////          th.post = th.posts[--th.idx_pop];\r\n//////////          return th.post;\r\n//////////        },\r\n//////////        pop_post_prep: function(th){\r\n//////////          delete th.posts;\r\n//////////          th.idx_pop = th.posts.length;\r\n//////////        },\r\n////////////        pop_post: function(th){ // working code\r\n////////////          while (th.idx_pop>=0) {\r\n////////////            var pn = th.children[th.idx_pop--];\r\n////////////            if (pn.className && pn.className.indexOf('postContainer')!=-1) {\r\n////////////              th.post = {pn:pn, parse_funcs:this, __proto__:th.__proto__};\r\n////////////              return true;\r\n////////////            }\r\n////////////          }\r\n////////////          return false;\r\n////////////        },\r\n//////////        post_no: function(post){return parseInt(post.pn.id.substr(3),10);},\r\n////////        post_no: function(post){return parseInt(post.pn.id.substr(2),10);}, // 2015.05.12, maybe depends on baord???\r\n////////        get_op_src: 'thread_json',\r\n////////        proto: 'page_html',\r\n////////      },\r\n    },\r\n    general_event_handler:{\r\n      catalog:{\r\n        mouseover: function(e){\r\n          var et = e.target;\r\n          var et_tagName = et.tagName;\r\n          if (et_tagName==='IMG')\r\n            if (pref[cataLog.embed_mode].image_hover && et.parentNode.tagName==='A') cataLog.image_hover_add.call(et, e);\r\n        },\r\n        __proto__: site2['DEFAULT'].general_event_handler.catalog\r\n      },\r\n    },\r\n    favicon : {\r\n      __proto__: site2['vichan'].favicon,\r\n      none: '/static/favicon.ico',\r\n      reply: '/static/css/ui/unreadFavicon.ico',\r\n      reply_to_me: '/static/css/ui/replyFavicon.ico',\r\n    },\r\n  };\r\n  site2['meguca'] = { // meguca.org v2\r\n    home: 'https://meguca.org/assets/favicons/default.ico',\r\n    check_func: site2['meguca1'].check_func, // needed as a own property.\r\n    components: {\r\n      boardlist: '#banner', // '#board-navigation'\r\n    },\r\n    boards_json: undefined, // terminate prototype chain\r\n    check_func : function(){\r\n      var href = window.location.href;\r\n      if (href.indexOf('/meguca.org/')!=-1) {\r\n        site.whereami = (href.search(/[0-9]+$/)!=-1)? 'thread' : 'catalog';\r\n//                      : 'other';\r\n        site.config('meguca.org',this.nickname);\r\n        site.max_page = 3;\r\n        site.header_height = function(){\r\n          var header = document.getElementById('banner');\r\n          return (header)? header.offsetHeight : 0;\r\n        }\r\n        return true;\r\n      } else {\r\n        this.prep_own_posts(); // make own_posts structure WITH PROTOTYPE.\r\n        return false;\r\n      }\r\n    },\r\n    url_boards_json : function(){return ['https://meguca.org/json/boardList', 'json'];}, // working code.\r\n    postprocess_board: function(val){\r\n      for (var i=0;i<val.length;i++) {\r\n        var bd = liveTag.mems.init({domain:this.nickname, board:'/'+val[i].id+'/'});\r\n        bd.o = i;\r\n        if (val[i].tags && val[i].tags.length!=0) liveTag.postprocess_board_add_btag(val[i].tags,bd);\r\n      }\r\n    },\r\n//////    utilize_boards_json: true,\r\n////    url_boards_json : function(){return ['https://meguca.org/json/boardTimestamps', 'json'];}, // need to be debugged\r\n////    postprocess_board: function(val){\r\n////      var order = 0;\r\n////      for (var i in val) {\r\n////        var bd = liveTag.mems.init({domain:this.nickname, board:'/'+i+'/'});\r\n////        bd.o = order++;\r\n////        Object.defineProperty(bd,'max',{value:val[i], writable:true});\r\n////        if (bd.read_max===undefined) Object.defineProperty(bd,'read_max',{value:0, writable:true});\r\n//////        if (val[i].tags && val[i].tags.length!=0) liveTag.postprocess_board_add_btag(val[i].tags,bd);\r\n////      }\r\n////    },\r\n    make_url4 : function(dbt){\r\n      var url_prefix  = this.protocol + '//' + this.domain_url; // force to use https:\r\n      if (dbt[3].substr(0,4)==='page' && dbt[2]==0) dbt[3] = 'catalog_json'; // dbt[2] is string, === can't be used.\r\n//      if      (dbt[3]==='page_html')    return [url_prefix + ((dbt[2]!=0)? (parseInt(dbt[2],10)+1) :''), 'html'];\r\n      return (dbt[3]==='catalog_json')? [url_prefix + '/json'+ dbt[1], 'json', 'meguca' + dbt[1] + 'j0'] :\r\n             (dbt[3]==='thread_html')?  [url_prefix + dbt[1] + dbt[2], 'html'] :\r\n             (dbt[3]==='thread_json')?  [url_prefix + '/json'+ dbt[1]+dbt[2], 'json'] : undefined;\r\n    },\r\n    catalog_get_native_area: function(){\r\n      return (site.whereami==='catalog')? document.getElementById('catalog') :\r\n                                          document.getElementById('threads');\r\n    },\r\n    catalog_get_native_scroll_area: function(){\r\n      return (site.whereami==='catalog')? document.getElementsByTagName('section')[1] : window;\r\n    },\r\n    catalog_native_prep_wait_loop_timeout: 100,\r\n    catalog_native_prep_wait_loop: function(whereami, callback){\r\n      if (--this.catalog_native_prep_wait_loop_timeout<0) return;\r\n      if ((whereami==='catalog' &&\r\n           (!document.getElementsByName('sortMode')[0])) ||\r\n          (whereami==='thread' &&\r\n           (!document.getElementById('expand-images') || !document.getElementById('threads')))\r\n         ) setTimeout(function(){this.catalog_native_prep_wait_loop(whereami,callback);}.bind(this),1000);\r\n      else callback();\r\n    },\r\n    catalog_native_prep: function(date,pn_filter,pn_tb,pn_hi){\r\n//      var node_ref = document.getElementsByClassName('catalog_search')[0].nextSibling;  // FF doesn't work.\r\n//      var node_ref = (site.whereami==='catalog')? document.getElementById('threads').getElementsByTagName('aside')[0] :\r\n      var node_ref = (site.whereami==='catalog')? document.getElementsByName('sortMode')[0] :\r\n                                                  document.getElementById('expand-images').parentNode.nextSibling;\r\n      site4.tb_prep_for_embed(pn_tb);\r\n      if (site.whereami==='catalog') {\r\n        var pn_tb_new = document.createElement('span');\r\n        while (pn_tb.firstChild) pn_tb_new.appendChild(pn_tb.firstChild);\r\n        pn_tb = pn_tb_new;\r\n        pn_tb.setAttribute('style','float:right');\r\n        pn_tb.setAttribute('style','float:right');\r\n      } else if (site.whereami==='page') {\r\n        var pctrls = document.getElementsByName('postcontrols')[0];\r\n//        for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.removeChild(pctrls.childNodes[i]);\r\n        pctrls.parentNode.insertBefore(document.createElement('hr'),pctrls.nextSibling);\r\n      }\r\n//      node_ref.parentNode.insertBefore(pn_hi,node_ref);\r\n      if (site.whereami==='catalog') {\r\n        node_ref.parentNode.appendChild(pn_tb);\r\n        node_ref.parentNode.parentNode.insertBefore(pn_tb.removeChild(pn_tb.childNodes[3]).firstChild, node_ref.parentNode);\r\n      } else node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n      if (site.whereami==='catalog') {\r\n        var ctlg = document.getElementById('catalog');\r\n        ctlg.parentNode.insertBefore(pn_filter,ctlg);\r\n      } else node_ref.parentNode.insertBefore(pn_filter,document.getElementById('catalog'));\r\n      var selector_catchan = pn_filter.getElementsByTagName('select')['catalog.indexing'];\r\n      selector_catchan.setAttribute('style','float:left');\r\n      if (site.whereami==='catalog') node_ref.parentNode.insertBefore(selector_catchan,node_ref);\r\n      else pn_tb.childNodes[3].insertBefore(selector_catchan,pn_tb.childNodes[3].firstChild);\r\n//      pn_tb.childNodes[0].setAttribute('style',pn_tb.childNodes[0].getAttribute('style')+';display:none');\r\n//      pn_tb.childNodes[1].setAttribute('style',pn_tb.childNodes[1].getAttribute('style')+';display:none');\r\n\r\n      node_ref.setAttribute('style','float:left');\r\n      if (site.whereami!=='catalog') node_ref.parentNode.insertBefore(pn_tb.childNodes[3],node_ref.nextSibling);\r\n      if (site.whereami=='catalog') {\r\n        node_ref.style.display = 'none';\r\n        document.getElementById('banner').style=\"height:auto\";\r\n        var search = document.getElementById('catalog-controls').getElementsByTagName('input')['search'];\r\n        var search2 = search.cloneNode(false);\r\n        search2.name = 'catalog.filter.kwd.str';\r\n        search2.oninput = cataLog.event_func;\r\n        search.parentNode.insertBefore(search2,search);\r\n        search.setAttribute('style','display:none');\r\n        pref3.catalog.filter.kwd.obj = [pn_filter.getElementsByTagName('input')['catalog.filter.kwd.str'], search2];\r\n        pref3.catalog.filter.kwd.clear();\r\n      }\r\n    },\r\n    post_json2html: site2['4chan'].post_json2html,\r\n    page_json2html3: site2['4chan'].page_json2html3,\r\n    page_json2html3_replace_expander: site2['4chan'].page_json2html3_replace_expander,\r\n    page_json2html3_add_expander: site2['4chan'].page_json2html3_add_expander,\r\n    page_json2html3_add_omitted_info: site2['4chan'].page_json2html3_add_omitted_info,\r\n    post_container: site2['4chan'].post_container,\r\n    wrap_to_parse: site2['DEFAULT'].wrap_to_parse, // bypass meguca1\r\n    catalog_json2html3_thumbnail: function(post){\r\n      return (post.image)? this.protocol + '//' + this.domain_url + // fullpath is required for desktopNotification.\r\n        ((post.image.spoiler!==undefined && !pref[cataLog.embed_mode].open_spoiler_image)? '/assets/spoil/default.jpg' :\r\n        '/images/thumb/' + post.image.SHA1 + ((post.image.fileType===0)? '.jpg' : '.png')) : undefined;\r\n    },\r\n//    catalog_json2html3_src: (function(){\r\n//      var fileType = ['jpg', 'png', 'gif', 'webm', 'pdf', 'svg', 'mp4', 'mp3', 'ogg'];\r\n//      return function(post){return (post.image)? '/images/src/' + post.image.SHA1 + '.' + fileType[post.image.fileType] : undefined;};\r\n//    })(),\r\n    catalog_json2html3_src: function(post){return (post.image)? '/images/src/' + post.image.SHA1 + post.ext : undefined;},\r\n    post_json2html_fname_server: function(post){return (post.image)? post.image.SHA1 + ((post.image.fileType===0)? '.jpg' : '.png') : undefined;},\r\n    post_json2html_fname: function(post){return (post.image)? post.filename + post.ext : undefined;},\r\n    parse_funcs: {\r\n      'page_html': { // for popup\r\n        get_omitted_info: site2['4chan'].parse_funcs.page_html.get_omitted_info,\r\n        set_omitted_info: site2['4chan'].parse_funcs.page_html.set_omitted_info,\r\n        replace_omitted_info: site2['4chan'].parse_funcs.replace_omitted_info,\r\n        replace_omitted_info2: site2['4chan'].parse_funcs.replace_omitted_info2,\r\n      },\r\n      'thread_json' : {\r\n        ths: function(obj, parse_obj) {\r\n          var th = Object.create(obj); // keep original as it is for archiving.\r\n//          if (th.sticky) th.sticky = true; // overwrite property of the same name before setting prototype to use polarity.\r\n          th.board = '/' + th.board +'/';\r\n          obj.no = obj.id;\r\n          delete obj.id;\r\n          var posts = [obj];\r\n////          var flag = false; // working code -2016.10.06\r\n////          var max_no = 0;\r\n////          for (var i in th.posts) {\r\n          for (var i=0;i<obj.posts.length;i++) {\r\n            var post = th.posts[i];\r\n//            if (pref.test_mode['72'] && post.editing) break; // static for live tagging and archiving, extraction will be done before finishing the posts.\r\n            if (post.id) {\r\n              post.no = post.id;\r\n              delete post.id;\r\n            }\r\n            posts[posts.length] = post;\r\n////            if (max_no>post.no) flag = true;\r\n////            max_no = post.no;\r\n          }\r\n////          if (flag) posts.sort(function(a,b){return a.no - b.no;});\r\n////          th.posts_obj = th.posts;\r\n          th.posts = posts;\r\n          th.nof_posts = th.posts.length; // for not being reduced if posts are sliced.\r\n          obj.__proto__ = parse_obj;\r\n          return [th];\r\n        },\r\n        get_op_src: function(obj){return site2[obj.domain].protocol + '//' + site2[obj.domain].domain_url + site2[obj.domain].catalog_json2html3_src(obj.posts[0]);},\r\n        op_img_url: 'DEFAULT.common', // function(th) {return site2['meguca'].catalog_json2html3_thumbnail(th, th.board);},\r\n//        op_img_url: function(obj){return site2[obj.domain].protocol + '//' + site2[obj.domain].domain_url + site2['meguca'].catalog_json2html3_thumbnail(obj.posts[0]);},\r\n//        add_op_img_url: site2['DEFAULT'].parse_parts.add_op_img_url,\r\n        time_unit: 1000,\r\n        type_com: 'txt',\r\n//        posts_full: 'DEFAULT.catalog_json',\r\n        posts_full: null,\r\n        has_editing: true,\r\n        posts_obj: function(th,no_in){\r\n          var posts_obj = {};\r\n          var i=th.posts.length;\r\n          while (--i>=0) {\r\n            var no = th.posts[i].no;\r\n            posts_obj[no] = th.posts[i];\r\n            if (no===no_in) break;\r\n          }\r\n          th.posts_obj = posts_obj;\r\n          return posts_obj[no_in];\r\n        },\r\n        key: 'DEFAULT.common',\r\n      },\r\n      'catalog_json': {\r\n        ths: function(obj, parse_obj) {\r\n          var ths = [];\r\n          for (var j=0;j<obj.threads.length;j++) {\r\n            var th = Object.create(obj.threads[j]); // keep original as it is for archiving.\r\n            th.page = '0.' + j;\r\n            if (th.sticky) th.sticky = true; // overwrite property of the same name before setting prototype to use polarity.\r\n            th.board = '/' + th.board +'/';\r\n            obj.threads[j].no = th.id;\r\n            delete obj.threads[j].id;\r\n            th.posts = [th.__proto__];\r\n            th.posts_obj = {};\r\n            th.posts_obj[th.no] = th.posts[0];\r\n            th.__proto__.__proto__ = parse_obj;\r\n            ths[ths.length] = th;\r\n          }\r\n          return ths;\r\n        },\r\n//        footer: function(th){return th.pn.getElementsByClassName('meta')[0];},\r\n//        posts: 'DEFAULT.catalog_json',\r\n//        posts: function(th){\r\n//          var posts = site2['DEFAULT'].parse_funcs.catalog_json.posts(th);\r\n//          if (th.last_replies) posts = posts.concat(th.last_replies);\r\n//          return posts;\r\n//        },\r\n//        has_editing: false,\r\n        has_posts: false,\r\n        missing_info: 1, // com is missing.\r\n        proto: 'thread_json',\r\n      },\r\n      'catalog_json_template': {\r\n        dont_have_com: true,\r\n        get nof_posts(){return this.postCtr+1;},\r\n        com: '', // doesn't have this.\r\n//        get max(){return this.lastUpdated;},\r\n        proto: 'thread_json_template'\r\n      },\r\n      'thread_json_template': {\r\n        get time_posted(){return this.replyTime*1000;},\r\n        get time_bumped(){return this.bumpTime*1000;},\r\n        get time_created(){return this.time*1000;},\r\n//        get nof_posts(){return this.posts.length;}, // remove editing posts. // BUG. reduced if posts are sliced.\r\n        get nof_files(){return this.imageCtr;},\r\n        get com(){return this.body;},\r\n        proto: 'post_json_template'\r\n      },\r\n      'post_json_template': (function(){\r\n        var fileType = ['jpg', 'png', 'gif', 'webm', 'pdf', 'svg', 'mp4', 'mp3', 'ogg'];\r\n        return {\r\n          get filename() {return (this.image)? this.image.name : undefined;},\r\n          get w(){return (this.image)? this.image.dims[0] : undefined;},\r\n          get h(){return (this.image)? this.image.dims[1] : undefined;},\r\n          get tn_w(){return (this.image)? ((this.image.spoiler!==undefined && !pref[cataLog.embed_mode].open_spoiler_image)? 150 : this.image.dims[2]) : undefined;},\r\n          get tn_h(){return (this.image)? ((this.image.spoiler!==undefined && !pref[cataLog.embed_mode].open_spoiler_image)? 150 : this.image.dims[3]) : undefined;},\r\n          get fsize(){return (this.image)? this.image.size : undefined;},\r\n          get ext(){return (this.image)? '.'+fileType[this.image.fileType] : undefined;},\r\n          get sub(){return (this.subject)? common_func.escape(this.subject) : '';},\r\n          name: 'Anonymous',\r\n          get txt(){return this.body;},\r\n          get com(){\r\n//            var txt2com = site2[site.nickname].parse_funcs.post_html.txt2com;\r\n            var anchor_class = (site2[site.nickname].parse_funcs.post_html.txt2com_anchor_class)? '\" class=\"' + site2[site.nickname].parse_funcs.post_html.txt2com_anchor_class : '';\r\n            var anchor_regex = /(>>)([0-9]+)/g;\r\n            function anchor_func(board, str,arrow,no){\r\n              var link = this[no];\r\n              return (link)? '<a href=\"/' + link.board + '/' + link.op + '#' + no + anchor_class +\r\n                '\">&gt;&gt;' + ((link.board!=board)? '&gt;/'+ link.board +'/' : '') + no + '</a>' : str; // links isn't provided while editing\r\n            }\r\n            var spoiler_replace_txt = site2[site.nickname].parse_funcs.post_html.txt2com_spoiler_replace_txt || '<spoiler>$1</spoiler>';\r\n            var c2t_count;\r\n            function command2txt(str){\r\n              return '<strong>' + str + ' (' + ((this[c2t_count])? this[c2t_count++].val : '') + ')</strong>';\r\n            }\r\n            Object.defineProperty(site2['meguca'].parse_funcs.post_json_template,'com',{get:function(){\r\n                if (!this.body) return '';\r\n                var com = common_func.escape_text(this.body);\r\n                if (this.links) com = com.replace(anchor_regex,anchor_func.bind(this.links, this.board.slice(1,-1)));\r\n                com = com.replace(/(^>[^>].*$)/mg,'<span class=\"quote\">$1</span>');\r\n                com = com.replace(/\\*\\*([^(\\*\\*)\\n]*)((\\*\\*)|$)/mg,spoiler_replace_txt);\r\n                if (this.commands) {\r\n                  c2t_count = 0;\r\n                  com = com.replace(/^#(pyu|flip|\\d*d\\d+|8ball)$/mg,command2txt.bind(this.commands));\r\n                }\r\n                com = com.replace(/https*:\\/\\/[^\\s]*(\\s|$)/mg,'<a href=\"$&\" target=\"_blank\">$&</a>');\r\n                return com.replace(/\\n/g,'<br>');\r\n              }, enumerable:true, configurable:true});\r\n            return this.com;}, // return Object.defineProperty(...).com doesn't work, because 'this' refers site2['meguca'].parse_funcs.post_json_template.\r\n//          get com(){return (this.body)? site2[site.nickname].parse_funcs.post_html.txt2com((this.links)? this.body.replace(anchor_regex,anchor_func(this.links)) : this.body) : '';}, // BUG, /a/1179831(test thread) doesn't have links and cause error. // links isn't provided while editing.\r\n//          get posts_editing(){\r\n//            var posts_editing = {};\r\n//            for (var i=0;i<this.posts.length;i++) if (this.posts[i].editing) posts_editing[this.posts[i].no] = this.posts[i];\r\n//            return Object.defineProperty(this,'posts_editing',{value:posts_editing, writable:true, enumerable:true, configurable:true}).posts_editing;\r\n//          },\r\n          sticky: false,\r\n          pn: undefined, // block getter\r\n          get no(){return this.id;},\r\n          time: undefined, // patch\r\n          flag: undefined,\r\n          flags: undefined,\r\n          get parse_funcs_html(){\r\n            Object.defineProperty(site2['meguca'].parse_funcs.post_json_template,'parse_funcs_html',\r\n              {value:site2[site.nickname].parse_funcs[site.whereami+'_html'], writable:true, enumerable:true, configurable:true});\r\n            return this.parse_funcs_html;},\r\n          proto: 'DEFAULT.common'\r\n        };\r\n      })(),\r\n    },\r\n    mimic_always: true,\r\n    proto: 'meguca1'\r\n  };\r\n\r\n  site2['lain'] = { //lainchan.org\r\n    nickname : 'lain',\r\n    home : site.protocol + '//lainchan.org/q/index.html',\r\n//    home : site.protocol + '//lainchan.org',\r\n    protocol: 'https:',\r\n    domain_url: 'lainchan.org',\r\n    postform_rules: null,\r\n    features : {page: false, graph: true, setting2: false},\r\n    pref_default: {\r\n      page:{ env:{ disp_offset:1}},\r\n      catalog:{image_hover:true, board:{all_boards:true}},\r\n      proto:{ env:{ localtime_native:false,\r\n                    colorID_native: false}},\r\n      stats:{ time_unit:3, estimate_posts:false}, // estimation doesn't work because lainchan has disorder of No.\r\n      chart: {inst:{show: {np:false, p:true}, time_sel:3}},\r\n      easy2:{limits:1},\r\n    },\r\n    boards_json:{boards:[{board:'cyb', pages:7}, {board:'tech', pages:7}, {board:'\\u03bb', pages:7}, {board:'layer', pages:5}, {board:'zzz', pages:17}, {board:'w', pages:4}, {board:'feels', pages:7}, {board:'drg', pages:4}, {board:'lit', pages:7}, {board:'civ', pages:1}, {board:'diy', pages:7}, {board:'art', pages:7}, {board:'r', pages:9}, {board:'q', pages:3}, {board:'f', pages:2}, {board:'sec', pages:3}, {board:'cult', pages:4}]},\r\n    check_func : function(){\r\n      var href = window.location.href;\r\n      if (href.indexOf('/lainchan.org/')!=-1) {\r\n        site.whereami = (href.indexOf('/catalog.html')!=-1)? 'catalog'\r\n                      : (href.indexOf('/res/')!=-1)? 'thread'\r\n                      : (document.getElementsByTagName('title')[0] && document.getElementsByTagName('title')[0].textContent==='404')? '404' \r\n//                      : (site.board==='/all/' || site.board==='/popular/')? 'other'\r\n//                      : (!pref.test_mode['29'] && (site.board==='/all/' || site.board==='/popular/'))? 'other'\r\n                      : 'page';\r\n//                      : (href.search(/\\/$|(index|[0-9]+)\\.html|\\/all$|\\/popular$/)!=-1)? 'page'\r\n//                      : 'other';\r\n        site.config('lainchan.org','lain');\r\n        site.max_page = 7;\r\n        site.header_height = function(){\r\n          var header = document.getElementsByClassName('boardlist')[0];\r\n          if (header) return header.offsetHeight;\r\n          else return 0;\r\n        }\r\n        site.myself = (site.whereami==='thread')? parseInt(href.replace(/.*res\\//,'').replace(/\\.html/,''),10) : 0;\r\n        if (site.whereami==='thread' || site.whereami==='page') {\r\n          site.embed_to['top']    = document.getElementsByName('postcontrols')[0];\r\n          site.embed_to['bottom'] = document.getElementsByTagName('footer')[0];\r\n        } else if (site.whereami==='catalog') {\r\n          site.embed_to['top']    = document.getElementsByTagName('header')[0].nextSibling;\r\n          site.embed_to['bottom'] = document.getElementsByTagName('footer')[0];\r\n        }\r\n        if (site.whereami==='thread' || site.whereami==='page') {\r\n//          site.postform = document.getElementsByTagName('form')['post'].getElementsByTagName('tbody')[0];\r\n          site.postform = document.getElementsByTagName('form')['post'];\r\n          if (site.postform) {\r\n//            site.postform_comment = document.getElementById('body');\r\n            this.postform_prep();\r\n\r\n//          var bar_bottom = document.getElementsByClassName('bottom')[0];\r\n//////          site.root_body2 = bar_bottom.insertBefore(document.createElement('span'),bar_bottom.childNodes[1]); // working code.\r\n////          site.root_body2 = document.getElementsByClassName('pages')[0];\r\n////          site.root_body2.setAttribute('style','width:auto');\r\n//////          site.root_body2 = document.getElementById('style-select');\r\n          }\r\n        }\r\n        pref.thread_reader.own_posts_tracker = true;\r\n////////        setTimeout(function(){this.postprocess_board(this.boards_json)}.bind(this),0);\r\n//        var ss = document.querySelector('link[href^=\"/stylesheets/\"]');\r\n        // http://stackoverflow.com/questions/2635814/javascript-capturing-load-event-on-link\r\n        // But https://pie.gd/test/script-link-events/\r\n        styleSheet.add_to_watch(document.getElementById('stylesheet'));\r\n        styleSheet.add_to_watch(document.getElementById('code_stylesheet'));\r\n//        var ss = document.getElementById('stylesheet'); // doesn't work because chrome and FF don't support onload event from link tag.\r\n//        ss.addEventListener('load',styleSheet.styles_changed,false);\r\n        return true;\r\n      } else return false;\r\n    },\r\n//    catalog_threads_in_page : function(doc){return doc.getElementsByClassName('mix');},\r\n    catalog_posts_in_thread : function(doc){return doc.getElementsByClassName('replyContainer');},\r\n    max_page : function(){return 10;},\r\n    all_boards: ['/popular/','/all/','/mega/','/random/'],\r\n    make_url4: function(dbt){\r\n      return (site2['lain'].all_boards.indexOf(dbt[1])!=-1 && dbt[3]!=='catalog_html')? undefined : this.__proto__.make_url4.call(this,dbt);\r\n    },\r\n\r\n    catalog_native_prep: function(date,pn_filter,pn_tb,pn_hi){\r\n//      var node_ref = document.getElementsByClassName('catalog_search')[0].nextSibling;  // FF doesn't work.\r\n      var node_ref = (site.whereami==='catalog')? document.getElementsByClassName('threads')[0]\r\n                                                : document.getElementsByName('postcontrols')[0];\r\n      site4.tb_prep_for_embed(pn_tb);\r\n      if (site.whereami==='catalog') {\r\n        var selector_native = document.getElementById('sort_by');\r\n        if (selector_native.selectedIndex!=0) {\r\n          selector_native.selectedIndex = 0;\r\n          var evt = document.createEvent('UIEvents');\r\n          evt.initUIEvent('change', false, true, window, 1);\r\n          selector_native.dispatchEvent(evt);\r\n        }\r\n        selector_native.style.display = 'none';\r\n        document.getElementById('image_size').addEventListener('change', site2['lain'].catalog_native_size_changed, false);\r\n        var pn_tb_new = document.createElement('span');\r\n        while (pn_tb.firstChild) pn_tb_new.appendChild(pn_tb.firstChild);\r\n        pn_tb = pn_tb_new;\r\n        pn_tb.appendChild(pn_tb.removeChild(pn_tb.childNodes[3]).firstChild);\r\n      } else if (site.whereami==='page') {\r\n        var pctrls = document.getElementsByName('postcontrols')[0];\r\n//        for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.removeChild(pctrls.childNodes[i]);\r\n        pctrls.parentNode.insertBefore(document.createElement('hr'),pctrls.nextSibling);\r\n      }\r\n//      node_ref.parentNode.insertBefore(pn_hi,node_ref);\r\n      if (site.whereami==='catalog') node_ref.previousElementSibling.appendChild(pn_tb);\r\n//      if (site.whereami==='catalog') node_ref.previousSibling.appendChild(pn_tb);\r\n      else node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n      node_ref.parentNode.insertBefore(pn_filter,node_ref);\r\n      var selector_catchan = pn_filter.getElementsByTagName('select')['catalog.indexing'];\r\n      if (site.whereami==='catalog') selector_native.parentNode.insertBefore(selector_catchan,selector_native);\r\n      else pn_tb.childNodes[3].insertBefore(selector_catchan,pn_tb.childNodes[3].firstChild);\r\n//      pn_tb.childNodes[0].setAttribute('style',pn_tb.childNodes[0].getAttribute('style')+';display:none');\r\n//      pn_tb.childNodes[1].setAttribute('style',pn_tb.childNodes[1].getAttribute('style')+';display:none');\r\n////////      return site2['lain'].catalog_from_native(date,document,site.board,site.whereami+'_html');\r\n    },\r\n////    catalog_get_native_area: function(){\r\n////      if (site.whereami==='catalog') return document.getElementById('Grid');\r\n////      else {\r\n////        var pc = document.getElementsByName('postcontrols')[0];\r\n////        return pc.insertBefore(document.createElement('div'),pc.firstChild);\r\n////      }\r\n////    },\r\n\r\n////////    catalog_from_native : function(date,doc,board,type) { // working code.\r\n////////      return site2[this.nickname].wrap_to_parse.get(doc, this.nickname, board, type);\r\n////////////      var parse_obj = {domain:this.nickname, board:board, parse_funcs:site2[this.nickname].parse_funcs[type], __proto__:site4.parse_funcs_on_demand};\r\n////////////      var ths = {pn:doc, __proto__:parse_obj};\r\n////////////      return ths.ths;\r\n////////    },\r\n//    catalog_get_native_area: function(){return document.getElementById('Grid');},\r\n    catalog_native_size: (document.getElementById('image_size'))? document.getElementById('image_size').value : 'small',\r\n    catalog_native_size_changed: function(){site2[site.nickname].catalog_native_size = this.value;},\r\n    parse_funcs : { // lainchan\r\n      'catalog_html' : {\r\n        sticky: function(th){return false;}, // patch\r\n        ths: function(doc){\r\n          var ths = this.__proto__.ths(doc);\r\n          if (site2['lain'].all_boards.indexOf(site.board)!=-1)\r\n            for (var i=ths.length-1;i>=0;i--) ths[i].board = '/' + ths[i].pn.getAttribute('data-board') + '/';\r\n          for (var i=0;i<ths.length;i++) ths[i].page = Math.floor(i/10) + '.' + i%10;\r\n          return ths;\r\n        },\r\n      },\r\n      'page_html':{\r\n//        tn_as: function (th){\r\n//          var as = [];\r\n////          var files = th.pn.getElementsByClassName('op')[0].getElementsByClassName('file');\r\n//          var files = th.pn.getElementsByClassName('files')[0].getElementsByClassName('file');\r\n//          for (var i=0;i<files.length;i++) {\r\n//            var as_tmp = files[i].getElementsByTagName('a');\r\n//            if (as_tmp) for (var j=0;j<as_tmp.length;j++) if (as_tmp[j].getElementsByTagName('img')[0]) as[as.length] = as_tmp[j];\r\n//          }\r\n//          return as;\r\n//        },\r\n        ths: function(doc){\r\n//          var ths = site2['vichan'].parse_funcs.page_html.ths(doc);\r\n          var ths = this.__proto__.ths(doc);\r\n          if (site2['lain'].all_boards.indexOf(site.board)!=-1) {\r\n            for (var i=ths.length-1;i>=0;i--) {\r\n              var key = site.nickname + '/' + ths[i].pn.getAttribute('data-board') + '/' + ths[i].no;\r\n              if (cataLog.threads[key]) {ths.splice(i,1);continue;}\r\n              ths[i].board = '/' + ths[i].pn.getAttribute('data-board') + '/';\r\n            }\r\n//            for (var i=0;i<ths.length;i++) {\r\n////            for (var i=ths.length-1;i>=0;i--) {\r\n//              var prev = ths[i].pn.previousSibling;\r\n//              if (!prev || prev.tagName!=='H2') {ths.splice(i,ths.length-i);break;}\r\n////              if (!prev || prev.tagName!=='H2') {ths.splice(i,1);continue;}\r\n////              if (!prev || !prev.getElementsByTagName('a')[0]) {ths.splice(i,1);continue;}\r\n//              ths[i].board = prev.getElementsByTagName('a')[0].textContent;\r\n//              prev.classList.add(pref.script_prefix+'_hs');\r\n////              prev.setAttribute('style','display:none');\r\n////              ths[i].pn.insertBefore(prev,ths[i].pn.firstChild);\r\n//            }\r\n            if (ths.length===0) cataLog.show_catalog();\r\n          }\r\n          return ths;\r\n        },\r\n      },\r\n      'catalog_json' : {\r\n        time_unit: 1000,\r\n      },\r\n      'post_html' : {\r\n        img2src: function(img){\r\n          var src = img.parentNode.href;\r\n          if (src.search(/.webm/)!=-1) src = src.replace(/.*player.php\\?v=/,'').replace(/&t=.*/,'');\r\n//              https://lainchan.org/player.php?v=/test/src/1449566174628.webm&t=1449422283293.webm&loop=1\r\n          return src;\r\n        }\r\n      },\r\n\r\n    },\r\n    colorID: function(pn) {\r\n      var id = pn.getElementsByClassName('poster_id')[0];\r\n      if (id && id.style && !id.style.backgroundColor) {\r\n        site2['vichan'].colorID(pn);\r\n        var prev = id.previousSibling;\r\n        id.textContent = 'ID: '+id.textContent;\r\n        if (prev.textContent===' ID: ') prev.textContent = '';\r\n      }\r\n    },\r\n    catalog_json2html3_thumbnail: function(obj, board) {\r\n      return (obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://' + site2['lain'].domain_url + board + 'thumb/' + obj.tim + '.png' :\r\n             (obj.ext==='.pdf')? 'https://' + site2['lain'].domain_url + '/static/pdf.jpg' :\r\n             '';\r\n    },\r\n////////    catalog_json2html3 : function(obj,board,thumb_url) {\r\n////////      var th = document.createElement('div');\r\n////////      th.setAttribute('class','mix');\r\n////////      th.setAttribute('style','display: inline-block;');\r\n//////////      if (obj.ext==='.gif' || obj.ext==='.png') obj.ext='.jpg';\r\n////////      if (obj.ext==='.gif' || obj.ext==='.jpeg') obj.ext='.jpg';\r\n////////      th.innerHTML = '<div class=\"thread grid-li grid-size-' + this.catalog_native_size + '\">' +\r\n////////                     '<a href=\"' + thumb_url + '\">' +\r\n////////                       '<img src=\"' + thumb_url +\r\n////////                       '\" id=\"img-' + obj.no +\r\n////////                       '\" data-subject=\"' + obj.sub +\r\n////////                       '\" data-name=\"' + obj.name +\r\n////////                       '\" data-muhdifference=\"\" data-last-reply=\"\" data-last-subject=\"\" data-last-name=\"\" data-last-difference=\"\"' +\r\n////////                       'class=\"' + board + ' thread-image\" title=\"' + new Date(obj.last_modified*1000).toLocaleString() + ' '+obj.ext + '\"></a>' +\r\n////////                     '<div class=\"replies\"><strong>R: ' + (obj.nof_posts-1) +' / I: ' + obj.nof_files +\r\n//////////                     ((pref.catalog_footer_show_board_name)? ' '+board : '')\r\n////////                     '</strong>' + \r\n////////                     ((obj.sub)? '<p class=\"intro\"><span class=\"subject\">' + obj.sub + '</span></p>' : '<br>') +\r\n////////                     obj.com + '</div></div>';\r\n////////      return th;\r\n////////    },\r\n    catalog_from_json3 : function(obj,board) {\r\n      return site2[this.nickname].wrap_to_parse.get(obj, this.nickname, board, 'catalog_json');\r\n////      var parse_obj = {domain:this.nickname, board:board, parse_funcs:this.parse_funcs['catalog_json'], __proto__:site4.parse_funcs_on_demand};\r\n////      var ths = {obj:obj, __proto__:parse_obj};\r\n////      return ths.ths;\r\n    },\r\n    favicon : {\r\n      __proto__: site2['vichan'].favicon,\r\n      none: '/favicon.png',\r\n      reply: 'png;base64,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',\r\n      reply_to_me: 'png;base64,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'\r\n    },\r\n    proto : 'vichan'\r\n  };\r\n\r\n  if (!site2['futaba']) site2['futaba'] = {\r\n    nickname : 'futaba',\r\n    check_func : function(){\r\n      if (window.location.href.search(/2chan.net/)!=-1) { // futaba\r\n        site.config('2chan.net','futaba');\r\n        site.max_page = site2['futaba'].max_page_futaba[site.server_name + site.board];\r\n        return true;\r\n      } else return false;\r\n    },\r\n    max_page_futaba : {\r\n      'may/b/' : 11,\r\n      'jun/b/' : 10,\r\n      'dec/b/' : 8,\r\n    },\r\n    max_page : function(bn){return site2['futaba'].max_page_futaba[bn];},\r\n//    make_url : function(board,no){return ['http://'+site.server_name+'.2chan.net' + board + ((no==0)? 'futaba' : no) + '.htm', 'html'];},\r\n    make_url4 : function(dbt){return ['http://'+site.server_name+'.2chan.net' + dbt[1] + ((dbt[2]==0)? 'futaba' : dbt[2]) + '.htm', 'html'];},\r\n    get_ops : function(doc){\r\n      var ops = [];\r\n      var responds = doc.getElementsByClassName('hsbn');\r\n//      for (var i=0;i<responds.length;i++) ops.push(responds[i].href.substr(-13,9)); // doesn't work for sub-docment.\r\n//      for (var i=0;i<responds.length;i++) ops.push(responds[i].getAttribute('href').substr(-13,9)); // may\r\n      for (var i=0;i<responds.length;i++) ops.push(responds[i].getAttribute('href').replace(/res\\//,'').replace(/\\.htm/,''));\r\n      return ops;\r\n    },\r\n    get_posts : function(doc) {\r\n      var posts = [];\r\n      var inputs = doc.getElementsByTagName('input');\r\n      for (var i=0;i<inputs.length;i++) if (inputs[i].value=='delete') posts.push(inputs[i].name);\r\n      return posts;\r\n    },\r\n    format_thread : function(doc){return doc;},\r\n  };\r\n\r\n\r\n  for (var i in site2)\r\n    if ((i!=='DEFAULT' && i!=='common') && window.location.href.indexOf(site2[i].domain_url)!=-1)  // PATCH\r\n      if (site2[i].hasOwnProperty('pref_default')) pref_func.pref_overwrite(pref,site2[i].pref_default);\r\n\r\n  if (  localStorage &&   localStorage[pref.script_prefix+'.pref']) pref_func.pref_overwrite(pref,JSON.parse(  localStorage[pref.script_prefix+'.pref']),true);\r\n  for (var i in {catalog:null, page:null, float:null}) if (!pref[i].save_board_list_sel) pref[i].board_list_sel = 0;\r\n  if (sessionStorage && sessionStorage[pref.script_prefix+'.pref']) pref_func.pref_overwrite(pref,JSON.parse(sessionStorage[pref.script_prefix+'.pref']),true);\r\n  if (pref.pref2.KC.summer_time) site2['KC'].time_offset = 2;\r\n  pref_func.site2_json(false,false,true);\r\n\r\n//if (pref.test_mode['18']) { // leak test about 8chan catalog in 4chan.\r\n//  delete site2['8chan'].parse_funcs['catalog_html'].th_init;\r\n//  delete site2['8chan'].parse_funcs['catalog_html'].th_destroy;\r\n//}\r\n\r\n//  for (var i in site2) {\r\n//    if (i=='DEFAULT') continue;\r\n//    for (var j in site2['DEFAULT'])\r\n//      if (site2[i][j]===undefined) site2[i][j]=site2['DEFAULT'][j];\r\n//  }\r\n  for (var i in site2) {\r\n    for (var j in site2[i].parse_funcs) {\r\n      if (typeof(site2[i].parse_funcs[j])==='string') {\r\n        var tgt = site2[i].parse_funcs[j];\r\n        site2[i].parse_funcs[j] = site2[i].parse_funcs[tgt];\r\n        continue;\r\n      }\r\n      for (var k in site2[i].parse_funcs[j]) { // working code.\r\n        if (k!=='proto' && typeof(Object.getOwnPropertyDescriptor(site2[i].parse_funcs[j],k).value)==='string') { // skip getter.\r\n//        if (k!=='proto' && typeof(site2[i].parse_funcs[j][k])==='string') {\r\n          tgt = site2[i].parse_funcs[j][k].split('.');\r\n////          if (tgt.length>1) site2[i].parse_funcs[j][k] = (tgt.length===3)? site2[tgt[0]].parse_funcs[tgt[1]][tgt[2]] : // working code.\r\n////                                                                           site2[i].parse_funcs[tgt[0]][tgt[1]];\r\n          var tgt_obj = (tgt.length===3)? site2[tgt[0]].parse_funcs[tgt[1]][tgt[2]] : // vichan.catalog_json.XXX\r\n                        (tgt.length===2 && site2[i].parse_funcs[tgt[0]] && site2[i].parse_funcs[tgt[0]][tgt[1]])? site2[i].parse_funcs[tgt[0]][tgt[1]] : // catalog_json.XXX\r\n                        (tgt.length===2 && site2[tgt[0]] && site2[tgt[0]].parse_funcs[tgt[1]] && site2[tgt[0]].parse_funcs[tgt[1]][k])? site2[tgt[0]].parse_funcs[tgt[1]][k] : // vichan.catalog_json\r\n                        (tgt.length===1)? site2[i].parse_funcs[tgt[0]] && site2[i].parse_funcs[tgt[0]][k] : // catalog_json\r\n                        null;\r\n          if (tgt_obj) site2[i].parse_funcs[j][k] = tgt_obj;\r\n        }\r\n      }\r\n////      if (i!=='DEFAULT' || j!=='common') { // working code.\r\n////        var proto = (site2[i].parse_funcs[j].hasOwnProperty('proto'))? site2[i].parse_funcs[j].proto : (site2['DEFAULT'].parse_funcs[j] && i!=='DEFAULT')? 'DEFAULT.'+j : 'DEFAULT.common';\r\n//////        if (pref.debug_mode['0']) site2[i].parse_funcs[j].proto = proto; // debug\r\n////        proto = (proto.indexOf('.')==-1)? site2[i].parse_funcs[proto] : site2[proto.substr(0,proto.indexOf('.'))].parse_funcs[proto.substr(proto.indexOf('.')+1)];\r\n////        site2[i].parse_funcs[j].__proto__ = proto;\r\n//////        if (!pref.debug_mode['0']) delete site2[i].parse_funcs[j].proto;\r\n////        delete site2[i].parse_funcs[j].proto;\r\n////      }\r\n      if (i!=='DEFAULT' || j!=='common') {\r\n        var proto = (site2[i].parse_funcs[j].hasOwnProperty('proto'))? site2[i].parse_funcs[j].proto :\r\n                    (site2[i].hasOwnProperty('proto') && i!=='DEFAULT')? site2[i].proto + '.' + j :\r\n                    (site2['DEFAULT'].parse_funcs[j] && i!=='DEFAULT')? 'DEFAULT.'+j : 'DEFAULT.common';\r\n//        var proto2= (site2[i].parse_funcs[j].hasOwnProperty('proto'))? site2[i].parse_funcs[j].proto : // old\r\n//                    (site2['DEFAULT'].parse_funcs[j] && i!=='DEFAULT')? 'DEFAULT.'+j : 'DEFAULT.common';\r\n//if (proto!==proto2) console.log(i+':'+j+', '+proto+', '+proto2+', '+(proto===proto2));\r\n        proto = (j.substr(-9,9)==='_template' && proto==='DEFAULT.common')? site2['DEFAULT'].wrap_to_parse.get_getters() :\r\n                (proto.indexOf('.')==-1)? site2[i].parse_funcs[proto] : site2[proto.substr(0,proto.indexOf('.'))].parse_funcs[proto.substr(proto.indexOf('.')+1)];\r\n//        if (proto!==null) proto = (proto.indexOf('.')==-1)? site2[i].parse_funcs[proto] : site2[proto.substr(0,proto.indexOf('.'))].parse_funcs[proto.substr(proto.indexOf('.')+1)];\r\n        site2[i].parse_funcs[j].__proto__ = proto;\r\n        delete site2[i].parse_funcs[j].proto;\r\n      }\r\n    }\r\n    if (i!=='DEFAULT') {\r\n      proto = (site2[i].hasOwnProperty('proto'))? site2[i].proto : 'DEFAULT';\r\n//      if (pref.debug_mode['0']) site2[i].proto = proto; // debug\r\n      if (site2[i].parse_funcs) site2[i].parse_funcs.__proto__ = site2[proto].parse_funcs;\r\n      if (site2[i].patch) site2[i].patch.__proto__ = site2[proto].patch;\r\n      site2[i].__proto__ = site2[proto];\r\n//      if (!pref.debug_mode['0']) delete site2[i].proto;\r\n      delete site2[i].proto;\r\n    }\r\n  }\r\n//  for (var i in site2) {\r\n//    if (i==='DEFAULT' || i==='common') continue;\r\n//    if (!site2[i].hasOwnProperty('prep_own_posts_event')) {\r\n//      site2[i].prep_own_posts_event = site2[i].prep_own_posts_event.bind(site2[i]); // DOESN'T WORK, WHY??? MAY THIS BE CHROME'S BUG??? but I found a better solution.\r\n//console.log('DEBUG: '+i);\r\n//    }\r\n//  }\r\n//    site2['lain'].prep_own_posts_event = site2['lain'].prep_own_posts_event.bind(site2['lain']); // works correctly.\r\n//    site2['KC'].prep_own_posts_event = site2['KC'].prep_own_posts_event.bind(site2['KC']);\r\n\r\n//if (pref.debug_mode['0']) console.log(common_func.debug_show_proto('8chan:catalog_html',site2['8chan'].parse_funcs['catalog_html'])); // debug\r\n//if (pref.debug_mode['0']) console.log(common_func.debug_show_proto('8chan:page_html',site2['8chan'].parse_funcs['page_html'])); // debug\r\n//console.log(common_func.debug_show_proto('8chan_live:thread_html',site2['8chan_live'].parse_funcs['thread_html'])); // debug\r\n//console.log(common_func.debug_show_proto('8chan:page_html',site2['8chan'].parse_funcs['page_html'])); // debug\r\n//console.log(common_func.debug_show_proto('4chan:thread_html',site2['4chan'].parse_funcs['thread_html'])); // debug\r\n\r\n//  for (var i in site2) if (i!=='DEFAULT' && i!=='common') {\r\n//    var proto = site2[i].hasOwnProperty('proto')? site2[i].proto : false;\r\n//    site2[i].__proto__ = (proto)? site2[proto] : site2['DEFAULT'];\r\n//    if (proto) delete site2[i].proto;\r\n//    for (var j in site2[i].parse_funcs) {\r\n//      proto = site2[i].parse_funcs[j].hasOwnProperty('proto')? site2[i].parse_funcs[j].proto : false;\r\n//      if (proto) proto = (proto.indexOf('.')==-1)? site2[i].parse_funcs[proto] : site2[proto.substr(0,proto.indexOf('.'))].parse_funcs[proto.substr(proto.indexOf('.')+1)];\r\n//      site2[i].parse_funcs[j].__proto__ = (proto)? proto\r\n//                                        : (site4.parse_funcs[j])? site4.parse_funcs[j] : site4.parse_funcs.common;\r\n//      if (proto) delete site2[i].parse_funcs[j].proto;\r\n//    }\r\n//  }\r\n//  for (var i in site4.parse_funcs) if (i!=='common') site4.parse_funcs[i].__proto__ = site4.parse_funcs.common;\r\n\r\n//  if (  localStorage &&   localStorage[pref.script_prefix+'.pref']) pref_func.pref_overwrite(pref,JSON.parse(  localStorage[pref.script_prefix+'.pref']),true);\r\n//  if (sessionStorage && sessionStorage.pref) pref_func.pref_overwrite(pref,JSON.parse(sessionStorage.pref),true);\r\n//  pref_func.site2_json();\r\n\r\n\r\n  var site3 = {};\r\n  for (var i in site2) if (i!=='DEFAULT' && i!=='common' && i!=='meguca1') {\r\n    site3[i] = {boards: null, tags: {cs:[], ci:[]}, own_posts:{}};\r\n    if (site2[i].hasOwnProperty('check_func')) {\r\n      site2[i].check_func();\r\n      delete site2[i].check_func; // reduce memory consumption.\r\n    }\r\n    site.nicknames.push(i);\r\n  }\r\n  if (!site.embed_to['top']) site.embed_to['top'] = site.root_body && site.root_body.firstChild;\r\n  if (!site.embed_to['bottom']) site.embed_to['bottom'] = site.root_body && site.root_body.lastChild;\r\n  \r\n  pref_func.site2_json(false,true,false);\r\n  if (window.top != window.self) {\r\n    if (site.nicknames.indexOf(window.name)==-1 && window.name!==site.embed_frame) return; //don't run on frames or iframes\r\n    for (var i in site2) if (site.nicknames.indexOf(i)!=-1 && i!=site.nickname) delete site2[i];\r\n  }\r\n\r\n  if (window.opener) {\r\n    if (site.nicknames.indexOf(window.name)!=-1) {\r\n      for (var i in site.features) site.features[i] = false;\r\n      for (var i in pref.features) pref.features[i] = false;\r\n      brwsr.sw_cache = null;\r\n      pref.cloudflare.auto_reload = false;\r\n    }\r\n  }\r\n\r\n  var pipe_name = pref.script_prefix + '.graph.' + site.board + '__pipe__';\r\n  var info_raw  = site.nickname + site.board;\r\n\r\n  if (!window.SharedWorker) {\r\n    pref.info_server = false;\r\n    pref.info_client = false;\r\n  }\r\n//  pref_func.str2obj('catalog_board_list_str');\r\n//  pref_func.str2obj2(pref.catalog,'style_general_list_obj2',pref.catalog.style_general_list_str);\r\n//  pref_func.str2obj2(pref.catalog.board,'ex_list_obj2',pref.catalog.board.ex_list_str);\r\n  pref_func.obj_init();\r\n  pref3.stats.use = pref.stats.use;\r\n  pref3.stats.estimate_posts = pref.stats.estimate_posts;\r\n\r\n  var notifier = (function(){\r\n    var sound = (pref.features.notify.sound)? (function(){\r\n      var audio;\r\n      function make_beep(){\r\n        var wav_str;\r\n        if (pref.notify.sound.notify) {\r\n          wav_str = [];\r\n          var dl = header_prep_monaural8(pref.notify.sound.beep_length_f);\r\n          data_prep_monaural8(pref.notify.sound.beep_freq,dl,pref.notify.sound.beep_volume_f);\r\n          for (var i=0;i<wav_str.length;i++) if (wav_str[i].length==1) wav_str[i] = '0'+wav_str[i];\r\n          audio = new Audio('data:audio/wav,%'+wav_str.join('%'));\r\n        } else audio = null;\r\n\r\n        function header_prep_monaural8(period) {\r\n          var dl=Math.floor(period*44100);\r\n          var header_size=46;\r\n          header_add(0x52494646,4,1);     //riff\r\n          header_add(dl+header_size,4,0); //size\r\n          header_add(0x57415645,4,1);     //WAVE\r\n          header_add(0x666d7420,4,1);     //fmt\r\n          header_add(0x12,4,0);           //size of fmt\r\n          header_add(0x01,2,0);           //linearPCM\r\n          header_add(0x01,2,0);           //Stereo\r\n          header_add(44100,4,0);          //44.1kHz\r\n          header_add(44100,4,0);          //176400 bit/sec\r\n          header_add(1,2,0);              //block size, 4Byte\r\n          header_add(8,2,0);              //bit/sample\r\n          header_add(0,2,0);              //size of ext\r\n    //      header_add(0x66616374,4,1);     //fact\r\n    //      header_add(4,4,0);              //size of fact\r\n    //      header_add(0xdbcd5a00,4,1);     //data of fact\r\n          header_add(0x64617461,4,1);     //data\r\n          header_add(dl,4,0);             //size of data\r\n          return dl;\r\n  \r\n          function header_add(val,num,big_endian) {\r\n            if (big_endian==1) for (var i=0;i<num;i++) wav_str.push('');\r\n            for (var i=0;i<num;i++) {\r\n              if (big_endian==1) wav_str[wav_str.length-1-i] = (val%0x100).toString(16);\r\n              else wav_str.push((val%0x100).toString(16));\r\n              val = Math.floor(val/0x100);\r\n            }\r\n          }\r\n        }\r\n        function data_prep_monaural8(freq,period,vol){\r\n          var pi2 = 3.141592654*2;\r\n          vol *=127;\r\n          for (var i=0;i<period;i++) {\r\n            var val = Math.floor(Math.sin(pi2*freq*i/44100)*vol+0x80)%0x100;\r\n            wav_str.push(val.toString(16));\r\n          }\r\n        }\r\n      }\r\n      make_beep();\r\n\r\n      function make_beep_play(){\r\n        make_beep();\r\n        if (pref.notify.sound.notify && pref.notify.sound.src==='beep') audio.play();\r\n      }\r\n      function src_changed(){\r\n        if (audio) audio.pause();\r\n        if (this.name==='notify.sound.file') pref.notify.sound.src='file';\r\n        if (pref.notify.sound.src==='beep') make_beep();\r\n        else {\r\n          var file = pref_func.settings.pn13.getElementsByTagName('input')['notify.sound.file'].files[0];\r\n          if (file) audio = new Audio(URL.createObjectURL(file));\r\n        }\r\n        pref_func.settings.apply_pn13_1();\r\n        if (pref.notify.sound.notify) audio.play();\r\n      }\r\n      pref_func.settings.onchange_funcs['notify.sound.beep_length_f'] = make_beep_play;\r\n      pref_func.settings.onchange_funcs['notify.sound.beep_volume_f'] = make_beep_play;\r\n      pref_func.settings.onchange_funcs['notify.sound.beep_freq'    ] = make_beep_play;\r\n      pref_func.settings.onchange_funcs['notify.sound.beep_freq'    ] = make_beep_play;\r\n      pref_func.settings.onchange_funcs['notify.sound.pause'        ] = function(){audio.pause();};\r\n      pref_func.settings.onchange_funcs['notify.sound.notify'       ] = make_beep;\r\n      pref_func.settings.onchange_funcs['notify.sound.file'         ] = src_changed;\r\n      pref_func.settings.onchange_funcs['notify.sound.src'          ] = src_changed;\r\n\r\n      return {\r\n        play : function(){audio.play();},\r\n      }\r\n    })() : {play:function(){}};\r\n\r\n    var favicon = (pref.features.notify.favicon)? (function(){\r\n      var favicon = site2[site.nickname].favicon.get_favicon();\r\n      var title = site2[site.nickname].favicon.get_title();\r\n      var title_org = title.innerHTML;\r\n      var favicon_current;\r\n      var title_current;\r\n      function favicon_set(favicon_next){\r\n        if (favicon_current!==favicon_next) {\r\n          var str = site2[site.nickname].favicon[favicon_next];\r\n          if (str[0]!=='/') str = 'data:image/'+str;\r\n          favicon.setAttribute('href',str);\r\n          favicon_current = favicon_next;\r\n        }\r\n      }\r\n//      function favicon_set(str){ // working code.\r\n//        if (!favicon) favicon = site2[site.nickname].favicon.get_favicon();\r\n//        if (str[0]!=='/') str = 'data:image/'+str;\r\n//        favicon.setAttribute('href',str);\r\n//      }\r\n\r\n      function set(){\r\n        var sum = new liveTag.CountNR();\r\n        if (pref.liveTag.watch_all) {\r\n          for (var d in liveTag.mems) {\r\n            for (var b in liveTag.mems[d]) {\r\n              if (liveTag.mems[d][b].nr<0) {\r\n                var sum_sub = new liveTag.CountNR();\r\n                for (var t in liveTag.mems[d][b]) sum_sub.count(liveTag.mems[d][b][t][2]);\r\n                liveTag.mems[d][b].nrtm = sum_sub.nrtm;\r\n                liveTag.mems[d][b].nr   = sum_sub.nr;\r\n              }\r\n//              sum.count([0x000c0000, (liveTag.mems[d][b].nrtm<<16) + liveTag.mems[d][b].nr]); // BUG, nr overflowed in 4chan.\r\n              sum.nrtm += liveTag.mems[d][b].nrtm;\r\n              sum.nr   += liveTag.mems[d][b].nr;\r\n        }}} else {\r\n          var threads = cataLog.threads;\r\n          if (threads) for (var name in threads) sum.count(threads[name][19]);\r\n        }\r\n        if (pref.notify.favicon) {\r\n          var favicon_next = (sum.nrtm!=0)? 'reply_to_me' :\r\n                             (sum.nr!=0)?   'reply' :\r\n                             'none';\r\n          favicon_set(favicon_next);\r\n        }\r\n        if (pref.notify.title.notify) {\r\n          if (sum.nr!=0 || !pref.notify.title.hide_zero) title_set(((pref.catalog_footer_show_nof_rep_to_me)? sum.nrtm + '/' + sum.nr : '('+sum.nr+')') + ' - ');\r\n          else title_set('');\r\n        }\r\n      }\r\n      function title_set(str){\r\n        if (title_current!==str) {\r\n          title.innerHTML = str + title_org;\r\n          title_current = str;\r\n        }\r\n      }\r\n      return {\r\n        set : new DelayBuffer(set, 200).get_binded_delayed_do(),\r\n      } \r\n    })() : {set:function(){}};\r\n\r\n    var desktop = (Notification && pref.features.notify.desktop)? (function(){\r\n      function get_permission(){\r\n        if (Notification.permission !== 'granted') {\r\n          Notification.requestPermission(function (status) {\r\n            if (Notification.permission !== status) {\r\n              Notification.permission = status;\r\n            }\r\n          });\r\n        }\r\n        return Notification.permission==='granted';\r\n      }\r\n      get_permission();\r\n\r\n//      var dtns = {};\r\n      var dtns = [];\r\n      var dtns_queue = [];\r\n      function show(th,obj,num){\r\n        if (dtns.length + dtns_queue.length < pref.notify.desktop.limit)\r\n          if (Notification.permission === 'granted' || get_permission()) show_1(th,obj,num);\r\n      }\r\n//      function show(name,obj,num){ // working code.\r\n//        if (dtns.length>pref.notify.desktop.limit) return;\r\n//        if (Notification.permission === 'granted') show_1(name,obj,num);\r\n//        else if (Notification && Notification.permission !== 'denied') {\r\n//          Notification.requestPermission(function (status) {\r\n//            if (Notification.permission !== status) {\r\n//              Notification.permission = status;\r\n//            }\r\n//            if (status === 'granted') show_1(name,obj,num);\r\n//          })\r\n//        }\r\n//      }\r\n      var pn = document.createElement('div');\r\n      function show_1(th,objs,num){\r\n        var obj = (num>=0)? objs[num] : objs;\r\n        obj = {icon: obj.op_img_url,\r\n               body: obj.com || '',\r\n               __proto__: obj};\r\n        if (obj.reply_of_mine && pref.catalog_footer_ignore_my_own_posts) return;\r\n        obj.title = ( // (obj.appear_thread)? 'Appear thread ' :\r\n                     (obj.new_thread)? 'New Thread ' :\r\n                     (obj.reply_to_me && pref.notify.desktop.reply_to_me)? '(You) in ' :\r\n                      '') + (th.sub || th.key);\r\n//        if (obj.tag) obj.tag = 'CatChan/' + obj.tag;\r\n        obj.tag = pref.script_prefix+'/' + th.key + ', '+(objs.length-num-1);\r\n        pn.innerHTML = obj.body;\r\n//        var dtn = new Notification(obj.title,{tag:obj.tag, body:pn[brwsr.innerText], icon:obj.icon});\r\n//        var dtn = new Notification(obj.title,{tag:obj.tag, body:pn[brwsr.innerText].trim(), icon:obj.icon}); // trim for KC\r\n        obj.body = pn[brwsr.innerText].trim(); // trim for KC\r\n        if (pref.notify.desktop.delay===0) show_1_queued(obj);\r\n        else {\r\n          dtns_queue[dtns_queue.length] = obj;\r\n          show_1_queued_delayed(); // FF denies multiple notifications at a time.\r\n        }\r\n      }\r\n      var show_1_queued_delayed = new DelayBuffer(show_1_queued, 200).get_binded_delayed_do();\r\n      function show_1_queued(obj) {\r\n        if (!obj) obj = dtns_queue.shift();\r\n        var dtn = new Notification(obj.title, obj); // trim for KC\r\n        dtn.onclick = win_focus;\r\n//        dtn.onclose = close_1;\r\n        var id = (pref.notify.desktop.lifetime!=0)? setTimeout(close_1, pref.notify.desktop.lifetime*1000) : null;\r\n        dtns[dtns.length] = [dtn, id];\r\n//console.log(dtns.length);\r\n//        dtns[obj.tag] = dtn;\r\n//        if (pref.notify.desktop.lifetime!=0) setTimeout(function(){dtn.close();delete dtns[obj.tag];},pref.notify.desktop.lifetime*1000); // can't call this in setTimeout without 'use strict'\r\n        if (dtns_queue.length>0) show_1_queued_delayed();\r\n      }\r\n      function close_1(){dtns.shift()[0].close();}\r\n      function win_focus(){window.focus();for (var i=dtns.length-1;i>=0;i--) if (dtns[i][0]===this || i==0) {if (dtns[i][1]) clearTimeout(dtns[i][1]);dtns.splice(i,1);break;}}\r\n      function close_all(){while (dtns.length>0) {if (dtns[0][1]) clearTimeout(dtns[0][1]);close_1();}}\r\n//      function win_focus(){window.focus();clearTimeout(dtns.shift()[1]);};\r\n//      function close_all(){while (dtns.length>0) close_1();}\r\n////      function win_focus(){window.focus()};\r\n////      function close_all(){\r\n////        for (var i in dtns) dtns[i].close();\r\n////      }\r\n      window.addEventListener('beforeunload', close_all, false);\r\n      return {\r\n        show : show,\r\n      }\r\n    })() : {show:function(){}};\r\n    return {\r\n      sound:   sound,\r\n      favicon: favicon,\r\n      desktop: desktop,\r\n      changed: function(th, tgt_th19_4){\r\n        if (pref.notify.favicon || pref.notify.title.notify) favicon.set();\r\n//        if (!threads[name][19][5] && tgt_th19_4 && tgt_th19_4.length!=0) { // I think that tgt_th19_4 is redundant, but error occured, so patched.\r\n          var sound_flag = false;\r\n          var dt = (pref.notify.desktop.show_last)? 0 : tgt_th19_4.length-1;\r\n          for (var i=tgt_th19_4.length-1;i>=0;i--) {\r\n            if (pref.notify.sound.reply || (pref.notify.sound.reply_to_me && tgt_th19_4[i].reply_to_me)) sound_flag = true;\r\n            if (i<=dt && pref.notify.desktop.notify)\r\n              if (pref.notify.desktop.reply || (pref.notify.desktop.reply_to_me && tgt_th19_4[i].reply_to_me)) desktop.show(th,tgt_th19_4,i, true);\r\n          }\r\n          if (pref.notify.sound.notify && sound_flag) notifier.sound.play();\r\n//        }\r\n//console.log(tgt_th19_4.length);\r\n      },\r\n////      changed: function(name,threads){\r\n////        if (pref.notify.favicon) favicon.set(threads);\r\n////        var sound_flag = false;\r\n//////threads[name][19][5] = false; // for debug.\r\n////        if (!threads[name][19][5] && threads[name][19][4] && threads[name][19][4].length!=0) { // I think that threads[name][19][4] is redundant, but error occured, so patched.\r\n////          if (pref.notify.desktop.notify) {\r\n////            var i = (pref.notify.desktop.show_last)? 0 : threads[name][19][4].length-1;\r\n////            while (i>=0) {\r\n////              if (i==0 || !pref.notify.desktop.show_last)\r\n////                if (pref.notify.desktop.reply || (pref.notify.desktop.reply_to_me && threads[name][19][4][i].to_me)) desktop.show(name,threads[name][19][4],i);\r\n////              i--;\r\n////            }\r\n////          }\r\n////          for (var i=0;i<threads[name][19][4].length;i++) if (pref.notify.sound.reply || (pref.notify.sound.reply_to_me && threads[name][19][4][i].to_me)) sound_flag = true;\r\n////        }\r\n////        if (pref.notify.sound.notify && sound_flag) notifier.sound.play();\r\n//////console.log(threads[name][19][4].length);\r\n////      },\r\n////      appeared: function(names,threads){ // working code.\r\n//////        if (pref.notify.sound.notify) notifier.sound.play();\r\n////        if (pref.notify.favicon || pref.notify.title.notify) favicon.set(threads);\r\n////        var sound_flag = false;\r\n////        for (var i=0;i<names.length;i++) {\r\n////          var name = names[i];\r\n//////          if (threads[name][19][0]<0) { // 'changed' shall not be issued.\r\n//////            if (pref.notify.desktop.new_thread && threads[name][19][8]) desktop.show(name,[{new_thread:true, body:threads[name][0].innerHTML}],0);\r\n////            var dbt = common_func.name2domainboardthread(name,true);\r\n//////            if (pref.notify.desktop.notify && (pref.notify.desktop.appear || (pref.notify.desktop.new_thread && threads[name][19][8])))\r\n////            if (pref.notify.desktop.notify &&   ((pref.notify.desktop.appear && !(threads[name][19][0]!==0 && (pref.notify.desktop.reply || pref.notify.desktop.reply_to_me)))\r\n////                                              || (pref.notify.desktop.new_thread && threads[name][19][8])))\r\n//////              desktop.show(name,[{new_thread:threads[name][19][8], body:threads[name][0].innerHTML, icon:site2[dbt[0]].get_op_image_url(threads[name][0],threads[name][18])}],0);\r\n////              desktop.show(name,{new_thread:threads[name][19][8], body:threads[name][0].innerHTML, icon:threads[name][26]},-1);\r\n////            if (pref.notify.sound.appear || (pref.notify.sound.new_thread && threads[name][19][8])) sound_flag = true;\r\n////        }\r\n////        if (pref.notify.sound.notify && sound_flag) notifier.sound.play();\r\n////      }\r\n      appeared: function(th, new_thread){\r\n        var threads = cataLog.threads;\r\n        if (pref.notify.favicon || pref.notify.title.notify) favicon.set(threads);\r\n        var watch = liveTag.mems[th.domain][th.board][th.no][2];\r\n        if (pref.notify.desktop.notify && ((pref.notify.desktop.appear && !(watch[0]!==0 && (pref.notify.desktop.reply || pref.notify.desktop.reply_to_me)))\r\n                                            || (pref.notify.desktop.new_thread && new_thread)))\r\n          desktop.show(th,{new_thread:new_thread, __proto__:th},-1);\r\n        if (pref.notify.sound.notify && (pref.notify.sound.appear || (pref.notify.sound.new_thread && new_therad))) notifier.sound.play();\r\n      }\r\n    }\r\n  })();\r\n\r\n  var ports = {};\r\n  var messages_to_send = {};\r\n  var init_func = {};\r\n  var receive_func = {};\r\n  function make_port_parent(name,win){\r\n    if (ports[name]) send_message(name,[['CLOSE']]);\r\n    ports[name] = 'init';\r\n    init_func[name] = function(e){initialize(e,name,win);};\r\n    window.addEventListener('message', init_func[name], false);\r\n    if (pref.debug_mode['0']) console.log(window.name + ': Waiting for connection from '+name+' ...');\r\n    function initialize(e,name,win) {\r\n      if (pref.debug_mode['0']) console.log(window.name + ': Connecting from '+e.data);\r\n//      if (e.source==win) {\r\n//      if (e.source==win && site2[e.data]) { // remove \"{\"name\":\"twttr:private:requestArticleUrl\"}\" from someone...\r\n//      if (e.source==win && site.nicknames.indexOf(e.data)!=-1) { // remove \"{\"name\":\"twttr:private:requestArticleUrl\"}\" from someone... in Tampermonkey. // BUG.\r\n//      if (e.source==win && new RegExp(site.nicknames.join('|')).test(e.data)) { // remove \"{\"name\":\"twttr:private:requestArticleUrl\"}\" from someone... in Tampermonkey.\r\n      if ((e.source==win && new RegExp(site.nicknames.join('|')).test(e.data)) ||\r\n          (e.source==site.embed_frame_win && site.whereami==='frame' && e.data.indexOf('CLOSE')==-1)) { // remove \"{\"name\":\"twttr:private:requestArticleUrl\"}\" from someone... in Tampermonkey.\r\n        if (pref.debug_mode['0']) console.log(window.name + ': Connected successfully.');\r\n        if (!brwsr.ff) init_receive_port(name,e.ports[0]);\r\n        else init_receive_port(name,win);\r\n        window.removeEventListener('message', init_func[name], false);\r\n        delete init_func[name];\r\n        send_message(name,messages_to_send[name]);\r\n        delete messages_to_send[name];\r\n        if (name=='_blank') send_message(name,[['CLOSE']]);\r\n      } else if (pref.debug_mode['0']) console.log(window.name + ': FAIL.');\r\n    }\r\n  }\r\n  function make_port_child(parent){\r\n    if (pref.debug_mode['0']) console.log(window.name + ': Try to connect to parent...');\r\n    if (!brwsr.ff) {\r\n      var channel = new MessageChannel();\r\n      init_receive_port('parent',channel.port1);\r\n      parent.postMessage(window.name, [channel.port2], '*');\r\n    } else { // FF doesn't support channel messaging.\r\n      init_receive_port('parent',parent);\r\n      parent.postMessage(window.name, '*');\r\n    }\r\n  }\r\n  function init_receive_port(name,port){\r\n    ports[name] = port;\r\n    receive_func[name] = function(e){receive_message(e,name);};\r\n    if (!brwsr.ff) {\r\n      port.addEventListener('message', receive_func[name], false);\r\n      port.start();\r\n    } else window.onmessage = receive_func[name];\r\n  }\r\n  function close_connection(name){\r\n    if (!brwsr.ff) ports[name].close();\r\n    ports[name].removeEventListener('message', receive_func[name], false);\r\n    delete receive_func[name];\r\n    delete ports[name];\r\n  }\r\n  function send_message(name,val,win){\r\n//    if (!ports[name]) make_port_parent(name,win);\r\n    if (win) make_port_parent(name,win);\r\n    if (ports[name]==='init') { // chrome works at ==.\r\n      if (!messages_to_send[name]) messages_to_send[name] = [];\r\n      for (var i=0;i<val.length;i++) messages_to_send[name].push(val[i]);\r\n    } else {\r\n      for (var i=0;i<val.length;i++) {\r\n        if (pref.debug_mode['0']) console.log(window.name + ': Sent to '+name+': '+val[i].toString().substr(0,80));\r\n        if (!brwsr.ff) ports[name].postMessage(JSON.stringify(val[i]));\r\n        else ports[name].postMessage(JSON.stringify(val[i]),'*');\r\n        if (val[i][0]=='CLOSE') {close_connection(name);break;}\r\n      }\r\n    }\r\n  }\r\n  function receive_message(e,name) {\r\n    if (pref.debug_mode['0']) console.log(window.name + ': Received from '+name+': '+e.data.toString().substr(0,80));\r\n    var val = JSON.parse(e.data);\r\n    if (typeof(val)=='string') val=JSON.parse(val); // patch for GM.\r\n    if (val[0]=='CLOSE') close_connection(name);\r\n    else if (val[0]=='MARK' && val[1]>0) {\r\n      var marked_first_post = (common_obj.thread_reader && pref.test_mode['16'])? common_obj.thread_reader.mark_newer_posts(val[1])\r\n                                                        : site2[site.nickname].mark_newer_posts(document,val[1],pref.catalog.unmark_on_hover);\r\n      if (marked_first_post) scrollTo(0,marked_first_post.offsetTop - site.header_height());\r\n      else scrollTo(0,document.body.clientHeight - window.innerHeight);\r\n      if (common_obj.thread_reader) common_obj.thread_reader.mark_posts_from_parent(val[1]);\r\n    } else if (val[0]=='SUBFRAME_INIT') http_req.remote();\r\n    else if (val[0]=='SUB_GET') http_req.sub_get(val[1]);\r\n    else if (val[0]=='SUB_ACK') http_req.sub_ack(val[1]);\r\n    else if (val[0]=='SUB_DEST') http_req.sub_dest(val[1]);\r\n    else if (val[0]=='OWN_POSTS') {\r\n      if (site2[val[1]].prep_own_posts_event_received) site2[val[1]].prep_own_posts_event_received(val[2]);\r\n      else site3[val[1]].own_posts = val[2];\r\n    } else if (val[0]=='TRIAGE') {\r\n//console.log('receive: TRIAGE, '+val[1]+', '+val[2]+', '+val[3]);\r\n//      if (catalog_obj && catalog_obj.catalog_func()!=null) catalog_obj.catalog_func().triage_exe_0(val[1],val[2],'',true,val[3]);\r\n      if (catalog_obj && catalog_obj.catalog_func()!=null) catalog_obj.catalog_func().triage_exe_pipe(val[1]);\r\n    }\r\nelse if (pref.test_mode['34'] && val[0]==='ECHO') setTimeout(function(){send_message(window.name? 'parent' : 'meguca',[['ECHO',val[1]]])},5000);\r\n  }\r\n//  function receive_message(e,name) { // working code for old http_req\r\n//    if (pref.debug_mode['0']) console.log(window.name + ': Received from '+name+': '+e.data.toString().substr(0,80));\r\n//    var val = JSON.parse(e.data);\r\n//    if (typeof(val)=='string') val=JSON.parse(val); // patch for GM.\r\n//    if (val[0]=='CLOSE') close_connection(name);\r\n//    else if (val[0]=='MARK' && val[1]>=0) {\r\n//      var offset_top = site2[site.nickname].mark_newer_posts(document,val[1]);\r\n//      scrollTo(0,offset_top);\r\n//    } else if (val[0]=='SUBFRAME_INIT') {\r\n//      http_req.remote();\r\n//    } else if (val[0]=='SUB_GET') {\r\n//      http_req.get(val[1][0],val[1][1],val[1][2],val[1][3],val[1][4],val[1][5],val[1][6]);\r\n//    } else if (val[0]=='SUB_ACK') {\r\n//      iframes[name][1]--;\r\n//      http_req.onload_local(val[1],val[2]);\r\n//    }\r\n//  }\r\n  function close_all(){\r\n    for (var name in ports) send_message(name,[['CLOSE']]);\r\n  }\r\n  window.addEventListener('beforeunload', close_all, false);\r\n  if (window.opener) {\r\n//console.log('child');\r\n    make_port_child(window.opener);\r\n////    for (var i in site2) // moved to before.\r\n////      if (site2[i].nickname===window.name) {\r\n////        for (var i in site.features) site.features[i] = false;\r\n////        brwsr.sw_cache = null;\r\n////        pref.cloudflare.auto_reload = false;\r\n////        break;\r\n////      }\r\n    if (site2[window.name] && site2[window.name].prep_own_posts_event) {\r\n      window.addEventListener('storage', site2[window.name].prep_own_posts_event, false);\r\n      site2[window.name].prep_own_posts();\r\n      site2[window.name].prep_own_posts_event();\r\n    }\r\n  }\r\n  if (pref.cloudflare.auto_reload) {\r\n    var cf_error = document.getElementsByClassName('cf-error-code');\r\n    if (cf_error.length>0 && parseInt(cf_error[0].textContent,10)>=500) setTimeout(function(){location.reload();},pref.cloudflare.auto_reload_time*60000);\r\n  }\r\n\r\n//  var ports = {}; // working code for test\r\n//  function make_port_parent(name, val){\r\n//    ports[name] = val;\r\n//    var port;\r\n//    if (pref.debug_mode['0']) console.log('parent: '+name+', '+val);\r\n//    window.onmessage = function(e) {\r\n//      if (pref.debug_mode['0']) console.log('from child #unkown: '+e.data);\r\n//      port = e.ports[0];\r\n//      port.postMessage(JSON.stringify(['MARK',val]));\r\n//      port.postMessage(JSON.stringify('CLOSE'));\r\n//      port.close();\r\n////      port.onmessage = function(e) {\r\n////        if (pref.debug_mode['0']) console.log(e.data);\r\n////        port.postMessage('received : ('+Date.now()+')');\r\n////      }\r\n//    }\r\n//  }\r\n//\r\n//  function make_port_child(prt){\r\n//    if (pref.debug_mode['0']) console.log('child :');\r\n//    var channel = new MessageChannel;\r\n//    var port = channel.port1;\r\n//    prt.postMessage('Connection: ', [channel.port2], '*');\r\n////    prt.postMessage('start', [channel.port2], '*');\r\n////    setInterval(function() {port.postMessage('sent : ' + (+new Date));}, 2000);\r\n////    port.onmessage = function(e) {if (pref.debug_mode['0']) console.log(e.data);};\r\n//    port.onmessage = function(e) {\r\n//      if (pref.debug_mode['0']) console.log(e.data);\r\n//      var val = JSON.parse(e.data);\r\n//      if (val[0]=='CLOSE') port.close();\r\n//      else if (val[0]=='MARK' && val[1]>=0) {\r\n//        var offset_top = site2[site.nickname].mark_newer_posts(document,val[1]);\r\n//        scrollTo(0,offset_top);\r\n//      }\r\n//    };\r\n//  }\r\n//  if (window.opener) make_port_child(window.opener);\r\n\r\n  var http_req = (function(){\r\n    var iframes = {};\r\n//    var caches = {}; // prevent occuring multiple access to the same url in short time.\r\n    var local = true;\r\n    var parser = new DOMParser();\r\n    var serializer = new XMLSerializer();\r\n//    var doc;\r\n//    var pool; // object pool\r\n    var reqs = {};\r\n    var Req = function(sender){\r\n      this.sender = sender;\r\n      this.req = null;\r\n      this.httpd = new XMLHttpRequest();\r\n      this.httpd.onload  = Req.prototype.onload.bind(this);\r\n      this.httpd.onerror = this.httpd.onload;\r\n      this.httpd.onabort = this.httpd.onload;\r\n    }\r\n    Req.prototype.onload = function(){\r\n//      if (local) onload_local(this.sender,{date: Date.now(), __proto__:this.httpd},false); // cause illegal invocation, I don't know why.\r\n      if (local) {\r\n        if (this.httpd.responseType==='text') onload_text(this.sender,{date: Date.now(), status: this.httpd.status, responseText: this.httpd.responseText},false); // temporaly patch.\r\n        else onload_local(this.sender,{date: Date.now(), status: this.httpd.status, response: this.httpd.response},false);\r\n      } else send_message('parent',[['SUB_ACK',[this.sender,Date.now(),this.httpd.status,this.httpd.responseText]]]);\r\n    };\r\n    function get_make_Req(sender, req){\r\n      if (reqs[sender]===undefined) reqs[sender] = new Req(sender);\r\n      if (req) reqs[sender].req = req;\r\n      return reqs[sender];\r\n    }\r\n    function destroy_httpd(sender){\r\n      delete reqs[sender];\r\n    }\r\n////    function make_httpd(sender){ // working code.\r\n////      var httpd = new XMLHttpRequest();\r\n////      function httpd_events(){\r\n//////        if (local) onload_local(sender,{date: Date.now(), status: httpd.status, responseText: httpd.responseText},false);\r\n////        if (local) {\r\n////          if (httpd.responseType==='text') onload_local(sender,{date: Date.now(), status: httpd.status, responseText: httpd.responseText},false); // temporaly patch.\r\n////          else onload_local(sender,{date: Date.now(), status: httpd.status, response: httpd.response},false);\r\n////        } else send_message('parent',[['SUB_ACK',[sender,Date.now(),httpd.status,httpd.responseText]]]);\r\n////      }\r\n////      httpd.addEventListener('load',  httpd_events, false);\r\n////      httpd.addEventListener('error', httpd_events, false);\r\n////      httpd.addEventListener('abort', httpd_events, false);\r\n////      httpds[sender] = [httpd, httpd_events];\r\n////    }\r\n////    function destroy_httpd(sender){\r\n////      if (sender in httpds) {\r\n////        var httpd = httpds[sender][0];\r\n////        var httpd_events = httpds[sender][1];\r\n////        httpd.removeEventListener('load',  httpd_events, false);\r\n////        httpd.removeEventListener('error', httpd_events, false);\r\n////        httpd.removeEventListener('abort', httpd_events, false);\r\n////        delete httpds[sender];\r\n//////if (pref.test_mode['30']) console.log('destroyed: '+site.nickname+'/'+sender)\r\n////      }\r\n////    }\r\n    function make_iframe(domain,url){\r\n//      var ifrm = cnst.init('left:200px:bottom:200px:display:none:Show'); // working code.\r\n////      var ifrm = cnst.init('left:200px:bottom:200px:' + ((pref.debug_mode['0'])? '' : 'display:none:') + 'Show');\r\n////      var ifrm = cnst.init('left:200px:bottom:200px:Show');\r\n//      ifrm.innerHTML = '<iframe name=' + domain + '></iframe>';\r\n      cnst.make_iframe(domain);\r\n//      try {\r\n        iframes[domain] = window.open((site2[domain].home!=='')? site2[domain].home : url, domain);\r\n        send_message(domain,[['SUBFRAME_INIT']],iframes[domain]);\r\n//      } catch (e) {\r\n//        console.log('IFRAME OPEN ERROR'); // not debugged yet.\r\n//      }\r\n//      iframes[domain].onerror = function(){console.log('IFRAME OPEN ERROR');}; // can't catch\r\n    }\r\n    function onload_from_sw_cache_check(key,value,args) {\r\n      if (value!==null) {\r\n//        var date = value[0];\r\n//        var req_date = Date.now() - args[4]*1000;\r\n//        if (date>req_date) {onload_from_sw_cache(key,value,args);return;}\r\n        if (args[4]===true || value.date > Date.now() - args[4]*1000) {onload_text(args[0],value,true);return;} // date check.\r\n      }\r\n      get_req(args[0],args[1],args[2],args[3],false,args[5]);\r\n    }\r\n    function onload_text(sender,value,from_cache) {\r\n      if (reqs[sender]) { // for 8chan's 524 error(Origin Time-out)\r\n        if (reqs[sender].req.data_type==='html') {\r\n          value.response = parser.parseFromString(value.responseText, 'text/html');\r\n//          delete value.responseText;\r\n        } else if (reqs[sender].req.data_type==='json') {\r\n          value.response = (value.status==200)? JSON.parse(value.responseText) : value.responseText;\r\n        }\r\n        onload_local(sender,value,from_cache);\r\n      }\r\n//      value.response = null;\r\n    }\r\n    function onload_local(sender,value,from_cache) {\r\n      if (!reqs[sender]) return;\r\n      var req = reqs[sender].req;\r\n//      if (!from_cache && data_type==='html') {\r\n//        doc = parser.parseFromString(value.responseText, 'text/html');\r\n//        site2.common.remove_by_tagname(doc,'script');\r\n//        doc.getElementsByTagName('head')[0].innerHTML = '';\r\n////        value = {date:value.date, status:value.status, responseText:serializer.serializeToString(doc)};\r\n//      }\r\n//      if (!from_cache && cache_write) {\r\n////        caches[key] = [date, value.status, response_txt];\r\n////        setTimeout(function(){delete caches[key];},10000);\r\n////        if (pref.info_server && brwsr.sw_cache && value.status==200) brwsr.sw_cache.setItem(key,[date, response_txt]);\r\n////        if (pref.info_server && brwsr.sw_cache && value.status==200) brwsr.sw_cache.setItem(key,[date, value.status, response_txt]);\r\n//        if (pref.info_server && brwsr.sw_cache && value.status==200) {\r\n//          if (data_type==='html') value = {date:value.date, status:value.status, responseText:serializer.serializeToString(doc)};\r\n//          brwsr.sw_cache.setItem(key,value);\r\n//        }\r\n//      }\r\n//      if (data_type==='html') {value.response = doc; delete value.responseText;} // trial patch.\r\n//      else if (data_type==='json') {value.response = JSON.parse(value.responseText); delete value.responseText;}\r\n//      callback(key, value, callback_arg);\r\n\r\n      if (!from_cache && req.data_type==='html' && value.response) {\r\n//        site2.common.remove_by_tagname(value.response,'script');\r\n//        var dbt = common_func.name2domainboardthread(key,true);\r\n        var dbt = req.key.split(',');\r\nif (pref.test_mode['28']) {\r\n        site2[dbt[0]].preprocess_doc(value.response);\r\n}\r\nif (pref.test_mode['50'] && site2[dbt[0]].preprocess_doc2 && site2[dbt[0]].preprocess_doc2[dbt[3]]) site2[dbt[0]].preprocess_doc2[dbt[3]](value.response);\r\nif (pref.test_mode['4']) {\r\n  site2[dbt[0]].remove_posts(value.response,pref.test_mode.num);\r\n  site2.common.remove_double_br(value.response);\r\n}\r\n        if (value.response.getElementsByTagName('head')[0]) value.response.getElementsByTagName('head')[0].innerHTML = '';\r\n      }\r\n//var check_perf = ['http_req :', performance.now()];\r\n      if (!from_cache && req.cache_write) {\r\n        if (pref.info_server && brwsr.sw_cache && value.status==200) {\r\n          if (req.data_type==='html') site2.common.remove_by_tagname(value.response,'script');\r\n          var value_sw_cache = (req.data_type==='html')? {date:value.date, status:value.status, responseText:serializer.serializeToString(value.response)}\r\n                                                       : {date:value.date, status:value.status, responseText:JSON.stringify(value.response)};\r\n//check_perf.push(performance.now());\r\n          brwsr.sw_cache.setItem(req.key,value_sw_cache);\r\n//check_perf.push(performance.now());\r\n        }\r\n      }\r\n// https://github.com/rtomayko/rack-cache/issues/111 Cache hit gives 200 instead of 304 when behind Nginx, Nginx + StringEtag + chrome.\r\nif (pref.test_mode['48'] && value.status===304) console.log('onload_local: 304, '+req.key);\r\n      req.callback(req.key, value, req.callback_arg);\r\n//if (sender==='catalog') common_func.perf_out(check_perf);\r\n    }\r\n    function get_req(sender,domain,url,key,sw_cache,data_type, archived){\r\n//      if (caches[key]) setTimeout(function(){onload_local(sender,{date: caches[key][0], status: caches[key][1], responseText: caches[key][2]},true);},0); // this make racing condition at checking page in catalog.\r\n      if ((sw_cache===true || (typeof(sw_cache)==='number' && sw_cache!=0)) && brwsr.sw_cache)\r\n        brwsr.sw_cache.trygetItem(key,onload_from_sw_cache_check,[sender,domain,url,key,sw_cache,data_type]);\r\n      else {\r\n        if (domain==site.nickname || pref.catalog_cross_domain_connection=='direct') {\r\n          var httpd = get_make_Req(sender).httpd;\r\n          httpd.open('GET', url, true);\r\n          httpd.responseType = (archived)? 'text' : (data_type==='html')? 'document' : (data_type==='json')? 'json' : 'text';\r\n          httpd.send(null);\r\n        } else {\r\n          if (!iframes[domain]) make_iframe(domain,url);\r\n          send_message(domain,[['SUB_GET',[sender,domain,url,key,sw_cache,'text']]]);\r\n        }\r\n      }\r\n    }\r\n    return {\r\n      get: function (sender,key,url,callback,sw_cache,sw_cache_write,callback_arg, archived){\r\n        var dbt = (key.indexOf(',')==-1)? common_func.name2dbt(key): key.split(',');\r\n        if (url==='') url = site2[dbt[0]].make_url4(dbt);\r\n        else if (typeof(url)==='string') url = [ url, 'raw'];\r\n        key = dbt.join(',');\r\n        get_make_Req(sender, {url:url[0], callback:callback, key:key, sw_cache:sw_cache, sw_cache_write:sw_cache_write, callback_arg:callback_arg, data_type:url[1]});\r\n        get_req(sender,dbt[0],url[0],key,sw_cache,url[1], archived);\r\n      },\r\n////////      get: function (sender,key,url,callback,sw_cache,sw_cache_write,callback_arg){ // working code.\r\n////////        var dbt = cnst.name2domainboardthread(key,true);\r\n////////        key = dbt[0]+dbt[1]+dbt[2];\r\n////////        if (url==='')\r\n////////          if (dbt[2][0]==='c' || dbt[2][0]==='p' || dbt[2][0]==='j') url = site2[dbt[0]].make_url(dbt[1],parseInt(dbt[2].substr(1),10),dbt[2][0]);\r\n////////          else url = [site2[dbt[0]].make_url3(dbt[1],dbt[2]), (dbt[2][0]!=='t')? 'html' : 'json'];\r\n////////        if (typeof(url)==='string') url = [ url, 'raw'];\r\n////////        req[sender] = {url:url[0], callback:callback, key:key, sw_cache:sw_cache, sw_cache_write:sw_cache_write, callback_arg:callback_arg, data_type:url[1]};\r\n////////        get_req(sender,dbt[0],url[0],key,sw_cache,url[1]);\r\n////////      },\r\n      close:   function(sender){\r\n        destroy_httpd(sender);\r\n        if (!pref.test_mode['30']) for (var domain in iframes) send_message(domain,[['SUB_DEST',[sender]]]);\r\n      },\r\n      sub_dest: function(args){destroy_httpd(args[0]);},\r\n      sub_get: function(arg){get_req(arg[0],arg[1],arg[2],arg[3],arg[4],arg[5]);},\r\n      sub_ack: function(arg){\r\n        var value =  {date: arg[1], status: arg[2], responseText: arg[3]};\r\n        onload_text(arg[0], value, false);\r\nif (pref.test_mode['34']) send_message('meguca',[['ECHO',arg]]);\r\n      },\r\n      remote : function(){local=false;}\r\n    };\r\n  })();\r\n\r\n//  var http_req = (function(){ // working code, but chokes when and err occur.\r\n//    var reqs = [];\r\n//    var caches = {}; // prevent occuring multiple access to the same url in short time.\r\n//    var httpd = new XMLHttpRequest();\r\n//    var httpd_events = function(){onload_local(httpd.status,httpd.responseText);}; // for local\r\n//    httpd.addEventListener('load',  httpd_events, false);\r\n//    httpd.addEventListener('error', httpd_events, false);\r\n//    httpd.addEventListener('abort', httpd_events, false);\r\n//    \r\n//    function onload_local(status,response_txt) {\r\n//      var req = reqs[0];\r\n//\r\n//      if (req[1]!=null) req[1](status, response_txt);\r\n//        if (pref.info_server && brwsr.sw_cache)\r\n//          brwsr.sw_cache.setItem(req[2]+req[3]+req[4],JSON.stringify([Date.now(), response_txt]));\r\n//\r\n//      prep_next();\r\n//    }\r\n//    function prep_next() {\r\n//      reqs.shift();\r\n//      if (reqs.length!=0) req_get(true); // javascript doesn't allow multiphe threads in a program, so this works well.\r\n//    }\r\n//    function req_get(force) {\r\n//      if (!force && reqs.length>=2) return;\r\n//      var url = reqs[0][0];\r\n//      if (reqs[0][2]==site.nickname || pref.catalog_cross_domain_connection=='direct') {\r\n//        httpd.open('GET', url, true);\r\n//        httpd.send(null);\r\n//      } else {\r\n//        var domain = reqs[0][2];\r\n//        if (!iframes[domain]) {\r\n////          iframes[domain] = [window.open(url,domain), 0];\r\n////          var ifrm = cnst.init('left:300px:bottom:300px:Show');\r\n//          var ifrm = cnst.init('left:300px:bottom:300px:display:none:Show');\r\n//          ifrm.innerHTML = '<iframe name=' + domain + '></iframe>';\r\n//          iframes[domain] = [window.open(url,domain), 0];\r\n//          send_message(domain,[['SUBFRAME_INIT']]);\r\n//        }\r\n//        send_message(domain,[['SUB_GET',reqs[0]]]);\r\n//        iframes[domain][1]++;\r\n//      }\r\n//    }\r\n//    return {\r\n//      get: function(url,callback,domain,board,page,sw_cache,sender){\r\n//        reqs.push([url,callback,domain,board,page,sw_cache,sender]);\r\n//        req_get(false);\r\n//      },\r\n//      remote: function(){\r\n//        httpd.removeEventListener('load',  httpd_events, false);\r\n//        httpd.removeEventListener('error', httpd_events, false);\r\n//        httpd.removeEventListener('abort', httpd_events, false);\r\n//        httpd_events = function(){\r\n//          send_message('parent',[['SUB_ACK',httpd.status, httpd.responseText]]);\r\n//          prep_next();\r\n//        };\r\n//        httpd.addEventListener('load',  httpd_events, false);\r\n//        httpd.addEventListener('error', httpd_events, false);\r\n//        httpd.addEventListener('abort', httpd_events, false);\r\n//      },\r\n//      onload_local: onload_local\r\n//    };\r\n//  })();\r\n\r\n  var cnst = (function(){\r\n    function opacity(pn, increase){\r\n      var op = parseFloat(pn.style.opacity);\r\n      if (isNaN(op)) op=1;\r\n      if (increase) pn.style.opacity = (op+0.1>=1)? 1 : op+0.1;\r\n      else if (!increase) pn.style.opacity = (op-0.1<=0.1)? 0.1: op-0.1;\r\n    }\r\n    function rollup(tb,pn, options){\r\n      if (pn.style.display=='none') { // for dollchan\r\n        tb.style.width = ''; // means 'auto'\r\n        pn.style.display = ''; // for dollchan\r\n        if (options.rolldown) options.rolldown.call(options.this_obj);\r\n      } else {\r\n        tb.style.width = tb.offsetWidth + 'px'; // for dollchan\r\n        pn.style.display = 'none'; // for dollchan\r\n        if (options.rollup) options.rollup.call(options.this_obj);\r\n      }\r\n    }\r\n    var state_arr = ['top','bottom','max','float'];\r\n    function maximize(pn,tb,req, options){\r\n      var state = options.maximize_state;\r\n      var state_str = state_arr[req];\r\n      var state_old_str = state_arr[state[0]];\r\n//      if (options.before_maximize) options.before_maximize(state_str, state_old_str);\r\n      common_func.overwrite_prop(tb.childNodes[1].childNodes[state[0]].style,{display:'inline'});\r\n      if (state[0]==2) state = [req, pn.style.left, pn.style.top, pn.childNodes[1].style.width, pn.childNodes[1].style.height];\r\n      else state[0] = req;\r\n      if (req==3) { // maximize\r\n        var header_height = site.header_height();\r\n        common_func.overwrite_prop(pn.style, {left:'0px', top:header_height + 'px', position:'fixed', resize:'none'});\r\n        common_func.overwrite_prop(pn.childNodes[1].style,\r\n          {width: document.documentElement.clientWidth + 'px', height: document.documentElement.clientHeight - tb.offsetHeight - header_height + 'px', resize:'none'});\r\n      } else if (req==2){ // float\r\n        common_func.overwrite_prop(pn.style, {left:state[1], top:state[2], position:'fixed', resize:'both'});\r\n        common_func.overwrite_prop(pn.childNodes[1].style, options.maximize_float_style_pnch1 || {width:state[3], height:state[4], resize:'both'});\r\n      } else {\r\n//        var ref = site2[site.nickname].embed_to[site.whereami][(req==0)?'top':'bottom'];\r\n        var ref = site.embed_to[(req==0)?'top':'bottom'];\r\n        if (ref){\r\n          common_func.overwrite_prop(pn.style, options.maximize_embed_style_pn || {left:'auto', top:'auto', position:'static', resize:'none'});\r\n          common_func.overwrite_prop(pn.childNodes[1].style, options.maximize_embed_style_pnch1 || {width:'auto', height:'auto', resize:'none'});\r\n          ref.parentNode.insertBefore(pn,ref);\r\n        }\r\n      }\r\n      common_func.overwrite_prop(tb.childNodes[1].childNodes[req].style,{display:'none'});\r\n      options.maximize_state = state;\r\n      options.maximize_state_str = state_str;\r\n      if (options.maximize) options.maximize.call(options.this_obj,state_str, state_old_str);\r\n    }\r\n    var drag_sx;\r\n    var drag_sy;\r\n//    var drag_cursor_style;\r\n    function div_dragstart(e){\r\n      drag_sx = e.screenX;\r\n      drag_sy = e.screenY;\r\n//      drag_cursor_style = pn.style.cursor;\r\n//      pn.style.cursor = 'move';\r\n      e.dataTransfer.setData('text/plain', ''); // for FF. CH doesn't require this.\r\n      e.dataTransfer.effectAllowed = 'move';\r\n      e.dataTransfer.dropEffect = 'move';\r\n//      e.preventDefault();\r\n      e.stopPropagation(); // prevent from invoking twice when legend on chart is moved.\r\n      if (!e.currentTarget.style) e.style = {};\r\n      e.currentTarget.style.opacity = 0.4;\r\n      div_dragend_caller = this;\r\n      e.currentTarget.addEventListener('dragend', div_dragend, false);\r\n      document.getElementsByTagName('body')[0].addEventListener('dragover',div_dragover,false);\r\n    }\r\n    function div_dragover(e){ // http://www.html5rocks.com/ja/tutorials/dnd/basics/\r\n      e.preventDefault();\r\n      e.dataTransfer.dropEffect = 'move';\r\n    }\r\n    var div_dragend_caller;\r\n    function div_dragend(e){\r\n      document.getElementsByTagName('body')[0].removeEventListener('dragover',div_dragover,false);\r\n      e.currentTarget.removeEventListener('dragend', div_dragend, false);\r\n//      console.log('drag_end');\r\n//      e.currentTarget.style.left   = (parseInt(e.currentTarget.style.left.replace(/px/,''))   + e.screenX - drag_sx) + 'px';\r\n      if (e.currentTarget.style.left!='') e.currentTarget.style.left   = (parseInt(e.currentTarget.style.left.replace(/px/,''))   + e.screenX - drag_sx) + 'px';\r\n      else e.currentTarget.style.right = (parseInt(e.currentTarget.style.right.replace(/px/,''))   - e.screenX + drag_sx) + 'px';\r\n      if (e.currentTarget.style.bottom!='') e.currentTarget.style.bottom = (parseInt(e.currentTarget.style.bottom.replace(/px/,'')) - e.screenY + drag_sy) + 'px'; // from bottom.\r\n      else e.currentTarget.style.top = (parseInt(e.currentTarget.style.top.replace(/px/,'')) + e.screenY - drag_sy) + 'px';\r\n//      pn.style.cursor = drag_cursor_style;\r\n      if (div_dragend_caller.dragend) div_dragend_caller.dragend.call(div_dragend_caller.this_obj,e);\r\n      div_dragend_caller = null;\r\n      e.currentTarget.style.opacity = 1;\r\n    }\r\n    function div_scroll(e){\r\n      var val = (!brwsr.ff)? e.wheelDelta : -e.detail*40;\r\n      if (e.currentTarget.style.bottom!='') e.currentTarget.style.bottom = (parseInt(e.currentTarget.style.bottom.replace(/px/,'')) - val) + 'px'; // from bottom.\r\n      else e.currentTarget.style.top = (parseInt(e.currentTarget.style.top.replace(/px/,'')) + val) + 'px';\r\n      e.preventDefault();\r\n    }\r\n    var tile = {\r\n      left   : 0,\r\n      bottom : 0,\r\n      last_pn: null, // CAUTION. grep last pn permanently.\r\n    };\r\n    return {\r\n      init3: function(obj){\r\n        return this.init(obj.func_str,null,null,null,null,obj.pn_st, obj);\r\n      },\r\n      init2: function(obj){\r\n        return this.init(obj.func_str,obj.rolldown_func,obj.rollup_func,obj.exit_func,obj.maximize_func,obj.pn_st);\r\n      },\r\n      init: function(func_str,rolldown_func,rollup_func,exit_func,maximize_func,site_settings, options){\r\n        var options_is_given = (options!==undefined);\r\n        if (options===undefined) options = { // options WILL BE this.\r\n          rolldown: rolldown_func,\r\n          rollup: rollup_func,\r\n          exit: exit_func,\r\n          maximize: maximize_func,\r\n        };\r\n        var pn = document.createElement('span');\r\n        if (site_settings) {\r\n          pn.textContent = ' '+func_str.replace(/.*:button:/,'').replace(/:.*/,'');\r\n          pn.setAttribute('style','cursor:pointer');\r\n          site_settings.appendChild(document.createTextNode(' '));\r\n          site_settings.appendChild(pn);\r\n          return pn;\r\n        }\r\n//        var pn = document.createElement('div');\r\n        if (!pn.style) pn.style = {};\r\n        pn.style.position = 'fixed';\r\n        pn.draggable = true;\r\n        pn.style.padding = '0px';\r\n        pn.style.zIndex = 1;\r\n        var funcs = func_str.split(':');\r\n        var i=0;\r\n        if (funcs[0]!='pop') {\r\n//          pn.style.background = '#e5ecf9';\r\n//          pn.style.color = '#000000';\r\n          pn.style.fontWeight = 'normal';\r\n          pn.style.border = '1px solid blue';\r\n//          pn.style.border = 'none';\r\n        } else {\r\n          if (!brwsr.ff) pn.addEventListener('mousewheel', div_scroll, false);\r\n          else pn.addEventListener('DOMMouseScroll', div_scroll, false);\r\n          pn.name = 'catalog_pop';\r\n          i=1;\r\n        }\r\n        pn.setAttribute('class', pref.script_prefix+'_window');\r\n        var rollup_func_tb = null;\r\n        var tgt = pn;\r\n        var funcs = func_str.split(':');\r\n        while (i<funcs.length) {\r\n          var arg = funcs[i++];\r\n          if (arg=='tb') {\r\n            pn.setAttribute('class', pref.script_prefix+'_titleBar');\r\n//            pn.style.background = '#b5ccf9';\r\n            pn.innerHTML = '<div>' +\r\n                '<div style=\"float: left\"><button type=\"button\">-</button><button type=\"button\"><</button><button type=\"button\">></button><span>&emsp;</span></div>' +\r\n//                '<div style=\"float: right\"><button type=\"button\">[]</button><button type=\"button\">X</button></div>' +\r\n                '<div style=\"float: right\"><button style=\"display:inline\">^</button><button style=\"display:inline\">_</button><button style=\"display:none\">o</button><button style=\"display:inline\">[]</button><button>X</button></div>' +\r\n                '<div></div>' +\r\n              '</div>' +\r\n              '<div class=\"' + pref.script_prefix + '_window\" style=\"margin: 0px 3px 3px 3px;clear:both\"></div>';\r\n//              '<div style=\"background: #e5ecf9; margin: 0px 3px 3px 3px\"></div>';\r\n//            pn.innerHTML = '<div><div style=\"float: left\"><button type=\"button\">-</button><button type=\"button\"><</button><button type=\"button\">></button></div><div style=\"float: right\"><button type=\"button\">X</button></div><div></div></div><div style=\"background: #e5ecf9; margin: 0px 3px 3px 3px\"></div>'\r\n            var tb = pn.childNodes[0];\r\n            tb.childNodes[2].style.height = tb.childNodes[0].offsetHeight + 'px';\r\n            tb.childNodes[0].style.cursor = 'move';\r\n            tb.childNodes[2].style.cursor = 'move';\r\n            rollup_func_tb = function(){rollup(pn,pn.childNodes[1], options);};\r\n            tb.childNodes[0].childNodes[0].onclick = rollup_func_tb;\r\n            tb.childNodes[0].childNodes[1].onclick = function(){opacity(pn, false);};\r\n            tb.childNodes[0].childNodes[2].onclick = function(){opacity(pn, true);};\r\n            tb.childNodes[0].childNodes[3].ondblclick = rollup_func_tb;\r\n            tb.childNodes[2].ondblclick = rollup_func_tb;\r\n            options.maximize_state = [2];\r\n            options.maximize_state_str = 'float';\r\n            tb.childNodes[1].childNodes[0].onclick = function(){maximize(pn,tb,0, options);}; // can reduce footprint if 'prototype' is used.\r\n            tb.childNodes[1].childNodes[1].onclick = function(){maximize(pn,tb,1, options);};\r\n            tb.childNodes[1].childNodes[2].onclick = function(){maximize(pn,tb,2, options);};\r\n            tb.childNodes[1].childNodes[3].onclick = function(){maximize(pn,tb,3, options);};\r\n            tb.childNodes[1].childNodes[4].onclick = (options.this_obj)? options.exit.bind(options.this_obj) : options.exit;\r\n//            if (brwsr.ff) {\r\n            pn.draggable = false;\r\n            tb.childNodes[0].draggable = true;\r\n            tb.childNodes[2].draggable = true;\r\n//            }\r\n            tgt = pn.childNodes[1];\r\n          } else if (arg=='txt' || (brwsr.ff && arg=='button')) {\r\n            tgt.appendChild(document.createTextNode(funcs[i++]));\r\n            tgt.style.cursor = 'pointer';\r\n            tgt.style.padding = '2px 5px 2px 5px';\r\n          } else if (arg=='button') {\r\n            tgt.innerHTML = '<input type=\"button\" value=\"' + funcs[i++] + '\">';\r\n//            tgt.innerHTML = '<button draggable=\"true\">' + funcs[++] + '</button>';\r\n            tgt.style.padding = '0';\r\n            tgt.style.border = '0';\r\n            tgt.style.background = 'none';\r\n          } else if (arg=='Show2') {\r\n            if (site.root_body!==site.root_body2 && site.root_body2) {\r\n              pn.style.position = 'static';\r\n              site.root_body2.appendChild(pn);\r\n            } else site.root_body.appendChild(pn);\r\n          } else if (arg=='Show') site.script_body.appendChild(pn);\r\n//          } else if (arg=='Show') site.root_body.appendChild(pn);\r\n          else if (arg=='tile' || arg=='tile2') {\r\n            if (funcs[i++]=='set') {\r\n              if (funcs[i]=='left') {tile[funcs[i]] = parseInt(pn.style[funcs[i]].replace(/px/,''),10) + pn.offsetWidth;i++;}\r\n              else {tile[funcs[i]] = parseInt(pn.style[funcs[i]].replace(/px/,''),10) + pn.offsetHeight;i++;}\r\n            } else if (arg==='tile') {pn.style[funcs[i]] = tile[funcs[i]]+'px';i++;} // tile:get\r\n            else {pn.style[funcs[i]] = tile[funcs[i]]+parseInt(funcs[i+1],10)+'px';i+=2;} // tile2:get\r\n            \r\n//            console.log(tile);\r\n          } else tgt.style[arg] = funcs[i++];\r\n        }\r\n        options.event_funcs = {};\r\n        options.event_funcs.dragstart = div_dragstart.bind(options);\r\n        pn.addEventListener('dragstart', options.event_funcs.dragstart, false);\r\n        tile.last_pn = pn;\r\n        options.pn = pn;\r\n        options.rollup_func_tb = rollup_func_tb;\r\n        options.tb = tb;\r\n        if (options_is_given) return options;\r\n        return (rollup_func_tb)? [pn,rollup_func_tb] : pn;\r\n      },\r\n      tile_set_bottom: function(){if (tile.last_pn) tile.bottom = tile.last_pn.offsetHeight;},\r\n      tile_set_left: function(){if (tile.last_pn) tile.left = tile.last_pn.offsetWidth;},\r\n      bottom_top: function(pn){\r\n        if (pn.style.bottom) {\r\n          pn.style.top = (window.innerHeight - parseInt(pn.style.bottom.replace(/px/,''),10) - pn.offsetHeight) + 'px';\r\n          pn.style.bottom = '';\r\n        }\r\n        if (pn.style.right) {\r\n          pn.style.left = (window.innerWidth - parseInt(pn.style.right.replace(/px/,''),10) - pn.offsetWidth) + 'px';\r\n          pn.style.right = '';\r\n        }\r\n      },\r\n      div_dragend: div_dragend,\r\n      void_func: function(){},\r\n      drag_sx : function(){return drag_sx;},\r\n      drag_sy : function(){return drag_sy;},\r\n      div_destroy: function(pn,child_of_body, options){\r\n        pref_func.tooltips.remove_hier(pn);\r\n        pref_func.tooltips.remove_root(pn);\r\n        if (child_of_body) pn.parentNode.removeChild(pn);\r\n        pn.removeEventListener('dragstart', (options)? options.event_funcs.dragstart : div_dragstart, false);\r\n        if (pn.name=='catalog_pop') {\r\n          if (!brwsr.ff) pn.removeEventListener('mousewheel', div_scroll, false);\r\n          else pn.removeEventListener('DOMMouseScroll', div_scroll, false);\r\n        }\r\n        return null;\r\n      },\r\n      add_to_tb: function(pn,str){\r\n        var pn_2 = document.createElement('div');\r\n        pn_2.style.float = 'right'; // doesn't work on FF\r\n        pn_2.style.resize = 'none';\r\n        pn_2.style.overflow = 'visible';\r\n        pn_2.innerHTML = str;\r\n        pn.childNodes[0].insertBefore(pn_2,pn.childNodes[0].childNodes[pn.childNodes[0].childNodes.length-1]);\r\n//        if (brwsr.ff) pn.childNodes[0].childNodes[2].setAttribute('style','float: right');\r\n        if (brwsr.ff) pn_2.setAttribute('style','float: right');\r\n        return pn_2;\r\n      },\r\n      show_hide: function(pn,pn2, pn3){\r\n        if (pn.style.display=='none') {\r\n          pn.style.display='';\r\n          if (pn2) pn2.style.height = parseInt(pn2.style.height.replace(/px/,''),10) - pn.offsetHeight + 'px'; // May not work? It depends on the timing of invoking rendering engine. Chrome is ok.\r\n          if (pn3) pn3.style.top    = parseInt(pn3.style.top.replace(/px/,''),10)    + pn.offsetHeight + 'px';\r\n        } else {\r\n          if (pn2) pn2.style.height = parseInt(pn2.style.height.replace(/px/,''),10) + pn.offsetHeight + 'px';\r\n          if (pn3) pn3.style.top    = parseInt(pn3.style.top.replace(/px/,''),10)    - pn.offsetHeight + 'px';\r\n          pn.style.display='none';\r\n        }\r\n      },\r\n//      rollup: function(tb,pn){rollup(tb,pn,cnst.void_func,cnst.void_func);},\r\n      name2domainboardthread: common_func.name2domainboardthread,\r\n//      name2domainboardthread: function(name,fill){\r\n//        var thread = name.replace(/[^\\/]*\\//g,'');\r\n//        var domain = name.replace(/\\/.*/,'');\r\n//        var board  = name.replace(new RegExp('^'+domain),'').replace(new RegExp(thread+'$'),'');\r\n//        if (thread==domain)\r\n//          if (thread.search(/[^0-9]/)!=-1) thread ='';\r\n//          else domain = '';\r\n//        if (fill) {\r\n//          if (domain==='') domain = site.nickname;\r\n//          if (board==='') board = site.board;\r\n//        }\r\n//        return [domain,board,thread];\r\n//      },\r\n      get_time: function(){\r\n        var now = new Date();\r\n        var hour = now.getHours();\r\n        var min = now.getMinutes();\r\n        var sec = now.getSeconds();\r\n        if(hour<10) hour = '0' + hour;\r\n        if(min<10)  min  = '0' + min;\r\n        if(sec<10)  sec  = '0' + sec;\r\n        return hour + ':' + min + ':' + sec;\r\n      },\r\n      make_destroy: function(parent,key,func_make,func_destroy){\r\n        if (!parent[key]) parent[key] = func_make();\r\n        else parent[key] = func_destroy();\r\n      },\r\n      make_popup: function(parent,tgt,html,onchange_func){\r\n        parent[tgt] = cnst.init('left:0px:tile:get:bottom:Show:tb',cnst.void_func,cnst.void_func, function(){\r\n            parent[tgt] = cnst.div_destroy(parent[tgt], true);\r\n          },cnst.void_func)[0];\r\n        parent[tgt].childNodes[1].innerHTML = html;\r\n        pref_func.add_onchange(parent[tgt].childNodes[1],onchange_func);\r\n      },\r\n      make_iframe: function(name){\r\n        var ifrm = document.createElement('iframe');\r\n        ifrm.name = name;\r\n        ifrm.setAttribute('style','display:none');\r\n        site.script_body.appendChild(ifrm);\r\n        return ifrm;\r\n      },\r\n\r\n\r\n      subscribe: function(container, tgt){ // for [] container.\r\n        container.push(tgt);\r\n      },\r\n      unsubscribe: function(container, tgt){\r\n        var idx = container.indexOf(tgt);\r\n        if (idx!=-1) container.splice(idx,1);\r\n      },\r\n      foreach: function(container, func){\r\n        for (var i=0;i<container.length;i++) func(container[i]);\r\n      },\r\n      auto_shrink_board_selector: (function(){\r\n        var sels = [];\r\n        function focus(){\r\n          this.removeAttribute('style');\r\n          for (var j=0;j<this.length;j++) {\r\n            this.options[j].text = pref.catalog_board_list_obj[j][0].key;\r\n            color(this.options[j],j);\r\n          }\r\n        }\r\n        function blur(){\r\n          for (var j=0;j<this.length;j++)\r\n            if (j!=this.selectedIndex) this.options[j].text = '';\r\n          color(this,this.selectedIndex);\r\n        }\r\n        function prep(sel, idx){\r\n          if (idx===undefined) idx = sel.selectedIndex;\r\n          sel.length=0;\r\n          for (var j=0;j<pref.catalog_board_list_obj.length;j++) {\r\n            sel.length++;\r\n            sel.options[sel.length-1].text = pref.catalog_board_list_obj[j][0]['key'];\r\n          }\r\n          sel.selectedIndex = (idx>=sel.length)? 0 : idx;\r\n          sel.onblur();\r\n        }\r\n        function color(pn,idx){\r\n          if (pref3.stats.use && (pref.stats.auto_acquisition || pref.stats.auto_acquisition_all) && stats.query_auto_acquisition(idx)) pn.setAttribute('style','background:#b5fbda');\r\n          else pn.removeAttribute('style');\r\n        }\r\n        return {\r\n          setup: function(sel, idx){\r\n            sel.onfocus = focus;\r\n            sel.onblur = blur;\r\n            prep(sel, idx);\r\n            cnst.subscribe(sels,sel);\r\n          },\r\n          str_changed: function(){\r\n            cnst.foreach(sels,prep);\r\n          },\r\n          destroy: function(sel){\r\n            cnst.unsubscribe(sels,sel);\r\n          },\r\n          color: function(){\r\n            cnst.foreach(sels,function(inst){color(inst,inst.selectedIndex);});\r\n          },\r\n        };\r\n      })(),\r\n      auto_shrink_selector: (function(){\r\n        var options = Object.create(null);\r\n        function focus(){\r\n          var opts = options[this.getAttribute('name')];\r\n          for (var j=0;j<this.length;j++) if (this.options[j].text==='') this.options[j].text = opts[j];\r\n        }\r\n        function blur(){\r\n          var opts = [];\r\n          for (var j=0;j<this.length;j++) {\r\n            opts[j] = this.options[j].text;\r\n            if (j!=this.selectedIndex) this.options[j].text = '';\r\n          }\r\n          options[this.getAttribute('name')] = opts;\r\n        }\r\n        return function(sel){\r\n          sel.onfocus = focus;\r\n          sel.onblur = blur;\r\n          sel.onblur();\r\n        };\r\n      })(),\r\n      config_expander: (function(){\r\n        function make_opts(){\r\n          var num = pref[cataLog.embed_mode].t2h_num_of_posts;\r\n          return ['Same as the page', pref[cataLog.embed_mode].t2h_L + ' posts', pref[cataLog.embed_mode].t2h_M + ' posts',\r\n                  num + ' posts', num + ' + all unread posts', 'All unread posts', 'All'];\r\n        }\r\n        function focus(){\r\n          var opts = make_opts();\r\n          for (var j=0;j<this.length;j++) if (this.options[j].text==='') this.options[j].text = opts[j];\r\n        }\r\n        function blur(){\r\n          for (var j=0;j<this.length;j++) if (j!=this.selectedIndex) this.options[j].text = '';\r\n        }\r\n        return function(sel,idx){\r\n          sel.className = pref.script_prefix + '_expander';\r\n          sel.length = 7;\r\n          if (idx===undefined) idx = 0;\r\n          sel.selectedIndex = idx;\r\n          sel.options[idx].text = (idx===0)? 'Expand...' : make_opts()[idx];\r\n          sel.onfocus = focus;\r\n          sel.onblur = blur;\r\n//          sel.onblur();\r\n        };\r\n      })(),\r\n      icons: {\r\n        filter: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcAQAAAABaduI5AAAAAnRSTlMAAQGU/a4AAABUSURBVAjXY/j///8HBjAx////CQz8//8zMLD//8fAwPz/DwND4/8fAgwH/n8wYHhQ/6CA4YP9gQ8MP+QbPzD84Wf+wPCPnx2ol5+fLKJfHmovnAAAn79HiYOE2q8AAAAldEVYdGRhdGU6Y3JlYXRlADIwMTUtMTAtMjlUMDI6MTM6MzkrMDk6MDBxKtFiAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE1LTEwLTI5VDAyOjEzOjM5KzA5OjAwAHdp3gAAAABJRU5ErkJggg==',\r\n        settings: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcAQAAAABaduI5AAAAAnRSTlMAAQGU/a4AAABWSURBVAjXdY6xDcAgDAQvGzAKG2QllykiwWgexWxgKQ2dI4yULs1X9/dPWHMyHrudYZegvVQ6FBQqdqrgzRwLF0ZM4YjJfySS8K4tQaq2dOlzKCe/By9fz0MDWLKIZgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNS0xMC0yOVQwMjowMzowNiswOTowMMhjeagAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTUtMTAtMjlUMDI6MDM6MDYrMDk6MDC5PsEUAAAAAElFTkSuQmCC',\r\n        refresh: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcAQAAAABaduI5AAAAAnRSTlMAAQGU/a4AAABmSURBVAjXbY6xDYAwDASfijLegBUYLRuAlCIljITEAowQNnCZIspjQ0tzkvX6e4NKBREudIw7KgaBTqugLEVwUwWnI9HOzMNh6UarhR+8QWaXD4nNBW02VY0ujdAA9SH1yXfcYG88J0BH+yT9vZAAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTUtMTAtMjhUMjM6NDg6MDYrMDk6MDASyn1kAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE1LTEwLTI4VDIzOjQ4OjA2KzA5OjAwY5fF2AAAAABJRU5ErkJggg==',\r\n      },\r\n      toggleButton: function(pn){\r\n        if (pn.style && pn.style.border) pn.style.border = '';\r\n        else pn.style.border = 'inset 2px';\r\n      },\r\n//      toggleButton: (function(){\r\n//        var style_str = 'width:14px;height:14px';\r\n//        return function(name,icon){\r\n//          var button = document.createElement('button');\r\n//          button.src = cnst.icons[icon];\r\n//          button.setAttribute('style',style_str);\r\n//          return button;\r\n//        };\r\n//      })(),\r\n      createElement: function(html){\r\n        var pn = document.createElement('div');\r\n        pn.innerHTML = html;\r\n        return (pn.childNodes.length===1)? pn.childNodes[0] : pn.querySelectorAll('*'); // return static array.\r\n      },\r\n    };\r\n  })();\r\n\r\n////  function Cnst2(func_str,funcs_args){ // rolldown, rollup, exit, maximize // test for prototype base coding.\r\n////    var pn = document.createElement('div');\r\n////    if (!pn.style) pn.style = {};\r\n////    pn.style.position = 'fixed';\r\n////    pn.draggable = true;\r\n////    pn.style.padding = '0px';\r\n////    var funcs = func_str.split(':');\r\n////    var i=0;\r\n////    if (funcs[0]!='pop') {\r\n////      pn.style.background = '#e5ecf9';\r\n////      pn.style.color = '#000000';\r\n////      pn.style.fontWeight = 'normal';\r\n////      pn.style.border = '1px solid blue';\r\n//////      pn.style.border = 'none';\r\n////    } else {\r\n////      pn.addEventListener(brwsr.mousewheel, div_scroll, false);\r\n////      pn.name = 'catalog_pop';\r\n////      i=1;\r\n////    }\r\n////    this.pn = pn;\r\n////\r\n////    var tgt = pn;\r\n////    var funcs = func_str.split(':');\r\n////    while (i<funcs.length) {\r\n////      var arg = funcs[i++];\r\n////      if (arg=='tb') {\r\n////        pn.style.background = '#b5ccf9';\r\n////        pn.innerHTML = '<div>' +\r\n////          '<div style=\"float: left\"><button name=\"rollup\">-</button><button name=\"opacity,-0.1\"><</button><button name=\"opacity,0.1\">></button><span>&emsp;</span></div>' +\r\n////          '<div style=\"float: right\"><button name=\"embed_top\" style=\"display:inline\">^</button><button name=\"embed_bottom\" style=\"display:inline\">_</button><button name=\"float\" style=\"display:none\">o</button><button name=\"maximize\" style=\"display:inline\">[]</button><button name=\"exit\">X</button></div>' +\r\n////          '<div></div>' +\r\n////          '</div>' +\r\n////          '<div style=\"background: #e5ecf9; margin: 0px 3px 3px 3px\"></div>';\r\n////        var tb = pn.childNodes[0];\r\n////        tb.childNodes[2].style.height = tb.childNodes[0].offsetHeight + 'px';\r\n////        tb.childNodes[2].ondblclick = (function(myself){return function(){myself.button_click(\"rollup\");};})(this);\r\n//////        tb.childNodes[0].childNodes[3].ondblclick = tb.childNodes[2].ondblclick;\r\n////        pn.draggable = false;\r\n////        tb.childNodes[0].draggable = true;\r\n////        tb.childNodes[2].draggable = true;\r\n////        tb.childNodes[0].style.cursor = 'move';\r\n////        tb.childNodes[2].style.cursor = 'move';\r\n////        tgt = pn.childNodes[1];\r\n////        this.tb = tb;\r\n////        this.opacity = 1;\r\n////        this.rolluped = false;\r\n////        this.state = ['float'];\r\n////        this.button_click_event = (function(myself){return function(){myself.button_click.call(myself,this.name);};})(this);\r\n////        this.funcs = {};\r\n////        common_func.overwrite_prop(this.funcs,funcs_args);\r\n////        var buttons = pn.getElementsByTagName('button');\r\n////        for (var j=0;j<buttons.length;j++) buttons[j].onclick = this.button_click_event;\r\n////        this.pn_1 = pn.childNodes[1];\r\n////      } else if (arg=='txt' || (brwsr.ff && arg=='button')) {\r\n////        tgt.appendChild(document.createTextNode(funcs[i++]));\r\n////        tgt.style.cursor = 'pointer';\r\n////        tgt.style.padding = '2px 5px 2px 5px';\r\n////      } else if (arg=='button') {\r\n////        tgt.innerHTML = '<input type=\"button\" value=\"' + funcs[i++] + '\">';\r\n//////        tgt.innerHTML = '<button draggable=\"true\">' + funcs[++] + '</button>';\r\n////        tgt.style.padding = '0';\r\n////        tgt.style.border = '0';\r\n////        tgt.style.background = 'none';\r\n////      } else if (arg=='Show2') {\r\n////        if (site.root_body!==site.root_body2 && site.root_body2) {\r\n////          pn.style.position = 'static';\r\n////          site.root_body2.appendChild(pn);\r\n////        } else site.root_body.appendChild(pn);\r\n////      } else if (arg=='Show') site.root_body.appendChild(pn);\r\n////      else if (arg=='tile') {\r\n////        if (funcs[i++]=='set') {\r\n////          if (funcs[i]=='left') {this.tile[funcs[i]] = parseInt(pn.style[funcs[i]].replace(/px/,''),10) + pn.offsetWidth;i++;}\r\n////          else {this.tile[funcs[i]] = parseInt(pn.style[funcs[i]].replace(/px/,''),10) + pn.offsetHeight;i++;}\r\n////        } else {pn.style[funcs[i]] = this.tile[funcs[i]]+'px';i++;}\r\n////      } else tgt.style[arg] = funcs[i++];\r\n////    }\r\n////    pn.addEventListener('dragstart', this.div_dragstart, false);\r\n//////    pn.addEventListener('dragstart', this.div_dragstart, true);\r\n////    pn.addEventListener('dragend', this.div_dragend, false);\r\n////  }\r\n////\r\n////  Cnst2.prototype = {\r\n////    tile : {lef: 0, bottom: 0},\r\n////    button_click : function(name){\r\n////      if (name.indexOf('opacity')!=-1) {\r\n////        this.opacity += parseFloat(name.substr(name.indexOf(',')+1),10);\r\n////        if (this.opacity>1) this.opacity = 1;\r\n////        else if (this.opacity<0.1) this.opacity = 0.1;\r\n////        this.pn.style.opacity = this.opacity;\r\n////      } else if (name.indexOf('rollup')!=-1) {\r\n////        if (this.rolluped) {\r\n////          this.tb.style.width = ''; // means 'auto'\r\n////          this.pn_1.style.display = ''; // for dollchan\r\n////          if (this.funcs.rolldown) this.funcs.rolldown();\r\n////        } else {\r\n////          this.tb.style.width = this.tb.offsetWidth + 'px'; // for dollchan\r\n////          this.pn_1.style.display = 'none'; // for dollchan\r\n////          if (this.funcs.rollup) this.funcs.rollup();\r\n////        }\r\n////        this.rolluped = !this.rolluped;\r\n////      } else if (['embed_top','embed_bottom','float','maximize'].indexOf(name)!=-1) {\r\n////        common_func.overwrite_prop(this.tb.childNodes[1].getElementsByTagName('*')[this.state[0]].style,{display:'inline'});\r\n////        if (this.state[0]=='float') this.state = [name, this.pn.style.left, this.pn.style.top, this.pn.childNodes[1].style.width, this.pn.childNodes[1].style.height];\r\n////        else this.state[0] = name;\r\n////        if (name=='maximize') {\r\n////          var header_height = site.header_height();\r\n////          common_func.overwrite_prop(this.pn.style, {left:'0px', top:header_height + 'px', position:'fixed', resize:'none'});\r\n////          common_func.overwrite_prop(this.pn.childNodes[1].style,\r\n////            {width: document.documentElement.clientWidth + 'px', height: document.documentElement.clientHeight - this.tb.offsetHeight - header_height + 'px', resize:'none'});\r\n////        } else if (name=='float'){\r\n////          common_func.overwrite_prop(this.pn.style, {left:this.state[1], top:this.state[2], position:'fixed', resize:'both'});\r\n////          common_func.overwrite_prop(this.pn.childNodes[1].style, {width:this.state[3], height:this.state[4], resize:'both'});\r\n////        } else {\r\n////          var ref = site.embed_to[(name==='embed_top')?'top':'bottom'];\r\n////          if (ref){\r\n////            common_func.overwrite_prop(this.pn.style, {left:'auto', top:'auto', position:'static', resize:'none'});\r\n////            common_func.overwrite_prop(this.pn.childNodes[1].style, {width:'auto', height:'auto', resize:'none'});\r\n////            ref.parentNode.insertBefore(this.pn,ref);\r\n////          }\r\n////        }\r\n////        common_func.overwrite_prop(this.tb.childNodes[1].getElementsByTagName('*')[this.state[0]].style,{display:'none'});\r\n////        if (this.funcs.maximize) this.funcs.maximize();\r\n////      } else if (name==='exit') this.funcs.exit();\r\n////    },\r\n////    drag_sx: null,\r\n////    drag_sy: null,\r\n////    div_dragstart: function(e){\r\n//////    var drag_cursor_style;\r\n////      this.drag_sx = e.screenX;\r\n////      this.drag_sy = e.screenY;\r\n//////      drag_cursor_style = pn.style.cursor;\r\n//////      pn.style.cursor = 'move';\r\n////      e.dataTransfer.setData('text/plain', ''); // for FF. CH doesn't require this.\r\n//////      e.preventDefault();\r\n//////      e.stopPropagation();\r\n////    },\r\n////    div_dragend: function(e){\r\n////      if (e.currentTarget.style.left!='') e.currentTarget.style.left   = (parseInt(e.currentTarget.style.left.replace(/px/,''))   + e.screenX - this.drag_sx) + 'px';\r\n////      else e.currentTarget.style.right = (parseInt(e.currentTarget.style.right.replace(/px/,''))   - e.screenX + this.drag_sx) + 'px';\r\n////      if (e.currentTarget.style.bottom!='') e.currentTarget.style.bottom = (parseInt(e.currentTarget.style.bottom.replace(/px/,'')) - e.screenY + this.drag_sy) + 'px'; // from bottom.\r\n////      else e.currentTarget.style.top = (parseInt(e.currentTarget.style.top.replace(/px/,'')) + e.screenY - this.drag_sy) + 'px';\r\n//////      pn.style.cursor = drag_cursor_style;\r\n////    }\r\n////  }\r\n\r\n  var timer_obj;\r\n  var chart_obj;\r\n  var setting_obj;\r\n  var post_form_obj;\r\n  var wafd = null;\r\n  var catalog_obj;\r\n  var cnst_obj = (function(){\r\n    site.script_body = document.createElement('div');\r\n    site.script_body.className = pref.script_prefix;\r\n    site.root_body.appendChild(site.script_body);\r\n    if (site.settings) {\r\n      site.settings.innerHTML = '<span>[CC</span><span></span>]';\r\n      site.settings.setAttribute('style','float:right;');\r\n      var pn_st = site.settings.childNodes[1];\r\n      site.settings.childNodes[0].setAttribute('style','cursor:pointer');\r\n      site.settings.childNodes[0].onclick = function(){cnst.show_hide(pn_st);};\r\n      site.settings.childNodes[1].setAttribute('style','display:none');\r\n    }\r\n    if (site.features.setting && pref.features.setting) {\r\n      var pn13 = cnst.init2({func_str:'left:0px:bottom:0px:button:settings:Show2:tile:set:left',pn_st:pn_st});\r\n      pn13.addEventListener('click', pref_func.settings.show_hide, false);\r\n    }\r\n    if (site.features.catalog && pref.features.catalog) {\r\n      if (!pref.catalog.embed_page || site.whereami!=='page') {\r\n        var pn12_str = (pref.catalog.embed && site.whereami==='catalog')? 'Frame' : 'Catalog';\r\n        var pn12 = cnst.init2({func_str:'tile:get:left:tile:get:bottom:button:'+pn12_str+':Show2:tile:set:left',pn_st:pn_st});\r\n      }\r\n      catalog_obj = make_catalog_obj(pn12);\r\n    }\r\n    cnst.tile_set_left();\r\n    if (site.features.graph && pref.features.graph && pref3.stats.use) {\r\n      var pn1 = cnst.init2({func_str:'tile:get:left:tile:get:bottom:button:Graph:Show2:tile:set:left',pn_st:pn_st});\r\n      chart_obj = make_chart_obj(pn1);\r\n    } else chart_obj = make_chart_obj(null);\r\n    if (site.features.setting2 && pref.features.setting2) {\r\n      var pn8 = cnst.init2({func_str:'tile:get:left:tile:get:bottom:button:settings2:Show2:tile:set:left',pn_st:pn_st});\r\n      setting_obj = make_setting_obj(pn8);\r\n    }\r\n    if (site.features.postform && pref.features.postform && (site.postform!=null || site2[site.nickname].postform_activation)) {\r\n      wafd = make_wafd();\r\n      var pn9 = cnst.init2({func_str:'tile:get:left:tile:get:bottom:button:post_form:Show2:tile:set:left',pn_st:pn_st});\r\n      post_form_obj = make_post_form_obj(pn9);\r\n    }\r\n    if (site.features.debug && pref.features.debug) {\r\n      var pn_debug_button = cnst.init2({func_str:'tile:get:left:tile:get:bottom:button:debug:Show2:tile:set:left',pn_st:pn_st});\r\n      make_debug_obj(pn_debug_button);\r\n//  var pn_debug_out    = cnst.init('left:200px:bottom:50px:txt:debug_out');\r\n    }\r\n    if (site.features.page && pref.features.page) {\r\n//      var pn0 = cnst.init('tile:get:left:tile:get:bottom:txt:init:Show2:tile:set:bottom');\r\n      var pn0 = cnst.init2({func_str:'tile:get:left:tile:get:bottom:txt:init:Show2',pn_st:pn_st});\r\n      timer_obj  = make_timer_obj(pn0);\r\n    }\r\n    cnst.tile_set_bottom();\r\n    if (site.features.catalog && pref.features.catalog) if (pref.catalog.board.board_tags_same) pref_func.settings.onchange_funcs['tag.same_tag_refresh']();\r\n  })();\r\n\r\n  function make_uip_tracker (){\r\n    var base_thread = site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'thread_html', {thread:site.myself})[0];\r\n//    site.thread = site.get_ops(document)[0];\r\n//    var url = site.protocol + '//a.4cdn.org' + site.board +'thread/' + site.thread + '.json';\r\n//    var url2= site.protocol + '//a.4cdn.org' + site.board +'catalog.json';\r\n//    var url = site2[site.nickname].get_json_url_thread(site.board,site.thread);\r\n    var url2= site2[site.nickname].get_json_url_catalog(site.board);\r\n    var key = site.nickname + site.board + site.no;\r\n    var post_uip = [];\r\n    var last_updated = [0,1,1]; //no,posts,uips\r\n    var posts_no = {};\r\n    var waste_count = 0;\r\n    var interval_pref = pref.uip_tracker.interval;\r\n    if (interval_pref<10) interval_pref = 10;\r\n    var interval = interval_pref;\r\n    var uip_tracker_id;\r\n    uip_check();\r\n//    function uip_check(){http_req.get('uip',key,url,uip_show,false,false);}\r\n    function uip_check(){\r\n      uip_tracker_id = null;    \r\n      site2[site.nickname].uip_check(uip_show);\r\n    }\r\n\r\n    var threads = {};\r\n    var threads_req = {};\r\n    var threads_req_mutex = true;\r\n    var threads_opened = {};\r\n    function uip_auto_open(key,value){\r\n//      var obj = JSON.parse(response_txt);\r\n      var obj = site2[site.nickname].parse_json_catalog(value.responseText);\r\n      threads['max'] = 0;\r\n      for (var i=0;i<obj.length;i++) {\r\n        for (var j=0;j<obj[i].threads.length;j++) {\r\n          var no = obj[i].threads[j].no;\r\n          threads[no] = {};\r\n          threads[no].sub = obj[i].threads[j].sub;\r\n          threads[no].com = obj[i].threads[j].com;\r\n          if (threads['max']<no) threads['max']=no;\r\n        }\r\n      }\r\n      uip_auto_open_check();\r\n      threads_req_mutex = true;\r\n    }\r\n//    if (pref.debug_mode['0']) { // for debug\r\n////      window.addEventListener('load',function(){console.log(new Date().toLocaleTimeString()+': load_event');},false); // can't get.\r\n////      window.addEventListener('DOMSubtreeModified',function(){console.log(new Date().toLocaleTimeString()+': DOMSubtreeModified');},false); // get too much because of root.\r\n//      site2[site.nickname].catalog_threads_in_page(document)[0].addEventListener('DOMSubtreeModified',function(){console.log(new Date().toLocaleTimeString()+': DOMSubtreeModified');},false); // ok.\r\n//    }\r\n\r\n    var observer = new MutationObserver(uip_show_from_doc);\r\n    observer.observe(base_thread.pn, {childList: true});\r\n    function add_dom_event_listener(){\r\n      observer.observe(base_thread.pn, {childList: true});\r\n    }\r\n    function remove_dom_event_listener(){\r\n      observer.disconnect();\r\n    }\r\n//    function add_dom_event_listener(){ // obsolete function. see https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events\r\n//      base_thread.pn.addEventListener('DOMSubtreeModified',uip_show_from_doc,false);\r\n//    }\r\n//    function remove_dom_event_listener(){\r\n//      base_thread.pn.removeEventListener('DOMSubtreeModified',uip_show_from_doc,false);\r\n//    }\r\n    add_dom_event_listener();\r\n    function uip_auto_open_check(){\r\n      var kwd = pref.uip_tracker.auto_open_kwd;\r\n      if (kwd==='') kwd = '.*';\r\n      for (var i in threads_req) {\r\n        if (threads[i] && i>site.no && threads_opened[i]===undefined) {\r\n          var flag = false;\r\n          flag |= threads[i].sub  && threads[i].sub.search(kwd) !=-1;\r\n          flag |= threads[i].name && threads[i].name.search(kwd)!=-1;\r\n          flag |= threads[i].com  && threads[i].com.search(kwd) !=-1;\r\nif (pref.debug_mode['0']) console.log('auto_opener: '+i+': '+flag);\r\n//          if (flag) window.open(site2[site.nickname].make_url3(site.board,i), site.domain+site.board+i);\r\n          if (flag) {\r\n            window.open(site2[site.nickname].make_url4([site.nickname, site.board, i, 'thread_html'])[0], '_blank');\r\n//            window.open(site2[site.nickname].make_url3(site.board,i), '_blank');\r\n            threads_opened[i] = i;\r\n          }\r\n          delete threads_req[i];\r\n        } else if (threads['max']>i) delete threads_req[i];\r\n      }\r\n      if (Object.keys(threads_req).length!=0 && threads_req_mutex) {\r\n        threads_req_mutex = false;\r\n        http_req.get('uip_auto',key,url2,uip_auto_open,false,false);\r\n      }\r\n    }\r\n    function uip_show(key,value){ // from http\r\n      uip_show_2(key,value,true);\r\n    }\r\n    function uip_show_from_doc(key,value){ // from document\r\n //     uip_show_2(Date.now(),1200,'',false);\r\n     uip_show_3();\r\n    }\r\n    function uip_show_3(){  // show\r\n      remove_dom_event_listener();\r\n      for (var i=0;i<post_uip.length;i++) {\r\n//        var tgt_post = document.getElementById('pc'+post_uip[i][0]);\r\n        var tgt_post = site2[site.nickname].uip_tgt_post(post_uip[i][0]);\r\n        if (tgt_post) {\r\n//          var post_nums = tgt_post.getElementsByClassName('postNum');\r\n          var post_nums = site2[site.nickname].uip_post_num(tgt_post);\r\n          var pn_uip = document.createElement('span');\r\n          pn_uip.innerHTML = ' (<span>'+post_uip[i][2]+'</span>)';\r\n          if (post_uip[i][4]) pn_uip.childNodes[1].setAttribute('style','color:Red');\r\n//          if (pref.uip_tracker.deletion && post_uip[i][5]!=='') {\r\n//            pn_deleted_posts = document.createElement('span');\r\n//            pn_deleted_posts.innerHTML = '<span>'+ post_uip[i][5] +'</span>/';\r\n//            pn_deleted_posts.childNodes[0].setAttribute('style','color:Red');\r\n//            pn_uip.insertBefore(pn_deleted_posts,pn_uip.childNodes[1]);\r\n//          }\r\n          if (pref.uip_tracker.posts) {\r\n            pn_posts = document.createElement('span');\r\n//            pn_posts.innerHTML = '<span>'+ post_uip[i][1] +'</span>/';\r\n            pn_posts.innerHTML = '<span>'+ post_uip[i][1] +'</span>' + ((post_uip[i][5]!=='')? '('+post_uip[i][5]+')' : '') + '/';\r\n            if (post_uip[i][3]) pn_posts.childNodes[0].setAttribute('style','color:Red');\r\n            pn_uip.insertBefore(pn_posts,pn_uip.childNodes[1]);\r\n          }\r\n          for (var j=0;j<post_nums.length;j++) post_nums[j].appendChild(pn_uip);\r\n          post_uip.splice(i,1);\r\n          i--;\r\n        }\r\n      }\r\n      add_dom_event_listener();\r\n    }\r\n    function uip_show_2(key,value,from_http){ // from http and doc\r\n//console.log(new Date(value.date).toLocaleTimeString()+', IN, '+from_http);\r\n      waste_count++;\r\n      if (value.status==200) {\r\n//        var obj = JSON.parse(value.responseText);\r\n        var obj = site2[site.nickname].parse_json_thread(('response' in value)? value.response : JSON.parse(value.responseText),from_http);\r\n        var posts = obj.posts.length;\r\n        var uips = obj.posts[posts-1]['unique_ips'];\r\n        if (uips==0) uips = last_updated[2];\r\n        var no = obj.posts[posts-1]['no'];\r\n        if (pref.uip_tracker.auto_open && pref.uip_tracker.auto_open_th<=posts && last_updated[0]!=0) { // this picks up before 300th.\r\n          if (last_updated[1]!=posts) { // skip if the previous post was deleted and the post get into.\r\n            var pn_test = document.createElement('span');\r\n            for (var i=last_updated[1];i<posts;i++) {\r\n              pn_test.innerHTML = obj.posts[i].com;\r\n              var pn_a = pn_test.getElementsByTagName('a');\r\n              for (var j=0;j<pn_a.length;j++) {\r\n                var flag = true;\r\n                var tgt = pn_a[j].textContent.substr(2);\r\n                for (var k=0;k<posts.length;k++) if (posts[k].no==tgt) {flag=false;break;}\r\n//                if (flag) console.log('auto_opener: '+tgt);\r\n                threads_req[tgt] = tgt;\r\n              }\r\n            }\r\n            uip_auto_open_check();\r\n          }\r\n        }\r\n        if (last_updated[0]!=no || last_updated[1]!=posts || last_updated[2]!=uips) {\r\n//          last_updated = [no,posts,uips,last_updated[1]+1!=posts,last_updated[2]!=uips];\r\nif (pref.debug_mode['0']) console.log(new Date(value.date).toLocaleTimeString()+', '+no+', '+posts+', '+uips);\r\n          var post_hilight = (obj.posts.length<last_updated[1] || obj.posts[last_updated[1]-1]['no']!=last_updated[0]);\r\n          var posts_deleted = '';\r\n          if (pref.uip_tracker.deletion) {\r\n            var posts_no_new = {};\r\n            for (var i=0;i<obj.posts.length;i++) posts_no_new[obj.posts[i].no] = 1; // dummy;\r\n            for (var i in posts_no) if (posts_no_new[i]===undefined) posts_deleted = posts_deleted + ((posts_deleted!=='')? ',' : '') + i;\r\n            posts_no = posts_no_new;\r\nif (pref.debug_mode['0'] && posts_deleted!=='') console.log('uip_deleted '+posts_deleted);\r\n          }\r\n          last_updated = [no,posts,uips,post_hilight,last_updated[2]!=uips,posts_deleted];\r\n          post_uip.push(last_updated);\r\n          waste_count = 0;\r\n        }\r\n        uip_show_3();\r\n      }\r\n      if (pref.uip_tracker.on) {\r\n        if (from_http) {\r\n          if (pref.uip_tracker.adaptive){\r\n            if (waste_count==0) interval = interval_pref;\r\n            else if (waste_count>=8) {\r\n              waste_count=0;\r\n              interval *= 2;\r\n             if (interval>=3600) interval=3600;\r\n            }\r\n          }\r\n//          if (value.status!=404) setTimeout(uip_check,interval*1000);\r\n          var p0 = (value.status==200)? obj.posts[0] : null;\r\n          if (value.status!=404 && (!p0 || (!p0['archived'] && !p0['closed']))) uip_tracker_id = setTimeout(uip_check,interval*1000);\r\n          else uip_tracker_destroy();\r\n        }\r\n      } else uip_tracker_destroy();\r\n    }\r\n    function uip_tracker_destroy(){\r\n      remove_dom_event_listener();\r\n      uip_tracker = null;\r\n//if (pref.debug_mode['0'] && uip_tracker===null) console.log('uip_tracker: stopped, '+value.status);\r\n    }\r\n    return function(){return uip_tracker_id;}\r\n  }\r\n  var uip_tracker=null;\r\n  setTimeout(uip_tracker_init,1); // patch for LiveTag.\r\n  function uip_tracker_init(){\r\n    if (uip_tracker===null && site.features.uip_tracker && pref.features.uip_tracker && site.isthread && pref.uip_tracker.on) uip_tracker = make_uip_tracker();\r\n    else if (!pref.uip_tracker.on) {\r\n      if (uip_tracker) clearTimeout(uip_tracker());\r\n      uip_tracker = null;\r\n    }\r\n  }\r\n\r\n  function make_thread_reader(){\r\n//    var base_thread = site2[site.nickname].catalog_threads_in_page(document)[0];\r\n    var name = site.nickname+site.board+site.myself;\r\n//    var dbt = common_func.name2domainboardthread(name);\r\n    var dummy = {sticky:null};\r\n    var threads = {};\r\n    threads[name] = [];\r\n////////    threads[name][8]  = [0,0,0,0];\r\n    threads[name][19] = liveTag.mems.init({domain:site.nickname, board:site.board, no:site.myself})[2]; // prepare data structures.\r\n    threads[name][19][0] = 0x000f0000; // start watching, init.\r\n//    threads[name][19] = [1,0,0,0,null,true,-1,0,true];\r\n    var favicon_obj = [];\r\n////////    var buf_id = null;\r\n////////    function updated_buf(){if (!buf_id) buf_id = setTimeout(updated,100);}\r\n//    var posts = {};\r\n////////    var nof_posts = 0;\r\n//    var init = true;\r\n////////    var time_lastpost = 0;\r\n////////    var num_of_children = 0;\r\n////////    var myself_th = {pn:base_thread, post_no_last:-1,\r\n////////      domain:site.nickname, board:site.board, parse_funcs:site2[site.nickname].parse_funcs['thread_html'], __proto__:site4.parse_funcs_on_demand};\r\n////////    var site_live = site.nickname + ((site2[site.nickname+'_live'])? '_live' : '');\r\n////////    var myself_th = site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'thread_html',\r\n////////                      {thread:site.myself, parse_funcs:site2[site_live].parse_funcs['thread_html']})[0];\r\n//    var parse_obj = {domain:site.nickname, board:site.board,\r\n//                     parse_funcs:site2[site_live].parse_funcs['thread_html'],\r\n//                     __proto__:site4.parse_funcs_on_demand};\r\n//    var myself_th = {pn:base_thread, __proto__:parse_obj};\r\n//    var myself_th = {pn:base_thread, domain:site.nickname, board:site.board,\r\n//                     parse_funcs:site2[site_live].parse_funcs['thread_html'],\r\n//                     __proto__:site4.parse_funcs_on_demand};\r\n////////    var regexp_anchor    = />>[0-9]+/g;\r\n////////    var regexp_anchor_cb = />>>\\/[0-9A-z_\\+]+\\/[0-9]+/g;\r\n////////    var remake_own_posts = true;\r\n\r\n\r\n\r\n    var own_posts_tracker = function(){\r\n      var get_flag = true;\r\n      function get_my_posts_no(){\r\n        get_flag = true;\r\n      }\r\n      function update_own_posts(posts,init){\r\n        if (posts.length==0) {get_flag = false; return;} // clearing get_flag for watching thread which may not have any new posts in lainchan, a conflict may occur in KC...  // length check for KC.\r\n        if (get_flag) {\r\n          var key = pref.script_prefix + '.own_posts.' + site.board + site.myself;\r\n          var own_posts = JSON.parse(localStorage[key] || \"[]\");\r\n          var my_posts = [];\r\n          if (!init) {\r\n            my_posts[0] = posts[posts.length-1];\r\n            own_posts[own_posts.length] = my_posts[0].no;\r\n            localStorage[key] = JSON.stringify(own_posts);\r\n          } else {\r\n            var i = 0;\r\n            var j = posts.length-1;\r\n            while (i<own_posts.length) {\r\n              while (j>0 && own_posts[i]>posts[j].no) j--;\r\n              if (own_posts[i]===posts[j].no) my_posts[my_posts.length] = posts[j];\r\n              i++;\r\n            }\r\n          }\r\n          for (var i=0;i<my_posts.length;i++) {\r\n            var pn_name = my_posts[i].parse_funcs_html.pn_name(my_posts[i]);\r\n            if (pref.thread_reader.show_own_post_by==='plain') pn_name.parentNode.insertBefore(document.createTextNode(' (You)'), pn_name.nextSibling);\r\n            else pn_name.innerHTML = pn_name.innerHTML + ' (You)';\r\n          }\r\n          get_flag = false;\r\n        }\r\n        for (var i=0;i<posts.length;i++) site2[site.nickname].check_reply.add_you(posts[i]);\r\n      }\r\n      function event_submit(){\r\n        if (this.name==='post') get_my_posts_no();\r\n      }\r\n      return {\r\n        update_own_posts: update_own_posts,\r\n        get_my_posts_no: get_my_posts_no,\r\n        event_submit: event_submit,\r\n      }\r\n    };\r\n    if (pref.thread_reader.own_posts_tracker) {\r\n      own_posts_tracker = own_posts_tracker();\r\n      if (!site.components.postform_submit) window.addEventListener('submit', own_posts_tracker.event_submit, false); // doesn't work....\r\n    } else {\r\n      own_posts_tracker = null;\r\n//      if (!site.components.postform_submit) window.removeEventListener('submit', own_posts_tracker.event_submit, false);\r\n    }\r\n\r\n////////    var ignore_old = pref.catalog_footer_ignore_my_own_posts; // patch for showing (You), don't discard my post...\r\n////////    pref.catalog_footer_ignore_my_own_posts = false;\r\n////////    updated(true);\r\n////////    pref.catalog_footer_ignore_my_own_posts = ignore_old;\r\n////////\r\n//////////    threads[name][19][5] = false; // modified in check_reply\r\n////////    common_func.set_value_to_root(threads[name][19],'5',false);\r\n////////    function remake_own_posts_flag(){remake_own_posts = true;}\r\n////////    function add_event_to_submit(pn){pn.addEventListener('click', remake_own_posts_flag, false);}\r\n////////    function remove_event_from_submit(pn){pn.addEventListener('click', remake_own_posts_flag, false);}\r\n//    function add_event_to_submit(pn){pn.addEventListener('click', site2[site.nickname].check_reply.remake_own_posts, false);}\r\n//    function remove_event_from_submit(pn){pn.addEventListener('click', site2[site.nickname].check_reply.remake_own_posts, false);}\r\n    function add_event_to_submit(pn){\r\n      pn.addEventListener('click', site2[site.nickname].check_reply.remake_own_posts, false);\r\n      if (own_posts_tracker) pn.addEventListener('click', own_posts_tracker.get_my_posts_no, false);\r\n    }\r\n    function remove_event_from_submit(pn){\r\n      pn.removeEventListener('click', site2[site.nickname].check_reply.remake_own_posts, false);\r\n      if (own_posts_tracker) pn.removeEventListener('click', own_posts_tracker.get_my_posts_no, false);\r\n    }\r\n////////    function updated(init){\r\n////////      buf_id = null;\r\n//////////console.log('called');\r\n////////      if (pref.thread_reader.check_num_of_children) {\r\n////////        if (num_of_children>=myself_th.pn.childNodes.length) return; // KC doesn't work by this, because all of children are not posts.\r\n////////          num_of_children = myself_th.pn.childNodes.length;\r\n////////      }\r\n////////////      myself_th.parse_funcs['pop_post_prep'](myself_th);\r\n////////      site2[site.nickname].check_reply.check(myself_th, threads[name][19]);\r\n////////      delete myself_th.posts;\r\n////////////////      nof_posts += threads[name][19][7]; // patch\r\n////////      for (var i=0;i<threads[name][19][4].length;i++)\r\n////////        threads[name][19][4][i].pn.addEventListener('mouseover', favicon_check, false);\r\n//////////console.log('length:'+threads[name][19][4].length);\r\n////////\r\n\r\n//////////      threads[name][19][1] = 0;\r\n////////      threads[name][19][4] = [];\r\n////////      var flag_first = true;\r\n////////      var post_no_last_new = myself_th.post_no_last;\r\n////////      myself_th.parse_funcs['pop_post_prep'](myself_th);\r\n////////      while (1) {\r\n////////        myself_th.post = myself_th.parse_funcs['pop_post'](myself_th);\r\n////////        if (myself_th.post && myself_th.post.post_no>myself_th.post_no_last) {\r\n////////      \r\n//////////      for (var i=base_thread.childNodes.length-1;i>=0;i--) { // num of posts is changed by hover and inline.\r\n//////////        var classname = base_thread.childNodes[i].className;\r\n//////////        if (classname && classname.indexOf('post')!=-1 && classname.indexOf('reply')!=-1) { // remove popuped posts.\r\n//////////          var id = base_thread.childNodes[i].id;\r\n//////////          if (!(id in posts)) {\r\n////////          if (flag_first) {\r\n////////            post_no_last_new = myself_th.post.post_no;\r\n////////            if (remake_own_posts) {\r\n////////              site2[site.nickname].prep_own_posts(); // couldn't get an event from myself, so don't miss posts from my thread.\r\n////////              remake_own_posts = false;\r\n////////            }\r\n////////            time_lastpost = myself_th.post.time;\r\n////////            flag_first = false;\r\n////////          }\r\n////////          nof_posts++;\r\n//////////          posts[id] = id;\r\n//////////          var post = myself_th.post.pn; // temporal\r\n////////          if (!init) {\r\n//////////            var post = base_thread.childNodes[i];\r\n//////////            var image = post.getElementsByClassName('post-image');\r\n//////////            image = (image[0])? image[0].src : undefined;\r\n//////////            var body = post.getElementsByClassName('body')[0].innerHTML;\r\n////////            var to_me  = false;\r\n////////            var anchors = regexp_anchor.exec(myself_th.post.com);\r\n////////            if (anchors!==null) {\r\n////////              for (var j=0;j<anchors.length;j++) {\r\n////////                var tgt = anchors[j].substr(2);\r\n////////                if (site3[site.nickname].own_posts[dbt[1]+tgt]===null) {to_me = true; break;}\r\n////////            }}\r\n////////            if (!to_me) {\r\n////////              anchors = regexp_anchor_cb.exec(myself_th.post.com);\r\n////////              if (anchors!==null) {\r\n////////                for (var j=0;j<anchors.length;j++) {\r\n////////                  var tgt = anchors[j].substr(3);\r\n////////                  if (site3[site.nickname].own_posts[tgt]===null) {to_me = true; break;}\r\n////////            }}}\r\n//////////            var anchors = body.match(/&gt;&gt;[0-9]+/g);\r\n//////////            if (anchors) {\r\n//////////              for (var j=0;j<anchors.length;j++) {\r\n//////////                var tgt = anchors[j].substr(8);\r\n//////////                if (site3[site.nickname].own_posts[dbt[1]+tgt]===null) {to_me = true; break;}\r\n//////////            }}\r\n//////////            if (!to_me) {\r\n//////////              anchors = body.match(/&gt;&gt;&gt;\\/[0-9A-z_\\+]+\\/[0-9]+/g);\r\n//////////              if (anchors) {\r\n//////////                for (var j=0;j<anchors.length;j++) {\r\n//////////                  var tgt = anchors[j].substr(12);\r\n//////////                  if (site3[site.nickname].own_posts[tgt]===null) {to_me = true; break;}\r\n//////////            }}}\r\n////////            threads[name][19][4].unshift(\r\n////////              {icon: myself_th.post.op_img_url,\r\n////////               body: myself_th.post.com,\r\n////////               time: myself_th.post.time,\r\n//////////               icon: image,\r\n//////////               body: body,\r\n//////////               time: Date.parse(post.getElementsByTagName('time')[0].getAttribute('datetime')) - pref.localtime_offset*3600000,\r\n////////               to_me: to_me,\r\n////////               offsetTop: myself_th.post.pn.offsetTop});\r\n////////            if (to_me) threads[name][19][1]++;\r\n////////          }\r\n////////          myself_th.post.pn.addEventListener('mouseover', favicon_check_event, false);\r\n//////////            if (time_lastpost<threads[name][19][4][0].time) time_lastpost=threads[name][19][4][0].time;\r\n//////////          } else break;\r\n//////////        }\r\n//////////      }\r\n////////\r\n////////        } else break;\r\n////////      }\r\n////////      myself_th.post_no_last = post_no_last_new;\r\n\r\n////////\r\n////////      if (!init) {\r\n//////////      if (init) {init=false;buf_id=null;return;}\r\n////////////////        threads[name][8][2]  = nof_posts;\r\n//////////        for (var i=0;i<threads[name][19][4].length;i++) favicon_obj.push([threads[name][19][4][i].pn.offsetTop,threads[name][19][4][i]]);\r\n//////////        for (var i=threads[name][19][4].length-1;i>=0;i--) favicon_obj.push([threads[name][19][4][i].pn.offsetTop,threads[name][19][4][i]]);\r\n////////        for (var i=threads[name][19][4].length-1;i>=0;i--) favicon_obj.push(threads[name][19][4][i]);\r\n//////////        threads[name][19][2] = nof_posts - favicon_obj.length;\r\n////////        threads[name][19][2] = favicon_obj.length;\r\n////////\r\n//////////      if (!init) { // merge with mark_newer_posts. MIGHT CAUSE UNSTABLITY???\r\n//////////        var nof_posts = site2[site.nickname].get_posts(document).length; // works well in static.\r\n//////////        threads[name][8][2] = nof_posts;\r\n//////////        site2[site.nickname].check_reply_to_me(name,dbt,threads[name][19], document, threads[name][8], dummy);\r\n//////////        for (var i=0;i<threads[name][19][4].length;i++) favicon_obj.push([site2[site.nickname].get_post_offsetTop(document,nof_posts-1-i),threads[name][19][4][i]]);\r\n////////\r\n////////        if (threads[name][19][4].length!=0) notifier.changed(name, threads[name][19][4]);\r\n////////      }\r\n////////      if (own_posts_tracker && cataLog.embed_mode!=='thread') own_posts_tracker.update_own_posts(threads[name][19][4],init); // PATCH\r\n//////////      if (own_posts_tracker) own_posts_tracker.update_own_posts(threads[name][19][4],init);\r\n////////    }\r\n\r\n    function mark_posts_from_parent(time){\r\n      ignore_scroll = true;\r\n      if (favicon_obj[0] && favicon_obj[0].time<time) { // not debugged this path, usually doesn't occur.\r\n        var i = 1;\r\n        while (i<favicon_obj.length && favicon_obj[i].time<=time) i++;\r\n        favicon_obj_trim({target:favicon_obj[i-1].pn});\r\n      } else {\r\n        var site_live = site.nickname + ((site2[site.nickname+'_live'])? '_live' : '');\r\n        var th = site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'thread_html',\r\n                   {thread:site.no, parse_funcs:site2[site_live].parse_funcs['thread_html']})[0];\r\n        var end = th.posts.length;\r\n        if (favicon_obj[0]) while (end>0 && th.posts[end-1].time>=favicon_obj[0].time) end--;\r\n        var i=end;\r\n        while (i>0 && th.posts[i-1].time>time) th.posts[--i].pn.addEventListener('mouseover', favicon_obj_trim, false);\r\n        favicon_obj = th.posts.slice(i,end).concat(favicon_obj);\r\n      }\r\n    }\r\n    function updated(new_posts, init){ // called from catalog\r\n      for (var i=new_posts.length-1;i>=0;i--) {\r\n        new_posts[i].pn.addEventListener('mouseover', favicon_obj_trim, false);\r\n        favicon_obj.push(new_posts[i]);\r\n      }\r\n      threads[name][19][1] = (threads[name][19][1]&0xffff0000) + favicon_obj.length;\r\n//      if (new_posts.length!=0) notifier.changed(name, new_posts);\r\n      if (own_posts_tracker) own_posts_tracker.update_own_posts(new_posts,init);\r\n    }\r\n//    function favicon_check_event(){\r\n//      this.removeEventListener('mouseover', favicon_check_event, false);\r\n//      favicon_check();\r\n//    }\r\n    var ignore_scroll = false;\r\n    var ref_height_checked = 0;\r\n    function favicon_check(e){\r\n      if (this===window && ignore_scroll) {ignore_scroll = false; return;}\r\n      if (favicon_obj.length==0) return;\r\n      var ref_height = brwsr.document_body.scrollTop;\r\n      if (ref_height<=ref_height_checked) return;\r\n      else ref_height_checked = ref_height;\r\n      ref_height += window.innerHeight -50;\r\n      favicon_obj_trim(e,ref_height);\r\n    }\r\n    function favicon_obj_trim(e,ref_height){\r\n      var time;\r\n      while (favicon_obj.length!=0) {\r\n        if (ref_height && favicon_obj[0].pn.offsetTop>ref_height) break;\r\n        var tgt = favicon_obj.shift();\r\n        tgt.pn.removeEventListener('mouseover', favicon_obj_trim, false);\r\n        time = tgt.time;\r\n        if (pref['thread'].mark_new_posts) tgt.pn.setAttribute('style','border:none');\r\n        if (e.currentTarget===tgt.pn) break;\r\n      }\r\n      if (time) {\r\n        threads[name][19][1] = favicon_obj.length;\r\n//        threads[name][19][0] = time;\r\n        for (var i=0;i<favicon_obj.length;i++) if (favicon_obj[i].reply_to_me) threads[name][19][1]+=0x10000;\r\n        notifier.favicon.set(threads);\r\n        if (pref.thread_reader.sync && window.opener) send_message('parent',[['TRIAGE',[name,'WATCH','',false,time]]]);\r\n      }\r\n    }\r\n    function mark_newer_posts(time){\r\n      var retval = null;\r\n      var i=0;\r\n      while (i<favicon_obj.length && favicon_obj[i].time < time) i++;\r\n      if (i<favicon_obj.length) retval = favicon_obj[i].pn;\r\n      while (i<favicon_obj.length) {\r\n        favicon_obj[i].marked = true;\r\n//        favicon_obj[i].pn.setAttribute('style','background:yellow');\r\n        favicon_obj[i].pn.setAttribute('style','border:2px solid red');\r\n        i++;\r\n      }\r\n      ignore_scroll = true;\r\n      return retval; // scroll will be done.\r\n    }\r\n\r\n    var triage;\r\n    var buttons = document.createElement('div');\r\n    buttons.innerHTML = '<button name=\"thread_reader.buttons.B\" type=\"button\">B</button>'+\r\n                        '<button name=\"thread_reader.buttons.UB\" type=\"button\">UB</button>'+\r\n                        ((window.opener)? '<button name=\"thread_reader.buttons.X\" type=\"button\">X</button>'+\r\n                                          '<button name=\"thread_reader.buttons.v\" type=\"button\">v</button>'\r\n                                        : '');\r\n    var buttons_collection = buttons.getElementsByTagName('*');\r\n    buttons_collection['thread_reader.buttons.B'].onclick  = function(){common_func.modify_bookmark(name,true)};\r\n    buttons_collection['thread_reader.buttons.UB'].onclick = function(){common_func.modify_bookmark(name,false)};\r\n    if (window.opener) {\r\n      buttons_collection['thread_reader.buttons.X'].onclick = function(){triage_exe('KILL','');};\r\n      buttons_collection['thread_reader.buttons.v'].onclick = function(){triage_exe('TIME','');};\r\n    }\r\n//    var th_link = document.getElementById('thread-links');\r\n//    th_link.parentNode.insertBefore(buttons,th_link);\r\n    var pn_ref = site.embed_to['bottom'];\r\n    pn_ref.parentNode.insertBefore(buttons,pn_ref);\r\n    if (window.opener && pref.thread_reader.triage) {\r\n//      var triage_all = common_func.make_triage({onclick:triage_event, wheelpatch:false});\r\n//      triage_str = triage_all.str;\r\n//      th_link.parentNode.insertBefore(triage_all.pn,th_link);\r\n      triage = new common_func.Triage(pref.catalog_triage_str,{onclick:triage_event, wheelpatch:false, name:'thread_reader_triage'});\r\n      pn_ref.parentNode.insertBefore(triage.pn,pn_ref);\r\n    }\r\n    pref_func.tooltips.add_hier(buttons);\r\n//    pref_func.tooltips.add_hier(triage.pn);\r\n\r\n    function triage_event(){\r\n      var flds = this.name.split(',');\r\n      var i = parseInt(flds[0].replace(/[^\\(]*\\(/,''),10);\r\n      var j = parseInt(flds[1].replace(/\\).*/,''),10);\r\n//      var i = parseInt(flds[0],10);\r\n//      var j = parseInt(flds[1],10);\r\n      triage_exe(triage.str[i][j],triage.str[i][j+2]);\r\n    }\r\n    function triage_exe(com0,com1){\r\n      send_message('parent',[['TRIAGE',[name,com0,com1,true, site2['DEFAULT'].check_reply.get_checked_time(threads[name][19])]]]);\r\n      if (pref.thread_reader.triage_close) window.close();\r\n    }\r\n\r\n//    window.addEventListener('storage', site2[site.nickname].prep_own_posts_event, false); // can't catch events from this thread.\r\n    if (pref.notify.favicon) window.addEventListener('scroll', favicon_check, false);\r\n//    base_thread.addEventListener('DOMSubtreeModified',updated_buf,false);\r\n//    base_thread.addEventListener('DOMNodeInserted',updated_buf,false);\r\n////////    var observer = new MutationObserver(updated_buf);\r\n////////    observer.observe(myself_th.pn, {childList: true});\r\n\r\n//    threads[name][19][3] = --threads[name][19][0];threads[name][19][0]--;updated(); // debug\r\n//    if (site.components.postform_submit) add_event_to_submit(site.components.postform_submit);\r\n    function setup_submit(inst_submit, postform_submit){\r\n      if (!inst_submit && pref.thread_reader.own_posts_tracker && postform_submit) {\r\n        add_event_to_submit(postform_submit);\r\n        inst_submit = postform_submit;\r\n      } else if (inst_submit && (!pref.thread_reader.own_posts_tracker || !postform_submit)) {\r\n        remove_event_from_submit(inst_submit);\r\n        inst_submit = null;\r\n      }\r\n      return inst_submit;\r\n    }\r\n    var inst_submit  = setup_submit(null, site.components.postform_submit);\r\n    var inst_submit2 = setup_submit(null, site.components.postform_submit2);\r\n////////    window.addEventListener('storage', remake_own_posts_flag, false);\r\n    window.addEventListener('storage', site2[site.nickname].check_reply.remake_own_posts, false);\r\n\r\n    return {\r\n      mark_newer_posts: mark_newer_posts,\r\n      destroy : function(){ // destroy\r\n//        base_thread.removeEventListener('DOMSubtreeModified',updated_buf,false);\r\n//        base_thread.removeEventListener('DOMNodeInserted',updated_buf,false);\r\n        observer.disconnect();\r\n////////        window.removeEventListener('storage', remake_own_posts_flag, false);\r\n        window.removeEventListener('storage', site2[site.nickname].check_reply.remake_own_posts, false);\r\n        if (inst_submit ) remove_event_from_submit(inst_submit);\r\n        if (inst_submit2) remove_event_from_submit(inst_submit2);\r\n        return null;\r\n      },\r\n      setup_submit2: function(){inst_submit2 = setup_submit(inst_submit2, site.components.postform_submit2);},\r\n      own_posts_tracker: own_posts_tracker,\r\n      updated: updated,\r\n      mark_posts_from_parent: mark_posts_from_parent,\r\n    }\r\n  }\r\n  function thread_reader_init(){\r\n    if (common_obj.thread_reader===null && site.features.thread_reader && pref.features.thread_reader && site.whereami==='thread' && pref.thread_reader.use) common_obj.thread_reader = make_thread_reader();\r\n    else if (!pref.thread_reader.use && common_obj.thread_reader) common_obj.thread_reader = common_obj.thread_reader.destroy();\r\n  }\r\n//  setTimeout(thread_reader_init,0); // call after making liveTag, and for safety, used setTimeout. (thirad_reader_init contains DOM access, it may fail).\r\n\r\n\r\n\r\n  var liveTag = {\r\n    pn : null,\r\n    pn_board : null,\r\n//    pn_filter_rexp : null,\r\n    active: {pk:0, in:0, ex:0},\r\n    tags_ci: null, // refers tags.__proto__\r\n    tags : Object.create(Object.create(null)),\r\n                                // tags[TAG] = {key:, num;, mems:, cbx:{pk:, in:, ex:}, (tgts:,) pn:, pn_num:, // summary tree\r\n                                //              ur:};\r\n//  mems : Object.create(null), // member tree : mems[domain][boards][no] = [[[],{},' '], [[],{}], threads_name_19];\r\n                                //   [0]:fixed, [1]:bumped, [x][0]:tags, [x][1]:keys, [0][2]:string,\r\n                                //   [2]:threads[name][19]\r\n                                //     [0]:time_of_checked, [1]:num_of_unread_replies_TO_ME, [2]:num_of_unread_replies,\r\n                                //     [3]:time_of_checked_time_internal, [4]:args_for_desktop_notification, [5]:init,\r\n                                //     [6]:time_of_checked_old, [7]:num_of_checked_posts, [8]:inital_loop,\r\n                                //     [9]:tag_temp, [10]:num_of_posts\r\n    mems : Object.create(null, {  //  CAUTION. USED ALWAYS EVEN IF pref.liveTag.use===false\r\n      getFromName: {value: function(name) {\r\n        var dbt = common_func.fullname2dbt(name);\r\n        return (dbt[2])? this[dbt[0]][dbt[1]][dbt[2]] : this[dbt[0]][dbt[1]];}},\r\n//      exist: {value: function(th) {\r\n//        return this[th.domain] && this[th.domain][th.board] && this[th.domain][th.board][th.no];}},\r\n      init: {value: (function(){\r\n        function prep_domain(th){\r\n////        if (this[th.domain]===undefined) this[th.domain] = Object.create(null, {proto:{value:Object.create(this.acc, {domain:{value:th.domain}})}, // working code.\r\n////                                                                                pfunc:{value:Object.create(null)}});\r\n////        if (!th.board) return this[th.domain];\r\n////\r\n////        if (this[th.domain][th.board]===undefined) {\r\n////          this[th.domain][th.board] = Object.create(this[th.domain].proto,\r\n////                                                     {proto:{value:Object.create(this[th.domain].proto,\r\n////                                                                                  {board:{value:th.board},\r\n////                                                                                   btag:{value:'#'+th.board.substr(1,th.board.length-2)}})},\r\n////                                                      nr:{value:0, writable:true}, nrtm:{value:0, writable:true}, nr_dirty:{value:false, writable:true},\r\n////                                                      u:{value:0, writable:true}, board:{value:th.board}, read_time:{value:0, writable:true},\r\n////                                                     });\r\n\r\n          this[th.domain] = Object.create(Object.create(this.acc, {domain:{value:th.domain}}),\r\n                                          {p:{value:Object.create(null)}, // pool of parse_funcs\r\n//                                         u:{value:0, writable:true}, // for 'add_domain'\r\n                                          });\r\n        }\r\n        function prep_board(th){\r\n          var btag = '#'+th.board.substr(1,th.board.length-2);\r\n          if (liveTag.tags[btag] && liveTag.tags[btag].ref_tag === btag) btag = liveTag.tags[btag].ref_tag; // force to use the same reference.\r\n          this[th.domain][th.board] = Object.create(Object.create(Object.getPrototypeOf(this[th.domain]),\r\n                                                                  {board:{value:th.board},\r\n                                                                   btag:{value:btag, writable:true}}),\r\n                                                    {nr:{value:0, writable:true},\r\n                                                     nrtm:{value:0, writable:true},\r\n//                                                     nr_dirty:{value:false, writable:true},\r\n                                                     u:{value:0, writable:true},\r\n//                                                     read_time:{value:0, writable:true},\r\n                                                     o:{value:null, writable:true}, // for 'add_domain' // order\r\n//                                                     f:{value:0, writable:true}, // for 'add_domain'\r\n                                                     p:{value:{}, configurable:true, writable:true}, // pool of parse_funcs\r\n                                                     pgs:{value:null, writable:true}, // for 'add_domain' // max pages\r\n                                                     LS_synced:{value:false, writable:true},\r\n                                                     // s:   for statistics\r\n                                                     // sr:  for statistics\r\n                                                     // srt: for statistics\r\n                                                    });\r\n          if (pref.liveTag.inherit_board_name) {\r\n            liveTag.update_tags_in_th_sub([], {}, [btag], {}, 1, null, 0, this[th.domain][th.board]);\r\n//            liveTag.update_boardlist_1(btag); // for passive virtual boarding. // BUG. don't update new tags.\r\n            liveTag.update_pn_buf.delayed_do();\r\n          }\r\n        }\r\n        function prep_thread(th){\r\n//          this[th.domain][th.board][th.no] = {1:undefined, 2:[0,0,0,0,null,true,-2, 0, true, [], 1],  // init [10] as 1.// working code.\r\n//                                              u:0, no:th.no,\r\n//                                              __proto__:Object.getPrototypeOf(this[th.domain][th.board])};\r\n          var bd = this[th.domain][th.board];\r\n          bd[th.no] = Object.create(Object.getPrototypeOf(bd),{ // 28/324 for 1,2,u,no,tl.\r\n                                                                // 28/240 for 1,2,u,no.\r\n                                                                // 28/236 for 1,2,u,no,tl. (1===null)\r\n                                                                // 28/152 for   2,u,no.\r\n            '1':{value:undefined, writable:true},\r\n            '2':{value:[0x00830000, 0, 0]}, // 16/48 Bytes each. (header/all=header+contents)\r\n////                                               '2':{value:Object.create(this.watch,{ // 4,5,7,9 are shared for reducing memory consumption. // working code. // 28/116 Bytes each.\r\n////                                                 '0':{value:0x00010000, writable:true},\r\n////                                                 '1':{value:0, writable:true},\r\n////                                                 '2':{value:0, writable:true},\r\n//////                                                 '3':{value:0, writable:true},\r\n//////                                                 '6':{value:-2, writable:true},\r\n//////                                                 '8':{value:true, writable:true},\r\n//////                                                 '10':{value:-1, writable:true}\r\n////                                               })},\r\n            u:{value:0, writable:true}, // require 32Bytes/instance, 2.5% memory increase/instance.\r\n            no:{value:th.no, writable:true},\r\n            // s: for statistics\r\n            // th:  thread data, aka th.\r\n            // ta:  live thread, 'posts' contains all live posts.\r\n            // pd:  posts_deleted\r\n            // ed_p: editing posts\r\n            // ed_t: editing tags\r\n          });\r\n//          var btag = bd[th.no].btag; // redundant\r\n//          liveTag.key_dirty[(pref.liveTag.ci)? btag.toLowerCase() : btag] = null;\r\n//          var btag2 = bd[th.no].btag2;\r\n//          if (btag2) for (var i=0;i<btag2.length;i++) liveTag.key_dirty[(pref.liveTag.ci)? btag2[i].toLowerCase() : btag2[i]] = null;\r\n        }\r\n        return function(th) {\r\n          if (this[th.domain]===undefined) prep_domain.call(this,th);\r\n          if (!th.board) return this[th.domain];\r\n          if (this[th.domain][th.board]===undefined) prep_board.call(this,th);\r\n          if (!th.no) return this[th.domain][th.board];\r\n          if (this[th.domain][th.board][th.no]===undefined) prep_thread.call(this,th);\r\n          return this[th.domain][th.board][th.no];\r\n        }\r\n      })()},\r\n//      watch: {value: Object.create(null, {  //'1':{value:undefined, writable:true, configurable:true}, // default value of 1.\r\n//                                          '4':{value:null, writable:true},\r\n//                                          '5':{value:true, writable:true},\r\n//                                          '7':{value:0, writable:true},\r\n//                                          '9':{value:[], writable:true},\r\n//                                         })},\r\n      acc: {value: Object.create(null, {  // to reduce memory consumption.\r\n        0: {\r\n////          get: function() {return (pref.liveTag.inherit_board_name && pref.liveTag.lock_board_name)? [this.btag] : null;}, // working code.\r\n////          set: function(val) {if (!pref.liveTag.inherit_board_name || !pref.liveTag.lock_board_name || val.length>=2) // inherit and lock ensures val.length>=1\r\n////                 Object.defineProperty(this,'0',{value:val, enumerable:true, configurable:true, writable:true}); // works.\r\n//////                 this.mems[this.domain][this.board][this.no]  = [val, this[1], this[2]];\r\n////               },\r\n////        },\r\n          get: function() {\r\n            var tag = this.btags;\r\n            if (this.tl) tag = (tag)? tag.concat(this.tl) : this.tl;\r\n            return tag || [];\r\n          },\r\n          set: function(val) {\r\n            var ref = this.btags;\r\n            if (ref) {\r\n              if (pref.liveTag.ci) for (var i=0;i<ref.length;i++) ref[i] = ref[i].toLowerCase();\r\n              for (var i=0;i<val.length;i++) if (ref.indexOf((pref.liveTag.ci)? val[i].toLowerCase() : val[i])!=-1) val.splice(i--,1);\r\n            }\r\n            if (val.length>0) this.tl = val;\r\n            else if (this.tl!==undefined) delete this.tl;\r\n          },\r\n        },\r\n        t: {get: function(){return this[1];}}, // TEMPORAL\r\n        key: {get: function(){return this.domain + this.board + ((this.no)? this.no : '');}},\r\n        tag: {get: function(){return (this[0] || []).concat(this[1] || []);}},\r\n        tags:{get: function(){return (this[0] || []).concat(this[1] || []);}}, // renaming function. use this later.\r\n//        tag: {get: function(){\r\n//          var tag0 = this[0];\r\n//          var tag1 = this[1];\r\n//          return (tag0 && tag1)? tag0.concat(tag1) : (tag0)? tag0 : (tag1)? tag1 : null;\r\n//        }},\r\n        btags: {get: function(){\r\n          var tag = (pref.liveTag.inherit_board_name && pref.liveTag.lock_board_name)? [this.btag] : null;\r\n          if (pref.liveTag.inherit_board_tags && pref.liveTag.lock_board_tags && this.btag2) tag = (tag)? tag.concat(this.btag2) : this.btag2;\r\n          return tag;}},\r\n        watched:  {get: function(){return  this[2][0]&0x000c0000;}}, // see 'check_reply'\r\n        time_checked: {get: function(){return  this[2][2];}},\r\n        archived: {get: function(){return (this[2][0]&0x00700000) >> 20;},\r\n                   set: function(v){this[2][0] = this[2][0] & 0xff8fffff | ((v&0x07)<<20);}},\r\n        force_ar: {get: function(){return (this[2][0]&0x00700000) >> 22;}}, // init or rescan\r\n        rescan_dp:{get: function(){return (this[2][0]&0x01000000) >> 24;},\r\n                   set: function(v){this[2][0] = this[2][0] & 0xfeffffff | ((v&0x01)<<24);}},\r\n        nrtm:     {get: function(){return (this[2][1]) >> 16;}},\r\n        nr:       {get: function(){return  this[2][1]&0x0000ffff;}},\r\n        nof_posts:{get: function(){return  this[2][0]&0x0000ffff ;},\r\n                   set: function(v){this[2][0] = (this[2][0] & 0xffff0000) + v;}},\r\n      })}\r\n    }),\r\n//    mems_obj_accessors: { // to reduce memory consumption.\r\n//      get 0() {return (this._btag)? ((this._0)? [this.btag].concat(this._0) : [this.btag]) : this._0;}, // _0 is null at initial, and will never back to null after once promoted to [].\r\n//      set 0(val) {if (val[0]===this.btag) {\r\n//                     this._btag = true;\r\n//                     val.shift();\r\n//                   } else this._btag = false;\r\n//                   this._0 = (val.length!=0)? val : null;\r\n//                 }\r\n//    },\r\n    postprocess_board_add_btag: function(tags,bd){\r\n      for (var j=0;j<tags.length;j++) {\r\n        tags[j] = '#'+tags[j].replace(/[&<>'\"#]/g,'');\r\n        if (tags[j].length>pref.liveTag.maxstr) tags.splice(j--,1);\r\n      }\r\n      var flag = bd.btag2 && bd.btag2.length===tags.length;\r\n      if (flag) for (var j=0;j<tags.length;j++) if (tags[j]!==bd.btag2[j]) {flag = false;break;}\r\n      if (!flag) {\r\n        for (var j=0;j<tags.length;j++) if (liveTag.tags[tags[j]] && liveTag.tags[tags[j]].ref_tag===tags[j]) tags[j] = liveTag.tags[tags[j]].ref_tag; // force to use the same pointer to reduce memory consumption.\r\n        Object.defineProperty(Object.getPrototypeOf(bd),'btag2',{value:tags, writable:true});\r\n        if (pref.liveTag.inherit_board_tags) {\r\n          liveTag.inherit_board_tags_changed_1(tags, bd);\r\n//          for (var j=0;j<tags.length;j++) liveTag.update_boardlist_1(tags[j]); // for passive virtual boarding. // BUG. don't update new tags.\r\n//          for (var j=0;j<tags.length;j++) liveTag.update_pn_buf.delayed_do(); // called in liveTag.inherit_board_tags_changed_1\r\n        }\r\n      }\r\n    },\r\n    retag: function(lth, scan){\r\n      if (scan) {\r\n        scan.list_nup.add_scan(lth);\r\n        lth[2][0] |= 0x00020000;\r\n      }\r\n      var th = {com:lth.tags.join(' '), parse_funcs:{type_com:'txt'}, __proto__:lth}; // patch\r\n      liveTag.prep_tags(th, lth.tag); // lth.tag returns a shallow copy, this is ok.\r\n      if (cataLog.threads[lth.key]) cataLog.insert_footer3(lth.key,null,null,lth);\r\n    },\r\n    retag_db: DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(function(){if (cataLog.catalog_filter_changed) cataLog.catalog_filter_changed();}, 10)),\r\n    inherit_board_name_changed: function(){\r\n      for (var d in this.mems) for (var b in this.mems[d]) this.inherit_board_tags_changed_1([this.mems[d][b].btag], this.mems[d][b], !pref.liveTag.inherit_board_name);\r\n    },\r\n    inherit_board_tags_changed: function(){\r\n      for (var d in this.mems) for (var b in this.mems[d]) if (this.mems[d][b].btag2) this.inherit_board_tags_changed_1(this.mems[d][b].btag2, this.mems[d][b], !pref.liveTag.inherit_board_tags);\r\n    },\r\n    inherit_board_tags_changed_1: function(tags, bd, remove){\r\n      for (var i=0;i<tags.length;i++) this.retag_in_th_sub(tags[i], bd, remove); // must before 'this.retag'.\r\n      for (var j in bd) {\r\n        var th_key = bd.domain + bd.board + bd[j].no;\r\n        this.retag(bd[j], remove && bd[j].tag.length >= pref.liveTag.max);\r\n      }\r\n      this.retag_db();\r\n      this.update_pn_buf.delayed_do();\r\n    },\r\n    ex_list_changed: function(){ // on demand remove only. When you remove a piece of list, reload is required.\r\n      if (pref.liveTag.ex_list) {\r\n        for (var d in this.mems) for (var b in this.mems[d]) for (var t in this.mems[d][b]) {\r\n          var lth = this.mems[d][b][t];\r\n          var tags_len = lth.tag.length;\r\n          if (this.exclude_tags(d+b+t, lth, true)) this.retag(lth, tags_len>=pref.liveTag.max);\r\n////          if (scan.list_nup[th.key]===undefined) {\r\n////            var ex_list = pref_func.merge_obj5(d+b+t,pref.liveTag.ex_list_obj5,null);\r\n////            if (ex_list) {\r\n////              var flag = false;\r\n////              var tag = this.mems[d][b][t];\r\n////              for (var k=0;k<ex_list.length;k++) { // CAUTION. LIMIT CHANGABLE TAG OR ISSUE REDUNDANT ACCESS.\r\n////                for (var j=0;j<2;j++) {\r\n////                  if (tag[j]) for (var i=0;i<tag[j].length;i++) if (ex_list[k].test(tag[j][i])) {\r\n////                    this.delete_tags(tag[j][i],d+b+t);\r\n////                    tag[j].splice(i--,1);\r\n////                    flag = true;\r\n////                  }\r\n////                }\r\n////              }\r\n////              if (flag) {\r\n////                scan.list_nup[d+b+t]=3;\r\n////                tag[2][9] = 'retag';\r\n////              }\r\n////            }\r\n////          }\r\n        }\r\n////        cataLog.catalog_liveTag_scan_threads_delayed_do();\r\n//        this.update_pn_buf.delayed_do();\r\n      }\r\n    },\r\n    exclude_tags: function(key, tag, remove){\r\n      var ex_list = pref_func.merge_obj5a(key,pref.liveTag.ex_list_obj5,null);\r\n      if (ex_list) {\r\n        var flag = false;\r\n        for (var k=0;k<ex_list.length;k++) { // CAUTION. LIMIT CHANGABLE TAG OR ISSUE REDUNDANT ACCESS.\r\n          for (var j=0;j<2;j++) {\r\n            if (tag[j]) for (var i=tag[j].length-1;i>=0;i--) if (ex_list[k].test(tag[j][i])) {\r\n//            if (tag[j]) for (var i=0;i<tag[j].length;i++) if (ex_list[k].test(tag[j][i])) { // BUG, cause infinite loop when ex_list refers btag(board's tag).\r\n              if (remove) this.delete_tags(tag[j][i],key);\r\n              tag[j].splice(i,1);\r\n//              tag[j].splice(i--,1);\r\n              flag = true;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return flag;\r\n    },\r\n    key_dirty_creation: Object.create(Object.create(null)),\r\n    key_dirty: null, // {__proto__:key_dirty_creation},\r\n////    tags_mems: Object.create(null, { // working code.\r\n////      keys_obj: {get: function(){ // working code.\r\n////        var keys = Object.create(null);\r\n////        for (var i in this) {\r\n////////////if (!pref.test_mode['23']) { // test_mode['23'] is meaningless, because String is handled by reference.\r\n////////////          var val = this[i];\r\n////////////} else {\r\n////////////          var val = this.search_from_dic(this[i]);\r\n////////////}\r\n////          if (i[i.length-1]==='/') {\r\n////            var dbt = common_func.fullname2dbt(i);\r\n////            for (var j in liveTag.mems[dbt[0]][dbt[1]]) keys[i+j] = this[i];\r\n////          } else keys[i] = this[i];\r\n////        }\r\n////        return keys;\r\n////      }},\r\n////      keys_length: {get: function(){\r\n////        var len = 0;\r\n////        for (var i in this) {\r\n////          if (i[i.length-1]==='/') {\r\n////            var dbt = common_func.fullname2dbt(i);\r\n////            len += Object.keys(liveTag.mems[dbt[0]][dbt[1]]).length;\r\n////          } else len++;\r\n////        }\r\n////        return len;\r\n////      }},\r\n////////////      search_from_dic: {value: function(no){for (var i in this.dic) if (this.dic[i]==no) return i;}},\r\n////////////      clean_up_dic: {value: function(){\r\n////////////        var keys = {};\r\n////////////        for (var i in this) keys[this[i]] = null;\r\n////////////        for (var i in this.dic) if (keys[this.dic[i]]!==null) delete this.dic[i];\r\n////////////      }},\r\n////    }),\r\n    tags_array_old : [],\r\n    tags_proto: {pk:false, in:false, ex:false, pn:null,\r\n      mems_keys_obj: function(){ // working code.\r\n        var keys = {};\r\n        for (var i of this.mems.keys())\r\n          if (i.no===undefined) for (var j in i) keys[i[j].key] = this.mems.get(i);\r\n          else keys[i.key] = this.mems.get(i);\r\n        return keys;\r\n      },\r\n      mems_keys: function*(){ // iterator is slow in chome because iterator is not optimized.\r\n        for (var i of this.mems.keys())\r\n          if (i.no===undefined) for (var j in i) yield i[j];\r\n          else yield i;\r\n      },\r\n      mems_keys_length: function(){\r\n        var len = 0;\r\n        for (var i of this.mems.keys())\r\n//          if (i.no===undefined) len += Object.keys(i).length; // slow???\r\n          if (i.no===undefined) for (var j in i) ++len;\r\n          else ++len;\r\n        return len;\r\n      },\r\n      mems_keys_length_and_set_top: function(){\r\n        var len = 0;\r\n        var keys = {};\r\n        for (var i of this.mems.keys()) {\r\n          var key = this.mems.get(i);\r\n          if (keys[key]===undefined) keys[key] = 0;\r\n          if (i.no===undefined) for (var j in i) {++keys[key];++len;} // working code.\r\n          else {++keys[key];++len;}\r\n//          if (i.no===undefined) {\r\n//            if (Object.keys(i).length===0) {++keys[key];++len;} // TEST for passive virtual boarding. // TEMPORAL PATCH // empty boards goes high.\r\n//            if (Object.keys(i).length===0) {if (len===0) {++keys[key];++len;}} // TEST for passive virtual boarding. // TEMPORAL PATCH // tag which has only 1 thread goes down.\r\n//            else for (var j in i) {++keys[key];++len;}\r\n//          } else {++keys[key];++len;}\r\n        }\r\n        for (var j in keys) if (keys[j]>keys[this.key] || (keys[j]==keys[this.key] && j<this.key)) this.key = j;\r\n        if (this.key===this.ref_tag) this.key = this.ref_tag; // get the same reference to reduce memory consumption.\r\n        return len;\r\n      },\r\n      mems_boards: function(){\r\n        var tgts = {};\r\n        for (var j of this.mems.keys()) tgts[j.key.substr(0,j.key.lastIndexOf('/')+1)]=null;\r\n        return tgts;\r\n      },\r\n    },\r\n    scan_regex : /#[^#, \\.:;\\n\\|\"<>&]+(?=[#, \\.:;\\n\\|\"<>&]|$)/g, // ATTENTION. REFER function prep_tag_str();\r\n////    update_tags_in_th_sub: function(tags, keys, src, keys_fix, num, th, ur, btag){ // working code for obj.\r\n////      var count = tags.length;\r\n////      var i = 0;\r\n////      while (count<num && i<src.length) {\r\n////        var k = src[i++];\r\n////        var k_ci = (pref.liveTag.ci)? k.toLowerCase() : k;\r\n////        if (k_ci===k) k_ci=k; // to reduce memory consumption.\r\n////        if (keys_fix[k_ci]===undefined) {\r\n////          if (keys[k_ci]===undefined) {\r\n////            keys[k_ci] = k; // discarded every time, so needless to think about reference of 'k'.\r\n//////            tags[count++] = k;\r\n////            if (this.tags[k]===undefined) {\r\n////              if (this.tags_ci[k_ci]===undefined) {\r\n////////////if (!pref.test_mode['23']) {\r\n////                this.tags_ci[k_ci] = {key:k, mems:Object.create(this.tags_mems), ref_tag:k,\r\n//////                                    pk:false, in:false, ex:false, // moved to prototype\r\n////                                      pn:null, pn_num:0, ur:ur, __proto__:this.tags_proto};\r\n////////////} else {\r\n////////////                this.tags[k] = {key:k, mems:Object.create(this.tags_mems, {dic:{value:{}, writable:true}, dic_no:{value:0, writable:true}}),\r\n////////////                                cbx:{pk:false, in:false, ex:false}, pn:null, pn_num:0, ur:ur};\r\n////////////}\r\n////                if (this.tags[k]===undefined) this.tags[k] = this.tags_ci[k_ci];\r\n////              } else this.tags[k] = this.tags_ci[k_ci];\r\n//////              this.tags[k].tgts[k] = null;\r\n////            }\r\n////////            this.tags[k].mems[name] = k;\r\n////            var mems = this.tags[k].mems;\r\n////////////if (!pref.test_mode['23']) {\r\n////////////            var val = k;\r\n////////////} else {\r\n////////////            if (mems.dic[k]===undefined) {mems.dic[k]=mems.dic_no++;} // to reduce memory consumption, use dictionary.\r\n////////////            var val = mems.dic[k];\r\n////////////}\r\n////            if (k===this.tags[k].ref_tag) k = this.tags[k].ref_tag; // get the same reference to reduce memory consumption. This makes major of members see 'btag'.\r\n////            else for (var j in mems) if (k===mems[j]) {k=mems[j]; break;}\r\n////            if (k!==btag) {\r\n////              if (mems[th.key]!==k) this.key_dirty[k_ci] = null; // cases are changed or a new tag is added. 'if (keys[k_ci]!==k)' ensures (pref.liveTag.ci===true).\r\n////              mems[th.key] = k; // write always to force to use the same reference to reduce memory.\r\n////            }\r\n////            tags[count++] = k;\r\n////          }  // else if (keys[k_ci]!==k) this.tags[this.tags_ci[k_ci]].key_dirty = true; // case is changed. 'if (keys[k_ci]!==k)' ensures (pref.liveTag.ci===true).\r\n////        }\r\n////      }\r\n////      return i;\r\n////    },\r\n    update_tags_in_th_sub: function(tags, keys, src, keys_fix, num, th, ur, bd, clean){\r\n      var count = tags.length;\r\n      var i = 0;\r\n      while (count<num && i<src.length) {\r\n        var k = src[i++];\r\n        var k_ci = (pref.liveTag.ci)? k.toLowerCase() : k;\r\n        if (k_ci===k) k_ci=k; // to reduce memory consumption.\r\n        if (keys_fix[k_ci]===undefined) {\r\n          if (keys[k_ci]===undefined) {\r\n            keys[k_ci] = k; // discarded every time, so needless to think about reference of 'k'.\r\n            if (this.tags[k]===undefined) {\r\n              if (this.tags_ci[k_ci]===undefined) {\r\n////                this.tags_ci[k_ci] = {key:k, mems: new Map(), ref_tag:k, // not optimized\r\n////                                      pn:null, pn_num:0, ur:ur, __proto__:this.tags_proto};\r\n                var mems_map = new Map(); // consumes 16 Bytes per content, but I can't reduce.... If this is changed to Set, 2.5% reduce in 8chan, but 0.5% in 4chan.(estimated)\r\n                this.tags_ci[k_ci] = {key:k, mems: mems_map, ref_tag:k, // optimized in V8\r\n                                      num:0, ur:ur, __proto__:this.tags_proto};\r\n//                                      pn:null, pn_num:0, ur:ur, __proto__:this.tags_proto};\r\n                if (k!==k_ci) this.tags[k] = this.tags_ci[k_ci]; // this is equiavlent to 'if (this.tags[k]===undefined)' because this.tags.__proto__ === this.tags_ci\r\n                this.key_dirty_creation[k_ci] = null; // for pickup in 'update_pn'\r\n//                if (pref.debug_mode['3']) console.log('Added: '+k);\r\n              } else this.tags[k] = this.tags_ci[k_ci];\r\n            } // 'else' isn't required because this.tags.__proto__ === this.tags_ci\r\n            var mems = this.tags[k].mems;\r\n            if (k===this.tags[k].ref_tag) k = this.tags[k].ref_tag; // get the same reference to reduce memory consumption. This makes major of members see 'btag'.\r\n            else for (var j in mems) if (k===mems.get(j)) {k=mems.get(j); break;}\r\n//            if (k!==btag) {\r\n            if (!mems.has(bd)) {\r\n              var me = (th===null)? bd : bd[th.no];\r\n              var val = mems.get(me);\r\n              if (val===undefined || val!==k) this.key_dirty[k_ci] = null; // a new tag is added or cases are changed. 'if (keys[k_ci]!==k)' ensures (pref.liveTag.ci===true).\r\n              mems.set(me,k); // write always to force to use the same reference to reduce memory.\r\n            } else if (!clean) this.key_dirty[k_ci] = null; // board tag is hit. Case may be changed in case of board tag.\r\n            tags[count++] = k;\r\n          }\r\n        }\r\n        if (th===null) {\r\n          if (this.tags_reserved[k_ci]!==undefined || this.tags_ci[k_ci]['pk']) this.tags_reserved_found_scan(k_ci, true, this.tags_reserved[k_ci], this.tags_ci[k_ci]['pk'], bd);\r\n        } else if (this.tags_reserved[k_ci]!==undefined) this.tags_reserved_found(k_ci, true, this.tags_reserved[k_ci]);\r\n      }\r\n      return i;\r\n    },\r\n    retag_in_th_sub: function(tag, bd, remove){\r\n      if (remove) {\r\n        if (this.tags[tag]) this.delete_tags(tag, bd.key, true);\r\n      } else { // consolidate\r\n        this.update_tags_in_th_sub([], {}, [tag], {}, 1, null, 0, bd);\r\n        var mems = this.tags[tag].mems;  \r\n        for (var t in bd) if (mems.has(t)) mems.delete(t);\r\n      }\r\n    },\r\n    update_tags_in_th: function(src_new, src_old, keys_fix, num, th, watch, bd){\r\n      var ur = this.generate_ur(watch[1]); // moved to here from 'extract_tags' because 'prep_tags' needs this when it has tags_old.\r\n      var tags = [];\r\n      var keys = {};\r\n      this.update_tags_in_th_sub(tags, keys, src_new, keys_fix, num, th, ur, bd);\r\n      if (src_old) {\r\n        var i = this.update_tags_in_th_sub(tags, keys, src_old, keys_fix, num, th, ur, bd);\r\n        while (i<src_old.length) {\r\n          var k = src_old[i++];\r\n          var k_ci = (pref.liveTag.ci)? k.toLowerCase() : k;\r\n          if (keys_fix[k_ci]===undefined) {\r\n            if (keys[k_ci]!==k) this.key_dirty[k_ci] = null; // case is changed, or removed. 'if ((k_ci in keys) && keys[k_ci]!==k)' ensures (pref.liveTag.ci===true).\r\n            if (keys[k_ci]===undefined) this.delete_tags(k,th.key);\r\n          }\r\n        }\r\n      }\r\n      for (var i in keys_fix) this.check_update_tags_color(keys_fix[i],ur);\r\n      for (var i=0;i<tags.length;i++) this.check_update_tags_color(tags[i],ur);\r\n//      this.update_pn();\r\n//      this.update_pn_buf.delayed_do();\r\n//      return [tags, keys, false];\r\n      src_new = null;\r\n      this.keys_fix = keys;\r\n      return tags;\r\n    },\r\n    remove_tags_in_th: function(dbt){\r\n      var tags = this.mems[dbt[0]][dbt[1]][dbt[2]];\r\n      if (!tags) return;\r\n      var name = dbt[0]+dbt[1]+dbt[2];\r\n      for (var j=0;j<2;j++) if (tags[j]) for (var i=tags[j].length-1;i>=0;i--) this.delete_tags(tags[j][i],name);\r\n//      var btag = this.mems[dbt[0]][dbt[1]][dbt[2]].btag;\r\n//      this.key_dirty[this.tags_ci[(pref.liveTag.ci)? btag.toLowerCase() : btag].key] = null;\r\n      var btags = this.mems[dbt[0]][dbt[1]][dbt[2]].btags;\r\n      if (btags) for (var i=0;i<btags.length;i++) this.key_dirty[(pref.liveTag.ci)? btags[i].toLowerCase() : btags[i]] = null;\r\n      if (pref3.stats.use) stats.thread_removed(dbt);\r\n      if (pref.test_mode['65']) if (pref.archive.IDB) IDB.req(dbt[0], dbt[1], dbt[2], 'pruned_time', Date.now(), 'put_if');\r\n      if (pref.test_mode['65']) if (pref.archive.IDB) IDB.req(dbt[0], dbt[1], dbt[2], null, null, 'check_clean');\r\n      if (pref.test_mode['67']) archiver.clean_list(dbt[0], dbt[1], dbt[2]);\r\n      delete this.mems[dbt[0]][dbt[1]][dbt[2]];\r\n      this.update_pn_buf.delayed_do();\r\n//      if (pref.debug_mode['3']) console.log('remove: '+name);\r\n//      if (pref.debug_mode['3']) {\r\n////        var th_count = 0;\r\n////        for (var d in this.mems) for (var b in this.mems[d]) for (var t in this.mems[d][b]) th_count++;\r\n////        console.log('remove: '+name+', '+tags.tag+', tags_ci+tags: '+Object.keys(this.tags_ci).length+'+'+Object.keys(this.tags).length+', threads:'+th_count);\r\n//        for (var i in this.tags_ci) for (var j of this.tags_ci[i].mems.keys()) if (j===tags) console.log('ERROR: tags_ci['+i+'].mems has a reference to a deleted thread.');\r\n//      }\r\n    },\r\n    delete_tags: function(tag,name, buffered_deletion){\r\n//      delete this.tags[tag].mems[name];\r\n      this.key_dirty[(pref.liveTag.ci)? tag.toLowerCase() : tag] = null;\r\n      if (this.tags[tag]) {\r\n        this.tags[tag].mems.delete(this.mems.getFromName(name));\r\n        if (pref.liveTag.style) this.update_ur_1(tag);\r\n//      if (Object.keys(this.tags[tag].mems).length==0) {\r\n        if (this.tags[tag].mems.size==0) {\r\n//          if (this.tags[tag].pn!==null) this.pn.removeChild(this.tags[tag].pn); // CAUSE ERROR, WHY???\r\n          if (this.tags[tag].pn!==null) if (this.tags[tag].pn.parentNode===this.pn) this.pn.removeChild(this.tags[tag].pn);\r\n//          delete this.tags[tag].tgts[tag];\r\n          for (var i in this.active) if (this.tags[tag][i]) this.active[i]--;\r\n          delete this.tags[tag];\r\n//          if (pref.liveTag.ci) for (var i in this.tags) if (!this.tags[i]) delete this.tags[i]; // tags are not removed in 'update_tags_in_th_sub' if cases are changed.\r\n          var tag_ci = (pref.liveTag.ci)? tag.toLowerCase() : tag;\r\n//          for (var i in this.tags) if (this.tags[i]===this.tags_ci[tag_ci]) delete this.tags[i]; // TOO SLOW\r\n          if (!buffered_deletion) { // BUFFERED DELETION MUST BE EXECUTED ATOMICALLY, NO ACCESS TO this.taga BEFORE EXECUTION OF DELETION IS NOT ALLOWED.\r\n            var keys_tags = Object.keys(this.tags);\r\n            var tags_ci_obj = this.tags_ci[tag_ci];\r\n            for (var i=0;i<keys_tags.length;i++) if (this.tags[keys_tags[i]]===tags_ci_obj) delete this.tags[keys_tags[i]];\r\n            if (this.tags_ci[tag_ci].pn) this.pn.removeChild(this.tags_ci[tag_ci].pn);\r\n            delete this.tags_ci[tag_ci];\r\n          } else {\r\n            if (!this.delete_tags_buffered_list) this.delete_tags_buffered_list = new Set();\r\n            this.delete_tags_buffered_list.add(this.tags_ci[tag_ci]);\r\n          }\r\n          if (pref.debug_mode['3']) console.log('Remove: '+tag);\r\n        }\r\n      }\r\n    },\r\n    delete_tags_buffered_list: null,\r\n    delete_tags_buffered: function(){\r\n      var keys_tags = Object.keys(this.tags);\r\n      for (var i=0;i<keys_tags.length;i++) if (this.delete_tags_buffered_list.has(this.tags[keys_tags[i]])) delete this.tags[keys_tags[i]];\r\n      for (var i in this.tags_ci) if (this.delete_tags_buffered_list.has(this.tags_ci[i])) {\r\n        if (this.tags_ci[i].pn) this.pn.removeChild(this.tags_ci[i].pn);\r\n        delete this.tags_ci[i];\r\n      }\r\n      this.delete_tags_buffered_list = null;\r\n    },\r\n    check_update_tags_color: function(tag, ur){ // checks 0->1 only.\r\n      var ur_old = this.tags[tag].ur;\r\n      this.tags[tag].ur |= ur;\r\n//      if (pref.debug_mode['4']) if (ur_old!=ur) console.log('ur: '+tag+', '+ur_old+' <- '+ur);\r\n      if (~ur_old & ur) this.update_tag_node(tag);\r\n    },\r\n    rm_404: function(domain, board, nos){\r\n      if (this.mems[domain] && this.mems[domain][board]) {\r\n        var mems = this.mems[domain][board];\r\n        var db = domain + board;\r\n        for (var i in mems) if (!((db+i) in nos)) this.rm_404_1(domain, board, i);\r\n      }\r\n    },\r\n    rm_404_1: function(domain, board, no){\r\n      cataLog.remove_thread(domain+board+no);\r\n      this.remove_tags_in_th([domain,board,no]);\r\n      if (pref[cataLog.embed_mode].deleted_posts.auto_clean) site2[domain].clean_up_deleted_posts_1(board + no);\r\n    },\r\n//    find_friend_tag_ci: function(tag){\r\n//      var tag_l = tag.toLowerCase();\r\n//      for (var i in liveTag.tags) if (tag!==i && tag_l===liveTag.tags[i].key.toLowerCase()) return i;\r\n//      return null;\r\n//    },\r\n    tooltip: function(e, str){\r\n      var tag;\r\n      var et = e.target;\r\n      if (et.type==='checkbox') {\r\n        var suffix = et.name.substr(-2,2);\r\n        tag = et.getAttribute('name').slice(0,-3);\r\n        str += ((suffix==='pk')? 'Pick up' :\r\n                (suffix==='in')? 'Show' : 'Hide')\r\n             + ' threads which have ' + tag + '.'\r\n      } else {\r\n        tag = et.getAttribute('name');\r\n        str += tag + ': ' + liveTag.make_info(tag) +'<br>';\r\n//        for (var i in liveTag.tags[tag].mems) str += i + ', ';\r\n        var myDomain = new RegExp('^'+site.nickname);\r\n        for (var i of liveTag.tags[tag].mems.keys()) str += i.key.replace(myDomain,'') + ', ';\r\n      }\r\n      pref_func.tooltips.show_1.call(et, e, str, null, et.type!=='checkbox');\r\n    },\r\n    boardlist_click_entry: function(e){\r\n      if (!e.ctrlKey) {\r\n        e.preventDefault();\r\n        var tag = this.textContent;\r\n        liveTag.cbx_changed(tag, pref.liveTag.click_func_bl, null, this);\r\n      }\r\n    },\r\n    generate_ur: function(info){\r\n      return ((info>>16)!=0)? 3 : ((info&0x0000ffff)!=0)? 1 : 0;\r\n    },\r\n    CountNR: (function(){\r\n// [ForInStatement is not fast case]\r\n// http://www.html5rocks.com/en/tutorials/performance/mystery/?redirect_from_locale=ja\r\n      var CountNR = function(){\r\n        this.nrtm = 0;\r\n        this.nr   = 0;\r\n        this.nth  = 0;\r\n      }\r\n      CountNR.prototype = {\r\n        count: function(th){\r\n          if (th[0]&0x000c0000) {\r\n            var nr = th[1]&0x0000ffff;\r\n            if (nr) {\r\n              this.nrtm += th[1]>>16;\r\n              this.nr   += nr;\r\n              this.nth++;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return CountNR;\r\n    })(),\r\n    update_ur: function(name,ur,all_case){\r\n      var dbt = common_func.fullname2dbt(name);\r\n      var tag = this.mems[dbt[0]][dbt[1]][dbt[2]];\r\n      this.mems[dbt[0]][dbt[1]].nr = -1;\r\n//      var tag = this.mems.getFromName(name);\r\n      for (var j=0;j<2;j++) if (tag[j]) for (var i=0;i<tag[j].length;i++) \r\n        if (!all_case) {if (this.tags[tag[j][i]]) this.check_update_tags_color(tag[j][i],ur);}\r\n        else this.update_ur_1(tag[j][i]);\r\n    },\r\n    update_ur_1: function(tag){ // subfunc of 'count_ur'\r\n      var ur_old = this.tags[tag].ur;\r\n      var ur = 0;\r\nif (!pref.test_mode['24']) {\r\n      var mems_objs = this.tags[tag].mems_keys_obj(); // working code.\r\n      for (var i in mems_objs) {\r\n//        var info = this.mems.getFromName(i)[2];\r\n        var info = this.mems.getFromName(i);\r\n        if (info) ur |= liveTag.generate_ur(info[2][1]);\r\n      }\r\n} else {\r\n      for (var i of this.tags[tag].mems_keys())\r\n        ur |= liveTag.generate_ur(i[2][1]);\r\n}\r\n      if (ur_old!=ur) {\r\n        this.tags[tag].ur = ur;\r\n        this.update_tag_node(tag);\r\n      }\r\n    },\r\n//    count_ur: function(tag){\r\n//      var nums = this.count_ur_sub(tag);\r\n//      var friends = Object.create(null);\r\n//      friends[tag] = null;\r\n//      if (pref.liveTag.ci) {\r\n//        var tag_l = tag.toLowerCase();\r\n//        for (var i in liveTag.tags) {\r\n//          if (tag!==i && tag_l===liveTag.tags[i].key.toLowerCase()) {\r\n//            friends[i]=null;\r\n//            if (this.tags[i].ur_cs===null) this.count_ur_sub(i);\r\n//            for (var j=0;j<4;j++) nums[j] += this.tags[i].ur_cs[j];\r\n//          }\r\n//        }\r\n//      }\r\n//      for (var i in friends) this.tags[i].ur = nums;\r\n//      return nums;\r\n//    },\r\n//    count_ur_sub: function(tag){\r\n    count_ur: function(tag){\r\n      var nof_th = 0;\r\n      var bds = {};\r\n      var counter = new this.CountNR();\r\nif (!pref.test_mode['24']) {\r\n      var mems_objs = this.tags[tag].mems_keys_obj(); // working code.\r\n      for (var i in mems_objs) {\r\n        var dbt = common_func.fullname2dbt(i);\r\n        var info = this.mems[dbt[0]][dbt[1]][dbt[2]][2];\r\n        if (info) counter.count(info);\r\n        bds[dbt[0]+dbt[1]] = null;\r\n      }\r\n      nof_th = this.tags[tag].mems_keys_length();\r\n} else {\r\n      for (var i of this.tags[tag].mems_keys()) {\r\n        counter.count(i[2]);\r\n        bds[i.domain+i.board] = null;\r\n        nof_th++;\r\n      }\r\n}\r\n      var nof_bds = Object.keys(this.tags[tag].mems_boards()).length;\r\n      return [counter.nrtm, counter.nr, counter.nth, nof_th, Object.keys(bds).length, nof_bds];\r\n    },\r\n    make_info: function(tag){\r\n      var nums = liveTag.count_ur(tag); // must exec every time because every update are NOT exact.\r\n      return 'U: '+nums[0]+'/'+nums[1]+'/'+nums[2]+' / T: '+nums[3]+' / B: '+nums[4]+'/'+nums[5];\r\n    },\r\n    tag_onmouseover: function(e){\r\n      if (pref.liveTag.show_info_onmouseover) pref_func.tooltips.show_1.call(this,e, liveTag.make_info(this.textContent), null, true);\r\n    },\r\n    cbx_changed: function(tag, func, no_scan, node_in_boardlist){\r\n      if (func==='pkin') {\r\n        if (this.tags[tag]['pk'] !== !this.tags[tag]['in']) {\r\n          this.tags[tag]['pk'] = !this.tags[tag]['in'];\r\n          if (this.tags[tag].pn!==null) this.tags[tag].pn.childNodes[0].checked = this.tags[tag]['pk'];\r\n          this.cbx_onchange(tag,'pk', no_scan); // 'in' is upped automatically when pk goes 0 -> 1.\r\n        }\r\n        if (this.tags[tag]['in'] !== this.tags[tag]['pk']) {\r\n          this.tags[tag]['in'] = this.tags[tag]['pk'];\r\n          if (this.tags[tag].pn!==null) this.tags[tag].pn.childNodes[1].checked = this.tags[tag]['in'];\r\n          this.cbx_onchange(tag,'in');\r\n        }\r\n      } else {\r\n        var in_old = this.tags[tag]['in'];\r\n        if (func==='in' || (func==='inex' && !(this.tags[tag]['in']===false && this.tags[tag]['ex']===true))) {\r\n          this.tags[tag]['in'] = !this.tags[tag]['in'];\r\n          if (this.tags[tag].pn!==null) this.tags[tag].pn.childNodes[1].checked = this.tags[tag]['in'];\r\n          this.cbx_onchange(tag,'in');\r\n        }\r\n        if (func==='ex' || (func==='inex' && !(in_old===false && this.tags[tag]['ex']===false))) {\r\n          this.tags[tag]['ex'] = !this.tags[tag]['ex'];\r\n          if (this.tags[tag].pn!==null) this.tags[tag].pn.childNodes[2].checked = this.tags[tag]['ex'];\r\n          this.cbx_onchange(tag,'ex');\r\n        }\r\n      }\r\n      this.update_tag_node(tag, node_in_boardlist);\r\n    },\r\n//    filter_onchange_entry : function(e){liveTag.filter_onchange(this, e);},\r\n    filter_onchange: function(pref_obj, init){\r\n      pref_obj.rexps = common_func.kwd_prep_regexp(pref_obj);\r\n//      this.pn_filter_rexp = (pref.catalog.filter.tag_search.str==='')? null : new RegExp(pref.catalog.filter.tag_search.str, (pref.liveTag.ci)? 'i': undefined);\r\n////      for (var i in this.tags) // working code.\r\n////        if (this.tags[i].pn!==null) this.tags[i].pn.style.display = (this.pn_filter_rexp===null || this.pn_filter_rexp.test(i))? '' : 'none';\r\n      if (!init) this.update_pn(pref_obj === pref.catalog.filter.tag_search);\r\n    },\r\n////    set_reserved_tags: function(tags,set){ // working code\r\n////      for (var i=0;i<tags.length;i++) {\r\n////        var tag = tags[i];\r\n////        var tag_ci = (pref.liveTag.ci)? tag.toLowerCase() : tag;\r\n////        if (this.tags_ci[tag_ci]) {\r\n////          if (this.tags_ci[tag_ci]['pk']!=set) this.cbx_changed(tag_ci,'pkin', true);\r\n////          this.update_tag_node(tag_ci);\r\n////          tags.splice(i--,1);\r\n////        }\r\n////      }\r\n////    },\r\n    tags_reserved: Object.create(null),\r\n    tags_reserved_found_scan: function(tag_ci,set, func_pk, pk, bd){\r\n      if (func_pk || pk) {\r\n        scan.list_nup.add_board(bd,0);\r\n        scan.scan('b',bd.domain);\r\n      }\r\n      if (func_pk!==undefined) this.tags_reserved_found(tag_ci,set, func_pk);\r\n    },\r\n    tags_reserved_found: function(tag_ci,set, func_pk){\r\n      if (this.tags_ci[tag_ci][(func_pk)?'pk':'in']!=set) this.cbx_changed(tag_ci,(func_pk)?'pkin':'in', true);\r\n      delete this.tags_reserved[tag_ci];\r\n    },\r\n    tags_reserved_init: function(tags,set){\r\n      this.tags_reserved = Object.create(null);\r\n      var bds_pickup = {};\r\n      for (var i=0;i<tags.length;i++) {\r\n        var tag_pk = tags[i][1]==='#'; // ##tag for 'pkin', #tag for 'in'\r\n        var tag_ci = (pref.liveTag.ci)? tags[i].toLowerCase() : tags[i]; // tags_ci must be used becase tags in blist is raw, the tag may not exist in liveTag.tags[tag].\r\n        if (tag_pk) tag_ci = tag_ci.substr(1);\r\n        if (this.tags_ci[tag_ci]) {\r\n          this.tags_reserved_found(tag_ci,set,tag_pk);\r\n          if (set && tag_pk) {\r\n            var bds = liveTag.tags_ci[tag_ci].mems_boards();\r\n            for (var bd in bds) bds_pickup[bd] = null;\r\n          }\r\n        } else if (set) this.tags_reserved[tag_ci] = tag_pk;\r\n      }\r\n      return bds_pickup;\r\n    },\r\n    update_pn_last_filter_active: false,\r\n    sort_func: function(a,b){return b.num - a.num || b.mems.size - a.mems.size || ((b.key > a.key)? -1:1);},\r\n    update_pn_disp_func: function(rexps, key){\r\n      if (rexps===null) return 0;\r\n      for (var i=0;i<rexps.length;i++) if (rexps[i].test(key)) return 1; // match any\r\n      return 0;\r\n    },\r\n    update_pn_buf: null,\r\n    update_pn : function(from_filter){\r\n      if (this.pn===0) return; // trap for thread_reader.\r\n      if (this.pn===null) {\r\n        this.pn = document.getElementsByName('catalog.filter.tag_list')[0];\r\n        if (this.pn) {\r\n          this.pn.style.height = '16px';\r\n          this.pn.style.width = '150px';\r\n//          this.pn_board = document.getElementsByName('catalog.filter.tag_board_list')[0];\r\n//          this.pn_board.style.height = '16px';\r\n//          this.pn_board.style.width = '150px';\r\n          this.pn.onchange = this.cbx_onchange_entry;\r\n          this.filter_onchange(pref.catalog.filter.tag_search, true);\r\n        } else {\r\n          this.pn = 0;\r\n          return;\r\n        }\r\n      }\r\n//      if (this.reserved) { // worning code\r\n//        this.set_reserved_tags(this.reserved,true);\r\n//        if (this.reserved.length===0) this.reserved = null;\r\n//      }\r\n\r\n////      var tags_array = []; // working code.\r\n//////      var keys = {};\r\n//////      for (var i in this.tags) // patch, this can be removed if this.tags is fully overlayed at pref.liveTag.ci. // PATCHES CAN BE REMOVED\r\n//////        if (keys[i]!==null) {\r\n//////          keys[i] = null;\r\n//////          tags_array[tags_array.length] = {key:i, num:Object.keys(this.tags[i].mems).length};\r\n//////        }\r\n//////      if (pref.liveTag.ci) {\r\n//////        for (var i=0;i<tags_array.length;i++) { // search major key\r\n//////          keys = {};\r\n//////          var mems = this.tags[tags_array[i].key].mems;\r\n//////          for (var j in mems) keys[mems[j]] = (keys[mems[j]] || 0) +1;\r\n//////          for (var j in keys) if (keys[j]>keys[tags_array[i].key]) tags_array[i].key = j;\r\n//////        }\r\n//////      }\r\n////\r\n////      if (pref.liveTag.ci) {\r\n////        for (var i in this.key_dirty) { // set major key\r\n////          var tag_obj = this.tags_ci[(pref.liveTag.ci)? i.toLowerCase() : i];\r\n////          if (tag_obj) {\r\n////            var keys = {};\r\n////            var mems = tag_obj.mems;\r\n////            for (var j in mems) keys[mems[j]] = (keys[mems[j]] || 0) +1;\r\n////            var key_old = tag_obj.key;\r\n////////////if (!pref.test_mode['23']) {\r\n////            for (var j in keys) if (keys[j]>keys[tag_obj.key]) tag_obj.key = j;\r\n////////////} else {\r\n////////////            for (var j in keys) if (keys[j]>keys[tag_obj.key]) tag_obj.key = tag_obj.mems.search_from_dic(j);\r\n////////////            mems.clean_up_dic();\r\n////////////}\r\n////            if (key_old!==tag_obj.key) if (tag_obj.pn) tag_obj.pn.childNodes[3].textContent = Object.keys(tag_obj.mems).length + ': ' + tag_obj.key;\r\n////          }\r\n////        }\r\n////      }\r\n////      this.key_dirty = Object.create(null);\r\n////      for (var i in this.tags_ci) tags_array[tags_array.length] = {key:this.tags_ci[i].key, num:this.tags_ci[i].mems_keys_length(),\r\n////                                                                   disp: (this.pn_filter_rexp===null || !this.pn_filter_rexp.test(this.tags_ci[i].key))? 0 : 1};\r\n////      tags_array.sort(this.sort_func);\r\n\r\n//      var tags_array = this.tags_array_old; // working code.\r\n//      for (var i=0;i<tags_array.length;i++) {\r\n//        var key = tags_array[i].key;\r\n//        var k_ci = (pref.liveTag.ci)? key.toLowerCase() : key;\r\n//        if (this.key_dirty[k_ci]===null) {\r\n//          delete this.key_dirty[k_ci];\r\n//          if (this.tags_ci[k_ci]) {\r\n//            tags_array[i].num = (pref.liveTag.ci)? this.tags_ci[k_ci].mems_keys_length_and_set_top() : this.tags_ci[k_ci].mems_keys_length();\r\n//            if (key!==this.tags_ci[k_ci].key) {\r\n//              if (this.tags_ci[k_ci].pn) this.tags_ci[k_ci].pn.childNodes[3].textContent = tags_array[i].num + ': ' + this.tags_ci[k_ci].key;\r\n//              tags_array[i].key = this.tags_ci[k_ci].key;\r\n//            }\r\n//          } else {\r\n//            tags_array.splice(i--,1);\r\n//            continue;\r\n//          }\r\n//        }\r\n//        if (from_filter) tags_array[i].disp = this.update_pn_disp_func(pref.catalog.filter.tag_search.rexps, tags_array[i].key);\r\n//      }\r\n//      for (var i in this.key_dirty)\r\n//        if (this.tags_ci[i]) {\r\n//          var tags_ary_num = (pref.liveTag.ci)? this.tags_ci[i].mems_keys_length_and_set_top() : this.tags_ci[i].mems_keys_length(); // sets key\r\n//          tags_array[tags_array.length] = {key:this.tags_ci[i].key, num:tags_ary_num,\r\n//                                           disp: this.update_pn_disp_func(pref.catalog.filter.tag_search.rexps, this.tags_ci[i].key)};\r\n//        }\r\n//      tags_array.sort(this.sort_func);\r\n//      this.key_dirty = Object.create(null);\r\n\r\n      var tags_array = this.tags_array_old;\r\n      var dirty_count = 0;\r\n      var dirty_count_deleted = 0;\r\n      for (var k_ci in this.key_dirty) { // must enumerate item in prototype.\r\n        if (this.tags_ci[k_ci]) this.tags_ci[k_ci].num = (pref.liveTag.ci)? this.tags_ci[k_ci].mems_keys_length_and_set_top() : this.tags_ci[k_ci].mems_keys_length();\r\n        else dirty_count_deleted++;\r\n        dirty_count++;\r\n      }\r\n      for (var k_ci in this.key_dirty_creation) if (this.tags_ci[k_ci]) tags_array[tags_array.length] = this.tags_ci[k_ci];\r\n      if (dirty_count || pref.test_mode['73']) tags_array.sort(this.sort_func);\r\n\r\n////      for (var i in this.tags) tags_array[tags_array.length] = {key:i, num:Object.keys(this.tags[i].mems).length, mems:{}}; // working code.\r\n//////      for (var i in this.tags) { // working code, moved to 'delete_tags'.\r\n//////        var num = Object.keys(this.tags[i].mems).length;\r\n//////        if (num==0){\r\n//////          if (this.tags[i].pn!==null) this.pn.removeChild(this.tags[i].pn);\r\n//////          delete this.tags[i];\r\n//////          if (pref.debug_mode['3']) console.log('Remove: '+i);\r\n//////        } else tags_array[tags_array.length] = {key:i, num:num, mems:{}};\r\n//////      }\r\n////\r\n////      tags_array.sort(this.sort_func);\r\n////\r\n////      if (pref.liveTag.ci) {\r\n////        var tags_ci = Object.create(null);\r\n////        for (var i=0;i<tags_array.length;i++) {\r\n////          var key = tags_array[i].key.toLowerCase();\r\n////          if (!(key in tags_ci)) tags_ci[key] = i;\r\n////          else {\r\n////            var src = this.tags[tags_array[i].key];\r\n////            var ref = this.tags[tags_array[tags_ci[key]].key];\r\n////            var dst = tags_array[tags_ci[key]];\r\n////            for (var j in src.mems) if (!(j in ref.mems)) dst.mems[j] = null;\r\n////            dst.num = Object.keys(ref.mems).length + Object.keys(dst.mems).length;\r\n////            tags_array[i].num = 0;\r\n//////            src.pk = ref.pk;\r\n//////            src.in = ref.in;\r\n//////            src.ex = ref.ex;\r\n//////            ref.ci[tags_array[i].key] = null;\r\n////////            src.ci = {};\r\n////            if (src.pn!==null) { // force to remake to reflect changes next time.\r\n////              if (src.pn!==null) this.pn.removeChild(src.pn);\r\n////              src.pn=null;\r\n////              src.pn_num=0;\r\n////            }\r\n////          }\r\n////        }\r\n////        tags_array.sort(this.sort_func);\r\n////      }\r\n//////      if (pref.debug_mode['3']) console.log(JSON.stringify(tags_array));\r\n\r\n      var historical_filter_active = pref.catalog.filter.tag_search.rexps.length!=0 || this.update_pn_last_filter_active;\r\n      if (historical_filter_active || dirty_count_deleted) {\r\n        var docfrag = (this.pn.firstChild)? null : document.createDocumentFragment();\r\n        var pos_insert=0;\r\n        for (var i=0;i<tags_array.length;i++) {\r\n          var key = tags_array[i].key;\r\n          var key_ci = (pref.liveTag.ci)? key.toLowerCase() : key;\r\n          var dirty = (key_ci in this.key_dirty);\r\n          var tag_obj = this.tags_ci[key_ci];\r\n          if (tag_obj) {\r\n            var pn = tag_obj.pn;\r\n            if (from_filter || dirty) {\r\n              var disp = this.update_pn_disp_func(pref.catalog.filter.tag_search.rexps, key_ci);\r\n              if (pn!==null) {\r\n                if (disp===0) { // for passive virtual boarding.\r\n    //            if (tags_array[i].num===0 || tags_array[i].disp===0) {\r\n                  this.pn.removeChild(pn);\r\n                  tag_obj.pn = null;\r\n                } else {\r\n                  if (dirty) tag_obj.pn.childNodes[3].textContent = tag_obj.num + ': ' + key;\r\n                  if (this.pn.childNodes[pos_insert]!==pn) this.pn.insertBefore(pn, this.pn.childNodes[pos_insert] || null);\r\n                  pos_insert++;\r\n                }\r\n              } else if (disp==1) { // for passive virtual boarding.\r\n    //          } else if (tags_array[i].num!=0 && tags_array[i].disp==1) {\r\n                pn = document.createElement('span');\r\n                pn.innerHTML = '<input type=\"checkbox\" name=\"' + key_ci + '.pk\" ' + ((tag_obj['pk'])? 'checked' : '') + '>' + \r\n                               '<input type=\"checkbox\" name=\"' + key_ci + '.in\" ' + ((tag_obj['in'])? 'checked' : '') + '>' + \r\n                               '<input type=\"checkbox\" name=\"' + key_ci + '.ex\" ' + ((tag_obj['ex'])? 'checked' : '') + '>' +\r\n                               '<span name=\"' + key + '\">' + tag_obj.num + ': ' + key + '</span><br>';\r\n                if (docfrag) docfrag.appendChild(pn);\r\n                else this.pn.insertBefore(pn, this.pn.childNodes[pos_insert++] || null);\r\n//                this.pn.insertBefore(pn, this.pn.childNodes[pos_insert++] || null);\r\n                tag_obj.pn = pn;\r\n              }\r\n            } else if (pn) pos_insert++;\r\n          } else {\r\n            tags_array.splice(i--,1); // for deleted tags, didn't checked in 'delete_tags'.\r\n            if (--dirty_count_deleted<=0 && !historical_filter_active) break;\r\n          }\r\n          if (dirty && --dirty_count<=0 && !historical_filter_active) break;\r\n        }\r\n        if (docfrag && !pref.test_mode['74']) this.pn.appendChild(docfrag);\r\n      }\r\n      \r\n////      var j=0;\r\n//      var pos_insert=0; // working code.\r\n//      for (var i=0;i<tags_array.length;i++) {\r\n//        var key = tags_array[i].key;\r\n//        if (!this.tags[key]) {tags_array.splice(i--,1);continue;} // for deleted tags, didn't checked in 'delete_tags'.\r\n//        var num = tags_array[i].num;\r\n//        var num_old = this.tags[key].pn_num;\r\n//        if (num!==num_old || from_filter) {\r\n//          var str = num + ': ' + key;\r\n//          this.tags[key].pn_num = num;\r\n//          var pn = this.tags[key].pn;\r\n//          if (pn!==null) {\r\n//            if (tags_array[i].disp===0) { // for passive virtual boarding.\r\n////            if (tags_array[i].num===0 || tags_array[i].disp===0) {\r\n//              this.pn.removeChild(pn);\r\n//              this.tags[key].pn = null;\r\n//            } else {\r\n//              this.tags[key].pn.childNodes[3].textContent = str;\r\n////              if (this.tags_array_old[j] && key===this.tags_array_old[j].key) j++;\r\n////              else {\r\n//              if (this.pn.childNodes[pos_insert]!==pn) this.pn.insertBefore(pn, this.pn.childNodes[pos_insert] || null);\r\n//              pos_insert++;\r\n////                this.pn.insertBefore(pn, this.pn.childNodes[pos_insert++] || null);\r\n////                if (pref.debug_mode['3']) console.log('Insert: '+((num>num_old)?'promote: ':'demote: ')+key+', '+num_old+' -> '+num+', '+i+', '+j+', '+num_of_skip);\r\n////                if (num<num_old) num_of_skip--;\r\n////              }\r\n//            }\r\n//          } else if (tags_array[i].disp==1) { // for passive virtual boarding.\r\n////          } else if (tags_array[i].num!=0 && tags_array[i].disp==1) {\r\n//            pn = document.createElement('span');\r\n//            pn.innerHTML = '<input type=\"checkbox\" name=\"' + key + '.pk\" ' + ((this.tags[key]['pk'])? 'checked' : '') + '>' + \r\n//                           '<input type=\"checkbox\" name=\"' + key + '.in\" ' + ((this.tags[key]['in'])? 'checked' : '') + '>' + \r\n//                           '<input type=\"checkbox\" name=\"' + key + '.ex\" ' + ((this.tags[key]['ex'])? 'checked' : '') + '>' +\r\n//                           '<span name=\"' + key + '\">' + str + '</span><br>';\r\n//            pn.childNodes[0].onchange = this.cbx_onchange_entry;\r\n//            pn.childNodes[1].onchange = this.cbx_onchange_entry;\r\n//            pn.childNodes[2].onchange = this.cbx_onchange_entry;\r\n////            pn.childNodes[0].onmouseover = this.tooltip;\r\n////            pn.childNodes[1].onmouseover = this.tooltip;\r\n////            pn.childNodes[2].onmouseover = this.tooltip;\r\n////            pn.childNodes[3].onmouseover = this.tooltip;\r\n////            pn.style = {};\r\n////            pn.style.display = (this.pn_filter_rexp===null || this.pn_filter_rexp.test(key))? '' : 'none';\r\n//            this.pn.insertBefore(pn, this.pn.childNodes[pos_insert++] || null);\r\n//            this.tags[key].pn = pn;\r\n////            for (var j in this.tags[key].tgts) this.tags[j].pn = pn;  // PATCHES CAN BE REMOVED\r\n//          }\r\n//        } else if (tags_array[i].disp==1) pos_insert++;\r\n//////        } else { // tracking // working code.\r\n//////          while (j<this.tags_array_old.length && key!==this.tags_array_old[j].key) {\r\n//////            if (this.tags[this.tags_array_old[j].key] && this.tags[this.tags_array_old[j].key].pn_num==this.tags_array_old[j].num) num_of_skip++; // removed(to be 0) while waiting or not processed yet(demote)\r\n////////            if (pref.debug_mode['3']) {\r\n////////              var debug_str = this.tags_array_old[j].key+', '+this.tags_array_old[j].num+', '+num_of_skip;\r\n////////              if (this.tags[this.tags_array_old[j].key]===undefined) console.log('Removed: '+debug_str);\r\n////////              else if (this.tags[this.tags_array_old[j].key].pn_num==this.tags_array_old[j].num) console.log('Skip: '+debug_str);\r\n////////            }\r\n//////            j++;\r\n//////          }\r\n//////          j++;\r\n//////        }\r\n//      }\r\n      this.tags_array_old = tags_array;\r\n      this.key_dirty_creation = Object.create(Object.create(null));\r\n      this.key_dirty = Object.create(this.key_dirty_creation);\r\n\r\n//      if (pref.debug_mode['3']) { // CHECKER, working code.\r\n//        var flag = true;\r\n//        var dom = [];\r\n//        for (var i=0;i<tags_array.length;i++) {\r\n//          if (tags_array[i].num==0) break;\r\n//          var tgt = this.pn.childNodes[i].childNodes[3].textContent;\r\n//          var key = tgt.replace(/[^:]+: /,'');\r\n//          dom[dom.length] = key;\r\n//          if (tags_array[i].key!==key) {\r\n//            var j=0;\r\n//            while (j<tags_array.length && tags_array[j].key!==key) j++;\r\n//            if (j==tags_array.length) j=-1;\r\n//            var k=0;\r\n//            while (k<this.tags_array_old.length && this.tags_array_old[k].key!==key) k++;\r\n//            if (k==this.tags_array_old.length) k=-1;\r\n//            console.log('ERROR: '+tgt+', should be '+j+', but '+i+', '+k+' in old');\r\n//            flag = false;\r\n//          }\r\n//        }\r\n//        if (!flag) {\r\n//          console.log(tags_array);\r\n//          console.log(dom);\r\n//          console.log(this.tags_array_old);\r\n//        }\r\n//      }\r\n\r\n//      this.pn.innerHTML = '';\r\n//      for (var i=0;i<tags_array.length;i++) if (tags_array[i].num!=0) {\r\n//        var item = document.createElement('span');\r\n//        var key = tags_array[i].key;\r\n//        var str  = tags_array[i].num + ': ' + key;\r\n//        item.innerHTML = '<input type=\"checkbox\" name=\"' + key + '.pk\" ' + ((this.tags[key].pk)? 'checked' : '') + '>' +\r\n//                         '<input type=\"checkbox\" name=\"' + key + '.in\" ' + ((this.tags[key].in)? 'checked' : '') + '>' +\r\n//                         '<input type=\"checkbox\" name=\"' + key + '.ex\" ' + ((this.tags[key].ex)? 'checked' : '') + '>' +\r\n//                         '<span name=\"' + key + '\">' +  str + '</span><br>';\r\n//        item.childNodes[0].onchange = this.cbx_onchange_entry;\r\n//        item.childNodes[1].onchange = this.cbx_onchange_entry;\r\n//        item.childNodes[2].onchange = this.cbx_onchange_entry;\r\n//        item.childNodes[3].onmouseover = pref_func.tooltips.show;\r\n//        this.pn.appendChild(item);\r\n//      }\r\n      if (pref.virtualBoard.show && !from_filter) this.update_boardlist();\r\n      this.update_pn_last_filter_active = pref.catalog.filter.tag_search.rexps.length!=0;\r\n    },\r\n////    cbx_onchange_entry : function(e){liveTag.cbx_onchange(this, e, true);},\r\n////    cbx_onchange : function(sender, e, from_cbx){ // working code.\r\n////      var prop = sender.name.substr(-2,2);\r\n//////      var val = e.target.checked;\r\n////      var val = sender.checked;\r\n////      var tag = sender.name.substr(0,sender.name.length-3);\r\n    cbx_onchange_entry: function(e){\r\n      var et = e.target;\r\n      var tag = et.name.slice(0,-3);\r\n      var prop = et.name.substr(-2,2);\r\n      liveTag.tags[tag][prop] = et.checked;\r\n      liveTag.cbx_onchange(tag, prop);\r\n      liveTag.update_tag_node(tag);\r\n    },\r\n    cbx_onchange : function(tag, prop, no_scan){\r\n      var val = this.tags[tag][prop];\r\n      this.active[prop] += (val)? 1 : -1;\r\n      if (prop==='pk') {\r\n        if (val && !this.tags[tag]['in']) {\r\n          this.tags[tag]['in'] = true;\r\n          this.active['in'] += 1;\r\n          if (this.tags[tag].pn!==null) this.tags[tag].pn.childNodes[1].checked = true;\r\n//          this.update_pn_buf.delayed_do();\r\n        }\r\n//        var tgts = {};\r\n////        var now = Date.now();\r\n////        var prev = now - pref.liveTag.pickup_interval*1000;\r\n////        for (var i in this.tags)\r\n////          if (this.tags[i]['pk'] && (this.tags[i]['pk']==='true' || this.tags[i]['pk']<prev)) {\r\n////            this.tags[i]['pk']=now;\r\n////            for (var j in this.tags[i].mems) tgts[j.substr(0,j.lastIndexOf('/')+1)]=null;\r\n////          }\r\n////        if (val) for (var i in this.tags[tag].tgts) for (var j in this.tags[i].mems) tgts[j.substr(0,j.lastIndexOf('/')+1)]=null; // working code.\r\n////        if (val) for (var j in this.tags[tag].mems) tgts[j.substr(0,j.lastIndexOf('/')+1)]=null;\r\n//        if (val) for (var j of this.tags[tag].mems.keys()) tgts[j.key.substr(0,j.key.lastIndexOf('/')+1)]=null; // working code.\r\n        if (val) {\r\n          var tgts = this.tags[tag].mems_boards();\r\n          if (!no_scan && Object.keys(tgts).length!=0 && catalog_obj && catalog_obj.catalog_func()!=null)\r\n            scan.scan_ui('refresh_tag', {tgts: tgts, options:{callback:function(){scan.scan('t');}, priority:6}});\r\n        }\r\n      }\r\n      if (prop==='in' || prop==='pk') {\r\n        if (this.active['in']===((val)? 1 : 0)) {\r\n          pref.catalog.filter.tag = val;\r\n          if (pref_func.mirror_targets.pn12_0_4)\r\n            pref_func.apply_prep(pref_func.mirror_targets.pn12_0_4.getElementsByTagName('input')['catalog.filter.tag'],false);\r\n        }\r\n        if (catalog_obj && catalog_obj.catalog_func()!=null) catalog_obj.catalog_func().catalog_filter_changed();\r\n//        if (this.active['in']===1) pref.catalog.filter.tag = true; // working code.\r\n//        if (catalog_obj && catalog_obj.catalog_func()!=null) {\r\n//          pref_func.apply_prep(document.getElementsByTagName('input')['catalog.filter.tag'],false);\r\n//          catalog_obj.catalog_func().catalog_filter_changed();\r\n//        }\r\n      }\r\n    },\r\n    search_by_tags : function(tags){ // working code.\r\n      var retval = !this.active.in;\r\n      if (this.active.in) for (var j=0;j<2;j++) if (tags[j]) for (var i=0;i<tags[j].length;i++) if ((tags[j][i] in this.tags) && this.tags[tags[j][i]]['in']) {retval = true; break;}\r\n      if (retval && this.active.ex) for (var j=0;j<2;j++) if (tags[j]) for (var i=0;i<tags.length;i++) if ((tags[j][i] in this.tags) && this.tags[tags[j][i]]['ex']) {retval = false; break;}\r\n      return retval;\r\n    },\r\n//    search_by_tags : function(tags){ // working code.\r\n//      var retval = !this.active.in;\r\n//      if (this.active.in) for (var i=0;i<tags.length;i++) if ((tags[i] in this.tags) && this.tags[tags[i]]['in']) {retval = true; break;}\r\n//      if (retval && this.active.ex) for (var i=0;i<tags.length;i++) if ((tags[i] in this.tags) && this.tags[tags[i]]['ex']) {retval = false; break;}\r\n//      return retval;\r\n//    },\r\n    keys_fix: null, // to reduce memory consumption.\r\n    prep_tags : function(th, tags_old){ // prepare tag holder and extract tags in op. 'tags_old' for retag.\r\n//      if (this.mems[th.domain] && this.mems[th.domain][th.board] && this.mems[th.domain][th.board][th.no]) return this.mems[th.domain][th.board][th.no];\r\n//      else {\r\n      var lth = this.mems.init(th);\r\n      var tag = lth;\r\n      if ((tag[2][0]&0x00010000) || tags_old) {\r\n        var watch = tag[2];\r\n        if (watch[0]&0x00010000) {\r\n          if (pref.test_mode['64'] && pref[cataLog.embed_mode].deleted_posts.merge) archiver.prep_deleted_posts(th,lth);\r\n          if (pref.test_mode['67']) archiver.check_op(th, lth);\r\n          if (pref.liveTag.watch_all && th.time_created) cataLog.set_watch_time_thread(th.key, cataLog.embed_mode, th.time_created, th.time_posted, th, watch);\r\n          watch[0] = (watch[0]&0xfffe0000);\r\n        }\r\n//        if (pref.liveTag.watch_all && th.time_created) { // working code.\r\n//          var time_watch = catalog_obj.catalog_func().get_watch_time_of_a_thread(th.key, th.time_created, th.time_posted || th.time_bumped, true);\r\n//          if (time_watch) site2[th.domain].check_reply.set_watch_time(watch, time_watch);\r\n//        }\r\n////        if (tag[2][0]===-1) tag[2][0]=1; // patch. This may be redundant.\r\n//        if (tag[2][0]&0x00010000) tag[2][0] &= 0xfffe0000; // there is a path which doesn't throuth 'check_reply'. // redundant, do it in 'check_reply.check_t1_op'\r\n////        if (watch[0]!==0) tag[2][2]=1; // PATCH with BUG, if op contains replies to me, this way can't find it until the thread gets new replies.\r\n\r\n        var tags_b = [[],[]]; // first time only.\r\n        var tag_idx;\r\n        if (pref.liveTag.inherit_board_name) { // working code.\r\n          tag_idx = (pref.liveTag.lock_board_name)? 0 : 1;\r\n          tags_b[tag_idx][0] = '#'+th.board.replace(/\\//g,'');\r\n        }\r\n        if (pref.liveTag.inherit_board_tags && tag.btag2) {\r\n          tag_idx = (pref.liveTag.lock_board_tags)? 0 : 1;\r\n          tags_b[tag_idx] = tags_b[tag_idx].concat(tag.btag2);\r\n        }\r\n        var extracted_tags = site2[th.domain].check_reply.check_t1_op(th); // extracting tags in op is redundant when tags are NOT locked, but locked extracting is only here, so this can't be removed.\r\n        if (extracted_tags.length!=0) {\r\n          tag_idx = (pref.liveTag.lock_tags_in_op)? 0 : 1;\r\n          tags_b[tag_idx] = tags_b[tag_idx].concat(extracted_tags);\r\n//          tags_b[tag_idx] = extracted_tags.concat(tags_b[tag_idx]);\r\n        }\r\n        this.exclude_tags(th.key, tags_b);\r\n        if (tags_old) for (var i=0;i<2;i++) if (tags_old[i]) tags_b[i] = tags_b[i].concat(tags_old[i]);\r\n        if (tags_b[0].length!=0) tag[0] = this.update_tags_in_th(tags_b[0], null, {}, (tags_b[0].length < pref.liveTag.max)? tags_b[0].length : pref.liveTag.max, th, watch, this.mems[th.domain][th.board]); // update this.keys_fix\r\n        if (tags_b[1].length!=0) this.extract_tags(th, tags_b[1], this.keys_fix);\r\n        else {\r\n          if (tag[1]!==null) tag[1] = null;\r\n          this.update_pn_buf.delayed_do();\r\n        }\r\n      }\r\n      return tag;\r\n    },\r\n    update_tags_in_editing_posts: function(th, lth){\r\n      var flag = true;\r\n      for (var i=lth.ed_t.length-1;i>=0;i--) if (lth.ed_t[i][0]!=='#') {\r\n        var post = (th.posts_obj)? th.posts_obj[lth.ed_t[i]] : th.parse_funcs.posts_obj(th,lth.ed_t[i]); // posts_obj must be accessed in order\r\n////        var post = th.posts_obj[lth.ed_t[i]]; // working code -2016.10.06\r\n        if (post && !post.editing) {\r\n          site2[th.domain].wrap_to_parse.posts({posts:[post], __proto__:th});\r\n          var extracted_tags = site2[th.domain].check_reply.check_t1_op(post);\r\n          if (extracted_tags.length!=0) flag = false;\r\n          lth.ed_t = lth.ed_t.slice(0,i).concat(extracted_tags).concat(lth.ed_t.slice(i+1));\r\n        }\r\n      }\r\n      if (pref.debug_mode['24']) console.log(th.key+': retag_req: '+extracted_tags+', '+flag+', '+lth.ed_t);\r\n      return (extracted_tags)? this.extract_tags(th, lth.ed_t, null, null, true, flag) : undefined;\r\n    },\r\n    extract_tags : function(th, extracted_tags, keys_fix, clean, retag_editing, retag_editing_noexe){\r\n      var tag = this.mems[th.domain][th.board][th.no];\r\n      if (th.parse_funcs.has_editing) {\r\n        var ex_tags_keep = null;\r\n        for (var i=extracted_tags.length-1;i>=0;i--) if (extracted_tags[i][0]!=='#') { // tags are reverse ordered.\r\n          if (!ex_tags_keep) ex_tags_keep = extracted_tags.slice(0,i+1);\r\n          extracted_tags.splice(i,1);\r\n        }\r\n        if (ex_tags_keep || retag_editing) tag.ed_t = (retag_editing || !tag.ed_t)? ex_tags_keep :\r\n                                                      ex_tags_keep.concat(tag.ed_t); // reverse order\r\n        if (pref.debug_mode['24']) console.log(th.key+ ': lth.ed_t: '+tag.ed_t);\r\n        if (retag_editing_noexe) return;\r\n      }\r\n      if (!keys_fix) {\r\n        this.keys_fix = {};\r\n        var t0 = tag[0]; // runs getter 1 times only.\r\n        if (t0!==null && t0.length!=0) {\r\n          if (pref.liveTag.ci) for (var i=0;i<t0.length;i++) this.keys_fix[t0[i].toLowerCase()] = t0[i];\r\n          else for (var i=0;i<t0.length;i++) this.keys_fix[t0[i]] = t0[i];\r\n        }\r\n      }\r\n      var tag_1 = this.update_tags_in_th(extracted_tags, tag[1], this.keys_fix, pref.liveTag.max-tag[0].length, th, tag[2], this.mems[th.domain][th.board], clean);\r\n      if (tag_1.length!=0 || (tag[1] && tag[1].length!==0)) tag[1] = tag_1;\r\n      this.update_pn_buf.delayed_do();\r\n      this.keys_fix = null;\r\n//      else if (ur>=0) {\r\n//        for (var j=0;j<2;j++) {\r\n//          var tgt = tag[j];\r\n//          for (var i=0;i<tgt.length;i++) this.check_update_tags_color(tgt[i],ur);\r\n//        }\r\n//      }\r\n      return tag;\r\n    },\r\n    tags_boardlist: null,\r\n    update_boardlist: function(force_redraw){\r\n////      if (!site3[site.nickname].bds && site3[site.nickname].boards) { // working code.\r\n//////        site3[site.nickname].bds = {};\r\n////        for (var i=0;i<site3[site.nickname].boards.length;i++) site3[site.nickname].bds['/'+site3[site.nickname].boards[i].board+'/'] = null;\r\n////      }\r\n//      if (site.components.boardlist && site3[site.nickname].bds) {\r\n      if (site.components.boardlist) {\r\n        if (this.tags_boardlist===null) {\r\n          this.tags_boardlist = [];\r\n          pref_func.settings.onchange_funcs['virtualBoard.search.show'](null, true);\r\n          this.filter_onchange(pref.virtualBoard.search, true);\r\n        }\r\n        var i=0;\r\n        var flag = force_redraw;\r\n        var p = 0;\r\n        var j=0;\r\n        var p_remove = pref.virtualBoard.p_board==='both' && pref.virtualBoard.p_remove;\r\n        var search_valid = pref.virtualBoard.search.show && pref.virtualBoard.search.rexps.length!=0;\r\n        while (j<pref.virtualBoard.max && i<this.tags_array_old.length) {\r\n//        while (i<pref.virtualBoard.max+p && i<this.tags_array_old.length) {\r\n          var key = this.tags_array_old[i].key;\r\n          if (p_remove && (('/'+key.substr(1)+'/') in this.mems[site.nickname])) p++;\r\n          else if (!search_valid || this.update_pn_disp_func(pref.virtualBoard.search.rexps, (pref.liveTag.ci)? key.toLowerCase() : key)) {\r\n            if (this.tags_boardlist[j]!==key) {\r\n              this.tags_boardlist[j] = key;\r\n              flag = true;\r\n            }\r\n            j++;\r\n          }\r\n          i++;\r\n        }\r\n        if (j!=this.tags_boardlist.length) {this.tags_boardlist.splice(j,this.tags_boardlist.length-j); flag=true;}\r\n        if (flag) site2[site.nickname].show_boardlist(this.tags_boardlist.slice(), this.boardlist_click_entry);\r\n      }\r\n    },\r\n//    update_boardlist_1: function(tag){ // working code, but too slow.\r\n//      var pn = this.update_tag_string([tag].concat(this.tags_boardlist), ' / ', this.boardlist_click_entry);\r\n//      site2[site.nickname].show_boardlist(pn);\r\n//    },\r\n    update_boardlist_1: (function(){\r\n      var buf = [];\r\n      var delayed_do = new DelayBuffer(\r\n        function(){\r\n          var tags = Object.create(null);\r\n          for (var i=0;i<buf.length;i++) tags[liveTag.tags_ci[(pref.liveTag.ci)? buf[i].toLowerCase() : buf[i]].key] = null;\r\n//          var pn = liveTag.update_tag_string(Object.keys(tags).concat(liveTag.tags_boardlist), ' / ', liveTag.boardlist_click_entry); // slow in 8chan.\r\n          site2[site.nickname].show_boardlist_physical_board(Object.keys(tags), liveTag.boardlist_click_entry);\r\n          buf = [];\r\n        }, 500).get_binded_delayed_do();\r\n      return function(tag) {\r\n        if (site.components.boardlist) {\r\n          buf[buf.length] = tag;\r\n          delayed_do();\r\n        }\r\n      };\r\n    })(),\r\n\r\n//    refresh_end_proc: function(){\r\n//      for (var i in this.tags) if (this.tags[i].ur_cs===null) this.count_ur_sub(i);\r\n//      for (var i in this.tags_update_state) this.tags[i].ur = null;\r\n//      for (var i in this.tags_update_state) {\r\n//        if (this.tags[i].ur===null) this.count_ur(i);\r\n//        this.update_tag_node(i);\r\n//      }\r\n//      this.tags_update_state = Object.create(null);\r\n//    },\r\n    update_tag_node: function(tag, node_in_boardlist){\r\n      if (cataLog.threads!==null) {\r\n////if (!pref.test_mode['24']) {\r\n        var keys = liveTag.tags[tag].mems_keys_obj(); // runs getter only 1 time. // working code.\r\n        for (var name in keys)\r\n          if (cataLog.threads[name] && cataLog.threads[name][24] && cataLog.threads[name][24][3])\r\n            this.update_tag_node_1(cataLog.threads[name][24][3].getElementsByClassName(pref.script_prefix+'_tag'),keys[name]);\r\n////} else {\r\n////        for (var i of this.tags[tag].mems_keys()) {\r\n////          var name = i.key;\r\n////          if (cataLog.threads[name] && cataLog.threads[name][24] && cataLog.threads[name][24][3])\r\n////            this.update_tag_node_1(cataLog.threads[name][24][3].getElementsByClassName(pref.script_prefix+'_tag'), this.tags[tag].mems.get(i)); // can't get tag when i is derived from board.\r\n////        }\r\n////}\r\n      }\r\n      tag = this.tags_ci[(pref.liveTag.ci)? tag.toLowerCase() : tag].key;\r\n      if (node_in_boardlist) this.color_tag_node(node_in_boardlist, tag);\r\n      else if (this.tags_boardlist && this.tags_boardlist.indexOf(tag)!=-1) this.update_tag_node_1(site.components.boardlist.getElementsByClassName(pref.script_prefix+'_tag'), tag);\r\n    },\r\n//    update_tag_node: function(tag, node_in_boardlist){ // working code.\r\n//      if (catalog_obj && catalog_obj.catalog_func()!=null) {\r\n//        var threads = catalog_obj.catalog_func().threads;\r\n//        for (var t in liveTag.tags[tag].tgts) \r\n//          for (var name in liveTag.tags[t].mems) \r\n//            if (threads[name] && threads[name][24] && threads[name][24][3]) this.update_tag_node_1(threads[name][24][3].getElementsByClassName(pref.script_prefix+'_tag'),tag);\r\n//      }\r\n//      if (node_in_boardlist) this.color_tag_node(node_in_boardlist, tag);\r\n//      else if (this.tags_boardlist.indexOf(tag)!=-1) this.update_tag_node_1(site.components.boardlist.getElementsByClassName(pref.script_prefix+'_tag'), tag);\r\n//    },\r\n    update_tag_node_1: function(pns, tag){\r\n      var tag_ci = tag.toLowerCase();\r\n      for (var j=0;j<pns.length;j++) {\r\n        var txt = pns[j].textContent;\r\n        if (txt===tag || (pref.liveTag.ci && txt.toLowerCase()===tag_ci)) {\r\n          this.color_tag_node(pns[j],tag);\r\n          break;\r\n        }\r\n      }\r\n    },\r\n    color_tag_node : function(node, tag){\r\n      if (this.tags[tag]['in']) common_func.init_set_style(node,pref.liveTag.style_in_obj4);\r\n      else if (pref.liveTag.style) {\r\n        if (this.tags[tag].ur>2) common_func.init_set_style(node,pref.liveTag.style_urtm_obj4);\r\n        else if (this.tags[tag].ur>0) common_func.init_set_style(node,pref.liveTag.style_ur_obj4);\r\n        else common_func.init_set_style(node,null);\r\n      } else common_func.init_set_style(node,null);\r\n    },\r\n    update_tag_string: function(tags, sep, func_click, tagname){\r\n      var pn = document.createElement('span');\r\n//      pn.setAttribute('class',pref.script_prefix+'_tag');\r\n      pn.setAttribute('name',pref.script_prefix+'_tag_parent');\r\n      if (tags) for (var j=0;j<tags.length;j++) {\r\n        var key = tags[j];\r\n        var pn_1 = document.createElement(tagname? tagname : 'span');\r\n        pn_1.setAttribute('class',pref.script_prefix+'_tag');\r\n        pn_1.textContent = key;\r\n        this.color_tag_node(pn_1,key);\r\n        pn_1.onclick = func_click;\r\n        pn_1.onmouseover = this.tag_onmouseover;\r\n        pn.appendChild(pn_1);\r\n        pn.appendChild(document.createTextNode(sep));\r\n      }\r\n      return pn;\r\n    },\r\n    tag_node_onclick: function(){\r\n      var tag = this.textContent;\r\n      liveTag.cbx_changed(tag, pref.liveTag.click_func);\r\n    }\r\n\r\n//    extract_tags_in_posts : function(th, tags, name){\r\n//      tag[1] = this.update_tags_in_th(tags, tag[1][0], tag[0][1], pref.liveTag.max-tag[0][0].length, name);\r\n//      this.update_pn_buf.delayed_do();\r\n//    },\r\n  };\r\n  liveTag.key_dirty = Object.create(liveTag.key_dirty_creation);\r\n//  liveTag.cbx_onchange_entry = liveTag.cbx_onchange_entry(liveTag);\r\n//  liveTag.update_pn_buf = new DelayBuffer(liveTag.update_pn.bind(liveTag), 500);\r\n  liveTag.update_pn_buf = new DelayBuffer(liveTag.update_pn.bind(liveTag), pref.liveTag.disp_delay);\r\n  liveTag.tags_ci = Object.getPrototypeOf(liveTag.tags);\r\n  thread_reader_init();\r\n\r\n////  function LiveTag(tags, mems){ // I want to use 'Tag', but this brings difficulty into search...\r\n////    this.tags = tags || Object.create(null); // tags : tags[TAG] = {key:, num;, mem:, pk:, in:, ex:};  // summary tree.\r\n////    this.mems = mems || Object.create(null); // mems : mems[DOMAIN_BOARD][TAG] = {'THREAD':null, ...}; // member tree.\r\n//////    Object.defineProperty(this, 'filter', {get: this.prep_filter_value, enumerable:true, configurable:true});\r\n////    this.pn = document.createElement('div');\r\n////    this.cbx_onchange_entry = (function(myself){function(){myself.cbx_onchange(this.name, this.checked);}})(this);\r\n////    this.footer_onclick_entry = (function(myself){function(){myself.footer_onclick(this.name);}})(this);\r\n////    this.active = null;\r\n////  }\r\n////  LiveTag.prototype = {\r\n////    cbx_onchange : function(name,checked){\r\n////      var name = this.name.split('.');\r\n////      this.tags[name[0]][name[1]] = checked;\r\n////      this.prep_search();\r\n//////      this.prep_filter_val();\r\n//////      Object.defineProperty(this, 'filter', {get: this.prep_filter_value, enumerable:true, configurable:true});\r\n////    },\r\n////    extract_tags_in_op : function(pn) {\r\n////      var tags = pn[brwsr.innerText].match(tags_scan_regex);\r\n////      var tags_uniq = Object.create(null);\r\n////      for (var i=tags.length-1;i>=0;i--) if (tags[i] in tags_uniq) tags.splice(i,1); else tags_uniq[tags[i]] = null; // uniq in Case Sensitive\r\n////      if (tags.length>pref.catalog.tag.max) return [];\r\n////      if (tags.length>pref.catalog.tag.ignore) tags.splice(0,tags.length-pref.catalog.tag.ignore);\r\n////      return tags;\r\n////    },\r\n////    update_tags : function(ths, partial){\r\n////      var tags_in_board = Object.create(null);\r\n////      for (var i=0;i<ths.length;i++) {\r\n////        for (var j=0;j<ths[i].tags.length;j++) {\r\n////          if (!tags_in_board[ths[i].tags[j]]) tags_in_board[ths[i].tags[j]] = Object.create(null);\r\n////          tags_in_board[ths[i].tags[j]][ths[i].no] = null;\r\n////        }\r\n////      }\r\n////      var db = ths[0].domain + ths[0].board;\r\n////      if (!this.mems[db]) this.mems[db] = Object.create(null);\r\n////      var mems_db = this.mems[db];\r\n////      var tags = this.tags;\r\n////      if (!partial) {\r\n////        for (var i in mems_db) {\r\n////          if (i in tags_in_board) {\r\n////            tags[i].num += Object.keys(tags_in_board[i]).length - Object.keys(mems_db[i]).length;\r\n////            mems_db[i] = tags_in_board[i];\r\n////            tags_in_board[i] = null;\r\n////          } else {\r\n////            tags[i].num -= Object.keys(mems_db[i]).length;\r\n////            delete tags[i].mem[db];\r\n////            if (tags[i].num==0 && !tags[i].pk && !tags[i].in && !tags[i].ex) delete tags[i];\r\n////            delete mems_db[i];\r\n////          }\r\n////        }\r\n////      } else {\r\n////        for (var i in tags_in_board) {\r\n////          if (in in mems_db) {\r\n////            old_len = Object.keys(mems_db[i]).length;\r\n////            for (var j in tags_in_board[i]) mems_db[i][j] = tags_in_board[i][j];\r\n////            tags[i].num += Object.keys(mems_db[i]).length - old_len;\r\n////            tags_in_board[i] = null;\r\n////          }\r\n////        }\r\n////      }\r\n////      for (var i in tags_in_board) {\r\n////        if (tags_in_board[i]!==null) { // i isn't in mems_db\r\n////          if (!(i in tags)) tags[i] = {key:i, num;0, mem:Object.create(null), pk:false, in:false, ex:false};\r\n////          tags[i].num += Object.keys(tags_in_board[i]).length;\r\n////          tags[i].mem[db] = null;\r\n////          mems_db[i] = tags_in_board[i];\r\n////        }\r\n////      }\r\n////    },\r\n////    update_pn : function(ci){\r\n////      var tags = this.tags;\r\n////      var tags_array = [];\r\n////      for (var i in tags) tags_array[tags_array.length] = tags[i];\r\n////      tags_array.sort(this.sort_func);\r\n////      if (ci) {\r\n////        var tags_ci = Object.create(null);\r\n////        for (var i=0;i<tags_array.length;i++) {\r\n////          var key = tags_array[i].key.toLowerCase();\r\n////          if (!(key in tags_ci)) tags_ci[key] = i;\r\n////          else {\r\n////            tags_array[tags_ci[key]].num += tags_array[i].num; // CAUSE OVERESTIMATION, BUT EXECUTION SPEED HAS MORE PRIORITY, THEREFORE LEAVE THIS.\r\n////            tags_array[tags_ci[key]].pk  |= tags_array[i].pk;\r\n////            tags_array[tags_ci[key]].in  |= tags_array[i].in;\r\n////            tags_array[tags_ci[key]].ex  |= tags_array[i].ex;\r\n////            tags_array.splice(i,1);\r\n////            i--;\r\n////          }\r\n////        }\r\n////        tags_array.sort(this.sort_func);\r\n////      }\r\n////      this.pn.innerHTML = '';\r\n////      for (var i=0;i<tags_array.length;i++) {\r\n////        var item = document.createElement('span');\r\n////        var str  = tags_array[i].num + ': ' + tags_array[i].key;\r\n////        item.innerHTML = '<input type=\"checkbox\" name=\"' + tags_array[i].key + '.pk\" ' + ((tags_array[i].pk)? 'checked' : '') + '>' + \r\n////                         '<input type=\"checkbox\" name=\"' + tags_array[i].key + '.in\" ' + ((tags_array[i].in)? 'checked' : '') + '>' + \r\n////                         '<input type=\"checkbox\" name=\"' + tags_array[i].key + '.ex\" ' + ((tags_array[i].ex)? 'checked' : '') + '>' + str + '<br>';\r\n////        item.childNodes[0].onchange = this.cbx_onchange_entry;\r\n////        item.childNodes[1].onchange = this.cbx_onchange_entry;\r\n////        item.childNodes[2].onchange = this.cbx_onchange_entry;\r\n////        this.pn.appendChild(item);\r\n////      }\r\n////    },\r\n////    prep_search : function(){\r\n////      var active = {pk:false, in:false, ex:false};\r\n////      var tags = this.tags;\r\n////      for (var i in tags) if (tags[i].pk) {active.pk = true; break;}\r\n////      for (var i in tags) if (tags[i].in) {active.in = true; break;}\r\n////      for (var i in tags) if (tags[i].ex) {active.ex = true; break;}\r\n////      this.active = active;\r\n////    }\r\n////    get_pick_up_mems : function(){\r\n////      var retval = {};\r\n////      if (this.active.pk) for (var i in tags) if (tags[i].pk) for (var j in tags[i].mem) retval[j] = null;\r\n////      return retval;\r\n////    },\r\n//////    prep_filter_value : function(){\r\n//////      var retval = {pk:Object.create(null), in:Object.create(null), ex:Object.create(null)};\r\n//////      for (var i in this.tags) {\r\n//////        if (this.tags[i].pk) retval.pk[i] = null;\r\n//////        if (this.tags[i].in) retval.in[i] = null;\r\n//////        if (this.tags[i].ex) retval.ex[i] = null;\r\n//////      }\r\n//////      Object.defineProperty(this, 'filter', {value: retval, writable:true, enumerable:true, configurable:true});\r\n//////    },\r\n////    prep_footer : function(tags){\r\n////      var ft = document.createElement('span');\r\n////      ft.setAttribute('style','cursor:pointer');\r\n////      for (var i=tags.length-1;i>=0;i--) {\r\n////        var tag_pn = document.createElement('span');\r\n////        tag_pn.innerHTML = tags[i] + ' ';\r\n////        tag_pn.onclick = this.footer_onclick_entry;\r\n////        ft.appendChild(tag_pn);\r\n////      }\r\n////      return ft;\r\n////    },\r\n////    footer_onclick : function(name) {\r\n////      var sel = pref.tag.footer_clicked;\r\n////      this.tags[name][sel] = !this.tags[name][sel];\r\n////      this.pn.getElementsByTagName('input')[name+'.'+sel] = this.tags[name][sel];\r\n////    },\r\n\r\n//  https://nolanlawson.com/2015/09/29/indexeddb-websql-localstorage-what-blocks-the-dom/    // IndexedDB IS TOO SLOW TO USE, Chrome47@2015.09.29\r\n//  http://stackoverflow.com/questions/28693674/indexeddb-slow-retrieval-issue               // IndexedDB IS TOO SLOW TO USE @2015.02\r\n//  http://stackoverflow.com/questions/10102571/indexeddb-very-slow-compared-to-websql-what-am-i-doing-wrong // IndexedDB IS TOO SLOW TO USE @2012.01.12\r\n//  https://dev.mozilla.jp/2012/07/why-no-filesystem-api-in-firefox/\r\n//  https://developer.mozilla.org/ja/docs/Web/API/IndexedDB_API/Browser_storage_limits_and_eviction_criteria#Storage_limits\r\n//  https://developer.mozilla.org/en-US/docs/Web/API/File_System_API/Introduction\r\n//  http://www.html5rocks.com/ja/tutorials/file/filesystem/\r\n  var IDB = (function(){\r\n    function IDBRequest_onerror(e){\r\n      console.log('IDB: ERROR: ',e);\r\n      for (var key of db_info.keys()) console.log(db_info.get(key));\r\n      console.log(last_closed);\r\n    }\r\n    function IDBRequest_onblocked(e){\r\n      if (pref.debug_mode['21']) console.log('IDB: BLOCKED: '+e.oldVersion+' -> '+e.newVersion);\r\n    }\r\n    function IDBTransaction_onabort(e){\r\n      console.log('IDBT: ABORT: '+e.target.error.name,e);\r\n      // http://stackoverflow.com/questions/10477489/what-are-the-details-can-be-obtained-from-webkitstorageinfo-queryusageandquota\r\n      if (window.webkitStorageInfo) window.webkitStorageInfo.queryUsageAndQuota(webkitStorageInfo.TEMPORARY, console.log.bind(console));\r\n      e.target.db.close();\r\n    }\r\n    function IDBTransaction_onerror(e){\r\n      console.log('IDBT: ERROR: '+e.target.error.name,e);\r\n      e.target.db.close();\r\n    }\r\n    \r\n    function IDBRequest_onupgradeneeded(e){\r\n      e.target.onsuccess = null; // prevent from being called twice.\r\n      IDBRequest_onsuccess_open(e, true);\r\n    }\r\n    function IDBRequest_onsuccess_open(e, from_upgrade){\r\n      var db = e.target.result;\r\n      version[db.name] = db.version;\r\n      var reqs = from_upgrade && reqs_vc[db.name] || reqs_rw[db.name];\r\n      if (pref.debug_mode['20']) {\r\n        var debug_coms = reqs && reqs.slice(0,5).map(function(v){return v.kind;});\r\n        console.log('IDB: opened: v'+db.version+', '+(reqs && reqs.length)+' req(s), '+e.type+', '+debug_coms);\r\n      }\r\n      if (db_info.has(db)) console.log('IDB: ERROR: the same db was returned.', db_info.get(db));\r\n      db_info.set(db, {type:e.type, coms:debug_coms, tr_count:1, reqs:reqs, req:null}); // tr_count.set(db, 1); // tr_count.set(db, (tr_count.get(db)||0)+1); // returns the same db sometimes.\r\n      if (reqs) {\r\n        if (from_upgrade) {\r\n          var tr = e.target.transaction;\r\n          while (reqs.length>0) {\r\n            var req = reqs.shift();\r\n            db_info.get(db).req = req;\r\n            var contains = db.objectStoreNames.contains(req.no);\r\n            if (req.kind==='put') {\r\n              if (!contains) make_1(db, req, IDBRequest_close);\r\n              else re_req(db,req, reqs_rw); // downgrade\r\n//              else put_1(db,req, IDBRequest_close);\r\n            } else if (req.kind==='delete_th') {\r\n              if (contains) delete_th_1(db, req, tr); // returns void, not a transaction.\r\n            }\r\n          }\r\n          req_end(db, from_upgrade);\r\n        } else {\r\n          var loop_func = function complete_func(){req_1(db,reqs,from_upgrade,complete_func);}\r\n          req_1(db, reqs, from_upgrade, loop_func);\r\n        }\r\n      } else req_end(db, from_upgrade);\r\n    }\r\n    function req_1(db, reqs, from_upgrade, complete_func){ // multi transaction can be accepted, but not debugged.\r\n      var req = reqs.shift();\r\n      db_info.get(db).req = req;\r\n      if (req) {\r\n        if (pref.debug_mode['22']) console.log(req.no+', '+req.kind+', '+req.key+', '+reqs.length);\r\n        var contains = db.objectStoreNames.contains(req.no);\r\n        if (req.kind==='put') {\r\n          if (!contains) {re_req(db,req, reqs_vc);complete_func();} // upgrade\r\n          else put_1(db,req, complete_func);\r\n        } else if (req.kind==='put_if') {\r\n          if (contains) put_1(db,req, complete_func);\r\n          else complete_func();\r\n        } else if (req.kind==='delete') {\r\n          if (contains) delete_1(db,req, complete_func);\r\n          else complete_func();\r\n        } else if (req.kind==='clean_up') {\r\n          check_cleaned[db.name] = Date.now();\r\n          var tgts = [];\r\n          for (var i=0;i<db.objectStoreNames.length;i++) if (req.obj[db.objectStoreNames[i]]!==null) tgts[tgts.length] = db.objectStoreNames[i];\r\n          clean_up(db, {tgts:tgts, prune:true, __proto__:req}, complete_func);\r\n//          for (var i=0;i<db.objectStoreNames.length;i++) if (req.obj[db.objectStoreNames[i]]!==null) clean_1(db, {no:db.objectStoreNames[i], prune:true, __proto__:req});\r\n        } else if (req.kind==='check_clean') {\r\n          var date = Date.now();\r\n          if (date - (check_cleaned[db.name] || 0 ) > pref.archive.IDB.check_every * 3600000) {\r\n            check_cleaned[db.name] = date;\r\n            clean_up(db, {tgts:Array.prototype.slice.call(db.objectStoreNames), __proto__:req}, complete_func);\r\n          } else complete_func();\r\n//          for (var i=0;i<db.objectStoreNames.length;i++) clean_1(db, {no:db.objectStoreNames[i], __proto__:req});\r\n        } else complete_func();\r\n      } else req_end(db, from_upgrade);\r\n    }\r\n    function req_end(db, from_upgrade){\r\n      IDBRequest_close({target:{db:db}});\r\n      delete (from_upgrade && reqs_vc[db.name] && reqs_vc || reqs_rw)[db.name];\r\n      if (reqs_re[db.name]) {\r\n        reqs_rw[db.name] = (reqs_rw[db.name])? reqs_rw[db.name].concat(reqs_re[db.name]) : reqs_re[db.name];\r\n        delete reqs_re[db.name];\r\n      }\r\n//      if ((!from_upgrade)? reqs_vc[db.name] : reqs_rw[db.name]) open_db(db.name, (!from_upgrade)? db.version+1 : undefined);\r\n      if (!from_upgrade && reqs_vc[db.name]) open_db(db.name, db.version+1);\r\n      if (Object.keys(reqs_rw).length===0 && Object.keys(reqs_vc).length===0 && Object.keys(reqs_re).length===0) watchdog.stop();\r\n    }\r\n    function re_req(db, req, reqs){\r\n//      var reqs = (reason==='upgrade')? reqs_vc : (reason==='downgrade')? reqs_rw : req_rw;\r\n      if (!reqs[db.name]) reqs[db.name] = [req];\r\n      else reqs[db.name].push(req);\r\n    }\r\n    function delete_th_1(db,req, tr){\r\n      tr_inc(db);\r\n      db.deleteObjectStore(req.no);\r\n      tr_set(tr, (function(func_prev){\r\n        return function(e){\r\n          if (func_prev) func_prev(e);\r\n          IDBRequest_close({target:{db:db}});\r\n        }\r\n      })(tr.oncomplete));\r\nif (pref.debug_mode['23']) console.log('IDB: delete_th: '+db.name+req.no+', '+db.objectStoreNames.length);\r\n    }\r\n    function make_1(db,req, complete_func){\r\n      tr_inc(db);\r\n      var tr = db.createObjectStore(req.no).transaction;\r\n      tr_set(tr, (function(func_prev){ // tr belongs to db, transaction.oncomplete is called ONE TIME, so cascade oncomplete funcs.\r\n        return function(e){\r\nif (!pref.test_mode['66']) {\r\n          put_1(db,req, complete_func);\r\n} else {\r\n          re_req(db, req, reqs_rw); // downgrade // DOESN'T WORK WHY???\r\n          complete_func({target:{db:db}});\r\n}\r\n          if (func_prev) func_prev(e);\r\n        }\r\n      })(tr.oncomplete));\r\n    }\r\n    function put_1(db,req, complete_func){\r\n      try {\r\n        if (pref.debug_mode['23']) console.log('put_1: '+req.no+', '+req.kind+', '+req.key);\r\n        var req = tr_set(db.transaction(req.no,'readwrite'), complete_func).objectStore(req.no).put(\r\n          (req.key!=='posts')? req.obj : JSON.stringify(req.obj, archiver.store_json_func),\r\n          (req.key!=='posts')? req.key : req.key+'_'+req.obj[0].no); // .onsuccess = IDBRequest_close;\r\n//        req.onsuccess = function(e){console.log('success:');};\r\n//        req.onerror   = function(e){console.log('ERROR');};\r\n      } catch (e){\r\n//        if (pref.debug_mode['20'])\r\n          console.log('IDB: fail to put: '+e.name+': ' + JSON.stringify(req,['no','key','kind']), e, db_info.get(db));\r\n        if (e.name==='InvalidStateError') { // retry when latter requests catch up with a prior request which creates new objectStore.\r\n          re_req(db,req, reqs_re); // retry\r\n          if (pref.debug_mode['20']) console.log('IDB: re-scheduled:');\r\n        }\r\n        complete_func({target:{db:db}});\r\n      }\r\n    }\r\n    function delete_1(db,req, complete_func){\r\n      tr_set(db.transaction(req.no,'readwrite'), complete_func).objectStore(req.no).delete(req.key); // .onsuccess = IDBRequest_close;\r\n    }\r\n    function clean_up(db,req, complete_func){ \r\n      req.complete_func = function(){clean_1(db,req, complete_func);};\r\n      clean_1(db,req, complete_func);\r\n    }\r\n    function clean_1(db,req, complete_func){\r\n      if (req.tgts.length===0) return complete_func();\r\n      if (db_info.get(db).wdg) delete db_info.get(db).wdg;\r\n      var no = req.tgts.shift();\r\n      if (pref.debug_mode['23']) console.log('clean_1: '+no+', '+req.tgts.length);\r\n      tr_set(db.transaction(no,'readwrite'), req.complete_func).objectStore(no).get('pruned_time').onsuccess = (req.prune)? clean_1_onsuccess_prune : clean_1_onsuccess;\r\n    }\r\n    function tr_set(tr, complete_func){\r\n      tr.oncomplete = complete_func;\r\n      tr.onabort    = IDBTransaction_onabort;\r\n      tr.onerror    = IDBTransaction_onerror;\r\n      return tr;\r\n    }\r\n//    function clean_1(db,req){ // CAUSE ERROR in Chrome, \"Internal error: Too many transactions queued.\" Upper limit is about 400-500.\r\n//      tr_inc(db);\r\n//      var tr = db.transaction(req.no,'readwrite');\r\n//      tr.objectStore(req.no).get('pruned_time').onsuccess = (req.prune)? clean_1_onsuccess_prune : clean_1_onsuccess;\r\n//      tr.oncomplete = IDBRequest_close;\r\n//      tr.onaboart = IDBTransaction_onabort;\r\n//      tr.onerror = IDBTransaction_onerror;\r\n//    }\r\n    function clean_1_onsuccess_prune(e){\r\n      clean_1_onsuccess(e, true);\r\n    }\r\n    function clean_1_onsuccess(e, prune){\r\n      var value = e.target.result;\r\n      var date = Date.now();\r\n      if (!value && prune) e.target.source.put(date, 'pruned_time');\r\n      else {\r\n        if (value + pref.archive.IDB.prune * 3600000 < date) acc(site.nickname, e.target.transaction.db.name.replace(pref.script_prefix+'.',''),\r\n                                                                 e.target.source.name, null, null, 'delete_th');\r\n      }\r\n    }\r\n    function IDBRequest_close(e){\r\n      var db = e.target.source && e.target.source.transaction.db || e.target.db || e.target.result;\r\n      var info = db_info.get(db);\r\n      if (!info) return; // closed by WATCHDOG.\r\n      if (info.tr_count!==1) info.tr_count -= 1; //      if (tc===1) {db.close();tr_count.delete(db);}\r\n      else {\r\n        db.close();\r\n        if (pref.debug_mode['20']) console.log('IDB: closed: v'+db.version+', '+JSON.stringify(db_info.get(db),['type','coms','tr_count']));\r\n        last_closed = db_info.get(db);\r\n        last_closed.db = db;\r\n        db_info.delete(db);\r\n      }\r\n    }\r\n    var last_closed = null; // for debug\r\n    var db_info = new Map();\r\n    function tr_inc(db){\r\n      db_info.get(db).tr_count += 1;\r\n    }\r\n    var check_cleaned = {};\r\n    var version = {};\r\n    var reqs_vc = {};\r\n    var reqs_rw = {};\r\n    var reqs_re = {};\r\n    function acc(domain,board,no,key,obj, kind){\r\n//      var db_name = pref.script_prefix+'.'+domain+board;\r\n      if (domain!==site.nickname) return;\r\n      var db_name = pref.script_prefix+'.'+board;\r\n      var req_obj = {no:no, key:key, obj:obj, kind:kind};\r\n      var ver = (kind==='delete_th' && version[db_name]+1) || undefined;\r\n      var reqs = (ver)? reqs_vc : reqs_rw;\r\n      if (!reqs[db_name]) {\r\n        reqs[db_name] = [req_obj];\r\n        open_db(db_name, ver);\r\n      } else {\r\n        reqs[db_name].push(req_obj);\r\n        watchdog.start();\r\n      }\r\n//      if (!reqs[db_name]) reqs[db_name] = [req_obj]; // not improved.\r\n//      else reqs[db_name].push(req_obj);\r\n//      open_db(db_name, ver);\r\n    }\r\n    function open_db(db_name, ver){\r\n      var req = window.indexedDB.open(db_name, ver);\r\n      req.onerror = IDBRequest_onerror;\r\n      req.onsuccess = IDBRequest_onsuccess_open;\r\n      req.onupgradeneeded = IDBRequest_onupgradeneeded;\r\n      req.onblocked = IDBRequest_onblocked;\r\n      watchdog.start();\r\n    }\r\n    var watchdog = new Watchdog(function (){\r\n//      if (pref.debug_mode['20']) {\r\n        var sums = [0,0,0];\r\n        var tgts = [reqs_vc,reqs_rw,reqs_re];\r\n        for (var i=0;i<3;i++)\r\n          for (var j in tgts[i]) sums[i] += Object.keys(tgts[i][j]).length;\r\n        console.log('IDB: WATCHDOG: '+Object.keys(reqs_vc).length+'('+sums[0]+'), '+Object.keys(reqs_rw).length+'('+sums[1]+'), '+Object.keys(reqs_re).length+'('+sums[2]+')');\r\n        for (var db of db_info.keys()) {\r\n          var tgt = db_info.get(db);\r\n          console.log(tgt);\r\n          if (!tgt.wdg || tgt.wdg!==tgt.req) tgt.wdg = tgt.req;\r\n          else {\r\n            db.close();\r\n            re_req(db, tgt.req, (tgt.req.kind==='delete_th')? reqs_vc : reqs_rw);\r\n            console.log('IDB: WATCHDOG: close and re-req, '+tgt.req.kind);\r\n            db_info.delete(db);\r\n          }\r\n        }\r\n//      }\r\n      for (var i in reqs_vc) open_db(i,version[i]+1);\r\n      for (var i in reqs_rw) if (!reqs_vc[i]) open_db(i);\r\n    }, 60000);\r\n    return {\r\n      req: acc,\r\n      put: function(domain,board,no,key,obj){acc(domain,board,no,key,obj, 'put');},\r\n      get: function(){\r\n      },\r\n      delete: function(domain,board,no,key,obj){acc(domain,board,no,key,obj, 'delete');},\r\n      clean_up: function(domain, board, nos){\r\n        acc(domain,board,undefined,undefined,nos, 'clean_up');\r\n      },\r\n    };\r\n  })();\r\n\r\n  var archiver = (function(){\r\n// http://www.redout.net/data/tar.html\r\n// dollchan\r\n// https://github.com/beatgammit/tar-js/blob/master/lib/tar.js\r\n// https://gist.github.com/kig/417483\r\n    var tar = (function(){\r\n      function make_header(blob, lth, suffix){\r\n        var header = new Uint8Array(512); // UInt8 for checksum.\r\n        suffix = (suffix.substr(0,3)==='tn_')?  'thumbs/' + encode_filename(suffix.substr(3)) :\r\n                 (suffix.substr(0,4)==='img_')? 'images/' + encode_filename(suffix.substr(4)) :\r\n                 encode_filename(suffix);\r\n        var name = lth.domain + '/' + encode_filename(lth.board.slice(1,-1)) + '/' + lth.no + '/' + suffix; // not to encode '/'\r\n        set_header(header,   0, name, 100);  // name\r\n        set_header(header, 100, '100777', 8);  // mode\r\n        set_header(header, 108, '0', 8);       // uid\r\n        set_header(header, 116, '0', 8);       // gid\r\n        set_header(header, 124, blob.size.toString(8), 12);  // fileSize, octal\r\n        set_header(header, 136, Math.floor(Date.now()/1000).toString(8), 12);  // mtime, octal\r\n        set_header(header, 148, '        ', 8);  // checksum \r\n        header[156] = 0x30;  // type 0 as a normal file.\r\n        var checksum = 0;\r\n        for(i=0;i<157;i++) checksum += header[i];\r\n        set_header(header, 148, checksum.toString(8), 8); // checksum, octal\r\n        return header;\r\n      }\r\n      function set_header(header, pos, numstr, len) {\r\n        var j=0;\r\n        while (j<numstr.length && j<len) header[pos++] = numstr.charCodeAt(j++) & 0xff;\r\n        if (j<len) header[pos++] = 0x00;\r\n      }\r\n      function encode_filename(str){\r\n        return encodeURIComponent(str).replace(/[!'()*]/g, function(c) {\r\n          return '%' + c.charCodeAt(0).toString(16);});\r\n      }\r\n      var tars = {};\r\n      var count = 0;\r\n      return {\r\n        add_blob: function(blob, lth, suffix, tarfile){\r\n          if (!tars[tarfile]) tars[tarfile] = {files:[], size:0};\r\n          var tfile = tars[tarfile];\r\n          tfile.files[tfile.files.length] = make_header(blob, lth, suffix);\r\n          tfile.size += 1;\r\n          tfile.files[tfile.files.length] = blob;\r\n          if (blob.size%512!==0) tfile.files[tfile.files.length] = new Uint8Array(512-blob.size%512);\r\n          tfile.size += Math.floor((blob.size+511)/512);\r\n          if (tfile.size>pref.archive.tarsize*2*1024 || pref.test_mode['71']) this.flush(tarfile);\r\n        },\r\n        flush: function(tarfile){\r\n          tars[tarfile].files[tars[tarfile].files.length] = new Uint8Array(1024);\r\n          download_url4(new Blob(tars[tarfile].files, {type:'application/x-tar'}), 'CatChan_archive_updates_'+tarfile+'_'+(count++)+'.tar');\r\n          delete tars[tarfile];\r\n        },\r\n        flush_all: function(){\r\n          for (var i in tars) this.flush(i);\r\n        },\r\n      };\r\n    })();\r\n    function store_posts(content, type, lth, suffix){\r\n      if (!window.URL) return;\r\n      if (!timestamp) set_timestamp();\r\n      download_url3(new Blob([content], {type:type}), lth, suffix, timestamp);\r\n    }\r\n    function download_url3(blob, lth, suffix, timestamp){\r\n      if (pref.archive.tar) tar.add_blob(blob, lth, suffix, timestamp);\r\n      else download_url4(blob, 'CatChan_'+lth.key.replace(/\\//g,'_') + '_' + suffix);\r\n    }\r\n    function download_url4(blob, filename){\r\n      var url = window.URL.createObjectURL(blob);\r\n      download_url(url, filename);\r\n      window.URL.revokeObjectURL(url);\r\n    }\r\n    function download_url(url, filename){ // this doesn't work if url is cross-origined, for example, i.4cdn.org from boards.4chan.org in 4chan.\r\n      if (pref.test_mode['70']) return;\r\n      var a_link = document.createElement('div');\r\n      a_link.innerHTML = '<a href=' + url + ' download=\"' + filename + '\">';\r\n      a_link.childNodes[0].click();\r\n    }\r\n    var timestamp = null;\r\n    var month = {Jan:'01', Feb:'02', Mar:'03', Apr:'04', May:'05', Jun:'06', Jul:'07', Aug:'08', Sep:'09', Oct:'10', Nov:'11', Dec:'12'};\r\n    function set_timestamp(){\r\n      var arr = new Date().toString().split(' ').slice(1,5);\r\n      timestamp = [arr[2], month[arr[0]], arr[1], arr[3].replace(/:/g,'')].join('');\r\n    }\r\n    var flush_req = DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(function(){\r\n      if (reqs.length==0 && xhrs.size==0) tar.flush_all();\r\n    },5000));\r\n    \r\n    var xhrs = new Map();\r\n    var reqs = [];\r\n//    function download_url2(url, lth, kind, to_file, to_idb){ // for test\r\n//      if (!timestamp) set_timestamp();\r\n//      var req = {url:url, lth:lth, kind:kind, to_file:to_file, to_idb:to_idb, timestamp:timestamp};\r\n    function download_url2(reqs_in){\r\n      for (var i=0;i<reqs_in.length;i++) {\r\n        if (xhrs.size>=10) reqs.push(reqs_in[i]);\r\n        else {\r\n          var xhr = new XMLHttpRequest();\r\n          xhr.responseType = 'blob';\r\n          xhr.onload  = download_url2_1_onload;\r\n          xhr.onerror = download_url2_1_onload;\r\n          xhr.onabort = download_url2_1_onload;\r\n          download_url2_1(xhr, reqs_in[i]);\r\n        }\r\n      }\r\n    }\r\n    function download_url2_1(xhr, req){ // for test\r\n      xhrs.set(xhr, req);\r\n      xhr.open('GET', req.url);\r\n      xhr.send();\r\n      return xhr;\r\n    }\r\n    function download_url2_1_onload(e){\r\n      var xhr = e.target;\r\n      var req = xhrs.get(xhr);\r\n      if (req.from) delete list_all_obj_downloading[req.from];\r\n      if(xhr.status === 200 && e.type==='load') {\r\n        var suffix = req.kind + '_'+ xhr.responseURL.replace(/.*\\//g,'');\r\n        if (req.to_file) download_url3(xhr.response, req.lth, suffix, req.timestamp);\r\n        if (pref.test_mode['65']) if (req.to_idb) IDB.req(req.lth.domain, req.lth.board, req.lth.no, suffix, xhr.response, 'put');\r\n      }\r\n      if (reqs.length>0) {\r\n        req = reqs.shift();\r\n        download_url2_1(e.target, req);\r\n      } else xhrs.delete(xhr);\r\n      if (xhrs.size===0) tar.flush_all();\r\n    }\r\n    function img_dl(kind, th, lth, posts, img, img_idb, webm, webm_idb, reqs){\r\n      for (var i=0;i<posts.length;i++) {\r\n        var url = (kind==='tn')? site2[th.domain].catalog_json2html3_thumbnail(posts[i],th.board) : site2[th.domain].catalog_json2html3_src(posts[i],th.board);\r\n        if (url) {\r\n          if (!timestamp) set_timestamp();\r\n          var proto = {lth:lth, kind:kind, to_file:img||webm, to_idb:img_idb||webm_idb, timestamp:timestamp};\r\n          if ((url.substr(-5,5)==='.webm')? webm || webm_idb : img || img_idb) reqs[reqs.length] = {url:url, __proto__:proto};\r\n          if (posts[i].extra_files) for (var j=0;j<posts[i].extra_files.length;j++) {\r\n            url = (kind==='tn')? site2[th.domain].catalog_json2html3_thumbnail(posts[i].extra_files[j],th.board) : site2[th.domain].catalog_json2html3_src(posts[i].extra_files[j],th.board);\r\n            if ((url.substr(-5,5)==='.webm')? webm || webm_idb : img || img_idb) reqs[reqs.length] = {url:url, __proto__:proto};\r\n          }}}\r\n    }\r\n\r\n    var archive_no = 0;\r\n    function restore(file, result, archive){\r\n      if (!window.URL) return;\r\n      var th_obj = (file.type==='text/html')? new DOMParser().parseFromString(result, 'text/html') : JSON.parse(result);\r\n      var dbt = (pref.archive.format==='auto')? common_func.name2domainboardthread(file.name.replace(/\\.[^\\.]*$/,'').split('_')[0].split('-').slice(0,3).join('/'),true) :\r\n                                                [pref_func.settings.html_funcs.get_domains()[pref.archive.domain],\r\n                                                 '/'+pref.archive.board.replace(/\\//g,'')+'/'];\r\n      cataLog.scan_boards_keyword_callback2(dbt[0]+','+dbt[1]+','+ (archive_no++)+',thread_' + ((file.type==='text/html')? 'html' : 'json'),\r\n                                            {date:Date.now(), status:200, response:th_obj},\r\n                                            ['archive_restore',{found_threads: 0, max_threads:500, found_board:0, scanned:0, refresh:true, localArchive:archive}]);\r\n    }\r\n    function start_1(req, lth, footer){\r\n      if (req==='ARC' || req==='ARC1') {\r\n        lth.archived |= (req==='ARC')? 6 : 5;\r\n        scan.list_nup.add_scan(lth);\r\n      } else if (req==='UARC') {\r\n        lth.archived = 0;\r\n        archiver.clean_list(lth.domain, lth.board, lth.no);\r\n      }\r\n      if (footer && pref.catalog.footer.archived) cataLog.insert_footer3(lth.key);\r\n    }\r\n    var blist = {pn:null, time_bumped:null, time_created:null, time_posted:null, flag:null, footer:null, time_tu:null,\r\n                 nof_posts:null, nof_files:null, tags:null, page:null,\r\n                 quotes:null, backlinks:null, reply_to_me:null, reply_of_mine:null, op_img_url:null}; // BUG. meguca has 'backlinks'.\r\n    function store_json_func(key,value){\r\n      return (blist[key]===null)? undefined : value;\r\n    }\r\n\r\n// https://www.w3.org/TR/html5/scripting-1.html#the-script-element\r\n//   Note: When inserted using the document.write() method, script elements execute (typically synchronously), but when inserted using innerHTML and outerHTML attributes, they do not execute at all.\r\n    var sanitize = (function(){\r\n      var funcs = {\r\n        html: (function(){\r\n          var pn = document.createElement('div');\r\n          var wlist = {'A':null, 'SPAN':null, 'DIV':null, 'BLOCKQUOTE':null, 'BR':null, 'WBR':null,\r\n                       'U':null, 'S':null, 'STRIKE':null, 'B':null, 'I':null, 'BIG':null, 'SMALL':null, 'TT':null, 'SUB':null, 'SUP':null, 'EM':null, 'STRONG':null};\r\n          return function (key,value,obj){\r\n            pn.innerHTML = value;\r\n            var tags = pn.getElementsByTagName('*');\r\n            for (var i=0;i<tags.length;i++) if (wlist[tags[i].tagName]!==null) {obj[key] = '';return;}\r\n          }\r\n        })(),\r\n        string: function (key,value,obj){\r\n          if (value.search(/[<>\"'&]/)!=-1) obj[key] = '';\r\n        }\r\n      };\r\n      return function(ary){\r\n        if (ary) for (var j=0;j<ary.length;j++) {\r\n          var obj = ary[j];\r\n          for (var i in obj)\r\n            if (typeof(obj[i])==='string')\r\n              if (i==='com') funcs.html(i, obj[i], obj);\r\n              else funcs.string(i, obj[i], obj);\r\n        }\r\n        return ary;\r\n      }\r\n    })();\r\n    var ls_key_archive = pref.script_prefix + '.archived';\r\n    var list_all_obj = {};\r\n    if (localStorage) load_list();\r\n    var list_all_obj_downloading = {};\r\n    function list_all(){\r\n      for (var d in liveTag.mems) {\r\n        for (var b in liveTag.mems[d]) {\r\n          var tgt     = list_all_obj[d] && list_all_obj[d][b];\r\n          var tgt_tmp = tgt || {};\r\n          for (var t in liveTag.mems[d][b]) {\r\n            var lth = liveTag.mems[d][b][t];\r\n            if (lth.archived) tgt_tmp[t] = list_all_obj_downloading[lth.key] || lth.time_checked; // BUG. NOT implemented yet.\r\n//            if (lth.archived && !(lth.key in pref3.archive.list_obj2)) list_all_obj[lth.key] = lth.time_checked; // BUG. NOT implemented yet.\r\n          }\r\n          if (!tgt && Object.keys(tgt_tmp).length!==0) {\r\n            if (!list_all_obj[d]) list_all_obj[d] = {};\r\n            list_all_obj[d][b] = tgt_tmp;\r\n          } else if (tgt && Object.keys(tgt).length===0) delete list_all_obj[d][b];\r\n        }\r\n        if (list_all_obj[d] && Object.keys(list_all_obj[d])===0) delete list_all_obj[d];\r\n      }\r\n    }\r\n    function load_list(e){\r\n      if (!e || e.key===ls_key_archive) list_all_obj = JSON.parse(e && e.newValue || localStorage[ls_key_archive] || '{}');\r\n    }\r\n    function save_list(){\r\n      if (pref3.archive.working && localStorage) {\r\n        list_all();\r\n        if (Object.keys(list_all_obj).length===0) delete localStorage[ls_key_archive];\r\n        else localStorage[ls_key_archive] = JSON.stringify(list_all_obj);\r\n      }\r\n    }\r\n    window.addEventListener('storage', load_list, false);\r\n    window.addEventListener('beforeunload', save_list, false);\r\n    return {\r\n      clean_list_all: function(nos, domain, board){\r\n        if (list_all_obj[domain] && list_all_obj[domain][board]) {\r\n          var list_all_obj_bd = list_all_obj[domain][board];\r\n          for (var no in list_all_obj_bd) if (nos[no]!==null) this.clean_list(domain,board,no);\r\n        }\r\n      },\r\n      clean_list: function(domain,board,no){\r\n        if (list_all_obj[domain] && list_all_obj[domain][board]) delete list_all_obj[domain][board][no]; // Since 4chan has 'delayed pruning', final archiving should be done here.\r\n      },\r\n      check_op: function(th,lth){\r\n        var kwd = pref.archive.kwd;\r\n        if (pref.archive.store_auto && kwd.str && (kwd.sub || kwd.name || kwd.com) &&\r\n            cataLog.threads && cataLog.catalog_filter_query_keyword.kwd(pref.archive.kwd, th.posts, th.domain, th)) start_1('ARC', lth, false);\r\n        else {\r\n          var val = this.check_archived_time(th.key, th.domain, th.board, th.no);\r\n          if (val!==false) start_1('ARC', lth, false);\r\n        }\r\n      },\r\n      check_archived_time: function(key, domain, board, no){\r\n        if (pref.archive.list) {\r\n          var val = pref3.archive.list_obj2[key]; // find d/b/t@xxxx expression\r\n          if (val && val.time) return val.time;\r\n        }\r\n        if (pref.archive.list_inherit && list_all_obj[domain] && list_all_obj[domain][board]) val = list_all_obj[domain][board][no];\r\n        if (val!==undefined) return val;\r\n        if (pref.archive.list) val = pref_func.merge_obj5(key,pref3.archive.list_obj2,null); // find all expresion\r\n        return (val)? val.time || 0 : false; // val may be undefined or null.\r\n      },\r\n      update_archived_time: function(name){\r\n        pref3.archive.working = true;\r\n        if (pref3.archive.list_obj2[name] && pref3.archive.list_obj2[name].time) {\r\n          var key = new RegExp('(^|,)'+name.replace(/\\+/,'\\\\+')+'([\\\\^@!][^,\\n]*)*(,|\\n|$)','mg');\r\n//          var millisec = datetime%1000;\r\n//          var time_str = '@' + new Date(datetime).toLocaleString() + ((datetime%1000==0)? '' : '.'+millisec);\r\n//          str = str.value.replace(key,',') + ',' + name + time_str + '\\n';\r\n          pref.archive.list_str = pref.archive.list_str.value.replace(key,',') + ',' + name + '\\n'; // remove time_str\r\n          pref.archive.list_str = str.replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,'');\r\n          pref3.archive.list_obj2[name].time = null;\r\n        }\r\n      },\r\n      store_entry: function(req, downloaded_files){\r\n        if (cataLog.threads) {\r\n          for (var name in cataLog.threads) {\r\n            var lth = liveTag.mems.getFromName(name);\r\n            if (pref.archive.src==='stored' ||\r\n               (pref.archive.src==='watched' && lth.watched) ||\r\n               (pref.archive.src==='shown' && cataLog.threads[name][9][0])) start_1(req, lth, true);\r\n          }\r\n        }\r\n      },\r\n      start_1: start_1,\r\n      store_th_to_mem: function(th,lth){\r\n        if (pref[cataLog.embed_mode].deleted_posts.detect!=='no') {\r\n          var posts = (th.posts && th.posts.length>1 && th.nof_posts>th.posts.length && lth.ta && pref[cataLog.embed_mode].deleted_posts.detect!=='passive')?\r\n                      site2[th.domain].update_posts_replace_prep(th.posts, lth.ta.posts, -1) : th.posts;\r\n          if (pref.test_mode['65'] && pref.archive.IDB.post) {\r\n            var posts_saved;\r\n            if (lth.ta && (lth.ta.posts.length===lth.ta.nof_posts || th.posts.length < th.nof_posts)) {\r\n              var last_no = lth.ta.posts[lth.ta.posts.length-1].no;\r\n              var i=th.posts.length;\r\n              while (i>0 && th.posts[i-1].no>last_no) i--;\r\n              posts_saved = th.posts.slice(i);\r\n            } else posts_saved = th.posts;\r\n            if (posts_saved.length>0) IDB.req(th.domain, th.board, th.no, 'posts', posts_saved, 'put');\r\n          }\r\n          lth.ta = {\r\n            posts: posts,\r\n            nof_posts:th.nof_posts,\r\n            time_loaded:th.time_loaded,\r\n//            __proto__:th  // for debug.\r\n          };\r\n        } else if (lth.ta) delete lth.ta;\r\n      },\r\n      check_deleted_posts: function(value, th, lth){\r\n        var th_old = lth.ta;\r\n        if ((lth.archived || pref[cataLog.embed_mode].deleted_posts.detect!=='no') && th_old && th_old.posts.length>1) {\r\n          var thp = th.posts;\r\n          var othp = th_old.posts;\r\n          var flag = th.nof_posts === th.posts.length || th.type_source==='thread'; // 'thread' is for safe if inconsistent data is returned.\r\n          var i=1;\r\n          var j=1;\r\n//          if (flag) {i=1;j=1;} // patch for 4chan's inconsistency between catalog_json and thread_json, thread_json returns old data and th_old.posts contains blank in it..\r\n          if (flag) lth.rescan_dp = 0;\r\n          else {\r\n            i = th_old.nof_posts - othp.length +1 -(th.nof_posts - thp.length); // for short posts in 4chan catalog.\r\n            j=1;\r\n            if (i<1) {j+=1-i;i=1;}\r\n          }\r\n          var k=0;\r\n          var m=0;\r\n          var othpd = lth.pd || [];\r\n          var post_deleted;\r\n          while (j<othp.length) {\r\n            if (i<thp.length) {\r\n              while (k<othpd.length && thp[i].no>othpd[k].no) k++;\r\n              if (k<othpd.length && thp[i].no==othpd[k].no) {if (!th.native_prep) post_deleted = othpd.splice(k,1); else k++; continue;} // for inconsistent data between thread_json and catalog_json in 4chan.\r\n//              if (j+1<othp.length && othp[j].no === othp[j+1].no) {j++;continue;} // BUG PATCH.\r\n              if (thp[i].no === othp[j].no) {i++;j++;flag=true;continue;}\r\n              if (thp[i].no <   othp[j].no) {i++;              continue;}\r\n            }\r\n            while (m<othpd.length && othp[j].no>othpd[m].no) m++;\r\n            if (m<othpd.length && othp[j].no === othpd[m].no) {j++;continue;}\r\n            if (!flag) { // passive detection, deletion of some posts was detected, but I don't know which.\r\n              if (pref[cataLog.embed_mode].deleted_posts.detect==='full') {lth.rescan_dp=1; scan.list_nup.add_scan(lth);} // can't fild all of them.\r\n              j++;\r\n              continue;\r\n            }\r\n\r\n            post_deleted = othp[j++];\r\n//            while (k<othpd.length && post_deleted.no>=othpd[k].no) k++; // BUG at serial posts are removed.\r\n            if (!post_deleted.deleted_after) {\r\n              post_deleted.deleted_after  = th_old.time_loaded;\r\n              post_deleted.deleted_before = value && value.date || null;\r\n//              post_deleted.deleted_debug  = th.type_parse + ', '+ th_old.type_parse + ', last' + (othp.length-j);\r\n              var posts_wrapped = {posts:[th_old.posts[0]].concat(post_deleted), __proto__:th}; // BUG, post may NOT be derived from th.posts[0], html or json. time_unit may differ.\r\n              site2[th.domain].wrap_to_parse.posts(posts_wrapped); // for merge\r\n            }\r\n            othpd.splice(m++,0,post_deleted);\r\n          }\r\n          lth.pd = (othpd.length>0)? othpd : null;\r\n          if (post_deleted) {\r\n            if (pref[cataLog.embed_mode].deleted_posts.store!=='no' && th.domain===site.nickname) {\r\n              var storage = (pref[cataLog.embed_mode].deleted_posts.store==='LS')? localStorage : sessionStorage;\r\n              if (storage) {\r\n                var ls_key = site2[th.domain].ls_key_deletedPosts + th.board + th.no;\r\n                if (othpd.length>0) storage[ls_key] = JSON.stringify(othpd, store_json_func);\r\n                else delete storage[ls_key];\r\n              }\r\n            }\r\n            if (pref.test_mode['65']) IDB.req(th.domain, th.board, th.no, 'posts_deleted', JSON.stringify(othpd, store_json_func), (othpd.length>0)? 'put' : 'delete');\r\n          }\r\n          if (pref.debug_mode['19'] && post_deleted && lth.pd)\r\n            for (var i=0;i<lth.pd.length-1;i++)\r\n              if (lth.pd[i].no>=lth.pd[i+1].no)\r\n                console.log('BUG: inorder of posts_deleted: '+th.key+', '+i+', '+lth.pd[i].no+', '+lth.pd[i+1].no);\r\n        }\r\n        return (post_deleted)? othpd : null; // return only if it's changed.\r\n      },\r\n      store_json_func: store_json_func, \r\n      store: function(value, th, lth, posts_new, time_check_old){\r\n        var deletedPosts = this.check_deleted_posts(value, th, lth);\r\n        this.store_th_to_mem(th,lth); // MUST BE AFTER 'check_deleted_posts', because it uses lth.ta for old version of posts and this revises them.\r\n        if (lth.archived) {\r\n          var time_checked = this.check_archived_time(th.key, th.domain, th.board, th.no) || time_check_old || 0;\r\n          if (lth.archived&0x04) if (th.posts[th.posts.length-1].time*th.parse_funcs.time_unit<=time_checked || th.time_posted<=time_checked) return;\r\n          if (th.parse_funcs.posts_full) th.parse_funcs.posts_full(th);\r\n          this.update_archived_time(th.key);\r\n          var live_active    = lth.archived&0x02;\r\n          var oneshot_active = lth.archived&0x01;\r\n          var post = live_active && pref.archive.live.post || oneshot_active && pref.archive.oneshot.post;\r\n          var suffix_dbt = th.key.replace(/\\//g,'-');\r\n          if (deletedPosts && post) store_posts(JSON.stringify(deletedPosts), 'text/plain', lth, suffix_dbt+'_'+'deleted.json');\r\n          \r\n          var type = (th.type_data==='html')? 'text/html' : 'text/plain';\r\n          var posts_all = (th.type_source==='thread' || th.posts.length===th.nof_posts)? th.posts : (lth.ta && lth.ta.posts.length===th.nof_posts)? lth.ta.posts : null;\r\n          if (post) {\r\n            var sub = (th.posts[0].sub || '').replace(/\\..*/,'');\r\n            var suffix = suffix_dbt + ((sub)? '_'+sub : '') + ((th.type_data==='html')? '.html' : '.json');\r\n            if (posts_all) store_posts((th.type_source==='thread')? value.responseText :\r\n                                                                    JSON.stringify(site2[th.domain].parse_funcs.thread_json.prep_to_archive(posts_all), store_json_func),\r\n                                       type, lth, suffix);\r\n            else {this.store_rescan(lth); return;}\r\n          }\r\n          if (posts_new || (lth.archived&0x04)) {\r\n            var tn       = live_active && pref.archive.live.tn       || oneshot_active && pref.archive.oneshot.tn;\r\n            var tn_idb   = live_active && pref.archive.live.tn_idb   || oneshot_active && pref.archive.oneshot.tn_idb;\r\n            var img      = live_active && pref.archive.live.img      || oneshot_active && pref.archive.oneshot.img;\r\n            var img_idb  = live_active && pref.archive.live.img_idb  || oneshot_active && pref.archive.oneshot.img_idb;\r\n            var webm     = live_active && pref.archive.live.webm     || oneshot_active && pref.archive.oneshot.webm;\r\n            var webm_idb = live_active && pref.archive.live.webm_idb || oneshot_active && pref.archive.oneshot.webm_idb;\r\n            if (tn || tn_idb || img || img_idb || webm || webm_idb) {\r\n              if (lth.archived&0x04) {\r\n                if (!posts_all && (!th.posts[1] || th.posts[1].time>time_checked) && (!lth.ta.posts[1] || lth.ta.posts[1].time>time_checked)) {this.store_rescan(lth); return;}\r\n                var posts_src = (th.posts[1] && th.posts[1].time<=time_checked)? th.posts : lth.ta.posts;\r\n                var i = posts_src.length;\r\n                while (i>0 && posts_src[i-1].time>time_checked) i--;\r\n                posts_new = posts_src.slice(i); // posts_src contains posts_new always.\r\n              }\r\n              if (posts_new.length!=0) {\r\n                var reqs = [];\r\n                if (tn || tn_idb)                       img_dl('tn',  th, lth, posts_new, tn,  tn_idb,  webm, webm_idb, reqs);\r\n                if (img || img_idb || webm || webm_idb) img_dl('img', th, lth, posts_new, img, img_idb, webm, webm_idb, reqs);\r\n                if (reqs.length!=0) {\r\n                  reqs[reqs.length-1].from = th.key;\r\n                  list_all_obj_downloading[th.key] = time_checked;\r\n                  download_url2(reqs);\r\n                }\r\n              }\r\n            }\r\n          }\r\n          if (post && posts_all && (!reqs || reqs.length===0) && pref.archive.tar) flush_req();\r\n          lth.archived &= 0x02;\r\n        }\r\n      },\r\n      store_rescan: function(lth){\r\n        scan.list_nup.add_scan(lth);\r\n        lth.archived |= 0x04;\r\n      },\r\n//      test_dl: function(url){\r\n//        var xhr = download_url2(url, '4chan_test_xxxx_image_'+ url.replace(/.*\\//g,''));\r\n//        xhr.onprogress = function(e){console.log(e.target.responseURL+': '+e.loaded+'/'+e.total);};\r\n//      },\r\n      restore_entry: function(files, imgs, clear_func){\r\n        var archive = {};\r\n        for (var i=0;i<imgs.length;i++) archive[imgs[i].name] = imgs[i];\r\n        var count = 0;\r\n        if (pref.archive.clear_threads && cataLog.threads) cataLog.catalog_clear_threads(0);\r\n        var fileReader = new FileReader();\r\n        fileReader.onerror = function (e){console.log('ERROR at loading json file, '+e);};\r\n        fileReader.onload = function(){\r\n          restore(files[count-1], fileReader.result, archive);\r\n          if (files.length>count) fileReader.readAsText(files[count++]);\r\n          else if (pref.archive.clear_files) clear_func();\r\n        }\r\n        fileReader.readAsText(files[count++]);\r\n      },\r\n      url2file: function(archive, url){\r\n        var file = archive[url.replace(/[^\\/]*\\//g,'')];\r\n        if (file) {\r\n          if (!file.url) file.url = window.URL.createObjectURL(file);\r\n          return file.url + ((file.type==='video/webm')? '\" data-ext=\".webm' : '');\r\n        } else return url;\r\n      },\r\n//      url2file: function(archive, th){ // cause network access because post_json2html makes url begore this.\r\n//        if (!window.URL) return;\r\n//        var tgts = ['src','href'];\r\n//        var all = th.pn.getElementsByTagName('*'); //'*[src],*[href]'\r\n//        for (var i=0;i<all.length;i++)\r\n//          for (var j=0;j<tgts.length;j++) {\r\n//            var url = all[i].getAttribute(tgts[j]);\r\n//            if (url) {\r\n//              var file = archive[url.replace(/[^\\/]*\\//g,'')];\r\n//              if (file) {\r\n//                if (!file.url) file.url = window.URL.createObjectURL(file);\r\n//                all[i].setAttribute(tgts[j], file.url);\r\n//                if (file.type==='video/webm') all[i].setAttribute('data-ext','.webm');\r\n//              }\r\n//            }\r\n//          }\r\n//      },\r\n      prep_deleted_posts: function(th,lth,src){\r\n        var posts_deleted = (src)? JSON.parse(src) :\r\n          (pref[cataLog.embed_mode].deleted_posts.store==='LS' && localStorage)? sanitize(JSON.parse(localStorage[site2[th.domain].ls_key_deletedPosts + th.board + th.no] || null)) :\r\n          (pref[cataLog.embed_mode].deleted_posts.store==='SS' && sessionStorage)?      JSON.parse(sessionStorage[site2[th.domain].ls_key_deletedPosts + th.board + th.no] || null) : null;\r\n        if (posts_deleted) {\r\n//          for (var i=0;i<posts_deleted.length;i++) delete posts_deleted[i].pn;\r\n          var th_deleted = {posts:[th.posts[0]].concat(posts_deleted),\r\n                            parse_funcs: site2[th.domain].parse_funcs.thread_json,\r\n////                            parse_funcs_html: site2[th.domain].parse_funcs.thread_html,\r\n                            type_parse: 'thread_json',\r\n                            type_source: 'thread',\r\n                            type_data: 'json',\r\n////                            type_html: 'thread_html',\r\n////                            domain_html: th.domain,\r\n//                            nof_posts:th.nof_posts - th.posts.length + posts_deleted.length+1,\r\n                            __proto__:th};\r\n          site2[th.domain].wrap_to_parse.posts(th_deleted);\r\n          if (src && lth.ta) {  // NOT DESCRIBED ALL, UNDER IMPLEMENTATION....\r\n            lth.pd = site2[th.domain].update_posts_merge_prep(th_deleted.posts, lth.pd, -1, true);\r\n            // CALL UPDATE_POSTS HERE.\r\n          } else lth.pd = posts_deleted;\r\n//          if (src) archiver.check_deleted_posts({date:date_load}, th, {archived:true}, th_deleted); // sourced from pipe.\r\n//          else lth.pd = posts_deleted;\r\n        }\r\n      },\r\n      refresh_start: function(){\r\n        save_list(); // for browser's crash, but this make conflicts when multiple window is opened.\r\n        timestamp=null;\r\n      },\r\n    };\r\n  })();\r\n \r\n  var recovery = (pref.features.recovery && localStorage)? (function(){\r\n    var key = site2[site.nickname].ls_key_comment +site.board+site.no;\r\n    var key_old = pref.script_prefix+'.comment.'+site.nickname+site.board+site.no; // patch for half year.\r\n    if (pref.recovery.comment) {\r\n      var comment = localStorage[key] || localStorage[key_old] || '';\r\n      if (comment) {\r\n        if (site.components.postform_comment ) site.components.postform_comment.value  = comment;\r\n        if (site.components.postform_comment2) site.components.postform_comment2.value = comment;\r\n      }\r\n    }\r\n//    function clear(){if (localStorage) delete localStorage[key];}\r\n    var src = null;\r\n    var com = null;\r\n    function com_changed(){\r\n      src = this;\r\n      delayed_check();\r\n    }\r\n    var delayed_check = new DelayBuffer(check_com,1000).get_binded_delayed_do();\r\n    function check_com(){\r\n      var com_new = src.value;\r\n      if (!com || com.length<=com_new.length) com = com_new;\r\n      src = null;\r\n      delayed_save();\r\n    }\r\n    var delayed_save = new DelayBuffer(save, pref.recovery.interval*1000).get_binded_delayed_do();\r\n    function save(){\r\n      if (com) localStorage[key] = com;\r\n      else delete localStorage[key];\r\n      com = null;\r\n    }\r\n    function save_at_exit(){\r\n      if (src) com = src.value;\r\n      if (com!==null) save();\r\n    }\r\n    function setup(rec_inst,postform_comment,postform_submit){\r\n      if (!rec_inst && pref.recovery.comment && postform_comment) {\r\n        var func = com_changed.bind(postform_comment);\r\n        postform_comment.addEventListener('change',func,false);\r\n        postform_comment.addEventListener('keyup',func,false);\r\n        postform_submit.addEventListener('click',func,false);\r\n        rec_inst = [postform_comment, postform_submit, func];\r\n      } else if (rec_inst && (!pref.recovery.comment || !postform_comment)) {\r\n        rec_inst[0].removeEventListener('change',rec_inst[2],false);\r\n        rec_inst[0].removeEventListener('keyup',rec_inst[2],false);\r\n        rec_inst[1].removeEventListener('click',rec_inst[2],false);\r\n        rec_inst = null;\r\n      }\r\n      return rec_inst;\r\n    }\r\n    var rec_inst = setup(null, site.components.postform_comment, site.components.postform_submit);\r\n    var rec_inst2 = null;\r\n    window.addEventListener('beforeunload', save_at_exit, false);\r\n    return {\r\n      setup: function(){\r\n        rec_inst  = setup(rec_inst, site.components.postform_comment, site.components.postform_submit);\r\n        rec_inst2 = setup(rec_inst2,site.components.postform_comment2,site.components.postform_submit2);\r\n      },\r\n      setup2: function(){rec_inst2 = setup(rec_inst2,site.components.postform_comment2, site.components.postform_submit2);},\r\n//      clear: clear,\r\n    }\r\n  })() : null;\r\n\r\n  var scan = (function(){\r\n////    list_nup_boards : Object.create(null), // list of next updates of boards.\r\n////    list_nup : Object.create(null), // list of next updates.\r\n    var list_nup = {\r\n      // th.u: 0:ready, >0:requested, <0:blacklisted\r\n      add: function(th, priority, force_thread){ // -1:locked, [1:0]:req, [2]:req_thread, [3]:force_json, [7:4]:priority,\r\n        if (typeof(th)==='string') th = this.get_th(th);\r\n        priority = (priority || 0) <<4;\r\n        if (th.u===0) th.u = priority | ((force_thread)? 7 : 3);\r\n        else if (th.u>0 && th.u<priority) th.u = priority | (th.u&0x0f);\r\n      },\r\n      add_scan: function(th){\r\n        this.add(th);\r\n        scan.scan_threads_delayed_do();\r\n      },\r\n      issued: function(th){\r\n        if (typeof(th)==='string') th = this.get_th(th);\r\n        if (th) th.u = (((th.u&0x03)===1)? 0xffffff00 : 0) | ((th.u===0)? 2 : th.u-1); // 'if (th)' for page(p0, p1...) // keep upper bits.\r\n        return th && th.no && th.archived;\r\n      },\r\n      got_200: function(th){\r\n        var lth = this.get_th(th.key);\r\n        if (lth.u!==0 && (!(lth.u&0x04) || th.type_source==='thread')) lth.u = 0; // not create instances for future implementation.\r\n      },\r\n      got_404: function(th){\r\n        if (typeof(th)==='string') th = this.get_th(th);\r\n        if (th) th.u = -1;\r\n      },\r\n      get_th: function(key){\r\n        var dbt = common_func.fullname2dbt(key);\r\n        if (dbt[2].search(/(p|q)[0-9]+$/)!=-1) return null; // prevent board to be blacklisted when over page loading.\r\n        if (dbt[2][0]==='t') dbt[2] = dbt[2].substr(1);\r\n        else if (dbt[2].search(/^[0-9]/)==-1) dbt[2] = '';\r\n        return liveTag.mems.init({domain:dbt[0], board:dbt[1], no:dbt[2]});\r\n      },\r\n      priority_th: [0, 0x10, 0x20, 0x30, 0x40, 0x50, 0x60, 0x70, 0x80, 0x90, 0xa0, 0xb0, 0xc0, 0xd0, 0xe0, 0xf0, 0x100],\r\n      get_list_thread: function(d, priority){\r\n        var req_th = this.priority_th[priority || 0];\r\n//        var req_th_u = this.priority_th[(priority || 0)+1];\r\n        var count = 0;\r\n        for (var b in liveTag.mems[d])\r\n          for (var t in liveTag.mems[d][b])\r\n           if (liveTag.mems[d][b][t].u>req_th) count++;            \r\n//           if (liveTag.mems[d][b][t].u>req_th && liveTag.mems[d][b][t].u<req_th_u) count++;\r\n        return (count===0)? null : [count, (function*(req_th){\r\n          for (var b in liveTag.mems[d])\r\n            for (var t in liveTag.mems[d][b])\r\n              if (liveTag.mems[d][b][t].u>req_th) yield liveTag.mems[d][b][t]; // for getting robustness\r\n//              if (liveTag.mems[d][b][t].u>req_th && liveTag.mems[d][b][t].u<req_th_u) yield liveTag.mems[d][b][t];\r\n        })(req_th)];\r\n      },\r\n      get_list_thread2: function(d, priority){ // working code.\r\n        var req_th = this.priority_th[priority || 0];\r\n        var list = [];\r\n//        for (var d in liveTag.mems)\r\n        for (var b in liveTag.mems[d])\r\n          for (var t in liveTag.mems[d][b])\r\n            if (liveTag.mems[d][b][t].u>req_th) list[list.length] = liveTag.mems[d][b][t];\r\n        return list;\r\n      },\r\n      get_list_board: function(d, priority){\r\n        var req_th = this.priority_th[priority || 0];\r\n//        var req_th_u = this.priority_th[(priority || 0)+1];\r\n        var count = 0;\r\n        for (var b in liveTag.mems[d])\r\n          if (liveTag.mems[d][b].u>req_th) count++;\r\n//          if (liveTag.mems[d][b].u>req_th && liveTag.mems[d][b].u<req_th_u) count++;\r\n        return (count===0)? null : [count, (function*(req_th){\r\n          for (var b in liveTag.mems[d])\r\n            if (liveTag.mems[d][b].u>req_th) yield liveTag.mems[d][b];\r\n//            if (liveTag.mems[d][b].u>req_th && liveTag.mems[d][b].u<req_th_u) yield liveTag.mems[d][b];\r\n        })(req_th)];\r\n      },\r\n      get_list_board2: function(d, priority){\r\n        var req_th = this.priority_th[priority || 0];\r\n        var list = [];\r\n        for (var b in liveTag.mems[d])\r\n          if (liveTag.mems[d][b].u>req_th) list[list.length] = liveTag.mems[d][b];\r\n        return list;\r\n      },\r\n//      add_domain: function(domain){liveTag.mems[domain].u = 1;},\r\n      add_domain: function(domain, force_thread, boards){\r\n        if (!liveTag.active.pk){\r\n          if (!boards) {\r\n            for (var b in liveTag.mems[domain])\r\n              if (liveTag.mems[domain][b].o!==null && liveTag.mems[domain][b].o < pref.scan.max) this.add_board(domain+b, null, force_thread);\r\n          } else for (var i=0;i<boards.length;i++) this.add_board(domain+boards[i], null, force_thread);\r\n        } else {\r\n          if (boards) {\r\n            for (var b in liveTag.mems[domain]) { // working code for '>'\r\n              if (liveTag.tags[liveTag.mems[domain][b].btag].pk) this.add_board(domain+b, null, force_thread);\r\n              var btag2 = liveTag.mems[domain][b].btag2;\r\n              if (btag2) {\r\n                for (var i=0;i<btag2.length;i++)\r\n                  if (liveTag.tags[btag2[i]].pk) this.add_board(domain+b, null, force_thread);\r\n              }\r\n            }\r\n          } else {\r\n            for (var i=0;i<pref.scan.max;i++) {\r\n              for (var bt of liveTag.tags[liveTag.tags_array_old[i].key].mems.keys())\r\n                if (!bt.no) this.add_board(bt, null, force_thread);\r\n                else this.add(bt, null, force_thread);\r\n            }\r\n          }\r\n        }\r\n      },\r\n      add_board: function(bd, priority, force_thread, use_boards_json, force_json){\r\n        if (typeof(bd)==='string') bd = this.get_th(bd);\r\n        var upper_bits = ((priority || 0) <<4) | ((force_json)? 8 : 0) | ((force_thread)? 4 : 0);\r\n        if (!use_boards_json || bd.read_max<bd.max) {\r\n          if (bd.u===0) bd.u = upper_bits | 3;\r\n          else if (bd.u>0 && bd.u<priority) bd.u = upper_bits | (bd.u&0x0f);\r\n        }\r\n//        if (force_thread) for (var t in bd) this.add(bd[t], priority, force_thread); // BUG, bd had no members at initial, threads scan doesn't scheduled.\r\n      },\r\n////      add_board: function(bd, use_boards_json, force_thread, priority){ // working code.\r\n////        if (typeof(bd)==='string') bd = this.get_th(bd);\r\n//////        if (bd.u===0) bd.u = 3;\r\n////        if (bd.u===0 && (!use_boards_json || bd.read_max<bd.max)) bd.u = 3;\r\n//////        bd.u = 3;\r\n//////        if (time) {\r\n//////          if (bd.max) bd.read_max = bd.max;\r\n//////          bd.read_time = time;\r\n//////        }\r\n////        if (force_thread) for (var t in bd) this.add(bd[t], force_thread);\r\n////      },\r\n      got_200_board: function(bd){\r\n        if (typeof(bd)==='string') bd = this.get_th(bd);\r\n        if (bd.u&0x04) for (var t in bd) this.add(bd[t], bd.u&0x00f0, true);\r\n        if (bd.max) bd.read_max = bd.max;\r\n        bd.u = 0;\r\n      },\r\n//      add_board: function(bd, time){ // working code.\r\n//        if (typeof(bd)==='string') bd = this.get_th(bd);\r\n////        if (bd.u===0) bd.u = 3;\r\n//        bd.u = 3;\r\n//        if (bd.max) bd.read_max = bd.max;\r\n//        bd.read_time = time;\r\n//      },\r\n////      get_list_board: function(d){ // working code.\r\n////        var list = [];\r\n//////        var time_th = Date.now()-pref.liveTag.pickup_interval*1000;\r\n//////        for (var d in liveTag.mems) {\r\n////////          if (liveTag.mems[d].u) { // for 'add_domain' // working code.\r\n////////            for (var b in liveTag.mems[d]) if (liveTag.mems[d][b].o!==null && liveTag.mems[d][b].o < pref.scan.max) this.add_board(d+b);\r\n////////            liveTag.mems[d].u = 0;\r\n////////          }\r\n//////          if (domain && d!==domain) continue;\r\n////        for (var b in liveTag.mems[d]) {\r\n////          var tgt = liveTag.mems[d][b];\r\n//////          if (tgt.u>0) if (tgt.read_time<time_th && (tgt.max===undefined || !pref.liveTag.utilize_boards_json || tgt.read_max<tgt.max)) list[list.length] = tgt;\r\n//////          if (tgt.u>0) if (tgt.max===undefined || !pref.liveTag.utilize_boards_json || tgt.read_max<tgt.max) list[list.length] = tgt;\r\n////          if (tgt.u>0) list[list.length] = tgt;\r\n////        }\r\n////        return (list.length!==0)? list : null;\r\n////      },\r\n//      query_list_board: function(domain){ // working code.\r\n//        var d = liveTag.mems[domain];\r\n//        if (d)\r\n//          for (var b in d)\r\n//            if (d[b].u>0) return true;\r\n//        return false;\r\n//      },\r\n      scan_boards_enumerate: function(domain, func, ex_list){\r\n        for (var b in liveTag.mems[domain])\r\n          if (pref.virtualBoard.scan_domains[domain]==='thread' || Object.keys(liveTag.mems[domain][b]).length!=0)\r\n//            if (ex_list[liveTag.mems[domain][b].key]===undefined) // prevent multiple scan.\r\n            if (!ex_list.has(liveTag.mems[domain][b])) // prevent multiple scan.\r\n              if (liveTag.mems[domain][b].o!==null && liveTag.mems[domain][b].o < pref.scan.max)\r\n                if (!func || func(liveTag.mems[domain][b])) return true;\r\n      },\r\n    };\r\n    var Scanner = function(type, domain, priority, key){ // type: 'b':boards, 't':threads\r\n      this.type = type;\r\n      this.domain = domain;\r\n      this.key = key;\r\n      this.priority = priority || 0;\r\n      this.scanners[key] = this; // and also this.wdg, this.req\r\n    };\r\n    Scanner.prototype = {\r\n      scanners: Object.create(null),\r\n      func_entry: function(){\r\n        var tgts;\r\nif (!pref.test_mode['51']) { // 1-3 times faster than generator.\r\n        tgts = (this.type==='b')? scan.list_nup.get_list_board2(this.domain, this.priority) : scan.list_nup.get_list_thread2(this.domain, this.priority);\r\n        if (tgts.length!=0) this.func_scan(tgts,null);\r\n        else this.exit();\r\n} else {\r\n        tgts = (this.type==='b')? scan.list_nup.get_list_board(this.domain, this.priority) : scan.list_nup.get_list_thread(this.domain, this.priority);\r\n        if (tgts) this.func_scan(tgts,{tgts_iterator:tgts[1], max:tgts[0]});\r\n        else this.exit();\r\n}\r\n      },\r\n      func_scan: function(tgts,options){\r\n        if (!this.wdg) this.wdg = new Watchdog(this.abort.bind(this),30000);\r\n        cataLog.scan_init(this.key, tgts, {callback: this.func_cont.bind(this),\r\n                                           watchdog: this.wdg.restart.bind(this.wdg),\r\n                                           priority: this.priority,\r\n                                           __proto__: options\r\n                                          });\r\n      },\r\n      func_cont: function() {\r\n        if (this.req) {\r\n          this.req = false;\r\n          this.func_entry();\r\n        } else this.exit();\r\n      },\r\n      exit: function(){\r\n        if (this.wdg) this.wdg.stop();\r\n        this.scanners[this.key] = null\r\n        if (this.type==='b') {\r\n          if (!this.aborted) scan.scan('t', this.domain, this.priority);\r\n        } else if (this.type==='t' && cataLog.catalog_refresh_end) cataLog.catalog_refresh_end();\r\n        if (this.callback) this.callback();\r\n        var priority_next = get_highest_priority(this.type, this.domain);\r\n        var key_next = get_key(this.type, this.domain, priority_next);\r\n        if (this.scanners[key_next]===false) new Scanner(this.type, this.domain, priority_next, key_next).func_entry(); // do scheduled task, but this may not occur.\r\n      },\r\n      abort: function(){\r\n        if (pref.debug_mode['7']) console.log('Scanner_abort: '+this.key);\r\n        cataLog.scan_boards.scan_abort(this.key);\r\n        if (this.aborted===undefined) {\r\n          this.aborted = true;\r\n          this.wdg.restart();\r\n        } else this.exit();\r\n      },\r\n    };\r\n    var ScannerUI = function(key, arg){ // arg is {tgts:, options:}\r\n      this.key = key;\r\n      this.arg = arg;\r\n      this.scanners[key] = this;\r\n      this.callback = this.arg.options && this.arg.options.callback;\r\n    };\r\n    ScannerUI.prototype = {\r\n      scanners: Object.create(null),\r\n      priority: 8,\r\n      func_entry: function(){\r\n        this.func_scan(this.arg.tgts, this.arg.options);\r\n      },\r\n      func_cont: function() {\r\n        if (this.queue && this.queue.length>0) {\r\n          this.arg = this.queue.shift();\r\n          this.func_entry();\r\n        } else this.exit();\r\n      },\r\n      __proto__: Scanner.prototype\r\n    };\r\n    function get_key(type, domain, priority){\r\n      return ((type==='b')? 'scan' : 'scan_threads')+ '_' + domain + ':' + (priority || 0);\r\n    }\r\n    function get_highest_priority(type, domain){\r\n      var key_pre = get_key(type, domain, 0).replace(/0$/,'');\r\n      for (var p=8;p>=0;p--) {\r\n        var scanner = Scanner.prototype.scanners[key_pre+p];\r\n        if (scanner || scanner===false) return p;\r\n      }\r\n      return -1;\r\n    }\r\n    var scan_refresh_ex_list = new Set();\r\n    return {\r\n      scan_refresh: function(health_indicator, list, priority){\r\n        scan_refresh_ex_list.clear();\r\n        for (var i=0;i<list.length;i++) {\r\n          var dbt = common_func.name2domainboardthread(list[i],true);\r\n          if (dbt[2].search(/^[cj]/)===0) scan_refresh_ex_list.add(liveTag.mems[dbt[0]][dbt[1]]);\r\n          else if (dbt[2].search(/^t*[0-9]+/)===0) scan_refresh_ex_list.add(liveTag.mems[dbt[0]][dbt[1]][(dbt[2][0]==='t')? dbt[2].substr(1) : dbt[2]]); // redundant.\r\n        }\r\n        scan.scan('t', null, priority);\r\n        if (!pref.liveTag.use)\r\n          for (var tag in liveTag.tags) // activate selected tags for NOT liveTag mode. In this case, tags are not many.\r\n            if (liveTag.tags[tag].pk)\r\n              for (var bt of liveTag.tags[tag].mems.keys())\r\n                if (!scan_refresh_ex_list.has(bt))\r\n                  if (bt.no) scan.list_nup.add(bt,2);\r\n                  else scan.list_nup.add_board(bt,2);\r\n        for (var d in liveTag.mems) {\r\n          if (pref.liveTag.use) {\r\n            if (site2[d].utilize_boards_json && pref.liveTag.utilize_boards_json) {\r\n              if (list_nup.scan_boards_enumerate(d, null, scan_refresh_ex_list))\r\n                site2[d].get_boards_json('boards_'+d,(function(domain){return function(){scan.scan_refresh_1(domain, true);}})(d),true,health_indicator);\r\n              else scan.scan('t', d);\r\n            } else scan.scan_refresh_1(d, false);\r\n          } else scan.scan('b', d);\r\n        }\r\n      },\r\n      scan_refresh_1: function(domain, use_boards_json){\r\n        list_nup.scan_boards_enumerate(domain, function(bd){scan.list_nup.add_board(bd, null, null, use_boards_json);}, scan_refresh_ex_list);\r\n        scan.scan('b', domain);\r\n      },\r\n//      scan_refresh_move_req: function(list){ // working code.\r\n//        for (var i=0;i<list.length;i++) {\r\n//          var dbt = common_func.name2domainboardthread(list[i],true);\r\n//          if (dbt[2].search(/^[cj]/)===0) {\r\n//            scan.list_nup.add_board(dbt[0]+dbt[1]);\r\n//            list.splice(i--,1);\r\n//          } else if (dbt[2].search(/^t*[0-9]+/)===0) {\r\n//            scan.list_nup.add(dbt[0]+dbt[1]+((dbt[2][0]==='t')? dbt[2].substr(1) : dbt[2]));\r\n//            list.splice(i--,1);\r\n//          }\r\n//        }\r\n//      },\r\n      scan: function(type, domain, priority){\r\n        if (!domain) for (var d in liveTag.mems) this.scan(type, d, priority);\r\n        else {\r\n          var key = get_key(type, domain, priority);\r\n          var scanner = Scanner.prototype.scanners[key];\r\n          if (scanner) scanner.req = true; // multi entry.\r\n          else if (get_highest_priority(type, domain)>=priority) Scanner.prototype.scanners[key] = false; // schedule\r\n          else if (type==='b' && (scanner = Scanner.prototype.scanners[get_key('t', domain, priority)]))\r\n            scanner.callback = function(){scan.scan(type, domain, priority);}; // schedule\r\n          else new Scanner(type, domain, priority, key).func_entry();\r\n        }\r\n      },\r\n      abort: function(){\r\n        for (var s in Scanner.prototype.scanners) {\r\n          var scanner = Scanner.prototype.scanners[s];\r\n          if (scanner) {\r\n            if (scanner.wdg) scanner.wdg.stop();\r\n            scanner.abort();\r\n          }\r\n        }\r\n      },\r\n      scan_ui: function(key, arg){\r\n        var scanner = ScannerUI.prototype.scanners[key];\r\n        if (scanner) {\r\n          if (!this.queue) this.queue = [];\r\n          this.queue[this.queue.length] = arg; // multi entry.\r\n        } else new ScannerUI(key, arg).func_entry();\r\n      },\r\n      scan_threads_delayed_do: DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(function(){scan.scan('t');}, 200)),\r\n      keyword_load: function(force, health_indicator){\r\n        var flag = true;\r\n        for (var domain in pref.virtualBoard.scan_domains) {\r\n          if (pref.virtualBoard.scan_domains[domain]!=='none') {\r\n            this.keyword_load_1(domain, force, null, health_indicator);\r\n            flag = false;\r\n          }\r\n        }\r\n        if (flag) this.keyword_load_1(site.nickname, force, null, health_indicator);\r\n      },\r\n      keyword_load_1: function(domain, force, boards, health_indicator){\r\n//          if (!site3[domain].boards && (domain===site.nickname || pref.virtualBoard.scan_domains[domain]!=='none')) {\r\n        if (!site3[domain].boards && ((!force && pref.virtualBoard.scan_domains[domain]!=='none') ||\r\n                                       (force && liveTag.active.pk) || !boards)) {\r\n          site2[domain].get_boards_json('kwd_load',function(){scan.keyword_load_1(domain, force, boards, health_indicator)},false,health_indicator);\r\n          return;\r\n        }\r\n//          if (domain===site.nickname || pref.virtualBoard.scan_domains[domain]==='thread') {\r\n//          if (pref.virtualBoard.scan_domains[domain]!=='none' || force) {\r\n        if (pref.virtualBoard.scan_domains[domain]==='thread' || force) {\r\n          scan.list_nup.add_domain(domain, force && pref.catalog.filter.kwd.post, boards);\r\n          scan.scan('b',domain);\r\n        }\r\n      },\r\n      list_nup: list_nup,\r\n    };\r\n  })();\r\n\r\n  function make_catalog_obj(pn12_button){\r\n    var catalog_func = null;\r\n    function show_hide(){\r\n      if (catalog_func===null) catalog_func = make_catalog(pn12_button);\r\n      else catalog_func = catalog_func.destroy();\r\n    }\r\n    var embed_catalog = pref.catalog.embed && site.whereami==='catalog';\r\n    var embed_page    = pref.catalog.embed_page && site.whereami==='page';\r\n    var embed_frame   = pref.catalog.embed_frame && site.whereami==='frame';\r\n    var embed_mode = (pref.catalog.embed && site.whereami==='catalog')? 'catalog' :\r\n                     (pref.catalog.embed_page && site.whereami==='page')? 'page' :\r\n                     (pref.thread.embed && site.whereami==='thread')? 'thread' : 'float';\r\n    var embed_embed = embed_mode!=='float';\r\n//    cataLog.embed_mode = embed_mode; // moved to later.\r\n    if (embed_embed) {\r\n////      pref.catalog_board_list_sel = 0;\r\n////      pref.catalog.filter.show = true;\r\n////      pref.catalog_show_setting = true;\r\n////      pref.catalog.design = 'catalog';\r\n//      show_hide();  // moved after making software cache because of subscription.\r\n//      if (brwsr.ff || site.settings) pn12_button.textContent = 'Frame'; // working code.\r\n//      else pn12_button.getElementsByTagName('input')[0].value = 'Frame';\r\n    } else {\r\n////      pref.catalog.design = 'page';\r\n      pn12_button.addEventListener('click', show_hide, false); // show_hide\r\n    }\r\n    styleSheet.init(embed_mode); // patch, but WHY???\r\n//if (!(brwsr.ff && embed_mode==='catalog' && site.nickname==='4chan')) styleSheet.init(); // patch, but WHY???\r\n////////if (!(brwsr.ff && embed_mode==='catalog' && site.nickname==='4chan')) { // patch, but WHY??? // working code.\r\n//////////    var ss = document.styleSheets[document.styleSheets.length-1];\r\n//////////    if (!ss) {\r\n//////////      var ss = document.createElement('style');\r\n//////////      document.head.appendChild(ss);\r\n//////////      ss = ss.sheet;\r\n//////////    }\r\n////////    var ss = document.head.appendChild(document.createElement('style')).sheet;\r\n////////    ss.insertRule('.catalog_triage_parent {pointer-events: none;}',0); \r\n////////    ss.insertRule('.catalog_triage_button {pointer-events: auto;}',1);\r\n////////    pref_func.style_sheet = ss;\r\n////////    pref_func.settings.onchange_funcs['catalog.click_area_add_rule'](); // rule 2.\r\n////////    ss.insertRule('.'+pref.script_prefix+'_tag {cursor:pointer;}',3);\r\n////////}\r\n\r\n    function scan_tags_common(ths,html_str,tags_obj){\r\n      var acc = true;\r\n      if (tags_obj===undefined) {\r\n        tags_obj = {cs:{}, ci:{}};\r\n        acc = false;\r\n      }\r\n      for (var i in ths) {\r\n        var tags_th = ths[i].tags;\r\n        if (tags_th) {\r\n          var dbt = cnst.name2domainboardthread(i,true);\r\n          var tags_th_uniq = {};\r\n          for (var j=tags_th.length-1;j>=0;j--)\r\n            if (tags_th_uniq[tags_th[j]]===undefined) tags_th_uniq[tags_th[j]] = null; // BUG. #aaa and #AAA are counted as 2 in case insensitive mode.\r\n            else tags_th.splice(j,1);\r\n          if (tags_th.length<=pref.catalog.tag.max) {\r\n            var end = (pref.catalog.tag.ignore<tags_th.length)? pref.catalog.tag.ignore : tags_th.length;\r\n            for (var j=0;j<end;j++) {\r\n              for (var k in tags_obj) {\r\n                var tag_test = (k==='cs')? tags_th[j] : tags_th[j].toLowerCase();\r\n                if (tags_obj[k][tag_test]===undefined) tags_obj[k][tag_test] = {num:1,mem:{}};\r\n                else tags_obj[k][tag_test].num++;\r\n                if (!tags_obj[k][tag_test].mem[dbt[0]+dbt[1]]) tags_obj[k][tag_test].mem[dbt[0]+dbt[1]] = 1;\r\n                else tags_obj[k][tag_test].mem[dbt[0]+dbt[1]]++;\r\n      }}}}}\r\n      if (!acc) return scan_tags_common_b(tags_obj,html_str,{cs:[],ci:[]})[0];\r\n    }\r\n    function scan_tags_common_b(tags_obj, html_str, tags){ // CAN'T FIND 1->0 AT A BOARD.\r\n      for (var i in tags_obj) {\r\n        for (var j in tags_obj[i]) {\r\n          var tag_ref = (i==='cs')? j : j.toLowerCase();\r\n          for (var n=0;n<tags[i].length;n++) {\r\n            var tag_test = (i==='cs')? tags[i][n].key : tags[i][n].key.toLowerCase();\r\n            if (tag_ref===tag_test) {\r\n              for (var k in tags_obj[i][j].mem) tags[i][n].mem[k] = tags_obj[i][j].mem[k]; // update.\r\n//var old = tags[i][n].num;\r\n              tags[i][n].num = 0;\r\n              for (var k in tags[i][n].mem) tags[i][n].num += tags[i][n].mem[k];\r\n//if (old!=tags[i][n].num) console.log(i+', '+j+', '+n+', '+tag_test+', '+old+', '+tags[i][n].num);\r\n              delete tags_obj[i][j]; // works in Chrome and FF, BUT DANGEROUS?\r\n              break;\r\n            }\r\n          }\r\n        }\r\n        for (var j in tags_obj[i]) tags[i].push({key:j, num:tags_obj[i][j].num, mem:tags_obj[i][j].mem});\r\n//        tags[i].sort(function(a,b){return b.num - a.num;});\r\n        tags[i].sort(function(a,b){return (b.num!=a.num)? b.num - a.num : (b.key > a.key)? -1:1;});\r\n      }\r\n      for (var i=0;i<tags.ci.length;i++) {\r\n        var key = tags.ci[i].key.toLowerCase();\r\n        for (var j=0;j<tags.cs.length;j++)\r\n          if (key===tags.cs[j].key.toLowerCase()) {tags.ci[i].key=tags.cs[j].key; break;}\r\n      }\r\n      return scan_tags_common_c(tags, html_str);\r\n    }\r\n    function scan_tags_common_c(tags, html_str){\r\n      var tags_tgt = (pref.catalog.filter.tag_ci)? tags.ci : tags.cs;\r\n      var str2 = '';\r\n      for (var i=0;i<tags_tgt.length;i++) {\r\n        var item = tags_tgt[i].num + ': ' + tags_tgt[i].key;\r\n        str2 = str2 + '<input type=\"checkbox\"' + html_str + '> '+item + '<br>';\r\n      }\r\n      return [str2, tags];\r\n    }\r\n//    function scan_tags_common(ths,html_str,tags_obj){\r\n//      var acc = true;\r\n//      if (tags_obj===undefined) {\r\n//        tags_obj = {cs:{}, ci:{}};\r\n//        acc = false;\r\n//      }\r\n//      for (var i in ths) {\r\n//        var tags_th = ths[i].tags;\r\n//        if (tags_th) {\r\n//          var dbt = cnst.name2domainboardthread(i,true);\r\n//          var tags_th_uniq = {};\r\n//          for (var j=tags_th.length-1;j>=0;j--)\r\n//            if (tags_th_uniq[tags_th[j]]===undefined) tags_th_uniq[tags_th[j]] = null;\r\n//            else tags_th.splice(j,1);\r\n//          if (tags_th.length<=pref.catalog.tag.max) {\r\n//            var end = (pref.catalog.tag.ignore<tags_th.length)? pref.catalog.tag.ignore : tags_th.length;\r\n//            for (var j=0;j<end;j++) {\r\n//              for (var k in tags_obj) {\r\n//                var tag_test = (k==='cs')? tags_th[j] : tags_th[j].toLowerCase();\r\n//                if (tags_obj[k][tag_test]===undefined) tags_obj[k][tag_test] = {num:0,mem:{}};\r\n//                tags_obj[k][tag_test].num++;\r\n//                tags_obj[k][tag_test].mem[dbt[0]+dbt[1]] = null;\r\n//      }}}}}\r\n//      if (!acc) return scan_tags_common_b(tags_obj,html_str)[0];\r\n//    }\r\n//    function scan_tags_common_b(tags_obj,html_str){\r\n//      var tags = [];\r\n//      for (var i in tags_obj.cs) tags.push({key:i, num:tags_obj.cs[i].num, mem:tags_obj.cs[i].mem});\r\n//      tags.sort(function(a,b){return b.num - a.num;});\r\n//      if (pref.catalog.filter.tag_ci) {\r\n//        for (var i=0;i<tags.length-1;i++) {\r\n//          var key = tags[i].key.toLowerCase();\r\n//          tags[i].num = tags_obj.ci[key].num;\r\n//          tags[i].mem = tags_obj.ci[key].mem;\r\n//          for (var j=tags.length-1;j>i;j--) if (key===tags[j].key.toLowerCase()) tags.splice(j,1);\r\n//        }\r\n//        tags.sort(function(a,b){return b.num - a.num;});\r\n//      }\r\n//      var str2 = '';\r\n//      for (var i=0;i<tags.length;i++) {\r\n//        var item = tags[i].num + ': ' + tags[i].key;\r\n//        str2 = str2 + '<input type=\"checkbox\"' + html_str + '> '+item + '<br>';\r\n//      }\r\n//      return [str2, tags];\r\n//    }\r\n////    function scan_tags_common(ths,html_str,tags_obj,acc){\r\n////      if (tags_obj===undefined) tags_obj = {};\r\n//////      var tags_obj = {};\r\n////      for (var i in ths) {\r\n////        var tags_th = ths[i].tags;\r\n////        if (tags_th) {\r\n////          var tags_th_uniq = {};\r\n////          for (var j=tags_th.length-1;j>=0;j--)\r\n////            if (tags_th_uniq[tags_th[j]]===undefined) tags_th_uniq[tags_th[j]] = null;\r\n////            else tags_th.splice(j,1);\r\n////          if (tags_th.length<=pref.catalog.tag.max) {\r\n////            var end = (pref.catalog.tag.ignore<tags_th.length)? pref.catalog.tag.ignore : tags_th.length;\r\n////            for (var j=0;j<end;j++) {\r\n////              if (tags_obj[tags_th[j]]===undefined) tags_obj[tags_th[j]] = [0,{}];\r\n////              tags_obj[tags_th[j]][0]++;\r\n////              tags_obj[tags_th[j]][1][i] = 0;\r\n////            }\r\n////          } \r\n////        }\r\n////      }\r\n////      if (!acc) return scan_tags_common_b(tags_obj,html_str);\r\n////    }\r\n////    function scan_tags_common_b(tags_obj,html_str){\r\n////      var tags = [];\r\n////      for (var i in tags_obj) tags.push({key:i, val:tags_obj[i][0], mem:tags_obj[i][1]});\r\n////      tags.sort(function(a,b){return b.val - a.val;});\r\n////      if (pref.catalog.filter.tag_ci) {\r\n////        for (var i=0;i<tags.length-1;i++) {\r\n////          var key = tags[i].key.toLowerCase();\r\n////          for (var j=tags.length-1;j>i;j--) {\r\n////            if (key===tags[j].key.toLowerCase()) {\r\n//////console.log(tags[i].key+', '+tags[i].val +' + '+tags[j].key+', '+tags[j].val);\r\n////              tags[i].val += tags[j].val;\r\n////              for (var k in tags[j].mem) tags[i].mem[k] = 0;\r\n////              tags.splice(j,1);\r\n////            }\r\n////          }\r\n////        }\r\n////        for (var i in tags) tags[i].val = Object.keys(tags[i].mem).length;\r\n////        tags.sort(function(a,b){return b.val - a.val;});\r\n////      }\r\n////      var str2 = '';\r\n////      for (var i=0;i<tags.length;i++) {\r\n////        var item = tags[i].val + ': ' + tags[i].key;\r\n////        str2 = str2 + '<input type=\"checkbox\"' + html_str + '> '+item + '<br>';\r\n////      }\r\n////      return str2;\r\n////    }\r\n    function make_catalog(pn12_button){\r\n      cataLog.embed_mode = embed_mode;\r\n      if (pref[embed_mode].open_spoiler_text) styleSheet.open_spoiler_text();\r\n      if (brwsr.sw_cache && pref.info_client) brwsr.sw_cache.subscribe(true);\r\n//      var threads = []; // This makes non-associative array.\r\n      var threads = {}; // This makes object.\r\n      cataLog.threads = threads;\r\n      var threads_idx = [];\r\n      var pop_up_status = {};\r\n////////      var boards = {};\r\n//      var threads_last_deleted = {};\r\n      var initialize_loop = true;\r\n\r\n      var pn12_0_4 = document.createElement('div');\r\n      var pn12_whole = cnst.init('left:0px:tile:get:bottom:resize:both:Show:tb:width:'+pref.catalog.appearance.initial.width+'px:height:'+pref.catalog.appearance.initial.height+'px:resize:both:overflow:auto',\r\n        function(){pn12_0_4.style.display='';},function(){pn12_0_4.style.display='none';},show_hide,show_catalog_cont);\r\n      var pn12 = pn12_whole[0];\r\n      if (embed_embed) pn12.style.display = 'none';\r\n      var pn12_rollup_func = pn12_whole[1];\r\n\r\n//// test for prototype base coding.\r\n////      var pn12_whole = new Cnst2('left:0px:tile:get:bottom:resize:both:Show:tb:width:400px:height:400px:resize:both:overflow:auto',\r\n////        {rolldowm:function(){pn12_0_4.style.display='';}, rollup:function(){pn12_0_4.style.display='none';}, exit:show_hide, maximize:show_catalog_cont});\r\n////      var pn12 = pn12_whole.pn;\r\n////      var pn12_rollup_func = pn12_whole.funcs.rollup;\r\n\r\n      cnst.bottom_top(pn12);\r\n      var pn12_0 = pn12.childNodes[0];\r\n      var pn12_1 = pn12.childNodes[1];\r\n//      pn12_1.innerHTML = '<div style=\"display:none\"></div><div></div>'; // doesn't work\r\n//      pn12_1.innerHTML = '<div style=\"display:none\"></div><div style=\"width:inherit;height:800px;resize:both;overflow:auto\"></div>'; // doesn't work\r\n//      pn12_1.innerHTML = '<div style=\"display:none\"></div><div style=\"width:inherit;height:inherit;resize:both;overflow:auto\"></div>'; // doesn't work\r\n//    var pn12_0_4 = pn12_1.childNodes[0];\r\n//      var pn12_1_1 = pn12_1.childNodes[1];\r\n      pn12_1.id = 'catalog_debug';\r\n      var autorollup_state = false;\r\n      function auto_hide_catalog() {\r\n        if (pref.catalog_auto_rollup_when_moving) {\r\n          if (pn12_1.style.display!='none') {\r\n            pn12_rollup_func();\r\n            autorollup_state = true;\r\n          } else if (autorollup_state) {\r\n            pn12_rollup_func();\r\n            autorollup_state = false;\r\n          }\r\n        }\r\n      }\r\n      pn12.addEventListener('dragstart', auto_hide_catalog, false);\r\n      pn12.addEventListener('dragend'  , auto_hide_catalog, false);\r\n      var pn12_0_2 = cnst.add_to_tb(pn12,\r\n//        '<label name=\"filter\"><input type=\"checkbox\" name=\"catalog.filter.show\"> Filter </label>' +\r\n//        '<label name=\"settings\"><input type=\"checkbox\" name=\"catalog_show_setting\"> Settings</label>'+\r\n        '<button name=\"filter\"><img src=\"' + cnst.icons.filter + '\" style=\"width:14px;height:14px\"></button>' +\r\n        '<button name=\"settings\"><img src=\"' + cnst.icons.settings + '\" style=\"width:14px;height:14px\"></button>'+\r\n//        '<button name=\"refresh\">Refresh</button>'+\r\n//        '<button name=\"refresh\">\\u27f3</button>'+\r\n        '<button name=\"refresh\"><img src=\"' + cnst.icons.refresh + '\" style=\"width:14px;height:14px\"></button>'+\r\n        '<span name=\"num_of_pages\">'+\r\n          '<span name=\"hide_at_embed\"> up to <input type=\"text\" name=\"catalog_max_page\" size=\"2\" style=\"text-align: right;\">pages in </span></span>'+\r\n        '<span name=\"boards_selector\"><select name=\"catalog_board_list_sel\"></select></span>');\r\n      var board_sel = pn12_0_2.getElementsByTagName('select')['catalog_board_list_sel'];\r\n      cnst.auto_shrink_board_selector.setup(board_sel,pref.catalog_board_list_sel);\r\n      pref_func.apply_prep(pn12_0_2,false);\r\n      var pn12_0_2_childs = ['filter','settings','refresh','num_of_pages','boards_selector'];\r\n      for (var i=0;i<pn12_0_2_childs.length;i++)\r\n        if (!pref.catalog.appearance.titleBar[pn12_0_2_childs[i]]) pn12_0_2.getElementsByTagName('*')[pn12_0_2_childs[i]].style.display = 'none';\r\n      pn12_1.style.width = pn12_0.offsetWidth + 'px';\r\n\r\n      var healthIndicator = (function(){\r\n        var his = [];\r\n        var count = 0;\r\n        var status = {};\r\n        var HealthIndicator = function(){\r\n          this.pn = document.createElement('span');\r\n          this.pn.innerHTML = '<span style=\"color:limegreen\"></span><span></span>';\r\n          this.pn_countdown = this.pn.childNodes[0];\r\n          this.pn_hi = this.pn.childNodes[1];\r\n//          if (!(embed_catalog)) pn_hi.style['font-size'] = '24px';\r\n          if (!pref.healthIndicator.show) this.pn.style.display = 'none';\r\n          his.push(this);\r\n          this.elems = [];\r\n        }\r\n        HealthIndicator.prototype = {\r\n          shift: function(col,str,initiator,priority){\r\n//            while (this.elems.length>=pref.healthIndicator.max) this.elems.shift().remove_from_parent();\r\n            for (var i=this.elems.length-pref.healthIndicator.max;i>=0;i--) if (this.elems[i].remove_from_parent()) this.elems.splice(i,1);\r\n            var elem = new HealthIndicatorElement(col,str,initiator,priority);\r\n            this.pn_hi.insertBefore(elem.pn, this.pn_hi.firstChild);\r\n            this.elems.push(elem);\r\n            return elem;\r\n          },\r\n          destroy: function(){\r\n            this.pn.parentNode.removeChild(this.pn);\r\n            his.splice(his.indexOf(this),1);\r\n          },\r\n//          remove: function(tgt){this.elems.splice(this.elems.indexOf(tgt),1)[0].remove();},\r\n//          set: function(col,str){this.elems[this.elems.length-1].set(col,str);}, // PATCH\r\n        };\r\n        var HealthIndicatorElement = function(col,str,initiator,priority){\r\n          this.pn = document.createElement('span');\r\n          this.name = 'healthIndicator.' + (count++);\r\n          this.pn.setAttribute('name',this.name);\r\n          this.set(col,str);\r\n          this.pn.onmouseover = mouseover;\r\n          this.pn.onmouseout  = mouseout;\r\n          this.pn.onclick     = click;\r\n          status[this.name] = {initiator:initiator, priority:priority};\r\n          this.show_tooltip_delayed = new DelayBuffer(show_tooltip.bind(this), 100).get_binded_delayed_do();\r\n//          this.status = status[this.name]; // patch for faster execution.\r\n        }\r\n        var src = null;\r\n        HealthIndicatorElement.prototype = {\r\n          set: function(col,str){\r\n            if (str) this.pn.textContent = str;\r\n            if (col) this.pn.setAttribute('style','color:'+col);\r\n          },\r\n          remove_from_parent: function(){ // must be called from parent to remove elems[this].\r\n            if (pref.healthIndicator.dont_retire_running && !status[this.name].end) return false;\r\n            delete status[this.name];\r\n            this.pn.parentNode.removeChild(this.pn);\r\n            if (this.pn===src) mouseout();\r\n            return true;\r\n          },\r\n          remove: function(){\r\n            if (this.remove_from_parent())\r\n              for (var i=0;i<his.length;i++) {\r\n                var idx = his[i].elems.indexOf(this);\r\n                if (idx!=-1) {\r\n                  his[i].elems.splice(idx,1);\r\n                  return;\r\n                }\r\n              }\r\n          },\r\n          report: function(obj){\r\n            var stat = status[this.name];\r\n            if (!stat) return; // when indicator was pruned.\r\n            var prog = stat.prog; // prepare for being overwritten.\r\n            if (obj) for (var i in obj) {\r\n              if (i==='err_str') stat[i] = ((stat[i])? stat[i]+', ':'') + obj[i];\r\n              else stat[i] = obj[i];\r\n              if (i==='end') {\r\n                if (prog) {\r\n                  stat.prog_str = prog.found_threads+'/'+prog.scanned+', '+prog.found_boards+'/'+prog.max;\r\n                  stat.prog = null; // remove reference loop.\r\n                }\r\n                var result = (!stat.err_str)? '\\u25cf' :\r\n                             (prog && Object.keys(prog.error_obj).length<prog.max)? '\\u25b2' : 'X';\r\n                this.set((result==='X')?'red':null, result);\r\n              }\r\n            }\r\n            if (src || pref.healthIndicator.expand_running) this.show_tooltip_delayed();\r\n          },\r\n        };\r\n        function mouseover(e){\r\n          src = this;\r\n          show_tooltip.call(this,e);\r\n        }\r\n        function show_tooltip(e){\r\n          var name = this.name || this.getAttribute('name');\r\n          var stat = status[name];\r\n          if (!stat) return; // retired already.\r\n          if (stat.prog) stat.prog_str = stat.prog.found_threads+'/'+stat.prog.scanned+', '+stat.prog.found_boards+'/'+stat.prog.idx+'/'+stat.prog.max+', ' + stat.tgt;\r\n          var cancel_button = !stat.end && !pref.healthIndicator.cancel;\r\n          var html = 'Initiator: '+stat.initiator+'&emsp;'+\r\n                     ((cancel_button)? '<button name=\"'+name+'\">Cancel</button>' : '')+ '<br>' +\r\n                     ((stat.start)? 'Start: '+ new Date(stat.start).toLocaleTimeString()+'<br>' : '')+\r\n                     ((stat.prog_str)? 'Progress: '+ stat.prog_str+'<br>' : '')+\r\n                     'Priority: '+ stat.priority+'<br>'+\r\n                     ((stat.start && !stat.end && stat.prog)? 'Crawler: '+ stat.prog.crawler+'<br>' : '')+\r\n                     ((stat.err_str)? '<span style=\"color:red\">Errors: '+ stat.err_str+'</span><br>' : '')+\r\n                     ((stat.abort_str)? '<span style=\"color:red\">Abort: '+ stat.abort_str+'</span><br>' : '')+\r\n                     ((stat.end)? 'End: '+ new Date(stat.end).toLocaleTimeString()+'<br>' : '');\r\n          if (src && src.getAttribute('name')===name) pref_func.tooltips.show_1.call(src, e, html, (cancel_button)? tooltip_func : null, true);\r\n          if (!e && pref.healthIndicator.expand_running && stat.start && !stat.end) this.set(null,' :'+stat.prog_str);\r\n        }\r\n        function mouseout(e){\r\n          src = null;\r\n        }\r\n        function tooltip_func(pn){\r\n          pn.getElementsByTagName('button')[0].onclick = cancel_scan;\r\n        }\r\n        function click(){\r\n          if (pref.healthIndicator.cancel) cancel_scan.call(this);\r\n        }\r\n        function cancel_scan(){\r\n          var name = this.getAttribute('name');\r\n          if (status[name] && !status[name].end) cataLog.scan_boards.scan_abort(status[name].initiator);\r\n        }\r\n        function show(){\r\n          var disp = (pref.healthIndicator.show)? '' : 'none';\r\n          for (var i=0;i<his.length;i++) his[i].pn.childNodes[1].style.display = disp;\r\n        }\r\n        function shrink_running(){\r\n          if (!pref.healthIndicator.expand_running)\r\n            for (var i=0;i<his.length;i++) \r\n              for (var j=0;j<his[i].elems.length;j++) if (his[i].elems[j].pn.textContent.length>1) his[i].elems[j].set(null,'r');\r\n        }\r\n        return {\r\n          HealthIndicator: HealthIndicator,\r\n          show: show,\r\n          shrink_running: shrink_running,\r\n        }\r\n      })();\r\n      cataLog.healthIndicator = healthIndicator;\r\n      var health_indicator = new healthIndicator.HealthIndicator();\r\n      pn12_0.childNodes[3].appendChild(health_indicator.pn);\r\n\r\n////      var health_indicator = (function(){ // working code.\r\n////        var pn_hi = document.createElement('span');\r\n//////        if (!(embed_catalog)) pn_hi.style['font-size'] = '24px';\r\n////        if (!pref.catalog.health_indicator.on) pn_hi.style.display = 'none';\r\n////        pn12_0.childNodes[3].appendChild(pn_hi);\r\n////        function insert_node(col,str){\r\n////          var max = pref.catalog.health_indicator.max;\r\n////          while (pn_hi.childNodes.length>=max) pn_hi.removeChild(pn_hi.lastChild);\r\n////          var pn = document.createElement('span');\r\n////          if (col) pn.setAttribute('style','color:'+col);\r\n////          if (str) pn.innerHTML = str;\r\n////          pn_hi.insertBefore(pn,pn_hi.firstChild);\r\n////          return pn;\r\n//////          while (pn_hi.childNodes.length>=max) pn_hi.removeChild(pn_hi.childNodes[pn_hi.childNodes.length-1]);\r\n//////          pn_hi.innerHTML = '<span' + ((col)? ' style=\"color:'+col+'\"' : '' ) + '>'+str+'</span>' + pn_hi.innerHTML;\r\n////        }\r\n////        pref_func.health_indicator = pn_hi;\r\n////        return {\r\n////          pn_hi : pn_hi,\r\n////          set: function(pn,col,str){\r\n//////            if (!pn) pn = pn_hi.childNodes[0];\r\n////            if (str) pn.textContent = str;\r\n////            if (col) pn.style.color = col;\r\n////          },\r\n////          shift: function(col,str){return insert_node(col,str);},\r\n////          remove: function(pn){\r\n////            pn.parentNode.removeChild(pn);\r\n////          }\r\n////        }\r\n////      })();\r\n\r\n      if (embed_mode==='float') pn12_0_4.setAttribute('class', pref.script_prefix+'_window');\r\n      pn12_0_4.style = 'margin:0px 3px; clear:both';\r\n      pn12_0.appendChild(pn12_0_4);\r\n      pn12_0_4.innerHTML = pref_func.format_html_str(\r\n        '<div style=\"float:right\">'+\r\n          '<div style=\"float:right\">'+\r\n            '<ICBX\"' + embed_mode + '.auto_update\"> Auto update<br>'+\r\n            '1,<ITB3\"' + embed_mode + '.auto_update_period\"> min.<br>'+\r\n//            '<input type=\"checkbox\" name=\"catalog_snoop_refresh\" checked> Snoop update<br>'+\r\n//            '&emsp;<input type=\"checkbox\" name=\"catalog_promiscuous\"> Promiscuous<br>'+\r\n            '<ICBX\"catalog_refresh_clear\"> Clear latter than<br>'+\r\n            '1,<ITB4\"catalog.max_threads_at_refresh\">th at update<br>'+\r\n            '<BTN\"clear_threads,ClearAllThreads\">'+\r\n          '</div>'+\r\n          '<div style=\"float:right\">'+\r\n            '<div name=\"hide_at_embed\">'+\r\n//              '<select name=\"catalog.indexing\"><option>Last reply</option><option>Creation date</option><option>Reply count</option><option>Image count</option></select><br>'+\r\n              '<select name=\"catalog.indexing\"><option>Bump order</option><option>Creation date</option><option>Reply count</option><option>Image count</option><option>Last reply</option><option>Fast</option><option>/Bump order</option><option>/Creation date</option><option>/Reply count</option><option>/Image count</option><option>/Last reply</option><option>Slow</option></select><br>'+\r\n              'size '+\r\n              '<span name=\"catalog.text_mode.mode.graphic\">'+\r\n                '<input type=\"text\" name=\"catalog_size_width\" size=\"4\" style=\"text-align: right;\"> x '+\r\n                '<input type=\"text\" name=\"catalog_size_height\" size=\"4\" style=\"text-align: right;\"></span>'+\r\n              '<span name=\"catalog.text_mode.mode.text\">'+\r\n                '<input type=\"text\" name=\"catalog_size_text_width\" size=\"4\" style=\"text-align: right;\"> x '+\r\n                '<input type=\"text\" name=\"catalog_size_text_height\" size=\"4\" style=\"text-align: right;\"></span>'+\r\n            '</div>'+\r\n            '<div>'+\r\n//              '&emsp;Order<br>'+\r\n              '<ICBX\"catalog.order.reply_to_me\"> New reply to me at first<br>'+\r\n              '<ICBX\"catalog.order.reply\"> New reply at first<br>'+\r\n//              '<input type=\"checkbox\" name=\"catalog.order.watch\"> Watch listed at first<br>'+\r\n              pref_func.settings.html_funcs.rollup_radio('catalog.order.watch', ' :Watch listed', 1, '',\r\n                ['first:at first','last:at last','dont_care:don\\'t care'])+ '<br>'+\r\n              pref_func.settings.html_funcs.rollup_radio('catalog.order.sticky', ' :Sticky', 1, '',\r\n                ['first:at first','last:at last','dont_care:don\\'t care'])+ '<br>'+\r\n//              '&emsp;<input type=\"radio\" name=\"catalog.order.sticky\" value=\"hide\"> hide<br>'+\r\n            '</div>'+\r\n          '</div>'+\r\n//          '<div style=\"float:right\">'+\r\n//            '<div name=\"hide_at_embed\">'+\r\n//              '<input type=\"radio\" name=\"catalog.text_mode.mode\" value=\"graphic\"> Graphical mode<br>'+\r\n//              '<input type=\"radio\" name=\"catalog.text_mode.mode\" value=\"text\"> Text mode<br>'+\r\n//            '</div>'+\r\n//          '</div>'+\r\n        '</div>'+\r\n        '<div align=\"left\" style=\"float:left\">'+\r\n          '<div data-show3=\"kwd\">'+\r\n            '<a name=\"HIDE3\" style=\"cursor:pointer\">[-]</a>'+\r\n            '<ICBX\"catalog.filter.kwd.use\"> Keyword :'+\r\n//            '<textarea style=\"height:1em\" cols=\"25\" name=\"catalog.filter.kwd.str\"></textarea>'+\r\n            '<input type=\"text\" name=\"catalog.filter.kwd.str\" size=\"25\">'+\r\n            ' <ICBX\"catalog.filter.kwd.ci\">CI '+\r\n            pref_func.settings.html_funcs.make_sel('catalog.filter.kwd.match', ['match all','match any','unmatch all','unmatch any'])+\r\n            ' <ICBX\"catalog.filter.kwd.sentence\">Sentence'+\r\n            ' <ICBX\"catalog.filter.kwd.re\">RE<br>'+\r\n            '1,(<ICBX\"catalog.filter.kwd.sub\">Subject '+\r\n            '<ICBX\"catalog.filter.kwd.name\">Name '+\r\n//            '<input type=\"checkbox\" name=\"catalog.filter.kwd.trip\">Tripcode '+\r\n            '<ICBX\"catalog.filter.kwd.com\">Comment '+\r\n            '<ICBX\"catalog.filter.kwd.file\">Filename '+\r\n            '<ICBX\"catalog.filter.kwd.meta\">No.)'+\r\n            ' (<ICBX\"catalog.filter.kwd.op\">OP '+\r\n            '<ICBX\"catalog.filter.kwd.post\">Posts)'+\r\n            '<button name=\"scanBoard\">></button>'+\r\n            '<button name=\"scanSite\">>></button>'+\r\n          '</div>'+\r\n//          '<div>'+\r\n////            '<button name=\"scanSite\">scanSite</button> '+\r\n//////////            '<span name=\"scan_progress\"></span><br>'+\r\n////            '<button name=\"clear_threads\">ClearAllThreads</button>'+\r\n////            '<input type=\"checkbox\" name=\"common.clear_at_manual_scan\">Auto <br>'+\r\n////            '<div style=\"float:left;overflow:auto;resize:both;\" name=\"catalog.filter.tag_site_list\"></div>'+\r\n////            '<input type=\"checkbox\" name=\"catalog.filter.tag_scansite\">scan tags<br>'+\r\n//          '</div>'+\r\n          '<div style=\"clear:both\" data-show3=\"time\">'+\r\n            '<a name=\"HIDE3\" style=\"cursor:pointer\">[-]</a>'+\r\n            'Time: Posted/Created '+\r\n            '<ICBX\"catalog.filter.time\">'+\r\n            '<ICBX\"catalog.filter.time_creation\">Hide '+\r\n//            '<input type=\"checkbox\" name=\"catalog.filter.time_mark\"> Mark: '+\r\n            '<ICBX\"catalog.filter.time_watch\">'+\r\n            '<ICBX\"catalog.filter.time_watch_creation\">Watch '+\r\n//            '<textarea style=\"height:1em\" cols=\"25\" name=\"catalog.filter.time_str\"></textarea>'+\r\n            '<ITBL25\"catalog.filter.time_str\">'+\r\n            '<select name=\"catalog.filter.time_quick_sel\">'+\r\n              '<option>quick select...</option>'+\r\n              '<option>now</option>'+\r\n              '<option>1 hour ago</option>'+\r\n              '<option>2 hours ago</option>'+\r\n              '<option>4 hous ago</option>'+\r\n              '<option>12 hours ago</option>'+\r\n              '<option>1 day ago</option>'+\r\n              '<option>3 days ago</option>'+\r\n              '<option>1 week ago</option>'+\r\n            '</select><br>'+\r\n          '</div>'+\r\n          '<div style=\"clear:both;display:none\" data-show3=\"tag\">'+\r\n            '<a name=\"HIDE3\" style=\"cursor:pointer;float:left\">[-]</a>'+\r\n            '<div style=\"float:left\">'+\r\n              '<input type=\"checkbox\" name=\"catalog.filter.tag\"> Tag :'+\r\n            '</div>'+\r\n            '<div style=\"float:left;overflow:auto;resize:both;\" name=\"catalog.filter.tag_list\"></div>'+\r\n            '<div style=\"float:left;overflow:auto;resize:both;\" name=\"catalog.filter.tag_board_list\"></div>'+\r\n            '<ITBL25\"catalog.filter.tag_search.str\" placeholder=\"Search tags...\">'+\r\n//            ' <ICBX\"catalog.filter.tag_search.ci\">CI'+\r\n            ' <ICBX\"catalog.filter.tag_search.re\">RE'+\r\n          '</div>'+\r\n          '<div style=\"clear:both;display:none\" data-show3=\"list\">'+\r\n            '<a name=\"HIDE3\" style=\"cursor:pointer;float:left\">[-]</a>'+\r\n            '<div style=\"float:left\">'+\r\n              '<input type=\"checkbox\" name=\"catalog.filter.list\"> Exclusive list:<br>'+\r\n  //            '<input type=\"checkbox\" name=\"catalog.filter.list_mark_time\"> Mark:<br>'+\r\n  //            '<!-- &emsp;<input type=\"checkbox\" name=\"catalog.filter.list_time_scroll\"> Scroll to new post -->'+\r\n  //            '<div style=\"clear:both\">&emsp;<textarea style=\"height:1em\" cols=\"20\" name=\"catalog.filter.list_str\"></textarea></div>'+\r\n              '&emsp;<textarea style=\"height:1em\" cols=\"20\" name=\"catalog.filter.list_str\"></textarea>'+\r\n            '</div>'+\r\n            '<div style=\"float:left\">'+\r\n  //            '<div style=\"float:left\"><input type=\"checkbox\" name=\"catalog.filter.attr_list\"> Attribute list:<br></div>'+\r\n              '<input type=\"checkbox\" name=\"catalog.filter.attr_list\"> Attribute list:<br>'+\r\n              '&emsp;<textarea style=\"height:1em\" cols=\"20\" name=\"catalog.filter.attr_list_str\"></textarea>'+\r\n            '</div>'+\r\n            '<div style=\"float:left\">'+\r\n              'Watch time list:<br>'+\r\n  //            '<input type=\"checkbox\" name=\"catalog.filter.watch_list_mark_time\"> Mark:<br>'+\r\n              '&emsp;<textarea style=\"height:1em\" cols=\"20\" name=\"catalog.filter.watch_list_str\"></textarea>'+\r\n            '</div>'+\r\n            '<div style=\"float:left\">'+\r\n              '<input type=\"checkbox\" name=\"catalog.filter.bookmark_list\"> Bookmark list:<br>'+\r\n              '&emsp;<textarea style=\"height:1em\" cols=\"10\" name=\"catalog.filter.bookmark_list_str\"></textarea>'+\r\n            '</div>'+\r\n            '<div style=\"float:left\">'+\r\n              '<button name=\"load\">load</button><input type=\"checkbox\" name=\"catalog.auto_load_filter\">Auto'+\r\n              '&emsp;<button name=\"load_default\">clear_filters</button><br>'+\r\n              '<button name=\"save\">save</button><input type=\"checkbox\" name=\"catalog.auto_save_filter\">Auto'+\r\n              '&emsp;<input type=\"checkbox\" name=\"catalog.auto_save_filter_at_refresh\">Auto at refresh<br>'+\r\n            '</div>'+\r\n          '</div>'+\r\n          '<a name=\"SHOW3\" style=\"cursor:pointer;float:left;display:none\" data-show3=\"kwd\">[+ keyword filter]</a>'+\r\n          '<a name=\"SHOW3\" style=\"cursor:pointer;float:left;display:none\" data-show3=\"time\">[+ Time filter]</a>'+\r\n          '<a name=\"SHOW3\" style=\"cursor:pointer;float:left\" data-show3=\"tag\">[+ Tag search]</a>'+\r\n          '<a name=\"SHOW3\" style=\"cursor:pointer;float:left\" data-show3=\"list\">[+ List filters]</a>'+\r\n        '</div>'+\r\n        '<div style=\"clear:both\"></div>');\r\n//      if (!embed_embed) pn12_0_4.style.background = '#e5ecf9';\r\n//      else if (embed_mode==='catalog') {\r\n      if (embed_mode==='catalog' || embed_mode==='page') {\r\n        pn12_0_2.getElementsByTagName('span')['hide_at_embed'].style.display = 'none';\r\n        pn12_0_4.getElementsByTagName('div')['hide_at_embed'].style.display = 'none';\r\n        if (embed_mode==='catalog') site2[site.nickname].catalog_native_frame_prep(pn12,pn12_button);\r\n      }\r\n      var hide_target = (pref.catalog.text_mode.mode==='text')? 'catalog.text_mode.mode.graphic' : 'catalog.text_mode.mode.text';\r\n      pn12_0_4.getElementsByTagName('span')[hide_target].style.display = 'none';\r\n      filter_kwd_prep_init(null, pref.catalog.filter.kwd,true); // prep kwd.kwds\r\n\r\n//      pref_func.tooltips.add_hier(pn12_0_4);\r\n      pref_func.tooltips.add_root(pn12_0_4);\r\n//      if (pref[embed_mode].auto_config_posts_search) auto_config_posts_search_deactivate();\r\n      pref_func.apply_prep(pn12_0_4,false, null, null, true);\r\n//      pref_func.apply_prep(pn12_0_4,true); // obj init.\r\n      var pn12_0_4_selectors = pn12_0_4.getElementsByTagName('select');\r\n      for (var i=0;i<pn12_0_4_selectors.length;i++) cnst.auto_shrink_selector(pn12_0_4_selectors[i]);\r\n//      function catalog_setting_onchange_event(){\r\n////console.log(this);\r\n//        pref_func.apply_prep(this,true);\r\n//        if (onchange_funcs[this.name]) onchange_funcs[this.name]();\r\n//      }\r\n      var pn_filter = pn12_0_4.childNodes[1];\r\n      var catalog_board_list_sel_old;\r\n      var oninput_funcs = {\r\n        'catalog.filter.kwd.str': (function(){\r\n          var pn_use = pn_filter.getElementsByTagName('*')['catalog.filter.kwd.use'];\r\n          return function(e){\r\n            if (pref.catalog.filter.kwd.use == !pref.catalog.filter.kwd.str) {\r\n              pref.catalog.filter.kwd.use = !pref.catalog.filter.kwd.use;\r\n              pref_func.apply_prep(pn_use,false);\r\n            }\r\n            if (e && e.target.name.substr(-4,4)==='.str') pref3.catalog.filter.kwd.str(e);\r\n            filter_kwd_prep(e, pref.catalog.filter.kwd);\r\n          }\r\n        })(),\r\n        'catalog.filter.list_str'  : function(){catalog_filter_changed();if (pref[embed_mode].mark_new_posts) format_html.time_filter_changed();},\r\n        'catalog.filter.attr_list_str': function(){if (pref.catalog.filter.attr_list) catalog_attr_changed();},\r\n        'catalog.filter.tag_search.str': function(){liveTag.filter_onchange(pref.catalog.filter.tag_search);},\r\n        __proto__: pref_func.settings.onchange_funcs.__proto__\r\n      };\r\n      cataLog.oninput_funcs = oninput_funcs;\r\n      var onchange_funcs = {\r\n//        'catalog.filter.show' : function(){cnst.show_hide(pn_filter,pn12_1);},\r\n//        'catalog_show_setting': function(){cnst.show_hide(pn_setting,pn12_1);},\r\n        'filter' : function(){cnst.show_hide(pn_filter,pn12_1);cnst.toggleButton(this);},\r\n        'settings': function(){cnst.show_hide(pn_setting,pn12_1);cnst.toggleButton(this);},\r\n//        'refresh'             : function(){catalog_refresh(true,null,false);},\r\n        'refresh'             : function(){auto_update.timer_tgt(true);},\r\n        'catalog_board_list_sel' : function(e, init){\r\n          if (!init) {\r\n            e.target.blur();\r\n            if (pref.catalog.auto_save_filter) onchange_funcs.save(catalog_board_list_sel_old);\r\n            if (pref.catalog.refresh.at_switch) catalog_clear_threads(0);\r\n            prep_reserved_tags(false,catalog_board_list_sel_old);\r\n            catalog_refresh(pref.catalog.refresh.at_switch,null,false);\r\n          }\r\n          if (pref.catalog.auto_load_filter) onchange_funcs.load();\r\n          if (pref[embed_mode].auto_config_posts_search) {\r\n            pref.catalog.filter.kwd.post = false;\r\n            pref_func.apply_prep(pn12_0_4.getElementsByTagName('input')['catalog.filter.kwd.post'],true);\r\n          }\r\n          catalog_board_list_sel_old = pref.catalog_board_list_sel;\r\n        },\r\n        'catalog_size_width'  : catalog_resized,\r\n        'catalog_size_height' : catalog_resized,\r\n        'catalog_size_text_width'  : catalog_resized,\r\n        'catalog_size_text_height' : catalog_resized,\r\n        'catalog.indexing'    : re_sort_thread,\r\n//        'catalog.indexing'    : function(){\r\n//          threads_idx=[];\r\n//          for (var i in threads) insert_thread_idx(i);\r\n//          show_catalog();\r\n//        },\r\n        '*.auto_update' : function(){auto_update.set()},\r\n        '*.auto_update_period' : '*.auto_update',\r\n        'clear_threads'       : function(){catalog_clear_threads(0);show_catalog();},\r\n        'load'                : function(){\r\n          if (localStorage) {\r\n            pref_func.pref_overwrite(pref.catalog.filter,pref_default().catalog.filter);\r\n            try { \r\n              pref_func.pref_overwrite(pref.catalog.filter,JSON.parse(localStorage.getItem(onchange_funcs.load_save_key(board_sel.selectedIndex))),true);\r\n              pref_func.apply_prep(pn_filter,false, null, null, true); // also make obj.\r\n//              pref_func.apply_prep(pn_filter,true); // make obj2.\r\n              filter_kwd_prep_init(null, pref.catalog.filter.kwd, initialize_loop);\r\n              liveTag.filter_onchange(pref.catalog.filter.tag_search, true);\r\n              catalog_attr_changed();\r\n            } catch (e){\r\n            }\r\n          }\r\n        },\r\n//        'save_onleave'        : function(){if (pref.catalog.auto_save_filter) onchange_funcs.save();window.removeEventListener('beforeunload', onchange_funcs.save_onleave, false);},\r\n//        'save'                : function(){if (localStorage) localStorage.setItem(onchange_funcs.load_save_key(pref.catalog_board_list_sel),JSON.stringify(pref.catalog.filter));},\r\n        'save'                : function(sel){\r\n          if (localStorage) {\r\n            if (sel===undefined) sel = pref.catalog_board_list_sel;\r\n            var pf = pref.catalog.filter;\r\n            var save_str = JSON.stringify(\r\n              pref_func.obj_elim_the_same(pref_default().catalog.filter, pref.catalog.filter),\r\n              (!pf.time && !pf.time_watch && !pf.time_watch_creation && !pf.time_creation)?\r\n                function(key,value){return (key==='time_str')? undefined : value;} : undefined);\r\n            var key = onchange_funcs.load_save_key(sel);\r\n            if (!key) return;\r\n            if (save_str==='{}') delete localStorage[key];\r\n            else localStorage.setItem(key, save_str);\r\n          }\r\n        },\r\n        'load_default'               : function(){\r\n//          var pref_def = pref_default();\r\n          pref_func.pref_overwrite(pref.catalog.filter,pref_default().catalog.filter);\r\n//          pref.catalog.filter.time_str = new Date().toLocaleString();\r\n          pref_func.apply_prep(pn12_0_4,false, null, null, true);\r\n//          pref_func.apply_prep(pn12_0_4,true); // obj init.\r\n          filter_kwd_prep(null, pref.catalog.filter.kwd);\r\n          catalog_attr_changed();\r\n        },\r\n        'load_save_key'       : function(num){\r\n          var row_obj = pref.catalog_board_list_obj[num];\r\n          return (row_obj)? pref.script_prefix + '.catalog.filter.' + row_obj[0].key : null;},\r\n        'catalog.filter.kwd.use'   : filter_kwd_active,\r\n        'catalog.filter.kwd.match' : filter_kwd_prep,\r\n        'catalog.filter.kwd.re'    : filter_kwd_prep,\r\n        'catalog.filter.kwd.ci'    : filter_kwd_prep,\r\n        'catalog.filter.kwd.sentence': filter_kwd_prep,\r\n        'catalog.filter.kwd.op'    : filter_kwd_active,\r\n        'catalog.filter.kwd.sub'   : filter_kwd_active,\r\n        'catalog.filter.kwd.name'  : filter_kwd_active,\r\n        'catalog.filter.kwd.file'  : filter_kwd_active,\r\n        'catalog.filter.kwd.com'   : filter_kwd_active,\r\n        'catalog.filter.kwd.trip'  : filter_kwd_active,\r\n        'catalog.filter.kwd.meta'  : filter_kwd_active,\r\n        'catalog.filter.kwd.post'  : function(e){\r\n          filter_kwd_active(e);\r\n          if (pref[embed_mode].auto_config_posts_search) {\r\n            if (e.target.checked) {\r\n              pref[embed_mode].t2h_sel = 'ALL_agg';\r\n              if (embed_mode==='catalog') pref[embed_mode].popup2 = 'sr';\r\n              onchange_funcs.scanBoard();\r\n            } else {\r\n              var pref_def = pref_default();\r\n              pref[embed_mode].t2h_sel = pref_def[embed_mode].t2h_sel;\r\n              if (embed_mode==='catalog') pref[embed_mode].popup2 = pref_def[embed_mode].popup2;\r\n            }\r\n            pref_func.apply_prep(pref_func.mirror_targets.pn13_1,false);\r\n          }\r\n        },\r\n        'catalog.filter.tag'       : catalog_filter_changed,\r\n//        'catalog.filter.tag_list'  : catalog_filter_changed,\r\n        'catalog.filter.time'      : oninput_funcs['catalog.filter.list_str'],\r\n        'catalog.filter.time_creation' : 'catalog.filter.time',\r\n        'catalog.filter.time_str'  : 'catalog.filter.time',\r\n        'catalog.filter.list'      : 'catalog.filter.time',\r\n        'catalog.filter.watch_list_str' : 'catalog.filter.time',\r\n//        'catalog.filter.attr_list' : catalog_filter_changed,\r\n//        'catalog.filter.attr_list_str' : catalog_filter_changed,\r\n//        'catalog.filter.attr_list' : show_catalog, //catalog_attr_changed,\r\n//        'catalog.filter.attr_list_str' : show_catalog, //catalog_attr_changed\r\n        'catalog.filter.attr_list' : catalog_attr_changed,\r\n//        'scan'                     : scan_tags,\r\n        'scanBoard' : function(){if (pref.common.clear_at_manual_scan) onchange_funcs.clear_threads();scan.keyword_load_1(site.nickname,true,[site.board], health_indicator);},\r\n        'scanSite' : function(){if (pref.common.clear_at_manual_scan) onchange_funcs.clear_threads();scan.keyword_load(true, health_indicator);},\r\n        'catalog.order.reply_to_me' : re_sort_thread,\r\n        'catalog.order.reply'       : re_sort_thread,\r\n        'catalog.order.watch'       : re_sort_thread,\r\n        'catalog.order.sticky'      : re_sort_thread,\r\n//        'catalog.filter.tag_ci'     : function(){scan_tags_init(scan_tags_common_c(site3[site.nickname].tags,'')[0], null);},\r\n        'catalog.filter.time_quick_sel': function(){\r\n          var time = [0,0,1,2,4,12,24,72,168][this.selectedIndex]*3600000;\r\n          ago_clicked(null, time);\r\n        },\r\n        'catalog.filter.tag_search.re': 'catalog.filter.tag_search.str',\r\n        __proto__: oninput_funcs,\r\n      };\r\n////      onchange_funcs.entry_func = (function(myself){ // working code.\r\n////        return function(e){\r\n////          pref_func.apply_prep(this,true);\r\n////          var this_name = this.getAttribute('name'); // for <span>\r\n////          if (myself[this_name]) myself[this_name].call(this,e);\r\n////          else if (this_name.indexOf('.')!=-1 && this_name.substr(0,this_name.indexOf('.'))===embed_mode) {\r\n////            var name = this_name.substr(this_name.indexOf('.')+1);\r\n////            if (myself[name]) myself[name].call(this,e);\r\n////          }\r\n////        }\r\n////      })(onchange_funcs);\r\n      window.addEventListener('beforeunload', window_beforeunload, false);\r\n      oninput_funcs = pref_func.add_onchange_format(oninput_funcs);\r\n      onchange_funcs = pref_func.add_onchange_format(onchange_funcs);\r\n      pref_func.add_onchange(pn12_0_2,onchange_funcs, oninput_funcs); // causes 1 leak.\r\n      cataLog.event_func = pref_func.add_onchange(pn12_0_4,onchange_funcs, oninput_funcs); // causes 1 leak.\r\n//console.log('init_onchange');\r\n      window.addEventListener('storage', site2[site.nickname].prep_own_posts_event, false);\r\n//      site2[site.nickname].prep_own_posts();\r\n      site2[site.nickname].check_reply.make_own_posts(); // prevent from calling twice.\r\n      function window_beforeunload() {\r\n        if (pref.catalog.auto_save_filter && embed_mode!=='thread') onchange_funcs.save();\r\n        window.removeEventListener('beforeunload', window_beforeunload, false);\r\n      }\r\n      if (initialize_loop && pref.virtualBoard.scan && embed_mode!=='thread')\r\n        setTimeout(function(){scan.keyword_load(false, health_indicator);}, pref.virtualBoard.scanDelay*1000);\r\n      \r\n      var pn_setting = pn12_0_4.childNodes[0];\r\n////      if (!pref.catalog_show_setting) pn_setting.style.display = 'none';\r\n      pn_setting.style.display = 'none';\r\n      var triage_parent = (embed_embed)? site2[site.nickname].catalog_get_native_area() : pn12_1;\r\n      cataLog.parent = triage_parent;\r\n//      if (pref.catalog.auto_load_filter) onchange_funcs.load();\r\n      onchange_funcs.catalog_board_list_sel(null,true);\r\n\r\n      var tags_scan_regex = new RegExp('#[^#, \\.:;\\n]+(?=#|,| |\\.|:|;|\\n|$)','g'); // ATTENTION. REFER function prep_tag_str(); // AND ALSO IN scan_tag_obj.\r\n      var scan_boards = (function(){\r\n//        var scan_button   = pn12_0_4.getElementsByTagName('button')['scanSite'];\r\n////////        var scan_boards   = {args:{}, crawler_timer:null, pool:null};\r\n        var scan_boards   = {args:{}, pool:null};\r\n////////        var scan_progress = (function(){\r\n////////          var elem = pn12_0_4.getElementsByTagName('span')['scan_progress'];\r\n////////          var timer = null;\r\n////////          var str = '';\r\n////////          function show(){elem.innerHTML=str; timer=null;}\r\n////////          return function(s){str=s; if (timer===null) timer = setTimeout(show,100);};\r\n////////        })();\r\n////////        function keyword_load(key){ // working code.\r\n////////          if (scan_boards_check_pre(key,true)) {\r\n//////////            if (pref.common.clear_at_manual_scan && !keep) onchange_funcs.clear_threads();\r\n////////            scan_button.innerHTML = 'Cancel';\r\n////////            if (!site3[site.nickname].boards) {\r\n////////              http_req.get(key,site.nickname,site2[site.nickname].url_boards_json(),scan_boards_keyword_callback,pref.scan.lifetime*60,true,key);\r\n////////              scan_progress('Loading boards\\' information');\r\n////////            } else {\r\n////////              var tgts = site2[site.nickname].enumerate_boards_to_scan(); // must remake to evaluate change of preference.\r\n////////              scan_boards_init(key, tgts, {lifetime:pref.scan.lifetime*60, cache_write:true,\r\n////////                                           callback:(pref.liveTag.use)? catalog_liveTag_scan_threads : null, callback_args:'scan'});\r\n////////            }\r\n////////          }\r\n////////        }\r\n        function scan_boards_check_pre(key){\r\n          if (scan_boards.args[key]) {\r\n            if (scan_boards.args[key].max != scan_boards.args[key].idx) {\r\n              scan_boards.args[key].max = scan_boards.args[key].idx;\r\n              if (scan_boards.args[key].indicator) scan_boards.args[key].indicator.report({abort_str:'canceled'});\r\n            } else {\r\n////////              if (scan_boards.args[key].crawler_watchdog) scan_boards.args[key].crawler_watchdog.stop();\r\n              crawler.watchdog.abort(key);\r\n              if (scan_boards.args[key].indicator) scan_boards.args[key].indicator.report({abort_str:'aborted', end:Date.now()});\r\n              delete scan_boards.args[key];\r\n            }\r\n            return false;\r\n          } else return true;\r\n        }\r\n//        function scan_boards_keyword_init(key){\r\n//          scan_boards_init(key, site3[site.nickname].boards,pref.catalog.filter.tag_scansite,pref.catalog.filter.tag_scansite,pref.scan.lifetime*60);\r\n//          var obj = [];\r\n//          obj.max_threads = pref.scan.max_threads;\r\n//          var count = pref.scan.max;\r\n//          for (var i in site3[site.nickname].boards) if (site3[site.nickname].boards[i].max) {\r\n//            obj.push('/'+site3[site.nickname].boards[i].uri+'/');\r\n//            if (--count==0) break;\r\n//          }\r\n//          scan_boards_init(key, obj, {lifetime:pref.scan.lifetime*60, cache_write:true});\r\n//        }\r\n        function scan_init(key,mem,args){\r\nif (pref.debug_mode['5']) console.log('scan_init: '+key);\r\n          if (!scan_boards_check_pre(key,false)) return;\r\n          if (!Array.isArray(mem)) mem = Object.keys(mem);\r\n          if (mem.length==0) {\r\n            if (args.callback) args.callback(args.callback_args);\r\n            return;\r\n          }\r\n          scan_boards_init(key, mem, args);\r\n        }\r\n        function scan_boards_init(key, obj, args){\r\n          if (!scan_boards.pool) scan_boards.pool = {\r\n            div: document.createElement('div'), parser: new DOMParser(), doc: null, ths: null, dbt: null, tgts: null, tags:{cs:{}, ci:{}},\r\n            name:null, sticky:null, type:null, wrapper_obj:null};\r\n  //        var obj = site3[site.nickname].boards;\r\n          scan_boards.args[key] = {\r\n                key: key,\r\n                idx: 0,\r\n//                max: (obj.length>pref.scan.max)? pref.scan.max : obj.length,\r\n                max: obj.length,\r\n//                max_threads: (obj.length>pref.scan.max)? obj.length : pref.scan.max,\r\n                max_threads: pref.scan.max_threads,\r\n                found_threads: 0,\r\n                found_boards: 0,\r\n                scanned: 0,\r\n////////                error: '',\r\n                error_obj: {},\r\n                crawler: 0,\r\n////////                crawler_max : pref.scan.crawler,\r\n                obj: obj,\r\n//                scan_tag: pref.catalog.filter.tag_scansite,\r\n//                store_tag: pref.catalog.filter.tag_scansite,\r\n                lifetime: 0,\r\n                cache_write: false,\r\n                callback : null,\r\n                callback_args : null,\r\n                pool: scan_boards.pool,\r\n                refresh: null,\r\n                indicator: null,\r\n                tgt_raw: false,\r\n                watchdog: null,\r\n////////                spawn_crawler: function(){scan_boards_spawn_crawler(key);},\r\n////////                crawler_watchdog: null,\r\n                from_auto: null,\r\n                load_on_demand: null,\r\n//                tag_only: null,\r\n                senders_returned:[],\r\n                priority: 0,\r\n                tgts_iterator: null,\r\n          };\r\n          for (var i in args) scan_boards.args[key][i] = args[i];\r\n          var sb = scan_boards.args[key];\r\n\r\n          if (sb.load_on_demand && !sb.tgts_iterator) {\r\n////            sb.max = 1; // working code.\r\n////            for (var i=obj.length-1;i>=1;i--) {\r\n////              var name = 'ODL:'+ sb.obj[i];\r\n////              var idx = threads_idx.indexOf(name);\r\n////              if (idx!=-1) threads_idx.splice(idx,1);\r\n////              threads_idx.unshift(name);\r\n////            }\r\n            for (var i=0;i<sb.obj.length;i++) {\r\n              var tgt = scan_boards_keyword_make_tgt(sb,i);\r\n              var dbt = common_func.name2domainboardthread(tgt,true);\r\n              if (dbt[2].search(/[cjpq][1-9]/)===0) {\r\n                threads_index.insert_odl(tgt);\r\n                sb.obj.splice(i--,1);\r\n              }\r\n            }\r\n            if (sb.obj.length===0) {\r\n              if (sb.indicator) sb.indicator.remove();\r\n              if (sb.callback) {\r\n                var func = sb.callback\r\n                var args = sb.callback_args;\r\n              }\r\n              delete scan_boards.args[sb.key];\r\n              return (func)? func(args) : undefined;\r\n            } else {\r\n              if (load_on_demand.get()) sb.callback = (sb.callback)? (function(func_old){return function(){load_on_demand.release();func_old();}})(sb.callback) : load_on_demand.release; // First access may not have mutex.\r\n              sb.max = sb.obj.length;\r\n              drawn_idx = 0;\r\n            }\r\n          }\r\n////////          if (sb.crawler_watchdog) sb.crawler_watchdog = new CrawlerWatchdog(sb);\r\n//          while (obj[sb.max-1].max===null) sb.max--;\r\n//if (pref.debug_mode['5']) {\r\n//  console.log('scan_boards: '+key+', '+scan_boards.args[key].obj.length);\r\n//  console.log(scan_boards.args[key].obj);\r\n//}\r\n          if (!sb.indicator) sb.indicator = health_indicator.shift('limegreen','r',sb.key,sb.priority);\r\n          sb.indicator.report({start:Date.now(), prog:sb}); // make reference loop.\r\n          while (sb.crawler<pref.scan.crawler) {\r\n////////            scan_boards_spawn_crawler(key, true);\r\n            crawler.spawn(key, true);\r\n            if (pref.scan.crawler_adaptive) break;\r\n          }\r\n        }\r\n        var crawler = {\r\n          key: null,\r\n          priority: 0,\r\n          num: 0, // dangerous, may hang up, all crawlers must be returned.\r\n          wdg_spawn: null,\r\n          spawn_req: function(sb){\r\n            this.clear_req(sb);\r\n            if (sb.priority>=this.priority) {\r\n              if (this.num<pref.scan.crawler || sb.priority>this.priority) {\r\n                this.wdg_spawn.start(pref.scan.crawler_idle_time_to_spawn);\r\n                this.key = sb.key;\r\n                this.priority = sb.priority;\r\n              }\r\n            }\r\n          },\r\n          spawn: function(key, init){\r\n            var sb = scan_boards.args[(key || this.key)]; // not to keep greping 'sb' object, 'key' and 'priority' are primitives.\r\n            if (sb && sb.idx<sb.max) {\r\n              var sender = (sb.senders_returned.length>0)? sb.senders_returned.shift() : sb.key+':'+sb.crawler;\r\n              sb.crawler++;\r\n              this.num++;\r\n              this.watchdog.add(sb, sender);\r\n              if (pref.debug_mode['5']) console.log('crawler_spawn: '+sender+'/'+sb.crawler);\r\n              scan_boards_keyword([sender,sb],200);\r\n              if (!init && !pref.scan.crawler_adaptive) this.spawn_req(sb);\r\n            }\r\n          },\r\n          clear_req: function(sb){\r\n            if (sb.priority>=this.priority) this.wdg_spawn.stop();\r\n          },\r\n          check_priority: function(sb, sender){\r\n            if (sb.priority>=this.priority || sb.crawler==1) return true;\r\n            else {\r\n              this.finish(sb, sender);\r\n//              sb.senders_returned.push(sender);  // THIS CAUSED A BUG,\r\n                                                   // crawler with status 1200(now changed to -200) call 'finish' immediately,\r\n                                                   // but this is respawned and causes multiple call of 'watchdog.add'.\r\n                                                   // For easy debug, this was moved to 'finish'.\r\n              return false;\r\n            }\r\n          },\r\n          finish: function(sb, sender){\r\n            this.clear_req(sb);\r\n            http_req.close(sender);\r\n            this.watchdog.end(sender);\r\n            sb.senders_returned.push(sender); // shold be here, but slightly redundant for end.\r\n            sb.crawler--;\r\n            this.num--;\r\n            if (pref.debug_mode['5']) console.log('crawler_finish: '+sender+'/'+sb.crawler);\r\n          },\r\n          finish_all: function(sb){\r\n            this.priority = 0;\r\n            if (Object.keys(scan_boards.args).length==0) this.reset(); // for safety.\r\n            else for (var key in scan_boards.args) if (scan_boards.args[key].senders_returned.length>0) this.spawn(key);\r\n          },\r\n          reset: function(){\r\n            this.num = 0;\r\n            this.watchdog.reset();\r\n          },\r\n          watchdog: {\r\n            list: [],\r\n            sbs: Object.create(null),\r\n            add: function(sb,sender){\r\n              this.list.push(sender);\r\n              this.sbs[sender] = sb;\r\n              if (this.list.length===1) this.wdg.start();\r\n            },\r\n            end: function(sender){\r\n              this.report_alive(sender);\r\n              delete this.sbs[sender];\r\n              this.list.splice(this.list.indexOf(sender),1);\r\n              if (this.list.length===0) this.wdg.stop();\r\n//              else this.wdg.restart(); // this is redundant because report_alive exists before\r\n            },\r\n            wdg: null,\r\n            report_alive: function(sender){\r\n              if (sender===this.list[0]) {\r\n                this.list.push(this.list.shift());\r\n                this.wdg.restart();\r\n              }\r\n            },\r\n            respawn: function(){\r\n              var sender = this.list[0];\r\n              var sb = this.sbs[sender];\r\n              if (pref.debug_mode['7']) console.log('crawler_respawn: '+sender+'/'+((sb)?sb.crawler:'undefined'));\r\n              scan_boards_keyword([sender,sb],200);\r\n              this.report_alive(sender);\r\n            },\r\n            reset: function(){\r\n              this.list = [];\r\n              this.sbs = Object.create(null);\r\n              this.wdg.stop();\r\n            },\r\n            abort: function(key){\r\n              for (var i=this.list.length-1;i>=0;i--) if (this.list[i].indexOf(key+':')===0) this.end(this.list[i]);\r\n            },\r\n          },\r\n          priority_up: null,\r\n          priority_release: null,\r\n          priority_wdg: null,\r\n          priority_count: 0,\r\n        };\r\n        crawler.wdg_spawn = new Watchdog(crawler.spawn.bind(crawler), 100);\r\n        crawler.watchdog.wdg = new Watchdog(crawler.watchdog.respawn.bind(crawler.watchdog), 30000);\r\n        crawler.priority_up = function(p){\r\n                                this.priority = p;\r\n                                this.priority_count++;\r\n                                this.priority_wdg.start();\r\n                              }.bind(crawler);\r\n        crawler.priority_release = function(){\r\n                                     if (--this.priority_count<=0) {\r\n                                       this.priority=0;\r\n                                       this.priority_wdg.stop();\r\n                                     } else this.priority_wdg.restart();\r\n                                   }.bind(crawler);\r\n        crawler.priority_wdg = new Watchdog(crawler.priority_release, 10000);\r\n\r\n////////        function scan_boards_spawn_crawler_timer(sb){ // working code.\r\n////////          scan_boards_crawler_timer_clear();\r\n////////          if (sb.crawler<sb.crawler_max) scan_boards.crawler_timer = setTimeout(sb.spawn_crawler, pref.scan.crawler_idle_time_to_spawn);\r\n////////        }\r\n////////        function scan_boards_spawn_crawler(key, init){\r\n////////          var sb = scan_boards.args[key];\r\n////////          if (pref.debug_mode['5']) console.log('crawler_spawn: '+sb.key+', '+(sb.crawler+1));\r\n////////          scan_boards_keyword([sb.key+sb.crawler++,sb],200);\r\n////////          if (!init && sb.idx<sb.max) scan_boards_spawn_crawler_timer(sb);\r\n////////        }\r\n////////        function scan_boards_crawler_timer_clear(){\r\n////////          if (scan_boards.crawler_timer!==null) {\r\n////////            clearTimeout(scan_boards.crawler_timer);\r\n////////            scan_boards.crawler_timer=null;\r\n////////          }\r\n////////        }\r\n////////        var CrawlerWatchdog = function(sb){ // patch for 8chan's unstability.\r\n////////          this.sb = sb;\r\n////////          this.tgt = 0;\r\n////////          this.db = new DelayBuffer(this.respawn.bind(this), 30000);\r\n////////          this.db.delayed_do();\r\n////////        }\r\n////////        CrawlerWatchdog.prototype = {\r\n////////          report_alive: function(kwd){\r\n////////            if (!this.sb) return; // stopped already\r\n////////            var me = kwd.substr(this.sb.key.length);\r\n////////            if (this.tgt==me) {\r\n////////              this.tgt = (this.tgt<this.sb.crawler-1)? this.tgt+1 : 0;\r\n////////              this.db.cancel();\r\n////////              this.db.delayed_do();\r\n////////            }\r\n////////          },\r\n////////          respawn: function(){\r\n////////            if (this.sb.idx<this.sb.max) {\r\n////////              if (pref.debug_mode['7']) console.log('crawler_respawn: '+this.sb.key+this.tgt+'/'+this.sb.crawler);\r\n////////              scan_boards_keyword([this.sb.key+this.tgt,this.sb],200);\r\n////////              this.report_alive(this.sb.key+this.tgt);\r\n////////            } else {\r\n////////              if (pref.debug_mode['7']) console.log('crawler_respawn: '+this.sb.key+this.tgt+'/'+this.sb.crawler+', stopped.');\r\n////////              this.stop();\r\n////////            }\r\n////////          },\r\n////////          stop: function(){\r\n////////            this.db.cancel();\r\n////////            this.sb = null; // release pointer\r\n////////          }\r\n////////        }\r\n        function scan_boards_keyword_make_tgt(sb,idx){\r\n          var tgt = (sb.tgts_iterator)? sb.tgts_iterator.next().value : sb.obj[idx];\r\n          if (tgt && typeof(tgt)!=='string') {\r\n            var force_json = tgt.u&0x0080;\r\n            tgt = tgt.key;\r\n          }\r\n          var dbt;\r\n          if (tgt) dbt = cnst.name2domainboardthread(tgt,true);\r\n          return (!tgt)? tgt:\r\n                 (sb.tgt_raw)? tgt :\r\n                 (dbt[2]==='')? tgt + ((pref.catalog.catalog_json | force_json)? 'j0' : 'c0') :\r\n                 (pref.catalog.catalog_json && dbt[2][0].search(/[0-9]/)!=-1)? dbt[0]+dbt[1]+'t'+dbt[2] : tgt;\r\n        }\r\n        function scan_boards_keyword(args,status){\r\n          var sender = args[0];\r\n          var sb = args[1];\r\n          crawler.watchdog.report_alive(sender);\r\n          if (sb.watchdog) sb.watchdog();\r\n          if (pref.scan.crawler_adaptive) if (!crawler.check_priority(sb,sender)) return;\r\n////////          if (sb.crawler_watchdog) sb.crawler_watchdog.report_alive(sender);\r\n//if (pref.debug_mode['5']) console.log('request_entry: '+sb.idx+'/'+sb.max+', '+sb.found_threads+'/'+sb.max_threads+', '+status);\r\nif (pref.debug_mode['5'] && sb.idx!=0 && sb.idx%1000==0) console.log('request_progress: '+sb.key+', '+sb.idx+'/'+sb.max+', '+sb.found_threads+'/'+sb.max_threads+', '+status);\r\n          if (sb.idx<sb.max && (sb.refresh || sb.found_threads<sb.max_threads) && status<500) {\r\n            var tgt = scan_boards_keyword_make_tgt(sb,sb.idx);\r\n            sb.idx++;\r\n////////            scan_progress(sb.found_threads+'/'+sb.scanned+', '+sb.found_boards+'/'+sb.idx+'/'+sb.max+', ' + tgt);\r\n            if (tgt && (!pref.catalog.board.ex_list || !pref_func.merge_obj5(tgt,pref.catalog.board.ex_list_obj2,{hit:false}).hit)) { // 'if (tgt)' is for tgts_iterator\r\n              if (sb.indicator) sb.indicator.report({tgt:tgt});\r\n              http_req.get(sender,tgt,'',scan_boards_keyword_callback2,sb.lifetime,sb.cache_write,args, scan.list_nup.issued(tgt));\r\n////////              if (sb.idx<sb.max && pref.scan.crawler_adaptive) scan_boards_spawn_crawler_timer(sb);\r\n              if (pref.scan.crawler_adaptive) crawler.spawn_req(sb);\r\n            } else scan_boards_keyword(args,200);\r\n          } else {\r\n            crawler.finish(sb, sender);\r\n////////            http_req.close(sender);\r\n            if (sb.crawler===0) {\r\n////////              if (pref.scan.crawler_adaptive) scan_boards_crawler_timer_clear();\r\n////////              if (sb.crawler_watchdog) sb.crawler_watchdog.stop();\r\n////////              var prog_str = sb.found_threads+'/'+sb.scanned+', '+sb.found_boards+'/'+sb.max\r\n////////                            + '<span style=\"color:red\">'\r\n////////                            +( (sb.error!=='')? ', Error at loading '+sb.error :\r\n////////                              ((!sb.refresh && sb.found_threads>=sb.max_threads)? ', Aborted.(Reached upper limit)' : ''))\r\n////////                            + '</span>';\r\n////////              scan_progress(prog_str);\r\n//              sb.max = sb.idx;\r\n//              if (sb.key==='scan') scan_button.innerHTML = 'scanSite';\r\nif (pref.test_mode['22']) {\r\n              if (sb.store_tag) {\r\n  //console.log(new Date());\r\n  //              scan_tags_init(sb.pool.tags);\r\n                var ret_obj = scan_tags_common_b(sb.pool.tags,'',site3[site.nickname].tags);\r\n                site3[site.nickname].tags = ret_obj[1];\r\n                scan_tags_init(ret_obj[0],true);\r\n  //              sb.pool.div.innerHTML = '';\r\n  //console.log(new Date());\r\n              }\r\n}\r\n//              sb = null;\r\n              if (sb.indicator) {\r\n////////                var keys = Object.keys(sb.error_obj);\r\n////////                if (keys.length==0) sb.indicator.set(null,'\\u25cf');\r\n////////                else if (keys.length>=sb.max) sb.indicator.set('red','X');\r\n////////                else sb.indicator.set(null,'\\u25b2');\r\n                if (sb.found_threads>=sb.max_threads) sb.indicator.report({err_str:'Aborted.(Reached upper limit)'});\r\n                sb.indicator.report({end:Date.now()});\r\n              }\r\n              delete scan_boards.args[sb.key];\r\nif (pref.debug_mode['5']) console.log('scan_boards_end: '+sb.key+', Running:'+Object.keys(scan_boards.args));\r\n              crawler.finish_all(sb);\r\n              if (Object.keys(scan_boards.args).length==0) scan_boards.pool = null;\r\n              if (sb.callback) sb.callback(sb.callback_args);\r\n            }\r\n          }\r\n        }\r\n\r\n        var threads_meguca = {};\r\n        function scan_boards_keyword_callback2(key,value,args){ // requires snoop and on demand rendering for merge.\r\n////////  if (pref.scan.crawler_adaptive) scan_boards_crawler_timer_clear();\r\n          var sb = args[1];\r\n          var dbt = key.split(',');\r\n          if (pref.scan.crawler_adaptive) crawler.clear_req(sb);\r\n          if ((value.status==200 || value.status==304) && value.response && sb.found_threads<sb.max_threads) { // Checking 'value.response' is a patch for 8chan's inconsistency, 8chan sometimes return 200 with null. // checking 304 is a patch.\r\nif (dbt[0]==='meguca1' && dbt[3]==='catalog_json') { // PATCH FOR MEGUCA\r\n            for (var i=0;i<value.response.length;i++) {\r\n//              threads_meguca[dbt[1]+value.response[i]] = {page:parseInt(i/10) +'.'+ i%10, refresh:sb.refresh};\r\n              liveTag.mems.init({domain:dbt[0], board:dbt[1], no:value.response[i]});\r\n              threads_meguca[dbt[1]+value.response[i]] = {page:parseInt(i/10) +'.'+ i%10, refresh:sb.refresh || threads_meguca[dbt[1]+value.response[i]] && threads_meguca[dbt[1]+value.response[i]].refresh}; // patch.\r\n              scan.list_nup.add(dbt[0]+dbt[1]+value.response[i], sb.priority);\r\n//              if (pref.liveTag.use) scan.list_nup.add_board(dbt[0]+dbt[1], value.date);\r\n            }\r\n            scan.list_nup.got_200_board(dbt[0]+dbt[1]);\r\n} else {\r\n            var tgts = {};\r\n            var parse_options = (dbt[3]==='thread_html' || dbt[3]==='thread_json')? {thread:dbt[2]} : {page:dbt[2]};\r\n            if (sb.localArchive) parse_options.localArchive = sb.localArchive;\r\n            var ths = site2[dbt[0]].wrap_to_parse.get(value.response, dbt[0], dbt[1], dbt[3], parse_options);\r\n            if (sb.localArchive) {\r\n              for (var i=0;i<ths.length;i++) ths[i].key = ths[i].key.substr(0,ths[i].key.lastIndexOf('/')+1) + ths[i].posts[0].no;\r\n              if (ths.length===1) dbt[2] = ths[0].posts[0].no;\r\n            }\r\n            sb.scanned += ths.length;\r\nif (pref.test_mode['22']) {\r\n            var tgt_pn = sb.pool.div;\r\n            var from_catalog = dbt[3]==='catalog_json' || dbt[3]==='catalog_html';\r\n            var filter_active = pref.catalog.filter.kwd.active || (pref.catalog.filter.tag && filter_tags.length!=0);\r\n} else {\r\n//            var filter_active = pref.catalog.filter.kwd.active || (pref.catalog.filter.tag && pref.liveTag.use && liveTag.active.in);\r\n//            var filter_active = pref.catalog.filter.kwd.active || (pref.catalog.filter.tag && liveTag.active.in); // for passive but don't use.\r\n            var filter_active_kwd = pref.catalog.filter.kwd.active;\r\n            var filter_active_tag = pref.catalog.filter.tag && liveTag.active.in; // for passive\r\n}\r\n////            var from_json = dbt[3].indexOf('_json')!=-1;\r\n            var refresh = sb.refresh;\r\n            if (dbt[0]==='meguca1' && dbt[3]==='thread_json') { // PATCH FOR MEGUCA\r\n              var tgt_th_meguca = threads_meguca[dbt[1]+dbt[2]];\r\n              if (tgt_th_meguca!== undefined) {\r\n                refresh = tgt_th_meguca.refresh;\r\n                ths[0].page = tgt_th_meguca.page;\r\n                delete threads_meguca[dbt[1]+dbt[2]];\r\n              }\r\n            }\r\n            var post_updated_static = pref.liveTag.from==='post' || pref.stats.use || pref[embed_mode].deleted_posts.detect==='full' ||\r\n              site2[dbt[0]].parse_funcs[dbt[3]].has_editing && (embed_mode==='page' || embed_mode==='thread');\r\n//            var post_updated_static = pref.liveTag.from==='post' || pref.stats.use || pref[embed_mode].deleted_posts.detect==='full';\r\n            for (var i=0;i<ths.length;i++) {\r\n              var th = ths[i];\r\n              if (!th.no) continue; // PATCH for a bug in 4chan, 4chan returns invalid data.\r\n              th.time_loaded = value.date;\r\n              if (sb.native_prep) th.native_prep = true;\r\nif (pref.test_mode['33'] && dbt[0]==='meguca1' && dbt[3]==='thread_json') {scan.list_nup.got_200(th);continue;}\r\nif (pref.test_mode['22']) {\r\n              if (sb.scan_tag && from_catalog) {\r\n                if (th.type_data==='json') tgt_pn.innerHTML = th.name + '\\n' + th.sub + '\\n' + th.com;\r\n                else tgt_pn = th.pn;\r\n                th.tags = tgt_pn[brwsr.innerText].match(tags_scan_regex);\r\n              }\r\n} else {\r\n//var tmp_len = Object.keys(scan.list_nup).length;\r\n//if (tmp_len!=0 && tmp_len%100===0) console.log('len: '+tmp_len);\r\n////////              if (pref.liveTag.use) {\r\n//              var mems_exist = liveTag.mems.exist(th);\r\n              var lth = liveTag.prep_tags(th); // extract tags in op. // editing tags are updated in this.\r\n              th.tags = lth;\r\n              var watch = lth[2];\r\n              var tgt_th = threads[th.key];\r\n              var tag_updated = (tgt_th)? undefined : th.tags; // force new thread to add tags\r\n              var post_updated = (post_updated_static || (watch[0]&0x002c0000))? false : null; // archiving or watching\r\n//              var post_updated = (post_updated_static || (watch[0]&0x000c0000))? false : null;\r\n\r\n              if (th.parse_funcs.has_editing && th.parse_funcs.has_posts) {\r\n                if (lth.ed_t) tag_updated = liveTag.update_tags_in_editing_posts(th, lth) || tag_updated;\r\n                if (lth.ed_p) for (var j=0;j<lth.ed_p.length;j++) {\r\n                  var post = (th.posts_obj)? th.posts_obj[lth.ed_p[j]] : th.parse_funcs.posts_obj(th,lth.ed_p[j]); // posts_obj must be accessed in order\r\n                  if (post && !post.editing) {\r\n                    //// CODE FOR UPDATING ARCHIVES SHOULD BE HERE.\r\n                    //// CODE FOR UPDATING POSTS CAN BE HERE.\r\n                    if (lth.ed_p.length!==1) lth.ed_p.splice(j--,1);\r\n                    else {lth.ed_p = null; break;}\r\n                  }\r\n                }\r\n////                if (lth.ed_p) for (var j=lth.ed_p.length-1;j>=0;j--) // working code -2016.10.06\r\n////                  if (th.posts_obj[lth.ed_p[j]] && !th.posts_obj[lth.ed_p[j]].editing) {\r\n////                    //// CODE FOR UPDATING ARCHIVES SHOULD BE HERE.\r\n////                    //// CODE FOR UPDATING POSTS CAN BE HERE.\r\n////                    if (lth.ed_p.length!==1) lth.ed_p.splice(j,1);\r\n////                    else lth.ed_p = null;\r\n////                  }\r\n              }\r\n//              if (liveTag.mems[dbt[0]][dbt[1]] && liveTag.mems[dbt[0]][dbt[1]].f) scan.list_nup.add(th.key, sb.priority); // use dbt[0] instead of th.domain for /popular/\r\n              if (lth.q && lth.q.waiting && th.parse_funcs.has_posts) site2[th.domain].popups_fetched(th, lth);\r\n\r\n              if (post_updated!==null && (lth.nof_posts<th.nof_posts || (watch[0]&0x00060000))) { // watch req || retag req\r\n//              if (post_updated!==null && (lth.nof_posts<th.nof_posts || watch[3]<0)) { // watch[3]<0 is a patch for retag.\r\n//if (th.parse_funcs.has_posts && th.last_replies) console.log(th.key+', '+th.last_replies.length+', '+th.nof_posts+', '+lth.nof_posts);\r\n//                if (pref.debug_mode.unread_count===th.key) console.log('uc: watch[0]='+lth.nof_posts+', nof_posts='+th.nof_posts);\r\n                if (th.type_source==='thread' || \r\n//                    (th.parse_funcs.has_posts && th.last_replies && th.last_replies.length>=th.nof_posts-lth.nof_posts) ||\r\n                    (th.parse_funcs.has_posts && th.posts.length>th.nof_posts-lth.nof_posts) ||\r\n                    (th.nof_posts===1 && th.posts[0].time>=0 && !th.parse_funcs.dont_have_com)) {\r\n                  post_updated = true;\r\n                  var updated = site2[th.domain].check_reply.check(th, watch, tgt_th, sb.ext_posts || []); // dive in at the first time if page_html contains all posts. sb.ext_posts for embed_mode==='thread'.\r\n                  tag_updated = updated.tags || tag_updated;\r\n                  scan.list_nup.got_200(th); // patch for 8chan. 8chan has an inconsistensy between catalog and threads,\r\n                                             // some threads which are there in catalog sometimes returns 404 if it gets as a thread.\r\n                                             // However, 8chan doesn't return 404, but fails at send(null), so system like watchdog is required.\r\n//                  if (pref.debug_mode['3']) console.log('Check tags: '+th.key+', '+lth.nof_posts);\r\n                  if (lth.archived || pref[embed_mode].deleted_posts.detect!=='no') if (pref.test_mode['67'] && !sb.localArchive) archiver.store(value, th, lth, updated.posts, updated.time_check_old);\r\n                } else { // if (!(th.parse_funcs.has_posts && !th.last_replies))\r\n                  scan.list_nup.add(th.key, sb.priority);\r\n//                  if (pref.debug_mode['3']) console.log('Schedule to check tags: '+th.key+', '+lth.nof_posts);\r\n                }\r\n              } else {\r\n                scan.list_nup.got_200(th);\r\n//                  if (lth.nof_posts==th.nof_posts || !pref.network.fetch_actively || // only active when count is changed,\r\n//                      // 'th.parse_funcs.missing_info' doesn't have state if the thread is not stored(tgt_th===undefined),\r\n//                      //and all members will be fetched forever.\r\n//                    ((tgt_th)? !tgt_th[23] || th.type_source==='thread' : !th.parse_funcs.missing_info)) scan.list_nup.got_200(th); // for threads which doesn't have posts.\r\n//                  else th.parse_funcs.missing_info_fetch(th);\r\n////                if (th.parse_funcs.has_editing) updated = {posts:th.posts.slice(lth.nof_posts || 0)}; // BUG, REDUNDANT.\r\n                if (lth.rescan_dp || lth.force_ar ||\r\n                    (lth.nof_posts<th.nof_posts && th.parse_funcs.has_posts && (lth.archived || pref[embed_mode].deleted_posts.detect!=='no'))) if (pref.test_mode['67'] && !sb.localArchive) archiver.store(value, th, lth); // for initial if watched already // BUG!!! THIS DOESN'T WORK IF 304 IS RETURNED.\r\n////                if (lth.nof_posts!=th.nof_posts)\r\n////                  if(!th.parse_funcs.has_editing || th.parse_funcs.has_posts || embed_mode==='catalog') lth.nof_posts = th.nof_posts; // to get updated in next loop. // BUG, REDUNDANT.\r\n                if (lth.nof_posts!=th.nof_posts) lth.nof_posts = th.nof_posts;\r\n              }\r\n////////              }\r\n              if (th.parse_funcs.has_editing) {\r\n                if (updated) for (var j=0;j<updated.posts.length;j++)\r\n                  if (updated.posts[j].editing)\r\n                    if (lth.ed_p) lth.ed_p[lth.ed_p.length] = updated.posts[j].no;\r\n                    else lth.ed_p = [updated.posts[j].no];\r\n                if (th.type_source==='catalog' && embed_mode!=='catalog' && tgt_th &&\r\n                  (tgt_th[16].needs_update<th.lastUpdated || tgt_th[16].needs_update===null)) scan.list_nup.add(th.key, sb.priority);\r\n//                if (th.type_source==='catalog' && embed_mode!=='catalog' && tgt_th && lth.ed_p) scan.list_nup.add(th.key, sb.priority);\r\n              }\r\n//              if (th.domain==='meguca' && th.type_source==='catalog' && embed_mode!=='catalog' && tgt_th && tgt_th[16].needs_update<th.logCtr) scan.list_nup.add(th.key, sb.priority);\r\n}\r\nif (pref.test_mode['32'] && dbt[0]==='meguca1' && dbt[3]==='thread_json') continue;\r\n              if (lth.th) {\r\n                if (!tgt_th) delete lth.th;\r\n                else if (lth.th.parse_funcs.missing_info && (!th.parse_funcs.missing_info || th.parse_funcs.missing_info<lth.th.parse_funcs.missing_info)) {\r\n                  if (lth.th.pn) th.pn = lth.th.pn;\r\n                  lth.th = th;\r\n                  // lth.th.posts SHOULD BE REDUCED HERE.\r\n                }\r\n              }\r\n////              if (tgt_th) { // working code.\r\n////                if (tgt_th[23]) {\r\n////                  for (var p in tgt_th[23]) {\r\n////                    if (p==='time_posted') {\r\n////                      if (th.time_posted) {tgt_th[8][4] = th.time_posted; delete tgt_th[23][p];}\r\n////                    } else if (p==='op_img_src_url') {\r\n////                      if (th.parse_funcs.get_op_src) {tgt_th[16].op_img_src_url = th.parse_funcs.get_op_src(th); delete tgt_th[23][p];}\r\n////                    }\r\n////                  }\r\n////                  if (Object.keys(tgt_th[23]).length===0) {\r\n////                    tgt_th[23] = null;\r\n//////                    if (missing_info[th.key]!==undefined) delete missing_info[th.key]\r\n////                  }\r\n////                }\r\n////              }\r\n              \r\n              var pick_up_for_search = th.type_source==='thread' && pref[embed_mode].t2h_sel==='ALL_agg';\r\n              var picked_up_by_kwd_filter = filter_active_kwd && catalog_filter_query_keyword.kwd(pref.catalog.filter.kwd, th.posts, th.domain, th);\r\n              var picked_up_by_tag_filter = filter_active_tag && liveTag.search_by_tags(th.tags);\r\n              var picked_up_by_filter = picked_up_by_kwd_filter || picked_up_by_tag_filter;\r\n              var tgt_th_status = (tgt_th===undefined)? undefined : tgt_th[9][0];\r\n//              var force_update = (tgt_th && (tgt_th[16].expand_posts || (th.type_source==='thread' && (tgt_th[16].needs_update===true || tgt_th[16].needs_update===1)))) || pick_up_for_search;\r\n              var force_update = (tgt_th && (tgt_th[16].expand_posts || (th.type_source==='thread' &&\r\n                (tgt_th[16].needs_update===true || (tgt_th[16].needs_update<th.lastUpdated || tgt_th[16].needs_update===null))))) || pick_up_for_search;\r\n              if (refresh || (post_updated && tgt_th) || picked_up_by_filter || force_update) {\r\n//              if (!sb.tag_only && (sb.refresh || (post_updated && tgt_th) || picked_up_by_filter)) {\r\n//              if (!sb.tag_only && (sb.refresh || (filter_active && catalog_filter_query_scan(th.posts, th.tags)))) {\r\n////////                if (insert_thread_with_test(th, dbt[3], value.date)) {// RUNS A REDUNDANT POST CHECK AT FIRST TIME....\r\n                if (post_updated===null && tgt_th) {\r\n                  var tgt_th8 = tgt_th[8];\r\n                  post_updated = !((((tgt_th8[0]>tgt_th8[4])? tgt_th8[0] : (tgt_th8[4] || tgt_th8[0])) >= ((th.time_bumped > th.time_posted)? th.time_bumped : (th.time_posted || th.time_bumped))) && // vichan has inconsistency in time between catalog.json and thread.json.\r\n                                   tgt_th8[2]==th.nof_posts && tgt_th8[3]==th.nof_files) || th.type_source==='thread'; // pass thread to revise all of tgt_th[8]\r\n                }\r\n                if (post_updated || picked_up_by_filter || tgt_th_status===undefined || force_update) {\r\n                  if (pref[embed_mode].scroll_lock) show_catalog_scroll_lock.set();\r\n                  insert_thread(th, value.date, picked_up_by_kwd_filter);\r\n                  tgts[th.key] = true;\r\n                  tgt_th = threads[th.key];\r\n                } // else if (pref[embed_mode].load_on_demand) reorder_thread_idx(th.key); // place thread before ODL. // changed. // implementation is changed.\r\n                sb.found_threads++;\r\n                if (sb.from_auto && (!tgt_th_status && tgt_th[9][0])) notifier.appeared(th,tgt_th_status===undefined);\r\n              } // else if (pref[embed_mode].load_on_demand && tgt_th) reorder_thread_idx(th.key); // temporal, should be rewritten.  // place thread before ODL. // implementation is changed.\r\n//              if (tgt_th_status!==undefined && tgt_th[16].expand_posts) insert_thread_format_html(th,th.key,false,false,th.type_data==='json'); // format_html.update_posts_in_page(th, th.key, true);\r\nif (!pref.test_mode['31'])\r\n              if (tgt_th) insert_footer3(th.key,(post_updated)? th.flags:null, th.page, (tgt_th_status!==undefined)? tag_updated : th.tags, th);\r\n//              if (pref.liveTag.use && i===0) scan.list_nup.add_board(th.domain+th.board, (th.type_source==='catalog')? value.date : null);\r\n//              if (th.tags.q && th.parse_funcs.has_posts) site2[th.domain].popups_fetched(th); // stored AFTER modifying pn. // BUT, posts are deleted sometimes.\r\n            }\r\nif (pref.test_mode['22']) {\r\n            if (sb.scan_tag && from_catalog) tag_scan_board(ths, sb);\r\n}\r\n            if (dbt[3]==='catalog_json' || dbt[3]==='catalog_html') {\r\n////              if (pref.liveTag.use) scan.list_nup.add_board(dbt[0]+dbt[1], value.date);\r\n              scan.list_nup.got_200_board(dbt[0]+dbt[1]);\r\n              rm_items_404_check(dbt[0],dbt[1],ths);\r\n////              if (liveTag.mems[dbt[0]][dbt[1]] && liveTag.mems[dbt[0]][dbt[1]].f) { // 'liveTag.mems[dbt[0]][dbt[1]]' is for /popular/\r\n////                for (var i=0;i<ths.length;i++) scan.list_nup.add(ths[i].key);\r\n////                liveTag.mems[dbt[0]][dbt[1]].f = false;\r\n////              }\r\n              if (liveTag.mems[dbt[0]][dbt[1]] && liveTag.mems[dbt[0]][dbt[1]].f) liveTag.mems[dbt[0]][dbt[1]].f = false; // 'liveTag.mems[dbt[0]][dbt[1]]' is for /popular/\r\n            }\r\n            if (pref.catalog_max_page_auto && (dbt[3]==='page_html' || (dbt[3]==='catalog_json' && site2[dbt[0]].parse_funcs[dbt[3]].get_max_page))) {\r\n              var max_page = site2[dbt[0]].parse_funcs[dbt[3]].get_max_page(value.response);\r\n              if (max_page) liveTag.mems[dbt[0]][dbt[1]].pgs = max_page;\r\n            }\r\n            if (pref[embed_mode].load_on_demand) {\r\n              var tgt = ths[ths.length-1];\r\n              if (tgt && tgt.type_source==='page' && (!site2[tgt.domain].all_boards || site2[tgt.domain].all_boards.indexOf(site.board)!=-1)) threads_index.raise_odl(tgt);\r\n            }\r\n            if (sb.native_prep) return ths;\r\n            if (Object.keys(tgts).length!=0) {\r\n              sb.found_boards++;\r\n              show_catalog(tgts);\r\n  //          if (pref.catalog.filter.tag_scan_auto) scan_tags();\r\n            }\r\n            if (sb.localArchive) return ths;\r\n  \r\n////////            if ((dbt[3]==='thread_html' || dbt[3]==='thread_json') && threads[ths[0].key]) update_thread(dbt[0]+dbt[1]+dbt[2], ths[0], threads[ths[0].key][19]); // patch  // working code.\r\n//            if ((dbt[3]==='thread_html' || dbt[3]==='thread_json') && threads[ths[0].key] && threads[ths[0].key][23]) update_thread(dbt[0]+dbt[1]+dbt[2], ths[0], threads[ths[0].key][19]); // patch to delete threads[name][23]\r\n////            if (dbt[3]==='thread_html') {\r\n////              var name = dbt[0] + dbt[1] + dbt[2];\r\n////              if (threads[name]) { // patch for parallel entry.\r\n////                site2[dbt[0]].check_reply.do(value.response, dbt, threads[name][19], threads[name][8], dbt[3]); // SHOULD CONSOLIDATE TO CHECK_REPLY.CHECK().\r\n////\r\n//////                if (threads[name][20]!==sb.pool.sticky) { // working code.\r\n//////                  site2[dbt[0]].add_sticky_info(threads[name][0],threads[name][18],sb.pool.sticky);\r\n//////                  threads[name][20] = sb.pool.sticky;\r\n//////                }\r\n////                if (threads[name][23]) {\r\n////                  threads[name][23] = false;\r\n////                  threads[name][9] = catalog_filter_query(name);\r\n////                }\r\n//////                if (pref.catalog_footer_show_nof_rep) site2[dbt[0]].insert_footer2(threads[name][0],threads[name][18],threads[name][19],threads[name][8]);\r\n////                if (pref.catalog_footer_show_nof_rep) insert_footer3(threads[name][24],threads[name][19],threads[name][8],name);\r\n////                threads[name][21] = false;\r\n////                if (threads[name][19][0]>=0) notifier.changed(name,threads);\r\n////                threads[name][19][5] = false;\r\n////                threads[name][19][4] = null; // for GC.\r\n////                reorder_thread_idx(name);\r\n//////var debug = '';\r\n//////for (var d=0;d<10;d++) debug += threads_idx[d] + ', ';\r\n//////console.log('ddd :'+debug);\r\n//////              if (reorder_thread_idx(name)) {\r\n//////                tgts = {};\r\n//////                tgts[name] = true;\r\n//////                show_catalog(tgts);\r\n//////              }\r\n////              }\r\n////            }\r\n//            if (sb.native_prep) return ths;\r\n}\r\n          } else { // DON'T USE TH.XXX BECAUSE MEGUCA DOESN'T HAVE.\r\n            if (value.status==404 && (dbt[3]==='thread_json' || dbt[3]==='thread_html')) {\r\n              if (pref.liveTag.rm_404_immediately) liveTag.rm_404_1(dbt[0],dbt[1],dbt[2]);\r\n              scan.list_nup.got_404(dbt[0] + dbt[1] + dbt[2]);\r\n            }\r\n            if (sb.found_threads<sb.max_threads) {\r\n////////              sb.error += ((sb.error==='')? '' : ', ') + key;\r\n////////              sb.error_obj[key] = value.status;\r\n              if (value.status==404) comment_out_bookmark(key);\r\n              if (sb.indicator) {\r\n                sb.indicator.report({err_str:key+'('+value.status+')'});\r\n                sb.indicator.set('orange');\r\n              }\r\n            }\r\n            if (value.response===null && value.status==200) { // patch for 8chan's inconsistency.\r\n              if (pref.debug_mode['16']) console.log('ERROR!!! Inconsistency in server. Server returned null with status 200 for '+site2[dbt[0]].make_url4(dbt)[0]+' , '+key);\r\n              value.status=-200;\r\n            }\r\n          }\r\n          scan_boards_keyword(args,value.status);\r\n        }\r\n        cataLog.scan_boards_keyword_callback2 = scan_boards_keyword_callback2;\r\n  \r\n////        function tag_scan_extract_1(pn) { // working code.\r\n////          return pn[brwsr.innerText].match(tags_scan_regex);\r\n////        }\r\n        function tag_scan_board(ths, sb) { // patch\r\n          var ths_tag = {};\r\n          for (var i=0;i<ths.length;i++) ths_tag[ths[i].key] = ths[i];\r\n          scan_tags_common(ths_tag,'',sb.pool.tags);\r\n        }\r\n\r\n////        function tag_scan_extract_1(key,pn,sb) {\r\n////          pn.tags = pn[brwsr.innerText].match(tags_scan_regex);\r\n////          var ths = {};\r\n////          ths[key] = pn;\r\n////          scan_tags_common(ths,'',sb.pool.tags);\r\n////  //        scan_tags_common({key:pn},'',sb.pool.tags,true);\r\n////  //        return pn.tags;\r\n////        }\r\n\r\n////////        function scan_boards_keyword_callback2(key,value,args){\r\n////////          var sb = args[1];\r\n////////          if (pref.scan.crawler_adaptive) scan_boards_crawler_timer_clear();\r\n////////          sb.pool.dbt = cnst.name2domainboardthread(key,true);\r\n////////          if (value.status==200 && sb.found_threads<sb.max_threads) {\r\n////////            if (sb.pool.dbt[2]=='j0' || sb.pool.dbt[2]=='c0') {\r\n////////              if (sb.pool.dbt[2]=='j0') {\r\n////////                sb.pool.type = 'catalog_json';\r\n////////                sb.pool.doc = ('response' in value)? value.response : JSON.parse(value.responseText);\r\n////////                var obj = sb.pool.doc;\r\n//////////                var obj = ('response' in value)? value.response : JSON.parse(value.responseText);\r\n////////    //            if (sb.scan_tag) {\r\n////////    //              for (var i=0;i<obj.length;i++) {\r\n////////    //                for (var j=0;j<obj[i].threads.length;j++) {\r\n////////    //                  sb.pool.div.innerHTML = obj[i].threads[j].com;\r\n////////    //                  obj[i].threads[j].tags = tag_scan_extract_1(sb.pool.dbt[0]+sb.pool.dbt[1]+obj[i].threads[j].no,sb.pool.div,sb);\r\n////////    //                }\r\n////////    //            }}\r\n////////                for (var i=0;i<obj.length;i++) {\r\n////////                  if (obj[i].threads) {\r\n////////                    sb.scanned += obj[i].threads.length;\r\n////////                    for (var j=0;j<obj[i].threads.length;j++) {\r\n////////                      sb.name = sb.pool.dbt[0]+sb.pool.dbt[1]+obj[i].threads[j].no;\r\n//////////                      if (threads[sb.name] && threads[sb.name][20]!==obj[i].threads[j].sticky) { // working code.\r\n//////////                        site2[sb.pool.dbt[0]].add_sticky_info(threads[sb.name][0],threads[sb.name][18],obj[i].threads[j].sticky);\r\n//////////                        threads[sb.name][20] = obj[i].threads[j].sticky;\r\n////////////                        reorder_thread_idx(sb.pool.dbt[0] + sb.pool.dbt[1] +sb.pool.dbt[2].substr(1)); doesn't prepared threads[];\r\n//////////                      }\r\n////////                      if (sb.scan_tag) {\r\n////////                        sb.pool.div.innerHTML = obj[i].threads[j].com + '\\n' + obj[i].threads[j].sub + '\\n' + obj[i].threads[j].name;\r\n////////                        tag_scan_extract_1(sb.pool.dbt[0]+sb.pool.dbt[1]+obj[i].threads[j].no,sb.pool.div,sb);\r\n////////                      }\r\n//////////                      var search_obj = [obj[i].threads[j].com, obj[i].threads[j].sub, obj[i].threads[j].name,'','','','',''];\r\n//////////                      if (!catalog_filter_query_scan(search_obj,sb.pool.div.tags)) {obj[i].threads.splice(j,1);j--;}\r\n////////                      if (!catalog_filter_query_scan(obj[i].threads[j],sb.pool.div.tags)) {obj[i].threads.splice(j,1);j--;}\r\n////////                    }\r\n////////                  }\r\n////////                }\r\n////////    //            for (var i=0;i<obj.length;i++) sb.scanned += obj[i].threads.length; // NOT SO FAST.\r\n////////    //            var kwd = pref.catalog.filter.kwd.str;\r\n////////    //            if (pref.catalog.filter.kwd && kwd!=='') {\r\n////////    //              if (!pref.catalog.filter.kwd.re) kwd = kwd.replace(/\\*/g,'.*');\r\n////////    //              if (pref.catalog.filter.kwd.ci) kwd = new RegExp(kwd,'i');\r\n////////    //              for (var i=0;i<obj.length;i++) {\r\n////////    //                for (var j=obj[i].threads.length-1;j>=0;j--) {\r\n////////    //                  var str = obj[i].threads[j].name + '\\n' + obj[i].threads[j].sub + '\\n' + obj[i].threads[j].com;\r\n////////    //                  var result = (str.search(kwd)!=-1);\r\n////////    //                  if (pref.catalog.filter.kwd.match==='unmatch') result = !result;\r\n////////    //                  if (!result) obj[i].threads.splice(j,1);\r\n////////    //                }\r\n////////    //              }\r\n////////    //            }\r\n////////                if ((pref.catalog.filter.kwd.use && pref.catalog.filter.kwd.str!=='') || (pref.catalog.filter.tag && filter_tags.length!=0))\r\n////////                  sb.pool.ths = site2[sb.pool.dbt[0]].catalog_from_json3(obj,sb.pool.dbt[1]); // heavy, and cause loading in chrome.\r\n////////                else sb.pool.ths = [];\r\n////////              } else {\r\n////////                sb.pool.type = 'catalog_html';\r\n////////                sb.pool.doc = ('response' in value)? value.response : sb.pool.parser.parseFromString(value.responseText, 'text/html');\r\n////////                sb.pool.ths = site2[sb.pool.dbt[0]].catalog_from_native(value.date,sb.pool.doc,sb.pool.dbt[1],sb.pool.type);\r\n////////    //            if (sb.scan_tag) for (var i=0;i<sb.pool.ths.length;i++) sb.pool.ths[i].tags = tag_scan_extract_1(sb.pool.dbt[0]+sb.pool.dbt[1]+sb.pool.ths[i].no,sb.pool.ths[i].pn,sb);\r\n////////                sb.scanned += sb.pool.ths.length;\r\n////////                for (var i=0;i<sb.pool.ths.length;i++) {\r\n////////                  if (sb.scan_tag) tag_scan_extract_1(sb.pool.dbt[0]+sb.pool.dbt[1]+sb.pool.ths[i].no,sb.pool.ths[i].pn,sb);\r\n////////                  if (!catalog_filter_query_scan(sb.pool.ths[i],sb.pool.ths[i].pn.tags)) {sb.pool.ths.splice(i,1);i--;}\r\n////////                }\r\n////////              }         \r\n////////              if (sb.pool.ths.length!=0 && ((pref.catalog.filter.kwd.use && pref.catalog.filter.kwd.str!=='') || (pref.catalog.filter.tag && filter_tags.length!=0))) {\r\n////////                sb.found_boards++;\r\n////////                sb.found_threads += sb.pool.ths.length;\r\n////////                sb.pool.tgts = {};\r\n////////                for (var i=0;i<sb.pool.ths.length;i++) {\r\n////////                  insert_thread_with_test(sb.pool.ths[i], sb.pool.type, value.date); // patch\r\n//////////                  insert_thread_from_native(sb.pool.ths[i], sb.pool.dbt[0], sb.pool.dbt[1], false, value.date);\r\n////////                  sb.pool.tgts[sb.pool.dbt[0]+sb.pool.dbt[1]+sb.pool.ths[i].no] = true;\r\n////////                }\r\n////////                show_catalog(sb.pool.tgts);\r\n////////    //            if (pref.catalog.filter.tag_scan_auto) scan_tags();\r\n////////              }\r\n////////            } else {\r\n////////              var name = sb.pool.dbt[0] + sb.pool.dbt[1] + ((sb.pool.dbt[2][0]==='t')? sb.pool.dbt[2].substr(1) : sb.pool.dbt[2]);\r\n////////              if (threads[name]) { // patch for parallel entry.\r\n////////                sb.pool.type = (sb.pool.dbt[2][0]!=='t')? 'thread_html' : 'thread_json';\r\n////////                if (sb.pool.dbt[2][0]!=='t') sb.pool.doc = ('response' in value)? value.response : sb.pool.parser.parseFromString(value.responseText, 'text/html');\r\n//////////                site2[sb.pool.dbt[0]].check_reply_to_me(name,sb.pool.dbt,threads[name][19],(sb.pool.dbt[2][0]!=='t')? sb.pool.doc : value);\r\n//////////var time_0 = performance.now();\r\n//////////                site2[sb.pool.dbt[0]].check_reply_to_me(name,sb.pool.dbt,threads[name][19],(sb.pool.dbt[2][0]!=='t')? sb.pool.doc : value,threads[name][8], sb.pool, sb.pool.type); // also checks sage.\r\n//////////                site2[sb.pool.dbt[0]].check_reply_to_me(name,sb.pool.dbt,threads[name][19],(sb.pool.dbt[2][0]!=='t')? sb.pool.doc : value.response, threads[name][8], sb.pool, sb.pool.type); // also checks sage.\r\n////////                site2[sb.pool.dbt[0]].check_reply.do((sb.pool.dbt[2][0]!=='t')? sb.pool.doc : value.response, sb.pool.dbt, threads[name][19], threads[name][8], sb.pool.type);\r\n////////\r\n//////////                if (threads[name][19][0]>threads[name][8][4]) threads[name][19][0] = -1; // 2015.05.01 removed, but I don't remember why I wrote this.\r\n////////\r\n//////////console.log('check_reply :'+name+', '+(performance.now()-time_0));\r\n//////////                if (threads[name][20]!==sb.pool.sticky) { // working code.\r\n//////////                  site2[sb.pool.dbt[0]].add_sticky_info(threads[name][0],threads[name][18],sb.pool.sticky);\r\n//////////                  threads[name][20] = sb.pool.sticky;\r\n//////////                }\r\n////////                if (threads[name][23]) {\r\n////////                  threads[name][23] = false;\r\n////////                  threads[name][9] = catalog_filter_query(name);\r\n////////                }\r\n//////////                if (pref.catalog_footer_show_nof_rep) site2[sb.pool.dbt[0]].insert_footer2(threads[name][0],threads[name][18],threads[name][19],threads[name][8]);\r\n////////                if (pref.catalog_footer_show_nof_rep) insert_footer3(threads[name][24],threads[name][19],threads[name][8],name);\r\n////////                threads[name][21] = false;\r\n////////                if (threads[name][19][0]>=0) notifier.changed(name,threads);\r\n////////                threads[name][19][5] = false;\r\n////////                threads[name][19][4] = null; // for GC.\r\n////////                reorder_thread_idx(name);\r\n//////////var debug = '';\r\n//////////for (var d=0;d<10;d++) debug += threads_idx[d] + ', ';\r\n//////////console.log('ddd :'+debug);\r\n//////////              if (reorder_thread_idx(name)) {\r\n//////////                sb.pool.tgts = {};\r\n//////////                sb.pool.tgts[name] = true;\r\n//////////                show_catalog(sb.pool.tgts);\r\n//////////              }\r\n////////              }\r\n////////            }\r\n////////          } else {\r\n////////            if (value.status==404 && (sb.pool.dbt[2][0]=='t' || sb.pool.dbt[2].search(/^[0-9]/)!=-1)) {\r\n////////              var name = sb.pool.dbt[0] + sb.pool.dbt[1] + ((sb.pool.dbt[2][0]==='t')? sb.pool.dbt[2].substr(1) : sb.pool.dbt[2]);\r\n////////              remove_thread(name);\r\n////////            }\r\n////////            if (sb.found_threads<sb.max_threads) sb.error += ((sb.error==='')? '' : ', ') + key;\r\n////////          }\r\n////////          sb.pool.doc = null;\r\n////////          scan_boards_keyword(args,value.status);\r\n////////        }\r\n////////  \r\n////////        function tag_scan_extract_1(key,pn,sb) {\r\n////////  //        sb.pool.tags[key] = {};\r\n////////  //        var tags = pn[brwsr.innerText].match(tags_scan_regex);\r\n////////  //        sb.pool.tags[key].tags = tags;\r\n////////  ////        var tags = div[brwsr.innerText].match(tags_scan_regex);\r\n////////  ////        if (tags) {\r\n////////  ////          var tags_uniq = {};\r\n////////  ////          for (var k=0;k<tags.length;k++) tags_uniq[tags[k]] = 1;\r\n////////  ////          for (var k in tags_uniq) {\r\n////////  ////            if (sb.pool.tags[k]===undefined) sb.pool.tags[k] = [];\r\n////////  ////            sb.pool.tags[k].push(key);\r\n////////  ////          }\r\n////////  ////        }\r\n////////  //        return tags;\r\n////////          pn.tags = pn[brwsr.innerText].match(tags_scan_regex);\r\n////////          var ths = {};\r\n////////          ths[key] = pn;\r\n////////          scan_tags_common(ths,'',sb.pool.tags);\r\n////////  //        scan_tags_common({key:pn},'',sb.pool.tags,true);\r\n////////  //        return pn.tags;\r\n////////        }\r\n        cataLog.scan_init = scan_init;\r\n        return {\r\n          scan_init: scan_init,\r\n          scan_abort: function(key){scan_init(key, {}, {});},\r\n          scan_boards_keyword_callback2: scan_boards_keyword_callback2,\r\n//          update_thread: update_thread,\r\n          priority_up: crawler.priority_up,\r\n          priority_release: crawler.priority_release,\r\n        }\r\n      }());\r\n      cataLog.scan_boards = scan_boards;\r\n\r\n      function catalog_resized(myself) {\r\n        var tgt;\r\n        if ((pref.catalog.text_mode.mode==='graphic' && (myself.name==='catalog_size_text_width' || myself.name==='catalog_size_text_height')) ||\r\n            (pref.catalog.text_mode.mode==='text'    && (myself.name==='catalog_size_width'      || myself.name==='catalog_size_height'))) return;\r\n        else tgt = myself.name.substr(myself.name.lastIndexOf('_')+1);\r\n        var val = (pref[myself.name]==0)? '' : pref[myself.name] + 'px';\r\n        for (var i in threads) threads[i][0].style[tgt] = val;\r\n//        for (var i in threads) {\r\n//          threads[i][0].style.width  = (pref.catalog_size_width==0 )? '' : pref.catalog_size_width  + 'px';\r\n//          threads[i][0].style.height = (pref.catalog_size_height==0)? '' : pref.catalog_size_height + 'px';\r\n//        }\r\n      }\r\n      var auto_update = (function(){\r\n        var timer = null;\r\n        var time_remains = 0;\r\n        var timer_tgt = function(from_refresh_button){\r\n          timer=null;\r\n          catalog_refresh(true,null,!from_refresh_button);\r\n          auto_update.set();\r\n        }\r\n        function stop_if_running(){\r\n          if (timer) {clearTimeout(timer); timer=null;}\r\n          if (pref.catalog_auto_update_countdown) health_indicator.pn_countdown.textContent = '';\r\n        }\r\n        function countdown(){\r\n          health_indicator.pn_countdown.textContent = --time_remains;\r\n          if (time_remains<=0) timer_tgt();\r\n          else timer = setTimeout(countdown,1000);\r\n        }\r\n        return {\r\n          set : function(){\r\n            stop_if_running();\r\n            if (pref[embed_mode].auto_update) {\r\n              var period = pref[embed_mode].auto_update_period || 0.5;\r\n              if (!pref.catalog_auto_update_countdown) timer = setTimeout(timer_tgt,period*60000);\r\n              else {\r\n                time_remains = period*60;\r\n                countdown();\r\n              }\r\n            }\r\n          },\r\n          stop_if_running: stop_if_running,\r\n          timer_tgt : function(){\r\n            if (timer) {clearTimeout(timer); timer=null;}\r\n            timer_tgt(true);\r\n          }\r\n        }\r\n      })();\r\n      auto_update.set();\r\n//      var auto_update_timer = null; // working code.\r\n//      function set_auto_update(){\r\n//        if (auto_update_timer) {clearTimeout(auto_update_timer);auto_update_timer=null;}\r\n//        if (pref.catalog_auto_update) {\r\n//          var period = pref.catalog_auto_update_period;\r\n//          auto_update_timer=setTimeout(function(){auto_update_timer=null;catalog_refresh(true,null,true);},period*60000);\r\n//        }\r\n//      }\r\n//      set_auto_update();\r\n\r\n////      pn_filter.getElementsByTagName('*')['catalog.filter.tag_search.str'].onkeyup = function(){ // working code.\r\n////        pref_func.apply_prep(this,true);\r\n////        liveTag.filter_onchange();\r\n////      }\r\n////      if (!pref.catalog.filter.show) pn_filter.style.display = 'none';\r\n      pn_filter.style.display = 'none';\r\n////      pn_filter.getElementsByTagName('*')['catalog.filter.kwd.str'].onkeyup = function(){ // working code.\r\n////        pref_func.apply_prep(this,true,true);\r\n////        if ((!pref.catalog.filter.kwd.use && this.value!=='') || (pref.catalog.filter.kwd.use && this.value==='')) {\r\n////          pref.catalog.filter.kwd.use = !pref.catalog.filter.kwd.use;\r\n////          var use = pn_filter.getElementsByTagName('*')['catalog.filter.kwd.use'];\r\n////          pref_func.apply_prep(use,false,true);\r\n////        }\r\n////      }\r\n      var filter_time_str = pn_filter.getElementsByTagName('*')['catalog.filter.time_str'];\r\n//      pn_filter.getElementsByTagName('button')['now'].onclick = function(){set_time_str(Date.now());}\r\n//      var filter_time_ago_str = pn_filter.getElementsByTagName('*')['catalog.filter.time_ago_str'];\r\n//      filter_time_ago_str.onkeyup = ago_clicked;\r\n//      pn_filter.getElementsByTagName('button')['ago'].onclick= ago_clicked;\r\n      function ago_clicked(e, time_in){\r\n//        if (time_in===undefined) {\r\n//          var str = filter_time_ago_str.value;\r\n//          var time_in = (parseInt(str.replace(/:.*/,''),10)*60+parseInt(str.replace(/[^:]*:/,''),10))*60000;\r\n//        }\r\n        var time = Date.now() - time_in;\r\n        filter_time_str.value = new Date(time).toLocaleString();\r\n        pref_func.apply_prep(filter_time_str,true,true);\r\n      }\r\n//      function ago_clicked(){\r\n//        var str = filter_time_ago_str.value;\r\n//        var time = Date.now() - (parseInt(str.replace(/:.*/,''),10)*60+parseInt(str.replace(/[^:]*:/,''),10))*60000;\r\n//        set_time_str(time);\r\n//      }\r\n//      function set_time_str(time){\r\n//        filter_time_str.value = new Date(time).toLocaleString();\r\n//        pn_filter_changed();\r\n//      };\r\n//      pn_filter.getElementsByTagName('button')['copy'].onclick =\r\n//        function(){\r\n//          pn_filter.getElementsByTagName('textarea')['catalog.filter.time_mark_str'].value=filter_time_str.value;\r\n//          pn_filter_changed();\r\n//        }\r\n      var watch_list = pn_filter.getElementsByTagName('textarea')['catalog.filter.watch_list_str'];\r\n      var search_ex_list = pn_filter.getElementsByTagName('textarea')['catalog.filter.list_str'];\r\n//      search_ex_list.onkeyup = pn_filter_changed;\r\n      var attr_list = pn_filter.getElementsByTagName('textarea')['catalog.filter.attr_list_str'];\r\n//      attr_list.onkeyup = function(){if (pref.catalog.filter.attr_list) catalog_attr_changed();};\r\n//      pn_filter.onchange = pn_filter_changed;\r\n      function pn_filter_changed(){\r\n        pref_func.apply_prep(pn_filter,true);\r\n        catalog_filter_changed();\r\n      }\r\n\r\n////      function scan_tags(){ // working code.\r\n////        var ths = [];\r\n////        var j=0;\r\n////        for (var i in threads) {\r\n////          ths[j] = {};\r\n////          ths[j++].tags = threads[i][0][brwsr.innerText].match(tags_scan_regex); // ATTENTION. DESCRIPTION IS ALSO EXIST IN CATALOG_FILTER_QUERY().\r\n////        }\r\n////        var str2 = scan_tags_common(ths,'');\r\n////        scan_tags_init(str2,false);\r\n////      }\r\n      function scan_tags_init(str2, reload){\r\nif (pref.test_mode['22']) {\r\n        var pn_tag_list = pn_filter.getElementsByTagName('div')['catalog.filter.tag_list'];\r\n        if (reload!==null) pn_tag_list.onchange = function(){prep_tag_str(null, reload, true);};\r\n        pn_tag_list.innerHTML = str2;\r\n        if (pn_tag_list.style.height=='') pn_tag_list.style.height = '30px';\r\n        if (pn_tag_list.style.width=='') pn_tag_list.style.width = '100px';\r\n//        prep_tag_str(true,reload);\r\n        prep_tag_str(true,false);\r\n}\r\n      }\r\n      var filter_tags = [];\r\n      function prep_tag_str(keep,reload, from_onchange){\r\n        var pn_tag_list = pn_filter.getElementsByTagName('div')['catalog.filter.tag_list'];\r\n        var cbxes = pn_tag_list.getElementsByTagName('input');\r\n        if (keep===true) {\r\n          for (var i=0;i<filter_tags.length;i++) filter_tags[i] = filter_tags[i].toString().replace(/^\\//,'').replace(/\\(.*\\n*.*/,'');\r\n          var tags = [];\r\n          for (var i=0;i<cbxes.length;i++) tags[i] = cbxes[i].nextSibling.textContent.replace(/ [0-9]*: /,'');\r\n          for (var i=0;i<filter_tags.length;i++)\r\n            for (var j=0;j<cbxes.length;j++)\r\n              if (tags[j]==filter_tags[i]) cbxes[j].checked = true;\r\n        }\r\n        filter_tags = [];\r\n        var tgts = {};\r\n        var flag = false;\r\n        for (var i=0;i<cbxes.length;i++)\r\n          if (cbxes[i].checked) {\r\n            filter_tags.push(new RegExp(cbxes[i].nextSibling.textContent.replace(/ [0-9]*: /,'').replace(/$/,'(#|,| |\\\\.|:|;|\\n|$)'),(pref.catalog.filter.tag_ci)? 'i' : '')); // ATTENTION. REFER tag_scan_regex.\r\n            if (reload) {\r\n              var tags_tgt = (pref.catalog.filter.tag_ci)? site3[site.nickname].tags.ci[i].mem : site3[site.nickname].tags.cs[i].mem;\r\n              for (var j in tags_tgt) tgts[j] = null;\r\n            }\r\n            flag = true;\r\n          }\r\n        if (from_onchange && flag) {\r\n          pref.catalog.filter.tag = true;\r\n          pref_func.apply_prep(pn12_0_4.getElementsByTagName('input')['catalog.filter.tag'],false);\r\n        }\r\n        if (pref.catalog.filter.tag) catalog_filter_changed();\r\n//        pn_filter_changed();\r\n        if (reload) {\r\n//          for (var i in tgts) console.log(i);\r\n\r\n//          load_list.tag.tgts = []; // working code.\r\n//          for (var i in tgts) load_list.tag.tgts.push(i+'c0');\r\n////          load_list.tag.use_cache = !refresh;\r\n//          load_list.tag.idx = 0;\r\n//          load_list.tag.mutex = true;\r\n//          load_list.tag.from_auto = false;\r\n//          load_list.tag.tgts = trim_list(load_list.tag.tgts,false);\r\n//          if (pref.catalog_refresh_clear) catalog_clear_threads(pref.catalog.max_threads_at_refresh);\r\n//          if (load_list.tag.idx<load_list.tag.tgts.length) get_page(load_list.tag);\r\n          scan_boards.scan_init('refresh_tag',tgts, {lifetime:pref.scan.lifetime*60, cache_write:true});\r\n//          set_auto_update();\r\n          filter_tags_refresh_mem = tgts;\r\n        }\r\n      }\r\n//      function load_save_key(){\r\n//        return pref.script_prefix + '.catalog.adv_str.' + pref.catalog_board_list_obj[board_sel.selectedIndex][0].key;\r\n//      }\r\n//      pn_filter.getElementsByTagName('button')['load_adv_str'].onclick = function(){\r\n//        if (localStorage) {\r\n//          var tmp = JSON.parse(localStorage.getItem(load_save_key()));\r\n//          if (tmp) {\r\n//            search_ex_list.value = tmp[0];\r\n//            attr_list.value = tmp[1];\r\n//          }\r\n//        }\r\n//      };\r\n//      pn_filter.getElementsByTagName('button')['save_adv_str'].onclick = function(){if (localStorage) localStorage.setItem(load_save_key(),JSON.stringify([search_ex_list.value,attr_list.value]));};\r\n      \r\n//      pn_filter.childNodes[11].onclick= function(){\r\n//        var str = pn_filter.childNodes[10].value;\r\n//        var time = Date.now() - (parseInt(str.replace(/:.*/,''),10)*60+parseInt(str.replace(/[^:]*:/,''),10))*60000;\r\n//        pn_filter.childNodes[8].value = new Date(time).toLocaleString();\r\n//        pref_func.apply_prep(pn_filter,true);\r\n//        catalog_filter_changed();\r\n//      };\r\n//      if (pn12_0_2.childNodes[0].checked) cnst.show_hide(pn_filter);\r\n//      pn12_1.style.width  = '';\r\n//      pn12_1.style.height = '';\r\n\r\n      var scroll_event_src = (embed_embed)? ((site2[site.nickname].catalog_get_native_scroll_area)? site2[site.nickname].catalog_get_native_scroll_area() : window) :\r\n                                            triage_parent;\r\n//      var scroll_event_src = (embed_embed)? window : triage_parent;\r\n      var pn12_triage;\r\n      var triage_str;\r\n      function remake_triage(){\r\n        triage.off();\r\n        pref_func.tooltips.remove_hier(pn12_triage);\r\n        make_triage_entry();\r\n      }\r\n      function make_triage_entry(){\r\n        var pn12_triage_all = new common_func.Triage(pref.catalog_triage_str, {onclick:triage_event, wheelpatch:(!embed_embed)? triage_wheel : null, name:'pn_catalog_triage'});\r\n        pn12_triage = pn12_triage_all.pn;\r\n        triage_str = pn12_triage_all.str;\r\n        pn12_triage.style.position = 'absolute';\r\n        pref_func.tooltips.add_hier(pn12_triage);\r\n//        var pn12_triage_all = common_func.make_triage({onclick:triage_event, wheelpatch:(!embed_catalog)? triage_wheel : null});\r\n//        pn12_triage = pn12_triage_all.pn;\r\n//        triage_str = pn12_triage_all.str;\r\n//        pn12_triage.style.position = 'absolute';\r\n//        pn12_triage.name = 'pn_catalog_triage';\r\n//        if (pref.tooltip.show) pref_func.tooltips.add(pn12_triage);\r\n//        pn12_triage.addEventListener('mouseover', catalog_triage_out_clear, false);\r\n//        pn12_triage.addEventListener('mouseout' , catalog_triage_out_delay, false);\r\n        pn12_triage.onmouseover = triage.triage_in;\r\n        pn12_triage.onmouseout  = triage.triage_out;\r\n        if (!pref.triage.hide_toggle) pn12_triage_all.format_tgt = null;\r\n        triage.set_trg(pn12_triage_all);\r\n      }\r\n//      function make_triage(args){\r\n//        var triage_str = [];\r\n//        var pn_triage = document.createElement('div');\r\n////        pn_triage.style.position = 'absolute';\r\n////        pn_triage.name = 'pn_catalog_triage';\r\n//        pn_triage.className = 'catalog_triage_parent';\r\n//        var triage_str_lines = pref.catalog_triage_str.replace(/\\/\\/.*/mg,'').split('\\n');\r\n//        for (var i=triage_str_lines.length-1;i>=0;i--) if (triage_str_lines[i]==='') triage_str_lines.splice(i,1);\r\n//        var triage_style_replace_list = (!brwsr.ff)? ['background','background-color'] : [];\r\n//        for (var i=0;i<triage_str_lines.length;i++)\r\n//          triage_str[i] = triage_str_lines[i].split(',');\r\n//        for (var i=0;i<triage_str.length;i++) {\r\n//          for (var j=0;j<triage_str[i].length;j+=3) {\r\n//            var triage_button = document.createElement('button');\r\n//            triage_button.innerHTML = triage_str[i][j+1];\r\n//            triage_button.name = i+','+j;\r\n//            triage_button.className = 'catalog_triage_button';\r\n//            var triage_styles = (triage_str[i][j+2])? triage_str[i][j+2].split(';') : [];\r\n//            for (var k=0;k<triage_styles.length;k++) {\r\n//              var style_str = triage_styles[k].replace(/:.*/,'');\r\n//              for (var m=0;m<triage_style_replace_list.length;m+=2) style_str = style_str.replace(triage_style_replace_list[m],triage_style_replace_list[m+1]);\r\n//              triage_button.style[style_str] = triage_styles[k].replace(/[^:]*:/,'');\r\n//            }\r\n////            triage_button.onclick = triage_factory(i,j);\r\n//            triage_button.onclick = args.onclick;\r\n//            pn_triage.appendChild(triage_button);\r\n//            if (args.wheelpatch) triage_button.onmousewheel = triage_wheel;\r\n//          }\r\n//          pn_triage.appendChild(document.createElement('br'));\r\n//        }\r\n////        pn_triage.onclick = function(e){  // also works, but CSS is the better.\r\n////          e.preventDefault();\r\n////          var evt = document.createEvent('MouseEvents');\r\n////          evt.initUIEvent('click', false, true, window, 1);\r\n////          threads[pn12_triage_thread][0].dispatchEvent(evt);\r\n//////console.log('aaa');\r\n////        };\r\n//        return {pn:pn_triage, str:triage_str};\r\n//      }\r\n      function triage_wheel(e){ // patch\r\n        triage.off();\r\n        pref_func.tooltips.hide();\r\n        e.preventDefault();\r\n//        triage_parent.dispatchEvent(e); // copy is required.\r\n          var evt = document.createEvent('MouseEvents');\r\n        evt.initMouseEvent(e.type, e.canBubble, e.cancelable, e.view,\r\n                   e.detail, e.screenX, e.screenY, e.clientX, e.clientY,\r\n                   e.ctrlKey, e.altKey, e.shiftKey, e.metaKey,\r\n                   e.button, e.relatedTarget);\r\n        triage_parent.dispatchEvent(evt); // seems not to work...\r\n      };\r\n//      pn12_triage.childNodes[0].onclick = function(){search_ex_list.value = search_ex_list.value + ',' + pn12_triage_thread + '\\n';pref_func.apply_prep(pn_filter,true);catalog_filter_changed();catalog_triage_out();};\r\n//      pn12_triage.childNodes[2].onclick = function(){\r\n////        var key = /8chan\\/meta\\/18578(@[^,]*)*,/;\r\n//        var key = new RegExp(pn12_triage_thread +'(@[^,]*)*(,|$)','g');\r\n//        search_ex_list.value = search_ex_list.value.replace(/,,+/,',').replace(key,'') + ',' + pn12_triage_thread + '@' + new Date(threads[pn12_triage_thread][8] + pref.localtime_offset*3600000).toLocaleString()+'\\n';\r\n//        pref_func.apply_prep(pn_filter,true);\r\n//        catalog_filter_changed();\r\n//        catalog_triage_out();\r\n//      };\r\n      function triage_event(){\r\n        var flds = this.name.split(',');\r\n        var i = parseInt(flds[0].replace(/[^\\(]*\\(/,''),10);\r\n        var j = parseInt(flds[1].replace(/\\).*/,''),10);\r\n//      function triage(i,j){\r\n        var name = triage.get_triaged_thread_name();\r\n//        triage_exe(name,triage_str[i][j],triage_str[i][j+2],true);\r\n////        pref_func.apply_prep(search_ex_list,true);\r\n////        pref_func.apply_prep(attr_list,true);\r\n////        pref_func.apply_prep(watch_list,true);\r\n//        if (triage_str[i][j]==='UNDO') catalog_attr_changed();\r\n//        else catalog_attr_set(name,threads[name][0]);\r\n//        if (triage_str[i][j]==='WATCH' || triage_str[i][j]==='UNWATCH') show_catalog(name);\r\n//        else catalog_filter_changed();\r\n////        catalog_triage_out();\r\n        triage_exe_0(name,triage_str[i][j],triage_str[i][j+2],true);\r\n      }\r\n      function triage_exe_pipe(args){triage_exe_0(args[0],args[1],args[2],args[3],args[4]);}\r\n      function triage_exe_0(name,tri_str_ex,tri_str_attr,hist,datetime){\r\n        if (['ARC','ARC1','UARC'].indexOf(tri_str_ex)!=-1) {\r\n          if (pref.test_mode['67']) archiver.start_1(tri_str_ex,liveTag.mems.getFromName(name),true); // test patch\r\n          return;\r\n        }\r\n        var changed = triage_exe(name,tri_str_ex,tri_str_attr,hist,datetime);\r\n        name = changed.name;\r\n        if (changed.attr) catalog_attr_set(name,threads[name][0]);\r\n        if (changed.ex) threads[name][9] = catalog_filter_query(name);\r\n        if (changed.watch) {\r\n          reorder_thread_idx(name);\r\n          if (pref[embed_mode].mark_new_posts) format_html.update(name);\r\n        }\r\n        if (changed.ex || changed.watch) show_catalog(name);\r\n        if (triage.get_trg().format_tgt) triage.format_buttons(changed.name);\r\n        pref_func.tooltips.hide();\r\n      }\r\n      function triage_exe(name,tri_str_ex,tri_str_attr,hist,datetime){ // KILL,TIME,UNDO,NONE,WATCH,UNWATCH,DELETE,GO\r\n        if (tri_str_ex==='UNWATCH') common_func.modify_bookmark(name,false);\r\n        var changed = {ex:false, attr:false, watch:false, name:name};\r\n        if (tri_str_ex==='GO') {click_thread(name, 'force');return changed;}\r\n        if (tri_str_ex!=='UNDO') {\r\n          if (hist) {\r\n            if (triage_history.length>=pref.catalog_triage_hist*4) triage_history.splice(0,4);\r\n            triage_history.push(arguments);\r\n            triage_history.push(search_ex_list.value);\r\n            triage_history.push(attr_list.value);\r\n            triage_history.push(watch_list.value);\r\n          }\r\n          var key = new RegExp('(^|,)'+name.replace(/\\+/,'\\\\+')+'([\\\\^@!][^,\\n]*)*(,|\\n|$)','mg');\r\n//          if (tri_str_ex.search(/KILL|TIME|WATCH/)!=-1) { // contains UNWATCH\r\n          if (['KILL','TIME','WATCH','UNWATCH','DELETE','KILL_N','TIME_N'].indexOf(tri_str_ex)!=-1) {\r\n//            var datetime = threads[name][8][0] + pref.localtime_offset*3600000; // NO BLOCK SCOPE\r\n//            var datetime = ((threads[name][8][0]>threads[name][8][4])? threads[name][8][0] : threads[name][8][4]) + pref.localtime_offset*3600000; // NO BLOCK SCOPE\r\n//            var datetime = (tri_str_ex!=='DELETE')? threads[name][8][4] + pref.localtime_offset*3600000 : 0; // NO BLOCK SCOPE\r\n            if (!datetime) datetime = (tri_str_ex!=='DELETE')? (threads[name][8][4]||threads[name][8][0]) : 0; // NO BLOCK SCOPE\r\n            var millisec = datetime%1000; // NO BLOCK SCOPE\r\n            var time_str = '@' + new Date(datetime).toLocaleString() + ((datetime%1000==0)? '' : '.'+millisec); // NO BLOCK SCOPE\r\n            var wat_str = watch_list.value;\r\n            if (tri_str_ex==='UNWATCH' && wat_str.indexOf(key)==-1) var unwatch_explicitly = true;\r\n            wat_str = wat_str.replace(key,',');\r\n//            if (tri_str_ex.search(/KILL|UNWATCH/)==-1) {\r\n            if (tri_str_ex!=='DELETE') {\r\n//              if (['TIME','WATCH'].indexOf(tri_str_ex)!=-1) {\r\n              if (tri_str_ex==='WATCH' || (tri_str_ex==='TIME' || tri_str_ex==='TIME_N') && pref.catalog.auto_watch) {\r\n                wat_str += ',' + name + time_str + '\\n'; // TIME or WATCH\r\n                mark_read_thread(name, true);\r\n              } else {\r\n                if (unwatch_explicitly) wat_str += ',' + name + '@0\\n';\r\n                mark_read_thread(name, false);\r\n              }\r\n            }\r\n            watch_list.value = wat_str.replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,'');\r\n            changed.watch = true;\r\n          }\r\n//          if (tri_str_ex.search(/KILL|TIME|NONE/)!=-1) {\r\n          if (['KILL','TIME','NONE','DELETE','UNWATCH','KILL_N','TIME_N'].indexOf(tri_str_ex)!=-1) {\r\n            var ex_str = search_ex_list.value.replace(key,',');\r\n            if (['KILL','KILL_N','TIME','TIME_N'].indexOf(tri_str_ex)!=-1) ex_str = ex_str + ',' + name + ((tri_str_ex==='TIME' || tri_str_ex==='TIME_N')? time_str : '') +'\\n';\r\n            search_ex_list.value = ex_str.replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,'');\r\n            changed.ex = true;\r\n          }\r\n////          if (['KILL','TIME','NONE','DELETE'].indexOf(tri_str_ex)!=-1) {\r\n////            var at_str = attr_list.value.replace(key,',') + ((tri_str_attr!=='')? ',' + name + '^' +tri_str_attr : '') +'\\n';\r\n////            attr_list.value = at_str.replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,'');\r\n////            changed.attr = true;\r\n////          }\r\n          if (['KILL','TIME','NONE','DELETE','ATTR','SHOW','UNSHOW','STICKY','UNSTICKY'].indexOf(tri_str_ex)!=-1) {\r\n            var at_str;\r\n            if (tri_str_ex==='DELETE') at_str = '';\r\n            else {\r\n              var at_str = attr_list.value.match(key);\r\n              at_str = (at_str)? at_str[0] : name;\r\n              var at_obj = {val_obj2:null, val_obj3:null};\r\n              pref_func.str2obj2(at_obj,'val_obj2',at_str);\r\n              if (tri_str_ex==='ATTR' && tri_str_attr) pref_func.str2obj2(at_obj,'val_obj2',name+'^'+tri_str_attr, true);\r\n              at_obj = at_obj.val_obj2[name];\r\n              if (!at_obj.style) at_obj.style = {};\r\n              if (!at_obj.cmd) at_obj.cmd = {};\r\n              if (tri_str_ex==='SHOW') at_obj.cmd['show'] = true;\r\n              else if (tri_str_ex==='UNSHOW') delete at_obj.cmd['show'];\r\n              else if (tri_str_ex==='STICKY') {\r\n                if (threads[changed.name][16].systemSticky) delete at_obj.cmd['sticky'];\r\n                else at_obj.cmd['sticky'] = true;\r\n              } else if (tri_str_ex==='UNSTICKY')\r\n                if (threads[changed.name][16].systemSticky) at_obj.cmd['sticky'] = false;\r\n                else delete at_obj.cmd['sticky'];\r\n              at_str = name;\r\n              if (['KILL','TIME','NONE'].indexOf(tri_str_ex)!=-1) {\r\n                if (tri_str_attr!=='') at_str += '^' +tri_str_attr;\r\n              } else { // 'ATTR'\r\n                var at_obj_keys = Object.keys(at_obj.style);\r\n                if (at_obj_keys.length!=0) {\r\n                  for (var i=0;i<at_obj_keys.length;i++) at_obj_keys[i] += ':' + at_obj.style[at_obj_keys[i]];\r\n                  at_str += '^' + at_obj_keys.join(';');\r\n                }\r\n              }\r\n              at_obj_keys = Object.keys(at_obj.cmd);\r\n              if (at_obj_keys.length!=0) {\r\n                for (var i=0;i<at_obj_keys.length;i++) if (at_obj.cmd[at_obj_keys[i]]===false) at_obj_keys[i] += ':false';\r\n                at_str += '!' + at_obj_keys.join(';');\r\n              }\r\n              at_str = (at_str === name)? '' : at_str + '\\n';\r\n            }\r\n            at_str = attr_list.value.replace(key,',') + at_str;\r\n            attr_list.value = at_str.replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,'');\r\n            changed.attr = true;\r\n          }\r\n        } else {\r\n          if (triage_history.length!=0) {\r\n            changed.watch = (watch_list.value     !== triage_history[triage_history.length-1]);\r\n            changed.attr  = (attr_list.value      !== triage_history[triage_history.length-2]);\r\n            changed.ex    = (search_ex_list.value !== triage_history[triage_history.length-3]);\r\n            watch_list.value = triage_history.pop();\r\n            attr_list.value = triage_history.pop();\r\n            search_ex_list.value = triage_history.pop();\r\n            var undo_args = triage_history.pop(); // from arguments\r\n            changed.name = undo_args[0];\r\n          }\r\n        }\r\n        if (tri_str_ex==='DELETE') {\r\n          if (tri_str_attr===null) return changed;\r\n          else {\r\n            while (tri_str_attr.length!=0) {\r\n              var name_next = tri_str_attr.shift();\r\n              var changed_next = triage_exe(name_next,tri_str_ex,null,hist,datetime);\r\n              changed.watch |= changed_next.watch;\r\n              changed.ex    |= changed_next.ex;\r\n              changed.attr  |= changed_next.attr;\r\n            }\r\n          }\r\n        }\r\n//        if (tri_str_ex==='UNDO') re_sort_thread();\r\n//        else if (['WATCH','UNWATCH'].indexOf(tri_str_ex)!=-1) reorder_thread_idx(name);\r\n//        if (tri_str_ex!=='NONE') pref_func.apply_prep(watch_list,true);\r\n//        if (['UNDO','KILL','TIME','NONE'].indexOf(tri_str_ex)!=-1) pref_func.apply_prep(search_ex_list,true);\r\n//        if (['WATCH','UNWATCH'].indexOf(tri_str_ex)==-1) pref_func.apply_prep(attr_list,true);\r\n        if (changed.watch) pref_func.apply_prep(watch_list,true);\r\n        if (changed.ex)    pref_func.apply_prep(search_ex_list,true);\r\n        if (changed.attr)  pref_func.apply_prep(attr_list,true);\r\n        if (tri_str_ex==='UNDO' && (changed.watch || undo_args[1]==='KILL')) { // re-order, 'KILL' doesn't change watch-list.\r\n//        if (tri_str_ex==='UNDO' && changed.watch) { // re-order\r\n          if (threads[changed.name]) {\r\n            site2['DEFAULT'].check_reply.set_watch_time(threads[changed.name][19], get_watch_time_of_a_thread(changed.name,threads[changed.name][8][1], null, true), changed.name);\r\n//            threads[changed.name][19][0] |= 0x00010000;\r\n            scan_boards.scan_init('triage_undo', [changed.name], {refresh:true, priority:8});\r\n          }\r\n        }\r\n        return changed;\r\n      }\r\n      var triage_history = [];\r\n\r\n      var triage = (function(){\r\n        var trg = null;\r\n        function format_buttons(name){\r\n          var tgt = trg.format_tgt;\r\n          var tgt_th = threads[name];\r\n          var lth = liveTag.mems.getFromName(name);\r\n          for (var i=0;i<tgt.length;i++) tgt[i][0].style.display = (format_funcs[tgt[i][1]](tgt_th,lth))? 'none' : '';\r\n        }\r\n        var format_funcs = { // YOU MUST ALSO CHANGE toggles in Triage.\r\n          'WATCH': function(tgt_th){return (tgt_th[19][0]&0x000c0000) && tgt_th[19][1]===0;},\r\n          'UNWATCH': function(tgt_th){return !(tgt_th[19][0]&0x000c0000);},\r\n          'SHOW': function(tgt_th){return tgt_th[16].icon_show_always;},\r\n          'UNSHOW': function(tgt_th){return !tgt_th[16].icon_show_always;},\r\n          'STICKY': function(tgt_th){return tgt_th[16].icon_sticky;},\r\n          'UNSTICKY': function(tgt_th){return !tgt_th[16].icon_sticky;},\r\n          'ARC': function(tgt_th,lth){return lth.archived;},\r\n          'ARC1': function(tgt_th,lth){return lth.archived;},\r\n          'UARC': function(tgt_th,lth){return !lth.archived;},\r\n        };\r\n        var on_off = (function(){\r\n          var triaged_name = null;\r\n          var triaged_pn = null;\r\n          var db_thread_out = new DelayBuffer(thread_out,100);\r\n          var thread_out_delayed = DelayBuffer.prototype.delayed_do.bind(db_thread_out);\r\n          var db_triage_off = new DelayBuffer(triage_off,pref.triage.popdown_delay);\r\n          var mode = true; // add/remove or show/hide\r\n          function change_mode(){\r\n            triage_parent.appendChild(pn12_triage);\r\n            mode = false;\r\n          }\r\n          function thread_in(e){\r\n            if (pref.catalog_triage) { // working.\r\n              var pn = e.currentTarget;\r\n              db_thread_out.cancel();\r\n              if (triaged_pn===pn) return; // for faster execution.\r\n              if (!triaged_name) {\r\n                if (mode) pn12_triage = triage_parent.appendChild(pn12_triage);\r\n                else pn12_triage.style.display = '';\r\n              }\r\n              if (!pref.triage.show_always) {db_triage_off.cancel();db_triage_off.delayed_do();}\r\n              if (triaged_pn) triaged_pn.removeEventListener('mouseout', thread_out_delayed, false);\r\n              var left = pn.offsetLeft - triage_parent.scrollLeft;\r\n              if (pref.catalog_triage_place==='topLeft' || pref.catalog_triage_place==='bottomLeft') {\r\n                pn12_triage.style.left = left + 'px';\r\n                pn12_triage.style.right = '';\r\n              } else {\r\n                pn12_triage.style.right = triage_parent.offsetWidth - left - pn.offsetWidth + 'px';\r\n                pn12_triage.style.left = '';\r\n              }\r\n              var top = pn.offsetTop  - triage_parent.scrollTop;\r\n              if (pref.catalog_triage_place==='topLeft' || pref.catalog_triage_place==='topRight') {\r\n                if (top<triage_parent.offsetTop) top = triage_parent.offsetTop;\r\n                pn12_triage.style.top   = top + 'px';\r\n                pn12_triage.style.bottom = '';\r\n              } else {\r\n                pn12_triage.style.bottom = window.innerHeight - top - pn.offsetHeight + 'px';\r\n                pn12_triage.style.top = '';\r\n              }\r\n              triaged_pn = e.currentTarget;\r\n              triaged_name = triaged_pn.name;\r\n              triaged_pn.addEventListener('mouseout', thread_out_delayed, false);\r\n              if (trg.format_tgt) format_buttons(triaged_name);\r\n            } else triage_off();\r\n          }\r\n          function thread_out(){\r\n            if (triaged_pn) {\r\n              triaged_pn.removeEventListener('mouseout', thread_out_delayed, false);\r\n              triaged_pn = null;\r\n            }\r\n            triage_off();\r\n          }\r\n          function triage_off(){\r\n            if (triaged_name) {\r\n              if (mode) pn12_triage = triage_parent.removeChild(pn12_triage);\r\n              else pn12_triage.style.display = 'none';\r\n              triaged_name = null;\r\n            }\r\n          }\r\n          return {\r\n            get_triaged_thread_name: function(){return triaged_name;},\r\n            change_mode: change_mode,\r\n            thread_in:  thread_in,\r\n            off: triage_off,\r\n            off_delay: function(){db_triage_off.delayed_do(500);},\r\n            triage_in:  function(){                              db_triage_off.cancel();    db_thread_out.cancel();},\r\n            triage_out: function(){if (!pref.triage.show_always) db_triage_off.delayed_do();db_thread_out.delayed_do();},\r\n          }\r\n        })();\r\n        return {\r\n          get_triaged_thread_name: on_off.get_triaged_thread_name,\r\n          change_mode: on_off.change_mode,\r\n          thread_in:  on_off.thread_in,\r\n          off: on_off.off,\r\n          off_delay: on_off.off_delay,\r\n          triage_in:  on_off.triage_in,\r\n          triage_out: on_off.triage_out,\r\n          set_trg: function(trg_new){trg = trg_new;},\r\n          get_trg: function(){return trg;},\r\n          format_buttons: format_buttons,\r\n        }\r\n      })();\r\n      make_triage_entry();\r\n                \r\n\r\n//      function insert_thread_with_test_from_catalog_json(th, snoop, date_load){\r\n//        if (threads[th.key] && threads[th.key][8][0]>=th.time_bumped && threads[th.key][8][2]==th.nof_posts && threads[th.key][8][3]==th.nof_files) return false;\r\n//        site2[th.domain].parse_funcs['catalog_json'].entry(th,['key','pn']);\r\n//\r\n//        var date = [th.time_bumped, th.time_created, th.nof_posts, th.nof_files]; // temporal\r\n//        th.search_obj = [ th.com, th.sub, th.name, '', '', '', '', '']; // temporal\r\n//        var url = site2[th.domain].make_url3(th.board, th.no, '0'); // temporal\r\n//        insert_thread(th.pn, th.domain, th.page, date_load, th.key, th.pn.innerHTML, date, th.search_obj, url, true, th);\r\n//        return true;\r\n//      }\r\n//      function insert_thread_with_test_from_catalog_html(th, snoop, date_load){\r\n//        if (threads[th.key] && threads[th.key][8][0]>=th.time_bumped && threads[th.key][8][2]==th.nof_posts && threads[th.key][8][3]==th.nof_files) return false;\r\n////        var th2 = site2[th.domain].catalog_from_native_1(th.pn,th.board);\r\n////        insert_thread_from_native(th2, th.domain, th.board, snoop, date_load);\r\n//        site2[th.domain].parse_funcs['catalog_html'].entry(th,['sub','name','com','page']);\r\n//        var date = [th.time_bumped, th.time_created, th.nof_posts, th.nof_files]; // temporal\r\n//        th.search_obj = [ th.com, th.sub, th.name, '', '', '', '', '']; // temporal\r\n//        var url = site2[th.domain].make_url3(th.board, th.no, '0'); // temporal\r\n//        insert_thread(th.pn, th.domain, th.page, date_load, th.key, th.pn.innerHTML, date, th.search_obj, url, true, th);\r\n//        return true;\r\n//      }\r\n\r\n      function insert_thread_with_test(th, type, date_load){\r\n        var name = th.key;\r\n        if (threads_candidates_of_deletion && threads_candidates_of_deletion[name]) delete threads_candidates_of_deletion[name];\r\n        if (threads[name] &&\r\n//            ((threads[name][8][4] || threads[name][8][0])>=(th.time_posted || th.time_bumped)) && // vichan has inconsistency in time between catalog.json and thread.json.\r\n            (((threads[name][8][0]>threads[name][8][4])? threads[name][8][0] : (threads[name][8][4] || threads[name][8][0])) >= ((th.time_bumped > th.time_posted)? th.time_bumped : (th.time_posted || th.time_bumped))) && // vichan has inconsistency in time between catalog.json and thread.json.\r\n            threads[name][8][2]==th.nof_posts && threads[name][8][3]==th.nof_files\r\n          && (!threads[name][21] || (th.type_parse!=='thread_html' && th.type_parse!=='thread_json'))) {\r\n//        if (threads[name] && threads[name][8][0]>=th.time_bumped && threads[name][8][2]==th.nof_posts && threads[name][8][3]>=th.nof_files) {\r\n////////          if (threads[name] && pref.catalog_footer_show_page && threads[name][24] && threads[name][24][2]!=th.page) insert_footer3(name,null,th.page);\r\n          return false;\r\n        }\r\nif (pref.test_mode['0']) {\r\n        site2[th.domain].parse_funcs[type].entry(th,site2[th.domain].parse_funcs[type]['after_test']);\r\n}\r\n        insert_thread_passed_test(th, type, date_load);\r\n        return true;\r\n      }\r\n      function insert_thread_passed_test(th, type, date_load){\r\n//        var date = [th.time_bumped, th.time_created, th.nof_posts, th.nof_files]; // temporal\r\n//        th.search_obj = [ (th.com)? th.com : '', (th.sub)? th.sub : '', (th.name)? th.name : '', '', '', '', '', '']; // temporal\r\n        var url = null;\r\n////        if (type==='thread_html' || type==='page_html') {\r\n//////          if (site.nickname!==th.domain) site2[th.domain].absolute_link(th.pn, th.board); // patch for url. BUT BUG.\r\n////          url = site2[th.domain].get_thread_link(th.pn,th.board,pref.catalog_click!='expand',th.key);\r\n////          th.html_org = th.pn.innerHTML; // patch, must be before trim.\r\n////if (!pref.test_mode['5']) {\r\n////          trim_html(th.pn, th.domain, pref.catalog_format.show, th.key); // temporal\r\n////}\r\n////        }\r\n//////        } else url = site2[th.domain].make_url3(th.board, th.no, '0'); // temporal\r\n//////        site2[th.domain].parse_funcs[type]['finisher'](th);\r\n//        insert_thread(null, th.domain, th.page, date_load, th.key, (th.html_org)? th.html_org : th.pn.innerHTML, date, th.search_obj, url, true, th, type);\r\n        insert_thread(null, th.domain, th.page, date_load, th.key, null, th.search_obj, url, true, th, type);\r\n      }\r\n\r\n////////      function insert_thread_from_native(th, nickname, board, snoop, date_load){\r\n////////        var name = nickname + board + th.no;\r\n////////        var date = [th.time_bumped, th.time_created, th.nof_posts, th.nof_files];\r\n////////        var url = site2[nickname].make_url3(board, th.no, '0');\r\n//////////        if (threads[name] && threads[name][8][0]>=date[0]) return 0;\r\n////////        if (threads[name] && threads[name][8][0]>=date[0] && threads[name][8][2]==th.nof_posts && threads[name][8][3]==th.nof_files) return 0;\r\n//////////        if (threads[name] && threads[name][8][0]==date[0] && threads[name][8][2]!=th.nof_posts && nickname==='8chan' && pref.catalog.order.find_sage_in_8chan) threads[name][21] = true; // for 8chan.\r\n////////        return insert_thread(th.pn, nickname, th.page_no, date_load, name, th.pn.innerHTML, date, th.search_obj, url, true, th);\r\n////////      }\r\n\r\n////////      function re_trim_html(){\r\n////////        for (var name in threads) {\r\n////////          var date = get_mark_time(name,pref.catalog.filter.time_mark,pref.catalog.filter.list_mark_time,pref.catalog.filter.watch_list_mark_time);\r\n////////          if (date===0) date = Infinity;\r\n////////          var dbt = cnst.name2domainboardthread(name,true);\r\n////////          site2[dbt[0]].mark_newer_posts(threads[name][0],date);\r\n////////        }\r\n////////      }\r\n      function trim_html(src,nickname,format, name){\r\nif (!pref.test_mode['7']) { // memory leak debug.\r\n  if (!pref.test_mode['8']) {\r\n    if (!pref.test_mode['9']) {// safe\r\n      if (!pref.test_mode['10']) { // safe 30 min.\r\nif (!pref.test_mode['11']) {\r\n        if (!format.fileinfo) site2[nickname].remove_files_info(src);\r\n}\r\nif (!pref.test_mode['12']) {\r\n//        if (!format.posts)    site2[nickname].remove_posts(src,0);\r\n        if (pref[embed_mode].t2h_num_of_posts>=0) site2[nickname].remove_posts(src,(!format.posts)? 0 : pref[embed_mode].t2h_num_of_posts);\r\n}\r\nif (!pref.test_mode['13']) {\r\n        if (format.contents)  site2[nickname].format_thread_contents(src);\r\n}\r\n      }\r\n        if (format.layout)    site2[nickname].format_thread_layout(src);\r\n        if (format.style)     site2[nickname].format_thread_style(src);\r\n                              site2[nickname].format_thread_always(src);\r\n    }\r\n        if (pref[embed_mode].localtime) site2[nickname].localtime(src);\r\n    //        if (pref.catalog.filter.time_mark) site2[nickname].mark_newer_posts(src,date);\r\n  }\r\n}\r\n      }\r\n      function trim_html_mark_time(src,nickname,format, name){\r\n        var date = get_mark_time(name, pref[embed_mode].mark_new_posts, pref[embed_mode].mark_new_posts, pref[embed_mode].mark_new_posts);\r\n        if (date>0) site2[nickname].mark_newer_posts(src,date);\r\n        if (pref[embed_mode].format.thumb.resize) site2[nickname].format_remove_tn_area_size(src);\r\n      }\r\n////////      function insert_thread_from_page(src, nickname, boardname, op_no, page_no, nof_posts, nof_files, snoop, date_load){\r\n////////        var name = nickname + boardname + op_no;\r\n////////        if (snoop && !pref.catalog_promiscuous && !threads[name]) {\r\n////////          var hit = false;\r\n////////          for (var i=0;i<load_list.refresh.tgts.length;i++)\r\n////////            if (load_list.refresh.tgts[i][0].indexOf(nickname+boardname+'p'+page_no)!=-1 ||\r\n////////                load_list.refresh.tgts[i][0].indexOf(nickname+boardname+op_no)!=-1) {hit=true;break;}\r\n////////          if (!hit) return 0;\r\n////////        }\r\n////////        var date = site2[nickname].get_time_of_posts(src);\r\n////////        if (threads[name] && threads[name][13]<date_load) update_page_in_footer(name,page_no,date_load);\r\n////////        if (threads[name] && threads[name][8][0]>=date[0]) return 0;\r\n//////////console.log('In :'+name);\r\n////////        var url = site2[nickname].get_thread_link(src,boardname,pref.catalog_click!='expand',name);\r\n//////////        var date_mark = Date.parse(pref.catalog.filter.time_str) - pref.localtime_offset*3600000;\r\n//////////        console.log(name+', '+date);\r\n//////////        var src1 = document.createElement('div');\r\n//////////        src1.innerHTML = src.innerHTML;\r\n////////        var html_org = src.innerHTML;\r\n////////        var src2 = document.createElement('div');\r\n////////        src2.innerHTML = src.innerHTML;\r\n////////        var cross_domain = pref.catalog_board_list_obj[board_sel.selectedIndex][0]['domain']!=nickname;\r\n////////        var cross_board  = pref.catalog_board_list_obj[board_sel.selectedIndex][0]['board']!=boardname;\r\n////////        date = date.concat(site2[nickname].insert_footer(src,page_no,((cross_domain)? nickname : '')+((cross_board)? boardname : ''),pref.catalog_footer,date,nof_posts,nof_files));\r\n//////////        trim_html(src,  nickname, pref.catalog_format.show, date_mark);\r\n////////////        trim_html(src1, nickname, pref.catalog_format.hover, date_mark);\r\n//////////        trim_html(src2, nickname, pref.catalog_format.search, date_mark);\r\n////////        trim_html(src,  nickname, pref.catalog_format.show, name);\r\n////////        trim_html(src2, nickname, pref.catalog_format.search, name);\r\n////////        return insert_thread(src, nickname, page_no, date_load, name, html_org, date, src2, url, false, {board:boardname});\r\n////////      }\r\n      function image_resize1_onload() {\r\n        this.removeEventListener('load',common_func.image_resize1_onload,false);\r\n        common_func.image_resize(this, pref.catalog_size_tn1_width, pref.catalog_size_tn1_height);\r\n      }\r\n      function image_resize2_onload() {\r\n        this.removeEventListener('load',common_func.image_resize2_onload,false);\r\n        common_func.image_resize(this, pref.catalog_size_tn2_width, pref.catalog_size_tn2_height);\r\n      }\r\n//      function convert_html(name,th){\r\n//        if (!embed_catalog && pref.catalog.text_mode.mode==='text') {\r\n//          var text = document.createElement('span');\r\n//          text.innerHTML = ((pref.catalog.text_mode.sub  && threads[name][4][1][0])? '&emsp;' + threads[name][4][1][0] : '') +\r\n//                           ((pref.catalog.text_mode.name && threads[name][4][2][0])? '&emsp;' + threads[name][4][2][0] : '') +\r\n//                           ((pref.catalog.text_mode.com  && threads[name][4][0][0])? '&emsp;' + threads[name][4][0][0] : '');\r\n//          var footer_new = document.createElement('span');\r\n//          footer_new.innerHTML = th.footer.innerHTML; // make footer on demand.\r\n//          th.footer = footer_new;\r\n//          th.pn.innerHTML = '';\r\n//          th.pn.appendChild(th.footer);\r\n//          th.pn.appendChild(text);\r\n//          threads[name][18] = 'text';\r\n//        } else {\r\n//          th.pn.innerHTML = threads[name][25][1];\r\n//          th.footer = threads[name][25][0];\r\n//        }\r\n//      }\r\n\r\n////////\r\n//////// safe758\r\n////////              page                  catalog + thread\r\n//////// adoptNode    works with errors     works with errors\r\n//////// importNode   works with errors     works with errors\r\n//////// None         works with no errors  works with no errors\r\n////////\r\n//////// Memory leak was found with None (document leaks when I read KC's one), but I'll go with None.\r\n////////\r\n      var insert_thread_from_native = false;\r\n//      function insert_thread(src, nickname, page_no, date_load, name, html_org, src2, url, from_native, th, type){\r\n      function insert_thread(th, date_load, picked_up_by_kwd_filter){\r\n        var date_load = date_load;\r\n        var name = th.key;\r\nif (!pref.test_mode['28']) {\r\n        if (site2[th.domain].preprocess_doc && !insert_thread_from_native) site2[th.domain].preprocess_doc(th.pn);\r\n}\r\n//console.log('insert_thread: '+name+','+th.page+', '+th.nof_posts+', '+th.nof_files);\r\nif (pref.test_mode['26']) {\r\n//        if (!insert_thread_from_native && th.type_data==='html') document.adoptNode(th.pn);  // KC causes memory leak if I don't use adoptNode(). // causes error in page mixing.\r\n        if (!insert_thread_from_native && th.type_data==='html') th.pn = document.adoptNode(th.pn);\r\n}\r\nif (pref.test_mode['27']) {\r\n        if (!insert_thread_from_native && th.type_data==='html') th.pn = document.importNode(th.pn, true);\r\n}\r\n//        if (th.pn.parentNode) th.pn.parentNode.removeChild(th.pn); // redundant.\r\n////        if (site.nickname!==th.domain && th.type_data==='html') site2[th.domain].absolute_link(th);\r\n//////        if (site.nickname!==th.domain) site2[th.domain].absolute_link(th); // make th.pn implicitly.\r\n        var init_new = false;\r\n        var tgt_th = threads[name];\r\n        var date = [th.time_bumped, th.time_created, th.nof_posts, th.nof_files, th.time_posted];\r\n        if (tgt_th && tgt_th[16].needs_update) {\r\n          if (tgt_th[16].needs_update===true) {\r\n            if (tgt_th[7]) th.page = tgt_th[7].page;\r\n            remove_thread(name);\r\n            tgt_th = undefined;\r\n          } else delete tgt_th[16].needs_update;\r\n        }\r\n        if (tgt_th==undefined) {\r\nif (pref.test_mode['19']) { // stability test.\r\n          if (th.parse_funcs_html.th_init) th.parse_funcs_html.th_init(th); // BUG, should be moved into show_catalog() because threads aren't shown all the time and cause memory leak.\r\n}\r\n          init_new = true;\r\n//          threads[name] = [ch, false, (from_native)? [catalog_triage_in, null] : [func_in, func_pop_up],\r\n          threads[name] = [(insert_thread_from_native)? th.pn : false, // lazy generation, null may be returned by DOM, so 'false' is used here.\r\n                           insert_thread_from_native, (embed_mode==='page')? [triage.thread_in, null] : [func_in, func_pop_up],\r\n                           null,\r\n//                           [html_org || th.pn.innerHTML, nickname], // PATCHED. THIS WILL BE REMOVED.\r\n                           (th.posts)? th.posts : {sub:th.sub, com:th.com, name:th.name, trip:th.trip, filename:th.filename},\r\n//                           click_thread, // 5, click function.\r\n                           [], // 5, click source\r\n                           null,\r\n                           null, // (!pref.test_mode['49'])? th : undefined, // 7, th, // test\r\n                           date,\r\n                           [true,0,true,0], // filter result\r\n//                           (from_native)? click_thread_native : click_thread, null, url, date, true,\r\n                           null, // timestamp for posts search\r\n                           null, null, date_load, th.page, 0,\r\n//                           (from_native && brwsr.ff)? th.init_func : null, // 16\r\n//                           null, // 16, NOT USED\r\n                           { dbt: common_func.name2domainboardthread(name,true),\r\n//                             th_destroy: th.parse_funcs_html.th_destroy,\r\n                             parse_funcs: th.parse_funcs,\r\n                             systemSticky: th.sticky,\r\n                             type_html: th.type_html, // for insert_thread_from_native\r\n                             domain_html: th.domain_html,\r\n                             parse_funcs_html: th.parse_funcs_html,\r\n                             icon_sticky: null,\r\n                             icon_show_always: null,\r\n                             show_always: null,\r\n//                             op_img_src_url: null,\r\n                             th: th,\r\n//                             popups: null, posts:null,\r\n                           }, // 16, others\r\n//                           ch[brwsr.innerText].match(tags_scan_regex), // 17, tag\r\n                           null, // 17, tag\r\n                           th.type_html, // 18, type of html\r\n                           null, // 19, tracking info\r\n//                           [0,0,0,0,null,false,-2, 0, true, [], 0], // debug\r\n                             // 19, time_of_checked, num_of_unread_replies_TO_ME, num_of_unread_replies,\r\n                             //     time_of_checked_time_internal, args_for_desktop_notification, init,\r\n                             //     time_of_checked_old, num_of_unread_old, inital_loop // for faster execution.\r\n                             //     tag_temp, num_of_checked_posts_so_far\r\n                           th.sticky, // 20 sticky.\r\n//                           (nickname==='8chan' && from_native && pref.catalog.order.find_sage_in_8chan), // 21, watch.\r\n                           false, // 21, watch.\r\n                           {}, // 22, attr info for rollback.\r\n                           null, // 23, for missing info\r\n                           null, // 24, footer.\r\n                           null, // 25, text_mode [0]: footer, [1]: html_backup\r\n//                           th.op_img_url, // 26 op_iamge_url\r\n                           ];\r\n          tgt_th = threads[name];\r\n//          if (name in threads_last_deleted) tgt_th[8][4] = threads_last_deleted[name].last_post_time;\r\n          tgt_th[17] = liveTag.prep_tags(th);\r\n          tgt_th[19] = liveTag.mems[th.domain][th.board][th.no][2];\r\n          if (th.type_source==='catalog' && !(embed_mode==='catalog' && th.domain===site.nickname) &&\r\n              (th.domain==='KC' || // doesn't have time info\r\n               th.domain==='meguca')) { // doesn't have op.\r\n            tgt_th[16].needs_update = true;\r\n            scan.list_nup.add(th.key);\r\n          }\r\n////          if (th.parse_funcs.missing_info) { // working code.\r\n////            tgt_th[23] = common_func.shallow_copy_1(th.parse_funcs.missing_info);\r\n////            if (pref.network.fetch_actively) th.parse_funcs.missing_info_fetch(th);\r\n////          }\r\n\r\n////          if ((embed_mode==='page' || embed_mode==='thread') && th.nof_posts>1 && th.posts.length===1) {\r\n//////            cataLog.scan_init('refresh_inserted', [th.key], {refresh:true}); // DOESN'T WORK BECAUSE OF SO MANY REQUEST STOP PREVIOUS REQUESTS.\r\n////            catalog_liveTag_scan_ui('scan_ui', {tgts:[th.key], options:{refresh:true}});\r\n////          }\r\n//          if (!(tgt_th[19][0]&0x000c0000) && (tgt_th[19][0]&0x00010000) && tgt_th[19][2]===0) {\r\n//            var time_watch;\r\n//            if (date[4]||date[0]) time_watch = get_watch_time_of_a_thread(name,date[1],date[4]||date[0], true); // THIS MAY BE REDUNDANT, threads pass 'prep_tags' always.\r\n//            if (time_watch===0 && embed_mode==='thread' && pref.catalog.auto_watch) time_watch = (th.posts[th.posts.length-1].time || th.time);\r\n//            if (time_watch!==0) site2[th.domain].check_reply.set_watch_time(tgt_th[19], time_watch);\r\n//          }\r\n        }\r\n        if (th.parse_funcs.posts_full) th.parse_funcs.posts_full(th);\r\n        if (!date[0]) date[0] = tgt_th[8][0];\r\n        if (!date[4]) date[4] = (tgt_th[8][4]<date[0])? date[0] : (tgt_th[8][4])? tgt_th[8][4] : site2[th.domain].check_reply.get_checked_time(tgt_th[19]);\r\n        tgt_th[8] = date;\r\n        if (tgt_th[19][0]&0x00840000===0x00800000 && (date[1]>0||date[4]>0)) set_watch_time_thread(name, embed_mode, date[1],date[4], th, tgt_th[19]);\r\n\r\n////        if (tgt_th[16].posts && tgt_th[16].posts.length===1 && (tgt_th[16].parse_funcs.missing_info > (th.parse_funcs.missing_info || -1))) { // PATCH\r\n////          th.posts[0].pn = tgt_th[16].posts[0].pn;\r\n////          tgt_th[16].posts = th.posts; // this cause inconsistency between posts shown and posts stored.\r\n////          tgt_th[16].parse_funcs = th.parse_funcs;\r\n////          tgt_th[16].parse_funcs_html = th.parse_funcs_html;\r\n////          format_html.prepare_html_prep_posts(th);\r\n////        }\r\n        \r\n        var flag_posts_stored = embed_mode==='catalog' && pref[embed_mode].t2h_sel==='no' && th.parse_funcs.has_posts && pref.catalog.filter.kwd.posts_active && \r\n          th.posts && // patch for 4chan catalog.\r\n          (pref[embed_mode].popup2==='sr' || (pref[embed_mode].popup2==='srpv' && catalog_filter_query_keyword.kwd(pref.catalog.filter.kwd, th.posts, th.domain, th))); // for simple search with scan.\r\n        if (flag_posts_stored) {\r\n          th.posts = catalog_filter_query_keyword.kwd_make_result(th.posts, th.domain, th);\r\n          if (th.posts) {\r\n            th.posts[0].__proto__.search_result = th.posts[0].search_result; // patch. see 'catalog_filter_query_keyword.kwd_make_result'\r\n            th.posts[0] = th.posts[0].__proto__;\r\n          }\r\n        }\r\n//        tgt_th[9] = (picked_up_by_kwd_filter)? [true] : catalog_filter_query(name); // moved to later to apply t2h_num_of_posts\r\n        if (init_new && tgt_th[0]) threads[name][16].posts = th.posts;\r\n        if (th.type_source==='page' || th.domain==='4chan' && th.type_parse==='catalog_json') threads[name][16].t2h_page = th.posts.length-1;\r\n\r\n        if (th.parse_funcs.has_posts && (pref.test_mode['49'] || !flag_posts_stored)) {\r\n//        if (embed_mode==='page' || embed_mode==='thread' || !pref.test_mode['49']) {\r\n          if (!th.posts) th.posts = th.parse_funcs.posts(th); // patch for 4chan catalog.\r\n          var t2h_num_of_posts = format_html.get_t2h_num_of_posts(tgt_th, th.type_source);\r\n          if (t2h_num_of_posts!==false) {\r\n            if (init_new && (t2h_num_of_posts<0 || t2h_num_of_posts+1>th.posts.length) && th.posts.length<th.nof_posts && embed_mode==='page') { // load to add\r\n//            if (init_new && (t2h_num_of_posts<0 || t2h_num_of_posts+1>th.posts.length) && th.posts.length<th.nof_posts) { // doesn't work for short links(last 50 posts)\r\n              threads[name][16].expand_posts = true;\r\n              scan.list_nup.add_scan(th.key);\r\n//              catalog_liveTag_scan_ui('scan_ui', {tgts:[name], options:{refresh:true}});\r\n            }\r\n            if (tgt_th[16].th) th.posts = site2[th.domain].update_posts_replace_prep(th.posts, tgt_th[16].th.posts, t2h_num_of_posts); // merge\r\n            if (tgt_th[16].posts) th.posts = site2[th.domain].update_posts_replace_prep(th.posts, tgt_th[16].posts, t2h_num_of_posts); // merge // MUST CHANGE ADDRESS OF th.posts, 'th.posts===th_old.posts' is used 'insert_thread_format_html'\r\n            // CAUSE BUG??? may cayse mixing posts which should use different prototype, posts_html and posts_json.\r\n          }\r\n          if (pref.test_mode['64'] && pref[embed_mode].deleted_posts.merge && th.lth.pd)\r\n            th.posts = site2[th.domain].update_posts_merge_prep(th.posts, th.lth.pd,\r\n              (t2h_num_of_posts===false)? th.posts.length-1 : t2h_num_of_posts + ((t2h_num_of_posts==='unread' || t2h_num_of_posts==='N_unread')? th.lth.pd.length : 0), true);\r\n        }\r\n        if (!th.page && tgt_th[16].th) th.page = tgt_th[16].th.page;\r\n        if (!init_new && th.parse_funcs.has_posts) tgt_th[16].th = th;\r\n        if (!pref.test_mode['49'] && pref[embed_mode].t2h_sel!=='no') tgt_th[7] = th;\r\n        if (pref[embed_mode].t2h_sel==='no') th.posts = th.posts.slice(0,1); // don't change th.posts itself, some other catalog may grep that.\r\n        th.lth.th = th;\r\n//        if (!pref.test_mode['49'] && th.parse_funcs.has_posts && pref.catalog.filter.kwd.posts_active && !flag_posts_stored) tgt_th[7] = th; // BUG at catalog.\r\n        threads[name][9][2] = null;\r\n//        tgt_th[9] = (pref.filter.disable_list_when_kwd_active && picked_up_by_kwd_filter)? [true] : catalog_filter_query(name);\r\n        tgt_th[9] = catalog_filter_query(name); // slightly redundant.\r\n\r\n        catalog_attr_set(th.key,tgt_th[0]); // for cmd '!show'.\r\n        if (insert_thread_from_native || (tgt_th[16].expand_posts && tgt_th[1] && !pref.catalog.filter.kwd.posts_active) || pref.test_mode['36']) insert_thread_prepare_html_lazy(tgt_th, init_new, insert_thread_from_native, null, th);\r\n////        else {\r\n////          var th_old = tgt_th[16].th;\r\n////          if (th_old.posts.length<=1 || th.posts.length>1 && th.posts[th.posts.length-1].no > th_old.posts[th_old.posts.length-1].no) tgt_th[16].th = th;\r\n////          else if (th.page) th_old.page = th.page;\r\n////          catalog_attr_set(th.key,tgt_th[0]); // for 'show'.\r\n////        }\r\n        if (th.domain==='meguca' && tgt_th[16].needs_update!==true) tgt_th[16].needs_update = th.lastUpdated || ((th.lth.ed_p)? null : undefined); // lastUpdated may be undefined.\r\n//        if (th.parse_funcs.has_editing && tgt_th[16].needs_update!==true) tgt_th[16].needs_update = (th.lth.ed_p)? 1 : null;\r\n        return reorder_thread_idx(name);\r\n      }\r\n      function set_watch_time_thread(name, embed_mode, time_created, time_posted, th, watch){\r\n        var time_watch = get_watch_time_of_a_thread(name,time_created,time_posted, true);\r\n        if (time_watch>0) site2['DEFAULT'].check_reply.set_watch_time(watch, time_watch, name);\r\n        else if (time_watch===0 && embed_mode==='thread' && pref.catalog.auto_watch) site2['DEFAULT'].check_reply.set_watched_to_last(watch, time_posted || time_created, name);\r\n        else site2['DEFAULT'].check_reply.set_unwatch(watch);\r\n      }\r\n//      function set_watch_time_thread(name, embed_mode, time_created, time_posted, th, tgt_th19){\r\n//        var time_watch = get_watch_time_of_a_thread(name,time_created,time_posted, true);\r\n//        if (time_watch===0 && embed_mode==='thread' && pref.catalog.auto_watch) time_watch = (th.posts[th.posts.length-1].time || th.time);\r\n//        site2[th.domain].check_reply.set_watch_time(tgt_th19, time_watch);\r\n//      }\r\n      cataLog.set_watch_time_thread = set_watch_time_thread;\r\n\r\n      function insert_thread_prepare_html_lazy(tgt_th, init_new, insert_thread_from_native, from_lazy, th){\r\n        var th = tgt_th[16].th || th;\r\n        format_html.prepare_html_prep_posts(th); // wrap always for popup2, including \"embed_mode==='catalog'\".\r\n        if (init_new || (embed_mode==='page' || embed_mode==='thread')) format_html.prepare_html(th, init_new);\r\n\r\n        if (init_new) {\r\n//          tgt_th[16].op_img_src_url = (th.parse_funcs.get_op_src)? th.parse_funcs.get_op_src(th) : th.op_img_url;\r\n          var ch = tgt_th[0];\r\n          tgt_th[3] = [ch.innerHTML, th.domain]; // PATCHED. THIS WILL BE REMOVED.\r\n          ch.name = th.key; // ch.setAttribute('name',name); // for native html\r\n          if (embed_mode==='float' || (th.domain!==site.nickname && !pref.catalog.mimic_base_site)) {\r\n            ch.style.width  = ((pref.catalog.text_mode.mode==='text')? pref.catalog_size_text_width  : pref.catalog_size_width ) + 'px';\r\n            ch.style.height = ((pref.catalog.text_mode.mode==='text')? pref.catalog_size_text_height : pref.catalog_size_height) + 'px';\r\n            ch.style.float = 'left';\r\n            ch.style.overflow = 'hidden';\r\n//            ch.style.background = '#e5ecf9';\r\n          }\r\n          if (!ch.style) ch['style'] = {};\r\n\r\n          tgt_th[0].addEventListener('mouseover', tgt_th[2][0], false);\r\n\r\n          common_func.dom_addEventListener(tgt_th[5], th.pn, 'click', click_thread_whole);\r\n          common_func.dom_addAttribute(th.pn, 'class', pref.script_prefix+'_thread');\r\n          if (embed_mode!=='page' && embed_mode!=='thread') for (var i=0;i<th.tn_as.length;i++) {\r\n            th.tn_as[i].onclick = click_thread_tn; // preventDefault is in this event handler.\r\n            common_func.dom_addAttribute(th.tn_as[i], 'class', pref.script_prefix+'_thumbnail');\r\n          }\r\n          if (pref[embed_mode].format.thumb.resize) // BUG, should be moved into show_catalog() because threads aren't shown all the time and cause memory leak.\r\n            for (var i=0;i<th.tn_imgs.length;i++) th.tn_imgs[i].addEventListener('load',(i==0)?image_resize1_onload : image_resize2_onload, false);\r\n\r\n          if (tgt_th[20]===true) tgt_th[16].icon_sticky = (insert_thread_from_native)? site2[th.domain].get_icon(tgt_th[0],th.type_html, 'sticky', tgt_th[16]) :\r\n                                                                                       site2[th.domain].add_icon(tgt_th[0],th.type_html, 'sticky', tgt_th[16]); // first time only.\r\n          catalog_attr_set(th.key,tgt_th[0]);\r\n  \r\n          if (embed_mode==='float' && pref.catalog.text_mode.mode==='text') { // place after th.op_img_url. // NEED TO MODIFY REMOVE_THREAD TO PREVENT MEMORY LEAK.\r\n            var text = document.createElement('span');\r\n            text.innerHTML = ((pref.catalog.text_mode.sub && th.sub)? '&emsp;' + th.sub : '') +\r\n                             ((pref.catalog.text_mode.name && th.name)? '&emsp;' + th.name : '') +\r\n                             ((pref.catalog.text_mode.com && th.com)? '&emsp;' + th.com : '');\r\n            var footer = th.footer; // make footer on demand.\r\n            var footer_new = document.createElement('span');\r\n            footer_new.innerHTML = footer.innerHTML;\r\n            th.footer = footer_new;\r\n            th.pn.innerHTML = '';\r\n            th.pn.appendChild(th.footer);\r\n            th.pn.appendChild(text);\r\n            tgt_th[18] = 'text';\r\n          }\r\n          tgt_th[24] = prep_footer3(th);\r\n          if (from_lazy) insert_footer3(th.key, null, th.page, th.tags, th);\r\n        }\r\n//          convert_html(name,th);\r\n//          threads[name][25] = [threads[name][24][0], threads[name][0].innerHTML, threads[name][18]];\r\n////////          insert_footer3(name,th.flags,th.page,threads[name][17]);\r\n        if (tgt_th[0]) insert_thread_format_html(th,th.key,init_new,insert_thread_from_native);\r\n        tgt_th[16].th = null;\r\n      }\r\n\r\n      function insert_thread_format_html(th,name,init_new,insert_thread_from_native, force_prep_html){\r\n//        if (force_prep_html) format_html.prepare_html(th); // for json\r\n        site2['DEFAULT'].check_reply.set_own_posts(th);\r\n//        if (th.type_source==='page') threads[name][16].t2h_page = th.posts.length-1;\r\n        if (init_new) {\r\n//          if (embed_mode==='page' || embed_mode==='thread') {\r\n          if (embed_mode==='page' && threads[name][16].posts && threads[name][16].posts!==th.posts) format_html.update_posts_in_page(th,name,null, true);\r\n          else threads[name][16].posts = th.posts;\r\n          if ((embed_mode==='page' || embed_mode==='thread') && pref.test_mode['64'] && pref[embed_mode].deleted_posts.merge && th.lth.pd) format_html.update_posts_in_page(th,name,null, true);\r\n////            var t2h_num_of_posts = format_html.get_t2h_num_of_posts(threads[name], th.type_source);\r\n////            if (t2h_num_of_posts!==false)\r\n////              if (t2h_num_of_posts+1>th.posts.length && th.posts.length<th.nof_posts) {\r\n////                threads[name][16].expand_posts = true;\r\n////                scan.list_nup.add_scan(th.key);\r\n//////                catalog_liveTag_scan_ui('scan_ui', {tgts:[name], options:{refresh:true}});\r\n////              } else if (t2h_num_of_posts+1<th.posts.length && (th.parse_funcs.has_posts || t2h_num_of_posts===0)) format_html.update_posts_in_page(th,name,null, true);\r\n          if (embed_mode==='page' && pref[embed_mode].use_expander_always) site2[th.domain_html].page_json2html3_replace_expander(th.posts, format_html.get_t2h_index(threads[name]));\r\n          if (th.type_html==='page' || th.type_html==='thread') {\r\n            var links = th.parse_funcs_html.get_thread_links(th);\r\n            if (links) for (var i=0;i<links.length;i++) links[i].onclick = click_link;\r\n//            if (th.parse_funcs.time_unit!==1) { // BUG!!! REFER 'update_posts_1'\r\n//              var tu = th.parse_funcs.time_unit;\r\n//              for (var i=0;i<th.posts.length;i++) th.posts[i].time *= th.parse_funcs.time_unit;\r\n//            }\r\n////            if (pref[embed_mode].colorID && site2[th.domain_html].colorID && (!pref[embed_mode].env.colorID_native || !insert_thread_from_native))\r\n////              for (var i=0;i<th.posts.length;i++) site2[th.domain_html].colorID(th.posts[i].pn);\r\n////            if (pref[embed_mode].backlink && site2[th.domain_html].backlink && (!pref[embed_mode].backlink_native || !insert_thread_from_native))\r\n////              for (var i=0;i<th.posts.length;i++) if (th.tags.q && th.tags.q[th.posts[i].no]) site2[th.domain_html].backlink(th.posts[i].pn, th.tags.q[th.posts[i].no]);\r\n            var pref_env = (!insert_thread_from_native)? pref[embed_mode] :\r\n                                                         {\r\n                                                           colorID: pref[embed_mode].colorID && !pref[embed_mode].env.colorID_native,\r\n                                                           backlink: pref[embed_mode].backlink && !pref[embed_mode].env.backlink_native, // do nothing because all posts don't have post.backlinks because this is before calling 'popups_add'.\r\n                                                           localtime: pref[embed_mode].localtime && !pref[embed_mode].env.localtime_native,\r\n                                                         };\r\n            for (var i=0;i<th.posts.length;i++) format_html.prepare_html_post(th, th.posts[i], th.tags.q, pref_env);\r\n//            for (var i=0;i<th.posts.length;i++) site2[th.domain_html].format_pn(th.posts[i].pn, th.tags.q && th.tags.q[th.posts[i].no], pref_env, th.posts[i]);\r\n          }\r\n        } else {\r\n          if (th.domain==='KC' && embed_mode==='page' && pref[embed_mode].use_expander_always) site2[th.domain_html].page_json2html3_replace_expander(th.posts, format_html.get_t2h_index(threads[name])); // test patch for KC, I don't know why but other than KC generates ERROR.\r\n          if ((embed_mode==='page' || embed_mode==='thread') && (pref.catalog_expand_at_initial_embed || pref.catalog_expand_at_initial))\r\n            if (th.parse_funcs.has_posts) format_html.update_posts_in_page(th,name);\r\n////////          if (threads[name][19][0]===0) { // patch // working code.\r\n////////            threads[name][19][0] = - get_mark_time(name,pref.catalog.filter.time_watch,false,true);\r\n////////            if (threads[name][19][0]!==0) threads[name][19][2] = 0;\r\n////////          }\r\n//          for (var i=0;i<threads_idx.length;i++) if (threads_idx[i]==name) {threads_idx.splice(i,1);break;}\r\n//          if (pref.notify.desktop.use && pref.notify.desktop.reply && threads[name][8][2]!=date[2]) desktop_notifier_obj.show('New Reples in '+name,name);\r\n//          ch = threads[name][0];\r\n////////          if (th.type_html==='page_html' || th.type_html==='thread_html') {\r\n////////            ch.innerHTML = src.innerHTML; // faster, but can't revise footer, because this re-create DOM and th.footer is abondoned.\r\n////////            threads[name][24] = prep_footer3(th.footer,th.board,th.domain,th.flags); // can't work \r\n////////          }\r\n//          ch.innerHTML = src.innerHTML; // revise footer.\r\n//          if (threads[name][20]===true) site2[nickname].add_sticky_info(threads[name][0],threads[name][18],threads[name][20]);\r\n//          threads[name][19][8] = false;\r\n          if (th.type_source!=='catalog' && embed_mode==='float') threads[name][3][0] = th.pn.innerHTML;\r\n        }\r\n//        if (embed_mode==='page' && th.posts && th.posts[0].search_result!==undefined && threads[name][16].posts) site2[th.domain_html].update_posts0_class(threads[name][16].posts[0].pn, th.posts[0].search_result); // place here, because sometimes filter is given at initial, and that is 'init_new===true' // patch for 4chan catalog. moved to 'format_pn'\r\n//        if (th.posts && th.posts[0].search_result!==undefined && threads[name][16].posts) site2[th.domain_html].update_posts0_class(threads[name][16].posts[0].pn, th.posts[0].search_result); // place here, because sometimes filter is given at initial, and that is 'init_new===true'\r\n        \r\n        var idx_new_post = (init_new)? 0 : 1;\r\n        if (embed_mode=='page' && th.type_data==='json') { // TEMPORAL PATCH\r\n          th.domain_html = site.nickname;\r\n          th.parse_funcs_html = site2[th.domain_html].parse_funcs.page_html;\r\n          for (var i=idx_new_post;i<th.posts.length;i++) if (!th.posts[i].pn) th.posts[i].pn = site2[th.domain_html].post_json2html(th.posts[i],th.board);\r\n          for (var i=idx_new_post;i<th.posts.length;i++) th.posts[i].tn_imgs = th.parse_funcs_html.tn_imgs(th.posts[i]);\r\n        }\r\n//        if (embed_page && th.parse_funcs.has_posts) {\r\n        if (embed_mode==='page' || embed_mode==='thread') {\r\n          var add_event = !pref[embed_mode].env.expand_thumbnail_inline_native || !insert_thread_from_native || (pref[embed_mode].expand_thumbnail_inline_all_after && pref[embed_mode].env.event_dynamic);\r\n          var expand_now = pref[embed_mode].expand_thumbnail_initial;\r\n          var expand_on_demand = pref[embed_mode].thumbnail.inline.ondemand;\r\n          if (add_event || expand_now)\r\n            for (var j=idx_new_post;j<th.posts.length;j++) {\r\n              var tn_imgs = th.parse_funcs_html.tn_imgs(th.posts[j]);\r\n              if (tn_imgs) for (var i=0;i<tn_imgs.length;i++) {\r\n                tn_imgs[i].onclick = expand_thumbnail_inline;\r\n//                tn_imgs[i].onclick = (add_event)? expand_thumbnail_inline : expand_thumbnail_on_demand_set; // REDUNDANT???\r\n                if (expand_now) {\r\n                  if (expand_on_demand) {\r\n                    expand_thumbnail_queue_add(tn_imgs[i]);\r\n                    expand_now = false;\r\n                  } else expand_thumbnail_inline.call(tn_imgs[i], null, true);\r\n                }\r\n              }\r\n            }\r\n        }\r\n        if ((embed_mode==='catalog' && init_new) || (embed_mode==='page' || embed_mode==='thread')) \r\n          if (pref[embed_mode].image_prefetch || (pref[embed_mode].image_hover && (!pref[embed_mode].env.image_hover_native || !insert_thread_from_native)))\r\n            if (th.parse_funcs.has_posts && (embed_mode==='page' || embed_mode==='thread')) {\r\n              for (var j=idx_new_post;j<th.posts.length;j++) {\r\n                var tn_imgs = th.parse_funcs_html.tn_imgs(th.posts[j]);\r\n                if (tn_imgs) for (var i=0;i<tn_imgs.length;i++) tn_imgs[i].onmouseover = image_hover_add;\r\n              }\r\n            } else if (init_new && !th.parse_funcs_html.dynamic_image_hover) {\r\n              var tn_imgs = th.parse_funcs_html.tn_imgs(th);\r\n              for (var i=0;i<tn_imgs.length;i++) tn_imgs[i].onmouseover = image_hover_add;\r\n            }\r\n        if ((embed_mode==='page' || embed_mode==='thread') && pref[embed_mode].popup && site2[th.domain].popups_add && th.type_html!=='catalog') site2[th.domain].popups_add(threads[name][16], th, (!insert_thread_from_native || !pref[embed_mode].env.popup_native));\r\n        if (pref.catalog.filter.kwd.post && th.posts) threads[name][4] = th.posts;\r\n//        threads[name][9] = catalog_filter_query(name);\r\n//if (pref.test_mode['5']) {\r\n//        if (init_new && th.type_html!='catalog' && (type==='thread_html' || type==='page_html')) { // modify HTML at end because of DYNAMIC PARSE.\r\n////          trim_html(threads[name][0], th.domain, pref[embed_mode].format.show, th.key);\r\n//          if (pref[embed_mode].localtime) site2[nickname].localtime(th.pn); // PATCH\r\n//        }\r\n//}\r\n        if (pref[embed_mode].hide_posts_without_images) format_html.hide_posts_without_images(th,name);\r\n        format_html.update_draw(name);\r\n      }\r\n      var format_html = {\r\n        prepare_html_prep_posts: function(th){\r\n          site2[th.domain].wrap_to_parse.posts(th);\r\n//          if (th.parse_funcs.posts_full) th.parse_funcs.posts_full(th); // BUG, DOESN'T HIT FILTER BEFORE BEING SHOWN.\r\n          if (th.type_data==='html') this.prepare_html_extract_params(th); // extraction function assumes that it has all of properties, this must be after 'posts_full'.\r\n        },\r\n        prepare_html_extract_params: function(th){\r\n          if (!th.extracted) {\r\n            if (th.parse_funcs.filename) {\r\n              for (var i=0;i<th.posts.length;i++) if (th.posts[i].pn) th.posts[i].filename = th.parse_funcs.filename(th.posts[i]); // deleted posts may be merged.\r\n//              for (var i=0;i<th.posts.length;i++) th.posts[i].filename = th.parse_funcs.filename(th.posts[i]);\r\n              th.filename = th.parse_funcs.filename(th);\r\n            }\r\n            if (th.parse_funcs.prep_mimic) th.parse_funcs.prep_mimic(th);\r\n            th.extracted = true;\r\n          }\r\n        },\r\n        prepare_html: function(th, init_new){\r\n          var tgt_th = threads[th.key];\r\n//        if ((th.domain!==site.nickname || site.whereami+'_html'!=type) && pref.catalog.mimic_base_site && th.pn && site2[site.nickname].catalog_json2html3) { // for KC.\r\n//        if ((th.domain!==site.nickname || site.whereami!='catalog') && pref.catalog.mimic_base_site && th.pn && site2[site.nickname].catalog_json2html3) { // cause document leak in KC\r\n//          site2[th.domain].wrap_to_parse.posts(th);\r\n//          if (th.parse_funcs.posts_full) th.parse_funcs.posts_full(th);\r\n          var mimic = ((th.domain!==site.nickname || site.whereami+'_html'!==th.type_parse) && pref.catalog.mimic_base_site);\r\n          var mimic_tgt = ((embed_mode==='page' || embed_mode==='thread') && site2[site.nickname].page_json2html3)? 'page' : 'catalog'; // temporal, remove '&& site2[site.nickname].page_json2html3' later.\r\n//          if (init_new || !mimic)\r\n//            if (mimic_tgt==='page' && th.type_data==='html') this.prepare_html_extract_params(th); // for popup2, always wrapping is required.\r\n          if (mimic) {\r\n            if (init_new) {\r\n              var tmp_pn = (mimic_tgt==='page')? site2[site.nickname].page_json2html3(th,th.board,th.op_img_url, true) : // FIXED, BUT WHY THIS WAS 'false'??? <- probably patch for type_data==='html'\r\n                                                 site2[site.nickname].catalog_json2html3(th,th.board,th.op_img_url);\r\n              Object.defineProperty(th, 'pn', {value: tmp_pn, writable:true, enumerable:true, configurable:true});\r\n            }\r\n            th.type_html = mimic_tgt;\r\n            th.domain_html = site.nickname;\r\n            th.parse_funcs_html = site2[site.nickname].parse_funcs[th.type_html+'_html']; // overwrite.\r\n          } else if (th.type_data==='html') site2.common.remove_by_tagname(th.pn,'script');\r\n          if (init_new) {\r\n            if (tgt_th[0]===false) { // patch\r\n              tgt_th[0] = th.pn;\r\n              tgt_th[16].type_html = th.type_html;\r\n              tgt_th[16].domain_html = th.domain_html;\r\n              tgt_th[16].parse_funcs_html = th.parse_funcs_html;\r\n            }\r\n            Object.defineProperty(th, 'footer', {value: th.parse_funcs_html.footer(th), writable:true, enumerable:true, configurable:true});\r\n            site2[th.domain].toplevel_anchor(th, th.no); // Files in op are out of posts[0].pn sometimes, so these must be called with 'th'.\r\n            if (site.nickname!==th.domain) site2[th.domain].absolute_link(th);\r\n//            if (th.localArchive) if (pref.test_mode['67']) archiver.url2file(th.localArchive, th); // merged to root html generator to prevent needless prefetch.\r\n//            if (th.parse_funcs.has_editing) for (var i=0;i<th.posts.length;i++) if (th.posts[i].editing)\r\n//              th.posts[i].pn.classList.add(pref.script_prefix+'_post_editing');\r\n//              th.posts[i].pn.style.background = '#cec952';\r\n          }\r\n//          else {\r\n//            var pfunc_pn = site2[th.domain_html].parse_funcs['post_json'].pn;\r\n//            for (var i=1;i<th.posts.length;i++) {\r\n//              if (!th.posts[i].pn) th.posts[i].pn = pfunc_pn(th.posts[i]);\r\n//              site2[th.domain].toplevel_anchor(th.posts[i], th.no);\r\n//              if (site.nickname!==th.domain) site2[th.domain].absolute_link(th.posts[i]);\r\n//              if (th.localArchive) if (pref.test_mode['67']) archiver.url2file(th.localArchive, th.posts[i]);\r\n//              if (th.posts[i].editing) th.posts[i].pn.style.background = '#cec952';\r\n//            }\r\n//          }\r\n        },\r\n        prepare_html_post: function(th, post, thq, pref_env){\r\n          if (!post.pn) post.pn = site2[th.domain_html].parse_funcs['post_json'].pn(post);\r\n          if (!pref_env) {\r\n            site2[th.domain].toplevel_anchor(post, th.no); // for updating by type_source==='html'\r\n            if (site.nickname!==th.domain) site2[th.domain].absolute_link(post);\r\n          }\r\n//          if (th.localArchive) if (pref.test_mode['67']) archiver.url2file(th.localArchive, post); // merged to root html generator to prevent needless prefetch.\r\n          site2[th.domain_html].format_pn(post.pn, (thq)? thq[post.no] : null, pref_env, post);\r\n          if (post.editing) post.pn.classList.add(pref.script_prefix+'_post_editing');\r\n//          if (post.editing) post.pn.style.background = '#cec952';\r\n        },\r\n        get_t2h_from_index: function(idx){\r\n          return ['page','L','M','N','N_unread','unread','all'][idx];\r\n        },\r\n        get_t2h_index: function(tgt_th){\r\n          var t2h_sel = tgt_th[16].t2h_sel || pref[embed_mode].t2h_sel; \r\n          return (t2h_sel==='page')? 0 :\r\n                 (t2h_sel==='L')? 1 :\r\n                 (t2h_sel==='M')? 2 :\r\n                 (t2h_sel==='N')? 3 :\r\n                 (t2h_sel==='N_unread')? 4 :\r\n                 (t2h_sel==='unread')? 5 : 6;\r\n        },\r\n        get_t2h_num_of_posts: function(tgt_th, type_source){\r\n          var t2h_sel = tgt_th[16] && tgt_th[16].t2h_sel || pref[embed_mode].t2h_sel; \r\n          if (t2h_sel!=='page' || type_source!=='page' || tgt_th[16].expand_posts) {\r\n            return (t2h_sel==='page')? tgt_th[16].t2h_page || pref[embed_mode].t2h_num_of_posts :\r\n                   (t2h_sel==='L')? pref[embed_mode].t2h_L :\r\n                   (t2h_sel==='M')? pref[embed_mode].t2h_M :\r\n                   (t2h_sel==='N')? pref[embed_mode].t2h_num_of_posts :\r\n                   (t2h_sel==='N_unread')? pref[embed_mode].t2h_num_of_posts + ((tgt_th[19][0]&0x000c0000)? (tgt_th[19][1]&0x0000ffff) : 0) :\r\n                   (t2h_sel==='unread')? ((tgt_th[19][0]&0x000c0000)? (tgt_th[19][1]&0x0000ffff) : tgt_th[16].t2h_page) :\r\n                   (t2h_sel==='no')? 0 : -1; // 'ALL' and 'ALL_agg'\r\n          } else return false;\r\n        },\r\n        update_posts_in_page: function(th,name, force_prep_html, remove){\r\n//          if (!th.parse_funcs.has_posts && !remove) return;\r\n//          if (force_prep_html) this.prepare_html(th); // for json\r\n          var tgt_th = threads[name];\r\n////          var t2h_num_of_posts = this.get_t2h_num_of_posts(tgt_th, th.type_source);\r\n////          if (t2h_num_of_posts!==false) {\r\n//////            if (t2h_num_of_posts>=0 && th.posts.length > t2h_num_of_posts+1) th.posts.splice(1,th.posts.length - t2h_num_of_posts -1);\r\n////            if (t2h_num_of_posts>=0 && th.posts.length > t2h_num_of_posts+1)\r\n////              th.posts = th.posts.slice(0,1).concat(th.posts.slice(th.posts.length - t2h_num_of_posts)); // SLIGHTLY REDUNDANT, SHOULD BE CONSOLIDATED.\r\n////            else site2[th.domain].update_posts_replace_prep(th,tgt_th[16], t2h_num_of_posts);\r\n////            site2[th.domain].page_json2html3_add_omitted_info(th, th.posts, th.posts);\r\n////          }\r\n//          if (pref.test_mode['64'] && pref[embed_mode].deleted_posts.merge && th.lth.pd) {\r\n//            th.posts_alive = th.posts;\r\n//            th.posts_full  = site2[th.domain].update_posts_merge_prep(th.posts, th.lth.pd, th.posts.length-1, true);\r\n//            th.posts = th.posts_full;\r\n////            tgt_th[16].posts = site2[th.domain].update_posts_merge_prep(tgt_th[16].posts, th.lth.pd, true);\r\n//            site2[th.domain_html].update_posts_replace(th,tgt_th[16],(pref[embed_mode].merge)? site2['DEFAULT'].update_posts_merge_base : tgt_th[0], pref[embed_mode].merge, tgt_th[1]);\r\n//          } else \r\n          site2[th.domain_html].update_posts_replace(th,tgt_th[16],(pref[embed_mode].merge)? site2['DEFAULT'].update_posts_merge_base : tgt_th[0], pref[embed_mode].merge, tgt_th[1]);\r\n          if (tgt_th[16].expand_posts) tgt_th[16].expand_posts = null;\r\n        },\r\n        replace_posts_by_search: function(tgt_th){ // tgt_th[16].th may be set by updater.\r\n          var th = tgt_th[7];\r\n          if (pref.catalog.filter.kwd.posts_active) {\r\n            if (tgt_th[10]!=pref.catalog.filter.kwd.timestamp || tgt_th[16].th) { // existence of tgt_th[16].th means thread is updated.\r\n              tgt_th[10] = pref.catalog.filter.kwd.timestamp;\r\n              var th_new = catalog_filter_query_keyword.kwd_make_result(th.posts, th.domain, th);\r\n              if (!th_new) {\r\n                tgt_th[9][0] = false;\r\n                tgt_th[16].th = null;\r\n              } else {\r\n                var flag = (!tgt_th[16].posts || tgt_th[16].posts.length!==th_new.length);\r\n                if (!flag) {\r\n                  var i=th_new.length-1;\r\n                  while (i>=0) {\r\n                    if (tgt_th[16].posts[i].no!==th_new[i].no) {flag=true; break;} // for no OP\r\n                    i--;\r\n                  }\r\n                  if (!flag && tgt_th[16].posts && tgt_th[16].posts[0] && tgt_th[16].posts[0].pn &&\r\n                      (tgt_th[16].posts[0].pn.classList.contains('CatChan_search_miss')==th_new[0].search_result))\r\n                    site2[th.domain_html].update_posts0_class(tgt_th[16].posts[0].pn,th_new[0].search_result);\r\n                }\r\n                if (flag) {    \r\n                  format_html.prepare_html_prep_posts(th);\r\n                  tgt_th[16].th = {posts:th_new, __proto__:th};\r\n//                  tgt_th[10] = pref.catalog.filter.kwd.timestamp;\r\n                } else if (tgt_th[16].th) tgt_th[16].th = null;\r\n              }\r\n            }\r\n          } else if (tgt_th[10] || tgt_th[16].th){ // rollback\r\n            if (!tgt_th[16].th) tgt_th[16].th = scopy_th(th);\r\n            tgt_th[10] = false;\r\n          }\r\n          if (tgt_th[16].th && tgt_th[7]) // updated by this or updater.\r\n            if (tgt_th[16].posts===tgt_th[7].posts) tgt_th[7].posts = tgt_th[7].posts.slice(); // backup\r\n        },\r\n        posts_search_inactivated: function(){\r\n          for (var name in threads) {\r\n            var th = threads[name][7];\r\n            var tgt_th16 = threads[name][16];\r\n            if (tgt_th16.posts && tgt_th16.posts[0] && tgt_th16.posts[0].pn && tgt_th16.posts[0].pn.classList.contains('CatChan_search_miss')) {\r\n              site2[th.domain_html].update_posts0_class(tgt_th16.posts[0].pn,true);\r\n//              delete th.posts[0].search_result; // can't update omitted info in page mode.\r\n            }\r\n          }\r\n          adrawn_idx = 0; // lazy filter.\r\n        },\r\n        hide_posts_without_images: function(th,name){\r\n          var posts = threads[name][16].posts;\r\n          for (var i=0;i<posts.length;i++) {\r\n            var tn_imgs = th.parse_funcs_html.tn_imgs(th.posts[i]); // for test\r\n            if (tn_imgs.length===0) posts[i].pn.style.display = 'none';\r\n          }\r\n        },\r\n        update_draw: function(name){\r\n          if (embed_mode!=='catalog' && pref[embed_mode].mark_new_posts && (threads[name][19][0]&0x000c0000)) {// draw only\r\n            var mark_time = get_mark_time(name,pref.catalog.filter.time_watch || pref.catalog.filter.time_watch_creation,true,true);\r\n            if (mark_time===0 && embed_mode==='thread') mark_time = site2['DEFAULT'].check_reply.get_checked_time(threads[name][19]);\r\n            site2[threads[name][16].domain_html].mark_newer_posts(threads[name][0], mark_time);\r\n          }\r\n        },\r\n        update: function(name){ // draw and ERASE.\r\n          var date = (pref[embed_mode].mark_new_posts && (threads[name][19][0]&0x000c0000))? get_mark_time(name, true, true, true) : 0;\r\n          if (date===0) date = Infinity; // to erase mark\r\n          if (threads[name][0]) site2[threads[name][16].domain_html].mark_newer_posts(threads[name][0], date);\r\n        },\r\n        time_filter_changed: function(){ // draw and ERASE.\r\n          if (embed_mode!=='catalog') for (var name in threads) this.update(name);\r\n        },\r\n      }\r\n      cataLog.format_html = format_html;\r\n\r\n      function get_watch_time_of_a_thread(name, time_created, time_posted, extra_format){\r\n        var ret_time = get_mark_time(name,pref.catalog.filter.time_watch || pref.catalog.filter.time_watch_creation,true,true, extra_format);\r\n        return (extra_format && ret_time<0)? -ret_time :\r\n               (time_posted && ret_time>time_posted)? 0 :\r\n               (!pref.catalog.filter.time_watch && pref.catalog.filter.time_watch_creation && ret_time>time_created)? 0 :\r\n               ret_time;\r\n      }\r\n      cataLog.get_watch_time_of_a_thread = get_watch_time_of_a_thread;\r\n\r\n      function func_in(e){pop_up_delay(e,this.name);triage.thread_in(e);}\r\n      function func_pop_up(e){pop_up_delay(e,this.name);}\r\n      function prep_footer3(th){\r\n//if (domain!=='KC') { // temporal\r\n//if (domain==='8chan') { // temporal\r\n//      th.footer.setAttribute('name',pref.script_prefix+'_footer');\r\n//        if (pref.catalog_footer_show_board_name) {\r\n////          footer.innerHTML = '<span name=\"'+pref.script_prefix+'_footer\">' + footer.innerHTML +'</span>' + '&emsp;' + board;\r\n//          footer.innerHTML = '<span>' + footer.innerHTML + '</span>' + '&emsp;' + board;\r\n//          footer = footer.childNodes[0];\r\n//        }\r\n        var footer = th.footer;\r\n        footer.classList.add(pref.script_prefix+'_footer');\r\n        th.parse_funcs_html.footer_clear(th);\r\n        var str = footer.innerHTML.replace(/ *R:[0-9 \\/]*I:[0-9 \\/]*/,'');\r\n        str = str.replace(/P:[0-9 \\/]*/,'');\r\n        str = str.replace(/ *\\(sticky\\) */,'');\r\n        if (str!=='') {\r\n          footer.innerHTML = '<span>' + footer.innerHTML.substr(0,str.length) + '</span>' + str;\r\n          footer = footer.childNodes[0];\r\n        }\r\n        if (pref[embed_mode].footer.br) {\r\n          var footer_style = footer.getAttribute('style');\r\n          footer_style = ((footer_style)? footer_style + ';' : '') + 'clear:both';\r\n          footer.setAttribute('style',footer_style);\r\n        }\r\n        return [footer, th.flags];\r\n//} else return null;\r\n      }\r\n      function insert_footer3(name,flags,page,tags, th){\r\n        var lth = liveTag.mems.getFromName(name);\r\n        var footer = threads[name][24];\r\n//        var nums   = threads[name][19];\r\n        var nums2  = threads[name][8];\r\nif (footer) { // temporal\r\n//        if (page===undefined || page===null || (page==='?' && footer[2])) page = footer[2];\r\n        if (!page) page = footer[2] || '?';\r\n        var str_nr = ((pref.catalog_footer_show_nof_rep_to_me)? lth.nrtm +'/' : '' ) + lth.nr;\r\n        var str_nl = (pref.catalog.footer.nl && lth.ta && lth.ta.posts)? lth.ta.posts.length+'/' : '';\r\n        var str_nd = (pref.catalog.footer.nd && lth.pd)? '+'+lth.pd.length : '';\r\n        var str = ((pref.catalog.footer.archived && lth.archived)? 'A ' : '') +\r\n                  ((pref.catalog_footer_design==='native')?\r\n                    ((pref.catalog_footer_show_nof_rep)? ((lth.watched)? 'U: '+ str_nr + ' / ' : ''):'') + 'R: '+ str_nl+(nums2[2]-1)+str_nd +  ' / I: '+nums2[3] + ((pref.catalog_footer_show_page)? ' / P: '+page : '')\r\n                  : ((pref.catalog_footer_show_nof_rep)? ((lth.watched)? str_nr + '/' : ''):'') + str_nl+nums2[2]+str_nd + '/'+nums2[3]+ ((pref.catalog_footer_show_page)? '/'+page : '')); // trial.\r\n        if (str) str += '&emsp;';\r\n        if (pref.catalog.footer.ctime || pref.catalog.footer.btime || pref.catalog.footer.ptime) {\r\n          var date_string = new RegExp(new Date().toLocaleDateString(),'g');\r\n          if (pref.catalog.footer.ctime) str += new Date(nums2[1]).toLocaleString().replace(date_string,'') + '&emsp;';\r\n          if (pref.catalog.footer.btime && nums2[0]) str += new Date(nums2[0]).toLocaleString().replace(date_string,'') + '&emsp;';\r\n          if (pref.catalog.footer.ptime && nums2[4]) str += new Date(nums2[4]).toLocaleString().replace(date_string,'') + '&emsp;';\r\n        }\r\n        if (pref.catalog.footer.prate) str += Math.floor(nums2[2]/((Date.now() - nums2[1])/86400000)) + '&emsp;';\r\n        if (pref.catalog_footer_show_board_name || pref.catalog_footer_show_thread_no || pref.catalog_footer_show_site_name) {\r\n          var dbt = common_func.name2domainboardthread(name,true);\r\n          str += ((pref.catalog_footer_show_site_name)? dbt[0] : '')+\r\n                 ((pref.catalog_footer_show_board_name)? dbt[1] : '')+\r\n                 ((pref.catalog_footer_show_thread_no)? dbt[2] : '');\r\n        }\r\n        footer[2] = page;\r\n\r\n//        if (pref.catalog_footer_show_tag) { // working code.\r\n//          var str_tags;\r\n//          if (tags) {\r\n//            var tags_count = tags[0][0].length;\r\n//            str_tags = tags[0][2];\r\n//            var i=0; \r\n//            while (tags_count<pref.liveTag.max && i<tags[1][0].length) {\r\n//              if (tags[0][1][tags[1][0][i]]===undefined) {\r\n//                str_tags += tags[1][0][i] + ', ';\r\n//                tags_count++;\r\n//              }\r\n//              i++;\r\n//            }\r\n//            footer[3] = str_tags;\r\n//          } else str_tags = footer[3] || '';\r\n//          str += str_tags;\r\n//        }\r\n\r\n        footer[0].innerHTML = (pref.catalog_footer)? str : '';\r\n\r\n        if (pref.catalog_footer && pref.catalog_footer_show_tag) {\r\n          if (!footer[3]) {\r\n            footer[3] = document.createElement('span');\r\n            footer[3].innerHTML = '<span></span><span></span>';\r\n          }\r\n          if (tags) {\r\n            for (var i=0;i<2;i++) {\r\n              var pn = liveTag.update_tag_string(tags[i], ', ', liveTag.tag_node_onclick);\r\n              footer[3].removeChild(footer[3].childNodes[i]);\r\n              footer[3].insertBefore(pn,footer[3].childNodes[i] || null);\r\n            }\r\n          }\r\n//          if (tags) { // working code.\r\n//            for (var i=0;i<2;i++) {\r\n//              if (!tags[i][2] || force_update) {\r\n//                var pn = liveTag.update_tag_string(tags[i][0], ', ', liveTag.tag_node_onclick);\r\n//                tags[i][2] = true;\r\n//                footer[3].removeChild(footer[3].childNodes[i]);\r\n//                footer[3].insertBefore(pn,footer[3].childNodes[i] || null);\r\n//              }\r\n//            }\r\n//          }\r\n          if (footer[3].parentNode!==footer[0]) footer[0].appendChild(footer[3]);\r\n        }\r\n\r\n        if (pref.catalog_footer_show_flag && (flags || footer[1]) && pref.catalog_footer && pref[embed_mode].t2h_num_of_posts>=0) {\r\n          if (!flags) flags = footer[1];\r\n          var i = flags.length - pref[embed_mode].t2h_num_of_posts;\r\n          if (i<1) i=1;\r\n          if (flags[0]) footer[0].appendChild(flags[0]);\r\n          while (i<flags.length) {\r\n            if (flags[i]) footer[0].appendChild(flags[i]);\r\n            i++;\r\n          }\r\n////////          if (th && site.nickname!==th.domain) site2[th.domain].absolute_link(footer[0], th.board); // patch\r\n          footer[1] = flags;\r\n        }\r\n}\r\n      }\r\n      cataLog.insert_footer3 = insert_footer3;\r\n////      function footer3_click_tag_entry(e){\r\n////        footer3_click_tag(this.textContent, true);\r\n////      }\r\n//////      function footer3_click_tag(tag, from_tag){ // working code.\r\n////////        var tag = this.textContent;\r\n//////        footer3_click_tag_sub(tag, from_tag);\r\n////////        liveTag.tag_in_thread_onclick(this,e);\r\n////////        for (var name in liveTag.tags[tag].mems) {\r\n////////          var dbt = common_func.name2domainboardthread(name,true);\r\n////////          var tgt = liveTag.mems[dbt[0]][dbt[1]][dbt[2]];\r\n////////          if (tgt[0][0].indexOf(tag)!=-1) tgt[0][2] = false;\r\n////////          else tgt[1][2] = false;\r\n////////          if (threads[name]) insert_footer3(name,undefined,undefined,threads[name][17]);\r\n////////        }\r\n////////        if (pref.liveTag.ci) if (liveTag.tags[tag].ci) for (var tag in liveTag.tags[tag].ci) footer3_click_tag_sub(tag); // can't track.\r\n//////        if (pref.liveTag.ci) {\r\n//////          var tag_l = tag.toLowerCase();\r\n//////          for (var i in liveTag.tags) if (tag!==i && tag_l===liveTag.tags[i].key.toLowerCase()) footer3_click_tag_sub(i, from_tag);\r\n//////        }\r\n//////      }\r\n////      function footer3_click_tag(tag, from_tag){\r\n////        for (var i in liveTag.tags[tag].tgts) footer3_click_tag_sub(i, from_tag);\r\n////      }\r\n////      function footer3_click_tag_sub(tag, from_tag){\r\n////        if (from_tag) liveTag.tag_in_thread_onclick(tag);\r\n////        for (var name in liveTag.tags[tag].mems) {\r\n////          var dbt = common_func.name2domainboardthread(name,true);\r\n////          var tgt = liveTag.mems[dbt[0]][dbt[1]][dbt[2]];\r\n////          if (tgt[0][0].indexOf(tag)!=-1) tgt[0][2] = false;\r\n////          else tgt[1][2] = false;\r\n////          if (threads[name]) insert_footer3(name,undefined,undefined,threads[name][17]);\r\n////        }\r\n////      }\r\n      function update_all_footers(){\r\n        for (var name in threads) insert_footer3(name);\r\n      }\r\n\r\n      function re_sort_thread(){\r\n        var odl = [];\r\n        for (var i=0;i<threads_idx.length;i++) if (threads_idx[i].substr(0,4)==='ODL:') odl[odl.length] = threads_idx[i];\r\n        threads_idx=[];\r\n        for (var i in threads) threads_index.insert(i);\r\n        for (var i=0;i<odl.length;i++) threads_idx[threads_idx.length] = odl[i];\r\n        drawn_idx = 0;\r\n        show_catalog();\r\n      }\r\n//      function reorder_threads_idx(names){\r\n//        for (var i in names) reorder_thread_idx(i);\r\n//      }\r\n////      function reorder_thread_idx(name, skip_check){ // working code.\r\n//////        for (var i=0;i<threads_idx.length;i++) if (threads_idx[i]==name) {threads_idx.splice(i,1);break;}\r\n//////        insert_thread_idx(name);\r\n////        var i;\r\n////        if (!skip_check) {\r\n////          i = 0;\r\n////          while (i<threads_idx.length && threads_idx[i]!==name) i++;\r\n////          if (i<threads_idx.length) threads_idx.splice(i,1);\r\n////        } else i = -1;\r\n////        return (i!=insert_thread_idx(name) || (threads[name] && threads[name][9][0]!=threads[name][1])); // returns need to redraw.\r\n////      }\r\n\r\n////      function raise_threads_idx_odl(db,key){ // works, but blocked by stikies.\r\n////        var idx = threads_idx.indexOf(key);\r\n////        if (idx!=-1) {\r\n////          var kwd_odldb = 'ODL:'+db;\r\n////          for (var i=idx+1;i<threads_idx.length;i++)\r\n////            if (threads_idx[i].indexOf(kwd_odldb)===0) {\r\n////              if (i!=idx+1) threads_idx.splice(idx+1,0,threads_idx.splice(i,1)[0]);\r\n////              break;\r\n////            }\r\n////        }\r\n////      }\r\n////      function raise_threads_idx_odl(db){ // working, but blinks when there are 'watched and first' threads. (stickies can't be sticky)\r\n////        for (var i=threads_idx.length-1;i>=0;i--)\r\n////          if (threads_idx[i].indexOf(db)===0) {\r\n////            if (i<threads_idx.length-2) {\r\n////              var kwd_odldb = 'ODL:'+db;\r\n////              for (var j=i+1;j<threads_idx.length;j++)\r\n////                if (threads_idx[j].indexOf(kwd_odldb)===0) {\r\n////                  if (j!=i+1) threads_idx.splice(i+1,0,threads_idx.splice(j,1)[0]);\r\n////                  break;\r\n////                }\r\n////            }\r\n////            break;\r\n////          }\r\n////      }\r\n      function reorder_thread_idx(name){\r\n        var idx_old = threads_idx.indexOf(name);\r\n        if (idx_old!=-1) threads_idx.splice(idx_old,1);\r\n        var idx_new = threads_index.insert(name);\r\n        if ((idx_new !== idx_old || embed_mode==='page') && (idx_new < drawn_idx || idx_old < drawn_idx)) drawn_idx = 0;\r\n//        if (idx_new !== idx_old && (idx_new < drawn_idx || idx_old < drawn_idx)) drawn_idx = 0; // BUG. doesn't redraw if its size is changed.\r\n        return (idx_new !==idx_old || (threads[name] && threads[name][9][0]!=threads[name][1])); // returns need to redraw.\r\n      }\r\n\r\n      var threads_index = (function(){\r\n        var threads_odl = {};\r\n//        var threads_odl_default = { '8': [0, undefined, undefined, undefined, undefined], // disable 'on demand mode' at indexing of 1,2,3\r\n        var threads_odl_default = { '8': [0, 0, 0, 0, 0],\r\n                                   '19': [0,0,0]};\r\n        function get_threads_odl_default(str){\r\n          var page = parseInt(str.substr(str.lastIndexOf('/')+2),10);\r\n          return (page===0)? {'8': [undefined, undefined, undefined, undefined, undefined], __proto__: threads_odl_default} : // force to top\r\n                             {'8': [-page, -page, -page, -page, -page], __proto__: threads_odl_default};  // force to last\r\n        }\r\n        var start,end, indexing;\r\n        var kwd_odl = 'ODL:';\r\n        var check_funcs = {\r\n          reply_to_me: function(tgt_th){return (tgt_th[19][0]&0x000c0000) && (tgt_th[19][1]>>16)!=0;},\r\n          reply: function(tgt_th){return (tgt_th[19][0]&0x000c0000) && tgt_th[19][1]!=0;},\r\n          watch_first: function(tgt_th){return tgt_th[19][0]&0x000c0000;},\r\n          watch_last: function(tgt_th){return !(tgt_th[19][0]&0x000c0000);},\r\n          sticky_first: function(tgt_th){return tgt_th[20];},\r\n          sticky_last: function(tgt_th){return !tgt_th[20];},\r\n        }\r\n        function get_tgt_th(str){\r\n          return (str.indexOf(kwd_odl)===0)? (threads_odl[str] || get_threads_odl_default(str)) :\r\n                                             threads[str];\r\n        }\r\n        function check_sub(myself, check_func){\r\n          var ref = start;\r\n          while (ref<end && check_func(get_tgt_th(threads_idx[ref]))) ref++;\r\n          if (check_func(myself)) end = ref;\r\n          else start = ref;\r\n        }\r\n        function insert(name){\r\n          start = 0;\r\n          end = threads_idx.length;\r\n          var myself = get_tgt_th(name);\r\n          if (pref.catalog.order.reply_to_me) check_sub(myself, check_funcs.reply_to_me);\r\n          if (pref.catalog.order.reply) check_sub(myself, check_funcs.reply);\r\n          if (pref.catalog.order.watch!=='dont_care') check_sub(myself, (pref.catalog.order.watch==='last')? check_funcs.watch_last : check_funcs.watch_first);\r\n          if (pref.catalog.order.sticky!=='dont_care') check_sub(myself, (pref.catalog.order.sticky==='last')? check_funcs.sticky_last : check_funcs.sticky_first);\r\n          var indexing  = pref.catalog.indexing%6;\r\n          var indexing2 = pref.catalog.indexing;\r\n          var get_date = (indexing===0 || indexing===4)? function(tgt_th){return tgt_th[8][indexing] || tgt_th[8][(indexing===0)?4:0];} :\r\n                         (indexing===5)?                 (function(){var now = Date.now(); return function(tgt_th){return (now - tgt_th[8][1])/tgt_th[8][2];}})() :\r\n                                                         function(tgt_th){return tgt_th[8][indexing];};\r\n          var date = get_date(myself);\r\n          var check_func = (indexing2>=5 && indexing2<11)? function(tgt_th){return date>=get_date(tgt_th);} :\r\n                                                           function(tgt_th){return date<=get_date(tgt_th);};\r\n          var ref = start;\r\n          while (ref<end && check_func(get_tgt_th(threads_idx[ref]))) ref++;\r\n  \r\n          if (ref==threads_idx.length) threads_idx[threads_idx.length] = name;\r\n          else threads_idx.splice(ref,0,name);\r\n  //        if (ref<=drawn_idx) drawn_idx = 0; // can't track by 'drawn_idx = ref; drawn_y = 0;'. drawn_xxx must be synchronized.\r\n          return ref;\r\n        }\r\n        function raise_odl(th){\r\n          var indexing = pref.catalog.indexing;\r\n          var i = threads_idx.indexOf(th.key);\r\n          if (i!=-1) {\r\n            var kwd_odldb = 'ODL:'+ th.domain + th.board;\r\n            while (++i<threads_idx.length) {\r\n              if (threads_idx[i].indexOf(kwd_odldb)===0) {\r\n                threads_odl[threads_idx[i]] = {'8':[ (th.time_posted || th.time_bumped), th.time_created, th.nof_posts, th.nof_files, (th.time_bumped || th.time_posted) ],\r\n                                               __proto__:threads_odl_default};\r\n                insert(threads_idx.splice(i,1)[0]);\r\n                break;\r\n          }}}\r\n        }\r\n        function delete_odl(keys){\r\n          for (var i=0;i<keys.length;i++) delete threads_odl[kwd_odl+keys[i]];\r\n        } \r\n        function insert_odl(name){\r\n          delete threads_odl[kwd_odl+name];\r\n          reorder_thread_idx(kwd_odl+name);\r\n        }\r\n        return {\r\n          insert: insert,\r\n          raise_odl: raise_odl,\r\n          delete_odl: delete_odl,\r\n          insert_odl: insert_odl,\r\n//          clear: clear, // NEED TO BE IMPLEMENTED to clear 'threads_odl' to prevent memory from leaking.\r\n        }\r\n      })();\r\n////////      function insert_thread_idx(name){ // working code.\r\n////////        var indexing = pref.catalog.indexing;\r\n////////        var ref=0;\r\n////////        var end = threads_idx.length;\r\n////////        var dbt = common_func.fullname2dbt(name);\r\n////////        var kwd_odl   = 'ODL:';\r\n////////        var kwd_odldb = kwd_odl+dbt[0]+dbt[1];\r\n////////        var check_func;\r\n////////        function skip_odl_th(ref){\r\n////////          var str = threads_idx[ref];\r\n////////          if (str.indexOf(kwd_odl)===0) return str.indexOf(kwd_odldb)!==0;\r\n////////          else return check_func(threads[str]);\r\n////////        }\r\n//////////console.log(name+', S: '+threads[name][19][1]+'/'+(threads[name][8][2]-threads[name][19][2])+', '+threads[name][8][2]+', '+threads[name][8][3]);\r\n////////        if (pref.catalog.order.reply_to_me) {\r\n////////          check_func = function(tgt_th){return tgt_th[19][0]!==0 && tgt_th[19][1]!=0;};\r\n////////          while (ref<end && skip_odl_th(ref)) ref++;\r\n////////          if (threads[name][19][0]!==0 && threads[name][19][1]!=0) {end=ref;ref=0;}\r\n//////////console.log(name+', M: '+ref+'/'+end+', '+threads[name][19][1]);\r\n////////        }\r\n////////        if (pref.catalog.order.reply) {\r\n////////          var ref2 = ref;\r\n//////////          while (ref2<end && threads_idx[ref2].substr(0,4)!=='ODL:' && threads[threads_idx[ref2]][19][2]!=threads[threads_idx[ref2]][8][2]) ref2++;\r\n//////////          while (ref2<end && threads_idx[ref2].substr(0,4)!=='ODL:' && threads[threads_idx[ref2]][19][2]!=0 && threads[threads_idx[ref2]][19][2]!=threads[threads_idx[ref2]][8][2]) ref2++;\r\n//////////          if (threads[name][19][2]!=0 && threads[name][19][2]!=threads[name][8][2]) end = ref2;\r\n////////          check_func = function(tgt_th){return tgt_th[19][0]!==0 && tgt_th[19][2]>0;};\r\n////////          while (ref2<end && skip_odl_th(ref2)) ref2++;\r\n////////          if (threads[name][19][0]!==0 && threads[name][19][2]>0) end = ref2;\r\n////////          else ref = ref2;\r\n//////////console.log(name+', N: '+ref+'/'+end+', '+(threads[name][8][2]-threads[name][19][2]));\r\n////////        }\r\n//////////        if (pref.catalog.order.watch) { // working code.\r\n//////////          var ref2 = ref;\r\n//////////          while (ref2<end && threads_idx[ref2].substr(0,4)!=='ODL:' && threads[threads_idx[ref2]][19][0]!==0) ref2++;\r\n//////////          if (threads[name][19][0]!==0) end = ref2;\r\n////////////          while (ref2<end && threads_idx[ref2].substr(0,4)!=='ODL:' && threads[threads_idx[ref2]][19][2]!=0) ref2++;\r\n////////////          if (threads[name][19][2]!=0) end = ref2;\r\n//////////          else ref = ref2;\r\n////////////console.log(name+', R: '+ref+'/'+end);\r\n//////////        }\r\n////////        if (pref.catalog.order.watch!=='dont_care') { // working code.\r\n////////          var polarity = (pref.catalog.order.watch==='last');\r\n////////          var ref2 = ref;\r\n////////          check_func = function(tgt_th){return polarity ^ tgt_th[19][0]!==0;};\r\n////////          while (ref2<end && skip_odl_th(ref2)) ref2++;\r\n////////          if (polarity ^ threads[name][19][0]!==0) end = ref2;\r\n////////          else ref = ref2;\r\n//////////console.log(name+', R: '+ref+'/'+end);\r\n////////        }\r\n////////        if (pref.catalog.order.sticky!=='dont_care') {\r\n////////          var polarity = (pref.catalog.order.sticky==='last');\r\n////////          var ref2 = ref;\r\n////////          check_func = function(tgt_th){return polarity ^ tgt_th[20];};\r\n////////          while (ref2<end && skip_odl_th(ref2)) ref2++;\r\n////////          if (polarity ^ threads[name][20]) end = ref2;\r\n////////          else ref = ref2;\r\n//////////console.log(name+', T: '+ref+'/'+end);\r\n////////        }\r\n////////        var date = threads[name][8][indexing] || threads[name][8][(indexing===0)?4:0];\r\n////////        check_func = function(tgt_th){return date<=(tgt_th[8][indexing] || tgt_th[8][(indexing===0)?4:0]);};\r\n////////        while (ref<end && skip_odl_th(ref)) ref++;\r\n////////        if (ref==threads_idx.length) threads_idx[threads_idx.length] = name;\r\n////////        else threads_idx.splice(ref,0,name);\r\n//////////console.log(name+', F: '+ref+'/'+end+', '+threads_idx.length);\r\n//////////        if (ref<=drawn_idx) drawn_idx = 0; // can't track by 'drawn_idx = ref; drawn_y = 0;'. drawn_xxx must be synchronized.\r\n////////        return ref;\r\n////////      }\r\n\r\n      function expand_shrink_thread(name){\r\n        if (threads[name][0].style.width=='') {\r\n          if (pref.catalog_expand_with_hr && embed_mode!=='catalog') show_catalog_hr(name,'shrink');\r\n          threads[name][0].style.width = pref.catalog_size_width + 'px';\r\n          threads[name][0].style.height = pref.catalog_size_height + 'px';\r\n        } else {\r\n          threads[name][0].style.width = '';\r\n          threads[name][0].style.height = '';\r\n          if (pref.catalog_expand_with_hr && embed_mode!=='catalog') show_catalog_hr(name,'add');\r\n        }\r\n      }\r\n\r\n      var image_hover_instance = null;\r\n      var image_prefetched_instance = null;\r\n      var image_expand_on_demand_instance = null;\r\n      var image_expanding = [];\r\n      function image_hover_prep(img,src){\r\n        var img_ex = clone_img(img, 'hover',null,src);\r\n        if (!img_ex) return;\r\n        img_ex.style.position = 'fixed';\r\n        img_ex.style.top = '0px';\r\n        img_ex.style.right = '0px';\r\n        img_ex.style.pointerEvents = 'none';\r\n//        if (pref.test_mode['69']) archiver.test_dl(img_ex.src);\r\n        return img_ex;\r\n      }\r\n      function image_hover_add(e,src){\r\n        if (pref[embed_mode].image_hover) {\r\n          var divert = image_prefetched_instance && image_prefetched_instance[1]===this;\r\n          var img_ex;\r\n          if (divert) {\r\n            img_ex = image_prefetched_instance[0];\r\n            img_ex.style.display = '';\r\n            image_prefetched_instance = null;\r\n          } else {\r\n            img_ex = image_hover_prep(this,src);\r\n            if (!img_ex) return;\r\n          }\r\n          img_ex.style.zIndex = pref[embed_mode].image_hover_zIndex;\r\n          this.onmouseout = image_hover_remove;\r\n          if (!divert) site.script_body.appendChild(img_ex);\r\n          e.preventDefault();\r\n          scan_boards.priority_up(8);\r\n          img_ex.onload  = scan_boards.priority_release;\r\n          img_ex.onerror = scan_boards.priority_release;\r\n          if (image_hover_instance) image_hover_remove();\r\n          image_hover_instance = img_ex;\r\n        }\r\n        if (image_prefetched_instance) {\r\n          image_prefetched_instance[0].parentNode.removeChild(image_prefetched_instance[0]);\r\n          image_prefetched_instance = null;\r\n        }\r\n        if (pref[embed_mode].image_prefetch) {\r\n          var name = get_name_recursive(this);\r\n          var img_next = site2[site.nickname].get_next_image(this);\r\n          if (img_next) {\r\n            var img_pf = image_hover_prep(img_next);\r\n            img_pf.style.display = 'none';\r\n            site.script_body.appendChild(img_pf);\r\n            image_prefetched_instance = [img_pf,img_next];\r\n          }\r\n        }\r\n//        if (pref[embed_mode].image_hover) { // working code.\r\n//          var img_ex = clone_img(this);\r\n//          img_ex.style.position = 'fixed';\r\n//          img_ex.style.top = '0px';\r\n//          img_ex.style.right = '0px';\r\n//          img_ex.style.pointerEvents = 'none';\r\n//          img_ex.style.zIndex = 101;\r\n//          this.onmouseout = image_hover_remove;\r\n//          site.script_body.appendChild(img_ex);\r\n//          e.preventDefault();\r\n//          scan_boards.priority_up(8);\r\n//          img_ex.onload  = scan_boards.priority_release;\r\n//          img_ex.onerror = scan_boards.priority_release;\r\n//          if (image_hover_instance) image_hover_remove();\r\n//          image_hover_instance = img_ex;\r\n//        }\r\n          \r\n      }\r\n      cataLog.image_hover_add = image_hover_add;\r\n      function image_hover_remove(){\r\n        if (image_hover_instance) site.script_body.removeChild(image_hover_instance);\r\n        image_hover_instance = null;\r\n      }\r\n      function image_hover_reentry(img){\r\n        if (image_hover_instance && image_hover_instance.src===img.src) image_hover_instance.src = clone_img_make_src(img);\r\n      }\r\n      cataLog.image_hover_reentry = image_hover_reentry;\r\n      function clone_img_make_src(img, inline_or_hover, from_initial){\r\n        var name = get_name_recursive(img);\r\n        if (!from_initial && pref[embed_mode].env.event_dynamic && inline_or_hover!==undefined &&\r\n          ((inline_or_hover==='inline')? pref[embed_mode].env.expand_thumbnail_inline_native : pref[embed_mode].env.image_hover_native)) return;\r\n//        &&  common_func.fullname2dbt(name)[0]===site.nickname) return;\r\n        if (!name) return img.src; // patch for expand all at initial in 4chan, BUT I DON'T KNOW WHY...\r\n        var tgt_th16 = threads[name][16];\r\n////      var src = ((tgt_th16.type_html==='catalog')? tgt_th16.op_img_src_url : img.parentNode.href) || pn.src;\r\n//        return ((tgt_th16.type_html==='catalog')? // working code\r\n//          site2[tgt_th16.domain_html].parse_funcs.catalog_html.img2src && site2[tgt_th16.domain_html].parse_funcs.catalog_html.img2src(img) :\r\n//          site2[tgt_th16.domain_html].parse_funcs.post_html.img2src(img)) || img.src;\r\n        if (embed_mode!=='catalog') return site2[tgt_th16.domain_html].parse_funcs.post_html.img2src(img) || img.src;\r\n        else {\r\n          var lth = liveTag.mems.getFromName(name);\r\n          return site2[lth.domain].parse_funcs[lth.th.type_parse].get_op_src(lth.th, img);\r\n        }\r\n      }\r\n      function clone_img(img, inline_or_hover, from_initial, src){\r\n        var pn = img.cloneNode();\r\n//        pn.src = (embed_mode==='page')? img.parentNode.href : pn.src; // TEMPORARILY!!!\r\n        if (!src) src = clone_img_make_src(img, inline_or_hover, from_initial);\r\n        if (!src) return; // return when native dynamic function works.\r\n        var ext = (src.search(/^blob/)===0)? site2['DEFAULT'].parse_funcs.post_html.img2ext(img) : '';\r\n        if (src.substr(-5,5)==='.webm' || ext==='.webm' || img.getAttribute('data-ext')==='.webm') {\r\n          if (pref[embed_mode].thumbnail[inline_or_hover].webm && !from_initial) {\r\n            if (image_hover_instance && image_hover_instance.src===src) {\r\n              pn = image_hover_instance;\r\n              image_hover_instance = null;\r\n              pn.style.position = '';\r\n              pn.style.top = '';\r\n              pn.style.right = '';\r\n              pn.style.pointerEvents = '';\r\n  //            pn.play();\r\n            } else {\r\n              var pn = document.createElement('video');\r\n              pn.controls = true;\r\n              pn.autoplay = true;\r\n              //  <video controls=\"\" loop=\"\" autoplay=\"\" class=\"expandedWebm\" src=\"xxx.webm\" style=\"max-width: 957px; max-height: 587px;\"></video> // 4chan\r\n            }\r\nif (!pref.test_mode['63']) {\r\n            pn.loop  = pref[embed_mode].thumbnail[inline_or_hover].webm_loop;\r\n            pn.muted = pref[embed_mode].thumbnail[inline_or_hover].webm_mute;\r\n}\r\n          } else return null;\r\n        }\r\n        pn.src = src;\r\n        pn.style.width = 'auto';\r\n        pn.style.height = 'auto';\r\n        if (pref[embed_mode].thumbnail[inline_or_hover].limit_width)  pn.style.maxWidth  = (window.innerWidth  - pref[embed_mode].thumbnail[inline_or_hover].margin_width)  + 'px';\r\n        if (pref[embed_mode].thumbnail[inline_or_hover].limit_height) pn.style.maxHeight = (window.innerHeight - pref[embed_mode].thumbnail[inline_or_hover].margin_height) + 'px';\r\n        return pn;\r\n      }\r\n      function expand_thumbnail_inline(e, from_initial){\r\n        if (pref[embed_mode].expand_thumbnail_inline && image_expanding.indexOf(this)==-1) {\r\n          var img_ex = clone_img(this, 'inline', from_initial);\r\n          if (!img_ex) {expand_thumbnail_on_demand_set.call(this);return;}\r\n//          if (!img_ex) return;\r\n          if (img_ex.tagName!=='VIDEO') {\r\n            img_ex.style.display = 'none';\r\n            img_ex.addEventListener('load',expand_thumbnail_inline_load, false);\r\n            this.style.opacity = 0.5;\r\n          }\r\n          this.parentNode.insertBefore(img_ex,this.nextSibling);\r\n//          this.onclick = null; // can't track event accurately because 'on demand expand' mode adds click event to images which have a native expansion event.\r\n          image_expanding.push(img_ex);\r\n          \r\n          if (e) e.preventDefault();\r\n          if (img_ex.tagName==='VIDEO') {\r\n            expand_thumbnail_inline_load.call(img_ex);\r\n            img_ex.play(); // may be diverted from image_hover\r\n          }\r\n        }\r\n      }\r\n      function expand_thumbnail_inline_load(){\r\n        this.previousSibling.style.display = 'none';\r\n        this.style.display = '';\r\n        this.previousSibling.style.opacity = '';\r\n        this.removeEventListener('load',expand_thumbnail_inline_load, false);\r\n        this.onclick = shrink_thumbnail_inline;\r\n        if (site2[site.nickname].format_expanded_thumbnail) site2[site.nickname].format_expanded_thumbnail(this);\r\n        var idx = image_expanding.indexOf(this);\r\n        if (idx>=0) image_expanding.splice(idx,1);\r\n\r\n        if (site.patch.expand_thumbnail_inline_load) site.patch.expand_thumbnail_inline_load.call(this);\r\n        expand_thumbnail_on_demand_set.call(this);\r\n      }\r\n      function expand_thumbnail_on_demand_set(){\r\n        if (pref[embed_mode].expand_thumbnail_inline && (pref[embed_mode].expand_thumbnail_initial || pref[embed_mode].expand_thumbnail_inline_all_after)) {\r\n          var img_next = site2[site.nickname].get_next_image(this,get_now_height()); // now_height for jump scroll\r\n          if (img_next && img_next.style.display!=='none') expand_thumbnail_on_demand(img_next);\r\n        }\r\n      }\r\n      function expand_thumbnail_on_demand(img){\r\n        var ref_height = get_ref_height(pref[embed_mode].thumbnail.inline.ref_height/100);\r\n        var offsetTop;\r\n        if (Array.isArray(img)) {\r\n          var tgt;\r\n          var nowHeight = get_now_height();\r\n          for (var i=0;i<img.length;i++) {\r\n            var ot = img[i].offsetTop;\r\n            if (ot>=nowHeight && ot<offsetTop || i===0) {\r\n              tgt = img[i];\r\n              offsetTop = ot;\r\n            }\r\n          }\r\n          img = tgt;\r\n        } else offsetTop = img.offsetTop;\r\n        if (offsetTop<ref_height || !pref[embed_mode].thumbnail.inline.ondemand) {\r\n          image_expand_on_demand_instance = null;\r\n          expand_thumbnail_inline.call(img, null, true);\r\n        } else image_expand_on_demand_instance = img;\r\n      }\r\n      function expand_thumbnail_queue_add(img){\r\n        if (!image_expand_on_demand_instance) image_expand_on_demand_instance = img;\r\n        else if (Array.isArray(image_expand_on_demand_instance)) image_expand_on_demand_instance[image_expand_on_demand_instance.length] = img;\r\n        else image_expand_on_demand_instance = [image_expand_on_demand_instance, img];\r\n        show_catalog_cont(); // patch, delayed 200ms\r\n      }\r\n      function shrink_thumbnail_inline(e){\r\n//        this.previousSibling.onclick = expand_thumbnail_inline;\r\n        this.previousSibling.style.display = '';\r\n        e.preventDefault();\r\n        \r\n        if (this.getAttribute('data-originalWidth')) {\r\n          var pnode = this.parentNode.parentNode;\r\n          pnode.style.width = this.getAttribute('data-originalWidth');\r\n        }\r\n        this.parentNode.removeChild(this);\r\n      }\r\n\r\n      function get_name_recursive(pn){\r\n        while (pn && !pn.name) pn = pn.parentNode;\r\n        return pn && pn.name;\r\n      }\r\n      function click_thread_tn(e){\r\n        if (pref[embed_mode].click==='none') return;\r\n        e.preventDefault();\r\n        if (pref[embed_mode].click_area==='entire') return;\r\n        click_thread(get_name_recursive(this), (this.classList.contains(pref.script_prefix+'_link'))? this.getAttribute('href') : null);\r\n      }\r\n      function click_thread_whole(){\r\n        if (pref[embed_mode].click_area==='entire') click_thread(this.name);\r\n      }\r\n      function click_thread(name, url){\r\n        if (url) open_new_thread((url==='force')? null : url, name);\r\n        else if (pref[embed_mode].click==='open') open_new_thread(null, name);\r\n        else if (threads[name][18]!=='catalog' && pref[embed_mode].click==='expand') expand_shrink_thread(name);\r\n      }\r\n      function click_link(e){\r\n        e.preventDefault();\r\n        if (this.href) open_new_thread(this.href, get_name_recursive(this));\r\n      }\r\n//      function click_thread(name){\r\n//        if (typeof(name)==='object') name= this.name;\r\n//        var name = this.name;\r\n//        if (pref.click=='expand') expand_shrink_thread(name);\r\n//        else open_new_thread(threads[name][7], name);\r\n//      }\r\n\r\n      function add_open_new_thread_event(name,args){\r\n        for (var i=0;i<args.length;i++) {\r\n          var elem = args[i][0];\r\n          var url  = args[i][1];\r\n          var func = function(){open_new_thread(url, name);if (pref[embed_mode].click==='expand') expand_shrink_thread(name);};\r\n          elem.addEventListener('click', func, false);\r\n          args[i][1] = func;\r\n        }\r\n        return args;\r\n      }\r\n      function remove_open_new_thread_event(args){\r\n        for (var i=0;i<args.length;i++) args[i][0].removeEventListener('click', args[i][1], false);\r\n        return null;\r\n      }\r\n      function get_mark_time(name,time,list,watch, extra_format){\r\n        if (watch) {\r\n          var date_mark = pref_func.merge_obj5(name,pref.catalog.filter.watch_list_obj2,{hit:false});\r\n          if ('time' in date_mark) return (extra_format)? -date_mark.time : date_mark.time;\r\n        }\r\n        if (list) {\r\n          date_mark = pref_func.merge_obj5(name,pref.catalog.filter.list_obj2,{hit:false});\r\n          if ('time' in date_mark) return date_mark.time;\r\n          else if (date_mark.hit) return 0;\r\n        }\r\n        if (time && pref.catalog.filter.time_str!=='') return Date.parse(pref.catalog.filter.time_str);\r\n        else return 0;\r\n      }\r\n//      function get_mark_time(name){\r\n//        var date_mark = -1;\r\n////        if (pref.catalog.filter.time_mark) date_mark = Date.parse(pref.catalog.filter.time_mark_str) - pref.localtime_offset*3600000;\r\n//        if (pref.catalog.filter.time_mark) date_mark = Date.parse(pref.catalog.filter.time_str) - pref.localtime_offset*3600000;\r\n//        if (pref.catalog.filter.list_mark_time) {\r\n//          var time_list = catalog_filter_query_time_list(name)[1];\r\n//          if (time_list) date_mark = time_list;\r\n//        }\r\n//        return date_mark;\r\n//      }\r\n      function open_new_thread(url, name){\r\n        if (url===null) {\r\n          var dbt = common_func.fullname2dbt(name);\r\n          url = site2[dbt[0]].make_url4(common_func.name2dbt(name))[0]; // temporal\r\n          if (pref.catalog_open_last50!=='no') {\r\n            var short_link = document.createElement('div');\r\n            short_link.innerHTML = site2[dbt[0]].short_link(name, threads[name][8][2], null, '', '');\r\n            var as = short_link.getElementsByTagName('a');\r\n            for (var i=0;i<as.length;i++) {\r\n              if (pref.catalog_open_last50==='exist' || !(threads[name][19][0]&0x000c0000) || (parseInt(as[i].textContent,10)>(threads[name][19][1]&0x0000ffff))) {\r\n                url = as[i].getAttribute('href');\r\n                break;\r\n        }}}}\r\n//////////        if (url===null) url = site2[threads[name][16].dbt[0]].make_url3(threads[name][16].dbt[1], threads[name][16].dbt[2], '0'); // temporal // working code.\r\n////////        if (url===null) url = site2[threads[name][16].dbt[0]].make_url4(common_func.name2dbt(name))[0]; // temporal\r\n////////        if (typeof(url)==='string') url = [url];\r\n////////        var idx = 0;\r\n////////        var unread50 = (threads[name][19][0]!==0 && threads[name][19][2]<=50);\r\n////////        if      (pref.catalog_open_last50==='no')    idx = 0;\r\n////////        else if (pref.catalog_open_last50==='exist') idx = url.length-1;\r\n////////        else if (pref.catalog_open_last50==='exist_watch') idx = (unread50)? url.length-1 : 0;\r\n////////        else {\r\n////////          var dbt = common_func.fullname2dbt(name); // patch\r\n////////if (dbt[0]==='8chan' || dbt[0]==='lain') { // patch.\r\n////////          if (url.length==1 && threads[name][8][2]>100) url[1] = url[0].replace(/.html/,'+50.html');\r\n////////          if (pref.catalog_open_last50==='speculative') idx = (threads[name][8][2]>100)? url.length-1 : 0;\r\n////////          else if (pref.catalog_open_last50==='spec_watch') idx = (unread50)? url.length-1 : 0;\r\n////////}\r\n////////        }\r\n////////        url = url[idx];\r\n\r\n//console.log(url);\r\n//        var cw = window.open(url,(pref.catalog_open_in_new_tab)? '_blank' : '_self');\r\n        var window_name = (site.embed_frame_win)? site.embed_frame\r\n                        : (pref.catalog_open_where==='named')? name\r\n                        : (pref.catalog_open_where==='_blank')? name + '_' + Date.now() : pref.catalog_open_where;\r\n//                        : (pref.catalog_open_in_new_tab)? ((pref.catalog_use_named_window)? name : '_blank') : '_self';\r\n        var cw = window.open(url,window_name);\r\n        var time_marked = (pref[embed_mode].mark_new_posts)? get_watch_time_of_a_thread(name,threads[name][8][1]) : 0;\r\n        send_message(window_name, [['MARK',time_marked]],cw);\r\n        if (pref.catalog.auto_watch) triage_exe_0(name,'WATCH','',true);\r\n      }\r\n      function mark_read_thread(name,read){\r\n        if (read) site2['DEFAULT'].check_reply.set_watched_to_last(threads[name][19], (threads[name][8][4]||threads[name][8][0]), name);\r\n        else site2['DEFAULT'].check_reply.set_unwatch(threads[name][19]);\r\n        if (pref.liveTag.style) liveTag.update_ur(name,0,true);\r\n//        site2[cnst.name2domainboardthread(name,true)[0]].insert_footer2(threads[name][0],threads[name][18],threads[name][19],threads[name][8]);\r\n        insert_footer3(name);\r\n//        if (reorder_thread_idx(name)) show_catalog(name); // called in triage_exe\r\n        if (pref.notify.favicon) notifier.favicon.set(threads);\r\n      }\r\n\r\n      var show_catalog_init_funcs;\r\n      var show_catalog_scroll_lock = (function(){\r\n        var marks = null;\r\n//        var set = Watchdog.prototype.restart.bind(new Watchdog(scroll_back, 5));\r\n        var wdg  = new Watchdog(scroll_back, 5);\r\n        var wdg2 = new Watchdog(tgt_lock_calcel, 100); // 500ms scroll lock and watchdog for oscillation.\r\n        var set = Watchdog.prototype.restart.bind(wdg);\r\n//        var last_viewed = null;\r\n        function tgt_lock_calcel(){\r\n          wdg.cancel();\r\n          marks = null;\r\n        }\r\n        function scroll_back(){\r\n          var mark_top = marks[0].offsetTop || 0;\r\n          var abs_top = mark_top - marks[1] + marks[2];\r\n          if (abs_top<0) abs_top = 0;\r\n          if (!mark_top || get_now_height()===abs_top) { // may cause oscillation\r\n//            marks = null;\r\n//             wdg2.stop(); // scroll lock\r\n            return;\r\n          }\r\n          window.scrollTo(0, abs_top);\r\n          set();\r\n        }\r\n        var last_viewed = null;\r\n        function start(pn){\r\n          if (marks===null || pn) {\r\n//            if (marks && pn) scroll_back();\r\n            if (!pn) {\r\n              pn = (wdg2.id)? last_viewed : // scroll locked\r\n                              general_event_handler.get_last_viewed() || last_viewed; // return null when initial or deleted\r\n              if (!pn) return;\r\n            }\r\n            marks = [pn, pn.offsetTop, get_now_height()];\r\n            last_viewed = pn;\r\n////            if (last_viewed) { // working code.\r\n////              marks = [last_viewed, last_viewed.offsetTop, get_now_height()];\r\n////              set();\r\n////            }\r\n//            var now_height = get_now_height();\r\n//            var last_top; // working code.\r\n//            if (last_viewed) last_top = last_viewed.offsetTop;\r\n//            if (last_viewed && last_top >= now_height && last_top <= now_height + window.innerHeight) marks = [last_viewed, last_top, now_height];\r\n//            else { // scrolled\r\n//              var posts = (embed_mode==='thread')? site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'thread_html', {thread:site.no})[0].posts :\r\n//                                                   site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'page_html', {page:0})[0].posts;\r\n//              var step = posts.length >> 1;\r\n//              var i = 0;\r\n//              while (step>0) {\r\n//                if (posts[i+step].pn.offsetTop<now_height) i += step;\r\n//                step >>= 1;\r\n//              }\r\n//              while (i<posts.length-1 && posts[i].pn.offsetTop<now_height) i++;\r\n//              marks = [posts[i].pn, posts[i].pn.offsetTop, now_height];\r\n//            }\r\n          }\r\n          wdg2.restart();\r\n          set();\r\n        }\r\n        return {\r\n          modified: function(tgt){\r\n//            start((tgt.pn && marks[0]===tgt.pn)? site2[site.nickname].general_event_handler[site.whereami].get_prev_mark(tgt.pn) : null); // fail if get_prev_mark returns undefined;\r\n            if (tgt.pn && marks && marks[0]===tgt.pn) {\r\n              scroll_back();\r\n              marks = null; // get_prev_mark may return undefined\r\n//              start(site2[site.nickname].general_event_handler[site.whereami].get_prev_mark(tgt.pn));\r\n              start(site2[site.nickname].general_event_handler[site.whereami].get_mark_from_height(tgt.pn.offsetTop));\r\n              general_event_handler.clear_last_viewed();\r\n            } else start();\r\n          },\r\n          set: start,\r\n//          viewed: function(tgt){if (!marks) last_viewed = tgt;},\r\n//          viewed: function(tgt){\r\n//            if (!wdg2.id)\r\n//              last_viewed = tgt;}, // scroll lock\r\n        }\r\n      })();\r\n      cataLog.show_catalog_scroll_lock = show_catalog_scroll_lock;\r\n      var drawn_idx = 0;\r\n      var drawn_y = 0;\r\n      var drawn_ref_count = 0;\r\n      var show_catalog_cont = new DelayBuffer(show_catalog_delayed, 200).get_binded_delayed_do();\r\n      function show_catalog_delayed(){\r\n        ref_heights = null;\r\n        if (drawn_idx!==true) show_catalog();\r\n        if (image_expand_on_demand_instance) expand_thumbnail_on_demand(image_expand_on_demand_instance);\r\n      }\r\n      var ref_heights = null;\r\n      function get_ref_height(threshold){\r\n        if (!threshold) threshold = 1.5;\r\n//        return (embed_embed)? brwsr.document_body.scrollTop + window.innerHeight * threshold // slow.\r\n//                            : triage_parent.scrollTop + triage_parent.clientHeight * threshold;\r\n        if (!ref_heights) ref_heights = {scrollTop: (scroll_event_src===window)? brwsr.document_body.scrollTop : scroll_event_src.scrollTop,\r\n                                         innerHeight: (scroll_event_src===window)? window.innerHeight : scroll_event_src.clientHeight}; // BUG, NEED TO ADD EVENTLISTENER TO TRIAGE_PARENT.'resize'.\r\n        return ref_heights.scrollTop + ref_heights.innerHeight * threshold;\r\n      }\r\n      function get_now_height(){\r\n        return (embed_embed)? brwsr.document_body.scrollTop : triage_parent.scrollTop;\r\n      }\r\n      function scopy_th(th){\r\n         var dst = {posts:[], __proto__:th};\r\n         for (var i=0;i<th.posts.length;i++) dst.posts[i] = {__proto__:th.posts[i]};\r\n         return dst;\r\n      }\r\nvar debug_str2;\r\n//      function show_catalog(tgts_in,sound){\r\n    var catalog_obj2_proto = {\r\n      show_catalog: function(tgts_in,sound){\r\nif (pref.debug_mode['11']) {\r\n  var debug_str = threads_idx_debug(drawn_idx, drawn_y, drawn_ref_count, threads_idx);\r\n//  var debug_str = 'drawn_idx:'+drawn_idx+', drawn_y:'+drawn_y+', drawn_ref_count:'+drawn_ref_count;\r\n}\r\nif (pref.test_mode['23']) drawn_idx = 0;\r\n        var draw_on_demand = pref[embed_mode].draw_on_demand && this.permit_draw_on_demand;\r\n        var draw_adaptive = draw_on_demand && pref.network.adaptive;\r\n        var draw_count = 0;\r\n        var ref_height;\r\n        if (draw_on_demand) {\r\n          ref_height = get_ref_height((draw_adaptive)? ((show_catalog_db_th20.id!==null)? 0.2 : 1) : 1.5);\r\n          if (drawn_idx!==0 && drawn_y>=ref_height)\r\n            if (triage_parent.offsetHeight<drawn_y) drawn_idx = 0; // for expanding posts or images.\r\n            else return;\r\n//          if (drawn_idx!==0 && drawn_y>=ref_height) return;\r\n        }\r\n        if (pref[embed_mode].scroll_lock) show_catalog_scroll_lock.set();\r\n        var tgts;\r\n        if (typeof(tgts_in)==='string') {\r\n          tgts = {};\r\n          tgts[tgts_in] = null;\r\n//        } else if (Array.isArray(tgts_in)) {\r\n//          tgts = {};\r\n//          for (var i=0;i<tgts_in.length;i++) tgts[tgts_in[i]] = null;\r\n        } else tgts = tgts_in;\r\n//        if (embed_catalog) {show_catalog_native();return;}\r\n//        if (tgts) for (var name in tgts) if (threads[name] && threads[name][0].parentNode) threads[name][0].parentNode.removeChild(threads[name][0]); // this is required when the thread is moved to later. // THIS CAUSES A BLINK.\r\n////////        catalog_triage_out();\r\n        var triage_thread = triage.get_triaged_thread_name();\r\n//        pref_func.tooltips.hide();\r\n        var catalog_expand_with_hr = pref.catalog_expand_with_hr && (embed_mode==='page' || embed_mode==='float');\r\n        var ref_count;\r\n        if (tgts!==undefined) for (var i=0;i<drawn_idx;i++) if (threads_idx[i] in tgts) {drawn_idx = i;break;}\r\n        var ref_count_init = pref[embed_mode].env.disp_offset;\r\n        if (catalog_expand_with_hr) ref_count_init = show_catalog_skip_hs(ref_count_init);\r\n        if (!draw_on_demand || drawn_idx===0 || drawn_idx===true) { // called with drawn_idx===true from 'release_draw'.\r\n          ref_count = ref_count_init;\r\n          drawn_y = 0;\r\n        } else ref_count = drawn_ref_count;\r\n        var load_tgt = '';\r\n//        var appeared = [];\r\n//var debug = '';\r\n//for (var d=0;d<threads_idx.length;d++) if (threads_idx[d]!=='ODL:' && threads[threads_idx[d]][9][0]) debug += threads_idx[d] + ', ';\r\n//console.log(debug);\r\n        var i=0;\r\n        var i_start = (draw_on_demand && drawn_idx!==true)? drawn_idx : 0;\r\n        while (i<threads_idx.length) {\r\n//console.log(drawn_y+', '+triage_parent.scrollTop+', '+triage_parent.clientHeight*1.5+', '+ref_height);\r\n          var name = threads_idx[i];\r\n          if (name.substr(0,4)==='ODL:') {\r\n            if (load_tgt==='') {\r\n              load_tgt = name;\r\n              if (load_on_demand.call([load_tgt.substr(4)])) threads_idx.splice(i,1);\r\n              break;\r\n            }\r\n          } else {\r\n            if (draw_on_demand && drawn_y>=ref_height) break;\r\n            if (tgts==='END') break;\r\n            if (i>=i_start) {\r\n              if (draw_on_demand || tgts===undefined || name in tgts) {\r\n                if (threads[name][9][0]===null) threads[name][9] = catalog_filter_query(name, true);\r\n                if (threads[name][9][0] && embed_mode==='page' && !pref.test_mode['52']) format_html.replace_posts_by_search(threads[name]); // may change threads[name][9][0]\r\n                if (threads[name][9][0]) {\r\n                  if (!threads[name][0] || threads[name][16].th) {\r\n                    insert_thread_prepare_html_lazy(threads[name], !threads[name][0], false, true);\r\n                    if (draw_adaptive) {\r\n                      if (++draw_count==pref.network.th100) {\r\n                        ref_height = get_ref_height(1);\r\n                        show_catalog_db_th100.delayed_do();\r\n                      } else if (draw_count===pref.network.th20) {\r\n                        ref_height = get_ref_height(0.2);\r\n                        show_catalog_db_th100.cancel();\r\n                        show_catalog_db_th20.delayed_do();\r\n                        draw_adaptive = false; // close\r\n                      }\r\n                    }\r\n                  }\r\n////                  if (tgts!==undefined) { // working code.\r\n////                    ref_count = 0;\r\n////                    for (var j=0;j<i;j++) if (threads_idx[j].substr(0,4)!=='ODL:' && threads[threads_idx[j]][1]) ref_count++;\r\n////                  }\r\n////                  if (catalog_expand_with_hr) {\r\n////                    var j = 0;\r\n////                    var j_max = triage_parent.childNodes.length;\r\n////                    while (j<=ref_count && j<j_max) if (triage_parent.childNodes[j++].tagName!=='DIV') ref_count++;\r\n////                  }\r\n                  var ref;\r\n                  if (tgts!==undefined) {\r\n                    var j=i-1;\r\n                    while (j>=0 && (threads_idx[j].substr(0,4)==='ODL:' || !threads[threads_idx[j]][1])) j--;\r\n                    if (j>=0) {\r\n                      ref = threads[threads_idx[j]][0].nextSibling;\r\n                      if (catalog_expand_with_hr && ref) ref = ref.nextSibling;\r\n                    } else ref = triage_parent.childNodes[ref_count_init];\r\n                    delete tgts[name];\r\n                    if (Object.keys(tgts).length===0) tgts='END';\r\n                  } else ref = triage_parent.childNodes[ref_count];\r\n                  if (ref!==threads[name][0] || !threads[name][1]) {\r\n                    if (this.func_show(name,ref,catalog_expand_with_hr)) threads[name][1] = true;\r\n                    if (triage_thread) {triage.off_delay();triage_thread=null;}\r\n                  }\r\n                  if (threads[name][1]) {\r\n                    if (draw_on_demand) drawn_y = threads[name][0].offsetTop; // for faster execution. DOM function is too heavy.\r\n                    ref_count += this.ref_step;\r\n                    if (catalog_expand_with_hr) ref_count = show_catalog_skip_hs(ref_count);\r\n                  }\r\n//                  var nickname = name.replace(/\\/.*/,'');\r\n//                  if (pref.catalog.filter.list_mark_time && threads[name][9][1]) site2[nickname].mark_newer_posts(ch,threads[name][9][1]);\r\n////                  if (!threads[name][1]) { // working code.\r\n////                    threads[name][1] = true;\r\n//////                    threads[name][11] = add_open_new_thread_event(name,site2[nickname].modify_thread_link(ch));\r\n//////                    console.log(ch.offsetTop +', ' + i + ', ' + name);\r\n////                    appeared.push(name);\r\n//////                    if (sound && pref.notify.sound.notify) notifier.sound.play();\r\n////                  }\r\n                } else if (threads[name][1]) {\r\n                  if (pop_up_status[name]) pop_down_event(name);\r\n//                  threads[name][11] = remove_open_new_thread_event(threads[name][11]);\r\n                  if (this.func_hide(name,catalog_expand_with_hr)) threads[name][1] = false;\r\n                  if (triage_thread) {triage.off_delay();triage_thread=null;}\r\n                }\r\n// BUG\r\n//              } else {\r\n////                var ref = triage_parent.childNodes[ref_count];\r\n////                for (var name in tgts) if (threads[name] && ref===threads[name][0]) {ref.parentNode.removeChild(ref);break;} // this is required when the thread is moved to later. // threads[name] may not exist when it is snoop, that contains redundant threads.\r\n//                while (1) {\r\n//                  var flag = true;\r\n//                  var ref2 = triage_parent.childNodes[ref_count];\r\n//                  for (var name2 in tgts) if (threads[name2] && ref2===threads[name2][0]) {\r\n//                    ref2.parentNode.removeChild(ref2);\r\n//                    flag=false;\r\n//                    break;\r\n//                  } // this is required when the thread is moved to later. // threads[name] may not exist when it is snoop, that contains redundant threads.\r\n//                  if (flag) break;\r\n//                }\r\n//                if (threads[name][9][0]) ref_count++; // name must proceed by the count of eliminated in above.  THIS IS A BUG.\r\n// BUG\r\n              }\r\n            }\r\n            i++;\r\n          }\r\n          if (triage_thread===name) triage_thread = null;\r\n        }\r\n        drawn_idx = (!draw_on_demand || i==threads_idx.length)? true : (i<i_start)? i_start : i;\r\n        drawn_ref_count = ref_count;\r\n//        if (appeared.length!=0 && sound) notifier.appeared(appeared,threads);\r\n//var str_debug = '';\r\n//for (var d=0;d<threads_idx.length;d++) if (threads[threads_idx[d]][1] && threads[threads_idx[d]][9][0]) str_debug += threads_idx[d] + threads[threads_idx[d]][8][pref.catalog.indexing] + ',';\r\n//console.log(str_debug);\r\n////        if (catalog_expand_with_hr)\r\n////          for (var i=triage_parent.childNodes.length-2;i>=0;i--)\r\n////            if (triage_parent.childNodes[i].tagName==='HR' && triage_parent.childNodes[i+1].tagName==='HR') triage_parent.removeChild(triage_parent.childNodes[i+1]);\r\nif (pref.debug_mode['11'] && embed_mode!=='thread' && !pref[embed_mode].merge) {\r\n        var flag = -1;\r\n        var d_count = 0;\r\n        for (var d=0;d<i;d++) {\r\n          if (threads_idx[d][0]!=='O' && threads[threads_idx[d]][1]) {\r\n            var dbt = common_func.fullname2dbt(threads_idx[d]);\r\n            var tgt,tgt_bt;\r\n            if (embed_mode==='page' && site.nickname==='4chan') {\r\n              tgt = triage_parent.getElementsByClassName('CatChan_thread')[d_count++];\r\n              tgt_bt = site.board + tgt.id.substr(1);\r\n            } else if (embed_mode==='page' && site.nickname==='8chan') {\r\n              tgt = triage_parent.getElementsByClassName('CatChan_thread')[d_count++];\r\n              tgt_bt = '/' + tgt.getAttribute('data-board') + '/' + tgt.id.substr(7);\r\n            } else {\r\n              tgt = triage_parent.childNodes[pref[embed_mode].env.disp_offset + d_count++];\r\n              tgt_bt = (embed_mode==='page')? '/' + tgt.getAttribute('data-board') + '/' + tgt.id.substr(7) :\r\n                                              tgt.getElementsByTagName('a')[0].getAttribute('href').replace('res/','').replace('.html','').replace(/.*lainchan.org/,'').replace(/.*8ch.net/,'').replace('thread/','').replace(/.*4chan.org/,'').replace(/.*meguca.org/,'').replace(/.*krautchan.net/,'').replace(/thread\\-/,'');\r\n              if (dbt[0]==='4chan' && embed_mode==='catalog') tgt_bt = tgt_bt.substr(0,tgt_bt.lastIndexOf('/'));\r\n            }\r\n            if (dbt[1]+dbt[2]!==tgt_bt) {\r\n              var debug_str4='';\r\n              for (var j=d+1;j<d+5;j++) debug_str4 += threads_idx[j]+', ';\r\n              console.log('ERROR: '+d+', '+tgt_bt+', '+threads_idx[d]+': '+i+', '+debug_str4);\r\n              flag = i;\r\n            }\r\n          }\r\n        }\r\n        var debug_str3 = threads_idx_debug(drawn_idx, drawn_y, drawn_ref_count, threads_idx);\r\n        if (flag!=-1) {\r\n          console.log('PREV: '+debug_str2);\r\n          console.log('IN:   '+debug_str);\r\n          for (var i=0;i<flag+5;i++) if (triage_parent.childNodes[i]) console.log(triage_parent.childNodes[i]);\r\n          console.log('OUT:  '+debug_str3);\r\n//          console.trace();\r\n        } else {\r\n//          console.log('OK: '+debug_str);\r\n        }\r\n        debug_str2 = debug_str3;\r\n}\r\n      },\r\n      func_show: function(name,ref,catalog_expand_with_hr){\r\n        triage_parent.insertBefore(threads[name][0],(ref && ref.parentNode===triage_parent)? ref : null); // if many threads are removed, ref refers horizontal splitter.\r\n        return true;\r\n      },\r\n      func_hide: function(name,catalog_expand_with_hr){\r\n        triage_parent.removeChild(threads[name][0]);\r\n        return true;\r\n      },\r\n      permit_draw_on_demand: true,\r\n      ref_step: 1,\r\n    };\r\n      scroll_event_src.addEventListener('scroll', show_catalog_cont, false);\r\n      window.addEventListener('resize', show_catalog_cont, false);\r\n      var catalog_obj2 = catalog_obj2_proto;\r\n      if (embed_mode==='page' && site2[site.nickname].all_boards && site2[site.nickname].all_boards.indexOf(site.board)!=-1) { // PATCH\r\n        catalog_obj2 = {\r\n          func_show: function(name){\r\n            var ch = threads[name][0];\r\n            if (ch.previousSibling && ch.previousSibling.tagName==='H2') {\r\n              ch.previousSibling.style.display = '';\r\n              ch.style.display = '';\r\n              return true;\r\n            } else return false;\r\n          },\r\n          func_hide: function(name){\r\n            var ch = threads[name][0];\r\n            if (ch.previousSibling && ch.previousSibling.tagName==='H2') {\r\n              ch.previousSibling.style.display = 'none';\r\n              ch.style.display = 'none';\r\n              return true;\r\n            } else return false;\r\n          },\r\n          permit_draw_on_demand: false,\r\n          __proto__: catalog_obj2_proto\r\n        }\r\n//      } else if (embed_mode==='thread' && pref.thread.merge) { // PATCH\r\n      } else if (pref[embed_mode].merge) { // TEST\r\n        var base_name = site.nickname + site.board + site.no;\r\n        catalog_obj2 = {\r\n          func_show_hide: function(name, show_or_hide){\r\n            if (embed_mode==='thread' && base_name===name) return true;\r\n            var myself = site2[site.nickname].update_posts_prep_merge();\r\n            var dst = myself.posts;\r\n            var pnode = myself.pn;\r\n            var dbt = name.split('/');\r\n            var posts = threads[name][16].posts;\r\n            var src = {domain:dbt[0], board:dbt[1], no:dbt[2], posts:posts};\r\n            if (show_or_hide) {\r\n//////////              var j = dst.posts.length-1;\r\n//////////              var i = posts.length-1;\r\n//////////              while (i>=0) {\r\n//////////                while (j>0 && dst.posts[j].time>posts[i].time) j--;\r\n//////////                if (dst.posts[j].com===posts[i].com) break;\r\n//////////                else i--;\r\n//////////              }\r\n//////////              while (++i<posts.length) {\r\n//////////                while (j<dst.posts.length && dst.posts[j].time<posts[i].time) j++;\r\n//////////                site2[site.nickname].update_posts_insert(src, dst, i, j, pnode);\r\n//////////              }\r\n////              var time_merged = threads[name][16].time_merged || 0; // working code.\r\n////              var i = 0;\r\n////              var j = 0;\r\n//////              var scroll_add = 0;\r\n//////              var now_height = (pref[embed_mode].scroll_lock && !init)? get_now_height() : 0;\r\n//////              var now_height_tmp = now_height;\r\n////              if (time_merged!==0) {\r\n////                i = posts.length;\r\n////                while (i>0 && posts[i-1].time>time_merged) i--;\r\n////                j = dst.posts.length;\r\n////                while (j>0 && dst.posts[j-1].time>time_merged) j--;\r\n////              }\r\n////              while (i<posts.length) {\r\n////                while (j<dst.posts.length && (dst.posts[j].time<posts[i].time || dst.posts[j].time==posts[i].time && dst.posts[j].no<=posts[i].no)) j++;\r\n////                site2[site.nickname].update_posts_insert(src, dst, i++, j, pnode);\r\n//////                var add_val = site2[site.nickname].update_posts_insert(src, dst, i++, j, pnode, now_height_tmp); // slow\r\n//////                if (add_val!==null) scroll_add += add_val;\r\n//////                else now_height_tmp = 0;\r\n////                if (pref[embed_mode].scroll_lock) show_catalog_scroll_lock.modified(src.posts[i-1]);\r\n////              }\r\n////              threads[name][16].time_merged = posts[posts.length-1].time;\r\n//////              if (scroll_add) window.scrollTo(0,now_height + scroll_add);\r\n              site2[site.nickname].update_posts_insert_merge(src.posts,0);\r\n            } else {\r\n//              var back = 0;\r\n//              var now_height;\r\n//              if (pref[embed_mode].scroll_lock) now_height = get_now_height();\r\n              for (var i=posts.length-1;i>=0;i--) {\r\n//                if (pref[embed_mode].scroll_lock) if (src.posts[i].offsetTop<now_height) back += src.posts[i].offsetHeight; // TEST, SHOULD INCLUDE container.\r\n                if (src.posts[i].pn) site2[site.nickname].update_posts_remove(src, i, pnode, true);\r\n              }\r\n//              if (back) window.scrollTo(0,now_height-back);\r\n              threads[name][16].time_merged = 0;\r\n            }\r\n            return true;\r\n          },\r\n          func_show: function(name){if (!threads[name][1]) this.func_show_hide(name, true); return true;},\r\n          func_hide: function(name){if ( threads[name][1]) this.func_show_hide(name, false);return true;},\r\n          permit_draw_on_demand: false,\r\n          __proto__: catalog_obj2_proto\r\n        }\r\n        if (embed_mode==='page') {\r\n          var top = site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'page_html', {page:0})[0];\r\n          catalog_obj2.base_name = site.nickname + site.board + top.no;\r\n          site2['DEFAULT'].update_posts_merge_base = top.pn;\r\n        }\r\n//        if (pref[embed_mode].scroll_lock && site2[site.nickname].update_posts_remove_lock) {// TEST // TOO SLOW\r\n//          site2[site.nickname].update_posts_remove = site2[site.nickname].update_posts_remove_lock;\r\n//          site2[site.nickname].update_posts_insert = site2[site.nickname].update_posts_insert_lock;\r\n//        }\r\n        show_catalog_init_funcs = (embed_mode==='page')? function(){\r\n          for (var name in threads)\r\n          if (threads[name][0]!==site2['DEFAULT'].update_posts_merge_base && threads[name][0].parentNode===triage_parent) {\r\n            if (threads[name][0].nextSibling.tagName==='HR') triage_parent.removeChild(threads[name][0].nextSibling);\r\n            triage_parent.removeChild(threads[name][0]);\r\n            catalog_obj2.func_show_hide(name, true);\r\n          }\r\n        } : null;\r\n      } else if (embed_mode==='page' && pref.catalog_expand_with_hr) {\r\n        catalog_obj2 = {\r\n          func_show: function(name,ref,catalog_expand_with_hr){\r\n            var hr = (threads[name][1])? threads[name][0].nextSibling : document.createElement('hr');\r\n            triage_parent.insertBefore(threads[name][0],ref);\r\n            triage_parent.insertBefore(hr,ref);\r\n            return true;\r\n          },\r\n          func_hide: function(name,catalog_expand_with_hr){\r\n            triage_parent.removeChild(threads[name][0].nextSibling);\r\n            triage_parent.removeChild(threads[name][0]);\r\n            return true;\r\n          },\r\n          ref_step: 2,\r\n          __proto__: catalog_obj2_proto\r\n        }\r\n      } else if (pref.catalog_expand_with_hr) {\r\n        catalog_obj2 = {\r\n          func_show: function(name,ref,catalog_expand_with_hr){\r\n            if (catalog_expand_with_hr && threads[name][1]) show_catalog_hr(name,'remove');\r\n            triage_parent.insertBefore(threads[name][0],(ref && ref.parentNode===triage_parent)? ref : null); // if many threads are removed, ref refers horizontal splitter.\r\n            if (catalog_expand_with_hr) show_catalog_hr(name,'add');\r\n            return true;\r\n          },\r\n          func_hide: function(name,catalog_expand_with_hr){\r\n            if (catalog_expand_with_hr) show_catalog_hr(name,'remove');\r\n            triage_parent.removeChild(threads[name][0]);\r\n            return true;\r\n          },\r\n          __proto__: catalog_obj2_proto\r\n        }\r\n//        var pctrls = triage_parent;\r\n//        for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.removeChild(pctrls.childNodes[i]);\r\n//        pctrls.parentNode.insertBefore(document.createElement('hr'),pctrls.nextSibling);\r\n      }\r\n      var show_catalog = (catalog_obj2)? catalog_obj2.show_catalog.bind(catalog_obj2) :\r\n                                         catalog_obj2_proto.show_catalog.bind(catalog_obj2_proto);\r\n      cataLog.show_catalog = show_catalog;\r\n      var show_catalog_db_th100 = new DelayBuffer(show_catalog, pref.network.th100_delay);\r\n      var show_catalog_db_th20 = new DelayBuffer(show_catalog, pref.network.th20_delay);\r\n      \r\nfunction threads_idx_debug(idx,y,count, threads_idx){\r\n  var str = 'drawn_idx:'+idx+', drawn_y:'+y+', drawn_ref_count:'+count+' ';\r\n  for (var i=0;i<threads_idx.length;i++) if (!threads[threads_idx[i]] || threads[threads_idx[i]][1]) str += threads_idx[i]+', ';\r\n  str += '::: '+JSON.stringify(threads_idx);\r\n  return str;\r\n}\r\n      var load_on_demand = (function(){\r\n        var mutex = true;\r\n        var timer = null;\r\n        function release(){\r\n          if (timer) {\r\n            clearTimeout(timer);\r\n            timer = null;\r\n          }\r\n          mutex = true;\r\n        }\r\n        return {\r\n          call: function(tgts){\r\n            if (this.get()) {\r\n              threads_index.delete_odl(tgts);\r\n              scan_boards.scan_init('on_demand_load', tgts, {refresh:true, crawler_max:1, callback:load_on_demand.release_draw});\r\n              return true;\r\n            } else return false;\r\n          },\r\n          release: release,\r\n          release_draw: function(){release();show_catalog();},\r\n          get: function(){\r\n            var retval = mutex;\r\n            if (retval) timer = setTimeout(release, pref.catalog_load_on_demand_timeout*1000);\r\n            mutex = false;\r\n            return retval;\r\n          }\r\n        }\r\n      })();\r\n\r\n      function show_catalog_skip_hs(ref_count){\r\n        var c_len = triage_parent.childNodes.length;\r\n        var class_hs = pref.script_prefix+'_hs';\r\n//        while (ref_count<c_len && triage_parent.childNodes[ref_count].className===class_hs) ref_count++;\r\n        if (ref_count<c_len && triage_parent.childNodes[ref_count].className===class_hs) ref_count++;\r\n        return ref_count;\r\n      }\r\n      function show_catalog_hr(name,func){\r\n        if (embed_mode==='catalog') return;\r\n        var pn = threads[name][0];\r\n        var class_hs = pref.script_prefix+'_hs';\r\n        if (func==='add' && pn.style.width==='' && pn.style.height==='') {\r\n          if (pn.previousSibling && pn.previousSibling.className!==class_hs) pn.parentNode.insertBefore(site2[site.nickname].horizontal_separator_in_index(),pn);\r\n          if (pn.nextSibling && pn.nextSibling.className!==class_hs) pn.parentNode.insertBefore(site2[site.nickname].horizontal_separator_in_index(),pn.nextSibling);\r\n        }\r\n        if (func==='shrink' || func==='remove' && pn.style.width==='' && pn.style.height==='' || func==='add' && (pn.style.width!=='' || pn.style.height!=='')) {\r\n          var pn_test = (pn.previousSibling && pn.previousSibling.className===class_hs)? pn.previousSibling.previousSibling : null;\r\n          if (pn_test && (pn_test.style.width!=='' || pn_test.style.height!=='')) pn.parentNode.removeChild(pn.previousSibling);\r\n          var pn_test = (pn.nextSibling && pn.nextSibling.className===class_hs)? pn.nextSibling.nextSibling : null;\r\n          if (pn_test && (pn_test.style.width!=='' || pn_test.style.height!=='')) pn.parentNode.removeChild(pn.nextSibling);\r\n        }\r\n        if (func==='remove') {\r\n//          if (pn.previousSibling && pn.previousSibling.className===class_hs && pn.nextSibling && pn.nextSibling.className===class_hs) pn.parentNode.removeChild(pn.previousSibling); // BUG IN 8ch page mode, remoev first br and 'ref' becomes null.\r\n          if (pn.previousSibling && pn.previousSibling.className===class_hs && pn.nextSibling && pn.nextSibling.className===class_hs) pn.parentNode.removeChild(pn.nextSibling);\r\n//          if (pn.nextSibling && pn.nextSibling.className===class_hs && pn.nextSibling.nextSibling && pn.nextSibling.nextSibling.className===class_hs) pn.parentNode.removeChild(pn.nextSibling);\r\n        }\r\n      }\r\n\r\n////      function show_catalog_hr(name,func){ // working code.\r\n////        var pn = threads[name][0];\r\n//////        var sibls = ['previousSibling', 'nextSibling'];\r\n//////        if (pn.style.width==='' && pn.style.height==='') {\r\n//////          for (var i=0;i<sibls.length;i++)\r\n//////            while (pn[sibls[i]] && pn[sibls[i]].tagName==='HR' && pn[sibls[i]][sibls[i]].tagName==='HR') pn.parentNode.removeChild(pn[sibls[i]]);\r\n////        if (func==='add' && pn.style.width==='' && pn.style.height==='') {\r\n////          if (pn.previousSibling && pn.previousSibling.tagName!=='HR') pn.parentNode.insertBefore(document.createElement('hr'),pn);\r\n////          if (pn.nextSibling && pn.nextSibling.tagName!=='HR') pn.parentNode.insertBefore(document.createElement('hr'),pn.nextSibling);\r\n////        }\r\n////        if (func==='shrink' || func==='remove' && pn.style.width==='' && pn.style.height==='' || func==='add' && (pn.style.width!=='' || pn.style.height!=='')) {\r\n////          var pn_test = (pn.previousSibling && pn.previousSibling.tagName==='HR')? pn.previousSibling.previousSibling : null;\r\n////          if (pn_test && (pn_test.style.width!=='' || pn_test.style.height!=='')) pn.parentNode.removeChild(pn.previousSibling);\r\n////          var pn_test = (pn.nextSibling && pn.nextSibling.tagName==='HR')? pn.nextSibling.nextSibling : null;\r\n////          if (pn_test && (pn_test.style.width!=='' || pn_test.style.height!=='')) pn.parentNode.removeChild(pn.nextSibling);\r\n////        }\r\n////        if (func==='remove') {\r\n////          if (pn.previousSibling && pn.previousSibling.tagName==='HR' && pn.nextSibling && pn.nextSibling.tagName==='HR') pn.parentNode.removeChild(pn.previousSibling);\r\n//////          for (var i=0;i<sibls.length;i++) {\r\n//////            var pn_test = pn[sibls[i]][sibls[i]];\r\n//////            if (pn_test.tagName==='DIV' && pn_test.style && (pn_test.style.width!=='' || pn_test.style.height!=='')) pn.parentNode.removeChild(pn[sibls[i]]);\r\n//////          }\r\n////        }\r\n////      }\r\n\r\n      function catalog_attr_set(name,pn){\r\n        var tgt_th = threads[name];\r\n        var val = null;\r\n        if (pref.catalog.filter.attr_list) {\r\n          if (pref.catalog.style_general_list) val = pref_func.merge_obj5(name,pref.catalog.style_general_list_obj2,val);\r\n          if (pref.catalog.filter.attr_list)   val = pref_func.merge_obj5(name,pref.catalog.filter.attr_list_obj2,val);\r\n        }\r\n//        if (val && val.style) {\r\n////          var styles = val.style.split(';');\r\n////          for (var i=0;i<styles.length;i++) {\r\n////            var stl = styles[i].split(':');\r\n////            pn.style[stl[0]] = stl[1];\r\n////          }\r\n////console.log('catalog_attr_set :'+name+', '+val.toSource());\r\n////          for (var stl in val)\r\n////            if (stl.indexOf('style')==0) pn.style[stl.substr(6)] = val[stl];\r\n////          for (var stl in val) {\r\n////            if (stl.indexOf('style')==0 && stl.length>6) pn.style[stl.substr(6)] = val[stl];\r\n////            if (stl.indexOf('style')==0 && stl.length>6) {\r\n////              pn.setAttribute('style',pn.getAttribute('style')+stl.substr(6)+':'+val[stl]+';');\r\n////              console.log('catalog_attr_set_1 :'+name+', '+pn.getAttribute('style')+';'+stl.substr(6)+val[stl]+':');\r\n////            }\r\n////          }\r\n//          for (var stl in val.style) pn.style[stl] = val.style[stl];\r\n        //        }\r\n        if (tgt_th[0]) {\r\n          var rollback_info = tgt_th[22];\r\n          if (val && val.style) {\r\n            for (var stl in val.style) {\r\n              if (!(stl in rollback_info)) rollback_info[stl] = pn.style[stl];\r\n              pn.style[stl] = val.style[stl];\r\n            }\r\n          }\r\n          for (var stl in rollback_info) {\r\n            if (!val || !val.style || !(stl in val.style)) {\r\n              if (rollback_info[stl]===undefined) delete pn.style[stl];\r\n              else pn.style[stl] = rollback_info[stl];\r\n              delete rollback_info[stl];\r\n            }\r\n          }\r\n        }\r\n        if (val && val.cmd || tgt_th[16].icon_sticky || tgt_th[16].icon_show_always || tgt_th[16].systemSticky) {\r\n          var sticky = !!((val && val.cmd && val.cmd['sticky']!==undefined)? val.cmd['sticky'] : tgt_th[16].systemSticky); // !! for ^\r\n          if (sticky ^ tgt_th[20]) { // sticky\r\n            tgt_th[20] = sticky;\r\n            if (tgt_th[20] != tgt_th[16].icon_sticky) tgt_th[16].icon_sticky = site2[site.nickname].add_icon(tgt_th[0],tgt_th[16].type_html, 'sticky', tgt_th[16]);\r\n          }\r\n          if ((val && val.cmd && val.cmd['show']) ^ !!tgt_th[16].icon_show_always) { // show\r\n            tgt_th[16].icon_show_always = site2[site.nickname].add_icon(tgt_th[0],tgt_th[16].type_html, 'show_always', tgt_th[16]);\r\n            tgt_th[16].show_always = val.cmd['show']; // for lazy pn generation.\r\n            tgt_th[9] = catalog_filter_query(name);\r\n            if (show_catalog) show_catalog(name); // 'if (show_catalog)' is a patch.\r\n          }\r\n        }\r\n      }\r\n    \r\n////      function catalog_obj_merge(name,obj,val){\r\n////        var dbt = cnst.name2domainboardthread(name,true);\r\n////        if (val===null) val = {hit:false};\r\n////        val = catalog_obj_merge_1(val,obj,'DEFAULT');\r\n////        val = catalog_obj_merge_1(val,obj,dbt[0]); // domain\r\n////        val = catalog_obj_merge_1(val,obj,dbt[1]); // board\r\n////        val = catalog_obj_merge_1(val,obj,dbt[0]+dbt[1]); // domain+board\r\n////        val = catalog_obj_merge_1(val,obj,dbt[2]); // thread\r\n////        val = catalog_obj_merge_1(val,obj,dbt[0]+dbt[2]); // domain+thread\r\n////        val = catalog_obj_merge_1(val,obj,dbt[1]+dbt[2]); // board+thread\r\n////        val = catalog_obj_merge_1(val,obj,name);\r\n////        return val;\r\n////      }\r\n////      function catalog_obj_merge_1(val,obj,key){\r\n////        if (obj[key]) {\r\n////          for (var i in obj[key])\r\n//////            if (val[i]===undefined || typeof(obj[key][i])!=='object') val[i] = obj[key][i];\r\n//////            else for (var j in obj[key][i]) val[i][j] = obj[key][i][j]; // 2nd level.\r\n////            if (typeof(obj[key][i])!=='object') val[i] = obj[key][i];\r\n////            else {\r\n////              if (val[i]===undefined) val[i]={};\r\n////              for (var j in obj[key][i]) val[i][j] = obj[key][i][j]; // 2nd level.\r\n////            }\r\n////          val.hit = true;\r\n////        }\r\n////        return val;\r\n////      }\r\n\r\n      function filter_kwd_prep_init(e, kwd, init) {\r\n        kwd.str_old = '';\r\n        kwd.fail_list = {};\r\n        kwd.suc_list  = {};\r\n        filter_kwd_prep(e, kwd, init);\r\n      }\r\n      function filter_kwd_prep(e, kwd, init) {\r\n        if (!kwd) kwd = pref.catalog.filter.kwd;\r\n        kwd.kwds = common_func.kwd_prep_regexp(kwd);\r\n//        kwd.timestamp = Date.now(); // not saved because pref.default() don't geenrate this.\r\n        filter_kwd_active(e, kwd, init);\r\n      }\r\n      var filter_kwd_count = 0;\r\n      function filter_kwd_active(e, kwd, init) {\r\n        if (!kwd) kwd = pref.catalog.filter.kwd;\r\n        var val_old = kwd.posts_active;\r\n        var basic_active = kwd.use && kwd.kwds.length!==0 && (kwd.sub || kwd.name || kwd.com || kwd.file || kwd.meta);\r\n        kwd.active       = basic_active && (kwd.op || kwd.post);\r\n        kwd.posts_active = basic_active &&            kwd.post;\r\n        if (!init && !kwd.posts_active && val_old) format_html.posts_search_inactivated();\r\n        kwd.timestamp = filter_kwd_count++; // not saved because pref.default() don't geenrate this. // use single entity for multi catalog or switching pref.*.filter object.\r\nif (!pref.test_mode['59']) {\r\n        if (e && e.target.name==='catalog.filter.kwd.str' && kwd.match===0 && (!kwd.re || /^[\\w\\s]*$/.test(kwd.str))) {\r\n          for (var i in kwd.fail_list) {\r\n            if (kwd.str.indexOf(kwd.fail_list[i])!==0) delete kwd.fail_list[i];\r\n            else if (kwd.fail_list[i]===kwd.str) kwd.timestamp = i;\r\n          }\r\n          for (var i in kwd.suc_list) {\r\n            if (kwd.suc_list[i].indexOf(kwd.str)!==0) delete kwd.suc_list[i];\r\n            else if (kwd.suc_list[i]===kwd.str) kwd.timestamp = i;\r\n          }\r\n        } else {\r\n          kwd.fail_list = {};\r\n          kwd.suc_list  = {};\r\n        }\r\n        if (kwd.str) {\r\n          kwd.fail_list[kwd.timestamp] = kwd.str;\r\n          kwd.suc_list[kwd.timestamp]  = kwd.str;\r\n        }\r\n}\r\n        if (!init) catalog_filter_changed();\r\n      }\r\n// pref.catalog.filter.kwd: {use:true, op:true, posts:false, sub:true, name:true, trip:true, com:true, file:true, re:false, ci:true, match:true, str:'', kwds:[]}\r\n//                     posts: [sub:null, com:null, name:null, trip:null, filename:null]\r\n      var catalog_filter_query_keyword = (function(){\r\n        function query_1(kwd, rexp, posts, domain, th){\r\n          if (kwd.op) if (query_11(kwd, rexp, posts[0].DUMMY && th || posts[0], domain)) return true;\r\n          if (kwd.post) for (var j=1;j<posts.length;j++) if (query_11(kwd, rexp, posts[j], domain)) return true;\r\n          return false;\r\n        }\r\n//        function query_1(kwd, rexp, posts, domain, th){ // working code.\r\n//          var post_array = Array.isArray(posts);\r\n//          var start = (!post_array || kwd.op)? 0 : 1; // temporarily\r\n//          var end   = ( post_array && kwd.post)? posts.length : 1; // tamporarily\r\n//          for (var j=start;j<end;j++) {\r\n//            var pst = (post_array)? posts[j] : (j==0)? posts : null;\r\n//            if (pst && query_11(kwd, rexp, pst, domain)) return true; // if posts are not exist, th.posts becomes 'undefined'.\r\n//          }\r\n//          return false;\r\n//        }\r\n////        var com2txt_flag = false; // SLOW.\r\n////        var com2txt_rexp = /<[^>]*>|&([#\\w\\d]*);/g\r\n////        var com2txt_subs = {\r\n////          gt : '>',\r\n////          lt : '<',\r\n////          amp: '&',\r\n////          hellip: '\\u2026',\r\n////          larr: '\\u2190',\r\n////          rarr: '\\u2192',\r\n////          mdash: '\\u2014',\r\n////          ndash: '\\u2013',\r\n////          qout:'\"', // 4chan\r\n////          '#039':\"'\", // 4chan\r\n////          '#044':',', // 4chan\r\n////          '#44' :',', // 4chan\r\n////        };\r\n////        function com2txt(match,p1,offset,string){\r\n////          if (match[0]==='&') {\r\n////            var retval = com2txt_subs[p1];\r\n////            if (retval) return retval;\r\n////            com2txt_flag = true;\r\n////            if (pref.debug_mode['17']) console.log('not interpreted html: '+match+', '+string);\r\n////          }\r\n////          return ' '; // case of <[^>]*> or not interpreetd.\r\n////        }\r\n        var pn_com = document.createElement('div');\r\n//        var pn_com = document.createElement('textarea'); // preserve tags in HTML. // slower than div.\r\n        function query_11(kwd, rexp, pst, domain){\r\n          if (kwd.sub)  if (pst.sub  && rexp.test(pst.sub )) return true;\r\n          if (kwd.name) if (pst.name && rexp.test(pst.name)) return true;\r\n          if (kwd.com)  if (pst.com) {\r\n            if (pst.parse_funcs && pst.parse_funcs.type_com==='txt' || pref.test_mode['53']) {\r\n              if (rexp.test(pst.body || pst.com)) return true; // fastest, speed ratio: part/total = 1/1.\r\n            } else {\r\n              if (!pref.test_mode['54']) {\r\n////                if (!pref.test_mode['57']) {\r\n                  var txt = site2[domain].post_com2txt(pst.com); // 9.4/1.99 for lainchan, 13.07/2.38 for 4chan.\r\n                  if (txt.search(/&[#\\w\\d]+;/)!=-1 && !pref.test_mode['58']) {\r\n                    if (pref.debug_mode['17']) console.log('not interpreted html: '+txt);\r\n                    pn_com.innerHTML = pst.com; // giving com is faster than giving txt.\r\n                    txt = pn_com[brwsr.innerText];\r\n                  }\r\n                  if (rexp.test(txt)) return true;\r\n////                } else { // SLOW.\r\n////                  com2txt_flag = false;\r\n//////                  var txt = pst.com.replace(com2txt_rexp, com2txt); // StringReplaceGlobalRegexpWithfunction is heavy. 19.76/3.33\r\n////                  var txt = pst.com.replace(/<[^>]*>|&([#\\w\\d]*);/g, com2txt); // This still outs StringReplaceGlobalRegexpWithfunction.\r\n////                  if (com2txt_flag) {\r\n////                    pn_com.innerHTML = pst.com;\r\n////                    txt = pn_com[brwsr.innerText];\r\n////                  }\r\n////                  if (rexp.test(txt)) return true;\r\n////                }\r\n              } else {\r\n                pn_com.innerHTML = (!pref.test_mode['55'])? pst.com :  // TOO SLOW!!!. 53.72/7.65\r\n                                                            pst.com.replace(/<[^>]*>/g,' ');  // TOO SLOW, FURTHER!!!. 60.51/8.21\r\n                if (rexp.test(pn_com[brwsr.innerText])) return true;\r\n              }\r\n            }\r\n          }\r\n//          if (kwd.trip) if (pst.trip && kwd.test(pst.trip)) return true;\r\n          if (kwd.file) {\r\n            if (pst.filename && rexp.test(pst.filename)) return true;\r\n            if (pst.extra_files)\r\n              for (var k=pst.extra_files.length-1;k>=0;k--)\r\n                if (pst.extra_files[k].filename && rexp.test(pst.extra_files[k].filename)) return true;\r\n          }\r\n          if (kwd.meta) if (pst.no && rexp.test(pst.no)) return true;\r\n          return false;\r\n        }\r\n        return {\r\n          kwd: function(kwd,posts, domain, th){\r\n            if (!kwd.use || kwd.kwds.length==0) return true;\r\n//            var retval = kwd.match<2; // working code.\r\n//            if (kwd.match%2===0) { // all\r\n//              for (var i=0;i<kwd.kwds.length;i++) if (retval!==query_1()) return false;\r\n//              return true;\r\n//            } else {\r\n//              for (var i=0;i<kwd.kwds.length;i++) if (retval===query_1()) return true;\r\n//              return false;\r\n//            }\r\n            var all_or_any = kwd.match%2===0;\r\n            var testval = !!((kwd.match<2) ^ all_or_any);\r\n            for (var i=0;i<kwd.kwds.length;i++) if (testval===query_1(kwd, kwd.kwds[i], posts, domain, th)) return !all_or_any;\r\n            return all_or_any;\r\n          },\r\n          kwd_1: function(kwd,posts, domain){ // for single post, match any or unmatch all.\r\n            var match_or_unmatch = kwd.match<2; // match_or_unmatch\r\n            for (var i=0;i<kwd.kwds.length;i++) if (query_11(kwd, kwd.kwds[i], posts, domain)) return match_or_unmatch; // match any or unamtch all\r\n            return !match_or_unmatch;\r\n          },\r\n          kwd_make_result: function(posts, domain){\r\n            var result = [Object.create(posts[0])]; // not to change source for 'posts_search_miss'. // BUG. wrapper just add protptpye to itself, it doesn't take this into account, but patched.\r\n//            var result = [posts[0]]; // can't update omitted info in page mode.\r\n            result[0].search_result = this.kwd_1(pref.catalog.filter.kwd, posts[0], domain);\r\n            for (var i=1;i<posts.length;i++) if (this.kwd_1(pref.catalog.filter.kwd, posts[i], domain)) result[result.length] = posts[i];\r\n            return (result.length!=1 || this.kwd_1(pref.catalog.filter.kwd, posts[0], domain))? result : null;\r\n          }\r\n        };\r\n      })();\r\n      cataLog.catalog_filter_query_keyword = catalog_filter_query_keyword;\r\n//        for (var i=0;i<kwd.kwds.length;i++) { // OR\r\n//          for (var j=start;j<end;j++) {\r\n//            var pst = (post_array)? posts[j] : (j==0)? posts : null;\r\n//            if (pst!==null) {\r\n//              if (kwd.sub)  if (pst.sub  && kwd.kwds[i].test(pst.sub )) return retval;\r\n//              if (kwd.com)  if (pst.com  && kwd.kwds[i].test(pst.com )) return retval;\r\n//              if (kwd.name) if (pst.name && kwd.kwds[i].test(pst.name)) return retval;\r\n//              if (kwd.trip) if (pst.trip && kwd.kwds[i].test(pst.trip)) return retval;\r\n//              if (kwd.file) {\r\n//                if (pst.filename && kwd.kwds[i].test(pst.filename)) return retval;\r\n//                if (pst.extra_files)\r\n//                  for (var k=pst.extra_files.length-1;k>=0;k--) \r\n//                    if (pst.extra_files[k].filename && kwd.kwds[i].test(pst.extra_files[k].filename)) return retval;\r\n//              }\r\n//            }\r\n//          }\r\n//        }\r\n//        return !retval;\r\n//      function catalog_filter_query_keyword(str_in){\r\n//        if (!pref.catalog.filter.kwd.use) return true;\r\n//        var kwd = pref.catalog.filter.kwd.str;\r\n//        if (kwd==='') return true;\r\n//        var str = ((pref.catalog.filter.kwd.op       )? str_in[0]+'\\n' : '')\r\n//                + ((pref.catalog.filter.kwd.op_sub   )? str_in[1]+'\\n' : '')\r\n//                + ((pref.catalog.filter.kwd.op_name  )? str_in[2]+'\\n' : '')\r\n//                + ((pref.catalog.filter.kwd.op_file  )? str_in[3]+'\\n' : '')\r\n//                + ((pref.catalog.filter.kwd.post     )? str_in[4]+'\\n' : '')\r\n//                + ((pref.catalog.filter.kwd.post_sub )? str_in[5]+'\\n' : '')\r\n//                + ((pref.catalog.filter.kwd.post_name)? str_in[6]+'\\n' : '')\r\n//                + ((pref.catalog.filter.kwd.post_file)? str_in[7]+'\\n' : '');\r\n//        if (str==='') return true;\r\n//\r\n//        var flag = true;\r\n//        var kwds = kwd.split(' ');\r\n//        for (var i=0;i<kwds.length;i++) {\r\n//          if (kwds[i]==='') continue;\r\n//          kwd = kwds[i];\r\n//          if (!pref.catalog.filter.kwd.re) kwd = kwd.replace(/[\\.\\(\\)\\[\\]\\+\\?\\^\\$\\{\\}]/g,'\\\\$&').replace(/\\*/g,'.*');\r\n//          if (pref.catalog.filter.kwd.ci) kwd = new RegExp(kwd,'i');\r\n//          var result = (str.search(kwd)!=-1);\r\n//          if (pref.catalog.filter.kwd.match==='unmatch') result = !result;\r\n//          flag = flag & result;\r\n//        }\r\n//        return flag;\r\n//      }\r\n////////      function catalog_filter_query_tag(tags){ // working code.\r\n//////////        if (!pref.catalog.filter.tag || filter_tags.length==0) return true;\r\n////////        if (!pref.catalog.filter.tag) return true;\r\n////////if (pref.test_mode['22']) {\r\n////////        if (filter_tags.length==0) return false;\r\n////////        if (!tags) return false;\r\n//////////console.log(tags);\r\n////////        for (var i=0;i<tags.length;i++)\r\n////////          for (var j=0;j<filter_tags.length;j++)\r\n////////            if (tags[i].search(filter_tags[j])!=-1) return true;\r\n////////        return false;\r\n////////} else {\r\n////////        return liveTag.search_by_tags(tags);\r\n////////}\r\n////////      }\r\n      function catalog_filter_query(name, no_reset){\r\n        var tgt_th = threads[name];\r\n        var val_old = tgt_th[9][0];\r\n        tgt_th[9][0] = catalog_filter_query_1(name, tgt_th);\r\n        if (!no_reset && val_old !== tgt_th[9][0]) drawn_idx = 0;\r\n        return tgt_th[9];\r\n      }\r\n      function catalog_filter_query_1(name, tgt_th){\r\n        if (tgt_th[16].show_always && !pref.catalog.filter.kwd.active) return true; // can't set 'tgt_th[16].icon_show_always' if (tgt_th[0]===null)\r\n        if (pref.catalog.filter.tag) if (!liveTag.search_by_tags(tgt_th[17])) return false;\r\n        if (pref.catalog.filter.time)          if ((tgt_th[8][4]||tgt_th[8][0])<=pref3.catalog.filter.time_obj) return false;\r\n        if (pref.catalog.filter.time_creation) if ( tgt_th[8][1]               <=pref3.catalog.filter.time_obj) return false;\r\n//        if (pref.catalog.filter.time) { // working code.\r\n//          var time = Date.parse(pref.catalog.filter.time_str);\r\n////          if (tgt_th[8][0]<=time && tgt_th[8][4]<=time) return [false];\r\n//          if ((tgt_th[8][4]||tgt_th[8][0])<=time) {tgt_th[9][0] = false; return;}\r\n//        }\r\n        if (pref.catalog.filter.list && (!pref.catalog.filter.kwd.active || !pref.filter.disable_list_when_kwd_active)) { // use [1]\r\n          var retval = catalog_filter_query_time_list(name);\r\n          if (retval[0]===false) {tgt_th[9] = retval; return tgt_th[9][0];}\r\n        }\r\n//        else if (pref.catalog.filter.list_mark_time) [true, get_mark_time(name)];\r\n        if (pref.catalog.filter.kwd.active) { // use [2],[3]\r\n          var tgt_posts = (pref.catalog.filter.kwd.post && pref[embed_mode].t2h_sel!=='no' && tgt_th[16].th && tgt_th[16].th.posts) || tgt_th[4];\r\nif (pref.test_mode['59']) { // BUG. THIS DOESN'T WORK WITH OTHER FILTERS, NEEDS TO BE SPLITTED. \r\n          if (!catalog_filter_query_keyword.kwd(pref.catalog.filter.kwd, tgt_posts, common_func.fullname2dbt(name)[0])) return false;\r\n} else {\r\n          if (!((pref.catalog.filter.kwd.fail_list[tgt_th[9][3]] && tgt_th[9][2]===false) ||\r\n                (pref.catalog.filter.kwd.suc_list[tgt_th[9][3]]  && tgt_th[9][2]===true ))) {\r\n            tgt_th[9][3] = pref.catalog.filter.kwd.timestamp;\r\n            tgt_th[9][2] = catalog_filter_query_keyword.kwd(pref.catalog.filter.kwd, tgt_posts, common_func.fullname2dbt(name)[0]);\r\n          } else {\r\n            if (pref.debug_mode['18'] && tgt_th[9][2]!==catalog_filter_query_keyword.kwd(pref.catalog.filter.kwd, tgt_posts, common_func.fullname2dbt(name)[0])) console.log('BUG, test59, '+name);\r\n          }\r\n          if (!tgt_th[9][2]) return false;\r\n}\r\n//          else if (pref[embed_mode].popup2==='sr' || pref[embed_mode].popup2==='srpv') tgt_th[10] = catalog_filter_query_keyword.kwd_make_result(tgt_posts);\r\n        }\r\n        return true;\r\n      }\r\n      cataLog.catalog_filter_query = catalog_filter_query;\r\n////      function catalog_filter_query_scan(posts,tags){\r\n////        if (!catalog_filter_query_keyword.kwd(pref.catalog.filter.kwd, posts)) return false;\r\n//////        if (!catalog_filter_query_keyword(str)) return false;\r\n////if (pref.test_mode['22']) {\r\n////        if (!catalog_filter_query_tag(tags)) return false;\r\n////} else {\r\n//////        if (!catalog_filter_query_tag(tags[0][0].concat(tags[1][0]))) return false;\r\n////        if (pref.catalog.filter.tag) if (!liveTag.search_by_tags(tags)) return false;\r\n////}\r\n////        return true;\r\n////      }\r\n      function catalog_filter_query_time_list(name){\r\n        var val = pref_func.merge_obj5(name,pref.catalog.filter.list_obj2,{hit:false});\r\n//        if (val.time) return [(!pref.catalog.filter.list || val.time<threads[name][8][0] || val.time<threads[name][8][4]), val.time]; // hit always.\r\n        if (val.time) return [(!pref.catalog.filter.list || val.time<(threads[name][8][4]||threads[name][8][0])), val.time]; // hit always.\r\n        else if (val.hit) return [!pref.catalog.filter.list];\r\n        return [true];\r\n      }\r\n      function catalog_filter_changed(){\r\nif (pref.test_mode['60']) {        \r\n        if (pref.catalog.filter.kwd.use || pref.catalog.filter.tag || pref.catalog.filter.time || pref.catalog.filter.list) for (var th in threads) threads[th][9] = catalog_filter_query(th);\r\n        else {\r\n//          for (var th in threads) threads[th][9] = [true];\r\n          for (var th in threads) threads[th][9][0] = true;\r\n          drawn_idx = 0;\r\n        }\r\n} else {\r\n        var val = (pref.catalog.filter.kwd.use || pref.catalog.filter.tag || pref.catalog.filter.time || pref.catalog.filter.list)? null : true;\r\n        for (var th in threads) threads[th][9][0] = val;\r\n        drawn_idx = 0;\r\n}  \r\n        if (show_catalog) show_catalog(); // 'if (show_catalog)' is a patch.\r\n//console.log('filter_changed');\r\n//        catalog_refresh_gather_info(); // cut at 2015.05.15.\r\n      }\r\n      cataLog.catalog_filter_changed = catalog_filter_changed;\r\n      function catalog_attr_changed(){\r\n//        if (pref.catalog.filter.attr_list)\r\n//          for (var th in threads) catalog_attr_set(th,threads[th][0]);\r\n//        if (pref.catalog.filter.attr_list) {\r\n          pref_func.apply_prep(attr_list,true);\r\n          for (var name in threads) catalog_attr_set(name,threads[name][0]);\r\n//          show_catalog(); // don't require.\r\n//        }\r\n      }\r\n\r\n      var pop_up_delay_id = {};\r\n      function pop_up_delay(e,name){\r\n        if (pref[embed_mode].popup2==='no') return; \r\n//        if (threads[name][0].style.width=='' && threads[name][0].style.height=='' && pref.catalog_no_popup_at_expanded) return;\r\n        if (pref.catalog_popdown=='imm' || pop_up_status[name]) pop_up_op(e,name); // patch\r\n        else {\r\n          if (pop_up_delay_id[name]) clearTimeout(pop_up_delay_id[name]);\r\n          else { // init\r\n            threads[name][0].addEventListener('mousemove' , threads[name][2][1]);\r\n            threads[name][6] = function(){clearTimeout(pop_up_delay_id[name]);};\r\n            threads[name][0].addEventListener('mouseout'  , threads[name][6]);\r\n          }\r\n          pop_up_delay_id[name] = setTimeout(function(){pop_up_op(e,name);},pref.catalog_popup_delay);\r\n        } \r\n      }\r\n      function pop_up_op(e,name){\r\n        if (pop_up_status[name]) {\r\n          pop_keep_event(name);\r\n          return;\r\n        }\r\n        var ch = threads[name][0];\r\n        if (pop_up_delay_id[name]) {\r\n          ch.removeEventListener('mousemove' , threads[name][2][1]);\r\n          ch.removeEventListener('mouseout'  , threads[name][6]);\r\n          delete pop_up_delay_id[name];\r\n        }\r\n        var th = threads[name][7];\r\nif (!pref.test_mode['49'] && pref.catalog.filter.kwd.posts_active && th) {\r\n        var search_result = (pref[embed_mode].popup2==='sr' || pref[embed_mode].popup2==='srpv')? catalog_filter_query_keyword.kwd_make_result(th.posts, th.domain, th) : null; // lazy\r\n}\r\n        if (pref[embed_mode].popup2==='sr' && !search_result) return;\r\n        var pn = cnst.init('pop:border:1px solid blue');\r\n        if (document.documentElement.clientWidth/2-e.clientX>0) pn.style.left = e.clientX + 10 + 'px';\r\n        else pn.style.right = document.documentElement.clientWidth - e.clientX + 10 + 'px';\r\n        if (document.documentElement.clientHeight/2-e.clientY>0) pn.style.top = e.clientY + 10 + 'px';\r\n        else  pn.style.bottom = document.documentElement.clientHeight - e.clientY + 10 + 'px';\r\n        if (pref[embed_mode].popup2!=='chart') {\r\nif (!pref.test_mode['49']) {\r\n          var lth = th.lth;\r\n          th = (pref[embed_mode].popup2==='dp')? {posts:[{search_result:false, __proto__:th.posts[0]}].concat(lth.pd || []), __proto__:th} :\r\n               (pref[embed_mode].popup2!=='pv' && search_result && {posts:search_result, __proto__:th}) || th;\r\n          format_html.prepare_html_prep_posts(th); // REDUNDANT for 2nd times or later.\r\n//          insert_thread_prepare_html_lazy(threads[name], !threads[name][0], false, true); // is this the better? not debugged yet.\r\n          var pn_result = site2[site.nickname].page_json2html3(th,th.board,th.op_img_url, true);\r\n//          if ((search_result || pref[embed_mode].popup2==='dp') && th.posts[0].search_result===false) site2[th.domain_html].update_posts0_class(th.posts[0].pn, th.posts[0].search_result);\r\n          for (var i=0;i<th.posts.length;i++) site2[th.domain_html].format_pn(th.posts[i].pn, lth.q && lth.q[th.posts[i].no], null, th.posts[i]);\r\n          pn.appendChild(pn_result);\r\n          catalog_attr_set(name,pn.childNodes[0]);\r\n} else {\r\n          pn.innerHTML = threads[name][3][0];\r\n          trim_html(pn, threads[name][3][1], pref[embed_mode].format.hover, name);\r\n          trim_html_mark_time(pn, threads[name][3][1], pref[embed_mode].format.hover, name);\r\n          var nickname = name.replace(/\\/.*/,'');\r\n//        if (pref.catalog.filter.list_mark_time && threads[name][9][1]) site2[nickname].mark_newer_posts(pn,threads[name][9][1]);\r\n          var date = get_mark_time(name, pref[embed_mode].mark_new_posts, pref[embed_mode].mark_new_posts, pref[embed_mode].mark_new_posts);\r\n          if (date>0) site2[nickname].mark_newer_posts(pn,date);\r\n          threads[name][12] = add_open_new_thread_event(name,site2[nickname].modify_thread_link(pn));\r\n          catalog_attr_set(name,pn);\r\n}\r\n        }\r\n        pn = site.root_body.appendChild(pn);\r\n        if (pref.catalog_popup_size_fix) { \r\n          pn.style.width  = pn.offsetWidth + 'px';\r\n          pn.style.height = pn.offsetHeight + 'px';\r\n        }\r\n        pop_up_status[name] = [null, function(){pop_down_event(name);}, function(){pop_keep_event(name);}, ch, pn];\r\n        if (pref[embed_mode].popup2==='chart') {\r\n          if (chart_obj && pref3.stats.use) {\r\n            pop_up_status[name][5] = new chart_obj.PostChart(pn,[name]); // must be after appendChild to draw.\r\n          } else pn.innerHTML = 'Statistics needs to be activated.';\r\n        }\r\n        if (pref.catalog_popdown=='imm') {\r\n          if (document.documentElement.clientHeight/2-e.clientY>0) {\r\n            if (parseInt(pn.style.top.replace(/px/,''),10) + pn.offsetHeight > document.documentElement.clientHeight) {\r\n              if (pn.offsetHeight > document.documentElement.clientHeight) pn.style.top = '0px';\r\n              else {pn.style.top = ''; pn.style.bottom = '0px';}\r\n            }\r\n          } else if (parseInt(pn.style.bottom.replace(/px/,''),10) + pn.offsetHeight > document.documentElement.clientHeight) {pn.style.bottom = ''; pn.style.top = '0px';}\r\n        } else {\r\n          pn.addEventListener('mouseover', pop_up_status[name][2], false);\r\n          pn.addEventListener('mouseout', pop_up_status[name][1], false);\r\n        }\r\n        ch.addEventListener('mouseout', pop_up_status[name][1], false);\r\n      }\r\n      function pop_keep_event(name){\r\n        if (pop_up_status[name][0]) {clearTimeout(pop_up_status[name][0]);pop_up_status[name][0]=null;}\r\n      }\r\n      function pop_down_event(name){\r\n        if (!pop_up_status[name][0]) pop_up_status[name][0] = setTimeout(function(){pop_down_op(name);},(pref.catalog_popdown=='imm')? 0 : pref.catalog_popdown_delay);\r\n      }\r\n      function pop_down_op(name){\r\n        if (pop_up_status[name][5]) pop_up_status[name][5].destroy();\r\n//        if (pop_up_status[name]==undefined) return;\r\n        ch = pop_up_status[name][3];\r\n        pn = pop_up_status[name][4];\r\n        ch.removeEventListener('mouseout' , pop_up_status[name][1], false);\r\n        if (pref.catalog_popdown!='imm') {\r\n          pn.removeEventListener('mouseover', pop_up_status[name][2], false);\r\n          pn.removeEventListener('mouseout' , pop_up_status[name][1], false);\r\n        }\r\n        if (threads[name][12]) threads[name][12] = remove_open_new_thread_event(threads[name][12]);\r\n        pn = cnst.div_destroy(pn,true);\r\n        delete pop_up_status[name]; //prevent memory leak.\r\n      }\r\n\r\n//      var page_delim = [];\r\n//      for (var i=0;i<site.max_page;i++) page_delim[i] = null;\r\n//      var page_delim_idx = [];\r\n\r\n      var load_list = {refresh: {key:'',    idx:0, tgts:null, mutex:true, use_cache:false, from_auto:false, page_check:true },\r\n                       ondemand:{key:'odl', idx:0, tgts:null, mutex:true, use_cache:false, from_auto:false, page_check:false},\r\n                       tag:     {key:'tag', idx:0, tgts:null, mutex:true, use_cache:true,  from_auto:false, page_check:false}};\r\n      var filter_tags_refresh_mem = {};\r\n      var refresh_use_cache = false;\r\n      function prep_reserved_tags(set,idx){\r\n        var tags = pref.catalog_board_list_obj[idx] && pref.catalog_board_list_obj[idx][0].tags || null;\r\n        return (tags)? liveTag.tags_reserved_init(tags,set) : null; // 'liveTag.tags_reserved_init' modifies tags.\r\n      }\r\n//      function prep_reserved_tags(set,idx){ // working code.\r\n//        var tags = pref.catalog_board_list_obj[idx][0].tags || null;\r\n//        if (tags) {\r\n//          tags = tags.slice();\r\n//          liveTag.set_reserved_tags(tags,set);\r\n//          if (set) liveTag.reserved = (tags.length!==0)? tags : null;\r\n//        }\r\n//      }\r\n      function make_refresh_list(sel,bookmark_list_str){\r\n//      function make_refresh_list(remove_attr){\r\n        var tgts = [];\r\n        if (site.whereami==='boards' && sel==0) pref_func.str2obj('catalog_board_list_str');\r\n        var blist = pref.catalog_board_list_obj[sel].slice();\r\n        var domains = blist[0].domains_for_all_boards;\r\n        if (domains) {\r\n          for (var i=0;i<domains.length;i++) {\r\n            var domain = domains[i];\r\n            if (!site3[domain].boards) return function(callback){ // singlelined because this may cause infinite loop if reading boards_json is failed.\r\n              site2[domain].get_boards_json('refresh_boards_json',callback,false,health_indicator);};\r\n//            if (!site3[domain].boards) {\r\n//              site2[domain].get_boards_json('refresh_boards_json',reentry_func,false,health_indicator);\r\n//              return tgts; // singlelined because this may cause infinite loop if reading boards_json is failed.\r\n//            }\r\n          }\r\n          for (var i=0;i<domains.length;i++)\r\n            for (var j in liveTag.mems[domains[i]]) blist[blist.length] = liveTag.mems[domains[i]][j];\r\n        }\r\n        var bds_picked_up_by_tags = prep_reserved_tags(true,sel);\r\n        for (var bd in bds_picked_up_by_tags) {\r\n          for (var j=1;j<blist.length;j++) if (blist[j].key===bd) break;\r\n          if (j==blist.length) blist[blist.length] = liveTag.mems.getFromName(bd); // scan.add_board(bd);\r\n        }\r\n        if (bookmark_list_str) tgts = bookmark_list_str.replace(/\\/\\/.*$/mg,',').replace(/\\n/g,',').replace(/,,+/g,',').replace(/^,/,'').replace(/,$/,'').split(',');\r\n        if (tgts[0]==='') tgts = [];\r\n//        var page_str = (pref.catalog.design==='page')? 'p' : 'c';\r\n        var j = 0;\r\n        while (blist.length>1) {\r\n          for (var i=1;i<blist.length;i++) {\r\n            var key = blist[i].key.replace(/\\s/g,''); // replace... is redundant\r\n            var dbt = cnst.name2domainboardthread(key,true);\r\n            var max_page_bd = pref.catalog_max_page_select==='auto' && liveTag.mems[dbt[0]] && liveTag.mems[dbt[0]][dbt[1]] && liveTag.mems[dbt[0]][dbt[1]].pgs || pref.catalog_max_page;\r\n            if (dbt[2]) {\r\n              if (j==0) tgts.push(key);\r\n              else blist.splice(i--,1)\r\n            } else if ((!blist[i].max_page || j<blist[i].max_page) && j<max_page_bd) tgts.push(key+ ((pref.catalog.catalog_json)? 'q':'p') +j);\r\n            else blist.splice(i--,1)\r\n          }\r\n          j++;\r\n        }\r\n\r\n////        for (var j=0;j<pref.catalog_max_page;j++) // working code.\r\n////          for (var i=1;i<blist.length;i++) {\r\n//////            if (blist[i]['key'].search(/[^\\/]*\\/[^\\/]*\\/[0-9]+/)!=-1) {if (j==0) tgts.push(blist[i]['key']);} // working code.\r\n////            var key = blist[i].key.replace(/\\s/g,''); // replace... is redundant\r\n////            if (common_func.fullname2dbt(key)[2]) {if (j==0) tgts.push(key);}\r\n////            else if (!blist[i].max_page || j<blist[i].max_page) tgts.push(key+ ((pref.catalog.catalog_json)? 'q':'p') +j);\r\n////          }\r\n//////        if (remove_attr) for (var i=0;i<tgts.length;i++) tgts[i] = tgts[i].replace(/!.*/,'');\r\n//////        for (var i=tgts.length-1;i>=0;i--) { // working code\r\n//////          var dbt = cnst.name2domainboardthread(tgts[i],true);\r\n//////          if (tgts[i].indexOf(dbt[1])==-1) tgts[i] = dbt[0] + dbt[1] + tgts[i];\r\n//////          else if (tgts[i].indexOf(dbt[0])==-1) tgts[i] = dbt[0] + tgts[i];\r\n//////        }\r\n        return tgts;\r\n      }\r\n      function trim_list(tgts,embed_init, mode){\r\n        if (pref.catalog.board.ex_list) {\r\n          for (var i=tgts.length-1;i>=0;i--) {\r\n            var val = pref_func.merge_obj5(tgts[i],pref.catalog.board.ex_list_obj2,{hit:false});\r\n            if (val.hit) tgts.splice(i,1);\r\n          }\r\n        }\r\n        if (pref.catalog.design==='catalog' || (pref.catalog.design==='auto' && mode==='catalog') || mode==='chart') {\r\n          for (var i=tgts.length-1;i>=0;i--) {\r\n            var dbt = cnst.name2domainboardthread(tgts[i],true);\r\n            if (((dbt[0]!=='KC') || mode==='chart') && tgts[i].search(/\\/[pq][0-9]*/)!=-1) {\r\n//            if ((dbt[0]==='8chan' ||dbt[0]==='4chan') && tgts[i].search(/\\/p[0-9]*/)!=-1) {\r\n//            if (dbt[0]==='8chan' && tgts[i].search(/\\/p[0-9]*/)!=-1) {\r\n//              if (tgts[i].search(/\\/p0$/)!=-1 && (!embed_init || dbt[1]!=site.board)) tgts[i] = tgts[i].replace(/p0/,(pref.catalog.catalog_json)? 'j0' : 'c0');\r\n              if (tgts[i].search(/\\/[pq]0$/)!=-1 && (!embed_init || dbt[1]!=site.board || dbt[0]!=site.nickname || (dbt[0]==='4chan' || dbt[0]==='meguca' || pref3.stats.use)))\r\n                tgts[i] = tgts[i].replace(/[pq]0/,(pref.catalog.catalog_json || (dbt[0]==='4chan' || dbt[0]==='meguca'))? 'j0' : 'c0');\r\n              else if (tgts[i].search(/\\/[pq][0-9]$/)!=-1) tgts.splice(i,1); // ratain thread\r\n            }\r\n          }\r\n        }\r\n        if (mode==='page' && embed_init) { // patch\r\n          if (pref.liveTag.use || pref.liveTag.from==='post') {\r\n            var bds = {};\r\n            for (var i=0;i<tgts.length;i++) {\r\n              var dbt = cnst.name2domainboardthread(tgts[i],true);\r\n              bds[dbt[0]+dbt[1]+((pref.catalog.catalog_json)? 'j0':'c0')] = null;\r\n            }\r\n            for (var i in bds) tgts[tgts.length] = i;\r\n//            cataLog.scan_init('init_tag',bds, {tag_only:true});\r\n          }\r\n//          if (pref.liveTag.use) { // working code.\r\n//            for (var i=0;i<tgts.length;i++) {\r\n//              var dbt = cnst.name2domainboardthread(tgts[i],true);\r\n//              scan.list_nup.add_board(dbt[0]+dbt[1]);\r\n//            }\r\n//          }\r\n          if (tgts[0] && tgts[0].search(site.nickname+site.board+'[pq]0')===0) tgts.splice(0,1);\r\n////          var site_db = site.nickname+site.board;\r\n////          for (var i=0;i<tgts.length;i++) { // working code, but obsolete.\r\n////            if (tgts[i].indexOf(site_db)===0) {\r\n////              if (tgts[i].search(site_db+'[pq]0')===0) tgts.splice(i--,1)[0];\r\n////              else if (pref[mode].load_on_demand) threads_idx[threads_idx.length] = 'ODL:'+tgts.splice(i--,1)[0];\r\n////            }\r\n////          }\r\n          if (pref[mode].load_on_demand) drawn_idx = 0;\r\n        }\r\n        if (mode==='thread') { // patch\r\n          if (board_sel.selectedIndex===0) {\r\n            if (embed_init) tgts.splice(0,1);\r\n            else tgts = [site.nickname + site.board + site.no];\r\n          }\r\n        }\r\n        for (var i=tgts.length-1;i>=0;i--) {\r\n          var dbt = common_func.name2dbt(tgts[i]);\r\n          var url = site2[dbt[0]].make_url4(dbt, pref.catalog.design!=='page' && (pref.catalog.indexing!==0 || pref.liveTag.use)); // trim for 4chan.\r\n          if (!url) tgts.splice(i,1);\r\n          else if (url[2] && url[2]!==tgts[i]) {\r\n            if (tgts.indexOf(url[2])!=-1) tgts.splice(i,1);\r\n            else tgts[i] = url[2];\r\n          }\r\n//          if (!site2[dbt[0]].make_url4(dbt)) tgts.splice(i,1);\r\n        }\r\n        return tgts;\r\n      }\r\n\r\n\r\n      function remove_threads_events(name){\r\n        if (threads[name][0]) threads[name][0].removeEventListener('mouseover', threads[name][2][0], false);\r\n        common_func.dom_removeEventListener(threads[name][5]);\r\n        if (threads[name][11]) threads[name][11] = remove_open_new_thread_event(threads[name][11]);\r\n      }\r\n      function remove_thread(name){\r\n        var ref = threads_idx.indexOf(name);\r\n        if (name.substr(0,4)!=='ODL:') {\r\n          if (!threads[name]) return;\r\n          var dbt = common_func.fullname2dbt(name);\r\n          var lth = liveTag.mems.getFromName(name);\r\n          if (threads[name][16].popups) for (var i in threads[name][16].popups) site2[dbt[0]].popups_release(lth.q, i, name); // remove cross thread/board links.\r\n          remove_threads_events(name);\r\n          if (threads[name][1]) {\r\n            if (pop_up_status[name]) pop_down_op(name);\r\n//            if (threads[name][0].parentNode===triage_parent) { // working code.\r\n////              if (pref.catalog_expand_with_hr && !embed_catalog) show_catalog_hr(name,'remove');\r\n////              triage_parent.removeChild(threads[name][0]); // for 4chan's native\r\n//              catalog_obj2.func_hide(name);\r\n//            }\r\n            if (threads[name][0] && threads[name][0].parentNode===triage_parent || pref[embed_mode].merge) // parent check is for on_demand_draw and merging threads.\r\n              catalog_obj2.func_hide(name);\r\n            if (ref<drawn_idx) drawn_idx = 0;\r\n          }\r\n//          if (lth) {\r\n//            delete lth.th;\r\n//            delete lth.ta;\r\n//            delete lth.pd;\r\n//          }\r\n        }\r\n        delete threads[name]; // remove 'ODL:' also\r\nif (pref.debug_mode['2']) console.log('removed: '+name);\r\n//        for (var i=threads_idx.length-1;i>=0;i--) if (threads_idx[i]===name) {threads_idx.splice(i,1);break;}\r\n        if (ref>=0) threads_idx.splice(ref,1);\r\n      }\r\n      cataLog.remove_thread = remove_thread;\r\n////      function remove_thread(name){ // working code.\r\n////        if (name.substr(0,4)!=='ODL:' && threads[name]) { // BUG. SHOULD WORK WITHOUT CHECKING threads[name]\r\n////          var dbt = common_func.fullname2dbt(name);\r\n////          if (threads[name][16].popups) for (var i=0;i<threads[name][16].popups.length;i++) site2[dbt[0]].popups_release(threads[name][16].popups[i]);\r\n//////        if (name.substr(0,4)!=='ODL:') {\r\n//////          if (threads[name][16].th_destroy) threads[name][16].th_destroy(threads[name][0], threads[name][16].parse_funcs);\r\n////          threads[name][0].removeEventListener('mouseover', threads[name][2][0], false);\r\n//////          threads[name][0].removeEventListener('click', threads[name][5], false);\r\n//////          for (var i=0;i<threads[name][5].length;i++) threads[name][5][i].removeEventListener('click', click_thread, false);\r\n////          common_func.dom_removeEventListener(threads[name][5]);\r\n////          if (threads[name][11]) remove_open_new_thread_event(threads[name][11]);\r\n////          if (threads[name][1]) {\r\n//////            if (threads[name][12]) remove_open_new_thread_event(threads[name][12]);\r\n////            if (pop_up_status[name]) pop_down_op(name);\r\n//////            triage_parent.removeChild(threads[name][0]);\r\n////            if (threads[name][0].parentNode===triage_parent) triage_parent.removeChild(threads[name][0]); // for 4chan's native\r\n////          }\r\n//////          if (threads[name][17][0][0].length!=0) liveTag.remove_tags_in_th(threads[name][17][0][0], name);\r\n//////          if (threads[name][17][1][0].length!=0) liveTag.remove_tags_in_th(threads[name][17][1][0], name);\r\n//////          liveTag.remove_tags_in_th(name);\r\n////        }\r\n////        delete threads[name]; // remove 'ODL:' also\r\n////if (pref.debug_mode['2']) console.log('removed: '+name);\r\n////        for (var i=threads_idx.length-1;i>=0;i--) if (threads_idx[i]===name) {threads_idx.splice(i,1);break;}\r\n////      }\r\n      var threads_candidates_of_deletion = null;\r\n      function catalog_clear_threads_candidates_of_deletion(num, schedule){\r\n        if (threads_candidates_of_deletion!==null) {\r\n          for (var name in threads_candidates_of_deletion)\r\n           if (threads[name] && threads_candidates_of_deletion[name]===((threads[name][8][0]>threads[name][8][4])? threads[name][8][0] : (threads[name][8][4] || threads[name][8][0]))) remove_thread(name);\r\n          threads_candidates_of_deletion = null;\r\n        }\r\n      }\r\n      function catalog_clear_threads(num, schedule){\r\n//        threads_last_deleted = {};\r\n//        catalog_triage_out();\r\n        var idx = 0;\r\n        while (idx<threads_idx.length && idx<num) if (threads_idx[idx++].substr(0,4)==='ODL:') num++;\r\n        if (!schedule) {\r\n          triage.off_delay();\r\n          while (threads_idx.length>num) {\r\n            var name = threads_idx[threads_idx.length-1];\r\n//          if (name.substr(0,4)!=='ODL:') threads_last_deleted[name] = {sticky:threads[name][20], last_post_time:threads[name][8][4], last_post_count:threads[name][8][2]};\r\n//          threads_last_deleted[name] = threads[name][20];\r\n            remove_thread(name);\r\n          }\r\n        } else {\r\n          if (threads_candidates_of_deletion===null) threads_candidates_of_deletion = {};\r\n          while (threads_idx.length>num) {\r\n            var name = threads_idx[num++];\r\n            if (name.substr(0,4)==='ODL:') {remove_thread(name);num--;}\r\n            else threads_candidates_of_deletion[name] = (threads[name][8][0]>threads[name][8][4])? threads[name][8][0] : (threads[name][8][4] || threads[name][8][0]);\r\n          }\r\n        }\r\n////////        if (!schedule) remake_boards();\r\n      }\r\n      cataLog.catalog_clear_threads = catalog_clear_threads;\r\n////////      function remake_boards(){\r\n////////        boards = {};\r\n////////        for (var name in threads) {\r\n////////          var dbt = cnst.name2domainboardthread(name,true);\r\n////////          boards[dbt[0]+dbt[1]] = null;\r\n////////        }\r\n////////      }\r\n      function catalog_refresh(refresh, embed_init, from_auto) {\r\n        if (pref.test_mode['67'] && !embed_init) archiver.refresh_start();\r\n        if (!embed_init && pref.catalog.auto_save_filter_at_refresh) onchange_funcs['save']();\r\n        var result = catalog_refresh_1(embed_mode, refresh, embed_init, from_auto, 'refresh', board_sel.selectedIndex, pref.catalog.filter.bookmark_list_str, false);\r\n        if (typeof(result)==='function') result(function(){catalog_refresh(refresh, embed_init, from_auto);});\r\n      }\r\n      function catalog_refresh_1(mode, refresh, embed_init, from_auto, scan_name, sel, bookmark_list_str, get_board_list, callback) {\r\n        var tgts = make_refresh_list(sel, bookmark_list_str);\r\n        if (typeof(tgts)==='function') return tgts; // must be reentried.\r\n        if (get_board_list) { // patch\r\n          var bds = {};\r\n          for (var i=0;i<tgts.length;i++) {\r\n            var dbt = common_func.name2domainboardthread(tgts[i],true);\r\n            if (dbt[2][0].search(/^[pqcj]/)!=-1) bds[dbt[0]+dbt[1]] = null;\r\n            else bds[dbt[0]+dbt[1]+dbt[2].replace(/^t/,'')] = null; // patch\r\n          }\r\n        }\r\n        if (scan_name && pref3.stats.use && pref.stats.auto_acquisition_all) stats.register_auto_acquisition(sel);\r\n        tgts = trim_list(tgts,embed_init, mode);\r\n        var priority = (!refresh)? 0 : (from_auto)? 2:4;\r\n        if (tgts.length===0) return (refresh)? scan.scan_refresh(health_indicator, tgts, priority) : tgts;\r\n        if (refresh) {\r\n          catalog_clear_threads_candidates_of_deletion();\r\n          if (pref.catalog_refresh_clear && !embed_init) catalog_clear_threads(pref.catalog.max_threads_at_refresh, true);\r\n        }\r\n////////        load_on_demand.release(); // prevent from hanging up.\r\n        if (scan_name) scan_boards.scan_init(scan_name, tgts,\r\n                                             {refresh:refresh,\r\n                                              callback:(callback)? function(){scan.scan_refresh(health_indicator, tgts, priority);callback();} :\r\n                                                                   function(){scan.scan_refresh(health_indicator, tgts, priority);},\r\n                                              from_auto:from_auto, load_on_demand:pref[mode].load_on_demand, priority:priority});\r\n        return (get_board_list)? Object.keys(bds) : tgts;\r\n      }\r\n      cataLog.catalog_refresh_1 = catalog_refresh_1;\r\n      \r\n////      function catalog_refresh(refresh, embed_init, from_auto, indicator) { // working code.\r\n//////if (pref.debug_mode['0']) console.log(new Date().toLocaleTimeString() + ', refresh: start: ');\r\n//////        set_auto_update();\r\n////        if (pref.catalog.filter.time_ago_str_sync_at_refresh) ago_clicked();\r\n////        load_list.refresh.use_cache = !refresh;\r\n////        load_list.refresh.idx = 0;\r\n////        load_list.refresh.mutex = true;\r\n////        load_list.refresh.from_auto = from_auto;\r\n////        load_list.refresh.tgts = trim_list(make_refresh_list(board_sel,pref.catalog.filter.bookmark_list),embed_init);\r\n////        if (load_list.refresh.tgts.length===0) return;\r\n////        if (threads_candidates_of_deletion!==null) {\r\n////          for (var name in threads_candidates_of_deletion)\r\n////           if (threads[name] && threads_candidates_of_deletion[name]===((threads[name][8][0]>threads[name][8][4])? threads[name][8][0] : (threads[name][8][4] || threads[name][8][0]))) remove_thread(name);\r\n////          threads_candidates_of_deletion = null;\r\n////////////          remake_boards();\r\n////        }\r\n////        if (refresh && pref.catalog_refresh_clear && !embed_init) catalog_clear_threads(pref.catalog.max_threads_at_refresh, true);\r\n//////        for (var i=0;i<load_list.refresh.tgts.length;i++) load_list.refresh.tgts[i] = [load_list.refresh.tgts[i], from_auto];\r\n////////////        load_on_demand.release(); // prevent from hanging up.\r\n////        if (load_list.refresh.idx<load_list.refresh.tgts.length) {\r\n//////if (!pref.test_mode['15']) scan_boards.scan_init('refresh', load_list.refresh.tgts, {refresh:true, crawler_max:1, indicator:indicator, callback:catalog_refresh_watch});\r\n//////if (!pref.test_mode['15']) scan_boards.scan_init('refresh', load_list.refresh.tgts, {refresh:true, indicator:indicator, callback:catalog_refresh_watch, from_auto:from_auto, load_on_demand:pref[embed_mode].load_on_demand});\r\n////if (!pref.test_mode['15']) scan_boards.scan_init('refresh', load_list.refresh.tgts, {refresh:true, callback:catalog_refresh_watch, from_auto:from_auto, load_on_demand:pref[embed_mode].load_on_demand, priority:(from_auto)?2:4});\r\n////else {\r\n//////          health_indicator.shift('limegreen','0');\r\n////          load_list.refresh.indicator = indicator;\r\n////          get_page(load_list.refresh);\r\n////}\r\n////        } else catalog_refresh_watch();\r\n//////        scan_boards.scan_init('refresh_tag',filter_tags_refresh_mem,(refresh)? 0 : pref.scan.lifetime*60, catalog_refresh_watch);\r\n////if (pref.test_mode['22'])\r\n////        scan_boards.scan_init('refresh_tag', filter_tags_refresh_mem, {lifetime:((refresh)? 0 : pref.scan.lifetime*60), cache_write:true});\r\n////      }\r\n////      \r\n////////      function catalog_refresh_watch() { // working code.\r\n//////////console.log('test');\r\n////////        var tgts = {};\r\n////////        for (var name in threads) if (threads[name][21]) tgts[name] = null;\r\n////////        scan_boards.scan_init('refresh_watch', tgts, {callback:catalog_refresh_gather_info, refresh:true});\r\n//////////console.time('refresh_watch');\r\n//////////        scan_boards.scan_init('refresh_watch', tgts, {callback:catalog_refresh_gather_info, force_json:pref.catalog.order.find_sage_in_8chan});\r\n////////      }\r\n////////      cataLog.catalog_refresh_watch = catalog_refresh_watch;\r\n////      function catalog_refresh_watch() { // working code, @safe1080\r\n////        catalog_refresh_gather_info();\r\n////      }\r\n////      var missing_info = {};\r\n////      function catalog_refresh_gather_info() {\r\n////        var tgts = missing_info;\r\n////        missing_info = {};\r\n//////////////console.timeEnd('refresh_watch');\r\n////////////        var tgts = {};\r\n////////////        for (var name in threads) {\r\n////////////          if (!pref.catalog.filter.time && !pref.catalog.filter.list && !threads[name][9][0]) continue;\r\n//////////////          var dbt = common_func.name2domainboardthread(name);\r\n//////////////          if (dbt[0]==='8chan' && pref.catalog.indexing==4 && threads[name][23]) tgts[name] = true; // get time of sage post in 8chan from json.\r\n//////////////          if (pref.catalog.indexing==4 && threads[name][23] && threads[name][23].time_posted===null) tgts[name] = true; // get time_posted\r\n////////////          if (pref.catalog.indexing==4 && threads[name][8][4]===undefined) tgts[name] = true; // get time_posted\r\n//////////////          if (!threads[name][9][0]) continue;\r\n//////////////          if (dbt[0]==='8chan' && pref.catalog.order.sticky!=='dont_care' && threads[name][20]===null) tgts[dbt[0]+dbt[1]] = true; // get sticky in 8chan from json.\r\n////////////        }\r\n//////////////console.log(tgts);\r\n////        scan_boards.scan_init('refresh_watch', tgts, {tgt_raw: true,\r\n////                                                      callback: function(){scan.scan_refresh(health_indicator);}});\r\n//////                                                      callback: (pref.liveTag.utilize_boards_json)? catalog_refresh_boards : catalog_liveTag_scan_boards,\r\n//////                                                      callback_args: (pref.liveTag.utilize_boards_json)? 'refresh_watch' : null});\r\n//////        if (pref.liveTag.utilize_boards_json && embed_mode==='catalog') catalog_liveTag_scan_threads(); // patch for 8chan, boards_json is too heavy.\r\n////      }\r\n////\r\n////      function catalog_refresh_boards() { // patch for 8chan // working code, @safe1069\r\n//////        if (liveTag.mems['8chan']) {\r\n//////          var tgts = scan.list_nup.get_list_board('8chan',true);\r\n////////          if (tgts.length!=0) http_req.get('refresh_watch','8chan,boards_json,boards_json,boards_json',site2['8chan'].url_boards_json(),catalog_refresh_boards_callback,0,true,catalog_liveTag_scan_boards);\r\n//////          if (tgts.length!=0) site2['8chan'].get_boards_json('refresh_watch',catalog_liveTag_scan_boards,true,health_indicator);\r\n//////          else catalog_liveTag_scan_boards();\r\n//////        } else catalog_liveTag_scan_boards();\r\n////        if (scan.list_nup.query_list_board('8chan')) {\r\n////          site2['8chan'].get_boards_json('refresh_watch',catalog_liveTag_scan_boards,true,health_indicator);\r\n////          return;\r\n////        }\r\n////        catalog_liveTag_scan_boards();\r\n////      }\r\n////////////      function catalog_refresh_boards_callback(key,value,callback){\r\n//////////////if (pref.debug_mode['7']) console.log('boards_json:');\r\n////////////        if (value.status==200) {\r\n////////////          var dbt = key.split(',');\r\n////////////          site2[dbt[0]].postprocess_board(value.response);\r\n////////////////          site3[dbt[0]].boards = value.response.boards || value.response; // patch for 8chan. WHY DO THEY CHANGE THE SPEC REPEATEDLY WITHOUT A PARTICULAR REASON??? // working code.\r\n////////////////          site3[dbt[0]].boards_to_scan = null;\r\n////////////////          if (site2[dbt[0]].make_site3_bds) site2[dbt[0]].make_site3_bds();\r\n////////////        }\r\n////////////        if (callback) callback();\r\n////////////      }\r\n////\r\n////      var mutex_wd_liveTag_scan_boards = new MutexWatchdog('scan');\r\n////      function catalog_liveTag_scan_boards(domain) {\r\n////        if (pref.liveTag.use) {\r\n////          if (!mutex_wd_liveTag_scan_boards.get()) {catalog_refresh_end(); return;}\r\n////          if (pref.debug_mode['7']) var d_str = '';\r\n////          var tgts = scan.list_nup.get_list_board(domain);\r\n////////          var tgts = []; // working code.\r\n////////          var time_th = Date.now()-pref.liveTag.pickup_interval*1000;\r\n////////          for (var i in scan.list_nup_boards) {\r\n////////            var dbt = common_func.fullname2dbt(i);\r\n////////            if (scan.list_nup_boards[i].time<time_th && (!scan.list_nup_boards[i].max || scan.list_nup_boards[i].max<liveTag.mems[dbt[0]][dbt[1]].max)) {\r\n////////              tgts[tgts.length] = i;\r\n////////              if (pref.debug_mode['7']) d_str += i + ':' +scan.list_nup_boards[i].max+'/'+liveTag.mems[dbt[0]][dbt[1]].max+', ';\r\n////////            }\r\n////////          }\r\n////          if (pref.debug_mode['7']) for (var i=0;i<tgts.length;i++) d_str += tgts[i].key + ':' +tgts[i].read_max+'/'+tgts[i].max+', ';\r\n////          if (Object.keys(tgts).length!=0) {\r\n////            scan_boards.scan_init('scan', tgts, {callback: catalog_liveTag_scan_boards_cont,\r\n////                                                 watchdog: mutex_wd_liveTag_scan_boards.restart.bind(mutex_wd_liveTag_scan_boards),\r\n////////////                                                 crawler_watchdog: true\r\n//////                                                 priority: 1,\r\n////                                                });\r\n////            if (pref.debug_mode['7']) console.log('catalog_liveTag_scan_boards: '+tgts.length+', '+d_str);\r\n////          } else {\r\n////            mutex_wd_liveTag_scan_boards.stop();\r\n////            catalog_liveTag_scan_threads();\r\n////          }\r\n////        } else catalog_liveTag_scan_threads();\r\n////      }\r\n////      function catalog_liveTag_scan_boards_cont() {\r\n////        mutex_wd_liveTag_scan_boards.stop();\r\n////        if (mutex_wd_liveTag_scan_boards.query_req()) catalog_liveTag_scan_boards();\r\n////        else catalog_liveTag_scan_threads();\r\n////      }\r\n////      function catalog_liveTag_scan_cancel() {\r\n////        mutex_wd_liveTag_scan_boards.abort();\r\n////        scan_boards.scan_abort('scan');\r\n////        mutex_wd_liveTag_scan_threads.abort();\r\n////        scan_boards.scan_abort('scan_threads');\r\n////      }\r\n////\r\n////      var catalog_liveTag_scan_threads_delayed_do = DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(catalog_liveTag_scan_threads, 200));\r\n////      var mutex_wd_liveTag_scan_threads = new MutexWatchdog('scan_threads');\r\n////      function catalog_liveTag_scan_threads() {\r\n////        if (!mutex_wd_liveTag_scan_threads.get()) {catalog_refresh_end();return;} // multi entry.\r\n////////        var tgts = []; // working code.\r\n////////        for (var i in scan.list_nup)\r\n////////////          if (scan.list_nup[i]!==null) {\r\n////////////            scan.list_nup[i] = null;\r\n////////////            tgts[tgts.length] = i;\r\n////////////          } else delete scan.list_nup[i];\r\n//////////          if (--scan.list_nup[i]>=0) tgts[tgts.length] = i; // leave nodes of <0 as black listed, patch for 8chan.\r\n////////          if (scan.list_nup[i]>0) tgts[tgts.length] = i;\r\n////        var tgts = scan.list_nup.get_list_thread();\r\n////        if (Object.keys(tgts).length!=0) scan_boards.scan_init('scan_threads', tgts, {callback: catalog_liveTag_scan_threads_cont,\r\n////                                                                                      watchdog: mutex_wd_liveTag_scan_threads.restart.bind(mutex_wd_liveTag_scan_threads),\r\n////////////                                                                                      crawler_watchdog: true\r\n////                                                                                     });\r\n////        else {\r\n////          mutex_wd_liveTag_scan_threads.stop();\r\n////          catalog_refresh_end();\r\n////        }\r\n////      }\r\n////      function catalog_liveTag_scan_threads_cont() {\r\n////        mutex_wd_liveTag_scan_threads.stop();\r\n////        if (mutex_wd_liveTag_scan_threads.query_req()) catalog_liveTag_scan_threads();\r\n////        else catalog_refresh_end();\r\n////      }\r\n////      cataLog.catalog_liveTag_scan_threads = catalog_liveTag_scan_threads;\r\n////      cataLog.catalog_liveTag_scan_threads_delayed_do = catalog_liveTag_scan_threads_delayed_do;\r\n\r\n      function catalog_refresh_end(){\r\n        if (pref.notify.favicon || pref.notify.title.notify) notifier.favicon.set(threads);\r\n//        if (pref.liveTag.style) liveTag.refresh_end_proc();\r\n//if (pref.debug_mode['9']) for (var i in scan.list_nup) if (scan.list_nup[i]<=0) console.log('list_nup: '+i+', '+scan.list_nup[i]);\r\n        if (pref.debug_mode['3']) {\r\n          var th_count = 0;\r\n          for (var d in liveTag.mems) for (var b in liveTag.mems[d]) for (var t in liveTag.mems[d][b]) th_count++;\r\n          var ths = {};\r\n          for (var i in liveTag.tags_ci) for (var j of liveTag.tags_ci[i].mems.keys()) ths[j.key] = null;\r\n          console.log('refresh_end: tags_ci+tags: '+Object.keys(liveTag.tags_ci).length+'+'+Object.keys(liveTag.tags).length+', threads:'+th_count+', '+Object.keys(ths).length);\r\n        }\r\n        if (pref[embed_mode].load_on_demand) show_catalog();\r\n      }\r\n      cataLog.catalog_refresh_end = catalog_refresh_end;\r\n\r\n////      var mutex_wd_liveTag_scan_ui = new MutexWatchdog('scan_ui'); // working code, @safe1069\r\n////      var liveTag_scan_ui_queue = {};\r\n////      function catalog_liveTag_scan_ui(key,arg) { // arg is {tgts:, options:}\r\n////        if (arg) {\r\n////          if (!liveTag_scan_ui_queue[key]) liveTag_scan_ui_queue[key] = {queue:[], mutex: new MutexWatchdog(key)};\r\n////          liveTag_scan_ui_queue[key].queue.push(arg);\r\n////        }\r\n////        var mutex = liveTag_scan_ui_queue[key].mutex;\r\n////        var queue = liveTag_scan_ui_queue[key].queue;\r\n////        if (!mutex.get()) return; // multi entry.\r\n////        if (queue.length>0) {\r\n////          var tgt = queue.shift();\r\n////          var scan_obj = {\r\n////            callback: catalog_liveTag_scan_ui_cont,\r\n////            callback_args: key,\r\n////            watchdog: mutex.restart.bind(mutex),\r\n////////////            crawler_watchdog: true,\r\n////            __proto__: tgt.options};\r\n////          scan_boards.scan_init(key, tgt.tgts, scan_obj);\r\n////        } else mutex.stop();\r\n////      }\r\n////      function catalog_liveTag_scan_ui_cont(key) {\r\n////        liveTag_scan_ui_queue[key].mutex.stop();\r\n////        catalog_liveTag_scan_ui(key);\r\n////      }\r\n\r\n//      function catalog_refresh_gather_info() {\r\n//        if (pref.catalog.order.sticky!=='dont_care') {\r\n//          var tgts = {};\r\n//          for (var name in threads) if (threads[name][20]===null) {\r\n//            var dbt = common_func.name2domainboardthread(name);\r\n//            tgts[dbt[0]+dbt[1]] = null;\r\n//          }\r\n//          if (Object.keys(tgts).length!=0) scan_boards.scan_init('refresh_watch', tgts, {force_json:true, callback:re_sort_thread});\r\n//        }\r\n//      }\r\n//      var flag_initial_refresh = (site.whereami==='boards') && pref.catalog.refresh.except_bt;\r\n\r\n      if (embed_frame) site2[site.nickname].catalog_frame_prep(pn12);\r\n      else if (embed_mode==='float') {\r\n        if (pref.catalog.appearance.initial.state==='maximized') pn12_0.childNodes[1].childNodes[3].onclick();\r\n        else if (pref.catalog.appearance.initial.state==='top') pn12_0.childNodes[1].childNodes[0].onclick();\r\n        else if (pref.catalog.appearance.initial.state==='bottom') pn12_0.childNodes[1].childNodes[1].onclick();\r\n      }\r\n      if (embed_embed) {  // for native catalog\r\n//        pn12.style.display = 'none';\r\n        setTimeout(function(){ // patch for liveTag.\r\n          site2[site.nickname].catalog_native_prep(Date.now(),pn12_0_4,pn12_0, embed_mode==='catalog');\r\n          var ths = insert_myself();\r\n//          if (site.whereami==='catalog') site2[site.nickname].clean_up_LS(ths);\r\n          if ((embed_mode==='page' && site2[site.nickname].all_boards && site2[site.nickname].all_boards.indexOf(site.board)!=-1) ||\r\n              (embed_mode==='thread' && pref.thread.env.auto_update_native)) {\r\n            var observer = new MutationObserver(insert_myself);\r\n//            var observer = new MutationObserver(function(){setTimeout(insert_myself,10);}); // wait native script for 4chan, but doesn't work.\r\n//            observer.observe(triage_parent, {childList: true});\r\n            observer.observe((embed_mode==='page')? ths[0].pn.parentNode : ths[0].pn, {childList: true});\r\n            triage.change_mode();\r\n          }\r\n          if (show_catalog_init_funcs) show_catalog_init_funcs();\r\n          if (pref.catalog.filter.kwd.active && (embed_mode==='page' || embed_mode==='catalog')) show_catalog();\r\n          if (pref.catalog_board_list_sel!==0 && pref.catalog.refresh.at_switch) catalog_clear_threads(0); \r\n          pn12.parentNode.removeChild(pn12);\r\n        },0);\r\n//        },10); // wait native script for 4chan, but doesn't work.\r\n      }\r\n      var insert_myself_init_flag = true; // PATCH\r\n      function insert_myself(){\r\n          insert_thread_from_native = true;\r\n//          var ths = scan_boards.scan_boards_keyword_callback2(site.nickname+','+site.board+','+site.no+','+((embed_catalog)?'catalog':'page')+'_html',\r\n          var new_posts = [];\r\n          var ths = scan_boards.scan_boards_keyword_callback2(site.nickname+','+site.board+','+((embed_mode==='thread')?site.no:'0')+','+embed_mode+'_html',\r\n                                                              {date:Date.now(), status:200, response:document},\r\n                                                              ['native_prep',{native_prep:true, found_threads: 0, max_threads:500, found_board:0, scanned:0, refresh:true, ext_posts:new_posts}]);\r\n          if (embed_mode==='thread' && common_obj.thread_reader && new_posts.length!==0) common_obj.thread_reader.updated(new_posts,insert_myself_init_flag);\r\n          insert_myself_init_flag = false;\r\n          insert_thread_from_native = false;\r\n          return ths;\r\n      }\r\n////////      if (embed_catalog || embed_page) {  // for native catalog // working code.\r\n////////        pn12.style.display = 'none';\r\n////////        setTimeout(function(){ // patch for liveTag.\r\n////////          var date = Date.now();\r\n////////          site2[site.nickname].catalog_native_prep(date,pn12_0_4,pn12_0, embed_catalog);\r\n////////          insert_thread_from_native = true;\r\n//////////          var ths = scan_boards.scan_boards_keyword_callback2(site.nickname+','+site.board+','+site.no+','+((embed_catalog)?'catalog':'page')+'_html',\r\n////////          var ths = scan_boards.scan_boards_keyword_callback2(site.nickname+','+site.board+',0,'+((embed_catalog)?'catalog':'page')+'_html',\r\n////////                                                              {date:date, status:200, response:document},\r\n////////                                                              ['native_prep',{native_prep:true, found_threads: 0, max_threads:500, found_board:0, scanned:0, refresh:true}]);\r\n////////          insert_thread_from_native = false;\r\n////////          if (pref.thread_reader.own_posts_tracker && pref.thread_reader.clean_up_own_posts && site.whereami==='catalog') site2[site.nickname].clean_up_own_posts(ths,site.board);\r\n////////        },0);\r\n////////      }\r\n\r\n    if (embed_mode!=='thread') setTimeout(function(){ // patch for liveTag.\r\n      catalog_refresh(pref.catalog.refresh.initial && site.whereami!=='boards', embed_embed, false);\r\n    },1);\r\n\r\n      function catalog_insert(key) {\r\n        var dbt = key.split(',');\r\n        if (pref.catalog_promiscuous || (dbt[0]+dbt[1] in boards)) scan_boards.scan_init('snoop', [key], {lifetime:3600, crawler_max:1, tgt_raw:true});\r\n      }\r\n      function catalog_insert_snoop(key,value) {\r\n        catalog_insert2(key,value,true,true);\r\n      }\r\n      function catalog_insert2(key,value,snoop,from_auto) {\r\n//var check_perf = ['catalog_refresh :', performance.now()];\r\n        var dbt = key.split(',');\r\n        var nickname = dbt[0];\r\n        var board = dbt[1];\r\n        var read_type = dbt[3];\r\n        var page_no = dbt[2];\r\n        var thread = dbt[2];\r\n////////        var dbt = cnst.name2domainboardthread(key,true);\r\n////////        var nickname = dbt[0];\r\n////////        var board = dbt[1];\r\n////////        var read_type = (dbt[2][0]==='p')? 'page_html' : ((dbt[2][0]==='c')? 'catalog_html' : ((dbt[2][0]==='j')? 'catalog_json' : 'thread_html'));\r\n////////        var page_no = (read_type==='thread_html')? '?' : dbt[2].substr(1);\r\n////////        var thread = dbt[2];\r\n        if (snoop && !pref.catalog_promiscuous && read_type==='thread_html' && !threads[name]) {\r\n          var hit = false;\r\n          for (var i=0;i<load_list.refresh.tgts.length;i++) if (load_list.refresh.tgts[i][0].indexOf(name)!=-1) {hit=true;break;}\r\n          if (!hit) return 0; // return if no interest.\r\n        }\r\nif (pref.test_mode['3']) return;\r\n        if (!('response' in value)) value.response = (read_type==='catalog_json')? JSON.parse(value.responseText)\r\n                                                                                 : new DOMParser().parseFromString(value.responseText, 'text/html'); // cause memory leak at KC/int/.\r\nif (pref.test_mode['2']) return;\r\n//check_perf.push(performance.now());\r\n        var tgts_show = {};\r\n//        catalog_clear_threads(pref.catalog.max_threads);\r\n////////        if ((read_type==='page_html' || read_type==='thread_html') && nickname==='NONE') { // for debug\r\n//////////        if ((read_type==='page_html' || read_type==='thread_html') && nickname==='KC') { // for debug\r\n//////////        if ((read_type==='page_html' || read_type==='thread_html') && nickname!=='8chan') { // for debug\r\n//////////        if ((read_type==='page_html' && nickname!=='8chan') || read_type==='thread_html') { // for debug\r\n//////////        if (read_type==='page_html' || read_type==='thread_html') {\r\n////////          var name = nickname + board + thread;\r\n////////          if (snoop && !pref.catalog_promiscuous && read_type==='thread_html' && !threads[name]) {\r\n////////            var hit = false;\r\n////////            for (var i=0;i<load_list.refresh.tgts.length;i++) if (load_list.refresh.tgts[i][0].indexOf(name)!=-1) {hit=true;break;}\r\n////////            if (!hit) return 0; // return if no interest.\r\n////////          }\r\n//////////          value.responseText = site2[nickname].preprocess_html(value.responseText,read_type==='page_html'); // cause memory leak.\r\n//////////          var doc = ('response' in value)? value.response : new DOMParser().parseFromString(value.responseText, 'text/html');\r\n////////          var doc = value.response;\r\n////////          site2[nickname].preprocess_doc(doc);\r\n////////          var nof_posts = 0;\r\n////////          var nof_files = 0;\r\n////////          if (read_type==='thread_html') {\r\n////////            var nof_pi = site2[nickname].thread2headline(doc);\r\n////////            nof_posts  = nof_pi[0];\r\n////////            nof_files = nof_pi[1];\r\n////////            nof_pi = null; // for test\r\n////////            site2[nickname].add_thread_link(doc,site2[nickname].make_url3(board,thread));\r\n////////          }\r\n////////          if (site.nickname!=nickname || site.board!=board) site2[nickname].absolute_link(doc,board);\r\n////////          var threads_in_page = site2[nickname].catalog_threads_in_page(doc);\r\n////////          var th_no = site2[nickname].get_ops(doc);\r\n////////\r\n////////          for (var i=0;i<threads_in_page.length;i++) {\r\n////////            var p_node = threads_in_page[i].parentNode;\r\n////////            insert_thread_from_page(threads_in_page[i], nickname, board, th_no[i], page_no+((read_type==='page_html' && pref.show_page_fraction)? '.'+i : ''), (i==0)?nof_posts : 0, (i==0)?nof_files : 0, snoop, value.date);\r\n//////////          if (threads_in_page[i].parentNode==p_node) threads_in_page[i].parentNode.removeChild(threads_in_page[i]);\r\n////////            tgts_show[nickname+board+th_no[i]]=true;\r\n////////          }\r\n////////        } else {\r\n//          if (read_type==='thread_html') site2[nickname].add_thread_link(value.response,site2[nickname].make_url3(board,thread));\r\n//          if (read_type==='page_html' || read_type==='thread_html') site2[nickname].preprocess_doc(value.response);\r\n          var ths;\r\nif (pref.test_mode['0']) {\r\n          ths = {domain:nickname, board:board, page:page_no};\r\n          if (read_type==='catalog_json') ths.obj = value.response;\r\n          else ths.pn = value.response;\r\n          site2[ths.domain].parse_funcs[read_type].entry(ths,site2[ths.domain].parse_funcs[read_type]['before_test']);\r\n          ths = ths.ths;\r\n} else {\r\n//////          ths = Object.create({domain:nickname, board:board, page:page_no, parse_funcs:site2[nickname].parse_funcs[read_type], __proto__:site4.parse_funcs_on_demand});\r\n//////          if (read_type==='catalog_json') ths.obj = value.response;\r\n//////          else Object.defineProperty(ths,'pn',{value:value.response, enumerable:true, configurable:true, writable:true});\r\n////          var parse_obj = Object.create({domain:nickname, board:board, page:page_no, parse_funcs:site2[nickname].parse_funcs[read_type], __proto__:site4.parse_funcs_on_demand});\r\n////          ths = (read_type==='catalog_json')? {obj:value.response, __proto__:parse_obj} : {pn:value.response, __proto__:parse_obj};\r\n////          ths = ths.ths;\r\n          ths = site2[nickname].wrap_to_parse.get(value.response, nickname, board, read_type, {page:page_no});\r\n}\r\n          if (read_type==='catalog_json' || read_type==='catalog_html') rm_items_404_check(nickname,board,ths); // consumes 15-40 ms, too slow.\r\n          if (snoop && !pref.catalog_promiscuous) for (var i=ths.length-1;i>=0;i--) if (!(ths[i].key in threads)) ths.splice(i,1);\r\n//check_perf.push(performance.now());\r\n          for (var i=0;i<ths.length;i++) {\r\n//            if (read_type!=='catalog_json' && ths[i].pn.parentNode) ths[i].pn.parentNode.removeChild(ths[i].pn); // patch for memory leak issue, but probably fixed.\r\n            if (insert_thread_with_test(ths[i], read_type, value.date)) tgts_show[ths[i].key]=true;\r\n          }\r\n////////        }\r\n//check_perf.push(performance.now());\r\n        if (Object.keys(tgts_show).length!=0) {\r\n          show_catalog(tgts_show,from_auto);\r\n//          if (pref.catalog.filter.tag_scan_auto) scan_tags();\r\n        }\r\n//check_perf.push(performance.now());\r\n//check_perf.push('num: '+Object.keys(tgts_show).length);\r\n//common_func.perf_out(check_perf);\r\n      }\r\n\r\n      function rm_items_404_check(domain, board, ths){\r\n        if (pref.patch.rm_404_blacklist.indexOf(domain)!=-1) return; // PATCH for 8chan, 8chan sends corrupted data.\r\n//        if (pref.catalog.bookmark_list_rm404) {\r\n//          var val = catalog_obj_merge(db,pref.catalog.filter.list_obj3,null);\r\n//          val = catalog_obj_merge(db,pref.catalog.filter.attr_list_obj3,val);\r\n//          if (val.hit) return true;\r\n//        }\r\n//        return false;\r\n//        return pref.catalog.bookmark_list_rm404\r\n//            && ((db in pref.catalog.filter.list_obj3) || (db in pref.catalog.filter.attr_list_obj3) || (db in pref.catalog.filter.watch_list_obj3));\r\n        var db = domain + board;\r\n        var flag_item = (pref.catalog.bookmark_list_rm404\r\n            && ((db in pref.catalog.filter.list_obj3) || (db in pref.catalog.filter.attr_list_obj3) || (db in pref.catalog.filter.watch_list_obj3)));\r\n        var nos = {};\r\n        for (var i=0;i<ths.length;i++) nos[ths[i].key] = true;\r\n        if (flag_item) rm_items_404(db,nos);\r\n        if (pref.liveTag.rm_404_immediately) liveTag.rm_404(domain, board, nos); // call remove_thread in this.\r\n        for (var i=0;i<ths.length;i++) nos[ths[i].no] = null; // patch, should be consolidated.\r\n        if (pref.test_mode['67']) archiver.clean_list_all(nos, domain, board);\r\n        if (!liveTag.mems[domain][board].LS_synced) site2[domain].clean_up_LS(domain, board, nos);\r\n      }\r\n      function rm_items_404(db,nos){\r\n//console.log('rrr');\r\n        var tgts = [[pref.catalog.filter.list_str,      pref.catalog.filter.list_obj2,      search_ex_list],\r\n                    [pref.catalog.filter.attr_list_str, pref.catalog.filter.attr_list_obj2, attr_list],\r\n                    [pref.catalog.filter.watch_list_str, pref.catalog.filter.watch_list_obj2, watch_list]];\r\n        for (var i=0;i<tgts.length;i++) {\r\n//          var changed = false;\r\n////          for (var name in tgts[i][1]) { // too slow\r\n////            var dbt = common_func.name2domainboardthread(name,true);\r\n//////            if (dbt[0]===nickname && dbt[1]===board && dbt[2]!=='') {\r\n//////              var flag = false;\r\n//////              for (var j=0;j<ths.length;j++) if (dbt[2]==ths[j].no) {flag=true;break;}\r\n//////              if (!flag) {\r\n////            if (dbt[0]+dbt[1]===db && dbt[2]!=='') {\r\n////              if (nos[dbt[2]]===undefined) {\r\n////                if (pref.debug_mode['0']) console.log(name);\r\n////                triage_exe(name,'DELETE','',false);\r\n////                changed = true;\r\n////                if (threads[name]) remove_thread(name);\r\n////              }\r\n////            }\r\n////          }\r\n//          for (var name in tgts[i][1]) {\r\n////            if (!(name in nos) && name.indexOf(db)==0) {\r\n//            if (name.indexOf(db)==0 && name.length!=db.length && !(name in nos)) {\r\n//              if (pref.debug_mode['2']) console.log('rm_items_404: ' + name);\r\n//              triage_exe(name,'DELETE','',false); // BUG, this changes tgts[i][1], so inconsistency occurs, and requires redundant sequences.\r\n//              changed = true;\r\n//              if (threads[name]) remove_thread(name);\r\n//            }\r\n//          }\r\n//          if (changed) { // seems to be redundant.\r\n//            tgts[0][2].value = tgts[0][2].value.replace(/\\n\\n+/g,'\\n'); // triage_exe executes both.\r\n//            tgts[1][2].value = tgts[1][2].value.replace(/\\n\\n+/g,'\\n');\r\n//            tgts[2][2].value = tgts[2][2].value.replace(/\\n\\n+/g,'\\n');\r\n//            pref_func.apply_prep(tgts[i][2],true);\r\n//            pref_func.apply_prep(tgts[i][2],false);\r\n//          }\r\n          var list = [];\r\n          for (var name in tgts[i][1]) {\r\n            if (name.length>db.length && name.indexOf(db)==0 && !(name in nos)) {\r\n              if (pref.debug_mode['2']) console.log('rm_items_404: ' + name);\r\n              list[list.length] = name;\r\n            }\r\n          }\r\n          if (list.length>0) triage_exe(list[0],'DELETE',list.slice(1),false); // BUG, this changes tgts[i][1], so inconsistency occurs, and requires redundant sequences.\r\n        }\r\n      }\r\n\r\n//      function req_events(key,value,list) { // working code.\r\n//        list.mutex = true;\r\n////if (pref.debug_mode['0']) console.log(new Date().toLocaleTimeString() + ', refresh: callback: '+load_list.refresh.tgts[load_list.refresh.idx]+', '+load_list.refresh.idx);\r\n//        if (value.status==200 && (value.responseText || value.response)) catalog_insert2(key,value,false,list.from_auto);\r\n//        else {\r\n//          if (value.status==404) comment_out_bookmark(key);\r\n//          list.indicator.set('orange');\r\n//        }\r\n//        if (list.idx<list.tgts.length && value.status<500) {\r\n//          if (!pref[embed_mode].load_on_demand) get_page(list);\r\n//        } else {\r\n//          if (list.idx==1 && value.status!=200) list.indicator.set('red','X');\r\n//          else if (list.idx==list.tgts.length) list.indicator.set(null,'\\u25cf');\r\n//          else list.indicator.set(null,'\\u25b2');\r\n//          if (list.check_page) {\r\n//            refresh_idx_page = 0;\r\n//            page_check_entry();\r\n//          } else http_req.close('catalog'+list.key);\r\n//          catalog_refresh_watch();\r\n//        }\r\n//      }\r\n//      function get_page(list){\r\n////if (pref.debug_mode['0']) console.log(new Date().toLocaleTimeString() + ', refresh: get: '+list.tgts[list.idx]+', '+list.idx);\r\n//        if (pref[embed_mode].load_on_demand && list.idx==0) \r\n//          for (var i=list.tgts.length-1;i>=1;i--) {\r\n//            var name = 'ODL:'+list.tgts[i];\r\n//            if (threads[name]) remove_thread(name);\r\n//            threads_idx.unshift(name);\r\n//          }\r\n////        if (tgt===undefined) tgt = list.tgts[list.idx];\r\n////        else tgt = [tgt,false];\r\n//        if (list.idx==0 && !list.indicator) list.indicator = health_indicator.shift('limegreen','0');\r\n//        list.indicator.set(null,(list.idx+1)+'/'+list.tgts.length);\r\n//        http_req.get('catalog'+list.key,list.tgts[list.idx].replace(/!.*/,''),'',req_events,list.use_cache,true,list);\r\n//        list.idx++;\r\n//        list.mutex = false;\r\n//      }\r\n//\r\n////      function req_events(key,value,args) {\r\n//////if (pref.debug_mode['0']) console.log(new Date().toLocaleTimeString() + ', refresh: callback: '+refresh_tgts[refresh_idx][0]+', '+refresh_idx);\r\n////        var inserted_idx = 0;\r\n//////        var key = refresh_tgts[refresh_idx][0].replace(/!.*/,'');\r\n//////        var key = args[0].replace(/!.*/,'');\r\n////        if (value.status==200 && value.responseText) {\r\n////          inserted_idx = catalog_insert2(key,value,false,args[1]);\r\n////        } else {\r\n////          if (value.status==404) comment_out_bookmark(key);\r\n////          health_indicator.set('orange');\r\n////        }\r\n////        refresh_idx++;\r\n////        if (refresh_idx<refresh_tgts.length && value.status<500) {\r\n////          if (!pref[embed_mode].load_on_demand) get_page();\r\n////          else {\r\n////            if (threads_idx.length==inserted_idx+1) threads_idx.push('url');\r\n////            else threads_idx.splice(inserted_idx+1,0,'url');\r\n//////            threads_idx.splice(page_delim_idx[refresh_idx],0,'url'); // THIS MAKES SUBTLE BUG, insert point slides from here at snoop refresh, but ok to use, so I'll omit.\r\n////            show_catalog();\r\n////          }\r\n////        } else {\r\n////          if (refresh_idx==1 && value.status!=200) health_indicator.set('red','X');\r\n////          else if (refresh_idx==refresh_tgts.length) health_indicator.set(null,'\\u25cf');\r\n////          else health_indicator.set(null,'\\u25b2');\r\n////          refresh_idx_page = 0;\r\n////          page_check_entry();\r\n////        }\r\n////      }\r\n////      function get_page(){\r\n//////if (pref.debug_mode['0']) console.log(new Date().toLocaleTimeString() + ', refresh: get: '+refresh_tgts[refresh_idx][0]+', '+refresh_idx);\r\n////        health_indicator.set(null,(refresh_idx+1)+'/'+refresh_tgts.length);\r\n////        http_req.get('catalog',refresh_tgts[refresh_idx][0].replace(/!.*/,''),'',req_events,refresh_use_cache,true,refresh_tgts[refresh_idx]);\r\n////      }\r\n\r\n      var refresh_idx_page;\r\n      function page_check_entry(){\r\n        while (refresh_idx_page<load_list.refresh.tgts.length) {\r\n          if (load_list.refresh.tgts[refresh_idx_page][0].search(/!page/)==-1) refresh_idx_page++;\r\n          else {\r\n            var name = load_list.refresh.tgts[refresh_idx_page++][0].replace(/!.*/,'');\r\n            if (threads[name]) {\r\n              if (threads[name][14].toString()[0]=='?') {\r\n                var page_no_old = parseInt(threads[name][15].toString().replace(/\\..*/,''),10);\r\n                if (isNaN(page_no_old)) page_no_old = 0;\r\n                page_check(name,page_no_old,page_check_callback);\r\n                break;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      function page_check_callback(name,str,date){\r\n//console.log('Callback : '+name+', '+str);\r\n        update_page_in_footer(name,str,date); // to show Dead.\r\n        page_check_entry();\r\n      }\r\n      function update_page_in_footer(name,str,date){\r\n//        if (threads[name]) {\r\n        if (threads[name] && threads[name][0].getElementsByTagName('div')['catalog_footer']) { // patch for threads, this will be removed.\r\n          var pn = threads[name][0].getElementsByTagName('div')['catalog_footer'].childNodes[0];\r\n          if (pn) {\r\n//            var str = str + '@' + new Date(date).toLocaleTimeString();\r\n            pn.innerHTML = pn.innerHTML.replace(/[^\\/]*$/,str);\r\n          }\r\n          threads[name][13]=date;\r\n          threads[name][15]=threads[name][14];\r\n          threads[name][14]=str;\r\n        }\r\n      }\r\n \r\n      function page_check(name,page_ini,callback){\r\n        var dbt = cnst.name2domainboardthread(name,true);\r\n        var domain = dbt[0];\r\n        var board = dbt[1];\r\n        var thread = dbt[2];\r\n        var page_idx = [];\r\n        var max_page = site2[domain].max_page(dbt[1]);\r\n        page_idx[0] = page_ini;\r\n        page_idx[1] = (page_ini+1)%(max_page+1);\r\n        for (var i=0;i<=max_page;i++) if (i!=page_idx[0] && i!=page_idx[1] && (!refresh_use_cache || i!=max_page)) page_idx.push(i);\r\n//        if (!refresh_use_cache) for (var i=0;i<5;i++) page_idx.push(page_idx[i]); // for retry, but live cache working...\r\n        var page_no;\r\n        var key;\r\n      \r\n        function page_check(){\r\n          page_no = page_idx.shift();\r\n          key = (page_no==max_page)? domain+board+thread : domain+board+'p'+page_no;\r\n//          http_req.get('catalog',key,url,req_events_page_check,refresh_use_cache);\r\n          http_req.get('catalog',key,'',req_events_page_check,refresh_use_cache,true);\r\n        }\r\n        page_check();\r\n        function req_events_page_check(key,value) {\r\n//console.log('Read : '+name+', '+key+', '+value.status);\r\n          var callback_str = null;\r\n          if (value.status!=200) {\r\n            if (page_no==max_page && value.status==404) callback_str = 'Dead';\r\n            else callback_str = 'HTTP'+value.status;\r\n          } else {\r\n            var doc = ('response' in value)? value.response : new DOMParser().parseFromString(value.responseText, 'text/html');\r\n            var ops = site2[domain].get_ops(doc);\r\n            var hit = false;\r\n            if (page_no!=max_page) for (var i=0;i<ops.length;i++) if (thread==ops[i]) {hit=true;callback_str = page_no+((pref.show_page_fraction)? '.'+i : '');}\r\n            if (!hit) {\r\n              if (value.responseText != null && page_idx.length!=0) setTimeout(page_check, 0); // live cache make racing condition with this. I don't know why.\r\n              else callback_str = '?' + ((!refresh_use_cache)? '(missing)' : '');\r\n              if (site2[domain].check_thread_archived(doc)) callback_str = 'Archived';\r\n            }\r\n          }\r\n          if (value.status==200) catalog_insert2(key,value,true); // update\r\n          if (callback_str!==null) {\r\n            if (callback_str==='Dead' || callback_str==='Archived') {\r\n              comment_out_bookmark(name);\r\n//              var tgt = pn12_0_4.getElementsByTagName('textarea')['catalog.filter.bookmark_list_str'];\r\n//              tgt.value = comment_out_key(name,tgt.value);\r\n//              pref_func.apply_prep(tgt,true);\r\n            }\r\n            callback(name,callback_str,value.date);\r\n          }\r\n//console.log('Out : '+name+', '+key+', '+value.status);\r\n        }\r\n      }\r\n      function comment_out_bookmark(name){\r\n        var tgt = pn12_0_4.getElementsByTagName('textarea')['catalog.filter.bookmark_list_str'];\r\n        tgt.value = comment_out_key(name,tgt.value);\r\n        pref_func.apply_prep(tgt,true);\r\n      }\r\n      function comment_out_key(key,str){\r\n////        var comments = [];\r\n////        var str_ret = '';\r\n////        var comment = new RegExp('//.*$','m');\r\n////        while (1) {\r\n////          var idx = str.search(comment);\r\n////          if (idx!=-1) comments.push([idx,str.match(comment)[0]]);\r\n////          else break;\r\n////        }\r\n//        return str.replace(key,'//$&');\r\n        var rep_str = (pref.catalog.bookmark_list_rm404)? '' : '//$&';\r\n////        return str.replace(new RegExp(key+'(!page)*(,|\\n|$)','g'),rep_str); // working code.\r\n        var dbt = key.split(',');\r\n        return str.replace(new RegExp(dbt[0]+dbt[1]+dbt[2]+'(!page)*(,|\\n|$)','g'),rep_str);\r\n      }\r\n\r\n      initialize_loop = false;\r\n      pref_func.mirror_targets.pn12_0_2 = pn12_0_2;\r\n      pref_func.mirror_targets.pn12_0_4 = pn12_0_4;\r\n\r\n      var general_event_handler = (function(){\r\n        var valid = false;\r\n        function setup(reset){\r\n          if (pref[embed_mode].scroll_lock && !valid && !reset){\r\n            triage_parent.addEventListener('mouseover',mouseover,true);\r\n            valid = true;\r\n          } else if (valid) {\r\n            triage_parent.removeEventListener('mouseover',mouseover,true);\r\n            valid = false;\r\n          }\r\n        }\r\n        var geh = site2[site.nickname].general_event_handler[site.whereami];\r\n        var last_viewed = null;\r\n        var last_Y = 0;\r\n        function mouseover(e){\r\nif (pref.debug_mode['14']) if (last_viewed) site2[site.nickname].general_event_handler[site.whereami].get_mark(last_viewed, get_now_height()+last_Y).style.border = 'none';\r\n          last_viewed = e.target;\r\n          last_Y = e.clientY;\r\n//          if (geh.last_viewed.call(this,e)) show_catalog_scroll_lock.viewed(e.target);\r\n          //          e.stopPropagation();\r\nif (pref.debug_mode['14']) {\r\n  var pn = site2[site.nickname].general_event_handler[site.whereami].get_mark(e.target, get_now_height()+last_Y);\r\n  if (!pn.classList.contains('post')) console.log(e.target, pn)\r\n  pn.style.border = '1px solid blue';\r\n}\r\n        }\r\n        var class_expander = pref.script_prefix + '_expander';\r\n        function change(e){\r\n          if (e.target.className===class_expander) {\r\n            var name = get_name_recursive(e.target);\r\n            threads[name][16].t2h_sel = format_html.get_t2h_from_index(e.target.selectedIndex);\r\n            threads[name][16].expand_posts = true;\r\n//            drawn_idx = 0; // patched in 'show_catalog', because this is required when images are expanded.\r\n            scan.scan_ui('expand_page', {tgts:[name], options:{refresh:true}});\r\n            e.target.blur();\r\n          }\r\n        }\r\n        triage_parent.addEventListener('change',change,false);\r\n        return {\r\n          setup: setup,\r\n          get_last_viewed: function(){\r\n            return (last_viewed)? site2[site.nickname].general_event_handler[site.whereami].get_mark(last_viewed, get_now_height()+last_Y) : null;\r\n          },\r\n          clear_last_viewed: function(){last_viewed = null;},\r\n          init: function(){\r\n            var subscribers = general_event_handler.subscribers;\r\n            var dynamic_image_hover = site2[site.nickname].parse_funcs[site.whereami+'_html'].dynamic_image_hover;\r\n            if (geh && geh.mouseover && (geh.add_mouseover || dynamic_image_hover)) common_func.dom_addEventListener(subscribers, triage_parent, 'mouseover', geh.mouseover);\r\n            setup();\r\n          },\r\n          subscribers: [],\r\n        }\r\n      })();\r\n      setTimeout(general_event_handler.init, 500);\r\n      cataLog.general_event_handler = general_event_handler;\r\n\r\n      return {\r\n        destroy: function(){ // destructor\r\n          common_func.dom_removeEventListener(general_event_handler.subscribers);\r\n          general_event_handler.setup(true);\r\n          triage.off();\r\n          for (var name in threads) remove_thread(name);\r\n//          pref_func.remove_onchange(pn12_0_2); // prevent leak.\r\n//          pref_func.remove_onchange(pn12_0_4); // prevent leak.\r\n          pref_func.mirror_targets.pn12_0_2 = null;\r\n          pref_func.mirror_targets.pn12_0_4 = null;\r\n          catalog_clear_threads(0);\r\n          if (brwsr.sw_cache && brwsr.sw_cache.subscribe) brwsr.sw_cache.subscribe(false);\r\n//          pref_func.health_indicator = null;\r\n          health_indicator.destroy();\r\n//          if (embed_catalog) if (catalog_native_destroy) catalog_native_destroy();\r\n          cnst.auto_shrink_board_selector.destroy(board_sel);\r\n          window_beforeunload();\r\n          pref_func.tooltips.remove_hier(pn12_triage);\r\n//          pref_func.tooltips.remove_hier(pn12_0_4);\r\n          pref_func.tooltips.remove_root(pn12_0_4);\r\n          pref_func.tooltips.hide();\r\n//          clearTimeout(auto_update_timer);\r\n          auto_update.stop_if_running();\r\n          pn12.parentNode.removeChild(pn12);\r\n          window.removeEventListener('storage', site2[site.nickname].prep_own_posts_event, false); // debug\r\n          scroll_event_src.removeEventListener('scroll', show_catalog_cont, false);\r\n          window.removeEventListener('resize', show_catalog_cont, false);\r\n          pn12.removeEventListener('dragstart', auto_hide_catalog, false);\r\n          pn12.removeEventListener('dragend'  , auto_hide_catalog, false);\r\n//          pn12_triage.removeEventListener('mouseover', catalog_triage_out_clear, false);\r\n//          pn12_triage.removeEventListener('mouseout' , catalog_triage_out_delay, false);\r\n          pn12 = null;\r\n          liveTag.pn = null;\r\n          for (var i in cataLog) cataLog[i] = null;\r\n          return null;\r\n        },\r\n        remake_triage: remake_triage,\r\n        triage_exe_pipe: triage_exe_pipe,\r\n        catalog_insert: catalog_insert,\r\n        update_all_footers: update_all_footers,\r\n        pn12_0_4: pn12_0_4,\r\n        pn12_0_2: pn12_0_2,\r\n        catalog_resized: catalog_resized,\r\n        get_threads: function(){return threads;},\r\n        catalog_filter_changed: catalog_filter_changed,\r\n        scan_boards: scan_boards,\r\n        show_catalog: show_catalog,\r\n//        threads: threads,\r\n        catalog_liveTag_scan_site: onchange_funcs['scanSite'],\r\n      }\r\n    }\r\n    return {\r\n      catalog_func: function(){return catalog_func;},\r\n      scan_tags_common: scan_tags_common,\r\n      show_hide: show_hide,\r\n    }\r\n  }\r\n\r\n  var stats = (pref3.stats.use)? (function(){\r\n    var tree_404 = {};\r\n    function thread_removed(dbt){\r\n      var lth = liveTag.mems[dbt[0]][dbt[1]][dbt[2]];\r\n      if (lth.ss) {\r\n        if (Array.isArray(lth.ss)) for (var i=0;i<lth.ss.length;i++) {if (lth.ss[i].rm) lth.ss[i].rm.update_thread(lth.s, 0, true);}\r\n        else if (lth.ss.rm) lth.ss.rm.update_thread(lth.s, 0, true);\r\n      }\r\n      if (pref.stats.retain_404 && lth.s) {\r\n        if (!tree_404[dbt[0]]) tree_404[dbt[0]] = {};\r\n        if (!tree_404[dbt[0]][dbt[1]]) tree_404[dbt[0]][dbt[1]] = {};\r\n        tree_404[dbt[0]][dbt[1]][dbt[2]] = liveTag.mems[dbt[0]][dbt[1]][dbt[2]];\r\n//        if (tree_404[dbt[0]][dbt[1]].sr || Object.keys(tree_404[dbt[0]][dbt[1]]).length>64) update_board_rm(tree_404[dbt[0]][dbt[1]]);\r\n        if (pref.test_mode['44'] || tree_404[dbt[0]][dbt[1]].sr || Object.keys(tree_404[dbt[0]][dbt[1]]).length>64) update_board_rm(tree_404[dbt[0]][dbt[1]]);\r\n      }\r\n    }\r\n    \r\n    var label_funcs = {\r\n      hour: function(t){return new Date(t*60000).toString().split(' ')[4].replace(/:\\d*$/,'');},\r\n      day: function(t){return new Date(t*60000).toString().replace(/\\s\\d{4}.*/,'');},\r\n      sunday : function(t){\r\n        var str = new Date(t*60000).toString();\r\n        return (str.split(' ')[0]=='Sun')? str.replace(/\\s\\d{4}.*/,'') : '';\r\n      },\r\n      month : function(t){\r\n        var str = new Date(t*60000).toString();\r\n        return (str.split(' ')[2]=='01')? str.replace(/\\s\\d{4}.*/,'') : '';\r\n      },\r\n      quarter_year : function(t){\r\n        var strs = new Date(t*60000).toString().split(' ');\r\n        return (strs[2]<=7 && ['Jan','Apr','Jul','Oct'].indexOf(strs[1])!=-1)? strs.slice(1,4).join(' ') : '';\r\n      },\r\n    }\r\n    label_funcs['1'] = [60, label_funcs.hour, 1];\r\n//    label_funcs['2'] = [60, label_funcs.hour, 1]; // debug\r\n    label_funcs['10'] = [60, label_funcs.hour, 1];\r\n    label_funcs['60'] = [1440, label_funcs.day, 1];\r\n    label_funcs['1440'] = [1440, label_funcs.sunday, 0];\r\n    label_funcs['10080'] = [1440, label_funcs.quarter_year, 0];\r\n//    var time_unit_arr = [1,2,60,1440,10080]; // debug\r\n    var time_unit_arr = [1,10,60,1440,10080];\r\n\r\n    function thread_created(lth){\r\n      for (var i=0;i<instances.length;i++) {\r\n        var result = pref_func.merge_obj5(lth.key, instances[i].tgts_obj2,{hit:false});\r\n        if (result.hit) instances[i].check_and_add_thread(lth);\r\n      }\r\n    }\r\n    var time_root = Math.floor(Date.now()/60000);\r\n    var instances= [];\r\n//    var count = 0;\r\n    var Stats = function(chart, tgts, key){\r\n      instances.push(this);\r\n      this.chart = chart;\r\n      this.tolerance = 0;\r\n//      this.name = 'graph_'+ count++;\r\n      this.draw = DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(this.refresh.bind(this), pref.stats.draw_delay*1000));\r\n      this.wdg_tick = new Watchdog(this.prep_time.bind(this), 60000);\r\n      this.fromNo = (pref3.stats.estimate_posts)? new StatsFromNo(this) : null; // for subscribe, this pointer can't be changed.\r\n      this.tgts_changed(tgts, key, true); // this.tgts, this.key\r\n      this.time_unit_changed(pref.chart.inst.time_sel, true); // this.time_base, this.time_unit, this.time_last, time_sel\r\n      this.len_changed((this.chart && this.chart.len>pref.stats.len_capture)? this.chart.len : pref.stats.len_capture); // this.len, this.data_p, this.data_t, this.data_l, this.min_idx, this.data_p_old, this.data_t_old, this.shift, this.rm.data_p, this.rm.data_t\r\n    };\r\n    Stats.prototype = {\r\n      destroy: function(){\r\n        this.chart = null;\r\n        this.save_all_unsubscribe(true);\r\n        this.wdg_tick.stop();\r\n        instances.splice(instances.indexOf(this),1);\r\n      },\r\n      merge_1: function(dst,src){\r\n        if (src) for (var i=0;i<src.length;i++) if (dst[i]<src[i]) dst[i] = src[i]; // src[i] may be undefined.\r\n        return dst;\r\n      },\r\n      merge_1_hier: function(dst,src, lower){\r\n        var num = this.time_unit/lower.time_unit;\r\n        var start = Math.ceil((lower.time_base - this.time_base)/this.time_unit);\r\n        var i = (num - (lower.time_base%this.time_unit)/lower.time_unit)%num; // start offset\r\n        while (i<src.length) {\r\n          this.merge_1_hier_1(dst, src, start, i, num, lower);\r\n          i+=num;\r\n          start++;\r\n        }\r\n      },\r\n      merge_1_hier_1: function(dst,src,idx_d,idx_s,num, lower){\r\n        var data = 0;\r\n        var end = (src.length>=idx_s+num)? num : src.length - idx_s;\r\n        for (var j=0;j<end;j++) data += src[idx_s+j];\r\n        if (pref.debug_mode['15'])\r\n          if (data>dst[idx_d])\r\n            console.log('merge_1_hier_1: '+this.time_unit+': '+idx_d+', '+dst[idx_d]+'->'+data+', '+\r\n                        new Date((this.time_base+idx_d*this.time_unit)*60000).toLocaleString()+', '+\r\n                        new Date((lower.time_base+idx_s*lower.time_unit)*60000).toLocaleString()+', '+num);\r\n        if (data>dst[idx_d]) dst[idx_d] = data;\r\n      },\r\n      save_all_unsubscribe: function(from_destructor){ // destructive\r\n        if (this.tgts && pref.stats.save && auto_acquisition_keys['@'+this.key]!==undefined) {\r\n          var timestamp = Math.floor(Date.now()/60000);\r\n          if (auto_acquisition_keys['@'+this.key]!==timestamp) { // prevent from saving twice in auto_acquisition\r\n            var chart_bak = this.chart;\r\n            this.chart = null; // don't draw\r\n            var idx = time_unit_arr.indexOf(this.time_unit);\r\n////            this.save();\r\n////            for (var i=1;i<time_unit_arr.length;i++) {\r\n////              this.time_unit_changed((idx+i)%time_unit_arr.length);\r\n////              this.save();\r\n////            }\r\n            var data_lower = null;\r\n            for (var i=0;i<time_unit_arr.length;i++) {\r\n              this.time_unit_changed(i);\r\n              this.save(data_lower);\r\n              data_lower = {data_p:this.data_p, data_t:this.data_t, time_unit:this.time_unit, time_base:this.time_base};\r\n            }\r\n            if (!from_destructor) this.time_unit_changed(idx);\r\n            this.chart = chart_bak;\r\n            auto_acquisition_keys['@'+this.key] = timestamp;\r\n          }\r\n        }\r\n        if (this.tgts) {\r\n          this.prep('both',this.prep_thread_unsubscribe);\r\n          if (this.fromNo) this.fromNo.prep('live',this.fromNo.prep_board_unsubscribe);\r\n        }\r\n      },\r\n      Zcompress: function(str){\r\n        return str.replace(/0,(0,)+/g,function(match){return 'z'+match.length/2+',';});\r\n//        var test2 = this.Zdecompress(test);\r\n//        if (test2!==str) console.log('ERROR: '+str+', '+test+', '+test2);\r\n//        return str;\r\n      },\r\n      Zdecompress: function(str){\r\n        return str.replace(/z(\\d+),/g,function(match,p1){\r\n          var str = '';\r\n          var len = parseInt(p1,10);\r\n          for(var i=0;i<len;i++) str+='0,';\r\n          return str;\r\n        });\r\n      },\r\n      get_ls_key: function(){\r\n        if (pref.test_mode['38']) return pref.script_prefix + '.graph.' + this.time_unit + '.' + this.key+'_test38';\r\n        return pref.script_prefix + '.graph.' + this.time_unit + '.' + this.key;\r\n      },\r\n      save: function(data_lower){ // destructive\r\n        if (this.data_p && pref.stats.load && pref.stats.save && localStorage) {\r\n          this.merge_1(this.data_p, this.data_p_old);\r\n          this.merge_1(this.data_t, this.data_t_old);\r\n          if (data_lower) {\r\n            this.merge_1_hier(this.data_p, data_lower.data_p, data_lower);\r\n            this.merge_1_hier(this.data_t, data_lower.data_t, data_lower);\r\n          }\r\n          var i=0;\r\n          while (i<this.data_p.length && this.data_p[i]===0 && this.data_t[i]===0) i++;\r\n          var data_save = [this.time_base+i*this.time_unit, this.data_p.slice(0,this.len+1).slice(i), this.data_t.slice(0,this.len+1).slice(i)];\r\nif (!pref.test_mode['42']) {\r\n          if (this.fromNo) {\r\n            var fN = this.fromNo;\r\n            fN.valid = true;\r\n            fN.prep('live',fN.prep_board_check_valid);\r\n            if (!fN.valid) for (var j=0;j<fN.data_p.length;j++) fN.data_p[j] = 0;\r\n            else if (fN.data_p_old) {\r\n              var idx_last = fN.data_p_old.length-1;\r\n              if (fN.data_p[idx_last]>fN.data_p_old[idx_last]) fN.data_p_old[idx_last] = fN.data_p[idx_last]; // overwrite last data, because last data may NOT complete its period.\r\n            }\r\n            if (fN.data_p_old) fN.data_p = fN.data_p_old.concat(fN.data_p.slice(fN.data_p_old.length));\r\n            for (var j=fN.data_p.length-2-this.tolerance;j<fN.data_p.length;j++) fN.data_p[j] = 0; // fill 0 to last 2 or more.\r\n            data_save[3] = fN.data_p.slice(0,this.len+1).slice(i);\r\n          }\r\n}\r\n          localStorage[this.get_ls_key()] = this.Zcompress(JSON.stringify(data_save));\r\n          if (pref.debug_mode['15']) console.log('saved: '+this.get_ls_key());\r\n        }\r\n      },\r\n      load: function(){\r\n        if (pref.stats.load && localStorage) {\r\n          var data = localStorage[this.get_ls_key()];\r\n          if (data) {\r\n            data = JSON.parse(this.Zdecompress(data));\r\n            var start = (this.time_base - data[0])/this.time_unit;\r\n            var end   = Math.floor((time_root - this.time_last)/this.time_unit); // negative value.\r\n            if (end===0) end = undefined;\r\n            if (start>=0) {\r\n              this.data_p_old = data[1].slice(start, end);\r\n              this.data_t_old = data[2].slice(start, end);\r\n              if (this.fromNo && data[3]) this.fromNo.data_p_old = data[3].slice(start, end);\r\n            } else {\r\n              this.data_p_old = this.array_init([],0,0).slice(0,-start).concat(data[1].slice(0,end));\r\n              this.data_t_old = this.array_init([],0,0).slice(0,-start).concat(data[2].slice(0,end));\r\n              if (this.fromNo && data[3]) this.fromNo.data_p_old = this.array_init([],0,0).slice(0,-start).concat(data[3].slice(0,end));\r\n            }\r\n            if (this.fromNo && this.fromNo.data_p_old) while (this.fromNo.data_p_old[this.fromNo.data_p_old.length-1]===0) this.fromNo.data_p_old.pop();\r\n          } else {\r\n            this.data_p_old = null;\r\n            this.data_t_old = null;\r\n          }\r\n        } \r\n      },\r\n      tgts_changed: function(tgts, key, skip_init){\r\n        this.save_all_unsubscribe();\r\n        this.tgts = tgts;\r\n        this.key = key;\r\n        pref_func.str2obj2(this,'tgts_obj2',tgts.join(','),null,true); // make this.tgts_obj2\r\n        this.prep('both',this.prep_thread_subscribe);\r\n        if (!skip_init) this.init();\r\n      },\r\n      time_unit_changed: function(sel, skip_init){\r\n        if (this.fromNo) this.fromNo.prep('live',this.fromNo.prep_board_unsubscribe);\r\n//        this.save();\r\n//        if (typeof(sel)!=='number') sel = sel.target.selectedIndex;\r\n        this.time_sel = sel;\r\n        this.time_unit = time_unit_arr[sel];\r\n        if (!skip_init) this.init();\r\n      },\r\n      len_changed: function(len){\r\n//        this.save();\r\n        this.len = len;\r\n        this.init();\r\n      },\r\n      init: function(){\r\n        this.time_last = null; // force to remake\r\n        this.data_p = [];\r\n        this.data_t = [];\r\n        this.data_l = [];\r\n        this.rm = (this.chart && (this.chart.show.ep || this.chart.show.et))? new StatsRm(this) : null;\r\n        if (this.fromNo) {\r\n          this.fromNo.data_p = [];\r\n          this.fromNo.data_p_old = [];\r\n          this.fromNo.min_idx = 0;\r\n        }\r\n        this.refresh(true);\r\n      },\r\n      array_init: function(arr,start,val){\r\n        for (var i=start;i<this.len+2;i++) if (arr[i]===undefined) arr[i] = val; // len+2\r\n        return arr;\r\n      },\r\n      tz_offset: new Date().getTimezoneOffset(),\r\n      label_init: function(start){\r\n        var lfunc = label_funcs[this.time_unit];\r\n        var i = (lfunc[2])? Math.floor((Math.floor(((this.time_base-this.tz_offset) + (this.len+2)*this.time_unit)/lfunc[0])*lfunc[0] - (this.time_base-this.tz_offset))/this.time_unit) :\r\n                            this.len+2;\r\n        while (i>=start) {\r\n          this.data_l[i] = lfunc[1](this.time_base + i*this.time_unit);\r\n          i -= (lfunc[2])? lfunc[0]/this.time_unit : 1;\r\n        }\r\n      },\r\n      prep_time: function(init){\r\n        var time_now = Math.floor((Date.now()/60000+this.tolerance)/this.time_unit)*this.time_unit;\r\n        if (this.time_last!==time_now) {\r\n          var distance = (time_now - this.time_last)/this.time_unit;\r\n          this.time_last = time_now;\r\n          this.time_base = time_now - this.time_unit * this.len;\r\n          var start = 0;\r\n          if (!init && distance!==0) {\r\n            if (distance>this.len) distance = this.len;\r\n            this.data_p.splice(0,distance);\r\n            this.data_t.splice(0,distance);\r\n            this.data_l.splice(0,distance);\r\n            if (this.rm) {\r\n              this.rm.data_p.splice(0,distance);\r\n              this.rm.data_t.splice(0,distance);\r\n            }\r\n            if (this.fromNo) {\r\n              this.fromNo.data_p.splice(0,distance);\r\n              if (this.fromNo.data_p_old) {this.fromNo.data_p_old.splice(0,distance); if (this.fromNo.data_p_old.length===0) this.fromNo.data_p_old = null;}\r\n              this.fromNo.min_idx -= distance;\r\n            }\r\n            if (this.data_p_old) {this.data_p_old.splice(0,distance); if (this.data_p_old.length===0) this.data_p_old = null;}\r\n            if (this.data_t_old) {this.data_t_old.splice(0,distance); if (this.data_t_old.length===0) this.data_t_old = null;}\r\n            start = this.len - distance;\r\n            this.min_idx -= distance;\r\n            if (this.min_idx<0) this.min_idx = 0; // this.min_idx <= this.len, therefore this may occur.\r\n          }\r\n          this.array_init(this.data_p,start,0);\r\n          this.array_init(this.data_t,start,0);\r\n          this.array_init(this.data_l,start,'');\r\n          if (this.rm) {\r\n            this.array_init(this.rm.data_p,start,0);\r\n            this.array_init(this.rm.data_t,start,0);\r\n          }\r\n          if (this.fromNo) this.array_init(this.fromNo.data_p,start,0);\r\n          this.label_init(start);\r\n          this.shift = (init)? 0 : this.shift + distance;\r\n        }\r\n        this.wdg_tick.restart(this.time_unit*60000);\r\n      },\r\n      prep: function(tree, func, func_t){\r\n        for (var i=0;i<this.tgts.length;i++) {\r\n          var dbt = common_func.name2domainboardthread(this.tgts[i],true);\r\n          if (tree==='live' || tree==='both') this.prep_1(liveTag.mems, dbt, func, func_t);\r\n          if (tree==='dead' || tree==='both') this.prep_1(tree_404, dbt, func, func_t);\r\n        }\r\n      },\r\n      prep_1: function(tree, dbt, func, func_t){\r\n        if (dbt[2]) {\r\n          if (tree[dbt[0]] && tree[dbt[0]][dbt[1]] && tree[dbt[0]][dbt[1]][dbt[2]] && func_t!==null) ((func_t)? func_t : func).call(this,tree[dbt[0]][dbt[1]][dbt[2]]);\r\n        } else if (dbt[1]) {\r\n          if (tree[dbt[0]] && tree[dbt[0]][dbt[1]]) this.prep_board(tree[dbt[0]][dbt[1]],func, func_t);\r\n        } else {\r\n          if (tree[dbt[0]]) this.prep_domain(tree[dbt[0]],func, func_t);\r\n        }\r\n      },\r\n      prep_domain: function(ld,func){\r\n        for (var b in ld) this.prep_board(ld[b],func, func_t);\r\n      },\r\n      prep_board: function(ldb,func){\r\n        for (var t in ldb) func.call(this,ldb[t]);\r\n      },\r\n      prep_thread_init: function(ldbt){\r\n        if (ldbt.s) this.update_thread(ldbt.s, 0);\r\n      },\r\n      check_and_add_thread: function(ldbt){\r\n        if (ldbt.s && !this.prep_thread_unsubscribe(ldbt,true)) {\r\n          this.update_thread(ldbt.s, 0, true);\r\n          this.prep_thread_subscribe(ldbt);\r\n        }\r\n      },\r\n      prep_thread_subscribe: function(ldbt){\r\n        if (Array.isArray(ldbt.ss)) ldbt.ss.push(this);\r\n        else if (ldbt.ss) ldbt.ss = [ldbt.ss, this];\r\n        else ldbt.ss = this;\r\n      },\r\n      prep_thread_unsubscribe: function(ldbt, check_only){\r\n        if (Array.isArray(ldbt.ss)) {\r\n          var idx = ldbt.ss.indexOf(this);\r\n          if (check_only) return (idx!==-1);\r\n          if (idx!=-1) {\r\n            ldbt.ss.splice(idx,1);\r\n            if (ldbt.ss.length===1) ldbt.ss = ldbt.ss[0];\r\n          }\r\n        } else if (ldbt.ss===this) {\r\n          if (check_only) return true;\r\n          delete ldbt.ss;\r\n        } else return false;\r\n      },\r\n      refresh: function(init){\r\n        if (pref.debug_mode['15']) console.log('updated: '+this.data_p.slice(this.len-10).toString()+', '+this.min_idx);\r\n        this.prep_time(init);\r\n        if (init) {\r\n          this.prep('live',this.prep_thread_init);\r\n          this.rm_tmp = new StatsRm(this, this.data_p, this.data_t);\r\n          this.rm_tmp.prep('dead',this.rm_tmp.prep_board_init, this.prep_thread_init);\r\n          if (this.rm) this.rm.prep('dead',this.rm.prep_board_init, this.prep_thread_init);\r\n          if (this.fromNo) this.fromNo.prep('live',this.fromNo.prep_board_init, true);\r\n          this.load();\r\n          if (this.chart) this.chart.replace_data(this);\r\n        } else if (this.shift!==0 || this.min_idx!==this.data_p.length) {\r\n          if (this.fromNo) this.fromNo.prep('live',this.fromNo.prep_board_init, false, true);\r\n          if (this.chart) this.chart.update_data2(this);\r\n        }\r\n        this.min_idx = this.data_p.length; // 'this.min_idx = this.len-1;' is suitable if local and server clocks are synced.\r\n      },\r\n//      remove_thread: function(s, start, from_thread){\r\n//        this.update_thread(s, start, from_thread);\r\n//        if (this.min_idx!==undefined) {\r\n//          this.__proto__.min_idx = this.min_idx;\r\n//          delete this.min_idx;\r\n//        }\r\n//      },\r\n      update_thread: function(s, start, from_thread){\r\n        if (!s) return;\r\n        if (start===0) this.update_thread_1(this.data_t, s, 0, 0);\r\n        this.update_thread_1(this.data_p, s, start, s.length-1);\r\n        if (from_thread) this.draw();\r\n      },\r\n      update_thread_1: function(data, s, start, end){\r\n        for (var j=end;j>=start;j--) {\r\n          var idx = Math.floor((s[j]-this.time_base)/this.time_unit);\r\n          var idx_over = idx - this.len -1;\r\n          if (idx_over>0) {\r\n            if (pref.stats.tolerant) {\r\n              this.tolerance = idx_over*this.time_unit + this.tolerance;\r\n              if (this.tolerance>pref.stats.tolerance) this.tolerance = pref.stats.tolerance;\r\n              this.prep_time(false);\r\n            }\r\n            idx = this.len+1;\r\n          }\r\n          if (idx>=0) {\r\n//            data[(idx<=this.len)? idx : this.len+1]++;\r\n            data[idx]++;\r\n            if (idx<this.min_idx) this.min_idx = idx;\r\n          } else break;\r\n        }\r\n      },\r\n    };\r\n    var StatsRm = function(parent, data_p, data_t){\r\n      this.data_p = data_p || [];\r\n      this.data_t = data_t || [];\r\n      Object.defineProperty(this,'min_idx',{set: function(val){this.__proto__.min_idx = val;},\r\n                                            get: function(){return this.__proto__.min_idx;}, // necessary\r\n                                            configurable:true, enumerable:true});\r\n      for (var i in StatsRm_prototype) this[i] = StatsRm_prototype[i];\r\n      this.__proto__ = parent;\r\n    };\r\n    var StatsRm_prototype = {\r\n      prep_board: function(ldb,func, func_t){\r\n        if (ldb.sr) func.call(this,ldb);\r\n        else for (var t in ldb) func_t.call(this,ldb[t]);\r\n      },\r\n      prep_board_init: function(ldb){ // for initial only\r\n        this.prep_board_init_1(ldb.sr, this.data_p);\r\n        this.prep_board_init_1(ldb.srt,this.data_t);\r\n      },\r\n      prep_board_init_1: function(ldbs,dst){ // for initial only\r\n        var data = ldbs[this.time_sel][1];\r\n        var offset = (this.time_base - ldbs[this.time_sel][0])/this.time_unit; // offset>=0 is always true.\r\n        var i = offset;\r\n        while (i<data.length) {\r\n          if (data[i]) dst[i-offset] += data[i];\r\n          i++;\r\n        }\r\n      },\r\n    };\r\n    var StatsFromNo = function(parent){\r\n      this.data_p = [];\r\n      this.min_idx = 0;\r\n      for (var i in StatsFromNo_prototype) this[i] = StatsFromNo_prototype[i];\r\n      this.__proto__ = parent;\r\n    };\r\n    var StatsFromNo_prototype = {\r\n      prep_board_subscribe: function(ldb){\r\n        if (!ldb.s) setup_board_no(ldb,'s');\r\n        ldb.s[this.time_sel][2].push(this);\r\n      },\r\n      prep_board_unsubscribe: function(ldb){\r\n        if (ldb.s && this.time_sel) {\r\n          var idx = ldb.s[this.time_sel][2].indexOf(this);\r\n          if (idx!=-1) ldb.s[this.time_sel][2].splice(idx,1);\r\n        }\r\n      },\r\n      prep: function(tree, func, subscribe, aggregate){\r\n        if (subscribe) this.__proto__.prep.call(this.fromNo,'live',this.fromNo.prep_board_subscribe, null);\r\n        if (aggregate) for (var i=this.min_idx;i<this.data_p.length;i++) this.data_p[i] = 0;\r\n        this.new_vals = {};\r\n        this.__proto__.prep.call(this, 'live', func, null);\r\n        for (var i in this.new_vals) this[i] = this.new_vals[i];\r\n        delete this.new_vals;\r\n      },\r\n      prep_board: function(ldb,func){\r\n        func.call(this,ldb);\r\n      },\r\n      prep_board_init: function(ldb,func){\r\n        var data = ldb.s[this.time_sel][1];\r\n        var offset = (this.time_base - ldb.s[this.time_sel][0])/this.time_unit; // offset>=0 is always true.\r\n        var i = this.min_idx + offset;\r\n        if (i<2) i = 2; // skip [0], because [0] contains old data.\r\n        var data_last;\r\n        var j=i-1;\r\n        while (j>0 && !data[j]) j--;\r\n        if (j>0) data_last = data[j];\r\n        else {\r\n          while (i<data.length && !data[i]) i++;\r\n          data_last = data[i++];\r\n        }\r\n        while (i<data.length) {\r\n          if (data[i]) {\r\n            this.data_p[i-offset] += data[i] - data_last;\r\n            data_last = data[i];\r\n          }\r\n          i++;\r\n        }\r\n        if (this.new_vals.min_idx===undefined || this.new_vals.min_idx > i - offset) this.new_vals.min_idx = i - offset;\r\n      },\r\n      update_posts_no: function(time_base,idx_in){\r\n        var idx = (time_base-this.time_base)/this.time_unit + idx_in;\r\n        if (idx>=0 && idx<this.min_idx) this.min_idx = idx;\r\n      },\r\n      prep_board_check_valid: function(ldb,func){\r\n        this.valid &= ldb.s[time_unit_arr.length]>=0;\r\n      },\r\n//      __proto__: Stats.prototype\r\n    };\r\n////    function setup_board_no(ldb, data, time_sel){\r\n////      for (var t in ldb) if (ldb[t].s) update_posts_no_1(ldb[t].s, ldb[t].sn, 0, ldb, time_sel);\r\n////      var j=0;\r\n////      while (j<data.length && !data[j]) j++;\r\n////      if (j!==0 && j!=data.length) for (var i=0;i<j;i++) data[i] = data[j];\r\n////if (pref.test_mode['43']) {\r\n////      while (j<data.length) {if (!data[j]) data[j] = data[j-1];j++;} // cause spike\r\n////} else {  \r\n////      while (j<data.length) { // average, not debugged.\r\n////        var j_old = j++;\r\n////        while (j<data.length && !data[j]) j++;\r\n////        if (j_old+1===j) continue;\r\n////        if (j<data.length) {\r\n//////console.log('setup_board_no: averaging: '+j_old+', '+j);\r\n////          var step = (data[j]-data[j_old])/(j-j_old);\r\n////          for (var i=1;i<j-j_old;i++) data[j_old+i] = data[j_old]+Math.floor(step*i);\r\n////        }\r\n////      }\r\n////}\r\n////    }\r\n    function update_board_rm(ldb){\r\n      if (!ldb.sr) {\r\n        setup_board_no(ldb,'sr');\r\n        setup_board_no(ldb,'srt');\r\n//        for (var i=0;i<time_unit_arr.length;i++) for (var j=0;j<pref.stats.len_capture+2;j++) ldb.sr[i][1][j] = 0;\r\n      }\r\n      for (var t in ldb) {\r\n        if (ldb[t].s) for (var i=0;i<time_unit_arr.length;i++) {\r\n          update_posts_no_1(ldb.sr[i],  null, 0, ldb[t].s.length, ldb[t].s, time_unit_arr[i], update_posts_rm_1_func, 0);\r\n          update_posts_no_1(ldb.srt[i], null, 0, 1,               ldb[t].s, time_unit_arr[i], update_posts_rm_1_func, 0);\r\n        }\r\n        delete ldb[t];\r\n      }\r\n    }\r\n    function setup_board_no(ldb,key){\r\n      Object.defineProperty(ldb, key, {value:[], configurable:true, writable:false});\r\n      for (var i=0;i<time_unit_arr.length;i++) {\r\n//        ldb[key][i] = [null,[],[],0]; // [time_base, data, subscribers, tolerance]\r\n        ldb[key][i] = [null,(i<3)?[]:{length:pref.stats.len_capture+2, __proto__:Array.prototype},[],0];\r\n//        ldb[key][i] = [null,{length:pref.stats.len_capture+2, __proto__:Array.prototype},[],0]; // debug // length isn't updated automatically after 'splice' shorten it.\r\n        update_posts_no_time(ldb[key][i], time_unit_arr[i]);\r\n      }\r\n      if (key==='s') ldb[key][time_unit_arr.length] = -Object.keys(ldb).length; // count\r\n    }\r\n    function update_posts_no_time(ldbst, time_unit, idx_over){\r\n      var time_now = Math.floor((Date.now()/60000 + ldbst[3])/time_unit)*time_unit;\r\n      var time_base = time_now - time_unit * pref.stats.len_capture;\r\n      if (!ldbst[0]) {ldbst[0] = time_base;return;} // initialize\r\n      else if (time_base!==ldbst[0] || idx_over) {\r\n        var shift = (time_base-ldbst[0])/time_unit;\r\n        var shift_add = 0;\r\n        if (idx_over>shift && pref.stats.tolerant) {\r\n          if (ldbst[3] + (idx_over-shift)*time_unit<pref.stats.tolerance) {\r\n            ldbst[3] = idx_over*time_unit;\r\n            shift_add = idx_over - shift;\r\n          } else {\r\n            ldbst[3] = pref.stats.tolerance;\r\n            shift_add = Math.floor((pref.stats.tolerance-ldbst[3])/time_unit);\r\n          }\r\n        }\r\n        ldbst[1].splice(0, shift + shift_add);\r\n        if (!Array.isArray(ldbst[1])) ldbst[1].length = pref.stats.len_capture+2;\r\n//        var last_data = ldbst[1][ldbst[1].length-1];\r\n//        for (var i=0;i<shift+shift_add;i++) ldbst[1][ldbst[1].length] = last_data;\r\n        ldbst[0] = time_base + shift_add*time_unit;\r\n        return shift + shift_add;\r\n      }\r\n    }\r\n    function update_posts_rm_1_func(data,idx){\r\n      data[idx] = (data[idx] || 0) +1;\r\n    }\r\n    function update_posts_no_1_func(data,idx,th,j){\r\n      var post_no = th.posts[j].no || th.no;\r\n      if (data[idx]===undefined || data[idx]<post_no) data[idx] = post_no;\r\n    }\r\n    function update_posts_no(ldb, th, start, lths){\r\n      if (!ldb.s) setup_board_no(ldb,'s');\r\n      for (var i=0;i<time_unit_arr.length;i++) update_posts_no_1(ldb.s[i], th, start, lths.length, lths, time_unit_arr[i], update_posts_no_1_func, th.posts.length);\r\n      ldb.s[time_unit_arr.length]++;\r\n    }\r\n    function update_posts_no_1(ldbst, th, start, end, lths, time_unit, func, j){\r\n      var time_base = ldbst[0];\r\n      var data = ldbst[1];\r\n      var idx_old;\r\n      for (var p=end-1;p>=start;p--) {\r\n        var idx = Math.floor((lths[p]-time_base)/time_unit);\r\n        if (--j>=0 && idx===idx_old) continue;\r\n        var idx_over = idx - pref.stats.len_capture -1;\r\n        if (idx_over>0) {\r\n          idx -= update_posts_no_time(ldbst, time_unit, idx_over);\r\n          if (idx>pref.stats.len_capture+1) idx = pref.stats.len_capture+1;\r\n          time_base = ldbst[0];\r\n        } else if (idx<0) idx = 0;\r\n        func(data,idx,th,j);\r\n        if (idx===0) break;\r\n        idx_old = idx;\r\n      }\r\n      for (var k=0;k<ldbst[2].length;k++) ldbst[2][k].update_posts_no(time_base,idx);\r\n    }\r\n        \r\n    var auto_acquisition_keys = {};\r\n    function get_ac_key(sel){return pref.catalog_board_list_obj[sel][0].key;} // key is a user string.\r\n    function auto_acquisition_beforeunload(){\r\n      if (pref.stats.auto_acquisition && cataLog.embed_mode!=='thread')\r\n        for (var i=pref.catalog_board_list_obj.length-1;i>=0;i--)\r\n          if (auto_acquisition_keys['@'+get_ac_key(i)]!==undefined) {\r\n            var tgts = cataLog.catalog_refresh_1('chart', false, false, false, false, i, false, true);\r\n            if (typeof(tgts)!=='function') new Stats(null, tgts, get_ac_key(i), false).destroy();\r\n          }\r\n    }\r\n    window.addEventListener('beforeunload', auto_acquisition_beforeunload, false);\r\n    function auto_acquisition_init(idx){\r\n      if (pref.stats.auto_acquisition && cataLog.catalog_refresh_1 && cataLog.embed_mode!=='thread') {\r\n        if (idx===undefined) idx = pref.catalog_board_list_obj.length-1;\r\n        while (idx>=0 && (!pref.catalog_board_list_obj[idx][0].cmds || pref.catalog_board_list_obj[idx][0].cmds.indexOf('stats')===-1)) idx--;\r\n        if (idx>=0) {\r\n          if (pref.stats.auto_acquisition) stats.register_auto_acquisition(idx);\r\n          var result = cataLog.catalog_refresh_1('chart', false, false, false, 'stats_ac', idx, false, true, function(){auto_acquisition_init(idx-1);});\r\n          if (typeof(result)==='function') result(function(){auto_acquisition_init(idx);});\r\n        }\r\n      }\r\n    }\r\n    if (pref.stats.auto_acquisition_scan) setTimeout(auto_acquisition_init, pref.stats.auto_acquisition_scan_delay*1000);\r\n    return {\r\n      aggregate: function(th){\r\n        if (!th.posts) return;\r\n        var ldb = liveTag.mems[th.domain][th.board];\r\n        var lth = ldb[th.no];\r\n        if (!lth.s) lth.s = []; // stat\r\n        var tu = th.parse_funcs.time_unit;\r\n        var start = lth.s.length;\r\n        var p = start;\r\n        var i = th.posts.length - (th.nof_posts - lth.s.length);\r\n        if (i<0) return; // i=0; // {p=-i; i=0;} // patch for short thread (last 50 replies) at embed_mode==='thread'.\r\n        while (i<th.posts.length) lth.s[p++] = Math.floor(th.posts[i++].time * tu / 60000);\r\n        if (lth.ss) { // subscribers\r\n          if (Array.isArray(lth.ss)) for (var i=0;i<lth.ss.length;i++) lth.ss[i].update_thread(lth.s,start, true);\r\n          else lth.ss.update_thread(lth.s,start, true);\r\n        } else if (start===0) thread_created(lth);\r\n        if (pref3.stats.estimate_posts) update_posts_no(ldb, th, start, lth.s, th.posts.length);\r\n      },\r\n      thread_removed: thread_removed,\r\n      Stats: Stats,\r\n      register_auto_acquisition: function(sel){\r\n        auto_acquisition_keys['@'+get_ac_key(sel)] = null;\r\n        cnst.auto_shrink_board_selector.color();\r\n      },\r\n      query_auto_acquisition: function(sel){\r\n        return auto_acquisition_keys['@'+get_ac_key(sel)]!==undefined;\r\n      },\r\n//      redraw_all: function(){\r\n//        for (var i=0;i<instances.length;i++) instances[i].init();\r\n//      }\r\n    };\r\n  })() : null;\r\n               \r\n\r\n  function make_chart_obj(pn1){\r\n//    var pref_graph = {key: null, pipe: null}; // working code.\r\n//    pn1.addEventListener('click', show_hide, false);\r\n//    var data = chart_data_init();\r\n//    pref_graph.key = pref.script_prefix + '.graph.' + site.board;\r\n//    if (localStorage && pref.load_data && localStorage.getItem(pref_graph.key)!==null) data = brwsr.JSON_parse(localStorage.getItem(pref_graph.key));\r\n//\r\n//    var pn2_func = null;\r\n//    function show_hide(){  // Toggle Show/Hide\r\n//      if (pn2_func==null) pn2_func = prep_pn2();\r\n//      else pn2_func = pn2_func.destroy();\r\n//    }\r\n//    var size_loc = ['400px', '400px', '5px', '50px', '120px', '390px'];\r\n\r\n    var time_unit_sel_html =\r\n      '<select name=\"chart.inst.time_sel\">'+\r\n        '<option>1 min</option>'+\r\n        '<option>10 mins</option>'+\r\n        '<option>1 hour</option>'+\r\n        '<option>1 day</option>'+\r\n        '<option>1 week</option>'+\r\n      '<select>';\r\n    var chart_options_str = [\r\n        'Number of points: <input type=\"text\" name=\"chart.inst.len\" size=\"3\" style=\"text-align: right;\"><br>',\r\n        'Scale of new thread: <input type=\"text\" name=\"chart.inst.scale_thread\" size=\"3\" style=\"text-align: right;\"><br>',\r\n//        '<input type=\"checkbox\" name=\"chart.inst.separate\">Separate estimated, observed and alive<br>',\r\n        'Show: Posts/Threads:<br>',\r\n        '&emsp;&emsp;<input type=\"checkbox\" name=\"chart.inst.show.np\">'+\r\n        '<input type=\"checkbox\" name=\"chart.inst.show.nt\" disabled style=\"opacity:0\"> Estimated, '+\r\n        '<input type=\"checkbox\" name=\"chart.inst.clip_np\">Clip: '+\r\n          '<input type=\"text\" name=\"chart.inst.clip_np_val\" size=\"4\" style=\"text-align: right;\"><br>',\r\n        '&emsp;&emsp;<input type=\"checkbox\" name=\"chart.inst.show.p\">'+\r\n        '<input type=\"checkbox\" name=\"chart.inst.show.t\"> Observed<br>',\r\n        '&emsp;&emsp;<input type=\"checkbox\" name=\"chart.inst.show.ep\">'+\r\n        '<input type=\"checkbox\" name=\"chart.inst.show.et\"> Alive<br>',\r\n        '<input type=\"checkbox\" name=\"chart.inst.show_legend\">Legend<br>',\r\n        '<input type=\"checkbox\" name=\"chart.inst.options.animation\">Animation (Doesn\\'t work on FF)<br>',\r\n        '<input type=\"checkbox\" name=\"chart.inst.options.pointDot\">Point dot: radius '+\r\n          '<input type=\"text\" name=\"chart.inst.options.pointDotRadius\" size=\"1\" style=\"text-align: right;\"><br>'\r\n      ];\r\n    if (!pn1) return {\r\n      time_unit_sel_html: time_unit_sel_html,\r\n      chart_options_str: chart_options_str,\r\n    }\r\n\r\n    pn1.addEventListener('click', make_new_chart, false);\r\n    var charts = [];\r\n    function make_new_chart(){\r\n      cnst.subscribe(charts,new PostChart());\r\n      if (charts.length===1) {\r\n        common_func.dom_addEventListener(common_obj.events_beforeunload, window, 'focus', window_focus);\r\n        common_func.dom_addEventListener(common_obj.events_beforeunload, window, 'blur', window_blur);\r\n      }\r\n    }\r\n    function window_focus(){\r\n      cnst.foreach(charts, function(inst){inst.chart_posts.options.animation = inst.options.animation;});\r\n    }\r\n    function window_blur(){\r\n      if (pref.chart.off_anime_blur) cnst.foreach(charts, function(inst){inst.chart_posts.options.animation = false;});\r\n    }\r\n    function destroy_all(){\r\n      cnst.foreach(charts, function(inst){inst.destroy();});\r\n    }\r\n    window.addEventListener('beforeunload', destroy_all, false);\r\n\r\n    var count = 0;\r\n    var PostChart = function(pn_popup, tgts){\r\n//      this.data_graph;\r\n//      this.chart_posts;\r\n      common_func.deep_copy(this,pref.chart.inst);\r\n      if (!pn_popup) {\r\n        this.name = 'graph_' + count++;\r\n\r\n        this.pn2_obj = cnst.init3({\r\n          this_obj:this,\r\n          __proto__:this.pn2_template});\r\n        var pn2 = this.pn2_obj.pn;\r\n        var pn2_2 = cnst.add_to_tb(pn2,\r\n          time_unit_sel_html + \r\n          '<select name=\"chart.inst.board_sel\"><select>'+\r\n          '<button name=\"settings\"><img src=\"' + cnst.icons.settings + '\" style=\"width:14px;height:14px\"></button>');\r\n        var pn2_settings = document.createElement('div');\r\n        pn2_settings.className = 'CatChan_window';\r\n        pn2_settings.style = 'display:none;clear:both';\r\n        pn2_settings.innerHTML = pref_func.format_html_str(\r\n          '<div style=\"float:right\">'+ chart_options_str.join('') + '</div>'+\r\n          '<div style=\"clear:both\"></div>');\r\n        pn2.childNodes[0].appendChild(pn2_settings);\r\n        pref_func.apply_prep(pn2,false);\r\n        var pns = pn2.getElementsByTagName('*');\r\n        cnst.auto_shrink_selector(pns['chart.inst.time_sel']);\r\n        this.pn_board_sel = pns['chart.inst.board_sel'];\r\n        cnst.auto_shrink_board_selector.setup(this.pn_board_sel, pref.catalog_board_list_sel);\r\n        this.board_sel = pref.catalog_board_list_sel;\r\n        this.pn_canvas_root = pn2.childNodes[1];\r\n      } else {\r\n        this.pn_canvas_root = pn_popup;\r\n        this.pn_canvas_root.style.width = pref.chart.window_width + 'px';\r\n        this.pn_canvas_root.style.height = pref.chart.window_height + 'px';\r\n        this.show = {np:false, p:true, ep:false, nt:false, t:true, et:false};\r\n      }\r\n      this.pn_canvas = document.createElement('canvas');\r\n      this.pn_canvas_root.appendChild(this.pn_canvas);\r\n      this.chart_size_changed(true); // patch\r\n      if (!pn_popup) {\r\n        this.legend = cnst.init3({\r\n          func_str:'border:1px solid lightblue:cursor:move:position:absolute:left:80px:top:40px',\r\n        });\r\n        this.pn2 = pn2;\r\n        this.set_legend_str();\r\n        if (this.show_legend) this.append_legend();\r\n      }\r\n  //      this.chart_create_draw(); called from stats\r\n      this.stats = (!pn_popup)? new stats.Stats(this, this.get_tgts(), pref.catalog_board_list_obj[this.board_sel][0].key) : // call 'chart_create_draw' in this.\r\n                                new stats.Stats(this, tgts, 'popup');\r\n  //      this.track_legend_pos();\r\n      if (!pn_popup) {\r\n        pn2.childNodes[0].onchange = this.onchange_entry.bind(this);\r\n        pns['settings'].onclick = this.toggle_settings.bind(this);\r\n        this.pn2_settings = pn2_settings;\r\n      }\r\n  ////      pn2.addEventListener('resize',  //) // can't get.\r\n      this.pn_canvas_root.onclick = this.chart_size_changed.bind(this);\r\n  //      pn2.ondragover = this.dragover_pn2.bind(this);\r\n  //      pn2.ondrop = this.drop_pn2.bind(this);\r\n  //      this.legend.pn.ondragend = function(e){e.stopPropagation();};\r\n      if (!pn_popup) cnst.bottom_top(pn2);\r\n    };\r\n    PostChart.prototype = {\r\n      get_tgts: function(scan_name){\r\n        return (!cataLog.catalog_refresh_1)? [site.nickname+site.board] :\r\n                                             cataLog.catalog_refresh_1('chart', false, false, false, scan_name, this.board_sel, false, true);\r\n      },\r\n      board_sel_changed: function(e){\r\n        e.target.blur();\r\n        var tgts = this.get_tgts((pref.chart.instant_scan)? this.name : null); // also scan\r\n        if (typeof(tgts)==='function') tgts(this.board_sel_changed.bind(this));\r\n        else this.stats.tgts_changed(tgts, pref.catalog_board_list_obj[this.board_sel][0].key);\r\n      },\r\n      len_changed: function(){\r\n        if (this.len>this.stats.len) this.stats.len_changed.call(this.stats, this.len); // call redraw\r\n        else if (this.stats.len!=pref.stats.len_capture) this.stats.len_changed.call(this.stats, pref.stats.len_capture); // call redraw\r\n        else this.replace_data(this.data_src);\r\n      },\r\n      chart_size_changed: function(init){ // patch\r\n//        if (str==='top' || str==='bottom') this.pn_canvas_root.style.overflow = '';\r\n//        else if (typeof(str)==='string') this.pn_canvas_root.style.overflow = 'hidden';\r\n//        this.pn_canvas_root.style.resize = 'both';\r\n//        if (this.pn_canvas_root.style.overflow==='hidden') {\r\n//        if (this.pn2_obj.maximize_state_str==='float') {\r\n          this.pn_canvas.style.width  = this.pn_canvas_root.style.width;\r\n          this.pn_canvas.style.height = (this.pn_canvas_root.style.height.replace(/px/,'')-10)+'px';\r\n          this.pn_canvas.width  = this.pn_canvas_root.clientWidth;\r\n          this.pn_canvas.height = this.pn_canvas_root.clientHeight - 10;\r\n//        }\r\n        if (init!==true) this.chart_redraw();\r\n      },\r\n      chart_redraw: function(){ // old 'chart_create_draw' in this.\r\n        if (this.chart_posts) this.chart_posts.destroy();\r\n        \r\n        this.data_graph = chart_data_init(); // deep copy always.\r\n        var dd = this.data_graph.datasets;\r\n        var fN = this.data_src.fromNo;\r\n        var dr = this.data_src.rm;\r\n        var ds = this.data_src;\r\n//        this.idxs  = (dr)? ((fN)? {p:1, t:3, ep:2, et:4, np:0} : {p:0, t:2, ep:1, et:3}) :\r\n//                           ((fN)? {t:1, np:0} : {t:1, p:0});\r\n        var layer = 0;\r\n        this.idxs = {};\r\n        var idxs = this.idxs;\r\n        idxs.np = (fN && this.show.np)? layer++ : -1;\r\n        idxs.p  = (      this.show.p )? layer++ : -1;\r\n        idxs.ep = (dr && this.show.ep)? layer++ : -1;\r\n        idxs.t  = (      this.show.t )? layer++ : -1;\r\n        idxs.et = (dr && this.show.et)? layer++ : -1;\r\n\r\n        if (idxs.np!=-1) dd[idxs.np] = chart_data_init_1('post_fromNo','151,187,205',0.2);\r\n        if (idxs.p !=-1) dd[idxs.p ] = chart_data_init_1('Posts','98,152,179', 0.2);\r\n        if (idxs.ep!=-1) dd[idxs.ep] = chart_data_init_1('exist_p','66,119,136',0.15); // '151,187,205',0.2\r\n        if (idxs.t !=-1) dd[idxs.t ] = chart_data_init_1('Threads','204,0,0', 0.2);\r\n        if (idxs.et!=-1) dd[idxs.et] = chart_data_init_1('exist_t','140,0,0',0.2); // '204,128,128',0.2\r\n\r\nif (pref.test_mode['39'] && dd[pref.test_mode.num]) dd[pref.test_mode.num] = chart_data_init_1(dd[pref.test_mode.num].label,pref.test_mode.test_str, pref.test_mode.num_f);\r\n        var start = (this.len<this.stats.len)? this.stats.len - this.len : 0;\r\n        this.data_graph.labels = ds.data_l.slice(start); // I don't know why, but shallow copy is required, I can't use source array directly.\r\n        if (idxs.p !=-1) dd[idxs.p].data = this.stats.merge_1(ds.data_p.slice(start), (ds.data_p_old)? ds.data_p_old.slice(start) : null);\r\n        if (idxs.t !=-1) {\r\n          dd[idxs.t].data = this.stats.merge_1(ds.data_t.slice(start), (ds.data_t_old)? ds.data_t_old.slice(start) : null);\r\n          if (this.scale_thread!=1) this.scale_setup(dd[idxs.t].data);\r\n        }\r\n        if (dr) {\r\n//          dd[5] = chart_data_init_1('old_t','204,0,0');\r\n//          dd[0].data = ds.data_p.slice(start);\r\n//          dd[1].data = ds.data_t.slice(start);\r\n//          dd[2].data = dr.data_p.slice(start); // raw\r\n//          dd[3].data = dr.data_t.slice(start);\r\n          if (idxs.ep!=-1) dd[idxs.ep].data = this.arr_dec_slice(ds.data_p, dr.data_p, start);\r\n          if (idxs.et!=-1) {\r\n            dd[idxs.et].data = this.arr_dec_slice(ds.data_t, dr.data_t, start);\r\n            if (this.scale_thread!=1) this.scale_setup(dd[idxs.et].data);\r\n          }\r\n//          dd[2].data = ds.data_p.map(function(v,i){return v - this[i];}.bind(dr.data_p)); // TOO SLOW...\r\n//          dd[3].data = ds.data_t.map(function(v,i){return v - this[i];}.bind(dr.data_t));\r\nif (pref.test_mode['40']) {\r\n//          dd[4] = chart_data_init_1('old_p','98,152,179');\r\n//          dd[4].fillColor = 'rgba(0,255,0,0.2)';\r\n          dd[layer] = chart_data_init_1('old_p','0,255,0',0.1);\r\n          dd[layer++].data = ds.data_p_old.slice(start);\r\n          dd[layer] = chart_data_init_1('p_raw','98,152,179',0.2);\r\n          dd[layer++].data = ds.data_p.slice(start);\r\n//          dd[5].data = ds.data_t_old.slice(start);\r\n}\r\n        }\r\n        if (fN && idxs.np!=-1) {\r\n          dd[idxs.np].data = (fN.data_p_old)? fN.data_p_old.concat(fN.data_p.slice(fN.data_p_old.length)).slice(start) : fN.data_p.slice(start);\r\n          if (fN.data_p_old) {\r\n            var idx_last = fN.data_p_old.length-1;\r\n            if (fN.data_p[idx_last]>fN.data_p_old[idx_last]) if (idx_last-start>=0) dd[idxs.np].data[idx_last-start] = fN.data_p[idx_last]; // overwrite last data, because last data may NOT complete its period.\r\n          }\r\n          if (this.clip_np) {\r\n            var data_np = dd[idxs.np].data;\r\n            for (var i=0;i<data_np.length;i++) data_np[i] = this.clip_np_func(data_np[i]);\r\n          }\r\n//          dd[idxs.np].data = fN.data_p.slice(start);\r\n//          var old_sliced = fN.data_p_old.slice(start);\r\n//          for (var i=0;i<old_sliced.length;i++)\r\n//            if (old_sliced[i])\r\n//              dd[idxs.np].data[i] = old_sliced[i];\r\nif (pref.test_mode['41']) {\r\n          dd[layer] = chart_data_init_1('post_fromNo_old','0,255,0',0.2);\r\n          dd[layer++].data = fN.data_p_old.slice(start);\r\n          dd[layer] = chart_data_init_1('post_fromNo','0,128,0',0);\r\n          dd[layer++].data = fN.data_p.slice(start);\r\n}\r\n        }\r\n//        Chart.defaults.global.animation = pref.stats.animation;\r\n        this.scale_thread_old = this.scale_thread;\r\n        var ctx = this.pn_canvas.getContext('2d');\r\n        this.chart_posts = new Chart(ctx).Line(this.data_graph, this.options);\r\n      },\r\n      clip_np_func: function(data){\r\n        return (data<0)? 0 :\r\n               (data>this.clip_np_val)? this.clip_np_val : data;\r\n      },\r\n      arr_dec_slice: function(src, dec, start){\r\n        var arr = [];\r\n        var p = 0;\r\n        for (var i=start;i<src.length;i++) arr[p++] = src[i] - dec[i];\r\n        return arr;\r\n      },\r\n      scale_setup: function(dst,old){\r\n        if (old!==undefined) for (var i=0;i<dst.length;i++) dst[i].value = dst[i].value/old*this.scale_thread;\r\n        else for (var i=0;i<dst.length;i++) dst[i] *= this.scale_thread;\r\n        return dst;\r\n      },\r\n      scale_changed: function(){\r\n        this.set_legend_str();\r\n        if (this.scale_thread_old!==0) {\r\n          this.scale_setup(this.chart_posts.datasets[this.idxs.t].points, this.scale_thread_old);\r\n          if (this.idxs.et!==undefined && this.data_graph.datasets[this.idxs.et]) this.scale_setup(this.chart_posts.datasets[this.idxs.et].points, this.scale_thread_old);\r\n          this.chart_posts.update();\r\n        } else this.chart_redraw();\r\n        this.scale_thread_old = this.scale_thread;\r\n      },\r\n      set_legend_str: function(){\r\n//        var str = '<ul class=\"line-legend\"><li style=\"color:rgba(98,152,179,1)\"><span style=\"color: black;\">Posts</span></li><li style=\"color:rgba(204,0,0,1)\"><span style=\"color: black;\">Threads ' + ((this.scale_thread==1)? '' : 'x'+ this.scale_thread) + '</span></li></ul>'\r\n        var str = '<span style=\"color:rgba(98,152,179,1)\">\\u25cf</span><span style=\"color: black;\"> Posts</span><br>'+\r\n                  '<span style=\"color:rgba(204,0,0,1)\">\\u25cf</span><span style=\"color: black;\"> Threads ' + ((this.scale_thread==1)? '' : 'x'+ this.scale_thread+' ') + '</span>'\r\n        this.legend.pn.innerHTML = str;\r\n      },\r\n//      dragover_pn2: function(e) {e.preventDefault();}, // working code.\r\n//      drop_pn2: function (e) {\r\n//        e.preventDefault(); // FF require this.\r\n//        var str = e.dataTransfer.getData('text');\r\n//        if (str!='') {\r\n//          if (pref.import_format=='obj') data = JSON.parse(str);\r\n//          else {\r\n//            var str_s = str.split(/\\r\\n|\\r|\\n|\\\\n/);\r\n//            data.labels = str_s[0].split(',');\r\n//            for (var i=0;i<2;i++) {\r\n//              var str_sc = str_s[i+1].split(',');\r\n//              for (var j=0;j<str_sc.length;j++) data.datasets[i].data[j] = (str_sc[j]!='')? parseInt(str_sc[j],10) : 0;\r\n//            }\r\n//          }\r\n//        }\r\n//        chart_redraw();\r\n//      },\r\n      toggle_settings: function(e){\r\n        cnst.show_hide(this.pn2_settings, null, this.legend.pn);\r\n        cnst.toggleButton(e.currentTarget);\r\n      },\r\n      destroy : function (){\r\n        if (!brwsr.ff) this.chart_posts.stop();\r\n        this.chart_posts.destroy();\r\n//        pn2.removeEventListener('click', chart_redraw, false);\r\n//        pn2.removeEventListener('dragover', dragover_pn2, false);\r\n//        pn2.removeEventListener('drop', drop_pn2, false);\r\n//        pn2.removeEventListener('dragend', div_dragend_pn2, false);\r\n//        pn6.removeEventListener('dragend', function(e){e.stopPropagation();}, false);\r\n        //        size_loc = [pn2.style.width, pn2.style.height, pn2.style.left, pn2.style.bottom, pn6.style.left, pn6.style.bottom];\r\n        this.stats.destroy();\r\n        this.stats = null;\r\n        if (this.pn2) {\r\n          cnst.div_destroy(this.legend.pn, false, this.legend);\r\n          cnst.div_destroy(this.pn2, true, this.pn2_obj);\r\n          cnst.auto_shrink_board_selector.destroy(this.pn_board_sel);\r\n          cnst.unsubscribe(charts, this);\r\n        }\r\n        return null;\r\n      },\r\n//      clear : function () {this.chart_redraw();}, // working code.\r\n//      update_data : function(time_str, posts, threads){\r\n//        while (data_graph.labels.length>=pref.max_graph) chart_posts.removeData();\r\n//        chart_posts.addData([posts,threads*pref.scale_thread],time_str);\r\n//        chart_posts.update();\r\n//      },\r\n//      update: function(){\r\n//        chart_redraw();\r\n//      },\r\n      replace_data: function(src){\r\n        if (!this.stats) this.stats = src; // patch\r\n        this.data_src = src;\r\n        this.chart_redraw();\r\n      },\r\n      update_data2 : function(src){\r\n        var i = src.shift;\r\n        while (i>0) {this.chart_posts.removeData();i--;}\r\n        var data = [];\r\n        for (var i=src.data_p.length-src.shift;i<src.data_p.length;i++) {\r\n          if (src.fromNo && this.idxs.np!=-1) data[this.idxs.np] = (this.clip_np)? this.clip_np_func(src.fromNo.data_p[i]) : src.fromNo.data_p[i];\r\n          if (this.idxs.p!=-1) data[this.idxs.p] = src.data_p[i];\r\n          if (this.idxs.t!=-1) data[this.idxs.t] = src.data_t[i]*this.scale_thread;\r\n          if (src.rm) {\r\n            if (this.idxs.ep!=-1) data[this.idxs.ep] =  src.data_p[i] - src.rm.data_p[i];\r\n            if (this.idxs.et!=-1) data[this.idxs.et] = (src.data_t[i] - src.rm.data_t[i])*this.scale_thread;\r\n          }\r\n          this.chart_posts.addData(data, src.data_l[i]);\r\n        }\r\n        var tgt_p = (this.idxs.p!=-1)? this.chart_posts.datasets[this.idxs.p] : null;\r\n        var tgt_t = (this.idxs.t!=-1)? this.chart_posts.datasets[this.idxs.t] : null;\r\n        var tgt_ep = (this.idxs.ep!=-1 && src.rm)? this.chart_posts.datasets[this.idxs.ep] : null;\r\n        var tgt_et = (this.idxs.et!=-1 && src.rm)? this.chart_posts.datasets[this.idxs.et] : null;\r\n        var tgt_np = (this.idxs.np!=-1 && src.fromNo)? this.chart_posts.datasets[this.idxs.np] : null;\r\n        var p = src.min_idx - (this.stats.len - this.len);\r\n        var i = src.min_idx;\r\n        if (p<0) {\r\n          i += -p;\r\n          p=0;\r\n        }\r\n        while (i<src.data_p.length-src.shift) {\r\n          if (tgt_p) tgt_p.points[p].value =  (src.data_p_old && src.data_p_old[i]>src.data_p[i])? src.data_p_old[i] : src.data_p[i];\r\n          if (tgt_t) tgt_t.points[p].value = ((src.data_t_old && src.data_t_old[i]>src.data_t[i])? src.data_t_old[i] : src.data_t[i]) *this.scale_thread;\r\n//            chart_posts.label.points[p].value = src.data_l[i];\r\n          if (tgt_ep) tgt_ep.points[p].value =  src.data_p[i] - src.rm.data_p[i];\r\n          if (tgt_et) tgt_et.points[p].value = (src.data_t[i] - src.rm.data_t[i]) *this.scale_thread;\r\n          if (tgt_np) tgt_np.points[p].value = (this.clip_np)? this.clip_np_func(src.fromNo.data_p[i]) : src.fromNo.data_p[i];\r\n          p++;\r\n          i++;\r\n        }\r\n        src.shift = 0;\r\n        this.chart_posts.update();\r\n      },\r\n      append_legend: function(){this.pn2.appendChild(this.legend.pn);},\r\n      remove_legend: function(){this.pn2.removeChild(this.legend.pn);},\r\n    }\r\n    PostChart.prototype.pn2_template = {\r\n      get func_str(){return 'left:' +(((count-1)%5)*20)+ 'px:tile2:get:bottom:' +(((count-1)%5)*20)+ ':resize:both:float:left:Show:tb:width:' +\r\n        pref.chart.window_width + 'px:height:' + pref.chart.window_height + 'px:resize:both:overflow:hidden';},\r\n      rolldown: PostChart.prototype.append_legend,\r\n      rollup: PostChart.prototype.remove_legend,\r\n      maximize: PostChart.prototype.chart_size_changed,\r\n      maximize_embed_style_pn: {left:'auto', top:'auto', position:'relative', resize:'none'}, //  {left:'auto', top:'auto', position:'static', resize:'none'}\r\n      maximize_embed_style_pnch1: {}, //  {width:'auto', height:'auto', resize:'none'}\r\n      maximize_float_style_pnch1: {}, //  {width:state[3], height:state[4], resize:'both'}\r\n      exit: PostChart.prototype.destroy,\r\n    };\r\n    PostChart.prototype.onchange_entry = function(e){\r\n      var target_hier = pref_func.get_tgt(e.target.name.replace(/chart.inst./,''),this);\r\n      var prop   = target_hier[1];\r\n//      var prop = e.target.name.substr(e.target.name.lastIndexOf('.')+1);\r\n      var val = (e.target.type==='checkbox')? e.target.checked : (e.target.type==='text')? parseInt(e.target.value,10) : e.target.selectedIndex;\r\n//      if (this.options[prop]!==undefined) this.options[prop] = val;\r\n//      if (this.show[prop]!==undefined) this.show[prop] = val;\r\n//      else if (this[prop]!==undefined) this[prop] = val;\r\n      target_hier[0][prop] = val;\r\n      if (this.onchange_funcs[prop]) this.onchange_funcs[prop].call(this,e);\r\n    };\r\n    PostChart.prototype.onchange_funcs = {\r\n      pointDot: PostChart.prototype.chart_redraw,\r\n      pointDotRadius: PostChart.prototype.chart_redraw,\r\n      scale_thread: PostChart.prototype.scale_changed,\r\n      animation: function(){this.chart_posts.options.animation = this.options.animation;},\r\n      len: PostChart.prototype.len_changed,\r\n      separate: function(){this.stats.init();},\r\n      time_sel: function(e){e.target.blur();this.stats.time_unit_changed(this.time_sel);},\r\n      board_sel: PostChart.prototype.board_sel_changed,\r\n      show_legend: function(e){if (e.target.checked) this.append_legend(); else this.remove_legend();},\r\n      clip_np: PostChart.prototype.chart_redraw,\r\n      clip_np_val: PostChart.prototype.chart_redraw,\r\n    };\r\n    PostChart.prototype.onchange_funcs.np = PostChart.prototype.onchange_funcs.separate;\r\n    PostChart.prototype.onchange_funcs.p  = PostChart.prototype.onchange_funcs.separate;\r\n    PostChart.prototype.onchange_funcs.ep = PostChart.prototype.onchange_funcs.separate;\r\n    PostChart.prototype.onchange_funcs.t  = PostChart.prototype.onchange_funcs.separate;\r\n    PostChart.prototype.onchange_funcs.et = PostChart.prototype.onchange_funcs.separate;\r\n\r\n    return {\r\n      clear: function(){}, // dummys\r\n      dump: function(format){},\r\n      data_update: function(time_str, posts, threads){},\r\n      PostChart: PostChart,\r\n//      clear: function(){ // working code.\r\n//        data = chart_data_init();\r\n//        if (pn2_func!=null) pn2_func.clear();\r\n//      },\r\n//      dump: function(format){ // http://stackoverflow.com/questions/22055598/writing-a-json-object-to-a-text-file-in-javascript\r\n//        var url;\r\n//        if (format=='csv') {\r\n//          var out_labels = data.labels;\r\n//          var out_data0 = data.datasets[0].data;\r\n//          var out_data1 = data.datasets[1].data;\r\n//          url = 'data:text/json;charset=utf8,' + encodeURIComponent(out_labels) + '\\\\n' + encodeURIComponent(out_data0) + '\\\\n' + encodeURIComponent(out_data1);\r\n//        } else if (format=='obj') url = 'data:text/json;charset=utf8,' + JSON.stringify(data);\r\n//        window.open(url, '_blank');\r\n//        window.focus();\r\n//      },\r\n//      data_update: function(time_str, posts, threads){\r\n//        if (pn2_func!=null) pn2_func.data_update(time_str, posts, threads);\r\n//        if (data.labels.length>=pref.max_capture) {\r\n//          data.datasets[0].data.slice(-pref.max_capture+1);\r\n//          data.datasets[1].data.slice(-pref.max_capture+1);\r\n//          data.labels.slice(-pref.max_capture+1); // labels are copied shallowly, but now made deep copy manually.\r\n//        }\r\n//        data.labels.push(time_str);\r\n//        data.datasets[0].data.push(posts);\r\n//        data.datasets[1].data.push(threads);\r\n//        if (pref.aggregator=='true' && pref.write_to_ls && localStorage) {\r\n//          localStorage.setItem(pipe_name,  JSON.stringify([time_str, posts, threads]));\r\n//          localStorage.setItem(pref_graph.key, JSON.stringify(data));\r\n//        }\r\n      //      },\r\n      time_unit_sel_html: time_unit_sel_html,\r\n      chart_options_str: chart_options_str,\r\n    }\r\n    function chart_data_init() {\r\n      return {\r\n        labels: ['dummy','dummy'], // at least 2 data required at first, or filling collapse. This is probably a BUG in Chart.js.\r\n        datasets: []\r\n      };\r\n    }\r\n    function chart_data_init_1(label, color, alpha) {\r\n      return {\r\n        label: label,\r\n        fillColor: 'rgba(' + color + ',' + alpha + ')',\r\n        strokeColor: 'rgba(' + color + ',1)',\r\n        pointColor: 'rgba(' + color + ',1)',\r\n        pointStrokeColor: '#fff',\r\n        pointHighlightFill: '#fff',\r\n        pointHighlightStroke: 'rgba(' + color + ',1)',\r\n        data: [0,0]\r\n      };\r\n    }\r\n  }\r\n\r\n  function make_setting_obj(pn8){\r\n//  var setting = (function(){\r\n//    var pn8 = div_init(8,'55px','30px','button','settings');\r\n//    var pn8 = cnst.init('left:55px:bottom:30px:button:settings:Show');\r\n    pn8.addEventListener('click', show_hide, false);\r\n    var pn7 = null;\r\n    var pn7_1 = null;\r\n    function show_hide(){  // Toggle Show/Hide\r\n      pn7 = prep_pn7(pn7==null);\r\n    }\r\n    function prep_pn7(make){\r\n      if (make) {\r\n//        pn7 = div_init(7,'5px','50px','div','');\r\n//        pn7 = cnst.init('left:5px:bottom:50px:Show:tb',cnst.void_func,cnst.void_func,show_hide,cnst.void_func);\r\n//if (pref.test_mode['17']) pn7 = cnst.init('left:0px:tile:get:bottom:Show',cnst.void_func,cnst.void_func,show_hide,cnst.void_func); // leaks nodes.\r\nif (pref.test_mode['17']) {pn7 = document.createElement('div');pn7.innerHTML='<div></div><div></div>';site.root_body.appendChild(pn7);} // leaks nodes.\r\nelse \r\n        pn7 = cnst.init('left:0px:tile:get:bottom:Show:tb',cnst.void_func,cnst.void_func,show_hide,cnst.void_func)[0];\r\nif (pref.test_mode['17']) pn7_1 = pn7;\r\nelse \r\n        pn7_1 = pn7.childNodes[1];\r\n        pn7_1.innerHTML = '<div><div style=\"float:left\">\\\r\nStatistics:<br>\\\r\n&emsp;Interval: <input type=\"text\" name=\"interval_found\" size=\"6\" style=\"text-align: right;\">min<br>\\\r\n&emsp;<input type=\"checkbox\" name=\"check_page\"> Show page no. of this thread<br>\\\r\n&emsp;&emsp;<input type=\"checkbox\" name=\"show_page_fraction\"> Show fraction of page No.<br>\\\r\n&emsp;<input type=\"checkbox\" name=\"check_post\"> Show num of new posts in this board<br>\\\r\n&emsp;<input type=\"checkbox\" name=\"check_thread\"> Show num of new threads in this board<br>\\\r\n&emsp;&emsp; Max_capture: <input type=\"text\" name=\"max_capture\" size=\"6\" style=\"text-align: right;\"> points<br>\\\r\n&emsp;&emsp;&emsp;Show recent : <input type=\"text\" name=\"max_graph\" size=\"6\" style=\"text-align: right;\"> points in graph<br>\\\r\n&emsp;&emsp;&emsp;Scale of #threads in graph: <input type=\"text\" name=\"scale_thread\" size=\"6\" style=\"text-align: right;\"><br>\\\r\n<!-- &emsp;&emsp;<input type=\"radio\" name=\"autoconf\" value=\"auto\"> Automatic configuration<br>\\\r\n&emsp;&emsp;<input type=\"radio\" name=\"autoconf\" value=\"manual\"> Manual configuration<br> -->\\\r\n&emsp;&emsp;&emsp;<input type=\"radio\" name=\"aggregator\" value=\"true\"> Aggregate data<br>\\\r\n&emsp;&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"write_to_ls\"> Write to localStrage (server)<br>\\\r\n&emsp;&emsp;&emsp;<input type=\"radio\" name=\"aggregator\" value=\"false\"> Listen from localStrage (client)<br>\\\r\n&emsp;&emsp;<input type=\"checkbox\" name=\"load_data\"> Load data from localStrage at the start<br>\\\r\n&emsp;&emsp;Import format (drop whole text on graph)<br>\\\r\n&emsp;&emsp;&emsp;<input type=\"radio\" name=\"import_format\" value=\"csv\"> csv<br>\\\r\n&emsp;&emsp;&emsp;<input type=\"radio\" name=\"import_format\" value=\"obj\"> obj<br>\\\r\n&emsp;&emsp;<input type=\"button\" value=\"Dump(csv)\"><input type=\"button\" value=\"Dump(obj)\">&emsp;<input type=\"button\" value=\"Clear data\"><br>\\\r\n<input type=\"checkbox\" name=\"auto_start\"> Start automatically (Delayed 10sec.)<br>\\\r\n<br>'+\r\n//          'UIP tracker for 4chan:<br>'+\r\n//          '&emsp;<input type=\"checkbox\" name=\"uip_tracker.on\"> Show num of unique IPs after post No.<br>'+\r\n//          '&emsp;&emsp;<input type=\"checkbox\" name=\"uip_tracker.posts\"> Show num of posts(checking for deletion timing)<br>'+\r\n//          '&emsp;&emsp;Interval: <input type=\"text\" name=\"uip_tracker.interval\" size=\"3\" style=\"text-align: right;\">sec'+\r\n//          '&emsp;<input type=\"checkbox\" name=\"uip_tracker.adaptive\"> Adaptive<br>'+\r\n//          '&emsp;<input type=\"checkbox\" name=\"uip_tracker.auto_open\"> Open next thread automatically<br>'+\r\n//          '&emsp;&emsp;Conditions:<br>'+\r\n//          '&emsp;&emsp;&emsp;After <input type=\"text\" name=\"uip_tracker.auto_open_th\" size=\"3\" style=\"text-align: right;\">th post<br>'+\r\n//          '&emsp;&emsp;&emsp;OP contains <textarea style=\"height:1em\" cols=\"20\" name=\"uip_tracker.auto_open_kwd\"></textarea><br>'+\r\n//          '<br>'+\r\n'For dollchan: (workaround for bugs)<br>\\\r\n&emsp;<input type=\"checkbox\" name=\"workaround_for_dollchan\"> Consistency checker for thubmnails of attached images<br>\\\r\n&emsp;&emsp;runs at<br>\\\r\n&emsp;&emsp;<input type=\"radio\" name=\"wafd_tb\" value=\"tb\">every time when mouse leaves from thumbnail\\'s area<br>\\\r\n&emsp;&emsp;<input type=\"radio\" name=\"wafd_tb\" value=\"reply\">only when mouse hovers on the reply button<br>\\\r\n&emsp;<input type=\"checkbox\" name=\"wafd_open_spoiler\"> Open text spoilers<br>\\\r\n&emsp;&emsp;(You must turn off the same function in dollchan beforehand)<br>\\\r\n<!-- Post form:<br>\\\r\n&emsp;<input type=\"checkbox\" name=\"hide_rules\"> Hide rules<br>\\\r\n&emsp;<input type=\"checkbox\" name=\"hide_Go\"> Hide \\'Go\\'<br> -->\\\r\n<br>\\\r\n<br>'+\r\n//Share loaded html with other tabs to update<br>\\\r\n//&emsp;<input type=\"checkbox\" name=\"info_server\"> Broadcast loaded html to other tabs (server)<br>\\\r\n//&emsp;<input type=\"checkbox\" name=\"info_client\"> Listen other tab\\'s broadcasting (client)<br>\\\r\n//<br>\\\r\n//Command interface for overwriting site preference<br>\\\r\n//&emsp;<textarea style=\"height:1em\" cols=\"40\" name=\"overwrite_site2_json_str\"></textarea><br>\\\r\n//&emsp;<input type=\"button\" value=\"JSON\"><br>\\\r\n//&emsp;<textarea style=\"height:1em\" cols=\"40\" name=\"overwrite_site2_eval_str\"></textarea><br>\\\r\n//&emsp;<input type=\"button\" value=\"EVAL\"><br>\\\r\n//</div><div style=\"float:left\">&emsp;&emsp;&emsp;</div><div style=\"float:left\">'+\r\n//Catalog:<br>\\\r\n//&emsp;Cross domain connection:<br>\\\r\n//&emsp;&emsp;<input type=\"radio\" name=\"catalog_cross_domain_connection\" value=\"direct\"> Direct connection<br>\\\r\n//&emsp;&emsp;<input type=\"radio\" name=\"catalog_cross_domain_connection\" value=\"indirect\"> Indirect connection<br>\\\r\n//<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"catalog_fake_access\"> Fake access made by human to avoid poor administration<br>\\\r\n//&emsp;&emsp;&emsp;(This causes heavier network traffic and server load,<br>\\\r\n//&emsp;&emsp;&emsp;but administrators can\\'t see what script you are using)<br>\\\r\n//&emsp;Configuration:<br>\\\r\n//&emsp;&emsp;(To get faster feeling, you should check them all.)<br> -->\\\r\n//&emsp;Networking: load on demand for reducing initial network traffic<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_draw_on_demand\"> Threads<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_load_on_demand\"> HTMLs<br>\\\r\n//&emsp;Localtime offset<input type=\"text\" name=\"localtime_offset\" size=\"2\" style=\"text-align: right;\"><br>'+\r\n//          '&emsp;Tagging:<br>'+\r\n//          '&emsp;&emsp;Ignore tags latter than <input type=\"text\" name=\"catalog.tag.ignore\" size=\"2\" style=\"text-align: right;\">th in a board/thread<br>'+\r\n//          '&emsp;&emsp;Ignore boards/threads which have more than <input type=\"text\" name=\"catalog.tag.max\" size=\"2\" style=\"text-align: right;\"> tags<br>'+\r\n//          '&emsp;Board group configuration:<br>'+\r\n//          '&emsp;&emsp;<textarea rows=\"9\" cols=\"60\" name=\"catalog_board_list_str\"></textarea><br>'+\r\n//          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.board.owners_recommendation\"> Read owner\\'s recommendation<br>'+\r\n////          '&emsp;&emsp;<input type=\"button\" value=\"Scan\"> Scan board tags<br>'+\r\n//          '&emsp;&emsp;<input type=\"button\" value=\"Generate\"> Generate board groups from tags<br>'+\r\n//          '&emsp;<input type=\"checkbox\" name=\"catalog.style_general_list\"> Use general style<br>'+\r\n//          '&emsp;&emsp;<textarea rows=\"4\" cols=\"40\" name=\"catalog.style_general_list_str\"></textarea><br>'+\r\n//'&emsp;Catalog/Pop-up/Search<br>\\\r\n//<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"catalog_format.show.images_2nd\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.hover.images_2nd\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.search.images_2nd\"> 2nd or more images in OP<br> -->\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_format.show.posts\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.hover.posts\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.search.posts\"> Posts<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_format.show.fileinfo\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.hover.fileinfo\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.search.fileinfo\"> File information<br>\\\r\n//<!--&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_checkbox_deletion_show\">\\\r\n//<input type=\"checkbox\" name=\"catalog_checkbox_deletion_hover\">\\\r\n//<input type=\"checkbox\" name=\"catalog_checkbox_deletion_search\"> Checkbox for deletion<br> -->\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_format.show.contents\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.hover.contents\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.search.contents\"> Format contents<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_format.show.layout\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.hover.layout\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.search.layout\"> Format layout<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_format.show.style\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.hover.style\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.search.style\"> Format style<br>\\\r\n//<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"catalog_border_show\">&emsp;&emsp;&emsp; Show border<br> -->\\\r\n//<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"catalog_enable_background\">&emsp;&emsp;&emsp; Use backgfound color<br> -->\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_footer\"> Info(num of posts, images and page)<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_footer_br\"> always over/under the image<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_popup\"> Use pop-up window<br>\\\r\n//&emsp;&emsp;&emsp;appear/disappear:<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"radio\" name=\"catalog_popdown\" value=\"imm\">immediately<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"radio\" name=\"catalog_popdown\" value=\"delay\">delayed \\\r\n//<input type=\"text\" name=\"catalog_popup_delay\" size=\"6\" style=\"text-align: right;\">\\\r\n//<input type=\"text\" name=\"catalog_popdown_delay\" size=\"6\" style=\"text-align: right;\"> ms<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_popup_size_fix\"> Fix size when you move it<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_localtime\"> Localtime<br>\\\r\n//&emsp;&emsp;Num of posts in thread headline: <input type=\"text\" name=\"catalog_t2h_num_of_posts\" size=\"3\" style=\"text-align: right;\"><br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_triage\"> Enable triage pop-up<br>\\\r\n//&emsp;&emsp;&emsp; Style:<textarea style=\"height:1em\" cols=\"40\" name=\"catalog_triage_str\"></textarea><br>\\\r\n//<!-- &emsp;<input type=\"checkbox\" name=\"catalog_enable_cross_board\"> Enable cross-board catalog<br> -->\\\r\n//<!-- &emsp;<input type=\"checkbox\" name=\"catalog_enable_cross_domain\"> Enable cross-domain catalog<br> -->\\\r\n//<!-- &emsp;&emsp; Cache working in <textarea style=\"height:1em\" cols=\"20\" name=\"catalog_sw_domain\"></textarea><br> -->'+\r\n//&emsp;Click to:<br>\\\r\n//&emsp;&emsp;<input type=\"radio\" name=\"catalog_click\" value=\"open\">Go to/Open the thread<br>\\\r\n//&emsp;&emsp;<input type=\"radio\" name=\"catalog_click\" value=\"expand\">Expand/shrink the OP in catalog<br>\\\r\n//&emsp;&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_expand_at_initial\"> Expand at initial<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_no_popup_at_expanded\"> Don\\'t popup when the catalog is expanded<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_open_in_new_tab\"> Open the thread in new tab<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_use_named_window\"> Prevent opening a thread in multiple tabs<br>\\\r\n//<br>\\\r\n'</div></div><div style=\"clear: both\">\\\r\n<input type=\"button\" value=\"cancel\">\\\r\n<input type=\"button\" value=\"apply\">\\\r\n<input type=\"button\" value=\"ok\">\\\r\n&emsp;<input type=\"button\" value=\"apply+save\">\\\r\n<input type=\"button\" value=\"load_default\">\\\r\n<input type=\"button\" value=\"load_samples\">'+\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"debug_mode\"> Debug mode\\\r\n//<input type=\"checkbox\" name=\"show_tooltip\"> Show tooltips\\\r\n'</div>';\r\nif (!pref.test_mode['17']) { // node leak test.\r\n        pref_apply_prep(false);\r\n//        if (brwsr.ff) pn7.draggable = false;\r\n        cnst.bottom_top(pn7);\r\n}\r\n      }\r\nif (!pref.test_mode['17']) {\r\n      var fm = pn7_1.getElementsByTagName('input');\r\n      for (var i=0;i<fm.length;i++) {\r\n        if (fm[i].type=='button') {\r\n          if (make) fm[i].addEventListener('click', button_action, false);\r\n          else fm[i].removeEventListener('click', button_action, false);\r\n        }\r\n      }\r\n}\r\n      if (make) return pn7;\r\n      else {\r\nif (pref.test_mode['17']) {\r\n  pn7_1.innerHTML = '';\r\n  pn7.parentNode.removeChild(pn7);\r\n  return null;\r\n} else\r\n        pn7_1 = null;\r\n        return cnst.div_destroy(pn7, true); // returns null\r\n      }\r\n\r\n//      function pref_apply_prep(set){\r\n//        var fm = pn7_1.getElementsByTagName('input');\r\n//        for (var i=0;i<fm.length;i++) {\r\n//          if (fm[i].type=='button') continue;\r\n//          var tgt = fm[i].name;\r\n//          if (set) {\r\n//            if      (typeof(pref[tgt])=='number' ) pref[tgt] = parseInt(fm[i].value,10);\r\n//            else if (typeof(pref[tgt])=='boolean') pref[tgt] = fm[i].checked;\r\n//            else if (typeof(pref[tgt])=='string' ) if (fm[i].checked) pref[tgt] = fm[i].value;\r\n//          } else {\r\n//            if      (typeof(pref[tgt])=='number' ) fm[i].value = pref[tgt];\r\n//            else if (typeof(pref[tgt])=='boolean') fm[i].checked = pref[tgt];\r\n//            else if (typeof(pref[tgt])=='string' ) if (pref[tgt] == fm[i].value) fm[i].checked = true;\r\n//          }\r\n//        }\r\n//        if (set) {\r\n//          sessionStorage.pref = JSON.stringify(pref);\r\n//          listener();\r\n//          timer_obj.init();\r\n//        }\r\n//      }\r\n      function pref_apply_prep(set){\r\n        pref_func.apply_prep(pn7_1,set);\r\n        if (set) {\r\n          listener();\r\n          timer_obj.init();\r\n          if (wafd!=null) wafd.workaround_for_dollchan_pref_changed();\r\n        }\r\n      }\r\n      function button_action(e){\r\n//        console.log(e);\r\n        var src = e.currentTarget.value;\r\n        if      (src=='apply'       ) pref_apply_prep(true);\r\n        else if (src=='cancel'      ) show_hide();\r\n        else if (src=='ok'          ) {pref_apply_prep(true);show_hide();}\r\n        else if (src=='apply+save'  ) {pref_apply_prep(true);if (localStorage) localStorage[pref.script_prefix+'.pref']=JSON.stringify(pref);}\r\n        else if (src=='load_default') {pref = pref_default();pref_apply_prep(false);pref_apply_prep(true);pref_func.obj_init();} // last pref_apply_prep is for writing to sessionStrage.\r\n//        else if (src=='load_backwash_style') {pref_func.pref_overwrite(pref,pref_func.pref_samples['backwash']);pref_apply_prep(false);}\r\n        else if (src=='load_samples') {pref_func.pref_samples.init();}\r\n        else if (src=='Dump(csv)'   ) chart_obj.dump('csv');\r\n        else if (src=='Dump(obj)'   ) chart_obj.dump('obj');\r\n        else if (src=='Clear data'  ) chart_obj.clear();\r\n        else if (src=='JSON'        ) {pref_func.apply_prep(pn7_1.getElementsByTagName('TEXTAREA')['overwrite_site2_json_str'],true);pref_func.site2_json();}\r\n        else if (src=='EVAL'        ) {pref_func.apply_prep(pn7_1.getElementsByTagName('TEXTAREA')['overwrite_site2_eval_str'],true);pref_func.site2_eval();}\r\n      }\r\n    }\r\n//  })();\r\n  }\r\n\r\n//  var listener = (function(){\r\n  function make_listener(){\r\n    var on = false;\r\n    var value_old;\r\n    function listen_event(e){\r\n//      console.log('EVENT:'+e.key);\r\n      if (e.newValue===null) return;\r\n      if (e.key===pipe_name && pref.aggregator==='false') {\r\n        var tmp = brwsr.JSON_parse(e.newValue);\r\n        if (tmp[0]!=value_old) {\r\n          value_old = tmp[0];\r\n          chart_obj.data_update(tmp[0], tmp[1], tmp[2]);\r\n          timer_obj.show_page([null, '+'+tmp[1]+'+'+tmp[2]+'@'+tmp[0]]);\r\n        }\r\n//      } else if (e.key.search(info_raw)!=-1 && pref.info_client) {\r\n//        var page_no = e.key.substr(info_raw.length);\r\n//        var timer = timer_obj.timer();\r\n//        if (timer!=null) {\r\n//          var value = JSON.parse(e.newValue);\r\n//          timer.page_check4(value[0], page_no, new DOMParser().parseFromString(value[1],'text/html'));\r\n//        }\r\n      }\r\n    }\r\n    function setup(){\r\n      if (!on && pref.aggregator==='false') {\r\n        window.addEventListener   ('storage', listen_event, false);\r\n        on = true;\r\n      } else if (on && pref.aggregator==='true') {\r\n        window.removeEventListener('storage', listen_event, false);\r\n        on = false;\r\n      }\r\n    }\r\n    setup();\r\n    return setup;\r\n  };\r\n//  })();\r\n  var listener = null;\r\n  if (site.features.listener && pref.features.listener) listener = make_listener();\r\n\r\n  function make_timer_obj(pn0){\r\n//  var timer_obj = (function(){\r\n////    var pn0 = div_init(0,'5px',  '5px' ,'txt','init');\r\n//    var pn0 = cnst.init('left:0px:bottom:0px:txt:init:fontSize:24px:Show:tile:set:left:tile:set:bottom');\r\n    pn0.addEventListener('click', function(){init(false);}, false);  // Toggle ON/OFF\r\n    var timer_obj2 = null;\r\n    function init(property_changed){\r\n      if (timer_obj2 == null && (pref.check_page || (pref.aggregator=='true' && (pref.check_thread || pref.check_post)))) timer_obj2 = make_timer(pn0);\r\n      else if (timer_obj2 != null) {\r\n        if (!property_changed || (!pref.check_page && (pref.aggregator=='false' || (!pref.check_thread && !pref.check_post)))) stop_destroy();\r\n        else if (property_changed) timer_obj2.timer().restart(false);\r\n      }\r\n    }\r\n    function stop_destroy(){\r\n      timer_obj2 = timer_obj2.destroy();\r\n      pn0.style.color = 'gray';\r\n    }\r\n//    if (pref.auto_start) init(false);\r\n    if (pref.auto_start) setTimeout(function(){init(false);},10000);\r\n    var pn0_str = ['',''];\r\n    return {\r\n      init : function(){init(true);},\r\n      finished : function(){stop_destroy();},\r\n      timer: function(){return timer_obj2;},\r\n      show_page : function(str){\r\n//        pn0.appendChild(document.createTextNode(str+'@'+cnst.get_time()));\r\n//        pn0.textContent = str+'@'+cnst.get_time();\r\n        if (                 str[0]!=null) pn0_str[0] = str[0]+'@'+cnst.get_time();\r\n        if (str.length>=2 && str[1]!=null) pn0_str[1] = str[1];\r\n        if (str.length>=3 && str[2]!=null) pn0_str[0] = str[2];\r\n//        pn0.textContent = pn0_str1 +', '+ pn0_str2 +', '+pn0_str3;\r\n        if (pn0_str[0]!='' && pn0_str[1]!='') pn0.textContent = pn0_str[0] +', '+ pn0_str[1];\r\n        else pn0.textContent = pn0_str[0] + pn0_str[1];\r\n      }\r\n    }\r\n//  })();\r\n  }\r\n\r\n  function make_timer(pn0){\r\n    var page = (function(){\r\n      var idx = [];\r\n      var p = 0;\r\n      var now = 0;\r\n      var str_place='';\r\n      var check_page = pref.check_page;\r\n      if (window.location.href.search(site.thread_keyword)==-1) check_page = false;\r\n//      var flag = [false,false,mode_graph_only]; // top, last, myself, to be got.\r\n      \r\n//      idx[0] = 0;\r\n//      idx[1] = site.max_page -1; // last page\r\n//      for (var i=2;i<site.max_page;i++) idx[i]=i-1;\r\n//      idx[site.max_page] = site.max_page; // +1 for myself.\r\n      function init(){\r\n        var j=0;\r\n        idx[0] = -1; // -1 for mot match.\r\n        idx[1] = -1;\r\n        if (pref.check_post) idx[j++] = 0;\r\n        if (pref.check_thread) idx[j++] = site.max_page-1;\r\n        var next = (now+1)%(site.max_page+1);\r\n        if (now !=idx[0] && now !=idx[1]) idx[j++] = now;  // idx[2] for page_no.\r\n        if (next!=idx[0] && next!=idx[1]) idx[j++] = next; // idx[3] for next_page.\r\n        for (var i=0;i<=site.max_page;i++)\r\n          if (i!=now && i!=next && i!=idx[0] && i!=idx[1]) idx[j++] = i;\r\n        flag = [!pref.check_post, !pref.check_thread, !check_page];\r\n        p=0;\r\n//        if (flag[0] && flag[1] && flag[2]) timer.stop();\r\n      }\r\n      init();\r\n  \r\n      return {\r\n        no   : function() {return idx[p];},\r\n        step : function() {p=(p+1)%(site.max_page+1);},\r\n        prep_next : function() {init();},\r\n        flag_set : function(i) {flag[i]=true;},\r\n        all_got  : function() {return flag[0] && flag[1] && flag[2];},\r\n        str_set  : function(i,j) {if (check_page && i!=site.max_page) {str_place = i + '.' + j; now=i;}}, // patch for a bug of showing '20.0'.\r\n        str_get  : function() {return str_place;},\r\n        init : function(){init();}\r\n      }\r\n    })();\r\n\r\n    var last_post_old = 0;\r\n    var last_post = 0;\r\n    var last_ops_old = [];\r\n    var num_of_new_threads = 0;\r\n    var timer = (function(){\r\n      var req = new XMLHttpRequest();\r\n      req.addEventListener('load',  req_events, false);\r\n      req.addEventListener('error', req_events, false);\r\n      req.addEventListener('abort', req_events, false);\r\n    \r\n      function req_events(evt) {\r\n        var parser = new DOMParser();\r\n        if (req.status==404) timer.dead();\r\n        else {\r\n          var date = Date.now();\r\n          if (pref.info_server && page.no()!=site.max_page && brwsr.sw_cache)\r\n            brwsr.sw_cache.setItem(info_raw+'p'+page.no(),{date: date, status: req.status, responseText: req.responseText});\r\n          if (pref.catalog_snoop_refresh && catalog_obj.catalog_func()!=null)\r\n            catalog_obj.catalog_func().catalog_insert(info_raw+'p'+page.no(),{date: date, status: req.status, responseText: req.responseText});\r\n          page_check2(parser.parseFromString(req.responseText, 'text/html'));\r\n        }\r\n      }\r\n      function get_page(url) {\r\n        req.open('GET', url, true);\r\n        req.send(null);\r\n      }\r\n      var checking = false;\r\n      var time_str;\r\n      function page_check3(){\r\n        if (!checking) {\r\n          checking = true;\r\n          time_str = cnst.get_time();\r\n          page_check();\r\n        }\r\n      }\r\n      function page_check(){\r\n//        timer.stop(false);\r\n//        var url = site.url_prefix + page.no() + '.html';\r\n//        var url = site.make_url([site.board, page.no(), 'p')[0];\r\n        var url = site2[site.nickname].make_url4([site.nickname, site.board, page.no(), 'page_html'])[0];\r\n        if (page.no()==site.max_page) url = window.location.href;\r\n        get_page(url);\r\n      }\r\n\r\n      var interval_missing = 1000;\r\n//      var interval_found   = 60000 * 10;\r\n//      var interval_error   = 60000 * 10; // 10 min.\r\n      var retry_count = 0;\r\n      var retry_limit = (site.max_page+1)+5;\r\n      var id = null;\r\n      var interval_old = 0;\r\n      function timer_restart(force){\r\n        if (force || interval_old != pref.interval_found) {\r\n          timer_stop(false);\r\n          id = setInterval(page_check3, pref.interval_found*60000);\r\n        }\r\n        interval_old = pref.interval_found;\r\n      }\r\n      timer_restart(true);\r\n      page_check3();\r\n      pn0.style.color = '#000000';\r\n\r\n      function timer_stop(end){\r\n        if (id!=null) clearInterval(id);\r\n        id = null;\r\n        if (end) pn0.style.color = 'gray';\r\n      }\r\n\r\n//      var myself = get_nos(document,-1,-1);\r\n      var myself = (window.location.href.search(site.thread_keyword)!=-1)? get_nos(document,-1,-1) :-2;\r\n      return {\r\n//        req : function(){return req;}, // for debug\r\n        req : req, // for debug\r\n        found: function(){\r\n          retry_count = 0;\r\n//          id = setInterval(page_check3, pref.interval_found*60000);\r\n          checking = false;\r\n        },\r\n        missing: function(){\r\n          if (req.status==200 && retry_count++<retry_limit) setTimeout(page_check, interval_missing);\r\n          else {\r\n            retry_count = 0;\r\n//            id = setInterval(page_check, interval_error);\r\n            checking = false;\r\n          }\r\n        },\r\n        stop:  function(end){timer_stop(end);},\r\n        dead:  function(){timer_obj.show_page(['Dead']);timer_stop(true);timer_obj.finished();},\r\n        myself: function(){return myself;},\r\n        restart: function(force){timer_restart(force)},\r\n        timestr: function(){return time_str;},\r\n        destroy: function(){\r\n          req.removeEventListener('load',  req_events, false);\r\n          req.removeEventListener('error', req_events, false);\r\n          req.removeEventListener('abort', req_events, false);\r\n        }\r\n      }\r\n    })();\r\n\r\n    if (brwsr.sw_cache && pref.info_client) brwsr.sw_cache.subscribe(true);\r\n    return {\r\n      destroy: function(){\r\n        if (brwsr.sw_cache) brwsr.sw_cache.subscribe(false);\r\n        timer.stop(true);\r\n        timer.destroy();\r\n        return null;\r\n      },\r\n      timer: function(){return timer;},\r\n//      page_check4: page_check4\r\n      page_check5: page_check5\r\n    }\r\n\r\n    function page_check5(key,value,args){\r\n      var page_no = common_func.name2domainboardthread(key,true)[2].substr(1);\r\n      page_check4(value.date, page_no, new DOMParser().parseFromString(value.responseText,'text/html'));\r\n    }\r\n    function page_check4(time_stamp, page_no, doc){\r\n      var ops = site.get_ops(doc);\r\n      var myself = timer.myself();\r\n      for (var i=0;i<ops.length;i++) {\r\n        if (myself==ops[i]) {\r\n          page.str_set(page_no,i);\r\n          var str = page.str_get() + '@' + new Date(time_stamp).toLocaleTimeString();\r\n          timer_obj.show_page([null,null,str]);\r\n          page.prep_next();\r\n          timer.restart(true);\r\n          if (pref.check_page) options.func0_exe(page.str_get());\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    function page_check2(doc){\r\n      var page_no = page.no();\r\n      get_nos(doc,timer.myself(),page_no);\r\n      if (page.all_got() && page.no()!=site.max_page) {\r\n        var increase_posts = (last_post_old==0)? 0 : last_post-last_post_old;\r\n        var str = '';\r\n        if (pref.check_page)   str = page.str_get();\r\n        if (pref.check_post)   str = str + '+' + increase_posts;\r\n        if (pref.check_thread) str = str + '+' + num_of_new_threads;\r\n        timer_obj.show_page([str]);\r\n        page.prep_next();\r\n        timer.found();\r\n        increase_posts = parseInt(increase_posts,10);\r\n        if (isNaN(increase_posts) || increase_posts==null) increase_posts = 0;\r\n        if (pref.check_post || pref.check_thread) chart_obj.data_update(timer.timestr(),increase_posts, num_of_new_threads);\r\n        last_post_old = last_post;\r\n        if (pref.check_page) options.func0_exe(page.str_get());\r\n      } else {\r\n        timer_obj.show_page([page_no+'?']);\r\n        page.step();\r\n        timer.missing();\r\n      }\r\n    }\r\n\r\n    function get_nos(tgt_doc,myself,page_no){\r\n//      var ops = [];\r\n//      var num = 0;\r\n//      var divs = tgt_doc.getElementsByTagName('div');\r\n//      for (var i=0;i<divs.length;i++) {\r\n//        if (divs[i].className == 'thread' || divs[i].className == 'thread kc_showReplies') {\r\n//          var op_no = divs[i].id.substring(7); // substring(7) for removing 'thread_'\r\n//          if (myself==op_no) {str_place = page.str_set(page_no,num); page.flag_set(2);}\r\n//          ops[num++] = op_no;\r\n//        }\r\n//      }\r\n      var ops = site.get_ops(tgt_doc);\r\n      for (var i=0;i<ops.length;i++) if (myself==ops[i]) {page.str_set(page_no,i); page.flag_set(2);break;}\r\n      if (myself==-1) return ops[0];\r\n      if (page_no==0) {\r\n        page.flag_set(0);\r\n        last_post = get_last_post(tgt_doc);\r\n      }\r\n      if (page_no==site.max_page-1) {\r\n        page.flag_set(1);\r\n        var len = last_ops_old.length\r\n        if (len!=0) {\r\n          var last_op = ops[ops.length-1];\r\n          var i=0;\r\n          while (i<len && last_op!=last_ops_old[len-i-1]) i++;\r\n          num_of_new_threads = i;\r\n        } else num_of_new_threads = 0;\r\n        last_ops_old = ops;\r\n      }\r\n    }\r\n\r\n    function get_last_post(tgt_doc){\r\n      var posts = site.get_posts(tgt_doc);\r\n//      var posts = [];\r\n//      var anchors = tgt_doc.getElementsByTagName('a');\r\n//      var num = 0;\r\n//      for (var i=0;i<anchors.length;i++)\r\n//        if (anchors[i].name != '') posts[num++] = anchors[i].name;\r\n      var last_post = posts[0];\r\n      for (var i=1;i<posts.length;i++) {\r\n        if (posts[i]>last_post) last_post=posts[i];\r\n//      else break; // Cause a bug when a post had made in a sunk thread and immediately deleted.\r\n      }\r\n      return last_post;\r\n    }\r\n  }\r\n\r\n//  function div_init(func, left, bottom, tp, str, width, height){\r\n//    var pn = document.createElement('div');\r\n//    pn.style.position = 'fixed';\r\n//    pn.style.bottom = bottom;\r\n//    pn.style.left = left;\r\n//    pn.style.color = '#000000';\r\n//    pn.style.fontWeight = 'normal';\r\n//    pn.style.background = '#e5ecf9';\r\n//    pn.style.padding = '0px 5px 2px 5px';\r\n//    pn.style.border = '1px solid black';\r\n//    if (tp=='txt' || (brwsr.ff && tp=='button')) {\r\n//      pn.appendChild(document.createTextNode(str));\r\n//      pn.style.cursor = 'pointer';\r\n//    } else if (tp=='button') {\r\n//      pn.innerHTML = '<input type=\"button\" value=\"' + str + '\">';\r\n////      pn.innerHTML = '<button draggable=\"true\">' + str + '</button>';\r\n//      pn.style.padding = '0';\r\n//      pn.style.border = '0';\r\n//      pn.style.background = 'none';\r\n//    }\r\n//    if (func==0) {\r\n//      pn.style.fontSize = '24px';\r\n//    } else if (func==2) {\r\n//      pn.style.padding = '0px 10px 0px 0px';\r\n////      pn.style.margin = '10px';\r\n//      pn.style.resize = 'both';\r\n//      pn.style.overflow = 'hidden';\r\n////      pn.style.width = '400px';\r\n////      pn.style.height = '400px';\r\n//      if (width) pn.style.width = width;\r\n//      if (height) pn.style.height = height;\r\n//    }\r\n//    if (func!=10) site.root_body.appendChild(pn);\r\n//    pn.draggable = true;\r\n//    pn.addEventListener('dragstart', div_dragstart, false);\r\n////    pn.addEventListener('dragstart', div_dragstart, true);\r\n//    pn.addEventListener('dragend', div_dragend, false);\r\n//    return pn;\r\n//  }\r\n//  function div_destroy(pn,child_of_body){\r\n//    if (child_of_body) site.root_body.removeChild(pn);\r\n//    pn.removeEventListener('dragstart', div_dragstart, false);\r\n//    pn.removeEventListener('dragend', div_dragend, false);\r\n//    return null;\r\n//  }\r\n//\r\n//  var drag_sx;\r\n//  var drag_sy;\r\n////  var drag_cursor_style;\r\n//  function div_dragstart(e){\r\n//    drag_sx = e.screenX;\r\n//    drag_sy = e.screenY;\r\n////    drag_cursor_style = pn.style.cursor;\r\n////    pn.style.cursor = 'move';\r\n//    e.dataTransfer.setData('text/plain', ''); // for FF. CH doesn't require this.\r\n////    e.preventDefault();\r\n////    e.stopPropagation();\r\n//  }\r\n//  function div_dragend(e){\r\n////    console.log('drag_end');\r\n//    e.currentTarget.style.left   = (parseInt(e.currentTarget.style.left.replace(/px/,''))   + e.screenX - drag_sx) + 'px';\r\n//    if (e.currentTarget.style.bottom!='') e.currentTarget.style.bottom = (parseInt(e.currentTarget.style.bottom.replace(/px/,'')) - e.screenY + drag_sy) + 'px'; // from bottom.\r\n//    else e.currentTarget.style.top = (parseInt(e.currentTarget.style.top.replace(/px/,'')) + e.screenY - drag_sy) + 'px';\r\n////    pn.style.cursor = drag_cursor_style;\r\n//  }\r\n\r\n  function make_wafd(){\r\n    function on_change_workaround_for_dollchan(exe){\r\n//      pref.workaround_for_dollchan = workaround_for_dollchan.checked;\r\n      if (pref.workaround_for_dollchan == true) {\r\n//        document.getElementById('postform_row_files').style.display = '';\r\n//        var tmp = document.getElementsByTagName('input');\r\n//        for (var i=0;i<tmp.length;i++) if (tmp[i].type=='file') tmp[i].parentNode.style.display = '';\r\n        if (exe) on_change_workaround_for_dollchan_2(); // temporarily.\r\n        if (pref.wafd_tb=='tb') document.getElementById('postform_label_comment').addEventListener('mouseout', on_change_workaround_for_dollchan, false);\r\n        else site.components.postform_submit.addEventListener('mouseenter', on_change_workaround_for_dollchan, false);\r\n      } else {\r\n//        document.getElementById('postform_row_files').style.display = 'none';\r\n        if (pref.wafd_tb=='tb') document.getElementById('postform_label_comment').removeEventListener('mouseout', on_change_workaround_for_dollchan, false);\r\n        else site.components.postform_submit.removeEventListener('mouseenter', on_change_workaround_for_dollchan, false);\r\n      }\r\n    }\r\n    function workaround_for_dollchan_pref_changed(){\r\n      if (pref.workaround_for_dollchan == true) {\r\n        pref.workaround_for_dollchan = false;\r\n        pref.wafd_tb = (pref.wafd_tb=='tb')? 'reply' : 'tb';\r\n        on_change_workaround_for_dollchan(null);\r\n        pref.workaround_for_dollchan = true;\r\n        pref.wafd_tb = (pref.wafd_tb=='tb')? 'reply' : 'tb';\r\n        on_change_workaround_for_dollchan(null);\r\n      }\r\n      open_spoiler();\r\n    }\r\n    function on_change_workaround_for_dollchan_2(){\r\n      var inputs = document.getElementsByTagName('input');\r\n      var files = [];\r\n      for (var i=0;i<inputs.length;i++) if (inputs[i].type=='file') files.push(inputs[i]);\r\n      var grand_parent = document.getElementById('postform_row_files');\r\n      var parent;\r\n      for (var i=0;i<grand_parent.childNodes.length;i++) if (grand_parent.childNodes[i].align=='left') parent = grand_parent.childNodes[i];\r\n//      for (var i=0;i<4;i++) for (var j=0;j<4;j++) if (files[i].name==('file_'+j)) parent.childNodes[i].appendChild(files[i]);\r\n      for (var i=0;i<files.length;i++) {\r\n        var no = parseInt(files[i].name.replace(/file_/,\"\"));\r\n        parent.childNodes[no].appendChild(files[i]);\r\n//        parent.childNodes[no].style.display = '';\r\n//        files[i].addEventListener('change', on_change_workaround_for_dollchan_3, false);\r\n        var evt = document.createEvent('UIEvents');\r\n        evt.initUIEvent('change', false, true, window, 1);\r\n        files[i].dispatchEvent(evt);\r\n      }\r\n\r\n//      var images = images = document.getElementsByClassName('de-file-img');\r\n//      var thumbnails = [];\r\n//      for (var i=0;i<images.length;i++) if (images[i].tagName=='IMG') thumbnails.push(images[i]);\r\n      var thumbnails_parent = document.getElementById('postform_label_comment');\r\n      var show_thumbnails = true;\r\n      for (var i=0;i<files.length;i++) {\r\n//        if (files[i].value=='' && thumbnails[i]!=undefined) thumbnails[i].parentNode.removeChild(thumbnails[i]);\r\n        if (files[i].value=='') {\r\n          var thumbnail = thumbnails_parent.getElementsByTagName('img')[0];\r\n          if (thumbnail!=undefined) thumbnail.parentNode.removeChild(thumbnail);          \r\n        }\r\n        if (files[i].value!='' || show_thumbnails) {\r\n          thumbnails_parent.childNodes[i].style.display = '';\r\n          if (files[i].value=='') show_thumbnails = false;\r\n        } else thumbnails_parent.childNodes[i].style.display = 'none';\r\n//        console.log(i + ': '+ files[i].value);\r\n      }\r\n    }\r\n//    function on_change_workaround_for_dollchan_3(){\r\n//      console.log('change');\r\n//    }\r\n    if (pref.workaround_for_dollchan == true) on_change_workaround_for_dollchan(false); // initial\r\n\r\n    var spoiler_org = null;\r\n    var rule = [];\r\n    function open_spoiler(){\r\n      if (pref.wafd_open_spoiler == true) {\r\n        rule = [];\r\n        for (var j=0;j<document.styleSheets.length;j++)\r\n          for (var i=0;i<document.styleSheets[j].cssRules.length;i++)\r\n            if (document.styleSheets[j].cssRules[i].selectorText && document.styleSheets[j].cssRules[i].selectorText.search(/spoiler/)!=-1) rule.push(j,i)\r\n        if (document.styleSheets[rule[0]].cssRules[rule[1]].selectorText.search(/hover/)!=-1) {rule.push(rule.shift());rule.push(rule.shift());}\r\n        spoiler_org = document.styleSheets[rule[0]].cssRules[rule[1]].style.cssText;\r\n        document.styleSheets[rule[0]].cssRules[rule[1]].style.cssText = document.styleSheets[rule[2]].cssRules[rule[3]].style.cssText;\r\n      } else if (spoiler_org!=null) document.styleSheets[rule[0]].cssRules[rule[1]].style.cssText = spoiler_org;\r\n    }\r\n    if (pref.wafd_open_spoiler == true) open_spoiler(); // initial\r\n    return{\r\n//      on_change_workaround_for_dollchan: function(exe){on_change_workaround_for_dollchan(exe);},\r\n      workaround_for_dollchan_pref_changed: function(){workaround_for_dollchan_pref_changed();}\r\n    }\r\n  }\r\n\r\n  function make_post_form_obj(pn9){\r\n//  var post_form = (function(){\r\n//    var pn9 = div_init(9,'120px','30px','button','post_form');\r\n//    var pn9 = cnst.init('left:120px:bottom:30px:button:post_form:Show');\r\n    pn9.addEventListener('click', show_hide, false);\r\n    var pn10 = null;\r\n    var pn10_2 = null;\r\n//    var pn10_2 = cnst.add_to_tb(pn10,'<input type=\"checkbox\">workaround for dollchan<input type=\"checkbox\">prevent redirection');\r\n//    var pn10_2 = document.createElement('div');\r\n//    pn10_2.style.float = 'right'; // doesn't work on FF\r\n//    pn10_2.innerHTML = '<input type=\"checkbox\">workaround for dollchan<input type=\"checkbox\">prevent redirection'\r\n//    var prevent_redirection = pn10_2.childNodes[2];\r\n//    prevent_redirection.onchange = on_change_redirection;\r\n//    var workaround_for_dollchan = pn10_2.childNodes[0];\r\n//    workaround_for_dollchan.onchange = on_change_workaround_for_dollchan;\r\n    var prevent_redirection;\r\n    var workaround_for_dollchan;\r\n//    var parent\r\n//    var no;\r\n    var on = false;\r\n    var hidden_elements = [];\r\n    function show_hide(){\r\n      if (site2[site.nickname].postform_activation) {\r\n        site2[site.nickname].postform_activation();\r\n        site2[site.nickname].postform_activation=null;\r\n      }\r\n      var tgt    = site.postform;\r\n      if (!on) {\r\n        if (pn10==null) {\r\n          pn10 = cnst.init('left:0px:tile:get:bottom:overflow:hidden:Show:tb',function(){site.components.postform_comment.focus();},cnst.void_func,show_hide,cnst.void_func)[0];\r\n          pn10.id = 'pn10_debug';\r\n//          pn10_2 = cnst.add_to_tb(pn10,'<input type=\"checkbox\" name=\"workaround_for_dollchan\">workaround for dollchan<input type=\"checkbox\" name=\"prevent_redirection\">prevent redirection');\r\n          pn10_2 = cnst.add_to_tb(pn10,'<input type=\"checkbox\" name=\"prevent_redirection\">prevent redirection');\r\n          pref_func.apply_prep(pn10_2,false);\r\n//          prevent_redirection = pn10_2.childNodes[2];\r\n          prevent_redirection = pn10_2.childNodes[0];\r\n          prevent_redirection.onchange = on_change_redirection;\r\n//          workaround_for_dollchan = pn10_2.childNodes[0];\r\n//          workaround_for_dollchan.onchange = on_change_workaround_for_dollchan;\r\n//          pn10.childNodes[0].insertBefore(pn10_2,pn10.childNodes[0].childNodes[2]);\r\n//          if (brwsr.ff)  pn10.childNodes[0].childNodes[2].style.float = 'right'; // doesn't work\r\n//          if (brwsr.ff) pn10.childNodes[0].childNodes[2].outerHTML = pn10.childNodes[0].childNodes[2].outerHTML.replace(/<div/,\"<div style=\\\"float: right\\\"\"); // discard events configuration\r\n//          if (brwsr.ff) pn10.childNodes[0].childNodes[2].setAttribute('style','float: right');\r\n          pn10.childNodes[1].innerHTML = '<div style=\"display: none\"></div><div></div>';\r\n//          options.func0_prep(pn10.childNodes[1].childNodes[0],pn10.childNodes[0]);\r\n          options.func0_prep(pn10.childNodes[1].childNodes[0],pn10);\r\n        }\r\n//        parent = tgt.parentNode; // working code\r\n//        no = 0;\r\n//        while (parent.childNodes[no]!=tgt && no < parent.childNodes.length) no++;\r\n//        pn10.childNodes[1].childNodes[1].appendChild(tgt);\r\n//        site.root_body.appendChild(pn10);\r\n        tgt.parentNode.insertBefore(pn10,tgt);\r\n        pn10.childNodes[1].childNodes[1].appendChild(tgt);\r\n        var labels = document.getElementsByClassName('label');\r\n        for (var i=0;i<labels.length;i++) {\r\n          if (labels[i].innerHTML==\"Go to:\" || labels[i].innerHTML==\"Password:\") {\r\n            if (labels[i].parentNode.style.display != 'none'){\r\n              labels[i].parentNode.style.display = 'none';\r\n              hidden_elements.push(labels[i].parentNode);\r\n            }\r\n          }\r\n        }\r\n        if (site.postform_rules!=null) {\r\n          site.postform_rules.style.display = 'none';\r\n          hidden_elements.push(site.postform_rules);\r\n        }\r\n        site.components.postform_comment.focus();\r\n        cnst.bottom_top(pn10);\r\n      } else {\r\n        while (hidden_elements.length!=0) hidden_elements.pop().style.display = '';\r\n//        site.root_body.removeChild(pn10); // working code.\r\n//        parent.insertBefore(tgt,parent.childNodes[no]);\r\n        pn10.parentNode.insertBefore(pn10.childNodes[1].childNodes[1].lastChild,pn10);\r\n        pn10.parentNode.removeChild(pn10);\r\n      }\r\n      on = !on;\r\n    }\r\n//    pn10.childNodes[0].childNodes[0].childNodes[0].onclick = rollup;\r\n//    pn10.childNodes[0].childNodes[0].childNodes[1].onclick = function(){opacity(false);};\r\n//    pn10.childNodes[0].childNodes[0].childNodes[2].onclick = function(){opacity(true);};\r\n//    var prevent_redirection = pn10.childNodes[0].childNodes[2].childNodes[2];\r\n//    pn10.childNodes[0].childNodes[2].childNodes[2].onchange = on_change_redirection;\r\n//    var workaround_for_dollchan = pn10.childNodes[0].childNodes[2].childNodes[0];\r\n//    pn10.childNodes[0].childNodes[2].childNodes[0].onchange = on_change_workaround_for_dollchan;\r\n//    pn10.childNodes[0].childNodes[1].childNodes[0].onclick = show_hide;\r\n//    pn10.childNodes[0].childNodes[3].ondblclick = rollup;\r\n//    var rolluped = false;\r\n//    function rollup(){\r\n//      if (rolluped) {\r\n//        pn10.style.height = ''; // means 'auto'\r\n//        pn10.style.width = ''; // for dollchan\r\n//        pn10.childNodes[1].style.display = ''; // for dollchan\r\n//        site.postform_comment.focus();\r\n//      } else {\r\n//        pn10.style.height = pn10.childNodes[0].offsetHeight + 'px';\r\n//        pn10.style.width = pn10.offsetWidth + 'px'; // for dollchan\r\n//        pn10.childNodes[1].style.display = 'none'; // for dollchan\r\n////        comment.addEventListener('change', rollup, false); // 'change' fires when outfocused.\r\n////        comment.addEventListener('keydown', rollup, false);\r\n////        comment.addEventListener('blur', rollup, false);\r\n//      }\r\n//      rolluped = !rolluped;\r\n//    }\r\n//    pn10.style.opacity = 1;\r\n//    function opacity(increase){\r\n//      var op = parseFloat(pn10.style.opacity);\r\n//      if (increase) pn10.style.opacity = (op+0.1>=1)? 1 : op+0.1;\r\n//      else if (!increase) pn10.style.opacity = (op-0.1<=0.1)? 0.1: op-0.1;\r\n//    }\r\n//    var dock = pn10.childNodes[0].childNodes[0].childNodes[3];\r\n//    pn10.addEventListener('resize', pn10_resize, false);\r\n//    pn10.addEventListener('mousedown', pn10_mousedown, false);\r\n//    pn10.addEventListener('mouseup', pn10_resize, false);\r\n//    var pn10_size;\r\n//    function pn10_mousedown(e){\r\n//      console.log('size');\r\n//      pn10_size = [pn10.style.width, pn10.style.height];\r\n//    }\r\n//    function pn10_resize(e){\r\n//      console.log('resize');\r\n//      if (dock.checked && (pn10.style.width!=pn10_size[0] || pn10.style.height!=pn10_size[1])) {\r\n//        var width_increase  = parseInt(pn10.style.width.replace(/px/,''))  - parseInt(pn10_size[0].replace(/px/,''));\r\n//        var height_increase = parseInt(pn10.style.height.replace(/px/,'')) - parseInt(pn10_size[1].replace(/px/,''));\r\n//        var comment = site.postform_comment;\r\n//        comment.style.width  = (parseInt(comment.style.width.replace(/px/,'')) + width_increase) + 'px';\r\n//        comment.style.height = (parseInt(comment.style.height.replace(/px/,'')) + height_increase) + 'px';\r\n//      }\r\n//    }\r\n\r\n//    function show_hide(){\r\n//      pn10 = prep_pn10(pn10==null);\r\n//    }\r\n//    function prep_pn10(make){\r\n//      if (make) {\r\n////        pn10.innerHTML = document.getElementsByName('postform')[0].innerHTML;\r\n//        pn10.appendChild(tgt);\r\n//      } else {\r\n////        pn10.removeChild(tgt); // not required.\r\n//        pos_size = pos_get_set(true);\r\n////        parent.appendChild(tgt);\r\n//        parent.insertBefore(tgt,parent.childNodes[no]);\r\n//      }\r\n//      if (make) return pn10;\r\n//      else return div_destroy(pn10);\r\n//    }\r\n//    function pos_get_set(get){\r\n//      var comment = site.postform_comment;\r\n//      if (get) return [pn10.style.left, pn10.style.bottom, pn10.style.width, pn10.style.height, comment.style.width, comment.style.height];\r\n//      else {\r\n//        pn10.style.width = pos_size[2];\r\n//        pn10.style.height = pos_size[3];\r\n//        comment.style.width = pos_size[4];\r\n//        comment.style.height = pos_size[5];\r\n//      }\r\n//    }\r\n//    function on_unload(){\r\n//      var x = document.documentElement.scrollLeft || document.body.scrollLeft;\r\n//      var y = document.documentElement.scrollTop || document.body.scrollTop;\r\n//      var store_val = [(pn10!=null), x, y, pos_get_set(true)];\r\n//      sessionStorage.post_form_pref = JSON.stringify(store_val);\r\n//      window.removeEventListener('unload', on_unload, false);\r\n//    }\r\n//    if (sessionStorage.post_form_pref) {\r\n//      var store_val = JSON.parse(sessionStorage.post_form_pref);\r\n//      scrollTo(store_val[1],store_val[2]);\r\n//      if (store_val[0]) {\r\n//        show_hide();\r\n//        pos_size = store_val[3];\r\n//        pos_get_set(false);\r\n//      }\r\n////      sessionStorage.removeItem('post_form_pref');\r\n//    }\r\n//    window.addEventListener('unload', on_unload, false);\r\n//    var posted = false;\r\n//    var inputs = document.getElementsByTagName('input');\r\n//    var button_del;\r\n//    for (var i=0;i<inputs.length;i++) if (inputs[i].type=='submit' && inputs[i].value==\"Delete\") button_del = inputs[i];\r\n//    button_del.addEventListener('click', function(){posted = true;}, false);\r\n//    site.components.postform_submit.addEventListener('click', function(){posted = true;}, false);\r\n//    window.addEventListener('beforeunload', on_beforeunload, false);\r\n//    function on_beforeunload(e){\r\n//      if (posted) e.returnValue = 'You are attempting to update. Please choose \"No\" when you use \"autoupdater\".';\r\n//      posted = false;\r\n//    }\r\n\r\n\r\n    var submits = [];\r\n    var forms_post = [];\r\n    var forms = document.getElementsByTagName('form');\r\n//    for (var i=0;i<forms.length;i++) if (forms[i].method!='post') forms.splice(i,1); // post, delete, report // doesn't work.\r\n    for (var i=0;i<forms.length;i++) if (forms[i].method=='post') forms_post.push(forms[i]); // post, delete, report\r\n    for (var i=0;i<forms_post.length;i++) {\r\n      var inputs = forms_post[i].getElementsByTagName('input');\r\n      for (var j=0;j<inputs.length;j++) if (inputs[j].type=='submit') submits.push(inputs[j]);\r\n    }\r\n//    var posted = [];\r\n//    for (var i=0;i<submits.length;i++) {posted.push(false); submits[i].addEventListener('click', function(){posted[i] = true;}, false);} // doesn't work because of closure.\r\n//    for (let i=0;i<submits.length;i++) {posted.push(false); submits[i].addEventListener('click', function(){posted[i] = true;}, false);} // 'let' can't be used in chrome script.\r\n    var posted = false;\r\n    var targets = [];\r\n    for (var i=0;i<submits.length;i++) submits[i].addEventListener('click', function(){posted = true;}, false);\r\n//    window.addEventListener('beforeunload', on_beforeunload, false);\r\n    var pn11;\r\n    function on_change_redirection(){\r\n//      pref.prevent_redirection = prevent_redirection.checked;\r\n      if (pn10_2!=null) pref_func.apply_prep(pn10_2,true);\r\n      if (pref.prevent_redirection == true) {\r\n        if (!pn11) {\r\n          pn11 = cnst.make_iframe('redirect_target');\r\n          pn11.onload = function(){if (pn11.location && pn11.location.href!='about:blank') pn11.location.replace('about:blank');}; // clear always.\r\n        }\r\n        for (var i=0;i<submits.length;i++) {\r\n          targets[i] = forms[i].target;\r\n          forms[i].target = 'redirect_target';\r\n        }\r\n      } else for (var i=0;i<submits.length;i++) forms[i].target = targets[i];\r\n    }\r\n    if (pref.prevent_redirection == true) on_change_redirection(); // initial\r\n//    function on_beforeunload(e){ // doesn't work. too late?\r\n//      if (prevent_redirection.checked == true) {\r\n//        console.log('beforeunload: ' + e);\r\n////        for (var i=0;i<submits.length;i++) {\r\n////          if (posted[i]) forms[i].target = 'rediret_target';\r\n////          posted[i] = false;\r\n////        }\r\n//        if (posted) for (var i=0;i<submits.length;i++) {\r\n//          targets[i] = forms[i].target;\r\n//          forms[i].target = 'redirect_target';\r\n//        }\r\n//      }\r\n//    }\r\n\r\n//    function on_change_workaround_for_dollchan(){\r\n////      pref.workaround_for_dollchan = workaround_for_dollchan.checked;\r\n//      if (pn10_2!=null) pref_func.apply_prep(pn10_2,true);\r\n//      if (pref.workaround_for_dollchan == true) {\r\n////        document.getElementById('postform_row_files').style.display = '';\r\n////        var tmp = document.getElementsByTagName('input');\r\n////        for (var i=0;i<tmp.length;i++) if (tmp[i].type=='file') tmp[i].parentNode.style.display = '';\r\n//        if (pn10_2!=null) on_change_workaround_for_dollchan_2(); // temporarily.\r\n//        if (pref.wafd_tb=='tb') document.getElementById('postform_label_comment').addEventListener('mouseout', on_change_workaround_for_dollchan, false);\r\n//        else site.components.postform_submit.addEventListener('mouseenter', on_change_workaround_for_dollchan, false);\r\n//      } else {\r\n////        document.getElementById('postform_row_files').style.display = 'none';\r\n//        if (pref.wafd_tb=='tb') document.getElementById('postform_label_comment').removeEventListener('mouseout', on_change_workaround_for_dollchan, false);\r\n//        else site.components.postform_submit.removeEventListener('mouseenter', on_change_workaround_for_dollchan, false);\r\n//      }\r\n//    }\r\n//    if (pref.workaround_for_dollchan == true) on_change_workaround_for_dollchan(); // initial\r\n//    function on_change_workaround_for_dollchan(){\r\n//      if (pn10_2!=null) pref_func.apply_prep(pn10_2,true);\r\n//      wafd.on_change_workaround_for_dollchan(true);\r\n//    }\r\n//    if (pref.workaround_for_dollchan == true) wafd.on_change_workaround_for_dollchan(false); // initial\r\n\r\n//    function on_change_workaround_for_dollchan_2(){\r\n//      var inputs = document.getElementsByTagName('input');\r\n//      var files = [];\r\n//      for (var i=0;i<inputs.length;i++) if (inputs[i].type=='file') files.push(inputs[i]);\r\n//      var grand_parent = document.getElementById('postform_row_files');\r\n//      var parent;\r\n//      for (var i=0;i<grand_parent.childNodes.length;i++) if (grand_parent.childNodes[i].align=='left') parent = grand_parent.childNodes[i];\r\n////      for (var i=0;i<4;i++) for (var j=0;j<4;j++) if (files[i].name==('file_'+j)) parent.childNodes[i].appendChild(files[i]);\r\n//      for (var i=0;i<files.length;i++) {\r\n//        var no = parseInt(files[i].name.replace(/file_/,\"\"));\r\n//        parent.childNodes[no].appendChild(files[i]);\r\n////        parent.childNodes[no].style.display = '';\r\n////        files[i].addEventListener('change', on_change_workaround_for_dollchan_3, false);\r\n//        var evt = document.createEvent('UIEvents');\r\n//        evt.initUIEvent('change', false, true, window, 1);\r\n//        files[i].dispatchEvent(evt);\r\n//      }\r\n//\r\n////      var images = images = document.getElementsByClassName('de-file-img');\r\n////      var thumbnails = [];\r\n////      for (var i=0;i<images.length;i++) if (images[i].tagName=='IMG') thumbnails.push(images[i]);\r\n//      var thumbnails_parent = document.getElementById('postform_label_comment');\r\n//      var show_thumbnails = true;\r\n//      for (var i=0;i<files.length;i++) {\r\n////        if (files[i].value=='' && thumbnails[i]!=undefined) thumbnails[i].parentNode.removeChild(thumbnails[i]);\r\n//        if (files[i].value=='') {\r\n//          var thumbnail = thumbnails_parent.getElementsByTagName('img')[0];\r\n//          if (thumbnail!=undefined) thumbnail.parentNode.removeChild(thumbnail);          \r\n//        }\r\n//        if (files[i].value!='' || show_thumbnails) {\r\n//          thumbnails_parent.childNodes[i].style.display = '';\r\n//          if (files[i].value=='') show_thumbnails = false;\r\n//        } else thumbnails_parent.childNodes[i].style.display = 'none';\r\n////        console.log(i + ': '+ files[i].value);\r\n//      }\r\n//    }\r\n////    function on_change_workaround_for_dollchan_3(){\r\n////      console.log('change');\r\n////    }\r\n\r\n//    var pn11 = cnst.make_iframe('redirect_target');\r\n//    pn11.onload = function(){if (pn11.location && pn11.location.href!='about:blank') pn11.location.replace('about:blank');}; // clear always.\r\n//////    var pn11 = div_init(11,'100px','100px','div'); // working code.\r\n//////    pn11.style.display = 'none';\r\n////    var pn11 = cnst.init('left:100px:bottom:100px:display:none:Show');\r\n////    pn11.id = 'pn11_debug';\r\n////    pn11.addEventListener('click', function(){on_load('parent_click');}, false);\r\n////    // delete contents for preventing from getting new posts by auto-updater.\r\n//////    function pn11_init(){ // works on Chrome, but causes infinite loop on FF.\r\n////      pn11.innerHTML = '<iframe name=\"redirect_target\" id=\"redirect_target\"></iframe>';\r\n////////      document.getElementsByName('redirect_target')[0].setAttribute('onload','alert(\"AAA\");return false;'); // work\r\n////////      document.getElementsByName('redirect_target')[0].setAttribute('onload','on_load();'); // fail;\r\n////////      document.getElementsByName('redirect_target')[0].onload  = function(){on_load('child_load')}; // work\r\n////////      document.getElementsByName('redirect_target')[0].onclick = function(){on_load('child_click')}; // for debug.\r\n////      pn11.childNodes[0].onload  = function(){on_load('child_load')}; // work\r\n////      pn11.childNodes[0].onclick = function(){on_load('child_click')}; // for debug.\r\n//////    }\r\n//////    pn11_init();\r\n////    function on_load(from_where){\r\n////      console.log('load: '+from_where);\r\n////      site.components.postform_submit.disabled = false;\r\n//////      top.redirect_target.document\r\n//////      if (posted) for (var i=0;i<submits.length;i++) forms[i].target = targets[i];\r\n//////      posted = false;\r\n//////      if (pn11.style.display=='none') pn11_init();\r\n//////      if (pn11.style.display=='none') frames['redirect_target'].location.replace('about:blank');\r\n////      if (pn11.style.display=='none') if (frames['redirect_target'].location.href!='about:blank') frames['redirect_target'].location.replace('about:blank');\r\n////    }\r\n//////    var pn11_on = false;\r\n////    function debug(){\r\n//////      if (!pn11_on) site.root_body.appendChild(pn11);\r\n//////      else site.root_body.removeChild(pn11); // can't prevent redirection.\r\n////      if (pn11.style.display=='none') pn11.style.display = '';\r\n////      else {\r\n////        pn11.style.display = 'none';\r\n//////      pn11_on = !pn11_on;\r\n//////      frames['redirect_target'].document.open();\r\n//////      frames['redirect_target'].document.write('deleted');\r\n//////      frames['redirect_target'].document.close();  // delete contents for preventing from getting new posts by auto-updater.\r\n//////        pn11_init();\r\n////        if (frames['redirect_target'].location.href!='about:blank') frames['redirect_target'].location.replace('about:blank');\r\n////      }\r\n////    }\r\n////    \r\n//////// working code\r\n//////    var pn11 = div_init(11,'100px','100px','div');\r\n//////    pn11.id = 'pn11_debug';\r\n//////    pn11.innerHTML = '<iframe name=\"redirect_target\" id=\"redirect_target\"></iframe>'\r\n//////    pn11.addEventListener('click', function(){on_load('parent_click');}, false);\r\n////////    document.getElementsByName('redirect_target')[0].setAttribute('onload','alert(\"AAA\");return false;'); // work\r\n////////    document.getElementsByName('redirect_target')[0].setAttribute('onload','on_load();'); // fail;\r\n//////    document.getElementsByName('redirect_target')[0].onload  = function(){on_load('child_load')};\r\n//////    document.getElementsByName('redirect_target')[0].onclick = function(){on_load('child_click')}; // for debug.\r\n//////    var forms = document.getElementsByTagName('form');\r\n//////    for (var i=0;i<forms.length;i++) {\r\n//////      if (forms[i].method=='post') forms[i].target = 'redirect_target'; // post, delete, report\r\n//////    }\r\n////////    window.addEventListener('load', on_load, false);\r\n//////    pn11.addEventListener('load', on_load, false);\r\n////////    pn11.redirect_target.addEventListener('load', on_load, false);\r\n//////    function on_load(from_where){\r\n//////      console.log('load: '+from_where);\r\n//////      site.components.postform_submit.disabled = false;\r\n////////      top.redirect_target.document\r\n//////    }\r\n    return {\r\n      debug: function(){debug();}\r\n    }\r\n//  })();\r\n  };\r\n\r\n\r\n  var pn_debug = 0;\r\n//  var pn_debug_button = div_init(-1,'200px','30px','button','debug');\r\n//  var pn_debug_button = cnst.init('left:200px:bottom:30px:button:debug:Show');\r\n//  var pn_debug_out    = div_init(2,'200px','50px','txt','debug_out');\r\n//  var pn_debug_out    = cnst.init('left:200px:bottom:50px:txt:debug_out');\r\n  function make_debug_obj(pn_debug_button){\r\n    pn_debug_button.addEventListener('click', debug, false);\r\n    function debug(e){\r\n      console.log('debug');\r\n      if (site.components.postform_submit!=null) site.components.postform_submit.disabled = false;\r\n//      pn_debug_out.textContent += 'debug';\r\n      if (post_form_obj) post_form_obj.debug();\r\n//      worker.port.postMessage(\"Scott\");\r\n//      worker.port.postMessage(JSON.stringify(['SET','test2','Scott']));\r\n//      worker.port.postMessage(JSON.stringify(['GET','test2']));\r\n//      var str = timer_obj.timer().timer().req.responseText;\r\n//      console.log(str);\r\n//      worker.port.postMessage(JSON.stringify(['ECHO','ON']));\r\n//      brwsr.sw_cache.setItem(site.nickname+site.board+'0',JSON.stringify([cnst.get_time(), str]));\r\n\r\n    }\r\n  }\r\n\r\n  // can't use sw_cache in 8chan because of 'Content Security Policy' header\r\n  brwsr.sw_cache = (brwsr.sw_cache && window.SharedWorker && (pref.info_server || pref.info_client))? (function(){\r\n// working code.\r\n//    script = 'self.onmessage = function(e){self.postMessage(e.data);};'\r\n//    var blob = new Blob([script], {type: 'text/javascript'});\r\n//    var blobURL = URL.createObjectURL(blob);\r\n//    var echoWorker = new unsafeWindow.Worker(blobURL);\r\n//    URL.revokeObjectURL(blobURL);\r\n//    echoWorker.onmessage = function (oEvent) {\r\n//      console.log(\"Worker said : \" + oEvent.data);\r\n//    };\r\n//    echoWorker.postMessage(\"ali\");\r\n\r\n// http://www.sitepoint.com/javascript-shared-web-workers-html5/\r\n    if (!localStorage) return null;\r\n    var worker = null;\r\n    var sw_alive = false;\r\n    var key_ls = pref.script_prefix+'.bs'; // backing store\r\n    var url = localStorage[key_ls]; // should use cookie instead of localStorage.\r\n    if (url) {\r\n      if (!prep_sw(url)) prep_sw();\r\n    } else prep_sw();\r\n    function prep_sw(blobURL) {\r\n      if (!blobURL) {\r\n        var script = '\\\r\n          var ports = [];\\\r\n          var store = {};\\\r\n          var connections = 0;\\\r\n          self.addEventListener(\"connect\", function(e){\\\r\n            var port = e.ports[0];\\\r\n            var no = connections++;\\\r\n            var func = function(e){msg_parser(e,port,no)};\\\r\n            port.addEventListener(\"message\", func, false);\\\r\n            port.start();\\\r\n            port.postMessage(JSON.stringify([\"INFO\",\"Connected: #\" + no]));\\\r\n            ports.push({port:port, func:func, echo:true, subscribe:false});\\\r\n          }, false);\\\r\n          function msg_parser(e,port,no){\\\r\n            if (ports[no].echo) port.postMessage(e.data);\\\r\n            var fields = JSON.parse(e.data);\\\r\n            if (fields[0]==\"ECHO\") ports[no].echo = fields[1];\\\r\n            else if (fields[0]==\"GET\") port.postMessage(JSON.stringify([\"ACK\",fields[1],store[fields[1]]]));\\\r\n            else if (fields[0]==\"CLOSE\") {\\\r\n              port.removeEventListener(\"message\", ports[no].func, false);\\\r\n              ports[no] = null;\\\r\n            }\\\r\n/*            else if (fields[0]==\"SET\") store[fields[1]]=fields[2];*/\\\r\n            else if (fields[0]==\"SET\") {\\\r\n              var old_val = store[fields[1]];\\\r\n              if (old_val!=fields[2]) {\\\r\n                var msg = JSON.stringify([\"EVENT\",fields[1]]);\\\r\n                for (var i=0;i<ports.length;i++)\\\r\n                  if (i==no) store[fields[1]]=fields[2];\\\r\n                  else if (ports[i] && ports[i].subscribe) ports[i].port.postMessage(msg);\\\r\n              }\\\r\n            } else if (fields[0]==\"STAT\") stat_post(port,\"STAT_ACK\",fields[1]);'+\r\n           'else if (fields[0]==\"SUBSCRIBE\") ports[no].subscribe = fields[1];'+\r\n         '}'+\r\n         'var gc = setInterval(gc_func, 600000);'+\r\n         'function gc_func(){'+\r\n           'var date = Date.now() - 3600000;'+\r\n           'for (var i in store) if (store[i].date < date) delete store[i];'+\r\n//           'stat_post(ports[0].port,\"STAT_REP\",false);'+\r\n//           'for (var i in store) ports[0].port.postMessage(JSON.stringify([i,store[i].date,store[i].date-date]));'+\r\n         '}'+\r\n         'function stat_post(port,str,dump){'+\r\n           'var live = 0;'+\r\n           'for (var i=0;i<ports.length;i++) if (ports[i]) live++;'+\r\n//           'var count = 0;'+\r\n//           'for (var i in store) count++;'+\r\n//           'var msg = JSON.stringify([str,\"Connected: \"+live+\"/\"+connections+\", Stored: \"+count]);'+\r\n           'var msg = JSON.stringify([str,\"Connected: \"+live+\"/\"+connections+\", Stored: \"+Object.keys(store).length]);'+\r\n           'port.postMessage(msg);'+\r\n           'var count = 0;'+\r\n           'if (dump) for (var i in store) port.postMessage(JSON.stringify([\"DUMP_ACK\",(count++)+\": \"+i+\", \"+JSON.stringify(store[i])]));'+\r\n         '}\\\r\n        ';\r\n        var blob = new Blob([script], {type: 'text/javascript'});\r\n        blobURL = URL.createObjectURL(blob);\r\n        localStorage[key_ls] = blobURL;\r\n      }\r\n      try {\r\n        worker = new unsafeWindow.SharedWorker(blobURL); // FF throws exception when blobURL is invalid. But chorome doesn't throw.\r\n//        worker = new unsafeWindow.SharedWorker('blob:https%3A//krautchan.net/87996484-6a43-44c8-ab11-efe455fd2b2b');\r\n//        URL.revokeObjectURL(blobURL); // Chrome need several secondss to invoke. If you place this here, it doesn't work on chrome.\r\n        worker.port.addEventListener('message', sw_out, false);\r\n//        worker.port.addEventListener('message', sw_get, false);\r\n        worker.port.addEventListener('message', sw_tryget, false);\r\n        worker.port.start();\r\n//        worker.port.postMessage(\"Alyssa\");\r\n//        worker.port.postMessage(JSON.stringify(['ECHO','Alyssa']));\r\n//        worker.port.postMessage(JSON.stringify(['SET','test0','val_0']));\r\n//        worker.port.postMessage(JSON.stringify(['SET','test1','val_1']));\r\n//        worker.port.postMessage(JSON.stringify(['GET','test0']));\r\n//        worker.port.postMessage(JSON.stringify(['GET','test1']));\r\n//        console.log(url);\r\n        return true;\r\n      } catch(e) {\r\n//        console.log('catch error at making worker');\r\n//        prep_sw(undefined); // FF with 'Content Security Policy' header will make infinite loop.\r\n        return false;\r\n      }\r\n    }\r\n    function sw_out(e){\r\n//      alert('Worker said : ' + e.data);\r\n//      console.log('Worker said : ' + e.data);\r\n      console.log(new Date().toLocaleTimeString() + ', Worker said : ' + e.data.substr(0,120));\r\n      if (!sw_alive) {\r\n        worker.port.postMessage(JSON.stringify(['STAT']));\r\n//        worker.port.postMessage(JSON.stringify(['STAT',true]));\r\n        if (!pref.debug_mode['0']) worker.port.postMessage(JSON.stringify(['ECHO',false]));\r\n//        worker.port.postMessage(JSON.stringify(['ECHO',true]));\r\n//        worker.port.postMessage(JSON.stringify(['ECHO',false]));\r\n        window.addEventListener('beforeunload',\r\n          function(){\r\n            worker.port.postMessage(JSON.stringify(['CLOSE']));\r\n            worker.port.close();\r\n          }, false);\r\n      }\r\n      sw_alive = true;\r\n      if (!pref.debug_mode['0']) worker.port.removeEventListener('message', sw_out, false);\r\n    }\r\n    if (!brwsr.ff && worker) setTimeout(function(){\r\n//      console.log('alive = '+ sw_alive);\r\n      if (url!==null && !sw_alive) {\r\n        worker.port.removeEventListener('message', sw_out, false);\r\n        worker.port.close();\r\n        if (!prep_sw()) brwsr.sw_cache = null; // kill myself\r\n      }\r\n    },5000);\r\n//    var store = [];\r\n//    function sw_get(e){\r\n//      var fields = JSON.parse(e.data);\r\n//      if (fields[0]==\"ACK\") store[fields[1]]=fields[2];\r\n//    }\r\n    var callbacks = [];\r\n    var tryget_ids = [];\r\n    var fields = null; // static object for scan.\r\n    function sw_tryget(e){\r\n      fields = JSON.parse(e.data);\r\n      if (fields[0]==\"ACK\") {\r\n        var key = fields[1];\r\n        clearTimeout(tryget_ids[key]);\r\n        if (callbacks[key]) {\r\n          callbacks[key][0](key,fields[2],callbacks[key][1]); // callback with value.\r\n          delete callbacks[key];\r\n        }\r\n      } else if (fields[0]==\"EVENT\") {\r\n        if (pref.info_client && fields[1].search(info_raw)!=-1 && fields[1].substr(info_raw.length,1)=='p') {\r\n          var page_no = fields[1].substr(info_raw.length+1);\r\n          var timer = (timer_obj)? timer_obj.timer() : null;\r\n          if (timer!=null) {\r\n//            var value = JSON.parse(fields[2]);\r\n//            timer.page_check4(value[0], page_no, new DOMParser().parseFromString(value[1],'text/html'));\r\n            brwsr.sw_cache.trygetItem(fields[1],timer.page_check5);\r\n          }\r\n        }\r\n        if (pref.info_client && catalog_obj && catalog_obj.catalog_func()!=null && pref.catalog_snoop_refresh)\r\n          catalog_obj.catalog_func().catalog_insert(fields[1]);\r\n      }\r\n      fields = null;\r\n    }\r\n    function tryget_timeout(key){ // timeout is sequential always.\r\n      callbacks[key][0](key,null,callbacks[key][1]); // callback with null.\r\n      delete callbacks[key];\r\n    }\r\n    return (!worker)? null : {\r\n      setItem: function(key,value){worker.port.postMessage(JSON.stringify(['SET',key,value]));},\r\n//      getItem: function(key){\r\n//        worker.port.postMessage(JSON.stringify(['GET',key]));\r\n//        while (store[key]==undefined) sleep(0);\r\n//        var retval = store[key];\r\n//        delete store[key];\r\n//        return retval;\r\n//      },\r\n      trygetItem: function(key,callback,args){\r\n        callbacks[key] = [callback,args];\r\n        tryget_ids[key] = setTimeout(function(){tryget_timeout(key);},2000); // timeout 2sec\r\n        worker.port.postMessage(JSON.stringify(['GET',key]));\r\n      },\r\n      subscribe: function(sub){worker.port.postMessage(JSON.stringify(['SUBSCRIBE',sub]));},\r\n      addEventListener: function(){\r\n      }\r\n    }\r\n  })() : null;\r\n\r\n  if ((pref.catalog.embed && site.whereami==='catalog') || (pref.catalog.embed_page && site.whereami==='page') || (pref.thread.embed && site.whereami==='thread')) { //patch\r\n    if (catalog_obj) {\r\n      if (site2[site.nickname].catalog_native_prep_wait_loop) site2[site.nickname].catalog_native_prep_wait_loop(site.whereami, catalog_obj.show_hide);\r\n      else if (pref.patch.delayed_invoke.use) setTimeout(catalog_obj.show_hide, pref.patch.delayed_invoke.sec*1000);\r\n      else  catalog_obj.show_hide();\r\n    }\r\n  }\r\n\r\n// console debug commands for SharedWorker.\r\n//\r\n// var url = localStorage['CatChan.backing_store'];\r\n// var worker = new window.SharedWorker(url);\r\n// worker.port.onmessage = function(e){console.log(e.data.substr(0.120));};\r\n// worker.port.start();\r\n// worker.port.postMessage(JSON.stringify(['STAT']));\r\n\r\n\r\n//  function test_sw_cache(){\r\n//    sw_cache.setItem('/int/','aaa');\r\n//    sw_cache.trygetItem('/int/',sw_dummy);\r\n//    function sw_dummy(key,val){\r\n//      console.log(key,val);\r\n//    }\r\n//  }\r\n//  setTimeout(test_sw_cache,10000);\r\n\r\n// OPTIONS FROM HERE\r\n  options.func0_prep = function(pn,tb){ // schedule poster.\r\n//    var tb_0 = document.createElement('div');\r\n//    tb_0.innerHTML = '<input type=\"checkbox\">show option';\r\n//    tb_0.style.float = 'right';\r\n//    tb.insertBefore(tb_0,tb.childNodes[tb.childNodes.length-1]);\r\n    var tb_0 = cnst.add_to_tb(tb,'<input type=\"checkbox\">show option');\r\n//    tb_0.childNodes[0].onchange = show_hide;\r\n    tb_0.childNodes[0].onchange = function(){cnst.show_hide(pn);};\r\n    pn.innerHTML = '<div style=\"float:left\"><input type=\"checkbox\">autobumper</div><div style=\"float:right\"><input type=\"button\" value=\"Schedule\"><select name=\"time_sel\"><option>at</option><option>later</option></select><input type=\"time\" name=\"time\" value=\"08:41\"></div><div style=\"float:right\"></div>';\r\n    pn.childNodes[1].childNodes[0].addEventListener('click', schedule_post, false);\r\n//    function show_hide(){\r\n//      if (pn.style.display=='none') pn.style.display='';\r\n//      else pn.style.display='none';\r\n//    }\r\n//// working code for relative time.\r\n////    var cd_id = null;\r\n////    var cd_id_m = null;\r\n////    var cd_id_30s = null;\r\n////    var bg_back     = pn.parentNode.style.background;\r\n//////    var bg_back_org = bg_back;\r\n////    var time_to_post;\r\n////    function schedule_post(){\r\n////      if (cd_id==null && cd_id_30s==null) {\r\n//////        pn.childNodes[1].childNodes[0].value = 'Cancel';\r\n////        var sel_id = pn.childNodes[1].childNodes[1].selectedIndex;\r\n////        var time_val = pn.childNodes[1].childNodes[2].value;\r\n////        \r\n////        time_to_post = parseInt(time_val.substr(0,2),10)*3600 + parseInt(time_val.substr(3,2),10)*60;\r\n////        if (sel_id==0) {\r\n////          var time_str = cnst.get_time();\r\n////          time_to_post -= parseInt(time_str.substr(0,2),10)*3600 + parseInt(time_str.substr(3,2),10)*60 + parseInt(time_str.substr(6,2),10);\r\n////        }\r\n////        if (time_to_post<=0) time_to_post += 86400;\r\n////        cd_id = setTimeout(countdown_post_30s,(time_to_post-30)*1000); // NOT ACCURATE. slip 70s for 5h.\r\n////        countdown_m(time_to_post%60);\r\n////        set_background_and_button_value();\r\n//////        pn.parentNode.style.background = '#f5ecf9';\r\n////      } else {\r\n////        if (cd_id    !=null) {clearTimeout(cd_id); cd_id = null;}\r\n////        if (cd_id_m  !=null) {clearTimeout(cd_id_m);cd_id_m = null;}\r\n////        if (cd_id_30s!=null) cd_id_30s = cd_id_30s();\r\n//////        pn.parentNode.style.background = bg_back;\r\n////        cd_txt.innerHTML = '';\r\n//////        pn.childNodes[1].childNodes[0].value = 'Schedule';\r\n////        set_background_and_button_value();\r\n////      }\r\n////    }\r\n////    var cd_txt = pn.childNodes[2];\r\n////    function countdown_m(dec){\r\n////      var str = '';\r\n////      if (time_to_post%60!=0) str = time_to_post%60 + 's';\r\n////      if (time_to_post>=60)   str = Math.round((time_to_post%3600)/60) + 'm' + str;\r\n////      if (time_to_post>=3600) str = Math.round(time_to_post/3600) + 'h' + str;\r\n////      cd_txt.innerHTML = str;\r\n////      time_to_post -= dec;\r\n////      cd_id_m = setTimeout(function(){countdown_m(60);},dec*1000);\r\n////    }\r\n////    function countdown_post_30s(){\r\n////      cd_id_30s = countdown_post(30);\r\n////      clearInterval(cd_id_m);\r\n////      cd_id = null;\r\n////      cd_id_m = null;\r\n////    }\r\n\r\n    var cd_id = null;\r\n    var cd_id_s = null;\r\n    var bg_back     = pn.parentNode.style.background;\r\n    var time_at_post;\r\n    function schedule_post(){\r\n      if (cd_id==null && cd_id_s==null) {\r\n        var sel_id = pn.childNodes[1].childNodes[1].selectedIndex;\r\n        var time_val = pn.childNodes[1].childNodes[2].value;\r\n        var hour = parseInt(time_val.substr(0,time_val.indexOf(':')),10);\r\n        var min  = parseInt(time_val.substr(time_val.indexOf(':')+1),10);\r\n        var time_now = Date.now();\r\n        if (sel_id==0) {\r\n          time_at_post = new Date().setHours(hour,min,0);\r\n          if (time_at_post<time_now) time_at_post+=86400*1000;\r\n        } else time_at_post = time_now + (hour*3600+min*60)*1000;\r\n        countdown_m();\r\n      } else {\r\n        if (cd_id  !=null) {clearTimeout(cd_id);cd_id=null;}\r\n        if (cd_id_s!=null) {clearInterval(cd_id_s);cd_id_s=null;}\r\n        cd_txt.innerHTML = '';\r\n      }\r\n      set_background_and_button_value(false);\r\n    }\r\n    var cd_txt = pn.childNodes[2];\r\n    function countdown_m(){\r\n      var time_now = Date.now();\r\n      var time_till_post = time_at_post-time_now;\r\n      if (time_till_post%60000>=1000 && time_till_post>60000) cd_id = setTimeout(countdown_m,time_till_post%60000);\r\n      else if (time_till_post<90000) cd_id = setTimeout(function(){cd_id_s=countdown_post(30);cd_id=null;},time_till_post-30*1000);\r\n      else cd_id = setTimeout(countdown_m,(time_till_post+30000)%60000+30000);\r\n      var str = '';\r\n//      if (time_till_post %60000) str = (time_till_post%60000)/1000 + 's'; // debug\r\n      if (time_till_post %60000>=1000 && time_till_post%60000<=59499) str = Math.round((time_till_post%60000)/1000) + 's';\r\n      if (time_till_post>=59500)   str = Math.floor(((time_till_post+500)%3600000)/60000) + 'm' + str;\r\n      if (time_till_post>=3599500) str = Math.floor( (time_till_post+500)/3600000) + 'h' + str;\r\n      cd_txt.innerHTML = str;\r\n    }\r\n\r\n    function countdown_post(sec){\r\n      cd_txt.innerHTML = sec + 's';\r\n      set_background_and_button_value(true);\r\n      return setInterval(countdown_s, 1000);\r\n\r\n      function countdown_s(){\r\n        sec -= 1;\r\n        cd_txt.innerHTML = sec + 's';\r\n        if (sec==0) {\r\n//          alert('post at '+ Date());\r\n          var evt = document.createEvent('MouseEvents');\r\n          evt.initUIEvent('click', false, true, window, 1);\r\n          site.components.postform_submit.dispatchEvent(evt);\r\n          schedule_post(); // cancel procedure\r\n        }\r\n      }\r\n    }\r\n\r\n    var autobumper = pn.childNodes[0].childNodes[0];\r\n    autobumper.onchange = function(){set_background_and_button_value(false);};\r\n    function set_background_and_button_value(cd_s){\r\n      var color = (cd_s)? '#ffc0cb' : ((cd_id!=null)? '#f5ecf9' : ((autobumper.checked)? '#e5f4f9' : bg_back));\r\n      pn.parentNode.style.background = color;\r\n      var value = (cd_s || cd_id!=null)? 'Cancel' : 'Schedule';\r\n      pn.childNodes[1].childNodes[0].value = value;\r\n    }\r\n    var timer_deadtime = null;\r\n    options.func0_exe = function(page){\r\n      var posts_itt = document.getElementsByClassName('postreply').length - document.getElementsByClassName('de-post-deleted').length;\r\n      if (parseFloat(page)>=site.max_page-1 && autobumper.checked && timer_deadtime==null && posts_itt < site.autosage) {\r\n//      if (parseFloat(page)>=1 && autobumper.checked && timer_deadtime==null) { // for debug }\r\n        cd_id_s = countdown_post(30);\r\n        timer_deadtime = setTimeout(function(){timer_deadtime=null;},3600*1000); // 1h\r\n      }\r\n    }\r\n  }\r\n// NEXT TIME PASSWORD fDEPJ9Uo\r\n// OPTIONS TO HERE\r\n\r\n})();\r\n\r\n\r\n"]}