{"version":3,"sources":["CatChan.user.js"],"names":["pref_default","for_save","proto","image_hover","image_prefetch","click","click_area","format","show","style","contents","layout","posts","fileinfo","images_2nd","hover","search","thumb","resize","footer","use","nrtm","nr","rp","im","domain","board","no","flag","tag","page","design","rOP","iOP","custom","custom2","ctime","btime","ptime","rctime","rbtime","rptime","br","prate","archived","nd","nl","nf","nid","ns","footer_br","draw_on_demand","load_on_demand","t2h_sel","t2h_L","t2h_M","t2h_N","this","t2h_num_of_posts","save_board_list_sel","board_list_sel","mark_new_posts","auto_update","auto_update_period","auto_update_countdown","storePosts","sourceOfSP","searchAs","searchAsA","searchAc","loosen","max","max_threads","max_threads_at_refresh","popup","colorID","backlink","popup_truncated","popup_zIndex","backlink_all","backlink_all_cross","popup_hlt","bl_ec","bl_rm","popup_delay","popdown_delay","popdown","popup_mMove","link_show_op","link_show_cross","expand_thumbnail_inline","localtime","expand_thumbnail_inline_all_after","expand_thumbnail_initial","hide_posts_without_images","thumbnail","inline","limit_width","limit_height","margin_width","margin_height","webm","webm_mute","webm_loop","ondemand","ref_height","dragfloat","df_dblC","df_mW","df_cV","zoom","popupX","ID","name","anon","trip","open_spoiler_text","open_spoiler_image","merge","merge_list","merge_list_str","merge_list_obj6","merge_first","merge_lv","merge_lv_str","merge_lv_obj6","lazyDraw","merge_step","step","scroll_lock","use_expander_always","popup2","popup2_sel","popup2_sel_tolerance","popup2_resize","popup2_resize_bw","popup2_resize_cw","popup3","ww","wn","nw","nn","posts_search_op","posts_search_op_opacity","deleted_posts","detect","store","auto_clean","detect_sage","page_his","promiscuous","imagesearch","google","iqdb","saucenao","whatAnime","desustorage","exhentai","env","disp_offset","disp_filler","popup_native","expand_thumbnail_inline_native","image_hover_native","colorID_native","backlink_native","localtime_native","auto_update_native","event_dynamic","popup_native_kill","refresh_initial","pref_new","script_prefix","features","graph","setting","setting2","postform","catalog","listener","uip_tracker","thread_reader","debug","notify","desktop","sound","favicon","recovery","domains","site0","domains_obj","max_capture","interval_found","write_to_ls","aggregator","server","load_pref","load_data","check_page","check_post","check_thread","import_format","max_graph","scale_thread","auto_start","prevent_redirection","graph_animation","autoconf","info_server","info_client","wafd_tb","wafd_open_spoiler","show_page_fraction","catalog_max_page","catalog_max_page_auto","catalog_max_page_select","catalog_snoop_refresh","catalog_auto_rollup_when_moving","catalog_size_width","catalog_size_height","catalog_size_text_width","catalog_size_text_height","catalog_size_tn1_width","catalog_size_tn1_height","catalog_size_tn2_width","catalog_size_tn2_height","catalog_size_frame0_width","catalog_size_frame1_width","catalog_load_on_demand_timeout","catalog_2nd_images_show","catalog_2nd_images_hover","catalog_2nd_images_search","catalog_posts_on_demand","catalog_refresh_clear","catalog_popdown","catalog_popup_delay","catalog_popdown_delay","catalog_popup_size_fix","catalog_open_last50","catalog_board_list_str","catalog_board_list_obj","catalog_promiscuous","catalog_board_list_sel","cataLog","embed_mode","val","localtime_offset","Date","getTimezoneOffset","catalog_footer_ignore_my_own_posts","catalog_footer_tag_letters","catalog_no_popup_at_expanded","catalog_open_in_new_tab","catalog_open_where","catalog_open_where_click","catalog_triage","catalog_triage_place","catalog_triage_hist","triage","show_always","hide_toggle","catalog_triage_str","catalog_auto_update_countdown","catalog_expand_with_hr","overwrite_site2_json_str","overwrite_site2_eval_str","tooltips","help","info","zIndex","indexing","filter","kwd","str","re","ci","match","sentence","op","post","sub","com","file","meta","id","rexps","tag_ci","time","time_creation","time_str","now","toLocaleString","time_obj","time_ago_str","time_ago_str_sync_at_refresh","time_track","desktopime_mark_str","time_watch","time_watch_creation","list_time_scroll","list","list_str","list_obj2","attr_list","attr_list_str","attr_list_obj2","bookmark_list","bookmark_list_str","bookmark_list_obj2","watch_list_str","watch_list_obj2","tag_search","show_nof_boards","pref","liveTag","tag2bList","label","by","auto_list","obj7","kill","watch","sticky","style_str","bookmark_list_rm404","auto_load_filter","auto_save_filter","auto_save_filter_at_refresh","ignore","recommendation","all_boards","board_tags","ex_list","ex_list_str","ex_list_obj2","board_tags_same","style_general_list","style_general_list_str","style_general_list_obj2","refresh","except_bt","at_switch","catalog_json","embed","embed_page","embed_frame","embed_archive","order","reply_to_me","reply","auto_watch","unmark_on_hover","mimic_base_site","text_mode","mode","appearance","titleBar","settings","num_of_pages","boards_selector","initial","state","width","height","left","top","__proto__","Object","create","disable_list_when_kwd_active","disable_tag_when_kwd_active","infinite","thread","float","common","clear_at_manual_scan","on","deletion","interval","adaptive","highlight_str","annotate","auto_open","auto_open_th","auto_open_kwd","link","name_str","addName","addName_str","post_str","sage","tolerance","patch_bug","patch_bug2","patch_bug2nth","patch_bug3","patch_bug4","patch_bug5","annotate_page","sync","triage_close","check_num_of_children","own_posts_tracker","show_own_post_by","show_reply_to_me_by","clean_up_own_posts","IDinfo","IDFlag","IDop","nofIDs","nofFlags","auto","nameTrip","nofNames","nofTrips","gen","gen_str","cloudflare","auto_reload","auto_reload_time","scan","lifetime","crawler","crawler_adaptive","crawler_idle_time_to_spawn","max_archive","src","beep_freq","beep_length_f","beep_volume_f","new_thread","appear","supp_init","show_last","limit","brwsr","delay","title","hide_zero","maxstr","from","lock_tags_in_op","inherit_board_name","lock_board_name","inherit_board_tags","lock_board_tags","ex","exurtm","exur","in","inurtm","inur","urtm","ur","pickup_interval","rm_404","disp_delay","fg","bg","click_func","click_func_bl","watch_all","lazy_each","lazy_delay","ex_list_obj5","rm_list","rm_list_str","rm_list_obj5","virtualBoard","scanDelay","p_board","p_remove","v_remove","scan_domains","instant_scan","sel","fix","titleBar_str","window_str","popUp_str","copy","post_editing","post_new","userCSS","sample","comment","healthIndicator","expand_running","dont_retire_running","cancel","network","cross_domain","fetch_actively","th100","th100_delay","th20","th20_delay","timeout","overXFO","overCSPF","stats","retain_404","draw_delay","estimate_posts","save","load","len_capture","auto_acquisition","auto_acquisition_scan","auto_acquisition_scan_delay","auto_acquisition_all","tolerant","patch_tm","chart","off_anime_blur","window_width","window_height","inst","len","time_sel","board_sel","show_legend","np","p","ep","nt","t","et","clip_np","clip_np_val","options","bezierCurve","animation","pointDot","pointDotRadius","archive","load_img","restore_auto","clear_threads","clear_files","store_auto","dir_dled","open_local","fix_inconsistency","store_watched","oneshot","tn","img","post_idb","tn_idb","img_idb","webm_idb","live","deleted","IDB","auto_clean_init","prune","prune_flush","nof_tr","nof_cl","nof_cl_max","auto_restore","auto_restore_remove","watchdog","redirect_404","redirect_404_CSP","list_obj6","list_inherit","tar","tarsize","sub_in_filename","files_sel","IDB_board_sel","IDB_board_sel_gfunc_pre","pref4","IDB_thread_sel","IDB_thread_sel_gfunc_pre","IDB_select_multiple","editing_timeout","threadStats","full","retry","debug_mode","unread_count","parse_error","site2func","site2func_expand","pfunc","pfunc_expand","pfunc_all","pfunc_all_expand","pfunc_comp","pfunc_comp_expand_same","pfunc_comp_expand_diff","pfunc_comp_proto","test_mode","tips","num","num_f","test_str","patch","delayed_invoke","sec","rm_404_blacklist","pref2","KC","summer_time","meguca","historyAPI","utilize_boards_json","utilize_boards_json_domain","8chan","easy","posts_ago","threads_ago","max_boards","easy2","reset","presets","time_post","time_op","basics","VB","local","global","LTfrom","limits","i","pref_default2","pref_func","pref_overwrite","delete_null","defineProperty","get","enumerable","configurable","common_func","Object_modifyDescriptor","writable","make_port_parent","win","initialize","e","console","log","window","data","source","RegExp","site","nicknames","join","test","embed_frame_win","whereami","indexOf","ff","init_receive_port","ports","removeEventListener","init_func","messages_to_send","length","send_message","addEventListener","make_port_child","parent","postMessage","channel","MessageChannel","port1","port2","port","receive_func","receive_message","onmessage","start","close_connection","close","message","Array","isArray","push","JSON","stringify","substr","receive_message_emu","send_message_emu","shift","key","toString","received_messages_404","parse","httpd","sub_funcs","archiver","marked_first_post","myself","site2","nickname","mark_newer_posts2","scrollTo","offsetTop","header_height","document","body","clientHeight","innerHeight","common_obj","mark_posts_from_parent","prep_own_posts_event_received","site3","own_posts","catalog_obj","catalog_func","triage_exe_pipe","annotate_from_catalog","setTimeout","close_all","make_uip_tracker","uip_check","uip_tracker_id","uip_show","sage_detect","remove_dom_event_listener","observer","disconnect","value","uip_show_2","uip_show_from_doc","post_uip","uip_show_3","time_req","clearTimeout","waste_count","uip_retry","tgt_uip","tgt_post","uip_tgt_post","pn_uip","createElement","innerHTML","childNodes","setAttribute","pn_posts","map","v","insertBefore","j","sage_annotate","pn_page","pn","his","show_page","lastChild","post_nums","uip_post_num","appendChild","pn_first","splice","from_http","status","parse_json_thread","response","responseText","nof_posts","uips","last_updated","last_no","date","toLocaleTimeString","posts_new","posts_old","post_hilight","posts_deleted","undefined","p0","uip_tracker_destroy","vals","email","uip_first","nos","uip_last","slice","concat","parentNode","removeChild","th","sage_scheduled","sage_done","page2num","page_his_update","pref_obj","pn_name","parse_funcs","textContent","obj","Math","floor","ps","split","parseInt","MutationObserver","observe","childList","auto_open_prep","threads","max_no","auto_open_check","rx","threads_req","threads_opened","open","make_url4","pn_test","pn_a","getElementsByTagName","tgt","keys","http_req","get_id","uip_tracker_init","isthread","make_thread_reader","add_event_to_submit","check_reply","remake_own_posts","get_my_posts_no","remove_event_from_submit","thread_html","time_unit","ignore_scroll","favicon_obj","favicon_obj_trim","target","site_live","wrap_to_parse","end","updated","new_posts","init","update_own_posts","favicon_check","document_body","scrollTop","ref_height_checked","offsetHeight","notifier","set","opener","triage_event","flds","replace","triage_exe","com0","com1","get_checked_time","setup_submit","inst_submit","postform_submit","mems","wt","get_flag","localStorage","my_posts","parse_funcs_html","createTextNode","nextSibling","add_you","event_submit","components","btns_p","btns","onclick","modify_bookmark","pn_ref","embed_to","Triage","wheelpatch","add_root","inst_submit2","postform_submit2","tacks","WeakMap","catalog_get_native_area","tagName","dataset","cmd","tack","remove","delete","addedNodes","make_tack","cnst","tack_float_nSblgs","previousElementSibling","entry","pfID","IDs","pfFlag","flags","IDFlags","trips","names","nameTrips","prop_pn","prop","header","trailer","show_total","combo","combo_prop","show_IDop","post_prop","prep","show_pn","c","m","total","obj_combo","show_op","pns","firstChild","redraw","remove_pn","previousSibling","prep_pfunc","onchange_funcs","destroy","remove_root","setup_submit2","thread_reader_init","make_catalog_obj","pn12_button","show_hide","make_catalog","set_embed_xxxx","embed_catalog","embed_embed","scan_tags_common","ths","html_str","tags_obj","acc","cs","tags_th","tags","dbt","name2domainboardthread","tags_th_uniq","k","tag_test","toLowerCase","mem","scan_tags_common_b","tag_ref","n","sort","a","b","scan_tags_common_c","tags_tgt","str2","hide_prev_float","currentTarget","display","show_prev_dock","tack_dock_e2tack","tack_dock_nSblgs","window_beforeunload","triage_parent_set","triage_parent","pn12_1","pClg","ppn","catalog_resized","lastIndexOf","ago_clicked","time_in","filter_time_str","apply_prep","remake_triage","finish","off","pn12_triage","make_triage_entry","pn12_triage_all","triage_wheel","triage_str","position","onmouseover","triage_in","onmouseout","triage_out","format_tgt","set_trg","hide","preventDefault","evt","createEvent","initMouseEvent","type","canBubble","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","dispatchEvent","triage_exe_0","get_triaged_thread_name","args","lth","getFromName","usWT","tri_str_ex","tri_str_attr","hist","datetime","start_1","changed","attr","catalog_attr_set","catalog_filter_query","threads_index","idx_reorder","format_html","update","show_catalog","get_trg","format_buttons","click_thread","triage_history","arguments","search_ex_list","watch_list","millisec","wat_str","unwatch_explicitly","mark_read_thread","ex_str","at_str","at_obj","val_obj2","val_obj3","str2obj2","systemSticky","at_obj_keys","pop","undo_args","name_next","changed_next","set_watch_time","get_watch_time_of_a_thread","scan_boards","scan_init","priority","trim_html","remove_files_info","remove_posts","format_thread_contents","format_thread_layout","format_thread_style","format_thread_always","trim_html_mark_time","get_mark_time","mark_newer_posts","format_remove_tn_area_size","image_resize1_onload","image_resize","image_resize2_onload","merge_deleted_posts","t2h","update_posts_merge_prep","pd","insert_thread","date_load","picked_up_by_kwd_filter","insert_thread_from_native","preprocess_doc","type_data","adoptNode","importNode","init_new","tgt_th","time_bumped","time_created","nof_files","time_posted","needs_update","gClg","remove_thread","th_init","func_in","func_pop_up","thread_in","type_html","domain_html","icon_sticky","icon_show_always","tgt_th16_proto","type_source","editing","list_nup","add_scan","add","pf","merge_obj5_1","auto_obj","merge_obj5a","catalog_filter_query_keyword","posts_full","posts_shown","type_parse","t2h_page","expand_posts","expand_num","get_t2h_num_of_posts","has_posts","recent_posts","posts_active","insert_thread_prepare_html_lazy","ed_t","ed_u","replyTime","Clg","prototype","Clgs","clone_thread","set_watch_time_thread","set_watched_to_last","set_unwatch","from_lazy","prepare_html","insert_thread_format_th_pn","insert_thread_format_html","ta","ch","gGEH","pns_all_keys","overflow","dom_addEventListener","click_thread_whole","dom_addAttribute","tn_as","click_thread_tn","tn_imgs","text","footer_new","Footer","prep_footer3","force_prep_html","set_own_posts","posts_used","init_or_refresh","links","get_thread_links","click_link","update_posts_in_page","popups_add","idx_new_post","page_html","post_json2html","update_draw","insert_thread_format_html_add_events","add_event","expand_now","expand_on_demand","DIH","GEH","blacklist_click","expand_thumbnail_queue_add","call","extra_format","ret_time","pop_up_delay","re_sort_thread","idx_re_sort","expand_shrink_thread","show_catalog_hr","get_name_recursive","classList","contains","getAttribute","url","open_new_thread","href","add_open_new_thread_event","elem","func","remove_open_new_thread_event","date_mark","merge_obj5","hit","fullname2dbt","archiveFile","name2dbt","short_link","as","window_name","time_marked","historyAPI_blocking","pgh","sg","size","sID","h","lastModified","track","update_ur","update_force","show_catalog_delayed","ref_heights","drawn_idx","catalog_obj2","lazy_draw","expand_thumbnail_on_demand","get_ref_height","threshold","scroll_event_src","get_now_height","threads_idx_debug","idx","y","count","threads_idx","show_catalog_skip_hs","ref_count","c_len","class_hs","className","horizontal_separator_in_index","rollback_info","stl","flag_redraw","set_icon","showAlways","filter_kwd_prep_init","str_old","fail_list","suc_list","filter_kwd_prep","kwd_prep_regexp","filter_kwd_active","val_old","basic_active","active","search_posts_active_once","posts_search_inactivated","timestamp","filter_kwd_count","catalog_filter_changed","no_reset","catalog_filter_query_1","search_by_tags","pref3","retval","catalog_filter_query_time_list","tgt_posts","catalog_attr_changed","pop_up_status","pop_up_op","pop_up_delay_id","pop_keep_event","pop_up_set_contents","popups_posts","set_pos","popup_body","offsetWidth","pop_down_event","chart_obj","PostChart","documentElement","bottom","pop_down_op","div_destroy","kind","flag_search","search_result","kwd_make_result","modify_thread_link","prepare_html_prep_posts","pn_result","page_json2html3","op_img_url","prep_anchor_links","format_pn","q","forEach","getElementsByClassName","prep_reserved_tags","not_initial","tags_reserved_init","make_refresh_list","tgts","tgt_domains","str2obj","blist","domains_for_all_boards","boards","callback","get_boards_json","health_indicator","bds_picked_up_by_tags","bd","max_page_bd","pgs","max_page","trim_list","embed_init","bds","catalog_clear_threads_candidates_of_deletion","schedule","threads_candidates_of_deletion","catalog_clear_threads","off_delay","catalog_refresh","from_auto","from_switch","refresh_start","result","catalog_refresh_1","selectedIndex","scan_name","get_board_list","tgts_all","register_auto_acquisition","scan_refresh","catalog_refresh_end","th_count","d","tags_ci","insert_myself","force_annotate","nativeUpdate2pn","posts_updated","get_key_recursive","scan_boards_keyword_callback2","native_prep","ext_posts","scan_boards_keyword_callback2_default_args","prepare_html_post","insert_thread_from_native_prep","catalog_insert","crawler_max","tgt_raw","restore_bd_from_IDB","threads_delayed_pruning","req","restore_bd_from_IDB_1","restore_th_from_IDB","event_funcs","bind","rm_items_404_check","db","list_obj3","attr_list_obj3","watch_list_obj3","rm_items_404","clean_list_all","lbd","LS_synced","clean_up_LS","IDB_synced","clean_up","db_len","comment_out_bookmark","pn12_0_4","comment_out_key","rep_str","make_watcher","clg","txt","post_com2txt","sub_com","sub_com_max","0","16","24","mouseover","req_show","show_tooltip","stat","prog","prog_str","IDX","found_threads","scanned","found_boards","cancel_button","html","initiator","err_str","abort_str","tooltip_func","show_2","mouseout","hide2","cancel_scan","scan_abort","disp","shrink_running","elems","HealthIndicator","pn_countdown","pn_hi","col","remove_from_parent","HealthIndicatorElement","show_tooltip_delayed","DelayBuffer","get_binded_delayed_do","report","SUC","set_health_indicator","timestamp_set","update_all_force","compile","force","insert_footer3","try_dirtifying_tag","draw","factory","prep_flag_dom","dom","Element","post_flag2html","ts_refresh","formatted_arr","get_str","footer_old","footer_native","footer_prep","footer_style","country","color_tag_node","query_tag_node","nextElementSibling","remove_nullify","tags_new","update_tag_nodes","tag_node_onclick","create_tag_nodes","deleted_after","flags_debug","format_relative_time","rt","sign","at","abs","s","format_time","ts_refresh_rx","toLocaleDateString","nums2","funcs","pg","nm","watched","lp","dp","ar","nc","ni","ct","cT","bt","bT","pt","pT","pr","dn","sp","wrap","l","arr","tmp","fmts","native","condensed","fmt","tgt_th_in","lth_in","styleSheet","sw_cache","subscribe","initialize_loop","watcher","pfai","pn12","init3","func_str","exit","maximize","show_catalog_cont","auto_roll","pn12_0","pn12_0_2","add_to_tb","icons","auto_shrink_board_selector","setup","pn12_0_2_children","IDB_spacer","IDB_indicator","set_indicator","format_html_str","html_funcs","rollup_radio","make_sel","rollup","popup_filter","pls","set_tack_float","set_target_of_button","idxs","threads_odl","clgs","hook_set","tgts_in","pn_only","ref","popups_release_all","func_hide","update_posts_merge_bases","remove_th","testPoster","hide_target","pn12_0_4_selectors","auto_shrink_selector","catalog_board_list_sel_old","pn_filter","oninput_funcs","catalog.filter.kwd.str","pn_use","catalog.filter.list_str","time_filter_changed","catalog.filter.attr_list_str","catalog.filter.tag_search.str","timer_tgt","blur","catalog.indexing","*.auto_update","*.auto_update_period","getItem","load_save_key","filter_onchange","save_str","obj_elim_the_same","setItem","load_default","row_obj","catalog.filter.kwd.*","catalog.filter.kwd.match","catalog.filter.kwd.re","catalog.filter.kwd.ci","catalog.filter.kwd.sentence","catalog.filter.kwd.post","checked","scanBoard","scanSite","catalog.filter.tag","catalog.filter.time","catalog.filter.time_creation","catalog.filter.time_str","catalog.filter.list","catalog.filter.watch_list_str","catalog.filter.attr_list","scanBoardIf","scanSiteIf","required_only","keyword_load_1","keyword_load","catalog.order.reply_to_me","catalog.order.reply","catalog.order.watch","catalog.order.sticky","catalog.filter.time_quick_sel","catalog.filter.tag_search.re","catalog.filter.tag_search.show_nof_boards","tagB.*","cbx_all_onchange","add_tags_to_boardlist","add_to_auto","cmds","str2obj7","o2s","filter.disable_list_when_kwd_active","filter.disable_tag_when_kwd_active","add_onchange_format","add_onchange","event_func","prep_own_posts_event","make_own_posts","tags_scan_regex","scan_boards_check_pre","indicator","multi_entry","callback_args","scan_boards_init","pool","div","parser","DOMParser","doc","wrapper_obj","cache_write","senders_returned","tgts_iterator","args_proto","sb","scan_boards_keyword_make_tgt","idx_insert_odl","func_old","release","next","force_json","u","threads_meguca","got_200_board","parse_options","localArchive","tgt_pn","from_catalog","filter_tags","filter_active_kwd","filter_active_tag","tgt_th_meguca","post_updated_static","has_editing","pf_store","sage_detect_all","time_loaded","got_200","scan_tag","innerText","prep_tags","insert_thread_from_native_1","tag_updated","post_updated","ed_f","update_tags_in_editing_posts","waiting","popups_fetched","archive_store","pf_store_th","pf_store_1","dont_have_com","check","popups_add_1_cross","stats_ID","time_check_old","rescan_dp","force_ar","ed_p","missing_info","pick_up_for_search","picked_up_by_tag_filter","picked_up_by_filter","tgt_th_status","force_update","tgt_th8","pf_store_th_2","store_th_to_mem","show_catalog_scroll_lock","appeared","tag_scan_board","get_max_page","idx_raise_odl","rm_404_1","got_404","ths_tag","callback_1","REQ","key2","get_tgt_func","issued","responseType","data_type","INDICATOR","callback2","hasOwnProperty","callback_1_fail","found_board","stop_if_running","timer","countdown","time_remains","from_refresh_button","period","catalog_get_native_scroll_area","trg","format_funcs","WATCH","UNWATCH","SHOW","UNSHOW","STICKY","UNSTICKY","ARC","ARC1","UARC","on_off","change_mode","set_triage_style","triaged_name","offsetLeft","scrollLeft","right","db_thread_out","triaged_pn","db_triage_off","delayed_do","thread_out_delayed","triage_off_wdg","restart","triage_off","thread_out","hide_if","thread_out2","Watchdog","stop","stopPropagation","triage_in2","trg_new","posts_in","remake","update_posts_replace_prep","expand","get_t2h_from_index","scan_ui","page_json2html3_add_omitted_info","prepare_html_extract_params","extracted","filename","prep_mimic","mimic","type_mimic","mimic_tgt","tmp_pn","catalog_json2html3","remove_by_tagname","toplevel_anchor","absolute_link","thq","pref_env","not_anchor","get_t2h_index","mb","merge_base_tgts","initialized","base_tgts","merge_base","query","bases","setup_hook","pf_env","update_posts_replace","page_json2html3_replace_expander","replace_posts_by_search","th_new","update_posts0_class","tgt_th16","mark_time","Infinity","Object_defProps","get_threads_odl_default","8","threads_odl_default","get_tgt_th","kwd_odl","check_sub","check_func","insert","check_funcs","sticky_last","sticky_first","watch_last","watch_first","get_date","funcs_get_date","19","4","5","1","2","3","kwd_odldb","idx_delete_odl","odls","idx_old","idx_new","image_hover_prep","img_ex","clone_img","pointerEvents","get_mode","image_hover_add","img_tn","divert","hover_pf","script_body","pause_req","onload","image_hover_onload","onerror","pause_cancel","hover_ex","image_hover_remove","hover_tn","img_next","get_next_image","img_pf","image_hover_snatch","zoom_required","cursor","image_hover_zoom_in","image_hover_snatch_end","play","image_hover_zoom_end","image_hover_zoom_prep","image_hover_zoom_start","x","clientWidth","naturalWidth","maxWidth","naturalHeight","maxHeight","zoom_included","image_hover_draggable","draggable","ondragstart","div_dragstart","mousewheel","div_scroll","inline_or_hover","zoom_factor","fx","fy","zoom_in_place","f","oT","oR","image_hover_zoom_out","clone_img_make_src","from_initial","tgt_domain_html","general_event_handler","image_hover_check_mode","post_html","img2src","get_op_src","cloneNode","ext","img2ext","controls","autoplay","loop","muted","image_expanding","expand_thumbnail_on_demand_set","expand_thumbnail_inline_load","opacity","shrink_thumbnail_inline","format_expanded_thumbnail","nowHeight","ot","image_expand_on_demand_instance","image_hover_reentry","show_catalog_init_funcs","tgt_lock_calcel","wdg","marks","scroll_back","mark_top","abs_top","wdg2","last_viewed","get_last_viewed","modified","get_mark_from_height","clear_last_viewed","debug_str2","catalog_obj2_proto","debug_str","drawn_y","permit_draw_on_demand","draw_adaptive","draw_count","tgts_count","triage_thread","ref_count_init","func_track_reset","load_tgt","i_start","mode_merge_tails","lazy_step","lazy_check","isShownForTails","disp_th100","disp_th20","func_show","func_search_ref","func_serach_ref","func_track_shown","d_count","tgt_bt","debug_str4","debug_str3","update_drawn_y","ref_step","func_org","y_old","check_y","od_count","od_width","func_od_reset","filler","hr","mutex","release_draw","query_1","rexp","query_11","DUMMY","pst","type_com","extra_files","any_or_all","testval","kwd_1","unmatch_or_match","catalog_frame_prep","tb_prep_for_embed","catalog_native_prep","key_me","key_me2","onchange_merge","mirror_targets","subscribers","valid","last_Y","mouseover_lock","change","class_expander","WeakSet","geh","insert_iframe_youtube","close_button","tgt_domain","domain_url","isThumbnail","href2domain","has","get_mark","dynamic_image_hover","dragstart","dragend","dom_removeEventListener","over","tag_onmouseover","mouseleave_bl","drag_sx","drag_sy","left2right","offsetX","offsetY","cn","GEH_mouseover_force","root_body","boardlist","register_cc","get_threads","catalog_liveTag_scan_site","register","make_chart_obj","pn1","make_new_chart","charts","events_beforeunload","window_focus","window_blur","foreach","chart_posts","destroy_all","chart_data_init","labels","datasets","chart_data_init_1","color","alpha","fillColor","strokeColor","pointColor","pointStrokeColor","pointHighlightFill","pointHighlightStroke","time_unit_sel_html","chart_options_str","pn_popup","skelton","deep_copy","pn_canvas_root","pn2_obj","this_obj","pn2_template","pn2","button_settings","sels","legend","set_legend_str","onchange_entry_bound","onchange_entry","onchange","bottom_top","querySelectorAll","tgt_hier","get_tgt","apply_prep_load","pn_board_sel","pn_canvas","chart_size_changed","Stats","get_tgts","canvas_active","onmousemove","deactivate_canvas_if_mouse_on_corner","append_legend","board_sel_changed","tgts_changed","len_changed","replace_data","data_src","ecTs","chart_redraw","data_graph","dd","fN","fromNo","dr","rm","ds","layer","data_l","merge_1","data_p","data_p_old","data_t","data_t_old","scale_setup","arr_dec_slice","idx_last","data_np","clip_np_func","scale_thread_old","ctx","getContext","Chart","Line","dec","dst","old","scale_changed","points","unsubscribe","update_data2","removeData","addData","tgt_p","tgt_t","tgt_ep","tgt_et","tgt_np","min_idx","remove_legend","maximize_embed_style_pnch1","maximize_float_style_pnch1","maximize_tgt","apply_prep_set","separate","time_unit_changed","querySelector","clear","dump","data_update","make_setting_obj","pn8","pn7","prep_pn7","make","pref_apply_prep","pn7_1","timer_obj","button_action","obj_init","pref_samples","site2_json","site2_eval","void_func","fm","make_listener","listen_event","newValue","pipe_name","JSON_parse","value_old","make_timer_obj","pn0","property_changed","timer_obj2","make_timer","stop_destroy","pn0_str","finished","get_time","page_check5","page_no","page_check4","parseFromString","time_stamp","ops","get_ops","str_set","str_get","prep_next","func0_exe","page_check2","get_nos","all_got","increase_posts","last_post_old","last_post","num_of_new_threads","found","isNaN","timestr","missing","tgt_doc","flag_set","get_last_post","last_ops_old","last_op","get_posts","str_place","location","thread_keyword","req_events","dead","info_raw","get_page","send","page_check3","checking","page_check","timer_restart","interval_old","timer_stop","setInterval","clearInterval","XMLHttpRequest","retry_count","retry_limit","make_post_form_obj","pn9","postform_focus","postform_comment","focus","postform_float","activation","rolldown","pn10","pn10_2","on_change_redirection","func0_prep","postform_dock","show_hide2","pn11","make_iframe","submits","targets","forms","forms_post","method","inputs","posted","make_debug_obj","pn_debug_button","disabled","post_form_obj","self","navigator","userAgent","Date_parse","do_tgt","hasFocus","desc","getOwnPropertyDescriptor","unshift","domains_all","protect","isStep","set_options_to_selector","IDB_board_sel_options","IDB_thread_sel_options","whreami","pn_end","strict","dumb","enables","pn_out","getElementsByName","fields","ex_count","str_out","pref_query","eval","sessionStorage","replace_rule","rule_str","ss","cssRules","deleteRule","insertRule","make_rule_click_area","make_styles","rules","rules_str","styleSheets","doc_rules","selectorText","trim_rules","cssText","add_to_watch","dummy_add","attributes","dummy","dummy_remove","spoiler_text","spoiler","spoiler_org","spoiler_open","sText","open_rule","selector","rule","registry","userCSS_changed","uss","head","cpf","sheet","styles","styles_changed","cls","reload_required","indexing_old","oninput","search2","working","jsons","imgs","dir","merge_list_obj2_old","merge_list_obj2","name_prev","field","merge_lv_obj2_old","merge_lv_obj2","str2obj2_func_for_val","merge_lv_obj3","js_file","defineProperties","pn13_1","propagate","mirror","make_obj","fm_tmp","query_str","apply_prep_2","fms","target_hier","replaceChild","str2obj6","stgt","str2obj5","s2o","apply_prep_2_str","toUpperCase","site2_json_ex_remove","parseFloat","t2h_sel:L","t2h_sel:M","t2h_sel:N","t2h_sel:N_unread","t2h_sel:unread","posts_search_op:opaque","popup2:sr","popup2:srpv","popup2:pv","popup2:chart","popup2:dp","catalog_board_list_str_or","catalog_board_list_str_bt","catalog_board_list_str_bt_same","func_obj","func_obj2","set_event_target","add_onchange_entry_func","idx_l","name_0","name_1","prep_beforeunload","inst_while_input","set_val_beforeunload","tgt_wrapped","bg_str","boards_sel_from_tags","or","get_owners_recommendation","lines","bn","dm","exact","set_vals","vals_in","completion","keep","obj2_only","key3","tgt3","str_in","flag_g","fd","idx2","str2rstr","trim","merge_obj5_all","merge_obj5_1a","merge_obj5a_sc","obj_key","obj_hier","obj_init_hier","not_root","no_copy","obj_elim_the_same_1","Set","done_list","pref_test","site2_json_ex","str_tooltip","str_hier","show_0","tooltip_kind","e_obj","tooltip_on","tooltip_e","show_timer","show_exe2","tooltip","hide_timer","hide_exe2","root","catalog.filter.tag_list","network.cross_domain","liveTag.rm_list_str","TagExLists","liveTag.ex_list_str","GeneralRules","catalog.style_general_list_str","catalog.board.recommendation","thread_reader.buttons.B","thread_reader.buttons.UB","thread_reader.buttons.X","thread_reader.buttons.v","virtualBoard.scan_domains.*","style.fix.*","style.copy.*","#*","simple","backwash","recommend","easy2.presets","vb_kwd","easy2.limits","easy.virtualBoard_10_passive","easy.virtualBoard_10","easy.virtualBoard_1","easy.virtualBoard_8_50","easy.virtualBoard_8_all","easy.virtualBoard_interSite","easy.posts_0h","easy.posts_24h","easy.threads_24h","easy.embed_index","easy.embed_index_lazy","easy.light","easy.embed_index_infinite","easy.embed_index_backwash","easy.stat_activate","triage_simple_kill","triage_simple","triage_basic","triage_basic_color","triage_colorful","triage_borders","triage_samples","triage_test","pn_samples","make_popup","onclick_event","get_name","pn13","pos","innerWidth","pn13_0_2","onchange_funcs_formatted","files_store","apply_pn13_1","files","insert_menu","menu","htmls","show_hide_all_to_header","show_hide_all","str_show","str_hide","inner","imm_down","limit_webm","expand_thumbnail_hover","str_inner","posts_for_search","op_in_search_result","deleted_posts_detection","popup_others","radios","indent","r_str","middler","format_posts","updates","vb_domains","sites","features_domains","cb_block","html_common","tag_gen","SHOWALL","TOGGLE","HIDEALL","HIDE","dst_dom","tgt_dom","SHOW2","TOGGLE2","HIDE2","SHOW3","HIDE3","SHOW2_I","etp","SHOW4","HIDE4","SUB","virtualBoard.search.str","uip_tracker.on","healthIndicator.show","healthIndicator.expand_running","settings.indexing","pn13_1_warning_reload","pn13_1_warning","tag.scan","tag.same_tag_refresh","tag.generate_caller","tag.generate_callback","arg","tag.re_generate","uri","tag.gen","cbxes","str_name","tag.gen_add","tag.recommendation_add","tag.add_to_list","board_sel_refresh","str_changed","stats.use","stats.estimate_posts","stats.auto_acquisition","stats.auto_acquisition_all","catalog.board.board_tags","catalog.board.all_boards","JSON_query_boards","JSON_query","JSON_ex","JSON_ex_full","JSON_ex_filter","EVAL","pref_def","nodes","load_default_of_this_page","load_samples","triage.hide_toggle","catalog.footer.*w/","float.footer.*w/","thread_reader.use","catalog.appearance.titleBar.settings","catalog.appearance.titleBar.refresh","catalog.appearance.titleBar.num_of_pages","catalog.appearance.titleBar.boards_selector","catalog.appearance.titleBar.filter","catalog.click_area","style.sel","style.reset.*","style.userCSS.*","virtualBoard.p_board","update_boardlist","virtualBoard.p_remove","virtualBoard.max","virtualBoard.show","easy.virtualBoard_8_100","easy.virtualBoard_8_500","easy2.beginner","easy2.apply","force_reset","reload","virtualBoard.scanStart","virtualBoard.scanStop","abort","virtualBoard.search.show","tgt_name","bar","update_pn","virtualBoard.search.*","debug_site2","debug_site2func","debug_pfunc","debug_parse_funcs_entry","debug_pfunc_comp","debug_pfunc_all","debug_parse_funcs_all","ex_list_changed","liveTag.inherit_board_name","inherit_board_name_changed","liveTag.inherit_board_tags","inherit_board_tags_changed","page.mark_new_posts","recovery.comment","*.open_spoiler_text","*.scroll_lock","button_test","req_raw","*.posts_search_op","*.posts_search_op_opacity","style.post_editing","restore2","restore_entry","restore_button","restore","clear_files_button","doms","dom_new","pn_IDB_board_sel","pn_IDB_thread_sel","multiple","queryQuota","webkitTemporaryStorage","queryUsageAndQuota","showQuota","usage","queryList","showList","indexedDB","webkitGetDatabaseNames","onsuccess","results","IDB_selected_boards","selected","showThreadList_fromIDB","IDB.selected_threads","arg3","arg4","arg5","restore3","thread_json","prep_to_archive","prep_deleted_posts","consolidate_IDB_result","images","thumbs","file_obj","func_init","consolidate_IDB_result_sub","consolidate_IDB_sort_func","IDB.delete_board","deleteDatabase","IDB.delete_thread","IDB.delete_imgs","IDBKeyRange","bound","IDB.export_thread","file_id","flush","export_thread","props","props2","isPosts","Blob","suffix","add_blob","IDB.reset_time","clean_list","store_entry","kwd.*","test_mode.js_load","URL","createObjectURL","scr","*.merge","*.merge_list","*.merge_list_str","*.merge_lv","onchange_lv","*.merge_lv_str","tighten_loosed_limits","*w/.t2h_sel","*w/.t2h_num_of_posts","bind_myself","p1","p2","p3","p4","p5","overwrite_prop","fill","ary","NONE","ATTR","KILL","TIME","UNDO","GO","toggles","triage_style_replace_list","triage_button","triage_styles","onmousewheel","perf_out","performance","last_ts","debug_show_proto_func_pool","debug_show_proto","ex_keys","search_key","debug_parse_funcs","pool_0","start_point","proto_org","pool_1","same","debug_parse_funcs_parse","src_type","src_types","strs","idx_s","hier_str","root_str","types","srcs","objs","obj_root","shallow_copy_1","w","nh","fw","fh","kwds","escape","entities","<",">","&","\"","'","escape_text","arraybuffer2blob","mime_types","jpg","jpeg","gif","png","pdf","svg","svgz","htm","mpg","mpeg","mp4","ogv","mp3","gz","tgz","zip","7z","xz","autosage","board_name","url_prefix","url_prefix2","postform_rules","server_name","protocol","catalog_threads_in_page","remove_checkboxes","get_time_of_last_post","query_set_component","query_word","comp","config","keyword","reentry","url_site","url_board","decodeURI","owners_recommendation","root_body2","home","make_showAlways","icon","get_icon","add_icon","onoff","postform_prep","postform_submit2_observer","postform_submit2_find","setup2","catalog_root","getElementByTagName","now_height","recSearch_thread","ecT","getID","getCountry","getTrip","getName","an2srcNo","generate_boards_json","page_def","pages","url_boards_json","callback_always","dummy_indicator","boards_json","get_boards_json_callback","FINISHED","postprocess_board","update_pn_buf","o","postprocess_board_add_btag","boardlist_boards","show_boardlist_physical_board","func_onclick","show_boardlist_physical_extract_func","boardlist_hit","create_tag_node_1","boardlist_tags","boardlist_tags_pn","show_boardlist","sbl","tags_bl","bd_bl","prefix","all","absolute_link_1","link_dbtp2href_abs","dbtp","quote","link_dbtp2href","ls_key_own_posts","prep_own_posts_1","prep_own_posts","clean_up_LS_th","ls_key_deletedPosts","ls_key_comment","clean_up_deleted_posts_1","ls_key","ls_key_bd","add_name","to_me","regexp_anchor_txt_1","own_posts_cb","regexp_anchor_cb_txt_1","check_1","extracted_tags","extracted_posts","of_mine","reply_of_mine","anchors","regexp_anchor","regexp_anchor_len","regexp_anchor_cb","check_t1","com_or_txt","mail","pn_tags","str_rm_list","scan_regex","tag_ex_list","prep_check_1","regexp_anchor_txt","regexp_anchor_cb_txt","regexp_anchor_com","regexp_anchor_cb_com","prep_check_t1","check_t1_op","tag_init","time_check","watchtime_changed","omitted_posts","ur_old","generate_ur","watching","extract_tags","aggregate","get_post_offsetTop","get_favicon","none","get_title","time_revised_check","nof_ths","unmark","short_cut","post_json","unmark_post_from_event","removeAttribute","time_pn","thq_no","unmark_post","preprocess_html","doc_txt","check_thread_archived","get_board_tags","get_json_url_catalog","depend_on_site","catalog_native_prep_sel","pn_tb","selector_native","initUIEvent","selector_catchan","catalog_native_prep_swap_sortSel","sortSel","catalog_native_frame_prep","insert_remove_frame","ifrm","disgorge_children","pn_catalog","absorb_children","catalog_native_frame_prep_frame","ref_node","margin","contentWindow","catalog_embed_prep","border","thread2search_obj","up_timer_factory","over_0","over_1","up_func","up_pf","up_src","up_timer","timer_end","up_e","out","erT_done","out_1_if_exists","pn_ex","out_1","pop_down","pop_setup","pna","pop_over","div_mousedown","snatch","pop_load_req_delete","scroll","pop_out","clear_down_timer","narrow_x","narrow_y","factor_x","hist_x","factor_y","hist_y","ddEcW","ddEcH","adjust_pos","tb","lr","nickname_href2domain","pf_mode","popups_link_regex","up0","popupSurface","X","erT","Map","blacklist","post_highlight_if_visible","pop_up","pop_make","popups_post_entry","pop_load","keys_loading","pop_load_req","th_q","popups_href2th_q","getComputedStyle","sT","popups_posts_class_hlt","post_highlight_end","post_dotted_if_multi_anchors","an_dotted","ce","post_pn2ce","src_no","popups_href2dbtp","thqp","isOP","th_q0","popups_try_fetch_from_lth_ta","popups_post_fetch","popups_set_waiting","borderStyle","boxShadow","popups_post_pnode","popups_debug","preview","th_over","pf3","up_th","th_out","pop_up_th","on_th","pop_up_th_1","kwd_src","btn","pfX","popup_make","exact_match","leave","pnode","deactivate","from_native","posts_exist","post_no","popups_add_1","lth_q_ps","popups_release","cross","hrefs","skey","popups_add_backlink","dig","nof_flinks","bks","add_backlinks_bks_query","op_regexp","quotes","as_txt","popups_set","backlinks","blks","add_backlinks","bks_pn","add_backlinks_bks","add_backlinks_add_1","popups_backlink2dbtpth","add_backlinks_bks_append","dbtpth","remove_backlink","popups_remove_backlink","popups_remove_waiting","prep_quotes","qts","debug_len","initial_cond","getPrototypeOf","popups_fetched_1","popups_fetched_html","proto_obj","d_str","remove_if_no_backlinks","toplevel_anchor_pos","get_getters","site4","parse_funcs_on_demand_debug","parse_funcs_on_demand","key_table","pfunc_root","mimic_always","th_regexp","shortCatalog","shortThread","json","doc_obj","parse_obj","proto_options","parse_pn_dummy","finisher","catalog_json2html3_thumbnail","ths_array","ths_col","get_lth_from_node","pn_in","catalog_html","exlist","pn_id","pn_trip","exe_sub","exe_sub2","fname","tim","posts_array","pts","idx0","idx1","get0","posts_get0","get1","posts_get1","insert_footer4","html_org","replace_omitted_info","replace_omitted_info2","page_json","bumplimit","replies","has_nof_files","rip_from_archive","anchor","catalog_json_template","page_json_template","thread_json_template","post_json_template","html_template","parse_parts","add_op_img_url","posts_m","by_no","posts_ret","isShown","base","merge_th","func_hide_org","base_factory","base_proto","lazy","lazy_idx","draw_1_pos","get_class","lv","class_add_all","merge_class","class_remove_all","page_json2html3_skelton","update_posts_separate","shown","lazy_tgts","update_posts_merge_1","base_arr","with_hr","func_show_org","func_track_shown_org","post_count","shownSet","values","func_track_reset_org","th_domain_html","update_posts_insert","key_op","release_hook","et_name1","check_tgts","onfocus","onblur","et_name","first_no","th_old","info_old","get_omitted_info","info_new","set_omitted_info","editings","update_posts_remove_1","update_posts_add","update_posts_remove","ref_time","time_tu","pn_sep","exist","post_json2html_fname_server","post_json2html_fname","post_com2txt_finisher","pn_com","container","remove_by_classname","classname","remove_br","tagname","remove_by_attribute","attr_name","attr_val","remove_attribute","add_attribute_by_classname","add_attribute_by_tagname","add_attribute_by_attribute","attr_name2","attr_val2","move_up_and_delete_parent","g_parent","remove_last_hrs_and_brs","last_node","remove_brs","remove_double_br","outerHTML","remove_double_tags","change_utc_to_local","utc_str","parse_funcs_getters","resto","parse_funcs_no_cache","parse_funcs_one_time","trace","domain_url_image","getElementById","read_max","frame_menu","frame_main","preprocess_doc2","before_test","after_test","full_hier","mixs","pn_child","catalog_native_size","filenames","spans","postform_comment2","add_mouseover","op_containers","substring","firstElementChild","times","file_style","or_str","aggregate_info","op_idx","coms","subs","files_in_post","uids","nof_uids","unique_ips","node_ref","pctrls","catalog_native_size_changed","last_modified","omitted_images","before_test_post","pn_time","om_info","op_img_url2","url2","fsize","tn_w","tn_h","post_pn","txt2com_spoiler_replace_txt","update_posts_insert_pack","ref_pnode","post_container","update_posts_insert_unpack","update_posts_insert_pack_iter","prev","prev_prev","fchild","blk","backlink_onclick","highlightReply","bg_r","bg_g","bg_b","kwd_head","kwd_tail","capcode","country_name","toISOString","post_json2html_file","multifile","fsize_str","fname_server","furl","catalog_json2html3_src","turl","both","thumb_url","assign_pn","clone","omit_info","config_expander","nof_files_omitted","nof_posts_omitted","make_footer","catalog_from_json3","force_https","max_page_kc","main","navigation","/int/","/b/","/trv/","/m/","divs","time_offset","offsetParent","postdate","lt","time_pn_1","filename_server","balls","ball","ft","th_no","html_file","update_posts_insert_1","ref_pnode2","post_flag","catalog_json2html3_onload","catalog_posts_in_thread","trim_page","archive_patch_domain","post_containers","filethumbs","callback_sage","add_sage","lastPage","prep_own_posts_reg","clear_func","catalog_native_prep_clonenode","node","deep","arc","catalog_json2html3_size_changed","ts","a0","class_thread","class_thumbnail","pn_next","last_replies","i2pkey","bumps","end_no","sskey","latest_bump","skey0","recovered","tu","obsolete","span","tFlag","txt2com_anchor_class","archive_html","expander","summary","blk2","backlink_parent_prevSib","op_no","tn_f","file_html","md5","th_w","post_json2html_nameblock","since4pass","post_json2html_colorID","troll_country","rgb","charCodeAt","r","g","ids","pn_tb_new","th_url","th_class_tn","th_class","image","imgnm","subject","anchor_regex","anchor_func","dims","imgctr","time_node","check_func_whereami","catalog_native_prep_wait_loop_timeout","catalog_native_prep_wait_loop","observe_native_bg","loading_image","skip_initial_call","observer_tap","ctlg","thumbType","SHA1","fileType","prep_th_posts","posts_obj","no_in","page_base","shortCatalog_json_template","postCtr","bumpTime","imageCtr","auth","MD5","sha1","arrow","anchor_func_tgt","anchor_func_1","command2txt","c2t_count","anchor_class","spoiler_replace_txt","quote_replace_txt","commands","lth_init","prep_own_posts_IDB","prep_own_posts_IDB_callback","ALL","add_backlinks_pn","add_backlinks_hrefs","popups_post_fetch_callback","post_0","post_json2html_imagesearch_href","post_json2html_imagesearch_1","provider","src_x","post_json2html_imagesearch","pref_imgsearch","file_header_html","md","th_pn","shortCatalog_json","ths_json","pgn","dic","posts_pns","X_FRAME_OPTIONS","CONTENT_SECURITY_POLICY_FRAME","threads0","blotter","backgroundColor","CONTENT_SECURITY_POLICY_DATAURI","other_html","getMilliseconds","pn_fifo_factory","filled","pn_add","queue","pn_message","pn_hist","pn_makeThread","pn_prune","pn_errors","xhr_reqs","xhr_frees","a_update","post_func","xhr_events","xhr","myobj","str2_idx","action","all_data","setRequestHeader","data_out","encodeURIComponent","pruned","tgt_obj","SharedWorker","make_beep","wav_str","dl","header_add","big_endian","freq","vol","sin","Audio","make_audio","src_changed","audio","pause","favicon_set","favicon_next","favicon_current","sum","CountNR","count_all","title_set","title_current","title_org","Notification","get_permission","permission","requestPermission","dtns","dtns_queue","show_1","show_1_queued","show_1_queued_delayed","dtn","win_focus","close_1","tgt_th19_4","sound_flag","dt","cf_error","dispatch_if_idle","crawler_spawn","dispatch","req_from","reqs","xhrs_count","ERR_5xx","req_1","reload_reqs","url2tgt","domain_xhr","download_local","xhrs_free","download_remote","xhr_onload_1","reqs_waiting_finish","iframes","remote_opened","remote_reqs","remote_count","to_file","to_idb","sub_get","GM_XMLHttpRequestWrapper","xhr_onload","onabort","xhrs","xhr_timeout_start","TIMEOUT","xhrs_reqs","crawler_timeout","xhr_timeout_restart","xhr_timeout","readyState","responseURL","onreadystatechange","xhr_onreadystatechange","onprogress","loaded","end_proc_httpd","onload_local","end_proc_user","onload_archive","sub_ack","TAR_FLUSH","free_xhrs","download_url4","list_all_obj_downloading","ignore_domain","download_url3","onload_archive_fail","check_timestamp_and_flush","sub_tar_flush","sub_frame_init","pause_timeout","GM_xmlhttpRequest","onXXX","onXXX_factory","_onreadystatechange","dummy_func","_onprogress","SUB_GET","SUB_ACK","SUB_FREE","SUB_TAR_FLUSH","SUB_FRAME_INIT","reqs_in","req_add","isLocal","sender","sw_cache_write","callback_arg","tb_clicks","tb_funcs","opts","ev_to_close","tack_float","tack_dock","tb_mousedown2","prep_drag","tb_mousedown","bottom2top","right2left","div_resize_on_border","mouse_cursor_on_text","tlbr","div_mouseup_resize","div_mousemove_resize","resize_tlbr","dx","dy","div_dragstart_dynamic","div_mouseup","et_cn","range","Range","tx","selectNode","rects","getClientRects","rect","roll_if_auto","dynamic","dataTransfer","setData","effectAllowed","dropEffect","div_dragend_dynamic","div_dragend","div_dragover","wheelDelta","op_p","roll_toggle","from_start","auto_unroll","button_pressed","maximize_state","cns","toggleButton","op_m","tile","last_pn","pn_st","init2","rolldown_func","rollup_func","exit_func","maximize_func","site_settings","options_is_given","padding","ondblclick","onmousedown","background","tile_set_bottom","tile_set_left","child_of_body","pn_2","pn3","hour","getHours","min","getMinutes","getSeconds","make_destroy","func_make","func_destroy","onchange_func","query_auto_acquisition","make_opts","func_float","func_embed","tack_p","setting_obj","cnst_obj","make_button","sf","draft","pn_summary","pk","prep_domain","prep_board","btag","ref_tag","update_tags_in_th_sub","prep_thread","btags","tl","t0","t1","btag2","time_checked","posts_saved","inherit_board_tags_changed_1","retag","retag_db","retag_in_th_sub","tags_len","exclude_tags","tags0","tags1","exclude_tags_1","loop_tag","delete_tags","key_dirty","tags_array_old","tags_proto","mems_keys_obj","mems_keys","mems_keys_length","mems_keys_length_and_set_top","mems_boards","keys_fix","clean","k_ci","mems_map","me","tag_reserved","tags_reserved","tag_pk","tags_reserved_found_scan","tags_reserved_found","update_tags_in_th","src_new","src_old","check_update_tags_color","remove_tags_in_th","thread_removed","update_ur_1","update_tag_node","from_IDB","make_info","myDomain","boardlist_click_entry","cbx_changed","nth","cnr","all_case","mems_objs","count_ur","nof_th","counter","nof_bds","nums","no_scan","node_in_boardlist","backward","stOut","stNone","stIn","inv_in","inv_pk","inv_ex","cbx_emulate_inv","add_board","bds_pickup","update_pn_last_filter_active","sort_func","update_pn_disp_func","from_filter","cbx_onchange_entry","update_pn_1_lazy","update_pn_1","update_pn_pos","tags_array","dirty_count","dirty_count_deleted","exam_pn","historical_filter_active","docfrag","createDocumentFragment","pos_insert","pf_boards","key_ci","dirty","tag_obj","cbx_onchange","str_ary","obj_in","obj_pk","obj_ex","check_op","tags_op","extract_tags_trim_editing","flag_added","retag_editing","ex_tags_keep","t0len","tags_boardlist","force_redraw","sv_rexps","tag_bl","tobj","sep_txt","func_click","pn_old","tags_old","tags_old_org","debug_refs","debug_before","sep","sep2","tag2","ref2","IDBRequest_onerror","error","db_info","last_closed","IDBRequest_onblocked","oldVersion","newVersion","IDBTransaction_onabort","tr","IDBT_rereq","IDBTransaction_onerror","transaction","IDBRequest_onupgradeneeded","IDBRequest_onsuccess_open","from_upgrade","version","waiting_open","reqs_vc","reqs_rw","debug_reqs","debug_query","tr_count","pass","oss","tr_info","req_kinds","done","done_put","objectStoreNames","tr_inc","tr_set","IDBRequest_close","createObjectStore","req_end","num_downgraded","indicator_update","add_req","make_1","delete_th_1","loop_func","complete_func","reqs_current","get_all","put_1","delete_1","times_pruned","write","list_len_old","Meta","pruned_time","clean_up_end_proc","isEmpty","req_parent","reqs_re","reqs_re2rw","open_db","db_name","push_all","deleteObjectStore","func_prev","oncomplete","IDBT","random","codes","String","fromCharCode","apply","objectStore","put","store_json_func","IDBTransaction_oncomplete","clean_1_onsuccess","src_obj","put_to_IDB","time_prune","flush_and_prune","IDBR","openCursor","get_all_onsuccess","req_dictionary","clear_wdg_get_db","ArrayBuffer","continue","IDB_close","case_of_test_mode78","req_obj","sub_callbacks","ver","from_watchdog","onupgradeneeded","onblocked","os_name","indicator_req_count","indicator_parent","spawn","ReqFifo","get_status","nof_crawlers","sums","length_whole","reduce","allow_multi","init_val","ary_ro","cl","cl_idx","ref_no","req_old","req_cl","whole_array","indicator_report","inactivated","db_name_key","dbtk","store_posts","content","set_timestamp","blob","download_url","revokeObjectURL","a_link","month","proto_archive","download_url2","img_dl","url_funcs_wrap","url2file","th_obj","url_funcs_wrapped","archive_no","from_check_op","list_all","list_all_obj","tgt_tmp","bug_patch_for_meguca_editing_timeout","time_now","load_list","ls_key_archive","save_list","make_header","Uint8Array","encode_filename","set_header","byteLength","checksum","numstr","tars","tarfile","ignore_limit","tfile","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","flush_req","sanitize","wlist","A","SPAN","DIV","BLOCKQUOTE","BR","WBR","U","S","STRIKE","B","I","BIG","SMALL","TT","SUP","EM","STRONG","string","list_all_obj_bd","check_archived_time","val_inherited","update_archived_time","downloaded_files","restore_posts_from_IDB","deletedPosts","check_deleted_posts","suffix_dbt","editing_finished","ta_posts","pf_d","fill_IDB","thp","othp","post_deleted","othpd","posts_offline","alert","deleted_before","posts_wrapped","storage","store_deleted_posts_to_IDB","live_active","oneshot_active","posts_all","store_rescan","posts_src","name_deleted","fileReader","FileReader","readAsText","th_deleted","key_old","com_changed","delayed_check","check_com","com_new","delayed_save","save_at_exit","rec_inst","rec_inst2","get_key","get_highest_priority","key_pre","scanner","Scanner","scanners","force_thread","get_th","scan_threads_delayed_do","priority_th","get_list_thread","req_th","get_list_thread2","get_list_board","get_list_board2","add_domain","use_boards_json","upper_bits","scan_boards_enumerate","thread_or_domain","func_entry","func_scan","func_cont","aborted","priority_next","key_next","ScannerUI","scan_refresh_ex_list","list_domains","scan_refresh_1","update_thread","tree_404","sr","update_board_rm","thread_created","instances","tgts_obj2","check_and_add_thread","ldb","setup_board_no","time_unit_arr","update_posts_no_1","update_posts_rm_1_func","srt","update_posts_no_time","ldbst","idx_over","time_base","shift_add","update_posts_no_1_func","update_posts_no_1_func_min","update_posts_no","lths","get_ac_key","auto_acquisition_beforeunload","auto_acquisition_keys","auto_acquisition_init","label_funcs","day","sunday","quarter_year","time_root","wdg_tick","prep_time","StatsFromNo","save_all_unsubscribe","merge_1_hier","lower","ceil","merge_1_hier_1","idx_d","from_destructor","chart_bak","data_lower","prep_thread_unsubscribe","prep_board_unsubscribe","Zcompress","Zdecompress","get_ls_key","data_save","prep_board_check_valid","time_last","array_init","skip_init","prep_thread_subscribe","StatsRm","tz_offset","label_init","lfunc","distance","tree","func_t","prep_1","ld","prep_thread_init","ldbt","check_only","rm_tmp","prep_board_init","from_thread","update_thread_1","StatsRm_prototype","prep_board_init_1","ldbs","offset","StatsFromNo_prototype","prep_board_subscribe","new_vals","data_last","idx_last2","idx_in","pn_debug","prep_sw","blobURL","key_ls","worker","unsafeWindow","sw_out","sw_tryget","sw_alive","tryget_ids","callbacks","trygetItem","tryget_timeout","func_invoke","key_a","schedule_post","cd_id","cd_id_s","sel_id","time_val","time_at_post","setHours","countdown_m","cd_txt","set_background_and_button_value","time_till_post","countdown_post","round","countdown_s","cd_s","autobumper","bg_back","timer_deadtime","posts_itt"],"mappings":"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","file":"CatChan.user.js","sourcesContent":["// ==UserScript==\r\n// @name CatChan\r\n// @version 2019.06.30.0\r\n// @description Cross domain catalog for imageboards\r\n// @include http*://*krautchan.net/*\r\n// @include http*://boards.4chan.org/*\r\n// @include http*://boards.4channel.org/*\r\n// @include http*://i.4cdn.org/*\r\n// @include http*://8chan.co/*\r\n// @include http*://8ch.net/*\r\n// @include http*://lainchan.org/*\r\n// @include http*://lainchan.jp/*\r\n// @include http*://*meguca.org/*\r\n// @include http://localhost/*\r\n// @require https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.1-beta.4/Chart.min.js\r\n// @updateURL https://raw.github.com/Dogman8/CatChan/master/CatChan.meta.js\r\n// @grant unsafeWindow\r\n// @grant GM_xmlhttpRequest\r\n// ==/UserScript==\r\n//\r\n//    Copyright 2014 DogMan8\r\n//\r\n//    This program is free software: you can redistribute it and/or modify\r\n//    it under the terms of the GNU Affero General Public License as published by\r\n//    the Free Software Foundation, version 3 of the License.\r\n//\r\n//    This program is distributed in the hope that it will be useful,\r\n//    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n//    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n//    GNU Affero General Public License for more details.\r\n//\r\n//    You should have received a copy of the GNU Affero General Public License\r\n//    along with this program.  If not, see <http://www.gnu.org/licenses/>.\r\n//\r\n\r\n\r\n(function (){\r\n//  if (window.top != window.self) return; //don't run on frames or iframes\r\n//if (window.top != window.self && window.name!='KC' && window.name!='4chan' && window.name!='8chan') return; //don't run on frames or iframes\r\nif (window.top != window.self && window.name==='') return; //don't run on frames or iframes\r\nif (window.name==='post_tgt' && window.location.href.indexOf('localhost')!=-1) return;\r\n\r\n\r\n\r\n\r\n//  http://stackoverflow.com/questions/9791489/greasemonkey-require-does-not-work-in-chrome\r\n//  http://stackoverflow.com/questions/2246901/how-can-i-use-jquery-in-greasemonkey-scripts-in-google-chrome\r\n//  http://stackoverflow.com/questions/17341122/link-and-execute-external-javascript-file-hosted-on-github\r\n\r\n  var brwsr = {\r\n    ff: (navigator.userAgent.indexOf(\"Firefox\") != -1),\r\n    sw_cache: true,\r\n    JSON_parse: function(val){ // patch for Tampermonkey.\r\n                       var retval = JSON.parse(val);\r\n//                       if (GM_setValue)\r\n//                       if (typeof(retval)==='object')\r\n//                       for (var i in retval) if (typeof(retval[i])==='string' && retval[i].startsWith('[') && retval[i].endsWith(']')) retval[i] = brwsr.JSON_parse(retval[i]);}\r\n                       for (var i in retval) if (typeof(retval[i])==='string' && retval[i].search(/^\\[.*\\]$/)!=-1) retval[i] = brwsr.JSON_parse(retval[i]);\r\n                       return retval;\r\n                     },\r\n  };\r\n  brwsr.innerText  = (!brwsr.ff)? 'innerText' : 'textContent';\r\n  brwsr.Date_parse = (!brwsr.ff)? Date.parse : function(str){\r\n    var time = Date.parse(str);\r\n    if (isNaN(time)) {\r\n      var idx = str.lastIndexOf('.');\r\n      time = Date.parse(str.substr(0,idx)) + parseInt(str.substr(idx+1,3));\r\n    }\r\n    return time;\r\n  };\r\n//  brwsr.Date_parse = (!brwsr.ff)? Date.parse : function(str){return Date.parse(str.replace(/ /,'T'));};\r\n  brwsr.document_body = (!brwsr.ff)? document.body : document.documentElement;\r\n  brwsr.mousewheel = (!brwsr.ff)? 'mousewheel' : 'DOMMouseScroll';\r\n\r\n  var DelayBuffer = function(tgt, delay){\r\n    this.tgt = tgt;\r\n    this.delay = delay;\r\n    this.id = null;\r\n    this.do_tgt = this.do_tgt.bind(this);\r\n  };\r\n  DelayBuffer.prototype = {\r\n//    constructor: DelayBuffer,\r\n    do_tgt: function(){this.id = null; this.tgt();}, \r\n    delayed_do: function(delay){\r\n      if (this.id===null) {\r\n        if (delay===undefined) delay = this.delay;\r\n        this.id = setTimeout(this.do_tgt,\r\n                             (typeof(delay)==='number')? delay : (this.hasFocus)? delay.fg : delay.bg);\r\n      }\r\n    },\r\n    cancel: function(){if (this.id!==null) {clearTimeout(this.id);this.id=null;}},\r\n    get_binded_delayed_do: function(){return this.delayed_do.bind(this);},\r\n    hasFocus: true\r\n  };\r\n \r\n  var Watchdog = function(tgt, delay){\r\n    DelayBuffer.call(this, tgt, delay);\r\n  };\r\n  Watchdog.prototype = {\r\n//    constructor: Watchdog,\r\n    start: function(delay){this.delayed_do(delay);},\r\n    stop: function(){this.cancel();},\r\n    restart: function(delay){this.cancel();this.delayed_do(delay);},\r\n    __proto__: DelayBuffer.prototype\r\n  };\r\n\r\n////  var MutexWatchdog = function(name){ // watchdog for 8chan's unstability. // working code, @safe1069\r\n////    this.mutex = true;\r\n////    this.req = false;\r\n////    this.name = name;\r\n////    this.abort_req = false;\r\n////    this.wdg = new Watchdog(this.fire.bind(this), 30000);\r\n//////    this.wdg = new DelayBuffer(function(){ // working code.\r\n//////      this.mutex = true;\r\n//////      if (pref.debug_mode['7']) console.log('watchdog: '+this.name);}.bind(this), 30000);\r\n////  }\r\n////  MutexWatchdog.prototype = {\r\n////    get: function(){\r\n////      if (this.mutex && !this.abort_req) {\r\n////        this.mutex = false;\r\n////        this.wdg.start();\r\n////        if (pref.debug_mode['5']) console.log('mutex: get: '+this.name);\r\n////        this.req = false;\r\n////        return true;\r\n////      } else {\r\n////        if (!this.abort_req) this.req = true;\r\n////        if (pref.debug_mode['5']) console.log('mutex: fail: '+this.name);\r\n////        this.abort_req = false;\r\n////        return false;\r\n////      }\r\n////    },\r\n////    restart: function(delay){\r\n////      this.wdg.restart(delay);\r\n////    },\r\n////    stop: function(){\r\n////      this.wdg.stop();\r\n////      this.mutex = true;\r\n////      if (pref.debug_mode['5']) console.log('mutex: release: '+this.name);\r\n////    },\r\n////    fire: function(){\r\n////      this.mutex = true;\r\n////      cataLog.scan_boards.scan_abort(this.name);\r\n////      if (pref.debug_mode['7']) console.log('watchdog: '+this.name);\r\n////    },\r\n////    abort: function(){\r\n////      this.abort_req = true;\r\n////      this.stop();\r\n////    },\r\n////    query_req: function(){\r\n////      return this.req;\r\n////    }\r\n////  }\r\n\r\n  var common_func = {\r\n    Object_modifyDescriptor: function(obj,prop,desc){\r\n      desc.__proto__ = Object.getOwnPropertyDescriptor(obj,prop);\r\n      Object.defineProperty(obj,prop,desc);\r\n    },\r\n    Object_defProps: function(dst,src){\r\n      for (var i in src) dst[i] = src[i];\r\n    },\r\n  };\r\n\r\n  var site0 = (function(){ // for less memory consumption and faster execution if background\r\n    var href = window.location.href;\r\n    var domain = null;\r\n    var pref_default = null;\r\n    var pref_default2 = null;\r\n    var href = window.location.href;\r\n    if (href.indexOf('/meguca.org/')!=-1) {\r\n      domain = 'meguca';\r\n      pref_default = {\r\n        pref2:{ meguca:{utilize_boards_json:false, utilize_boards_json_domain:false}},\r\n      // overwritten by easy2 default.\r\n        thread:{ env:{ disp_offset:3}},\r\n        scan:{max:100},\r\n        proto:{env:{event_dynamic:true,}},\r\n        style:{zIndex:300},\r\n        tooltips:{zIndex:302},\r\n      };\r\n      pref_default2 = true;\r\n    } else if (href.search(/(4chan(nel)*|4cdn).org/)!=-1) {\r\n      domain = '4chan';\r\n      pref_default = {\r\n        catalog_expand_with_hr: true,\r\n        page:{env:{disp_filler:'<hr>'}},\r\n        patch: {delayed_invoke: {use: brwsr.ff}},\r\n        catalog: {t2h_sel:'N', thumbnail:{hover:{popup_zIndex:100001}}},\r\n        proto:{\r\n          footer:{rOP:false, iOP:false},\r\n          env:{event_dynamic: true}\r\n        },\r\n        easy2:{limits:2},\r\n      };\r\n    } else if (href.indexOf('lainchan.org')!==-1) {\r\n      domain = 'lain';\r\n      pref_default = {\r\n        page:{ env:{ disp_offset:1}},\r\n        catalog:{image_hover:true, board:{all_boards:true}, env:{disp_offset:1, disp_filler:'                                        '}},\r\n        proto:{ env:{ localtime_native:false,\r\n                      colorID_native: false}},\r\n        stats:{ time_unit:3, patch_tm:true},\r\n        chart: {inst:{show: {p:true}, time_sel:3}},\r\n        easy2:{limits:1},\r\n        thread_reader:{own_posts_tracker:true},\r\n      };\r\n    } else if (href.indexOf('lainchan.jp')!=-1) {\r\n      domain = 'lainjp';\r\n      pref_default = {\r\n        page:{ env:{ disp_offset:1}},\r\n        proto:{ env:{ localtime_native:false,\r\n                      colorID_native: false}},\r\n        stats:{ time_unit:3, patch_tm:true},\r\n        chart: {inst:{show: {p:true}, time_sel:3}},\r\n      // overwritten by easy2 default.\r\n        catalog:{image_hover:true, board:{all_boards:true}, env:{disp_offset:1, disp_filler:' '},},\r\n        thread: {auto_update:true},\r\n        thread_reader:{own_posts_tracker:true},\r\n        scan:{max:100},\r\n        liveTag:{style:{urtm:'color:lime !important;font-weight:bold !important',\r\n                        ur:'color:limegreen !important;font-weight:bold !important',\r\n                        in:'color:red !important'}},\r\n        virtualBoard:{scanDelay:1},\r\n        easy2:{limits:1},\r\n        style:{post_new:'border:2px solid red !important'},\r\n      };\r\n      pref_default2 = true;\r\n    } else if (href.search(/8chan.co|8ch.net/)!=-1) {\r\n      domain = '8chan';\r\n      pref_default = {\r\n        catalog_expand_with_hr: true,\r\n        page:{ env:{ disp_offset:1, disp_filler:'<hr>'}}};\r\n    } else if (href.search(/krautchan.net/)!=-1) {\r\n      domain = 'KC';\r\n      pref_default = {\r\n        thread_reader:{own_posts_tracker:true, check_num_of_children: false},\r\n        proto:{\r\n          env:{\r\n            popup_native:false,\r\n            expand_thumbnail_inline_native:false,\r\n            image_hover_native:false,\r\n            colorID_native:false,\r\n            backlink_native:false,\r\n            localtime_native:false,\r\n            auto_update_native:false,\r\n          },\r\n        },\r\n        page:{use_expander_always:true},\r\n      };\r\n    }\r\n    var domains = ['meguca', '4chan', 'lain', 'lainjp', '8chan', 'KC'];\r\n    if (domain) domains.unshift(domains.splice(domains.indexOf(domain),1)[0]);\r\n    var domains_all = ['CatChan_tgt','8chan','8chan_live','vichan','KC','4chan_i','4chan','meguca','imeguca','lain','lainjp'];\r\n    if (pref_default2) {\r\n      pref_default2 = {// new default patch\r\n        catalog:{auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true},\r\n        liveTag: {use:false, from:'op'},\r\n        virtualBoard:{max:100, scan:true, scan_domains:{}}, \r\n        network:{fetch_actively:false},\r\n        easy2:{presets:1,VB:{local:1},catalog:{auto_update:false},page:{auto_update:false}},\r\n      };\r\n      pref_default2.virtualBoard.scan_domains[domain] = 'board';\r\n    }\r\n    return {\r\n      domain: domain,\r\n      domains: domains,\r\n      pref_default: pref_default,\r\n      pref_default2: pref_default2,\r\n      domains_obj: function(val, protect){\r\n        var obj={};\r\n        for (var i=0;i<domains.length;i++) obj[domains[i]] = val;\r\n        if (protect) common_func.Object_modifyDescriptor(obj,domain,{writable:false});\r\n        return obj;\r\n      },\r\n      isStep: window.opener && domains_all.indexOf(window.name)!=-1,\r\n    };\r\n  })();\r\n\r\n  var pref4 = { // dynamic, but not auto sync objects.\r\n    funcs:{\r\n      set_options_to_selector: function(sel,options){\r\n        sel.length = options.length;\r\n        for (var i=0;i<options.length;i++) sel.options[i].text = options[i];\r\n      },\r\n    },\r\n    archive: {\r\n      IDB_board_sel_gfunc_pre:function(p,k,v,n,f){\r\n        pref4.funcs.set_options_to_selector(f,pref4.archive.IDB_board_sel_options || ['Wait...']);\r\n      },\r\n      IDB_board_sel_options: null,\r\n      IDB_thread_sel_gfunc_pre:function(p,k,v,n,f){\r\n        pref4.funcs.set_options_to_selector(f,pref4.archive.IDB_thread_sel_options || ['Wait...']);\r\n      },\r\n      IDB_thread_sel_options: null,\r\n    },\r\n    refresh:{ count:0},\r\n    search_posts_active_once: false,\r\n    scan: {\r\n      get loosen(){return pref4.search_posts_active_once && pref.proto.searchAc.loosen;},\r\n      get max(){return site.whreami==='archive'? pref.scan.max_archive : this.loosen? pref.proto.searchAc.max : pref.scan.max;},\r\n      get max_threads(){return site.whreami==='archive'? pref.scan.max_archive : this.loosen? pref.proto.searchAc.max_threads : pref.scan.max_threads;},\r\n      get max_threads_at_refresh(){return this.loosen? pref.proto.searchAc.max_threads_at_refresh : pref.catalog.max_threads_at_refresh;},\r\n    }\r\n  };\r\n  \r\n  function pref_default(for_save) {\r\n    var proto = {\r\n      image_hover:false,\r\n      image_prefetch:false,\r\n      click: 'none',\r\n      click_area: 'thumbnail',\r\n      format: {show:  {style:  true, contents:  true, layout:  true, posts: false, fileinfo: false, images_2nd: true},\r\n               hover: {style:  true, contents: false, layout: false, posts:  true, fileinfo:  true, images_2nd: true},\r\n               search:{style: false, contents: false, layout: false, posts:  true, fileinfo:  true, images_2nd: true},\r\n               thumb: {resize: false},\r\n      },\r\n      footer: {use:true, nrtm:true, nr:true, rp:true, im:true, domain:false, board:true, no:false, flag:false, tag:true, page:true, design:'native', rOP:true, iOP:true,\r\n               custom: '(ar )(nm/)(nr/)(lp/)(rp)(*sp)(+dp)(/im)(/pg) (ni/nf) (ct )(cT )(bt )(bT )(pt )(pT )(pr )(dn)(bd)(no) ',\r\n               custom2: '(ar )(nm/)(nr/)(lp/)(rp)(*sp)(+dp)(/im)(/pg) (ni/nf) (ct )(cT )(bt )(bT )(pt )(pT )(pr )(dn)(bd)(no) ',\r\n               ctime:false, btime:false, ptime:false, rctime:false, rbtime:false, rptime:false, br:true, prate:false, archived:true, nd:false, nl:false, nf:false, nid:false, ns:false},\r\n      footer_br: true,\r\n      draw_on_demand: true,\r\n      load_on_demand: false,\r\n      t2h_sel: 'page',\r\n      t2h_L: 100,\r\n      t2h_M: 50,\r\n      get t2h_N(){return this.t2h_num_of_posts},\r\n      t2h_num_of_posts : 5,\r\n      save_board_list_sel: false,\r\n      board_list_sel: 0,\r\n      mark_new_posts: true,\r\n      auto_update : false,\r\n      auto_update_period : 10,\r\n      auto_update_countdown : true,\r\n      storePosts:'auto', sourceOfSP:'auto', searchAs:true, searchAsA:false, searchAc:{loosen:true, max:1000, max_threads:10000, max_threads_at_refresh:10000},\r\n\r\n      popup:true, colorID:true, backlink:true, popup_truncated:true, popup_zIndex:100, backlink_all:false, backlink_all_cross:false,\r\n      popup_hlt:true, bl_ec:false, bl_rm:true,  // popup_highlight, backlink_explicit_cross, baclink_remove_if_OP\r\n      popup_delay:50, popdown_delay:500, popdown:'delay', popup_mMove:true,\r\n      link_show_op:true, link_show_cross:true,\r\n      expand_thumbnail_inline:true, localtime:true,\r\n      expand_thumbnail_inline_all_after:false,\r\n      expand_thumbnail_initial:false,\r\n      hide_posts_without_images:false,\r\n      thumbnail:{\r\n        inline:{limit_width: true, limit_height:false, margin_width: 40, margin_height: 0, webm: true, webm_mute:false, webm_loop:false, ondemand:true, ref_height:400},\r\n        hover: {limit_width: true, limit_height: true, margin_width: 40, margin_height: 0, webm:false, webm_mute: true, webm_loop:false,\r\n                popup_delay:50, popdown_delay:500, popdown:'delay', popup_mMove:true, popup_zIndex:101,\r\n                dragfloat:true, df_dblC:true, df_mW:true, df_cV:true, zoom:false},\r\n      },\r\n      popupX: {popup_delay:500, popdown_delay:500, popdown:'delay', popup_mMove:true, popup_zIndex:101, use:false, ID:true, flag:true, name:false, anon:false, trip:false},\r\n//      popupID: {popup_delay:500, popdown_delay:500, popdown:'delay', popup_mMove:true, popup_zIndex:101},\r\n//      popupFlag: {popup_delay:500, popdown_delay:500, popdown:'delay', popup_mMove:true, popup_zIndex:101},\r\n//      popupName: {popup_delay:500, popdown_delay:500, popdown:'delay', popup_mMove:true, popup_zIndex:101, anon:false},\r\n//      popupTrip: {popup_delay:500, popdown_delay:500, popdown:'delay', popup_mMove:true, popup_zIndex:101},\r\n      open_spoiler_text: false,\r\n      open_spoiler_image: false,\r\n      merge: false, merge_list: false, merge_list_str: '', merge_list_obj6: null, merge_first: true,\r\n      merge_lv:true, merge_lv_str:'', merge_lv_obj6:null,\r\n      lazyDraw: {merge: true, merge_step: 256, step: 16},\r\n      scroll_lock: false,\r\n      use_expander_always: false,\r\n      popup2:'sr',\r\n      popup2_sel:'auto', popup2_sel_tolerance:10, popup2_resize:false, popup2_resize_bw:8, popup2_resize_cw:20,\r\n      popup3: {ww:'no', wn:'no', nw:'no', nn:'no', popup_delay:300, popdown_delay:500, popdown:'delay', popup_mMove:true, popup_zIndex:100},\r\n      posts_search_op: 'opaque',\r\n      posts_search_op_opacity: 40,\r\n      deleted_posts: {detect:'acc', store:'LS', merge:true, auto_clean:true},\r\n      detect_sage: false,\r\n      page_his: false,\r\n//      auto_config_posts_search: true,\r\n      promiscuous: false,\r\n      imagesearch: {\r\n        use: true,\r\n        google: true,\r\n        iqdb: true,\r\n        saucenao: true,\r\n        whatAnime: true,\r\n        desustorage: true,\r\n        exhentai: true,\r\n      },\r\n\r\n      env: {\r\n        disp_offset:0,\r\n        disp_filler:'',\r\n        popup_native:true,\r\n        expand_thumbnail_inline_native:true,\r\n        image_hover_native:false,\r\n        colorID_native:true,\r\n        backlink_native:true,\r\n        localtime_native:true,\r\n        auto_update_native:false,\r\n        event_dynamic:false,\r\n        popup_native_kill:true,\r\n        refresh_initial:true,\r\n      },\r\n    };\r\n    var pref_new = {\r\n      script_prefix: 'CatChan',\r\n      features: {\r\n        page: true, graph: true, setting: true, setting2: true, postform: true, catalog: true, listener : true, uip_tracker: true, thread_reader: true, debug: false,\r\n        notify:{desktop:true, sound:true, favicon:true},\r\n        recovery: true,\r\n        domains: site0.domains_obj(true, true),\r\n      },\r\n      max_capture: 576,\r\n      interval_found: 10,\r\n      write_to_ls: true,\r\n      aggregator: 'true', // radiobutton\r\n      server: true,\r\n      load_pref: true,\r\n      load_data: true,\r\n      check_page: false,\r\n      check_post: false,\r\n      check_thread: false,\r\n      import_format: 'obj', // radiobutton\r\n      max_graph: 576, // radiobutton\r\n      scale_thread: 10,\r\n      auto_start: true,\r\n//      workaround_for_dollchan: false,\r\n      prevent_redirection: false,\r\n      graph_animation: false,\r\n      autoconf: 'auto',\r\n      info_server: false,\r\n      info_client: false,\r\n      wafd_tb: 'tb',\r\n      wafd_open_spoiler: false,\r\n      show_page_fraction : true,\r\n      catalog_max_page: 5,\r\n      catalog_max_page_auto: true,\r\n      catalog_max_page_select: 'auto',\r\n      catalog_snoop_refresh: true,\r\n      catalog_auto_rollup_when_moving: true,\r\n      catalog_size_width: 240,\r\n      catalog_size_height: 350,\r\n      catalog_size_text_width: 400,\r\n      catalog_size_text_height: 16,\r\n      catalog_size_tn1_width: 240,\r\n      catalog_size_tn1_height: 240,\r\n      catalog_size_tn2_width: 80,\r\n      catalog_size_tn2_height: 80,\r\n      catalog_size_frame0_width: 30,\r\n      catalog_size_frame1_width: 69,\r\n//      catalog_enable_cross_board: true,\r\n//      catalog_enable_cross_domain: true,\r\n      catalog_load_on_demand_timeout: 10,\r\n      catalog_2nd_images_show: false,\r\n      catalog_2nd_images_hover: true,\r\n      catalog_2nd_images_search: true,\r\n      catalog_posts_on_demand: true,\r\n      catalog_refresh_clear: true,\r\n//      catalog_checkbox_deletion_show: false,\r\n//      catalog_checkbox_deletion_hover: true,\r\n//      catalog_checkbox_deletion_search: true,\r\n//      catalog_popup: true,\r\n      catalog_popdown: 'delay',\r\n      catalog_popup_delay: 300,\r\n      catalog_popdown_delay: 500,\r\n      catalog_popup_size_fix: true,\r\n      catalog_open_last50: 'exist_watch',\r\n      catalog_board_list_str: '//sample of board group\\n' +\r\n//        '//board_name[,nickname+board_name[+thread No.] | \\'*\\'+up to X page | \\'^\\'+style]...\\n'+\r\n        '//board_name[,nickname+board_name[+thread No.][\\'*\\'+up to X page]]..., [#Tag|##Tag]..., [!stats]\\n'+\r\n        'Global/int/,8chan/int/,KC/int/,4chan/int/\\n'+\r\n        'Global/b/,8chan/b/,KC/b/,4chan/b/\\n'+\r\n        'v+gg,8chan/v/,8chan/gamergatehq/,4chan/v/\\n'+\r\n        'Inter/pol/,8chan/pol/,4chan/pol/\\n'+\r\n        'JapanShoppingMall,8chan/jpck/,8chan/japan2/\\n'+\r\n        'tech,meguca/g/,lain/tech/,8chan/tech/,4chan/g/,KC/t/\\n',\r\n//        'ScriptHome,8chan/scriptcdc/,KC/jp/35003\\n',\r\n//        'script_home,8chan/scriptcdc/,KC/jp/35003,KC/kc/41434\\n',\r\n      catalog_board_list_obj: [],\r\n      catalog_promiscuous: false,\r\n//      catalog_board_list_sel: 0,\r\n      get catalog_board_list_sel() {return (cataLog && cataLog.embed_mode && this[cataLog.embed_mode])? this[cataLog.embed_mode].board_list_sel : 0;},\r\n      set catalog_board_list_sel(val) {if (cataLog && cataLog.embed_mode && this[cataLog.embed_mode]) this[cataLog.embed_mode].board_list_sel = val;},\r\n//      catalog_sw_domain: 'https://8chan.co',\r\n      localtime_offset : -(new Date().getTimezoneOffset()/60),\r\n//      catalog_localtime : true,\r\n//      catalog_border_show : false,\r\n//      catalog_border : '1px solid',\r\n//      catalog_enable_background : false,\r\n      catalog_footer_ignore_my_own_posts : true,\r\n      catalog_footer_tag_letters : 3,\r\n      catalog_no_popup_at_expanded : true,\r\n      catalog_open_in_new_tab : true,\r\n      catalog_open_where : 'named',\r\n      catalog_open_where_click : true,\r\n//      catalog_use_named_window : true,\r\n      catalog_triage : true,\r\n      catalog_triage_place : 'topLeft',\r\n      catalog_triage_hist : 16,\r\n      triage:{ show_always:false, popdown_delay:2000, hide_toggle:true},\r\n//      catalog_triage_str : '[\"background:#e5ecf9\",\"background:#c3dcf9\",\"background:#b8efc2\",'+\r\n//        '\"background:#efedbe\",\"background:#fbd5fb\",\"background:#fac2c5\"]// defalut\\n' +\r\n//        '//[\"background:#e5ecf9;border:none\",\"background:#c3dcf9;border:1px solid #a3bcd9\",'+\r\n//        '\"background:#b8efc2;border:1px solid #98cfa2\",\"background:#efedbe;border:1px solid #cfcd9e\",' +\r\n//        '\"background:#fbd5fb;border:1px solid #ebb5db\",\"background:#fac2c5;border:1px solid #daa2a5\"]// backgroud+border',\r\n      catalog_triage_str: 'KILL,X,,TIME,v,,WATCH,W,,UNWATCH,UW,,UNDO,U,',\r\n//      catalog_triage_str : '//default\\n'+\r\n//        'KILL,X,,KILL,X,background:#c3dcf9,KILL,X,background:#b8efc2,'+\r\n//        'KILL,X,background:#efedbe,KILL,X,background:#fbd5fb,KILL,X,background:#fac2c5\\n'+\r\n//        'TIME,v,,TIME,v,background:#c3dcf9,TIME,v,background:#b8efc2,'+\r\n//        'TIME,v,background:#efedbe,TIME,v,background:#fbd5fb,TIME,v,background:#fac2c5\\n'+\r\n//        'NONE,O,,NONE,O,background:#c3dcf9,NONE,O,background:#b8efc2,'+\r\n//        'NONE,O,background:#efedbe,NONE,O,background:#fbd5fb,NONE,O,background:#fac2c5\\n'+\r\n//        'UNDO,U,,WATCH,Watch,,UNWATCH,UnWatch,\\n'+\r\n//        '// sample\\n'+\r\n//        '//KILL,back_to_default,,NONE,border,background:#c3dcf9;border:3px solid blue,NONE,transparent,background:,NONE,shrink,width:100px;height:100px\\n'+\r\n//        '//\\n'+\r\n//        '// 1st column :\\n'+\r\n//        '//   KILL : delete forever.\\n'+\r\n//        '//   TIME : delete until the thread gets new replies.\\n'+\r\n//        '//   NONE : just change its appearance.\\n'+\r\n//        '// 2nd column : strings in the button.\\n'+\r\n//        '// 3rd column : style in HTML.\\n'+\r\n//        '// Repeat these as you wish.\\n',\r\n//        'KILL,'\\u2715',,TIME,'\\u2713',,NONE,'O',\r\n//      catalog_auto_update : false,\r\n//      catalog_auto_update_period : 10,\r\n      catalog_auto_update_countdown : true,\r\n//      catalog_show_setting : false,\r\n//      catalog_expand_at_initial : false,\r\n//      catalog_expand_at_initial_embed : true,\r\n      catalog_expand_with_hr : false,\r\n      overwrite_site2_json_str:\r\n        '//{\"site2\":{\"KC\":{\"time_offset\":2}}} // summer time for KC.\\n'+\r\n        '//{\"site2\":{\"4chan\":{\"protocol\":\"https:\"}}} // use https to 4chan.\\n'+\r\n        '//{\"pref\":{\"patch\":{\"rm_404_blacklist\":[\"8chan\"]}}} // 8chan sends corrupted data.\\n',\r\n      overwrite_site2_eval_str: '',\r\n//      show_tooltip : true,\r\n      tooltips: {help: {show: true, popup_delay:2000, popdown_delay:1000},\r\n                 info: {show: true, popup_delay:300,  popdown_delay:500},\r\n                 zIndex:100},\r\n      catalog: {\r\n        indexing: 0,\r\n//        max_threads : 512,\r\n        max_threads_at_refresh : 500,\r\n        filter: {\r\n//          show : false,\r\n          kwd : {use:false, str:'', re:false, ci:true, match:0, sentence:false, op:true, post:false,\r\n                 sub:true, name:true, trip:false, com:true, file:false, meta:false, flag:false, id:false,    rexps:null},\r\n          tag      : false,\r\n//          tag_list_str : '',\r\n//          tag_scan_auto : false,\r\n          tag_ci   : false,\r\n          time     : false,\r\n          time_creation : false,\r\n          time_str : new Date(Date.now()-86400000).toLocaleString(),\r\n          time_obj : true,\r\n//          time_ago_str : '24:00',\r\n          time_ago_str : '0:00',\r\n          time_ago_str_sync_at_refresh : false,\r\n          time_track : false,\r\n//          time_mark : false,\r\n          desktopime_mark_str : '',\r\n          time_watch : false,\r\n          time_watch_creation : false,\r\n          list_time_scroll: true,\r\n          list : true,\r\n//          list_mark_time : true,\r\n          list_str : '',\r\n//          list_obj : [],\r\n          list_obj2 : {},\r\n          attr_list : true,\r\n          attr_list_str : '',\r\n          attr_list_obj2 : {},\r\n          bookmark_list : true,\r\n          bookmark_list_str : '',\r\n          bookmark_list_obj2 : {},\r\n          watch_list_str : '',\r\n          watch_list_obj2 : {},\r\n//          watch_list_mark_time : true,\r\n//          tag_scansite : true,\r\n          tag_search: {str:'', re:false, show_nof_boards:false,   get ci(){return pref.liveTag.ci;}, sentence:false, rexps:null},\r\n          tag2bList: {label:'', by:'tag'},\r\n          auto_list: {use:false, str:'', obj7:null, kill:false, watch:true, show:false, sticky:false, style:false, style_str:''},\r\n        },\r\n        bookmark_list_rm404 : true,\r\n        auto_load_filter : false,\r\n        auto_save_filter : false,\r\n        auto_save_filter_at_refresh : false,\r\n        tag : {ignore:12, max:12},\r\n        board: {recommendation: true, all_boards:false, board_tags: false, ex_list: false, ex_list_str: '', ex_list_obj2: {}, board_tags_same: false},\r\n        style_general_list : true,\r\n        style_general_list_str : \r\n          '//^background:#e5ecf9\\n'+\r\n          '//^border:1px solid black\\n'+\r\n          '//8chan^background:#eef2ff;border:1px solid #d6daf0\\n'+\r\n          '//8chan^background:#eef2ff\\n'+\r\n          '//KC^background:#e0e0fc;border:1px solid #aaaacc\\n'+\r\n          '//4chan^background:#ffffee;border:1px solid #f0e0d6\\n',\r\n        style_general_list_obj2 : {},\r\n        refresh : {except_bt : true, at_switch: true},\r\n        design : 'auto',\r\n        catalog_json : true,\r\n        embed : true,\r\n        embed_page: true,\r\n        embed_frame : true,\r\n        embed_archive: false,\r\n//        order : {reply_to_me: true, reply: true, watch: 'dont_care', sticky:'dont_care', find_sage_in_8chan: false},\r\n        order : {reply_to_me: true, reply: true, watch: 'dont_care', sticky:'first'},\r\n//        health_indicator: {on: true, max:10},\r\n        auto_watch: true,\r\n        unmark_on_hover: true,\r\n        mimic_base_site: true,\r\n        text_mode: {mode:'graphic', sub:true, name:false, com:true},\r\n        appearance: {\r\n          titleBar: {filter: true, settings: true, refresh: true, num_of_pages: true, boards_selector: true},\r\n          initial: {state: 'max', width: 400, height: 400, left:0, top:0}\r\n        },\r\n        t2h_sel: 'no',\r\n        click: 'open',\r\n        popupX: {__proto__:proto.popupX},\r\n        env:Object.create(proto.env),\r\n        footer: {__proto__:proto.footer}, // this is required for save, or refers proto directly and deletes them all.\r\n        __proto__: proto},\r\n      filter: {disable_list_when_kwd_active:true, disable_tag_when_kwd_active:false},\r\n      page: {\r\n        get embed(){return pref.catalog.embed_page;},\r\n        infinite: false, \r\n//        scan_tag:true,\r\n        format: {show:{style:false, contents:false, layout:false, posts:true, fileinfo:true, images_2nd:true},\r\n                 __proto__:proto.format},\r\n        image_hover:true,\r\n        get footer(){return pref.catalog.footer;},\r\n        footer_br: false,\r\n        load_on_demand: true,\r\n        popupX: {__proto__:proto.popupX},\r\n        env:Object.create(proto.env),\r\n        __proto__: proto},\r\n      thread: {\r\n        embed: false,\r\n        format: {show:{style:false, contents:false, layout:false, posts:true, fileinfo:true, images_2nd:true},\r\n                 __proto__:proto.format},\r\n        image_hover:true,\r\n        get footer(){return pref.catalog.footer;},\r\n        footer_br: false,\r\n        popupX: {__proto__:proto.popupX},\r\n        env:{auto_update_native:true, refresh_initial:false, __proto__:proto.env},\r\n        t2h_num_of_posts : -1,\r\n        auto_update: false,\r\n        __proto__: proto},\r\n      float: {\r\n        click: 'open',\r\n        footer: {__proto__:proto.footer},\r\n//        get footer(){return pref.catalog.footer;},\r\n        format: {thumb: {resize: true},\r\n                 __proto__:proto.format},\r\n        save_board_list_sel: true,\r\n        popupX: {__proto__:proto.popupX},\r\n        env:Object.create(proto.env),\r\n        __proto__: proto},\r\n      common: {\r\n        clear_at_manual_scan : false,\r\n      },\r\n\r\n//      graph : {key: null, pipe: null},\r\n      uip_tracker: {on : false, posts: true, deletion: true, interval: 10, adaptive: true, highlight_str:'color:red', annotate:true,\r\n                    auto_open:false, auto_open_th:300, auto_open_kwd:'',\r\n                    deletion: {show:true, link:true, name:true, name_str:'color:red', addName:true, addName_str:'DELETED_', post:false, post_str:'opacity:0.4'},\r\n                    sage: {detect:true, name:true, name_str:'color:blue', addName:false, addName_str:'SAGE_', post:false, post_str:'opacity:0.4', tolerance:1,\r\n                           patch_bug:false, patch_bug2:false, patch_bug2nth:8, patch_bug3:true, annotate:true, page:false, patch_bug4:true, patch_bug5:true, annotate_page:false}},\r\n      thread_reader: {use: true, sync: true, triage: true, triage_close: true, check_num_of_children: true,\r\n        own_posts_tracker: false, show_own_post_by: 'anchor', show_reply_to_me_by: 'anchor', clean_up_own_posts: true},\r\n      IDinfo: {ID:true, flag:true, IDFlag:true, IDop:true, nofIDs:true, nofFlags:true, auto:true, name:false, trip:false, nameTrip:false, nofNames:true, nofTrips:true},\r\n      settings: {indexing: 0},\r\n      tag : {gen: false, gen_str:''}, // dummy for checkbox and textarea.\r\n      cloudflare: {auto_reload: true, auto_reload_time: 5},\r\n      scan: {max:10000, lifetime:20, crawler:50, max_threads:1000, crawler_adaptive:true, crawler_idle_time_to_spawn:100, max_archive:150},\r\n      notify : {sound: {notify: false, src:'beep', beep_freq:1000, beep_length_f:0.2, beep_volume_f:1, reply_to_me: true, reply: true, new_thread: true, appear: true, supp_init:true},\r\n                desktop: {notify: true, reply_to_me: true, reply: true, new_thread:true, appear:true, lifetime:30, show_last:false, supp_init:true,\r\n                          limit:(brwsr.ff)? 10 : 30, delay:(brwsr.ff)? 500 : 0},\r\n                favicon: true,\r\n                title: {notify:true, hide_zero: true},\r\n               },\r\n      liveTag: {\r\n        use: true, max: 12, maxstr: 25, from:'post', lock_tags_in_op: true, ci: true,\r\n        inherit_board_name: true, lock_board_name: true, inherit_board_tags: true, lock_board_tags: true,\r\n        info: true,\r\n        style: {ex:'color:blue', exurtm:'color:cyan;font-weight:bold', exur:'color:deepskyblue;font-weight:bold',\r\n                in:'color:red', inurtm:'color:yellow;font-weight:bold', inur:'color:orange;font-weight:bold',\r\n                use:true, urtm:'color:lime;font-weight:bold', ur:'color:limegreen;font-weight:bold'},\r\n//        style_urtm_obj4:{},                           style_ur_obj4:{},                                style_in_obj4:{},\r\n        pickup_interval: 10, rm_404:'imm', disp_delay:{fg:500, bg:5000}, click_func: 'in', click_func_bl: 'pkin',\r\n        watch_all: true, lazy_each:150, lazy_delay:100,\r\n        ex_list: true, ex_list_str:'8chan:#selection\\n', ex_list_obj5:null,\r\n        rm_list: true, rm_list_str:'http*\\n', rm_list_obj5:null},\r\n      virtualBoard: {\r\n        show: true, max:20, scan: false, scanDelay: 5, p_board: 'replace', p_remove: false, v_remove:true,\r\n        scan_domains: site0.domains_obj('none'),\r\n//        scan_domains: {meguca:'none', lain:'none', '8chan':'none', '4chan':'none', KC:'none', lainjp:'none'},\r\n        instant_scan: true,\r\n        search: {show: true,  str:'', re:false,    get ci(){return pref.liveTag.ci;}, sentence:false, rexps:null},\r\n      },\r\n      style:{\r\n        sel: 'fix', zIndex:1,\r\n        fix:{\r\n          titleBar_str:'background:#b5ccf9;border:1px solid blue;font-weight:normal',\r\n          window_str:'background:#e5ecf9;color:#000000;font-weight:normal',\r\n          popUp_str:'background:#e5f4f9;color:#000000;border:2px solid blue;font-weight:normal'\r\n        },\r\n        copy:{titleBar_str:'body', window_str:'body', popUp_str:''},\r\n        post_editing: 'background:#cec952 !important',\r\n        post_new: 'border:2px solid red',\r\n        userCSS: {use:false, str:'',\r\n          sample:'.CatChan_titleBar button[name^=\"op\"]{display:none} /* remove transparency buttons in titleBar */\\n'+\r\n            '.CatChan_merge1::before{float:left;content:\">\";} /* levelized merge */\\n'+\r\n            '.CatChan_merge2::before{float:left;content:\">>\";}\\n'+\r\n            '.CatChan_merge3::before{float:left;content:\">>>\";}\\n'+\r\n            '.CatChan_merge4::before{float:left;content:\">>>>\";}\\n'+\r\n            '.CatChan_merge5::before{float:left;content:\">>>>>\";}\\n'+\r\n            '.CatChan_merge1{border-left:10px solid red;} /* colored merge */\\n'+\r\n            '.CatChan_merge2{border-left:10px solid orange;}\\n'+\r\n            '.CatChan_merge2{border-left:10px solid yellow;}\\n'+\r\n            '.CatChan_merge2{border-left:10px solid green;}\\n'+\r\n            '.CatChan_merge3{border-left:10px solid blue;}\\n'+\r\n            '.CatChan_titleBar button[name=\"roll_toggle\"]{display:none} /* remove toggle button in titleBar */\\n'+\r\n            '.CatChan_titleBar button[name=\"max\"]{display:none} /* remove maximize button in titleBar */\\n'+\r\n            '.CatChan_titleBar button[name=\"top\"]{display:none} /* remove embed to top button in titleBar */\\n'+\r\n            '.CatChan_titleBar button[name=\"bottom\"]{display:none} /* remove embed to bottom button in titleBar */\\n'+\r\n            '.CatChan_search_miss>*{opacity:inherit} /* patch for chrome in 4chan */\\n' // https://mevius.5ch.net/test/read.cgi/hp/1544452458/346\r\n        },\r\n      },\r\n      recovery:{comment:true, interval:10, auto_clean:true},\r\n      healthIndicator: {show:true, max:10, expand_running:false, dont_retire_running:true, cancel:true},\r\n      network: {cross_domain:'indirect', fetch_actively:true, adaptive:true, th100:5, th100_delay:500, th20:10, th20_delay:100, timeout:15, overXFO:true, overCSPF:true},\r\n      stats: {use:false, retain_404:true, draw_delay:10, estimate_posts:true,\r\n              save:true, load:true, len_capture:1440, auto_acquisition:true, auto_acquisition_scan:true, auto_acquisition_scan_delay:120, auto_acquisition_all:false, \r\n              tolerant:true, tolerance:90, patch_tm:false},  // patch_tm is a patch for thread moving in lainchan or 4chan/bant/.\r\n      chart: {off_anime_blur:true, window_width:400, window_height:400, instant_scan:true, load_on_demand:false,\r\n              inst:{len:120, scale_thread:10, time_sel:1, board_sel:0, show_legend:true, // separate:false, \r\n                    show: {np:true, p:false, ep:false, nt:false, t:true, et:false}, clip_np:false, clip_np_val:0,\r\n                    options: {bezierCurve: false, animation:false, pointDot:true, pointDotRadius:4}}},\r\n      archive:{load_img:true, restore_auto:true, clear_threads:true, clear_files:false, format:'auto', domain:0, board:'',\r\n               src:'shown', store_auto:false, dir_dled:null, open_local:false, fix_inconsistency:true, store_watched:false,\r\n               oneshot: {post:true, tn:true, img:true,  webm:true , post_idb:true, tn_idb:true, img_idb:true,  webm_idb:true},\r\n               live:    {post:true, tn:true, img:false, webm:false, post_idb:true, tn_idb:true, img_idb:false, webm_idb:false},\r\n               deleted: {post:true, tn:true, img:false, webm:false, post_idb:true, tn_idb:true, img_idb:false, webm_idb:false},\r\n               IDB:     {auto_clean:true, auto_clean_init:true, prune:168, prune_flush:false, nof_tr:10, nof_cl:20, nof_cl_max:80, auto_restore:false, auto_restore_remove:true, watchdog:120, redirect_404: false, redirect_404_CSP: false}, // check_every:1, },\r\n               kwd: {use:true, str:'', re:false, ci:true, match:0, op:true, post:false, sub:true, name:true, trip:false, com:true, file:false, meta:false, sentence:false,    rexps:null},\r\n               list:true,\r\n               list_str:'', list_obj6:null, list_inherit:false,\r\n               tar: true, tarsize: 100, sub_in_filename:true,\r\n//               get list_str(){return pref3.archive.list_str_get();},\r\n//               set list_str(val){pref3.archive.list_str_set(val);},\r\n               files_sel:0,\r\n               IDB_board_sel:0,  IDB_board_sel_gfunc_pre:pref4.archive.IDB_board_sel_gfunc_pre,\r\n               IDB_thread_sel:0, IDB_thread_sel_gfunc_pre:pref4.archive.IDB_thread_sel_gfunc_pre,\r\n               IDB_select_multiple: true,\r\n               editing_timeout: true,\r\n              },\r\n      threadStats: {use:false, full:true, retry:false},\r\n      debug_mode : {unread_count:'', parse_error:false, site2func:'', site2func_expand:true, pfunc:'', pfunc_expand: true, pfunc_all:'', pfunc_all_expand: true,\r\n                    pfunc_comp:'', pfunc_comp_expand_same:true, pfunc_comp_expand_diff:true, pfunc_comp_proto:'',},\r\n      test_mode: {tips:false, num:0, num_f:0, test_str:''},\r\n      patch: {\r\n        delayed_invoke: {use: false, sec: 10},\r\n        rm_404_blacklist: [], //['8chan'], // 8chan sends corrupted data.\r\n      },\r\n      pref2: {\r\n        KC: {summer_time: false},\r\n        meguca: {\r\n//          get remove_history_class(){return pref.catalog_open_where!=='_self';},\r\n          historyAPI: true,\r\n          utilize_boards_json:true, utilize_boards_json_domain:true,},\r\n        '8chan': {utilize_boards_json:true,},\r\n      },\r\n      easy: {posts_ago:24, threads_ago:24, max_boards:50,},\r\n      easy2: {\r\n        reset: true, presets: 0, time_post:24, time_op:24, basics:true, // easy2 local parameters.\r\n        auto_update:false, auto_update_period:10, // easy2 local parameters.\r\n        VB: {local:0, global:0}, LTfrom: 0, limits:0, // easy2 local parameters.\r\n        virtualBoard: {show:true, scan:true, max:100},\r\n        liveTag: {use:false, from:'op'},\r\n        catalog: {embed:true, embed_page:true, max_threads_at_refresh:500,\r\n                  auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:10,\r\n                  filter: {time_watch:false, time_watch_creation:false},\r\n                 },\r\n        page:{auto_update:true, auto_update_period:10},\r\n        thread: {embed:false, auto_update:true, auto_update_period:10},\r\n        notify:{desktop:{notify:true}},\r\n        stats: {use:false},\r\n        scan:{max:100, max_threads:1000},\r\n        network:{fetch_actively:false},\r\n        healthIndicator:{expand_running:false},\r\n      },\r\n      proto: proto, // for overwrite from pref_default.\r\n    };\r\n    for (var i=0;i<40;i++) pref_new.debug_mode[i] = false;\r\n    for (var i=0;i<130;i++) pref_new.test_mode[i] = false;\r\n    if (site0.pref_default2) pref_func.pref_overwrite(pref_new,site0.pref_default2);\r\n    if (site0.pref_default ) pref_func.pref_overwrite(pref_new,site0.pref_default);\r\n//    if (site) if (site2[site.nickname].pref_default) pref_func.pref_overwrite(pref_new,site2[site.nickname].pref_default);\r\n    if (for_save) {\r\n      pref_func.delete_null(pref_new);\r\n      Object.defineProperty(pref_new.page,  'footer',{get:function(){return pref_new.catalog.footer;}, enumerable:true, configurable:true}); // patch for refer to each object instead of global pref.\r\n      Object.defineProperty(pref_new.thread,'footer',{get:function(){return pref_new.catalog.footer;}, enumerable:true, configurable:true});\r\n//      Object.defineProperty(pref_new.float, 'footer',{get:function(){return pref_new.catalog.footer;}, enumerable:true, configurable:true});\r\n    }\r\n    common_func.Object_modifyDescriptor(pref_new.style.userCSS,'sample',{writable:false});\r\n    return pref_new;\r\n  }\r\n  var gGEH = {\r\n    get_key_recursive: function(pn, pn_end){\r\n      var key;\r\n      while (pn && !(key=this.pns_all_keys.get(pn)) && pn!==pn_end) pn = pn.parentNode;\r\n      return key;\r\n    },\r\n    pns_all_keys: new WeakMap(),\r\n    triage_in: null, // patch for test_mode['127']\r\n    triage_in2: null, // patch for test_mode['127']\r\n  };\r\n\r\n  var pref_func = {\r\n      delete_null: function(dst){\r\n        for (var i in dst) {\r\n          if (dst[i]===null) delete dst[i];\r\n          else if (typeof(dst[i])==='object' && !Array.isArray(dst[i])) pref_func.delete_null(dst[i]);\r\n        }\r\n      },\r\n      pref_overwrite: function(dst,src,strict){\r\n        for (var i in src)\r\n          if (dst[i]!==undefined && (dst[i]!==null || pref && pref.test_mode['117'])) {\r\n            if (strict && typeof(src[i])!==typeof(dst[i])) continue;\r\n            if (typeof(src[i])==='object' && !Array.isArray(src[i])) pref_func.pref_overwrite(dst[i],src[i],strict);\r\n//            else dst[i] = src[i];\r\n            else if (dst[i]!==src[i]) dst[i] = src[i]; // utilize prototype\r\n          }\r\n      },\r\n      site2_json: function(query, dumb, enables){\r\n        var pn_out = document.getElementsByName('JSON_result')[0];\r\n        if (pn_out) pn_out.style = {};\r\n        try { \r\n          if (pref.overwrite_site2_json_str!=='') {\r\n            var fields = pref.overwrite_site2_json_str.split('\"');\r\n            var i=0;\r\n            while (i<fields.length) {\r\n              if (fields[i].search(/\\/\\/.*/)!=-1) {\r\n                while (i+1<fields.length && fields[i].search(/\\/\\/[^\\n]*\\n/)==-1) fields[i] += fields.splice(i+1,1);\r\n                fields[i] = fields[i].replace(/\\/\\/[^\\n]*(\\n|$)/,'');\r\n              } else i+=2;\r\n            }\r\n            var str = fields.join('\"');\r\n            var ex_count = 0;\r\n            var str_out = '';\r\n            var count = 0;\r\n            var start = 0;\r\n            for (var j=0;j<str.length;j++) { // can handle multiple JSON.\r\n              if (count==0 && str[j]!=='{' && str[j]!==' ' && str[j]!=='\\n') ex_count++;\r\n              if (str[j]==='{') count++;\r\n              if (str[j]==='}' && --count==0) {\r\n                var obj = JSON.parse(str.substr(start,j-start+1))\r\n                for (var i in obj)\r\n                  if (i==='site2' || i==='pref' || i==='pref_func' || i=='liveTag' || i==='site3')\r\n                    if (!enables || enables.indexOf(i)!=-1)\r\n//                  if ((!disable_others && (i==='site2' || i==='pref' || i==='pref_func' || i=='liveTag')) || (!disable_site3 && i==='site3'))\r\n                      if (!query) pref_func.pref_overwrite(eval(i),obj[i]);\r\n                      else str_out = '{\"' + i + '\":' + pref_func.pref_query(eval(i),obj[i]) + '}';\r\n                start = j+1;\r\n              }\r\n            }\r\n\r\n//            if (str!=='') { // working code.\r\n//            if (str.indexOf('{')!=-1) {\r\n//              var obj = JSON.parse(str);\r\n//              for (var i in obj)\r\n//                if (i==='site2' || i==='pref' || i==='pref_func') pref_func.pref_overwrite(eval(i),obj[i]);\r\n//            }\r\n////          if (pref.overwrite_site2_json_str!=='') { // working code\r\n//////            var str = pref.overwrite_site2_json_str.replace(/\\/\\/.*/mg,'').replace(/\\n/g,'');\r\n////            var fields = pref.overwrite_site2_json_str.split('\"');\r\n////            for (var i=0;i<fields.length;i+=2) {\r\n////              if (fields[i].search(/\\/\\/.*/)!=-1) {\r\n////                if (fields[i].search(/\\n/)!=-1 || i+1==fields.length) fields[i] = fields[i].replace(/\\/\\/[^\\n]*(\\n|$)/,'');\r\n////                else {\r\n//////                  while (i+1<fields.length && fields[i].search(/\\n/)==-1) fields[i++]='';\r\n////                  while (i+1<fields.length && fields[i].search(/\\n/)==-1) fields.splice(i,1);\r\n////                  if (i<fields.length) fields[i] = fields[i].replace(/[^\\n]*(\\n|$)/,'');\r\n////                }\r\n////              }\r\n////            }\r\n////            var str = fields.join('\"');\r\n////            var count = 0;\r\n////            var start = 0;\r\n////            for (var j=0;j<str.length;j++) {\r\n////              if (str[j]==='{') count++;\r\n////              if (str[j]==='}') {\r\n////                count--;\r\n////                if (count==0) {\r\n////                  var str_tmp = str.substr(start,j-start+1);\r\n////                  if (str_tmp!=='') {\r\n////                    var obj = JSON.parse(str_tmp);\r\n////                    for (var i in obj)\r\n////                      if (i==='site2' || i==='pref' || i==='pref_func') pref_func.pref_overwrite(eval(i),obj[i]);\r\n////                  }\r\n////                  start = j+1;\r\n////                }\r\n////              }\r\n////            }\r\n//////            if (str!=='') pref_func.pref_overwrite(site2,JSON.parse(str));\r\n//////            if (str!=='') {\r\n//////              var obj = JSON.parse(str);\r\n//////              for (var i in obj)\r\n//////                if (i==='site2' || i==='pref' || i==='pref_func') pref_func.pref_overwrite(eval(i),obj[i]);\r\n//////            }\r\n            if (pn_out) {\r\n              pn_out.textContent = ((ex_count!=0)? 'OK, but there are extra useless strings, ' :\r\n                                    (count!=0)? 'OK, but there are non-closed brackets, ' :\r\n                                    'OK, ') + new Date().toLocaleString();\r\n              pn_out.style.color = '';\r\n              if (str_out!=='') {\r\n                document.getElementsByName('overwrite_site2_json_str')[0].value = str_out;\r\n                pref.overwrite_site2_json_str = str_out;\r\n              }\r\n            }\r\n          }\r\n        } catch (e) {\r\n          if (pn_out) {\r\n            pn_out.textContent = 'ERROR!!!, ' + new Date().toLocaleString();\r\n            pn_out.style.color = 'red';\r\n          }\r\n          console.log('ERROR in overwtite strings:');\r\n          console.log(pref.overwrite_site2_json_str);\r\n          console.log(e);\r\n        }\r\n      },\r\n  };\r\n\r\n  var pref = pref_default(); // pref_default is loaded.\r\n  if (  localStorage &&   localStorage[pref.script_prefix+'.pref']) pref_func.pref_overwrite(pref,JSON.parse(  localStorage[pref.script_prefix+'.pref']),true);\r\n  for (var i in {catalog:null, page:null, float:null, thread:null}) if (!pref[i].save_board_list_sel) pref[i].board_list_sel = 0;\r\n  if (sessionStorage && sessionStorage[pref.script_prefix+'.pref']) pref_func.pref_overwrite(pref,JSON.parse(sessionStorage[pref.script_prefix+'.pref']),true);\r\n  if (window.name) for (var i in {catalog:null, page:null, float:null, thread:null}) pref[i].board_list_sel = 0;\r\n  pref_func.site2_json(false,true,['pref']);\r\n  if (site0.isStep) {\r\n//    for (var i in site.features) site.features[i] = false;\r\n    for (var i in pref.features) if (i!=='domains') pref.features[i] = false;\r\n    for (var i in pref.features.domains) if (i!==site0.domain) pref.features.domains[i] = false;\r\n    brwsr.sw_cache = null;\r\n    pref_func.pref_overwrite(pref,{\r\n      catalog:{auto_update:false},\r\n      thread:{auto_update:false},\r\n      page:{auto_update:false},\r\n      float:{auto_update:false},\r\n      virtualBoard:{scan:false},\r\n      stats:{auto_acquisition_scan:false},\r\n      cloudflare:{auto_reload:false},\r\n    });\r\n  }\r\n\r\n  var styleSheet = (site0.isStep)? {} : (function(){\r\n    var ss;\r\n    function replace_rule(rule_str,idx){\r\n      if (ss.cssRules[idx]) ss.deleteRule(idx);\r\n      ss.insertRule(rule_str,idx);\r\n    }\r\n    function make_rule_click_area(){\r\n      replace_rule('.'+pref.script_prefix+((pref.catalog.click_area==='entire')? '_thread' : '_thumbnail')+' {cursor: pointer}',2);\r\n    }\r\n    function make_styles(){\r\n      var rules = [pref.style.fix.titleBar_str, pref.style.fix.window_str, pref.style.fix.popUp_str];\r\n      if (pref.style.sel==='copy') {\r\n        var rules_str = [pref.style.copy.titleBar_str, pref.style.copy.window_str, pref.style.copy.popUp_str];\r\n        for (var i=document.styleSheets.length-1;i>=0;i--) {\r\n          var doc_rules = document.styleSheets[i].cssRules;\r\n          if (!doc_rules) continue;\r\n          for (var j=doc_rules.length-1;j>=0;j--) {\r\n            for (var k=0;k<3;k++) {\r\n              if (rules_str[k] && doc_rules[j].selectorText===rules_str[k]) {\r\n                rules[k] = trim_rules(doc_rules[j].cssText);\r\n                rules_str[k] = null;\r\n              }\r\n            }\r\n            if (!rules[0] && !rules[1] && !rules[2]) break;\r\n          }\r\n          if (!rules[0] && !rules[1] && !rules[2]) break;\r\n        }\r\n      }\r\n      replace_rule('.'+pref.script_prefix+'_titleBar'+' {' + rules[0] + '}',4);\r\n      replace_rule('.'+pref.script_prefix+'_window'  +' {' + rules[1] + '}',5);\r\n      replace_rule('.'+pref.script_prefix+'_popUp'   +' {' + rules[2] + '}',6);\r\n    }\r\n    function trim_rules(str){\r\n      var rules = str.replace(/.*\\{/,'').replace(/\\}.*/,'').split(';');\r\n      for (var i=rules.length-1;i>=0;i--) if (rules[i].split(':')[0].search(/\\s*(background|color)/)==-1) rules.splice(i,1);\r\n      return rules.join(';');\r\n    }\r\n    function add_to_watch(elem){ // http://stackoverflow.com/questions/2635814/javascript-capturing-load-event-on-link\r\n//      elem.addEventListener('change', dummy_add, false); // doesn't work.\r\n      new MutationObserver(dummy_add).observe(elem, {attributes:true});\r\n    }\r\n    function dummy_add(){\r\n      if (!ss) return;\r\n      var dummy = document.createElement('img');\r\n      dummy.src = this.href;\r\n      dummy.onerror = dummy_remove;\r\n      document.getElementsByTagName('body')[0].appendChild(dummy);\r\n    }\r\n    function dummy_remove(){\r\n      this.parentNode.removeChild(this);\r\n      make_styles();\r\n    }\r\n    var spoiler_org = null;\r\n    var spoiler_open = null;\r\n    function open_spoiler_text(){\r\n      if (!cataLog.embed_mode) return;\r\n      var desc = site2[site.nickname].spoiler_text;\r\n      if (desc.spoiler) {\r\n        if (!spoiler_org && !spoiler_open) {\r\n          if (desc && pref[cataLog.embed_mode].open_spoiler_text) {\r\n            for (var j=0;j<document.styleSheets.length;j++)\r\n              if (document.styleSheets[j].cssRules)\r\n                for (var i=0;i<document.styleSheets[j].cssRules.length;i++) {\r\n                  var sText = document.styleSheets[j].cssRules[i].selectorText;\r\n                  if (sText) {\r\n                    if (sText.search(desc.spoiler)!=-1) spoiler_org  = [j,i,document.styleSheets[j].cssRules[i].style.cssText];\r\n                    if (sText.search(desc.open   )!=-1) spoiler_open = [j,i,document.styleSheets[j].cssRules[i].style.cssText];\r\n                  }\r\n                }\r\n          }\r\n        }\r\n        if (spoiler_org && spoiler_open)\r\n          document.styleSheets[spoiler_org[0]].cssRules[spoiler_org[1]].style.cssText = spoiler_org[2] + ((pref[cataLog.embed_mode].open_spoiler_text)? spoiler_open[2] : '');\r\n      } else { // cssRules is null when stylesheet is placed in other domain. http://hakuhin.jp/js/style_sheet.html#STYLE_SHEET_04\r\n        if (pref[cataLog.embed_mode].open_spoiler_text) {\r\n          spoiler_open = [document.styleSheets.length-1, document.styleSheets[document.styleSheets.length-1].cssRules.length, desc.open_rule];\r\n          document.styleSheets[spoiler_open[0]].insertRule(spoiler_open[2],spoiler_open[1]);\r\n        } else if (spoiler_open) document.styleSheets[spoiler_open[0]].deleteRule(spoiler_open[1]);\r\n      }\r\n    }\r\n    var registry = ['dummy','dummy','dummy','dummy','dummy','dummy','dummy'];\r\n    function register(selector, rule){\r\n      var idx = registry.indexOf(selector);\r\n      if (idx!=-1) ss.deleteRule(idx);\r\n      if (rule===null || rule==='') {\r\n        if (idx!=-1) registry.splice(idx,1);\r\n      } else {\r\n        if (idx===-1) {\r\n          idx = registry.length;\r\n          registry[idx] = selector;\r\n        }\r\n        ss.insertRule(selector+' {'+rule+'}', idx); // (rule[0]===':'? rule : ' {'+rule+'}'), idx);\r\n      }\r\n    }\r\n    var cpf = '.'+pref.script_prefix+'_';\r\n    var uss = null;\r\n    function userCSS_changed(){\r\n      var pf = pref.style.userCSS;\r\n      if (pf.use) {\r\n        var s = uss || document.createElement('style');\r\n        s.textContent = pf.str;\r\n        if (!uss) uss = document.head.appendChild(s);\r\n      } else {\r\n        if (uss) {\r\n          document.head.removeChild(uss);\r\n          uss = null;\r\n        }\r\n      }\r\n    }\r\n    userCSS_changed(); // init\r\n    return {\r\n      init: function(embed_mode){\r\n        ss = document.head.insertBefore(document.createElement('style'),uss).sheet;\r\n        ss.insertRule('.catalog_triage_parent {pointer-events: none;}',0); \r\n        ss.insertRule('.catalog_triage_button {pointer-events: auto;}',1);\r\n        make_rule_click_area(); // rule 2.\r\n        ss.insertRule('.'+pref.script_prefix+'_tag {cursor:pointer;}',3);\r\n        make_styles(); // rule4,5,6\r\n        pref_func.settings.onchange_funcs['*.posts_search_op'](null,embed_mode);\r\n        pref_func.settings.onchange_funcs['style.post_editing']();\r\n        register(cpf+'autoTp:hover', 'opacity:1;');\r\n        register(cpf+'autoTp', 'opacity:0;');\r\n        register(cpf+'deleted', 'opacity:0.4;');\r\n        var styles = site2[site.nickname].styles;\r\n        if (styles) for (var i=0;i<styles.length;i++) register(styles[i][0], styles[i][1]);\r\n//        register(cpf+'hMenu', 'display:inline-block;');\r\n//        register(cpf+'hMCnt button', 'display:block;width:100%');\r\n//        register(cpf+'hMenu '+cpf+'hMCnt', 'display:none;');\r\n//        register(cpf+'hMenu:hover '+cpf+'hMCnt', 'display:block;position:absolute;');\r\n      },\r\n      make_rule_click_area: function(){if (ss) make_rule_click_area();},\r\n      styles_changed: function(){if (ss) make_styles();},\r\n      add_to_watch: add_to_watch,\r\n      open_spoiler_text: open_spoiler_text,\r\n      register: register,\r\n      register_cc: function(cls,rule){this.register(cpf+cls, rule);}, // class is reserved word.\r\n      userCSS_changed: userCSS_changed,\r\n    }\r\n  })();\r\n\r\n  var pref3 = { // auto sync objects.\r\n    stats: {use:null, estimate_posts:null},\r\n    reload_required: false,\r\n    catalog: {\r\n      indexing_old: 0,\r\n      filter: {\r\n        time_str: function(parent,key,val){parent[key.replace(/str$/,'obj')] = Date.parse(val);},\r\n        time_obj: 0,\r\n        kwd: {\r\n          str: function(e){if (this.obj) this.obj[(this.obj[0]===e.target)? 1 : 0].value = pref.catalog.filter.kwd.str;},\r\n          obj: null,\r\n          clear: function(){ // non-enumerable\r\n//            if (!this.obj) return; // patch for obj_init_hier\r\n            this.obj[1].value = '';\r\n            this.obj[1].oninput({target:this.obj[1],currentTarget:this.obj[1]});\r\n          },\r\n          init: function(search, pn_filter){ // non-enumerable\r\n            var search2;\r\n            if (!this.obj) { // for multientry in meguca.\r\n              search2 = search.cloneNode(false);\r\n              search2.name = 'catalog.filter.kwd.str';\r\n              search2.oninput = cataLog.event_func;\r\n              this.obj = [pn_filter.getElementsByTagName('input')['catalog.filter.kwd.str'], search2];\r\n            } else search2 = this.obj[1];\r\n            search.setAttribute('style','display:none');\r\n            search.parentNode.insertBefore(search2,search.nextSibling);\r\n            this.clear();\r\n            return search2;\r\n          },\r\n        },\r\n      },\r\n    },\r\n    notify:{sound:{file:null}},\r\n    archive: {\r\n      working: false,\r\n      list_str: function(parent,key,val){pref_func.str2obj2(parent,key.replace(/str$/,'obj2'),val);},\r\n      list_obj2: null,\r\n      list_obj3: null,\r\n      jsons: null,\r\n      imgs: null,\r\n      dir: null,\r\n//      list_str_set: function(val){\r\n//        pref3.archive.list_str = val;\r\n//        pref_func.str2obj2(pref3.archive,'list_obj2',val);\r\n//      },\r\n//      list_str_get: function(){\r\n//        var lm = liveTag.mems;\r\n//        for (var name in pref3.archive.list_obj2) {\r\n//          var dbt = common_func.name2domainboardthread(name);\r\n//          if (!dbt[2]) continue;\r\n//          if (lm[dbt[0]] && lm[dbt[0]][dbt[1]]) var lth = lm[dbt[0]][dbt[1]][dbt[2]];\r\n//          if (lth && lth.archived && lth.time_checked !== pref3.archive.list_obj2[name].time) pref3.archive.list_str = list_func_1(pref3.archive.list_str, name, lth.time_checked); // BUG. NOT implemented yet.\r\n//        }\r\n//        return pref3.archive.list_str;\r\n//        function list_func_1(str,name,datetime){ // refer 'triage_exe'\r\n//          var key = new RegExp('(^|,)'+name.replace(/\\+/,'\\\\+')+'([\\\\^@!][^,\\n]*)*(,|\\n|$)','mg');\r\n////          var millisec = datetime%1000;\r\n////          var time_str = '@' + new Date(datetime).toLocaleString() + ((datetime%1000==0)? '' : '.'+millisec);\r\n////          str = str.value.replace(key,',') + ',' + name + time_str + '\\n';\r\n//          str = str.value.replace(key,',') + ',' + name + '\\n'; // remove time_str\r\n//          return str.replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,'');\r\n//        }\r\n//      },\r\n    },\r\n    proto: {\r\n      merge_list_str: function(parent,key,val){\r\n        if (!this.merge_list_obj2_old) this.merge_list_obj2_old = this.merge_list_obj2;\r\n        var name_prev = null;\r\n        pref_func.str2obj2(parent,'merge_list_obj2',val.replace(/\\s*\\+/g,',+'), null, null, function(field, tgt){\r\n          var add = field.search(/^\\s*\\+\\s*/)!=-1;\r\n          var name = field.replace(/^\\s*\\+\\s*/,'') || 'DEFAULT';\r\n          if (add && name_prev) {\r\n            tgt[name] = tgt[name_prev];\r\n            tgt[name][tgt[name].length] = name;\r\n          } else {\r\n            tgt[name] = [name];\r\n            name_prev = name;\r\n          }\r\n        });\r\n      },\r\n      merge_list_obj2: null,\r\n      merge_list_obj2_old: null,\r\n      merge_lv_str: function(parent,key,val){\r\n        if (!this.merge_lv_obj2_old) this.merge_lv_obj2_old = this.merge_lv_obj2;\r\n        pref_func.str2obj2(parent,'merge_lv_obj2',val, null, null, pref_func.str2obj2_func_for_val);\r\n      },\r\n      merge_lv_obj2: null,\r\n      merge_lv_obj2_old: null,\r\n      merge_lv_obj3: null,\r\n    },\r\n    test_mode: {js_file:null},\r\n  };\r\n  Object.defineProperties(pref3.catalog.filter.kwd, {\r\n    'clear': {value:pref3.catalog.filter.kwd.clear, configurable:true, enumerable:false, writable:true},\r\n    'init':  {value:pref3.catalog.filter.kwd.init,  configurable:true, enumerable:false, writable:true}});\r\n\r\n  var cataLog = {\r\n    threads: null,\r\n//    insert_footer3: null,\r\n    scan_boards: null,\r\n    scan_init: null,\r\n    catalog_filter_query: null,\r\n    embed_mode: null,\r\n////    catalog_refresh_watch: null,\r\n    format_html: null,\r\n    show_catalog: null,\r\n    show_catalog_cont: null,\r\n    get_ref_height: null,\r\n    catalog_obj2: null,\r\n    healthIndicator: null,\r\n    parent: null, // triage_parent\r\n    open_spoiler_text: null,\r\n    show_catalog_scroll_lock: null,\r\n    general_event_handler: null,\r\n    catalog_refresh_1: null,\r\n    catalog_refresh_end: null,\r\n    catalog_filter_changed: null,\r\n    image_hover_reentry: null,\r\n    image_hover_remove: null,\r\n    scan_boards_keyword_callback2: null,\r\n    scan_boards_keyword_callback2_default_args: null,\r\n    catalog_clear_threads: null,\r\n    catalog_filter_query_keyword: null,\r\n    set_watch_time_thread: null,\r\n    get_watch_time_of_a_thread: null,\r\n    event_func: null,\r\n    restore_th_from_IDB: null,\r\n    components: null,\r\n    triage: null,\r\n    GEH: null,\r\n    insert_myself: null,\r\n    DIH: null,\r\n    pop_up_set_contents: null,\r\n    auto_update: null,\r\n    gClg: null, \r\n  }\r\n\r\n  pref_func = (function(){\r\n//    var tooltip = document.createElement('div');\r\n//    var tooltip_txt = tooltip.appendChild(document.createTextNode('help'));\r\n////    var tooltip_txt = tooltip.appendChild(document.createElement('textarea'));\r\n//    tooltip.style.position = 'fixed';\r\n//    tooltip.style.background = '#e5f4f9';\r\n//    tooltip.style.color = '#000000';\r\n//    tooltip.style.border = '2px solid blue';\r\n//    tooltip.style.fontWeight = 'normal';\r\n//    var tooltip_on = false;\r\n    return {\r\n      __proto__: pref_func,\r\n      mirror_targets: {\r\n        pn12_0_2: null,\r\n        pn12_0_4: null,\r\n        pn13_1: null,\r\n        boardlist: null,\r\n      },\r\n////////      style_sheet: null,\r\n      apply_prep: function(pn,set,propagate, mirror, make_obj){\r\n        if (!pn) return; // reject mirroring to null, // patch for attr_changed.\r\n        var fm;\r\n        if (!mirror) {\r\n          if (Array.isArray(pn)) fm = pn;\r\n          else {\r\n            var query_str = 'input,textarea,select'+ ((set)? '' : ',span[data-class=show_value]');\r\n            fm = Array.prototype.slice.call(pn.querySelectorAll(query_str));\r\n            if (fm.length==0) fm = [pn];\r\n          }\r\n////          if (!set)\r\n////            for (var j in this.mirror_targets)\r\n////              if (this.mirror_targets[j])\r\n////                fm = fm.concat(Array.prototype.slice.call(this.mirror_targets[j].querySelectorAll(query_str)));\r\n//          fm = Array.prototype.slice.call(pn.getElementsByTagName('input')); // working code.\r\n//          fm = fm.concat(Array.prototype.slice.call(pn.getElementsByTagName('textarea')));\r\n//          fm = fm.concat(Array.prototype.slice.call(pn.getElementsByTagName('select')));\r\n//          if (!set) fm = fm.concat(Array.prototype.slice.call(pn.querySelectorAll('span[data-class=show_value]')));\r\n////          var fm = pn.getElementsByTagName('*'); // this doesn't work because a select contains its options in it.\r\n//          if (fm.length==0) fm = [pn];\r\n        } else {\r\n          fm = [];\r\n          for (var j in this.mirror_targets) {\r\n            if (this.mirror_targets[j]) {\r\n              var fm_tmp = this.mirror_targets[j].getElementsByTagName('input')[pn.name];\r\n              if (fm_tmp)\r\n                if (Array.isArray(fm_tmp)) fm = fm.concat(Array.prototype.slice.call(fm_tmp));\r\n                else fm[fm.length] = fm_tmp;\r\n            }\r\n          }\r\n          for (var j=fm.length-1;j>=0;j--) if (fm[j]===pn) fm.splice(j,1);\r\n          if (fm.length==0) return;\r\n        }\r\n        this.apply_prep_2(fm,set,propagate, mirror, make_obj);\r\n      },\r\n      apply_prep_2: function(fms,set,propagate, mirror, make_obj){\r\n        for (var i=0;i<fms.length;i++) {\r\n          var fm = fms[i];\r\n          var name = fm.getAttribute('name');\r\n          if (!name) continue; // for <span> //  if (!fm.name) continue;\r\n          if (fm.type=='button') continue;\r\n          var target_hier = pref_func.get_tgt(name, fm.type==='file'? pref3 : null); // null for #tags2\r\n          var parent = target_hier[0];\r\n          var tgt    = target_hier[1];\r\n          var tagName = fm.tagName;\r\n          if (tagName==='INPUT') {\r\n            if (fm.type==='file') {\r\n              if (!set && parent[tgt] && parent[tgt]!==fm) fm.parentNode.replaceChild(parent[tgt],fm);\r\n              else parent[tgt] = fm; // set also when set===false, keep tracking the DomNode.\r\n            } else if (set) {\r\n              if (parent[tgt+'_old']!==undefined) parent[tgt+'_old'] = parent[tgt];\r\n              this.apply_prep_set(parent, tgt, fm, name);\r\n              if (!mirror && fm.type!=='radio') this.apply_prep(fm,false,false,true); // !mirror for cutting infinite loop. // radio has multiple elements.\r\n            } else this.apply_prep_load(fm, parent, tgt);\r\n            if (set || make_obj)\r\n              if (typeof(parent[tgt])==='string' )\r\n                if (fm.type==='text') {\r\n//                  if (tgt.substr(-3,3)==='str' && parent[tgt.substr(0,tgt.length-3)+'obj4']) pref_func.str2obj4(parent,tgt.substr(0,tgt.length-3)+'obj4',fm.value);\r\n                  if (tgt.substr(-3,3)==='str' && parent[tgt.substr(0,tgt.length-3)+'obj']) pref_func.str2obj6(parent,tgt,fm.value,name);\r\n                }\r\n          } else if (tagName==='TEXTAREA') {\r\n            if (set) parent[tgt] = fm.value;\r\n            else fm.value = parent[tgt];\r\n            if (set || make_obj) {\r\n              if (tgt.slice(-3)==='str') {\r\n                var stgt = tgt.slice(0,-3);\r\n                if (parent[stgt+'obj']) pref_func.str2obj(tgt);\r\n                else if (parent[stgt+'obj2']) pref_func.str2obj2(parent,stgt+'obj2',fm.value);\r\n//                if (tgt.substr(-3,3)==='str' && parent[tgt.substr(0,tgt.length-3)+'obj4']) pref_func.str2obj4(parent,tgt.substr(0,tgt.length-3)+'obj4',fm.value);\r\n                else if (parent[stgt+'obj5']!==undefined) pref_func.str2obj5(parent,stgt+'obj5',fm.value, tgt==='rm_list_str');\r\n                else if (parent[stgt+'obj6']===null) pref_func.str2obj6(parent,tgt,fm.value,name); // obj6===null always, obj6 is located in pref3, \r\n                else if (parent[stgt+'obj7']!==undefined) pref_func.str2obj7.s2o(parent,stgt+'obj7',fm.value);\r\n              }\r\n            }\r\n          } else if (tagName==='SELECT') {\r\n            if (set) this.apply_prep_set(parent, tgt, fm, name); // if (parent[tgt]!==undefined) parent[tgt] = fm.selectedIndex;,\r\n            else {\r\n//              var tgt_obj = (tgt.search(/sel/)!=-1)? tgt.replace(/sel/,'obj') : null;\r\n//              if (parent[tgt_obj]) {\r\n//                fm.length=0;\r\n//                for (var j=0;j<parent[tgt_obj].length;j++) {\r\n//                  fm.length++;\r\n//                  fm.options[fm.length-1].text = parent[tgt_obj][j][0]['key'];\r\n//                }\r\n//              }\r\n              if (parent[tgt+'_gfunc_pre']) parent[tgt+'_gfunc_pre'](parent,tgt,parent[tgt],name,fm);\r\n              this.apply_prep_load(fm, parent, tgt);\r\n//              if (parent[tgt]>=fm.length) parent[tgt] = 0;\r\n//              fm.selectedIndex = parent[tgt];\r\n            }\r\n          } else if (tagName==='SPAN') {\r\n            if (!set && fm.getAttribute('data-class')==='show_value') {\r\n              var val = parent[tgt];\r\n              var func_str = this.apply_prep_2_str[tgt+':'+parent[tgt]];\r\n              if (func_str) val = (typeof(func_str)==='string')? func_str : func_str(parent);\r\n//              if (fm.getAttribute('name').substr(-7,7)==='t2h_sel' && ['L','M','N'].indexOf(parent[tgt])!=-1) val = parent['t2h_'+parent[tgt]];\r\n              fm.textContent = val.toString().replace(/^./,function(v){return v.toUpperCase();});\r\n            }\r\n          }\r\n          if (propagate) {\r\n            if (fm.oninput)  fm.oninput.call(fm, {currentTarget:fm, target:fm}, true);\r\n            if (fm.onchange) fm.onchange.call(fm, {currentTarget:fm, target:fm}, true);\r\n          }\r\n        }\r\n        if (pref.test_mode['117']) {if (sessionStorage && set) sessionStorage[pref.script_prefix+'.pref']=JSON.stringify(pref_func.site2_json_ex_remove());}\r\n        else {if (sessionStorage && (set||make_obj)) sessionStorage[pref.script_prefix+'.pref'] = JSON.stringify(pref);}\r\n      },\r\n      apply_prep_set: function(parent, tgt, fm, name){ // don't set if parent[tgt]===undefined, ex.time_quick_sel\r\n        var type = typeof(parent[tgt]);\r\n        if (type==='number') {\r\n          var val;\r\n          parent[tgt] = (fm.tagName==='SELECT')? fm.selectedIndex\r\n                      : (val = (name && name.substr(-2)==='_f')? parseFloat(fm.value) : parseInt(fm.value,10), isNaN(val)? 0 : val)\r\n        } else if (type==='boolean') parent[tgt] = fm.checked;\r\n        else if (type==='string') if (fm.type==='text'|| fm.checked) parent[tgt] = fm.value;\r\n      },\r\n      apply_prep_load: function(fm, parent, tgt){\r\n        var val = parent[tgt];\r\n        if (fm.tagName==='SELECT') {\r\n          if (val>=fm.length) parent[tgt] = 0;\r\n          fm.selectedIndex = parent[tgt];\r\n        } else { // INPUT\r\n          var type = typeof(val);\r\n          if      (type=='number' ) fm.value = val;\r\n          else if (type=='boolean') fm.checked = val;\r\n          else if (type=='string' ) if (fm.type==='text') fm.value = val;\r\n          else if (val === fm.value) fm.checked = true;\r\n        }\r\n      },\r\n      apply_prep_2_str: {\r\n        't2h_sel:L': function(parent){return parent['t2h_L'];},\r\n        't2h_sel:M': function(parent){return parent['t2h_M'];},\r\n        't2h_sel:N': function(parent){return parent['t2h_N'];},\r\n        't2h_sel:N_unread': function(parent){return parent['t2h_N']+'+unread';},\r\n        't2h_sel:unread': 'All unread',\r\n        'posts_search_op:opaque': function(parent){return 'opaque '+parent['posts_search_op_opacity']+'%';},\r\n        'popup2:sr': 'SearchResult',\r\n        'popup2:srpv': 'SearchResult/Preview',\r\n        'popup2:pv': 'Preview',\r\n        'popup2:chart': 'PostRateChart',\r\n        'popup2:dp': 'DeletedPosts',\r\n      },\r\n//      make_pref_obj : function(name){ // copy of part of apply_prep.\r\n//        var target_hier = pref_func.get_tgt(name);\r\n//        var parent = target_hier[0];\r\n//        var tgt    = target_hier[1];\r\n//        if (tgt.search(/str$/)!=-1 && parent[tgt.replace(/str$/,'obj')]) pref_func.str2obj(tgt);\r\n//        if (tgt.search(/str$/)!=-1 && parent[tgt.replace(/str$/,'obj2')]) pref_func.str2obj2(parent,tgt.replace(/str$/,'obj2'),parent[tgt]);\r\n//      },\r\n      catalog_board_list_str_or: '',\r\n      catalog_board_list_str_bt: '',\r\n      catalog_board_list_str_bt_same: '',\r\n      add_onchange: function(pn,func_obj, func_obj2){ // obj2 for oninput\r\n        return this.set_event_target(pn, this.add_onchange_entry_func.bind(func_obj), func_obj2);\r\n      },\r\n      add_onchange_entry_func: function(e, propagate){ // always used after binded.\r\n        var pn_name = e.currentTarget.getAttribute('name'); // for <span>\r\n        if (!propagate && ['INPUT','TEXTAREA','SELECT'].indexOf(e.currentTarget.tagName)!=-1) pref_func.apply_prep(e.currentTarget,true);\r\n        if (this[pn_name]) this[pn_name].call(e.currentTarget,e); // exact match\r\n        else {\r\n          var idx = pn_name.indexOf('.');\r\n          if (idx!=-1) {\r\n            var name = pn_name.substr(idx); // *.XXX\r\n            if (this['*'+name]) this['*'+name].call(e.currentTarget,e);\r\n            else if (this['*w/'+name]) this['*w/'+name].call(e.currentTarget,e,pn_name);\r\n            else {\r\n              var idx_l = pn_name.lastIndexOf('.');\r\n              if (idx_l!=-1) {\r\n                var name = pn_name.substr(0,idx_l+1)+'*'; // XXX.YYY.*\r\n                if (this[name]) this[name].call(e.currentTarget,e);\r\n                else if (this[name+'w/']) this[name+'w/'].call(e.currentTarget,e,pn_name); // XXX.YYY.*s with source name\r\n                else if (idx!=-1) { // hierarchy approach\r\n                  var name_0 = pn_name.substr(0,idx); // XXX.YYY\r\n                  var name_1 = pn_name.substr(idx+1);\r\n                  if (this[name_0] && this[name_0][name_1]) this[name_0][name_1](e); // NO THIS EMULATION.\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n//        var pn = e.target.parentNode; // 'Filter' doesn't have stopper.\r\n//        while (pn && pn!==site.script_body) {\r\n//          if (pn.getAttribute('name')==='SUB') this['SUB'].call(pn,{currentTarget:pn});\r\n//          pn = pn.parentNode;\r\n//        }\r\n      },\r\n      add_onchange_format: function(func_obj){\r\n        var keys = Object.keys(func_obj);\r\n        for (var i=0;i<keys.length;i++) if (typeof(func_obj[keys[i]])==='string') func_obj[keys[i]] = func_obj[func_obj[keys[i]]];\r\n        return func_obj;\r\n      },\r\n////      add_onchange: function(pn,func_obj, func_obj2){ // obj2 for oninput // working code.\r\n////        var call_tgt = func_obj;\r\n////        if (typeof(func_obj)!=='function') { // object\r\n////          for (var i in func_obj) if (typeof(func_obj[i])==='string') func_obj[i] = func_obj[func_obj[i]];\r\n////          if (func_obj2) for (var i in func_obj2) if (typeof(func_obj2[i])==='string') func_obj2[i] = func_obj2[func_obj2[i]];\r\n//////          func_obj.func_default = function(){ // cause EventListener leak.\r\n//////            pref_func.apply_prep(this,true);\r\n//////            if (func_obj[this.name]) func_obj[this.name](this);\r\n//////          };\r\n//////          call_tgt = func_obj.func_default;\r\n////          call_tgt = func_obj.entry_func;\r\n////        }\r\n////        this.set_event_target(pn,call_tgt, func_obj2);\r\n////      },\r\n      set_event_target: (function(){\r\n        var inst_while_input = null;\r\n        function prep_beforeunload(e){\r\n          inst_while_input = (e)? e.target : null;\r\n        }\r\n        function set_val_beforeunload(){\r\n          if (inst_while_input) pref_func.apply_prep(inst_while_input,true);\r\n        }\r\n        window.addEventListener('beforeunload', set_val_beforeunload, false);\r\n        return function(pn,tgt, func_obj2){\r\n          var tgt_wrapped = function(e, propagate){inst_while_input=null;tgt.call(this,e, propagate);};\r\n          var fm = pn.getElementsByTagName('*');\r\n          if (fm.length==0) fm = [pn];\r\n          for (var i=0;i<fm.length;i++) {\r\n            var name = fm[i].getAttribute('name');\r\n            if (!name) continue; // for span // if (!fm[i].name) continue;\r\n            var tagName = fm[i].tagName;\r\n            if (tagName==='INPUT' || tagName==='TEXTAREA' || tagName==='SELECT') {\r\n              if (func_obj2 && func_obj2[fm[i].name]) fm[i].oninput = tgt_wrapped;\r\n              else {\r\n                fm[i].onchange = tgt_wrapped;\r\n                if ((tagName==='INPUT' && fm[i].type==='text') || tagName==='TEXTAREA') fm[i].oninput = prep_beforeunload;\r\n              }\r\n            } else if (tagName==='BUTTON') fm[i].onclick = tgt_wrapped; // OK.\r\n            else if (tagName==='A') {\r\n              if (name==='SHOW' || name==='SHOWALL' || name==='HIDEALL' || name==='SHOW2' || name==='SHOW3' || name==='HIDE3') fm[i].onclick = tgt;\r\n            } else if (tagName==='SPAN' || tagName==='DIV') {\r\n//              if (name==='NEXT') fm[i].onclick = tgt;\r\n              if (name==='SUB') fm[i].onchange = tgt; // called twice times when INPUT in SUB is changed.\r\n              if (name==='SHOW2_I' || name==='SHOW4' || name==='HIDE4') fm[i].onclick = tgt;\r\n            }\r\n          }\r\n          return tgt_wrapped;\r\n        };\r\n      })(),\r\n//      remove_onchange: function(pn){this.set_event_target(pn,null);},\r\n//      invoke_onchange: function(pn){\r\n//        var evt = document.createEvent('UIEvents');\r\n//        evt.initUIEvent('change', false, true, window, 1);\r\n//        pn.dispatchEvent(evt);\r\n//      },\r\n      str2obj: function(key) {\r\n//        var tgt = key+'_obj';\r\n        var tgt = key.replace(/str$/,'obj');\r\n        pref[tgt] = [];\r\n        tgt = pref[tgt];\r\n        var bg_str = (site.whereami==='boards')? site2[site.nickname].boards_sel_from_tags() :\r\n                     site.board + ((site.whereami==='thread')? site.no : '');\r\n        if (bg_str==='//') bg_str = '/ROOT_DUMMY/';\r\n        bg_str += ',' + bg_str + '\\n' + pref[key] + '\\n';\r\n        if (pref.catalog.board.recommendation) {\r\n//          var blotter = document.getElementsByClassName('blotter')[0];\r\n//          if (blotter) {\r\n//            or_str = document.getElementsByClassName('blotter')[0][brwsr.innerText];\r\n//            var kwd = 'Recommendation: ';\r\n//            var idx = or_str.indexOf(kwd);\r\n//            if (idx!=-1) {\r\n//              var or = or_str.substr(idx+kwd.length);\r\n//              pref_func.catalog_board_list_str_or = or;\r\n//              lines.push(or);\r\n//            }\r\n//          }\r\n          var or = site2[site.nickname].get_owners_recommendation();\r\n          pref_func.catalog_board_list_str_or = or;\r\n//          lines.push(or);\r\n          bg_str = bg_str + or + '\\n';\r\n        }\r\n//        if (pref.catalog.board.board_tags && pref_func.catalog_board_list_str_bt!=='') lines.push(pref_func.catalog_board_list_str_bt);\r\n//        if (pref.catalog.board.board_tags_same && pref_func.catalog_board_list_str_bt_same!=='') lines.push(pref_func.catalog_board_list_str_bt_same);\r\n        if (pref.catalog.board.board_tags && pref_func.catalog_board_list_str_bt!=='') bg_str = bg_str + pref_func.catalog_board_list_str_bt + '\\n';\r\n        if (pref.catalog.board.board_tags_same && pref_func.catalog_board_list_str_bt_same!=='') bg_str = bg_str + pref_func.catalog_board_list_str_bt_same + '\\n';\r\n        var lines = bg_str.split('\\n');\r\n        var bn = -1;\r\n        for (var i=0;i<lines.length;i++) {\r\n          var fields = lines[i].replace(/\\s*\\/\\/.*/,'').replace(/, +/g,',').split(',');\r\n          var j=0;\r\n          while (j<fields.length && fields[j]=='') j++;\r\n          if (fields[j]) {\r\n            tgt[++bn] = [{key:fields[j++]}];\r\n            var idx=0;\r\n            while (j<fields.length) {\r\n              if (fields[j]!==''){\r\n                if (fields[j].search(/^\\s*!?#/)!==-1) {\r\n                  if (!tgt[bn][0].tags) tgt[bn][0].tags=[];\r\n                  tgt[bn][0].tags[tgt[bn][0].tags.length] = fields[j].replace(/\\s/g,'');\r\n                } else if (fields[j].search(/^\\s*!/)!==-1) {\r\n                  if (!tgt[bn][0].cmds) tgt[bn][0].cmds=[];\r\n                  tgt[bn][0].cmds[tgt[bn][0].cmds.length] = fields[j].replace(/\\s/g,'').substr(1);\r\n                } else {\r\n                  tgt[bn][++idx] = {};\r\n                  tgt[bn][idx].key = fields[j].replace(/[\\*\\^!].*/,'').replace(/\\s/g,'')\r\n                  if (fields[j].search(/\\*/)!=-1) tgt[bn][idx].max_page  = parseInt(fields[j].replace(/[^\\*\\^!]*[\\*\\^!]/,'').replace(/[\\^!].*/,''),10);\r\n                  if (fields[j].search(/\\^/)!=-1) tgt[bn][idx]['style' ] = fields[j].replace(/[^\\*\\^!]*[\\*\\^!]/,'').replace(/[\\*!].*/,'');\r\n//                  if (fields[j].search(/\\!/)!=-1) tgt[bn][idx]['search'] = fields[j].replace(/[^\\*\\^!]*[\\*\\^!]/,'').replace(/[\\*\\^].*/,'');\r\n//                  tgt[bn][idx].key = fields[j].replace(/[\\*%!].*/,''); // working code..., but '%' is used in URL...\r\n//                  if (fields[j].search(/\\*/)!=-1) tgt[bn][idx]['num'   ] = fields[j].replace(/[^\\*%!]*[\\*%!]/,'').replace(/[%!].*/,'');\r\n//                  if (fields[j].search(/\\%/)!=-1) tgt[bn][idx]['style' ] = fields[j].replace(/[^\\*%!]*[\\*%!]/,'').replace(/[\\*!].*/,'');\r\n//                  if (fields[j].search(/\\!/)!=-1) tgt[bn][idx]['search'] = fields[j].replace(/[^\\*%!]*[\\*%!]/,'').replace(/[\\*%].*/,'');\r\n                }\r\n              }\r\n              j++;\r\n            }\r\n          }\r\n        }\r\n        if (pref.catalog.board.all_boards) tgt[tgt.length] = [{key:'ALL'},{key:site.nickname}];\r\n        for (var i=0;i<tgt.length;i++) {\r\n          for (var j=1;j<tgt[i].length;j++) {\r\n            var dm = tgt[i][j].key.replace(/\\/.*/,'');\r\n            if (dm=='') dm=site.nickname;\r\n            var bd = '/'+ tgt[i][j].key.replace(/[^\\/]*\\//,'').replace(/\\/.*/,'') +'/';\r\n            if (j==1) {\r\n              tgt[i][0]['domain']= dm;\r\n              tgt[i][0]['board' ]= bd;\r\n            } else {\r\n              if (tgt[i][0]['domain']!=dm) tgt[i][0]['domain']=null;\r\n              if (tgt[i][0]['board' ]!=bd) tgt[i][0]['board' ]=null;\r\n            }\r\n          }\r\n        }\r\n        for (var i=0;i<tgt.length;i++)\r\n          for (var j=1;j<tgt[i].length;j++) {\r\n            var dbt = common_func.name2domainboardthread(tgt[i][j].key,false);\r\n            tgt[i][j].key = common_func.name2domainboardthread(tgt[i][j].key,true).join(''); // patch\r\n            if (dbt[1]==='' && dbt[2]==='') {\r\n              if (!tgt[i][0].domains_for_all_boards) tgt[i][0].domains_for_all_boards = [];\r\n              tgt[i][0].domains_for_all_boards[tgt[i][0].domains_for_all_boards.length] = dbt[0];\r\n              tgt[i].splice(j--,1);\r\n            }\r\n          }\r\n      },\r\n      get_tgt: function(name, parent, exact){\r\n        if (!parent) parent = (name[0]==='#')? liveTag.tags : pref;\r\n        var tgts = name.split('.');\r\n        for (var j=0;j<tgts.length;j++)\r\n          if (!exact || parent[tgts[j]]!==undefined) {\r\n            if (j!=tgts.length-1) parent = parent[tgts[j]];\r\n            else return [parent,tgts[j]];\r\n          } else return null;\r\n      },\r\n      str2obj2: (function(){\r\n        function set_vals(tgt,key,vals_in,completion){\r\n          if (vals_in) {\r\n            if (!tgt[key]) tgt[key] = {};\r\n            var vals = vals_in[0].substr(1).split(';');\r\n            for (var j=0;j<vals.length;j++) {\r\n              var val = vals[j].split(':');\r\n              if (completion) {\r\n                if (val.length===1 || val[1]==='true') val[1] = true;\r\n                else if (val[1]==='false') val[1] = false;\r\n              }\r\n              tgt[key][val[0]] = val[1];\r\n            }\r\n          }\r\n        }\r\n        function func_org(field, tgt){\r\n          var name = field.replace(/[@\\^!].*/,'') || 'DEFAULT';\r\n          if (tgt[name]===undefined) tgt[name] = {};\r\n//          var time = field.match(/@[^\\^!]*/);\r\n//          if (time) tgt[name].time = Date.parse(time[0].replace(/@/,''));\r\n          var time = field.match(/@([^\\^!]*)/);\r\n          if (time) tgt[name].time = (time[1]==0)? 0 : brwsr.Date_parse(time[1]); // Date.parse(0) returns 2000/1/1 0:00. '==0' is intended, 0 is string in this case.\r\n          set_vals(tgt[name],'style',field.match(/\\^[^@!]*/));\r\n          set_vals(tgt[name],'cmd'  ,field.match(/![^@\\^]*/),true);\r\n        }\r\n        return function(parent,key,str, keep, obj2_only, func){\r\n          if (!keep) parent[key] = {};\r\n          var tgt = parent[key];\r\n          var fields = str.replace(/\\s*\\/\\/.*/mg,'').replace(/\\n/g,',').split(/\\s*,\\s*/);\r\n          if (!func) func = func_org;\r\n          for (var i=0;i<fields.length;i++) if (fields[i]) func(fields[i],tgt);\r\n          if (obj2_only) return tgt;\r\n          var key3 = key.replace(/_obj2/,'_obj3');\r\n          parent[key3] = {};\r\n          var tgt3 = parent[key3];\r\n          for (var i in tgt) tgt3[i.replace(/\\/[0-9]+$/,'/')] = true;\r\n        }\r\n      })(),\r\n      str2obj2_func_for_val: function(field, tgt){\r\n        field = field.replace(/\\s*/g,'');\r\n        var idx = field.indexOf(':');\r\n        var name = (idx>=1)? field.substr(0,idx) : 'DEFAULT';\r\n        tgt[name] = field.substr(idx+1);\r\n      },\r\n////      str2obj2: function(parent,key,str){ // working code.\r\n////        parent[key] = {};\r\n////        tgt = parent[key];\r\n////        var fields = str.replace(/\\/\\/.*/mg,'').replace(/\\n/g,',').split(',');\r\n////        for (var i=0;i<fields.length;i++) {\r\n////          if (fields[i]=='') continue;\r\n////          var name  = fields[i].replace(/[@%].*/,'');\r\n////          if (name=='') name = 'DEFAULT';\r\n////          var attr  = fields[i].match(/[@%].*/);\r\n////          var time  = (attr!=null)? attr[0].replace(/%[^@]*(@|$)/,'').replace(/@/,'') : null;\r\n////          var style = (attr!=null)? attr[0].replace(/@[^%]*(%|$)/,'').replace(/%/,'') : null;\r\n////          if (tgt[name]===undefined) tgt[name] = {};\r\n////          if (time ) tgt[name]['time']  = Date.parse(time);\r\n//////          if (style) tgt[name]['style'] = style;\r\n////          if (style) {\r\n////            if (!tgt[name].style) tgt[name].style = {};\r\n////            var styles = style.split(';');\r\n////            for (var j=0;j<styles.length;j++) {\r\n////              var stl = styles[j].split(':');\r\n////              tgt[name].style[stl[0]] = stl[1];\r\n////            }\r\n//////            tgt[name]['style'] = true;\r\n//////            var styles = style.split(';');\r\n//////            for (var j=0;j<styles.length;j++) {\r\n//////              var stl = styles[j].split(':');\r\n//////              tgt[name]['style.'+stl[0]] = stl[1];\r\n//////            }\r\n////          }\r\n////        }\r\n////        var key3 = key.replace(/_obj2/,'_obj3');\r\n////        parent[key3] = {};\r\n////        var tgt3 = parent[key3];\r\n////        for (var i in tgt) tgt3[i.replace(/\\/[0-9]+$/,'/')] = true;\r\n////      },\r\n//      str2obj4: function(parent,key,str) {\r\n//        parent[key] = this.style2obj(str);\r\n//      },\r\n//      style2obj: function(str) {\r\n//        var fields  = str.split(';');\r\n//        for (var i=fields.length-1;i>=0;i--) {\r\n//          if (fields[i]) {\r\n//            var coms = fields[i].replace(/\\s/g,'').split(':');\r\n//            fields[i] = '\"'+coms[0]+'\":\"'+coms[1]+'\"';\r\n//          } else fields.splice(i,1);\r\n//        }\r\n//        return JSON.parse('{' + fields.join(',') + '}');\r\n//      },\r\n      str2obj5: function(parent,key,str_in, flag_g){\r\n        parent[key] = {};\r\n        tgt = parent[key];\r\n        var fields = str_in.replace(/\\s*\\/\\/.*/mg,'').replace(/\\n/g,',').split(',');\r\n        for (var i=0;i<fields.length;i++) {\r\n          var fd = fields[i].replace(/\\s*:\\s*/,':').replace(/\\s+$/,'');\r\n          if (fd=='') continue;\r\n          var idx = fd.indexOf(':'); // tags never contains ':'\r\n          var name = (idx!=-1)? fd.substr(0,idx) : 'DEFAULT';\r\n          var idx2;\r\n          var rx = fd[idx+1]==='/' && (idx2 = fd.lastIndexOf('/'), idx2>idx+2);\r\n          var str = (rx)? fd.slice(idx+2,idx2) : fd.slice(idx+1);\r\n          var flags = (flag_g? 'g':'') + (rx? fd.slice(idx2+1).replace(/g/,'') : '');\r\n          if (tgt[name]===undefined) tgt[name] = [];\r\n          try {\r\n            tgt[name][tgt[name].length] = new RegExp((rx)? str : this.str2rstr(str, flag_g), flags);\r\n          } catch(e) {\r\n            console.log('ERROR at str2obj5 in string of: '+fields[i]);\r\n          }\r\n//          tgt[name][tgt[name].length] = (fields[i][idx+1]==='/')? new RegExp(fields[i].substr(idx+2,fields[i].lastIndexOf('/')-idx-2),fields[i].substr(fields[i].lastIndexOf('/')+1)) :\r\n//                                        (key==='ex_list_obj5')? new RegExp(fields[i].substr(idx+1).replace(/\\*/g,'.*')) :\r\n//                                                                new RegExp(fields[i].substr(idx+1).replace(/\\*/g,'\\\\S*(\\\\s|$)'),'g');\r\n//          tgt[name][tgt[name].length] = new RegExp('#'+(fields[i][idx]==='/')? fields[i].substr(idx+1) :\r\n//                                                                               fields[i].substr(idx+1).replace(/\\*/,'.*'));\r\n        }\r\n      },\r\n      str2rstr: function(str,flag_g){\r\n        return str.replace(/[\\.\\(\\)\\[\\]\\+\\^\\$\\{\\}]/g,'\\\\$&').replace(/\\*/g,flag_g?'\\\\S*(\\\\s|\\\\n|$)':'.*').replace(/\\?/g,'.');\r\n      },\r\n//      str2obj8: (function(){ // not tested\r\n//        var idx;\r\n//        var proto = {re:false, ci:false, match:0, sentence:false, op:true, post:false,\r\n//                     sub:true, name:true, trip:false, com:true, file:false, meta:false, flag:false, id:false,    rexps:null};\r\n//        return {\r\n//          str2obj: function(parent,key,str_pref){\r\n//            parent[key] = {};\r\n//            tgt = parent[key];\r\n//            var fields = str_pref.replace(/\\s*\\/\\/.*/mg,'').replace(/\\n/g,',').split(',');\r\n//            var flag_g = key==='rm_list_obj5';\r\n//            var json = key==='auto_list_obj5';\r\n//            for (var i=0;i<fields.length;i++) {\r\n//              var fd = fields[i].replace(/\\s*:\\s*/,':').replace(/\\s+$/,'');\r\n//              if (fd=='') continue;\r\n//              var idx = fd.indexOf(':'); // tags never contains ':'\r\n//              try {\r\n//                var val = json? func_json(fd) : func_str(fd, flag_g); // must be preceded, this may change idx\r\n//              } catch(e) {\r\n//                console.log('ERROR at str2obj5 in string of: '+fd);\r\n//              }\r\n//              var name = (idx!=-1)? fd.substr(0,idx) : 'DEFAULT';\r\n//              if (tgt[name]===undefined) tgt[name] = [];\r\n//              tgt[name][tgt[name].length] = val;\r\n//            }\r\n//          },\r\n//          obj2str: function(obj){\r\n//            var tgt = common_func.deep_copy(obj);\r\n//            pref_func.obj_elim_the_same(tgt,proto);\r\n//            return JSON.stringify(tgt);\r\n//          }\r\n//        };\r\n//        function func_str(fd, flag_g){\r\n//          var idx2;\r\n//          var rx = fd[idx+1]==='/' && (idx2 = fd.lastIndexOf('/'), idx2>idx+2);\r\n//          var str = (rx)? fd.slice(idx+2,idx2) : fd.slice(idx+1);\r\n//          var flags = (flag_g? 'g':'') + (rx? fd.slice(idx2+1).replace(/g/g,'') : '');\r\n//          return new RegExp((rx)? str : this.str2rstr(str, flag_g), flags);\r\n//        }\r\n//        function func_json(fd){\r\n//          var idx2 = fd.indexOf('{');\r\n//          if (idx2<idx) idx = -1;\r\n//          var obj = JSON.parse(fd.slice(idx+1));\r\n//          obj.__proto__ = proto;\r\n//          obj.rexps = common_func.kwd_prep_regexp(obj);\r\n//          return obj;\r\n//        }\r\n//      })(),\r\n      str2obj7: (function(){\r\n        var proto = {use:true, str:'', re:false, ci:true, match:0, sentence:false, op:true, post:false,\r\n                     sub:true, name:true, trip:false, com:true, file:false, meta:false, flag:false, id:false, cmds:''};\r\n        return {\r\n          s2o: function(parent,key,str_in){\r\n            parent[key] = {};\r\n            tgt = parent[key];\r\n            var fields = str_in.replace(/\\s*\\/\\/.*/mg,'').split(/\\s*\\n\\s*/);\r\n            for (var i=0;i<fields.length;i++) {\r\n              var fd = fields[i].trim().replace(/\\s*:\\s*/,':');\r\n              if (fd=='') continue;\r\n              var idx = fd.indexOf(':');\r\n              var idx2 = fd.indexOf('{');\r\n              if (idx2<idx) idx = idx2-1;\r\n              var name = (idx!=-1)? fd.substr(0,idx) : 'DEFAULT';\r\n              if (tgt[name]===undefined) tgt[name] = [];\r\n              try {\r\n                var obj = JSON.parse(fd.slice(idx2));\r\n                obj.__proto__ = proto;\r\n                obj.rexps = common_func.kwd_prep_regexp(obj);\r\n                tgt[name][tgt[name].length] = obj;\r\n              } catch(e) {\r\n                console.log('ERROR at str2obj7 in string of: '+fields[i]);\r\n              }\r\n            }\r\n          },\r\n          o2s: function(obj){\r\n            var tgt = {};\r\n            for (var i in proto) if (proto[i]!=obj[i]) tgt[i] = obj[i];\r\n            delete tgt['use'];\r\n            if (obj.sentence && obj.str.indexOf(' ')===-1) delete tgt['sentence'];\r\n            return JSON.stringify(tgt);\r\n          },\r\n        };\r\n      })(),\r\n      merge_obj5: function(name,obj,val){\r\n        return this.merge_obj5_all(name,obj,val,this.merge_obj5_1);\r\n      },\r\n      merge_obj5a: function(th,obj,val){\r\n        return this.merge_obj5_all(th.key,obj,val,this.merge_obj5_1a);\r\n      },\r\n      merge_obj5a_sc: function(name,obj,val){ // short cut logic.\r\n        if (!obj) return val;\r\n        var dbt = common_func.fullname2dbt(name);\r\n        return obj[name] ||\r\n               obj[dbt[1]+dbt[2]] || // board+thread\r\n               obj[dbt[0]+dbt[2]] || // domain+thread\r\n               obj[dbt[2]] || // thread\r\n               obj[dbt[0]+dbt[1]] || // domain+board\r\n               obj[dbt[1]] || // board\r\n               obj[dbt[0]] || // domain\r\n               obj['DEFAULT'] || val;\r\n      },\r\n      merge_obj5_all: function(name,obj,val,func){\r\n        var dbt = common_func.fullname2dbt(name);\r\n        val = func(val,obj,'DEFAULT');\r\n        val = func(val,obj,dbt[0]); // domain\r\n        val = func(val,obj,dbt[1]); // board\r\n        val = func(val,obj,dbt[0]+dbt[1]); // domain+board\r\n        val = func(val,obj,dbt[2]); // thread\r\n        val = func(val,obj,dbt[0]+dbt[2]); // domain+thread\r\n        val = func(val,obj,dbt[1]+dbt[2]); // board+thread\r\n        val = func(val,obj,name);\r\n        return val;\r\n      },\r\n      merge_obj5_1: function(val,obj,key){\r\n        if (obj[key]) {\r\n          var obj_key = obj[key];\r\n//          if (Array.isArray(obj_key)) return obj_key.concat(val || []);\r\n          if (!val) val = {};\r\n          if (val.hit!==undefined) val.hit = true;\r\n          for (var i in obj_key)\r\n            if (typeof(obj_key[i])!=='object') val[i] = obj_key[i];\r\n            else {\r\n              if (val[i]===undefined) val[i]={};\r\n              for (var j in obj_key[i]) val[i][j] = obj_key[i][j]; // 2nd level.\r\n            }\r\n        }\r\n        return val;\r\n      },\r\n      merge_obj5_1a: function(val,obj,key){\r\n        var tgt = obj[key];\r\n        return tgt? (val? tgt.concat(val) : tgt) : val;\r\n      },\r\n      str2obj6: function(parent,key,val,name){\r\n        var obj_hier  = pref_func.get_tgt(name, pref3);\r\n        obj_hier[0][obj_hier[1]](obj_hier[0],key,val);\r\n      },\r\n      obj_init_hier: function(dst, src){\r\n        for (var i in dst) {\r\n          if (typeof(dst[i])==='object' && src[i]) this.obj_init_hier(dst[i], src[i]); // stopped by null.\r\n          else if (typeof(dst[i])==='function') dst[i](dst, i, src[i]);\r\n        }\r\n      },\r\n      obj_init: function(){\r\n        pref_func.str2obj('catalog_board_list_str');\r\n        pref_func.str2obj2(pref.catalog,'style_general_list_obj2',pref.catalog.style_general_list_str);\r\n        pref_func.str2obj2(pref.catalog.board,'ex_list_obj2',pref.catalog.board.ex_list_str);\r\n//        pref_func.str2obj4(pref.liveTag, 'style_urtm_obj4', pref.liveTag.style_urtm_str);\r\n//        pref_func.str2obj4(pref.liveTag, 'style_ur_obj4',   pref.liveTag.style_ur_str);\r\n//        pref_func.str2obj4(pref.liveTag, 'style_in_obj4',   pref.liveTag.style_in_str);\r\n        pref_func.str2obj5(pref.liveTag, 'ex_list_obj5',    pref.liveTag.ex_list_str);\r\n        pref_func.str2obj5(pref.liveTag, 'rm_list_obj5',    pref.liveTag.rm_list_str);\r\n        pref_func.settings.onchange_funcs.archive['kwd.*'](); // archiver.event_funcs['kwd.*'](); can't use this because it doesn't exist at this time.\r\n        this.obj_init_hier(pref3, pref);\r\n      },\r\n      obj_elim_the_same: function(dst,src, not_root, no_copy){\r\n        return this.obj_elim_the_same_1(new Set(), dst,src, not_root, no_copy);\r\n      },\r\n      obj_elim_the_same_1: function(done_list, dst,src, not_root, no_copy){\r\n        var flag = false;\r\n        for (var i in dst) {\r\n          if (typeof(dst[i])==='object' && src[i] && typeof(src[i])==='object') { // eliminates objects made by program automatically because original object are vacant.\r\n            if (!dst.hasOwnProperty(i)) continue;\r\n            if (done_list.has(dst[i])) continue; else done_list.add(dst[i]); // blocks getters\r\n            if (!pref_func.obj_elim_the_same_1(done_list, dst[i],src[i], true, no_copy)) {delete dst[i]; done_list.add(src[i]);}\r\n            else {\r\n              flag = true;\r\n              if (!no_copy) if (Array.isArray(dst[i]) || Array.isArray(src[i])) dst[i] = src[i];\r\n            }\r\n          } else {\r\n            if (dst[i]===src[i]) delete dst[i];\r\n            else {\r\n              flag = true;\r\n              if (!no_copy) dst[i]=src[i];\r\n            }\r\n          }\r\n        }\r\n        if ((Array.isArray(dst) || Array.isArray(src)) && dst.length!==src.length) flag = false;\r\n        return (not_root)? flag : dst;\r\n      },\r\n      site2_json_ex_remove: function(){\r\n        var pref_test = pref_default(true);\r\n        delete pref_test.catalog_board_list_obj;\r\n        delete pref_test.catalog.style_general_list_obj2;\r\n        delete pref_test.catalog.board.ex_list_obj2;\r\n//        delete pref_test.liveTag.style_urtm_obj4;\r\n//        delete pref_test.liveTag.style_ur_obj4;\r\n//        delete pref_test.liveTag.style_in_obj4;\r\n//        delete pref_test.liveTag.ex_list_obj5;\r\n//        delete pref_test.liveTag.rm_list_obj5;\r\n//        if (pref_test.settings) delete pref_test.settings;\r\n//        if (pref_test.graph) delete pref_test.graph;\r\n        pref_func.obj_elim_the_same(pref_test,pref); // proto might be removed\r\n        var proto = pref_default().proto;\r\n        ['catalog','page','thread','float'].forEach(function(v){ // 'v => {' can use 'this' instead of 'pref_func'.\r\n          if (!pref_func.obj_elim_the_same(pref_test[v], proto, true, true)) delete pref_test[v];});\r\n        delete pref_test.page.footer;\r\n        delete pref_test.thread.footer;\r\n//        delete pref_test.float.footer;\r\n        return pref_test;\r\n      },\r\n      site2_json_ex: function(full, filter){\r\n        var pref_test = this.site2_json_ex_remove();\r\n        if (!filter) if (pref_test.catalog.filter) delete pref_test.catalog.filter;\r\n        if (!full) if (pref_test.catalog_board_list_str) delete pref_test.catalog_board_list_str;\r\n        if (pref_test.overwrite_site2_json_str) delete pref_test.overwrite_site2_json_str;\r\n        if (!filter) pref.overwrite_site2_json_str = '{\"pref\":' + JSON.stringify(pref_test) + '}';\r\n        else pref.overwrite_site2_json_str = '{\"pref\":{\"catalog\":{\"filter\":' + JSON.stringify(pref_test.catalog.filter) + '}}}';\r\n      },\r\n      pref_query: function(ref,src){\r\n        var str = '';\r\n        for (var i in src) {\r\n          if (ref[i]!==undefined) {\r\n            str += '\"' + i + '\":' +\r\n                   ((typeof(src[i])==='object' && !Array.isArray(src[i]))? pref_func.pref_query(ref[i],src[i]) :\r\n                                                                           JSON.stringify(ref[i]))\r\n                 + ',';\r\n          }\r\n        }\r\n        return '{' + str.substr(0,str.length-1) + '}';\r\n      },\r\n      site2_eval: function(){\r\n//        try { \r\n//          if (pref.overwrite_site2_eval_str!=='') eval(pref.overwrite_site2_eval_str);\r\n//        } catch (e) {\r\n//          console.log('ERROR in overwtite strings:');\r\n//          console.log(pref.overwrite_site2_eval_str);\r\n//          console.log(e);\r\n//        }\r\n      },\r\n      tooltips: (site0.isStep)? null : (function(){\r\n        var tooltip = document.createElement('div');\r\n        tooltip.style.position = 'fixed';\r\n////        tooltip.style.background = '#e5f4f9';\r\n////        tooltip.style.color = '#000000';\r\n////        tooltip.style.border = '2px solid blue';\r\n//          tooltip.style.fontWeight = 'normal';\r\n        tooltip.setAttribute('class', pref.script_prefix+'_popUp');\r\n        tooltip.style.zIndex = pref.tooltips.zIndex;\r\n        var tooltip_on = null;\r\n//        var tooltip_shown = false;\r\n        var tooltip_kind = 'help';\r\n//        var func = {};\r\n        var show_timer = null;\r\n        var hide_timer = null;\r\n//        var str_tooltip = '';\r\n\r\n//        function add_hier(pn){ // working code\r\n//          var all = pn.getElementsByTagName('*');\r\n////          if (pref.test_mode.tips) for (var i=0;i<all.length;i++) if (!str[all[i].name]) str[all[i].name] = 'Name: ' + all[i].name;\r\n////          for (var i=0;i<all.length;i++) if (all[i].name) add(all[i]); // span can't return if .name\r\n//          for (var i=0;i<all.length;i++) {\r\n//            var name = all[i].getAttribute('name');\r\n//            if (name && (str[name] || (str[name]!==false && pref.test_mode.tips))) add(all[i]);\r\n//          }\r\n//        }\r\n//        function remove_hier(pn){\r\n//          var all = pn.getElementsByTagName('*');\r\n////          for (var i=0;i<all.length;i++) if (all[i].name) remove(all[i]);\r\n//          for (var i=0;i<all.length;i++) if (all[i].hasAttribute('name')) remove(all[i]);\r\n//        }\r\n//        function add(elem){\r\n//////          if (str.hasOwnProperty(elem.name)) {\r\n//            if (!func.hasOwnProperty(elem.name)) func[elem.name] = [];\r\n//            func[elem.name].push(elem);\r\n//            elem.addEventListener('mouseover', show, false);\r\n//////          }\r\n//        }\r\n//        function remove(elem){\r\n//          if (func.hasOwnProperty(elem.name)) {\r\n//            var elems = func[elem.name];\r\n//            for (var i=0;i<elems.length;i++) {\r\n//              if (elem===elems[i]) {\r\n//                elem.removeEventListener('mouseover', show, false);\r\n//                elems.splice(i,1);\r\n//                if (elems.length==0) delete func[elem.name];\r\n//                break;\r\n//              }\r\n//            }\r\n////            for (var i=0;i<elems.length;i++) {\r\n////              var elem = func[elem.name][i];\r\n////              elem.removeEventListener('mouseover', show, false);\r\n////            }\r\n////            delete func[elem.name];\r\n//          }\r\n//        }\r\n        function show(e){\r\n//          if (!pref.tooltips.help.show) return;\r\n          var name = e && (e.target.name || e.target.getAttribute('name')) || this.name;\r\n          if (name && e && e.target.type==='radio') name += ', '+e.target.value;\r\n          if (!name && e.target.tagName==='LABEL') name = e.target.childNodes[0].name + (e.target.childNodes[0].type==='radio'? ', '+e.target.childNodes[0].value : '');\r\n          if (name==='SHOW2_I') name = e.target.previousSibling.childNodes[1].getAttribute('name');\r\n          if (name==='SHOW2') name = e.target.childNodes[1].getAttribute('name');\r\n          if (!name) return; // for add_root\r\n//          var name = this.name || this.getAttribute('name')); // for add_hier\r\n////          for (var i in str_func) if (this.name.indexOf(i)==0) {\r\n////            str_tooltip = str_func[i](this,e);\r\n////            break;\r\n////          }\r\n          var str_tooltip = (typeof(str[name])==='function')? str[name]() : str[name];\r\n//            if (!str_tooltip) str_tooltip = str[this.parentNode.name];\r\n          if (!str_tooltip) str_tooltip = str[name.substr(0,name.lastIndexOf('.')+1)+'*'];\r\n          if (!str_tooltip) str_tooltip = str_hier(str,name,'') || '';\r\n          if (pref.test_mode.tips) str_tooltip = 'Name: ' + name + '\\n' + str_tooltip;\r\n          str_tooltip = str_tooltip.replace(/\\n/mg,'<br>').replace(/  /g,'&emsp;');\r\n\r\n          if (name[0]==='#') return str['#*'](e, str_tooltip);\r\n//          if (name[0]==='#') {str['#*'](e, str_tooltip);return;}\r\n//          if (str_tooltip) show_1.call(this,e,str_tooltip);\r\n          return str_tooltip;\r\n        }\r\n//        function show_1(e,str_func, callback, info_tips){ // working code\r\n//          tooltip_kind = (info_tips)? 'info' : 'help';\r\n//          if (!pref.tooltips[tooltip_kind].show) return;\r\n//          tooltip.innerHTML = str_func;\r\n//          if (callback) callback(tooltip);\r\n//          if (hide_timer!==null) {clearTimeout(hide_timer);hide_timer=null;} // test\r\n//          if (!e || tooltip_on===e.target) return;\r\n//          tooltip.style.left = e.clientX + 20 + 'px';\r\n//          tooltip.style.top  = e.clientY + 20 + 'px';\r\n////          if (hide_timer!==null) {clearTimeout(hide_timer);hide_timer=null;}\r\n//          if (tooltip_on) tooltip_on.removeEventListener('mouseout' ,hide, false);\r\n//          else {\r\n//            if (show_timer!==null) clearTimeout(show_timer);\r\n//            show_timer = setTimeout(show_exe,pref.tooltips[tooltip_kind].popup_delay);\r\n//          }\r\n//          tooltip_on = e.target;\r\n//          tooltip_on.addEventListener('mouseout' , hide, false);\r\n//        }\r\n//        function show_exe(){\r\n//          show_timer = null;\r\n////          tooltip_set(tooltip_contents.str_func, tooltip_contents.e, tooltip_contents.callback);\r\n//          site.script_body.appendChild(tooltip);\r\n//          tooltip_shown = true;\r\n//        }\r\n//        function hide(){ // called from both event and external function.\r\n//          if (hide_timer===null) hide_timer = setTimeout(hide_exe,pref.tooltips[tooltip_kind].popdown_delay);\r\n//        }\r\n//        function hide_exe(){\r\n//          hide_timer = null;\r\n//          if (tooltip_shown) {\r\n//            tooltip.parentNode.removeChild(tooltip);\r\n//            tooltip_shown = false;\r\n//          }\r\n//          if (show_timer!==null) {clearTimeout(show_timer);show_timer=null;}\r\n//          if (tooltip_on) {\r\n//            tooltip_on.removeEventListener('mouseout' ,hide, false);\r\n//            tooltip_on = null;\r\n//          }\r\n//        }\r\n\r\n        var tooltip_e = null;\r\n        var tooltip_func = null;\r\n        function show_0(e){\r\n          var name = e.target.getAttribute('name');\r\n          var kind = (name && name[0]==='#')? 'info' : 'help'\r\n          if (pref.tooltips[kind].show) req_show(kind, e, show);\r\n        }\r\n        function req_show(kind, e, func){\r\n          tooltip_kind = kind;\r\n          var e_obj = {target:e.target, currentTarget:e.currentTarget, clientX:e.clientX, clientY:e.clientY};\r\n          if (!tooltip_on) {\r\n            if (show_timer!==null) clearTimeout(show_timer);\r\n            show_timer = setTimeout(show_exe2,pref.tooltips[kind].popup_delay);\r\n            tooltip_e = e_obj; // e;\r\n            tooltip_func = func;\r\n          } else if (show_2(e, func(e))) tooltip_e = e_obj;\r\n        }\r\n        function show_exe2(){\r\n          show_timer = null;\r\n          if (show_2(tooltip_e, tooltip_func(tooltip_e))) site.script_body.appendChild(tooltip);\r\n          else tooltip_e = null;\r\n          tooltip_func = null;\r\n        }\r\n        function show_2(e,contents){\r\n          if (!contents) {hide2();return false;}\r\n          if (typeof(contents)==='string') tooltip.innerHTML = contents;\r\n          else {\r\n            tooltip.innerHTML = contents.html;\r\n            if (contents.callback) contents.callback(tooltip);\r\n          }\r\n          if (hide_timer!==null) {clearTimeout(hide_timer);hide_timer=null;}\r\n          if (e && tooltip_on!==e.target) {\r\n            tooltip.style.left = e.clientX + 20 + 'px';\r\n            tooltip.style.top  = e.clientY + 20 + 'px';\r\n            tooltip_on = e.target;\r\n          }\r\n          return true;\r\n        }\r\n//        function hide3(e){\r\n//          if (e.target===e.currentTarget) hide2(); // out from root\r\n//        }\r\n        function hide_if(pn){\r\n          if (tooltip_e && tooltip_e.currentTarget===pn) hide2();\r\n        }\r\n        function hide2(){ // called from both event and external function.\r\n          if (tooltip_e && hide_timer===null) {\r\n//          if ((tooltip_on || tooltip_e) && hide_timer===null) {\r\n            if (show_timer!==null) {clearTimeout(show_timer);show_timer=null;}\r\n            hide_timer = setTimeout(hide_exe2,pref.tooltips[tooltip_kind].popdown_delay);\r\n          }\r\n        }\r\n        function hide_exe2(){\r\n          hide_timer = null;\r\n          if (tooltip_on) {\r\n            tooltip.parentNode.removeChild(tooltip);\r\n            tooltip_on = null;\r\n            tooltip_e = null;\r\n          }\r\n        }\r\n        \r\n        function str_hier(root,name){\r\n          if (!root) return null; // cancel if miss\r\n          var idx = name.indexOf('.');\r\n          return (idx==-1)? root[name] || root['*'] || null :\r\n                            str_hier(root[name.substr(0,idx)],name.substr(idx+1));\r\n        }\r\n//        function str_hier(root,name,str){ // working code.\r\n//          if (!root) return null; // cancel if miss\r\n//          var idx = name.indexOf('.');\r\n//          if (idx==-1 || root['*']) {\r\n//            var val = root[name] || root['*'];\r\n//            return (val)? str + name + ': ' + val : null; // cancel if miss\r\n//          } else {\r\n//            var pfx = name.substr(0,idx);\r\n//            return str_hier(root[pfx],name.substr(idx+1),str+pfx+'.');\r\n//          }\r\n//        }\r\n        var str = {\r\n//          'pn_catalog_triage': 'hide forever, hide until new replies, watch, unwatch, undo.\\n'+\r\n//                               'You can customize this in settings -> Catalog: Appearance (in top selector) -> Style:',\r\n////          'pn_catalog_triage': '1st row: Hide it forever.\\n2nd row: Hide it now, but it will appear again when the thread gets new replies,\\n' +\r\n////            '  and new replies are marked.\\n3rd row: Don\\'t hide it, just change its appearance.\\n' +\r\n////            'Each column shows appearance the thread will get.\\n' +\r\n////            'Don\\'t forget checking \\'Exclusive list\\' and \\'Attribute list\\' for using this function.\\n' +\r\n////            'In other words, you can appear it again by unckecking them.\\nAnd you can configure these appearance in \\'Attribute list\\' and \\'Triage styles\\'.',\r\n          'catalog_refresh_clear': 'Clear all threads at update.',\r\n          'catalog_promiscuous': 'Gather information whatever.',\r\n          catalog: {\r\n            filter: {\r\n              kwd: {\r\n                re: 'Regular Expression.',\r\n                ci: 'Case insensitive. Don\\'t distinguish upper and lower case.',\r\n                sentence: '\"XXXX YYYY\" matches itself as a whole instead of matching \"XXXX\" and/or \"YYYY\"',\r\n              },\r\n              time: 'Time : Hide threads which have no posts after the time.',\r\n              time_creation: 'Time(Creation Time) : Hide threads which were created before the time.',\r\n              time_watch: 'Watch: watch threads which have posts after the time.',\r\n              time_watch_creation: 'Watch(Creation Time): watch threads which were created after the time.',\r\n            }\r\n          },\r\n//          'catalog.filter.time_mark': 'Mark: mark newer posts and scrool to them when it\\'s opened.',\r\n          'catalog.filter.tag_search.str': 'String for searching tags.\\n[CAUTION] this function is very heavy, keep blank here when you don\\'t use.',\r\n          'catalog.filter.tag_list': false,\r\n          'network.cross_domain': 'Use \\'direct\\' if you could, because it\\'s quite light, but it doesn\\'t work in almost of all environments.\\n\\'indirect\\' usually works well and gives full functionality.\\n\\Or you can use \\'GreaseMonkeyM\\'s extension if your browser tend to close steps for cross domain when you connect over X-Frame-Options, but this doesn\\'t provide localStorage/IDB features in remote domains.',\r\n          'debug_mode' : 'Debug mode.',\r\n          'show_tooltip' : 'Show this tooltip.',\r\n          'liveTag.rm_list_str': function(){return this.TagExLists();},\r\n          'liveTag.ex_list_str': function(){return this.TagExLists();},\r\n          'TagExLists': function(){return 'String, ...  or\\n/RegularExpression/, ... or \\nIdentifier:String, ... or \\nIdentifier:/RegularExpression/, ...\\n'+\r\n            '\\nRegularExpression must be embraced by shashes, and accepts i flag(case insensitive).\\n'+\r\n            'Identifier must be followed by :(colon). First colon is interpreted as a delimiter always. Put a colon at the head of line when you want to use colons in search strings for global search(without any identifiers)\\n'+this.GeneralRules;},\r\n          'catalog_board_list_str': function(){return 'How to write \\'Board groups\\'.\\n'+\r\n            '\\nNameOfBoardGroup,Identifier, ..., Commands, ...\\n\\n'+\r\n            'Each line becomes each board group. One line per one board group.\\n'+\r\n            'First column is a name of board group. The name is shown in board selector and become a key for localStorage or statistics.\\n'+\r\n            'Second or later columns are members. Each member is expressed by \\'Identifier\\'.\\n'+\r\n            'You can add tags for filtering or picking up threads. Single # means filter, double #(##) means pick up and filter. For example,\\n\\n'+\r\n            'CC, lain/\\u03bb/, #CatChan // load lain/\\u03bb/ and filter by #CatChan, then shows a thread for CatChan in lain/\\u03bb/.\\n'+\r\n            'lain#lainchan, lain, #lainchan // load all boards of lain and filter by #lainchan, then show all threads which have the tag(#lainchan).\\n'+\r\n            '#tech, ##tech // load all boards which have #tech from sites which are set in VirtualBoard, and filter by #tech, then show all threads which have the tag(#tech) from sites.\\n'+\r\n            'And you can add commands to the last of each line. \\'!stats\\' takes statistics if the function is enabled.\\n'+\r\n            this.GeneralRules;},\r\n          'GeneralRules': 'Double slash(//) is a beginning of comment.\\n\\n'+\r\n            'Identifier:\\n'+\r\n            'Identifier is a string which contains domain, board and/or thread. You can omit some of them. When some identifiers are dropped, it\\'ll be interpreted as follows. Upper case has the priority.\\n'+\r\n            '\\n'+\r\n            'domain/board/thread\\n'+\r\n            '/board/thread\\n'+\r\n            'domain/thread\\n'+\r\n            'thread\\n'+\r\n            'domain/board/\\n'+\r\n            '/board/\\n'+\r\n            'domain\\n'+\r\n            '\\n'+\r\n            '\\'Board identifier\\' must be expressed in a couple of slashes, like /int/. \\'Thread identifier\\' must be numeric. When the identifier is a word, it\\'ll be \\'Thread identifier\\' if it is numeric, otherwise it\\'ll be a \\'Domain identifier\\'. '+\r\n            'Domain identifiers must be one of meguca, lain, 4chan, 8chan or KC.',\r\n          'catalog.style_general_list_str' : function(){return 'Identifier^Style_string\\n'+\r\n            'Style_string is a string and set to its object.style.XXXX. Therefore you can use all of styles in CSS, which ranges from \\'background\\' or \\'border\\' to \\'fontSize\\', \\'width\\' or \\'height\\'\\n'+ this.GeneralRules;},\r\n//            'About Identifier, see \\'board group\\'.',\r\n          'catalog.board.recommendation' : 'Scans \\'board announcement\\' and gets owner\\'s recommendation. This recommendation must be start \\'Recommendation: \\', and the following part of the line is treated as a line of board groups. The recommendation can be seen in a last line of board groups.',\r\n          'catalog_triage_str': '// 1st column :\\n'+\r\n            '//   KILL : delete forever, and set its style.\\n'+\r\n            '//   TIME : delete until the thread gets new replies, and set its style.\\n'+\r\n            '//   NONE : Don\\'t hide the thread and set its style.\\n'+\r\n            '//   KILL_N : delete forever.\\n'+\r\n            '//   TIME_N : delete until the thread gets new replies.\\n'+\r\n            '//   ATTR : Set its style additionally.\\n'+\r\n            '//   UNDO : undo the last modification.\\n'+\r\n            '//   WATCH : watch this thread, or I\\'ve read all replies in this thread.\\n'+\r\n            '//   UNWATCH : unwatch this thread.\\n'+\r\n            '//   STICKY : sticky this thread.\\n'+\r\n            '//   UNSTICKY : unsticky this thread.\\n'+\r\n            '//   SHOW : show this thread always without regard to filter setteings.\\n'+\r\n            '//   UNSHOW : remove \\'show\\' mark.\\n'+\r\n            '// 2nd column : strings in the button.\\n'+\r\n            '// 3rd column : style in HTML.\\n'+\r\n            '// Repeat these as you wish.',\r\n          'overwrite_site2_eval_str' : 'For developers. This function is killed by security reason. If you want to use, you must uncomment the function \\'pref_func.site2_eval\\' by yourself.',\r\n          'thread_reader.buttons.B' : 'Bookmark this thread to current catalog.',\r\n          'thread_reader.buttons.UB': 'Unbookmark this thread from current catalog.',\r\n          'thread_reader.buttons.X' : function(){return 'Kill this thread from parent catalog' + ((pref.thread_reader.triage_close)? ', and close.' : '.');},\r\n          'thread_reader.buttons.v' : function(){return 'Hide this thread from parent catalog untill it gets new posts' + ((pref.thread_reader.triage_close)? ', and close.' : '.');},\r\n          'catalog_open_where' : 'this tab: open the thread in this tab, and catalog will be closed.\\nnew tab always: this enables you to open a thread in multiple tabs.\\nnamed tab: this prevents you from opening a thread in multiple tabs.\\na fixed tab: this enables you to use a catalog window as a dashboard.',\r\n          'virtualBoard.scan_domains.*': 'None: Don\\'t scan.\\nBoard: Read boards.json and set them to boardlist, not scan threads at startup. Threads are scanned when you read them.\\nThread: Scan all threads at startup.',\r\n          'scanBoard': 'Scan selected virtual boards.\\nScan this physical board if no virtual board is selected.',\r\n          'scanSite': 'Scan all virtual boards.\\nScan all boards in this site if no virtual board is selected.',\r\n          'style.fix.*': 'Write style strings.',\r\n          'style.copy.*': 'Write exact selectorText in CSS, then its styles are copied.',\r\n          debug_mode:['pipe','','removed threads from catalog'],\r\n          dummy: '',\r\n          archive: {kwd: null},\r\n          '#*': function(e, str){return liveTag.tooltip(e, str);},\r\n        };\r\n        str.archive.kwd = str.catalog.filter.kwd;\r\n        str['catalog.filter.tag_search.re'] = str.catalog.filter.kwd.re;\r\n        Object.defineProperty(str,'catalog_triage_str',{value:str['catalog_triage_str'], enumerable:true, configurable:true, writable:false});\r\n        return {\r\n          add_root: function(elem){\r\n            elem.addEventListener('mouseover', show_0, false);\r\n            elem.addEventListener('mouseleave', hide2, false);\r\n          },\r\n          remove_root: function(elem){\r\n            elem.removeEventListener('mouseover', show_0, false);\r\n            elem.removeEventListener('mouseleave', hide2, false);\r\n          },\r\n          show: show,\r\n//          show_1: show_1,\r\n//          hide: hide,\r\n          str: str,\r\n          req_show:req_show,\r\n          hide2: hide2,\r\n          show_2: show_2,\r\n          hide: hide2,\r\n          hide_if: hide_if,\r\n        }\r\n      })(),\r\n      pref_samples: (site0.isStep)? null : {\r\n        simple: {\r\n          catalog_triage_str: 'KILL,X,',\r\n          catalog : {style_general_list_str:'%border:4px solid #d6daf0\\n%margin:4px',\r\n                     format : {show:{posts:true}}},\r\n        },\r\n        backwash: {\r\n          catalog_triage_str :\r\n            'NONE,O,width:;height:,NONE,O,border:4px solid #ff0000;width:100px;height:100px,NONE,O,border:4px solid #00ff00;width:100px;height:100px,'+\r\n            'NONE,O,border:4px solid #0000ff;width:100px;height:100px,NONE,O,border:4px solid #ffff00;width:100px;height:100px,'+\r\n            'NONE,O,border:4px solid #ff00ff;width:100px;height:100px,NONE,O,border:4px solid #00ffff;width:100px;height:100px',\r\n//          catalog_expand_at_initial : true,\r\n          page:{click:'expand'},\r\n          catalog:{format: {show:  {style:  true, contents:  true, layout:  true, posts: true, fileinfo: true, images_2nd: true}}},\r\n        },\r\n        recommend: {\r\n          max_threads_at_refresh : 500,\r\n          catalog: {\r\n            auto_load_filter: true,\r\n            auto_save_filter: true,\r\n            auto_save_filter_at_refresh: true,\r\n            order: {\r\n              sticky:'first',\r\n//              find_sage_in_8chan: true\r\n            },\r\n            board: {board_tags_same: true},\r\n            auto_update : true,\r\n            auto_update_period : 1,\r\n          },\r\n          page:{auto_update:true, auto_update_period:1},\r\n          float:{auto_update:true, auto_update_period:1},\r\n        },\r\n        get easy2(){return pref.easy2;},\r\n        'easy2.presets': (function(){\r\n          var presets = [\r\n            {liveTag: {use:false}, virtualBoard:{scan:false}, LTfrom:0, VB:{local:0, global:0}, network:{fetch_actively:false}},\r\n            {liveTag: {use:false}, virtualBoard:{scan:true }, LTfrom:0, VB:{local:1, global:0}, network:{fetch_actively:false}},\r\n            {liveTag: {use:false}, virtualBoard:{scan:true }, LTfrom:0, VB:{local:1, global:1}, network:{fetch_actively:false}},\r\n            {liveTag: {use:true }, virtualBoard:{scan:true }, LTfrom:0, VB:{local:2, global:0}, network:{fetch_actively:true }},\r\n            {liveTag: {use:true }, virtualBoard:{scan:true }, LTfrom:0, VB:{local:2, global:1}, network:{fetch_actively:true }},\r\n            {liveTag: {use:true }, virtualBoard:{scan:true }, LTfrom:0, VB:{local:2, global:2}, network:{fetch_actively:true }},\r\n            {liveTag: {use:true }, virtualBoard:{scan:true }, LTfrom:1, VB:{local:2, global:0}, network:{fetch_actively:true }},\r\n            {liveTag: {use:true }, virtualBoard:{scan:true }, LTfrom:1, VB:{local:2, global:1}, network:{fetch_actively:true }},\r\n            {liveTag: {use:true }, virtualBoard:{scan:true }, LTfrom:1, VB:{local:2, global:2}, network:{fetch_actively:true }},\r\n          ];\r\n          var vb_kwd = ['none','board','thread'];\r\n          var basics = {\r\n            catalog:{auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true},\r\n            page:{load_on_demand:true},\r\n          };\r\n          return function(idx){\r\n            var easy2 = pref.easy2;\r\n            if (idx!==undefined) pref_func.pref_overwrite(easy2, presets[idx]);\r\n            easy2.virtualBoard.scan_domains = {};\r\n            for (var i in pref.virtualBoard.scan_domains) easy2.virtualBoard.scan_domains[i] = vb_kwd[((i===site.nickname)? easy2.VB.local : easy2.VB.global)];\r\n            easy2.liveTag.from = (easy2.LTfrom===0)? 'op' : 'post';\r\n            var auto_update = {auto_update:pref.easy2.auto_update, auto_update_period:pref.easy2.auto_update_period};\r\n            if (easy2.catalog.embed)      pref_func.pref_overwrite(easy2,{catalog:auto_update});\r\n            if (easy2.catalog.embed_page) pref_func.pref_overwrite(easy2,{page:   auto_update});\r\n            if (easy2.thread.embed)       pref_func.pref_overwrite(easy2,{thread: auto_update});\r\n            if (easy2.catalog.filter.time_watch || easy2.catalog.filter.time_watch_creation)\r\n              easy2.catalog.filter.time_str = new Date(Date.now()-((easy2.catalog.filter.time_watch)?easy2.time_post:easy2.time_op)*3600000).toLocaleString();\r\n            if (pref.easy2.basics) pref_func.pref_overwrite(easy2, basics);\r\n            return easy2;\r\n          };\r\n        })(),\r\n        'easy2.limits': (function(){\r\n          var limits = [\r\n            {virtualBoard:{max:100}, scan:{max:  100, max_threads:  1000}, catalog:{max_threads_at_refresh:  500}}, // general\r\n            {virtualBoard:{max: 50}, scan:{max:  100, max_threads:  1500}, catalog:{max_threads_at_refresh: 1500}}, // lain, meguca\r\n            {virtualBoard:{max:150}, scan:{max:  100, max_threads: 15000}, catalog:{max_threads_at_refresh:15000}}, // 4chan\r\n            {virtualBoard:{max:100}, scan:{max:   50, max_threads: 15000}, catalog:{max_threads_at_refresh:15000}}, // 8chan, top 50\r\n            {virtualBoard:{max:150}, scan:{max:  100, max_threads: 30000}, catalog:{max_threads_at_refresh:15000}}, // 8chan, top 100\r\n            {virtualBoard:{max:200}, scan:{max:  500, max_threads:100000}, catalog:{max_threads_at_refresh:15000}}, // 8chan, top 500\r\n            {virtualBoard:{max:200}, scan:{max:10000, max_threads:100000}, catalog:{max_threads_at_refresh:15000}}, // 8chan, all\r\n            {virtualBoard:{max:150}, scan:{max:  100, max_threads: 15000}, catalog:{max_threads_at_refresh:15000}}, // KC\r\n          ];\r\n          return function(){\r\n            pref_func.pref_overwrite(pref.easy2, limits[pref.easy2.limits]);\r\n          }\r\n        })(),\r\n        'easy.virtualBoard_10_passive': {\r\n          virtualBoard: {show: true, scan: true, max:20},\r\n          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:10},\r\n          page:{auto_update:true, auto_update_period:10},\r\n          float:{auto_update:true, auto_update_period:10},\r\n          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'board' : 'none';},\r\n        },\r\n        'easy.virtualBoard_10': {\r\n          virtualBoard: {show: true, scan: true, max:20},\r\n          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:10},\r\n          page:{auto_update:true, auto_update_period:10},\r\n          float:{auto_update:true, auto_update_period:10},\r\n          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'none';},\r\n        },\r\n        'easy.virtualBoard_1': {\r\n          virtualBoard: {show: true, scan: true, max:100, scanDelay: 20},\r\n          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:1},\r\n          page:{auto_update:true, auto_update_period:1},\r\n          float:{auto_update:true, auto_update_period:1},\r\n          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'none';},\r\n        },\r\n        'easy.virtualBoard_8_50': {\r\n          virtualBoard: {show: true, scan: true, max:100, scanDelay: 20},\r\n//          scan:{max:50},\r\n          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:5},\r\n          page:{auto_update:true, auto_update_period:5},\r\n          float:{auto_update:true, auto_update_period:5},\r\n          func: function(){\r\n            pref.scan.max = pref.easy.max_boards;\r\n            for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'none';\r\n          },\r\n        },\r\n////        'easy.virtualBoard_8_100': {\r\n////          catalog_auto_update : true,\r\n////          catalog_auto_update_period : 5,\r\n////          virtualBoard: {show: true, scan: true, max:100, scanDelay: 20},\r\n////          scan:{max:100},\r\n////          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true},\r\n////          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'none';},\r\n////        },\r\n////        'easy.virtualBoard_8_500': {\r\n////          catalog_auto_update : true,\r\n////          catalog_auto_update_period : 5,\r\n////          virtualBoard: {show: true, scan: true, max:100, scanDelay: 20},\r\n////          scan:{max:500},\r\n////          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true},\r\n////          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'none';},\r\n////        },\r\n        'easy.virtualBoard_8_all': {\r\n          virtualBoard: {show: true, scan: true, max:100, scanDelay: 20},\r\n          scan:{max:10000},\r\n          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:5},\r\n          page:{auto_update:true, auto_update_period:5},\r\n          float:{auto_update:true, auto_update_period:5},\r\n          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'none';},\r\n        },\r\n        'easy.virtualBoard_interSite': {\r\n          virtualBoard: {show: true, scan: true, max:100, scanDelay: 20},\r\n          catalog: {auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:10},\r\n          page:{auto_update:true, auto_update_period:10},\r\n          float:{auto_update:true, auto_update_period:10},\r\n          func: function(){for (var i in pref.virtualBoard.scan_domains) pref.virtualBoard.scan_domains[i] = (i===site.nickname)? 'thread' : 'board';},\r\n//          func: function(){for (var i in pref.virtualBoard.scan_domains) if (i!==site.nickname && pref.virtualBoard.scan_domains[i]==='none') pref.virtualBoard.scan_domains[i] = 'board';},\r\n        },\r\n        'easy.posts_0h': {\r\n          catalog:{filter:{time_str:null, time_watch:true}},\r\n          func: function(){pref_func.pref_samples['easy.posts_0h'].catalog.filter.time_str = new Date().toLocaleString();}\r\n        },\r\n        'easy.posts_24h': {\r\n          catalog:{filter:{time_str:null, time_watch:true}},\r\n          func: function(){pref_func.pref_samples['easy.posts_24h'].catalog.filter.time_str = new Date(Date.now()-pref.easy.posts_ago*3600000).toLocaleString();}\r\n        },\r\n        'easy.threads_24h': {\r\n          catalog:{filter:{time_str:null, time_watch_creation:true}},\r\n          func: function(){pref_func.pref_samples['easy.threads_24h'].catalog.filter.time_str = new Date(Date.now()-pref.easy.threads_ago*3600000).toLocaleString();}\r\n        },\r\n////        'easy.posts_48h': {\r\n////          catalog:{filter:{time_str:null, time_watch:true}},\r\n////          func: function(){pref_func.pref_samples['easy.posts_48h'].catalog.filter.time_str = new Date(Date.now()-48*3600000).toLocaleString();}\r\n////        },\r\n        'easy.embed_index': {\r\n          catalog:{embed_page:true, auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true},\r\n        },\r\n        'easy.embed_index_lazy': {\r\n          catalog:{embed_page:true, auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_watch:false},\r\n          liveTag:{use:false},\r\n          notify:{desktop:{notify:false}},\r\n          network:{fetch_actively:false},\r\n//          page:{scan_tag:false},\r\n        },\r\n        'easy.light': {\r\n          catalog:{embed_page:true, auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true,\r\n                   filter:{time_watch:false, time_watch_creation:false},\r\n                  },\r\n          liveTag:{use:false},\r\n          stats:{use:false},\r\n          network:{fetch_actively:false},\r\n//          page:{scan_tag:false},\r\n        },\r\n        'easy.embed_index_infinite': {\r\n          catalog_max_page_auto:true,\r\n          catalog:{embed_page:true, auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true},\r\n        },\r\n        'easy.embed_index_backwash': {\r\n          catalog_max_page_auto:true,\r\n          catalog:{embed_page:true, auto_load_filter:true, auto_save_filter:true, auto_save_filter_at_refresh:true, auto_update:true, auto_update_period:0},\r\n          page:{auto_update:true, auto_update_period:0},\r\n          float:{auto_update:true, auto_update_period:0},\r\n        },\r\n        'easy.stat_activate': {\r\n          stats:{use:true},\r\n          virtualBoard:{scan:true, scan_domains:{}},\r\n          liveTag:{use:true, from:'post'},\r\n          func: function(){this.virtualBoard.scan_domains[site.nickname] = 'board';},\r\n        },\r\n        triage_simple_kill: {\r\n          catalog_triage_str: 'KILL,X,',\r\n//          'pn_catalog_triage': 'hide forever.'\r\n        },\r\n        triage_simple: {\r\n          catalog_triage_str: 'KILL,X,,TIME,v,,WATCH,W,,UNWATCH,UW,,UNDO,U,',\r\n//          'pn_catalog_triage': 'hide forever, hide until new replies, watch, unwatch, undo.'\r\n        },\r\n        triage_basic: {\r\n          catalog_triage_str: 'KILL,X,,TIME,v,,WATCH,W,,UNWATCH,UW,,SHOW,\\u2605,,UNSHOW,\\u2606,,STICKY,S,,UNSTICKY,US,,UNDO,U,',\r\n        },\r\n        triage_basic_color: {\r\n          catalog_triage_str: 'KILL_N,X,,TIME_N,v,,WATCH,W,,UNWATCH,UW,,SHOW,\\u2605,,UNSHOW,\\u2606,,STICKY,S,,UNSTICKY,US,,UNDO,U,\\n'+\r\n            'NONE,O,,ATTR,O,background:#c3dcf9,ATTR,O,background:#b8efc2,'+\r\n            'ATTR,O,background:#efedbe,ATTR,O,background:#fbd5fb,ATTR,O,background:#fac2c5\\n'+\r\n            'ATTR,O,border:3px solid blue,ATTR,O,border:3px solid lime,'+\r\n            'ATTR,O,border:3px solid yellow,ATTR,O,border:3px solid orange,ATTR,O,border:3px solid red\\n',\r\n        },\r\n        triage_colorful: {\r\n          catalog_triage_str:\r\n            'KILL,X,,KILL,X,background:#c3dcf9,KILL,X,background:#b8efc2,'+\r\n            'KILL,X,background:#efedbe,KILL,X,background:#fbd5fb,KILL,X,background:#fac2c5\\n'+\r\n            'TIME,v,,TIME,v,background:#c3dcf9,TIME,v,background:#b8efc2,'+\r\n            'TIME,v,background:#efedbe,TIME,v,background:#fbd5fb,TIME,v,background:#fac2c5\\n'+\r\n            'NONE,O,,NONE,O,background:#c3dcf9,NONE,O,background:#b8efc2,'+\r\n            'NONE,O,background:#efedbe,NONE,O,background:#fbd5fb,NONE,O,background:#fac2c5\\n'+\r\n            'UNDO,U,,WATCH,W,,UNWATCH,UW,,GO,G,\\n',\r\n//          'pn_catalog_triage': '1st row: Hide it forever.\\n'+\r\n//            '2nd row: Hide until new replies\\n' +\r\n//            '3rd row: Change its appearance.\\n' +\r\n//            'Undo, Watch, UnWatch.\\n'\r\n        },\r\n        triage_borders: {\r\n          catalog_triage_str:\r\n            'KILL,X,,KILL,X,border:3px solid blue,KILL,X,border:3px solid lime,'+\r\n            'KILL,X,border:3px solid yellow,KILL,X,border:3px solid orange,KILL,X,border:3px solid red\\n'+\r\n            'TIME,v,,TIME,v,border:3px solid blue,TIME,v,border:3px solid lime,'+\r\n            'TIME,v,border:3px solid yellow,TIME,v,border:3px solid orange,TIME,v,border:3px solid red\\n'+\r\n            'NONE,O,,NONE,O,border:3px solid blue,NONE,O,border:3px solid lime,'+\r\n            'NONE,O,border:3px solid yellow,NONE,O,border:3px solid orange,NONE,O,border:3px solid red\\n'+\r\n            'UNDO,U,,WATCH,W,,UNWATCH,UW,,GO,G,\\n',\r\n//          'pn_catalog_triage': '1st row: Hide it forever.\\n'+\r\n//            '2nd row: Hide until new replies\\n' +\r\n//            '3rd row: Change its appearance.\\n' +\r\n//            'Undo, Watch, UnWatch.\\n'\r\n        },\r\n        triage_samples: {\r\n          catalog_triage_str: \r\n            'KILL,delete forever,\\n'+\r\n            'TIME,hide until new replies,\\n'+\r\n            'NONE,back to default design,background:;border:;\\n'+\r\n            'NONE,border and background,background:#c3dcf9;border:3px solid blue\\n'+\r\n            'NONE,border 3px,border:3px solid blue\\n'+\r\n            'NONE,background,background:#c3dcf9\\n'+\r\n            'NONE,border 5px,border:5px solid blue\\n'+\r\n            'NONE,border 1px,border:1px solid blue\\n'+\r\n            'NONE,transparent,background:\\n'+\r\n            'NONE,shrink,width:100px;height:100px\\n'+\r\n            'GO,open this thread,\\n',\r\n//          'pn_catalog_triage': 'samples\\n'\r\n        },\r\n        triage_test: {\r\n          catalog_triage_str: 'KILL,X,,TIME,v,,WATCH,W,,UNWATCH,UW,,SHOW,\\u2605,,UNSHOW,\\u2606,,STICKY,S,,UNSTICKY,US,,UNDO,U,,ARC,A+,,ARC1,A1,,UARC,A-,',\r\n        },\r\n        pn_samples : null,\r\n        init : function(){\r\n          if (pref_func.pref_samples.pn_samples) return;\r\n          var html = 'General samples:<br>'+\r\n                     '<button name=\"simple\">simple</button><br>'+\r\n                     '<button name=\"backwash\">backwash</button><br>'+\r\n                     '<button name=\"recommend\">recommend for desktop/note</button><br>'+\r\n                     'Triages:<br>'+\r\n                     '<button name=\"triage_simple_kill\">simple_kill</button><br>'+\r\n                     '<button name=\"triage_simple\">simple</button><br>'+\r\n                     '<button name=\"triage_basic\">basic</button><br>'+\r\n                     '<button name=\"triage_basic_color\">basic_color</button><br>'+\r\n                     '<button name=\"triage_colorful\">colorful</button><br>'+\r\n                     '<button name=\"triage_borders\">borders</button><br>'+\r\n                     '<button name=\"triage_samples\">samples</button><br>'+\r\n                     '<button name=\"triage_test\">test</button><br>';\r\n          cnst.make_popup(pref_func.pref_samples,'pn_samples',html,pref_func.pref_samples.onclick_event);\r\n//          pref_func.pref_samples.pn_samples = cnst.init('left:0px:tile:get:bottom:Show:tb',cnst.void_func,cnst.void_func,pref_func.pref_samples.destroy,cnst.void_func)[0];\r\n//          var pn_smpl = pref_func.pref_samples.pn_samples;\r\n//          pn_smpl.childNodes[1].innerHTML = '<button name=\"backwash\">backwash</button>';\r\n//          var buttons = pn_smpl.childNodes[1].getElementsByTagName('BUTTON');\r\n//          for (var i=0;i<buttons.length;i++) buttons[i].onclick = pref_func.pref_samples.onclick_event;\r\n        },\r\n//        destroy : function() {\r\n//          pref_func.pref_samples.pn_samples = cnst.div_destroy(pref_func.pref_samples.pn_samples, true);\r\n//        },\r\n        get_name: function(src,names,str){\r\n          for (var i in src) {\r\n            if (typeof(src[i])!=='object') names.push(str+i);\r\n            else pref_func.pref_samples.get_name(src[i],names,str+i+'.');\r\n          }\r\n          return names;\r\n        },\r\n        onclick_event : function(e, src) {\r\n          if (!src) src = pref_func.pref_samples[this.name];\r\n          if (src.func && typeof(src.func)==='function') src.func();\r\n          pref_func.pref_overwrite(pref,src);\r\n          pref_func.pref_overwrite(pref_func.tooltips.str,src);\r\n          var names = pref_func.pref_samples.get_name(src,[],'');\r\n          var pns = Array.prototype.slice.call(document.querySelectorAll('*[name]'));\r\n          for (var i=pns.length-1;i>=0;i--) if (names.indexOf(pns[i].name)==-1) pns.splice(i,1);\r\n          if (pns.length>0) pref_func.apply_prep(pns, false, true, null, true);  // refresh appearance, make object, trigger event.\r\n//          for (var i=0;i<names.length;i++) { // worknig code, but has a bug...\r\n//            var pn = document.getElementsByName(names[i])[0];\r\n//            if (pn) pref_func.apply_prep(document.getElementsByName(names[i])[0], false, true, null, true);  // refresh appearance, make object, trigger event.\r\n//          }\r\n////          for (var i=0;i<names.length;i++) { // working code.\r\n////            var pn = document.getElementsByName(names[i])[0];\r\n////            if (pn) {\r\n////              pref_func.apply_prep(pn,false);  // refresh appearance.\r\n//////            pref_func.apply_prep(pn,true);   // make obj.\r\n//////              pref_func.invoke_onchange(pn,true);   // make obj.\r\n////            }\r\n////            pref_func.make_pref_obj(names[i]); // make obj.\r\n//////            if (pref_func.settings.onchange_funcs[names[i]]) pref_func.settings.onchange_funcs[names[i]].call(pn);\r\n////            if (pn && pref_func.settings.onchange_funcs[names[i]]) pref_func.settings.onchange_funcs[names[i]].call(pn);\r\n////          }\r\n////          if (sessionStorage) sessionStorage.pref = JSON.stringify(pref);\r\n        }\r\n      },\r\n      settings: {\r\n        pn13 : null,\r\n        show_hide : function(e){\r\n          if (pref_func.settings.pn13===null) {\r\n            var pos = ((e.clientX*2>window.innerWidth)? 'right':'left') + ':0px:' + ((e.clientY*2>window.innerHeight)? 'bottom:0':'top:'+site.header_height())+'px';\r\n            var pn13 = cnst.init(pos+':Show:tb',cnst.void_func,cnst.void_func,pref_func.settings.show_hide,cnst.void_func);\r\n            var pn13_0_2 = cnst.add_to_tb(pn13,\r\n              '<select name=\"settings.indexing\">'+\r\n                '<option>' + pref_func.settings.options.join('</option><option>') + '</option>'+\r\n              '</select>');\r\n            pn13_0_2.getElementsByTagName('select')['settings.indexing'].selectedIndex = pref.settings.indexing<pref_func.settings.options.length? pref.settings.indexing : 0;\r\n            pref_func.settings.pn13 = pn13; // for onchange func.\r\n            pref_func.mirror_targets.pn13_1 = pn13.childNodes[1]; // for mirror.\r\n            pref_func.settings.onchange_funcs['settings.indexing']();\r\n            pref_func.add_onchange(pn13_0_2,pref_func.settings.onchange_funcs_formatted);\r\n            pref_func.tooltips.add_root(pref_func.mirror_targets.pn13_1);\r\n            cnst.bottom_top(pn13);\r\n          } else {\r\n            pref_func.tooltips.remove_root(pref_func.mirror_targets.pn13_1);\r\n            pref_func.settings.files_store();\r\n            pref_func.mirror_targets.pn13_1 = null;\r\n            pref_func.settings.pn13 = cnst.div_destroy(pref_func.settings.pn13, true); // returns null\r\n          }\r\n        },\r\n////        show_hide : function(){cnst.make_destroy(pref_func.settings,'pn13',pref_func.settings.prep_pn13,pref_func.settings.destroy_pn13);}, // working code.\r\n////        prep_pn13 : function(){\r\n////          var pn13 = cnst.init('left:0px:tile:get:bottom:Show:tb',cnst.void_func,cnst.void_func,pref_func.settings.show_hide,cnst.void_func)[0];\r\n////          var pn13_0_2 = cnst.add_to_tb(pn13,\r\n////            '<select name=\"settings.indexing\">'+\r\n////              pref_func.settings.options.join('') + \r\n////////              '<option>Catalog: General 0</option>'+\r\n////////              '<option>Catalog: General 1</option>'+\r\n////////              '<option>Catalog: Board Group</option>'+\r\n////////              '<option>Catalog: Appearance</option>'+\r\n////////              '<option>Catalog: Design</option>'+\r\n////////              '<option>Catalog: Footer/PopUp</option>'+\r\n////////              '<option>Watcher / Notifiers</option>'+\r\n//////////              '<option>Statistics:</option>'+\r\n////////              '<option>UIP tracker for 4chan</option>'+\r\n////////              '<option>Command Line Interface</option>'+\r\n//////////              '<option>Workaround for dollchan</option>'+\r\n////////              '<option>General</option>'+\r\n////////              '<option>About</option>'+\r\n////            '</select>');\r\n////          pn13_0_2.getElementsByTagName('*')['settings.indexing'].selectedIndex = pref.settings.indexing;\r\n////          pref_func.settings.pn13 = pn13; // for onchange func.\r\n////          pref_func.mirror_targets.pn13_1 = pn13.childNodes[1]; // for mirror.\r\n////          pref_func.settings.onchange_funcs['settings.indexing'](); // leaks 1 EventLister, but call add_onchange in this.\r\n////          pref_func.add_onchange(pn13_0_2,pref_func.settings.onchange_funcs); // leaks 1.\r\n////          cnst.bottom_top(pn13);\r\n////          return pn13;\r\n////        },\r\n////        destroy_pn13 : function(){\r\n////          pref_func.mirror_targets.pn13_1 = null;\r\n////          pref_func.settings.files_store();\r\n////          pref_func.settings.pn13 = cnst.div_destroy(pref_func.settings.pn13, true); // returns null\r\n////        },\r\n        apply_pn13_1: function(set,propagate){\r\n          pref_func.apply_prep(pref_func.settings.pn13.childNodes[1],set,propagate);\r\n          pref_func.settings.onchange_funcs['pn13_1_warning']();\r\n        },\r\n        files_store: function(){\r\n//          var files_archive = pref_func.mirror_targets.pn13_1.querySelectorAll('span[name=\"FILES_ARCHIVE0\"]')[0]; // out of w3c, but works in chrome and FF.\r\n//          if (files_archive) site.script_body.firstChild.appendChild(files_archive); // called also at initial. // firstChild is 'display:none'.\r\n////          if (files_archive) site.script_body.appendChild(files_archive); // called also at initial.\r\n          var files = pref_func.settings.pn13.querySelectorAll('input[type=file]');\r\n          if (files.length>0) pref_func.apply_prep_2(files,true);\r\n        },\r\n        insert_menu: function(menu,html){\r\n          var idx = pref_func.settings.options.length-1;\r\n          pref_func.settings.options.splice(idx,0,menu);\r\n          pref_func.settings.htmls.splice(idx,0,html);\r\n        },\r\n        html_funcs: {\r\n          show_hide_all_to_header: function(str){\r\n            return '<span>' + str + '<a name=\"SHOWALL\" style=\"float:right;cursor:pointer\" data-str=\"[all\\u25b2]\">[all\\u25bc]</a></span>';\r\n          },\r\n//          show_hide_all_to_header: function(str){\r\n//            return '<span>' + str + '<span style=\"float:right\">' + this.show_hide_all('all\\u25bc', 'all\\u25b2') + '</span></span>';\r\n//          },\r\n          show_hide_all: function(str_show, str_hide){\r\n            return '<a name=\"SHOWALL\" style=\"cursor:pointer\">[' +str_show+ ']</a><a name=\"HIDEALL\" style=\"cursor:pointer\">[' +str_hide+ ']</a>';\r\n          },\r\n          show_hide: function(show, hide, inner, header){\r\n            return '<a name=\"SHOW\" style=\"cursor:pointer\" data-str=\"' +hide+ '\">' +show+ '</a><span style=\"display:none\" name=\"SUB\">' +(header||'')+ '<br>' +inner+ '</span>';\r\n          },\r\n//          show_hide: function(str_show, str_hide, str_inner){\r\n//            return '<a name=\"SHOW\" style=\"cursor:pointer\">[' +str_show+ ']</a><a name=\"HIDE\" style=\"cursor:pointer;display:none\">[' +str_hide+ ']</a><span style=\"display:none\" name=\"SUB\"><br>' +str_inner+ '</span>';\r\n//          },\r\n          popup: function(mode){\r\n            return '2,<ICBX\"'+mode+'.popup\"> Pop up reply' + this.rollup(\r\n              this.popup_delay('proto.')+'<br>'+\r\n              '3,<IC\"proto.popup_hlt\">Highlight the post if it is visible')+'<br>';\r\n          },\r\n          popup_delay: function(pf, imm_down){\r\n            return '4,<IR\"'+pf+'popdown,imm\">immediately<br>'+\r\n              '4,<IR\"'+pf+'popdown,delay\">delayed: <ITB4\"'+pf+'popup_delay\">'+(imm_down? '':'<ITB4\"'+pf+'popdown_delay\">')+' ms<br>'+\r\n              '5,<IC\"'+pf+'popup_mMove\">Don\\'t popup while mouse is moving<br>'+\r\n              '4,zIndex: <ITB3\"'+pf+'popup_zIndex\">';\r\n          },\r\n//          popupX: function(mode, prop, caption){\r\n//            return '2,<IC\"'+mode+'.popup\">'+caption+this.rollup(\r\n//              this.popup_delay(prop))+'<br>';\r\n//          },\r\n          expand_thumbnail_inline: function(mode){\r\n            var pf = mode+'.thumbnail.inline.';\r\n            return '2,<IC\"' +mode+ '.expand_thumbnail_inline\">Image expansion at click'+ this.rollup(\r\n              this.limit_webm(pf)+\r\n              '3,<IC\"' +mode+ '.expand_thumbnail_initial\">Expand all images at initial<br>'+\r\n              '3,<IC\"' +mode+ '.expand_thumbnail_inline_all_after\">Expand all images after clicked one<br>'+\r\n              '4,<IC\"' +pf+ 'ondemand\">On demand loading: '+\r\n              '<ITB3\"' +pf+ 'ref_height\"> % of browser')+ '<br>';\r\n          },\r\n          expand_thumbnail_hover: function(mode){\r\n            var pf = mode+'.thumbnail.hover.';\r\n            return '2,<IC\"' +mode+ '.image_hover\">Image hover'+ this.rollup(\r\n              this.popup_delay(pf, true)+'<br>'+\r\n              this.limit_webm(pf)+\r\n              '3,<IC\"' +mode+ '.image_prefetch\">Prefetch next image<br>'+\r\n              '3,<IC\"' +pf+ 'dragfloat\">Drag thumbnail to make it window<br>'+\r\n              '4,<IC\"' +pf+ 'df_dblC\">Double click to close<br>'+\r\n              '4,<IC\"' +pf+ 'df_mW\">Wheel to scroll<br>'+\r\n              '4,<IC\"' +pf+ 'df_cV\">Continue playing video<br>'+\r\n              '3,<IC\"' +pf+ 'zoom\">Click to zoom mode if limited')+'<br>';\r\n          },\r\n          limit_webm: function(pf){\r\n            return '4,<IC\"' +pf+ 'limit_width\">Limit to browser\\'s width - <ITB3\"' +pf+ 'margin_width\"> px<br>'+\r\n              '4,<IC\"' +pf+ 'limit_height\">Limit to browser\\'s height - <ITB3\"' +pf+ 'margin_height\"> px<br>'+\r\n              '4,<IC\"' +pf+ 'webm\">Play webm<br>'+\r\n              '5,<IC\"' +pf+ 'webm_loop\">Loop<br>'+\r\n              '5,<IC\"' +pf+ 'webm_mute\">Mute<br>';\r\n//              '3,<ICBX\"' +pref+ 'limit_width\"> Limit to browser\\'s width - <ITB3\"' +pref+ 'margin_width\"> px<br>'+\r\n//              '3,<ICBX\"' +pref+ 'limit_height\"> Limit to browser\\'s height - <ITB3\"' +pref+ 'margin_height\"> px';\r\n          },\r\n          env: function(mode, str_inner){\r\n            return '1,Environment values:(advanced option)'+ this.rollup(\r\n              '2,You are using native function of:<br>'+\r\n              '3,<IC\"' +mode+ '.popup_native\">Pop up reply<br>'+\r\n              '3,<IC\"' +mode+ '.expand_thumbnail_inline_native\">Image expansion<br>'+\r\n              '3,<IC\"' +mode+ '.image_hover_native\">Image hover<br>'+\r\n              '3,<IC\"' +mode+ '.colorID_native\">Color ID<br>'+\r\n              '3,<IC\"' +mode+ '.backlink_native\">Backlink<br>'+\r\n              '3,<IC\"' +mode+ '.localtime_native\">Local time'+\r\n              str_inner + '<br>'+\r\n              '2,<IC\"' +mode+ '.popup_native_kill\">Suppress native static popup<br>'+\r\n              '2,<IC\"' +mode+ '.refresh_initial\">Refresh at initial<br>') + '<br>';\r\n          },\r\n          posts_for_search: function(mode){\r\n            return '2,'+ this.rollup_radio(mode+'.storePosts',' :Num of posts to store for search', 3, '',\r\n              ['no:No additional posts are stored for search.<br>5,Search will be done only from posts for preview.',\r\n               'ALL:All posts are stored always.<br>5,Search will be done from all posts without preparation scan.',\r\n               'auto:All posts in all scanned threads are stored after the first activation of search.<br>5,Need (automatic) scans prior to search. (usual usage)',\r\n               'ALL_agg:All posts in all scanned threads are stored.<br>5,Search will be done from all scanned threads.<br>5,This is an option for search from entire domains.<br>'+\r\n               '3,<IC\"proto.searchAc.loosen\">Auto loosen limits at the first activation'+this.rollup(\r\n                 '6,Max boards of a scan: <ITB6\"proto.searchAc.max\"><br>'+\r\n                 '6,Max threads of a scan: <ITB6\"proto.searchAc.max_threads\"><br>'+\r\n                 '6,Max threads at refresh (auto deletion): <ITB6\"proto.searchAc.max_threads_at_refresh\"><br>'+\r\n                 '5,<BTN\"tighten_loosed_limits,Tighten loosed limits\">')+'<br>'+\r\n               '3,<IC\"proto.searchAs\">Auto scan from this (virtual) board if needed <BTN\"scanBoardIf,Scan\"><BTN\"scanBoard,Rescan\"><br>'+\r\n               '3,<IC\"proto.searchAsA\">Auto scan from all (virtual) boards if needed <BTN\"scanSiteIf,Scan\"><BTN\"scanSite,Rescan\">']) +'<br>'+\r\n              '2,'+ this.rollup_radio(mode+'.sourceOfSP',' :Posts to be used for search', 3,\r\n              '3,Posts may be stored also by function of deleted posts detection.<br>'+\r\n              '3,Number of stored posts can be shown in footer.<br>',\r\n              ['auto:All stored posts.(usual usage)',\r\n              'pv:Posts for preview only.<br>5,Search will be done only from recent or newer posts,<br>5,which depends on preview settings.']) +'<br>';\r\n          },\r\n          op_in_search_result: function(mode){\r\n            return '2,' + this.rollup_radio(mode+'.posts_search_op', ' :Unmatched OP in search result', 3, '',\r\n              ['show:Show', 'opaque:Opaque: <ITB3\"' +mode+ '.posts_search_op_opacity\"> %','hide:Hide']) + '<br>';\r\n//              '2,<ICBX\"' + mode + '.auto_config_posts_search\"> Auto config and scan at searching posts(WILL BE REPLACED)<br>';\r\n          },\r\n          deleted_posts_detection: function(mode){\r\n            return '2,' + this.rollup_radio(mode+'.deleted_posts.detect', ' :Detect deleted posts', 4, '3,Detection:<br>',\r\n                ['no:No', 'passive:Passive detection. Don\\'t make any request',\r\n                 'acc:Best effort without any additional requests', 'full:Full detection, read all posts at first', 'full_IDB:Full detection with IndexedDB'],\r\n              '<br>'+\r\n              '3,<ICBX\"' + mode + '.deleted_posts.merge\"> Merge deleted posts with live posts'\r\n//              this.radios(mode+'.deleted_posts.store',4,\r\n//                ['LS:Store to LocalStorage to share with other tabs<br>5,<ICBX\"' + mode + '.deleted_posts.auto_clean\"> Clean up automatically',\r\n//                 'SS:Store to SessionStorage to get higher security', 'MC:Use ChannelMessage for security'])\r\n              );\r\n          },\r\n          popup_others: function(mode){\r\n            return !pref.test_mode['121']? '' : '2,<IC\"'+mode+'.popupX.use\">Pop up others'+ this.rollup(\r\n              this.popup_delay('proto.popupX.')+'<br>'+\r\n              '3,<IC\"'+mode+'.popupX.ID\">Pop up ID<br>'+\r\n              '3,<IC\"'+mode+'.popupX.flag\">Pop up flag<br>'+\r\n              '3,<IC\"'+mode+'.popupX.name\">Pop up name<br>'+\r\n              '3,<IC\"'+mode+'.popupX.trip\">Pop up trip')+'<br>';\r\n          },\r\n//          show_val_rollup: function(pref, inner){\r\n//            return '<SSV\"' +pref+ '\">'+ '&emsp;' + this.show_hide('change...', 'hide', '', inner);\r\n//          },\r\n          radios: function(pref, indent, args, pref2){\r\n            var r_str = indent+',<IR\"'+pref+',$1\">' + (pref2? pref2.map(function(v){return '<IR\"'+v+',$1\">';}).join('') : '');\r\n            return args.map(function(v){return v.replace(/([^:]*):/, r_str);}).join('<br>');\r\n          },\r\n          rollup_radio: function(pref, header, indent, middler, args, trailer, pref2){\r\n            return '<a name=\"SHOW2\" style=\"cursor:pointer\" data-str=\"\\u25b2]\">[<SSV\"' +pref+ '\"></span>\\u25bc]</a>'+\r\n              '<span name=\"SHOW2_I\">' + header + '</span><span style=\"display:none\" name=\"SUB\"><br>' +middler + this.radios(pref,indent,args,pref2)+ (trailer || '') + '</span>';\r\n//            return '<span name=\"NEXT\" style=\"cursor:pointer\">[<SSV\"' +pref+ '\"></span>' + this.show_hide('\\u25bc]', '\\u25b2]', header, middler + args.join('<br>'));\r\n//            return '<SSV\"' +pref+ '\">'+ header + '&emsp;' + this.show_hide('change...', 'hide', '', middler + args.join('<br>'));\r\n          },\r\n          rollup: function(inner, header){\r\n            return '&emsp;' + this.show_hide('[\\u25bc]', '[\\u25b2]', inner, header);\r\n          },\r\n          format_posts: function(mode, html_funcs){\r\n            return '2,<IC\"' +mode+ '.open_spoiler_text\">Open text spoiler<br>'+\r\n              '2,<IC\"' +mode+ '.colorID\">Color ID<br>'+\r\n              this.backlink(mode)+\r\n              '2,<IC\"' +mode+ '.localtime\">Local time<br>'+\r\n              html_funcs.deleted_posts_detection(mode)+'<br>'+\r\n              '2,<IC\"' +mode+ '.mark_new_posts\">Mark new posts<br>';\r\n          },\r\n          backlink: function(mode){\r\n            return '2,<IC\"' +mode+ '.backlink\">Backlink'+ this.rollup(\r\n              '3,<IC\"proto.bl_ec\">Explicit cross backlink<br>'+\r\n              '3,<IC\"proto.bl_rm\">Don\\'t retain backlinks to OP<br>'+\r\n              '3,<IC\"' +mode+ '.backlink_all\">Track all backlinks<br>'+\r\n              '4,<IC\"' +mode+ '.backlink_all_cross\">Track all cross-board links') + '<br>';\r\n          },\r\n          updates: function(mode){\r\n            return '2,<IC\"' +mode+ '.auto_update\">Auto update, every <ITB2\"' +mode+ '.auto_update_period\">min.<br>'+\r\n              '2,<IC\"' +mode+ '.hide_posts_without_images\">Hide posts without images<br>'+\r\n              '2,<IC\"' +mode+ '.merge\">Merge all threads'+ this.rollup(\r\n                '2,<IC\"' +mode+ '.merge_list\">Merge listed threads<br>'+\r\n                '3,<TA\"proto.merge_list_str,40,1\" placeholder=\"4chan/c/2887897 + 4chan/c/2880944 + 4chan/c/2888255,\"><br>'+\r\n                '2,<IC\"' +mode+ '.merge_lv\">Merge with level (use user CSS to style)<br>'+\r\n                '3,<TA\"proto.merge_lv_str,40,1\">'+\r\n                this.rollup(this.userCSS(2)))+'<br>';\r\n          },\r\n          userCSS: function(indent){\r\n            return indent+',<IC\"style.userCSS.use\">User CSS<br>'+\r\n              (indent+1)+',<TA\"style.userCSS.str,50,1\"><br>'+\r\n              (indent+1)+',Sample user CSS:<br>'+\r\n              (indent+1)+',<TA\"style.userCSS.sample,50,1\" disabled>';},\r\n//            '<div>'+\r\n//              '<div style=\"float:left\">&emsp;&emsp;</div>'+\r\n//              '<div style=\"float:left\">'+\r\n//                '<TA\"style.userCSS.str,50,1\">'+\r\n//                '<div style=\"overflow:scroll;resize:both;\">'+this.userCSS_samples.replace(/\\n/g,'<br>')+'</div>'+\r\n//              '</div>'+\r\n//            '</div>';},\r\n//          userCSS_samples: 'Samples:\\n'+\r\n//            '.CatChan_titleBar button[name^=\"op\"]{display:none} /* remove transparency buttons in titleBar */\\n',\r\n          vb_domains: function(){\r\n//            var str = '<span name=\"virtualBoard.scan_domains\">'+\r\n            var str = '2,Scan targets:<br>'+\r\n                      '3,None/Board/Thread(No/Passive/Active)<br>';\r\n            var sites = site0.domains;\r\n            for (var i=0;i<sites.length;i++) {\r\n              str += '3,<input type=\"radio\" name=\"virtualBoard.scan_domains.'+sites[i]+'\" value=\"none\">'+  // 'apply_prep' can't recognize ['domain'] notation.\r\n                     '<input type=\"radio\" name=\"virtualBoard.scan_domains.'+sites[i]+'\" value=\"board\">'+\r\n                     '<input type=\"radio\" name=\"virtualBoard.scan_domains.'+sites[i]+'\" value=\"thread\"> '+ sites[i] +'<br>';\r\n            }\r\n            return str;\r\n          },\r\n//          get_domains: function(){\r\n//            var sites = Object.keys(pref.virtualBoard.scan_domains);\r\n//            sites.unshift(sites.splice(sites.indexOf(site.nickname),1)[0]);\r\n//            return sites;\r\n//          },\r\n          make_sel: function(pref,args){\r\n            var str = '<select name=\"' + pref + '\" style=\"float:none\">';\r\n            for (var i=0;i<args.length;i++) str += '<option>' + args[i] + '</option>';\r\n            return str + '</select>';\r\n          },\r\n          features_domains: function(){\r\n            var str = ''\r\n            for (var i=0;i<site0.domains.length;i++) str += '1,<ICBX\"features.domains.'+site0.domains[i]+'\"> '+ site0.domains[i] +'<br>';\r\n            return str;\r\n          },\r\n          cb_block: function(pf,start){\r\n            var str = '';\r\n            var i=start-1;\r\n            while (pref[pf][++i]!==undefined) str += '<ICBX\"'+pf+'.'+i+'\">' + ((i%10===4)? '&emsp;' : (i%50===49)? '<br><br>' : (i%10===9)? '<br>' : '');\r\n            return str;\r\n          },\r\n          footer: function(mode){\r\n            var pf = mode+'.footer.';\r\n            return '1,<IC\"'+pf+'use\">Show information footer'+this.rollup(\r\n                '3,<IC\"'+mode+'.footer_br\">Always over/under the image<br>'+\r\n                '3,<IC\"'+pf+'rOP\">Num of replies counts OP<br>'+\r\n                '3,<IC\"'+pf+'iOP\">Num of images counts images in OP')+'<br>'+\r\n              '2,<IC\"'+pf+'nr\">Show num of new replies (nr)<br>'+\r\n              '3,<IC\"'+pf+'nrtm\">Show num of new replies to me (nm)<br>'+\r\n              '2,<IC\"'+pf+'rp\">Show num of replies (rp)<br>'+\r\n              '2,<IC\"'+pf+'im\">Show num of images (im)<br>'+\r\n              '2,<IC\"'+pf+'nl\">Show num of stored live posts (lp)<br>'+\r\n              '2,<IC\"'+pf+'nd\">Show num of deleted posts (dp)<br>'+\r\n              '2,<IC\"'+pf+'ns\">Show num of saged posts (sp)<br>'+\r\n              '2,<IC\"'+pf+'page\">Show page No. (pg)<br>'+\r\n              '2,<IC\"threadStats.use\">Take statistics of each thread'+this.rollup(\r\n                '4,<IC\"threadStats.full\">Issue additional fetchs if required<br>'+\r\n                '5,<IC\"threadStats.retry\">Retry if obsolete data(may cause infinite loop)') + '<br>'+\r\n              '3,<IC\"'+pf+'nid\">Show num of IDs (ni)<br>'+\r\n              '3,<IC\"'+pf+'nf\">Show num of flags (nf)<br>'+\r\n              '2,<ICBX\"'+pf+'ctime\"> <IC\"'+pf+'rctime\">Show created time (ct), relative (cT)<br>'+\r\n              '2,<ICBX\"'+pf+'btime\"> <IC\"'+pf+'rbtime\">Show bumped time (bt), relative (bT)<br>'+\r\n              '2,<ICBX\"'+pf+'ptime\"> <IC\"'+pf+'rptime\">Show last posted time (pt), relative (pT)<br>'+\r\n              '2,<IC\"'+pf+'prate\">Show post rate (pr)<br>'+\r\n              '2,<IC\"'+pf+'domain\">Show domain\\'s name (dn)<br>'+\r\n              '2,<IC\"'+pf+'board\">Show board\\'s name (bd)<br>'+\r\n              '2,<IC\"'+pf+'no\">Show thread\\'s no (no)<br>'+\r\n              '2,<IC\"'+pf+'archived\">Show archived (ar)<br>'+\r\n              '2,<IC\"'+pf+'tag\">Show tags (tg)<br>'+\r\n    //          ', in <input type=\"text\" name=\"'+pf+'tag_letters\" size=\"2\" style=\"text-align: right;\"> letters'+\r\n              '2,<IC\"'+pf+'flag\">Show recent flags (rf)<br>'+\r\n              '2,Design:<br>'+\r\n              '3,<IR\"'+pf+'design,native\"> U: */* / R: * / I: * / P: *<br>'+\r\n              '3,<IR\"'+pf+'design,condensed\"> */*/*/*/*<br>'+\r\n              '3,<IR\"'+pf+'design,meguca\"> /bd/ */*/*/*/*<br>'+\r\n              '3,<IR\"'+pf+'design,custom\"> <ITBL40\"'+pf+'custom\"><br>'+\r\n              '3,<IR\"'+pf+'design,custom2\"> <ITBL40\"'+pf+'custom2\"><br>';\r\n          },\r\n        },\r\n////        options: [\r\n////          '<option>Easy Setting:</option>',\r\n////          '<option>Virtual board:</option>',\r\n////          '<option>Initialization:</option>',\r\n////          '<option>Catalog: General 1</option>',\r\n////          '<option>Catalog: Board Group</option>',\r\n////          '<option>Catalog: Live Tag</option>',\r\n////          '<option>Catalog: Appearance</option>',\r\n////          '<option>Catalog: Design</option>',\r\n////          '<option>Catalog: Footer/PopUp</option>',\r\n////          '<option>Watcher</option>',\r\n////          '<option>Notifiers</option>',\r\n//////          '<option>Statistics:</option>',\r\n////          '<option>UIP tracker for 4chan</option>',\r\n////          '<option>Command Line Interface</option>',\r\n//////          '<option>Workaround for dollchan</option>',\r\n////          '<option>Networking</option>',\r\n////          '<option>General</option>',\r\n////          '<option>About</option>'\r\n        ////        ],\r\n        options: [\r\n          'Easy Setting2:',\r\n          'Easy Setting:',\r\n          'Virtual Board:',\r\n          'Catalog:',\r\n          'Index Page:',\r\n          'Thread:',\r\n          'Floating Catalog:',\r\n          'Gerenal 0',\r\n          'General 1',\r\n          'Board Group',\r\n          'Live Tag',\r\n          'Statistics',\r\n          'Design of FC',\r\n          'Footer',\r\n          'Footer for watcher',\r\n          'Watcher',\r\n          'Notifiers',\r\n          'JSON Archiver: Store',\r\n          'JSON Archiver: Restore',\r\n          'UIP tracker for 4chan',\r\n          'Command Line Interface',\r\n//          'Workaround for dollchan',\r\n          'Networking',\r\n          'General 2',\r\n          'Styles',\r\n          'Features',\r\n          'About'\r\n        ],\r\n        htmls: [ function(html_funcs){return 'Easy Setting2: --- Welcome to CatChan! ---<br>'+\r\n          '<br>'+\r\n          '1,0. <button name=\"easy2.beginner\">I\\'m a beginner and I just want to try</button>, click this.<br>'+\r\n          '2,Then a reload will be occur after loading settings for beginner.<br>'+\r\n          '2,(This will be default after a certain period of test.)<br>'+\r\n          '2,Or follow next steps to choose your favorite settings.<br>'+\r\n          '<br>'+\r\n          '1,1. <input type=\"checkbox\" name=\"easy2.reset\"> Reset all settings before loading new one if you prefer.<br>'+\r\n          '1,2. Select a preset: '+\r\n          '<select name=\"easy2.presets\" style=\"float:none\">'+\r\n            '<option>Safe default</option>'+\r\n            '<option>Silent inter-board operability (for beginner)</option>'+ // passive/No/No. works silently.\r\n            '<option>Silent inter-site operability</option>'+  // passive/passive/No, works silently.\r\n//            '<option>Silent in-board operability with tags from OP</option>'+    // active/No/liveTag-OP\r\n            '<option>Active inter-board operability</option>'+ // active/No/LiveTag-OP, scans all catalogs.\r\n            '<option>Active inter-site ondemand operability</option>'+ // active/passive/LiveTag-OP, scans all catalogs, but ondemand for other site.\r\n            '<option>Active inter-site operability</option>'+ // active/active/LiveTag-OP, scans all catalogs.\r\n            '<option>Active in-board operability with LiveTag</option>'+    // active/No/liveTag-Post, scans all threads.\r\n            '<option>Active inter-board operability with LiveTag</option>'+ // active/passive/liveTag-Post, scans all threads.\r\n            '<option>Active inter-site operability with LiveTag</option>'+ // active/active/liveTag-Post, scans all threads.\r\n          '</select><br>'+\r\n          '1,3. Select limits for safe: '+\r\n          '<select name=\"easy2.limits\" style=\"float:none\">'+\r\n            '<option>General</option>'+\r\n            '<option>/all/ for lain, meguca</option>'+\r\n            '<option>/all/ for 4chan</option>'+\r\n            '<option>8chan with top 50 boards</option>'+\r\n            '<option>8chan with top 100 boards</option>'+\r\n            '<option>8chan with top 500 boards</option>'+\r\n            '<option>8chan with all boards</option>'+\r\n            '<option>/all/ for KC</option>'+\r\n          '</select><br>'+\r\n          '1,4. Modify details if you want.<br>'+\r\n          '2,<input type=\"checkbox\" name=\"easy2.virtualBoard.show\"> VirtualBoards, shows '+\r\n          '<input type=\"text\" name=\"easy2.virtualBoard.max\" size=\"3\" style=\"text-align: right;\"> virtual boards<br>'+\r\n          '4,Local: <select name=\"easy2.VB.local\" style=\"float:none\">'+\r\n            '<option>No</option>'+\r\n            '<option>Passive</option>'+\r\n            '<option>Active</option>'+\r\n          '</select>'+\r\n          '&emsp;Global: <select name=\"easy2.VB.global\" style=\"float:none\">'+\r\n            '<option>No</option>'+\r\n            '<option>Passive</option>'+\r\n            '<option>Active</option>'+\r\n          '</select><br>'+\r\n          '2,<input type=\"checkbox\" name=\"easy2.liveTag.use\"> LiveTag, '+\r\n          'from: <select name=\"easy2.LTfrom\" style=\"float:none\">'+\r\n            '<option>OP</option>'+\r\n            '<option>Posts</option>'+\r\n          '</select><br>'+\r\n          '2,<IC\"easy2.catalog.embed\">Use CatChan in catalog<br>'+\r\n          '2,<IC\"easy2.catalog.embed_page\">Use CatChan in index page<br>'+\r\n          '2,<IC\"easy2.thread.embed\">Use CatChan in thread<br>'+\r\n          '2,<IC\"easy2.auto_update\">Auto update, every <ITB2\"easy2.auto_update_period\"> min.<br>'+\r\n          '2,<IC\"easy2.notify.desktop.notify\">Desktop notification<br>'+\r\n          '2,Misc.'+html_funcs.rollup(\r\n            '3,<IC\"easy2.catalog.filter.time_watch\">Hide all threads which have no posts in recent <ITB3\"easy2.time_post\"> hours<br>'+\r\n            '3,<IC\"easy2.catalog.filter.time_watch_creation\">Hide all threads which are created before <ITB3\"easy2.time_op\"> hours ago<br>'+\r\n            '3,<IC\"easy2.stats.use\">Statistics<br>'+\r\n            '3,<IC\"easy2.healthIndicator.expand_running\">Show details of running indicators<br>'+\r\n            '3,<IC\"easy2.network.fetch_actively\">Fetch missing info actively<br>'+\r\n//          '2,<input type=\"checkbox\" name=\"easy2.basics\"> Other basic settings, which depends on preset<br>'+\r\n            '3,<IC\"easy2.basics\">Other basic settings<br>'+\r\n            '3,Limits for safe: <br>'+\r\n            '4,At scan: <ITB6\"easy2.scan.max\"> boards, <ITB6\"easy2.scan.max_threads\"> threads.<br>'+\r\n            '4,In a catalog: <ITB6\"easy2.catalog.max_threads_at_refresh\"> threads.')+'<br>'+\r\n          '1,5. Click <button name=\"easy2.apply\">Apply</button><br>'+\r\n          '1,6. Click <button name=\"save\">Save</button> if you want to save your settings to localStorage<br>'+\r\n          '1,7. Click <button name=\"reload\">Reload</button>, because some setting may need<br>';},\r\n          'Easy Setting:<br>'+\r\n          '&emsp;VBs: virtual boards<br>'+\r\n          '&emsp;AU: auto update every X min<br>'+\r\n          '&emsp;<button name=\"easy.virtualBoard_10_passive\">Click</button> 20 VBs / AU 10 min. / passive scan. (for all)<br>'+\r\n          '&emsp;<button name=\"easy.virtualBoard_10\">Click</button> 20 VBs / AU 10 min. (for lainchan and meguca)<br>'+\r\n          '&emsp;<button name=\"easy.virtualBoard_1\">Click</button> 100 VBs / AU 1 min. (for 4chan)<br>'+\r\n          '&emsp;<button name=\"easy.virtualBoard_8_50\">Click</button> 100 VBs / AU 5 min from top '+\r\n          '<input type=\"text\" name=\"easy.max_boards\" size=\"3\" style=\"text-align: right;\">'+\r\n          ' boards. (for 8chan)<br>'+\r\n//          '&emsp;<button name=\"easy.virtualBoard_8_100\">Click</button> 100 VBs / AU 5 min from top 100 boards. (for 8chan)<br>'+\r\n//          '&emsp;<button name=\"easy.virtualBoard_8_500\">Click</button> 100 VBs / AU 5 min from top 500 boards. (for 8chan)<br>'+\r\n          '&emsp;<button name=\"easy.virtualBoard_8_all\">Click</button> 100 VBs / AU 5 min from all boards. (for 8chan)<br>'+\r\n          '&emsp;<button name=\"easy.virtualBoard_interSite\">Click</button> 100 VBs / AU 10 min from all sites. / passive scan. (for all)<br>'+\r\n          '<br>'+\r\n          '&emsp;<button name=\"easy.posts_0h\">Click</button> I want to check all new posts from now.<br>'+\r\n          '&emsp;<button name=\"easy.posts_24h\">Click</button> I want to check all posts from '+\r\n          '<input type=\"text\" name=\"easy.posts_ago\" size=\"3\" style=\"text-align: right;\">'+\r\n          ' hours ago.<br>'+\r\n          '&emsp;<button name=\"easy.threads_24h\">Click</button> I want to check all new threads from '+\r\n          '<input type=\"text\" name=\"easy.threads_ago\" size=\"3\" style=\"text-align: right;\">'+\r\n          ' hours ago.<br>'+\r\n          '<br>'+\r\n//          '&emsp;<button name=\"easy.embed_index\">Click</button> Use CatChan in index page without infinite scroll.<br>'+\r\n          '&emsp;<button name=\"easy.embed_index_lazy\">Click</button> Setup for narrow band.<br>'+\r\n          '&emsp;<button name=\"easy.embed_index_infinite\">Click</button> Setup for infinite scroll.<br>'+\r\n          '&emsp;<button name=\"easy.embed_index_backwash\">Click</button> Backwash style. (infinite scroll/quick auto update)<br>'+\r\n          '<br>'+\r\n          '&emsp;<button name=\"easy.light\">Click</button> Setup for light start up.<br>'+\r\n          '',\r\n          function(html_funcs){return 'Virtual Board:<br>'+\r\n            '&emsp;<input type=\"checkbox\" name=\"virtualBoard.show\"> Show virtual boards'+\r\n            ', up to: <input type=\"text\" name=\"virtualBoard.max\" size=\"3\" style=\"text-align: right;\"><br>'+\r\n            '2,<ICBX\"virtualBoard.search.show\"> Show search bar in boardlist<br>'+\r\n//            '3,<ICBX\"virtualBoard.search.re\"> Regular Expression<br>'+\r\n            '&emsp;<input type=\"checkbox\" name=\"virtualBoard.scan\"> Scan at start up'+\r\n            ', delay: <input type=\"text\" name=\"virtualBoard.scanDelay\" size=\"2\" style=\"text-align: right;\">s<br>'+\r\n            '&emsp;&emsp;&emsp;Scan: <button name=\"virtualBoard.scanStart\">Start</button>'+\r\n            '&emsp;<button name=\"virtualBoard.scanStop\">Stop</button><br>'+\r\n            html_funcs.vb_domains()+\r\n            '&emsp;&emsp;<input type=\"checkbox\" name=\"virtualBoard.instant_scan\"> Instant scan<br>'+\r\n            '&emsp;Physical boards in boardlist:<br>'+\r\n            '&emsp;&emsp;<input type=\"radio\" name=\"virtualBoard.p_board\" value=\"both\"> Show as they are<br>'+\r\n            '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"virtualBoard.p_remove\"> Remove virtual boards of the same name<br>'+\r\n            '&emsp;&emsp;<input type=\"radio\" name=\"virtualBoard.p_board\" value=\"replace\"> Replace with virtual boards<br>'+\r\n//            '3,<ICBX\"virtualBoard.v_remove\"> Remove filtered virtual boards<br>'+\r\n            '1,<IC\"liveTag.info\">Show infomation on hover<br>'+\r\n            '1,Styles:'+html_funcs.rollup(\r\n            '2,Selected:<ITBL30\"liveTag.style.in\"><br>'+\r\n            '2,Excluded:<ITBL30\"liveTag.style.ex\"><br>'+\r\n            '2,<IC\"liveTag.style.use\">Add style for unread posts:<br>'+\r\n  //          '&emsp;&emsp;Unread replies to me:<textarea rows=\"1\" cols=\"20\" name=\"liveTag.style_urtm_str\"></textarea><br>'+\r\n  //          '&emsp;&emsp;Unread replies:<textarea rows=\"1\" cols=\"20\" name=\"liveTag.style_ur_str\"></textarea><br>'+\r\n            '3,Unread replies to me:<ITBL30\"liveTag.style.urtm\"><br>'+\r\n            '3,Unread replies:<ITBL30\"liveTag.style.ur\"><br>'+\r\n            '3,Unread replies to me + selected:<ITBL30\"liveTag.style.inurtm\"><br>'+\r\n            '3,Unread replies + selected:<ITBL30\"liveTag.style.inur\"><br>'+\r\n            '3,Unread replies to me + excluded:<ITBL30\"liveTag.style.exurtm\"><br>'+\r\n            '3,Unread replies + excluded:<ITBL30\"liveTag.style.exur\">')+'<br>';},\r\n          function(html_funcs){\r\n            return html_funcs.show_hide_all_to_header('Catalog:') + '<br>'+\r\n              '&emsp;<input type=\"checkbox\" name=\"catalog.embed\"> Use CatChan in catalog<br>'+\r\n              html_funcs.expand_thumbnail_hover('catalog')+\r\n              html_funcs.popup_others('catalog')+\r\n              '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.open_spoiler_text\"> Open text spoiler<br>'+\r\n              '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.auto_update\"> Auto update, every '+\r\n              '<input type=\"text\" name=\"catalog.auto_update_period\" size=\"2\" style=\"text-align: right;\"> min.<br>'+\r\n              '&emsp;&emsp;<input type=\"checkbox\" name=\"page.mark_new_posts\"> Mark new posts when you open a thread<br>'+\r\n              '2,'+ html_funcs.rollup_radio('catalog.click_area', ' :Click to open the thread', 3, '',\r\n                ['thumbnail:Thumbnail','entire:Entire thread card'])+ '<br>'+\r\n              '2,'+ html_funcs.rollup_radio(!pref.test_mode['110']? 'catalog.popup3.ww':'catalog.popup2',' :Pop up', 3,\r\n                '3,WW/WN/NW/NN (Wider/Narrower) side:'+html_funcs.rollup(html_funcs.popup_delay('proto.popup3.'))+'<br>',\r\n                ['no:No','sr:Search result','srpv:Search result or preview','pv:Preview','chart:Post rate chart (statistics must be activated)','dp:Deleted posts'], '',['catalog.popup3.wn','catalog.popup3.nw','catalog.popup3.nn'])+ '<br>'+\r\n              '2,'+ html_funcs.rollup_radio('catalog.t2h_sel',' :Num of posts for preview or footer', 3, '',\r\n                ['no:No','N:Last <ITB3\"catalog.t2h_num_of_posts\"> posts (N posts)',\r\n                 'N_unread:N + all unread posts', 'unread:All unread posts', 'ALL:All posts' //, ALL_agg:All posts from all scanned threads'\r\n                ]) +'<br>'+\r\n              html_funcs.posts_for_search('catalog')+\r\n              html_funcs.op_in_search_result('catalog')+\r\n              html_funcs.deleted_posts_detection('catalog')+'<br>'+\r\n              '2,<IC\"catalog.detect_sage\">Detect saged posts in 4chan<br>'+\r\n              '3,<IC\"catalog.page_his\">Store page history in 4chan<br>'+\r\n              html_funcs.backlink('catalog')+\r\n              '2,<IC\"catalog.save_board_list_sel\">Save board group index<br>'+\r\n              '2,<IC\"catalog.promiscuous\">Show all fetched threads<br>'+\r\n              '1,<IC\"catalog.embed_archive\">Generate catalog in archive'+html_funcs.rollup(\r\n                '5,from top <ITB5\"scan.max_archive\"> threads')+'<br>'+\r\n              '<br>'+\r\n              '1,Environment values:(advanced option)'+ html_funcs.rollup(\r\n                '2,You are using native function of:<br>'+\r\n                '3,<IC\"catalog.env.image_hover_native\">Image hover<br>'+\r\n                '2,<IC\"catalog.env.refresh_initial\">Refresh at initial') + '<br>';},\r\n          function(html_funcs){\r\n            return html_funcs.show_hide_all_to_header('Index Page:') + '<br>'+\r\n              '&emsp;<input type=\"checkbox\" name=\"catalog.embed_page\"> Use CatChan in index page' + html_funcs.rollup(\r\n                '3,Refresh up to:<br>'+\r\n                '4,<IR\"catalog_max_page_select,manual\"> <ITB2\"catalog_max_page\"> pages<br>'+\r\n                '4,<IR\"catalog_max_page_select,auto\"> Max pages<br>'+\r\n                '5,<ICBX\"catalog_max_page_auto\"> Update automatically') +'<br>'+\r\n    //          '&emsp;&emsp;<input type=\"checkbox\" name=\"page.infinite\"> Infinite scroll<br>'+\r\n              html_funcs.popup('page')+\r\n              html_funcs.expand_thumbnail_inline('page')+\r\n              html_funcs.expand_thumbnail_hover('page')+\r\n              html_funcs.popup_others('page')+\r\n              html_funcs.format_posts('page', html_funcs)+\r\n    //          '&emsp;&emsp;<input type=\"checkbox\" name=\"page.scan_tag\"> Scan tags at initial<br>'+\r\n    //          '&emsp;&emsp;<input type=\"checkbox\" name=\"page.format.show.posts\"> Show posts<br>'+\r\n              '2,<ICBX\"page.use_expander_always\"> Use CatChan\\'s expander always<br>'+\r\n              '2,' + html_funcs.rollup_radio('page.t2h_sel', ' :Num of posts to show', 3, '',\r\n                ['page:Inherit from index page',\r\n                 'L: <ITB3\"page.t2h_L\"> posts(L posts)',\r\n                 'M: <ITB3\"page.t2h_M\"> posts(M posts)',\r\n                 'N: <ITB3\"page.t2h_num_of_posts\"> posts(N posts)',\r\n                 'N_unread:N + all unread posts',\r\n                 'unread:All unread posts',\r\n                 'ALL:All posts',\r\n//                 'ALL_agg:All posts (for incremental posts search)',\r\n                ]) +'<br>'+\r\n              html_funcs.posts_for_search('page')+\r\n              html_funcs.op_in_search_result('page')+\r\n              html_funcs.updates('page')+\r\n              '&emsp;&emsp;<input type=\"checkbox\" name=\"page.scroll_lock\"> Don\\'t scroll at update<br>'+\r\n              '2,<IC\"page.save_board_list_sel\"> Save board group index<br>'+\r\n              '2,<IC\"page.promiscuous\">Show all fetched threads<br>'+\r\n              '<br>'+\r\n              html_funcs.env('page.env','');},\r\n          function(html_funcs){\r\n            return html_funcs.show_hide_all_to_header('Thread:') + '<br>'+\r\n              '&emsp;<input type=\"checkbox\" name=\"thread.embed\"> Use CatChan in thread<br>'+\r\n              html_funcs.popup('thread')+\r\n              html_funcs.expand_thumbnail_inline('thread')+\r\n              html_funcs.expand_thumbnail_hover('thread')+\r\n              html_funcs.popup_others('thread')+\r\n//              (pref.test_mode['121']? html_funcs.popupX('thread','proto.popupID.', 'Pop up ID') + html_funcs.popupX('thread','proto.popupFlag.','Pop up Flag'):'')+\r\n              html_funcs.format_posts('thread', html_funcs)+\r\n              html_funcs.updates('thread')+\r\n              '2,<IC\"archive.IDB.redirect_404\">Open archive from IDB if 404'+html_funcs.rollup(\r\n                '3,<IC\"archive.IDB.redirect_404_CSP\">Open blob to bypass Content Security Policy')+'<br>'+\r\n    //          '&emsp;<input type=\"checkbox\" name=\"thread.save_board_list_sel\"> Save board group index<br>'+\r\n              '<br>'+\r\n              html_funcs.env('thread.env', '<br>3,<input type=\"checkbox\" name=\"thread.env.auto_update_native\"> Auto update');},\r\n          'Floating Catalog:<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"float.auto_update\"> Auto update, every '+\r\n          '<input type=\"text\" name=\"float.auto_update_period\" size=\"2\" style=\"text-align: right;\"> min.<br>'+\r\n          '&emsp;Click to:<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"float.click\" value=\"open\">Go to/open the thread<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"float.click\" value=\"expand\">Expand/shrink the OP in catalog<br>'+\r\n//          '&emsp;&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_expand_at_initial\"> Expand at initial<br>'+\r\n//          '&emsp;&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_expand_at_initial_embed\"> Expand at initial in index.<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_expand_with_hr\"> Insert horizontal splitter when it is expanded<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_no_popup_at_expanded\"> Don\\'t popup when the catalog is expanded<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"float.click\" value=\"none\">None<br>'+\r\n          '&emsp;Click area:<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"float.click_area\" value=\"thumbnail\">Thumbnail<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"float.click_area\" value=\"entire\">Entire thread card<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"float.popup2\"> Use pop-up window<br>'+\r\n          '2,appear/disappear:<br>'+\r\n          '3,<IR\"catalog_popdown,imm\">immediately<br>'+\r\n          '3,<IR\"catalog_popdown,delay\">delayed: <ITB4\"catalog_popup_delay\"><ITB4\"catalog_popdown_delay\"> ms<br>'+\r\n          '2,grab to move / select text:<br>'+\r\n          '3,<IR\"proto.popup2_sel,move\">Move always<br>'+\r\n          '3,<IR\"proto.popup2_sel,auto\">Auto, padding-x:<ITB4\"proto.popup2_sel_tolerance\"> px<br>'+\r\n          '3,<IR\"proto.popup2_sel,sel\">Select always<br>'+\r\n          '3,<ICBX\"catalog_popup_size_fix\"> Fix size when you move it<br>'+\r\n          '2,<IC\"proto.popup2_resize\">Resize on borders of <ITB4\"proto.popup2_resize_bw\"> px<br>'+\r\n          '3,Size of corner angle: <ITB4\"proto.popup2_resize_cw\"> px<br>'+\r\n//          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_localtime\"> Localtime<br>'+\r\n          '1,At initial:<br>'+\r\n          '2,<IR\"catalog.appearance.initial.state,max\">Maximized<br>'+\r\n          '2,<IR\"catalog.appearance.initial.state,float\">Floating '+ \r\n          '<ITB4\"catalog.appearance.initial.width\"> x '+\r\n          '<ITB4\"catalog.appearance.initial.height\"><br>'+\r\n          '4,left:<ITB4\"catalog.appearance.initial.left\">px, '+\r\n          'top:<ITB4\"catalog.appearance.initial.top\">px<br>'+\r\n          '2,<IR\"catalog.appearance.initial.state,top\">Embed to top<br>'+\r\n          '2,<IR\"catalog.appearance.initial.state,bottom\">Embed to bottom<br>'+\r\n          '1,<IC\"float.save_board_list_sel\">Save board group index<br>'+\r\n          '',\r\n          'General 0:<br>'+\r\n          '&emsp; Open short link<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_last50\" value=\"no\">No. Open entire thread<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_last50\" value=\"exist\">If it exists<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_last50\" value=\"exist_watch\">If it exists and all unread posts are in it<br>'+\r\n////          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_last50\" value=\"speculative\">If it is estimated to exist<br>'+\r\n////          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_last50\" value=\"spec_watch\">If it is estimated to exist and unread posts are less than 50<br>'+\r\n          '&emsp; Open the thread in<br>'+\r\n//          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_open_where_click\"> Apply to reply links in index page<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_where\" value=\"_self\">this tab<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_where\" value=\"_blank\">new tab always<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_where\" value=\"named\">named tab<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog_open_where\" value=\"CatChan_tgt\">a fixed tab<br>'+\r\n//          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_use_named_window\"> Prevent opening a thread in multiple tabs<br>'+\r\n          '2,<ICBX\"pref2.meguca.historyAPI\"> Use historyAPI in meguca'+\r\n          '<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog_triage\"> Enable triage pop-up<br>'+\r\n          '2,Where to show:<br>'+\r\n          '3,<span style=\"display:inline-block\">'+\r\n            '<IR\"catalog_triage_place,topLeft\">Top left<br>'+\r\n            '<IR\"catalog_triage_place,bottomLeft\">Bottom left'+\r\n          '</span>'+\r\n          '<span style=\"display:inline-block\">'+\r\n            '<IR\"catalog_triage_place,topRight\">Top right<br>'+\r\n            '<IR\"catalog_triage_place,bottomRight\">Bottom right'+\r\n          '</span><br>'+\r\n          '&emsp;&emsp;pop down delay: <input type=\"text\" name=\"triage.popdown_delay\" size=\"4\" style=\"text-align: right;\">ms<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"triage.show_always\"> Don\\'t pop down while the mouse is on the thread<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"triage.hide_toggle\"> Hide useless toggle buttons<br>'+\r\n          '&emsp;&emsp;Style:<br>'+\r\n          '&emsp;&emsp;&emsp;<textarea style=\"height:1em\" cols=\"40\" name=\"catalog_triage_str\"></textarea><br>'+\r\n          '<!-- &emsp;<input type=\"checkbox\" name=\"catalog_enable_cross_board\"> Enable cross-board catalog<br> -->'+\r\n          '<!-- &emsp;<input type=\"checkbox\" name=\"catalog_enable_cross_domain\"> Enable cross-domain catalog<br> -->'+\r\n          '<!-- &emsp;&emsp; Cache working in <textarea style=\"height:1em\" cols=\"20\" name=\"catalog_sw_domain\"></textarea><br> -->'+\r\n          '&emsp;&emsp;Sample triage:<br>'+\r\n          '&emsp;&emsp;&emsp;<button name=\"triage_simple_kill\">simple_kill</button>'+\r\n          '&emsp;<button name=\"triage_simple\">simple</button>'+\r\n          '&emsp;<button name=\"triage_basic\">basic</button>'+\r\n          '&emsp;<button name=\"triage_basic_color\">basic_color</button><br>'+\r\n          '&emsp;&emsp;&emsp;<button name=\"triage_colorful\">colorful</button>'+\r\n          '&emsp;<button name=\"triage_borders\">borders</button>'+\r\n          '&emsp;<button name=\"triage_samples\">samples</button>'+\r\n          '&emsp;<button name=\"triage_test\">test</button>'+\r\n          '<br>'+\r\n          '',\r\n          function(html_funcs){\r\n            return 'General 1:<br>'+\r\n              '&emsp;Shows in title bar:<br>'+\r\n              '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.appearance.titleBar.filter\">Checkbox to show filter<br>'+\r\n              '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.appearance.titleBar.settings\">Checkbox to show settings<br>'+\r\n              '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.appearance.titleBar.refresh\">Refresh button<br>'+\r\n              '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.appearance.titleBar.num_of_pages\">Num of pages to refresh<br>'+\r\n              '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.appearance.titleBar.boards_selector\">Boards selector<br>'+\r\n              '<br>'+\r\n              '&emsp;<input type=\"checkbox\" name=\"catalog.embed_frame\"> Embed to frame<br>'+\r\n              '&emsp;&emsp;Frame size : '+\r\n              '&emsp;&emsp;<input type=\"text\" name=\"catalog_size_frame0_width\" size=\"4\" style=\"text-align: right;\">%, '+\r\n              '&emsp;&emsp;<input type=\"text\" name=\"catalog_size_frame1_width\" size=\"4\" style=\"text-align: right;\">%<br>'+\r\n    //          '&emsp;Max threads in catalog: <input type=\"text\" name=\"catalog.max_threads\" size=\"4\" style=\"text-align: right;\"><br>'+\r\n              '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.refresh.except_bt\"> Except the page of selecting boards\\' tag.<br>'+\r\n              '&emsp;<input type=\"checkbox\" name=\"catalog.refresh.at_switch\"> Clear and refresh when boards are switched<br>'+\r\n              '&emsp;<input type=\"checkbox\" name=\"common.clear_at_manual_scan\"> Clear all threads at manual scan<br>'+\r\n              '1,'+ html_funcs.rollup_radio('liveTag.rm_404',' :Remove 404 threads', 2, '',\r\n                ['imm:Immediately','watched:Keep watched threads','unread:Keep watched threads if they have unread posts', 'no:No, keep all threads remain']) +'<br>'+\r\n              '&emsp;<input type=\"checkbox\" name=\"catalog.bookmark_list_rm404\"> Remove 404 threads from bookmark<br>'+\r\n              '&emsp;<input type=\"checkbox\" name=\"pref2.8chan.utilize_boards_json\"> Utilize boards.json in 8chan<br>'+\r\n              '1,<ICBX\"pref2.meguca.utilize_boards_json\"> Utilize boardTimestamps in meguca<br>'+\r\n              '2,<ICBX\"pref2.meguca.utilize_boards_json_domain\"> Utilize boardTimestamps at refresh in meguca<br>';},\r\n//              '&emsp;<input type=\"checkbox\" name=\"filter.disable_list_when_kwd_active\"> Disable list filter when keyword filter is active<br>';},\r\n          'Board Group:<br>'+\r\n          '&emsp;configuration:<br>'+\r\n          '&emsp;&emsp;<textarea rows=\"1\" cols=\"60\" name=\"catalog_board_list_str\"></textarea><br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.board.recommendation\"> Read owner\\'s recommendation '+\r\n          '&emsp;&emsp;<button name=\"tag.recommendation_add\">Add to list</button><br>'+\r\n          '2,<IC\"catalog.board.all_boards\">Add all boards group to the last<br>'+\r\n//          '&emsp;&emsp;<input type=\"button\" value=\"Scan\"> Scan board tags<br>'+\r\n//          '&emsp;&emsp;<input type=\"button\" value=\"Generate\" name=\"tag.generate\"> Generate board groups from tags <br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.board.board_tags\"> Generate board groups from tags '+\r\n          '&emsp;&emsp;<button name=\"tag.scan\">Scan</button><br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.board.board_tags_same\"> Pick up boards which have the same tag'+\r\n          '&emsp;&emsp;<button name=\"tag.same_tag_refresh\">Refresh</button><br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.board.ex_list\"> Use exclusive list<br>'+\r\n          '&emsp;&emsp;<textarea rows=\"1\" cols=\"40\" name=\"catalog.board.ex_list_str\"></textarea><br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.style_general_list\"> Use general style<br>'+\r\n          '&emsp;&emsp;<textarea rows=\"1\" cols=\"40\" name=\"catalog.style_general_list_str\"></textarea><br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.mimic_base_site\"> Mimic base site<br>'+\r\n////////          '&emsp;Tagging:<br>'+\r\n////////          '&emsp;&emsp;Ignore tags latter than <input type=\"text\" name=\"catalog.tag.ignore\" size=\"2\" style=\"text-align: right;\">th in a board/thread<br>'+\r\n////////          '&emsp;&emsp;Ignore boards/threads which have more than <input type=\"text\" name=\"catalog.tag.max\" size=\"2\" style=\"text-align: right;\"> tags<br>'+\r\n          '&emsp;Scan:<br>'+\r\n          '&emsp;&emsp;Max scan boards <input type=\"text\" name=\"scan.max\" size=\"6\" style=\"text-align: right;\"><br>'+\r\n          '&emsp;&emsp;Max found threads <input type=\"text\" name=\"scan.max_threads\" size=\"6\" style=\"text-align: right;\"><br>'+\r\n////////          '&emsp;&emsp;Reload older than <input type=\"text\" name=\"scan.lifetime\" size=\"6\" style=\"text-align: right;\"> minutes old<br>'+\r\n          '&emsp;&emsp;Num of crawler: <input type=\"text\" name=\"scan.crawler\" size=\"2\" style=\"text-align: right;\"><br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"scan.crawler_adaptive\"> Spawn adaptively at idle' + \r\n          '<input type=\"text\" name=\"scan.crawler_idle_time_to_spawn\" size=\"2\" style=\"text-align: right;\">ms<br>'+\r\n          '',\r\n          'Live Tag:<br>'+\r\n          '1,From:<br>'+\r\n          '2,<IR\"liveTag.from,op\">OP<br>'+\r\n          '2,<IR\"liveTag.from,post\">All posts<br>'+\r\n          '1,<ICBX\"liveTag.use\"> Live<br>'+\r\n//          '4,<ICBX\"stats.use\"> Take statistics<br>'+\r\n          '1,max: <ITB2\"liveTag.max\">'+\r\n          ', max string length: <ITB2\"liveTag.maxstr\"><br>'+\r\n          '1,<ICBX\"liveTag.ci\"> Case insensitive<br>'+\r\n          '1,<ICBX\"liveTag.inherit_board_name\"> Inherits board\\'s name as a tag<br>'+\r\n          '2,<ICBX\"liveTag.lock_board_name\"> Lock & sticky<br>'+\r\n          '1,<ICBX\"liveTag.inherit_board_tags\"> Inherits board\\'s tags<br>'+\r\n          '2,<ICBX\"liveTag.lock_board_tags\"> Lock & sticky<br>'+\r\n          '1,<ICBX\"liveTag.lock_tags_in_op\"> Lock & sticky tags in OP<br>'+\r\n          '1,<ICBX\"liveTag.ex_list\"> Use exclusive list<br>'+\r\n          '2,String list to remove before extraction (costs much)<br>'+\r\n          '3,<textarea rows=\"1\" cols=\"40\" name=\"liveTag.rm_list_str\"></textarea><br>'+\r\n          '2,Tag list to remove after extraction (costs less)<br>'+\r\n          '3,<textarea rows=\"1\" cols=\"40\" name=\"liveTag.ex_list_str\"></textarea><br>'+\r\n          '1,Click function: tags in <br>'+\r\n          '2,boardlist / threads<br>'+\r\n          '2,<IR\"liveTag.click_func_bl,pkin\"><IR\"liveTag.click_func,pkin\">None -> Fetch/In -> None<br>'+\r\n          '2,<IR\"liveTag.click_func_bl,in\"><IR\"liveTag.click_func,in\">None -> In -> None<br>'+\r\n          '2,<IR\"liveTag.click_func_bl,inex\"><IR\"liveTag.click_func,inex\">None <-> In <-> Out <-> None (ctrl for backward)<br>'+\r\n          '2,<IR\"liveTag.click_func_bl,ex\"><IR\"liveTag.click_func,ex\">None -> Out -> None<br>'+\r\n          '1,Update intervals:<br>'+\r\n          '2,Foreground: <ITB4\"liveTag.disp_delay.fg\">ms<br>'+\r\n          '2,Background: <ITB4\"liveTag.disp_delay.bg\">ms<br>'+\r\n          '2,Lazy draw of incremental search:<br>'+\r\n          '3,every <ITB4\"liveTag.lazy_each\"> tags with <ITB4\"liveTag.lazy_delay\"> ms delay<br>',\r\n          function(html_funcs){\r\n            return 'Statistics:<br>'+\r\n////            '&emsp;&emsp;Statistics is a subfunction of the LiveTag,<br>'+\r\n////            '&emsp;&emsp;You must activate it beforehand and RELOAD to start.<br>'+\r\n////            '&emsp;&emsp;Then, the \"Graph\" button will appear in the setting button([CC])<br>'+\r\n//////            '&emsp;&emsp;And this function uses both local and server timestamps,<br>'+\r\n//////            '&emsp;&emsp;your local clock must be accurate.<br>'+\r\n////            '<span style=\"float:left\">&emsp;&emsp;<button name=\"easy.stat_activate\">Activate</button></span>'+\r\n////            '<span>'+\r\n////              '&emsp;<input type=\"checkbox\" name=\"stats.use\"> Take statistics<br>'+\r\n////              '&emsp;<input type=\"checkbox\" name=\"stats.estimate_posts\"> Estimate num of posts from posts\\' No.<br>'+\r\n////            '</span>'+\r\n////            '<br>'+\r\n            '1,<ICBX\"stats.use\"> Take statistics<br>'+\r\n            '3,<ICBX\"stats.estimate_posts\"> Estimate num of posts from posts\\' No.<br>'+\r\n            '4,<ICBX\"stats.patch_tm\"> Patch for thread move<br>'+\r\n            '2,Default settings:<br>'+\r\n            '3,Time unit: '+ chart_obj.time_unit_sel_html + '<br>' +\r\n            '3,' + chart_obj.chart_options_str.join('&emsp;&emsp;&emsp;') +\r\n            '3,Size of window: <ITB4\"chart.window_width\"> x <ITB4\"chart.window_height\"><br>'+\r\n            '<br>'+\r\n//            '&emsp;Data of pruned threads:<br>'+\r\n//            '&emsp;&emsp;<input type=\"checkbox\" name=\"stats.retain_404\"> Retain values of pruned thread<br>'+\r\n            '2,Accumulation:<br>'+\r\n            '3,<ICBX\"stats.load\"> Load data<br>'+\r\n            '4,<ICBX\"stats.save\"> Save data: <ITB4\"stats.len_capture\"> points<br>'+\r\n            '4,Auto acquisition of data:<br>'+\r\n            '5,<ICBX\"stats.auto_acquisition_all\"> All board groups which you saw once<br>'+\r\n            '5,<ICBX\"stats.auto_acquisition\"> Board groups with \\'!stats\\'<br>'+\r\n            '6,<ICBX\"stats.auto_acquisition_scan\"> Scan all targets at startup with '+\r\n            '<ITB2\"stats.auto_acquisition_scan_delay\"> secs delay<br>'+\r\n            '5,(Targets are colored <span style=\"background:#b5fbda\">green</span> in board selector)<br>'+\r\n            '<br>'+\r\n            '2,<ICBX\"chart.instant_scan\"> Instant scan at switching board group<br>'+\r\n            '2,Delay to draw: <ITB2\"stats.draw_delay\"> sec.<br>'+\r\n            '2,<ICBX\"chart.off_anime_blur\"> Off animation in background<br>'+\r\n            '2,<ICBX\"stats.tolerant\"> Tolerant of inaccuracy of server and local clocks<br>'+\r\n            '5,up to <input type=\"text\" name=\"stats.tolerance\" size=\"2\" style=\"text-align: right;\"> min<br>'+\r\n            '';\r\n          },\r\n          'Design of Floating Catalog:<br>'+\r\n          '<input type=\"radio\" name=\"catalog.text_mode.mode\" value=\"graphic\"> Graphical mode: '+\r\n          '<input type=\"text\" name=\"catalog_size_width\" size=\"4\" style=\"text-align: right;\"> x '+\r\n          '<input type=\"text\" name=\"catalog_size_height\" size=\"4\" style=\"text-align: right;\"><br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.format.thumb.resize\">Resize thumbnails in embed catalog<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"page.format.thumb.resize\">Resize thumbnails in embed page<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"float.format.thumb.resize\">Resize thumbnails in float catalog<br>'+\r\n          '&emsp;&emsp;&emsp;1st thumbnail: '+\r\n          '<input type=\"text\" name=\"catalog_size_tn1_width\" size=\"4\" style=\"text-align: right;\"> x '+\r\n          '<input type=\"text\" name=\"catalog_size_tn1_height\" size=\"4\" style=\"text-align: right;\"><br>'+\r\n          '&emsp;&emsp;&emsp;2nd and later: '+\r\n          '<input type=\"text\" name=\"catalog_size_tn2_width\" size=\"4\" style=\"text-align: right;\"> x '+\r\n          '<input type=\"text\" name=\"catalog_size_tn2_height\" size=\"4\" style=\"text-align: right;\"><br>'+\r\n          '&emsp;Catalog/Pop-up/Search<br>'+\r\n          '<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"float.format.show.images_2nd\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.hover.images_2nd\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.search.images_2nd\"> 2nd or more images in OP<br> -->'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"float.format.show.posts\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.hover.posts\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.search.posts\"> Posts<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"float.format.show.fileinfo\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.hover.fileinfo\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.search.fileinfo\"> File information<br>'+\r\n          '<!--&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_checkbox_deletion_show\">'+\r\n          '<input type=\"checkbox\" name=\"catalog_checkbox_deletion_hover\">'+\r\n          '<input type=\"checkbox\" name=\"catalog_checkbox_deletion_search\"> Checkbox for deletion<br> -->'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"float.format.show.contents\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.hover.contents\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.search.contents\"> Format contents<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"float.format.show.layout\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.hover.layout\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.search.layout\"> Format layout<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"float.format.show.style\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.hover.style\">'+\r\n          '<input type=\"checkbox\" name=\"float.format.search.style\"> Format style<br>'+\r\n          '<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"catalog_border_show\">&emsp;&emsp;&emsp; Show border<br> -->'+\r\n          '<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"catalog_enable_background\">&emsp;&emsp;&emsp; Use backgfound color<br> -->'+\r\n          '&emsp;Num of posts in thread headline: <input type=\"text\" name=\"float.t2h_num_of_posts\" size=\"3\" style=\"text-align: right;\"><br>'+\r\n          '<input type=\"radio\" name=\"catalog.text_mode.mode\" value=\"text\"> Text mode: '+\r\n          '<input type=\"text\" name=\"catalog_size_text_width\" size=\"4\" style=\"text-align: right;\"> x '+\r\n          '<input type=\"text\" name=\"catalog_size_text_height\" size=\"4\" style=\"text-align: right;\"><br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.text_mode.sub\"> Show title<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.text_mode.name\"> Show op\\'s name<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.text_mode.com\"> Show op\\'s comment<br>'+\r\n          '',\r\n          function(html_funcs){return 'Footer:<br>'+html_funcs.footer('catalog');},\r\n          function(html_funcs){return 'Footer for watcher:(under construction)<br>'+html_funcs.footer('float');},\r\n          'Watcher:<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"liveTag.watch_all\"> Watch all boards<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.auto_watch\"> Auto add to watch list<br>'+\r\n//          '&emsp;<input type=\"checkbox\" name=\"catalog.order.find_sage_in_8chan\"> Find sage post in native catalog in 8chan<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"catalog.unmark_on_hover\"> Unmark post on hover<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"thread_reader.use\"> Thread reader<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"thread_reader.own_posts_tracker\"> Own posts tracker<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;>> (You)<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;<input type=\"radio\" name=\"thread_reader.show_reply_to_me_by\" value=\"anchor\"> anchor text<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;<input type=\"radio\" name=\"thread_reader.show_reply_to_me_by\" value=\"plain\"> plain text (for dollchan)<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;(You) in name field<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;<input type=\"radio\" name=\"thread_reader.show_own_post_by\" value=\"anchor\"> name string<br>'+\r\n          '&emsp;&emsp;&emsp;&emsp;<input type=\"radio\" name=\"thread_reader.show_own_post_by\" value=\"plain\"> plain text<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"thread_reader.clean_up_own_posts\"> Clean up localStorage at loading embed native catalog<br>'+\r\n          '&emsp;&emsp;<input type=\"checkbox\" name=\"thread_reader.sync\"> Sync with parent catalog<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"thread_reader.triage\"> Show triage to parent catalog<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"thread_reader.triage_close\"> Close window when triage is clicked<br>'+\r\n          '2,ID enhancer:<br>'+\r\n          '4,<IC\"IDinfo.auto\">Auto off when OP doesn\\'t have ID or flag<br>'+\r\n          '3,<IC\"IDinfo.ID\">Show count of posts by each ID<br>'+\r\n          '4,<IC\"IDinfo.nofIDs\">Show count of IDs at the time of post<br>'+\r\n          '4,<IC\"IDinfo.IDop\">Show \\'OP\\' for ID of OP<br>'+\r\n          '3,<IC\"IDinfo.flag\">Show count of posts by each flag<br>'+\r\n          '4,<IC\"IDinfo.nofFlags\">Show count of flags at the time of post<br>'+\r\n          '4,<IC\"IDinfo.IDFlag\">Show count of IDs by each Flag<br>'+\r\n          '3,<IC\"IDinfo.name\">Show count of posts by each name<br>'+\r\n          '4,<IC\"IDinfo.nofNames\">Show count of names at the time of post<br>'+\r\n          '4,<IC\"IDinfo.nameTrip\">Show count of trips by each name<br>'+\r\n          '3,<IC\"IDinfo.trip\">Show count of posts by each trip<br>'+\r\n          '4,<IC\"IDinfo.nofTrips\">Show count of trips at the time of post<br>',\r\n          function(html_funcs){return 'Notifiers:<br>'+\r\n            '1,<ICBX\"notify.desktop.notify\"> Desktop Notification'+ sub('desktop', html_funcs,\r\n            '3,<ITB3\"notify.desktop.lifetime\"> secs (0 means permanent)<br>'+\r\n            '3,max: <ITB3\"notify.desktop.limit\">, '+\r\n              'delay: <ITB3\"notify.desktop.delay\">ms<br>'+\r\n            '3,<ICBX\"notify.desktop.show_last\"> Show the last post only<br>')+\r\n            '1,<ICBX\"notify.favicon\"> Favicon<br>'+\r\n            '1,<ICBX\"notify.title.notify\"> Show number of unread replies in title<br>'+\r\n            '2,<ICBX\"notify.title.hide_zero\"> Hide unread count in title bar when it is zero<br>'+\r\n            '1,<IC\"notify.sound.notify\">Sound&emsp;&emsp;<BTN\"notify.sound.pause,Pause\">'+ sub('sound', html_funcs,\r\n            '3,<IR\"notify.sound.src,beep\">Beep '+\r\n              '&emsp;freq:<ITB4\"notify.sound.beep_freq\"> '+\r\n              'length:<ITB4\"notify.sound.beep_length_f\"> '+\r\n              'volume:<ITB4\"notify.sound.beep_volume_f\"><br>'+\r\n            '3,<IR\"notify.sound.src,file\">File '+\r\n            '&emsp;<input type=\"file\" accept=\"audio/*\" name=\"notify.sound.file\"><br>');\r\n            function sub(prop, funcs, str){ return funcs.rollup(\r\n              '4,<IC\"notify.'+prop+'.supp_init\">Suppressed at initial')+ '<br>'+\r\n              str+\r\n              '2,<IC\"notify.'+prop+'.reply_to_me\">New replies to me<br>'+\r\n              '2,<IC\"notify.'+prop+'.reply\">New replies<br>'+\r\n              '2,<IC\"notify.'+prop+'.new_thread\">New threads<br>'+\r\n              '2,<IC\"notify.'+prop+'.appear\">Appear threads<br>';\r\n            }\r\n          },\r\n          function(html_funcs){\r\n            archiver.event_funcs['queryQuota']();\r\n            return 'JSON Archiver: Store<br>'+\r\n//            '1,Store:<br>'+\r\n            '<br>'+\r\n            '1,1. Make sure DOWNLOAD DIRECTORY to be set correctly.'+html_funcs.rollup(\r\n              '3,All files will be into the directory.<br>'+\r\n              '3,And also, make sure each download doesn\\'t ask you anything.<br>'+\r\n              '3,So many files will be downloaded.<br>'+\r\n              '2,<ICBX\"archive.editing_timeout\"> Timeout for editing posts (patch for meguca)') +'<br>'+\r\n            '1,2. Select sources for each target:<br>'+\r\n            '2,File: Manual/Auto<br>'+\r\n            '3,<ICBX\"archive.oneshot.post\"><ICBX\"archive.live.post\"> Posts<br>'+\r\n            '3,<ICBX\"archive.oneshot.tn\"><ICBX\"archive.live.tn\"> Thumbnails<br>'+\r\n            '3,<ICBX\"archive.oneshot.img\"><ICBX\"archive.live.img\"> Images (original size)<br>'+\r\n            '3,<ICBX\"archive.oneshot.webm\"><ICBX\"archive.live.webm\"> Webms<br>'+\r\n            '2,IndexedDB: Manual/Auto'+html_funcs.rollup(\r\n              '4,<ICBX\"archive.IDB.auto_clean\"> Automatic clean up<br>'+\r\n              '4,<ICBX\"archive.IDB.auto_clean_init\"> Automatic clean up at start up<br>'+\r\n              '4,Delayed pruning: <ITB3\"archive.IDB.prune\"> hours<br>'+\r\n              '5,<ICBX\"archive.IDB.prune_flush\"> Archive to file at pruning<br>'+\r\n              '4,num of transactions: <ITB3\"archive.IDB.nof_tr\"><br>'+\r\n              '4,num of requests in a cluster: <ITB3\"archive.IDB.nof_cl\"> - <ITB3\"archive.IDB.nof_cl_max\"><br>'+\r\n              '4,watchdog timer: <ITB3\"archive.IDB.watchdog\">s')+'<br>'+\r\n            '4,used / limit: <span name=\"SHOW_QUOTA\"></span><button name=\"archive.queryQuota\"><img src=\"' + cnst.icons.refresh + '\" style=\"width:1em;height:1em\"></button><br>'+\r\n            '3,<ICBX\"archive.oneshot.post_idb\"><ICBX\"archive.live.post_idb\"> Posts<br>'+\r\n            '3,<ICBX\"archive.oneshot.tn_idb\"><ICBX\"archive.live.tn_idb\"> Thumbnails<br>'+\r\n            '3,<ICBX\"archive.oneshot.img_idb\"><ICBX\"archive.live.img_idb\"> Images (original size)<br>'+\r\n            '3,<ICBX\"archive.oneshot.webm_idb\"><ICBX\"archive.live.webm_idb\"> Webms<br>'+\r\n//            '2,3. Select files which will be skipped downloading<br>'+\r\n//            '3,Downloaded files: <IF\"archive.dir_dled\" multiple directory><br>'+\r\n            '1,3. <ICBX\"archive.list_inherit\"> Inherit previous archiving list<br>'+\r\n            '1,4a. <IC\"archive.store_watched\">Auto archiving for watched threads<br>'+\r\n            '1,4b. <IC\"archive.store_auto\">Auto archiving if OP matches:<br>'+\r\n            '2,Keyword: <input type=\"text\" name=\"archive.kwd.str\" size=\"25\">'+\r\n            pref_func.settings.html_funcs.make_sel('archive.kwd.match', ['match all','match any','unmatch all','unmatch any'])+ '<br>'+\r\n            '3,<ICBX\"archive.kwd.sub\">Subject '+\r\n            '<ICBX\"archive.kwd.name\">Name '+\r\n            '<ICBX\"archive.kwd.com\">Comment <br>'+\r\n            '3,<ICBX\"archive.kwd.ci\">CI'+\r\n            ' <ICBX\"archive.kwd.sentence\">Sentence'+\r\n            ' <ICBX\"archive.kwd.re\">RE<br>'+\r\n            '1,4c. <ICBX\"archive.list\"> List picker<br>'+\r\n            '2,<textarea rows=\"1\" cols=\"40\" name=\"archive.list_str\" placeholder=\"lain  // whole lainchan\\n/tech/  // whole /tech/\\n/q/1234  // thread /q/1234\"></textarea><br>'+\r\n            '1,4d. <BTN\"archive.oneshot,OneShotArchive\"> or <BTN\"archive.start,StartArchiving\"><br>'+\r\n            '3,<IR\"archive.src,shown\"> All shown threads<br>'+\r\n            '3,<IR\"archive.src,watched\"> All watched threads<br>'+\r\n            '3,<IR\"archive.src,stored\"> All stored threads<br>'+\r\n//            '3,<IR\"archive.src\"\"scanned\"> All scanned threads for automatic archiving<br>'+\r\n            '1,4e. You can select target threads individually using triage<br>';},\r\n          function(html_funcs){\r\n            if (pref.archive.files_sel===2) archiver.event_funcs['queryList']();\r\n            return 'JSON Archiver: Restore<br>'+\r\n//            '1,Restore:<br>'+\r\n            '<br>'+\r\n            '1,1. Open a live catalog, index page or thread to be overriden.<br>'+\r\n            '2,CatChan must be working in it.<br>'+\r\n            '1,2. Select where to extract<br>'+\r\n            '2,<IR\"archive.format,auto\">Select from filename: Domain-Board-No_Sub.json<br>'+\r\n            '2,<IR\"archive.format,manual\">Set manually: '+ html_funcs.make_sel('archive.domain',site0.domains) + '/<ITB5\"archive.board\">/No.<br>'+\r\n            '1,3a. <ICBX\"archive.IDB.auto_restore\"> Automatic restore from IndexedDB<br>'+\r\n            '3,<ICBX\"archive.IDB.auto_restore_remove\"> Remove deleted thread from display<br>'+\r\n            '1,3b. Select source from: '+ html_funcs.make_sel('archive.files_sel',['Dir','Files','IndexedDB'])+ '<br>'+\r\n            '<span name=\"FILES_ARCHIVE0\"' +((pref.archive.files_sel===0)? '' : ' style=\"display:none\"') +'>'+\r\n              '&emsp;&emsp;<span><IF\"archive.dir\" multiple webkitdirectory directory><BTN\"archive.files_clear,X\"></span><br>'+\r\n            '</span>'+\r\n            '<span name=\"FILES_ARCHIVE1\"' +((pref.archive.files_sel===1)? '' : ' style=\"display:none\"') +'>'+\r\n              '&emsp;&emsp;JSONs/HTMLs: <IF\"archive.jsons\" multiple accept=\".html,.json,text/*\"><br>'+\r\n              '2,<ICBX\"archive.load_img\"> Images: <IF\"archive.imgs\" multiple webkitdirectory directory><br>'+\r\n            '</span>'+\r\n            '<span name=\"FILES_ARCHIVE2\"' +((pref.archive.files_sel===2)? '' : ' style=\"display:none\"') +'>'+\r\n              '&emsp;&emsp;<span><select name=\"archive.IDB_board_sel\"' + ((pref.archive.IDB_select_multiple)? ' multiple':'') + ' style=\"float:none\"></select>'+\r\n              '<select name=\"archive.IDB_thread_sel\" style=\"float:none' + ((pref4.archive.IDB_thread_sel_options)? '\"' : ';display:none\"')\r\n                                                      + ((pref.archive.IDB_select_multiple)? ' multiple':'') +'></select></span>'+\r\n                html_funcs.rollup('&emsp;&emsp;<ICBX\"archive.IDB_select_multiple\"> Multiple select<br>'+\r\n                                  '&emsp;&emsp;Export selected &emsp;&emsp;&emsp;&emsp;<BTN\"archive.IDB.export_thread,Threads\"><br>'+\r\n                                  '&emsp;&emsp;Reset archived time of selected <BTN\"archive.IDB.reset_time,Threads\">')+\r\n                html_funcs.rollup('&emsp;&emsp;Delete selected <BTN\"archive.IDB.delete_board,Boards\"><BTN\"archive.IDB.delete_thread,Threads\"><BTN\"archive.IDB.delete_imgs,Images\">')+'<br>'+\r\n            '</span>'+\r\n            '&emsp;&emsp;<BTN\"archive.restore_button,Restore\"> <ICBX\"archive.restore_auto\"> Auto restore after selection<br>'+\r\n            '3,<ICBX\"archive.clear_threads\"> Clear all threads at opening an archive<br>'+\r\n            '3,<ICBX\"archive.fix_inconsistency\"> Fix inconsistencies at open<br>';\r\n            '3,<ICBX\"archive.open_local\"> Open remote archive in local environment<br>';\r\n//            '1,5. <BTN\"archive.clear_files_button,Clear Files\"> <ICBX\"archive.clear_files\"> Auto clear after open<br>';\r\n          },\r\n          'UIP tracker for 4chan:<br>'+\r\n          '1,<ICBX\"uip_tracker.on\"> Show num of unique IPs after post No.<br>'+\r\n          '3, Check interval: <ITB3\"uip_tracker.interval\">sec, <ICBX\"uip_tracker.adaptive\"> Adaptive<br>'+\r\n          '3, Style of changes: <ITBL30\"uip_tracker.highlight_str\"><br>'+\r\n          '2,<ICBX\"uip_tracker.posts\"> Show num of posts<br>'+\r\n          '2,<ICBX\"uip_tracker.deletion.show\"> Show deleted posts\\' No.<br>'+\r\n          '3,<ICBX\"uip_tracker.deletion.link\"> as links<br>'+\r\n          '2, Apply style to deleted post:<br>'+\r\n          '3,<ICBX\"uip_tracker.deletion.name\"> Add style to name: <ITBL30\"uip_tracker.deletion.name_str\"><br>'+\r\n          '3,<ICBX\"uip_tracker.deletion.addName\"> Add <ITBL30\"uip_tracker.deletion.addName_str\"> to name<br>'+\r\n          '3,<ICBX\"uip_tracker.deletion.post\"> Add style to post: <ITBL30\"uip_tracker.deletion.post_str\"><br>'+\r\n          '2,<ICBX\"uip_tracker.annotate\"> Annotate history of UIP from catalog<br>'+\r\n          '2,<ICBX\"uip_tracker.auto_open\"> Open next thread automatically<br>'+\r\n          '3,Conditions:<br>'+\r\n          '4,After <input type=\"text\" name=\"uip_tracker.auto_open_th\" size=\"3\" style=\"text-align: right;\">th post<br>'+\r\n          '4,OP contains <textarea style=\"height:1em\" cols=\"20\" name=\"uip_tracker.auto_open_kwd\"></textarea><br>'+\r\n          '2,<ICBX\"uip_tracker.sage.detect\"> Sage detection, tolerance: <ITB2\"uip_tracker.sage.tolerance\"> sec<br>'+\r\n          '3,<ICBX\"uip_tracker.sage.name\"> Add style to name: <ITBL30\"uip_tracker.sage.name_str\"><br>'+\r\n          '3,<ICBX\"uip_tracker.sage.addName\"> Add <ITBL30\"uip_tracker.sage.addName_str\"> to name<br>'+\r\n          '3,<ICBX\"uip_tracker.sage.post\"> Add style to post: <ITBL30\"uip_tracker.sage.post_str\"><br>'+\r\n          '3,Bug patch for corrupted data<br>'+\r\n          '4,<ICBX\"uip_tracker.sage.patch_bug3\"> Ignore corrupted data at head by history<br>'+\r\n          '4,<IC\"uip_tracker.sage.patch_bug4\">Recover by page history<br>'+\r\n          '4,<IC\"uip_tracker.sage.patch_bug5\">Cease detection at encountering obsolete data<br>'+\r\n          '4,<ICBX\"uip_tracker.sage.patch_bug2\"> Loose detection, to <ITB2\"uip_tracker.sage.patch_bug2nth\">th thread<br>'+\r\n          '4,<ICBX\"uip_tracker.sage.patch_bug\"> Re-evaluate and recover<br>'+\r\n          '3,<IC\"uip_tracker.sage.page\">Annotate page history<br>'+\r\n          '3,<IC\"uip_tracker.sage.annotate\">Annotate sage from catalog<br>'+\r\n          '4,<IC\"uip_tracker.sage.annotate_page\">Annotate page history from catalog<br>',\r\n          'Command interface for overwriting preference<br>'+\r\n          '&emsp;<textarea style=\"height:1em\" cols=\"40\" name=\"overwrite_site2_json_str\"></textarea><br>'+\r\n          '&emsp;<button name=\"JSON_ex\">extract</button>'+\r\n          '<button name=\"JSON_ex_full\">extract_full</button>'+\r\n          '<button name=\"JSON_ex_filter\">extract_current_filter</button>'+\r\n          '&emsp;<button name=\"JSON_query\">query</button>'+\r\n          '&emsp;<button name=\"JSON_query_boards\">query_boards</button>'+\r\n          '&emsp;&emsp;<button name=\"JSON\">JSON</button>'+\r\n          '<span name=\"JSON_result\"></span><br>'+\r\n          '&emsp;<textarea style=\"height:1em\" cols=\"40\" name=\"overwrite_site2_eval_str\"></textarea><br>'+\r\n          '&emsp;<button name=\"EVAL\">EVAL</button><br>',\r\n//          '5',\r\n          function(html_funcs){\r\n            return 'Networking:<br>'+\r\n          '1,Timeout: <ITB3\"network.timeout\"> sec.<br>'+\r\n          '&emsp;Cross domain connection:<br>'+\r\n          html_funcs.radios('network.cross_domain',2, ['direct: Direct connection',\r\n          'indirect: Indirect connection<br>'+\r\n            '3,<ICBX\"network.overXFO\"> Over X-Frame-Options<br>'+\r\n            '3,<ICBX\"network.overCSPF\"> Over Content Security Policy frame',\r\n          'GM: GreaseMonkey\\'s extension'])+ '<br>'+\r\n//          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_fake_access\"> Fake access made by human to avoid poor administration<br>'+\r\n//          '&emsp;&emsp;&emsp;(This causes heavier network traffic and server load,<br>'+\r\n//          '&emsp;&emsp;&emsp;but administrators can\\'t see what script you are using)<br>'+\r\n//          '&emsp;Configuration:<br>'+\r\n//          '&emsp;&emsp;(To get faster feeling, you should check them all.)<br>'+\r\n          '&emsp;Data source:<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog.design\" value=\"page\">Page<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog.design\" value=\"auto\">Auto<br>'+\r\n          '&emsp;&emsp;<input type=\"radio\" name=\"catalog.design\" value=\"catalog\">Catalog<br>'+\r\n          '&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.catalog_json\"> From json file<br>'+\r\n          '1,Lazy load/draw<br>'+\r\n          '2,Catalog/IndexPage/Float <br>'+\r\n          '3,<IC\"catalog.lazyDraw.merge\" style=\"visibility:hidden\"><IC\"page.lazyDraw.merge\">'+\r\n            '<IC\"float.lazyDraw.merge\" style=\"visibility:hidden\">Lazy draw posts, step:<ITB3\"proto.lazyDraw.merge_step\">(at merge)<br>'+\r\n          '3,<IC\"catalog.draw_on_demand\"><IC\"page.draw_on_demand\"><IC\"float.draw_on_demand\">Lazy draw threads, step:<ITB3\"proto.lazyDraw.step\"><br>'+\r\n          '3,<IC\"catalog.load_on_demand\"><IC\"page.load_on_demand\"><IC\"float.load_on_demand\">Lazy load HTMLs/JSONs<br>'+\r\n          '2,<input type=\"checkbox\" name=\"network.adaptive\"> Adaptive<br>'+\r\n          '3,100%: new <input type=\"text\" name=\"network.th100\" size=\"3\" style=\"text-align: right;\"> threads, '+\r\n          '<input type=\"text\" name=\"network.th100_delay\" size=\"4\" style=\"text-align: right;\"> ms delay<br>'+\r\n          '3,20%: new <input type=\"text\" name=\"network.th20\" size=\"3\" style=\"text-align: right;\"> threads, '+\r\n          '<input type=\"text\" name=\"network.th20_delay\" size=\"4\" style=\"text-align: right;\"> ms delay<br>'+\r\n          '1,<ICBX\"catalog_auto_update_countdown\"> Show countdown to auto update<br>'+\r\n          '1,<ICBX\"healthIndicator.show\"> Health indicator, history: <ITB3\"healthIndicator.max\"><br>'+\r\n          '2,<ICBX\"healthIndicator.expand_running\"> Show details of running indicators<br>'+\r\n          '2,<ICBX\"healthIndicator.dont_retire_running\"> Don\\'t retire running indicators<br>'+\r\n          '2,<ICBX\"healthIndicator.cancel\"> Cancel scan when it is clicked<br>'+\r\n          '1,<ICBX\"network.fetch_actively\"> Fetch missing info actively<br>';},\r\n          'General 2:<br>'+\r\n          '&emsp;Localtime offset<input type=\"text\" name=\"localtime_offset\" size=\"2\" style=\"text-align: right;\"><br>'+\r\n          'Share loaded html with other tabs to update<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"info_server\"> Broadcast loaded html to other tabs (server)<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"info_client\"> Listen other tab\\'s broadcasting (client)<br>'+\r\n          'Cloudflare<br>'+\r\n          '&emsp;<input type=\"checkbox\" name=\"cloudflare.auto_reload\"> Auto reload at server error<br>'+\r\n          '&emsp;&emsp;<input type=\"text\" name=\"cloudflare.auto_reload_time\" size=\"2\" style=\"text-align: right;\"> minutes after<br>'+\r\n          '<br>'+\r\n          '<input type=\"checkbox\" name=\"tooltips.info.show\"> Show infotips<br>'+\r\n          '&emsp;pop up delay: <input type=\"text\" name=\"tooltips.info.popup_delay\" size=\"4\" style=\"text-align: right;\"> ms<br>'+\r\n          '&emsp;pop down delay: <input type=\"text\" name=\"tooltips.info.popdown_delay\" size=\"4\" style=\"text-align: right;\"> ms<br>'+\r\n          '<input type=\"checkbox\" name=\"tooltips.help.show\"> Show tooltips<br>'+\r\n          '&emsp;pop up delay: <input type=\"text\" name=\"tooltips.help.popup_delay\" size=\"4\" style=\"text-align: right;\"> ms<br>'+\r\n          '&emsp;pop down delay: <input type=\"text\" name=\"tooltips.help.popdown_delay\" size=\"4\" style=\"text-align: right;\"> ms<br>'+\r\n          'Z-Index of tooptips: <ITB4\"tooltips.zIndex\"><br>'+\r\n          'Misc.<br>'+\r\n          '<input type=\"checkbox\" name=\"recovery.comment\"> Recover comment when browser was crashed<br>'+\r\n          '<input type=\"checkbox\" name=\"catalog_footer_ignore_my_own_posts\"> Ignore my own posts at counting unread posts<br>'+\r\n          '<input type=\"checkbox\" name=\"pref2.KC.summer_time\"> Summer time in KC<br>'+\r\n          '<br>'+\r\n          'Patches<br>'+\r\n          '<input type=\"checkbox\" name=\"patch.delayed_invoke.use\"> Delayed invoke for 4chan, '+\r\n          '<input type=\"text\" name=\"patch.delayed_invoke.sec\" size=\"2\" style=\"text-align: right;\">sec.<br>'+\r\n//          '<input type=\"checkbox\" name=\"pref2.meguca.remove_history_class\"> Remove history class in meguca'+\r\n          '',\r\n      function(html_funcs){\r\n        return 'Styles:<br>'+\r\n          '1,Windows and popups:<br>'+\r\n          '2,Z-Index: <ITB4\"style.zIndex\"><br>'+\r\n          '2,<IR\"style.sel,fix\"> Fixed <BTN\"style.reset.fix,reset\"><br>'+\r\n          '3,Title bar:<ITBL30\"style.fix.titleBar_str\"><br>'+\r\n          '3,Window:<ITBL30\"style.fix.window_str\"><br>'+\r\n          '3,Pop up:<ITBL30\"style.fix.popUp_str\"><br>'+\r\n          '2,<IR\"style.sel,copy\"> Copy from CSS <BTN\"style.reset.copy,reset\"><br>'+\r\n          '3,Title bar:<ITBL30\"style.copy.titleBar_str\"><br>'+\r\n          '3,Window:<ITBL30\"style.copy.window_str\"><br>'+\r\n          '3,Pop up:<ITBL30\"style.copy.popUp_str\"><br>'+\r\n          '1,Others:<br>'+\r\n          '2,New post:<ITBL30\"style.post_new\"><br>'+\r\n          '2,Editing post:<ITBL30\"style.post_editing\"><br>'+\r\n          html_funcs.userCSS(1);},\r\n      function(html_funcs){\r\n        return 'Features:<br>'+\r\n          '1,<ICBX\"features.page\"> Page<br>'+\r\n          '1,<ICBX\"features.graph\"> Graph<br>'+\r\n//          '1,<ICBX\"features.setting\"> Setting<br>'+\r\n          '1,<ICBX\"features.setting2\"> Setting2<br>'+\r\n          '1,<ICBX\"features.postform\"> Postform<br>'+\r\n          '1,<ICBX\"features.catalog\"> Catalog<br>'+\r\n          '1,<ICBX\"features.listener\"> Listener<br>'+\r\n          '1,<ICBX\"features.uip_tracker\"> UIP_tracker<br>'+\r\n          '1,<ICBX\"features.thread_reader\"> Thread Reader<br>'+\r\n          '1,<ICBX\"features.recovery\"> Recovery comment<br>'+\r\n//          '<input type=\"checkbox\" name=\"features.debug\"> Debug<br>'+\r\n          'Notifications:<br>'+\r\n          '1,<ICBX\"features.notify.desktop\"> DesktopNotification<br>'+\r\n          '1,<ICBX\"features.notify.sound\"> Sound<br>'+\r\n          '1,<ICBX\"features.notify.favicon\"> Favicon<br>'+\r\n          'Sites:<br>'+\r\n          html_funcs.features_domains();},\r\n      function(html_funcs){\r\n        return 'CatChan<br>'+\r\n          'Version 2019.06.30.0<br>'+\r\n          '<a href=\"https://github.com/DogMan8/CatChan\">GitHub</a><br>'+\r\n          '<a href=\"https://github.com/DogMan8/CatChan/raw/master/CatChan.user.js\">Get stable release</a><br>'+\r\n          '<a href=\"https://github.com/DogMan8/CatChan/raw/develop/CatChan.user.js\">Get BETA release</a><br>'+\r\n          '<br><br>'+\r\n          'Debug mode<br>'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.0\">'+\r\n          '<input type=\"text\" name=\"debug_mode.unread_count\" size=\"30\" style=\"text-align: right;\">'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.2\">'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.3\">'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.4\">&emsp;'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.5\">'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.parse_error\">'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.7\"><br>'+\r\n          '<input type=\"text\" name=\"debug_mode.site2func\" size=\"15\" style=\"text-align: right;\" placeholder=\"catalog_json2html3\">'+\r\n          '<button name=\"debug_site2\">dump_site2</button>'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.site2func_expand\">func<br>'+\r\n          '<input type=\"text\" name=\"debug_mode.pfunc\" size=\"15\" style=\"text-align: right;\" placeholder=\"4chan:catalog_json\">'+\r\n          '<button name=\"debug_pfunc\">dump_parse_funcs</button>'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.pfunc_expand\">func<br>'+\r\n          '<input type=\"text\" name=\"debug_mode.pfunc_comp\" size=\"15\" style=\"text-align: right;\" placeholder=\"4chan:catalog_json\">'+\r\n          '<button name=\"debug_pfunc_comp\">compare_parse_funcs</button>'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.pfunc_comp_expand_same\"><input type=\"checkbox\" name=\"debug_mode.pfunc_comp_expand_diff\">func <br>'+\r\n          '1,<input type=\"text\" name=\"debug_mode.pfunc_comp_proto\" size=\"40\" style=\"text-align: right;\" placeholder=\"temporal prototype, DEFAULT:catalog_json\"><br>'+\r\n          '<input type=\"text\" name=\"debug_mode.pfunc_all\" size=\"15\" style=\"text-align: right;\"  placeholder=\"op_img_url\">'+\r\n          '<button name=\"debug_pfunc_all\">find_parse_funcs</button>'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.pfunc_all_expand\">func<br>'+\r\n          '<input type=\"checkbox\" name=\"debug_mode.9\"><br>'+\r\n          html_funcs.cb_block('debug_mode',10)+\r\n          'Test mode'+html_funcs.rollup(html_funcs.cb_block('test_mode',0)+'<br>'+\r\n          '<IC\"test_mode.tips\">'+\r\n          '<ITB6\"test_mode.num\">'+\r\n          '<ITBL30\"test_mode.test_str\">'+\r\n          '<ITB6\"test_mode.num_f\">'+\r\n          '&emsp;<button name=\"button_test\">test</button><br>'+\r\n          '&emsp;<button name=\"load_samples\">setting_samples</button><br>'+\r\n          '<IF\"test_mode.js_file\" accept=\".js,text/*\"><BTN\"test_mode.js_load,JS_load\">')+'<br>';}\r\n        ],\r\n        html_common:\r\n          '<span name=\"reload_recommended\" style=\"display:none;background:yellow\">&emsp;&emsp;RELOAD IS REQUIRED TO GET LIGHT FEELING&emsp;&emsp;<br></span>'+\r\n          '<span name=\"reload_required\" style=\"display:none;background:red;color:white\">&emsp;&emsp;RELOAD IS REQUIRED&emsp;&emsp;</span>'+\r\n          '<br><button name=\"close\">close</button>'+\r\n          '&emsp;<button name=\"save\">save</button>'+\r\n          '<button name=\"load_default\">load_default</button>'+\r\n          '<button name=\"load_default_of_this_page\">load_default_of_this_page</button>',\r\n//        onchange_event : function(){\r\n//          pref_func.apply_prep(this,true);\r\n//          if (pref_func.settings.onchange_funcs[this.name]) pref_func.settings.onchange_funcs[this.name]();\r\n//        },\r\n        tag_gen: null,\r\n//        health_indicator: null,\r\n        get onchange_funcs_formatted(){\r\n          Object.defineProperty(this,'onchange_funcs_formatted',{value:pref_func.add_onchange_format(this.onchange_funcs), writable:true, enumerable:true, configurable:true});\r\n          pref_func.add_onchange_format(this.onchange_funcs.archive);\r\n          return this.onchange_funcs_formatted;\r\n        },\r\n        oninput_funcs: null,\r\n        onchange_funcs : {\r\n          __proto__: {\r\n            __proto__: {\r\n              SHOWALL: function(e){ // bound later.\r\n                this.TOGGLE(e.target,'HIDEALL','',null,'no');\r\n                Array.prototype.slice.call(e.target.parentNode.parentNode.querySelectorAll('[name=SHOW],[name=SHOW2],[name=SHOW3]')).forEach(function(v){v.onclick({target:v, currentTarget:v});});\r\n  //              Array.prototype.slice.call(e.target.parentNode.parentNode.parentNode.querySelectorAll('[name=SHOW],[name=SHOW2]')).forEach(function(v){v.onclick({target:v});});\r\n              },\r\n              HIDEALL: function(e){ // bound later.\r\n                this.TOGGLE(e.target,'SHOWALL','',null,'no');\r\n                Array.prototype.slice.call(e.target.parentNode.parentNode.querySelectorAll('[name=HIDE],[name=HIDE2],[name=HIDE3]')).forEach(function(v){v.onclick({target:v, currentTarget:v});});\r\n  //              Array.prototype.slice.call(e.target.parentNode.parentNode.parentNode.querySelectorAll('[name=HIDE],[name=HIDE2]')).forEach(function(v){v.onclick({target:v});});\r\n              },\r\n              SHOW: function(e){this.TOGGLE(e.target,'HIDE','');}, // bound later.\r\n              HIDE: function(e){this.TOGGLE(e.target,'SHOW','none');}, // bound later.\r\n              TOGGLE: function(et,name,disp, dst_dom, tgt_dom){\r\n                if (!dst_dom) dst_dom = et;\r\n                var str = et.getAttribute('data-str');\r\n                et.setAttribute('data-str',dst_dom.textContent);\r\n                dst_dom.textContent = str;\r\n                et.setAttribute('name',name);\r\n                if (tgt_dom==='no') return;\r\n                if (!tgt_dom) tgt_dom = et.nextSibling;\r\n                tgt_dom.style.display = disp;\r\n              },\r\n  //            NEXT: function(e){e.currentTarget.nextSibling.onclick({target:e.currentTarget.nextSibling});},\r\n              SHOW2: function(e){this.TOGGLE2(e.target,'HIDE2','');}, // bound later.\r\n              HIDE2: function(e){this.TOGGLE2(e.target,'SHOW2','none');}, // bound later.\r\n              TOGGLE2: function(et,name,disp){ // bound later.\r\n                if (et.tagName!=='A') et = et.parentNode;\r\n                this.TOGGLE(et,name,disp,et.childNodes[2], et.nextSibling.nextSibling);\r\n              },\r\n  //            SHOW3: function(e){ // bound later.\r\n  //              if (e.target.previousSibling) {\r\n  //                var div = document.createElement('div');\r\n  //                div.setAttribute('style','clear:both');\r\n  //                e.target.parentNode.insertBefore(div,e.target);\r\n  //              }\r\n  //              e.target.nextSibling.style.display = '';\r\n  //              e.target.style.display = 'none';\r\n  //            },\r\n  //            HIDE3: function(e){ // bound later.\r\n  //              e.target.parentNode.previousSibling.style.display = '';\r\n  //              e.target.parentNode.style.display = 'none';\r\n  //              var etPpp = e.target.parentNode.previousSibling.previousSibling;\r\n  //              if (etPpp) e.target.parentNode.parentNode.removeChild(etPpp);\r\n  //            },\r\n              SHOW3: function(e){ // bound later.\r\n                var label = e.target.getAttribute('data-show3');\r\n                var tgt = e.target.previousSibling;\r\n                while (tgt.getAttribute('data-show3')!==label) tgt = tgt.previousSibling;\r\n                tgt.style.display = '';\r\n                e.target.style.display = 'none';\r\n              },\r\n              HIDE3: function(e){ // bound later.\r\n                var label = e.target.parentNode.getAttribute('data-show3');\r\n                var tgt = e.target.parentNode.nextSibling;\r\n                while (tgt.getAttribute('data-show3')!==label) tgt = tgt.nextSibling;\r\n                tgt.style.display = '';\r\n                e.target.parentNode.style.display = 'none';\r\n              },\r\n              SHOW2_I: function(e){var etp = e.target.previousSibling; etp.onclick({target:etp, currentTarget:etp});},\r\n  //            SHOW: function(e){\r\n  //              e.target.style.display = 'none';\r\n  //              e.target.nextSibling.style.display = '';\r\n  //              e.target.nextSibling.nextSibling.style.display = '';\r\n  //            },\r\n  //            HIDE: function(e){\r\n  //              e.target.style.display = 'none';\r\n  //              e.target.nextSibling.style.display = 'none';\r\n  //              e.target.previousSibling.style.display = '';\r\n  //            },\r\n              SHOW4: function(e){\r\n                e.target.style.display = 'none';\r\n                e.target.previousSibling.style.display = null;\r\n              },\r\n              HIDE4: function(e){\r\n                e.target.parentNode.style.display = 'none';\r\n                e.target.parentNode.nextSibling.style.display = null;\r\n              },\r\n              SUB: function(e){\r\n  //              var pns = e.currentTarget.parentNode.querySelectorAll('span[name=\"' +e.target.getAttribute('name')+ '\"]');\r\n                var pn = e.currentTarget.previousSibling.previousSibling;\r\n                if (pn && pn.querySelectorAll) {\r\n                  var pns = pn.querySelectorAll('span[data-class=show_value]');\r\n                  if (pns.length>0) pref_func.apply_prep_2(pns, false);\r\n                }\r\n              },\r\n              'virtualBoard.search.str': function(){liveTag.filter_onchange(pref.virtualBoard.search);},\r\n            }\r\n          },\r\n          'uip_tracker.on' : uip_tracker_init,\r\n          'healthIndicator.show' : function(){cataLog.healthIndicator.show();},\r\n          'healthIndicator.expand_running' : function(){cataLog.healthIndicator.shrink_running();},\r\n          'settings.indexing' : function(e){\r\n            var this_obj = pref_func.settings;\r\n            var pn13_1 = pref_func.settings.pn13.childNodes[1];\r\n//            if (pn13_1.innerHTML) pref_func.tooltips.remove_hier(pn13_1);\r\n            pref_func.settings.files_store();\r\n//            var files_archive;\r\n//            if (pref.settings.indexing===17) files_archive = site.script_body.querySelectorAll('span[name=\"FILES_ARCHIVE0\"]')[0]; // out of w3c, but works in chrome and FF.\r\n            var tgt = this_obj.htmls[pref.settings.indexing];\r\n            var html = ((typeof(tgt)==='function')?  tgt(this_obj.html_funcs) : tgt) +this_obj.html_common;\r\n            pn13_1.innerHTML = pref_func.format_html_str(html);\r\n//            if (files_archive) {\r\n//              var ref = pn13_1.querySelectorAll('span[name=\"FILES_ARCHIVE0\"]')[0]; // out of w3c, but works in chrome and FF.\r\n//              ref.parentNode.insertBefore(files_archive,ref);\r\n//              ref.parentNode.removeChild(ref);\r\n//            }\r\n            pref_func.add_onchange(pn13_1,pref_func.settings.onchange_funcs_formatted);\r\n            pref_func.settings.apply_pn13_1();\r\n//            pref_func.tooltips.add_hier(pn13_1);\r\n          },\r\n          'pn13_1_warning_reload': function(){\r\n            pref3.reload_required = true;\r\n            pref_func.settings.onchange_funcs['pn13_1_warning']();\r\n          },\r\n          'pn13_1_warning': function(){\r\n            var pn13_1 = pref_func.settings.pn13.childNodes[1];\r\n            var pn = pn13_1.getElementsByTagName('span')['reload_required'];\r\n            pn.style.display = (pref3.reload_required || pref3.stats.use!==pref.stats.use || pref.stats.estimate_posts && !pref3.stats.estimate_posts)? '' : 'none';\r\n            var pn = pn13_1.getElementsByTagName('span')['reload_recommended'];\r\n            pn.style.display = (!pref.stats.estimate_posts && pref3.stats.estimate_posts)? '' : 'none';\r\n          },\r\n          'tag.scan' : function(){\r\n            pref.catalog.board.board_tags = true;\r\n            pref_func.settings.onchange_funcs['tag.generate_caller']('tag.scan');\r\n            liveTag.popup_filter.popup();\r\n          },\r\n          'tag.same_tag_refresh' : function(){\r\n            pref.catalog.board.board_tags_same = true;\r\n            pref_func.settings.onchange_funcs['tag.generate_caller']('tag.same_tag_refresh');\r\n          },\r\n          'tag.generate_caller' : function(src){\r\n            site2[site.nickname].get_boards_json('manual_refresh_boards_json', null, null, true); // ,pref_func.settings.onchange_funcs['tag.generate_callback']);\r\n            if (pref.test_mode['112']) {\r\n              http_req.get('tag','8chan','https://'+site2['8chan'].domain_url+'/boards.json',pref_func.settings.onchange_funcs['tag.generate_callback'],false,false,src);\r\n              if (pref_func.settings.pn13) pref_func.settings.apply_pn13_1();\r\n            }\r\n          },\r\n          'tag.generate_callback' : function(key,value,arg){\r\n            site3['8chan'].boards = ('response' in value)? value.response : JSON.parse(value.responseText);\r\n            pref_func.settings.onchange_funcs['tag.re_generate'](arg);\r\n          },\r\n          'tag.re_generate' : function(arg){\r\n            var str = catalog_obj.scan_tags_common(site3['8chan'].boards,'name=\"tag.gen\"');\r\n            if (!pref_func.settings['tag_gen']) {\r\n              if (arg!=='tag.same_tag_refresh') {\r\n                var html = '<div><button name=\"tag.scan\">Refresh</button><br>'+\r\n                  '<textarea style=\"height:1em\" cols=\"20\" name=\"tag.gen_str\"></textarea>'+\r\n                  '<button name=\"tag.gen_add\">Add to list</button></div><div>' + str +'</div>';\r\n                cnst.make_popup(pref_func.settings,'tag_gen',html,pref_func.settings.onchange_funcs);\r\n                var pn = pref_func.settings['tag_gen'].childNodes[1];\r\n//                pn.getElementsByTagName('textarea')[0].value='board_group_name';\r\n                pn.style.height = '200px';\r\n                pn.style.width  = '200px';\r\n                pn.style.overflow = 'auto';\r\n                pn.style.resize = 'both';\r\n                cnst.bottom_top(pn);\r\n              }\r\n            } else pref_func.settings['tag_gen'].childNodes[1].childNodes[1].innerHTML = str;\r\n            if (pref_func.settings['tag_gen']) pref_func.add_onchange(pref_func.settings['tag_gen'].childNodes[1].childNodes[1],pref_func.settings.onchange_funcs_formatted);\r\n\r\n            var str = ''\r\n            var obj = site3['8chan'].boards;\r\n            var myself = 0;\r\n            while (myself<obj.length-1 && site.board!=='/'+obj[myself].uri+'/') myself++;\r\n            for (var i=0;i<obj[myself].tags.length;i++) {\r\n              var key = obj[myself].tags[i];\r\n              str = str + '#' + key;\r\n              for (var j=0;j<obj.length;j++)\r\n                for (var m=0;m<obj[j].tags.length;m++)\r\n                  if (obj[j].tags[m]===key) str = str + ',8chan/' + obj[j].uri + '/';\r\n              str = str + '\\n';\r\n            }\r\n            pref_func.catalog_board_list_str_bt_same = str;\r\n\r\n            pref_func.catalog_board_list_str_bt = '';\r\n            pref_func.settings.onchange_funcs['board_sel_refresh']();\r\n          },\r\n//          'catalog.tag.ignore' : function(){pref_func.settings.onchange_funcs['tag.re_generate']();},\r\n//          'catalog.tag.max' : function(){pref_func.settings.onchange_funcs['tag.re_generate']();},\r\n//          'tag.gen_str' : function(){pref_func.settings.onchange_funcs['tag.gen']();},\r\n          'tag.gen' : function(){\r\n            var cbxes = pref_func.settings['tag_gen'].childNodes[1].getElementsByTagName('input');\r\n            var str = '';\r\n            var str_name = pref_func.settings['tag_gen'].childNodes[1].getElementsByTagName('textarea')[0].value;\r\n            var obj = site3['8chan'].boards;\r\n            for (var i=0;i<cbxes.length;i++)\r\n              if (cbxes[i].checked) {\r\n                var key = cbxes[i].nextSibling.textContent.replace(/ [0-9]*: /,'');\r\n                if (str_name==='') str_name = '#' + key;\r\n                for (var j=0;j<obj.length;j++)\r\n                  for (var m=0;m<obj[j].tags.length;m++)\r\n                    if (obj[j].tags[m]==key) str = str + '8chan/' + obj[j].uri + '/,';\r\n              }\r\n            pref_func.catalog_board_list_str_bt = str_name + ',' + str;\r\n            pref_func.settings.onchange_funcs['board_sel_refresh']();\r\n//            pref_func.str2obj('catalog_board_list_str');\r\n//            if (pref_func.board_sel) pref_func.apply_prep(pref_func.board_sel,false);\r\n          },\r\n          'tag.gen_add' : function(){\r\n            pref_func.settings.onchange_funcs['tag.gen']();\r\n            pref_func.settings.onchange_funcs['tag.add_to_list'](pref_func.catalog_board_list_str_bt);\r\n          },\r\n          'tag.recommendation_add' : function(){\r\n            pref_func.settings.onchange_funcs['tag.add_to_list'](pref_func.catalog_board_list_str_or);\r\n          },\r\n          'tag.add_to_list' : function(str){\r\n            if (str!=='') {\r\n              if (pref.catalog_board_list_str.search(/\\n$/)==-1) pref.catalog_board_list_str = pref.catalog_board_list_str + '\\n';\r\n              pref.catalog_board_list_str = pref.catalog_board_list_str + str + '\\n';\r\n              if (pref_func.settings.pn13) pref_func.settings.apply_pn13_1();\r\n//              pref_func.str2obj('catalog_board_list_str');\r\n//              if (pref_func.board_sel) pref_func.apply_prep(pref_func.board_sel,false);\r\n              pref_func.settings.onchange_funcs['board_sel_refresh']();\r\n            }\r\n          },\r\n          'board_sel_refresh' : function(){\r\n            pref_func.str2obj('catalog_board_list_str');\r\n            cnst.auto_shrink_board_selector.str_changed();\r\n          },\r\n          'stats.use' : 'pn13_1_warning',\r\n          'stats.estimate_posts' : 'pn13_1_warning',\r\n          'stats.auto_acquisition' : function(){cnst.auto_shrink_board_selector.color();},\r\n          'stats.auto_acquisition_all' : 'stats.auto_acquisition',\r\n          'catalog.board.recommendation': 'board_sel_refresh',\r\n          'catalog.board.board_tags': 'board_sel_refresh',\r\n          'catalog_board_list_str': 'board_sel_refresh',\r\n          'catalog.board.all_boards': 'board_sel_refresh',\r\n          'JSON' : function() {\r\n//          pref_func.apply_prep(pref_func.settings.pn13.getElementsByTagName('TEXTAREA')['overwrite_site2_json_str'],true);\r\n            pref_func.site2_json();\r\n          },\r\n          'JSON_query_boards' : function() {\r\n            pref.overwrite_site2_json_str = '{\"site2\":{\"'+site.nickname+'\":{\"boards_json\":\"\"}}}';\r\n            pref_func.site2_json(true);\r\n          },\r\n          'JSON_query' : function() {\r\n            pref_func.site2_json(true);\r\n          },\r\n          'JSON_ex' : function() {\r\n            pref_func.site2_json_ex(false);\r\n            pref_func.settings.apply_pn13_1();\r\n          },\r\n          'JSON_ex_full' : function() {\r\n            pref_func.site2_json_ex(true);\r\n            pref_func.settings.apply_pn13_1();\r\n          },\r\n          'JSON_ex_filter' : function() {\r\n            pref_func.site2_json_ex(false, true);\r\n            pref_func.settings.apply_pn13_1();\r\n          },\r\n          'EVAL' : function() {\r\n//            pref_func.apply_prep(pref_func.settings.pn13.getElementsByTagName('TEXTAREA')['overwrite_site2_eval_str'],true);\r\n            pref_func.site2_eval();\r\n          },\r\n          'close': function(){pref_func.settings.show_hide();},\r\n//          'save' : function(){if (localStorage) localStorage[pref.script_prefix+'.pref']=JSON.stringify(pref);},\r\n          'save' : function(){\r\n            if (localStorage) localStorage[pref.script_prefix+'.pref']=JSON.stringify(pref_func.site2_json_ex_remove());\r\n          },\r\n          'load_default' : function(e){\r\n            var pref_def = pref_default();\r\n            delete pref_def.settings.indexing;\r\n            delete pref_def.catalog_board_list_sel;\r\n            delete pref_def.catalog.filter;\r\n            if (e.target.name==='load_default_of_this_page') {\r\n              var nodes = e.target.parentNode.getElementsByTagName('*');\r\n              for (var i=0;i<nodes.length;i++)\r\n                if (nodes[i].name) {\r\n                  var src = pref_func.get_tgt(nodes[i].name, pref_def, true);\r\n                  if (src) {\r\n                    var dst = pref_func.get_tgt(nodes[i].name);\r\n                    dst[0][dst[1]] = src[0][src[1]];\r\n                  }\r\n                }\r\n            } else {\r\n              if (e.target.name.indexOf('easy2')===0) delete pref_def.easy2;\r\n              pref_func.pref_overwrite(pref,pref_def);\r\n              pref3.reload_required = true;\r\n            }\r\n//            var idx = pref.settings.indexing;\r\n//            pref = pref_default();\r\n            pref_func.obj_init();\r\n//            pref.settings.indexing = idx;\r\n//            pref_func.settings.onchange_funcs['settings.indexing']();\r\n            pref_func.settings.apply_pn13_1();\r\n            pref_func.settings.apply_pn13_1(true, e.target.name==='load_default_of_this_page' && cataLog.threads);  // writing to sessionStrage.\r\n          },\r\n          'load_default_of_this_page' : 'load_default',\r\n          'load_samples' : function(){pref_func.pref_samples.init();},\r\n          'catalog_triage_str' : function(){\r\n            if (catalog_obj && catalog_obj.catalog_func()!==null) catalog_obj.catalog_func().remake_triage();\r\n          },\r\n          'triage.hide_toggle': 'catalog_triage_str',\r\n          'catalog.footer.*w/': function(e,src){if (cataLog.Footer) cataLog.Footer.update_all_force(e,src);},\r\n          'float.footer.*w/': 'catalog.footer.*w/',\r\n          'thread_reader.use' : thread_reader_init,\r\n          'catalog.appearance.titleBar.settings'        : 'catalog.appearance.titleBar.filter',\r\n          'catalog.appearance.titleBar.refresh'         : 'catalog.appearance.titleBar.filter',\r\n          'catalog.appearance.titleBar.num_of_pages'    : 'catalog.appearance.titleBar.filter',\r\n          'catalog.appearance.titleBar.boards_selector' : 'catalog.appearance.titleBar.filter',\r\n          'catalog.appearance.titleBar.filter' : function(){\r\n            if (catalog_obj && catalog_obj.catalog_func()!==null) catalog_obj.catalog_func().pn12_0_2.getElementsByTagName('*')[this.name.substr(this.name.lastIndexOf('.')+1)].style.display = (this.checked)? '' : 'none';\r\n          },\r\n          'catalog_size_text_height': 'catalog_size_width', \r\n          'catalog_size_text_width': 'catalog_size_width',\r\n          'catalog_size_height': 'catalog_size_width',\r\n          'catalog_size_width': function(){\r\n            if (catalog_obj && catalog_obj.catalog_func()!==null) catalog_obj.catalog_func().catalog_resized(this);\r\n          },\r\n          'catalog.click_area': styleSheet.make_rule_click_area,\r\n          'style.sel': styleSheet.styles_changed,\r\n          'style.fix.*': 'style.sel',\r\n          'style.copy.*': 'style.sel',\r\n          'style.reset.*': function(){\r\n            var pref_def = pref_default();\r\n            var tgt = this.name.split('.')[2];\r\n            pref_func.pref_overwrite(pref.style[tgt], pref_def.style[tgt]);\r\n            pref_func.settings.apply_pn13_1();\r\n            pref_func.settings.onchange_funcs['style.sel']();\r\n          },\r\n          'style.userCSS.*': styleSheet.userCSS_changed,\r\n////////          'catalog.click_area': function(){ // working code.\r\n////////            if (pref_func.style_sheet) {\r\n////////              if (pref_func.style_sheet.cssRules[2]) pref_func.style_sheet.deleteRule(2);\r\n////////              pref_func.settings.onchange_funcs['catalog.click_area_add_rule']();\r\n////////            }\r\n////////          },\r\n////////          'catalog.click_area_add_rule': function(){\r\n////////////            var tgt  = site2[site.nickname].parse_funcs[site.whereami+'_html']['class_'+((pref.catalog.click_area==='entire')? 'thread' : 'thumbnail')]; // working code.\r\n////////////            if (!tgt) tgt = 'dummy';\r\n////////////            pref_func.style_sheet.insertRule('.'+tgt+' {cursor: pointer}',2);\r\n////////            pref_func.style_sheet.insertRule('.'+pref.script_prefix+((pref.catalog.click_area==='entire')? '_thread' : '_thumbnail')+' {cursor: pointer}',2);\r\n////////          },\r\n//          'sound.beep_length_f' : notifier.sound.make_beep,\r\n//          'sound.beep_volume_f' : notifier.sound.make_beep,\r\n//          'sound.beep_freq'     : notifier.sound.make_beep,\r\n//          'sound.src'           : notifier.sound.src,\r\n//          'catalog.order.reply_to_me' : catalog_func.onchange_funcs['catalog.indexing'](),\r\n//          'catalog.order.reply'  : catalog_func.onchange_funcs['catalog.indexing'](),\r\n//          'catalog.order.watch'  : catalog_func.onchange_funcs['catalog.indexing'](),\r\n//          'catalog.order.sticky' : catalog_func.onchange_funcs['catalog.indexing'](),\r\n          'virtualBoard.p_board' : function(){liveTag.update_boardlist(true);},\r\n          'virtualBoard.p_remove' : 'virtualBoard.p_board',\r\n          'virtualBoard.max' : 'virtualBoard.p_board',\r\n          'virtualBoard.show' : 'virtualBoard.p_board',\r\n          'easy.virtualBoard_10_passive' : 'easy.virtualBoard_10',\r\n          'easy.virtualBoard_10' : function(){pref_func.settings.onchange_funcs['pn13_1_warning_reload'](); pref_func.pref_samples.onclick_event.call(this);},\r\n          'easy.virtualBoard_1' : 'easy.virtualBoard_10',\r\n          'easy.virtualBoard_8_50' : 'easy.virtualBoard_10',\r\n          'easy.virtualBoard_8_100' : 'easy.virtualBoard_10',\r\n          'easy.virtualBoard_8_500' : 'easy.virtualBoard_10',\r\n          'easy.virtualBoard_8_all' : 'easy.virtualBoard_10',\r\n          'easy.virtualBoard_interSite' : 'easy.virtualBoard_10',\r\n          'easy.posts_0h' : 'easy.virtualBoard_10',\r\n          'easy.posts_24h' : 'easy.virtualBoard_10',\r\n          'easy.threads_24h' : 'easy.virtualBoard_10',\r\n          'easy.embed_index' : 'easy.virtualBoard_10',\r\n          'easy.embed_index_lazy' : 'easy.virtualBoard_10',\r\n          'easy.embed_index_infinite' : 'easy.virtualBoard_10',\r\n          'easy.embed_index_backwash' : 'easy.virtualBoard_10',\r\n          'easy.light' : 'easy.virtualBoard_10',\r\n          'easy.stat_activate' : 'easy.virtualBoard_10',\r\n          'easy2.beginner' : function(e){\r\n            pref.easy2.presets = 1;\r\n            pref_func.settings.onchange_funcs['easy2.presets'](e,pref.easy2.presets);\r\n            pref_func.settings.onchange_funcs['easy2.apply'](e, true);\r\n            pref_func.settings.onchange_funcs['reload'](e);\r\n          },\r\n          'easy2.presets' : function(e,idx){\r\n            pref_func.pref_samples['easy2.presets']((idx!==undefined)? idx : pref.easy2.presets);\r\n            pref_func.settings.apply_pn13_1();\r\n          },\r\n          'easy2.limits' : function(e,idx){\r\n            pref_func.pref_samples['easy2.limits']();\r\n            pref_func.settings.apply_pn13_1();\r\n          },\r\n          'easy2.apply' : function(e, force_reset){\r\n            if (pref.easy2.reset || force_reset) pref_func.settings.onchange_funcs['load_default'](e);\r\n            pref_func.pref_samples['easy2.presets']();\r\n            pref_func.settings.onchange_funcs['pn13_1_warning_reload']();\r\n            pref_func.pref_samples.onclick_event(null,pref.easy2);\r\n          },\r\n          'reload' : function(){location.reload();},\r\n          'triage_simple_kill' : 'triage_simple',\r\n          'triage_simple' : function(){pref_func.pref_samples.onclick_event.call(this);},\r\n          'triage_basic' : 'triage_simple',\r\n          'triage_basic_color' : 'triage_simple',\r\n          'triage_colorful' : 'triage_simple',\r\n          'triage_borders' : 'triage_simple',\r\n          'triage_samples' : 'triage_simple',\r\n          'triage_test' : 'triage_simple',\r\n          'virtualBoard.scanStart' : function(){if (catalog_obj && catalog_obj.catalog_func()!==null) catalog_obj.catalog_func().catalog_liveTag_scan_site();},\r\n          'virtualBoard.scanStop' : function(){scan.abort();},\r\n          'virtualBoard.scan_domains.*': function(){\r\n            if (pref.virtualBoard.instant_scan) {\r\n              var domain = this.name.replace('virtualBoard.scan_domains.','');\r\n              scan.keyword_load_1(domain);\r\n            }},\r\n          'virtualBoard.search.show': function(e, init){\r\n            if (!site.components.boardlist) return;\r\n            var tgt_name = 'virtualBoard.search';\r\n            var bar = site.components.boardlist.getElementsByTagName('input')[tgt_name+'.str'];\r\n            if (bar) bar = bar.parentNode;\r\n            if (pref.virtualBoard.search.show) {\r\n              if (!bar) {\r\n                bar = document.createElement('span');\r\n                bar.innerHTML = pref_func.format_html_str('<ITBL10\"'+tgt_name+'.str\"><span style=\"display:none\"><ICBX\"'+tgt_name+'.re\">RE, &lt;<ITB2\"virtualBoard.max\"><span name=\"HIDE4\">\\u25c0</span></span><span name=\"SHOW4\">\\u25b6</span>');\r\n                bar.style= 'float:right';\r\n                pref_func.apply_prep(bar,false);\r\n                pref_func.add_onchange(bar, pref_func.settings.onchange_funcs_formatted, pref_func.settings.oninput_funcs);\r\n//                bar.oninput = function(e){pref.virtualBoard.search.str = e.target.value;liveTag.filter_onchange(pref.virtualBoard.search);}; // not storing to sessionStorage\r\n//                var pn_settings = bar.childNodes[1];\r\n//                var pn_open = bar.childNodes[2];\r\n//                var pn_close = bar.childNodes[1].childNodes[2];\r\n//                pn_open.onclick = function(){pn_open.style.display='none';pn_settings.style.display=null;};\r\n//                pn_close.onclick = function(){pn_open.style.display=null;pn_settings.style.display='none'};\r\n                site.settings.parentNode.insertBefore(bar, site.settings);\r\n                pref_func.mirror_targets.boardlist = bar;\r\n                if (!init) liveTag.update_pn(); // activate filter\r\n              }\r\n            } else if (bar) {\r\n              site.settings.parentNode.removeChild(bar); // 'if' for initialj\r\n              pref_func.mirror_targets.boardlist = null;\r\n              liveTag.update_pn(); // disable filter\r\n            }\r\n          },\r\n          'virtualBoard.search.*': 'virtualBoard.search.str', // for 'search.re'. checkboxes don't fire oninput, though MDN says they fire. https://developer.mozilla.org/ja/docs/Web/HTML/Element/Input/checkbox\r\n          'debug_site2': function(){if (pref.debug_mode.site2func) common_func.debug_site2func(pref.debug_mode.site2func);},\r\n          'debug_pfunc': function(){if (pref.debug_mode.pfunc) common_func.debug_parse_funcs_entry(pref.debug_mode.pfunc);},\r\n          'debug_pfunc_comp': function(){if (pref.debug_mode.pfunc_comp) common_func.debug_parse_funcs_entry(pref.debug_mode.pfunc, pref.debug_mode.pfunc_comp);},\r\n          'debug_pfunc_all': function(){if (pref.debug_mode.pfunc_all) common_func.debug_parse_funcs_all(pref.debug_mode.pfunc_all);},\r\n          'liveTag.ex_list_str' : function(){liveTag.ex_list_changed();},\r\n          'liveTag.inherit_board_name' : function(){liveTag.inherit_board_name_changed();},\r\n          'liveTag.inherit_board_tags' : function(){liveTag.inherit_board_tags_changed();},\r\n          'page.mark_new_posts' : function(){if (cataLog.format_html) cataLog.format_html.time_filter_changed();},\r\n          'recovery.comment' : function(){recovery.setup();},\r\n          '*.open_spoiler_text': styleSheet.open_spoiler_text,\r\n          '*.scroll_lock': function(){cataLog.general_event_handler.setup();},\r\n          'button_test': function(){\r\n//            site2['meguca'].catalog_native_prep(Date.now(), cataLog.components.pn12_0_4, cataLog.components.pn12_0, cataLog.embed_mode==='catalog');\r\n            function callback(domain, board, no, result){\r\n              console.log(result);\r\n            }\r\n            IDB.req_raw('meguca', 'meguca', 'mine', null, callback, 'get_all', true);\r\n          },\r\n          '*.posts_search_op': function(e,embed_mode){\r\n            if (!embed_mode) embed_mode = cataLog.embed_mode;\r\n            styleSheet.register('.CatChan_search_miss', (pref[embed_mode].posts_search_op==='opaque')? 'opacity:'+pref[embed_mode].posts_search_op_opacity/100+' !important' :\r\n                                (pref[embed_mode].posts_search_op==='hide')? 'display:none !important' : null);},\r\n          '*.posts_search_op_opacity': '*.posts_search_op',\r\n          'style.post_editing': function(){styleSheet.register('.'+pref.script_prefix+'_post_editing', pref.style.post_editing);},\r\n          'archive': {\r\n            'restore2': function(e, files, posts){\r\n              if (!cataLog.threads) return;\r\n              if (e && !pref.archive.restore_auto && e.target.name!=='archive.restore_button') return;\r\n              if (!posts) {\r\n                files = Array.prototype.slice.call(pref3.archive.dir.files);\r\n                posts = files.filter(function(v,i,a){return v.name.search(/\\.(json|html*)$/)!=-1;});\r\n                posts = posts.filter(function(v,i,a){return v.name.indexOf('_deleted.json')==-1;}); // PATCH\r\n              }\r\n              var imgs = files.filter(function(v,i,a){return v.name.search(/\\.(json|html*)$/)==-1;});\r\n              if (posts.length===0) return;\r\n              archiver.restore_entry(posts,imgs, this['clear_files_button'], files.filter(function(v,i,a){return v.name.indexOf('_deleted.json')!=-1;}));\r\n            },\r\n            'dir': 'restore2',\r\n            'files_sel': function(e){\r\n              e.target.parentNode.querySelectorAll('span[name=\"FILES_ARCHIVE0\"]')[0].style.display = (pref.archive.files_sel===0)? '' : 'none';\r\n              e.target.parentNode.querySelectorAll('span[name=\"FILES_ARCHIVE1\"]')[0].style.display = (pref.archive.files_sel===1)? '' : 'none';\r\n              e.target.parentNode.querySelectorAll('span[name=\"FILES_ARCHIVE2\"]')[0].style.display = (pref.archive.files_sel===2)? '' : 'none';\r\n              if (pref.archive.files_sel===2) this['queryList']();\r\n            },\r\n            'restore_button': function(e){\r\n              if (pref.archive.files_sel===0) this['restore2'](e);\r\n              if (pref.archive.files_sel===2) this['IDB_thread_sel'](e);\r\n              else this['restore'](e);\r\n            },\r\n            'restore': function(e){\r\n//            if (!cataLog.threads) return;\r\n//            if (!pref.archive.restore_auto && e.target.name!=='archive.restore') return;\r\n              var posts= pref3.archive.jsons.files;\r\n              var imgs = pref3.archive.imgs.files;\r\n//            if (pref.archive.force_json) files = Array.prototype.filter.call(files,function(v){return v.name.substr(-5,5)==='.json';});\r\n              if (posts.length===0 || (pref.archive.load_img && imgs.length===0)) return;\r\n//            archiver.restore_entry(files,imgs, this['clear_files_button']);\r\n              this['restore2'](null, Array.prototype.slice.call(imgs), posts);\r\n            },\r\n            'jsons': 'restore',\r\n            'imgs': 'restore',\r\n            'clear_files_button': function(){\r\n              var doms = [pref3.archive.jsons, pref3.archive.imgs];\r\n              for (var i=0;i<doms.length;i++) if (doms[i] && doms[i].parentNode) {\r\n                var dom_new = doms[i].parentNode.insertBefore(doms[i].cloneNode(doms[i]),doms[i]);\r\n                dom_new.onchange = doms[i].onchange;\r\n                doms[i].parentNode.removeChild(doms[i]);\r\n                dom_new.onchange({target:doms[i], currentTarget:doms[i]});\r\n              }\r\n            },\r\n            get pn_IDB_board_sel(){return pref_func.settings.pn13 && pref_func.settings.pn13.querySelector('select[name=\"archive.IDB_board_sel\"]');},\r\n            get pn_IDB_thread_sel(){return pref_func.settings.pn13 && pref_func.settings.pn13.querySelector('select[name=\"archive.IDB_thread_sel\"]');},\r\n            'IDB_select_multiple': function(){\r\n              this.pn_IDB_board_sel.multiple = pref.archive.IDB_select_multiple;\r\n              this.pn_IDB_thread_sel.multiple = pref.archive.IDB_select_multiple;\r\n            },\r\n            'queryQuota': function(){\r\n              if (navigator.webkitTemporaryStorage) navigator.webkitTemporaryStorage.queryUsageAndQuota(this['showQuota'].bind(this));\r\n            },\r\n            'showQuota': function(usage, limit){\r\n              var tgt = pref_func.settings.pn13.querySelector('span[name=\"SHOW_QUOTA\"]');\r\n              if (tgt) tgt.textContent = usage.toLocaleString() + ' / ' + limit.toLocaleString() + ' (' + (usage*100/limit).toString().slice(0,5) + '%)';\r\n            },\r\n            'queryList': function(){\r\n              if (!pref.test_mode['65']) if (!pref4.archive.IDB_board_sel_options)\r\n              if (!brwsr.ff) window.indexedDB.webkitGetDatabaseNames().onsuccess = this['showList'].bind(this);\r\n                else setTimeout(function(){this.showList({target:{result:Object.keys(liveTag.mems[site.nickname])}})}.bind(this),0);\r\n            },\r\n            'showList': function(e){\r\n              if (e) {\r\n                var results = e.target.result;\r\n                var options = ['Select board'];\r\n                for (var i=0;i<results.length;i++) options[options.length] = results[i].replace(/^[^\\/]*/,'');\r\n                options[options.length] = 'ALL (' + results.length + ')';\r\n              } else options = null;\r\n              pref4.archive.IDB_board_sel_options = options;\r\n              pref_func.apply_prep(this.pn_IDB_board_sel, false);\r\n            },\r\n            'IDB_board_sel': function(){\r\n              pref4.archive.IDB_thread_sel_options = null;\r\n              var pn = this.pn_IDB_thread_sel;\r\n              pref_func.apply_prep(pn, false);\r\n              pn.style.display = '';\r\n              var boards = this['IDB_selected_boards']();\r\n              for (var i=0;i<boards.length;i++) IDB.req(site.nickname, boards[i], null, null, this['showThreadList_fromIDB'].bind(this), 'list_os');\r\n            },\r\n            'IDB_selected_boards': function(){\r\n              if (pref.archive.IDB_board_sel===0) return [];\r\n//            var board = pref4.archive.IDB_board_sel_options[pref.archive.IDB_board_sel];\r\n//            return (board[0]==='A')? pref4.archive.IDB_board_sel_options.slice(1,-1) : [board]; // ALL\r\n              return (pref4.archive.IDB_board_sel_options && pref.archive.IDB_board_sel===pref4.archive.IDB_board_sel_options.length-1)? pref4.archive.IDB_board_sel_options.slice(1,-1) :\r\n                Array.prototype.slice.call(this.pn_IDB_board_sel.options).filter(function(v){return v.selected;}).map(function(v){return v.textContent;});\r\n            },\r\n            'showThreadList_fromIDB': function(domain, board, nos){\r\n              var boards = this['IDB_selected_boards']();\r\n              if (boards.length==1) board = '';\r\n              var options = pref4.archive.IDB_thread_sel_options || ['ALL'];\r\n              for (var i=0;i<nos.length;i++) options[options.length] = board + nos[i];\r\n              options[0] = ' '; // assure the top before sort.\r\n              options.sort();\r\n              options[0] = 'ALL (' + (options.length-1) +')';\r\n              pref4.archive.IDB_thread_sel_options = options;\r\n              pref_func.apply_prep(this.pn_IDB_thread_sel, false);\r\n            },\r\n            'IDB_thread_sel': function(e){\r\n              if (!cataLog.threads) return;\r\n              if (!pref.archive.restore_auto && e.target.name!=='archive.restore_button') return;\r\n              if (pref.archive.clear_threads && cataLog.threads) cataLog.catalog_clear_threads(0);\r\n              this['IDB.selected_threads'](IDB.req, null, this['restore3'].bind(this), 'get_all');\r\n            },\r\n            'IDB.selected_threads': function(func, arg3, arg4, arg5){\r\n              var ths = (pref.archive.IDB_thread_sel===0)? pref4.archive.IDB_thread_sel_options.slice(1) : // ALL\r\n                Array.prototype.slice.call(this.pn_IDB_thread_sel.options).filter(function(v){return v.selected;}).map(function(v){return v.textContent;});\r\n//                                                      [pref4.archive.IDB_thread_sel_options[pref.archive.IDB_thread_sel]];\r\n              var boards = this['IDB_selected_boards']();\r\n              var board = (boards.length===1)? boards[0] : '';\r\n              if (func) for (var i=0;i<ths.length;i++) func(site.nickname, board || ths[i].replace(/[^\\/]*$/,''), ths[i].replace(/\\/[^\\/]*\\//,''), arg3, arg4, arg5);\r\n              else {\r\n                var proto = {domain:site.nickname, boards:boards};\r\n                for (var i=0;i<ths.length;i++) ths[i] = {board:board || ths[i].replace(/[^\\/]*$/,''), no:ths[i].replace(/\\/[^\\/]*\\//,''), __proto__:proto};\r\n                return ths;\r\n              }\r\n            },\r\n            'restore3': function(domain, board, no, result){\r\n              var obj = this['consolidate_IDB_result'](result, domain);\r\n              if (obj.posts.length>0) {\r\n                var th = archiver.restore({name:(site.nickname+board+no).replace(/\\//,'-')}, site2[domain].parse_funcs.thread_json.prep_to_archive(obj.posts), obj.tn, true);\r\n                if (obj.posts_deleted.length>0) {\r\n                  if (pref.test_mode['80']) board = board.slice(0,-1)+'_IDB/';\r\n                  var lth = liveTag.mems.init({domain:domain, board:board, no:no});\r\n                  archiver.prep_deleted_posts(th, lth, true, obj.posts_deleted);\r\n                }\r\n              }\r\n            },\r\n            'consolidate_IDB_result': function(result, domain){\r\n              var posts = [];\r\n              var posts_deleted = [];\r\n              var images = {};\r\n              var thumbs = Object.create(images);\r\n              var keys = Object.keys(result);\r\n              for (var i=0;i<keys.length;i++) {\r\n                if (keys[i].indexOf('posts_deleted')===0) posts_deleted = posts_deleted.concat(result[keys[i]]);\r\n                else if (keys[i].indexOf('posts')===0) posts = posts.concat(result[keys[i]]);\r\n                else if (keys[i]==='pruned_time') continue; // patch for old files.\r\n                else {\r\n                  var ext = keys[i].replace(/[^\\.]*./,'');\r\n                  var type = (ext==='webm')? 'video/webm' : 'image';\r\n                  var file_obj = {type:type, file:result[keys[i]]};\r\n                  if (keys[i].indexOf('tn_')===0) thumbs[keys[i].substr(3)] = file_obj;\r\n                  else images[keys[i].substr(4)] = file_obj;\r\n                }\r\n              }\r\n              var i = 0;\r\n              while (i<posts.length-1 && posts[i].no<posts[i+1].no) i++;\r\n              if (i!==posts.length-1) { // out of order or duplication may due to queueing system of IDB, retry or reload.\r\n                posts.sort(this['consolidate_IDB_sort_func']);\r\n                i = 0;\r\n                while (i<posts.length-1) {\r\n                  if (posts[i].no===posts[i+1].no) {\r\n                    var j=i+2;\r\n                    while (j<posts.length && posts[i].no===posts[j].no) j++;\r\n                    if (domain==='meguca') {\r\n                      var editing = posts[i].editing;\r\n                      var k=i+1;\r\n                      while (k<j && posts[k].editing==editing) k++;\r\n                      if (k<j) {\r\n                        k=j;\r\n                        while (--k>i) if (posts[k].editing) {posts.splice(k,1);j--;}\r\n                      }\r\n                    }\r\n                    while (--j>i) posts.splice(j,1); // 4chan has different coms when anchor refers deleted posts.\r\n//                    while (--j>i) if (posts[j-1].com===posts[j].com) posts.splice(j,1); // BUG. posts[x].no must be unique and simple increase at 'check_deleted_posts'.\r\n                  }\r\n                  i++;\r\n                }\r\n              }\r\n              j=0;\r\n              for (var i=0;i<posts_deleted.length;i++) {\r\n                while (j<posts.length && posts[j].no<posts_deleted[i].no) j++;\r\n                if (j<posts.length && posts[j].no===posts_deleted[i].no) posts.splice(j,1);\r\n              }\r\n              var func_init = domain && site2[domain].parse_funcs.thread_json.consolidate_IDB_result_sub;\r\n              if (func_init && posts.length!==0) func_init(posts);\r\n              return {posts:posts, posts_deleted:posts_deleted, img:images, tn:thumbs};\r\n            },\r\n            'consolidate_IDB_sort_func': function(a,b){return (a.no!==b.no)? a.no - b.no : (a.com<b.com)? -1:1},\r\n            'IDB.delete_board': function(){\r\n              var boards = this['IDB_selected_boards']();\r\n              for (var i=0;i<boards.length;i++) window.indexedDB.deleteDatabase(pref.script_prefix+'.'+boards[i]);\r\n//              this['IDB.delete_board_pn']();\r\n//            },\r\n//            'IDB.delete_board_pn': function(){\r\n              var pn = this.pn_IDB_thread_sel;\r\n              if (pn) pn.style.display = 'none';\r\n              this['showList'](null);\r\n              this['queryList']();\r\n            },\r\n            'IDB.delete_thread': function(){\r\n              this['IDB.selected_threads'](IDB.req, null, null, 'delete_th');\r\n              this['IDB_board_sel'](null);\r\n            },\r\n            'IDB.delete_imgs': function(){\r\n              this['IDB.selected_threads'](IDB.req, IDBKeyRange.bound('img_', 'img`', false, true), null, 'delete');\r\n            },\r\n            'IDB.export_thread': function(){\r\n              var ths = this['IDB.selected_threads']();\r\n              var filename = 'CatChan_IDB_'+ths[0].domain+'-'+((ths[0].boards.length==1)? ths[0].board.slice(1,-1) : ths[0].boards.length)+'-'+\r\n                                                              ((ths.length===1)? ths[0].no : ths.length) +'.tar';\r\n              var file_id = 'IDB_extract_'+Date.now();\r\n              var callback = (function(this_obj){\r\n                var count = ths.length;\r\n                return function(domain, board, no, result){\r\n                  this_obj['export_thread'](domain, board, no, result, file_id);\r\n                  if (--count===0) archiver.tar.flush(file_id, filename);\r\n                }\r\n              })(this);\r\n              for (var i=0;i<ths.length;i++) IDB.req(ths[i].domain, ths[i].board, ths[i].no, null, callback, 'get_all');\r\n            },\r\n            'export_thread': function(domain, board, no, result, file_id, filename){\r\n              var obj = this['consolidate_IDB_result'](result, domain);\r\n//            var file_id = 'CatChan_IDB_'+domain+'-'+board.slice(1,-1)+'-'+no+'.tar';\r\n              var props = Object.keys(obj);\r\n              for (var i=0;i<props.length;i++) {\r\n                var props2 = (Array.isArray(obj[props[i]]))? ['dummy'] : Object.keys(obj[props[i]]);\r\n                for (var j=0;j<props2.length;j++) {\r\n                  var isPosts = props[i].indexOf('posts')===0;\r\n                  if (isPosts && obj[props[i]].length===0) continue;\r\n                  var data = (isPosts)? new Blob([JSON.stringify(site2[domain].parse_funcs.thread_json.prep_to_archive(obj[props[i]]))], {type:'text/plain'}) : obj[props[i]][props2[j]].file;\r\n                  var suffix = (isPosts)? domain+'-'+board.slice(1,-1)+'-'+no+ props[i].substr(5)+'.json' : props[i] +'_'+ props2[j];\r\n                  archiver.tar.add_blob(data, {domain:domain, board:board, no:no}, suffix, file_id, true);\r\n                }\r\n              }\r\n              if (filename) archiver.tar.flush(file_id, filename);\r\n            },\r\n            'IDB.reset_time': function(){\r\n              this['IDB.selected_threads'](archiver.clean_list);\r\n            },\r\n            'start': function(e){archiver.store_entry((e.target.name==='archive.start')? 'ARC' : 'ARC1');},\r\n            'oneshot': 'start',\r\n            'kwd.*': function(){pref.archive.kwd.rexps = common_func.kwd_prep_regexp(pref.archive.kwd);},\r\n          },\r\n          'test_mode.js_load': function(){\r\n            var file = pref_func.settings.pn13.getElementsByTagName('input')['test_mode.js_file'].files[0];\r\n            var url = window.URL.createObjectURL(file);\r\n            var scr = document.createElement('script');\r\n            scr.src = url;\r\n            site.script_body.appendChild(scr);\r\n          },\r\n          '*.merge': function(e){site2['DEFAULT'].update_posts_merge_bases.onchange_merge(e);},\r\n          '*.merge_list': '*.merge',\r\n          '*.merge_list_str': '*.merge',\r\n          '*.merge_lv': function(e){site2['DEFAULT'].update_posts_merge_bases.onchange_lv(e);},\r\n          '*.merge_lv_str': '*.merge_lv',\r\n          'scanBoard': function(e){if (cataLog.event_func) cataLog.event_func(e);},\r\n          'scanBoardIf': 'scanBoard',\r\n          'scanSite': 'scanBoard',\r\n          'scanSiteIf': 'scanBoard',\r\n          'tighten_loosed_limits': function(e){pref4.search_posts_active_once = false;},\r\n          '*w/.t2h_sel': function(e,src){if (cataLog.Footer && pref.catalog.footer.use && pref.catalog.footer.flag) cataLog.Footer.update_all_force(e,src,true);},\r\n          '*w/.t2h_num_of_posts': 'catalog.t2h_sel',\r\n        },\r\n      },\r\n      bind_myself: function(obj, args){for (var i of args) obj[i] = obj[i].bind(obj);},\r\n      format_html_str: function(html){\r\n        html = html.replace(/<br>([1-9]),/g,function(match,p1){ // function myself(match,p1){return (!p1)? '<br>' : myself(null,p1-1)+'&emsp;';}\r\n                                              var str = '<br>';\r\n                                              for (var i=0;i<p1;i++) str += '&emsp;';\r\n                                              return str;\r\n                                            });\r\n        html = html.replace(/<TA\"([\\w.]+),(\\d+),(\\d+)\"([^>]*)>/g,'<textarea style=\"height:1em\" rows=\"$3\" cols=\"$2\" name=\"$1\"$4></textarea>');\r\n        html = html.replace(/<IC\"([\\w.]+)\"([^>]*)>(\\w)?/g,function(m,p1,p2,p3){return '<input type=\"checkbox\" name=\"'+p1+'\"'+p2+'>'+(p3?' '+p3:'');}); // with single space\r\n        html = html.replace(/<ITB(L)?(\\d+)\"([\\w.]+)\"([^>]*)>(\\w)?/g,function(m,p1,p2,p3,p4,p5){return '<input type=\"text\"'+(p1?'':' style=\"text-align: right;\"')+' size=\"'+p2+'\" name=\"'+p3+'\"'+p4+'>'+(p5?' '+p5:'');}); // with single space\r\n        html = html.replace(/<ICBX\"/g,'<input type=\"checkbox\" name=\"'); // used for catalog.filter.kwd\r\n//        html = html.replace(/<ITBL(\\d+)\"/g,'<input type=\"text\" size=\"$1\" name=\"');\r\n//        html = html.replace(/<ITB(\\d+)\"/g,'<input type=\"text\" style=\"text-align: right;\" size=\"$1\" name=\"');\r\n//        html = html.replace(/<IR(\"[\\w\\.]+):([^:]+):([^\"]+)\">/g,'<input type=\"radio\" name=$1\" value=\"$2\">$3');\r\n        html = html.replace(/<IR\"([\\w\\.]+),([^\"]+)\">/g,'<input type=\"radio\" name=\"$1\" value=\"$2\">');\r\n        html = html.replace(/<SSV(\"[\\w\\.]+\")>/g,'<span data-class=\"show_value\" style=\"font-weight:bold\" name=$1></span>');\r\n        html = html.replace(/<BTN\"([\\w.]+),([^\"]+)\"([^>]*)>/g,'<button type=\"button\" name=\"$1\"$3>$2</button>');\r\n        html = html.replace(/<IF\"/g,'<input type=\"file\" name=\"');\r\n        return html.replace(/<input type=\"(checkbox|radio)[^>]+>[^<]+/g,'<label>$&</label>');\r\n      },\r\n    };\r\n  })();\r\n  pref_func.settings.oninput_funcs = pref_func.add_onchange_format(pref_func.settings.onchange_funcs.__proto__);\r\n///  pref_func.settings.onchange_funcs.entry_func = (function(myself){ // working code.\r\n///    return function(e){\r\n///      pref_func.apply_prep(this,true);\r\n///      var pn_name = this.getAttribute('name'); // for <span>\r\n///      if (myself[pn_name]) myself[pn_name].call(this,e);\r\n///      else if (pn_name.indexOf('.')!=-1) {\r\n///        var name = '*'+pn_name.substr(pn_name.indexOf('.')); // *.XXX\r\n///        if (myself[name]) myself[name].call(this,e);\r\n///        else if (pn_name.lastIndexOf('.')!=-1) {\r\n///          var name = pn_name.substr(0,pn_name.lastIndexOf('.')+1)+'*'; // XXX.YYY.*\r\n///          if (myself[name]) myself[name].call(this,e);\r\n///        }\r\n///      }\r\n///      var pn = e.target.parentNode;\r\n///      while (pn && pn!==site.script_body) {\r\n///        if (pn.getAttribute('name')==='SUB') myself['SUB'].call(pn,{currentTarget:pn});\r\n///        pn = pn.parentNode;\r\n///      }\r\n///    }\r\n///  })(pref_func.settings.onchange_funcs);\r\n\r\n  pref_func.settings.onchange_funcs['catalog.tag.ignore'] = pref_func.settings.onchange_funcs['tag.re_generate'];\r\n  pref_func.settings.onchange_funcs['catalog.tag.max']    = pref_func.settings.onchange_funcs['tag.re_generate'];\r\n  pref_func.settings.onchange_funcs['tag.gen_str']        = pref_func.settings.onchange_funcs['tag.gen'];\r\n  pref_func.bind_myself(pref_func.settings.oninput_funcs.__proto__, ['SHOW','HIDE','SHOW2','HIDE2','SHOW3','HIDE3','TOGGLE2','SHOWALL','HIDEALL']);\r\n\r\n  var options = {\r\n    func0_prep: function(){},\r\n    func0_exe : function(){}\r\n  };\r\n\r\n  common_func = {\r\n    __proto__:common_func,\r\n    overwrite_prop: function(dst,src){\r\n      for (var i in src) {\r\n        if (src[i]===undefined && dst[i]) delete dst[i];\r\n        else if (typeof(dst[i])==='object' && typeof(src[i])==='object') common_func.overwrite_prop(dst[i],src[i]);\r\n        else dst[i] = src[i];\r\n      }\r\n    },\r\n    name2domainboardthread: function(name,fill){\r\n//      var thread = name.replace(/[^\\/]*\\//g,'');\r\n//      var domain = name.replace(/\\/.*/,'');\r\n//      var board  = name.replace(new RegExp('^'+domain),'').replace(new RegExp(thread+'$'),'');\r\n\r\n//      name = new String(name); // not tested.\r\n      var thread = name.substr(name.lastIndexOf('/')+1);\r\n      var domain = name.substr(0,name.indexOf('/'));\r\n      var board  = name.substr(domain.length,name.length-thread.length-domain.length);\r\n      if (name===thread && thread.search(/[^0-9]/)!=-1) {\r\n        domain = thread;\r\n        thread = '';\r\n      }\r\n//      if (thread===domain) // BUG PATCH, SHOULD BE REMOVED.\r\n//        if (thread.search(/[^0-9]/)!=-1) thread ='';\r\n//        else domain = '';\r\n      if (fill) {\r\n        if (domain==='') domain = site.nickname;\r\n        if (board==='') board = site.board;\r\n      }\r\n      return [domain,board,thread];\r\n    },\r\n    name2dbt: (function(){\r\n      var type = { c:'catalog_html',\r\n                   j:'catalog_json',\r\n                   p:'page_html',\r\n                   q:'page_json',\r\n                   t:'thread_json',\r\n//                   0:'thread_html' // default\r\n                 };\r\n      return function(name){\r\n        var dbt = this.name2domainboardthread(name,true);\r\n        dbt[3] = type[dbt[2][0]];\r\n        if (dbt[3]) dbt[2] = dbt[2].substr(1);\r\n        else dbt[3] = 'thread_html';\r\n//        if (dbt[2][0].search(/[A-z]/)!=-1) {\r\n//          dbt[3] = type[dbt[2][0]];\r\n//          dbt[2] = dbt[2].substr(1);\r\n//        } else dbt[3] = 'thread_html';\r\n        return dbt;\r\n      }\r\n    })(),\r\n//    fullname2dbt: function(name){ // slow\r\n//      var dbt = name.split('/');\r\n//      dbt[1] = '/'+dbt[1]+'/';\r\n//      return dbt;\r\n//    },\r\n    fullname2dbt: function(name){\r\n      var thread = name.substr(name.lastIndexOf('/')+1);\r\n      var domain = name.substr(0,name.indexOf('/'));\r\n      var board  = name.substr(domain.length,name.length-thread.length-domain.length);\r\n      return [domain,board,thread];\r\n    },\r\n    dom_addEventListener: function(ary, dom, kwd, func){\r\n      dom.addEventListener(kwd, func, false);\r\n      ary[ary.length] = [dom, kwd, func];\r\n    },\r\n    dom_removeEventListener: function(ary, dom, kwd, func){\r\n      for (var i=ary.length-1;i>=0;i--) {\r\n        if ((!dom || dom===ary[i][0]) && (!kwd || kwd===ary[i][1]) && (!func || func===ary[i][2])) {\r\n          ary[i][0].removeEventListener(ary[i][1], ary[i][2], false);\r\n          ary.splice(i,1);\r\n        }\r\n      }\r\n    },\r\n    dom_addAttribute: function(dom,attr,val){\r\n      var val_old = dom.getAttribute(attr);\r\n      if (val_old) val = val_old + ' ' + val;\r\n      dom.setAttribute(attr,val);\r\n    },\r\n    Triage: function(str,args){\r\n      var tooltips = {\r\n        'NONE': ['Don\\'t hide this thread and set its style.',true],\r\n        'ATTR': ['Set style additionally.',true],\r\n        'KILL': ['Hide this thread permanently.',true],\r\n        'TIME': ['Hide this thread until it gets new replies.',true],\r\n        'WATCH': ['Watch this thread and mark as I\\'ve read all posts so far.', false],\r\n        'UNWATCH': ['Unwatch this thread.', false],\r\n        'SHOW': ['Show this thread always without regard to filter setting.', false],\r\n        'UNSHOW': ['Remove \\'show\\' marks.', false],\r\n        'STICKY': ['Sticky this thread.', false],\r\n        'UNSTICKY': ['Unsticky this thread.', false],\r\n        'UNDO': ['Undo last modification.', false],\r\n        'GO': ['Open this thread.', false],\r\n        'ARC': ['Start archiving this thread.', false],\r\n        'ARC1': ['Archive this thread one time.', false],\r\n        'UARC': ['Unarchive this thread.', false],\r\n      };\r\n      tooltips['KILL_N'] = [tooltips['KILL'][0],false];\r\n      tooltips['TIME_N'] = [tooltips['TIME'][0],false];\r\n        var format_tgt = [];\r\n        var toggles = ['WATCH','UNWATCH','SHOW','UNSHOW','STICKY','UNSTICKY','ARC','ARC1','UARC'];\r\n        var pn = document.createElement('div');\r\n        pn.name = (args.name)? args.name : '';\r\n//        pn_triage.style.position = 'absolute';\r\n//        pn_triage.name = 'pn_catalog_triage';\r\n        pn.className = 'catalog_triage_parent';\r\n        var lines = str.replace(/\\s*\\/\\/.*/mg,'').split('\\n');\r\n        str = [];\r\n        for (var i=lines.length-1;i>=0;i--) if (lines[i]==='') lines.splice(i,1);\r\n        var triage_style_replace_list = (!brwsr.ff)? ['background','background-color'] : [];\r\n        for (var i=0;i<lines.length;i++) str[i] = lines[i].split(',');\r\n        for (var i=0;i<str.length;i++) {\r\n          for (var j=0;j<str[i].length;j+=3) {\r\n            var triage_button = document.createElement('button');\r\n            triage_button.innerHTML = str[i][j+1];\r\n            triage_button.name = pn.name + '('+i+','+j+')';\r\n            triage_button.className = 'catalog_triage_button';\r\n            triage_button.type = 'button';\r\n            var triage_styles = (str[i][j+2])? str[i][j+2].split(';') : [];\r\n            for (var k=0;k<triage_styles.length;k++) {\r\n              var style_str = triage_styles[k].replace(/:.*/,'');\r\n              for (var m=0;m<triage_style_replace_list.length;m+=2) style_str = style_str.replace(triage_style_replace_list[m],triage_style_replace_list[m+1]);\r\n              triage_button.style[style_str] = triage_styles[k].replace(/[^:]*:/,'');\r\n            }\r\n//            triage_button.onclick = triage_factory(i,j);\r\n            triage_button.onclick = args.onclick;\r\n            pn.appendChild(triage_button);\r\n            if (args.wheelpatch) triage_button.onmousewheel = args.wheelpatch;\r\n            if (pn.name) pref_func.tooltips.str[triage_button.name] = ((tooltips[str[i][j]])? tooltips[str[i][j]][0] +\r\n                                                                       ((tooltips[str[i][j]][1])? '\\nSet style ' + ((str[i][j+2])? str[i][j+2] : 'default') + '.' : '') : '');\r\n            if (toggles.indexOf(str[i][j])!=-1) format_tgt[format_tgt.length] = [triage_button, str[i][j]];\r\n          }\r\n          pn.appendChild(document.createElement('br'));\r\n        }\r\n//        pn.onclick = function(e){  // also works, but CSS is the better.\r\n//          e.preventDefault();\r\n//          var evt = document.createEvent('MouseEvents');\r\n//          evt.initUIEvent('click', false, true, window, 1);\r\n//          threads[pn12_triage_thread][0].dispatchEvent(evt);\r\n//        };\r\n        this.str = str;\r\n        this.pn  = pn;\r\n        this.format_tgt = (format_tgt.length!==0)? format_tgt : null;    \r\n      },\r\n//    make_triage: function(args){\r\n//        var triage_str = [];\r\n//        var pn_triage = document.createElement('div');\r\n////        pn_triage.style.position = 'absolute';\r\n////        pn_triage.name = 'pn_catalog_triage';\r\n//        pn_triage.className = 'catalog_triage_parent';\r\n//        var triage_str_lines = pref.catalog_triage_str.replace(/\\/\\/.*/mg,'').split('\\n');\r\n//        for (var i=triage_str_lines.length-1;i>=0;i--) if (triage_str_lines[i]==='') triage_str_lines.splice(i,1);\r\n//        var triage_style_replace_list = (!brwsr.ff)? ['background','background-color'] : [];\r\n//        for (var i=0;i<triage_str_lines.length;i++)\r\n//          triage_str[i] = triage_str_lines[i].split(',');\r\n//        for (var i=0;i<triage_str.length;i++) {\r\n//          for (var j=0;j<triage_str[i].length;j+=3) {\r\n//            var triage_button = document.createElement('button');\r\n//            triage_button.innerHTML = triage_str[i][j+1];\r\n//            triage_button.name = i+','+j;\r\n//            triage_button.className = 'catalog_triage_button';\r\n//            var triage_styles = (triage_str[i][j+2])? triage_str[i][j+2].split(';') : [];\r\n//            for (var k=0;k<triage_styles.length;k++) {\r\n//              var style_str = triage_styles[k].replace(/:.*/,'');\r\n//              for (var m=0;m<triage_style_replace_list.length;m+=2) style_str = style_str.replace(triage_style_replace_list[m],triage_style_replace_list[m+1]);\r\n//              triage_button.style[style_str] = triage_styles[k].replace(/[^:]*:/,'');\r\n//            }\r\n////            triage_button.onclick = triage_factory(i,j);\r\n//            triage_button.onclick = args.onclick;\r\n//            pn_triage.appendChild(triage_button);\r\n//            if (args.wheelpatch) triage_button.onmousewheel = args.wheelpatch;\r\n//          }\r\n//          pn_triage.appendChild(document.createElement('br'));\r\n//        }\r\n////        pn_triage.onclick = function(e){  // also works, but CSS is the better.\r\n////          e.preventDefault();\r\n////          var evt = document.createEvent('MouseEvents');\r\n////          evt.initUIEvent('click', false, true, window, 1);\r\n////          threads[pn12_triage_thread][0].dispatchEvent(evt);\r\n//////console.log('aaa');\r\n////        };\r\n//        return {pn:pn_triage, str:triage_str};\r\n//    },\r\n    modify_bookmark: function(name,add){\r\n      var key = new RegExp('(^|,)'+name.replace(/\\+/,'\\\\+')+'([\\^@*!][^,\\n]*)*(,|\\n|$)','mg');\r\n      var str = pref.catalog.filter.bookmark_list_str;\r\n      str = str.replace(key,',') + ((add)? ','+name+'\\n' : '');\r\n      pref.catalog.filter.bookmark_list_str = str.replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,'')\r\n      if (catalog_obj.catalog_func()) {\r\n        var tgt = catalog_obj.catalog_func().pn12_0_4.getElementsByTagName('textarea')['catalog.filter.bookmark_list_str'];\r\n        pref_func.apply_prep(tgt,false);\r\n      } else if (pref.catalog.auto_save_filter) { // see 'save' in catalog.\r\n        if (localStorage) {\r\n          key = pref.script_prefix + '.catalog.filter.' + pref.catalog_board_list_obj[pref.catalog_board_list_sel][0].key;\r\n          var obj = JSON.parse(localStorage.getItem(key));\r\n          obj.bookmark_list_str = pref.catalog.filter.bookmark_list_str;\r\n          localStorage.setItem(key,JSON.stringify(obj));\r\n        }\r\n      }\r\n    },\r\n    perf_out: function(obj){\r\n      obj.push(performance.now());\r\n      var str = '';\r\n      var last_ts = null;\r\n      for (var i=0;i<obj.length;i++) {\r\n        if (typeof(obj[i])==='number') {\r\n          if (last_ts) str += (obj[i]-last_ts) + ', ';\r\n          last_ts = obj[i];\r\n        } else str += obj[i] + ', ';\r\n      }\r\n      console.log(str);\r\n    },\r\n    debug_show_proto_func_pool: null,\r\n    debug_show_proto: function(name,obj,ex_keys,search_key) {\r\n      if (!search_key) search_key='proto';\r\n      if (!ex_keys) ex_keys = ['proto'];\r\n      var str = name + ':';\r\n      var keys = Object.keys(obj);\r\n      for (var i=0;i<keys.length;i++) if (ex_keys.indexOf(keys[i])==-1) {\r\n        str += keys[i] + ',';\r\n        ex_keys.push(keys[i]);\r\n        if (this.debug_show_proto_func_pool) this.debug_show_proto_func_pool[keys[i]] = obj[keys[i]];\r\n      }\r\n//      if (obj.hasOwnProperty(search_key)) str += '/' + this.debug_show_proto(obj[search_key], obj.__proto__, ex_keys, search_key); // for 'proto'\r\n      if (obj.hasOwnProperty(search_key)) str += '/' + this.debug_show_proto(obj.__proto__[search_key], obj.__proto__, ex_keys, search_key); // for 'debug____proto'\r\n      return str;\r\n    },\r\n    debug_parse_funcs_entry: function(str, str2) {\r\n      var expand = (!str2)? pref.debug_mode.pfunc_expand : pref.debug_mode.pfunc_comp_expand_same || pref.debug_mode.pfunc_comp_expand_diff;\r\n      if (expand) this.debug_show_proto_func_pool = {};\r\n      console.log(this.debug_parse_funcs(str));\r\n      if (str2) {\r\n        var pool_0 = this.debug_show_proto_func_pool;\r\n        this.debug_show_proto_func_pool = {};\r\n        if (pref.debug_mode.pfunc_comp_proto) {\r\n          var dp = str2.split(':');\r\n          var start_point = site2[dp[0]].parse_funcs[dp[1]];\r\n          var proto_org = start_point.__proto__;\r\n          dp = pref.debug_mode.pfunc_comp_proto.split(':');\r\n          dp = site2[dp[0]].parse_funcs[dp[1]];\r\n          if (dp) start_point.__proto__ = dp;\r\n        }\r\n        console.log(this.debug_parse_funcs(str2));\r\n        var pool_1 = this.debug_show_proto_func_pool;\r\n      }\r\n      if (this.debug_show_proto_func_pool)\r\n        if (!str2) for (var i in this.debug_show_proto_func_pool) console.log(i+': '+this.debug_show_proto_func_pool[i]);\r\n      else {\r\n        for (var i in pool_1) {\r\n          var same = pool_0[i] === pool_1[i];\r\n          if (pref.debug_mode.pfunc_comp_expand_same && same || pref.debug_mode.pfunc_comp_expand_diff && !same) {\r\n            console.log(i+': '+ (same? 'same':'differ') + ': '+ pool_0[i]);\r\n            if (!same) console.log(i+': '+ (same? 'same':'differ') + ': '+ pool_1[i]);\r\n          }\r\n          delete pool_0[i];\r\n        }\r\n        for (var i in pool_0) console.log(i+': only_in_original: '+ pool_0[i]);\r\n      }\r\n      this.debug_show_proto_func_pool = null;\r\n      if (proto_org) start_point.__proto__ = proto_org;\r\n    },\r\n    debug_parse_funcs: function(str) {\r\n      for (var i in site2) for (var j in site2[i].parse_funcs) if (site2[i].hasOwnProperty('parse_funcs') && site2[i].parse_funcs.hasOwnProperty(j)) site2[i].parse_funcs[j]['debug____proto'] = i+'.'+j;\r\n      var str2 = str.split(':');\r\n      var start_point = site2[str2[0]].parse_funcs[str2[1]];\r\n      return str+'::'+ ((start_point)? this.debug_show_proto('/'+start_point['debug____proto'],start_point, ['debug____proto','proto'], 'debug____proto') :\r\n                                      'NONE');\r\n    },\r\n    debug_parse_funcs_parse: function(domain, src_type, str, force) {\r\n      var src_types = [src_type+'_template', src_type];\r\n      for (var s=0;s<2;s++) {\r\n        var strs = this.debug_parse_funcs(domain+':'+src_types[s]).split(',');\r\n        for (var i=0;i<strs.length;i++) {\r\n          var idx_s = strs[i].lastIndexOf(':');\r\n          if (strs[i].substr(idx_s+1)===str) {\r\n            strs.splice(i+1,strs.length-i-1);\r\n            var hier_str = strs[(i>0)?i-1:i].replace(/[^\\/]*\\//g,'').replace(/:[^:]*$/,'').replace(/\\./,':');\r\n            var root_str = strs[0].replace(/::.*/,'');\r\n            if (hier_str!==root_str) strs[strs.length] = ' (==='+hier_str+')';\r\n            return [strs, hier_str, src_types[s]];\r\n          }\r\n          if (idx_s===-1) strs.splice(i--,1);\r\n          else strs[i]=strs[i].substr(0,idx_s+1);\r\n        }\r\n      }\r\n      return [strs, hier_str, src_types[s]];\r\n    },\r\n    debug_parse_funcs_all: function(str) {\r\n      var domains = ['DEFAULT','4chan','vichan','lain','8chan','KC','meguca','meguca1','meguca2','dist'];\r\n      var types = ['','_json','_html']; // ,'_json_template','_html_template']; // '' for common\r\n      var srcs = ['common','post','thread','page','catalog'];\r\n      var objs = {};\r\n      for (var d=0;d<domains.length;d++)\r\n        for (var t=0;t<types.length;t++) {\r\n          if (domains[d]==='KC' && types[t]==='_json') continue;\r\n          for (var s=0;s<srcs.length;s++) {\r\n            if (domains[d]!=='DEFAULT' && srcs[s]==='common' || !site2[domains[d]]) continue; // !site2[domains[d]] is a patch for 'dist'\r\n            var src_type = srcs[s]+types[t];\r\n            if (site2[domains[d]].parse_funcs[src_type]) {\r\n              var result = this.debug_parse_funcs_parse(domains[d], src_type, str);\r\n              var strs = result[0];\r\n              var hier_str = result[1];\r\n              src_type = result[2];\r\n//            try {\r\n              var obj_root = site2[domains[d]].parse_funcs[src_type];\r\n              if (obj_root) {\r\n                var obj = obj_root[str];\r\n                var flag = true;\r\n                for (var i in objs) if (objs[i][0]===obj) {strs[strs.length] = ' (==='+i+')'; flag=false; objs[i][1]++; break;}\r\n  //              if (flag) objs[domains[d]+':'+src_type] = obj;\r\n                if (flag) objs[hier_str] = [obj,1];\r\n                if ((typeof(obj)==='string' || typeof(obj)==='number')) strs[str.length] = ', '+obj;\r\n              }\r\n//            } catch(e){\r\n//              if (src_type.indexOf('_template')==-1) throw e; // templates don't have parse_funcs and cause excaption.\r\n//            }\r\n              console.log(strs.join(''));\r\n            }\r\n          }\r\n        }\r\n      var num = 0;\r\n      if (pref.debug_mode.pfunc_all_expand) for (var i in objs) console.log((num++)+'('+objs[i][1]+'): '+ i +': '+objs[i][0]);\r\n    },\r\n    debug_site2func: function(name) {\r\n      for (var i in site2) if(site2[i].hasOwnProperty(name)) site2[i]['debug____'+name] = i;\r\n      var str = '';\r\n      var funcs = {};\r\n      for (var i in site2) {\r\n        str += i+': '+site2[i]['debug____'+name]+', ';\r\n        funcs[site2[i]['debug____'+name]] = site2[i][name];\r\n      }\r\n      console.log(str);\r\n      if (pref.debug_mode.site2func_expand) for (var i in funcs) console.log(i+': '+funcs[i]);\r\n    },\r\n//    obj_scopy_from_key: function(obj){\r\n//      for (var i in obj)\r\n//        if (typeof(i)==='string' && Object.prototype.hasOwnProperty.call(obj,obj[i])) obj[i] = obj[obj[i]];\r\n//      return obj;\r\n//    },\r\n//    set_value_to_root: function(leaf,key,val){ // working code.\r\n//      if (Object.prototype.hasOwnProperty.call(leaf,key)) leaf[key] = val;\r\n//      else this.set_value_to_root(Object.getPrototypeOf(leaf),key,val);\r\n//    },\r\n//    init_set_style: function(dom,src){\r\n//      dom.style = {};\r\n//      if (src) for (var i in src) dom.style[i] = src[i];\r\n//      if (src===null) {\r\n//        src = dom.getAttribute('style');\r\n//        if (src) {\r\n//          src = pref_func.style2obj(src);\r\n//          for (var i in src) dom.style[i] = null;\r\n//        }\r\n//      }\r\n//    },\r\n    shallow_copy_1: function(src){\r\n      var dst = Object.create(null);  \r\n      for (var i in src) if (src.hasOwnProperty(i)) dst[i] = src[i];\r\n      return dst;\r\n    },\r\n    deep_copy: function(dst,src){\r\n      for (var i in src)\r\n        if (src.hasOwnProperty(i))\r\n          if (Array.isArray(src[i])) dst[i] = src[i].slice();\r\n          else if (typeof(src[i])==='object') dst[i] = this.deep_copy({},src[i]);\r\n          else dst[i] = src[i];\r\n      return dst\r\n    },\r\n    image_resize : function(pn,w,h) {\r\n      var nw = pn.naturalWidth;\r\n      var nh = pn.naturalHeight;\r\n      var fw = (nw>w)? nw/w : 1;\r\n      var fh = (nh>h)? nh/h : 1;\r\n//      if (fh>1 || fw>1) {\r\n        pn.setAttribute('width', (fw>=fh)? w : nw/fh);\r\n        pn.setAttribute('height',(fh>=fw)? h : nh/fw);\r\n//      }\r\n////      var f  = (fw>fh)? fw : fh;\r\n////      pn.setAttribute('width',  nw/f);\r\n////      pn.setAttribute('height', nh/f);\r\n    },\r\n    kwd_prep_regexp: function(kwd, exact) {\r\n      if (!kwd.str) return null;\r\n      var kwds = (kwd.sentence)? [kwd.str] : kwd.str.split(' ');\r\n      for (var i=kwds.length-1;i>=0;i--) {\r\n        if (kwds[i]==='') kwds.splice(i,1);\r\n        else {\r\n          if (!kwd.re) {\r\n            kwds[i] = kwds[i].replace(/[\\.\\(\\)\\[\\]\\+\\^\\$\\{\\}]/g,'\\\\$&').replace(/\\*/g,'.*').replace(/\\?/g,'.'); // should be consolidated with str2rstr\r\n            if (exact) kwds[i] = '^' + kwds[i] + '$';\r\n          }\r\n          try {\r\n            kwds[i] = new RegExp(kwds[i],(kwd.ci)? 'i' : '');\r\n          } catch(e) {\r\n            kwds.splice(i,1); // user input causes errors usually, ex. trailing \\ in incremental search.\r\n          }\r\n        }\r\n      }\r\n      return (kwds.length===0)? null : kwds;\r\n    },\r\n    escape:(function(){\r\n      var entities = {\r\n        '<': '&lt;',\r\n        '>': '&gt;',\r\n        '&': '&amp;',\r\n        '\"': '&quot;',\r\n        '\\'':'&#039;', // '&apos;'\r\n      };\r\n      function escape(str){\r\n        return entities[str];\r\n      }\r\n      return function(txt){\r\n        return txt.replace(/[<>\"'&]/g,escape);\r\n      }\r\n    })(),\r\n    escape_text: function(txt){ // http://d.hatena.ne.jp/ockeghem/20070510/1178813849\r\n      return txt.replace(/&/g,'&amp;').replace(/</g,'&lt;');\r\n    },\r\n    arraybuffer2blob: (function(){\r\n      var mime_types = {jpg:'image/jpeg', jpeg:'image/jpeg', gif:'image/gif', png:'image/png', pdf:'application/pdf',\r\n                        svg:'image/svg+xml', svgz:'image/svg+xml', \r\n                        htm:'text/html', html:'text/html', txt:'text/plain',\r\n                        webm:'video/webm', mpg:'video/mpeg', mpeg:'video/mpeg', mp4:'video/mp4', ogv:'video/ogg',\r\n                        mp3:'audio/mp3', \r\n                        gz:'application/x-gzip', tar:'application/x-tar', tgz:'application/x-tar', zip:'application/x-compress',\r\n                        '7z':'application/x-7z-compressed', xz:'application/x-xz',\r\n                       };\r\n      return function(filename, data){\r\n        var ext = filename.substr(filename.lastIndexOf('.')+1);\r\n        var type = mime_types[ext] || 'text/plain';\r\n        return new Blob([data], {type:type});\r\n      }\r\n    })(),\r\n  };\r\n\r\n  var common_obj = {\r\n    thread_reader: null,\r\n    events_beforeunload: [],\r\n  };\r\n  common_func.dom_addEventListener(common_obj.events_beforeunload, window, 'beforeunload', function(){common_func.dom_removeEventListener(common_obj.events_beforeunload)});\r\n  common_func.dom_addEventListener(common_obj.events_beforeunload, window, 'focus', function(){DelayBuffer.prototype.hasFocus = true;});\r\n  common_func.dom_addEventListener(common_obj.events_beforeunload, window, 'blur', function(){DelayBuffer.prototype.hasFocus = false;});\r\n\r\n  var site = { // krautchan/int/\r\n    max_page   : 20,\r\n    autosage   : 300,\r\n    board_name : '/int/',\r\n    url_prefix : 'https://krautchan.net/int/',\r\n    url_prefix2 : {},\r\n    nickname   : 'KC',\r\n    nicknames  : ['CatChan_tgt'],\r\n    thread_keyword: 'thread',\r\n    postform: null,\r\n    postform_rules: null,\r\n    get_ops    : null,\r\n    get_posts  : null,\r\n////////    make_url   : null,\r\n////////    make_url2  : function(bn,idx){\r\n////////      var nickname  = (bn.indexOf('/')==0)? site.nickname : bn.substr(0,bn.indexOf('/'));\r\n////////      var boardname = '/' + bn.replace(/[^\\/]*\\//,'').replace(/\\/.*/,'/');\r\n////////      return [nickname, boardname, idx, site2[nickname].make_url(boardname,idx)];\r\n////////    },\r\n    server_name : null, // optional for 2chan.\r\n    protocol : (document.location.href.search(/https/)!=-1)? 'https:' : 'http:',\r\n    catalog_threads_in_page : null,\r\n//    catalog_posts_in_thread : null,\r\n    remove_posts : function(src){return src;},\r\n    remove_files_info : function(src){return src;},\r\n    remove_checkboxes : function(src){return src;},\r\n////////    get_thread_link : function(src){return '_blank';},\r\n    get_time_of_last_post : function(doc){return null;},\r\n    header_height : function(){return 0;},\r\n    patch: null,\r\n    components: {},\r\n    get key(){return site.nickname + site.board + ((site.whereami==='thread')? site.no : '');}, // for dynamic change of site.whereami in meguca.\r\n    query_set_component: function(name){\r\n      var query_word = site2[site.nickname].components[name];\r\n      var comp = (typeof(query_word)==='string')? document.querySelector(query_word) :\r\n                                                  document.querySelectorAll(query_word[0])[query_word[1]];\r\n      if (comp) site.components[name] = comp;\r\n      else delete site.components[name];\r\n    },\r\n    config: function(keyword,nickname, reentry){ // url='*site/board/etc', keyword='site'\r\n      var href = window.location.href;\r\n      var url_site = href.substr(0,href.indexOf(keyword)+keyword.length);\r\n      var url_board = decodeURI(href.substr(url_site.length+1)) + '/'; // add '/' to the last for case of ending without slash.\r\n      site.board = '/' + url_board.substr(0,url_board.indexOf('/')+1);\r\n      site.url_prefix = url_site + site.board;\r\n      site.server_name  = href.substr(0,href.indexOf(keyword)-1).replace(/https*:\\/\\/*/,'');\r\n      site.nickname = nickname;\r\n      site.isthread = window.location.href.search(site2[nickname].thread_keyword)!=-1;\r\n//      for (var i in site2[nickname]) site[i] = site2[nickname][i];\r\n//      site.features = site2[site.nickname].features;\r\n      if (site.no===undefined) site.no = (site.whereami==='thread')? site2[site.nickname].get_ops(document)[0] : '';\r\n//      site.myself = site2[site.nickname].get_ops(document)[0];\r\n//      site.no = (site.whereami==='thread')? site.myself : '';\r\n      if (reentry) return;\r\n      if (!site0.isStep && site2[nickname].features) pref_func.pref_overwrite(site.features,site2[nickname].features);\r\n      for (var i in site2[site.nickname].components) site.query_set_component(i);\r\n      if (!site.settings && site.components.boardlist) site.settings = site.components.boardlist.appendChild(document.createElement('span'));\r\n//      if (site2[site.nickname].pref_default) pref_func.pref_overwrite(pref,site2[site.nickname].pref_default);\r\n      site.patch = site2[site.nickname].patch;\r\n    },\r\n    features : {page: false, graph: true, setting: true, setting2: true, postform: true, catalog: true, listener : false, uip_tracker: false, thread_reader: true, debug: false},\r\n    owners_recommendation: '',\r\n    catalog : false,\r\n    whereami: null,\r\n    embed_to: {},\r\n    root_body : document.getElementsByTagName('body')[0],\r\n//    root_body : (document.getElementsByTagName('body')[0])? document.getElementsByTagName('body')[0] :\r\n//                                                            document.getElementsByTagName('frame')[0].contentDocument.getElementsByTagName('body')[0] // KC root\r\n    embed_frame:'CatChan_embed_frame',\r\n    embed_frame_win: null,\r\n    boardlist: null,\r\n    settings: null,\r\n    __proto__: {\r\n      get myself(){\r\n        Object.defineProperty(this,'myself',{value:site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'thread_html',{thread:site.no})[0],\r\n                                             writable:true, enumerable:true, configurable:true});\r\n        return this.myself;\r\n      }\r\n    }\r\n  };\r\n  site.protocol = (document.location.href.search(/https/)!=-1)? 'https:' : 'http:'; // patch for Tampermonkey.\r\n  site.root_body2 = site.root_body;\r\n\r\n  var site2 = {};\r\n  site2['DEFAULT'] = { // skeleton for default\r\n    nickname : 'DEFAULT',\r\n    home : '', // home is used url for iframe, so it MUST BE THE SAME ORIGIN, OR LEAVE IT BLANK.\r\n    check_func: function(){ // for background iframe\r\n      if (window.location.href.indexOf(this.domain_url)!=-1) {\r\n        site.whereami = 'other';\r\n        site.config(this.domain_url,this.nickname);\r\n        return true;\r\n      } else return false;\r\n    },\r\n//    check_func: function(){return false;}, // return true if the script is running in this site.\r\n    boards_sel_from_tags : function(){return '';}, // return boards selection strings.\r\n    protocol: site.protocol,\r\n    components: {},\r\n    spoiler_text: {\r\n      spoiler: /span.spoiler$/,\r\n      open: /span.spoiler:hover/,\r\n    },\r\n    make_tack: function(){\r\n      var tack = document.createElement('i');\r\n      tack.setAttribute('class','fa fa-thumb-tack');\r\n      return tack;\r\n    },\r\n    make_showAlways: function(){\r\n      var icon = document.createElement('i');\r\n      icon.setAttribute('class','fa');\r\n      icon.textContent = '\\u2605';\r\n      return icon;\r\n    },\r\n    set_icon : function(pn,type,kind,tgt_th16, set){\r\n      if (pn) {\r\n        var icon = tgt_th16['icon_'+kind] || kind=='sticky' && this.get_icon(pn,type,kind,tgt_th16);\r\n        if (set && icon) { // for initial\r\n          if (tgt_th16.systemSticky) icon.style.opacity = null;\r\n          return icon;\r\n        }\r\n        if (!icon) return this.add_icon(pn,type,kind,tgt_th16);\r\n        else {\r\n          if (kind=='sticky' && tgt_th16.systemSticky) icon.style.opacity = '0.4';\r\n          else icon.parentNode.removeChild(icon);\r\n        }\r\n      }\r\n      return null;\r\n    },\r\n    postform:(function(){\r\n      function onoff(ref){\r\n//        if (this.tack && ref) ref.parentNode.insertBefore(this.tack, ref);\r\n        if (this.tack) this.tack.style.display = (this.tack.style.display==='none')? '' : 'none';\r\n      }\r\n      return {\r\n        tack: null,\r\n        init:function(){\r\n          if (site.postform) {\r\n            this.tack = site2[site.nickname].make_tack();\r\n            this.tack.setAttribute('style','float:right;font-size:2em');\r\n            site.postform.parentNode.insertBefore(this.tack,site.postform);\r\n          }\r\n          return this.tack;\r\n        },\r\n        on: onoff,\r\n        off:onoff,\r\n      };\r\n    })(),\r\n    postform_prep: function(){ // the same as vichan.\r\n      site.components.postform_submit2 = null;\r\n      site.components.postform_submit2_observer = new MutationObserver(this.postform_submit2_find);\r\n      site.components.postform_submit2_observer.observe(document.getElementsByTagName('body')[0], {childList: true});\r\n    },\r\n    postform_submit2_find: function(){\r\n      var state_old = site.components.postform_submit2;\r\n      site.query_set_component('postform_submit2');\r\n      site.query_set_component('postform_comment2');\r\n      if (common_obj.thread_reader) common_obj.thread_reader.setup_submit2();\r\n      if (pref.features.recovery) recovery.setup2();\r\n    },\r\n    general_event_handler:(function(){\r\n//      function func_false(){return false;}\r\n      var obj = {\r\n        common: {\r\n          subscribe: function(catalog_root){\r\n            if (this.mouseover) catalog_root.addEventListener('mouseover',this.mouseover,false);\r\n          },\r\n          unsubscribe: function(catalog_root){\r\n            if (this.mouseover) catalog_root.removeEventListener('mouseover',this.mouseover,false);\r\n          },\r\n          get_mark: function(pn, clientY){\r\n            return this.get_mark_from_height(clientY, document.getElementByTagName('div'));\r\n          },\r\n          get_mark_from_height: function(now_height, pns){\r\n            var len = pns.length;\r\n            var step = len >> 1;\r\n            var i = 0;\r\n            while (step>0) {\r\n              if (pns[i+step].offsetTop<now_height) i += step;\r\n              step >>= 1;\r\n            }\r\n            while (i+1<len && pns[i+1].offsetTop<now_height) i++;\r\n            return pns[i];\r\n          },\r\n          isThumbnail: function(e){\r\n            var et = e.target;\r\n            return et.tagName==='IMG' && et.parentNode && et.parentNode.tagName==='A'; // et.parentNode for shrink_thumbnails, expanded image was removed already.\r\n          },\r\n          recSearch_thread: function(tgt,ecT){\r\n            while (tgt && tgt!=ecT) {\r\n              if (tgt.classList && tgt.classList.contains('thread')) return tgt;\r\n              else tgt = tgt.parentNode;\r\n            }\r\n            return null;\r\n          },\r\n\r\n          getID: function(pn){},\r\n          getCountry: function(pn){},\r\n          getTrip: function(pn){},\r\n          getName: function(pn){return pn.classList.contains('name') && pn.textContent || undefined;},\r\n          an2srcNo: function(pn, th){\r\n            while (pn) {\r\n              if (pn.classList && pn.classList.contains('post')) return site2[th.domain_html].parse_funcs['post_html'].no({pn:pn});\r\n              if (gGEH.pns_all_keys.get(pn)) return site2[th.domain_html].parse_funcs['catalog_html'].no({pn:pn});\r\n              pn = pn.parentNode;\r\n            }\r\n          }\r\n        },\r\n      };\r\n      obj.thread = Object.create(obj.common);\r\n      obj.page = Object.create(obj.common);\r\n      obj.catalog = Object.create(obj.common);\r\n      return obj;\r\n    })(),\r\n//    catalog_background : '#b5ccf9',\r\n//    catalog_bordercolor : '#000000',\r\n    horizontal_separator_in_index: function(){\r\n//      var pn = document.createElement('div');\r\n//      pn.innerHTML = '<br><br class=\"clear\"><hr>';\r\n      var pn = document.createElement('hr');\r\n      pn.setAttribute('class', pref.script_prefix+'_hs');\r\n      return pn;\r\n    },\r\n//    get_next_image: function(img,name){return null;}, // return next image for prefetch3\r\n    get_next_image: function(img,top, imgs){\r\n      if (!imgs) imgs = cataLog.parent.getElementsByTagName('img');\r\n      var idx = Array.prototype.indexOf.call(imgs,img);\r\n      if (top) while (imgs[idx+1] && imgs[idx+1].offsetTop<top) idx++;\r\n      return (idx>=0)? imgs[idx+1] : null;\r\n    },\r\n//    get_time_of_posts : function(thread){return [0,0];}, // returns parsed UTC time of last and op posts from element of the thread.\r\n//    get_time_of_post_in_utc : function(post){return 0;}, // returns parsed UTC time of posts.\r\n////////    get_thread_link : function(thread){return null;}, // returns href from element of the thread. THIS SHOULD BE MERGED WITH modify_thread_link.\r\n    catalog_threads_in_page : function(doc){return [];}, // returns array of thread elements in the page from the document.\r\n    remove_posts : function(thread,end){}, // removes posts from the thread with a certain remains.\r\n    remove_files_info : function(thread){return thread;}, // removes file information from the thread, and returns itself.\r\n//    remove_checkboxes : function(thread){return thread;}, // removes checkboxes from the thread, and returns itself.\r\n    postform_rules : null,\r\n    thread_keyword : 'thread', // thread keyword in URL.\r\n    max_page : function(board){return 10;}, // returns max_page\r\n//    max_page : 10, // maximum page number.\r\n//    make_url : function(board,no,key){return ['_blank','raw'];}, // returns URL and type from board name and page number.\r\n//    make_url3: function(board,th){return '_blank';}, // returns URL from board name and thread number.\r\n//    make_url4: function(dbt){return '_blank';}, // returns URL from dbt.\r\n////////////    enumerate_boards_to_scan:function(){ // 4chan // working code.\r\n////////////      var obj = [];\r\n////////////      var end = (site3[site.nickname].boards.length > pref.scan.max)? pref.scan.max : site3[site.nickname].boards.length;\r\n////////////      for (var i=0;i<end;i++) obj[obj.length] = '/'+site3[site.nickname].boards[i].board+'/';\r\n////////////      return obj;\r\n////////////    },\r\n////////    enumerate_boards_to_scan:function(){ // working code.(2016.01.09)\r\n////////      var obj = [];\r\n////////      var end = (site3[site.nickname].boards.length > pref.scan.max)? pref.scan.max : site3[site.nickname].boards.length;\r\n////////      for (var i=0;i<end;i++) obj[obj.length] = site3[site.nickname].boards[i];\r\n////////      return obj;\r\n////////    },\r\n    generate_boards_json: function(src, page_def){\r\n      var proto = {pages:page_def};\r\n      var arr = [];\r\n      for (var i=0;i<src.length;i++)\r\n        arr[arr.length] = (Array.isArray(src[i]))? {board:src[i][0], pages:src[i][1], __proto__:proto}\r\n                                                 : {board:src[i],                     __proto__:proto};\r\n      return {boards:arr};\r\n    },\r\n    url_boards_json: function(){return '';}, // returns url of boards.json.\r\n    get_boards_json: function(key,callback,callback_always,  dummy_indicator){\r\n      var key = 'boards_json_'+this.nickname;\r\n      if (this.boards_json) this.get_boards_json_callback(this.nickname,{status:200, response:this.boards_json},[callback,callback_always]);\r\n      else httpd.req({initiator:key,\r\n                      INDICATOR: dummy_indicator? {shift:function(){}, report:function(){}} : null, IDX:0, FINISHED:0, SUC:0, max:1, // patch for 8chan, see tag.generate_caller\r\n                      tgts:[{domain:this.nickname, url:this.url_boards_json()[0], responseType:'json', data_type:'json'}],\r\n                      callback_1:function(req,val){this.get_boards_json_callback(key,val,[callback,callback_always,true])}.bind(this)},6);\r\n    },\r\n    get_boards_json_callback: function(key,value,args){\r\n      if (value.status==200) {\r\n        this.postprocess_board(value.response);\r\n        if (!site3[this.nickname].boards) {liveTag.update_pn_buf.cancel();liveTag.update_pn_buf.do_tgt();}\r\n        site3[this.nickname].boards = true;\r\n      }\r\n      if (args[0] && (args[1] || value.status===200))\r\n        if (args[2]) args[0]();\r\n        else setTimeout(args[0],0);\r\n    },\r\n////    get_boards_json_indicator: null, // working code.\r\n////    get_boards_json: function(key,callback,callback_always,health_indicator){\r\n////      var key = 'boards_json_'+this.nickname;\r\n////      if (this.get_boards_json_indicator) {\r\n////        this.get_boards_json_indicator.report({end:Date.now(), prog_str:'Aborted.', err_str:'Aborted by next request.'});\r\n////        this.get_boards_json_indicator = null;\r\n////      }\r\n////      if (this.boards_json) this.get_boards_json_callback(this.nickname,{status:200, response:this.boards_json},[callback,callback_always]);\r\n////      else {\r\n////        var indicator;\r\n////        if (health_indicator) { // patch\r\n////          indicator = health_indicator.shift('limegreen','b',key);\r\n////          indicator.report({start:Date.now(), prog_str:'Loading boards\\' information'});\r\n////          this.get_boards_json_indicator = indicator;\r\n////        }\r\n////        http_req.get(key,this.nickname+',dummy,dummy',this.url_boards_json(),this.get_boards_json_callback.bind(this),0,true,[callback,callback_always,indicator,key]);\r\n////      }\r\n////    },\r\n////    get_boards_json_callback: function(key,value,args){\r\n////      if (value.status==200) {\r\n////        this.postprocess_board(value.response);\r\n////        if (!site3[this.nickname].boards) liveTag.update_pn_buf.do_tgt();\r\n////        site3[this.nickname].boards = true;\r\n////      }\r\n////      if (args[2]) {\r\n////        args[2].report({end:Date.now(), prog_str: (value.status==200)? 'boards.json is loaded.' : '',\r\n////                        err_str:  (value.status==200)? '' : 'Error at loading board\\'s infomation.'});\r\n////        this.get_boards_json_indicator = null;\r\n////      }\r\n////      if (args[3]) http_req.close(args[3]);\r\n////      if (args[0] && (args[1] || value.status===200))\r\n////        if (args[2]) args[0]();\r\n////        else setTimeout(args[0],0);\r\n////    },\r\n    postprocess_board: function(val){ // for 4chan and all \r\n      for (var i=0;i<val.boards.length;i++) {\r\n        var bd = liveTag.mems.init({domain:this.nickname, board:'/'+val.boards[i].board+'/'});\r\n        bd.o = i;\r\n        if (val.boards[i].pages && !bd.pgs) bd.pgs = val.boards[i].pages;\r\n        if (val.boards[i].tags && val.boards[i].tags.length!=0) liveTag.postprocess_board_add_btag(val.boards[i].tags,bd);\r\n      }\r\n    },\r\n////////    postprocess_board: function(val){ // 4chan // working code.\r\n////////      site3[this.nickname].boards = [];\r\n////////      for (var i=0;i<val.boards.length;i++) {\r\n////////        var bd = liveTag.mems.init({domain:this.nickname, board:'/'+val.boards[i].board+'/'});\r\n////////        site3[this.nickname].boards.push(bd); // BUG. increase length forever.\r\n//////////        Object.defineProperty(bd,'bump_limit',{value:val.boards.bump_limit});\r\n////////      }\r\n////////    },\r\n\r\n////    show_boardlist_replaced: false, // working code.\r\n////    show_boardlist_physical_board: function(tags,func_onclick){\r\n////      var as = site.components.boardlist.getElementsByTagName('a');\r\n////      if (pref.virtualBoard.p_board==='replace') {\r\n////        for (var i=pn.childNodes.length-2;i>=0;i-=2) { // skip every delimiter // working code.\r\n//////          var key = pn.childNodes[i].textContent.substr(1); // working code.\r\n//////          for (var j=0;j<as.length;j++) {\r\n//////            if (as[j].textContent===key) {\r\n//////              if (!as[j].style) as[j].style = {};\r\n//////              if (as[j].style.display!=='none') {\r\n//////                as[j].style.display='none';\r\n//////                pn.childNodes[i].tagName = 'a'; // can't change by specification.\r\n//////                pn.childNodes[i].setAttribute('href',as[j].getAttribute('href'));\r\n//////                as[j].parentNode.insertBefore(pn.childNodes[i],as[j]);\r\n//////              } else pn.removeChild(pn.childNodes[i]); // remove '#XXX'(tag)\r\n//////              pn.removeChild(pn.childNodes[i]); // remove '/'(delimiter)\r\n//////            }\r\n//////          }\r\n////          var key = pn.childNodes[i].textContent;\r\n////          for (var j=0;j<as.length;j++) {\r\n////            if (as[j].textContent===key || as[j].textContent===key.substr(1)) {\r\n////              if (!as[j].classList.contains(pref.script_prefix+'_tag')) {\r\n////                var tmp_node = liveTag.update_tag_string([pn.childNodes[i].textContent], '', pn.childNodes[i].onclick, 'a').childNodes[0];\r\n////                tmp_node.setAttribute('href',as[j].getAttribute('href'));\r\n////                as[j].parentNode.insertBefore(tmp_node,as[j]);\r\n////                as[j].parentNode.removeChild(tmp_node.nextSibling);\r\n////              } else pn.removeChild(pn.childNodes[i]); // remove '#XXX'(tag)\r\n////              pn.removeChild(pn.childNodes[i]); // remove '/'(delimiter)\r\n////            }\r\n////          }\r\n////        }\r\n////        this.boardlist_replaced = true;\r\n////      } else if (this.boardlist_replaced) {\r\n////        for (var i=0;i<as.length;i++) {\r\n////          if (as[i].style && as[i].style.display==='none') {\r\n////            as[i].style.display='';\r\n////            as[i].parentNode.removeChild(as[i].previousSibling);\r\n////          }\r\n////        }\r\n////        this.boardlist_replaced = false;\r\n////      }\r\n////    },\r\n    boardlist_boards: Object.create(null,{sel:{value:null, writable:true}}),\r\n    show_boardlist_physical_board: function(tags,func_onclick){ // tuned for 8chan\r\n      var tgts = this.boardlist_boards;\r\n      if ((tgts.sel===true  && pref.virtualBoard.p_board==='replace') ||\r\n          (tgts.sel===false && pref.virtualBoard.p_board==='both')) {\r\n        var src = (tgts.sel)? 'v' : 'p';\r\n        var dst = (tgts.sel)? 'p' : 'v';\r\n        for (var i in tgts) {\r\n          var tgt = tgts[i];\r\n          if (tgt[src] && tgt[dst]) {\r\n            tgt[dst].parentNode.insertBefore(tgt[src],tgt[dst]);\r\n            tgt[dst].parentNode.removeChild(tgt[dst]);\r\n          }\r\n        }\r\n        tgts.sel = !tgts.sel;\r\n      }\r\n      if (this.boardlist_boards.sel===null && pref.virtualBoard.p_board==='replace') {\r\n        var as = site.components.boardlist.getElementsByTagName('a');\r\n        for (var i=0;i<as.length;i++) {\r\n          var key = as[i].textContent;\r\n          if (this.show_boardlist_physical_extract_func) key = this.show_boardlist_physical_extract_func(key);\r\n          if (key[0]!=='#') this.boardlist_boards['#'+ ((pref.liveTag.ci)? key.toLowerCase() : key)] = {p:as[i]};\r\n        }\r\n        this.boardlist_boards.sel = false;\r\n      }\r\n      if (pref.virtualBoard.p_board==='replace') {\r\n        var boardlist_hit = {};\r\n        for (var i=tags.length-1;i>=0;i--) {\r\n          var key = (pref.liveTag.ci)? tags[i].toLowerCase() : tags[i];\r\n          var tgt = this.boardlist_boards[key];\r\n          if (tgt) {\r\n            if (!tgt.v) {\r\n              var p = tgt.p;\r\n              var v = liveTag.create_tag_node_1(key, func_onclick, 'a');\r\n              v.setAttribute('href',p.getAttribute('href'));\r\n              p.parentNode.insertBefore(v,p);\r\n              p.parentNode.removeChild(p);\r\n              tgt.v = v;\r\n            }\r\n            tags.splice(i,1);\r\n            boardlist_hit[key] = null;\r\n          }\r\n        }\r\n        if (pref.virtualBoard.v_remove) {\r\n          for (var i in this.boardlist_boards)\r\n            if (this.boardlist_boards[i].v && boardlist_hit[i]===undefined) {\r\n              var p = this.boardlist_boards[i].p;\r\n              var v = this.boardlist_boards[i].v;\r\n              v.parentNode.insertBefore(p,v);\r\n              v.parentNode.removeChild(v);\r\n              delete this.boardlist_boards[i].v;\r\n            }\r\n        }\r\n      }\r\n      return tags;\r\n    },\r\n    boardlist_tags: null,\r\n    boardlist_tags_pn: null,\r\n    show_boardlist: function(tags,func_onclick){\r\n//      for (var i=0;i<site.boardlist.length;i++) {\r\n//        if (site.boardlist[i].lastChild.className===pref.script_prefix+'_tag') site.boardlist[i].removeChild(site.boardlist[i].lastChild);\r\n//        site.boardlist[i].appendChild(pn); // can't clone events.\r\n//      }\r\n      var sbl = site.components.boardlist;\r\n      var tags_bl = this.show_boardlist_physical_board(tags.slice(),func_onclick);\r\n      if (pref.virtualBoard.show && tags_bl.length!==0) {\r\n        var pn = (pref.test_mode['118'])? liveTag.create_tag_nodes(tags_bl, ' / ', func_onclick)\r\n                                        : liveTag.update_tag_nodes(tags_bl, ' / ', func_onclick, this.boardlist_tags_pn, this.boardlist_tags);\r\n        if (!this.boardlist_tags_pn) {\r\n          var ppn = document.createElement('span');\r\n          ppn.appendChild(document.createTextNode('[ '));\r\n          ppn.appendChild(pn);\r\n          ppn.appendChild(document.createTextNode(' ]'));\r\n          sbl.appendChild(ppn);\r\n        } else if (pref.test_mode['118']) this.boardlist_tags_pn.parentNode.replaceChild(pn, this.boardlist_tags_pn);\r\n        this.boardlist_tags_pn = pn;\r\n        this.boardlist_tags = tags_bl;\r\n      } else if (this.boardlist_tags_pn) {\r\n        sbl.removeChild(this.boardlist_tags_pn.parentNode);\r\n        this.boardlist_tags_pn = null;\r\n        this.boardlist_tags = null;\r\n      }\r\n\r\n//      this.boardlist_tags = this.show_boardlist_physical_board(tags.slice(),func_onclick);\r\n//      if (this.boardlist_tags_pn) {\r\n//        sbl.removeChild(this.boardlist_tags_pn);\r\n//        this.boardlist_tags_pn = null;\r\n//      }\r\n////      if (sbl.lastChild.getAttribute && sbl.lastChild.getAttribute('name')===pref.script_prefix+'_tag_parent') sbl.removeChild(sbl.lastChild);\r\n//      if (pref.virtualBoard.show && this.boardlist_tags.length!==0) {\r\n//        var pn = liveTag.create_tag_nodes(this.boardlist_tags, ' / ', func_onclick);\r\n//        pn.insertBefore(document.createTextNode('[ '),pn.firstChild); // referred from query_tag_node\r\n//        pn.appendChild(document.createTextNode(' ]'));\r\n//        this.boardlist_tags_pn = sbl.appendChild(pn);\r\n//      }\r\n    },\r\n    query_tag_node: function(tag){\r\n      var bd_bl = this.boardlist_boards[tag];\r\n      if (bd_bl) return bd_bl.v;\r\n      else if (this.boardlist_tags_pn) {\r\n        var idx = this.boardlist_tags.indexOf(tag);\r\n        if (idx>=0) return this.boardlist_tags_pn.childNodes[idx*2]; // [idx*2+1];\r\n      }\r\n    },\r\n    get_ops : function(doc){return [];}, // returns array of op numbers from the document.\r\n    get_posts : function(doc) {return [];}, // returns array of posts numbers from the document.\r\n//    absolute_link : function(doc){}, // change link from relative to absolute which includes site URL.\r\n    absolute_link : function(pn){\r\n      var prefix = this.protocol + '//' + this.domain_url;\r\n      var tgts = ['src','href'];\r\n      var all = pn.getElementsByTagName('*'); //'*[src],*[href]'\r\n      for (var i=0;i<all.length;i++) {\r\n        for (var j=0;j<tgts.length;j++) {\r\n          var tgt = all[i].getAttribute(tgts[j]);\r\n          if (tgt && tgt.indexOf('http')!=0 && tgt.indexOf('mailto:')!=0 && tgt.indexOf('blob')!=0 && tgt.substr(0,2)!='//')\r\n            all[i].setAttribute(tgts[j], prefix + tgt);\r\n//            all[i].setAttribute(tgts[j],site2[doc.domain].protocol + '//' + site2[doc.domain].domain_url + tgt); // working code.\r\n        }\r\n      }\r\n    },\r\n    absolute_link_1: function(href){return site2[this.nickname].protocol + '//' + site2[this.nickname].domain_url + href;},\r\n    link_dbtp2href_abs: function(dbtp, quote){\r\n      var d = dbtp[0];\r\n      return (d!=site.nickname? site2[d].protocol + '//' + site2[d].domain_url : '') + site2[d].link_dbtp2href(dbtp, quote);\r\n    },\r\n////////    insert_footer : function(thread,page_no,boardname,insert,date,nof_posts,nof_files){return [nof_posts,nof_files];}, // insert information footer, and returns count of posts and images.\r\n\r\n////////    insert_footer2: function(thread,type,nums,nums2){}, // insert num of new replies to me, num of new replies.\r\n//    prep_footer3 : function(){return null;}, // prepare footer\r\n//    insert_footer3: function(thread,nums,nums2){}, // insert footer.\r\n\r\n//    prep_own_posts: function(){}, // prepare own_post object.\r\n//    prep_own_posts_event: function(e){}, // event entry for preparing own_post object.\r\n    ls_key_own_posts: pref.script_prefix + '.own_posts.',\r\n    prep_own_posts_event : function(e){\r\n      if (e) site2[site.nickname].prep_own_posts_1(e.key); // gives 'this' value to 'prep_own_posts_1'. MUST BE site2[site.nickname].\r\n      if (window.name===site.nickname) send_message('parent',['OWN_POSTS', window.name, site3[window.name].own_posts]);\r\n    },\r\n    prep_own_posts : function(bt){\r\n      site3[this.nickname].own_posts = {};\r\n      if (localStorage) {\r\n        var keys = (bt)? [this.ls_key_own_posts + bt] : Object.keys(localStorage);\r\n        for (var i=0;i<keys.length;i++) this.prep_own_posts_1(keys[i]);\r\n      }\r\n//console.log(site3[this.nickname].own_posts);\r\n    },\r\n    prep_own_posts_1 : function(key){\r\n      if (key.indexOf(this.ls_key_own_posts)==0) {\r\n        var bt = key.substr(this.ls_key_own_posts.length);\r\n        var board = bt.substr(0,bt.lastIndexOf('/')+1);\r\n        if (!site3[this.nickname].own_posts[board]) site3[this.nickname].own_posts[board] = {};\r\n        var nos = JSON.parse(localStorage[key] || '[]');\r\n        for (var j=0;j<nos.length;j++) site3[this.nickname].own_posts[board][nos[j]] = null;\r\n      }\r\n    },\r\n//    clean_up_own_posts : function(ths,board){ // working code.\r\n////console.log('clean up');\r\n//      if (localStorage) {\r\n//        var nos = {};\r\n//        for (var i=0;i<ths.length;i++) nos[ths[i].key.substr(ths[i].key.lastIndexOf('/')+1)] = null;\r\n//        var own_key_bd = this.ls_key_own_posts + board;\r\n//        var keys = Object.keys(localStorage);\r\n//        for (var i=0;i<keys.length;i++)\r\n//          if (keys[i].indexOf(own_key_bd)==0 && nos[keys[i].substr(own_key_bd.length)]!==null) delete localStorage[keys[i]]\r\n//      }\r\n////console.log(site3[this.nickname].own_posts);\r\n//    },\r\n    clean_up_LS: function(domain, board, nos){\r\n      if (domain!==site.nickname) return; // PATCH.\r\n      if (localStorage) {\r\n        if (pref.thread_reader.own_posts_tracker && pref.thread_reader.clean_up_own_posts) this.clean_up_LS_th(this.ls_key_own_posts, board, nos);\r\n        if (pref[cataLog.embed_mode].deleted_posts.auto_clean) this.clean_up_LS_th(this.ls_key_deletedPosts, board, nos);\r\n        if (pref.recovery.auto_clean) {\r\n          this.clean_up_LS_th(this.ls_key_comment, board, nos);\r\n          this.clean_up_LS_th(pref.script_prefix+'.comment.'+site.nickname, board, nos); // patch for half year, from 2016.09\r\n        }\r\n      }\r\n    },\r\n    ls_key_deletedPosts: pref.script_prefix + '.deletedPosts.',\r\n    clean_up_deleted_posts_1: function(bt){if (localStorage) delete localStorage[this.ls_key_deletedPosts + bt];},\r\n//    ls_key_comment: pref.script_prefix + '.draft.',\r\n    ls_key_comment: pref.script_prefix + '.draft.',\r\n    clean_up_LS_th: function(ls_key, board, nos){\r\n      var ls_key_bd = ls_key + board;\r\n      var keys = Object.keys(localStorage);\r\n      for (var i=0;i<keys.length;i++)\r\n        if (keys[i].indexOf(ls_key_bd)==0 && nos[keys[i].substr(ls_key_bd.length)]===undefined) delete localStorage[keys[i]]; // console.log('delete_LS: '+keys[i]);\r\n    },\r\n    check_reply: (function(){\r\n      var com_or_txt = false;\r\n      var pn_tags = document.createElement('div');\r\n      var regexp_anchor      = '';\r\n      var regexp_anchor_len  = 0;\r\n      var regexp_anchor_cb   = '';\r\n      var regexp_anchor_txt_1  = /^>>[0-9]+/; // RegExp.test executes RegExp.exec once.\r\n      var regexp_anchor_txt    = />>[0-9]+/g;\r\n      var regexp_anchor_cb_txt_1 = /^>>>\\/[0-9A-z_\\+]+\\/[0-9]+/;\r\n      var regexp_anchor_cb_txt = />>>\\/[0-9A-z_\\+]+\\/[0-9]+/g;\r\n      var regexp_anchor_com    = /&gt;&gt;[0-9]+/g;\r\n      var regexp_anchor_cb_com = /&gt;&gt;&gt;\\/[0-9A-z_\\+]+\\/[0-9]+/g;\r\n      var remake_own_posts = true;\r\n      var own_posts;\r\n      var own_posts_cb;\r\n      var tag_ex_list;\r\n      var str_rm_list;\r\n//      var time_offset = Math.floor(Date.now()/1000)*1000; // BUG.\r\n////////      var count_replies = 0; // for direct call to check_t1 from native catalog.\r\n      function add_you(post, add_name){\r\n        var as = post.pn.getElementsByTagName('a');\r\n        for (var i=0;i<as.length;i++) {\r\n          var to_me = false;\r\n          var txt = as[i].textContent;\r\n          if (own_posts && own_posts[txt.substr(2)]===null && regexp_anchor_txt_1.test(txt)) to_me = true; // SHOULD USE SEARCH INSTEAD OF TEST TO KEEP CONSISTENCY.\r\n          if (!to_me && own_posts_cb && regexp_anchor_cb_txt_1.test(txt)) {\r\n            var tgt = txt.split('/');\r\n            var bd = '/'+tgt[1]+'/';\r\n            if (own_posts_cb[bd] && own_posts_cb[bd][tgt[2]]===null) to_me = true;\r\n          }\r\n          if (to_me) {\r\n            if (pref.thread_reader.show_reply_to_me_by==='plain') as[i].parentNode.insertBefore(document.createTextNode(' (You)'), as[i].nextSibling);\r\n            else as[i].textContent = as[i].textContent + ' (You)'; // break dollchan.\r\n          }\r\n        }\r\n        if (add_name && own_posts && own_posts[post.no]===null) {\r\n          var pn_name = post.parse_funcs_html.pn_name(post);\r\n          if (pref.thread_reader.show_own_post_by==='plain') pn_name.parentNode.insertBefore(document.createTextNode(' (You)'), pn_name.nextSibling);\r\n          else pn_name.innerHTML = pn_name.innerHTML + ' (You)';\r\n        }\r\n      }\r\n      function check_1(post, watch, extracted_tags, extracted_posts){\r\n        var of_mine = own_posts && (post.no in own_posts);\r\n        if (of_mine) post.reply_of_mine = true;\r\n        if (!of_mine || !pref.catalog_footer_ignore_my_own_posts) {\r\n          var com = (com_or_txt)? post.com : post.body;\r\n          if (com) {\r\n            var to_me  = false;\r\n            if (own_posts) {\r\n              var anchors = com.match(regexp_anchor);\r\n              if (anchors!==null) {\r\n                for (var j=0;j<anchors.length;j++) {\r\n                  var tgt = anchors[j].substr(regexp_anchor_len);\r\n                  if (own_posts[tgt]===null) {to_me = true; break;}\r\n            }}}\r\n            if (!to_me && own_posts_cb) {\r\n              anchors = com.match(regexp_anchor_cb);\r\n              if (anchors!==null) {\r\n                for (var j=0;j<anchors.length;j++) {\r\n                  var tgt = anchors[j].split('/');\r\n                  var bd = '/'+tgt[1]+'/';\r\n                  if (own_posts_cb[bd] && own_posts_cb[bd][tgt[2]]===null) {to_me = true; break;}\r\n            }}}\r\n            if (to_me) {\r\n              post.reply_to_me = true;\r\n              watch[1]+=0x10000;\r\n            }\r\n          }\r\n          watch[1]++;\r\n        }\r\n        extracted_posts[extracted_posts.length] = post;\r\n        if (extracted_tags) check_t1(post, extracted_tags);\r\n      }\r\n      function check_t1(post, extracted_tags){\r\n        if (com_or_txt) {\r\n          var mail = post.com; // 4chan doesn't have 'mail'.\r\n          if (!mail) return;\r\n          mail = mail.replace(/<[^>]*>|&[^;]*;/g,' ');\r\n          if (pref.test_mode['47']) {\r\n            pn_tags.innerHTML = mail;\r\n            mail = pn_tags[brwsr.innerText];\r\n          }\r\n        } else {\r\n          if (post.editing) {\r\n            extracted_tags[extracted_tags.length] = post;// post.no;\r\n            return;\r\n          }\r\n          mail = post.body || post.com;\r\n          if (!mail) return;\r\n        }\r\n        if (mail.indexOf('#')===-1) return; // short cut.\r\n        if (str_rm_list) for (var i=0;i<str_rm_list.length;i++) mail = mail.replace(str_rm_list[i],'\\n');\r\n        var tags = mail.match(liveTag.scan_regex);\r\n//        if (tags!==null) extracted_tags = extracted_tags.concat(tags);\r\n        if (tags!==null)\r\n          for (var i=0;i<tags.length;i++)\r\n            if (tags[i].length<=pref.liveTag.maxstr) {\r\n              if (tag_ex_list) {\r\n                for (var j=tag_ex_list.length-1;j>=0;j--) if (tag_ex_list[j].test(tags[i])) break;\r\n                if (j>=0) continue;\r\n              }\r\n              extracted_tags[extracted_tags.length] = tags[i];\r\n            }\r\n      }\r\n      function prep_check_1(th){\r\n        if (th.parse_funcs.type_com==='txt') {\r\n          regexp_anchor     = regexp_anchor_txt;\r\n          regexp_anchor_len = 2;\r\n          regexp_anchor_cb  = regexp_anchor_cb_txt;\r\n          com_or_txt        = false;\r\n        } else {\r\n          regexp_anchor     = regexp_anchor_com;\r\n          regexp_anchor_len = 8;\r\n          regexp_anchor_cb  = regexp_anchor_cb_com;\r\n          com_or_txt        = true;\r\n        }\r\n      }\r\n      function prep_check_t1(th){\r\n        if (pref.liveTag.ex_list) {\r\n          tag_ex_list = pref_func.merge_obj5a(th,pref.liveTag.ex_list_obj5,null);\r\n          str_rm_list = pref_func.merge_obj5a(th,pref.liveTag.rm_list_obj5,null);\r\n        } else {\r\n          tag_ex_list = null;\r\n          str_rm_list = null;\r\n        }\r\n//        tag_ex_list = (pref.liveTag.ex_list)? pref_func.merge_obj5(th.key,pref.liveTag.ex_list_obj5,null) : null;\r\n      }\r\n      return {\r\n        remake_own_posts : function(){remake_own_posts = true;}, // couldn't get an event from myself, so don't miss posts from my thread.\r\n        make_own_posts : function(){  // called also from catalog initialializer, prevent from being called twice at initial.\r\n          site2[site.nickname].prep_own_posts();\r\n          remake_own_posts = false;\r\n        },\r\n        add_you: add_you,\r\n        set_own_posts: function(th){\r\n          own_posts_cb = site3[th.domain].own_posts;\r\n          own_posts = own_posts_cb[th.board] || own_posts_cb['ALL']; // 'ALL' for meguca.\r\n//          own_posts = own_posts_cb[th.board];\r\n          if (Object.keys(own_posts_cb).length==0) own_posts_cb = undefined; // patch for faster execution.\r\n        },\r\n//        check_t1: check_t1,\r\n        check_t1_op: function(th){\r\n          prep_check_1(th);\r\n          prep_check_t1(th);\r\n          var extracted_tags = [];\r\n          check_t1(th, extracted_tags);\r\n////          watch[0] = (watch[0]&0xfffe0000) | 1; // BUG, WHY???\r\n//          watch[0] = (watch[0]&0xfffe0000);\r\n////          watch[2] = th.time; // requires many changes\r\n////          watch[2] = th.time_created; // requires many changes // BUG, WHY???\r\n          return extracted_tags;\r\n        },\r\n        get_checked_time: function(watch){\r\n//          return watch[2] + time_offset; // BUG.\r\n          return watch[2];\r\n        },\r\n        set_watch_time: function(watch, time, key, track){\r\n          if (time>0) {\r\n            watch[0] |= 0x00040000;\r\n////          watch[2]  = time - time_offset; // to reduce memory usage, but doesn't effect. // BUG!!! watch[2] is initialized to 0, and not watched thread will enter with this. all threads must be initialized to '-time_offset'.\r\n//            watch[2]  = time;\r\n            if (watch[0]&0x00800000) watch[2] = time; // to reduce memory churn, this may require 'double' instead of Int32 for watch[2], CAUTION for compression.\r\n            else {\r\n              if (!track) this.time_watch[key] = time;\r\n              else this.time_track[key] = time;\r\n              watch[0] &= 0xff7fffff;\r\n            }\r\n          }\r\n        },\r\n        set_watched_to_last: function(watch, time, key, track){\r\n          this.set_watch_time(watch, time, key, track);\r\n          watch[1] = track || 0;\r\n        },\r\n        set_unwatch: function(watch){\r\n          watch[0] &= 0xff73ffff;\r\n          watch[1] = 0;\r\n        },\r\n        time_watch:{},\r\n        time_track:{},\r\n//        check: function(th, watch, make_pn){\r\n        check: function(th, watch, notify, ext_posts){ // watch[0]>0 && watch[3]>0 : usual check,\r\n          // watch[0]>0 && watch[3]<0 : retag, initialize tag but doesn't show new replies. (watch[3] must retain its value), and entry\r\n          // watch[0]<0 && watch[3]>0 : watchtime is updated. rescan new replies and show them. (watch[0] can be destroyed), BUG, can't entry.\r\n          // watch[0]<0 && watch[3]<0 : not used.\r\n          //\r\n          // watch[0] [15:0]: num of posts so far,\r\n          //          [16]: initial,\r\n          //          [17]: initial tag, retag,\r\n          //          [18]: watch_req, [19]:watching, [22:20]:archive,\r\n          //          [23]: watch time not initialized. (23,18) -> 10: not initialized, 11: watch_req, use watch[2], 01: watch_req, use tiem_watch, 00: usual state.\r\n          //          [24]: reentry of detection of deleted posts\r\n          //          [25]: posts_saved.\r\n          // watch[1] number of unread replies to me << 16 + number of unread replies\r\n          // watch[2] checked time'\r\n          var tag_init = watch[0]&0x00020000; // patch for retag.\r\n//          var init = (watch[3]<0); // patch for retag.\r\n//          if (watch[3]<0) watch[3] = -watch[3];\r\n//          var time_check = watch[3];\r\n//          var time_check = watch[2] + time_offset; // BUG.\r\n          var time_check = watch[2];\r\n          var watchtime_changed = false;\r\n//          var time_lastsaw = (watch[3]>0)? watch[3] : watch[0];\r\n//          var time_lastsaw = (watch[3]>watch[0])? watch[3] : watch[0]; // redundant anymore.\r\n//          if (watch[0]<0) { // initial\r\n//            watch[0] = -watch[0];\r\n//            time_check = watch[0];\r\n//            watch[1] = 0;\r\n//            watch[2] = (watch[2]&0xfffe0000) + ((th.omitted_posts)? th.omitted_posts+1 : 0); // number of replies so far, patch for 4chan catalog_json.\r\n//            init     = true;\r\n//            watchtime_changed = true;\r\n//          }\r\n          var time_watch = watch[2];\r\n          if (watch[0]&0x00040000) { // initial\r\n//            time_watch = cataLog.get_watch_time_of_a_thread(th.key,th.time_created,null, true); // BUG, can't handle if time_watch===0(not watched).\r\n            if (watch[0]&0x00800000) {\r\n              time_check = 0;\r\n              watch[2] = 0;\r\n            } else {\r\n              var time_track = !this.time_watch[th.key] && this.time_track[th.key];\r\n              time_watch = this.time_watch[th.key] || time_track;\r\n              delete this.time_watch[th.key];\r\n              delete this.time_track[th.key];\r\n            }\r\n//            watch[2] = 0;\r\n            watch[1] = 0;\r\n            watch[0] = ((watch[0]&0xff7b0000) | 0x00080000)+ ((th.omitted_posts)? th.omitted_posts+1 : 0); // number of replies so far, patch for 4chan catalog_json.\r\n                      // &=0xff7fffff for entry by clicking WATCH triage.\r\n//            init     = true;\r\n            watchtime_changed = true;\r\n          }\r\n          var time_check_old = time_check;\r\n//console.log('start: '+dbt[0]+dbt[1]+dbt[2],watch[5]);\r\n          var i = th.posts.length-1;\r\n//          if (remake_own_posts) { // working code.\r\n//            site2[site.nickname].prep_own_posts(); // couldn't get an event from myself, so don't miss posts from my thread.\r\n//            remake_own_posts = false;\r\n//          }\r\n          if (i>=0) {\r\n//            watch[2] = (th.posts[i].time*th.parse_funcs.time_unit || watch[2]) - time_offset; // BUG.\r\n            watch[2] = th.posts[i].time*th.parse_funcs.time_unit || watch[2];\r\n            if (th.parse_funcs.time_unit!=1) {\r\n              time_check = Math.floor(time_check/th.parse_funcs.time_unit);\r\n              time_watch = (watchtime_changed)? Math.floor(time_watch/th.parse_funcs.time_unit) : time_check;\r\n            }\r\n            var extracted_tags = (pref.liveTag.from==='post')? [] : null;\r\n            if (extracted_tags) prep_check_t1(th);\r\n            var ur_old = liveTag.generate_ur(watch[1]);\r\n            var watching = watch[0]&0x000c0000;\r\n            if (watching || extracted_tags) prep_check_1(th);\r\n            if (watching) {\r\n              if (remake_own_posts) this.make_own_posts();\r\n              liveTag.mems[th.domain][th.board].nr = -1; // mark as dirty.\r\n              prep_check_1(th);\r\n              this.set_own_posts(th);\r\n              while (i>=0 && th.posts[i].time>time_watch) check_1(th.posts[i--], watch, extracted_tags, ext_posts); // extracting tags in op is redundant, because they are ALWAYS extracted.\r\n            }\r\n            if (extracted_tags) while (i>0 && (tag_init || th.posts[i].time>time_check)) check_t1(th.posts[i--], extracted_tags); // tuned for initial loop. don't extract tags in op.\r\n            if (!common_obj.thread_reader) {\r\n              if (extracted_tags && extracted_tags.length!=0) var tags = liveTag.extract_tags(th, extracted_tags, null, !tag_init); // 'check_update_tags_color' is called in this.\r\n              else if (pref.liveTag.style.use && watching) {\r\n                var ur = liveTag.generate_ur(watch[1]);\r\n                if (ur_old!=ur) liveTag.update_ur(th.key,ur,ur_old!=0 && watchtime_changed); // can choose faster function if ur==0.\r\n              }\r\n            }\r\n            if (pref3.stats.use && stats) stats.aggregate(th); // '&& stats' is a patch for embed_thread.\r\n            if (time_watch!==time_check || !watching) {\r\n              i = th.posts.length;\r\n              while (i>0 && th.posts[i-1].time>time_check) i--;\r\n              var new_posts = th.posts.slice(i);\r\n            }\r\n          }\r\n          watch[0] = (watch[0]&0xfff90000) + th.nof_posts;\r\n//console.log('end:   '+dbt[0]+dbt[1]+dbt[2]);\r\n//if (pref.debug_mode['3'] && extracted_tags.length!=0) console.log(th.key+': '+extracted_tags);\r\n////////          if (cataLog.threads && cataLog.threads[th.key]) { // working code.\r\n//////////            if (!cataLog.threads[th.key][9][0]) cataLog.threads[th.key][9] = cataLog.catalog_filter_query(th.key); // doesn't work because threads[name][8] is NOT updated.\r\n////////            cataLog.insert_footer3(th.key,null,th.page,tags);\r\n////////          }\r\n          if (notify && (watch[0]&0x000c0000)) {\r\n//            if (ext_posts.length!=0 && pref.notify.desktop.notify && th.parse_funcs.add_op_img_url) th.parse_funcs.add_op_img_url(ext_posts,th.board,th.domain); // can't get 'com' if 'meguca'\r\n            if (ext_posts.length!=0 && pref.notify.desktop.notify) site2[th.domain].wrap_to_parse.posts({posts:ext_posts, __proto__:th});\r\n            notifier.changed(th, time_track? [] : ext_posts);\r\n          }\r\n          return {tags:tags, posts:new_posts || ext_posts, time_check_old:time_check_old};\r\n        },\r\n      }\r\n    })(),\r\n\r\n////////    get_posts2 : function(doc,pool){return {}}, // subfunction of check_reply_to_me, parse html to json.\r\n    get_post_offsetTop : function(doc,num) {}, // get offsetTop of Nth object.\r\n    favicon: {\r\n      get_favicon: function(){\r\n        var links = document.getElementsByTagName('head')[0].getElementsByTagName('link');\r\n        for (var i=0;i<links.length;i++) if (links[i].getAttribute('rel')=='shortcut icon') return links[i];\r\n        var pn = document.createElement('link');\r\n        pn.setAttribute('rel','shortcut icon');\r\n        pn.setAttribute('href',this.none);\r\n        pn.setAttribute('type','image/x-icon');\r\n        return document.getElementsByTagName('head')[0].appendChild(pn);\r\n      },\r\n      get_title: function(){\r\n        var title = document.getElementsByTagName('head')[0].getElementsByTagName('title')[0];\r\n        if (!title){\r\n          title = document.createElement('title');\r\n          title = document.getElementsByTagName('head')[0].appendChild(title);\r\n        }\r\n        return title;\r\n      },\r\n    }, // object for favicon\r\n//    get_op_image_url: function(th,type){}, // get op image's url.\r\n    get_icon : function(){}, // get sticky icon.\r\n    add_icon : function(){}, // add sticky icon.\r\n    time_revised_check: function(nof_ths){return false;},\r\n\r\n    format_thread_layout   : function(thread){}, // formats its layout   for catalog.\r\n    format_thread_style    : function(thread){}, // formats its style    for catalog.\r\n    format_thread_contents : function(thread){}, // formats its contents for catalog.\r\n    format_thread_always   : function(thread){}, // formats its contents for catalog, always executed.\r\n////////    format_time            : function(thread){}, // formats its timestamp to local time.\r\n    format_remove_tn_area_size: function(thread){}, // remove thumbnail area size\r\n//    mark_newer_posts       : function(thread,time){return null;},  // mark newer posts, and returns marked first post.\r\n//    unmark_post_from_event : function(post){},  // unmark post.\r\n    mark_newer_posts2: function(posts,date,unmark, short_cut) {\r\n      date = date/this.parse_funcs.post_json.time_unit;\r\n      var marked_first_post = null;\r\n      for (var i=posts.length-1;i>=0;i--) {\r\n        var pn = posts[i].pn\r\n        if (date<posts[i].time) {\r\n          pn.setAttribute('style', pref.style.post_new);\r\n          if (unmark) pn.addEventListener('mouseover', this.unmark_post_from_event, false);\r\n          marked_first_post = pn;\r\n        } else {\r\n          if (short_cut) break;\r\n          if (pn.getAttribute('style')!=null) pn.removeAttribute('style');\r\n        }\r\n      }\r\n      return marked_first_post;\r\n    },\r\n    mark_newer_posts : function(nickname,posts,date, func, unmark, short_cut){\r\n//      var offset_top = 0;\r\n      var marked_first_post = null;\r\n      for (var i=posts.length-1;i>=0;i--) {\r\n//        var reply = posts[i];\r\n////        posts[i] = posts[i].parentNode;\r\n////        if (class_or_tag=='class') while (posts[i].className.search(key)==-1) posts[i] = posts[i].parentNode;\r\n////        if (class_or_tag=='tag') while (posts[i].tagName.search(key)==-1) posts[i] = posts[i].parentNode;\r\n//        if (class_or_tag=='class') reply = posts[i].getElementsByClassName(key)[0];\r\n//        if (class_or_tag=='tag')  reply = posts[i].getElementsByTagName(key)[0];\r\n        var reply = (func)? func(posts[i]) : posts[i];\r\n        if (reply)\r\n          if (date<site2[nickname].parse_funcs.post_html.time_pn(posts[i])) {\r\n            reply.setAttribute('style', pref.style.post_new);\r\n//            if (!reply.style) reply.style = {};\r\n//            reply.style.border = '2px solid red'; // ca'nt use !important\r\n            if (unmark) reply.addEventListener('mouseover', site2[nickname].unmark_post_from_event, false);\r\n//            offset_top = reply.offsetTop;\r\n            marked_first_post = reply;\r\n          } else {\r\n            if (reply.getAttribute('style')!=null) reply.removeAttribute('style');\r\n            if (short_cut) break;\r\n//            if (reply.style) reply.style.border = 'none';\r\n          }\r\n      }\r\n//      return offset_top;\r\n      return marked_first_post;\r\n    },\r\n    format_pn: function(pn,thq_no, pref_env, post, th){\r\n      if (!pref_env) pref_env = pref[cataLog.embed_mode];\r\n      if (pref_env.colorID) this.colorID(pn);\r\n      if (pref_env.backlink) this.backlink(pn,thq_no, th); // th for short href.\r\n      if (pref_env.localtime) this.localtime(pn);\r\n      if (post) { // BUG, CALLED TWISE TIMES for deleted posts in embed_mode==='thread'\r\n//        if (cataLog.embed_mode==='page' || cataLog.embed_mode==='thread') site2['DEFAULT'].check_reply.add_you(post, true); // \"cataLog.embed_mode==='page'\" is a patch.\r\n        site2['DEFAULT'].check_reply.add_you(post, true);\r\n        if (post.deleted_after) pn.classList.add('CatChan_deleted');\r\n        if (post.search_result!==undefined) site2[post.domain_html].update_posts0_class(pn, post.search_result);\r\n      }\r\n    },\r\n    colorID: function(){},\r\n    localtime: function(){},\r\n    unmark_post_from_event: function(e) {\r\n      e.target.removeEventListener('mouseover', site2['common'].unmark_post_from_event, false);\r\n      site2['DEFAULT'].unmark_post(e.target);\r\n    },\r\n    unmark_post: function(pn) {\r\n      pn.removeAttribute('style');\r\n//      pn.setAttribute('style','border: none');\r\n    },\r\n    modify_thread_link     : function(thread){return [];}, // modify thread link and returns information to add event listener.\r\n    preprocess_html        : function(doc_txt){return doc_txt;},  // pre-process document from txt. // cause memory leak.\r\n    preprocess_doc         : null, //function(doc){},  // pre-process document.\r\n////////    thread2headline : function(doc){return [0,0];},  // make headline from entire thread, returns num of [posts, images].\r\n//    add_thread_link : function(doc,url){}, // add link to this thread.\r\n    check_thread_archived : function(thread){return false;}, // check the thread is archived.\r\n    get_owners_recommendation: function(){return '';}, // return string of owner's recommendation.\r\n    get_board_tags : function(){return {};}, // return object of board tags.\r\n//    get_json_url_thread : function(board,thread){return '';}, // return url of JSON API.\r\n    get_json_url_catalog : function(board){return '';}, // return url of JSON API.\r\n//    parse_json_thread: function(txt,from_http){return JSON.parse(txt);}, // parser of JSON API.\r\n    parse_json_thread: function(obj,from_http){}, // parser of JSON API.\r\n//    parse_json_catalog: function(txt){return JSON.parse(txt);},  // parser of JSON API.\r\n    uip_tgt_post : function(no){return null;}, // returns uip target post.\r\n    uip_post_num : function(post){return null;}, // returns num in posts.\r\n    uip_check: function(callback){}, // hook for uip_tracker.\r\n    catalog_native_prep: function(depend_on_site){return [];}, // prepare for native catalog.\r\n    catalog_native_prep_sel: function(pn_filter, pn_tb, selector_native){\r\n      if (selector_native) {\r\n        if (selector_native.selectedIndex!=0) {\r\n          selector_native.selectedIndex = 0;\r\n          var evt = document.createEvent('UIEvents');\r\n          evt.initUIEvent('change', false, true, window, 1);\r\n          selector_native.dispatchEvent(evt);\r\n        }\r\n        selector_native.style.display = 'none';\r\n      }\r\n      var selector_catchan = pn_filter.getElementsByTagName('select')['catalog.indexing'];\r\n      if (site.whereami==='catalog') selector_native.parentNode.insertBefore(selector_catchan,selector_native);\r\n      else pn_tb.childNodes[3].insertBefore(selector_catchan,pn_tb.childNodes[3].firstChild);\r\n    },\r\n    catalog_native_prep_swap_sortSel: function(sortSel){\r\n      sortSel.parentNode.insertBefore(cataLog.components.catalog.indexing, sortSel.nextSibling);\r\n      sortSel.setAttribute('style', 'display:none');\r\n    },\r\n    catalog_frame_prep: function(pn12){}, // prepare for frame mode.\r\n    catalog_native_frame_prep: function(pn12_button){ // prepare for frame mode in native catalog.\r\n      var mode = false;\r\n      var ifrm;\r\n      var pn_catalog;\r\n      function insert_remove_frame(){\r\n        if (!mode) {\r\n          pn_catalog = site2['common'].absorb_children(site.root_body);\r\n          pn_catalog.style.width = pref.catalog_size_frame0_width + '%';\r\n          pn_catalog.style.float = 'left';\r\n          pn_catalog.style.height = '' + window.innerHeight + 'px';\r\n          pn_catalog.style.overflow = 'scroll';\r\n          ifrm = site2[site.nickname].catalog_native_frame_prep_frame(site.root_body,null);\r\n        } else {\r\n          site.root_body.removeChild(ifrm);\r\n          ifrm = null;\r\n          site.embed_frame_win = null;\r\n          site2['common'].disgorge_children(pn_catalog);\r\n//          this.removeEventListener('click', insert_remove_frame, false);\r\n        }\r\n        mode = !mode;\r\n      }\r\n      pn12_button.addEventListener('click', insert_remove_frame, false);\r\n    },\r\n    catalog_native_frame_prep_frame: function(parent,ref_node){\r\n      ifrm = document.createElement('iframe');\r\n      ifrm.setAttribute('name',site.embed_frame);\r\n      ifrm.style.height = '' + window.innerHeight + 'px';\r\n      ifrm.style.margin = '0px';\r\n      ifrm.style.width = pref.catalog_size_frame1_width + '%';\r\n      parent.insertBefore(ifrm,ref_node);\r\n      site.embed_frame_win = ifrm.contentWindow;\r\n      return ifrm;\r\n    },\r\n    catalog_embed_prep: function(pn12){ // https://developer.mozilla.org/ja/docs/Web/API/HTMLElement/style, reset by null.\r\n      pn12.style.position = null;\r\n      pn12.childNodes[1].style.width = null;\r\n      pn12.childNodes[1].style.height = window.innerHeight + 'px';\r\n      pn12.childNodes[0].childNodes[0].style.display = 'none';\r\n      pn12.childNodes[0].childNodes[1].style.display = 'none';\r\n      pn12.style.border = null;\r\n      pn12.style.left = null;\r\n      pn12.style.resize = null;\r\n      pn12.style.top = null;\r\n    },\r\n    thread2search_obj : function(thread){return [thread[brwsr.innerText],'','','','','','',''];}, // return search_obj from thread.\r\n////    get_click_area: function(pn){\r\n////      var img = pn.getElementsByTagName('img');\r\n////      return (img.length!=0)? img : pn;\r\n////    },\r\n//    get_click_area: function(pn){\r\n//      var img0 = pn.getElementsByTagName('img')[0];\r\n//      return (img0)? img0 : pn;\r\n//    }\r\n    popups_posts: (function(){\r\n      function up_timer_factory(){\r\n        var up_timer = null;\r\n        var up_e = null;\r\n        var up_func = null;\r\n        var up_pf = null;\r\n        var up_src = null;\r\n        function over_0(pf, e, func, src){\r\n          if (pf.popdown==='imm') func(e);\r\n          else {\r\n            if (!src) src = e.target;\r\n            if (pf.popup_mMove) src.addEventListener('mousemove', over_1, false);\r\n            up_func = func;\r\n            up_pf = pf;\r\n            up_src = src;\r\n            over_1(e);\r\n          }\r\n        }\r\n        function over_1(e){\r\n          if (up_timer) clearTimeout(up_timer);\r\n          up_timer = setTimeout(timer_end, up_pf.popup_delay);\r\n          up_e = e;\r\n        }\r\n        function timer_end(stop){ // this may be fired twice, because this has a racing condition between finish of up_timer and over_1 event.\r\n          if (stop) clearTimeout(up_timer);\r\n          up_timer = null;\r\n          if (up_pf.popup_mMove) up_src.removeEventListener('mousemove', over_1, false);\r\n          if (!stop) up_func(up_e);\r\n        }\r\n        return {\r\n          over: over_0,\r\n          stop: function(){\r\n            if (up_timer) {timer_end(true);return true;}\r\n            return false;\r\n          },\r\n          get up_timer(){return up_timer;},\r\n          out: function(e){\r\n            if (e.relatedTarget===erT_done) {erT_done = null; return e.relatedTarget;}\r\n            else return this.stop();\r\n          },\r\n        };\r\n      }\r\n      var pns = new Map();\r\n      var erT_done = null;\r\n      function out_1_if_exists(src, pn_ex){\r\n        var pn = pns.get(src);\r\n        if (pn)\r\n          if (!Array.isArray(pn)) {if (pn!==pn_ex) out_1(pn);}\r\n          else for (var i=0;i<pn.length;i++) if (pn[i] && pn[i]!==pn_ex) out_1(pn[i]);\r\n      }\r\n      function out_1(pn){\r\n        var info = pns.get(pn);\r\n        var pf = info.pf && info.pf() || pref.proto;\r\n        if (pf.popdown==='imm') pop_down(pn);\r\n        else info.timer = setTimeout(pop_down.bind(null,pn), pf.popdown_delay);\r\n      }\r\n      function pop_setup(src, pn, obj, pna){\r\n        pns.set(src, pna || pn);\r\n        pns.set(pn, obj || {src:src}); // bi-directional\r\n        pn.addEventListener('mouseenter',pop_over, false);\r\n        pn.addEventListener('mousedown',cnst.div_mousedown,false);\r\n      }\r\n      function pop_down(pn, snatch){\r\n        if (pn && pn.parentNode) {\r\n          if (!snatch) pn.parentNode.removeChild(pn);\r\n          var info = pns.get(pn);\r\n          if (info.key) posts.pop_load_req_delete(info.key, pn);\r\n          if (info.chart && !snatch) info.chart.destroy();\r\n          if (info.scroll) pn.removeEventListener(brwsr.mousewheel, cnst.div_scroll, false);\r\n          var src = info.src;\r\n          var pna = pns.get(src);\r\n          if (Array.isArray(pna)) {\r\n            pna[pna.indexOf(pn)] = null; // keep position, not splice\r\n            for (var i=0;i<pna.length;i++) if (pna[i]) break;\r\n            if (i==pna.length) pns.delete(src);\r\n          } else pns.delete(src);\r\n          pns.delete(pn);\r\n          pn.removeEventListener('mouseenter', pop_over, false);\r\n          pn.removeEventListener('mousedown',cnst.div_mousedown,false);\r\n          if (snatch) {\r\n            pn.removeEventListener('mouseleave', pop_out, false);\r\n            return info;\r\n          }\r\n        }\r\n      }\r\n      function pop_over(e){\r\n        var ecT = e.currentTarget;\r\n        var info = pns.get(ecT);\r\n        var pf = info.pf && info.pf() || pref.proto;\r\n        if (pf.popdown==='imm') pop_down(ecT);\r\n        else {\r\n          if (info.timer) clear_down_timer(info);\r\n          erT_done = e.relatedTarget;\r\n          ecT.addEventListener('mouseleave', pop_out, false);\r\n        }\r\n      }\r\n      function pop_out(e){\r\n        var ecT = e.currentTarget;\r\n        ecT.removeEventListener('mouseleave', pop_out, false);\r\n        out_1(ecT);\r\n      }\r\n      function clear_down_timer(info){clearTimeout(info.timer); info.timer=null;}\r\n\r\n      var hist_x = 'left';\r\n      var hist_y = 'top';\r\n      var ddEcW = 0;\r\n      var ddEcH = 0;\r\n      function set_pos(pn, e, hist, narrow_x, narrow_y){\r\n        var factor_x = (!hist)? 0.5 : (hist_x==='left')? 3/4 : 1/4;\r\n        var factor_y = (!hist)? 0.5 : (hist_y==='top')?  4/5 : 1/5;\r\n        ddEcW = document.documentElement.clientWidth;\r\n        ddEcH = document.documentElement.clientHeight;\r\n        if (ddEcW*factor_x-e.clientX>0 ^ narrow_x) {pn.style.left = e.clientX + 10 + 'px'; hist_x='left';}\r\n        else {pn.style.right = ddEcW - e.clientX + 10 + 'px'; hist_x='right';}\r\n        if (ddEcH*factor_y-e.clientY>0 ^ narrow_y) {pn.style.top = e.clientY + 10 + 'px'; hist_y='top';}\r\n        else {pn.style.bottom = ddEcH - e.clientY + 10 + 'px'; hist_y='bottom';}\r\n//        if (document.documentElement.clientWidth/2-e.clientX>0) pn.style.left = e.clientX + 10 + 'px';\r\n//        else pn.style.right = document.documentElement.clientWidth - e.clientX + 10 + 'px';\r\n//        if (document.documentElement.clientHeight/2-e.clientY>0) pn.style.top = e.clientY + 10 + 'px';\r\n//        else  pn.style.bottom = document.documentElement.clientHeight - e.clientY + 10 + 'px';\r\n      }\r\n      function adjust_pos(pn, e){\r\n        var s = pn.style;\r\n        var tb = parseInt(s.top?s.top:s.bottom,10);\r\n        var visible_v = pn.offsetHeight + tb < ddEcH;\r\n        if (!visible_v && tb > ddEcH*0.5) {\r\n          var h = ddEcH - pn.offsetHeight;\r\n          var pos = (h<0? 0:h)+'px';\r\n          if (s.top) {s.top = pos; hist_y = 'bottom';}\r\n          else {s.bottom = pos; hist_y = 'top';}\r\n        }\r\n        var lr = parseInt(s.left?s.left:s.right,10);\r\n        var visible_h = pn.offsetWidth + lr < ddEcW;\r\n        if (!visible_h && lr > ddEcW*0.5) {\r\n          var pos = ddEcW - parseInt(s.left?s.left:s.right,10)+20 + 'px';\r\n          if (s.left) {s.right = pos; s.left = null;}\r\n          else {s.left = pos; s.right = null;}\r\n        }\r\n      }\r\n\r\n      var blacklist = new WeakSet();\r\n      var geh;\r\n      function href2domain(href){\r\n        if (href[0]==='/' || href[0]==='#') return site.nickname;\r\n        else for (var d in liveTag.mems) if (href.indexOf(site2[d].domain_url)!=-1) return site2[d].nickname;\r\n        for (var d in site2) if (href.indexOf(site2[d].domain_url)!=-1) return site2[d].nickname_href2domain || site2[d].nickname;\r\n      }\r\n      var up0 = up_timer_factory(); // surface\r\n      function over(e, force){ // image_hover can be merged to this, and popup2 also. e.path can be created easily, mouseenter can be replaced to mouseover.\r\n        out(e);\r\n        var et = e.target;\r\n        var pf_mode = pref[cataLog.embed_mode];\r\n        if (pf_mode.popup && et.tagName==='A' && site2['DEFAULT'].popups_link_regex.test(et.textContent)) posts.over(e, force);\r\n        else if (pf_mode.image_hover && geh.isThumbnail(e)) up0.over(pf_mode.thumbnail.hover, e, cataLog.DIH.image_hover_add);\r\n        else if (pref.test_mode['121'] && pf_mode.popupX.use) up0.over(pf_mode.popupX, e, popupSurface.X);\r\n//        else if (pref.test_mode['121'] && geh.getID(et)) up0.over(pf_mode.popupID, e, popupSurface.ID);\r\n//        else if (pref.test_mode['121'] && geh.getName(et)) up0.over(pf_mode.popupName, e, popupSurface.Name);\r\n//        else if (pref.test_mode['121'] && geh.getTrip(et)) up0.over(pf_mode.popupTrip, e, popupSurface.Trip);\r\n//        else if (pref.test_mode['121'] && geh.getCountry(et)) up0.over(pf_mode.popupFlag, e, popupSurface.Flag);\r\n      }\r\n      function out(e){\r\n        cataLog.DIH.image_hover_remove();\r\n        if (up0.out(e)) return;\r\n        var erT = e.relatedTarget;\r\n//        if (erT) out_1_if_exists(erT); // cause too many errors\r\n        if (erT && (erT.tagName==='A' || pref.test_mode['121'] && popupSurface.et)) out_1_if_exists(erT);\r\n        popupSurface.et= null;\r\n//        if (erT && (erT.tagName==='A' || pref.test_mode['121'] && (geh.getID(erT) || geh.getName(erT) || geh.getTrip(erT) || geh.getCountry(erT)))) out_1_if_exists(erT);\r\n//        if (erT && erT.tagName==='A') out_1_if_exists(erT);\r\n//        if (erT===erT_done) erT_done = null;\r\n//        else if (up0.stop()) return;\r\n//        else if (erT && erT.tagName==='A') {\r\n//          var info = pns.get(erT);\r\n//          if (info) out_1(info);\r\n//        }\r\n      }\r\n      var posts = (function(){\r\n        function over(e, force){\r\n          if (pref.proto.popup_hlt && post_highlight_if_visible(e)) return;\r\n          up0.force = force\r\n          up0.over(pref.proto, e, pop_up);\r\n          var domain = href2domain(e.target.getAttribute('href'));\r\n          if (domain!==site.nickname) e.stopPropagation(); // prevent striking(----) because of being taken as a deleted post in 4chan.\r\n        }\r\n        function pop_up(e){\r\n          var force = up0.force;\r\n          var et = e.target;\r\n          if (pns.has(et)) {clear_down_timer(pns.get(pns.get(et))); return;}\r\n          var domain = href2domain(et.getAttribute('href'));\r\n          if (!force && pref[cataLog.embed_mode].env.popup_native) {\r\n            if (pref[cataLog.embed_mode].env.event_dynamic && !pref.test_mode['100']) {\r\n              if (site.nickname===domain) return; // 4chan\r\n            } else if (blacklist.has(et)) return // { // working code, but can't surpress dual popup.\r\n  //            if (pref[cataLog.embed_mode].env.popup_native_kill) {\r\n  //              var pn = blacklist.get(et);\r\n  //              if (pn===null) {\r\n  //                pn = et.cloneNode(true);\r\n  //                pn.setAttribute('style','position:relative;left:-'+et.offsetWidth+'px;'); // to cause mouseout to popdown native popup.\r\n  //                et.parentNode.insertBefore(pn,et.nextSibling);\r\n  //                blacklist.set(pn,et);\r\n  //              } else {\r\n  //                et.parentNode.removeChild(et.previousSibling);\r\n  //                et.removeAttribute('style');\r\n  //                blacklist.delete(et);\r\n  //              }\r\n  //            } else return;\r\n  //          }\r\n          }\r\n          pop_make(e, domain);\r\n        }\r\n        function pop_make(e, domain){\r\n          var obj = popups_post_entry(e, domain);\r\n          if (obj) pop_setup(e.target, obj.pn, obj.key? {src:e.target, key:obj.key} : null);\r\n          return obj.pn;\r\n        }\r\n  \r\n        var keys_loading = new Map();\r\n        function pop_load(key, domain){\r\n          var tgts = keys_loading.get(key);\r\n          if (tgts) {\r\n            for (var i=tgts.length-1;i>=0;i--) { // must be backward, tgts[i] will be removed in pop_down\r\n              var tgt = tgts[i]; // backup is needed, pop_down removes tgts[i] itself.\r\n              var pn = pns.get(tgt.target);\r\n              if (pn) {\r\n                pop_down(pn); // removes tgts[i]\r\n                var pn2 = pop_make(tgt,domain);\r\n                if (pn.style.left) pn2.style.left = pn.style.left; else pn2.style.right = pn.style.right;\r\n                if (pn.style.top) pn2.style.top = pn.style.top; else pn2.style.bottom = pn.style.bottom;\r\n              }\r\n            }\r\n            keys_loading.delete(key);\r\n          }\r\n        }\r\n        function pop_load_req(e, key, pn){\r\n          var val = {target:e.target, clientX:e.clientX, clientY:e.clientY, pn:pn};\r\n          var tgts = keys_loading.get(key);\r\n          if (tgts) tgts.unshift(val); // reverse ordering.\r\n          else keys_loading.set(key,[val]);\r\n        }\r\n        function pop_load_req_delete(key, pn){\r\n          var tgts = keys_loading.get(key);\r\n          if (tgts) {\r\n            for (var i=tgts.length-1;i>=0;i--) if (tgts[i].pn===pn) tgts.splice(i,1);\r\n            if (tgts.length===0) keys_loading.delete(key);\r\n          }\r\n        }\r\n  \r\n        function post_highlight_if_visible(e){\r\n          var href = e.target.getAttribute('href'); // keep as it is, et.href may be %xx%yy.\r\n          var domain = href2domain(href);\r\n          var th_q = site2[domain].popups_href2th_q(href);\r\n          var no = th_q[1];\r\n          var tgt_th = cataLog.threads[th_q[0].key];\r\n          var posts = tgt_th && tgt_th[16] && tgt_th[16].posts;\r\n          if (posts) {\r\n            for (var i=posts.length-1;i>=0;i--) if (posts[i].no===no) break;\r\n            var pn = (i>=0)? posts[i].pn : undefined;\r\n            if (pn && window.getComputedStyle(pn).display!=='none') {\r\n              var oT = pn.offsetTop;\r\n              var sT = brwsr.document_body.scrollTop;\r\n              if (oT>sT && oT+pn.offsetHeight<sT+document.documentElement.clientHeight) { // temporal, embed only. see 'get_ref_height'.\r\n                pn.classList.add(site2[site.nickname].popups_posts_class_hlt);\r\n                e.target.addEventListener('mouseout',post_highlight_end, false);\r\n                pns.set(e.target, pn);\r\n                post_dotted_if_multi_anchors(pn, e, {domain_html:pref.catalog.mimic_base_site? site.nickname : domain});\r\n                return true;\r\n              }\r\n            }\r\n          }\r\n          return false;\r\n        }\r\n        var an_dotted = null;\r\n        function post_highlight_end(e){\r\n          var et = e.target;\r\n          et.removeEventListener('mouseout',post_highlight_end, false);\r\n          pns.get(et).classList.remove(site2[site.nickname].popups_posts_class_hlt);\r\n          pns.delete(et);\r\n          if (an_dotted) {\r\n            an_dotted.classList.remove('dotted');\r\n            an_dotted = null;\r\n          }\r\n        }\r\n        function post_dotted_if_multi_anchors(pn, e, th){\r\n          if (!pref.test_mode['108']) {\r\n            var ce = site2[th.domain_html].post_pn2ce(pn); // patch for catalog_html, whose th.posts[0].pn is the same as th.pn, this doesn't give ce, but the caller generates pn from it.\r\n            var as = ce? ce.getElementsByTagName('a') : undefined;\r\n            if (as && as.length>1) {\r\n              var src_no = geh.an2srcNo(e.target,th);\r\n//              var pn_post = site2[th.domain_html].post_an2pn(e.target);\r\n              if (src_no) {\r\n//                var src_no = site2[th.domain_html].parse_funcs['post_html'].no({pn:pn_post});\r\n                for (var i=0;i<as.length;i++) if (site2[th.domain_html].popups_href2dbtp(as[i].getAttribute('href'))[3]==src_no) break;\r\n                if (i!=as.length) {\r\n                  as[i].classList.add('dotted');\r\n                  an_dotted = as[i];\r\n                }}}}\r\n        }\r\n        function popups_post_entry(e, domain){\r\n          var et = e.target;\r\n          var th = {domain:domain, domain_html: pref.catalog.mimic_base_site? site.nickname : domain};\r\n          var th_q = site2[th.domain].popups_href2th_q(et.getAttribute('href'));\r\n          if (!th_q) return;\r\n          var dbt = th_q[2];\r\n  //        if (pref[cataLog.embed_mode].env.event_dynamic && pref[cataLog.embed_mode].env.popup_native && site.nickname===th.domain && pref.test_mode['98']) return;\r\n          var pn;\r\n          var thqp = th_q[0][th_q[1]];\r\n          var isOP = dbt[3] == dbt[2]; // thqp.no == dbt[2]; // == must be used, typeof(dbt[2]) is string.\r\n          if (thqp===undefined && pref.test_mode['80']) { // patch\r\n            th.no = th_q[2][2];\r\n            var boards = ['_IDB/', '_File/'];\r\n            for (var i=0;i<2;i++) {\r\n              th.board = th_q[2][1].slice(0,-1)+boards[i];\r\n              var th_q0 = liveTag.mems[th.domain][th.board] && liveTag.mems[th.domain][th.board][th.no] && liveTag.mems[th.domain][th.board][th.no].q;\r\n              if (th_q0) {\r\n                th_q[0] = th_q0;\r\n                break;\r\n              }\r\n            }\r\n          }\r\n          if (thqp===undefined || Array.isArray(thqp)) {\r\n            site2['DEFAULT'].popups_try_fetch_from_lth_ta(liveTag.mems[th.domain][dbt[1]][dbt[2]], parseInt(dbt[3],10), th); // may change thqp, th for domain_html(mimic)\r\n            thqp = th_q[0][th_q[1]];\r\n          }\r\n          if (thqp===undefined || Array.isArray(thqp)) { // 'thqp===undefined' for multilevel popups.\r\n            site2[th.domain].popups_post_fetch(th, dbt);\r\n  //          cataLog.scan_init('popup',[th.domain+dbt[1]+((pref.catalog.catalog_json)? 't':'')+dbt[2]], {priority:8});\r\n            pn = site2[th.domain_html].post_json2html({time: 0, com:'Loading...', domain:domain, board:dbt[1], no:dbt[2]}, dbt[1]); // board and no is not used now, just a insurance.\r\n            var key = dbt[0]+dbt[1]+dbt[2]+'#'+dbt[3];\r\n            pop_load_req(e, key, pn);\r\n  //          site2['DEFAULT'].popup_info = {node:et, clientX:e.clientX, clientY:e.clientY, key:dbt[0]+dbt[1]+dbt[2]+'#'+dbt[3], func_out:site2['DEFAULT'].popups_posts.pop_down.bind(null,pn)}; //out};\r\n            site2['DEFAULT'].popups_set_waiting(th_q[0],th_q[1]);\r\n          } else {\r\n  //          if (site2['DEFAULT'].popup_info) site2['DEFAULT'].popup_info.func_out();\r\n  //          if (site2['DEFAULT'].popup_info) et.onmouseout(); // BUG at editing, sometimes out is never issued because of being replaced.\r\n  //          if (!thqp.pn || thqp.isOP || thqp.type_data==='html') {\r\n            if (!thqp.pn || isOP && (site.nickname!=='4chan' || site.whereami!=='thread')) {\r\n//            if (!thqp.pn || isOP && !pref.test_mode['105']) { // test\r\n  //          if (!thqp.pn || thqp.isOP || pref.proto.popdown!=='imm') { // BUG, this requires exact extraction of country, country_name or data for images even from html.\r\n              if (!thqp.domain) { // PATCH, use prototype of liveTag.mems.\r\n                var tgt = thqp;\r\n                tgt.domain = th.domain;\r\n                if (tgt.extra_files) for (var i=0;i<tgt.extra_files.length;i++) tgt.extra_files[i].domain = th.domain;\r\n              }\r\n              pn = site2[th.domain_html].post_json2html(thqp, dbt[1]);\r\n            } else pn = thqp.pn.cloneNode(true);\r\n            cataLog.format_html.prep_anchor_links(pn, th_q[0]);\r\n            site2[th.domain_html].format_pn(pn, thqp, null, null, th_q[0]);\r\n            post_dotted_if_multi_anchors(pn, e, th);\r\n          }\r\n          pn.style = {};\r\n          pn.style.position = 'fixed';\r\n          set_pos(pn,e, true);\r\n  //        pn.style.left = e.clientX + 10 + 'px';\r\n  //        if (!pref.test_mode['25']) pn.style.top  = e.clientY -15 + 'px';\r\n  //        else pn.style.bottom  = window.innerHeight - e.clientY + 20 + 'px';\r\n          pn.style.zIndex = pref[cataLog.embed_mode].popup_zIndex;\r\n          if (site.nickname!=='KC') pn.style.borderStyle = 'solid';\r\n          pn.style.boxShadow = 'rgb(153, 153, 153) 1px 1px 1px';\r\n          if (site.nickname==='4chan') {\r\n            pn.classList.add('preview');\r\n            pn.style.display = 'block';\r\n          }\r\n  //        if (thqp.isOP) site2[th.domain_html].popups_op_func_use(pn,th_q[0], th_q[1]);\r\n          site2[site.nickname].popups_post_pnode(et).appendChild(pn);\r\n  //        site2['DEFAULT'].popups_posts.set(et,pn);\r\n  //        site2['DEFAULT'].popup_info = null;\r\n          if (pref.debug_mode['10']) console.log('popup: '+th_q[1]+': '+site2[th.domain].popups_debug(th_q[0]));\r\n  //        }\r\n          adjust_pos(pn,e);\r\n          gGEH.pns_all_keys.set(pn,dbt[0]+dbt[1]+dbt[2]);\r\n          return key? {pn:pn, key:key} : {pn:pn};\r\n        }\r\n        gGEH.triage_in2 = out;\r\n        return {\r\n          over: over,\r\n          pop_load: pop_load,\r\n          pop_load_req_delete, pop_load_req_delete,\r\n        };\r\n      })();\r\n\r\n      var preview = (function(){\r\n        var up_th = up_timer_factory();\r\n        var on_th = null;\r\n        function th_over(e){\r\n          var pf3 = pref[cataLog.embed_mode].popup3;\r\n          if (pf3.ww==='no' && pf3.wn==='no' && pf3.nw==='no' && pf3.nn==='no') return;\r\n          var tgt = geh.recSearch_thread(e.target, e.currentTarget);\r\n          if (tgt) {\r\n            if (up_th.up_timer && up_th.src===tgt) return;\r\n            th_out(e);\r\n            up_th.src = tgt;\r\n            up_th.over(pf3, e, pop_up_th, tgt);\r\n          } else th_out(e);\r\n        }\r\n        function th_out(e){\r\n          var pn_ex = up_th.out(e);\r\n          if (pn_ex===true) return;\r\n          var tgt = geh.recSearch_thread(e.relatedTarget,e.currentTarget);\r\n          if (tgt) out_1_if_exists(tgt,pn_ex);\r\n          else if (on_th) out_1_if_exists(on_th,pn_ex);\r\n          on_th = null;\r\n        }\r\n        function pop_up_th(e){\r\n  //        if (pns.has(up_th.src)) {clear_down_timer(pns.get(up_th.src)); return;}\r\n          var name = gGEH.get_key_recursive(up_th.src, document);\r\n//          var name = up_th.src.name;\r\n          var pf = pref[cataLog.embed_mode].popup3;\r\n          var pna = pns.get(up_th.src) || [];\r\n          if (!pref.test_mode['110']) pop_up_th_1(pf.ww, e, name, pna, 0, false, false);\r\n          pop_up_th_1(pf.wn, e, name, pna, 1, false, true);\r\n          pop_up_th_1(pf.nw, e, name, pna, 2, true, false);\r\n          pop_up_th_1(pf.nn, e, name, pna, 3, true, true);\r\n          on_th = up_th.src\r\n          up_th.src = null;\r\n        }\r\n        function pop_up_th_1(kind, e, name, pna, idx, narrow_x, narrow_y, kwd, kwd_src){ // kwd for popupID\r\n          if (kind==='no') return;\r\n          if (pna[idx]) {clear_down_timer(pns.get(pna[idx])); return;}\r\n          var pn = document.createElement('div');\r\n          pn.setAttribute('class', pref.script_prefix+'_window');\r\n  //        pn.style.width = '200px';\r\n  //        pn.style.height = '200px';\r\n          pn.style.position = 'fixed';\r\n  //        pn.style.backgroundColor = 'red';\r\n  //        pn.innerHTML = up_th.src.getAttribute('id');\r\n          pn.style.border = '1px solid blue';\r\n          if (kind!=='chart') if (!cataLog.pop_up_set_contents(pn, kind, name, kwd)) return;\r\n          pn.addEventListener(brwsr.mousewheel, cnst.div_scroll, false);\r\n          set_pos(pn, e, false, narrow_x, narrow_y);\r\n          pna[idx] = site.popup_body.appendChild(pn); // for chart, must be preceded before making chart.\r\n          if (pref.catalog_popup_size_fix) {\r\n            pn.style.width  = pn.offsetWidth + 'px';\r\n            pn.style.height = pn.offsetHeight + 'px';\r\n          }\r\n          if (kind==='chart') {\r\n            if (chart_obj && pref3.stats.use) {\r\n              var chart = new chart_obj.PostChart(pn,[name]); // must be after appendChild to draw. (just to call destroy?)\r\n            } else pn.innerHTML = 'Statistics needs to be activated.';\r\n          }\r\n          var btn = document.createElement('button');\r\n          common_func.overwrite_prop(btn.style, {position:'absolute', top:'0px', left:'0px'});\r\n          btn.classList.add(pref.script_prefix+'_autoTp');\r\n          btn.appendChild(site2[site.nickname].make_tack());\r\n          pn.appendChild(btn);\r\n          btn.onclick = function(e){\r\n            var btn = e.currentTarget;\r\n            var pn = btn.parentNode;\r\n            cnst.bottom_top(pn);\r\n            var pn2;\r\n            var chart = pop_down(pn,true).chart;\r\n            if (chart) {\r\n              var tn = document.createElement('div');\r\n              var tn_imgs = site2[common_func.name2dbt(name)[0]].parse_funcs['catalog_html'].tn_imgs({pn:cataLog.threads[name][0]});\r\n              if (tn_imgs[0]) tn.appendChild(tn_imgs[0].cloneNode());\r\n//              if (site.nickname==='4chan') tn.appendChild(cataLog.threads[name][0].getElementsByTagName('img')[0].cloneNode());\r\n              else tn.innerHTML = name;\r\n              common_func.overwrite_prop(tn.style, {position:'absolute', bottom:'0px', left:'0px', opacity:0.4});\r\n              pn.replaceChild(tn,btn);\r\n              pn2 = chart_obj.PostChart.call(chart, null,null,chart);\r\n              pn2.childNodes[1].replaceChild(pn, pn2.childNodes[1].childNodes[1]);\r\n            } else {\r\n              pn.removeChild(btn);\r\n              pn2 = cnst.init3({func_str:'Show:tb'}).pn;\r\n              pn2.appendChild(pn);\r\n            }\r\n            pn2.style.top = parseInt(pn.style.top,10) - pn2.offsetHeight + 'px';\r\n            pn2.style.left = pn.style.left;\r\n            common_func.overwrite_prop(pn.style, {position:'relative', border:null, top:null, left:null});\r\n          };\r\n          if (kwd) pop_setup(kwd_src, pn, {src:kwd_src, scroll:true, pf:pfX});\r\n          else pop_setup(up_th.src, pn, chart? {src:up_th.src, chart:chart, scroll:true, pf:pf} : {src:up_th.src, scroll:true, pf:pf}, pna);\r\n        }\r\n        function pfX(){return pref.proto.popupX;}\r\n        function pf(){return pref.proto.popup3;}\r\n        return {\r\n          init: function(pn){\r\n            site.root_body.addEventListener('mouseover',th_over,false);\r\n//            pn.addEventListener('mouseover',th_over,false);\r\n            pn.addEventListener('mouseleave',th_out,false);\r\n            gGEH.triage_in = th_out; // for triage\r\n          },\r\n          destroy: function(pn){\r\n            site.root_body.removeEventListener('mouseover',th_over,false);\r\n//            pn.removeEventListener('mouseover',th_over,false);\r\n            pn.removeEventListener('mouseleave',th_out,false);\r\n          },\r\n          pop_up_th_1: pop_up_th_1, // for popupID\r\n        }\r\n      })();\r\n      var popupSurface = (function(){\r\n        var et = null;\r\n        function popup_make(e, kwd, exact_match){\r\n          var key = gGEH.get_key_recursive(e.target, e.currentTarget);\r\n          if (!key) return;\r\n          kwd.rexps = common_func.kwd_prep_regexp(kwd, exact_match);\r\n          preview.pop_up_th_1('sr', e, key, [], 4, false, false, kwd, e.target);\r\n          et = e.target;\r\n        }\r\n        return {\r\n          X: function(e){\r\n            var pf = pref[cataLog.embed_mode].popupX;\r\n            if (pf.ID) {\r\n              var id = geh.getID(e.target);\r\n              if (id) return popup_make(e, {str:id, id:true});\r\n            }\r\n            if (pf.flag) {\r\n              var country = geh.getCountry(e.target);\r\n              if (country) return popup_make(e, {str:country, flag:true});\r\n            }\r\n            if (pf.name) {\r\n              var name = geh.getName(e.target);\r\n              if (!pref.anon && name==='Anonymous') return;\r\n              if (name) return popup_make(e, {str:name, name:true, sentence:true}, true);\r\n            }\r\n            if (pf.trip) {\r\n              var trip = geh.getTrip(e.target);\r\n              if (trip) return popup_make(e, {str:trip, trip:true}, true);\r\n            }\r\n          },\r\n          get et(){return et;},\r\n          set et(v){et=v;},\r\n//          ID: function(e){\r\n//            var key = gGEH.get_key_recursive(e.target, e.currentTarget);\r\n//            if (!key) return;\r\n//            var id = geh.getID(e.target);\r\n//            var kwd = {str:id, match:0, id:true, rexps:null};\r\n//            kwd.rexps = common_func.kwd_prep_regexp(kwd);\r\n//            preview.pop_up_th_1('sr', e, key, [], 4, false, false, kwd, e.target);\r\n//          },\r\n//          Flag: function(e){\r\n//            var key = gGEH.get_key_recursive(e.target, e.currentTarget);\r\n//            if (!key) return;\r\n//            var country = geh.getCountry(e.target);\r\n//            var kwd = {match:0, flag:true, rexps:[new RegExp(country)]};\r\n//            preview.pop_up_th_1('sr', e, key, [], 4, false, false, kwd, e.target);\r\n//          },\r\n//          Name: function(e){\r\n//            var key = gGEH.get_key_recursive(e.target, e.currentTarget);\r\n//            if (!key) return;\r\n//            var name = geh.getName(e.target);\r\n//            if (!pref.proto.popupName.anon && name==='Anonymous') return;\r\n//            var kwd = {str:name, match:0, name:true, rexps:null};\r\n//            kwd.rexps = common_func.kwd_prep_regexp(kwd, true);\r\n//            preview.pop_up_th_1('sr', e, key, [], 4, false, false, kwd, e.target);\r\n//          },\r\n//          Trip: function(e){\r\n//            var key = gGEH.get_key_recursive(e.target, e.currentTarget);\r\n//            if (!key) return;\r\n//            var trip = geh.getTrip(e.target);\r\n//            var kwd = {str:trip, match:0, trip:true, rexps:null};\r\n//            kwd.rexps = common_func.kwd_prep_regexp(kwd, true);\r\n//            preview.pop_up_th_1('sr', e, key, [], 4, false, false, kwd, e.target);\r\n//          }\r\n        };\r\n      })();\r\n      var triage = (function(){\r\n        function th_over(e){\r\n          var tgt = geh.recSearch_thread(e.target, e.currentTarget); // redundant, this can be merged with preview.th_over\r\n          if (tgt) {\r\n            var name = gGEH.pns_all_keys.get(tgt) || gGEH.pns_all_keys.get(tgt.parentNode); // tgt.parentNode for vichan catalog\r\n            if (name) return cataLog.triage.thread_in(tgt, name);\r\n          }\r\n          cataLog.triage.thread_out2(e); // onTriage_or_off(e);\r\n        }\r\n        return {\r\n          init: function(pn){site.root_body.addEventListener('mouseover',th_over,false);},\r\n          destroy: function(pn){site.root_body.removeEventListener('mouseover',th_over,false);},\r\n        }\r\n      })();\r\n      return {\r\n        over: over,\r\n        leave: up0.stop,\r\n        pop_load: posts.pop_load,\r\n        blacklist: blacklist,\r\n        set_pos: set_pos, // to be removed.\r\n        href2domain: href2domain,\r\n        init: function(pn){\r\n          geh = site2[site.nickname].general_event_handler[site.whereami];\r\n          if (!pref.test_mode['110'] && cataLog.embed_mode==='catalog') preview.init(pn);\r\n          if (!pref.test_mode['127']) triage.init();\r\n        },\r\n      };\r\n    })(),\r\n    popups_posts_class_hlt: 'highlighted',\r\n//    popups_op_func_set: function(){return 1;}, // vichan\r\n//    popups_op_func_use: function(pn,thq,no){ // vichan\r\n//      pn.setAttribute('class',pn.getAttribute('class')+' reply');\r\n////      pn.insertBefore(thq[no].pn.parentNode.querySelector('.files').cloneNode(true),pn.firstChild);\r\n//    },\r\n    popups_post_fetch: function(th, dbt){\r\n      cataLog.scan_init('popup',[th.domain+dbt[1]+((pref.catalog.catalog_json)? 't':'')+dbt[2]], {priority:8});\r\n    },\r\n//    popup_info:null,\r\n//    popups_posts: new WeakMap(),\r\n    popups_post_pnode: function(pnode){\r\n      if (pref.test_mode['107']) return site.popup_body;\r\n      if (!pref.test_mode['106']) {\r\n        var p = pnode.parentNode;\r\n        while (p) if (p===cataLog.parent) return site.popup_body; else p = p.parentNode;\r\n      }\r\n      var attr;\r\n      while (attr = pnode.getAttribute('class'), (!attr || (attr.indexOf('post')==-1 && attr.indexOf('thread')==-1)) && pnode.parentNode) pnode = pnode.parentNode;\r\n      return pnode;\r\n    },\r\n    \r\n//    popups_href2dbtp: function(href, src, th){\r\n//      if (href[0]==='#') {\r\n//        href = th.board+'res/'+th.no+'.html'+href;\r\n//        src.setAttribute('href',href);\r\n//      }\r\n//      var hrefs = href.split('/');\r\n//      var p = hrefs[hrefs.length-1].substr(hrefs[hrefs.length-1].indexOf('#')+1);\r\n//      var t = hrefs[hrefs.length-1].substr(0,hrefs[hrefs.length-1].indexOf('.'));\r\n//      var b = (hrefs.length>=3)? '/'+hrefs[hrefs.length-3]+'/' : site.board;\r\n//      var d = this.nickname;\r\n//      return [d,b,t,p];\r\n//    },\r\n    popups_href2th_q: function(href){ //,src,th){\r\n      var dbt = this.popups_href2dbtp(href); // ,src,th);\r\n//      var th = liveTag.mems[d][b][t];\r\n      if (!dbt[0] || !dbt[1] || !dbt[2]) return null; // hit this line when dbt[2]==='' caused by '>>>/a/'\r\n      var lth = liveTag.mems.init({domain:dbt[0], board:dbt[1], no:parseInt(dbt[2],10)});\r\n      if (lth.q===undefined) lth.q = (lth.no>1000000)? Object.create(lth) : Object.create({0:undefined, 1:undefined, 2:undefined, __proto__:lth}); // PATCH before removing [0:2] // crosslink, CYCLIC REFERENCE.\r\n//      if (!liveTag.mems[dbt[0]][dbt[1]][dbt[2]] || !liveTag.mems[dbt[0]][dbt[1]][dbt[2]].q) return null; // patch for accessibility check. 'if (!th)' doesn't work. // WHY??? // HIT THIS LINE WHEN dbt[2]===''.\r\n      return [liveTag.mems[dbt[0]][dbt[1]][dbt[2]].q, parseInt(dbt[3],10), dbt];\r\n    },\r\n////    popups_add: function(posts, posts_old, th){ // working code.\r\n////      if (!posts_old) posts_old = [];\r\n////      var th_q0 = liveTag.mems[th.domain][th.board][th.no];\r\n////      if (th_q0.q===undefined) th_q0.q = {};\r\n////      var thq = th_q0.q;\r\n////      if (posts) for (var i=0;i<posts.length;i++) Object.defineProperty(posts[i],'no',{value:th.parse_funcs.no(posts[i])});\r\n////      if (posts && posts.length!=0) {\r\n//////        for (var i=0;i<posts.length;i++) Object.defineProperty(posts[i],'no',{value:parseInt(posts[i].pn.getElementsByClassName('post_no')[1].textContent,10)});\r\n//////        if (posts_old.length!=0) while (posts_old[0].no<posts[0].no) this.popups_release(posts_old.shift()); // [0] is OP\r\n////        if (posts.length>1) while (posts_old.length>1 && posts_old[1].no<posts[1].no) this.popups_release(posts_old.splice(1,1)[0]);\r\n////      }\r\n////      if (posts) {\r\n////        for (var i=0;i<posts.length;i++) {\r\n////          var flag_old = posts_old.length!=0 && posts_old[posts_old.length-1].no>posts[i].no;\r\n////          var tgts = [];\r\n////          var as = posts[i].pn.getElementsByTagName('a');\r\n////          for (var j=0;j<as.length;j++)\r\n////            if (as[j].textContent.search(/>>[0-9]+$/)!=-1) {\r\n////              as[j].onmouseover = this.popups_post_entry;\r\n////              if (!flag_old) {\r\n////                var th_q = site2[th.domain].popups_href2th_q(as[j].getAttribute('href'),as[j],th);\r\n////                if (th_q) {\r\n////                  tgts[tgts.length] = as[j].getAttribute('href');\r\n////                  this.popups_grep(th_q[0],th_q[1]);\r\n////                }\r\n////              }\r\n////            }\r\n////          if (!flag_old) {\r\n////            posts_old[posts_old.length] = (tgts.length!==0)? {no:posts[i].no, tgts:tgts, thq:thq} : {no:posts[i].no, thq:thq};\r\n////            this.popups_grep(thq,posts[i].no);\r\n////            this.popups_set(thq,posts[i].no,posts[i]);\r\n////            if (i===0) thq[posts[i].no].isOP = 1;\r\n////          }\r\n////        }\r\n////      } else while (posts_old.length>1) this.popups_release(posts_old.shift());\r\n////      if (pref.debug_mode['10']) {\r\n////        var d_str = '';\r\n////        for (var i in thq) d_str += i+':'+((thq[i].reffered)? thq[i].reffered : thq[i])+', ';\r\n////        console.log('popups_add :'+th.key+': '+d_str);\r\n////      }\r\n////      return posts_old;\r\n////    },\r\n////    popups_grep: function(thq, no){\r\n////      if (thq[no]===undefined) thq[no] = 1; // waiting to be filled, but not make requests.\r\n////      else if (typeof(thq[no])==='number') thq[no] = thq[no] + ((thq[no]<0)? -1 : 1);\r\n////      else ++thq[no].reffered;\r\n////    },\r\n////    popups_set: function(thq, no, val){\r\n////      if (typeof(thq[no])==='number') {\r\n////        thq[no] = val;\r\n////        thq[no].reffered = (val_old>=0)? val_old : -val_old;\r\n////      }\r\n////    },\r\n////    popups_release_1: function(th_q){\r\n////      if (th_q) {\r\n////        if (typeof(th_q[0][th_q[1]])==='number') {\r\n////          th_q[0][th_q[1]] -= (th_q[0][th_q[1]]<0)? -1 : 1;\r\n////          if (th_q[0][th_q[1]]===0) delete th_q[0][th_q[1]];\r\n////        } else if (--th_q[0][th_q[1]].reffered===0) delete th_q[0][th_q[1]];\r\n////      }\r\n////    },\r\n////    popups_release: function(post){\r\n////      if (post.tgts)\r\n////        for (var i=0;i<post.tgts.length;i++)\r\n////          this.popups_release_1(site2[site.nickname].popups_href2th_q(post.tgts[i])); // TEMPORAL\r\n////      this.popups_release_1([post.thq, post.no]);\r\n////      if (pref.debug_mode['10']) {\r\n////        var d_str = '';\r\n////        for (var i in thq) d_str += i+':'+((thq[i].reffered)? thq[i].reffered : thq[i])+', ';\r\n////        console.log('popups_release :'+post.no+': '+d_str);\r\n////       }\r\n////    },\r\n    popups_add: function(posts, th, deactivate, from_native, release){\r\n      var lth = liveTag.mems[th.domain][th.board][th.no];\r\n      if (lth.q===undefined) lth.q = ( th.no>1000000)? Object.create(lth) : Object.create({0:undefined, 1:undefined, 2:undefined, __proto__:lth}); // PATCH before removing [0:2] // usual, lth.q is made in popups_href2th_q if crosslink. CYCLIC REFERENCE.\r\n      if (posts) if (th.type_data==='html') {for (var i=0;i<posts.length;i++) if (!posts[i].no) Object.defineProperty(posts[i],'no',{value:th.parse_funcs.no(posts[i])});}\r\n//                 else for (var i=0;i<posts.length;i++) if (!posts[i].pn) posts[i].pn = this.post_json2html(posts[i],th.board);\r\n      var posts_exist = {};\r\n      if (posts) {\r\n        for (var i=0;i<posts.length;i++) {\r\n          var post_no = posts[i].no;\r\n          posts_exist[post_no] = null;\r\n          if (lth.q[post_no]===undefined || Array.isArray(lth.q[post_no])) this.popups_add_1(th, posts[i], deactivate, lth.q, true, from_native); // may cause multiple entry because lth.q[post_no] will be deleted even if it is shown when the post is not reffered from other posts of the same thread but there is a cross link and the post of the cross link is changed to not shown. This invokes emurational recursive call of popups_release to delete lth.q[post_no]. But this is OK because popups_add_1 admits multiple entry, you can call it any times.\r\n        }\r\n      }\r\n      if (!pref[cataLog.embed_mode].backlink_all && (release || pref.test_mode['125'])) this.popups_release_all(lth, posts_exist);\r\n    },\r\n    popups_release_all: function(lth, posts_exist){\r\n      var lth_q_ps = Object.keys(lth.q);\r\n      for (var i=0;i<lth_q_ps.length;i++)\r\n        if (posts_exist[lth_q_ps[i]]===undefined && lth_q_ps[i]!=='waiting') this.popups_release(lth, lth_q_ps[i]);\r\n    },\r\n//    popups_add: function(tgt_th16, th, deactivate, from_native){ // working code.\r\n//      var posts = tgt_th16.posts;\r\n//      if (!tgt_th16.popups) tgt_th16.popups = Object.create(null);\r\n//      var popups = tgt_th16.popups;\r\n//      var lth = liveTag.mems[th.domain][th.board][th.no];\r\n//      if (lth.q===undefined) lth.q = ( th.no>1000000)? Object.create(lth) : Object.create({0:undefined, 1:undefined, 2:undefined, __proto__:lth}); // PATCH before removing [0:2] // usual, lth.q is made in popups_href2th_q if crosslink. CYCLIC REFERENCE.\r\n//      if (posts) if (th.type_data==='html') {for (var i=0;i<posts.length;i++) if (!posts[i].no) Object.defineProperty(posts[i],'no',{value:th.parse_funcs.no(posts[i])});}\r\n////                 else for (var i=0;i<posts.length;i++) if (!posts[i].pn) posts[i].pn = this.post_json2html(posts[i],th.board);\r\n//      var posts_exist = {};\r\n//      if (posts) {\r\n//        for (var i=0;i<posts.length;i++) {\r\n//          var post_no = posts[i].no;\r\n//          posts_exist[post_no] = null;\r\n//          if (popups[post_no]===undefined) {\r\n//            this.popups_add_1(th, posts[i], deactivate, lth.q, true, from_native);\r\n//            popups[post_no] = null;\r\n//          }\r\n//        }\r\n//      }\r\n//      if (!pref.catalog.filter.kwd.posts_active) for (var i in popups) {\r\n//        if (posts_exist[i]===undefined) {\r\n////          this.popups_release(popups[i], i, th.key); // BUG???\r\n//          this.popups_release(lth, i);\r\n//          delete popups[i];\r\n//        }\r\n//      }\r\n////      if (posts) site2[th.domain_html].format_pn(posts[0].pn, lth.q[th.no]); // PROBABLY THIS IS REDUNDANT, BUT NOT DEBUGGED.\r\n////      if (pref.debug_mode['10']) this.popups_debug('popups_add: '+th.no+': ', lth.q);\r\n//    },\r\n    popups_add_1_cross: function(th, posts, cross){ // called before wrapped\r\n      for (var j=0;j<posts.length;j++) {\r\n        var hrefs = th.parse_funcs.hrefs(posts[j]);\r\n        if (hrefs) for (var i=0;i<hrefs.length;i++) {\r\n          if (hrefs[i][0]==='#') continue;\r\n          if (!cross && hrefs[i].indexOf(th.board)!==0) continue;\r\n          var th_q = site2[th.domain].popups_href2th_q(hrefs[i]);\r\n          if (th_q) {\r\n            var skey = th_q[2][0]!==th.domain? th.key : th_q[2][1]!==th.board? th.board+th.no : th_q[2][2]!=th.no? th.no : null;\r\n            if (skey!==null) site2[th.domain_html].popups_add_backlink(th_q[0],th_q[1], skey+'#'+posts[j].no, th, false, false);\r\n          }\r\n        }\r\n      }\r\n    },\r\n//        var link_regex = />>[0-9]+$|>>>\\/[0-z_]+\\/[0-9]+$/;\r\n//        var link_regex = />>(>\\/.+\\/)*[0-9]+$/;\r\n//    popups_link_regex: />>(>\\/.+\\/)*[0-9]+(\\s\\(You\\))*$/, // patch for '(You)'\r\n    popups_link_regex: /^>>(>\\/[^/]+\\/)*[0-9]+/, // patch for '(You)' and '(OP)'\r\n    popups_add_1: function(th, post, deactivate, thq, dig, from_native){\r\n      if (!post.pn) post.pn = site2[th.domain_html].post_json2html(post,th.board);\r\n      var as = site2[th.domain_html].post_pn2ce(post.pn).getElementsByTagName('a');\r\n      var nof_flinks = as.length;\r\n      if (deactivate && pref[cataLog.embed_mode].env.backlink_native) {\r\n        var bks = site2[th.domain_html].add_backlinks_bks_query(post.pn);\r\n        if (bks) as = Array.prototype.slice.call(as).concat(Array.prototype.slice.call(bks.getElementsByTagName('a'))); // direct call of concat causes error.\r\n      }\r\n      if (as.length>0) {\r\n        var op_regexp = new RegExp('^>>'+th.no+'(\\\\s|\\\\(|$)');\r\n        var quotes = [];\r\n        for (var j=0;j<as.length;j++) {\r\n  //        if (as[j].textContent.search(/>>[0-9]+$/)!=-1) {\r\n          var as_txt = as[j].textContent;\r\n          if (as_txt.search(this.popups_link_regex)!=-1) {\r\n            if (deactivate) {\r\n              if (pref[cataLog.embed_mode].env.popup_native_kill) as[j].parentNode.replaceChild(as[j].cloneNode(true),as[j]);\r\n              else this.popups_posts.blacklist.add(as[j]);\r\n            }\r\n            if (j>=nof_flinks) continue;\r\n//            if (activate) as[j].onmouseover = this.popups_post_entry;\r\n            var th_q = site2[th.domain].popups_href2th_q(as[j].getAttribute('href')); // ,as[j],th); // this may change href, so this must be here. <- FIXED.\r\n            if (pref[cataLog.embed_mode].link_show_op && as_txt.search(op_regexp)===0 && as_txt.indexOf('(OP)')==-1) as[j].textContent += ' (OP)';\r\n            if (pref[cataLog.embed_mode].link_show_cross && th_q && th_q[0]!=thq) as[j].textContent += ' \\u2192';\r\n  //          var a_class = as[j].parentNode.getAttribute('class');\r\n  //          if (!a_class || a_class.indexOf(site2[th.domain_html].backlink_class)==-1) { // skip backlinks\r\n              if (th_q) {\r\n                quotes[quotes.length] = [th_q[0], th_q[1]]; // quotes may be multiple.\r\n//                quotes[quotes.length] = [thq, th_q[1]]; // quotes may be multiple.  // use 'thq' instead of 'th_q[0]' for test_mode['80'] // BUG. MUST USE th_q[0]\r\n                var skey = th_q[2][0]!==th.domain? th.key : th_q[2][1]!==th.board? th.board+th.no : th_q[2][2]!=th.no? th.no : null;\r\n                site2[th.domain_html].popups_add_backlink(th_q[0],th_q[1], skey!==null? skey+'#'+post.no : post.no, th, dig, from_native);\r\n//                site2[th.domain_html].popups_add_backlink(thq,th_q[1], skey!==null? skey+'#'+post.no : post.no, th, dig);\r\n              }\r\n  //          }\r\n          }\r\n        }\r\n      }\r\n      this.popups_set(thq,post.no,post, quotes && quotes.length!=0 && quotes);\r\n//      if (op) thq[post.no].isOP = site2[th.domain_html].popups_op_func_set(post.pn);\r\n    },\r\n    popups_add_backlink: function(thq, no, key, th, dig, from_native){\r\n      if (thq[no]===undefined) {\r\n        thq[no] = [key];\r\n        if (dig) this.popups_set_waiting(thq,no);\r\n      } else if (Array.isArray(thq[no])) {\r\n        if (thq[no].indexOf(key)==-1) {\r\n          thq[no][thq[no].length] = key;\r\n          if (dig) this.popups_set_waiting(thq,no); // may not waiting because of 'dig'.\r\n        }\r\n      } else {\r\n        if (!thq[no].backlinks) thq[no].backlinks = [];\r\n        var blks = thq[no].backlinks;\r\n        if (blks.indexOf(key)==-1) {\r\n          blks[blks.length] = key;\r\n          if (thq[no].pn) if (pref[cataLog.embed_mode].backlink && (!pref[cataLog.embed_mode].env.backlink_native || !from_native)) site2[th.domain_html].add_backlinks(thq[no].pn, blks, blks.length-1, th);\r\n        }\r\n      }\r\n    },\r\n    add_backlinks: function(pn,backlinks,target, th){ // this refers site2[domain_html]\r\n      var bks_pn = this.add_backlinks_bks_query(pn);\r\n      var bks = bks_pn || this.add_backlinks_bks();\r\n      if (!target) bks.innerHTML = ''; // this hits target===0 also and clean up.\r\n      for (var i=(target || 0);i<backlinks.length;i++) {\r\n        this.add_backlinks_add_1(bks, this.popups_backlink2dbtpth(backlinks[i], th));\r\n        if (target) break;\r\n      }\r\n      if (!bks_pn) this.add_backlinks_bks_append(pn, bks);\r\n    },\r\n    popups_backlink2dbtpth: function(backlink, th){\r\n      var dbtp;\r\n      var dbtpth = (typeof(backlink)==='number')? [th.domain, th.board, th.no, backlink, '>>'+backlink]\r\n          : (dbtp = backlink.split(/[\\/#]/),\r\n             dbtp.length==2? [th.domain, th.board, dbtp[0], dbtp[1], '>>'+(pref.proto.bl_ec? dbtp[0]+'#':'')+dbtp[1]]\r\n                           : [dbtp[0] || th.domain, '/'+dbtp[1]+'/', dbtp[2], dbtp[3], (dbtp[0]? '>>>>'+dbtp[0]:'>>>')+'/'+dbtp[1]+'/'+(pref.proto.bl_ec? dbtp[2]+'#':'')+dbtp[3]]);\r\n      dbtpth[5] = site2[dbtpth[0]].link_dbtp2href_abs(dbtpth); // don't use 'this', 'this' refers site2[domain_html], not site2[domain].\r\n      return dbtpth;\r\n    },\r\n    remove_backlink: function(pn,idx){}, // dummy\r\n    popups_remove_backlink: function(thq, no, key){\r\n      if (!thq[no]) return; // 'quotes' may be multiple, then hit this line.\r\n      var ary = (Array.isArray(thq[no]))? thq[no] : thq[no].backlinks;\r\n      var idx = ary.indexOf(key);\r\n      if (idx>=0) {\r\n        ary.splice(idx,1);\r\n        if (thq.no===no && pref.proto.bl_rm) if (thq[no]) this.remove_backlink(thq[no].pn, idx); // remove op only for faster execution. // includes cross link\r\n//        if (ary.length===0) return true; // prevent from infinite loop by reference loop of anchors.\r\n      }\r\n////      else console.log('ERROR in handling popups ' + no+', '+key+', '+thq[no].backlinks); // quotes allows multiple, but backlink doesn't, deletion of a post which has multiple links to a post hits this line.\r\n////      if (ary.length===0 && thq[no].remove_if_no_backlinks) delete thq[no];\r\n////      if (pref.debug_mode['10']) console.log('popups_remove_backlink: '+(idx>=0?'suc':'fail')+', '+no+'<-'+key+':    '+this.popups_debug(thq));\r\n////      if (ary.length===0) return true;\r\n    },\r\n    popups_set: function(thq, no, val, quotes){\r\n      if (no<=2) if (!Object.hasOwnProperty.call(thq,no)) thq[no] = undefined; // PATCH before renaming, now thq has prototype, [0][1] or [2] returns tags or watch.\r\n      if (thq[no]===undefined) {\r\n        if (val.backlinks) val.backlinks = undefined; // PATCH FOR MEGUCA, meguca has backlinks in native.\r\n      } else if (Array.isArray(thq[no])) {\r\n        val.backlinks = thq[no];\r\n      } else { // for multiple entry at editing===true, update thq[no].\r\n        if (thq[no].backlinks) val.backlinks = thq[no].backlinks;\r\n      }\r\n      thq[no] = val;\r\n      if (quotes) thq[no].quotes = quotes;\r\n      if (val.editing) this.popups_set_waiting(thq,no); // keep updating while editing by 'popups_fetched'\r\n      this.popups_remove_waiting(thq,no);\r\n    },\r\n    popups_release: function(lth, no){ // in-place, on-demand ver.\r\n      var quotes = [];\r\n      var i=0;\r\n      if (pref.debug_mode['12']) var initial_cond = {no:no, lth:lth, len:debug_len(lth)};\r\n      prep_quotes.call(this, lth, no);\r\n      while (--i>=0) {\r\n        var tgt = quotes[i];\r\n        lth = tgt[0];\r\n        no  = tgt[1];\r\n        if (tgt.length==3) {\r\n          var q = tgt[2][0];\r\n          var p = tgt[2][1];\r\n          var skey = q.domain!==lth.domain? lth.key : q.board!==lth.board? lth.board+lth.no : q.no!=lth.no? lth.no : null;\r\n          this.popups_remove_backlink(q, p, skey!==null? skey+'#'+no : parseInt(no,10));\r\n          prep_quotes.call(this, Object.getPrototypeOf(q), p); // emulates recursive call // overwrite for in-place\r\n        } else delete lth.q[no];\r\n//        } else {\r\n//          if (lth.no!=no && lth.q && lth.q[no])\r\n//            if (!lth.q[no].backlinks || lth.q[no].backlinks.length===0) delete lth.q[no];\r\n////            else if (lth.q[no].quote) lth.q[no].quote = null; // nullify for strict accordance, but redundant.\r\n////          if (pref.debug_mode['10']) console.log('popups_release: '+no+':    '+this.popups_debug(lth.q));\r\n//        }\r\n      }\r\n      if (pref.debug_mode['12']) {\r\n        var len = debug_len(initial_cond.lth);\r\n        if (len!==initial_cond.len) console.log('popups_release: '+initial_cond.lth.key+': '+len+' <- '+initial_cond.len+', '+initial_cond.no+\r\n                                                ((pref.debug_mode['10'])? '    '+this.popups_debug(lth.q):''));}\r\n      function prep_quotes(lth, no){\r\n        if (lth.no!=no && lth.q && lth.q[no]) { // lth.q is nullfied when the thread was pruned.\r\n          var ary = (Array.isArray(lth.q[no]))? lth.q[no] : lth.q[no].backlinks;\r\n          if (!ary || ary.length===0) {\r\n            this.popups_remove_waiting(lth.q,no);\r\n            quotes[i++] = [lth, no];\r\n            var qts = lth.q && lth.q[no] && lth.q[no].quotes; // lth may refer archived thread, which never have loaded.\r\n            if (qts) for (var j=qts.length-1;j>=0;j--) quotes[i++] = [lth, no, qts[j]];\r\n          }\r\n        }\r\n      }\r\n      function debug_len(lth){\r\n        var nos = Object.keys(lth.q);\r\n        return nos.length - (nos.indexOf('waiting')==-1? 0:1);\r\n      }\r\n    },\r\n//    popups_release: function(lth, no){ // in-place, on-demand ver. // working code.\r\n//      var quotes = [];\r\n//      var i=0;\r\n//      if (pref.debug_mode['12']) var initial_cond = {no:no, lth:lth, len:Object.keys(lth.q).length};\r\n//      prep_quotes(lth, no);\r\n//      while (--i>=0) {\r\n//        var tgt = quotes[i];\r\n//        lth = tgt[0];\r\n//        no  = tgt[1];\r\n//        if (tgt.length==4) {\r\n//          var q = tgt[2];\r\n//          var p = tgt[3];\r\n//          var skey = q.domain!==lth.domain? lth.key : q.board!==lth.board? lth.board+lth.no : q.no!=lth.no? lth.no : null;\r\n//          if (this.popups_remove_backlink(q, p, skey!==null? skey+'#'+no : parseInt(no,10))) { // only true if removed successfully, this prevents infinite loop by reference loop.\r\n//            this.popups_remove_waiting(q,p);\r\n//            prep_quotes(Object.getPrototypeOf(q), p);// emulates recursive call // overwrite for in-place\r\n//          }\r\n//        } else {\r\n//          if (lth.no!=no && lth.q && lth.q[no])\r\n//            if (!lth.q[no].backlinks || lth.q[no].backlinks.length===0) delete lth.q[no];\r\n////            else if (lth.q[no].quote) lth.q[no].quote = null; // nullify for strict accordance, but redundant.\r\n////          if (pref.debug_mode['10']) console.log('popups_release: '+no+':    '+this.popups_debug(lth.q));\r\n//        }\r\n//      }\r\n//      if (pref.debug_mode['12']) console.log('popups_release: '+initial_cond.lth.key+': '+Object.keys(initial_cond.lth.q).length+' <- '+initial_cond.len+', '+initial_cond.no+\r\n//                                             ((pref.debug_mode['10'])? '    '+this.popups_debug(lth.q):''));\r\n//      function prep_quotes(lth, no){\r\n//        quotes[i++] = [lth, no];\r\n//        var qts = lth.q && lth.q[no] && lth.q[no].quotes; // lth may refer archived thread, which never have loaded.\r\n//        if (qts) for (var j=qts.length-1;j>=0;j--) quotes[i++] = [lth, no, qts[j][0], qts[j][1]];\r\n//      }\r\n//    },\r\n//    popups_release: function(lth, no){ // working code. loop ver.\r\n//      var quotes = format_quotes(lth, no, lth.q[no].quotes);\r\n//      while (quotes.length>0) {\r\n//        var tgt = quotes.shift();\r\n//        lth = tgt[0];\r\n//        no  = tgt[1];\r\n//        if (tgt.length==4) {\r\n//          var q = tgt[2];\r\n//          var p = tgt[3];\r\n//          var skey = q.domain!==lth.domain? lth.key : q.board!==lth.board? lth.board+lth.no : q.no!=lth.no? lth.no : null;\r\n//          if (this.popups_remove_backlink(q, p, skey? skey+'#'+no : parseInt(no,10))) {\r\n//            this.popups_remove_waiting(q,p);\r\n//            var lth_next = Object.getPrototypeOf(q);\r\n//            quotes = format_quotes(lth_next, p, lth_next.q[p].quotes).concat(quotes); // emulates recursive call\r\n//            lth_next.q[p].quotes = null; // prevent from infinite loop by reference loop of anchors.\r\n//          }\r\n//        } else {\r\n//          if (lth.no!=no && (!lth.q[no].backlinks || lth.q[no].backlinks.length===0)) delete lth.q[no];\r\n//          if (pref.debug_mode['10']) console.log('popups_release: '+no+':    '+this.popups_debug(lth.q));\r\n//        }\r\n//      }\r\n//      function format_quotes(lth,no, quotes){\r\n//        return (quotes)? quotes.map(function(v){return [lth, no].concat(v);}).concat([[lth, no]]) : [[lth, no]];\r\n//      }\r\n//    },\r\n////    popups_release_list: [], // DOESN'T WORK, leaves must be removed first, or lost reference and get too complicated procedures.\r\n////    popups_release_recursive: function(){ // avoid recursive calls\r\n////      while (this.popups_release_list.length>0) {\r\n////        var tgt = this.popups_release_list.pop();\r\n////        this.popups_release(tgt[0], tgt[1], tgt[2]);\r\n////      }\r\n////    },\r\n//    popups_release: function(lth, no){ // working code // , thq_no_in){\r\n//      var thq = lth.q;\r\n//      var thq_no = thq[no]; //  || thq_no_in;\r\n//      if (thq_no.quotes)\r\n//        for (var i=0;i<thq_no.quotes.length;i++) {\r\n//          var q = thq_no.quotes[i][0];\r\n//          var p = thq_no.quotes[i][1];\r\n//          var skey = q.domain!==lth.domain? lth.key : q.board!==lth.board? lth.board+lth.no : q.no!=lth.no? lth.no : null;\r\n//          if (this.popups_remove_backlink(q, p, skey? skey+'#'+no : parseInt(no,10))) {\r\n//            this.popups_remove_waiting(q,p);\r\n////            this.popups_release_list.push([Object.getPrototypeOf(q), p, q[p]]); // DOESN'T WORK\r\n//            try { \r\n//              this.popups_release(Object.getPrototypeOf(q), p); // RECURSIVE CALLS MAY CAUSE STACKOVERFLOW.\r\n//            } catch(e){\r\n//              setTimeout(this.popups_release.bind(this,Object.getPrototypeOf(q), p),0);\r\n//            }\r\n//          }\r\n//        }\r\n//      if (lth.no!=no && (!thq_no.backlinks || thq_no.backlinks.length===0)) delete thq[no];\r\n////      else thq_no.remove_if_no_backlinks = 1;\r\n//      if (pref.debug_mode['10']) console.log('popups_release: '+no+':    '+this.popups_debug(lth.q));\r\n////      if (!thq_no_in && this.popups_release_list.length>0) this.popups_release_recursive();\r\n//    },\r\n    popups_set_waiting: function(thq,no){\r\n      if (!thq.waiting) thq.waiting = [no];\r\n      else {\r\n        var i=0;\r\n        while (i<thq.waiting.length && thq.waiting[i]<no) i++;\r\n        if (thq.waiting[i]!=no) thq.waiting.splice(i,0,no);\r\n      }\r\n    },\r\n    popups_remove_waiting: function(thq,no){\r\n      if (!thq.waiting) return;\r\n      var idx = thq.waiting.indexOf(no);\r\n      if (idx!=-1) {\r\n        thq.waiting.splice(idx,1);\r\n        if (thq.waiting.length===0) delete thq.waiting;\r\n      }\r\n    },\r\n    popups_fetched: function(th, lth, start){ // 'if (lth.q && lth.q.waiting)' is checked by caller.\r\n      if (!start) start = 0;\r\n      var j=th.posts.length-1;\r\n      for (var i=lth.q.waiting.length-1;i>=0;i--) {\r\n        var no = lth.q.waiting[i];\r\n        while (j>start && no<th.posts[j].no) j--;\r\n        if (no===th.posts[j].no) this.popups_fetched_1(th, lth, no, th.posts[j]);\r\n        else if (th.type_source==='thread') {\r\n          if (pref.test_mode['64']) this.popups_set(lth.q, no, {time: 0, com:'DELETED'});\r\n          else this.popups_set(lth.q, no, {time: 0, com:'DELETED'}); // referring deleted posts should be here.\r\n        } // else if (j===start) break;\r\n        this.popups_posts.pop_load(th.key+'#'+th.posts[j].no, th.domain);\r\n//        if (this.popup_info && this.popup_info.key===th.key+'#'+th.posts[j].no) this.popups_posts.pop_make({target:this.popup_info.node, __proto__:this.popup_info}, th.domain);\r\n      }\r\n    },\r\n    popups_fetched_1: function(th, lth, no, post){\r\n//      post.parse_funcs = th.parse_funcs; // redundant???  // CAUSED A BUG, parse_funcs are archived and stop its prototype chain.\r\n//      if (th.type_data==='html') this.popups_fetched_html(post, th); // wrap_to_parse.post and prepare_html_extract_params should be used, but not debugged, left this.\r\n      site2[th.domain].wrap_to_parse.posts({posts:[post], __proto__:th});\r\n      cataLog.format_html.prepare_html_post(th, post);\r\n      this.popups_add_1(th, post, false, lth.q, false); // cut quote link.\r\n//      this.popups_set(lth.q, no, post); // BUG, this doesn't update quotes, this will be appear in multiple popup mode, use popups_add_1.\r\n//                                               // In single popup mode, this cut quote links and reduce memory consumption.\r\n////      this.popups_set(lth.q, i, (th.type_data==='json')? post : this.popups_fetched_html(post, th)); // BUG, this deletes quote.\r\n    },\r\n    popups_try_fetch_from_lth_ta: function(lth, no, th){\r\n      if (lth.ta) for (var i=lth.ta.posts.length-1;i>=0;i--) if (lth.ta.posts[i].no==no) {\r\n        var post = lth.ta.posts[i];\r\n        var th = {domain_html: th.domain_html, lth:lth, type_data:post.type_data || (post.pn? 'html':'json'), posts:[post], __proto__:lth};\r\n        this.popups_fetched_1(th, lth, no, post);\r\n        return;\r\n      }\r\n    },\r\n\r\n    popups_fetched_html: function(post, th){ // PATCH, WILL BE REMOVED.\r\n//      if (th.domain!==site.nickname && pref.catalog.mimic_base_site && th.domain_html!==site.nickname) {\r\n//        var post_new = common_func.shallow_copy_1(post); // MAY COLLIDE???\r\n\r\n//        site2[th.domain].wrap_to_parse_posts(th); // TEMPORAL\r\n        var proto_obj = {domain:th.domain, board:th.board, domain_html:th.domain_html, parse_funcs:th.parse_funcs};\r\n        if (post.extra_files) for (var j=0;j<post.extra_files.length;j++) for (var k in proto_obj) post.extra_files[j][k] = proto_obj[k];\r\n        for (var k in proto_obj) post[k] = proto_obj[k];\r\n\r\n//        if (th.parse_funcs.posts_full) th.parse_funcs.posts_full(th);\r\n        if (post.parse_funcs.filename) post.filename = post.parse_funcs.filename(post);\r\n//        if (th.parse_funcs.prep_mimic) th.parse_funcs.prep_mimic(th);\r\n\r\n        var dummy = post.time; // invoke getter\r\n        dummy = post.sub;\r\n        dummy = post.com;\r\n        dummy = post.name;\r\n        dummy = post.no;\r\n        dummy = post.op_img_url;\r\n        post.type_data = th.type_data;\r\n//      }\r\n      return post;\r\n    },\r\n    backlink: function(pn,thq_no, th){\r\n      var backlinks = (thq_no)? ((Array.isArray(thq_no))? thq_no : thq_no.backlinks) : null;\r\n      if (backlinks) this.add_backlinks(pn,backlinks, undefined, th);\r\n    },\r\n\r\n    popups_debug: function(thq){\r\n      if (!thq) return '';\r\n      var keys = Object.keys(thq);\r\n      var d_str = keys.length+', '+thq.key+': ';\r\n      for (var j=0;j<keys.length;j++) {\r\n        var i = keys[j];\r\n        d_str += i+':'+((Array.isArray(thq[i]))? thq[i] : (thq[i].backlinks || thq[i].remove_if_no_backlinks || 'P'))+', ';\r\n      }\r\n      return d_str;\r\n    },\r\n    toplevel_anchor_pos:1,\r\n    toplevel_anchor: function(pn, th){\r\n      var as = pn.getElementsByTagName('a');\r\n      var pos = this.toplevel_anchor_pos;\r\n      var dbtp = [th.domain, th.board, th.no, null];\r\n      for (var i=0;i<as.length;i++) {\r\n        var href = as[i].getAttribute('href');\r\n        if (href && href[0]==='#') {\r\n          dbtp[3] = href.substr(pos);\r\n          as[i].setAttribute('href',this.link_dbtp2href(dbtp));\r\n        }\r\n      }\r\n    },\r\n\r\n    wrap_to_parse: (function(){\r\n      var th_regexp = /[A-z]/;\r\n//      var parse_objs = {};\r\n      var key_table = { // to reduce memory consumption.\r\n        catalog: 'c',\r\n        page:    'i',\r\n        thread:  't',\r\n        post:    'p',\r\n        shortCatalog: 'b',\r\n        shortThread:  's',\r\n        html:    'h',\r\n        json:    'j',\r\n      };\r\n      function get_getters(){\r\n//        if (pref.test_mode['6']) return site4.parse_funcs_no_cache; // no cache parse to reduce memory consumption.\r\n//        if (pref.test_mode['6']) return site4.parse_funcs_one_time; // one time parse for faster execution.\r\n        return (pref.debug_mode.parse_error)? site4.parse_funcs_on_demand_debug : site4.parse_funcs_on_demand;\r\n//        var obj = (pref.debug_mode.parse_error)? site4.parse_funcs_on_demand_debug : site4.parse_funcs_on_demand;\r\n//        if (pref.test_mode['1'] && parse_funcs){ // test of static getters '&& parse_funcs' is a patch for test. // required to change 'get_getters(parse_funcs){'\r\n//          var obj2 = {};\r\n//          var props = ['no', 'key', 'time_bumped', 'nof_posts', 'nof_files', 'time_created', 'posts', 'sub', 'name', 'com', 'flag', 'flags', 'footer', 'sticky', 'pn', 'time', 'time_posted', 'txt']; // ['op_img_url'] // op_img_url is wrapped at localArhicve mode dynamically.\r\n//          for (var i=0;i<props.length;i++)\r\n//            Object.defineProperty(obj2,props[i],typeof(parse_funcs[props[i]]==='function')? {get:parse_funcs[props[i]], enumerable:true, configurable:true}\r\n//                                                                                          : {value:parse_funcs[props[i]], enumerable:true, configurable:true}); // not writable\r\n//          var time_tu_func = parse_funcs.time_unit===1?    function(){return this.time;}\r\n//                           : parse_funcs.time_unit===1000? function(){return this.time * 1000;}\r\n//                           :                               function(){return this.time * parse_funcs.time_unit;};\r\n//          Object.defineProperty(obj2,'time_tu', {get:time_tu_func, enumerable:true, configurable:true});\r\n//          obj2.__proto__ = obj;\r\n//          return obj2;\r\n//        }\r\n//        return obj;\r\n      }\r\n      function prep_pfunc(domain, board, type){\r\n//        var key = domain+board+type +'/'+pref.test_mode['6']+pref.debug_mode.parse_error;\r\n//        var key = domain+board+type;\r\n//        var parse_obj = parse_objs[key];\r\n        var type_source = type.substr(0,type.indexOf('_'));\r\n        var type_data   = type.substr(type.indexOf('_')+1);\r\n        var key = key_table[type_source] + key_table[type_data] + ((pref.debug_mode.parse_error)? '_debug':'');\r\n        var pfunc = liveTag.mems.init({domain:domain, board:board}).p[key];\r\n        if (!pfunc) {\r\n          var pfunc_root = liveTag.mems[domain].p;\r\n          var pfunc = pfunc_root[key];\r\n          if (!pfunc) {\r\n            var proto = site2[domain].parse_funcs[type+'_template'] || site2[domain].parse_funcs[type_data+'_template'] || get_getters();\r\n            var domain_html = (pref.catalog.mimic_base_site || site2[domain].mimic_always)? site.nickname : domain;\r\n            pfunc_root[key] = {domain: domain,\r\n                       parse_funcs: site2[domain].parse_funcs[type],\r\n                       parse_funcs_html: site2[domain_html].parse_funcs[type_source+'_html'],\r\n                       type_parse: type,\r\n                       type_source: type_source,\r\n                       type_data: type_data,\r\n                       type_html: type_source,\r\n                       domain_html: domain_html,\r\n//                       thread: null, // for faster execution.\r\n//                       page_no: null,\r\n//                       __proto__:site4.parse_funcs_on_demand\r\n                       __proto__:proto\r\n                              };\r\n            pfunc = pfunc_root[key];\r\n////            var template = site2[domain].parse_funcs[type+'_template'];\r\n////            if (template) {\r\n////////              var keys = Object.keys(template);\r\n////////              for (var i=0;i<keys.length;i++) Object.defineProperty(pfunc, keys[i], {value:template[keys[i]], enumerable:true, configurable:true, writable:true});\r\n//////              for (var i in template) Object.defineProperty(pfunc, i, {value:template[i], enumerable:true, configurable:true, writable:true}); // search in prototype, overwrite getters\r\n////              for (var i in template) // search in prototype, overwrite getters\r\n////                if (typeof(template[i])==='function') Object.defineProperty(pfunc, i, {get:template[i], enumerable:true, configurable:true});\r\n////                else Object.defineProperty(pfunc, i, {value:template[i], enumerable:true, configurable:true, writable:true});\r\n////            }\r\n          }\r\n          liveTag.mems[domain][board].p[key] = {\r\n            board: board,\r\n            __proto__: pfunc\r\n          };\r\n          pfunc = liveTag.mems[domain][board].p[key];\r\n        }\r\n        return pfunc;\r\n      }\r\n      return {\r\n        get_getters: get_getters,\r\n        prep_pfunc: prep_pfunc,\r\n        get: function(doc_obj, domain, board, type, options){\r\n          var parse_obj = prep_pfunc(domain, board, type);\r\n          if (options) {\r\n            if (options.thread!==undefined) {\r\n              if (th_regexp.test(options.thread)) options.thread = options.thread.substr(1);\r\n//              options.op = options.thread; // patch for thread_html\r\n            }\r\n            options.__proto__ = parse_obj;\r\n            parse_obj = options;\r\n          }\r\n//          if (options) {  // working code.\r\n//            if (options.thread) parse_obj.thread = (th_regexp.test(options.thread))? options.thread.substr(1): options.thread;\r\n//            if (options.page) parse_obj.page = options.page;\r\n//          }\r\n          return (type.indexOf('_json')==-1)? site2[domain].parse_funcs[type].ths({pn:doc_obj, __proto__:parse_obj}) :\r\n                                              site2[domain].parse_funcs[type].ths(doc_obj, parse_obj);\r\n        },\r\n////        clean: function(boards){\r\n////          var keys = Object.keys(parse_objs);\r\n////          for (var i=0;i<keys.length;i++) {\r\n////            var key_split = keys[i].split('/');\r\n////            if (boards[key_split[0]+key_split[1]]===undefined) parse_objs[keys[i]] = null;\r\n////          }\r\n////        }\r\n        posts: function(th, start, proto_options){\r\n          if (th.type_data===undefined) {\r\n            var arr = [];\r\n            if (th.posts) for (var i=0;i<th.posts.length;i++) if (!th.posts[i].domain && th.posts.pn) arr[arr.length] = th.posts[i];\r\n            if (arr.length!=0) this.posts({type_data:'html', posts:arr, __proto__:th}, 0, common_func.shallow_copy_1(proto_options));\r\n            th = {type_data:'json', __proto__:th};\r\n          }\r\n          var proto_obj = prep_pfunc(th.domain, th.board, 'post_'+th.type_data);\r\n          if (proto_options) {\r\n            proto_options.__proto__ = proto_obj;\r\n            proto_obj = proto_options;\r\n          }\r\n          var localArchive = th.localArchive;\r\n          if (localArchive) proto_obj = {localArchive:localArchive, __proto__:proto_obj};\r\n//          var proto_obj = {domain:th.domain, board:th.board, domain_html:th.domain_html, parse_funcs:th.parse_funcs};\r\n          if (th.posts) for (var i=start||0;i<th.posts.length;i++) {\r\n            if (!th.posts[i].domain || localArchive) {\r\n              if (th.posts[i].extra_files) for (var j=0;j<th.posts[i].extra_files.length;j++)\r\n                if (!th.posts[i].extra_files.domain) th.posts[i].extra_files[j].__proto__ = proto_obj;\r\n              th.posts[i].__proto__ = proto_obj;\r\n            }\r\n          }\r\n          if (th.extra_files) if (!th.extra_files[0].domain || localArchive) for (var j=0;j<th.extra_files.length;j++) th.extra_files[j].__proto__ = proto_obj;\r\n////      if (th.posts) for (var i=0;i<th.posts.length;i++) {\r\n////        if (th.posts[i].extra_files) for (var j=0;j<th.posts[i].extra_files.length;j++) th.posts[i].extra_files[j].__proto__ = th.__proto__;\r\n////        th.posts[i].__proto__ = th.__proto__;\r\n////      }\r\n////      if (th.extra_files) for (var j=0;j<th.extra_files.length;j++) th.extra_files[j].__proto__ = th.__proto__;\r\n        },\r\n      }\r\n    })(),\r\n    parse_pn_dummy: document.createElement('div'),\r\n    parse_funcs: { // DEFAULT\r\n      'common': {\r\n////        entry : function(dtpo,req) { // doc, thread, post, object // working code.\r\n////          for (var i=0;i<req.length;i++) {\r\n////            if (req[i]===':ITER') {\r\n////              if (req[i+1]===':ALL') for (var j=0;j<dtpo[req[i+2]].length;j++) this.exe_sub(dtpo,req,i,j);\r\n////              else if (req[i+1]===':FL') {\r\n////                this.exe_sub(dtpo,req,i,0);\r\n////                this.exe_sub(dtpo,req,i,dtpo[req[i+2]].length-1);\r\n////              } else if (req[i+1]===':FLx' || req[i+1]===':GFLx' || req[i+1]===':GALL') {\r\n////                var j = dtpo[req[i+2]].length - pref[cataLog.embed_mode].t2h_num_of_posts;\r\n////                if (j<1 || req[i+1]===':GALL') j=1;\r\n////                if (req[i+1]===':FLx') {\r\n////                  this.exe_sub(dtpo,req,i,0);\r\n////                  while (j<dtpo[req[i+2]].length) this.exe_sub(dtpo,req,i,j++);\r\n////                } else {\r\n////  //                dtpo[req[i+3][0]] = [];\r\n////                  Object.defineProperty(dtpo,req[i+3][0], {value:[], enumerable:true, configurable:true, writable:true});\r\n////                  dtpo[req[i+3][0]].push(dtpo[req[i+2]][0][req[i+3][1]]);\r\n////                  while (j<dtpo[req[i+2]].length) dtpo[req[i+3][0]].push(dtpo[req[i+2]][j++][req[i+3][1]]);\r\n////                  for (var j=dtpo[req[i+3][0]].length-1;j>=0;j--) if (!dtpo[req[i+3][0]][j]) dtpo[req[i+3][0]].splice(j,1);\r\n////                }\r\n////              }\r\n////              i += 3;\r\n////  //          } else dtpo[req[i]] = this[req[i]](dtpo,req);\r\n////            } else Object.defineProperty(dtpo,req[i], {value:this[req[i]](dtpo,req), enumerable:true, configurable:true, writable:true});\r\n////          }\r\n////        },\r\n////        exe_sub : function(dtpo,req,i,j) {\r\n////          dtpo[req[i+2]][j].domain = dtpo.domain;\r\n////          dtpo[req[i+2]][j].board  = dtpo.board;\r\n////          this.entry(dtpo[req[i+2]][j],req[i+3]);\r\n////        },\r\n        finisher : function(){return;},\r\n        posts: function(){return undefined;},\r\n        com: function(){return undefined;},\r\n        flags: function(){return undefined;},\r\n        flag: function(){},\r\n        id: function(){},\r\n        country: function(){},\r\n        hrefs: function(){},\r\n        trip: function(){}, // hit this line in archive of 4chan with trip search acrive.\r\n//        op_img_url: function() {return undefined;},\r\n//        preventDefault:function(e){e.preventDefault();},\r\n        th_init: null,\r\n//        th_destroy: null,\r\n        tn_as: function(th){return th.pn.getElementsByTagName('a');},\r\n        tn_imgs: function(th){\r\n          var imgs = [];\r\n//          for (var i=0;i<as.length;i++) imgs[i] = as[i].getElementsByTagName('img')[0];\r\n          var as = th.pn.getElementsByTagName('a');\r\n          for (var i=0;i<as.length;i++) {\r\n            var tmp = as[i].getElementsByTagName('img')[0];\r\n            if (tmp) imgs[imgs.length] = tmp;\r\n          }\r\n          return imgs;\r\n        },\r\n        key: function(th){return th.domain + th.board + th.no;},\r\n        pn: function(th){return site2[th.domain_html].catalog_json2html3(th,th.board, this.op_img_url(th));},\r\n        op_img_url: function(th) {return site2[th.domain].catalog_json2html3_thumbnail(th, th.board);},\r\n        get_op_src: function(th) {return th.op_img_url;},\r\n        ths_array: function(doc,ths_col){\r\n          var ths = [];\r\n          if (ths_col)\r\n            for (var i=ths_col.length-1;i>=0;i--) {\r\n              var page = (doc.type_html==='catalog')? Math.floor(i/15)+'.'+i%15\r\n                                                    : (doc.type_html==='page')? doc.page + '.' + i : undefined; // page_html\r\n              ths[i] = {\r\n                pn: ths_col[i],\r\n                page: page,\r\n                __proto__: doc.__proto__};\r\n            }\r\n          return ths;\r\n        },\r\n        time: function(th){return undefined;},\r\n        time_posted : function(th){return undefined;},\r\n        time_unit: 1,\r\n        has_posts: true,\r\n//        last_replies: function(th){return th.posts.slice(1);},\r\n////        post_no: function(post){return post.no;},\r\n        txt: function(th){\r\n          site2['DEFAULT'].parse_pn_dummy.innerHTML = th.com;\r\n          return site2['DEFAULT'].parse_pn_dummy[brwsr.innerText];\r\n        },\r\n        type_com: 'html',\r\n        footer_prep: function(th, footer){\r\n          var str = footer.innerHTML.replace(/ *R:[0-9 \\/]*I:[0-9 \\/]*/,'');\r\n          str = str.replace(/P:[0-9 \\/]*/,'');\r\n          str = str.replace(/ *\\(sticky\\) */,'');\r\n          if (str!=='') {\r\n            footer.innerHTML = '<span></span>' + str;\r\n            footer = footer.childNodes[0];\r\n          }\r\n        },\r\n//        adopt_pn: function(th){\r\n////          for (var i=0;i<th.posts.length;i++) Object.defineProperty(th.posts[i], 'pn', {value:document.adoptNode(th.posts[i].pn), enumerable:true, configurable:true, writable:true});\r\n//          Object.defineProperty(th, 'pn', {value:document.adoptNode(th.pn), enumerable:true, configurable:true, writable:true});\r\n//        },\r\n        get_lth_from_node: function(pn){\r\n          while (pn && !pn.name) pn = pn.parentNode;\r\n          return pn && liveTag.mems.getFromName(pn.name) || null;\r\n        },\r\n//        txt2com: function(txt){return txt;},\r\n        nativeUpdate2pn: function(pn_in){return pn_in.lastChild;}, // rip container from updated instance by native updater.\r\n//        nativeUpdate2pn: function(pn_in){return pn_in;},\r\n      },    \r\n      'catalog_html': {\r\n        posts: function(th){return [{pn:th.pn, __proto__:th.__proto__}];}, // test, gives mirror of th, but not getter, [{get 0(){return th;}, length:1}]\r\n//        posts: function(th){return [{sub:th.sub, com:th.com, name:th.name, pn:th.pn}];}, // BUG, should be [{sub:th.sub, com:th.com, name:th.name}], but this causes too many erroes because all data must be parsed from th.pn in catalog_html, pn===undefined needes to write all uses of posts[0].XXX \r\n        time: function(th){return th.time_created;},\r\n        posts_full: (function(){\r\n          var exlist = {posts:null, pn:null, flag:null, flags:null, footer:null, pn_name:null, ths:null, page:null,\r\n                        tn_as:null, tn_imgs:null, txt:null, pn_id:null, pn_trip:null,\r\n                        parse_funcs:null, parse_funcs_html:null, type_parse:null, type_source:null, type_data:null, type_html:null,\r\n                        domain:null, board:null, domain_html:null, exe_sub:null, exe_sub2:null};\r\n          return function(th){\r\n//            for (var prop in th) if (exlist[prop]===undefined) th.posts[0][prop] = th[prop]; // invoke getters.\r\n            for (var prop in th) if (exlist[prop]===undefined)\r\n              if (th.parse_funcs[prop]) Object.defineProperty(th.posts[0], prop, {value:th[prop], enumerable:true, configurable:true, writable:true}); // invoke getters to cut reference to pn(whole html), and also set th[prop].\r\n          };\r\n        })(),\r\n        has_posts: false,\r\n        type_com: 'txt',\r\n        filename: function(th){\r\n          var fname = th.op_img_url.replace(/.*\\//,'');\r\n          var idx = fname.indexOf('.');\r\n          th.tim = fname.substr(0,idx);\r\n//          th.ext = fname.substr(  idx);\r\n          return th.tim;\r\n        },\r\n      },\r\n      'catalog_json': {\r\n        ths: function(obj, parse_obj) {\r\n          var ths = [];\r\n          for (var i=0;i<obj.length;i++)\r\n            if (obj[i].threads) for (var j=0;j<obj[i].threads.length;j++) {\r\n              obj[i].threads[j].page = i + '.' + j;\r\n              obj[i].threads[j].sticky = obj[i].threads[j].sticky===1; // overwrite property of the same name before setting prototype to use polarity.\r\n              obj[i].threads[j].type_html = 'catalog';\r\n              obj[i].threads[j].__proto__ = parse_obj;\r\n              ths[ths.length] = obj[i].threads[j];\r\n            }\r\n          return ths;\r\n        },\r\n//        posts: function(th){return [{sub:th.sub, com:th.com, name:th.name, trip:th.trip, pn:th.pn, time:th.time_created}];}, // time for post_json2html\r\n//        posts: function(th){return [{sub:th.sub, com:th.com, name:th.name, time:th.time}];}, // this is used at scan, so the lighter is the best. 'time' is only for 'check_reply' and 'stats'. And this removes prototype chain to reduce memory consumption instead of using '[{__proto__:th}]'.\r\n        posts: function(th){return [{time:th.time, DUMMY:true}];}, // 'time' is for 'check_reply' and 'stats'. And this removes prototype chain to reduce memory consumption instead of using '[{__proto__:th}]'.\r\n        posts_full: function(th){\r\n//          th.posts[0] = {}; // BUG NEVER DO THIS. posts_full is called AFTER SETTING PROTOTYPE in wrap_to_parse.posts in format_html.prepare_html_prep_posts\r\n            delete th.posts[0].DUMMY;\r\n////          th.posts[0].no = th.no; // works\r\n////          th.posts[0].time = th.time;\r\n          var keys = Object.keys(th);\r\n//          var exlist = ['obj','posts'];\r\n//          for (var i=0;i<keys.length;i++) if (exlist.indexOf(prop)==-1) th.posts[0][keys[i]] = th[keys[i]]; // remove props in prototype chain. // will be this.\r\n          for (var i=0;i<keys.length;i++) if (keys[i]!=='posts' && keys[i]!=='pn') th.posts[0][keys[i]] = th[keys[i]]; // remove props in prototype chain.\r\n        },\r\n        has_posts: false,\r\n      },\r\n//      'catalog_html': {\r\n//        ths_array: function(doc,ths_col){ // working code.\r\n//          var ths = [];\r\n//          if (ths_col)\r\n////            if (site.nickname!==doc.domain) site2[doc.domain].absolute_link(doc.pn, doc.board);\r\n//            for (var i=ths_col.length-1;i>=0;i--) {\r\n//              var page = Math.floor(i/15)+'.'+i%15;\r\n//              ths[i] = {\r\n//                pn: ths_col[i],\r\n//                type_html: 'catalog_html',\r\n////                page: Math.floor(i/15)+'.'+i%15, // cause warning of 'Object literal with complex property' in V8.\r\n//                page: page,\r\n//                __proto__: doc.__proto__};\r\n//            }\r\n//          return ths;\r\n//        },\r\n//      },\r\n      'page_html': {\r\n//        ths_array: function(doc,ths_col){ // working code.\r\n//          var ths = [];\r\n//          if (ths_col)\r\n////            if (site.nickname!==doc.domain) site2[doc.domain].absolute_link(doc.pn, doc.board);\r\n//            for (var i=ths_col.length-1;i>=0;i--) {\r\n//              var page = (doc.page!=='?')? doc.page + '.' + i : doc.page;\r\n//              ths[i] = {\r\n//                pn: ths_col[i],\r\n//                type_html: 'page_html',\r\n////                page: (doc.page!=='?')? doc.page + '.' + i : doc.page, // cause warning of 'Object literal with complex property' in V8.\r\n//                page: page,\r\n//                __proto__: doc.__proto__};\r\n//            }\r\n//          return ths;\r\n//        },\r\n        posts_array: function(th,pns){ // working code.\r\n          var pts = [];\r\n          var proto = site2[th.domain].wrap_to_parse.prep_pfunc(th.domain, th.board, 'post_html');\r\n//          var proto = (th.domain==='4chan')? site2[th.domain].wrap_to_parse.prep_pfunc(th.domain, th.board, 'post_html') : th.__proto__; // tests only in 4chan, this reuires so many test...\r\n//          var proto_kwd = 'post_' + th.type_data; // working code, WILL BE THIS.\r\n//          var proto = (site2[th.domain].parse_funcs.hasOwnProperty(proto_kwd))? site2[th.domain].parse_funcs[proto_kwd] : th.__proto__;\r\n//          var proto = th.__proto__; \r\nif (!pref.test_mode['5']) { // faster, because object creation is light,,,orz,,,\r\n          for (var i=0;i<pns.length;i++) pts[pts.length] = {pn:pns[i], __proto__:proto};\r\n} else {\r\n          pts.pns = pns;\r\n          pts.idx0 = 0;\r\n          pts.idx1 = pns.length-1;\r\n          pts.get0 = this.posts_get0;\r\n          pts.get1 = this.posts_get1;\r\n          pts.proto = proto;\r\n//          var pts = {pn:pns, idx0:0, idx1:pns.length-1, length:pns.length, __proto__:proto};\r\n          Object.defineProperty(pts, pts.idx0, {get: pts.get0, enumerable:true, configurable:true});\r\n          Object.defineProperty(pts, pts.idx1, {get: pts.get1, enumerable:true, configurable:true});\r\n}\r\n          return pts;\r\n        },\r\n        posts_get0: function(){\r\n//console.log('get0: '+this.idx0);\r\n          var val = {pn:this.pns[this.idx0],  __proto__:this.proto}; // this.__proto__ reffers Array, doesn't work.\r\n          Object.defineProperty(this, this.idx0, {value: val, enumerable:true, configurable:true, writable:true});\r\n          if (++this.idx0<this.idx1) Object.defineProperty(this, this.idx0, {get: this.get0, enumerable:true, configurable:true});\r\n          return val;\r\n        },\r\n        posts_get1: function(){\r\n//console.log('get1: '+this.idx1);\r\n//console.log('this.pns: ');\r\n//console.log(this.pns);\r\n          var val = {pn:this.pns[this.idx1],  __proto__:this.proto};\r\n          Object.defineProperty(this, this.idx1, {value: val, enumerable:true, configurable:true, writable:true});\r\n          if (--this.idx1>this.idx0) Object.defineProperty(this, this.idx1, {get: this.get1, enumerable:true, configurable:true});\r\n          return val;\r\n        },\r\n//        posts_array: function(th,posts){ // working code.\r\n//          var pts = [];\r\n//          for (var i=0;i<posts.length;i++) pts[pts.length] = {pn:posts[i], __proto__:th.__proto__};\r\n//          return pts;\r\n//        },\r\n        posts: function(th){return this.posts_array(th, th.pn.getElementsByClassName('post'));},\r\n////////        posts_pn: function(th){return th.pn.getElementsByClassName('post');},\r\n        time_posted: 'thread_html',\r\n        time_bumped: function(th){ // TO BE FIXED.\r\n          return th.posts[th.posts.length-1].time;\r\n        },\r\n        time_created: function(th){return th.posts[0].time;},\r\n        key: function(th){return th.domain + th.board + th.no;},\r\n        insert_footer4: function(ref){\r\n          var footer = document.createElement('div');\r\n          return ref.parentNode.insertBefore(footer,ref);\r\n        },\r\n        flags: function(th){ // for on demand access.\r\n          var flags = [];\r\n          var i = th.posts.length -1;\r\n          var n = pref[cataLog.embed_mode].t2h_num_of_posts -1;\r\n          if (i<n) { // POSTS MUST BE ACCESSED FROM HEAD OR TAIL.\r\n            n=0;\r\n            while (n<=i) {\r\n//console.log('up: '+n+', '+i);\r\n              if (th.posts[n]) flags[n] = th.posts[n].flag; // 8chan doesn't show 5 posts all the time.\r\n              n++;\r\n            }\r\n          } else {\r\n            while (n>=0) {\r\n//console.log('down: '+n+', '+i);\r\n//console.log(th.posts[i]);\r\n              if (th.posts[i]) flags[n--] = th.posts[i--].flag;\r\n              if (n==0) i=0;\r\n            }\r\n          }\r\n          return flags;\r\n        },\r\n////        flags: function(th){ // for on demand access. // worked code, but post was changed to had to be accessed from top or end.\r\n////          var flags = [];\r\n////          var i = th.posts.length - pref.catalog_t2h_num_of_posts;\r\n////          if (i<1) i=1;\r\n////          if (th.posts.length!=0) flags[0] = th.posts[0].flag;\r\n////          while (i<th.posts.length) {\r\n////            if (th.posts[i]) flags[i] = th.posts[i].flag;\r\n////            i++;\r\n////          }\r\n////          return flags;\r\n////        },\r\n        html_org: function(th){return th.pn.innerHTML;},\r\n        sticky: function(){return false;},\r\n////        pop_post_prep: function(th){ // working code.\r\n////          th.children = th.pn.childNodes;\r\n////          th.idx_pop = th.pn.childNodes.length-1;\r\n////        },\r\n        type_com: 'txt',\r\n        replace_omitted_info : function(dst, src){dst.textContent = src.textContent;},\r\n        replace_omitted_info2: 'replace_omitted_info',\r\n        posts_full: 'catalog_html',\r\n        get_max_page: function(doc){\r\n          var pns = doc.getElementsByClassName('pages')[0];\r\n          if (!pns) return;\r\n          pns = pns.childNodes;\r\n          var max = 0;\r\n          for (var i=0;i<pns.length;i++) if (max+1 == pns[i].textContent) max++; // == used intentionally.\r\n          return max;\r\n        },\r\n      },\r\n      'page_json': {\r\n        ths: function(obj, parse_obj){\r\n          var ths = [];\r\n          if (obj && obj.threads) for (var i=0;i<obj.threads.length;i++) { // patch for 8chan\r\n//          for (var i=0;i<obj.threads.length;i++) {\r\n            var tgt = obj.threads[i];\r\n            if (tgt) { // patch for 8chan\r\n              tgt.page = (parse_obj.page)? parse_obj.page + '.' + i : undefined;\r\n              tgt.key = parse_obj.domain + parse_obj.board + tgt.posts[0].no;\r\n              tgt.posts[0].__proto__ = parse_obj;\r\n              tgt.__proto__ = tgt.posts[0];\r\n              ths[i] = tgt;\r\n            }\r\n////            if (tgt) { // patch for 8chan // working code.\r\n////              ths[i] = {obj: tgt, // buffered, because if obj is used, change of obj's contents will affect to this program directly.\r\n////                        posts: tgt.posts, ext: tgt.posts[0].ext, tim:tgt.posts[0].tim,\r\n////                        time: tgt.posts[0].time, // for 'check_reply.check_t1_op'\r\n////                        key: parse_obj.domain + parse_obj.board + tgt.posts[0].no, no: tgt.posts[0].no,\r\n////                        page: (parse_obj.page)? parse_obj.page + '.' + i : undefined,\r\n////                        __proto__:parse_obj};\r\n////            }\r\n////            tgt.posts = null; // cut the reference, if leave this, cutting th.posts.length in 'update_posts_replace_prep' doesn't affect to tgt.posts and tgt.posts keep containing all posts.\r\n          }\r\n          return ths;\r\n        },\r\n        flags: function(th){\r\n          if (!th.country) return undefined;\r\n          var n = th.posts.length - pref[cataLog.embed_mode].t2h_num_of_posts;\r\n          return [th].concat(th.posts.slice((n<=1)? 1 : n)); // patch for 4chan:catalog_html, it isn't formed as catalog_json, posts[0] doesn't contain full information.\r\n//          return (n<=1)? th.posts.slice() : [th.posts[0]].concat(th.posts.slice(n));\r\n        },\r\n      },\r\n      'thread_html'  : {\r\n        ths_array: function(doc, ths_col){\r\n          return [{pn:ths_col,\r\n//                   type_html: 'thread_html',\r\n//                   page: '?',\r\n                   __proto__: doc.__proto__}];\r\n        },\r\n        time_posted : function(th){return th.posts[th.posts.length-1].time;},\r\n        posts_full: 'catalog_html',\r\n        id: function(th){return th.posts[0].id;},\r\n        country: function(th){return th.posts[0].country;},\r\n        trip: function(th){return th.posts[0].trip;},\r\n        flag: function(th){return th.posts[0].flag;},\r\n        name: function(th){return th.posts[0].name;},\r\n        type_com: 'txt',\r\n      },\r\n      'thread_json'  : {\r\n        ths: function(obj, parse_obj){\r\n          obj.key = parse_obj.domain + parse_obj.board + obj.posts[0].no;\r\n          obj.posts[0].__proto__ = parse_obj;\r\n          obj.__proto__ = obj.posts[0];\r\n          return [obj];\r\n        },\r\n//        ths: function(obj, parse_obj){return site2['DEFAULT'].parse_funcs.page_json.ths({threads:[obj]}, parse_obj);}, // working code.\r\n////        ths: function(obj, parse_obj){\r\n////          return [{obj:obj, posts: obj.posts, ext: obj.posts[0].ext, tim:obj.posts[0].tim,\r\n////                   key: parse_obj.domain + parse_obj.board + parse_obj.thread, no: parse_obj.thread, __proto__:parse_obj}];\r\n////        },\r\n\r\n////        pop_post_prep: function(obj){ // working code.\r\n////          obj.idx_pop = obj.posts.length-1;\r\n////        },\r\n////        pop_post: function(obj){\r\n////          if (obj.idx_pop>=0) {\r\n////            obj.post = obj.posts[obj.idx_pop--];\r\n//////            obj.post.parse_funcs = this;\r\n//////            obj.post.__proto__ = obj.__proto__;\r\n////            obj.post.time *= 1000; // DESTRUCTIVE\r\n////            return true;\r\n////          } else return false;\r\n////        },\r\n////        preprocess: function(obj){ // working code, but deleted.\r\n////          if (!obj.preprocessed) {\r\n////            obj.preprocessed = true;\r\n////            for (var i=obj.posts.length-1;i>=0;i--) obj.posts[i].time *= 1000;\r\n////          }\r\n////        },\r\n////        time_created : function(obj){return obj.posts[0].time;}, // preprocessed\r\n////        time_bumped : function(obj){return obj.posts[obj.posts.length-1].time;}, // preprocessed\r\n        time_created : function(obj){return obj.posts[0].time*1000;},\r\n        time_bumped : function(obj){\r\n          if (obj.posts[0].bumplimit) return undefined; // 4chan doesn't have email field but compensated.\r\n          var i = obj.posts.length-1;\r\n          while (i>0 && obj.posts[i].email && obj.posts[i].email==='sage') i--;\r\n          return obj.posts[i].time*1000;\r\n        },\r\n        time_posted : function(obj){return obj.posts[obj.posts.length-1].time*1000;},\r\n        nof_posts: function(obj){return obj.posts[0].replies+1;},\r\n        nof_files: function(obj){return obj.posts[0].images+1;},\r\n        has_nof_files: true,\r\n        sub: function(obj){return (obj.posts[0].sub || '');},\r\n        name: function(obj){return (obj.posts[0].name || '');},\r\n        com: function(obj){return (obj.posts[0].com || '');},\r\n        sticky: function(obj){return obj.posts[0].sticky===1;},\r\n        time_unit: 1000,\r\n        prep_to_archive: function(obj){return {posts:obj};},\r\n        rip_from_archive: function(obj){return obj.posts || obj;}, // patch for dual acceptance, internal and external format.\r\n//        proto: 'page_json'\r\n      },\r\n      'post_html': {\r\n        sub: function(post){\r\n          var sub = post.pn.getElementsByClassName('subject')[0];\r\n          return (sub)? sub.textContent : '';\r\n        },\r\n        img2src: function(img){return img.parentNode.href;},\r\n        img2ext: function(img){return img.parentNode.getAttribute('data-ext');},\r\n      },\r\n      'post_json': {\r\n        time_unit: 1000,\r\n        pn: function(post){return site2[post.domain_html].post_json2html(post,post.board);}, // blocked by template\r\n        anchor: function(){},\r\n        hrefs: function(post){\r\n          if (!post.com) return;\r\n          var hrefs = post.com.match(/href=\"([^\"]*)\"/g);\r\n          if (hrefs) for (var i=0;i<hrefs.length;i++) {\r\n            var idx = hrefs[i].indexOf('://');\r\n            hrefs[i] = hrefs[i].slice(idx===-1? 6:idx+1, -1);\r\n          }\r\n          return hrefs;\r\n        },\r\n      },\r\n      'catalog_json_template': 'post_json_template',\r\n      'page_json_template': 'post_json_template',\r\n      'thread_json_template': 'post_json_template',\r\n      'post_json_template': {\r\n        sub: '',\r\n        name: 'Anonymous',\r\n        com: '',\r\n        sticky: undefined,\r\n        pn: undefined, // block getter\r\n        no: undefined, // patch\r\n        time: undefined, // patch\r\n      },\r\n      'html_template': { // for test_mode['121']\r\n        get id(){return this.exe_sub('id');},\r\n        get pn_id(){return this.exe_sub('pn_id');},\r\n//        get country(){return this.exe_sub('country');},\r\n//        get trip(){return this.exe_sub('trip');},\r\n//        get pn_trip(){return this.exe_sub('pn_trip');},\r\n        get pn_name(){return this.exe_sub('pn_name');},\r\n//        get tFlag(){return this.exe_sub('tFlag');},\r\n      },\r\n    },\r\n//    parse_funcs : function(dtp,req) { // doc, thread, post, use .call() to call with 'this'.\r\n//      for (var i=0;i<req.length;i++) {\r\n//        if (this[req[i]]) dtp[req[i]] = this[req[i]](dtp,req);\r\n//        if (req[i]==='ths') i++;\r\n//      }\r\n//    },\r\n    parse_parts:{\r\n      add_op_img_url: function(posts,board,domain){\r\n         for (var i=0;i<posts.length;i++)\r\n          posts[i].op_img_url = site2[domain].catalog_json2html3_thumbnail(posts[i], board);\r\n      },\r\n    },\r\n////    update_posts_replace: function(th,th_old,pnode) { // working code.\r\n////      if (th_old.posts) {\r\n////        th_old.posts[0].pn.innerHTML = th.posts[0].pn.innerHTML;\r\n////        for (var i=th_old.posts.length-1;i>=1;i--) this.update_posts_remove(th_old,i,pnode);\r\n////      }\r\n////      th_old.posts = [th_old.posts[0]];\r\n////      this.update_posts_add(th,th_old,pnode);\r\n////    },\r\n    update_posts_merge_prep: function(posts, posts_m, num, by_no) { // merge posts by time\r\n      if (posts) {\r\n        num = (num>=0)? num+1 : ((posts_m && posts_m.length)? posts_m.length : 0) + posts.length;\r\n        if (num<posts.length) posts = posts.slice(0,1).concat(posts.slice(posts.length - num + 1)); // cut\r\n        var i=1;\r\n        var j=0;\r\n        var posts_ret = [posts[0]];\r\n        if (by_no) // by no.\r\n          while (i<posts.length && j<posts_m.length) {\r\n            if (posts[i].no === posts_m[j].no) {posts_ret[posts_ret.length] = posts[i++]; j++; continue;}\r\n            posts_ret[posts_ret.length] = (posts[i].no < posts_m[j].no)? posts[i++] : posts_m[j++];\r\n          }\r\n        else\r\n          while (i<posts.length && j<posts_m.length)\r\n            posts_ret[posts_ret.length] = (posts[i].time * posts[i].parse_funcs.time_unit < posts_m[j].time * posts_m[j].parse_funcs.time_unit)? posts[i++] : posts_m[j++];;\r\n        posts_ret = posts_ret.concat((i<posts.length)? posts.slice(i) : posts_m.slice(j));\r\n        return (posts_ret.length<=num)? posts_ret :\r\n                                        posts_ret.slice(0,1).concat(posts_ret.slice(posts_ret.length-num+1,posts_ret.length));\r\n      }\r\n    },\r\n    update_posts_merge_bases: {\r\n      bases: {},\r\n      initialized: false,\r\n      query: function(th, tgt, isShown){\r\n        var key = th.key;\r\n        if (this.bases[key]) return this.bases[key];\r\n        var base = (tgt)? this.bases[tgt] : null;\r\n        if (base) {\r\n//        for (var i=0;i<tgts.length;i++) if (this.bases[tgts[i]]) {\r\n//          var base = this.bases[tgts[i]];\r\n          this.bases[key] = base;\r\n          this.merge_th(th, base);\r\n          if (isShown) cataLog.catalog_obj2.func_hide_org(key);\r\n//          th.pn.setAttribute('style','display:none'); // TEMPORAL PATCH.\r\n          cataLog.threads[key][0] = base.pn;\r\n          return base;\r\n        }\r\n        this.bases[key] = this.base_factory(th, isShown);\r\n        if (!this.initialized) this.setup_hook();\r\n        return this.bases[key];\r\n      },\r\n      base_factory: (function(){\r\n        var base_proto = {\r\n          lazy_draw: function(idx){\r\n            if (idx>=this.lazy.length) this.lazy[idx] = true; // all are not initialized.\r\n            else this.lazy.splice(idx,0,true);\r\n            if (this.lazy_idx>idx) this.lazy_idx = idx;\r\n//            cataLog.show_catalog_cont();\r\n          },\r\n          remove: function(idx){\r\n            this.posts.splice(idx,1);\r\n            if (idx<this.lazy_idx) this.lazy_idx--;\r\n            return (this.lazy)? !this.lazy.splice(idx,1)[0] : true;\r\n          },\r\n          draw_1_pos: function(idx){ // this.lazy_idx may refer \"true\" node by this.\r\n            var n=idx+1;\r\n            while (n<this.lazy.length && this.lazy[n]) n++; // skip myself also\r\n            this.lazy[idx] = false;\r\n            return n;\r\n          },\r\n          get_class: function(key, force, old) {\r\n            if (!force && !pref.proto.merge_lv) return null;\r\n            var lv = pref_func.merge_obj5a_sc(key,old? pref3.proto.merge_lv_obj2_old : pref3.proto.merge_lv_obj2, null);\r\n//            var lv = (key===site.nickname+site.board+site.no)? 0 : 1; // test\r\n            return (lv===null)? null : pref.script_prefix+'_merge'+lv;\r\n          },\r\n        };\r\n        return function(th, isShown){\r\n          site2['DEFAULT'].update_posts_merge_bases.class_add_all(th.posts, base_proto.get_class(th.key));\r\n          return {\r\n            pn: th.pn, // site2[th.domain].page_json2html3({domain:th.domain, board:th.board, no:0}, '/ALL_MERGED/', null, true),\r\n            posts: th.posts.slice(),\r\n            isShown: 1, // (isShown)? 1 : 0, // num of participants\r\n            lazy: (pref[cataLog.embed_mode].lazyDraw.merge)? th.posts.map(function(){return false;}) : null,\r\n            lazy_idx: (pref[cataLog.embed_mode].lazyDraw.merge)? th.posts.length : null,\r\n            __proto__:base_proto\r\n          };\r\n        }\r\n      })(),\r\n      class_add_all: function(posts, merge_class){\r\n        if (!merge_class) return;\r\n        for (var i=0;i<posts.length;i++) if (posts[i].pn && posts[i].pn.parentNode) posts[i].pn.parentNode.classList.add(merge_class);\r\n      },\r\n      class_remove_all: function(posts, merge_class){\r\n        if (!merge_class) return;\r\n        for (var i=0;i<posts.length;i++) if (posts[i].pn && posts[i].pn.parentNode) posts[i].pn.parentNode.classList.remove(merge_class);\r\n      },\r\n      lazy_draw: null,\r\n      remove_th: function(th, remove){\r\n        var merge = this.bases[th.key];\r\n        if (merge) {\r\n//          var dbt = common_func.name2dbt(th.key);\r\n//          if (!cataLog.threads[th.key][16].th) cataLog.threads[th.key][16].th = {domain:dbt[0], board:dbt[1], no:dbt[2], posts:th.posts.slice(), __proto__:cataLog.threads[th.key][16]}; // test patch, but these funcs are NOT reentrant.\r\n//          var posts = (!remove)? th.posts.slice() : null;\r\n//          var k = 0;\r\n//          for (var i=th.posts.length-1;i>=0;i--) k = site2[th.domain_html].update_posts_remove_1(th, i, merge.pn, merge.isShown, merge, k);\r\n          var pnode = (!remove)? site2[th.domain_html].page_json2html3_skelton(th) : null;\r\n          site2[th.domain_html].update_posts_separate(th, merge, pnode);\r\n          if (--this.bases[th.key].isShown==0) {\r\n            cataLog.catalog_obj2.func_hide_org(th.key);\r\n            this.shown.delete(merge);\r\n            cataLog.catalog_obj2.lazy_tgts.delete(merge);\r\n          }\r\n          delete this.bases[th.key];\r\n          if (!remove) {\r\n            cataLog.threads[th.key][0] = pnode;\r\n            gGEH.pns_all_keys.set(pnode,th.key);\r\n          }\r\n//          if (!remove) {\r\n//            var dbt = common_func.name2dbt(th.key);\r\n//            var pnode = site2[th.domain_html].page_json2html3_skelton({no:dbt[2]});\r\n//            for (var i=0;i<posts.length;i++) site2[th.domain_html].update_posts_insert(posts,th.posts,i,i,pnode,false); // th.posts is NOT updated.\r\n//            th.posts = posts;\r\n//            site2[th.domain_html].page_json2html3_add_omitted_info({posts:th.posts, __proto__:liveTag.mems.getFromName(th.key)},th.posts,th.posts); // th.nof_xxx are required.\r\n////            site2[th.domain_html].page_json2html3_add_omitted_info(th,th.posts,th.posts); // th.nof_xxx are required.\r\n//            cataLog.threads[th.key][0] = pnode;\r\n//          }\r\n        }\r\n      },\r\n      merge_th: function(th, merge){\r\n        var k=0;\r\n        for (var i=0;i<th.posts.length;i++) {\r\n//          cataLog.format_html.prepare_html_post(th, merge.posts[i]); // NEED TO CHECK CAPABILITY OF REENTRY.\r\n          k = site2[th.domain_html].update_posts_merge_1(th, merge, i, k);\r\n        }\r\n        this.bases[th.key].isShown++;\r\n        if (merge.lazy && merge.lazy_idx<merge.posts.length) this.lazy_tgts.set(merge,th.key); // patch for merge_first. slightly redundant.\r\n      },\r\n      base_arr: function(name, old){\r\n        return pref_func.merge_obj5a_sc(name, old? pref3.proto.merge_list_obj2_old : pref3.proto.merge_list_obj2, null);\r\n      },\r\n      base_tgts: function(name){\r\n        if (pref[cataLog.embed_mode].merge) return Object.keys(this.bases)[0] || name;\r\n        else if (pref[cataLog.embed_mode].merge_list) {\r\n          var ref = this.base_arr(name);\r\n          if (!ref) return null;\r\n          for (var key in this.bases) if (this.base_arr(key)===ref) return key;\r\n          return name;\r\n        } else return null;\r\n      },\r\n      func_show: function(name,ref, with_hr){ // this refers catalog_obj2\r\n        var mb = site2['DEFAULT'].update_posts_merge_bases;\r\n        var base = mb.bases[name];\r\n        if (!base) {\r\n          var tgts = mb.base_tgts(name);\r\n          if (tgts) {\r\n            var tgt_th = cataLog.threads[name];\r\n            base = mb.query({pn:tgt_th[0], __proto__:tgt_th[16]}, tgts, false);\r\n          }\r\n        }\r\n//        var base = (pref[cataLog.embed_mode].merge)? mb.query({pn:tgt_th[0], __proto__:tgt_th[16]}, 'ALL', false) : mb.bases[name];\r\n        if (base) {\r\n//          if (base.isShown!=0) cataLog.catalog_obj2.func_hide_org(name);\r\n//          if (base.isShown==0) base.isShown++;\r\n          if (!mb.shown.has(base)) cataLog.catalog_obj2.func_show_org(name,ref, with_hr);\r\n          return true;\r\n        } else return this.func_show_org(name,ref, with_hr);\r\n      },\r\n      func_hide: function(name){ // this refers catalog_obj2\r\n        var mb = site2['DEFAULT'].update_posts_merge_bases;\r\n        if (mb.bases[name]) {\r\n          mb.remove_th(cataLog.threads[name][16]);\r\n          return true;\r\n        } else return this.func_hide_org(name);\r\n      },\r\n      func_search_ref: function(key){ // this refers catalog_obj2\r\n        var mb = site2['DEFAULT'].update_posts_merge_bases;\r\n        return mb.bases[key] && mb.shown.get(mb.bases[key])!==key;\r\n      },\r\n      func_track_shown: function(name, update_drawn_y){ // this refers catalog_obj2\r\n        var mb = site2['DEFAULT'].update_posts_merge_bases;\r\n        var base = mb.bases[name];\r\n        if (base) {\r\n          if (!mb.shown.has(base)) {\r\n//          var pn = base.pn;\r\n//          if (!mb.shown.has(pn) || mb.shown.get(pn)===name) { // ===name for reentry.\r\n            this.func_track_shown_org(name, !pref[cataLog.embed_mode].merge && update_drawn_y);\r\n            mb.shown.set(base, name);\r\n          }\r\n          if (base.lazy && base.lazy_idx<base.posts.length) this.lazy_tgts.set(base,name);\r\n          if (pref[cataLog.embed_mode].merge && update_drawn_y) \r\n            var step = (pref.test_mode['88'])? 1 : pref[cataLog.embed_mode].lazyDraw.merge_step;\r\n            if (++this.post_count%step==0) this.drawn_y = cataLog.threads[name][16].posts[0].pn.offsetTop;\r\n        } else this.func_track_shown_org(name, update_drawn_y);\r\n      },\r\n      shown: new Map(), // base -> name of first shown pair for search_ref\r\n      shownSet: null,\r\n      isShownForTails: function(name){\r\n        if (!this.shownSet) {\r\n          this.shownSet = new Set();\r\n          for (var name of this.shown.values()) this.shownSet.add(this.base_arr(name));\r\n        }\r\n        return this.shownSet.has(this.base_arr(name));\r\n      },\r\n      func_track_reset: function(){ // this refers catalog_obj2\r\n        var mb = site2['DEFAULT'].update_posts_merge_bases;\r\n        mb.shown.clear();\r\n        mb.shownSet = null;\r\n        this.post_count = 0;\r\n        this.lazy_tgts.clear();\r\n        this.func_track_reset_org();\r\n      },\r\n      setup_hook: function(){\r\n        cataLog.catalog_obj2.func_show_org = cataLog.catalog_obj2.func_show;\r\n        cataLog.catalog_obj2.func_show     = this.func_show;\r\n        cataLog.catalog_obj2.func_hide_org = cataLog.catalog_obj2.func_hide;\r\n        cataLog.catalog_obj2.func_hide     = this.func_hide;\r\n        cataLog.catalog_obj2.func_track_shown_org = cataLog.catalog_obj2.func_track_shown;\r\n        cataLog.catalog_obj2.func_track_shown     = this.func_track_shown;\r\n        cataLog.catalog_obj2.func_track_reset_org = cataLog.catalog_obj2.func_track_reset;\r\n        cataLog.catalog_obj2.func_track_reset     = this.func_track_reset;\r\n        cataLog.catalog_obj2.func_search_ref = cataLog.catalog_obj2.func_search_ref;\r\n        cataLog.catalog_obj2.post_count = 0;\r\n        var lazy_tgts = new Map();\r\n        cataLog.catalog_obj2.lazy_tgts = lazy_tgts;\r\n        this.lazy_tgts = lazy_tgts;\r\n//        cataLog.catalog_obj2.lazy_draw = function(name){ // this refers catalog_obj2\r\n//          var mb = site2['DEFAULT'].update_posts_merge_bases;\r\n//          var merge = mb.bases[name];\r\n//          if (!merge || !merge.lazy || merge.lazy_idx>=merge.posts.length) lazy_tgts.set(merge,name);\r\n//        };\r\n        this.initialized = true;\r\n        cataLog.catalog_obj2.lazy_draw = function(){\r\n          var ref_height = cataLog.get_ref_height(4);\r\n          for (var merge of lazy_tgts.keys()) {\r\n            var i = merge.lazy_idx;\r\n            if (i>=1 && merge.posts[i-1].pn.offsetTop>ref_height) break;\r\n            var j = 0;\r\n            var step = (pref.test_mode['88'])? 1 : pref[cataLog.embed_mode].lazyDraw.merge_step;\r\n            var th_domain_html = (pref.catalog.mimic_base_site)? site.nickname : cataLog.threads[lazy_tgts.get(merge)][16].domain_html;\r\n            while (i<merge.posts.length) {\r\n              if (merge.lazy[i]) {\r\n                if (j<i) j=i+1;\r\n                while (j<merge.lazy.length && merge.lazy[j]) j++;\r\n                site2[th_domain_html].update_posts_insert(merge.posts,merge.posts,i,j,merge.pn);\r\n                merge.lazy[i] = false;\r\n                var merge_class = merge.get_class(merge.posts[i].key_op);\r\n                if (merge_class) merge.posts[i].pn.parentNode.classList.add(merge_class);\r\n              }\r\n              if (!pref.test_mode['111']) if (++cataLog.catalog_obj2.post_count%step==0 && merge.posts[i].pn.offsetTop>ref_height) break; // slow.\r\n              i++;\r\n            }\r\n            merge.lazy_idx = i;\r\n            if (i>=merge.posts.length) lazy_tgts.delete(merge);\r\n          }\r\n        };\r\n      },\r\n      release_hook: function(){},\r\n      onchange_merge: function(e){\r\n        var mb = site2['DEFAULT'].update_posts_merge_bases;\r\n        var et_name1 = (e.target.name || e.target.getAttribute('name')).split('.')[1];\r\n        if (et_name1==='merge_list_str' && !pref[cataLog.embed_mode].merge_list) return;\r\n        var check_tgts = (et_name1==='merge')? function(){return true;}\r\n        : (et_name1==='merge_list')? function(name){return mb.base_arr(name) || mb.base_arr(name,true);}\r\n                       : function(name){\r\n                           var now = mb.base_arr(name);\r\n                           var old = mb.base_arr(name,true);\r\n                           return (now)? (!old || now.join()!==old.join()) : old;};\r\n        for (var name in cataLog.threads) {\r\n          var tgt_th = cataLog.threads[name];\r\n          if (tgt_th[1] && check_tgts(name))\r\n            if (cataLog.catalog_obj2.func_hide(name)) tgt_th[1] = false;\r\n        }\r\n        pref3.proto.merge_list_obj2_old = null;\r\n        cataLog.catalog_obj2.func_track_reset();\r\n        if (!mb.initialized) mb.setup_hook();\r\n        if (et_name1==='merge') {\r\n          if (pref[cataLog.embed_mode].merge) pref3.catalog.indexing_old = pref.catalog.indexing;\r\n          cataLog.components.catalog.indexing.onfocus();\r\n          pref.catalog.indexing = (pref[cataLog.embed_mode].merge)? 7 : pref3.catalog.indexing_old; // 7:/creation\r\n          pref_func.apply_prep(cataLog.components.catalog.indexing,false,true); // call show_catalog();\r\n          cataLog.components.catalog.indexing.onblur();\r\n          cataLog.components.catalog.indexing.disabled = pref[cataLog.embed_mode].merge;\r\n        } else cataLog.show_catalog();\r\n      },\r\n      onchange_lv: function(e){\r\n        if (!pref[cataLog.embed_mode].merge && !pref[cataLog.embed_mode].merge_list) return;\r\n        var et_name = (e.target.name || e.target.getAttribute('name')).split('.')[1];\r\n        if (et_name==='merge_lv_str' && !pref[cataLog.embed_mode].merge_lv) return;\r\n        var mb = site2['DEFAULT'].update_posts_merge_bases;\r\n        for (var name in cataLog.threads) {\r\n          if (!cataLog.threads[name][1]) continue;\r\n          var base = mb.bases[name];\r\n          if (!base) continue;\r\n          var now = base.get_class(name);\r\n          var old = base.get_class(name,true,true);\r\n          if (et_name==='merge_lv' || now!=old) {\r\n            var posts = cataLog.threads[name][16].posts;\r\n            if (et_name!=='merge_lv' || !pref[cataLog.embed_mode].merge_lv) mb.class_remove_all(posts,old);\r\n            if (et_name!=='merge_lv' ||  pref[cataLog.embed_mode].merge_lv) mb.class_add_all(posts,now);\r\n          }\r\n        }\r\n        pref3.proto.merge_lv_obj2_old = null;\r\n      },\r\n    },\r\n////////    update_posts_merge_base: null,\r\n    update_posts_replace_prep: function(posts,posts_old,num) { // use newer posts as much as possible // concate posts by no. existence of posts_old was checked in caller.\r\n      if (!posts || posts.length<=1) return (num<0 || posts_old.length<=num+1)? posts_old : (num==0)? posts_old.slice(0,1) : posts_old.slice(0,1).concat(posts_old.slice(-num));\r\n      num = (num>=0)? num+1 : posts_old.length + posts.length -1;\r\n      if (num==posts.length) return posts;\r\n      if (num< posts.length) return posts.slice(0,1).concat(posts.slice(posts.length - num + 1)); // cut\r\n      var first_no = posts[1].no;\r\n      var i=1;\r\n      while (i<posts_old.length && posts_old[i].no<first_no) i++;\r\n      if (i===1) return posts;\r\n      var start = (i>num-posts.length)? i-(num-posts.length) : 1;\r\n      return posts.slice(0,1).concat(posts_old.slice(start,i),posts.slice(1));\r\n    },\r\n    update_posts0_class: function(pn,search_result) {\r\n      if (search_result) pn.classList.remove('CatChan_search_miss');\r\n      else               pn.classList.add('CatChan_search_miss');\r\n    },\r\n    update_posts_replace: function(th,th_old,pnode,merge,show, posts_used) {\r\n      if (merge) {\r\n        pnode = merge.pn;\r\n        show  = merge.isShown;\r\n      }\r\n      if (th_old.posts) {\r\n        var info_old = th_old.parse_funcs_html.get_omitted_info(th_old.posts[0]); // (th_old.posts[0].pn)? : null; // for lazy_draw in merge, but this is patched in 'update_posts_merge_1'.\r\n        var info_new = (th.posts[0].pn)? th.parse_funcs_html.get_omitted_info(th.posts[0]) : site2[th.domain_html].page_json2html3_add_omitted_info(th,null,th.posts);\r\n        if (info_old) {\r\n//          if (info_new) th_old.parse_funcs_html.replace_omitted_info(info_old, info_new);\r\n//          else info_old.parentNode.removeChild(info_old);\r\n          th_old.parse_funcs_html.replace_omitted_info2(info_old, info_new, th); // REDUNDANT when check new replies at initial in page view.\r\n        } else if (info_new) th_old.parse_funcs_html.set_omitted_info(th_old.posts[0], info_new);\r\n////        var nos = {}; // working code.\r\n////        for (var i=1;i<th.posts.length;i++) nos[th.posts[i].no] = null;\r\n////        for (var i=th_old.posts.length-1;i>=1;i--) \r\n////          if (nos[th_old.posts[i].no]===undefined) {\r\n////            this.update_posts_remove(th_old,i,pnode);\r\n////            th_old.posts.splice(i,1);\r\n////          }\r\n        var k = -1;\r\n        var j = th.posts.length-1;\r\n//        var scroll_back = 0;\r\n//        var now_height = (scroll_lock)? brwsr.document_body.scrollTop : 0; // WILL BE CHANGED TO get_now_height for multi inscance\r\n        var editings = null;\r\n        for (var i=th_old.posts.length-1;i>=1;i--) {\r\n          while (j>1 && th.posts[j].no>th_old.posts[i].no) j--;\r\n          var editing = th_old.posts[i].editing && th_old.posts[i].pn && th_old.posts[i]!==th.posts[j]; // meguca returns old data sometime since they uses cache.\r\n          // Meguca uses caches of 30 seconds, so it returns old data sometime, and last posts aren't contained in old data sometimes.\r\n          // CatChan takes this as a situation of \"the posts was removed\", so deleted_posts are fluctuate,\r\n          // and th.posts may contain shallow copies of th_old.posts because deleted_posts are merged with live posts.\r\n          // So, \"insert-remove\" method causes an error when the post is a shallow copy of an old post beacuse th.posts[j].pn.parentNode will be null.\r\n          if (th.posts[j].no!=th_old.posts[i].no || editing) k = this.update_posts_remove_1(th_old, i, pnode, show, merge, k);\r\n          if (editing) if (editings) editings[editings.length] = th.posts[j]; else editings = [th.posts[j]];\r\n//          else if (th_old.posts[i].editing && (th_old.posts[i].pn) && th_old.posts[i]!==th.posts[j]) { // meguca returns old data sometime since they uses cache.\r\n////          } else if (th_old.posts[i].editing && (!merge || show) && (th_old.posts[i].pn)) {\r\n//            var thq = liveTag.mems[th.domain][th.board][th.no].q;\r\n//            cataLog.format_html.prepare_html_post(th, th.posts[j]);\r\n//            this.popups_add_1(th, th.posts[j], false, thq, j===0, true);\r\n//            if (pref[cataLog.embed_mode].backlink) if (thq[th.posts[j].no].backlinks) site2[th.domain_html].add_backlinks(th.posts[j].pn,thq[th.posts[j].no].backlinks, undefined, th);\r\n//            th_old.posts[i].pn.parentNode.insertBefore(th.posts[j].pn,th_old.posts[i].pn);\r\n//            th_old.posts[i].pn.parentNode.removeChild(th_old.posts[i].pn);\r\n//            th_old.posts[i] = th.posts[j];\r\n//            posts_used[posts_used.length] = th.posts[j];\r\n//          }\r\n        }\r\n//        if (scroll_back) window.scrollTo(0,now_height + scroll_back);\r\n      }\r\n      this.update_posts_add(th,th_old,pnode,merge,show, posts_used, editings);\r\n    },\r\n    update_posts_add: function(th,th_old,pnode,merge,show, posts_used, editings) {\r\n      if (th_old.posts && th.posts) {\r\n        var thq = liveTag.mems[th.domain][th.board][th.no].q;\r\n        var time_unit = (merge)? th.parse_funcs.time_unit : 1; // (merge)? for safety.\r\n//        var first_no = th_old.posts[1].no; // working, but not verified enough.\r\n//        if (th.posts[1].no<first_no) {\r\n//          var end=1;\r\n//          while (end+1<th.posts.length && th.posts[end+1].no<first_no) end++;\r\n//          var i=end;\r\n//          while (i>=1) {\r\n//            this.update_posts_1(th,th_old,pnode,merge, i, 1, time_unit, thq); // inset before\r\n//            th_old.posts.splice(1,0,th.posts[i--]);\r\n//          }\r\n//          if (merge && show) this.update_posts_insert_merge(th.posts.splice(0,end+1),1);\r\n//        }\r\n//        var th_old_posts_length = th_old.posts.length;\r\n//        for (var i=th_old_posts_length;i<th.posts.length;i++) {\r\n//          this.update_posts_1(th,th_old,pnode,merge, i, th_old.posts.length, time_unit, thq); // th_old.posts.length is live count, always add to end. // add after\r\n//          th_old.posts[th_old.posts.length] = th.posts[i];\r\n//        }\r\n//        if (th.posts.length>1 && merge && show) this.update_posts_insert_merge(th.posts,th_old_posts_length);\r\n\r\n        var k = -1;\r\n        var j=(merge)? 0 : 1; // for filter output, random insert.\r\n        for (var i=(merge)? 0 : 1;i<th.posts.length;i++) {\r\n          while (j<th_old.posts.length && th.posts[i].no>th_old.posts[j].no) j++;\r\n          if (j>=th_old.posts.length || th.posts[i].no!=th_old.posts[j].no) {\r\n            var editing = editings && editings.indexOf(th.posts[i])!=-1;\r\n            var thq = editing? liveTag.mems[th.domain][th.board][th.no].q : null; // must be here?\r\n            cataLog.format_html.prepare_html_post(th, th.posts[i]);\r\n            if (editing) {\r\n              this.popups_add_1(th, th.posts[i], false, thq, true);\r\n              if (pref[cataLog.embed_mode].backlink) if (thq[th.posts[i].no].backlinks) site2[th.domain_html].add_backlinks(th.posts[i].pn,thq[th.posts[i].no].backlinks, undefined, th);\r\n            }\r\n            if (!merge) this.update_posts_insert(th.posts,th_old.posts,i,j,pnode); // th_old.posts.length is live count, always add to end.\r\n            else k = this.update_posts_merge_1(th, merge, i, k);\r\n//            this.update_posts_1(th,th_old,pnode,merge, i, j, time_unit, thq); // th_old.posts.length is live count.\r\n            if (j<th_old.posts.length) th_old.posts.splice(j,0,th.posts[i]); // live array\r\n            else th_old.posts[th_old.posts.length] = th.posts[i];\r\n            posts_used[posts_used.length] = th.posts[i];\r\n          }\r\n          if (j<th_old.posts.length) j++;\r\n        }\r\n//        if (th.posts.length>1 && merge && show) this.update_posts_insert_merge(th.posts,0, th_old.posts[0].pn);\r\n      }\r\n    },\r\n    update_posts_remove_1: function(th_old, i, pnode, isShown, merge, k){\r\n      var post = th_old.posts[i];\r\n      if (isShown) if (pref[cataLog.embed_mode].scroll_lock) cataLog.show_catalog_scroll_lock.modified(post);\r\n      if (!merge) {\r\n        if (post.pn) this.update_posts_remove(th_old,i,pnode); // MAY CAUSE A BUG. post.pn may not have the same lifetime as th.pn\r\n      } else {\r\n        k = (k==-1)? merge.posts.indexOf(post) // for faster search\r\n                   : merge.posts.lastIndexOf(post, k);\r\n        if (k==-1) k = merge.posts.lastIndexOf(post); // 4chan sometimes returns out-of-order posts.\r\n        if (k>=0) if (merge.remove(k)) this.update_posts_remove(th_old,i,pnode);\r\n      }\r\n//      scroll_back += this.update_posts_remove(th_old,i,pnode,now_height); // SLOW.\r\n      th_old.posts.splice(i,1);\r\n      return k;\r\n    },\r\n    update_posts_merge_1: function(th, merge, i, k){\r\n      var ref_time = th.posts[i].time_tu;\r\n      if (k==-1) k = merge.posts.length-1;\r\n      while (k>0 && merge.posts[k].time_tu>=ref_time) k--; // for faster search // 4chan sometimes returns out-of-order posts.\r\n      while (k<merge.posts.length && (merge.posts[k].time_tu <ref_time || \r\n                                      merge.posts[k].time_tu==ref_time && merge.posts[k].no<=th.posts[i].no)) k++;\r\n      if (merge.lazy) merge.lazy_draw(k);\r\n      if (!merge.lazy || (!pref.test_mode['89'] && i==0)) {\r\n        this.update_posts_insert(th.posts,merge.posts,i,merge.lazy? merge.draw_1_pos(k)-1:k, merge.pn); // th_old.posts.length is live count, always add to end if !merge.lazy.\r\n        var merge_class = merge.get_class(th.key);\r\n        if (merge_class) th.posts[i].pn.parentNode.classList.add(merge_class);\r\n      }\r\n//      if (i==0) th.posts[0].isOP = true;\r\n//      if (merge.lazy) merge.lazy_draw(k);\r\n//      else this.update_posts_insert(th.posts,merge.posts,i,k,merge.pn); // th_old.posts.length is live count, always add to end.\r\n//      if (!pref.test_mode['89'] && merge.lazy && i==0) // required, sometimes OP has omitted_info outside of the OP. \r\n//        if (pref[cataLog.embed_mode].merge) this.update_posts_insert(th.posts,merge.posts,i,merge.draw_1_pos(k)-1,merge.pn);\r\n////        if (pref.test_mode['89']) this.update_posts_insert(th.posts,merge.posts,i,merge.draw_1_pos(k)-1,merge.pn,merge); // i!=0 for ommited info, which doesn't expect lazy drawing. -1 of dst[j] is because dst isn't updated yet.\r\n//        else th.posts[0].isOP = true;\r\n      if (k<merge.posts.length) merge.posts.splice(k,0,th.posts[i]); // live array\r\n      else merge.posts[merge.posts.length] = th.posts[i];\r\n      return k;\r\n    },\r\n    update_posts_separate: function(th, merge, pn_sep){\r\n      var merge_class = merge.get_class(th.key, true);\r\n      var k=0;\r\n      for (var i=0;i<th.posts.length;i++) {\r\n        var post = th.posts[i];\r\n        k = merge.posts.indexOf(post, k);\r\n        if (k==-1) k = merge.posts.indexOf(post); // 4chan sometimes returns out-of-order posts.\r\n        var exist = (k!=-1)? merge.remove(k) : false;\r\n        if (merge.isShown) if (pref[cataLog.embed_mode].scroll_lock) cataLog.show_catalog_scroll_lock.modified(post);\r\n        if (merge_class && post.pn.parentNode) post.pn.parentNode.classList.remove(merge_class);\r\n        if (pn_sep) this.update_posts_insert(th.posts,[],i,i,pn_sep);\r\n        else if (exist) this.update_posts_remove(th,i,merge.pn);\r\n      }\r\n    },\r\n//    update_posts_1: function(th,th_old,pnode,merge, tgt, pos, time_unit, thq) { // working code.\r\n//      if (!merge) this.update_posts_insert(th.posts,th_old.posts,tgt,pos,pnode,merge); // th_old.posts.length is live count, always add to end.\r\n////      this.format_pn(th.posts[tgt].pn, th_old.q[th.posts[tgt].no]); // WILL BE THIS.\r\n////      if (time_unit!==1) th.posts[tgt].time *= time_unit; // BUG!!!, THIS DOESN'T ALLOW MULTIPLE ENTRY, CAN'T BE USED FOR POSTS SEARCH.\r\n//    },\r\n////    update_posts_add: function(th,th_old,pnode,merge,show) { // working code.\r\n////      if (th_old.posts && th.posts) {\r\n////        var thq = liveTag.mems[th.domain][th.board][th.no].q;\r\n////        var last_no = th_old.posts[th_old.posts.length-1].no;\r\n////        if (th.posts[th.posts.length-1].no==last_no || th.posts.length<=1) return;\r\n////        //        var i=1;\r\n////        //        while (i<th.posts.length && th.posts[i].no<=last_no) i++;\r\n////        var i=th.posts.length;\r\n////        while (i>1 && th.posts[i-1].no>last_no) i--;\r\n////        if (i>1) th.posts.splice(1,i-1);\r\n////        if (pref[cataLog.embed_mode].t2h_num_of_posts>=0 && th.posts.length > pref[cataLog.embed_mode].t2h_num_of_posts+1) {\r\n////          th.posts.splice(1,th.posts.length - pref[cataLog.embed_mode].t2h_num_of_posts -1);\r\n////          this.page_json2html3_add_omitted_info(th, th_old.posts, th.posts);\r\n////        }\r\n////        var time_unit = (merge)? th.parse_funcs.time_unit : 1; // (merge)? for safety.\r\n////        for (var i=1;i<th.posts.length;i++) {\r\n////          if (!merge) this.update_posts_insert(th.posts,th_old.posts,i,th_old.posts.length,pnode,merge); // th_old.posts.length is live count, always add to end.\r\n////            this.format_pn(th.posts[i].pn, (thq)? thq[th.posts[i].no] : null);\r\n////          //          this.format_pn(th.posts[i].pn, th_old.q[th.posts[i].no]); // WILL BE THIS.\r\n////          if (time_unit!==1) th.posts[i].time *= time_unit;\r\n////          th_old.posts[th_old.posts.length] = th.posts[i];\r\n////        }\r\n////        if (th.posts.length>1 && merge && show) this.update_posts_insert_merge(th.posts,1);\r\n////      }\r\n////    },\r\n////////    update_posts_insert_merge: function(src,start, src0_pn) { // working code, but very slow because of based on HTML.\r\n////////      if (pref[cataLog.embed_mode].scroll_lock) cataLog.show_catalog_scroll_lock.set();\r\n////////      var i,j;\r\n////////      var myself = this.update_posts_prep_merge();\r\n////////      var dst = myself.posts;\r\n////////      var pnode = myself.pn;\r\n////////      src = src.slice();\r\n////////      src[0].pn = src0_pn; // patch for posts search\r\n////////      for (var i=src.length-1;i>=0;i--) // sort by timestamp only, so if there is, that is already sorted.\r\n////////        if (src[i].pn) {\r\n////////          var tgt = src[i].pn.parentNode;\r\n////////          while (tgt) {\r\n////////            if (tgt===pnode) {src.splice(i,1);break;} // if other sorting scheme is needed, change this to 'update_posts_remove'\r\n////////            else tgt = tgt.parentNode;\r\n////////          }\r\n////////        }\r\n////////      if (src.length===0) return;\r\n////////      if (start===0) {\r\n////////        i = start;\r\n////////        j = 0;\r\n////////        var step = dst.length & 0x7ffffff0;\r\n////////        while (i<src.length) {\r\n////////          if (step>1) while (j+step<dst.length && (dst[j+step].time_tu<src[i].time_tu || dst[j+step].time_tu==src[i].time_tu && dst[j+step].no<=src[i].no)) j += step+1;\r\n////////          while (j<dst.length && (dst[j].time_tu<src[i].time_tu || dst[j].time_tu==src[i].time_tu && dst[j].no<=src[i].no)) j++;\r\n////////          if (j<dst.length) site2[site.nickname].update_posts_insert(src, dst, i++, j, pnode);\r\n////////          else { // can't refer nodes after inserted one.\r\n////////            var k = src.length-1;\r\n////////            site2[site.nickname].update_posts_insert(src, dst, k--, j, pnode);\r\n////////            while (k>=i) {\r\n////////              site2[site.nickname].update_posts_insert(src, src, k, k+1, pnode); // can't refer nodes after inserted one.\r\n////////              k--;\r\n////////            }\r\n////////            break;\r\n////////          }\r\n////////        }\r\n////////      } else {\r\n////////        i = src.length-1;\r\n////////        j = dst.length;\r\n////////        while (i>=start) {\r\n////////          while (j>0 && (dst[j-1].time_tu>src[i].time_tu || dst[j-1].time_tu==src[i].time_tu && dst[j-1].no>src[i].no)) j--;\r\n////////          site2[site.nickname].update_posts_insert(src, dst, i--, j, pnode);\r\n////////          while (i>=start && !(j>0 && (dst[j-1].time_tu>src[i].time_tu || dst[j-1].time_tu==src[i].time_tu && dst[j-1].no>src[i].no))) { // dst is NOT updated. It's an object, not a live list.\r\n////////            site2[site.nickname].update_posts_insert(src, src, i, i+1, pnode);\r\n////////            i--;\r\n////////          }\r\n////////        }\r\n////////      }\r\n////////    },\r\n////////    update_posts_prep_merge: function() {\r\n////////      return (cataLog.embed_mode==='thread')? this.wrap_to_parse.get(document, site.nickname, site.board, 'thread_html', {thread:site.no})[0] :\r\n////////                                              this.wrap_to_parse.get(document, site.nickname, site.board, 'page_html', {page:0})[0];\r\n////////    },\r\n////    update_posts_add: function(th,th_old,pnode) { // working code.\r\n////      if (th_old.posts && th.posts) {\r\n////        var thq = liveTag.mems[th.domain][th.board][th.no].q;\r\n////        for (var i=1;i<th.posts.length;i++) {\r\n////          if (th.posts[i].no>th_old.posts[th_old.posts.length-1].no) {\r\n////            this.update_posts_insert(th,th_old,i,pnode);\r\n////            this.format_pn(th.posts[i].pn, (thq)? thq[th.posts[i].no] : null);\r\n//////            this.format_pn(th.posts[i].pn, th_old.q[th.posts[i].no]); // WILL BE THIS.\r\n////            th_old.posts[th_old.posts.length] = th.posts[i];\r\n////          }\r\n////        }\r\n////      }\r\n////    },\r\n////////    update_posts_add: function(th,th_old,pnode) { // working code.\r\n////////      var ref = th_old.posts[0].nextSibling || null;\r\n////////      for (var i=0;i<th.posts.length;i++) {\r\n////////        if (th.posts[i].no>th_old.posts[th_old.posts.length-1].no) {\r\n////////          pnode.appendChild(document.createElement('br'));\r\n////////          pnode.appendChild(this.post_container(th.posts[i].pn || this.post_json2html(th.posts[i],th.posts.board),th.posts[i].no));\r\n////////          th_old.posts[th_old.posts.length] = th.posts[i];\r\n////////        }\r\n////////      }\r\n////////    },\r\n    short_link:function(){return '';},\r\n    page_json2html3_replace_expander: function(){}, // temporal\r\n    page_json2html3_add_omitted_info: function(){}, // temporal\r\n    post_json2html_fname_server: function(post){return post.tim+post.ext;},\r\n    post_json2html_fname: function(post){return post.filename+post.ext;},\r\n    post_com2txt_finisher: (function(){\r\n      var pn_com = document.createElement('div');\r\n      return function(txt, pst){\r\n        if (txt.search(/&[#\\w\\d]+;/)==-1) return txt; //  && !pref.test_mode['58']) return txt;\r\n        if (pref.debug_mode['17']) console.log('not interpreted html: '+txt);\r\n        pn_com.innerHTML = pst && pst.com; // giving com is faster than giving txt.\r\n        return pn_com.textContent; // [brwsr.innerText];\r\n      };\r\n    })(),\r\n    post_com2txt: function(post){\r\n      return (!post.com)? '' : this.post_com2txt_finisher(post.com.replace(/<[^>]*>/g,' ').replace(/&gt;/g,'>').replace(/&lt;/g,'<').replace(/&amp;/g,'&'), post); // most of lainchan, speed: 9.4/1.99, misshit 4%\r\n    },\r\n    patch:{},\r\n    post_pn2ce: function(pn){\r\n      return (pn.lastChild.tagName==='BLOCKQUOTE')? pn.lastChild : pn.getElementsByTagName('blockquote')[0];\r\n    },\r\n//    post_an2pn: function(pn){\r\n//      while (pn && pn.classList && !pn.classList.contains('post')) pn = pn.parentNode; // because document.parentNode.parentNode.classList===undefined\r\n//      return pn;\r\n//    },\r\n//    post_pn2ce: function(pn){return pn;},\r\n  };\r\n  site2['common'] = { // common functions\r\n    absorb_children: function(pn){\r\n      var container = document.createElement('div');\r\n      while (pn.childNodes.length!=0) container.appendChild(pn.childNodes[0]);\r\n      pn.appendChild(container);\r\n      return container;\r\n    },\r\n    disgorge_children: function(pn){\r\n      while (pn.childNodes.length!=0) pn.parentNode.appendChild(pn.childNodes[0]);\r\n      pn.parentNode.removeChild(pn);\r\n    },\r\n    remove_by_classname : function(pn,classname,end,remove_br){\r\n      if (end===undefined) end = 0;\r\n      var tgts = pn.getElementsByClassName(classname);\r\n      for (var i=tgts.length-1-end;i>=0;i--) {\r\n        if (remove_br && tgts[i].nextSibling && tgts[i].nextSibling.tagName==='BR') tgts[i].parentNode.removeChild(tgts[i].nextSibling);\r\n//if (!pref.test_mode['14']) tgts[i].setAttribute('style','display:none;'+(tgts[i].getAttribute('style') || ''));\r\n//else\r\n        tgts[i].parentNode.removeChild(tgts[i]);\r\n      }\r\n    },\r\n//    remove_by_classname : function(pn,classname,end,remove_br){ // cause document leak in Chrome at 4chan/a/.\r\n//      if (end===undefined) end = 0;\r\n//      var tgts = pn.getElementsByClassName(classname);\r\n//      for (var i=tgts.length-1-end;i>=0;i--) {\r\n//        if (remove_br && tgts[i].nextSibling && tgts[i].nextSibling.outerHTML==='<br>') tgts[i].parentNode.removeChild(tgts[i].nextSibling);\r\n//        tgts[i].parentNode.removeChild(tgts[i]);\r\n//      }\r\n//    },\r\n    remove_by_tagname : function(pn,tagname,end){\r\n      if (end===undefined) end = 0;\r\n      var tgts = pn.getElementsByTagName(tagname);\r\n      for (var i=tgts.length-1-end;i>=0;i--) tgts[i].parentNode.removeChild(tgts[i]);\r\n    },\r\n    remove_by_attribute : function(pns,attr_name,attr_val){ // pns must be array.\r\n      for (var i=pns.length-1;i>=0;i--)\r\n        for (var j=pns[i].childNodes.length-1;j>=0;j--)\r\n          if (pns[i].childNodes[j].getAttribute)\r\n            if (pns[i].childNodes[j].getAttribute(attr_name))\r\n              if (pns[i].childNodes[j].getAttribute(attr_name).search(attr_val)!=-1) pns[i].removeChild(pns[i].childNodes[j]);\r\n    },\r\n    remove_attribute : function(doc,attr_name){\r\n      var pns = doc.getElementsByTagName('*');\r\n      for (var i=pns.length-1;i>=0;i--)\r\n        if (pns[i].getAttribute && pns[i].getAttribute(attr_name)) pns[i].removeAttribute(attr_name);\r\n    },\r\n    add_attribute_by_classname : function(pn,classname,attr_name,attr_val){\r\n      var tgts = pn.getElementsByClassName(classname);\r\n      for (var i=tgts.length-1;i>=0;i--) tgts[i].setAttribute(attr_name,attr_val);\r\n    },\r\n    add_attribute_by_tagname : function(pn,tagname,attr_name,attr_val){\r\n      var tgts = pn.getElementsByTagName(tagname);\r\n      for (var i=tgts.length-1;i>=0;i--) tgts[i].setAttribute(attr_name,attr_val);\r\n    },\r\n    add_attribute_by_attribute : function(pns,attr_name,attr_val,attr_name2,attr_val2){ // pns must be array.\r\n      for (var i=pns.length-1;i>=0;i--)\r\n        for (var j=pns[i].childNodes.length-1;j>=0;j--)\r\n          if (pns[i].childNodes[j].getAttribute)\r\n            if (pns[i].childNodes[j].getAttribute(attr_name))\r\n              if (pns[i].childNodes[j].getAttribute(attr_name).search(attr_val)!=-1) pns[i].setAttribute(attr_name2,attr_val2);\r\n    },\r\n    move_up_and_delete_parent : function(pns){\r\n      for (var i=0;i<pns.length;i++) {\r\n        var parent = pns[i].parentNode;\r\n        var g_parent = parent.parentNode;\r\n        g_parent.insertBefore(pns[i],parent);\r\n        g_parent.removeChild(parent);\r\n      }\r\n    },\r\n    remove_last_hrs_and_brs : function(th){\r\n      while (1) {\r\n        var last_node = th.childNodes[th.childNodes.length-1];\r\n        if (last_node.tagName !== 'HR' && last_node.tagName !== 'BR') break;\r\n        else th.removeChild(last_node);\r\n      }\r\n    },\r\n    remove_brs : function(elem){\r\n      var tgts = elem.getElementsByTagName('br');\r\n      for (var i=tgts.length-1;i>=0;i--) tgts[i].parentNode.removeChild(tgts[i]);\r\n    },\r\n    remove_double_br : function(elem){\r\n      var elems = elem.getElementsByTagName('*');\r\n      for (var i=elems.length-2;i>=0;i--)\r\n//        if (elems[i].outerHTML=='<br>' && elems[i+1].outerHTML=='<br>') elems[i+1].parentNode.removeChild(elems[i+1]); // CAN'T FIND STRINGS WITHOUT TAGS.\r\n        if (elems[i].outerHTML==='<br>' && elems[i].nextSibling && elems[i].nextSibling.tagName==='BR') elems[i].parentNode.removeChild(elems[i].nextSibling);\r\n    },\r\n    remove_double_tags : function(elem,tag){\r\n      var elems = elem.getElementsByTagName('*');\r\n      for (var i=elems.length-2;i>=0;i--) {\r\n        if (elems[i].tagName===tag && elems[i+1].tagName===tag) elems[i+1].parentNode.removeChild(elems[i+1]);\r\n      }\r\n    },\r\n    change_utc_to_local : function(utc_str){\r\n      var date = new Date(utc_str);\r\n//      return date.toString().replace(/\\ GMT.*/,'');\r\n      return date.toLocaleString().replace(/\\ /,' ('+date.toString().replace(/\\ .*/,'')+') ');\r\n    },\r\n////////    thread2headline : function(doc,nickname){\r\n////////      var retval  = site2[nickname].insert_footer(doc,0,'t2h',false,0,0,0);\r\n////////      site2[nickname].remove_posts(doc,pref.catalog_t2h_num_of_posts);\r\n////////      site2.common.remove_double_br(doc);\r\n////////      var retval2 = site2[nickname].insert_footer(doc,0,'t2h',false,0,0,0);\r\n////////      return [retval[0]-retval2[0], retval[1]-retval2[1]];\r\n////////    },\r\n  };\r\n  var site4 = {\r\n////////\r\n//////// TUNING RESULTS to parse entire 4chan by chrome, (avarage of 3 times), 2015/10/5 on XXX.\r\n////////     TYPE1: written in flat with 'exe_sub'. (traditional)\r\n////////     TYPE2: written in array with 'exe_sub'.\r\n////////     TYPE3: written in array.\r\n////////     TYPE4: written in array systematically.\r\n////////     TYPE5: written in flat.\r\n////////   results(ms): (idle), (program), (anonymous_function), usage. \r\n////////     TYPE1: 179164.7, 24936.9, 12598.6, 17.3%\r\n////////     TYPE2: 165382.5, 35503.6, 14546.3, 23.2%\r\n////////     TYPE3: 169261.9, 23509.1, 13727.0, 18.0%\r\n////////     TYPE4: 159156.4, 37429.6, 14104.5, 24.5%\r\n////////     TYPE5: 159990.8, 32805.5, 14998.7, 23.0%\r\n////////\r\n//////// TUNING RESULTS use TYPE1 to parse entire 4chan 2015/12/19 on chrome 47.0.2526.106m. Just one trial.\r\n////////     rev_547: 12min05s\r\n////////     rev_714: 11min30s, why does 4chan become so slow? lainchan is not so slow.\r\n////\r\n////    parse_funcs_getters: {}, // works.\r\n////    parse_funcs_getters: Object.create(null), // THIS DOESN'T WORK.\r\n////    parse_funcs_getters: (function(){ // works if '{}'\r\n//////      var obj = Object.create(null); // DOESN'T WORK, probably introduce problem to make prototype chain using '__proto__'.\r\n////      var obj = {}; // works.\r\n////      var props=['no','ths','key','time_bumped','nof_posts','nof_files','time_created','posts','sub','name','com','flag','flags',\r\n////                 'footer','sticky','format','pn','pn_name','time','time_posted','tn_as','tn_imgs','op_img_url','post_no'];\r\n////      for (var i=0;i<props.length;i++) Object.defineProperty(obj,props[i],{get:(function(prop){return function(){return this.exe_sub(prop);}})(props[i]), enumerable:true});\r\n////      return obj;\r\n////    })(),\r\n////\r\n    parse_funcs_getters: { // working code. // TYPE1\r\n      get no() {return this.exe_sub('no');},\r\n//      get ths() {return this.exe_sub('ths');}, // removed to get faster.\r\n      get key() {return this.exe_sub('key');},\r\n      get time_bumped() {return this.exe_sub('time_bumped');},\r\n      get nof_posts() {return this.exe_sub('nof_posts');},\r\n      get nof_files() {return this.exe_sub('nof_files');},\r\n      get time_created() {return this.exe_sub('time_created');},\r\n      get posts() {return this.exe_sub('posts');},\r\n      get sub() {return this.exe_sub('sub');},\r\n      get name() {return this.exe_sub('name');},\r\n      get com() {return this.exe_sub('com');},\r\n      get flag() {return this.exe_sub('flag');},\r\n      get flags() {return this.exe_sub('flags');},\r\n      get footer() {return this.exe_sub('footer');},\r\n      get sticky() {return this.exe_sub('sticky');},\r\n//      get format() {return this.exe_sub('format');},\r\n      get pn() {return this.exe_sub('pn');},\r\n//      get pn_name() {return this.exe_sub2('pn_name');},\r\n      get time() {return this.exe_sub('time');},\r\n      get time_posted() {return this.exe_sub('time_posted');},\r\n//      get html_org() {return this.exe_sub('html_org');},\r\n      get tn_as() {return this.exe_sub2('tn_as');},  // CAUTION. ADDED AFTER TUNING.\r\n      get tn_imgs() {return this.exe_sub2('tn_imgs');},  // CAUTION. ADDED AFTER TUNING.\r\n      get op_img_url() {return this.exe_sub('op_img_url');},\r\n////      get post_no() {return this.exe_sub('post_no');},\r\n//      get last_replies() {return this.exe_sub('last_replies');},   // CAUTION. ADDED AFTER TUNING.\r\n      get txt() {return this.exe_sub('txt');},   // CAUTION. ADDED AFTER TUNING.\r\n\r\n      get time_tu() {return this.time * this.parse_funcs.time_unit;},   // CAUTION. ADDED AFTER TUNING. THIS IS NOT A CALLER.\r\n      get lth() {return liveTag.mems[this.domain][this.board][this.no];},   // CAUTION. ADDED AFTER TUNING. THIS IS NOT A CALLER.\r\n      get type_mimic(){return this.type_parse;},\r\n      get key_op() {return this.domain + this.board + (this.resto || this.op || this.no);}, // this.op for meguca, it always refer to op, while resto===0 if it is op itself.\r\n    },\r\n////    parse_funcs_on_demand : { // TYPE5\r\n////      get no() {return Object.defineProperty(this,'no',{value:this.parse_funcs['no'](this), enumerable:true, configurable:true, writable:true})['no'];},\r\n////      get ths() {return Object.defineProperty(this,'ths',{value:this.parse_funcs['ths'](this), enumerable:true, configurable:true, writable:true})['ths'];},\r\n////      get key() {return Object.defineProperty(this,'key',{value:this.parse_funcs['key'](this), enumerable:true, configurable:true, writable:true})['key'];},\r\n////      get time_bumped() {return Object.defineProperty(this,'time_bumped',{value:this.parse_funcs['time_bumped'](this), enumerable:true, configurable:true, writable:true})['time_bumped'];},\r\n////      get nof_posts() {return Object.defineProperty(this,'nof_posts',{value:this.parse_funcs['nof_posts'](this), enumerable:true, configurable:true, writable:true})['nof_posts'];},\r\n////      get nof_files() {return Object.defineProperty(this,'nof_files',{value:this.parse_funcs['nof_files'](this), enumerable:true, configurable:true, writable:true})['nof_files'];},\r\n////      get time_created() {return Object.defineProperty(this,'time_created',{value:this.parse_funcs['time_created'](this), enumerable:true, configurable:true, writable:true})['time_created'];},\r\n////      get posts() {return Object.defineProperty(this,'posts',{value:this.parse_funcs['posts'](this), enumerable:true, configurable:true, writable:true})['posts'];},\r\n////      get sub() {return Object.defineProperty(this,'sub',{value:this.parse_funcs['sub'](this), enumerable:true, configurable:true, writable:true})['sub'];},\r\n////      get name() {return Object.defineProperty(this,'name',{value:this.parse_funcs['name'](this), enumerable:true, configurable:true, writable:true})['name'];},\r\n////      get com() {return Object.defineProperty(this,'com',{value:this.parse_funcs['com'](this), enumerable:true, configurable:true, writable:true})['com'];},\r\n////      get flag() {return Object.defineProperty(this,'flag',{value:this.parse_funcs['flag'](this), enumerable:true, configurable:true, writable:true})['flag'];},\r\n////      get flags() {return Object.defineProperty(this,'flags',{value:this.parse_funcs['flags'](this), enumerable:true, configurable:true, writable:true})['flags'];},\r\n////      get footer() {return Object.defineProperty(this,'footer',{value:this.parse_funcs['footer'](this), enumerable:true, configurable:true, writable:true})['footer'];},\r\n////      get sticky() {return Object.defineProperty(this,'sticky',{value:this.parse_funcs['sticky'](this), enumerable:true, configurable:true, writable:true})['sticky'];},\r\n////      get format() {return Object.defineProperty(this,'format',{value:this.parse_funcs['format'](this), enumerable:true, configurable:true, writable:true})['format'];},\r\n////      get pn() {return Object.defineProperty(this,'pn',{value:this.parse_funcs['pn'](this), enumerable:true, configurable:true, writable:true})['pn'];},\r\n////      get pn_name() {return Object.defineProperty(this,'pn_name',{value:this.parse_funcs['pn_name'](this), enumerable:true, configurable:true, writable:true})['pn_name'];},\r\n////      get time() {return Object.defineProperty(this,'time',{value:this.parse_funcs['time'](this), enumerable:true, configurable:true, writable:true})['time'];},\r\n////      get time_posted() {return Object.defineProperty(this,'time_posted',{value:this.parse_funcs['time_posted'](this), enumerable:true, configurable:true, writable:true})['time_posted'];},\r\n//////      get html_org() {return Object.defineProperty(this,'html_org',{value:this.parse_funcs['html_org'](this), enumerable:true, configurable:true, writable:true})['html_org'];},\r\n////      get tn_as() {return Object.defineProperty(this,'tn_as',{value:this.parse_funcs['tn_as'](this), enumerable:true, configurable:true, writable:true})['tn_as'];},\r\n////      get tn_imgs() {return Object.defineProperty(this,'tn_imgs',{value:this.parse_funcs['tn_imgs'](this), enumerable:true, configurable:true, writable:true})['tn_imgs'];},\r\n////      get op_img_url() {return Object.defineProperty(this,'op_img_url',{value:this.parse_funcs['op_img_url'](this), enumerable:true, configurable:true, writable:true})['op_img_url'];},\r\n////      get post_no() {return Object.defineProperty(this,'post_no',{value:this.parse_funcs['post_no'](this), enumerable:true, configurable:true, writable:true})['post_no'];},\r\n////    },\r\n    parse_funcs_on_demand : {},\r\n    parse_funcs_on_demand_debug : {},\r\n    parse_funcs_no_cache: {},\r\n    parse_funcs_one_time: {}\r\n  };\r\n////  var props=['no','ths','key','time_bumped','nof_posts','nof_files','time_created','posts','sub','name','com','flag','flags', // works.\r\n////             'footer','sticky','format','pn','pn_name','time','time_posted','tn_as','tn_imgs','op_img_url','post_no'];\r\n////  for (var i=0;i<props.length;i++)\r\n//////    Object.defineProperty(site4.parse_funcs_getters,props[i],{get:(function(prop){return function(){return this.exe_sub(prop);}})(props[i]), enumerable:true}); // TYPE2\r\n////    Object.defineProperty(site4.parse_funcs_on_demand,props[i],{get:(function(prop){ // WORKS // TYPE3\r\n////      return function(){\r\n////        return Object.defineProperty(this,prop,{value:this.parse_funcs[prop](this), enumerable:true, configurable:true, writable:true})[prop];\r\n////      }})(props[i]), enumerable:true});\r\n  site4.parse_funcs_on_demand = { // working code. // TYPE1,2\r\n    exe_sub : function(prop){return Object.defineProperty(this,prop,{value:this.parse_funcs[prop](this), enumerable:true, configurable:true, writable:true})[prop];},\r\n    exe_sub2 : function(prop){return this.parse_funcs_html[prop](this);}, // no cache\r\n    __proto__: site4.parse_funcs_getters\r\n  };\r\n  site4.parse_funcs_on_demand_debug = {\r\n    exe_sub : function(prop){\r\n      try {\r\n        return Object.defineProperty(this,prop,{value:this.parse_funcs[prop](this), enumerable:true, configurable:true, writable:true})[prop];\r\n      } catch(e) {\r\n        console.log('parse_error: '+this.key+', '+this.type_parse+', '+prop);\r\n        console.trace();\r\n        console.log(this);\r\n      }\r\n    },\r\n    exe_sub2 : function(prop){\r\n      try {\r\n        return this.parse_funcs_html[prop](this); // no cache\r\n      } catch(e) {\r\n        console.log('parse_error: '+this.key+', '+this.type_parse+', '+prop);\r\n        console.trace();\r\n        console.log(this);\r\n      }\r\n    },\r\n    __proto__: site4.parse_funcs_getters\r\n  };\r\n  site4.parse_funcs_no_cache = {\r\n    exe_sub : function(prop){return this.parse_funcs[prop](this);},\r\n    exe_sub2 : function(prop){return this.parse_funcs_html[prop](this);},\r\n    __proto__: site4.parse_funcs_getters\r\n  };\r\n  site4.parse_funcs_one_time = {\r\n    get posts() {return Object.defineProperty(this,'posts',{value:this.parse_funcs['posts'](this), enumerable:true, configurable:true, writable:true})['posts'];},\r\n    exe_sub : function(prop){return this.parse_funcs[prop](this);},\r\n    exe_sub2 : function(prop){return this.parse_funcs_html[prop](this);},\r\n    __proto__: site4.parse_funcs_getters\r\n  };\r\n\r\n////  (function (){ // WORKS, BUT TOO SLOW // TYPE4\r\n////    var props=['no','ths','key','time_bumped','nof_posts','nof_files','time_created','posts','sub','name','com','flag','flags', // works.\r\n////               'footer','sticky','format','pn','pn_name','time','time_posted','tn_as','tn_imgs','op_img_url','post_no'];\r\n////    for (var i=0;i<props.length;i++) {\r\n////      var func = (function(prop){return function(){\r\n////                   return Object.defineProperty(this,prop,{value:this.parse_funcs[prop](this), enumerable:true, configurable:true, writable:true})[prop];\r\n////                 }})(props[i]);\r\n////      var func_no_cache = (function(prop){return function(){\r\n////                   return this.parse_funcs[prop](this);\r\n////                 }})(props[i]);\r\n////      var func_debug = (function(func,prop){return function(){\r\n////                         try {\r\n//////                           return func();  // THIS DOESN'T WORK, WHY???\r\n////                           return Object.defineProperty(this,prop,{value:this.parse_funcs[prop](this), enumerable:true, configurable:true, writable:true})[prop]; // works.\r\n////                         } catch(e) {\r\n////                           console.log('parse_error: '+this.key+', '+this.type_parse);\r\n////                         }\r\n////                       }})(func,props[i]);\r\n////      Object.defineProperty(site4.parse_funcs_on_demand,props[i],{get:func, enumerable:true});\r\n////      Object.defineProperty(site4.parse_funcs_on_demand_debug,props[i],{get:func_debug, enumerable:true});  // NOT DEBUGGED YET\r\n////      Object.defineProperty(site4.parse_funcs_no_cache,props[i],{get:func_no_cache, enumerable:true});  // NOT DEBUGGED YET\r\n////      if (props[i]!=='posts') Object.defineProperty(site4.parse_funcs_one_time,props[i],{get:func, enumerable:true});  // NOT DEBUGGED YET\r\n////      else Object.defineProperty(site4.parse_funcs_one_time,props[i],{get:func_no_cache, enumerable:true});\r\n////    }\r\n////  })();\r\n\r\nif (pref.features.domains['8chan']) {\r\n  site2['8chan'] = {\r\n    nickname : '8chan',\r\n    domain_url: '8ch.net',\r\n    domain_url_image: 'media.8ch.net',\r\n//    home : site.protocol + '//8chan.co/faq.html', // stop twitter and IRC access.\r\n//    home : site.protocol + '//8ch.net/faq.html', // stop twitter and IRC access.\r\n//    home : site.protocol + '//8ch.net/favicon.ico', // can't work in FF.\r\n    home: site.protocol + '//8ch.net' + ((brwsr.ff)? '/faq.html' : '/favicon.ico'),\r\n//    protocol : 'https:',\r\n    protocol : site.protocol,\r\n    features : {uip_tracker: true},\r\n    utilize_boards_json: true,\r\n    check_func : function(){\r\n      var href = window.location.href;\r\n      if (href.search(/8chan.co|8ch.net/)!=-1) { // 8chan\r\n        site2['8chan'].domain_url = (href.search(/8ch.net/)!=-1)? '8ch.net' : '8chan.co';\r\n        this.home = site.protocol + '//' + this.domain_url + this.home.substr(this.home.lastIndexOf('/')); // FF doesn't work on favicon.\r\n        site.whereami = (document.title.indexOf('404 - Page Not Found')!=-1)? '404'\r\n                      : (href.search(/8ch\\.net\\/?$/)!=-1)? 'frame'\r\n                      : (href.search(/catalog\\.html/)!=-1)? 'catalog'\r\n                      : (href.search(/res\\/[0-9\\+]*\\.html/)!=-1)? 'thread'\r\n                      : (href.search(/8ch\\.net\\/index/)!=-1)? 'boards'\r\n                      : (href.search(/\\/$|(index|[0-9]+)\\.html|\\/#all$/)!=-1)? 'page'\r\n                      : (href.search(/boards.html/)!=-1)? 'boards'\r\n                      : 'other';\r\n        site.config(site2['8chan'].domain_url,'8chan');\r\n        site.header_height = function(){\r\n          var header = document.getElementsByClassName('boardlist')[0];\r\n          return (header)? header.offsetHeight : 0;\r\n        }\r\n        site.postform = document.getElementsByTagName('form')[0];\r\n//        site.postform_comment = document.getElementById('body');\r\n        if (site.postform) this.postform_prep();\r\n        site.max_page = site2['8chan'].max_page(site.board);\r\n        site.catalog = href.search(/catalog\\.html/)!=-1;\r\n        site.embed_to = (site.whereami==='thread' || site.whereami==='page')? {\r\n          top: function(){return document.getElementsByName('postcontrols')[0];},\r\n          bottom: function(){return document.getElementsByClassName('boardlist bottom')[0];}\r\n        } : (site.whereami==='catalog')? {\r\n          top: function(){return document.getElementsByClassName('thumbnail')[0].nextSibling;},\r\n          bottom: function(){return document.getElementsByTagName('footer')[0];}\r\n        } : {};\r\n        if (site.components.boardlist) site.components.boardlist.style.zIndex = 0;\r\n        if (site.whereami==='boards') {\r\n          var ppn = document.getElementById('search-form');\r\n          var button = ppn.parentNode.insertBefore(document.createElement('button'),ppn);\r\n//          var button = ppn.firstChild.appendChild(document.createElement('button')); // doesn't work, form is submitted.\r\n          button.textContent = 'TagSearch';\r\n          button.onclick = pref_func.settings.onchange_funcs['tag.scan'];\r\n        }\r\n        return true;\r\n      } else {\r\n        if (!brwsr.ff) {\r\n          this.protocol = 'https:';\r\n          this.home = this.protocol + '//' + this.domain_url + this.home.substr(this.home.lastIndexOf('/'));\r\n        }\r\n        return false;\r\n      }\r\n    },\r\n    postprocess_board: function(val){\r\n      for (var i=0;i<val.length;i++) {\r\n        if (val[i].max>0) { // val[i].max is string, but this is ok.\r\n          var bd = liveTag.mems.init({domain:this.nickname, board:'/'+val[i].uri+'/'});\r\n          bd.o = i;\r\n          if (val[i].pages && !bd.pgs) bd.pgs = val[i].pages;\r\n////          site3[this.nickname].boards.push(bd); // BUG. increase length forever.\r\n          Object.defineProperty(bd,'max',{value:parseInt(val[i].max,10), writable:true});\r\n          if (bd.read_max===undefined) Object.defineProperty(bd,'read_max',{value:0, writable:true});\r\n          if (val[i].tags && val[i].tags.length!=0) liveTag.postprocess_board_add_btag(val[i].tags,bd);\r\n        }\r\n      }\r\n    },\r\n////    enumerate_boards_to_scan:function(){\r\n////      var obj = [];\r\n////      var end = (site3[site.nickname].boards.length > pref.scan.max)? pref.scan.max : site3[site.nickname].boards.length;\r\n////      for (var i=0;i<end;i++) \r\n////        if (site3[site.nickname].boards[i].max) obj[obj.length] = '/'+site3[site.nickname].boards[i].uri+'/';\r\n////      return obj;\r\n////    },\r\n////    make_site3_bds:function(){ // working code.\r\n////      var tgts = site3[site.nickname].boards;\r\n////      for (var i=0;i<tgts.length;i++) site3[this.nickname].bds['/'+tgts[i].uri+'/'] = tgts[i].max;\r\n////    },\r\n    catalog_frame_prep: function(pn12){\r\n      document.getElementsByTagName('header')[0].style.display='none';\r\n      document.getElementsByClassName('footer')[0].style.display = 'none';\r\n      var frame_menu = document.getElementsByClassName('menuCol')[0];\r\n      frame_menu.firstChild.style.display='none';\r\n      var frame_main = document.getElementsByClassName('bodyCol')[0];\r\n      frame_main.firstChild.style.display = 'none';\r\n      frame_menu.insertBefore(pn12,frame_menu.firstChild);\r\n      var ifrm = this.catalog_native_frame_prep_frame(frame_main,frame_main.firstChild);\r\n      this.catalog_embed_prep(pn12);\r\n    },\r\n    prep_own_posts_event : function(e){\r\n      if (e && e.key==='own_posts') site2['8chan'].prep_own_posts();\r\n      if (window.name==='8chan') send_message('parent',['OWN_POSTS', window.name, site3[window.name].own_posts]);\r\n    },\r\n    prep_own_posts : function(){\r\n      var own_posts = {};\r\n      var obj = JSON.parse(localStorage.getItem('own_posts'));\r\n      for (var i in obj) {\r\n        var board = '/'+i+'/';\r\n        own_posts[board] = {};\r\n        for (var j=0;j<obj[i].length;j++) own_posts[board][obj[i][j]] = null;\r\n      }\r\n//      for (var i in obj)\r\n//        for (var j=0;j<obj[i].length;j++)\r\n//          own_posts['/'+i+'/'+obj[i][j]] = null;\r\n//console.log(own_posts);\r\n      site3['8chan'].own_posts = own_posts;\r\n    },\r\n////    format_thread_always : function(th){\r\n////////      site2.common.remove_last_hrs_and_brs(th); // working code.\r\n////      if (th.nextSibling && th.nextSibling.tagName==='HR') th.appendChild(th.nextSibling);\r\n////      else th.appendChild(document.createElement('hr'));\r\n////    },\r\n    preprocess_doc2: {\r\n      thread_html: function(doc){\r\n        var head = doc.getElementsByTagName('head')[0];\r\n        while (head.firstChild) head.removeChild(head.firstChild);\r\n        var body = doc.getElementsByTagName('body')[0];\r\n        for (var i=body.childNodes.length-1;i>=0;i--) if (body.childNodes[i].name!=='postcontrols') body.removeChild(body.childNodes[i]);\r\n      }\r\n    },\r\n\r\n    parse_funcs : { // 8chan\r\n      'catalog_html' : {\r\n//        ths: function(doc,req){\r\n//          var req2 = req[req.indexOf('ths')+1];\r\n//          var mixs = doc.pn.getElementsByClassName('mix');\r\n//          var ths = [];\r\n//          for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV') {\r\n//            ths.push({pn:mixs[i], board:doc.board, domain:doc.domain});\r\n//            site2['DEFAULT'].parse_funcs.call(this,ths[ths.length-1],req2);\r\n//          }\r\n//          return ths;\r\n//        },\r\n        before_test : ['ths',':ITER',':ALL','ths',['key','time_bumped','nof_posts','nof_files']],\r\n        after_test  : ['time_created','sub','name','com','footer','sticky','format'],\r\n        full_hier   : ['ths',':ITER',':ALL','ths',['key','time_bumped','nof_posts','nof_files','time_created','sub','name','com','footer','sticky','format']],\r\n//        full_th     : ['key','time_bumped','nof_posts','nof_files','sub','name','com','footer','sticky'],\r\n        ths: function(doc) {\r\n          var mixs = doc.pn.getElementsByClassName('mix');\r\n          var ths = [];\r\nif (pref.test_mode['0']) {\r\n          for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV') ths[ths.length] = {pn:mixs[i], page:Math.floor(i/15)+'.'+i%15};\r\n} else { \r\n          for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV') ths[ths.length] = mixs[i];\r\n          ths = this.ths_array(doc,ths);\r\n}\r\n//          for (var i=0;i<ths.length;i++) ths[i].pn.getElementsByTagName('a')[0].addEventListener('click',this.preventDefault,false); // TEST, works.\r\n          return ths;\r\n        },\r\n        th_init: function(th){\r\n          var pn_child = th.pn.getElementsByTagName('div')[0];\r\n//          pn_child.className = pn_child.className.replace(/grid\\-size\\-[a-z]*/,'grid-size-'+site2[th.domain].catalog_native_size); // BUG WHEN MIMICED.\r\n          pn_child.className = pn_child.className.replace(/grid\\-size\\-[a-z]*/,'grid-size-'+site2['8chan'].catalog_native_size);\r\n//          th.pn.getElementsByTagName('a')[0].removeAttribute('href');\r\n//          th.pn.getElementsByTagName('a')[0].addEventListener('click',th.parse_funcs.preventDefault,false); // TEST\r\n        },\r\n//        th_destroy: function(pn, parse_funcs){\r\n////          pn.getElementsByTagName('a')[0].removeEventListener('click',parse_funcs.preventDefault,false); // TEST\r\n//        },\r\n////        ths: function(doc) {\r\n////          var mixs = doc.pn.getElementsByClassName('mix');\r\n////          var ths = [];\r\n////if (pref.test_mode['0']) {\r\n////          for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV') ths[ths.length] = {pn:mixs[i], page:Math.floor(i/15)+'.'+i%15};\r\n////} else { \r\n//////          for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV')\r\n//////            ths[ths.length] = {pn:mixs[i], page:Math.floor(i/15)+'.'+i%15, type_html: 'catalog_html', __proto__:doc.__proto__};\r\n////          for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV') ths[ths.length] = mixs[i];\r\n////          ths = this.ths_array(doc,ths);\r\n////}\r\n////          for (var i=0;i<ths.length;i++) {\r\n////            var pn_child = ths[i].pn.getElementsByTagName('div')[0];\r\n////            pn_child.className = pn_child.className.replace(/grid\\-size\\-[a-z]*/,'grid-size-'+site2['8chan'].catalog_native_size);\r\n////          }\r\n////          for (var i=0;i<ths.length;i++) ths[i].pn.getElementsByTagName('a')[0].removeAttribute('href');\r\n//////          for (var i=0;i<ths.length;i++) ths[i].pn.getElementsByTagName('a')[0].addEventListener('click',this.preventDefault,false); // TEST\r\n////          return ths;\r\n//////          for (var i=mixs.length-1;i>=0;i--) if (mixs[i].tagName==='DIV') mixs[i]={pn:mixs[i]}; // CAN'T WRITE TO COLLECTION.\r\n//////                                             else Array.prototype.splice.call(mixs,i,1);\r\n//////          return mixs; // return collection\r\n////        },\r\n//        no : function(th){return th.pn.getElementsByTagName('img')[0].id.replace(/img\\-/,'');},\r\n        no : function(th){return parseInt(th.pn.getAttribute('data-id'),10);},\r\n        sticky: function(th){return th.pn.getAttribute('data-sticky')==='true';},\r\n        posts: 'DEFAULT.catalog_html',\r\n        proto: 'vichan.catalog_html'\r\n      },\r\n      'catalog_json' : {\r\n////        op_img_url: function(obj) { // working code.\r\n////          return (obj.ext==='.jpg' || obj.ext==='.png' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.webm' || obj.ext==='.mp4')?\r\n////                   'https://' + site2['8chan'].domain_url + obj.board + 'thumb/' + obj.tim + '.jpg' :\r\n////                 (obj.embed)? 'https:' + obj.embed.replace(/.*src=\"/,'').replace(/\".*/,'') :\r\n////                 (obj.ext==undefined)? 'https://' + site2['8chan'].domain_url + '/static/no-file.png' :\r\n//////                 (obj.ext==undefined)? 'https://' + site2['8chan'].domain_url + '/static/assets' + obj.board + 'no-file.png' :\r\n////                 '';\r\n//////          return ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://' + site2['8chan'].domain_url + obj.board + 'thumb/' + obj.tim + obj.ext : '');\r\n////        },\r\n        get_op_src: 'thread_json',\r\n        proto: 'vichan.catalog_json'\r\n      },\r\n      'page_html'    : {\r\n        ths: function(doc) {\r\n//          var pc = doc.pn.getElementsByName('postcontrols')[0].childNodes;\r\n//          var ths = [];\r\n//          if (pc) for (var i=0;i<pc.length;i++) if (pc[i].id && pc[i].id.substr(0,6)=='thread') ths[ths.length] = pc[i];\r\n//          ths = this.ths_array(doc,ths);\r\n          var ths = this.ths_array(doc,doc.pn.getElementsByClassName('thread')); // 2015.04.26 changed to the same as 4chan.\r\n          if (site.whereami!=='page' || !pref.catalog.embed_page) for (var i=0;i<ths.length;i++) ths[i].pn.removeAttribute('class');\r\n//          for (var i=0;i<ths.length;i++) if (ths[i].pn.nextSibling && ths[i].pn.nextSibling.tagName==='HR') ths[i].pn.appendChild(ths[i].pn.nextSibling);\r\n////          for (var i=0;i<ths.length;i++) {\r\n////            var as = ths[i].pn.getElementsByTagName('a');\r\n////            as[0].removeAttribute('href'); // changed 2015.04.26\r\n////            as[1].removeAttribute('href'); // changed 2015.04.26\r\n////          }\r\n          return ths;\r\n        },\r\n//        no : function(th){return parseInt(th.pn.getElementsByClassName('post op')[0].id.substring(3),10);},\r\n          pn: 'page_json', // for mimic\r\n        filename: 'thread_html',\r\n        proto: 'vichan.page_html'\r\n      },\r\n      'page_json'  : {\r\n        has_posts: true,\r\n//pn: function(th){return site2[th.domain_html].catalog_json2html3(th,th.board, this.op_img_url(th));}, // TEMPORAL PATCH\r\n        proto: 'vichan.page_json'\r\n      },\r\n      'thread_html'  : {\r\n////        qsel_th2posts: ':scope>.post.reply', // working code.\r\n////        pop_post_prep: function(th){\r\n////          th.posts_col = th.pn.querySelectorAll(this.qsel_th2posts);\r\n////          th.idx_pop = th.posts_col.length-1;\r\n////        },\r\n////        pop_post: function(th){\r\n////          while (th.idx_pop>=0) {\r\n////            var pn = th.posts_col[th.idx_pop--];\r\n////            if (pn.className && pn.className.indexOf('post')!=-1 && pn.className.indexOf('reply')!=-1) {\r\n////              th.post = {pn:pn, parse_funcs:this, __proto__:th.__proto__};\r\n////              return true;\r\n////            }\r\n////          }\r\n////          return false;\r\n////        },\r\n        filename: function (th){ // post can be accepted.\r\n          var filenames = [];\r\n          var files = ((th.pn.classList.contains('op'))? th.pn.parentNode : th.pn).getElementsByClassName('files')[0];\r\n          if (files) {\r\n            var spans = files.getElementsByClassName('postfilename');\r\n            for (var i=0;i<spans.length;i++) filenames[i] = spans[i].textContent;\r\n//            files = files.getElementsByClassName('file');\r\n//            for (var i=0;i<files.length;i++) {\r\n//              var as = files[i].getElementsByTagName('a');\r\n//              for (var j=0;j<as.length;j++) if (as[j].getAttribute('title')==='Save as original filename') filenames[filenames.length] = as[j].textContent;\r\n//            }\r\n          }\r\n          if (filenames.length>1) {\r\n            th.extra_files = [];\r\n            for (var i=1;i<filenames.length;i++) th.extra_files[i-1] = {filename:filenames[i], __proto__:th.__proto__};\r\n          }\r\n          return filenames[0];\r\n        },\r\n        get_op_src: 'thread_json',\r\n        proto: 'vichan.thread_html'\r\n      },\r\n      'thread_json'  : {\r\n        get_op_src: function(th){return th.op_img_url.replace('thumb','src').replace('.jpg',th.ext);},\r\n        proto: 'vichan.thread_json'\r\n      },\r\n    },\r\n\r\n////    popups_op_func_set: function(pn){return pn.parentNode.querySelector('.files');},\r\n//    popups_op_func_set: function(pn){return pn.querySelector('.files');}, // MUST BE CONSISTENT OF page_json2html\r\n//    popups_op_func_use: function(pn,thq,no){\r\n//      pn.setAttribute('class',pn.getAttribute('class')+' reply');\r\n//      pn.insertBefore(thq[no].isOP.cloneNode(true),pn.firstChild);\r\n//    },\r\n    update_posts_remove: function(th_old,i,pnode){\r\n      pnode.removeChild(th_old.posts[i].pn.nextSibling);\r\n      pnode.removeChild(th_old.posts[i].pn);\r\n    },\r\n    update_posts_insert: function(src,dst,i,j,pnode){\r\n      var ref = (j==1)? (dst[0].pn.nextSibling || null) :\r\n                (j<dst.length)? (dst[j].pn.nextSibling && dst[j].pn.nextSibling.nextSibling || null) : null;\r\n      if (!src[i].pn) src[i].pn = this.post_json2html(src[i],src[i].board);\r\n      pnode.insertBefore(src[i].pn, ref);\r\n      pnode.insertBefore(document.createElement('br'),ref);\r\n    },\r\n\r\n    catalog_json2html3_thumbnail: function(obj, board) {\r\n      return (obj.ext==='.jpg' || obj.ext==='.png' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.webm' || obj.ext==='.mp4')?\r\n        this.protocol + '//' + ((obj.tim.length!=64)? this.domain_url + board + 'thumb/' + obj.tim + (obj.ext==='.gif'? '.gif' : '.jpg')\r\n                                                    : this.domain_url_image + '/file_store/thumb/' + obj.tim + (obj.ext==='.gif'? '.gif' : obj.ext==='.png'? '.png' : obj.ext==='.jpeg'? '.jpeg' : '.jpg'))\r\n      : (obj.embed)? (obj.embed.slice(0,2)=='//'?'https:':'') + obj.embed.replace(/.*src=\"/,'').replace(/\".*/,'')\r\n      : (obj.ext==='.swf')? '/static/file.png' :\r\n//             (obj.ext===undefined)? site2['8chan'].protocol + site2['8chan'].domain_url + '/static/no-file.png' :\r\n////             (obj.ext===undefined)? 'https://' + site2['8chan'].domain_url + '/static/assets' + board + 'no-file.png' :\r\n             '';\r\n//      return ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://' + site2['8chan'].domain_url + board + 'thumb/' + obj.tim + obj.ext : '');\r\n    },\r\n    short_link:function(){return '';},\r\n    favicon: {\r\n      __proto__: site2['DEFAULT'].favicon,\r\n      none: '/favicon.ico',\r\n      reply: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAQElEQVR42mNgGEbg/5n/GJgYORQFDQ0IjK4BmxxWzehsQnJYBdFtxCWH1QBcrkKWw2sAWS6gKAwojgWqpIORDQBVkjfW5KYpFQAAAABJRU5ErkJggg==',\r\n      reply_to_me: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAWUlEQVR42mNgAIH/Z/4zNDRgYpA4UQBqADIYZAaAaHRMtAEwjB42cEPQFaCzCclhFcQWK9jk0A1A8QJW2xgYiDeAJBdQFAbYAhLdRryxgByVuOKaYDoY2QAAcHCIXLRHYMUAAAAASUVORK5CYII='\r\n    },\r\n    proto : 'vichan'\r\n  };\r\n  site2['8chan_live'] = {\r\n    parse_funcs : {\r\n      'thread_html'  : {\r\n        posts: function(th){return this.posts_array(th, th.pn.querySelectorAll(':scope>.post.reply'));},\r\n        proto: '8chan.thread_html'\r\n      }\r\n    },\r\n    proto : '8chan'\r\n  };\r\n}\r\nif (pref.features.domains['8chan'] || pref.features.domains['lain'] || pref.features.domains['lainjp']) {\r\n  site2['vichan'] = {\r\n    components: {\r\n      boardlist: '.boardlist',\r\n      postform_comment: ['textarea[name=\"body\"]',0],\r\n      postform_comment2: ['textarea[name=\"body\"]',1],\r\n      postform_submit: ['input[name=\"post\"]',0],\r\n      postform_submit2: ['input[name=\"post\"]',1],\r\n    },\r\n////    postform_prep: function(){\r\n////      site.components.postform_submit2 = null;\r\n////      site.components.postform_submit2_observer = new MutationObserver(this.postform_submit2_find);\r\n////      site.components.postform_submit2_observer.observe(document.getElementsByTagName('body')[0], {childList: true});\r\n////    },\r\n////    postform_submit2_find: function(){\r\n////      var postform_qr = document.querySelectorAll('input[name=post]')[1]; // quick reply\r\n////      if (!site.components.postform_submit2 && postform_qr) {\r\n////        site.components.postform_submit2 = postform_qr;\r\n//////        site.components.postform_submit2_observer.disconnect();\r\n//////        delete site.components.postform_submit2_observer;\r\n////        if (common_obj.thread_reader) common_obj.thread_reader.add_event_to_submit(site.components.postform_submit2);\r\n////      } else if (site.components.postform_submit2 && !postform_qr) {\r\n////        if (common_obj.thread_reader) common_obj.thread_reader.remove_event_from_submit(site.components.postform_submit2);\r\n////        site.components.postform_submit2 = null;\r\n////      }\r\n////      site.query_set_component('postform_comment2');\r\n////      recovery.setup2();\r\n////    },\r\n    general_event_handler:(function(){\r\n      var obj = {\r\n        thread: {\r\n          get_mark: function(pn, clientY){\r\n            while (pn && pn!== cataLog.parent) {\r\n              if (pn.tagName==='BR' || !pn.classList) {pn = pn.previousSibling || pn.parentNode; continue;}\r\n              if (pn.classList.contains('post')) return pn;\r\n              if (pn.classList.contains('postcontainer')) return pn.getElementsByClassName('post')[0];\r\n              if (pn.parentNode && pn.parentNode.id && pn.parentNode.id.search(/^thread/)!=-1) {\r\n                pn = pn.previousSibling;\r\n                if (pn) continue;\r\n                else break;\r\n              }\r\n              if (pn.id && pn.id.search(/^thread/)!=-1) break;\r\n              pn = pn.parentNode;\r\n            }\r\n            return this.get_mark_from_height(clientY);\r\n          },\r\n          get_mark_from_height: function(now_height){\r\n            return this.__proto__.get_mark_from_height(now_height, document.getElementsByClassName('post'));\r\n          },\r\n          image_hover_check_mode: function(img){\r\n            return img.parentNode.parentNode.classList.contains('file')? 'page' : 'catalog';\r\n          },\r\n          getID: function(pn){return pn.classList.contains('poster_id') && pn.textContent;},\r\n          __proto__: site2['DEFAULT'].general_event_handler.common,\r\n        },\r\n      };\r\n      obj.page = {\r\n        add_mouseover: pref.test_mode['68'], // true,\r\n        mouseover: function(e){\r\n          var et = e.target;\r\n          var et_tagName = et.tagName;\r\n          if (et_tagName==='A')\r\n            if (pref[cataLog.embed_mode].popup_truncated && et.parentNode.className==='toolong') site2['DEFAULT'].popups_posts.over(e);\r\n        },\r\n        __proto__:obj.thread\r\n      },\r\n      obj.catalog = Object.create(obj.thread);\r\n//      obj.catalog = { // working code\r\n//        mouseover: function(e){\r\n//          var et = e.target;\r\n//          var et_tagName = et.tagName;\r\n//          if (et_tagName==='IMG')\r\n//            if (pref[cataLog.embed_mode].image_hover && et.parentNode.tagName==='A') cataLog.image_hover_add.call(et, e);\r\n//        },\r\n//        __proto__:obj.thread\r\n//      };\r\n      return obj;\r\n    })(),\r\n    boards_sel_from_tags : function(){\r\n      var boards = document.getElementsByClassName('board-list-tbody')[0];\r\n      var str = 'SELECTED_BOARDS,';\r\n      for (var i=0;i<boards.childNodes.length;i++)\r\n        if (boards.childNodes[i].style.display!=='none') str = str + '8chan' + boards.childNodes[i].getElementsByClassName('board-uri')[0].getElementsByTagName('a')[0].getAttribute('href') + ',';\r\n      return str+'\\n';\r\n    },\r\n//    catalog_background : '#eef2ff',\r\n//    catalog_bordercolor : '#d6daf0',\r\n    get_next_image: function(img,top){\r\n      var imgs = Array.prototype.slice.call(cataLog.parent.getElementsByClassName('post-image')).filter(function(v){return v.src.substr(-5,5)!=='.webm';});\r\n//      var imgs = cataLog.parent.getElementsByClassName('post-image');\r\n//      var imgs = cataLog.parent.querySelectorAll('img[id^=\"thumbnail\"]');\r\n      return site2['DEFAULT'].get_next_image(img,top,imgs);\r\n    },\r\n//    get_time_of_posts : function(doc){ // working code.\r\n//      var posts = doc.getElementsByClassName('post');\r\n//      return [Date.parse(posts[posts.length-1].getElementsByTagName('time')[0].getAttribute('datetime')),\r\n//              Date.parse(posts[0             ].getElementsByTagName('time')[0].getAttribute('datetime'))];\r\n//    },\r\n////////    get_thread_link : function(pn,bn,del,name){\r\n////////      var as = pn.getElementsByClassName('post op')[0].getElementsByTagName('a');\r\n////////      var hrefs = [];\r\n////////      var href;\r\n////////      for (var i=as.length-1;i>=0;i--) if (as[i].innerHTML==='[Reply]' || as[i].innerHTML==='[Last 50 Posts]') {\r\n////////        var href = as[i].getAttribute('href');\r\n////////        if (hrefs.length==0 || as[i].innerHTML==='[Reply]') hrefs.unshift(href);\r\n////////        else hrefs.push(href);\r\n////////        if (del) as[i].parentNode.removeChild(as[i]);\r\n////////        else {\r\n//////////          as[i].setAttribute('target',(pref.catalog_open_in_new_tab)? '_blank' : '_self');\r\n//////////          as[i].setAttribute('onclick','open_new_thread('+as[i].getAttribute('href')+','+name+')');\r\n////////          as[i].addEventListener('click', function(){open_new_thread(as[i].getAttribute('href'),name);}, false);\r\n//////////          as[i].removeAttribute('href');\r\n////////        }\r\n////////      }\r\n////////      return (hrefs.length!=0)? hrefs : null;\r\n////////    },\r\n    modify_thread_link : function(pn){\r\n      var as = pn.getElementsByClassName('post op');\r\n      if (as.length==0) return [];\r\n      var retval = [];\r\n      as = as[0].getElementsByTagName('a');\r\n      for (var i=as.length-1;i>=0;i--) \r\n        if (as[i].innerHTML=='[Reply]' || as[i].innerHTML=='[Last 50 Posts]') {\r\n          var href = as[i].getAttribute('href');\r\n          if (href) {\r\n            retval.push([as[i],href]);\r\n//            as[i].addEventListener('click', make_open_new_thread_callback(href,name), false);\r\n//            as[i].addEventListener('click', function(){open_new_thread(href,name);}, false);\r\n            as[i].removeAttribute('href');\r\n          }\r\n        }\r\n      return retval;\r\n    },\r\n//    add_thread_link : function(doc,url){\r\n//      var pn = document.createElement('a');\r\n//      pn.href = url.replace(new RegExp('/https*:\\/\\/'+site2['8chan'].domain_url+'/'),'');\r\n//      pn.innerHTML = '[Reply]';\r\n//      var th = doc.getElementsByClassName('post op')[0];\r\n//      if (th) th.insertBefore(pn,th.firstChild);\r\n//    },\r\n    catalog_threads_in_page : function(doc){ // patch\r\n      var doc_obj = {domain:site.nickname, pn:doc};\r\n      var ths = this.parse_funcs['page_html'].ths(doc_obj);\r\n      for (var i=0;i<ths.length;i++) ths[i] = ths[i].pn;\r\n      return ths;\r\n    },\r\n//    catalog_threads_in_page : function(doc){return this.parse_funcs['page_html'].ths(doc);},\r\n//    catalog_threads_in_page : function(doc){\r\n//      var pc = doc.getElementsByName('postcontrols');\r\n//      th = [];\r\n//      if (pc.length!=0)\r\n//        for (var i=0;i<pc[0].childNodes.length;i++)\r\n//          if (pc[0].childNodes[i].id && pc[0].childNodes[i].id.substr(0,6)=='thread') th.push(pc[0].childNodes[i]);\r\n//      return th;\r\n//    },\r\n    remove_posts : function(th,end){\r\n      site2.common.remove_by_classname(th,'post reply',end,true);\r\n//      site2.common.remove_double_br(th);\r\n    },\r\n    remove_files_info : function(th){\r\n      site2.common.remove_by_classname(th,'fileinfo');\r\n      site2.common.move_up_and_delete_parent(th.getElementsByClassName('post-image'));\r\n    },\r\n//    site.catalog_files_info = function(doc){return doc.getElementsByClassName('fileinfo');};\r\n//    site.catalog_delete_checkboxs = function(doc){return doc.getElementsByClassName('delete');};\r\n//    remove_checkboxes : function(doc){\r\n//      var cbxs = doc.getElementsByClassName('delete');\r\n//      for (var i=cbxs.length-1;i>=0;i--) cbxs[i].outerHTML = '';\r\n//      return doc;\r\n//    },\r\n    postform_rules : null,\r\n    thread_keyword : 'res',\r\n    max_page : function(){return 15;},\r\n    make_url4 : function(dbt){\r\n      var url_prefix = this.protocol + '//' + this.domain_url + dbt[1];\r\n//      if (dbt[3]==='page_json') dbt[3] = 'page_html'; // TEMPORAL PATCH\r\n      if      (dbt[3]==='page_html')    return [url_prefix + ((dbt[2]!=0)? (parseInt(dbt[2],10)+1) :'index')+'.html', 'html'];\r\n      else if (dbt[3]==='page_json')    return [url_prefix +                parseInt(dbt[2],10)             +'.json', 'json'];\r\n      else if (dbt[3]==='catalog_json') return [url_prefix + 'catalog.json', 'json'];  // Doesn't contain information about webm thumbnail.\r\n      else if (dbt[3]==='catalog_html') return [url_prefix + 'catalog.html', 'html'];\r\n      else if (dbt[3]==='thread_html')  return [url_prefix + 'res/' + dbt[2] + '.html', 'html'];\r\n      else if (dbt[3]==='thread_json')  return [url_prefix + 'res/' + dbt[2] + '.json', 'json'];\r\n    },\r\n////////    make_url : function(board,no,key){ // working code.\r\n////////      var url_prefix = site2['8chan'].protocol + '//' + site2['8chan'].domain_url + board;\r\n////////      if (key==='p') return [url_prefix + ((no!=0)? (no+1) :'index')+'.html', 'html'];\r\n////////      else if (key==='j') return [url_prefix + 'catalog.json', 'json'];  // Doesn't contain information about webm thumbnail.\r\n////////      else return [url_prefix + 'catalog.html', 'html'];\r\n////////    },\r\n//////////    make_url3: function(board,th){return site2['8chan'].protocol + '//' + site2['8chan'].domain_url + board + 'res/' + th + '.html';},\r\n////////    make_url3: function(board,th){return site2['8chan'].protocol + '//' + site2['8chan'].domain_url + board + 'res/' + ((th[0]!=='t')? (th + '.html') : (th.substr(1) + '.json'));},\r\n//////////    make_url3: function(board,th){\r\n//////////      return [site2['8chan'].protocol + '//' + site2['8chan'].domain_url + board + 'res/' + ((th[0]!=='t')? (th + '.html') : (th.substr(1) + '.json')), (th[0]!=='t')? 'html' : 'json'];\r\n//////////    },\r\n    url_boards_json : function(){return [site2['8chan'].protocol + '//' + site2['8chan'].domain_url + '/boards.json','json'];},\r\n//    enumerate_boards_to_scan:function(){\r\n//      var obj = [];\r\n//      var end = (site3[site.nickname].boards.length > pref.scan.max)? pref.scan.max : site3[site.nickname].boards.length;\r\n//      for (var i=0;i<end;i++) \r\n//        if (site3[site.nickname].boards[i].max) obj[obj.length] = '/'+site3[site.nickname].boards[i].uri+'/';\r\n//      return obj;\r\n//    },\r\n    get_ops : function(doc){\r\n      var op_containers = doc.getElementsByClassName('post op');\r\n      var ops = [];\r\n//      for (var i=0;i<op_containers.length;i++) ops.push(op_containers[i].getElementsByTagName('input')[0].id.substring(7));\r\n      for (var i=0;i<op_containers.length;i++) ops.push(parseInt(op_containers[i].id.substring(3),10));\r\n      return ops;\r\n    },\r\n    get_posts : function(doc) {\r\n      var posts = [];\r\n//      var deletes = doc.getElementsByClassName('delete');\r\n//      for (var i=0;i<deletes.length;i++) posts.push(deletes[i].id.substr(7));\r\n      var nos = doc.getElementsByClassName('post_no');\r\n      for (var i=0;i<nos.length;i++) if (nos[i].id) posts.push(parseInt(nos[i].id.substr(8),10));\r\n      return posts;\r\n    },\r\n//    absolute_link : function(doc){\r\n//      var all = doc.getElementsByTagName('*');\r\n//      var tgts = ['src','href'];\r\n//      for (var i=0;i<all.length;i++) {\r\n//        for (var j=0;j<tgts.length;j++) {\r\n//          var tgt = all[i].getAttribute(tgts[j]);\r\n//          if (tgt && tgt.indexOf('http')!=0  && tgt.substr(0,2)!='//')  all[i].setAttribute(tgts[j],site2['8chan'].protocol + '//' + site2['8chan'].domain_url + tgt);\r\n//        }\r\n//      }\r\n//    },\r\n//    absolute_link : function(doc){\r\n//      var all = doc.getElementsByTagName('*');\r\n//      for (var i=0;i<all.length;i++) {\r\n//        if (all[i].getAttribute('src')  && all[i].getAttribute('src').indexOf('http')!=0  && all[i].getAttribute('src').substr(0,2)!='//')  all[i].setAttribute('src',site2['8chan'].protocol + '//' + site2['8chan'].domain_url + all[i].getAttribute('src'));\r\n//        if (all[i].getAttribute('href') && all[i].getAttribute('href').indexOf('http')!=0 && all[i].getAttribute('href').substr(0,2)!='//') all[i].setAttribute('href',site2['8chan'].protocol + '//' + site2['8chan'].domain_url + all[i].getAttribute('href'));\r\n//      }\r\n//    },\r\n////////    insert_footer : function(th,page_no,bn,exe,date,nof_posts,nof_files){\r\n////////      var key = (!brwsr.ff)? 'innerText' : 'innerHTML';\r\n////////      nof_posts += th.getElementsByClassName('post').length;\r\n////////      nof_files += th.getElementsByClassName('fileinfo').length;\r\n////////      var om_info = th.getElementsByClassName('omitted');\r\n////////      if (om_info[0]) {\r\n////////        var str = om_info[0][key].replace(/\\n/g,'');\r\n////////        nof_posts += parseInt(str.replace(/\\ post.*/,''),10);\r\n////////        nof_files += parseInt('0'+str.replace(/\\ image.*/,'').replace(/[^\\ ]*\\ /g,''),10);\r\n////////      }\r\n////////      if (exe) {\r\n////////        var pn = document.createElement('div');\r\n////////        pn.setAttribute('name','catalog_footer');\r\n////////        if (pref.catalog_footer_br) pn.setAttribute('style','clear:both');\r\n////////        pn.innerHTML = '<span>' + bn + '  ' + nof_posts + '/' + nof_files + '/' + page_no + '  </span>';\r\n//////////        pn.innerHTML = '<span><span>' + bn + '  </span><span></span><span>' + nof_posts + '/' + nof_files + '/' + page_no + '  </span></span>';\r\n////////        var flags = th.getElementsByClassName('flag');\r\n////////        for (var i=0;i<flags.length;i++) {\r\n////////          pn.appendChild(flags[i].cloneNode(false));\r\n//////////          pn.appendChild(document.createTextNode(' '));\r\n////////        }\r\n////////        th.insertBefore(pn,th.getElementsByClassName('post op')[0]);\r\n////////      }\r\n////////      return [nof_posts,nof_files];\r\n////////    },\r\n////////    insert_footer2 : function(th,type,nums,nums2){\r\n////////      var str_add = ((pref.catalog_footer_show_nof_rep_to_me)? nums[1]+'/' : '' ) +(nums2[2]-nums[2]);\r\n////////      if (type==='page') {\r\n////////        var footer = th.getElementsByTagName('div')['catalog_footer'];\r\n//////////        footer.childNodes[0].childNodes[1].innerHTML = nums[1] + '/' + (nums2[2]-nums[2]) + '/';\r\n//////////        footer.childNodes[0].innerHTML = footer.childNodes[0].innerHTML.replace(/  /,'  '+ nums[1] + '/' + (nums2[2]-nums[2]) + '/');\r\n////////        var str = footer.childNodes[0].innerHTML;\r\n////////        var fields = str.replace(/[^ ]*  /,'').split('/');\r\n////////        if (fields.length>3) fields.splice(0,fields.length-3);\r\n////////        footer.childNodes[0].innerHTML = str.replace(/  .*/,'  ') + ((nums[0]>=0)? str_add + '/' :'') + fields.join('/');\r\n////////      } else {\r\n////////        var footer = th.getElementsByTagName('strong')[0];\r\n////////        footer.childNodes[0].innerHTML = (nums[0]>=0)? 'U: '+ str_add + ' / ' : '';\r\n////////      } \r\n////////    },\r\n//    prep_footer3 : function(footer,board){\r\n////      th.footer.setAttribute('name',pref.script_prefix+'_footer');\r\n//      if (pref.catalog_footer_show_board_name) {\r\n////        footer.innerHTML = '<span name=\"'+pref.script_prefix+'_footer\">' + footer.innerHTML +'</span>' + '&emsp;' + board;\r\n//        footer.innerHTML = '<span>' + footer.innerHTML + '</span>' + '&emsp;' + board;\r\n//        footer = footer.childNodes[0];\r\n//      }\r\n//      return footer;\r\n//    },\r\n//    insert_footer3 : function(footer,nums,nums2){\r\n//      var str_add = ((pref.catalog_footer_show_nof_rep_to_me)? nums[1]+'/' : '' ) +(nums2[2]-nums[2]);\r\n//      var str = (pref.catalog_footer_design==='native')? ((nums[0]>=0)? 'U: '+ str_add + ' / ' : '') + 'R: '+(nums2[2]-1) + ' / I: '+nums2[3]\r\n//                                                       : ((nums[0]>=0)? str_add + '/' : '') + nums2[2] + '/'+nums2[3]; // trial.\r\n//      footer.innerHTML = str;\r\n//    },\r\n////////    check_reply_to_me : function(name,dbt,nums,value,date,pool){\r\n////////      var obj ;\r\n////////      var time_check = (nums[6]==nums[0])? nums[3] : nums[0];\r\n////////      if (dbt[2][0]==='t') {\r\n////////        obj = ('response' in value)? value.response.posts : JSON.parse(value.responseText).posts;\r\n////////        var images = 0;\r\n////////        for (var i=0;i<obj.length;i++) {\r\n////////          if ('filename' in obj[i]) images++;\r\n////////          if (obj[i].extra_files) for (var j=0;j<obj[i].extra_files.length;j++) if ('filename' in obj[i].extra_files[j]) images++;\r\n////////          obj[i].time *= 1000;\r\n//////////obj[i].time += - pref.localtime_offset*3600000; // BUG PATCH.\r\n////////          if (obj[i].ext==='.jpeg' || obj[i].ext==='.gif') obj[i].ext = '.jpg';\r\n////////          if (obj[i].filename) obj[i].icon =  'https://' + site2['8chan'].domain_url + dbt[1] + 'thumb/' + obj[i].tim + obj[i].ext;\r\n////////        }\r\n////////        obj[0].images = images;\r\n//////////        if (obj[obj.length-1].ext==='.jpeg' || obj[obj.length-1].ext==='.gif') obj[obj.length-1].ext = '.jpg';\r\n//////////        if (obj[obj.length-1].filename) obj[obj.length-1].icon =  'https://' + site2['8chan'].domain_url + dbt[1] + 'thumb/' + obj[obj.length-1].tim + obj[obj.length-1].ext;\r\n////////        pool.sticky = obj[0].sticky;\r\n////////      } else obj = site2['8chan'].get_posts2(value,pool,time_check);\r\n//////////      date = [obj[obj.length-1].time, date[1], obj.length, obj[0].images];\r\n//////////      date[0] = obj[obj.length-1].time; // CAUSE BUG IN PAGE, THIS PREVENT REVISING POST'S INFO FOR POPUPS. AND MUST BE FIXED TIMEZONE MISUNDERSTOOD.\r\n//////////if (date[4] != obj[obj.length-1].time) console.log('find: '+name+', '+date[4]+' -> '+obj[obj.length-1].time+', '+(obj[obj.length-1].time-date[4]));\r\n////////      date[4] = obj[obj.length-1].time;\r\n//////////                            IF UNCOMMENT, CAUSE BLINKS BECAUSE USING DIFFERENT METHOD TO EVALUATE,\r\n//////////                            IF COMMENT, DELAYS UPDATE AND CAUSE BUG IN PAGE MODE.\r\n//////////      date[2] = obj.length; // CAUSE BUG IN PAGE, THIS CAUSE INCONSISTENCY BETWEEN FOOTER AND POPUP COMMENTS.\r\n//////////      date[3] = obj[0].images; // CAUSE BUG IN PAGE, THIS CAUSE INCONSISTENCY BETWEEN FOOTER AND POPUP COMMENTS.\r\n////////\r\n//////////      var i = 0;\r\n//////////      while (i<obj.length && (!obj[i] || obj[i].time<=time_check)) i++;\r\n////////      var i = obj.length;\r\n////////      while (i-1>=0 && obj[i-1] && obj[i-1].time>time_check) i--;\r\n//////////console.log(name+', '+obj.length+', '+(obj.length-i));\r\n//////////      nums[2] = i;\r\n////////      var rep_to_me = (nums[6]==nums[0])? nums[1] : 0;\r\n////////      var rep       = (nums[6]==nums[0])? nums[7] : 0;\r\n////////      nums[4] = [];\r\n////////      if (nums[3]<nums[0]) nums[3]=nums[0];\r\n////////      if (i<obj.length ) {\r\n////////        while (i<obj.length) {\r\n////////          if (pref.catalog_footer_ignore_my_own_posts && (dbt[1]+obj[i].no in site3['8chan'].own_posts)) {i++;continue;}\r\n////////          rep++;\r\n//////////          if (obj[i].time>nums[3]) nums[4].push({icon:obj[obj.length-1].icon, body:obj[obj.length-1].com, time:obj[obj.length-1].time, to_me:false});\r\n////////          if (obj[i].time>nums[3]) nums[4].push({icon:obj[i].icon, body:obj[i].com, time:obj[i].time, to_me:false});\r\n////////          var tgts = [];\r\n////////          if (obj[i].com) {\r\n////////            var anchors = obj[i].com.match(/&gt;&gt;[0-9]+/g);\r\n////////            if (anchors) for (var j=0;j<anchors.length;j++) tgts.push(dbt[1]+anchors[j].substr(8));\r\n////////            anchors = obj[i].com.match(/&gt;&gt;&gt;\\/[0-9A-z_\\+]+\\/[0-9]+/g);\r\n////////            if (anchors) for (var j=0;j<anchors.length;j++) tgts.push(anchors[j].substr(12));\r\n//////////console.log(tgts);\r\n////////            for (var j=0;j<tgts.length;j++) {\r\n////////              if (site3['8chan'].own_posts[tgts[j]]===null) {\r\n////////                rep_to_me++;\r\n////////                if (obj[i].time>nums[3]) nums[4][nums[4].length-1].to_me = true;\r\n//////////console.log(dbt[2]+', >>'+tgts[j]);\r\n////////                break;\r\n////////          }}}\r\n//////////          var anchors = (obj[i].com)? obj[i].com.match(/&gt;&gt;[0-9]+/g) : null; // working code.\r\n//////////          if (anchors) {\r\n//////////            for (var j=0;j<anchors.length;j++) {\r\n//////////              var tgt = anchors[j].substr(8);\r\n//////////              if (site3['8chan'].own_posts[dbt[1]+tgt]===null) {\r\n//////////                rep_to_me++;\r\n//////////                if (obj[i].time>nums[3]) nums[4][nums[4].length-1].to_me = true;\r\n////////////console.log(dbt[2]+', >>'+tgt);\r\n//////////                break;\r\n//////////          }}}\r\n//////////          anchors = (obj[i].com)? obj[i].com.match(/&gt;&gt;&gt;\\/[0-9A-z_\\+]+\\/[0-9]+/g) : null;\r\n//////////          if (anchors) {\r\n//////////            for (var j=0;j<anchors.length;j++) {\r\n//////////              var tgt = anchors[j].substr(12);\r\n//////////              if (site3['8chan'].own_posts[tgt]===null) {\r\n//////////                rep_to_me++;\r\n//////////                if (obj[i].time>nums[3]) nums[4][nums[4].length-1].to_me = true;\r\n//////////                break;\r\n//////////          }}} \r\n////////          i++;\r\n////////        }\r\n////////      }\r\n////////      nums[2] = obj.length - rep;\r\n////////      nums[1] = rep_to_me;\r\n////////      nums[3] = obj[obj.length-1].time;\r\n////////      nums[6] = nums[0];\r\n////////      nums[7] = rep;\r\n////////    },\r\n////////    get_posts2 : function(doc,pool,time_check) {\r\n////////      var obj = [];\r\n////////      var posts = doc.getElementsByClassName('post');\r\n//////////      for (var i=0;i<posts.length;i++) {\r\n////////      var i=posts.length-1;\r\n////////      while (i>=0) {\r\n////////        var image = posts[i].getElementsByClassName('post-image');\r\n////////        image = (image[0])? image[0].getAttribute('src') : undefined;\r\n////////        var time = Date.parse(posts[i].getElementsByTagName('time')[0].getAttribute('datetime'));\r\n////////        obj[i] = {\r\n////////          time: time,\r\n////////          com:  posts[i].getElementsByClassName('body')[0].innerHTML,\r\n////////          no:   parseInt(posts[i].getElementsByClassName('post_no')[0].id.substr(8),10),\r\n////////          icon: image\r\n////////        }\r\n////////        if (time<=time_check && i!=0) i=0;\r\n////////        else i--;\r\n////////      }\r\n//////////      var image = posts[posts.length-1].getElementsByClassName('post-image');\r\n//////////      obj[obj.length-1].icon = (image[0])? image[0].src : undefined;\r\n////////      var files = doc.getElementsByClassName('thread')[0].getElementsByClassName('file');\r\n//////////      for (var i=files.length-1;i>=0;i--) if (files[i].tagName!=='DIV') files[i].remove(); // slow?\r\n////////      var nof_files = 0;\r\n////////      for (var i=files.length-1;i>=0;i--) if (files[i].tagName==='DIV') nof_files++;\r\n////////      var op_images = doc.getElementsByClassName('thread')[0].getElementsByClassName('files');\r\n////////      op_images = (!op_images[0])? 0 : op_images[0].getElementsByClassName('file').length;\r\n//////////      obj[0].images = files.length - op_images;\r\n////////      obj[0].images = nof_files - op_images;\r\n////////      pool.sticky = doc.getElementsByClassName('fa-thumb-tack').length!=0\r\n////////      return obj;\r\n////////    },\r\n    get_post_offsetTop : function(doc,num) {\r\n      return doc.getElementsByClassName('post')[num].offsetTop;\r\n    },\r\n    get_icon : function(pn,type,kind,tgt_th16){\r\n//      return (type==='catalog')? this.add_icon(pn,type,kind,tgt_th16) :\r\n      return (kind==='sticky')? pn.getElementsByClassName('fa-thumb-tack')[0] : null;\r\n    },\r\n    add_icon : function(pn,type,kind,tgt_th16){\r\n//      if (pn) {\r\n//        var del_tgt = tgt_th16['icon_'+kind];\r\n//        if (!del_tgt) {\r\n//          var count = 0;\r\n//          if (tgt_th16['icon_sticky']) count++;\r\n//          if (tgt_th16['icon_show_always']) count++;\r\n          var icon = (kind==='sticky')? this.make_tack() : this.make_showAlways();\r\n          var ref;\r\n          if (type==='catalog') {\r\n            ref = pn.getElementsByClassName('threadIcons')[0];\r\n            if (!ref) {\r\n              ref = document.createElement('div');\r\n              ref.setAttribute('class','threadIcons');\r\n              ref.setAttribute('style','position:absolute');\r\n              pn.firstElementChild.insertBefore(ref,pn.firstElementChild.firstChild);\r\n            }\r\n            ref.appendChild(icon);\r\n//            icon.setAttribute('style','position:absolute;left:' + (16*count) + 'px');\r\n//            ref = pn.getElementsByClassName('thread')[0];\r\n//            ref.insertBefore(icon,ref.firstChild);\r\n          } else {\r\n            var op = pn.getElementsByClassName('op')[0];\r\n            ref = op.getElementsByClassName('mentioned')[0] || op.getElementsByClassName('post_no')[1].nextSibling;\r\n//            ref = pn.getElementsByClassName('mentioned')[0] || Array.prototype.filter.call(pn.getElementsByTagName('a'),function(dom){return dom.textContent==='[Reply]';})[0];\r\n            ref.parentNode.insertBefore(icon,ref);\r\n          }\r\n          return icon;\r\n//        } else del_tgt.parentNode.removeChild(del_tgt);\r\n//      }\r\n//      return null;\r\n    },\r\n//    add_icon : function(th,type,kind,tgt_th16){\r\n//      if (type==='catalog') {\r\n//        var parent = th.getElementsByClassName('thread')[0];\r\n//        if (parent) {\r\n//          var del_tgt = tgt_th16['icon_'+kind];\r\n//          if (!del_tgt) {\r\n//            var count = 0;\r\n//            if (tgt_th16['icon_sticky']) count++;\r\n//            if (tgt_th16['icon_show_always']) count++;\r\n//            var icon = document.createElement('i');\r\n//            icon.setAttribute('class',(kind==='sticky')? 'fa fa-thumb-tack' : 'fa');\r\n//            icon.setAttribute('style','position:absolute;left:' + (16*count) + 'px');\r\n//            if (kind==='show_always') icon.textContent = '\\u2605';\r\n//            parent.insertBefore(icon,parent.firstChild);\r\n//            return icon;\r\n//          } else del_tgt.parentNode.removeChild(del_tgt);\r\n//        }\r\n//      }\r\n//      return null;\r\n//    },\r\n    favicon: {\r\n      __proto__: site2['DEFAULT'].favicon,\r\n      none: '/favicon.ico',\r\n      reply: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAQElEQVR42mNgGEbg/5n/GJgYORQFDQ0IjK4BmxxWzehsQnJYBdFtxCWH1QBcrkKWw2sAWS6gKAwojgWqpIORDQBVkjfW5KYpFQAAAABJRU5ErkJggg==',\r\n      reply_to_me: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAWUlEQVR42mNgAIH/Z/4zNDRgYpA4UQBqADIYZAaAaHRMtAEwjB42cEPQFaCzCclhFcQWK9jk0A1A8QJW2xgYiDeAJBdQFAbYAhLdRryxgByVuOKaYDoY2QAAcHCIXLRHYMUAAAAASUVORK5CYII='\r\n    },\r\n//    get_op_image_url: function(th,type){\r\n//      var img = th.getElementsByTagName('img')[0];\r\n//      return (img)? img.src : undefined; // patch.\r\n//    },\r\n    time_revised_check: function(nof_ths){return nof_ths>300;},\r\n    format_thread_layout : function(th){\r\n      site2.common.add_attribute_by_tagname(th,'img','style','margin:0px');\r\n      site2.common.add_attribute_by_tagname(th,'iframe','style','margin:0px');\r\n      site2.common.add_attribute_by_classname(th,'post','style','padding:0px');\r\n      site2.common.add_attribute_by_classname(th,'intro','style','margin:0px');\r\n      site2.common.add_attribute_by_classname(th,'body','style','margin:12px 5px');\r\n    },\r\n    format_thread_contents : function(th){\r\n      site2.common.remove_by_classname(th,'delete');\r\n//      site2.common.remove_by_tagname(th,'hr');\r\n//      site2.common.remove_by_tagname(th,'br');\r\n      site2.common.remove_by_classname(th,'omitted');\r\n    },\r\n    localtime: function(pn){\r\n      var times = pn.getElementsByTagName('time');\r\n      for (var i=0;i<times.length;i++) times[i].textContent = site2.common.change_utc_to_local(times[i].getAttribute('datetime'));\r\n    },\r\n    format_remove_tn_area_size: function(th){\r\n      var files = th.getElementsByClassName('file');\r\n      for (var i=0;i<files.length;i++){\r\n        var file_style = files[i].getAttribute('style');\r\n        if (file_style) {\r\n          file_style = ((file_style)? file_style + ';' : '') + 'float:left;';\r\n          if (file_style.indexOf('width')!=-1) file_style = file_style.replace(/width:[^;]*(;|$)/,'');\r\n          if (file_style.indexOf('height')!=-1) file_style = file_style.replace(/height:[^;]*(;|$)/,'');\r\n          files[i].setAttribute('style',file_style);\r\n        }\r\n      }\r\n    },\r\n//    get_time_of_post_in_utc : function(post){ // working code\r\n//      return Date.parse(post.getElementsByTagName('time')[0].getAttribute('datetime'));\r\n//    },\r\n    mark_newer_posts: function(th,date,unmark, short_cut) {\r\n//      return site2.common.mark_newer_posts('8chan',th.getElementsByClassName('post'),date,'border:2px solid red','border: none','class','post');\r\n      return site2['DEFAULT'].mark_newer_posts('8chan',th.getElementsByClassName('post'),date,null,unmark, short_cut);\r\n    },\r\n//    unmark_post_from_event: function() {\r\n//      this.setAttribute('style','border: none');\r\n//      this.removeEventListener('mouseover', site2['8chan'].unmark_post_from_event, false);\r\n//    },\r\n//    mark_newer_posts : function(th,date){\r\n//      var marked_first_post = null;\r\n////      var offset_top = 0;\r\n//      var times = th.getElementsByTagName('time');\r\n//      for (var i=times.length-1;i>=0;i--) {\r\n//        var mark = date<Date.parse(times[i].getAttribute('datetime'))-pref.localtime_offset*3600000;\r\n//        var reply = times[i].parentNode;\r\n//        while (reply.className.search(/post/)==-1) reply = reply.parentNode;\r\n//        if (mark) {\r\n//          reply.setAttribute('style','border: 2px solid red');\r\n//          marked_first_post = reply;\r\n////          offset_top = reply.offsetTop;\r\n//        } else reply.setAttribute('style','border: none');\r\n//      }\r\n////      return offset_top;\r\n//      return marked_first_post;\r\n//    },\r\n    get_owners_recommendation: function(){\r\n      var blotter = document.getElementsByClassName('blotter')[0];\r\n      if (blotter) {\r\n        or_str = document.getElementsByClassName('blotter')[0][brwsr.innerText];\r\n        var kwd = 'Recommendation: ';\r\n        var idx = or_str.indexOf(kwd);\r\n        if (idx!=-1) return or_str.substr(idx+kwd.length);\r\n      }\r\n      return '';\r\n    },\r\n////////    thread2headline : function(doc){\r\n////////      return site2.common.thread2headline(doc,'8chan');\r\n////////    },\r\n//    get_json_url_thread: function(board,thread){\r\n//      return site2['8chan'].protocol + '//8chan.co' + board +'res/' + thread + '.json';\r\n//    },\r\n    get_json_url_catalog: function(board){\r\n      return site2['8chan'].protocol + '//' + site2['8chan'].domain_url + board +'catalog.json';\r\n    },\r\n    thread2search_obj: function(th){\r\n      var coms  = aggregate_info(th.getElementsByClassName('body'));\r\n      var subs  = aggregate_info(th.getElementsByClassName('subject'));\r\n      var names = aggregate_info(th.getElementsByClassName('name'));\r\n\r\n      var files = th.getElementsByClassName('files');\r\n      var filenames = ['',''];\r\n      if (files.length!=0) {\r\n        for (var i=0;i<files.length;i++) {\r\n          var files_in_post = files[i].getElementsByClassName('unimportant');\r\n          filenames[i] = '';\r\n          for (var j=0;j<files_in_post.length;j++) {\r\n            if (files_in_post[j].getElementsByTagName('a').length!=0) filenames[i] = filenames[i] + files_in_post[j].getElementsByTagName('a')[0][brwsr.innerText] + '\\n';\r\n            if (files_in_post[j].getElementsByTagName('span').length!=0) filenames[i] = filenames[i] + files_in_post[j].getElementsByTagName('span')[0][brwsr.innerText] + '\\n';\r\n          }\r\n        }\r\n        for (var i=2;i<filenames.length;i++) filenames[1] = filenames[1] + filenames[i] + '\\n';\r\n        if (files[0].parentNode!=th) {\r\n          filenames[1] = filenames[0] + '\\n' + filenames[1];\r\n          filenames[0] = '';\r\n        }\r\n      }\r\n      return [coms[0], subs[0], names[0], filenames[0], coms[1], subs[1], names[1], filenames[1]];\r\n\r\n      function aggregate_info(pns){\r\n        if (pns.length!=0) {\r\n          var parent = pns[0].parentNode;\r\n          while (parent.classList.contains('post')) parent = parent.parentNode;\r\n          var op_idx = (!parent.classList.contains('op'))? 0 : -1;\r\n          var op = (op_idx>=0)? pns[0][brwsr.innerText] : '';\r\n          var posts = '';\r\n          for (var i=op_idx+1;i<pns.length;i++) posts = posts + pns[i][brwsr.innerText] + '\\n';\r\n          return [op, posts];\r\n        } return ['',''];\r\n      }\r\n    },\r\n    parse_json_thread: function(txt,from_http){\r\n      var obj = {posts: []};\r\n      var uids = {};\r\n      var nof_uids = 0;\r\n      var posts = document.getElementsByClassName('post');\r\n      for (var i=0;i<posts.length;i++) {\r\n        obj.posts[i] = {};\r\n        obj.posts[i].no = posts[i].id.replace(/op_/,'').replace(/reply_/,'');\r\n        var id = posts[i].getElementsByClassName('poster_id')[0].textContent;\r\n        obj.posts[i].id = id;\r\n        if (uids[id]===undefined) {\r\n          nof_uids++;\r\n          uids[id] = 1;\r\n        }\r\n        obj.posts[i].unique_ips = nof_uids;\r\n      }\r\n      return obj;\r\n    },\r\n    uip_check: function(callback){\r\n      callback(0,200,'');\r\n    },\r\n    uip_tgt_post : function(no){\r\n      var pn = document.getElementById('reply_'+no);\r\n      if (pn) return pn;\r\n      else return document.getElementById('op_'+no);\r\n    },\r\n    uip_post_num : function(tgt_post){\r\n      return tgt_post.getElementsByClassName('intro');\r\n    },\r\n//    catalog_native_prep0: function(threads,callback,pn_filter,pn_tb,func_sel){\r\n////      var node_ref = document.getElementsByClassName('catalog_search')[0].nextSibling;  // FF doesn't work.\r\n//      var node_ref = document.getElementsByClassName('threads')[0];\r\n//      node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n//      node_ref.parentNode.insertBefore(pn_filter,node_ref);\r\n//\r\n//      site2['8chan'].catalog_from_native(Date.now(),document,threads,null);\r\n//\r\n//      document.getElementById('sort_by').addEventListener('change',func_event,false);\r\n//      return function(){document.getElementById('sort_by').removeEventListener('change',func_event,false);};\r\n//      function func_event(){\r\n//        pref.catalog.indexing = document.getElementById('sort_by').selectedIndex;\r\n//        func_sel();\r\n//      }\r\n//\r\n////      var mixs = document.getElementsByClassName('mix');\r\n////      var date_load = Date.now();\r\n////      for (var i=0;i<mixs.length;i++) site2['8chan'].catalog_from_native_1(threads,mixs[i],date_load);\r\n////      for (var i=0;i<mixs.length;i++) {\r\n////        var url  = mixs[i].getElementsByTagName('a')[0].href;\r\n////        mixs[i].getElementsByTagName('a')[0].removeAttribute('href');\r\n////        var name = url.replace(/.*8chan\\.co/,'8chan').replace(/res\\//,'').replace(/\\.html/,'');\r\n////        var date = [0,0,0,0];\r\n////        var date_load = 0;\r\n////        var page_no = 0;\r\n////        threads[name] = [mixs[i], false, null,\r\n////                         [mixs[i].innerHTML, '8chan'],\r\n////                         mixs[i][brwsr.innerText], null, null, url, date, true,\r\n////                         null,\r\n////                         null, null, date_load, page_no, 0];\r\n////      }\r\n////      http_req.get('catalog',site.nickname+site.board,site.protocol+'//8chan.co'+site.board+'catalog.json',site2['8chan'].catalog_from_json,false,false,[threads,callback,null,site.board]);\r\n//    },\r\n    catalog_native_prep: function(date,pn_filter,pn_tb,pn_hi, embed_catalog){\r\n//      var node_ref = document.getElementsByClassName('catalog_search')[0].nextSibling;  // FF doesn't work.\r\n      var node_ref = (site.whereami==='catalog')? document.getElementsByClassName('threads')[0]\r\n                                                : document.getElementsByName('postcontrols')[0];\r\n      site2['DEFAULT'].catalog_native_prep_sel(pn_filter,pn_tb,site.whereami==='catalog'? document.getElementById('sort_by') : null);\r\n      if (site.whereami==='catalog') {\r\n        pn_tb.style.display='inline';\r\n        pn_tb.childNodes[3].style.display='inline';\r\n//        document.getElementById('image_size').addEventListener('change', site2['8chan'].catalog_native_size_changed, false);\r\n//        var pn_tb_new = document.createElement('span');\r\n//        while (pn_tb.firstChild) pn_tb_new.appendChild(pn_tb.firstChild);\r\n//        pn_tb = pn_tb_new;\r\n//        pn_tb.appendChild(pn_tb.removeChild(pn_tb.childNodes[3]).firstChild);\r\n      } else if (site.whereami==='page') {\r\n        var pctrls = document.getElementsByName('postcontrols')[0];\r\n        if (!pref.catalog_expand_with_hr || embed_catalog) {for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.removeChild(pctrls.childNodes[i]);}\r\n        else for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.childNodes[i].setAttribute('class',pref.script_prefix+'_hs');\r\n        pctrls.parentNode.insertBefore(document.createElement('hr'),pctrls.nextSibling);\r\n      }\r\n//      node_ref.parentNode.insertBefore(pn_hi,node_ref);\r\n      node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n//      node_ref.parentNode.insertBefore(pn_filter,node_ref);\r\n//      pn_tb.childNodes[0].setAttribute('style',pn_tb.childNodes[0].getAttribute('style')+';display:none');\r\n//      pn_tb.childNodes[1].setAttribute('style',pn_tb.childNodes[1].getAttribute('style')+';display:none');\r\n////////      return site2['8chan'].catalog_from_native(date,document,site.board,site.whereami+'_html');\r\n    },\r\n    catalog_native_size: (document.getElementById('image_size'))? document.getElementById('image_size').value : 'small',\r\n    catalog_native_size_changed: function(){site2['8chan'].catalog_native_size = this.value;},\r\n    catalog_get_native_area: function(){\r\n      if (site.whereami==='catalog') return document.getElementById('Grid');\r\n      return document.getElementsByName('postcontrols')[0];\r\n////      else { // working code.\r\n////        var pc = document.getElementsByName('postcontrols')[0];\r\n////        return pc.insertBefore(document.createElement('div'),pc.firstChild);\r\n////      }\r\n    },\r\n////////    catalog_from_native : function(date,doc,board,type) { // working code.\r\n////////      var ths;\r\n////////if (pref.test_mode['0']) {\r\n////////      ths = {domain:'8chan', board:board, pn:doc};\r\n////////      this.parse_funcs['catalog_html'].entry(ths,this.parse_funcs['catalog_html']['full_hier']);\r\n////////      return ths.ths;\r\n////////} else {\r\n////////////      var parse_obj = {domain:'8chan', board:board, parse_funcs:site2['8chan'].parse_funcs[type], __proto__:site4.parse_funcs_on_demand};\r\n////////////      ths = {pn:doc, __proto__:parse_obj};\r\n////////////      return ths.ths;\r\n////////      return site2[this.nickname].wrap_to_parse.get(doc, this.nickname, board, type);\r\n////////}\r\n////////    },\r\n//    catalog_from_native : function(date,doc,board) {\r\n//      var ths;\r\n//if (pref.test_mode['0']) {\r\n//      ths = {domain:'8chan', board:board, pn:doc};\r\n//      this.parse_funcs['catalog_html'].entry(ths,this.parse_funcs['catalog_html']['full_hier']);\r\n//} else {\r\n////      ths = {domain:'8chan', board:board, pn:doc, parse_funcs:this.parse_funcs['catalog_html'], __proto__:site4.parse_funcs_on_demand};\r\n//      var parse_obj = {domain:'8chan', board:board, parse_funcs:site2['8chan'].parse_funcs['catalog_html'], __proto__:site4.parse_funcs_on_demand};\r\n//      ths = {pn:doc, __proto__:parse_obj};\r\n//}\r\n//      return ths.ths;\r\n//    },\r\n//    catalog_from_native : function(date,doc,board) {\r\n//      var mixs = doc.getElementsByClassName('mix');\r\n//      var ths = [];\r\n////      for (var i=0;i<mixs.length;i++) {\r\n////        ths.push(site2['8chan'].catalog_from_native_1(mixs[i]));\r\n////        if (mixs[i].parentNode) mixs[i].parentNode.removeChild(mixs[i]);\r\n////      }\r\n////var time_in = Date.now();\r\n//      for (var i=0;i<mixs.length;i++) if (mixs[i].tagName==='DIV') ths.push(site2['8chan'].catalog_from_native_1(mixs[i],board));\r\n////console.log('aaa: '+(Date.now()-time_in));\r\n////      for (var i=0;i<ths.length;i++) if (ths[i].pn.parentNode) ths[i].pn.parentNode.removeChild(ths[i].pn);\r\n//      return ths;\r\n//    },\r\n//    catalog_from_native_1 : function(th,board) {\r\n//      th.getElementsByTagName('a')[0].removeAttribute('href');\r\n//      var sub = th.getElementsByClassName('subject');\r\n//      sub = (sub[0])? sub[0].textContent : '';\r\n//      var opn = th.getElementsByTagName('img')[0].getAttribute('data-name');\r\n//      var op = th[brwsr['innerText']].replace(th.getElementsByTagName('strong')[0][brwsr['innerText']],'');\r\n//      if (sub!=='') op = op.replace(sub,'');\r\n////      if (pref.catalog_footer_show_board_name) th.getElementsByTagName('strong')[0].innerHTML = '<span></span>' + th.getElementsByTagName('strong')[0].innerHTML + '&emsp;' + board;\r\n//      return {\r\n//        pn: th,\r\n//        exist: false,\r\n//        no: th.getElementsByTagName('img')[0].id.replace(/img\\-/,''),\r\n//        search_obj: [ op, sub, opn, '', '', '', '', ''],\r\n//        page_no: '?',\r\n//        time_bumped: (parseInt(th.getAttribute('data-bump'),10)-pref.localtime_offset*3600)*1000,\r\n//        time_created : (parseInt(th.getAttribute('data-time'),10)-pref.localtime_offset*3600)*1000,\r\n//        nof_posts: parseInt(th.getAttribute('data-reply'),10) +1,\r\n//        nof_files: parseInt(th.getElementsByClassName('replies')[0].getElementsByTagName('strong')[0].textContent.replace(/.*I: */,''),10),\r\n////        init_func: site2['8chan'].catalog_from_native_init_elem_func,\r\n//        update_func: site2['8chan'].catalog_from_native_update_elem_func,\r\n//        board: board,\r\n//        footer: th.getElementsByTagName('strong')[0], // temporal\r\n//        domain: '8chan', // temporal\r\n//        sticky: th.getAttribute('data-sticky')==='true', // temporal\r\n//      }\r\n//    },\r\n//    catalog_from_native_init_elem_func : function(th) {\r\n//      th.setAttribute('class','mix');\r\n//      th.setAttribute('style','display: inline-block;');\r\n//    },\r\n//    catalog_from_native_update_elem_func : function(th,src) {\r\n//      th.setAttribute('data-reply',src.nof_posts);\r\n//      th.setAttribute('data-bump',src.time_bumped);\r\n//      th.setAttribute('data-time',src.time_created);\r\n//    },\r\n//    catalog_from_native_1 : function(th,board) { // working code\r\n//      var th2 = {domain:'8chan', board:board, pn:th};\r\n//      this.parse_funcs['catalog_html'].entry(th2,this.parse_funcs['catalog_html']['full_th']);\r\n//      return th2;\r\n//    },\r\n    parse_funcs : { // vichan\r\n      'catalog_html' : {\r\n//        ths: function(doc) {\r\n//          var ths = this.ths_array(doc,doc.pn.getElementsByClassName('mix'));\r\n//          for (var i=0;i<ths.length;i++) ths[i].pn.getElementsByTagName('a')[0].removeAttribute('href');\r\n//          return ths;\r\n//        },\r\n        ths: function(doc) {return this.ths_array(doc,doc.pn.getElementsByClassName('mix'));},\r\n        no : function(th){return parseInt(th.pn.getElementsByTagName('img')[0].id.substr(4),10);},\r\n        time_bumped: function(th){return parseInt(th.pn.getAttribute('data-bump'),10)*1000;},\r\n        time_created : function(th){return parseInt(th.pn.getAttribute('data-time'),10)*1000;},\r\n        nof_posts: function(th){return parseInt(th.pn.getAttribute('data-reply'),10) +1;},\r\n//        nof_files: function(th){return parseInt(th.pn.getElementsByClassName('replies')[0].getElementsByTagName('strong')[0].textContent.replace(/.*I: */,''),10);},\r\n        nof_files: function(th){return parseInt(th.pn.getElementsByTagName('strong')[0].textContent.replace(/.*I: */,''),10) +1;}, // assumes OP has 1 pic.\r\n        key: function(th){\r\n//          if (!th.hasOwnProperty('no')) th['no'] = this['no'](th);\r\nif (pref.test_mode['0']) {\r\n          if (!th.hasOwnProperty('no')) Object.defineProperty(th,'no',{value:this['no'](th), enumerable:true, configurable:true, writable:true});\r\n}\r\n          return th.domain + th.board + th.no;\r\n        },\r\n        sub: 'DEFAULT.post_html',\r\n        name: function(th){return th.pn.getElementsByTagName('img')[0].getAttribute('data-name');},\r\n        com: function(th){\r\n          return th.pn.getElementsByClassName('replies')[0].innerHTML.replace(/\\s*<strong>[^<]*<\\/strong>\\s*(<br>)*/,'').replace(/\\s*$/,'');\r\n        },\r\n        type_com:'html',\r\n//        com: function(th){ // working code.\r\n//if (pref.test_mode['0']) {\r\n//          if (!th.hasOwnProperty('sub')) th.sub = this.sub(th);\r\n//}\r\n//          return th.pn[brwsr.innerText].replace(th.pn.getElementsByTagName('strong')[0][brwsr.innerText],'').replace(th.sub,'');\r\n//        },\r\n        footer: function(th){return th.pn.getElementsByTagName('strong')[0];},\r\n        sticky: function(th){return null;}, // patch\r\n//        format: function(th){th.pn.getElementsByTagName('a')[0].removeAttribute('href');return null;},\r\n        op_img_url: function(th){\r\n          var img = th.pn.getElementsByTagName('img')[0];\r\n          return (img)? img.getAttribute('src') : undefined; // patch.\r\n        },\r\n//        filename: function(th){return th.op_img_url;},\r\n//        missing_info: {time_posted: null, op_img_src_url: null},\r\n////        missing_info_fetch: function(th){scan.list_nup.add_board(th.domain+th.board,0,null,null,true);scan.scan('b',this.nickname)}, // BUG. catalog doesn't contain time_posted.\r\n//        missing_info_fetch: function(th){scan.list_nup.add(th.key,0);scan.scan('t',this.nickname)}, // BUG. catalog doesn't contain time_posted.\r\n        dynamic_image_hover: true,\r\n        missing_info: 2,\r\n        img2src: function(img){\r\n          var lth = this.get_lth_from_node(img);\r\n          if (!lth) return null;\r\n          var src = img.src;\r\n          if (lth.th && lth.th.ext) src = src.replace(/thumb/,'src').replace(/.[^\\.]*$/,lth.th.ext);\r\n          else if (lth.th.parse_funcs.missing_info) scan.scan_ui('image_hover', {tgts: [lth.domain+lth.board+'j0'], options:{callback:function(){cataLog.image_hover_reentry(img);}, priority:6}});\r\n          return src;\r\n        },\r\n        get_op_src: 'thread_json',\r\n      },\r\n      'catalog_json' : {\r\n        before_test : ['ths',':ITER',':ALL','ths',['key','time_bumped','nof_posts','nof_files']],\r\n        after_test  : ['time_created','pn','footer'],\r\n        full_hier   : ['ths',':ITER',':ALL','ths',['key','time_bumped','nof_posts','nof_files','pn','footer']],\r\n        ths: 'DEFAULT.catalog_json',\r\n        time_bumped: function(th){return th.last_modified*1000;},\r\n        time_created : function(th){return th.time*1000;},\r\n        nof_posts: function(th){return th.replies+1;},\r\n        nof_files: function(th){return th.images+th.omitted_images;},\r\n        key: function(th){return th.domain + th.board + th.no;},\r\n//        sub: function(th){return ('sub' in th)? th.sub : '';},\r\n//        name: function(th){return ('name' in th)? th.name : '';},\r\n//        com: function(th){return ('com' in th)? th.com : '';},\r\n//        sticky: function(th){return (th.sticky===1);}, // prevent memory leak.\r\n        sub: function(th){return (th.hasOwnProperty('sub'))? th.sub : '';},\r\n        name: function(th){return (th.hasOwnProperty('name'))? th.name : '';},\r\n        com: function(th){return (th.hasOwnProperty('com'))? th.com : '';},\r\n//        sticky: function(th){return (th.hasOwnProperty('sticky'))? th.sticky==='1' : false;},\r\n        op_img_url: 'DEFAULT.common',\r\n////        op_img_url: function(obj) { // working code.\r\n////          return site2[obj.domain].protocol + '//' + site2[obj.domain].domain_url + obj.board + 'thumb/' + obj.tim + ((obj.ext==='.jpg')? '.png' : obj.ext);\r\n//////          return this.protocol+ '//' + site2[obj.domain].domain_url + obj.board + 'thumb/' + obj.tim + ((obj.ext==='.jpg')? '.png' : obj.ext);\r\n////        },\r\n        missing_info: 1,\r\n//        missing_info: null,\r\n//        posts: 'DEFAULT.catalog_json', // DOESN'T WORK\r\n        get_op_src: 'thread_json',\r\n        time_unit: 1000,\r\n        type_com: 'html',\r\n        posts: 'DEFAULT.catalog_json',\r\n        posts_full: 'DEFAULT.catalog_json',\r\n        get_max_page: function(doc){return doc.length;},\r\n        proto: 'catalog_html',\r\n      },\r\n      'page_json' : {\r\n        has_posts: true,\r\n        nof_posts: 'DEFAULT.thread_json', // VICHAN HAS A INCONSISTENCY, thread_json doesn't provide 'replies'.\r\n        nof_files: function(th){return th.posts[0].images+th.posts[0].omitted_images;},\r\n        ths: 'DEFAULT.page_json',\r\n        proto:'thread_json'\r\n      },\r\n      'page_html' : {\r\n        before_test : ['ths',':ITER',':ALL','ths',['key','time_bumped','nof_posts','nof_files']],\r\n//        after_test  : [':ITER',':ALL','posts',['sub','name','com'],'flags'],\r\n        after_test  : ['time_created',':ITER',':ALL','posts',['sub','name','com','flag'],':ITER',':GALL','posts',['flags','flag']],\r\n        before_test_post : ['posts',':ITER',':FL','posts',['time'],'html_org','footer'],\r\n//        ths: function(doc) {\r\n//          var ths = doc.pn.querySelectorAll('div[id^=thread_]');\r\n//          if (ths.length===0) ths = doc.pn.querySelectorAll('div[de-thread]'); // for dollchan archive // doesn't work because of other modification.\r\n//          return this.ths_array(doc,ths);\r\n//        },\r\n        ths: function(doc) {return this.ths_array(doc,doc.pn.querySelectorAll('div[id^=thread_]'));},\r\n        th_init: function(th){\r\n          if (site.whereami!=='page' || !pref.catalog.embed_page) th.pn.removeAttribute('class');\r\n//          var as = th.pn.querySelectot_inheritrAll('.files a');\r\n//          for (var j=0;j<as.length;j++) as[j].removeAttribute('href');\r\n////          for (var j=0;j<as.length;j++) as[j].addEventListener('click',th.parse_funcs.preventDefault,false); // not debugged.\r\n        },\r\n//        th_destroy: function(pn, parse_funcs){\r\n////          var as = pn.querySelectorAll('.files a');\r\n////          for (var j=0;j<as.length;j++) as[j].removeEventListener('click',parse_funcs.preventDefault,false); // not debugged.\r\n//        },\r\n//        ths: function(doc) {\r\n//          var ths = this.ths_array(doc,doc.pn.querySelectorAll('div[id^=thread_]'));\r\n//          if (site.whereami!=='page' || !pref.catalog.embed_page) for (var i=0;i<ths.length;i++) ths[i].pn.removeAttribute('class');\r\n//          for (var i=0;i<ths.length;i++) {\r\n//            var as = ths[i].pn.querySelectorAll('.files a');\r\n//            for (var j=0;j<as.length;j++) as[j].removeAttribute('href');\r\n//          }\r\n//          return ths;\r\n//        },\r\n        no: 'post_html',\r\n//        no : function(th){return parseInt(th.pn.id.substring(th.pn.id.indexOf('_')+1),10);},\r\n////        post_no: 'page_html.no',\r\n        time: function(post){\r\n          var pn_time = post.pn.getElementsByTagName('time')[0]; // old threads doesn't have this.\r\n          return (pn_time)? Date.parse(pn_time.getAttribute('datetime'))/1000 : undefined;\r\n        },\r\n        time_unit:1000, // must be the same as json\r\n////////        time_posted: function(th){\r\n////////if (pref.test_mode['0']) {\r\n////////          if (!th.hasOwnProperty('posts')) this.entry(th,this.before_test_post);\r\n////////}\r\n////////          return th.posts[th.posts.length-1].time;\r\n////////        },\r\n        time_bumped: function(th){ // TO BE FIXED.\r\n////if (pref.test_mode['0']) {\r\n////          if (!th.hasOwnProperty('posts')) this.entry(th,this.before_test_post);\r\n////}\r\n////          return th.posts[th.posts.length-1].time;\r\n          var i=th.posts.length;\r\n          while (--i>=0) {\r\n            var mail = th.posts[i].pn.getElementsByClassName('email')[0];\r\n            if (!mail || mail.href!=='mailto:sage') return th.posts[i].time;\r\n          }\r\n          return undefined;\r\n        },\r\n        time_created : function(th){\r\nif (pref.test_mode['0']) {\r\n          if (!th.hasOwnProperty('posts')) this.entry(th,this.before_test_post);\r\n}\r\n          return th.posts[0].time;\r\n        },\r\n        nof_posts: function(th){\r\n          var nof_posts = th.pn.getElementsByClassName('post').length;\r\n          var nof_files = th.pn.getElementsByClassName('fileinfo').length;\r\n          var om_info   = th.pn.getElementsByClassName('omitted')[0];\r\n          if (om_info) {\r\n            var str = om_info.childNodes[0].textContent.replace(/\\n/g,'');\r\n            nof_posts += parseInt(str.replace(/\\ post.*/,''),10) || 0;\r\n            nof_files += parseInt('0'+str.replace(/\\ image.*/,'').replace(/[^\\ ]*\\ /g,''),10) || 0;\r\n          }\r\n//          th.nof_files = nof_files;\r\n          Object.defineProperty(th,'nof_files',{value:nof_files, enumerable:true, configurable:true, writable:true});\r\n          return nof_posts;\r\n        },\r\n        nof_files: function(th){\r\n          if (!th.hasOwnProperty('nof_posts')) this['nof_posts'](th);\r\n          return th.nof_files;\r\n        },\r\n        key: function(th){\r\n//          if (!th.hasOwnProperty(('no')) th.no = this.no(th);\r\nif (pref.test_mode['0']) {\r\n          if (!th.hasOwnProperty('no')) Object.defineProperty(th,'no',{value:this['no'](th), enumerable:true, configurable:true, writable:true});\r\n}\r\n          return th.domain + th.board + th.no;\r\n        },\r\n        sub: 'DEFAULT.post_html',\r\n        com:  function(post){\r\n          var com = post.pn.getElementsByClassName('body')[0];\r\n//          return (com)? com[brwsr.innerText] : '';\r\n          return (com)? com.innerHTML : '';\r\n        },\r\n        type_com:'html',\r\n        footer: function(th){return this.insert_footer4(th.pn.getElementsByClassName('post op')[0]);},\r\n//        footer: function(th){\r\n//          var footer = document.createElement('div');\r\n//          footer = th.pn.insertBefore(footer,th.pn.getElementsByClassName('post op')[0]);\r\n//          return footer;\r\n//        },\r\n        sticky: function(th){return (th.pn.getElementsByClassName('fa-thumb-tack').length!=0);},\r\n        flag: 'post_html',\r\n////        flag: function(post){return post.pn.getElementsByClassName('flag')[0];},\r\n//        flag: function(post){\r\n//          var flags = post.pn.getElementsByClassName('flag');\r\n//          return (flags.length!=0)? document.importNode(flags[0],false) : null;\r\n//        },\r\n//        flags: function(th){\r\n//          var flags = th.pn.getElementsByClassName('flag');\r\n//          var pn_flags = [];\r\n//          for (var i=0;i<flags.length;i++) pn_flags.push(flags[i].cloneNode(false));\r\n//          return pn_flags;\r\n//        },\r\n//        flags: function(th){ // for on demand access.\r\n//          var flags = [];\r\n//          var i = th.posts.length - pref.catalog_t2h_num_of_posts;\r\n//          if (i<1) i=1;\r\n//          if (th.posts.length!=0) flags[0] = th.posts[0].flag;\r\n//          while (i<th.posts.length) {\r\n//            if (th.posts[i]) flags[i] = th.posts[i].flag;\r\n//            i++;\r\n//          }\r\n//          return flags;\r\n//        },\r\n        op_img_url: function(th){\r\n          var img = th.pn.getElementsByTagName('img');\r\n          if (img.length>=2) {\r\n            th.op_img_url2 = [];\r\n            for (var i=1;i<img.length;i++) {\r\n              var url2 = img[i].getAttribute('src');\r\n              if (url2) th.op_img_url2[th.op_img_url2.length] = url2;\r\n            }\r\n          }\r\n          return (img && img[0])? img[0].getAttribute('src') : undefined; // patch.\r\n        },\r\n        tn_as: function(th){return th.tn_imgs;},\r\n//        tn_imgs: function(th){\r\n//          var imgs = [];\r\n//          var files = th.pn.getElementsByClassName('file');\r\n//          for (var i=0;i<files.length;i++) imgs[i] = files[i].getElementsByTagName('img')[0];\r\n//          return imgs;\r\n//        },\r\n        tn_imgs: function (th){ // post can be accepted.\r\n          var imgs = [];\r\n          var files = ((th.pn.classList.contains('op'))? th.pn.parentNode : th.pn).getElementsByClassName('files')[0];\r\n          if (files) {\r\n            files = files.getElementsByClassName('file');\r\n            for (var i=0;i<files.length;i++) {\r\n              var tmp = files[i].getElementsByTagName('img')[0] || files[i].getElementsByTagName('video')[0];\r\n//              var tmp = files[i].getElementsByTagName('img')[0];\r\n              if (tmp) imgs[imgs.length] = tmp;\r\n            }\r\n          }\r\n          return imgs;\r\n        },\r\n        get_thread_links : function(th){\r\n          var links = [];\r\n          var as = th.pn.getElementsByClassName('post op')[0].getElementsByTagName('a');\r\n          for (var i=0;i<as.length;i++) {\r\n            if (as[i].textContent==='[Reply]') links.unshift(as[i]);\r\n            if (as[i].textContent==='[Last 50 Posts]') links.push(as[i]);\r\n            if (as[i].classList.contains(pref.script_prefix+'_link')) links.push(as[i]);\r\n          }\r\n          return links;\r\n        },\r\n        get_omitted_info : function(post){return post.pn.getElementsByClassName('omitted')[0];},\r\n        set_omitted_info : function(post, info){post.pn.lastChild.appendChild(info);},\r\n//        replace_omitted_info : function(dst, src){dst.childNodes[0].textContent = src.childNodes[0].textContent;},\r\n        replace_omitted_info2 : function(dst, src){dst.childNodes[0].textContent = (src)? src.childNodes[0].textContent : '';},\r\n        filename: 'thread_html',\r\n        get_op_src: 'thread_json',\r\n        id: 'DEFAULT.thread_html',\r\n        country: 'DEFAULT.thread_html',\r\n        trip: 'DEFAULT.thread_html',\r\n        flag: 'DEFAULT.thread_html',\r\n        name: 'DEFAULT.thread_html',\r\n        pn_name: 'post_html',\r\n      },\r\n      'thread_html' : {\r\n        after_test  : ['time_created',':ITER',':FLx','posts',['sub','name','com','flag'],':ITER',':GFLx','posts',['flags','flag']],\r\n//        'finisher' : function(th){site2['8chan'].remove_posts(th.pn,pref.catalog_t2h_num_of_posts);},\r\n////        pop_post: function(th){ // working code.\r\n////          while (th.idx_pop>=0) {\r\n////            var pn = th.children[th.idx_pop--];\r\n////            if (pn.className && pn.className.indexOf('post')!=-1 && pn.className.indexOf('reply')!=-1) {\r\n////              th.post = {pn:pn, parse_funcs:this, __proto__:th.__proto__};\r\n////              return true;\r\n////            }\r\n////          }\r\n////          return false;\r\n////        },\r\n        get_op_src: 'thread_json',\r\n        filename: function(th){\r\n          var files = ((th.pn.classList.contains('op'))? th.pn.parentNode : th.pn).getElementsByClassName('files')[0];\r\n          if (files) {\r\n            files = files.querySelectorAll(':scope>.file');\r\n            for (var i=0;i<files.length;i++) {\r\n              var fname = files[i].getElementsByTagName('a')[0];\r\n              if (!fname) continue; // file may be deleted.\r\n              fname = fname.textContent;\r\n              if (i===1) th.extra_files = [];\r\n              if (i>=1) th.extra_files[i-1] = {domain:th.domain, board:th.board};\r\n              var tgt = (i===0)? th : th.extra_files[i-1];\r\n              tgt.filename = (th.domain==='lain')? files[i].getElementsByTagName('a')[1].getAttribute('download') // lainchan 2017.04.25- \r\n                                                 : files[i].getElementsByClassName('postfilename')[0].textContent.replace(/\\..*/,'');\r\n              tgt.ext = fname.substr(  fname.indexOf('.'));\r\n              tgt.tim = fname.substr(0,fname.indexOf('.'));\r\n              var info = (th.domain!=='lainjp')? files[i].getElementsByClassName('details')[0].textContent.split(',')\r\n                                               : files[i].getElementsByClassName('unimportant')[0].textContent.split(',');\r\n              tgt.w = parseInt(info[1].substr(0,info[1].indexOf('x')  ),10);\r\n              tgt.h = parseInt(info[1].substr(  info[1].indexOf('x')+1),10);\r\n              var fsize = info[0].split(/\\s/);\r\n              fsize[1] = (fsize[1]==='KB')? 1024 : (fsize[1]==='MB')? 1024*1024 : 1;\r\n              tgt.fsize = parseFloat(fsize[0].replace(/\\(/,'')) * fsize[1];\r\n              var tn = files[i].querySelector('img.post-image');\r\n              if (tn) {\r\n                tgt.tn_w = parseInt(tn.style.width,10);\r\n                tgt.tn_h = parseInt(tn.style.height,10);\r\n              }\r\n            }\r\n          }\r\n          return (files)? th.filename : undefined;\r\n        },\r\n        proto: 'page_html',\r\n      },\r\n      'thread_json' : {\r\n        nof_posts: function(obj){return obj.posts.length;},\r\n        nof_files: function(obj){\r\n          var count=0;\r\n          for (var i=1;i<obj.posts.length;i++) {\r\n            if (obj.posts[i].filename) count++;\r\n            if (obj.posts[i].extra_files) count += obj.posts[i].extra_files.length;\r\n          }\r\n          return count;\r\n        },\r\n        add_op_img_url: site2['DEFAULT'].parse_parts.add_op_img_url,\r\n//        get_op_src: function(th){return th.op_img_url.replace('thumb','src').replace('.png',th.ext);},\r\n        get_op_src: function(th, img){\r\n          if (!th.ext && th.parse_funcs.missing_info) scan.scan_ui('image_hover', {tgts: [th.domain+th.board+'j0'], options:{callback:function(){cataLog.image_hover_reentry(img);}, priority:6}});\r\n          return (th.ext)? th.op_img_url.replace('thumb','src').replace('.png',th.ext) : img.src;\r\n        },\r\n        pn_name: 'post_html',\r\n        proto: 'DEFAULT.thread_json',\r\n      },\r\n      'post_html': {\r\n        no: function(th){\r\n          var id = th.pn.getAttribute('id');\r\n          return parseInt(id.substring(id.indexOf('_')+1),10);},\r\n        name: function(post){return (post.pn_name)? post.pn_name.textContent : '';},\r\n        pn_name: function(post){return post.pn.getElementsByClassName('name')[0];},\r\n        time_pn: function(post_pn){return Date.parse(post_pn.getElementsByTagName('time')[0].getAttribute('datetime'));},\r\n//        txt2com: function(txt){\r\n//          txt = txt.replace(/(^>[^>].*$)/mg,'<span class=\"quote\">$1</span>');\r\n//          txt = txt.replace(/\\*\\*([^(\\*\\*)]*)((\\*\\*)|$)/g,'<span class=\"spoiler\">$1</span>');\r\n//          return txt.replace(/\\n/g,'<br>');},\r\n        txt2com_spoiler_replace_txt: '<span class=\"spoiler\">$1</span>',\r\n        flag: function(post){return post.pn.getElementsByClassName('flag')[0];},\r\n        pn_id: function(post){return post.pn.getElementsByClassName('poster_id')[0];},\r\n        id: function(post){return (post.pn_id)? post.pn_id.textContent : undefined;},\r\n        time: 'page_html',\r\n        proto: 'DEFAULT.post_html',\r\n      },\r\n      'post_json': {\r\n        proto: 'DEFAULT.post_json'\r\n      },\r\n    },\r\n    update_posts_remove: function(th_old,i,pnode,merge){\r\n      var tgt = th_old.posts[i].pn;\r\n      if (!merge || tgt.parentNode!==pnode) tgt = tgt.parentNode;\r\n      else this.update_posts_insert_pack(tgt);\r\n      pnode.removeChild(tgt.nextSibling);\r\n      pnode.removeChild(tgt);\r\n    },\r\n    update_posts_insert: function(src,dst,i,j,pnode){\r\n////      var ref = (j==1)? (dst[0].pn.getElementsByClassName('op')[0].nextSibling || null) :\r\n//      var ref = (i==1)? (dst[0].pn.nextSibling || null) :\r\n//                        (dst[dst.length-1].pn.parentNode.nextSibling || null);\r\n//      var ref = (j==0)? (dst[0].pn || null) :\r\n//                (j==1)? (dst[0].pn.nextSibling || null) :\r\n//                (j<dst.length)? (dst[j].pn.parentNode.nextSibling || null) :\r\n//                (dst[dst.length-1].pn.parentNode.nextSibling &&\r\n//                 dst[dst.length-1].pn.parentNode.nextSibling.nextSibling || null);\r\n      var ref = (j<dst.length)? dst[j].pn : null;\r\n//      var ref = dst[(j<dst.length)? j : dst.length-1];\r\n//      ref = (ref)? ref.pn : null;\r\n      var ref_pnode = ref && ref.parentNode;\r\n      if (ref_pnode && ref_pnode!==pnode) ref = ref_pnode; // remove container\r\n//      if (j>=1 && (!merge || ref.parentNode!==pnode)) ref = ref.parentNode; // remove container\r\n      if (j>=dst.length) ref = pnode.getElementsByClassName('clear')[0]; // for universal merge with lazy draw, dst[dst.length-1].pn may remain in old pnode.\r\n//      if (j>=dst.length) ref = ref && ref.nextSibling && ref.nextSibling.nextSibling || null;\r\n      if (!src[i].pn) src[i].pn = this.post_json2html(src[i],src[i].board);\r\n//      pnode.insertBefore(this.post_container(src[i].pn,src[i].no), ref); // working code.\r\n//      pnode.insertBefore(document.createElement('br'),ref);\r\n//      if (ref && ref.parentNode!==pnode) ref = ref.parentNode; // patch for thread merging.\r\n      if (i===0) this.update_posts_insert_pack(src[i].pn);\r\n      if (j===0 && dst[0]) this.update_posts_insert_pack(dst[0].pn);\r\n//      if (j===0 && ref) this.update_posts_insert_pack(dst[0].pn); // BUG???\r\n      var tgt = (j===0 && i===0)? src[i].pn : this.post_container(src[i].pn,src[i].no); // patch for thread merging.\r\n      pnode.insertBefore(tgt, ref);\r\n      pnode.insertBefore(document.createElement('br'),ref);\r\n      if (i===0 && j===0) this.update_posts_insert_unpack(src[i].pn);\r\n//      if (j===0) {\r\n//        ref = dst[0].pn.nextSibling;\r\n//        pnode.insertBefore(this.post_container(dst[0].pn,dst[0].no), ref);\r\n//      }\r\n    },\r\n    update_posts0_class: function(pn,search_result) {\r\n      site2['DEFAULT'].update_posts0_class(pn,search_result);\r\n      this.update_posts_insert_pack_iter(pn, (search_result)? function(prev){prev.classList.remove('CatChan_search_miss');} : \r\n                                                              function(prev){prev.classList.add('CatChan_search_miss');});\r\n    },\r\n    update_posts_insert_pack: function(pn){\r\n      this.update_posts_insert_pack_iter(pn, function(prev){pn.insertBefore(prev, pn.firstChild);});\r\n    },\r\n    update_posts_insert_pack_iter: function(pn, func){\r\n      var prev = pn.previousSibling;\r\n      while (prev) {\r\n        var prev_prev = prev.previousSibling; // prev is livelist.\r\n        if (prev.classList && (prev.classList.contains(pref.script_prefix+'_footer') || prev.classList.contains('files'))) func(prev);\r\n        if (prev.classList &&  prev.classList.contains('op')) break;\r\n        prev = prev_prev;\r\n      }\r\n    },\r\n    update_posts_insert_unpack: function(pn){\r\n      while (1) {\r\n        var fchild = pn.firstChild;\r\n        if (fchild && fchild.classList && (fchild.classList.contains(pref.script_prefix+'_footer') || fchild.classList.contains('files'))) pn.parentNode.insertBefore(fchild, pn);\r\n        else break;\r\n      }\r\n    },\r\n    add_backlinks_bks: (function(){\r\n      var bks = document.createElement('span');\r\n      bks.setAttribute('class','mentioned unimportant');\r\n      return function(){\r\n        return bks.cloneNode(false);\r\n      };\r\n    })(),\r\n    add_backlinks_add_1: (function(){\r\n      var blk = document.createElement('a');\r\n      blk.setAttribute('class','mentioned'); // mentioned-XXXX in lainchan.\r\n      return function(bks, dbtpth){\r\n        var pn = blk.cloneNode(true);\r\n        pn.setAttribute('href',dbtpth[5]);\r\n        pn.textContent = dbtpth[4];\r\n        pn.onclick = this.backlink_onclick;\r\n//        pn.onmouseover = this.popups_post_entry;\r\n        bks.appendChild(pn);\r\n      };\r\n    })(),\r\n    add_backlinks_bks_query: function(pn){\r\n      return pn.getElementsByClassName('mentioned')[0];\r\n    },\r\n////    add_backlinks: function(pn,backlinks,target,th){\r\n////      var bks_pn = pn.getElementsByClassName('mentioned')[0];\r\n////      var bks = bks_pn || this.add_backlinks_bks();\r\n////      if (!target) bks.innerHTML = '';\r\n////      for (var i=(target || 0);i<backlinks.length;i++) {\r\n////        var dbtp = this.popups_backlink2dbtpth(backlinks[i], th);\r\n////        var domain = dbtp[0];\r\n//////        var board = dbtp[1];\r\n//////        var post_no = dbtp[3];\r\n////        var href = site2[domain].link_dbtp2href(dbtp);\r\n////        if (domain!==site.nickname) href = site2[domain].absolute_link_1(href);\r\n//////        var blk = null; // IS THIS REQUITED???\r\n//////        if (target!==undefined)\r\n//////          for (var j=0;j<bks.childNodes.length;j++)\r\n//////            if (bks.childNodes[j].textContent==='>>'+post_no) {\r\n//////              blk = bks.childNodes[j];\r\n//////              break;\r\n//////            }\r\n//////        if (!blk)\r\n////        this.add_backlinks_add_1(bks, dbtp, href);\r\n////        if (target) break;\r\n////      }\r\n////      if (!bks_pn) {\r\n////        var ref = pn.getElementsByClassName('post_no')[1];\r\n////        var pnode = ref.parentNode;\r\n////        do {ref = ref.nextSibling;} while (ref && ref.tagName==='I');\r\n////        pnode.insertBefore(bks,ref);\r\n////      }\r\n////    },\r\n    add_backlinks_bks_append: function(pn, bks){\r\n      var ref = pn.getElementsByClassName('post_no')[1];\r\n      var pnode = ref.parentNode;\r\n      do {ref = ref.nextSibling;} while (ref && ref.tagName==='I');\r\n      pnode.insertBefore(bks,ref);\r\n    },\r\n    popups_href2dbtp: function(href){ //, src, th){\r\n//      if (href[0]==='#') {\r\n//        href = th.board+'res/'+th.no+'.html'+href;\r\n//        src.setAttribute('href',href);\r\n//      }\r\n      var hrefs = href.split('/');\r\n      var p = hrefs[hrefs.length-1].substr(hrefs[hrefs.length-1].indexOf('#')+1);\r\n      var t = hrefs[hrefs.length-1].substr(0,hrefs[hrefs.length-1].indexOf('.')) || href[0]==='#' && site.no;\r\n      var b = (hrefs.length>=3)? '/'+hrefs[hrefs.length-3]+'/' : site.board;\r\n      var d = this.nickname;\r\n      return [d,b,t,p];\r\n    },\r\n    link_dbtp2href: function(dbtp){\r\n      return dbtp[1] + 'res/' + dbtp[2] + '.html#' + dbtp[3];\r\n    },\r\n    backlink_onclick: function(){\r\n      highlightReply.call(this,parseInt(this.textContent.substr(2),10));\r\n    },\r\n//    backlink_class: 'mentioned',\r\n    colorID: function(pn) {\r\n      var id = pn.getElementsByClassName('poster_id')[0];\r\n      if (id) {\r\n        var bg = id.textContent;\r\n        var bg_r = parseInt(bg.substr(0,2),16);\r\n        var bg_g = parseInt(bg.substr(2,2),16);\r\n        var bg_b = parseInt(bg.substr(4,2),16);\r\n        var fg = (bg_r + bg_g + bg_b>384)? 0 : 255;\r\n        id.setAttribute('style','padding: 0px 5px; border-radius: 8px; color: rgb('+fg+','+fg+','+fg+'); background-color: rgb('+bg_r+','+bg_g+','+bg_b+');');\r\n      }\r\n    },\r\n//    localtime: function(pn) {\r\n//      var pn_time = pn.getElementsByTagName('time');\r\n//      for (var i=0;i<pn_time.length;i++)\r\n//        pn_time[i].textContent = site2.common.change_utc_to_local(pn_time[i].getAttribute('datetime'));\r\n//    },\r\n//    post_com2txt: function(com){\r\n//      return com.replace(/<[^>]*>/g,' ').replace(/&gt;/g,'>').replace(/&lt;/g,'<').replace(/&amp;/g,'&').replace(/&hellip;/g,'\\u2026'); // most of lainchan, speed: 10.62/2.02\r\n//    },\r\n    post_container : function(post_pn,no) {\r\n      var pn = document.createElement('div');\r\n      pn.setAttribute('id','pc'+no);\r\n      pn.setAttribute('class','postcontainer');\r\n      pn.innerHTML = '<div class=\"sidearrows\">&gt;&gt;</div>';\r\n      pn.appendChild(post_pn);\r\n      return pn;\r\n    },\r\n    short_link: function(name, nof_posts, num, kwd_head, kwd_tail){\r\n      var dbt = common_func.fullname2dbt(name);\r\n      return (nof_posts>100)? '<a href=\"' +dbt[1]+ 'res/' +dbt[2]+ '+50.html\" class=\"' + pref.script_prefix + '_link' + '\">'+kwd_head+'50'+kwd_tail+'</a>' : '';\r\n    },\r\n    post_json2html : function(post, board, op, short_link) {\r\n      var pn = document.createElement('div');\r\n      var time_unit = (post.parse_funcs && post.parse_funcs.time_unit) || 1;\r\n      var date = new Date((post.time || 0) * time_unit);\r\n      var html_str =\r\n        '<div class=\"post ' +((op)? 'op':'reply')+ '\" id=\"reply_'+post.no+'\" style=\"border: none\">'+\r\n//        '<div class=\"post reply\" id=\"reply_'+post.no+'\" style=\"border: none\">'+\r\n          '<p class=\"intro\">'+\r\n            '<input type=\"checkbox\" class=\"delete\" name=\"delete_'+post.no+'\" id=\"delete_'+post.no+'\">'+\r\n            '<label for=\"delete_'+post.no+'\">'+\r\n              ((post.sub)? '<span class=\"subject\">'+post.sub+ ' </span>' : '')+\r\n              ((post.email)? '<a class=\"email\" href=\"mailto:' + post.email + '\">' : '') +\r\n                '<span class=\"name\">'+(post.name || '')+'</span>'+\r\n                ((post.trip)? '<span class=\"trip\">' + post.trip + '</span>' : '') +\r\n              ((post.capcode)? '<span class=\"capcode\" style=\"color:orange;font-weight:bold\">## ' + post.capcode + '</span>' : '') +\r\n              ((post.email)? '</a> ' : ' ') +\r\n              ((post.country)? '<img class=\"flag flag-' + post.country.toLowerCase() + '\" src=\"/static/blank.gif\" style=\"width:16px;height:11px;\" alt=\"' + post.country_name + '\" title=\"' + post.country_name +'\"> ' : ' ')+\r\n              '<time datetime=\"'+ date.toISOString() + '\">' + date.toLocaleString()+'</time>'+\r\n            '</label>'+\r\n            ((post.id)? '<span class=\"poster_id\">'+post.id+'</span>' : '')+\r\n            '&nbsp;'+\r\n            '<a class=\"post_no\" id=\"post_no_'+post.no+'\">No.</a>'+\r\n//            '<a class=\"post_no\" onclick=\"citeReply(12486)\" href=\"/tech/res/12393.html#q12486\">12486</a>'+\r\n            '<a class=\"post_no\">'+post.no+'</a>'+\r\n            ((op)? ('<a href=\"' + site2[post.domain].make_url4([post.domain, board, post.no, 'thread_html'])[0] +'\">[Reply]</a>'+\r\n//            ((op)? ('<a href=\"' +board+ 'res/' +post.no+ '.html\">[Reply]</a>'+\r\n                   ((short_link)? short_link : '')) : '') +\r\n//////////            '<span class=\"mentioned unimportant\"><a class=\"mentioned-12497\" onclick=\"highlightReply('12497');\" href=\"#12497\">&gt;&gt;12497</a></span>'+\r\n          '</p>';\r\n      if (post.filename) {\r\n        html_str += '<div class=\"files\">' +\r\n                    this.post_json2html_file(post,board, post.extra_files);\r\n        if (post.extra_files) for (var i=0;i<post.extra_files.length;i++) html_str += this.post_json2html_file(post.extra_files[i],board, true);\r\n        html_str += '</div>';\r\n      }\r\n      html_str +=\r\n          '<div class=\"body\">'+ ((post.com)? post.com : '') +\r\n//////////            '<a onclick=\"highlightReply('12446');\" href=\"/tech/res/12393.html#12446\">&gt;&gt;12446</a><br>'+\r\n//////////            '<a onclick=\"highlightReply('12403');\" href=\"/tech/res/12393.html#12403\">&gt;&gt;12403</a><br>'+\r\n//////////            '<span class=\"quote\"><br>&gt;people saying nice things about openstack</span><br><br>Thanks, lainons. I work on developing openstack and people seem to love complaining about it, so it's heartening to hear somewhat happy people.'+\r\n          '</div>'+\r\n        '</div>';\r\n      pn.innerHTML = html_str;\r\n      return pn.childNodes[0];\r\n    },\r\n    post_pn2ce: function(pn){\r\n      return (pn.lastChild.className==='body')? pn.lastChild : pn.getElementsByClassName('body')[0];\r\n    },\r\n    post_json2html_file : function(post, board, multifile) {\r\n      var fsize_str = (((post.fsize>1048576)? post.fsize/1048576 : post.fsize/1024)+0.005).toString();\r\n      fsize_str = fsize_str.substr(0,fsize_str.indexOf('.')+3) + ((post.fsize>1048576)? ' MB' : ' KB');\r\n      var fname_server = site2[post.domain].post_json2html_fname_server(post);\r\n      var fname = site2[post.domain].post_json2html_fname(post);\r\n      var furl = site2[post.domain].catalog_json2html3_src(post,board);\r\n      var turl = site2[post.domain].catalog_json2html3_thumbnail(post,board);\r\n      var html_str = \r\n              '<div class=\"file' + ((multifile)?' multifile':'')+'\"' +((multifile)?' style=\"width:'+(post.tn_w+40)+'px\"':'') +'>'+\r\n                '<p class=\"fileinfo\">File: '+\r\n                  '<a href=\"'+furl+'\">'+fname_server+'</a> '+\r\n                  '<span class=\"details\">('+fsize_str+', '+post.w+'x'+post.h+', '+\r\n                    '<span class=\"postfilename\">'+fname+'</span>) '+\r\n////////                  '<span class=\"unimportant image_id\">'+\r\n//////////                    '<a href=\"http://imgops.com/https://lainchan.org/tech/src/1445201930315.jpg\" target=\"_blank\">ImgOps</a>'+\r\n//////////                    '<a href=\"http://regex.info/exif.cgi?url=https://lainchan.org/tech/src/1445201930315.jpg\" target=\"_blank\">Exif</a>'+\r\n//////////                    '<a href=\"http://iqdb.org/?url=https://lainchan.org/tech/src/1445201930315.jpg\" target=\"_blank\">iqdb</a>'+\r\n////////                  '</span>'+\r\n                  '</span>'+\r\n                '</p>'+\r\n                '<a href=\"'+furl+'\" target=\"_blank\">'+\r\n                  ((post.ext!=='.webm')? '<img class=\"post-image\" src=\"'+turl+'\" style=\"width: '+post.tn_w+'px; height: '+post.tn_h+'px; max-width: 98%;\" alt=\"\"'+\r\n                                         ((post.tn_w===128 && post.tn_h===128)? 'onerror=\"this.onerror=null;this.src=\\'/static/spoiler.png\\';\"' : '')+ '>' : // vichan doesn't have any information about spoilered.\r\n                                         '<video class=\"post-image\" src=\"'+furl+'\" style=\"width: '+post.tn_w+'px; height: '+post.tn_h+'px; max-width: 98%;\">')+\r\n                '</a>'+\r\n              '</div>';\r\n      return html_str;\r\n    },\r\n    page_json2html3_skelton: function(obj, both){\r\n      var th = document.createElement('div');\r\n      th.setAttribute('class','thread');\r\n      th.setAttribute('id','thread_'+obj.no);\r\n      th.setAttribute('data-board',obj.board.slice(1,-1));\r\n//      th.setAttribute('style','float: left; overflow: hidden;');\r\n      var br = document.createElement('br');\r\n      br.setAttribute('class','clear');\r\n      th.appendChild(br);\r\n      th.appendChild(document.createElement('hr'));\r\n      return (both)? [th,br] : th;\r\n    },\r\n    page_json2html3 : function(obj,board,thumb_url, assign_pn, clone) { // TEMPORAL, USE thumb_url TO MIMIC.\r\n      var doms = this.page_json2html3_skelton(obj,true);\r\n      var th = doms[0];\r\n      var ref = doms[1];\r\n      var op = this.post_json2html((obj.posts && obj.posts[0])? obj.posts[0] : obj, obj.board, true, site2[obj.domain].short_link(obj.key, obj.nof_posts, 2, '[Last ',' Posts]'));\r\n      var files = op.getElementsByClassName('files')[0];\r\n      if (files) th.insertBefore(files, ref);\r\n      if (clone && obj.posts[0].pn) op = obj.posts[0].pn.cloneNode(true);\r\n      op.setAttribute('class','post op');\r\n      if (obj.posts && obj.posts[0] && obj.posts[0].extra_files) op.setAttribute('style','clear:both;');\r\n      th.insertBefore(op, ref);\r\n//      if (assign_pn) obj.posts[0].pn = th;\r\n      obj.posts[0].pn = op;\r\n      if (obj.posts) {\r\n        for (var i=1;i<obj.posts.length;i++) {\r\n//          th.appendChild(this.post_json2html(obj.posts[i], board));\r\n          var pn = clone && obj.posts[i].pn && obj.posts[i].pn.cloneNode(true) || this.post_json2html(obj.posts[i], obj.board);\r\n          th.insertBefore(this.post_container(pn,obj.posts[i].no), ref);\r\n          th.insertBefore(document.createElement('br'), ref);\r\n          obj.posts[i].pn = pn;\r\n        }\r\n        this.page_json2html3_add_omitted_info(obj,obj.posts,obj.posts);\r\n////////      } else { // WILL BE REDUNDANT\r\n////////        var keys = Object.keys(obj); // obj.posts===undefined, but it is defined as undefined, so key contains 'posts'. \r\n////////        obj.posts = [];\r\n////////        obj.posts[0] = {};\r\n////////        for (var i=0;i<keys.length;i++) if (keys[i]!=='posts') obj.posts[0][keys[i]] = obj[keys[i]]; // remove props in prototype chain.\r\n////////        obj.posts[0].pn = op;\r\n      }\r\n      return th;\r\n    },\r\n    page_json2html3_replace_expander : function(posts_old, idx, key) {\r\n      var omit_info = posts_old[0].pn.getElementsByClassName('omitted')[0];\r\n      if (omit_info) {\r\n        if (omit_info.childNodes.length>=3) omit_info.removeChild(omit_info.childNodes[2]);\r\n        if (omit_info.childNodes.length>=2) omit_info.removeChild(omit_info.childNodes[1]); // 'if ()' is a parch for a bug in lainchan, inconsistency between usual boards and /mega/\r\n//        omit_info.removeChild(omit_info.childNodes[1]);\r\n        omit_info.appendChild(cnst.config_expander(key, idx));\r\n      }\r\n    },\r\n    page_json2html3_add_omitted_info : function(th,posts_old,posts) {\r\n      var nof_files = 0;\r\n      for (var i=1;i<posts.length;i++) nof_files += (posts[i].type_data==='html')? posts[i].pn.getElementsByClassName('file').length :\r\n                                                    (!posts[i].filename)? 0 :\r\n                                                    (posts[i].extra_files)? posts[i].extra_files.length+1 : 1;\r\n      var nof_files_omitted = th.nof_files - nof_files;\r\n      var nof_posts_omitted = th.nof_posts - posts.length;\r\n\r\n      var omit_info = (posts_old)? posts_old[0].pn.getElementsByClassName('omitted')[0] : null;\r\n      if (nof_posts_omitted!=0) {\r\n//      if (th.nof_posts>1) {\r\n        if (!omit_info) {\r\n          omit_info = document.createElement('span');\r\n          omit_info.setAttribute('class','omitted');\r\n//          omit_info.innerHTML = 'dummy<a href=\"javascript:void(0)\">Click to expand</a>.';\r\n          omit_info.innerHTML = 'dummy';\r\n          omit_info.appendChild(cnst.config_expander(th.key));\r\n          if (posts_old) posts_old[0].pn.appendChild(omit_info);\r\n        }\r\n//        omit_info.childNodes[0].textContent = (nof_posts_omitted!==0)? (nof_posts_omitted +' post' + ((nof_posts_omitted!==1)? 's':'') +\r\n//          ((nof_files_omitted)? ' and ' + nof_files_omitted + ' image repl'+ ((nof_files_omitted===1)? 'y' : 'ies') : '') + ' omitted. ') : '';\r\n        omit_info.childNodes[0].textContent = nof_posts_omitted +' post' + ((nof_posts_omitted!==1)? 's':'') +\r\n          ((nof_files_omitted)? ' and ' + nof_files_omitted + ' image repl'+ ((nof_files_omitted===1)? 'y' : 'ies') : '') + ' omitted. ';\r\n      } else if (omit_info) omit_info.childNodes[0].textContent = 'Showing all posts.'; //if (omit_info && posts_old) posts_old[0].pn.removeChild(omit_info);\r\n      return omit_info;\r\n    },\r\n    catalog_json2html3_thumbnail: function(obj, board) {\r\n      return ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://' + this.domain_url + board + 'thumb/' + obj.tim + obj.ext : '');\r\n    },\r\n    catalog_json2html3_src: function(obj, board) {\r\n      return ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png' || obj.ext==='.webm')? 'https://' + this.domain_url + board + 'src/' + obj.tim + obj.ext : '');\r\n    },\r\n    catalog_json2html3 : function(obj,board,thumb_url, make_footer) {\r\n      var th = document.createElement('div');\r\n      th.setAttribute('class','mix');\r\n      th.setAttribute('style','display: inline-block;');\r\n//      if (obj.ext==='.gif' || obj.ext==='.png') obj.ext='.jpg';\r\n//      if (obj.ext==='.gif' || obj.ext==='.jpeg') obj.ext='.jpg';\r\n      th.innerHTML = '<div class=\"thread grid-li grid-size-' + site2[site.nickname].catalog_native_size + '\">' +\r\n                     '<a href=\"' + site2[obj.domain].make_url4([obj.domain,obj.board,obj.no,'thread_html'])[0] + '\">' +\r\n//                     '<a href=\"' + thumb_url + '\">' +\r\n//                     '<a>' +\r\n                       '<img src=\"' + thumb_url +\r\n                       '\" id=\"img-' + obj.no +\r\n                       '\" data-subject=\"' + obj.sub +\r\n                       '\" data-name=\"' + obj.name +\r\n                       '\" data-muhdifference=\"\" data-last-reply=\"\" data-last-subject=\"\" data-last-name=\"\" data-last-difference=\"\"' +\r\n                       'class=\"' + board + ' thread-image\" title=\"' + new Date(obj.last_modified*1000).toLocaleString() + ' '+obj.ext + '\"></a>' +\r\n                     '<div class=\"replies\"><strong>' + (make_footer?' R: ' + (obj.nof_posts-1) +' / I: ' + obj.nof_files : '') + '</strong>' + \r\n                     ((obj.sub)? '<p class=\"intro\"><span class=\"subject\">' + obj.sub + '</span></p>' : '<br>') +\r\n                     obj.com + '</div></div>';\r\n      return th;\r\n    },\r\n//    catalog_json2html3 : function(obj,board) {\r\n//      th = document.createElement('div');\r\n////      if (obj.ext==='.gif' || obj.ext==='.png') obj.ext='.jpg';\r\n//      if (obj.ext==='.gif' || obj.ext==='.jpeg') obj.ext='.jpg';\r\n//      th.innerHTML = '<div class=\"thread grid-li grid-size-small\"><a href=\"'\r\n//                   + site2['8chan'].make_url3(board,obj.no) + '\"><img src=\"'\r\n//                   + ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://' + site2['8chan'].domain_url + board + 'thumb/' + obj.tim + obj.ext : '')\r\n//                   + '\" id=\"img-'\r\n//                   + obj.no  + '\" data-subject=\"'\r\n//                   + obj.sub + '\" data-name=\"'\r\n//                   + obj.name+ '\" data-muhdifference=\"\" data-last-reply=\"\" data-last-subject=\"\" data-last-name=\"\" data-last-difference=\"\"'\r\n////                   + 'class=\"scriptcdc thread-image\" title=\"' + new Date(obj.last_modified*1000).toLocaleString() +'\"></a>'\r\n//                   + 'class=\"'+board+' thread-image\" title=\"' + new Date(obj.last_modified*1000).toLocaleString() + ' '+obj.ext + '\"></a>'\r\n//                   + '<div class=\"replies\"><strong>R: '\r\n//                   + obj.replies +' / I: '\r\n//                   + (obj.images+obj.omitted_images)\r\n////                   + ((pref.catalog_footer_show_board_name)? ' '+board : '')\r\n//                   + '</strong>'\r\n//                   + ((obj.sub)? '<p class=\"intro\"><span class=\"subject\">' + obj.sub + '</span></p>' : '')\r\n//                   + obj.com + '</div></div>';\r\n//      return th;\r\n//    },\r\n    catalog_from_json3 : function(obj,board) {\r\n      var ths;\r\nif (pref.test_mode['0']) {\r\n      ths = {domain:'8chan', board:site.board, obj:obj};\r\n      this.parse_funcs['catalog_json'].entry(ths,this.parse_funcs['catalog_json']['full_hier']);\r\n} else {\r\n//      ths = {domain:'8chan', board:board, obj:obj, parse_funcs:this.parse_funcs['catalog_json'], __proto__:site4.parse_funcs_on_demand};\r\n////      var parse_obj = {domain:'8chan', board:board, parse_funcs:this.parse_funcs['catalog_json'], __proto__:site4.parse_funcs_on_demand};\r\n////      ths = {obj:obj, __proto__:parse_obj};\r\n      return site2[this.nickname].wrap_to_parse.get(obj, this.nickname, board, 'catalog_json');\r\n}\r\n      return ths.ths;\r\n    },\r\n//    catalog_json2html2 : function(obj,board) {\r\n//      th = document.createElement('div');\r\n//      th.setAttribute('data-reply',obj.replies);\r\n//      th.setAttribute('data-bump',obj.last_modified);\r\n//      th.setAttribute('data-time',obj.time);\r\n////      if (obj.ext==='.gif' || obj.ext==='.png') obj.ext='.jpg';\r\n//      if (obj.ext==='.gif' || obj.ext==='.jpeg') obj.ext='.jpg';\r\n//      th.innerHTML = '<div class=\"thread grid-li grid-size-small\"><a href=\"'\r\n//                   + site2['8chan'].make_url3(board,obj.no) + '\"><img src=\"'\r\n////                   + ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://media.' + site2['8chan'].domain_url + board + 'thumb/' + obj.tim + obj.ext : '')\r\n//                   + ((obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://' + site2['8chan'].domain_url + board + 'thumb/' + obj.tim + obj.ext : '')\r\n//                   + '\" id=\"img-'\r\n//                   + obj.no  + '\" data-subject=\"'\r\n//                   + obj.sub + '\" data-name=\"'\r\n//                   + obj.name+ '\" data-muhdifference=\"\" data-last-reply=\"\" data-last-subject=\"\" data-last-name=\"\" data-last-difference=\"\"'\r\n////                   + 'class=\"scriptcdc thread-image\" title=\"' + new Date(obj.last_modified*1000).toLocaleString() +'\"></a>'\r\n//                   + 'class=\"scriptcdc thread-image\" title=\"' + new Date(obj.last_modified*1000).toLocaleString() + ' '+obj.ext + '\"></a>'\r\n//                   + '<div class=\"replies\"><strong>R: '\r\n//                   + obj.replies +' / I: '\r\n//                   + (obj.images+obj.omitted_images)\r\n////                   + ((pref.catalog_footer_show_board_name)? ' '+board : '')\r\n//                   + '</strong>'\r\n//                   + ((obj.sub)? '<p class=\"intro\"><span class=\"subject\">' + obj.sub + '</span></p>' : '')\r\n//                   + obj.com + '</div></div>';\r\n//      return th;\r\n//    },\r\n//    catalog_from_json2 : function(doc_json,board) {\r\n//    catalog_from_json2 : function(obj,board) {\r\n////      var obj = JSON.parse(doc_json);\r\n//      var ths = [];\r\n//      for (var i=0;i<obj.length;i++)\r\n//        for (var j=0;j<obj[i].threads.length;j++) {\r\n//          var name = '8chan' + board + obj[i].threads[j].no;\r\n//          var pn = site2['8chan'].catalog_json2html2(obj[i].threads[j],board);\r\n//          ths.push(site2['8chan'].catalog_from_native_1(pn,board));\r\n//          ths[ths.length-1][14] = i + '.' +j;\r\n//        }\r\n//      return ths;\r\n//    },\r\n    patch:{\r\n      expand_thumbnail_inline_load: function(){\r\n        var pnode = this.parentNode && this.parentNode.parentNode;\r\n        if (pnode && pnode.classList && pnode.classList.contains('multifile') && pnode.style.width) { // patch for multifile in vichan\r\n          this.setAttribute('data-originalWidth',pnode.style.width);\r\n          pnode.style = '';\r\n        }\r\n      },\r\n    },\r\n    proto : 'DEFAULT'\r\n  };\r\n}\r\nif (pref.features.domains['KC']) { \r\n  site2['KC'] = {\r\n    nickname : 'KC',\r\n    domain_url: 'krautchan.net',\r\n//    features : {thread_reader: true},\r\n    components: {\r\n      boardlist: '.menu',\r\n      postform_comment: '#postform_comment',\r\n      postform_submit: '#postform_submit',\r\n    },\r\n    make_tack: function(){\r\n      var tack = document.createElement('img');\r\n      tack.setAttribute('src','/images/sticky.gif');\r\n      return tack;\r\n    },\r\n//    postform: {\r\n//      init:function(){\r\n//        this.tack = site2[site.nickname].make_tack();\r\n//        this.tack.setAttribute('style','float:right;font-size:2em;');\r\n//        site.postform.parentNode.insertBefore(this.tack,site.postform);\r\n//        return this.tack;\r\n//      },\r\n//      __proto__:site2['DEFAULT'].postform\r\n//    },\r\n    boards_json: site2['DEFAULT'].generate_boards_json(\r\n      [['b',15],['int',20],'vip',\r\n       'a','c','co','d','e','f','fb','fe','fit','jp','k','l','li',['m',5],'n','ng','p','ph','prog','sp',\r\n       't',['trv',18],'tu','tv','v','w','we','wk','wp','z','zp','ft','r',['h',8],'s','bans','kc','rfk',['rvss',15]], 10),\r\n    check_func : function(){\r\n      if (!site2['KC'].force_https) site2['KC'].protocol = site.protocol;\r\n      var href = window.location.href;\r\n      if (href.search(/krautchan.net/)!=-1) { // Krautchan\r\n        site.whereami = (document.head.innerHTML.indexOf('404 Not Found')!=-1)? '404'\r\n                      : (href.search(/krautchan\\.net\\/?$/)!=-1)? 'frame'\r\n                      : (href.search(/catalog/)!=-1)? 'catalog'\r\n                      : (href.search(/thread/)!=-1)? 'thread'\r\n                      : (href.search(/\\/$|(index|[0-9]+)\\.html|\\/#all$/)!=-1)? 'page'\r\n                      : 'other';\r\n        if (site.whereami==='page' || site.whereami==='thread') {\r\n          this.components.boardlist = 'body > div:nth-child(3)';\r\n          delete this.show_boardlist_physical_extract_func;\r\n        }\r\n        site.config('krautchan.net','KC');\r\n        site.max_page  = (site2['KC'].max_page_kc[site.board]==undefined)? 10 : site2['KC'].max_page_kc[site.board];\r\n        if (site.whereami==='catalog') {\r\n          if (href[href.length-1]==='/') href = href.substr(0,href.length-1);\r\n          site.board = href.substr(href.lastIndexOf('/'))+'/';\r\n        }\r\n        if (site.whereami==='frame') {\r\n          site.root_body2 = document.createElement('div');\r\n          site.embed_frame = 'main';\r\n          site.embed_frame_win = main;\r\n          navigation.onload = function(){\r\n            site.root_body = navigation.document.body;\r\n            site.root_body.appendChild(site.root_body2);\r\n          };\r\n        }\r\n        site.embed_to = (site.whereami==='thread' || site.whereami==='page')? {\r\n          top: function(){return document.querySelector('form[action=\"/delete\"]');},\r\n          bottom: function(){return document.querySelector('form[action=\"/delete\"]').nextSibling;}} : {};\r\n//        if (site.whereami==='thread' || site.whereami==='page') {\r\n//          site.embed_to['top']    = document.querySelector('form[action=\"/delete\"]');\r\n//          site.embed_to['bottom'] = document.querySelector('form[action=\"/delete\"]').nextSibling;\r\n////        } else if (site.whereami==='catalog') {\r\n////          site.embed_to['top']    = document.getElementsByTagName('header')[0].nextSibling;\r\n////          site.embed_to['bottom'] = document.getElementsByTagName('footer')[0];\r\n//        }\r\n        site.postform = document.getElementById('postform');\r\n        site.postform_rules = document.getElementById('rules_row');\r\n////        this.pref_default(pref); // working code.\r\n        return true;\r\n      } else return false;\r\n    },\r\n////    pref_default: function(pref){ // working code.\r\n////      pref.thread_reader.own_posts_tracker = true;\r\n////      pref.thread_reader.check_num_of_children = false;\r\n////    },\r\n    force_https : false,\r\n    protocol : 'https:',\r\n//    home : site.protocol + '//krautchan.net', // cause memory leak\r\n    home : site.protocol + '//krautchan.net/regeln.html',\r\n//    home : site.protocol + '//krautchan.net/favicon.ico',\r\n    show_boardlist_physical_extract_func: function(key){return key.substr(1,key.length-2);},\r\n    catalog_frame_prep: function(pn12){\r\n      var source = [navigation.document.body, main.document.body];\r\n//      for (var i=0;i<2;i++) {\r\n//        var container = document.createElement('div');\r\n//        container.style.display = 'none';\r\n//        while (source[i].childNodes.length!=0) container.appendChild(source[i].childNodes[0]);\r\n//        source[i].appendChild(container);\r\n//      }\r\n      site2['common'].absorb_children(source[0]).style.display = 'none';\r\n      site2['common'].absorb_children(source[1]).style.display = 'none';\r\n      source[0].insertBefore(pn12,source[0].firstChild);\r\n      source[0].insertBefore(pn12,source[0].firstChild);\r\n      site.root_body.appendChild(site.root_body2);\r\n      this.catalog_embed_prep(pn12);\r\n    },\r\n////    catalog_background : '#cfcede',\r\n////    catalog_background : '#dadafc',\r\n//    catalog_background : '#e0e0fc',\r\n//    catalog_bordercolor : '#aaaacc',\r\n//    catalog_threads_in_page : function(doc){return doc.getElementsByClassName('thread');},\r\n    catalog_threads_in_page : function(doc){return doc.getElementsByClassName('thread_body');},\r\n//    remove_posts : function(doc){\r\n//      var threads_body = doc.getElementsByClassName('thread_body');\r\n//      var posts = [];\r\n//      for (var i=0;i<threads_body.length;i++) {\r\n//        posts_in_thread = threads_body[i].getElementsByTagName('table');\r\n//        for (var j=0;j<posts_in_thread.length;j++) posts.push(posts_in_thread[j]);\r\n//      }\r\n//      for (var i=posts.length-1;i>=0;i--) posts[i].innerHTML = '';\r\n//      return doc;\r\n//    },\r\n    max_page_kc : {\r\n      '/int/' : 20,\r\n      '/b/'   : 15,\r\n      '/trv/' : 13,\r\n      '/m/'   : 5\r\n    },\r\n    max_page: function(bn){return site2['KC'].max_page_kc[bn];},\r\n    make_url4 : function(dbt){\r\n      var url_prefix = this.protocol + '//' + this.domain_url;\r\n      dbt[3] = dbt[3].replace(/_json/,'_html');\r\n      if      (dbt[3]==='page_html')    return [url_prefix + dbt[1] + ((dbt[2]==0)? '' : dbt[2] + '.html'), 'html'];\r\n      else if (dbt[3]==='catalog_html') return [url_prefix + '/catalog' + dbt[1].substr(0,dbt[1].length-1), 'html'];\r\n      else if (dbt[3]==='thread_html')  return [url_prefix + dbt[1] + 'thread-' + dbt[2] + '.html', 'html'];\r\n    },\r\n    trim_list: 'no',\r\n//////////    make_url : function(board,no){return [site2['KC'].protocol + '//krautchan.net' + board + ((no==0)? '' : no + '.html'), 'html'];}, // working code.\r\n////////    make_url : function(board,no,key){\r\n////////      var url_prefix = site2['KC'].protocol + '//krautchan.net';\r\n////////      return (key==='p')? [url_prefix + board + ((no==0)? '' : no + '.html'), 'html'] : \r\n////////                          [url_prefix + '/catalog' + board.substr(0,board.length-1),'html'];\r\n////////    },\r\n////////    make_url3: function(board,th){return  site2['KC'].protocol + '//krautchan.net' + board + 'thread-' + th + '.html';},\r\n    get_next_image: function(img,top){\r\n      var imgs = Array.prototype.slice.call(document.querySelectorAll('img[id^=thumbnail]')).filter(function(v){return v.src.substr(-5,5)!=='.webm';});\r\n//      var imgs = cataLog.parent.querySelectorAll('img[id^=\"thumbnail\"]');\r\n      return site2['DEFAULT'].get_next_image(img,top,imgs);\r\n    },\r\n    get_ops : function(doc){\r\n      var ops = [];\r\n      var divs = doc.getElementsByTagName('div');\r\n      for (var i=0;i<divs.length;i++)\r\n        if (divs[i].className == 'thread' || divs[i].className == 'thread kc_showReplies')\r\n          ops.push(divs[i].id.substring(7)); // substring(7) for removing 'thread_'\r\n      return ops;\r\n    },\r\n    get_posts : function(doc) {\r\n      var posts = [];\r\n      var anchors = doc.getElementsByTagName('a');\r\n      for (var i=0;i<anchors.length;i++) if (anchors[i].name != '') posts.push(anchors[i].name);\r\n      return posts;\r\n    },\r\n////////    get_thread_link : function(pn,boardname,del){\r\n//////////      var keyword = (boardname=='/int/')? 'Reply' : 'Antworten';\r\n////////      var as = pn.getElementsByClassName('postheader')[0].getElementsByTagName('a');\r\n//////////      for (var i=0;i<as.length;i++) if (as[i][brwsr.innerText]==keyword) return as[i].getAttribute('href');\r\n//////////      for (var i=0;i<as.length;i++) if (as[i].innerHTML==keyword) {\r\n////////      for (var i=0;i<as.length;i++) if (as[i][brwsr.innerText]=='Reply' || as[i][brwsr.innerText]=='Antworten') {\r\n////////        var href = as[i].getAttribute('href');\r\n////////        if (del) {\r\n////////          var j=0;\r\n////////          var parent = as[i].parentNode;\r\n////////          while (parent.childNodes[j]!=as[i]) j++;\r\n////////          parent.removeChild(parent.childNodes[j+1]);\r\n////////          parent.removeChild(as[i]);\r\n////////          parent.removeChild(parent.childNodes[j-1]);\r\n////////        } else as[i].setAttribute('target',(pref.catalog_open_in_new_tab)? '_blank' : '_self');\r\n////////        return href;\r\n////////      }\r\n////////      return null;\r\n////////    },\r\n    modify_thread_link : function(pn){\r\n      var retval = [];\r\n      var as = pn.getElementsByClassName('postheader')[0].getElementsByTagName('a');\r\n      for (var i=0;i<as.length;i++) if (as[i][brwsr.innerText]=='Reply' || as[i][brwsr.innerText]=='Antworten') {\r\n        var href = as[i].getAttribute('href');\r\n        retval.push([as[i],href]);\r\n        as[i].removeAttribute('href');\r\n      }\r\n      return retval;\r\n    },\r\n//    add_thread_link : function(doc,url){\r\n//      var pn = document.createElement('a');\r\n//      pn.href = url.replace(/https*:\\/\\/krautchan\\.net/,'');\r\n//      pn.innerHTML = 'Reply';\r\n//      var th = doc.getElementsByClassName('postheader')[0];\r\n//      if (th) {\r\n//        th.insertBefore(pn,th.firstChild);\r\n//        th.insertBefore(document.createTextNode('['),pn);\r\n//        th.insertBefore(document.createTextNode(']'),pn.nextSibling);\r\n//      }\r\n//    },\r\n    time_offset : 1, // 1 for usual, 2 for summer time.\r\n//    get_time_of_posts : function(doc){ // working code.\r\n//      var postdates = doc.getElementsByClassName('postdate');\r\n//      return [parseInt(brwsr.Date_parse(postdates[postdates.length-1][brwsr.innerText]),10) - site2['KC'].time_offset*3600000,\r\n//              parseInt(brwsr.Date_parse(postdates[0                 ][brwsr.innerText]),10) - site2['KC'].time_offset*3600000];\r\n//    },\r\n//    get_time_of_posts : function(th){ // cause error\r\n//      var posts = th.getElementsByTagName('table');\r\n//      return [site2['KC'].get_time_of_post_in_utc(posts[posts.length-1]),site2['KC'].get_time_of_post_in_utc(posts[0])];\r\n//    },\r\n//    get_time_of_post_in_utc : function(post){ // working code\r\n//      var postdates = post.getElementsByClassName('postdate');\r\n//      if (postdates[0]) return parseInt(brwsr.Date_parse(postdates[0][brwsr.innerText]),10) - site2['KC'].time_offset*3600000;\r\n//    },\r\n    mark_newer_posts: function(th,date,unmark, short_cut) {\r\n      var pn = site2['DEFAULT'].mark_newer_posts('KC',th.getElementsByTagName('table'),date, function(post){return post.getElementsByClassName('postreply')[0];}, unmark, short_cut);\r\n      return (pn!=null)? pn.offsetParent : null;\r\n    },\r\n    localtime: function(pn){\r\n      var postdate = pn.getElementsByClassName('postdate')[0];\r\n      if (postdate) {\r\n        var lt = postdate.cloneNode(false);\r\n        lt.setAttribute('class','CatChan_localtime');\r\n        lt.textContent = site2.common.change_utc_to_local(site2['KC'].parse_funcs.post_html.time_pn_1(postdate)); // use direct path to hope to be inline optimized.\r\n        postdate.parentNode.insertBefore(lt,postdate.nextSibling);\r\n        postdate.setAttribute('style','display:none');\r\n      }\r\n//      var times = pn.getElementsByClassName('postdate');\r\n//      for (var i=0;i<times.length;i++) times[i].textContent = site2.common.change_utc_to_local(Date.parse(times[i][brwsr.innerText])-site2['KC'].time_offset*3600000);\r\n//      for (var i=0;i<times.length;i++) times[i].textContent = site2.common.change_utc_to_local(brwsr.Date_parse(times[i][brwsr.innerText])-site2['KC'].time_offset*3600000);\r\n    },\r\n    remove_files_info : function(th){\r\n      site2.common.remove_by_classname(th,'filename');\r\n      site2.common.remove_by_classname(th,'fileinfo');\r\n      var imgs = th.getElementsByTagName('img');\r\n      for (var i=0;i<imgs.length;i++) if (imgs[i].id && imgs[i].id.search('thumbnail')!=-1) {\r\n        imgs[i].removeAttribute('onmouseover');\r\n        imgs[i].removeAttribute('onmouseout');\r\n        imgs[i].removeAttribute('onload');\r\n        site2.common.move_up_and_delete_parent([imgs[i]]);\r\n      }\r\n      var files = th.getElementsByClassName('file_thread');\r\n      for (var i=0;i<files.length;i++) site2.common.remove_brs(files[i]);\r\n      for (var i=0;i<files.length;i++) site2.common.remove_by_attribute([files[i]],'id','filename');\r\n//      site2.common.remove_by_classname(th,'file_thread');\r\n//      site2.common.remove_by_classname(th,'postbody');\r\n    },\r\n////////    insert_footer : function(th,page_no,bn,exe,date,nof_posts,nof_files){\r\n////////      var key = (!brwsr.ff)? 'innerText' : 'innerHTML';\r\n////////      var posts = th.getElementsByTagName('table');\r\n////////      nof_posts += posts.length +1; // +1 for OP.\r\n////////      var files = th.getElementsByClassName('file_thread');\r\n////////      nof_files += th.getElementsByClassName('filename').length;\r\n////////      var om_info = th.getElementsByClassName('omittedinfo');\r\n////////      if (om_info[0]) {\r\n////////        var str = om_info[0][key].replace(/\\n/g,'');\r\n////////        nof_posts += parseInt(str.replace(/\\ post.*/,''),10);\r\n////////        nof_files += parseInt('0'+str.replace(/\\ file.*/,'').replace(/[^\\ ]*\\ /g,''),10);\r\n////////      }\r\n////////      if (exe) {\r\n////////        var pn = document.createElement('div');\r\n//////////        pn.name = 'catalog_footer';\r\n////////        pn.setAttribute('name','catalog_footer');\r\n//////////        pn[key] = bn + '  ' + nof_posts + '/' + nof_files + '/' + page_no + '  ';\r\n////////        pn.innerHTML = '<span>' + bn + '  ' + nof_posts + '/' + nof_files + '/' + page_no + '  </span>';\r\n////////        var imgs = th.getElementsByTagName('img');\r\n////////        for (var i=0;i<imgs.length;i++) {\r\n//////////          if (imgs[i].src && imgs[i].getAttribute('src').search(/images\\/balls/)!=-1) pn.appendChild(imgs[i].cloneNode(false)); // doesn't work in KC.\r\n////////          if (imgs[i].getAttribute('src') && imgs[i].getAttribute('src').search(/images\\/balls/)!=-1) pn.appendChild(imgs[i].cloneNode(false));\r\n////////        }\r\n////////        th.insertBefore(pn,files[0]);\r\n////////      }\r\n////////      return [nof_posts,nof_files];\r\n////////    },\r\n    remove_posts : function(th,end){\r\n//      site2.common.remove_by_tagname(th,'table',end);\r\n//      site2.common.remove_double_tags(th,'A');\r\n      var tgts = th.getElementsByTagName('table');\r\n      for (var i=tgts.length-1-end;i>=0;i--) {\r\n        if (tgts[i].previousSibling.previousSibling) tgts[i].parentNode.removeChild(tgts[i].previousSibling.previousSibling); // a tags\r\n        tgts[i].parentNode.removeChild(tgts[i].previousSibling); // text\r\n//if (!pref.test_mode['14']) tgts[i].setAttribute('style','display:none;'+(tgts[i].getAttribute('style') || ''));\r\n//else\r\n        tgts[i].parentNode.removeChild(tgts[i]);\r\n      }\r\n    },\r\n////////    absolute_link : function(doc){\r\n////////      var all = doc.pn.getElementsByTagName('*');\r\n////////      for (var i=0;i<all.length;i++) {\r\n////////        if (all[i].getAttribute('src'))  all[i].setAttribute('src', site2['KC'].protocol + '//krautchan.net'+all[i].getAttribute('src'));\r\n////////        if (all[i].getAttribute('href')) all[i].setAttribute('href',site2['KC'].protocol + '//krautchan.net'+all[i].getAttribute('href'));\r\n////////      }\r\n////////    },\r\n    format_thread_layout : function(th){\r\n      site2.common.add_attribute_by_classname(th,'file_thread','style','float:left;margin:5px');\r\n      site2.common.add_attribute_by_classname(th,'file_reply','style','float:left;margin:5px');\r\n      th.getElementsByTagName('blockquote')[0].setAttribute('style','margin:5px;clear:both');\r\n//      var ph = th.getElementsByClassName('postheader');\r\n//      th.insertBefore(ph,th.getElementsByClassName('postbody')[0]);\r\n    },\r\n    format_thread_style : function(th){\r\n      site2.common.add_attribute_by_classname(th,'postreply','style','background:#cacaec');\r\n    },\r\n    format_thread_contents : function(th){\r\n      site2.common.remove_by_tagname(th,'input');\r\n      site2.common.remove_by_classname(th,'report_parent');\r\n      site2.common.remove_by_attribute(th.getElementsByClassName('postheader'),'onclick','hideThread');\r\n      site2.common.remove_by_attribute(th.getElementsByClassName('file_thread'),'onclick','toggleThumbnail');\r\n//      site2.common.add_attribute_by_attribute(th.getElementsByClassName('file_thread'),'onclick','toggleThumbnail','style','display:none');\r\n      site2.common.remove_by_attribute(th.getElementsByClassName('file_thread'),'href','shipainter');\r\n//      site2.common.remove_by_classname(th,'thread_hidden');\r\n      site2.common.remove_by_tagname(th,'hr');\r\n//      site2.common.remove_by_tagname(th,'br');\r\n      site2.common.remove_by_classname(th,'omittedinfo');\r\n    },\r\n    preprocess_html : function(doc_txt,page){ // cause memory leak in chrome, but fail without this in FF or GreaseMonkey.\r\n      if (doc_txt) {\r\n//        if (page) while (doc_txt.search(/<script[>\\ ](.|\\n)*<\\/script>/)!=-1) doc_txt = doc_txt.replace(/<script[>\\ ](.|\\n)*<\\/script>/,''); // slower execution.\r\n//        while (doc_txt.search(/onload=\"imageFinishedLoading\\([0-9]*\\)\"/)!=-1) doc_txt = doc_txt.replace(/onload=\"imageFinishedLoading\\([0-9]*\\)\"/,''); // slower execution.\r\n//        if (page) doc_txt = doc_txt.replace(/<script[>\\ ](.|\\n)*<\\/script>/mg,''); // cause leak in Chrome, probably a bug.\r\n        if (page) doc_txt = doc_txt.replace(/<script[> ].*<\\/script>/mg,''); // cause leak in Chrome, probably a bug. (remove \\n)\r\n        doc_txt = doc_txt.replace(/onload=\"imageFinishedLoading\\([0-9]*\\)\"/mg,''); // cause leak in Chrome, probably a bug.\r\n// sanitize\r\n        doc_txt = doc_txt.replace(/onmouseover=\"[^\"]*\"/mg,'');\r\n        doc_txt = doc_txt.replace(/onmouseout=\"[^\"]*\"/mg,'');\r\n        doc_txt = doc_txt.replace(/onclick=\"[^\"]*\"/mg,'');\r\n      }\r\n      return doc_txt;\r\n    },\r\n    preprocess_doc : function(doc){\r\n//      site2.common.remove_by_tagname(doc,'script');\r\n      site2.common.remove_attribute(doc,'onload');\r\n      site2.common.remove_attribute(doc,'onmouseover');\r\n      site2.common.remove_attribute(doc,'onmouseout');\r\n      site2.common.remove_attribute(doc,'onclick');\r\n\r\n      site2.common.remove_attribute(doc,'onchange');\r\n      site2.common.remove_attribute(doc,'onfocus');\r\n      site2.common.remove_attribute(doc,'onsubmit');\r\nvar pns = doc.getElementsByTagName('*');\r\nfor (var i=pns.length-1;i>=0;i--)\r\n  if (pns[i].getAttribute && pns[i].getAttribute('href') && pns[i].getAttribute('href').indexOf('javascript:')==0) pns[i].removeAttribute('href');\r\n\r\nif (pref.test_mode['28']) {\r\n      doc.getElementsByTagName('html')[0].innerHTML = doc.getElementsByTagName('html')[0].innerHTML; // remake to sanitize.\r\n}\r\n    },\r\n////////    thread2headline : function(doc){\r\n////////      return site2.common.thread2headline(doc,'KC');\r\n////////    },\r\n    catalog_native_prep: function(date,pn_filter,pn_tb,pn_hi){\r\n      var node_ref = (site.whereami==='catalog')? document.getElementsByClassName('catalog')[0]\r\n                                                : document.querySelector('form[action=\"/delete\"]');\r\n//      var node_ref = (site.whereami==='catalog')? document.getElementById('settings')\r\n//                                                : document.getElementsByName('postcontrols')[0];\r\n//      pn_tb.setAttribute('style', 'float:right');\r\n//      if (site.whereami==='catalog') {\r\n      var selector_catchan = pn_filter.getElementsByTagName('select')['catalog.indexing'];\r\n      selector_catchan.setAttribute('style','float:left');\r\n      node_ref.parentNode.insertBefore(selector_catchan,node_ref);\r\n      pn_tb.childNodes[3].setAttribute('style','float:left');\r\n      node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n////////      return site2['KC'].catalog_from_native(date,document,site.board,site.whereami+'_html');\r\n    },\r\n////////    catalog_from_native : function(date,doc,board,type) { // working code.\r\n////////      return site2[this.nickname].wrap_to_parse.get(doc, this.nickname, board, type);\r\n////////////      var parse_obj = {domain:'KC', board:board, parse_funcs:site2['KC'].parse_funcs[type], __proto__:site4.parse_funcs_on_demand};\r\n////////////      var ths = {pn:doc, __proto__:parse_obj};\r\n////////////      return ths.ths;\r\n////////    },\r\n    catalog_get_native_area: function(){\r\n      if (site.whereami==='page') return document.querySelector('form[action=\"/delete\"]');\r\n      else return document.getElementsByClassName('catalog')[0];\r\n    },\r\n////    get_click_area: function(pn, th){\r\n////      var areas = [];\r\n////      if (th.type_html==='catalog_html') {\r\n////        var tn = pn.getElementsByClassName('thumbnail');\r\n////        for (var i=0;i<tn.length;i++) areas.push(tn[i].getElementsByTagName('img')[0]);\r\n////      } else if (th.type_html==='page_html') {\r\n////        var fths = pn.getElementsByClassName('file_thread');\r\n////        for (var i=0;i<fths.length;i++) {\r\n////          var imgs = fths[i].getElementsByTagName('img');\r\n////          areas.push(imgs[imgs.length-1]);\r\n////        }\r\n////      }\r\n////      return (areas.length!=0)? areas : [pn]; \r\n////    },\r\n//    get_click_area: function(pn, th){\r\n//      if (th.type_html==='catalog_html') {\r\n//        var tn = pn.getElementsByClassName('thumbnail');\r\n//        return (tn[0])? tn[0].getElementsByTagName('img')[0] : pn;\r\n//      } else if (th.type_html==='page_html') {\r\n//        var imgs = pn.getElementsByClassName('file_thread')[0].getElementsByTagName('img');\r\n//        return imgs[imgs.length-1];\r\n//      }\r\n//    },\r\n    parse_funcs : { // KC\r\n      'catalog_html' : {\r\n        ths: function(doc) {\r\n          var ths = this.ths_array(doc,doc.pn.getElementsByClassName('thread'));\r\n          var t = Date.now() - pref.localtime_offset*3600000; // patch\r\n          for (var i=0;i<ths.length;i++) {\r\n            if (ths[i].time_bumped<0) ths[i].time_bumped += t;\r\n//            var as = ths[i].pn.getElementsByTagName('a');\r\n//            for (var j=0;j<as.length;j++) as[j].removeAttribute('href');\r\n          }\r\n          return ths;\r\n        },\r\n//        th_init: function(th) {\r\n//          var as = th.pn.getElementsByTagName('a');\r\n//          for (var j=0;j<as.length;j++) as[j].addEventListener('click',th.parse_funcs.preventDefault,false);\r\n//        },\r\n//        th_destroy: function(pn, parse_funcs){\r\n//          var as = pn.getElementsByTagName('a');\r\n//          for (var j=0;j<as.length;j++) as[j].removeEventListener('click',parse_funcs.preventDefault,false);\r\n//        },\r\n\r\n        no : function(th){return parseInt(th.pn.getAttribute('id').substr(7),10);}, // the same as 4chan.\r\n//        time_bumped: function(th){return 0;},\r\n        time_bumped: function(th){\r\n          return -1 -parseInt(th.page.substr(0,th.page.indexOf('.')),10)*16 - parseInt(th.page.substr(th.page.indexOf('.')+1));},\r\n        time_created : function(th){return 0;},\r\n        nof_posts: function(th){\r\n          var footer = th.pn.getElementsByClassName('omitted_text')[0];\r\n//          Object.defineProperty(th, 'footer', {value:footer, enumerable:true, writable:true, configurable:true});\r\n//          footer.innerHTML = '';\r\n          var nof_posts = (footer)? parseInt(footer.textContent.match(/[0-9]+/),10) : 0;\r\n          return (isNaN(nof_posts))? 1 : nof_posts + 1;\r\n        },\r\n        nof_files: function(th){return 0;},\r\n        key: function(th){return th.domain + th.board + th.no;},\r\n        sub: function(th){\r\n          var sub = th.pn.getElementsByTagName('header')[0].textContent.trim();\r\n          return (sub.search(/^#[0-9]+$/)==0)? '' : sub;\r\n        },\r\n        name: function(th){return '';},\r\n//        com: function(th){return th.pn.getElementsByTagName('section')[0][brwsr.innerText];},\r\n        com: function(th){return th.pn.getElementsByTagName('section')[0].innerHTML;},\r\n        type_com: 'html',\r\n        footer: function(th){\r\n          var footer = th.pn.getElementsByClassName('omitted_text')[0]; // must parse pn because of mimic mode.\r\n          footer.innerHTML = '';\r\n          return footer;\r\n        },\r\n        sticky: function(th){return false;},\r\n//        format: function(th){th.pn.getElementsByTagName('a')[0].removeAttribute('href');return null;},\r\n        op_img_url:function(th){\r\n//          var img = th.pn.getElementsByClassName('thumbnail')[0].getElementsByTagName('img');\r\n          var tn  = th.pn.getElementsByClassName('thumbnail');\r\n          var img = (tn[0])? tn[0].getElementsByTagName('img') : null; // parse other site's html\r\n          var url = (img && img[img.length-1])? img[img.length-1].getAttribute('src') : undefined;\r\n          return url;\r\n        },\r\n        get_op_src: 'thread_html',\r\n        filename: function (th){ // post can be accepted.\r\n          var op = th.pn.classList.contains('thread') || th.pn.classList.contains('thread_body');\r\n          var files = th.pn.getElementsByClassName('post_files')[0].getElementsByTagName('figure');\r\n          if (files) \r\n            for (var i=0;i<files.length;i++) {\r\n              var href = files[i].getElementsByTagName('img')[0].getAttribute('src');\r\n              if (i===1) th.extra_files = [];\r\n              if (i>=1) th.extra_files[i-1] = {domain:th.domain, board:th.board};\r\n              var idx = href.lastIndexOf('/');\r\n              var tgt = (i===0)? th : th.extra_files[i-1];\r\n//              tgt.filename = href.substr(idx+1);\r\n              tgt.filename = files[i].getElementsByTagName('img')[0].getAttribute('alt');\r\n//              tgt.filename_server = href.substr(0,idx).replace(/[^\\/]*\\//g,'');\r\n              tgt.filename_server = href.substr(idx+1);\r\n            }\r\n          return th.filename;\r\n        },\r\n        prep_mimic: 'page_html',\r\n        tn_imgs: function(){return [];}, // dynamic, or function(th){return th.pn.getElementsByClassName('thumbnail');},\r\n        img2src: function(img){return th.op_img_url.replace('thumbnails','files');},\r\n        dynamic_image_hover: true,\r\n      },\r\n      'catalog_json' : {\r\n        proto: 'catalog_html',\r\n      },\r\n      'page_html' : {\r\n        ths: function(doc) {return this.ths_array(doc, doc.pn.getElementsByClassName('thread'));},\r\n        th_init: function(th) {\r\n          th.pn.removeAttribute('class');\r\n          th.pn.style.clear = 'none';\r\n        },\r\n//        th_destroy: function(pn, parse_funcs){},\r\n//        no : function(th){return th.pn.id.substr(7);},\r\n//        no : function(th){return parseInt(th.pn.id.substr((th.pn.classList.contains('thread'))? 7:5),10);}, // page and posts\r\n        no : function(th){ // page and posts\r\n          return parseInt((th.pn.id)? th.pn.id.replace(/[^_\\-]*./,'') : // /int/\r\n                                      th.pn.getElementsByClassName('postnumber')[0].getElementsByTagName('a')[1].textContent, 10);}, // other boards.\r\n//        ths: function(doc) { // working code.\r\n//          var ths = this.ths_array(doc, doc.pn.getElementsByClassName('thread'));\r\n//          for (var i=0;i<ths.length;i++) {\r\n//            Object.defineProperty(ths[i], 'no', {value:ths[i].pn.id.substr(7), enumerable:true, writable:true, configurable:true});\r\n//            ths[i].pn.removeAttribute('class'); // collection ISN'T writable? and if wrote, its enumerator doesn't work.\r\n//            ths[i].pn.style.clear = 'none';\r\n//          }\r\n//          return ths;\r\n//        },\r\n//        no : function(th){return parseInt(th.pn.getElementsByClassName('quotelink')[0][brwsr.innerText],10);},\r\n        posts: function(th){return this.posts_array(th, th.pn.querySelectorAll('.thread_body, td.postreply'));},\r\n//        posts: function(th){return this.posts_array(th, th.pn.querySelectorAll('.thread_body, .postreply'));}, // doesn't work for thread_reader.\r\n//        posts: function(th){ // working code.\r\n//          var posts = [];\r\n//          posts[0] = {pn:th.pn.getElementsByClassName('thread_body')[0], __proto__:th.__proto__}; // OP\r\n//          var replies = th.pn.getElementsByClassName('postreply');\r\n//          for (var i=0;i<replies.length;i++) posts[posts.length] = {pn:replies[i], __proto__:th.__proto__};\r\n//          return posts;\r\n//        },\r\n        time: 'post_html.time',\r\n        nof_posts: function(th){\r\n          var nof_posts = th.pn.getElementsByTagName('table').length +1; // +1 for OP.\r\n          var nof_files = th.pn.getElementsByClassName('filename').length;\r\n          var om_info = th.pn.getElementsByClassName('omittedinfo');\r\n          if (om_info[0]) {\r\n            var str = om_info[0][brwsr.innerText].replace(/\\n/g,'');\r\n            nof_posts += parseInt(str.replace(/\\ post.*/,''),10);\r\n            nof_files += parseInt('0'+str.replace(/\\ file.*/,'').replace(/[^\\ ]*\\ /g,''),10);\r\n          }\r\n          Object.defineProperty(th,'nof_files',{value:nof_files, enumerable:true, configurable:true, writable:true});\r\n          return nof_posts;\r\n        },\r\n        nof_files: function(th){\r\n          if (!th.hasOwnProperty('nof_posts')) this['nof_posts'](th);\r\n          return th.nof_files;\r\n        },\r\n        sub:  function(post){\r\n          var sub = post.pn.getElementsByClassName('postsubject')[0];\r\n          return (sub)? sub.textContent : '';},\r\n        name: function(post){return post.pn.getElementsByClassName('postername')[0][brwsr.innerText];},\r\n        pn_name: function(post){return post.pn.getElementsByClassName('postername')[0];},\r\n//        com:  function(post){return (post.pn.getElementsByClassName('postbody')[0] || post.pn).getElementsByTagName('p')[0][brwsr.innerText];},\r\n        com:  function(post){return (post.pn.getElementsByClassName('postbody')[0] || post.pn).getElementsByTagName('p')[0].innerHTML.replace(/^\\s*/,'').replace(/\\s*$/,'');},\r\n        type_com: 'html',\r\n        footer: function(th){return this.insert_footer4(th.pn.getElementsByClassName('file_thread')[0]);},\r\n//        sticky: function(th){return (th.pn.getElementsByClassName('stickyIcon').length!=0);},\r\n        flag: function(post){  // same as 8chan\r\n          var balls = post.pn.getElementsByTagName('img');\r\n          for (var i=0;i<balls.length;i++) if (balls[i].getAttribute('src').search(/images\\/balls/)!=-1) break;\r\n//          return (i<balls.length)? balls[i].cloneNode(false) : null; // may cause memory leak\r\n//          return (i<balls.length)? document.importNode(balls[i],false) : null;\r\n          if (i<balls.length) {\r\n            var ball = document.importNode(balls[i],false);\r\n            ball.setAttribute('src', site2['KC'].absolute_link_1(ball.getAttribute('src')));\r\n            return ball;\r\n          } else return null;\r\n//          if (i<balls.length) { // didn't stop memory leak.\r\n//            var ball = document.createElement('img');\r\n//            ball.setAttribute('src',balls[i].getAttribute('src'));\r\n//            return ball;\r\n//          } else return null;\r\n        },\r\n        op_img_url:function(th){\r\n//          var img = th.pn.getElementsByClassName('file_thread')[0].getElementsByTagName('img');\r\n          var ft  = th.pn.getElementsByClassName('file_thread');\r\n          var img = (ft[0])? ft[0].getElementsByTagName('img') : null; // parse other site's html\r\n          var url = (img && img[img.length-1])? img[img.length-1].getAttribute('src') : undefined;\r\n          if (ft.length>=2) {\r\n            th.op_img_url2 = [];\r\n            for (var i=1;i<ft.length;i++) {\r\n              img = ft[i].getElementsByTagName('img');\r\n              var url2 = (img && img[img.length-1])? img[img.length-1].getAttribute('src') : undefined;\r\n              if (url2) th.op_img_url2[th.op_img_url2.length] = url2;\r\n            }\r\n          }\r\n//          return url;\r\n          return site2[th.domain].protocol + '//' + site2[th.domain].domain_url + url; // patch\r\n        },\r\n////        post_no: function(post){return parseInt(post.pn.getElementsByClassName('quotelink')[1][brwsr.innerText],10);},\r\n        get_op_src: 'thread_html',\r\n        get_thread_links : function(th){\r\n          var as = th.pn.getElementsByClassName('postheader')[0].getElementsByTagName('a');\r\n          for (var i=0;i<as.length;i++) \r\n            if (as[i].textContent==='Reply' || as[i].textContent==='Antworten') return [as[i]];\r\n        },\r\n        get_omitted_info : function(post){return post.pn.getElementsByClassName('omittedinfo')[0];},\r\n        set_omitted_info : function(post, info){post.pn.insertBefore(info,post.pn.getElementsByClassName('postbody')[0].nextSibling);},\r\n        replace_omitted_info2 : function(dst, src){dst.childNodes[0].textContent = (src)? src.childNodes[0].textContent : '';},\r\n        filename: function (th){ // post can be accepted.\r\n          var op = th.pn.classList.contains('thread') || th.pn.classList.contains('thread_body');\r\n          var files = th.pn.getElementsByClassName((op)? 'file_thread' : 'file_reply');\r\n          if (files) \r\n            for (var i=0;i<files.length;i++) {\r\n              var href = files[i].getElementsByClassName('filename')[0].getElementsByTagName('a')[0].getAttribute('href');\r\n              if (i===1) th.extra_files = [];\r\n              if (i>=1) th.extra_files[i-1] = {domain:th.domain, board:th.board};\r\n              var idx = href.lastIndexOf('/');\r\n              var tgt = (i===0)? th : th.extra_files[i-1];\r\n              tgt.filename = href.substr(idx+1);\r\n//              tgt.filename_server = href.substr(0,idx).replace(/[^\\/]*\\//g,'');\r\n              tgt.filename_server = href.substr(0,idx).replace(/[^\\/]*\\//g,'').replace(/jpeg$/,'jpg');\r\n              var info = files[i].getElementsByClassName('fileinfo')[0].textContent.replace(/\\s/g,'').split(',');\r\n              tgt.w = parseInt(info[1].substr(0,info[1].indexOf('x')  ),10);\r\n              tgt.h = parseInt(info[1].substr(  info[1].indexOf('x')+1),10);\r\n              var fsize = info[1].split(/\\s/);\r\n              fsize[1] = (fsize[1]==='kB')? 1000 : (fsize[1]==='MB')? 1000000 : 1;\r\n              tgt.fsize = parseInt(fsize[0],10) * fsize[1];\r\n              var tn = files[i].querySelector('img[id^=thumbnail]');\r\n              if (tn) {\r\n                tgt.tn_w = parseInt(tn.getAttribute('width'),10);\r\n                tgt.tn_h = parseInt(tn.getAttribute('height'),10);\r\n              }\r\n            }\r\n          return th.filename;\r\n        },\r\n        tn_imgs: function(th){return th.pn.querySelectorAll('img[id^=thumbnail]');},\r\n        prep_mimic: function (th){\r\n//          th.posts[0].no = th.no; // doesn't work because posts[0].no has getter.\r\n//          for (var i=0;i<th.posts.length;i++) Object.defineProperty(th.posts[i],'no',{value:th.no}); // test patch\r\n          th.op_img_url = th.parse_funcs.op_img_url(th);\r\n        },\r\n        get_op_src: function(th){return site2['KC'].catalog_json2html3_src(th);},\r\n        get_max_page: function(doc){\r\n//          var pns = doc.querySelectorAll('form[action*=delete]')[0].lastChild.previousSibling.previousSibling.previousSibling.getElementsByTagName('*'); // CAN'T GET [1] because it's a text node.\r\n          var pns = doc.querySelectorAll('form[action*=delete]')[0].lastChild.previousSibling.previousSibling.previousSibling.childNodes[1].childNodes[1].childNodes[0].childNodes[3].childNodes; // WORKS ONLY PAGE 0.\r\n          var max = 0;\r\n          for (var i=0;i<pns.length;i++) {\r\n            var text = pns[i].textContent.replace(/\\s+/g,'');\r\n            if (max+1 == text || '['+(max+1)+']'===text) max++; // == used intentionally.\r\n          }\r\n          return max;\r\n        },\r\n      },\r\n      'thread_html' : {\r\n//        ths: function(doc) { // pn of thread isn't used.\r\n//          var ths = site2['KC'].parse_funcs.page_html.ths(doc);\r\n//          for (var i=0;i<ths.length;i++) {\r\n//            var ph = ths[i].pn.getElementsByClassName('postheader')[0];\r\n//            if (ph) {\r\n//              ph.appendChild(document.createTextNode(' ['));\r\n//              var link = document.createElement('a');\r\n//              link.setAttribute('href',ths[i].board + 'thread-' + ths[i].no + '.html');\r\n//              link.innerHTML = 'Reply';\r\n//              ph.appendChild(link);\r\n//              ph.appendChild(document.createTextNode('] '));\r\n//            }\r\n//          }\r\n//          return ths;\r\n//        },\r\n//        ths: function(doc) {return this.ths_array(doc, doc.pn.getElementsByClassName('thread_body'));}, // patch, but for what???, de-patched for trial.\r\n//        com:  function(post){return post.pn.getElementsByTagName('blockquote')[0][brwsr.innerText];},\r\n        com:  function(post){return post.pn.getElementsByTagName('blockquote')[0].innerHTML.replace(/^\\s*/,'').replace(/\\s*$/,'');},\r\n        type_com: 'html',\r\n        time_created: function(th){\r\nreturn th.parse_funcs.time(th.posts[0]);},\r\n        time_bumped: function(th){\r\nreturn th.parse_funcs.time(th.posts[th.posts.length-1]);},\r\n////        pop_post_prep: function(th){ // working code.\r\n////          th.children = th.pn.getElementsByClassName('postreply');\r\n////          th.idx_pop = th.children.length-1;\r\n////        },\r\n////        pop_post: function(th){\r\n////          if (th.idx_pop>=0) {\r\n////            th.post = {pn:th.children[th.idx_pop--], parse_funcs:this, __proto__:th.__proto__};\r\n////            return true;\r\n////          }\r\n////          return false;\r\n////        },\r\n        get_op_src: function(th){return th.op_img_url.replace('thumbnails','files');},\r\n        proto: 'page_html',\r\n      },\r\n      'post_html' : {\r\n        flag: 'page_html',\r\n        time: function(post){\r\n          return site2['KC'].parse_funcs.post_html.time_pn(post.pn); // use direct path to hope to be inline optimized.\r\n        },\r\n        time_pn: function(post_pn){\r\n          var postdate = post_pn.getElementsByClassName('postdate')[0];\r\n          return (postdate)? site2['KC'].parse_funcs.post_html.time_pn_1(postdate) : undefined; // use direct path to hope to be inline optimized.\r\n        },\r\n        time_pn_1: function(postdate){\r\n          return Date.parse(postdate.textContent) + (pref.localtime_offset-site2['KC'].time_offset)*3600000; // FF accepts KC's format\r\n        },\r\n      },\r\n      'post_json' : {\r\n        time_unit: 1, // for archive.list_all\r\n      }\r\n    },\r\n\r\n    general_event_handler:{\r\n//      catalog:{ // working code\r\n//        mouseover: function(e){\r\n//          var et = e.target;\r\n//          var et_tagName = et.tagName;\r\n//          if (et_tagName==='IMG')\r\n//            if (pref[cataLog.embed_mode].image_hover && et.parentNode.className==='thumbnail') cataLog.image_hover_add.call(e.target,e, e.target.src.replace(/thumbnail/,'file'));\r\n//        },\r\n//        __proto__: site2['DEFAULT'].general_event_handler.catalog\r\n//      },\r\n    },\r\n\r\n    popups_href2dbtp: function(href){ //, src, th){\r\n//      if (href[0]==='#' && th) {\r\n//        href = this.link_dbtp2href([th.domain, th.board, th.no, href.substr(1)]);\r\n//        src.setAttribute('href',href);\r\n//      }\r\n      var hrefs = href.split(/[\\/#]/);\r\n      var p = hrefs[hrefs.length-1];\r\n      var t = hrefs[hrefs.length-2].replace('thread-','').replace('.html','');\r\n      var b = (hrefs.length>=3)? '/'+hrefs[hrefs.length-3]+'/' : site.board;\r\n      return ['KC',b,t,p]\r\n    },\r\n    link_dbtp2href: function(dbtp){\r\n      return dbtp[1] + 'thread-' + dbtp[2] + '.html#' + dbtp[3];\r\n    },\r\n\r\n    post_json2html_fname_server: function(post){return post.filename_server;},\r\n    post_json2html_fname: function(post){return post.filename;},\r\n    catalog_json2html3_src: function(obj) {\r\n      return site.protocol + '//' + site2[obj.domain].domain_url + '/files/' + obj.filename_server;\r\n    },\r\n    catalog_json2html3_thumbnail: function(obj) {\r\n      return site.protocol + '//' + site2[obj.domain].domain_url + '/thumbnails/' + obj.filename_server;\r\n    },\r\n//    catalog_json2html3_thumbnail: function(obj, board) {\r\n//      var ext = (obj.ext==='.jpg' || obj.ext==='.png' || obj.ext==='.gif' || obj.ext==='.webm')? '.jpg' : obj.ext;\r\n//      return (obj.ext)? 'http://i.4cdn.org' + obj.board + obj.tim + 's' + ext : '';\r\n//    },\r\n\r\n\r\n\r\n\r\n    \r\n    post_json2html : function(post, board, op, short_link, th_no) {\r\n      var pn = document.createElement('div');\r\n      var time_unit = (post.parse_funcs && post.parse_funcs.time_unit) || 1;\r\n      var date = new Date((post.time || 0) * time_unit -(pref.localtime_offset-site2['KC'].time_offset)*3600000);\r\n      var html_file = '';\r\n      if (post.filename) {\r\n        html_file += this.post_json2html_file(post,board, post.extra_files);\r\n        if (post.extra_files) for (var i=0;i<post.extra_files.length;i++) html_file += this.post_json2html_file(post.extra_files[i],board, true);\r\n      }\r\n      pn.innerHTML =\r\n        '<div class=\"' +((op)? 'thread_body' : 'postreply\" id=\"post-' +post.no) + '\">'+ // <td> can't be used alone.\r\n          '<div class=\"postheader\">'+\r\n            '<input name=\"post_' + post.no+ '\" value=\"delete\" type=\"checkbox\">'+\r\n            ((post.flag)? post.flag.outerHTML : '')+ //  '<img src=\"/images/balls/ca.png\">'+\r\n            '<span class=\"postsubject\">' +post.sub+ '</span> '+\r\n            '<span class=\"postername\">' +post.name+ '</span> '+\r\n            '<span class=\"postdate\">' + date.toLocaleString()+ '</span> '+\r\n            '<span class=\"postnumber\">'+\r\n              '<a href=\"/int/thread-' +th_no+ '.html#' +post.no+ '\" class=\"quotelink\">No.</a>'+\r\n              '<a href=\"/int/thread-' +th_no+ '.html#q'+post.no+ '\" class=\"quotelink\">' +post.no+ '</a>'+\r\n            '</span> '+\r\n            '<div class=\"report_parent\"><a href=\"/report/int/' +th_no +'\" class=\"report_link\"><img src=\"/images/icon-report.png\"></a></div>'+\r\n            ((op)? ' [<a href=\"' + board + 'thread-' + post.no + '.html\">Reply</a>] ' : '')+\r\n          '</div>'+\r\n          html_file+\r\n          '<div' + ((op)? ' class=\"postbody\"' : '') + '>'+\r\n            '<blockquote>'+\r\n              '<p id=\"post_text_' +post.no+ '\">'+ post.com + '</p>'+\r\n            '</blockquote>'+\r\n          '</div>'+\r\n        '</div>'; //'<td>';\r\n      return pn.childNodes[0];\r\n    },\r\n    post_pn2ce: function(pn){ // NOT DEBUGGED BECAUSE KC WAS CLOSED.\r\n      return (pn.lastChild.firstChild.tagName==='BLOCKQUOTE')? pn.lastChild.firstChild : pn.getElementsByTagName('blockquote')[0];\r\n    },\r\n    post_json2html_file : function(post, board, multifile) {\r\n      var fsize_str = (((post.fsize>1048576)? post.fsize/1048576 : post.fsize/1024)+0.005).toString();\r\n      fsize_str = fsize_str.substr(0,fsize_str.indexOf('.')+3) + ((post.fsize>1048576)? ' MB' : ' KB');\r\n      var fname_server = site2[post.domain].post_json2html_fname_server(post);\r\n      var fname = site2[post.domain].post_json2html_fname(post);\r\n      var furl = site2[post.domain].catalog_json2html3_src(post,board);\r\n      var turl = site2[post.domain].catalog_json2html3_thumbnail(post,board);\r\n      var html_str =\r\n        '<div class=\"file_thread\">'+\r\n          '<span class=\"filename\">'+\r\n            '<a href=\"/download/' +fname_server+ '/' +fname+ '\">' +fname+ '</a>'+\r\n          '</span>'+\r\n//          '<img id=\"button_expand_image_185478186\" src=\"/images/button-expand.gif\" style=\"cursor: pointer\">'+\r\n//          '<a href=\"/paint?action=new&amp;board=int&amp;thread=35608887&amp;modify=185478186&amp;applet=shipainter\" onmouseover=\"helpTip('Modify picture')\" onmouseout=\"UnTip()\">'+\r\n//            '<img src=\"/images/button-paint.gif\" border=\"0\" width=\"15\" height=\"15\"></a>\r\n          '<br>'+\r\n          '<span class=\"fileinfo\"> '+ fname.substr(fname.lastIndexOf('.')+1).toUpperCase()+ ', ' +post.w+ 'x' +post.h+ ', ' + fsize_str + '</span><br>'+\r\n          '<a href=\"' +furl+ '\" target=\"_blank\">'+\r\n           '<img style=\"display: block\" id=\"thumbnail_' +fname_server+ '\" src=\"' +turl+ '\" width=\"' +post.tn_w+ '\" height=\"' +post.tn_h+ '\">'+\r\n          '</a>'+\r\n//          '<span id=\"filename_XXXXXXXXX\" style=\"display: none; margin-top: 0px; margin-left: 0px;\">iPhone-SE-vs-iPhone-6S.jpg</span>'+\r\n        '</div>'\r\n      return html_str;\r\n    },\r\n    page_json2html3 : function(obj,board,thumb_url, assign_pn) { // TEMPORAL, USE thumb_url TO MIMIC. // copied from vichan.\r\n      assign_pn = true; // test patch\r\n      var th = document.createElement('div');\r\n      th.setAttribute('id','thread_'+obj.no);\r\n      th.setAttribute('style','clear:both');\r\n      th.innerHTML = '<hr><a name=' +obj.no+ '></a>';\r\n//      th.setAttribute('style','float: left; overflow: hidden;');\r\n      var op = this.post_json2html((obj.posts && obj.posts[0])? obj.posts[0] : obj, board, true, site2[obj.domain].short_link(obj.key, obj.nof_posts, 2, '[Last ',' Posts]'), obj.no);\r\n//      var files = op.getElementsByClassName('file_thread');\r\n//      if (files.length>0) for (i=0;i<files.length;i++) th.appendChild(files[i]);\r\n//      if (obj.posts && obj.posts[0] && obj.posts[0].extra_files) op.setAttribute('style','clear:both;');\r\n      th.appendChild(op);\r\n//      if (assign_pn) obj.posts[0].pn = th;\r\n      if (assign_pn || !obj.posts[0].pn) obj.posts[0].pn = op;\r\n      if (obj.posts) {\r\n        for (var i=1;i<obj.posts.length;i++) {\r\n//          th.appendChild(this.post_json2html(obj.posts[i], board));\r\n          var pn = this.post_json2html(obj.posts[i], board);\r\n          this.update_posts_insert_1(this.post_container(pn,obj.posts[i].no), obj.posts[i].no, null, th);\r\n//          var pn = this.post_container(this.post_json2html(obj.posts[i], board),obj.posts[i].no); // WHY DID I DO THIS? PROBABLY THERE IS A PROBLEM IN A SOLUTION ABOVE.\r\n//          this.update_posts_insert_1(pn, obj.posts[i].no, null, th);\r\n//          th.appendChild(document.createElement('br'));\r\n          if (assign_pn || !obj.posts[i].pn) obj.posts[i].pn = pn;\r\n        }\r\n        this.page_json2html3_add_omitted_info(obj,obj.posts,obj.posts);\r\n////////      } else { // WILL BE REDUNDANT\r\n////////        var keys = Object.keys(obj); // obj.posts===undefined, but it is defined as undefined, so key contains 'posts'. \r\n////////        obj.posts = [];\r\n////////        obj.posts[0] = {};\r\n////////        for (var i=0;i<keys.length;i++) if (keys[i]!=='posts') obj.posts[0][keys[i]] = obj[keys[i]]; // remove props in prototype chain.\r\n////////        obj.posts[0].pn = op;\r\n      }\r\n//      var br = document.createElement('br');\r\n//      br.setAttribute('class','clear');\r\n//      th.appendChild(br);\r\n//      th.appendChild(document.createElement('hr'));\r\n      return th;\r\n    },\r\n    page_json2html3_replace_expander : function(posts_old, idx, key) {\r\n      var omit_info = posts_old[0].pn.getElementsByClassName('omittedinfo')[0];\r\n      if (omit_info) {\r\n//        omit_info.removeChild(omit_info.childNodes[1]);\r\n        omit_info.appendChild(cnst.config_expander(key, idx));\r\n      }\r\n    },\r\n    page_json2html3_add_omitted_info : function(th,posts_old,posts) {\r\n      var nof_files = 0;\r\n      for (var i=1;i<posts.length;i++) nof_files += (posts[i].type_data==='html')? posts[i].pn.getElementsByClassName('file_thread').length :\r\n                                                    (!posts[i].filename)? 0 :\r\n                                                    (posts[i].extra_files)? posts[i].extra_files.length+1 : 1;\r\n      var nof_files_omitted = th.nof_files - nof_files;\r\n      var nof_posts_omitted = th.nof_posts - posts.length;\r\n\r\n      var omit_info = (posts_old)? posts_old[0].pn.getElementsByClassName('omittedinfo')[0] : null;\r\n      if (th.nof_posts>1) { // for expand ALL\r\n        if (!omit_info) {\r\n          omit_info = document.createElement('span');\r\n          omit_info.setAttribute('class','omittedinfo');\r\n//          omit_info.innerHTML = 'dummy<a href=\"javascript:void(0)\">Click to expand</a>.';\r\n          omit_info.innerHTML = 'dummy';\r\n          omit_info.appendChild(cnst.config_expander(th.key));\r\n          if (posts_old) posts_old[0].pn.insertBefore(omit_info, posts_old[0].pn.getElementsByClassName('postbody')[0].nextSibling);\r\n        }\r\n        omit_info.childNodes[0].textContent = (nof_posts_omitted!==0)? (nof_posts_omitted +' post' + ((nof_posts_omitted!==1)? 's':'') +\r\n          ((nof_files_omitted)? ' and ' + nof_files_omitted + ' file'+ ((nof_files_omitted===1)? '' : 's') : '') + ' are not shown. ') : '';\r\n      } else if (omit_info) omit_info.childNodes[0].textContent = 'Showing all posts.'; //if (omit_info && posts_old) posts_old[0].pn.removeChild(omit_info);\r\n      return omit_info;\r\n    },\r\n    update_posts_remove: function(th_old,i,pnode,merge){\r\n      pnode = pnode.getElementsByClassName('thread_body')[0];\r\n      var tgt = th_old.posts[i].pn;\r\n      if (!merge || tgt.parentNode!==pnode) tgt = tgt.parentNode.parentNode.parentNode;\r\n      else this.update_posts_insert_pack(tgt);\r\n      if (tgt.previousSibling && tgt.previousSibling.tagName==='A') pnode.removeChild(tgt.previousSibling); // <a>\r\n      pnode.removeChild(tgt);\r\n    },\r\n    update_posts_insert: function(src,dst,i,j,pnode){\r\n      var ref = dst[j];\r\n//      var ref = dst[(j<dst.length)? j : dst.length-1];\r\n      ref = (ref)? ref.pn : null;\r\n      var ref_pnode2 = ref && ref.parentNode && ref.parentNode.parentNode && ref.parentNode.parentNode.parentNode;\r\n      if (ref_pnode2 && ref_pnode2.parentNode && ref_pnode2.parentNode.parentNode===pnode) ref = ref_pnode2; // remove container\r\n//      if (j>=dst.length) ref = ref && ref.nextSibling && ref.nextSibling.nextSibling || null;\r\n      if (!src[i].pn) src[i].pn = this.post_json2html(src[i],src[i].board);\r\n      if (i===0) this.update_posts_insert_pack(src[0].pn);\r\n      if (j===0 && ref) this.update_posts_insert_pack(dst[0].pn);\r\n      var tgt = (j===0 && i===0)? src[i].pn : this.post_container(src[i].pn,src[i].no); // patch for thread merging.\r\n      this.update_posts_insert_1(tgt,src[i].no,ref,pnode);\r\n      if (i===0 && j===0) this.update_posts_insert_unpack(src[0].pn);\r\n    },\r\n    update_posts_insert_1: function(tgt,no,ref,pnode){\r\n      pnode = pnode.getElementsByClassName('thread_body')[0];\r\n      var pn_a = document.createElement('a');\r\n      pn_a.setAttribute('name',no);\r\n      pnode.insertBefore(pn_a,ref);\r\n      pnode.insertBefore(tgt, ref);\r\n    },\r\n    update_posts0_class: site2['vichan'].update_posts0_class,\r\n    update_posts_insert_pack: site2['vichan'].update_posts_insert_pack,\r\n    update_posts_insert_pack_iter: function(pn, func){\r\n      var prev = pn.previousSibling;\r\n      while (prev) {\r\n        var prev_prev = prev.previousSibling; // prev is livelist.\r\n        if (prev.classList && (prev.classList.contains(pref.script_prefix+'_footer') || prev.classList.contains('file_thread') || prev.classList.contains('post_header'))) func(prev);\r\n        if (prev.classList &&  prev.classList.contains('postbody')) break;\r\n        prev = prev_prev;\r\n      }\r\n    },\r\n    update_posts_insert_unpack: function(pn){\r\n      while (1) {\r\n        var fchild = pn.firstChild;\r\n        if (fchild && fchild.classList && (fchild.classList.contains(pref.script_prefix+'_footer') || fchild.classList.contains('file_thread') || fchild.classList.contains('post_header'))) pn.parentNode.insertBefore(fchild, pn);\r\n        else break;\r\n      }\r\n    },\r\n    post_container : function(post_pn,no) {\r\n      var pn = document.createElement('table');\r\n      pn.innerHTML = '<tbody><tr><td valign=\"top\">&gt;&gt;</td></tr></tbody>';\r\n      pn.childNodes[0].childNodes[0].appendChild(post_pn);\r\n      return pn;\r\n    },\r\n\r\n\r\n\r\n\r\n    catalog_json2html3 : function(obj,board,thumb_url, make_footer) {\r\n      var th = document.createElement('article');\r\n      th.setAttribute('class','thread teaser');\r\n      th.setAttribute('id','thread-'+obj.no);\r\n      var post_flag = null;\r\n      if (obj.flags && obj.flags[0]) {\r\n//        post_flag = obj.flags[0].cloneNode(false);\r\n        post_flag = document.importNode(obj.flags[0],false);\r\n        post_flag.setAttribute('class','post_country');\r\n      }\r\n//      th.innerHTML = '<a href=\"http://boards.4chan.org' + obj.board + 'thread/' + obj.no + ((obj.sub)? '/'+obj.sub.replace(/ /,'-') : '') + '\">' + // cause direct jump\r\n\r\n        th.innerHTML =\r\n//          '<article tabindex=\"0\" id=\"thread_' + obj.no + '\" class=\"thread teaser\">'+\r\n            '<article class=\"thread_OP\" id=\"' + obj.no + '\">'+\r\n              '<div class=\"post\">'+\r\n                '<header>'+\r\n                  '<a><h1>'+\r\n                    ((post_flag)? post_flag.outerHTML : '') + \r\n//                    '<img class=\"post_country\" src=\"http://krautchan.net/images/balls/kz.png\" style=\"cursor:pointer\" name=\"KC/catalog/01234567\">/+\r\n                        ((obj.sub)? obj.sub : '#'+obj.no )+ \r\n//                        obj.sub + \r\n                  '</h1></a>'+\r\n                '</header>'+\r\n                '<div class=\"post_body\">'+\r\n                  '<a>'+\r\n                    '<div class=\"post_files multiple\">'+\r\n                      '<figure>'+\r\n                        '<div class=\"thumbnail\">'+\r\n                          '<img src=\"' + obj.op_img_url + '\">'+\r\n                        '</div>'+\r\n                      '</figure>'+\r\n                      ((obj.op_img_url2 && obj.op_img_url2[0])? (\r\n                        '<figure>'+\r\n                          '<div class=\"thumbnail\">'+\r\n                            '<img src=\"' + obj.op_img_url2[0] + '\">'+\r\n                          '</div>'+\r\n                        '</figure>'+\r\n                        ((obj.op_img_url2 && obj.op_img_url2[1])? (\r\n                          '<figure>'+\r\n                            '<div class=\"thumbnail\">'+\r\n                              '<img src=\"' + obj.op_img_url2[1] +'\">'+\r\n                            '</div>'+\r\n                          '</figure>'+\r\n                          ((obj.op_img_url2 && obj.op_img_url2[2])? (\r\n                            '<figure>'+\r\n                              '<div class=\"thumbnail\">'+\r\n                                '<img src=\"' + obj.op_img_url2[2] + '\">'+\r\n                              '</div>'+\r\n                            '</figure>') :\r\n                          '')) :\r\n                       '')) : '') +\r\n                    '</div>'+\r\n                  '</a>'+\r\n                  '<div class=\"omittedposts\">'+\r\n                    '<span class=\"omitted_text\">'+(make_footer? 'R: 0 / I: 0 / P: 0.0&emsp;/catalog/':'')+'</span>'+\r\n                  '</div>'+\r\n                  '<div class=\"post_text\"><section>'+\r\n                    obj.com +\r\n                  '</section></div>'+\r\n                '</div>'+\r\n              '</div>'+\r\n            '</article>';\r\n//          '</article>';\r\n      var tns = th.getElementsByClassName('thumbnail');\r\n      tns[0].childNodes[0].addEventListener('load',site2['KC'].catalog_json2html3_onload,false);\r\n      return th;\r\n    },\r\n    catalog_json2html3_onload : function() {\r\n      this.removeEventListener('load',site2['KC'].catalog_json2html3_onload,false);\r\n      var w = this.naturalWidth;\r\n      var h = this.naturalHeight;\r\n      var f = ((w>h)? w : h) / 200;\r\n      this.setAttribute('width', w/f);\r\n      this.setAttribute('height', h/f);\r\n    },\r\n    favicon : {\r\n      __proto__: site2['DEFAULT'].favicon,\r\n      none: '/favicon.ico',\r\n      reply: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAKJJREFUOE9jZPh/hgECfv4yts59/PgxlAujZGVlzx6dzMDOBhMAaoCjtEA01SAuUBBZDQrnwEwsGoCCKBp+HEPwPx6QkZFB1gPifjyAUABUbGxsDLIUaAxEItQFxRIgFygIlAIqSAsEKYYDkGGhLpaWlsgaQNxQFxRrxcTEsLgbhxBI8SDUQLKnSQ9WUiOO9KRBfuL7cQzoH2C0oAGQJ5GcDQBwM6RhinByrgAAAABJRU5ErkJggg==',\r\n      reply_to_me: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAMxJREFUOE9jZPh/hgECfv4yts59/PgxlAujZGVlzx6dzMDOBhMAavh/5j8MoKkGcdMCQYbCEYSFT8OBmagafhxD1iAjI4NsCYj78QBCA1CxsbEx0FKEDaEuKK4CcoFOAOoB2pMWCFIMAXANlpaWyBpA3FAXFGvFxMSQNWDxNJIQSDFEA5EAoQFfKGG1gQQNcP0gn4W6EPY0JFhBoQYJb8LBCo44KPp4gHDEoUQ70B5MgJ40kBMW0G2YAGviA9nz4xjQP8CQRgMgTyI5GwD2xdfU779fsgAAAABJRU5ErkJggg=='\r\n    },\r\n    add_backlinks: function(pn,backlinks,target,th){}, // dummy\r\n  };\r\n}\r\nif (pref.features.domains['4chan'] || pref.features.domains['meguca']) {\r\n  site2['4chan_i'] = {\r\n    home:undefined,\r\n    nickname:'4chan_i',\r\n    nickname_href2domain:'4chan',\r\n    domain_url: 'i.4cdn.org',\r\n    check_func: site2['DEFAULT'].check_func,\r\n    proto:'4chan'\r\n  };\r\n  site2['4chan'] = {\r\n    nickname : '4chan',\r\n//    home : site.protocol + '//boards.4chan.org/int/',\r\n    home : site.protocol + '//boards.4chan.org/favicon.ico',\r\n    protocol: 'http:',\r\n    make_tack: function(){\r\n      var tack = document.createElement('img');\r\n      tack.setAttribute('src','//s.4cdn.org/image/sticky.gif');\r\n      tack.setAttribute('class','stickyIcon retina');\r\n      return tack;\r\n    },\r\n    postform_rules: null,\r\n    postform: {\r\n//      init:function(){\r\n//        this.tack = site2[site.nickname].make_tack();\r\n//        this.tack.setAttribute('style','float:right;font-size:2em;');\r\n//        site.postform.parentNode.insertBefore(this.tack,site.postform);\r\n//        return this.tack;\r\n//      },\r\n      activation: function(){\r\n        document.getElementById('togglePostFormLink').getElementsByTagName('a')[0].click();\r\n        this.activation = null;\r\n      },\r\n      __proto__:site2['DEFAULT'].postform\r\n    },\r\n    features : {uip_tracker: true},\r\n    components: {\r\n      boardlist: '.boardList',\r\n      postform_comment: 'textarea[name=\"com\"]',\r\n      postform_submit: 'input[type=\"submit\"]',\r\n      postform_comment2: ['textarea[name=\"com\"]',1],\r\n      postform_submit2: ['input[type=\"submit\"]',2],\r\n    },\r\n    spoiler_text: {\r\n      open_rule: 's,s a:not(:hover) {color: #fff!important;}',\r\n    },\r\n    general_event_handler:(function(){\r\n      var obj = {\r\n        thread: {\r\n////          last_viewed: function(e){return e.target.classList && e.target.classList.contains('post');}, // working code, but not used.\r\n////          get_next_mark: function(pn){\r\n////            var parent_next = pn.parentNode && pn.parentNode.nextSibling;\r\n////            if (parent_next.tagName==='SPAN') parent_next = parent_next.nextSibling;\r\n////            var next_post = parent_next && parent_next.getElementsByClassName('post')[0];\r\n////            if (!next_post) {\r\n////              var parent_parent_next = pn.parentNode.parentNode.nextSibling;\r\n////              next_post = parent_parent_next.getElementsByClassName('post')[0];\r\n////            }\r\n////            return next_post;\r\n////          },\r\n////          get_prev_mark: function(pn){\r\n////            var parent_prev = pn.parentNode && pn.parentNode.previousSibling;\r\n////            if (parent_prev.tagName==='SPAN') parent_prev = parent_prev.previousSibling;\r\n////            var prev_post = parent_prev && parent_prev.getElementsByClassName('post')[0];\r\n////            if (!prev_post) {\r\n////              var parent_parent_prev = pn.parentNode.parentNode.previousSibling;\r\n////              prev_post = parent_parent_prev.getElementsByClassName('post')[0];\r\n////            }\r\n////            return prev_post;\r\n////          },\r\n          get_mark: function(pn, clientY){\r\n            while (pn && pn!== cataLog.parent) {\r\n              if (pn.classList.contains('post')) return pn;\r\n              if (pn.classList.contains('postContainer')) return pn.getElementsByClassName('post')[0];\r\n              if (pn.parentNode && pn.parentNode.classList.contains('thread')) {\r\n                pn = pn.previousSibling;\r\n                if (pn) continue;\r\n                else break;\r\n              }\r\n              if (pn.classList.contains('thread')) break;\r\n              pn = pn.parentNode;\r\n            }\r\n            return this.get_mark_from_height(clientY);\r\n          },\r\n          get_mark_from_height: function(now_height){\r\n            return this.__proto__.get_mark_from_height(now_height, document.getElementsByClassName('post'));\r\n          },\r\n          image_hover_check_mode: function(img){\r\n            return img.parentNode.classList.contains('fileThumb')? 'page' : 'catalog';\r\n          },\r\n          getID: function(pn){return pn.classList.contains('hand') && pn.textContent;},\r\n          getCountry: function(pn){\r\n            return pn.classList.contains('flag') && pn.getAttribute('class').replace(/\\s*flag\\-*/g,'').toUpperCase() ||\r\n              pn.className==='countryFlag' && pn.getAttribute('alt').toLowerCase();}, // lower case for troll flag\r\n          getTrip: function(pn){return pn.classList.contains('postertrip') && pn.textContent;},\r\n          __proto__: site2['DEFAULT'].general_event_handler.common,\r\n        },\r\n      };\r\n//      obj.catalog = { // working code\r\n//        mouseover: function(e){\r\n//          var et = e.target;\r\n//          var et_tagName = et.tagName;\r\n//          if (et_tagName==='IMG')\r\n//            if (pref[cataLog.embed_mode].image_hover && et.parentNode.tagName==='A') cataLog.image_hover_add.call(et, e);\r\n//        },\r\n//        __proto__:obj.thread\r\n//      };\r\n      obj.catalog = Object.create(obj.thread);\r\n      obj.page = Object.create(obj.thread);\r\n      obj.archive = Object.create(obj.thread);\r\n      return obj;\r\n    })(),\r\n    domain_url: 'boards.4chan.org',\r\n    check_func : function(){\r\n      var href = window.location.href;\r\n      if (href.search(this.domain_url)===-1) return false;\r\n      site.whereami = (document.title.indexOf('404 Not Found')!=-1)? '404'\r\n                    : (href.search(/catalog/)!=-1)? 'catalog'\r\n                    : (href.search(/thread\\/[0-9]+/)!=-1)? 'thread'\r\n                    : (href.search(/archive/)!=-1)? 'archive'\r\n                    : (href.search(/\\/$|(index|[0-9]+)(\\.html)*|\\/#all$/)!=-1)? 'page'\r\n                    : 'other';\r\n      if (site.whereami==='thread') site.no = parseInt(href.replace(/.*thread\\/([0-9]+)/,'$1'),10);\r\n      site.config(this.domain_url,'4chan');\r\n      this.postform_prep();\r\n      site.max_page = site2['4chan'].max_page(site.board);\r\n      site.header_height = function(){\r\n        var header = document.getElementById('header');\r\n        return (header)? header.offsetHeight : 0;\r\n      }\r\n      site.embed_to = (site.whereami==='thread')? {\r\n        top:function(){return document.getElementsByClassName('navLinks')[0];},\r\n        bottom:function(){return document.getElementsByClassName('bottomad')[0] || document.getElementById('boardNavDesktopFoot');}\r\n//          site.embed_to['bottom'] = document.getElementsByClassName('bottomad')[0];\r\n      } : (site.whereami==='page')? {\r\n        top:function(){return document.getElementById('ctrl-top');},\r\n//          site.embed_to['bottom'] = document.getElementsByClassName('board')[0].nextSibling; // fail\r\n        bottom:function(){return document.getElementsByClassName('pagelist')[0];}\r\n      } : (site.whereami==='catalog')? {\r\n        top:function(){return document.getElementById('content').previousSibling;},\r\n        bottom:function(){return document.getElementsByClassName('navLinksBottom')[0].nextSibling;}\r\n      } : {};\r\n      site.postform = document.getElementsByClassName('postForm')[0];\r\n      return true;\r\n    },\r\n//    catalog_background : '#ffffee',\r\n    //    catalog_bordercolor : '#f0e0d6',\r\n    get_next_image: function(img,top){\r\n      var imgs = cataLog.parent.querySelectorAll('img[data-md5]');\r\n      var idx = Array.prototype.indexOf.call(imgs,img);\r\n      if (idx==-1) idx = Array.prototype.indexOf.call(imgs,img.previousSibling);\r\n      if (top) while (imgs[idx+1] && imgs[idx+1].offsetTop<top) idx++;\r\n      if (idx>=0) {\r\n        while (imgs[idx+1] && imgs[idx+1].parentNode.getAttribute('href').search(/\\.webm$/)!=-1) idx++;\r\n        return imgs[idx+1];\r\n      } else return null;\r\n    },\r\n    format_expanded_thumbnail: function(img){\r\n      img.removeAttribute('data-md5');\r\n      img.className = 'expanded-thumb';\r\n    },\r\n    catalog_threads_in_page : function(doc){return doc.getElementsByClassName('thread');},\r\n    catalog_posts_in_thread : function(doc){return doc.getElementsByClassName('replyContainer');},\r\n    max_page : function(){return 10;},\r\n    make_url4 : function(dbt, trim_page){ // dbt[2] is string.\r\n      var url_prefix  = site.protocol + '//' + this.domain_url  + dbt[1];\r\n      var url_prefix2 = site.protocol + '//' + 'a.4cdn.org' + dbt[1];\r\n      if (dbt[3]==='catalog_html' || (trim_page && dbt[2]==0 && dbt[3]==='page_json')) dbt[3] = 'catalog_json'; // catalog_html is a skelton.\r\n      return (dbt[3]==='page_json')?       [url_prefix2 + (parseInt(dbt[2],10)+1) + '.json', 'json', (trim_page)? '4chan'+dbt[1]+'j0' : undefined] : // dbt[2] is string.\r\n             (dbt[3]==='catalog_json')?    [url_prefix2 + 'catalog.json', 'json', '4chan'+dbt[1]+'j0'] :\r\n             (dbt[3]==='thread_json')?     [url_prefix2 + 'thread/' + dbt[2] + '.json', 'json'] :\r\n             (dbt[3]==='page_html')?       [url_prefix  + ((dbt[2]!=0)? (parseInt(dbt[2],10)+1) :''), 'html'] :\r\n             (dbt[3]==='thread_html')?     [url_prefix  + 'thread/' + dbt[2], 'html'] : null;\r\n    },\r\n    trim_list: 'force_init',\r\n//////////    make_url : function(board,no){return [site.protocol+'//boards.4chan.org' + board + ((no!=0)? (no+1) :''), 'html'];},  // worling code.\r\n//////////    make_url3: function(board,th){return  site.protocol+'//boards.4chan.org' + board + 'thread/' + th;},\r\n////////    make_url : function(board,no,key){\r\n////////      var url_prefix = site.protocol+'//boards.4chan.org' + board;\r\n////////      return (key==='p')? [url_prefix + ((no!=0)? (no+1) :''), 'html'] :\r\n////////                          [url_prefix + 'catalog.json'       , 'json']; // 4chan's html is skelton.\r\n//////////             (key==='j')? [url_prefix + 'catalog.json'       , 'json'] :\r\n//////////                          [url_prefix + 'catalog'            , 'html'];\r\n////////    },\r\n////////    make_url3: function(board,th){return site.protocol+'//boards.4chan.org' + board + 'thread/' + ((th[0]!=='t')? th : th.substr(1)+'.json');},\r\n    url_boards_json : function(){return [site.protocol+'//a.4cdn.org/boards.json', 'json'];},\r\n    archive_patch_domain: function(proto){\r\n      Object.defineProperty(proto,'domain_xhr',{get:function(){return (this.url.indexOf('i.4cdn.org/')===-1)? null : '4chan_i';}, configurable:true, enumerable:true});\r\n    },\r\n    get_ops : function(doc){\r\n      var ops = [];\r\n      var threads = doc.getElementsByClassName('thread');\r\n      for (var i=0;i<threads.length;i++) ops.push(threads[i].id.substring(1));\r\n      return ops;\r\n    },\r\n    get_posts : function(doc) {\r\n      var posts = [];\r\n      var post_containers = doc.getElementsByClassName('postContainer');\r\n      for (var i=0;i<post_containers.length;i++) posts.push(parseInt(post_containers[i].id.substring(2),10));\r\n      return posts;\r\n    },\r\n////////    get_thread_link : function(pn,bn,del){\r\n////////      var link = pn.getElementsByClassName('replylink')[0];\r\n////////      if (link) {\r\n//////////        if (del) link.parentNode.parentNode.removeChild(link.parentNode);\r\n////////        if (del) {\r\n////////          link.parentNode.removeChild(link.nextSibling);\r\n////////          link.parentNode.removeChild(link.previousSibling);\r\n////////          link.parentNode.removeChild(link);\r\n////////        } else if (pref.catalog_open_in_new_tab) link.setAttribute('target','_blank');\r\n////////        return link.getAttribute('href');\r\n////////      } else return null;\r\n////////    },\r\n    modify_thread_link : function(pn){\r\n      var link = pn.getElementsByClassName('replylink')[0];\r\n      if (link) {\r\n        var href = link.getAttribute('href');\r\n        link.removeAttribute('href');\r\n        return [[link, href]];\r\n      } else return [];\r\n    },\r\n//    add_thread_link : function(doc,url){\r\n////      <a href=\"thread/32599218/finland-general\" class=\"replylink\" rel=\"canonical\">Reply</a>\r\n//      var pn = document.createElement('a');\r\n//      var prefix = new RegExp('https*://boards\\.4chan\\.org/[^/]*/');\r\n//      pn.href = url.replace(prefix,'');\r\n//      pn.className = 'replylink';\r\n//      pn.rel = 'canonical';\r\n//      pn.innerHTML = 'Reply';\r\n//      var th = doc.getElementsByClassName('thread')[0];\r\n//      if (th) {\r\n//        th.insertBefore(pn,th.firstChild);\r\n//        th.insertBefore(document.createTextNode('['),pn);\r\n//        th.insertBefore(document.createTextNode(']'),pn.nextSibling);\r\n//      }\r\n//    },\r\n    check_thread_archived : function(th){\r\n      return (th.getElementsByClassName('archivedIcon').length!=0);\r\n    },\r\n//    get_time_of_posts : function(doc){\r\n//      var posts = doc.getElementsByClassName('postContainer');\r\n//      var last_post = posts[posts.length-1];\r\n//      return [(parseInt(posts[posts.length-1].getElementsByClassName('dateTime')[0].getAttribute('data-utc'),10)- pref.localtime_offset*3600)*1000,\r\n//              (parseInt(posts[0             ].getElementsByClassName('dateTime')[0].getAttribute('data-utc'),10)- pref.localtime_offset*3600)*1000];\r\n//    },\r\n//    get_time_of_posts : function(th){ // working code.\r\n//      var posts = th.getElementsByClassName('postContainer');\r\n//      return [site2['4chan'].get_time_of_post_in_utc(posts[posts.length-1]),site2['4chan'].get_time_of_post_in_utc(posts[0])];\r\n//    },\r\n//    get_time_of_post_in_utc : function(post){ // working code\r\n//      return parseInt(post.getElementsByClassName('dateTime')[0].getAttribute('data-utc'),10)*1000;\r\n//    },\r\n    mark_newer_posts: function(th,date,unmark, short_cut) {\r\n      return site2['DEFAULT'].mark_newer_posts('4chan',th.getElementsByClassName('postContainer'),date,function(post){return post.getElementsByClassName('post')[0];}, unmark, short_cut);\r\n//      return site2['DEFAULT'].mark_newer_posts('4chan',th.getElementsByClassName('postContainer'),date,function(post){return post.getElementsByClassName('post reply')[0];}, unmark, short_cut);\r\n    },\r\n    localtime: function(pn){\r\n      var times = pn.getElementsByClassName('dateTime');\r\n      for (var i=0;i<times.length;i++) times[i].textContent = site2.common.change_utc_to_local(parseInt(times[i].getAttribute('data-utc'),10)*1000);\r\n    },\r\n    remove_files_info : function(th){\r\n      site2.common.remove_by_classname(th,'fileText');\r\n      site2.common.remove_by_classname(th,'mFileInfo');\r\n      var filethumbs = th.getElementsByClassName('fileThumb');\r\n      for (var i=0;i<filethumbs.length;i++) site2.common.move_up_and_delete_parent([filethumbs[i].childNodes[0]]);\r\n    },\r\n//    remove_checkboxes : function(doc){\r\n//      var cbxs = doc.getElementsByTagName('input');\r\n//      for (var i=cbxs.length-1;i>=0;i--) cbxs[i].outerHTML = '';\r\n//      return doc;\r\n//    },\r\n    remove_posts : function(th,end){\r\n      site2.common.remove_by_classname(th,'postContainer replyContainer',end,true);\r\n//      site2.common.remove_double_br(th);\r\n    },\r\n//    absolute_link : site2['DEFAULT'].absolute_link.bind({protocol:'http:',domain_url:'http://boards.4chan.org'}), // working code.\r\n////    absolute_link : function(doc,board){\r\n////      var url_prefix = 'http://boards.4chan.org';\r\n////      var protocol   = 'http:';\r\n////      var all = doc.getElementsByTagName('*');\r\n////      for (var i=0;i<all.length;i++) {\r\n////        if (all[i].getAttribute('src')) \r\n////          if (all[i].getAttribute('src').substr(0,2)!='//') all[i].setAttribute('src', url_prefix+board+all[i].getAttribute('src'));\r\n////          else all[i].setAttribute('src', protocol+all[i].getAttribute('src'));\r\n////        if (all[i].getAttribute('href'))\r\n////          if (all[i].getAttribute('href').substr(0,2)!='//') all[i].setAttribute('href',url_prefix+board+all[i].getAttribute('href'));\r\n////          else all[i].setAttribute('href',protocol+all[i].getAttribute('href'));\r\n////      }\r\n////    },\r\n////////    insert_footer : function(th,page_no,bn,exe,date,nof_posts,nof_files){\r\n////////      var key = (!brwsr.ff)? 'innerText' : 'innerHTML';\r\n////////      nof_posts += th.getElementsByClassName('postContainer').length;\r\n////////      nof_files += th.getElementsByClassName('fileText').length;\r\n////////      var om_info = th.getElementsByClassName('summary desktop');\r\n////////      if (om_info[0]) {\r\n////////        var str = om_info[0][key].replace(/\\n/g,'');\r\n////////        nof_posts += parseInt(str.replace(/\\ post.*/,''),10);\r\n////////        nof_files += parseInt('0'+str.replace(/\\ image.*/,'').replace(/[^\\ ]*\\ /g,''),10);\r\n////////      }\r\n////////      if (exe) {\r\n////////        var pn = document.createElement('div');\r\n////////        pn.setAttribute('name','catalog_footer');\r\n////////        pn.innerHTML = '<span>' + bn + '  ' + nof_posts + '/' + nof_files + '/' + page_no + '  </span>';\r\n////////        var flags = th.getElementsByClassName('flag');\r\n////////        for (var i=0;i<flags.length;i+=2) { // contains both mobile and desktop.\r\n////////          pn.appendChild(flags[i].cloneNode(false));\r\n//////////          pn.appendChild(document.createTextNode(' '));\r\n////////        }\r\n////////        var op_info = th.getElementsByClassName('postInfo desktop')[0];\r\n////////        op_info.parentNode.insertBefore(pn,op_info);\r\n////////      }\r\n////////      return [nof_posts,nof_files];\r\n////////    },\r\n    format_thread_layout : function(th){\r\n      site2.common.add_attribute_by_classname(th,'post op','style','padding:0px');\r\n//      site2.common.add_attribute_by_classname(th,'file','style','float:left');\r\n      site2.common.add_attribute_by_tagname(th,'blockquote','style','margin:12px 5px');\r\n    },\r\n    format_thread_contents : function(th){\r\n      site2.common.remove_by_tagname(th,'input');\r\n      site2.common.remove_by_classname(th,'mobile');\r\n//      site2.common.remove_by_classname(th,'postLink mobile');\r\n//      site2.common.remove_by_classname(th,'postInfoM mobile');\r\n      site2.common.remove_by_classname(th,'sideArrows');\r\n      site2.common.remove_by_classname(th,'summary');\r\n    },\r\n////////    thread2headline : function(doc){\r\n////////      return site2.common.thread2headline(doc,'4chan');\r\n////////    },\r\n//    get_json_url_thread: function(board,thread){\r\n//      return site.protocol + '//a.4cdn.org' + board +'thread/' + thread + '.json';\r\n//    },\r\n    get_json_url_catalog: function(board){\r\n      return site.protocol + '//a.4cdn.org' + board +'catalog.json';\r\n    },\r\n    uip_check: function(callback, callback_sage){\r\n//      var dbt = [site.nickname,site.board,site.no,(pref.uip_tracker.sage.detect)? 'catalog_json' : 'thread_json']; // catalog doesn't contain 'unique_ips'\r\n      var dbt = [site.nickname,site.board,site.no,'thread_json']; // [site.protocol + '//a.4cdn.org' + site.board +'thread/' + site.no + '.json', 'json'];\r\n      http_req.get('uip',dbt.join(),'',callback,false,false);\r\n      if (pref.uip_tracker.sage.detect) {\r\n        dbt[3] = 'catalog_json';\r\n        http_req.get('sage_detection',dbt.join(),'',this.sage_detect,false,false, callback_sage);\r\n      }\r\n    },\r\n    sage_detect: function(key,value, callback){\r\n      var dbt = key.split(',');\r\n      var ths = site2['4chan'].wrap_to_parse.get(value.response, dbt[0], dbt[1], dbt[3], {page:0});\r\n      var obj = site2['4chan'].parse_funcs['catalog_json'].add_sage(ths, site.no);\r\n      callback(obj);\r\n    },\r\n    sage_detect_all: function(ths){\r\n      this.parse_funcs['catalog_json'].add_sage(ths, null);\r\n      for (var i=0;i<ths.length;i++) {\r\n        var posts = ths[i].posts;\r\n        var lth = liveTag.mems.init(ths[i]); // ths[i].lth;\r\n        for (var j=0;j<posts.length;j++) {\r\n          if (posts[j].email==='sage') {\r\n            if (!lth.sg) lth.sg = new Set();\r\n            lth.sg.add(posts[j].no);\r\n          }\r\n        }\r\n        if (pref.catalog.page_his) { // qeuivalent to show_page in uip_tracker\r\n          if (!lth.pgh) lth.pgh = {};\r\n          var pgh = lth.pgh;\r\n          var no = ths[i].posts[ths[i].posts.length-1].no;\r\n          if (!pgh[no]) pgh[no] = [i];\r\n          else this.page_his_update(pgh[no],i);\r\n        }\r\n      }\r\n    },\r\n    page_his_update: function(pgh,page){\r\n      var lastPage = pgh[pgh.length-1];\r\n      if (lastPage!=page) pgh[pgh.length - (pgh.length>=3 && pgh.length%2===1? 0 : pgh.length>1 && lastPage<page? 1:0)] = page;\r\n      return lastPage!=page;\r\n    },\r\n    parse_json_thread: function(obj,from_http){\r\n      if (from_http) {\r\n//        var obj = JSON.parse(txt);\r\n        obj.posts[obj.posts.length-1]['unique_ips'] = obj.posts[0]['unique_ips'];\r\n        return obj;\r\n      } else {\r\n        var obj = {posts: []};\r\n        var uids = {};\r\n        var nof_uids = 0;\r\n        var posts = document.getElementsByClassName('postContainer');\r\n        for (var i=0;i<posts.length;i++) {\r\n          obj.posts[i] = {};\r\n          obj.posts[i].no = posts[i].id.replace(/pc/,'');\r\n          var id = posts[i].getElementsByClassName('posteruid')[0];\r\n          if (id) {\r\n            id = id.textContent;\r\n            obj.posts[i].id = id;\r\n            if (uids[id]===undefined) {\r\n              nof_uids++;\r\n              uids[id] = 1;\r\n            }\r\n          }\r\n          obj.posts[i].unique_ips = nof_uids;\r\n        }\r\n//        obj.posts[posts.length-1].unique_ips = document.getElementById('unique-ips').textContent; // not refreshed.\r\n        obj.posts[posts.length-1].unique_ips = 0;\r\n        return obj;\r\n      }\r\n    },\r\n    uip_tgt_post : function(no){\r\n      return document.getElementById('p'+no);\r\n//      return document.getElementById('pc'+no);\r\n    },\r\n    uip_post_num : function(tgt_post){\r\n      return tgt_post.getElementsByClassName('postNum');\r\n    },\r\n    prep_own_posts_reg: /^4chan\\-track\\-[0-9A-z]+\\-[0-9]+$/,\r\n    prep_own_posts_event : function(e){\r\n      if (e) if (site2['4chan'].prep_own_posts_1(e.key)) e = null;\r\n      if (window.name==='4chan' && !e) send_message('parent',['OWN_POSTS', window.name, site3[window.name].own_posts]);\r\n    },\r\n    prep_own_posts : function(bt){\r\n      site3[this.nickname].own_posts = {};\r\n      if (localStorage) {\r\n        var keys = (bt)? [('4chan-track'+bt).replace(/\\//g,'-')] :\r\n                         Object.keys(localStorage || '{}');\r\n        for (var i=0;i<keys.length;i++) this.prep_own_posts_1(keys[i]);\r\n      }\r\n//console.log(site3[this.nickname].own_posts);\r\n    },\r\n    prep_own_posts_1 : function(key){\r\n      if (this.prep_own_posts_reg.test(key)) {\r\n        var board = '/' + key.replace(/^4chan\\-track\\-/,'').replace(/\\-[0-9]+$/,'') + '/';\r\n        if (!site3[this.nickname].own_posts[board]) site3[this.nickname].own_posts[board] = {};\r\n        var nos = JSON.parse(localStorage[key] || '{}');\r\n        for (var j in nos) site3[this.nickname].own_posts[board][j.substr(2)] = null;\r\n        return true;\r\n      }\r\n      return false;\r\n    },\r\n\r\n    catalog_native_prep: function(date,pn_filter,pn_tb,pn_hi){\r\n      var node_ref = (site.whereami==='catalog')? document.getElementById('ctrl') :\r\n                                                  document.getElementById('ctrl-top');\r\n      if (site.whereami==='thread' || !node_ref) { // !node_ref for 4chan-X v1.13.8.7\r\n        var node_ref = document.getElementsByClassName('navLinks');\r\n        for (var i=0;i<node_ref.length;i++)\r\n          if (window.getComputedStyle(node_ref[i]).display!=='none') {node_ref = node_ref[i]; break;}\r\n      }\r\n//      pn_tb.setAttribute('style', 'float:right');\r\n      site2['DEFAULT'].catalog_native_prep_sel(pn_filter,pn_tb,site.whereami==='catalog'? document.getElementById('order-ctrl') : null);\r\n      if (site.whereami==='catalog') {\r\n        document.getElementById('size-ctrl').addEventListener('change', site2['4chan'].catalog_native_size_changed, false);\r\n\r\n////        var fl = document.getElementById('filters-ctrl'); // working code.\r\n////        fl.parentNode.setAttribute('style','display:none');\r\n////        var qf2 = this.catalog_native_prep_clonenode(document.getElementById('qf-box'));\r\n//////        var qf = document.getElementById('qf-box');\r\n//////        var qf2= qf.cloneNode();\r\n//////        qf2.name = 'CatChan_qf2';\r\n//////        qf.parentNode.insertBefore(qf2,qf.nextSibling);\r\n//////        qf.setAttribute('style','display:none');\r\n////        var kwd_str = document.getElementsByName('catalog.filter.kwd.str')[0];\r\n////        if (kwd_str.value!=='') {\r\n////          kwd_str.value = '';\r\n////          pref_func.apply_prep(kwd_str,true,true);\r\n////        }\r\n////        qf2.onkeyup = function(){\r\n////          pref.catalog.filter.kwd.str = this.value;\r\n////          pref_func.apply_prep(kwd_str,false);\r\n////          kwd_str.onkeyup();\r\n////        }\r\n////        var qfctrl = this.catalog_native_prep_clonenode(document.getElementById('qf-ctrl'),true);\r\n////        qfctrl.onclick = function(){\r\n////          var qf_cnt = document.getElementById('qf-cnt');\r\n////          if (qf_cnt.style.display==='none') qf_cnt.style.display = 'inline';\r\n////          else {\r\n////            qf_cnt.style.display = 'none';\r\n////            qf2.value = '';\r\n////            qf2.onkeyup();\r\n////          }\r\n////        }\r\n////        var qfc = this.catalog_native_prep_clonenode(document.getElementById('qf-clear'),true);\r\n////        qfc.onclick = function(){\r\n////          qfctrl.onclick();\r\n////        }\r\n        pref3.catalog.filter.kwd.init(document.getElementById('qf-box'), pn_filter).id = null;\r\n//        var qf = document.getElementById('qf-box');\r\n//        var qf2 = qf.cloneNode(false);\r\n//        qf2.name = 'catalog.filter.kwd.str';\r\n//        qf2.id = null;\r\n//        qf2.oninput = cataLog.event_func;\r\n//        qf.parentNode.insertBefore(qf2,qf);\r\n//        qf.setAttribute('style','display:none');\r\n//        pref3.catalog.filter.kwd.obj = [pn_filter.getElementsByTagName('input')['catalog.filter.kwd.str'], qf2];\r\n        var clear_func = pref3.catalog.filter.kwd.clear.bind(pref3.catalog.filter.kwd);\r\n        document.getElementById('qf-ctrl').addEventListener('click',clear_func,false);\r\n        document.getElementById('qf-clear').addEventListener('click',clear_func,false);\r\n//        clear_func();\r\n\r\n//        var pn_tb_new = document.createElement('span');\r\n//        while (pn_tb.firstChild) pn_tb_new.appendChild(pn_tb.firstChild);\r\n//        pn_tb = pn_tb_new;\r\n//        pn_tb.appendChild(pn_tb.removeChild(pn_tb.childNodes[3]).firstChild);\r\n      } else if (site.whereami==='page') {\r\n//        var pctrls = document.getElementsByClassName('board')[0]; // test patch\r\n//        for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.removeChild(pctrls.childNodes[i]);\r\n//        pctrls.parentNode.insertBefore(document.createElement('hr'),pctrls.nextSibling);\r\n      }\r\n//      node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n      node_ref.appendChild(pn_tb);\r\n//      node_ref.parentNode.insertBefore(pn_filter,node_ref);\r\n////////      return site2['4chan'].catalog_from_native(date,document,site.board,site.whereami+'_html');\r\n      if (site.whereami==='archive') {\r\n        styleSheet.register('.'+pref.script_prefix+'_threads','padding:20px 0;text-align:center;');\r\n        styleSheet.register('.'+pref.script_prefix+'_threads>.thread','width:180px;max-height:320px;vertical-align:top;display:inline-block;word-wrap:break-word;overflow:hidden;margin-top:5px;margin-bottom:20px;padding:5px 0 3px;position:relative;');\r\n      }\r\n    },\r\n    catalog_native_prep_clonenode : function(node,deep) {\r\n      var cn = node.cloneNode(deep);\r\n      cn.setAttribute('name',((cn.name)? cn.name : 'clone_node') + '_CatChan');\r\n      node.parentNode.insertBefore(cn,node.nextSibling);\r\n      node.setAttribute('style','display:none');\r\n      return cn;\r\n    },\r\n////////    catalog_from_native : function(date,doc,board,type) { // working code.\r\n////////      return this.wrap_to_parse.get(doc, this.nickname, board, type);\r\n////////    },\r\n//    catalog_from_native : function(date,doc,board,type) { // working code.\r\n//      var parse_obj = {domain:'4chan', board:board, parse_funcs:site2['4chan'].parse_funcs[type], __proto__:site4.parse_funcs_on_demand};\r\n//      var ths = {pn:doc, __proto__:parse_obj};\r\n//      return ths.ths;\r\n//    },\r\n    catalog_get_native_area: function(){\r\n      if (site.whereami==='archive') {\r\n        var arc = document.getElementById('arc-list');\r\n        var div = document.createElement('div');\r\n        div.setAttribute('class',pref.script_prefix+'_threads');\r\n        arc.parentNode.insertBefore(div,arc);\r\n        var btn = document.createElement('button');\r\n        btn.textContent= 'More threads';\r\n        arc.parentNode.insertBefore(btn,arc);\r\n        btn.onclick = function(){\r\n          cataLog.insert_myself(null,null,true);}; // argument init is a patch for patch, should be removed.\r\n        return div;\r\n      }\r\n      return (site.whereami==='catalog')? document.getElementById('threads') : document.getElementsByClassName('board')[0];\r\n    },\r\n    catalog_native_size: (document.getElementById('size-ctrl'))? document.getElementById('size-ctrl').value : 'small',\r\n    catalog_native_size_changed: function(){\r\n      site2['4chan'].catalog_native_size = this.value;\r\n      var threads = catalog_obj.catalog_func().get_threads();\r\n      for (var name in threads) if (threads[name][0]) site2['4chan'].catalog_json2html3_size_changed(threads[name][0].getElementsByTagName('img')[0]);\r\n      catalog_obj.catalog_func().show_catalog();\r\n    },\r\n    parse_funcs : { // 4chan\r\n      'catalog_html' : {\r\n        ths: 'thread_html',\r\n//        th_init: function(th) {\r\n//          th.pn.getElementsByTagName('a')[0].addEventListener('click',th.parse_funcs.preventDefault,false);\r\n//        },\r\n//        th_destroy: function(pn, parse_funcs){\r\n//          pn.getElementsByTagName('a')[0].removeEventListener('click',parse_funcs.preventDefault,false);\r\n//        },\r\n//        ths: function(doc) {\r\n//          var ths = this.ths_array(doc,doc.pn.getElementsByClassName('thread'));\r\n//          for (var i=0;i<ths.length;i++)\r\n//            ths[i].pn.getElementsByTagName('a')[0].removeAttribute('href');\r\n//          return ths;\r\n//        },\r\n        no : function(th){return parseInt(th.pn.getAttribute('id').substr(7),10);},\r\n        time_bumped: function(th){return 0;},\r\n        time_created : function(th){return 0;},\r\n        nof_posts: function(th){\r\n          var tmp = th.footer.textContent.match(/[0-9]+/g);\r\n          var nof_files = tmp && tmp[1] && parseInt(tmp[1],10)+1 || 1;\r\n          Object.defineProperty(th, 'nof_files', {value:nof_files, enumerable:true, writable:true, configurable:true});\r\n          return tmp && parseInt(tmp[0],10)+1 || 1;\r\n        },\r\n        nof_files: function(th){\r\n          var tmp = th.footer.textContent.match(/[0-9]+/g);\r\n          var nof_posts = tmp && parseInt(tmp[0],10)+1 || 1;\r\n          Object.defineProperty(th, 'nof_posts', {value:nof_posts, enumerable:true, writable:true, configurable:true});\r\n          return tmp && tmp[1] && parseInt(tmp[1],10)+1 || 1;\r\n        },\r\n        sub: function(th){\r\n          var ts = th.pn.getElementsByClassName('teaser')[0];\r\n          var sub = (ts)? ts.getElementsByTagName('b') : null;\r\n          var com = (!ts)? '' : (sub && sub[0])? ((ts.childNodes[1])? ts.childNodes[1].textContent : '') : ts.childNodes[0].textContent;\r\n          Object.defineProperty(th, 'com', {value:com, enumerable:true, writable:true, configurable:true});\r\n          return (sub && sub[0])? sub[0].textContent : '';\r\n        },\r\n        name: function(th){return '';},\r\n        com: function(th){\r\n          if (!th.hasOwnProperty('sub')) Object.defineProperty(th, 'sub', {value:this['sub'](th), enumerable:true, writable:true, configurable:true});\r\n          return th.com;\r\n        },\r\n        footer: function(th){\r\n          return th.pn.getElementsByClassName('meta')[0]; // must parse pn because of mimic mode.\r\n//          footer.innerHTML = '';\r\n        },\r\n        sticky: function(th){return th.pn.getElementsByClassName('stickyIcon')[0]!==undefined;},\r\n//        format: function(th){th.pn.getElementsByTagName('a')[0].removeAttribute('href');return null;},\r\n        tn_as: function(th){return th.pn.getElementsByTagName('a');},\r\n        tn_imgs: function(th){\r\n          var a0 = th.pn.getElementsByTagName('a')[0];\r\n          return (a0)? [a0.getElementsByTagName('img')[0]] : [];}, // for chart popup, not using tn_as\r\n//        tn_imgs: function(th){return (th.tn_as[0])? [th.tn_as[0].getElementsByTagName('img')[0]] : [];},\r\n        class_thread: 'thread',\r\n        class_thumbnail: 'thumb',\r\n//        op_img_url: function(th){ // working code.\r\n//          var img = th.pn.getElementsByTagName('img')[0];\r\n//          return (img)? img.getAttribute('src') : undefined; // patch.\r\n//        },\r\n        op_img_url: function(th){return (th.tn_imgs[0])? th.tn_imgs[0].getAttribute('src') : undefined;}, // patch. // BUG IN MIMIC MODE, BECAUSE THIS REQURES TH.PN AND TH.PN WILL BE WRITTEN AFTERWARDS. // moved from DEFAULT.common\r\n        get_op_src: 'thread_json',\r\n//        get_op_src: function(th){ // working code.\r\n//          return (th.op_img_url.indexOf('s.4cdn.org')!=-1)? th.op_img_url : th.op_img_url.replace(/s(\\.\\w+)$/,'$1');}, // TEMPORAL PATCH\r\n        dynamic_image_hover: true,\r\n        missing_info: 1,\r\n        img2src: function(img){\r\n          var lth = this.get_lth_from_node(img);\r\n          if (!lth) return null;\r\n          var src = img.src;\r\n          if (lth.th && lth.th.ext) src = src.replace(/thumb/,'src').replace(/s\\.[^\\.]*$/,lth.th.ext);\r\n          else if (lth.th.parse_funcs.missing_info) scan.scan_ui('image_hover', {tgts: [lth.domain+lth.board], options:{callback:function(){cataLog.image_hover_reentry(img);}, priority:6}}); // NEVER ACTIVATED because catalog.json is read always at initial\r\n          return src;\r\n        },\r\n        time_unit: 1000,\r\n//        posts: function(th){\r\n//          return (pref.test_mode['126'])? [{sub:th.sub, com:th.com, name:th.name, pn:undefined, __proto__:th.__proto__}] : [{sub:th.sub, com:th.com, name:th.name, get pn(){console.trace();return this._pn;}, _pn:th.pn}];}, // for debug\r\n        footer_prep: function(th, footer){\r\n          var pn = document.createElement('span');\r\n          footer.insertBefore(pn, footer.firstChild);\r\n          footer.removeChild(footer.lastChild); // remove menu\r\n          var pn_next;\r\n          while (pn_next = pn.nextSibling) pn.appendChild(pn_next);\r\n          return pn;\r\n        },\r\n      },\r\n      'catalog_json' : {\r\n        ths: function(obj, parse_obj) {\r\n          var ths = [];\r\n          for (var i=0;i<obj.length;i++)\r\n            if (obj[i].threads) for (var j=0;j<obj[i].threads.length;j++) {\r\n              var tgt = obj[i].threads[j];\r\n              tgt.__proto__ = parse_obj;\r\n              ths[ths.length] = {\r\n                page: i + '.' + j,\r\n                key: parse_obj.domain + parse_obj.board + tgt.no,\r\n                __proto__: tgt,\r\n              }\r\n            }\r\n          return ths;\r\n        },\r\n//        ths: 'DEFAULT.catalog_json',\r\n        time_posted: function(th){return (th.last_replies)? th.last_replies[th.last_replies.length-1].time*1000 : th.time_created;},\r\n        time_bumped: function(th){return (th.bumplimit)? undefined : th.time_posted;},\r\n        time_created : function(th){return th.time*1000;},\r\n        nof_posts: function(th){return th.replies+1;}, // same as 8chan\r\n        nof_files: function(th){return th.images+1;},\r\n////        key: function(th){return th.domain + th.board + th.no;}, // same as 8chan\r\n////        sub: function(th){return (th.hasOwnProperty('sub'))? th.sub : '';},\r\n////        name: function(th){return (th.hasOwnProperty('name'))? th.name : '';},\r\n////        com: function(th){return (th.hasOwnProperty('com'))? th.com : '';},\r\n        op_img_url: 'DEFAULT.common',\r\n////        op_img_url: function(th) {\r\n////          return site2['4chan'].catalog_json2html3_thumbnail(th, th.board);},\r\n        //        footer: function(th){return th.pn.getElementsByClassName('meta')[0];},\r\n        posts: function(th){\r\n          return (th.last_replies)? [th.__proto__].concat(th.last_replies) : [th.__proto__];\r\n        },\r\n////        posts: function(th){\r\n////          var posts = site2['DEFAULT'].parse_funcs.catalog_json.posts(th);\r\n////          if (th.last_replies) posts = posts.concat(th.last_replies);\r\n////          return posts;\r\n////        },\r\n//////        posts: function(th){return th.last_replies;}, // can't show icon in desktop notification. // BUG, don't hit at search.\r\n//////        posts: function(th){ // work, but parse redundantly\r\n//////          if (th.last_replies) for (var i=0;i<th.last_replies.length;i++)\r\n//////            th.last_replies[i].op_img_url = site2['4chan'].catalog_json2html3_thumbnail(th.last_replies[i], th.board);\r\n//////          return th.last_replies;\r\n//////        },\r\n        has_posts: true,\r\n////        last_replies: function(th){return undefined;}, // stop parsing loop between 'posts' and 'last_replies'\r\n//        add_op_img_url: function(th){  // slow in chrome because of making needless prefetch.\r\n//          for (var i=0;i<th.posts.length;i++)\r\n//            th.posts[i].op_img_url = site2['4chan'].catalog_json2html3_thumbnail(th.posts[i], th.board);\r\n//        },\r\n//        add_op_img_url: function(posts,board){\r\n//          for (var i=0;i<posts.length;i++)\r\n//            posts[i].op_img_url = site2['4chan'].catalog_json2html3_thumbnail(posts[i], board);\r\n//        },\r\n        add_op_img_url: site2['DEFAULT'].parse_parts.add_op_img_url,\r\n        time_unit: 1000,\r\n        get_op_src: 'thread_json',\r\n        type_com: 'html',\r\n        posts_full: null,\r\n////        posts_full: 'DEFAULT.catalog_json',\r\n        missing_info: undefined,\r\n        tn_as: 'catalog_html',\r\n        tn_imgs: 'catalog_html',\r\n        footer: 'catalog_html',\r\n        class_thread: 'catalog_html',\r\n        class_thumbnail: 'catalog_html',\r\n        add_sage: (function(){\r\n          var bumps = {};\r\n          var pages = {};\r\n          function i2pkey(i,skey,post){\r\n            return 'p'+Math.floor(i/15)+'.'+(i%15)+', '+skey+'#'+post.no;\r\n          }\r\n          return function(ths, end_no){\r\n            var pf = pref.uip_tracker.sage;\r\n            var i=0;\r\n            while (i<ths.length && ths[i].sticky) if (ths[i].no===end_no) return ths[i]; else i++;\r\n            if (pf.patch_bug3) { // ignore not updated data\r\n              var sskey = (ths[0].domain!==site.nickname? ths[0].domain : '') + ths[0].board;\r\n              var latest_bump = bumps[sskey] || 0;\r\n              while (i<ths.length && ths[i].last_modified<latest_bump) if (ths[i].no===end_no) return ths[i]; else i++;\r\n              if (i<ths.length) bumps[sskey] = ths[i].last_modified;\r\n            }\r\n            if (i==ths.length) return;\r\n            if (ths[i].no==end_no) return ths[i];\r\n            latest_bump = ths[i].last_modified; // for deletion of the last post, instead of ths[i].posts[ths[i].posts.length-1].time;\r\n            var skey0 = (ths[0].domain!==site.nickname? ths[0].domain : '') + (ths[0].board!==site.board? ths[0].board : '');\r\n            var recovered = false;\r\n            var tu = this.time_unit;\r\n            while (++i<ths.length) { // can't use stateful fast approach because of 4chan's bug.\r\n              var th = ths[i];\r\n              var skey = skey0? skey0 + th.no : th.no; // retain numeric type.\r\n              if (!th.bumplimit) {\r\n                for (var j=th.posts.length-1;j>=1;j--) { // annotate all\r\n                  var time = th.posts[j].time;\r\n                  if (bumps[skey]>=time) break; // for deletion and reentry\r\n                  if (latest_bump+pf.tolerance>=time) break; // bug of 4chan at roundup, 1 tolerance is required.\r\n  //                if (latest_bump>=time) break;\r\n                  if (pf.patch_bug4 && j==th.posts.length-1) {\r\n                    if (i<pages[skey]) { // In case of that there are new posts but page order is corupted. More updates shall exist.\r\n                      if (pref.debug_mode['30']) console.log('RECOVERED by page history: '+i2pkey(i,skey,th.posts[j]));\r\n                      recovered = true;\r\n                      break;\r\n                    }\r\n                  }\r\n                  th.posts[j].email = 'sage'; // vichan has 'email' field.\r\n                  if (pref.debug_mode['30']) console.log('detect: sage: '+i2pkey(i,skey,th.posts[j])+', '+time+', '+latest_bump);\r\n                }\r\n                if (j===0) time = th.posts[0].time; // j===0 when all posts are sage.\r\n                if (th.posts.length===1 || th.posts[th.posts.length-1].time!=th.last_modified) time = th.last_modified; // for deletion of the last post, assumes last post was age. th.posts.length===1 for new threads which has no posts.\r\n  //              if (time<th.last_modified) time = th.last_modified; // for deletion of the last post.\r\n                var updated = bumps[skey]!=time;\r\n                if (!bumps[skey] || bumps[skey]<time) bumps[skey] = time;\r\n                latest_bump = (pf.patch_bug2 && i<pf.patch_bug2nth)? th.last_modified : bumps[skey]; // for fast board like /v/.\r\n                Object.defineProperty(th,'time_bumped',{value:latest_bump*tu, enumerable:true, configurable:true, writable:true});\r\n              }\r\n              var obsolete = !updated && i<pages[skey]; // )? pages[skey] : 0;\r\n              pages[skey] = (obsolete)? pages[skey] : i; // lock to pages[skey], 10000 is too strict for thread deletion.\r\n//              pages[skey] = (obsolete)? 10000 : i; // lock to 10000 as a flag, since threads are bumped without new posts in 4chan.(bug)\r\n              if (th.no==end_no) return th;\r\n              if (pf.patch_bug5 && (recovered || obsolete)) {\r\n                if (pref.debug_mode['30']) console.log('EXIT by obsolete data: '+i2pkey(i,skey,th.posts[j])+', '+pages[skey]);\r\n                break;\r\n              }\r\n            }\r\n          }\r\n        })(),\r\n        flags: 'DEFAULT.page_json',\r\n        hrefs: 'DEFAULT.post_json',\r\n        proto: 'DEFAULT.common',\r\n//        proto: 'DEFAULT.catalog_json',\r\n      },\r\n      'page_html' : {\r\n        proto: 'thread_html',\r\n      },\r\n      'thread_html' : {\r\n        time_created: 'DEFAULT.thread_json',\r\n        time_bumped: 'DEFAULT.thread_json',\r\n        time_posted: 'DEFAULT.thread_json',\r\n        ths: function(doc) {return this.ths_array(doc, doc.pn.getElementsByClassName('thread'));},\r\n//        ths: function(doc) {return site2['DEFAULT'].parse_funcs['thread_html'].ths_array(doc, doc.pn.getElementById('t'+doc.thread));}, // working code.\r\n//        ths: function(doc) { // working code.\r\n//          return [{pn:doc.pn.getElementById('t'+doc.thread),\r\n//                   type_html: 'thread_html',\r\n//                   page: '?',\r\n//                   __proto__: doc.__proto__}];\r\n//        },\r\n\r\n//        pop_post: function(th){ // debuging code.\r\n//          th.post = th.posts[--th.idx_pop];\r\n//          return th.post;\r\n//        },\r\n//        pop_post_prep: function(th){\r\n//          delete th.posts;\r\n//          th.idx_pop = th.posts.length;\r\n//        },\r\n////        pop_post: function(th){ // working code\r\n////          while (th.idx_pop>=0) {\r\n////            var pn = th.children[th.idx_pop--];\r\n////            if (pn.className && pn.className.indexOf('postContainer')!=-1) {\r\n////              th.post = {pn:pn, parse_funcs:this, __proto__:th.__proto__};\r\n////              return true;\r\n////            }\r\n////          }\r\n////          return false;\r\n////        },\r\n//////        post_no: function(post){return parseInt(post.pn.id.substr(3),10);},\r\n////        post_no: function(post){return parseInt(post.pn.id.substr(2),10);}, // 2015.05.12, maybe depends on baord???\r\n        id: 'DEFAULT.thread_html',\r\n        country: 'DEFAULT.thread_html',\r\n        trip: 'DEFAULT.thread_html',\r\n        flag: 'DEFAULT.thread_html',\r\n        name: 'DEFAULT.thread_html',\r\n\r\n        th_init: function(th) {th.pn.removeAttribute('class');},\r\n//        th_destroy: function(pn, parse_funcs){},\r\n//        ths: function(doc) { // working code.\r\n//          var ths = this.ths_array(doc, doc.pn.getElementsByClassName('thread'));\r\n//          for (var i=0;i<ths.length;i++) {\r\n//            Object.defineProperty(ths[i], 'no', {value:ths[i].pn.id.substr(1), enumerable:true, writable:true, configurable:true});\r\n//            ths[i].pn.removeAttribute('class'); // collection ISN'T writable? and if wrote, its enumerator doesn't work.\r\n//          }\r\n//          return ths;\r\n//        },\r\n//        no : function(th){return parseInt(th.pn.getElementsByClassName('postContainer')[0].id.substring(2),10);},\r\n//        last_replies: 'catalog_json',\r\n        nof_posts: function(th){\r\n          var nof_posts = th.pn.getElementsByClassName('postContainer').length;\r\n          var nof_files = th.pn.getElementsByClassName('fileText').length;\r\n          var om_info   = th.pn.getElementsByClassName('summary desktop')[0];\r\n          if (om_info) {\r\n            var str = om_info[brwsr.innerText].replace(/\\n/g,'');\r\n            nof_posts += parseInt(str.replace(/\\ post.*/,''),10);\r\n            nof_files += parseInt('0'+str.replace(/\\ image.*/,'').replace(/[^\\ ]*\\ /g,''),10);\r\n          }\r\n          Object.defineProperty(th,'nof_files',{value:nof_files, enumerable:true, configurable:true, writable:true});\r\n          return nof_posts;\r\n        },\r\n        nof_files: function(th){\r\n          if (!th.hasOwnProperty('nof_posts')) this['nof_posts'](th);\r\n          return th.nof_files;\r\n        },\r\n//        name: function(post){return post.pn.getElementsByClassName('name')[0][brwsr.innerText];}, // same as 8chan\r\n        footer: function(th){return this.insert_footer4(th.pn.getElementsByClassName('postInfo desktop')[0]);},\r\n        sticky: function(th){return (th.pn.getElementsByClassName('stickyIcon').length!=0);},\r\n        op_img_url:function(th){\r\n          var img = th.pn.getElementsByTagName('img')[0];\r\n          var url = (img)? img.getAttribute('src') : undefined;\r\n          return url;\r\n        },\r\n        get_thread_links : function(th){return th.pn.querySelectorAll('.replylink,.'+pref.script_prefix+'_link');}, // PATCH\r\n//        get_thread_links : function(th){return th.pn.getElementsByClassName('replylink');}, \r\n//        get_omitted_info : function(post){return post.pn.getElementsByClassName('summary')[0];},\r\n        get_omitted_info : function(post){\r\n          var omit_info = post.pn.parentNode.nextSibling;\r\n          return (omit_info && omit_info.classList.contains('summary'))? omit_info : undefined;\r\n//          var omit_info = post.pn.parentNode.parentNode; // working, but slow.\r\n//          if (omit_info) omit_info = omit_info.getElementsByClassName('summary')[0];\r\n////          if (omit_info && omit_info.childNodes[1]) omit_info = omit_info.childNodes[1];\r\n//          return omit_info;\r\n        },\r\n        set_omitted_info : function(post, info){post.pn.parentNode.parentNode.insertBefore(info, post.pn.parentNode.nextSibling);},\r\n        replace_omitted_info : function(dst, src){dst.childNodes[1].textContent = src.childNodes[1].textContent;},\r\n        replace_omitted_info2 : function(dst, src, th){\r\n//          if (!dst.childNodes[1]) { // for 4chan-X v1.13.8.7 in therad, but this isn't required.\r\n          if (dst.tagName==='A') { // for 4chan-X v1.13.8.7\r\n            var span = document.createElement('span');\r\n            span.setAttribute('class','summary');\r\n            span.appendChild(document.createElement('span'));\r\n            span.appendChild(dst);\r\n            dst = span;\r\n          }\r\n//          if (!src) dst.parentNode.removeChild(dst); // BUG, when I choose ALL in expander, the expander will disappear.\r\n          if (!src) {\r\n            dst.childNodes[0].setAttribute('style','display:none');\r\n            dst.childNodes[1].setAttribute('style','display:none');\r\n          } else {\r\n            if (dst.childNodes[1].style.display==='none') {\r\n              if (th.domain===site.nickname) dst.childNodes[0].removeAttribute('style');\r\n              dst.childNodes[1].removeAttribute('style');\r\n            }\r\n            this.replace_omitted_info(dst,src);\r\n          }\r\n        },\r\n        get_op_src: 'thread_json',\r\n        proto: 'post_html',\r\n      },\r\n      'page_json'  : {\r\n        ths: 'DEFAULT.page_json',\r\n        get_op_src: 'thread_json',\r\n        proto: 'thread_json'\r\n      },\r\n      'thread_json'  : {\r\n////        op_img_url: function(th){\r\n////          return site2[th.domain].catalog_json2html3_thumbnail(th.posts[0],th.board);},\r\n        tn_as: 'catalog_html.tn_as',\r\n        sticky: function(th){return th.posts[0].sticky;},\r\n//        time_bumped : function(obj){return (obj.posts[0].bumplimit)? undefined : obj.posts[obj.posts.length-1].time*1000;}, // 4chan doesn't have email field.\r\n//                   obj.posts[site3[this.domain].boards[this.board].bump_limit-2].time*1000 :   // for safety, 2.\r\n//        get_op_src: function(th){return th.op_img_url.replace(/s\\..*/,th.ext);},\r\n        get_op_src: function(th, img){\r\n          if (th.op_img_url.indexOf('s.4cdn.org')!=-1) return th.op_img_url;\r\n          if (!th.ext && th.parse_funcs.missing_info) scan.scan_ui('image_hover', {tgts: [th.domain+th.board+'j0'], options:{callback:function(){cataLog.image_hover_reentry(img);}, priority:6}}); // NEVER ACTIVATED because catalog.json is read always at initial\r\n          return (th.localArchive)? site2[th.domain].catalog_json2html3_src(th,th.board) :\r\n                 (th.ext)? th.op_img_url.replace(/s(\\.\\w+)$/, th.ext) : img.src;\r\n//          return (th.ext)? th.op_img_url.replace(/s(\\.\\w+)$/, th.ext) : img.src;\r\n        },\r\n        consolidate_IDB_result_sub: function(posts){\r\n          posts[0].nof_posts = posts.length;\r\n          var nof_files = 0;\r\n          for (var i=0;i<posts.length;i++) if (posts[i].filename) nof_files++;\r\n          posts[0].nof_files = nof_files;\r\n        },\r\n        flags: 'DEFAULT.page_json',\r\n        hrefs: 'DEFAULT.post_json',\r\n        proto: 'DEFAULT.thread_json'\r\n      },\r\n      'post_html': {\r\n        no : function(th){\r\n          var id = th.pn.getAttribute('id');\r\n          return parseInt(id.substr(1),10) || parseInt(id.substr(2),10)},\r\n        time: function(post){\r\n          return parseInt(post.pn.getElementsByClassName('dateTime')[0].getAttribute('data-utc'),10);\r\n        },\r\n        time_pn: function(post_pn){return parseInt(post_pn.getElementsByClassName('dateTime')[0].getAttribute('data-utc'),10)*1000;}, // returns utc.\r\n        flag: function(post){return post.pn.getElementsByClassName('flag')[1] || post.tFlag;},\r\n        tFlag: function(post){return post.pn.getElementsByClassName('countryFlag')[1];}, // troll flag in /pol/\r\n        country: function(post){\r\n          return (post.tFlag)? post.tFlag.getAttribute('alt').toLowerCase() // lower case for troll flag\r\n            : (post.flag)? post.flag.getAttribute('class').replace(/\\s*flag\\-*/g,'').toUpperCase() : undefined; \r\n        },\r\n//        flag: function(post){\r\n//          var flag = post.pn.getElementsByClassName('flag')[1];\r\n////          var flag = (flags.length!=0)? document.importNode(flags[0],false) : null;\r\n//          if (flag) var country = flag.getAttribute('class').replace(/\\s*flag\\-*/g,'').toUpperCase();\r\n//          else {\r\n//            flag = post.pn.getElementsByClassName('countryFlag')[1]; // for /pol/\r\n//            if (flag) {\r\n//              country = flag.getAttribute('alt');\r\n//              post.troll_country = country.toUpperCase();\r\n//            }\r\n//          }\r\n//          Object.defineProperty(post,'country',{value:country, writable:true, configurable:true, enumerable:true});\r\n//          return flag;\r\n//        },\r\n//        country: function(post){\r\n//          var flag = post.flag;\r\n//          return post.country;\r\n//        },\r\n//        txt2com: function(txt){\r\n//          txt = txt.replace(/(^>[^>].*$)/mg,'<span class=\"quote\">$1</span>');\r\n//          txt = txt.replace(/\\*\\*([^(\\*\\*)]*)((\\*\\*)|$)/g,'<s>$1</s>');\r\n//          return txt.replace(/\\n/g,'<br>');},\r\n        txt2com_anchor_class: 'quotelink',\r\n        txt2com_spoiler_replace_txt: '<s>$1</s>',\r\n        time_unit: 1000,\r\n        pn_name: function(post){return post.pn.getElementsByClassName('desktop')[0].getElementsByClassName('name')[0];},\r\n        name: function(post){return this.pn_name(post).textContent;},\r\n        pn_id: function(post){\r\n          var pn = post.pn.getElementsByClassName('posteruid')[1];\r\n          return (pn)? pn.childNodes[1] : undefined;},\r\n        id: function(post){return (post.pn_id)? post.pn_id.textContent : undefined;},\r\n//        pn_id: function(post){return post.pn.getElementsByClassName('posteruid')[1];},\r\n//        id: function(post){return (post.pn_id)? post.pn_id.className.replace(/\\s*posteruid\\s*/,'').replace(/id_/,'') : undefined;},\r\n        pn_trip: function(post){return post.pn.getElementsByClassName('postertrip')[1];},\r\n        trip: function(post){return (post.pn_trip)? post.pn_trip.textContent : undefined;},\r\n\r\n        time_unit: 1000,\r\n        com:  function(post){return post.pn.getElementsByClassName('postMessage')[0].innerHTML;},\r\n        sub: 'DEFAULT.post_html',\r\n        img2src: 'DEFAULT.post_html',\r\n        img2ext: 'DEFAULT.post_html',\r\n        proto: 'DEFAULT.page_html', // test\r\n//        proto: 'DEFAULT.post_html',\r\n      },\r\n      'post_json': {\r\n        proto: 'DEFAULT.post_json',\r\n      },\r\n      'archive_html': {\r\n        ths: function(doc) {\r\n          var pns = Array.prototype.slice.call(doc.pn.getElementById('arc-list').getElementsByTagName('tr')).slice(1,pref.scan.max_archive+1);\r\n          for (var i=0;i<pns.length;i++) pns[i].parentNode.removeChild(pns[i]);\r\n          return this.ths_array(doc, pns);\r\n        },\r\n        no: function(th){return parseInt(th.pn.getElementsByTagName('td')[0].textContent,10);},\r\n        sub: function(th){\r\n          var sub = th.pn.getElementsByTagName('td')[1].firstChild;\r\n          return sub.tagName==='B'? sub.textContent : '';\r\n        },\r\n        com: function(th){return th.pn.getElementsByTagName('td')[1].lastChild.textContent;},\r\n        nof_posts: function(){return undefined;},\r\n        nof_files: function(){return undefined;},\r\n        filename: function(){return '';},\r\n        footer: function(){return document.createElement('div');},\r\n        proto: 'catalog_html',\r\n      },\r\n      'html_template': { // for test_mode['121']\r\n        get id(){return this.exe_sub('id');},\r\n        get pn_id(){return this.exe_sub('pn_id');},\r\n        get country(){return this.exe_sub('country');},\r\n        get trip(){return this.exe_sub('trip');},\r\n        get pn_trip(){return this.exe_sub('pn_trip');},\r\n        get pn_name(){return this.exe_sub('pn_name');},\r\n        get tFlag(){return this.exe_sub('tFlag');},\r\n      },\r\n    },\r\n////    toplevel_anchor: function(th){\r\n////      var as = th.pn.getElementsByTagName('a');\r\n////      for (var i=0;i<as.length;i++) {\r\n////        var href = as[i].getAttribute('href');\r\n////        if (href && href[0]==='#') as[i].setAttribute('href',th.board + 'thread/' + th.no + href);\r\n////      }\r\n////    },\r\n    popups_posts_class_hlt: 'highlight',\r\n    popups_href2dbtp: function(href){ //, src, th){\r\n//      if (href[0]==='#' && th) {\r\n//        href = this.link_dbtp2href([th.domain, th.board, th.no, href.substr(2)]);\r\n//        src.setAttribute('href',href);\r\n//      }\r\n      // inputs are: \r\n      //   #PPPP\r\n      //   /BBBB/thread/TTTT/#PPPP\r\n      //   //boards.4chan.org/r/catalog#s=eddit  for >>>/r/eddit\r\n      //   //boards.4channel.org/int/thread/TTTT\r\n      //   /BBBB/\r\n      //   //i.4cdn.org/BBBB/xxxx.webm\r\n      var hrefs = href.split(/[\\/#]/); // hrefs will be [ '', '1234'] when href is #1234.\r\n      var len = hrefs.length;\r\n      var p = hrefs[len-1].substr(1);\r\n      var t = len>=2 && hrefs[len-2] || site.no;\r\n      var b = (len>=4 && hrefs[len-4])? '/'+hrefs[len-4]+'/' : site.board;\r\n      if (hrefs[len-2]==='catalog') {\r\n        p = ''; // hrefs[len-1].slice(2,-3);\r\n        t = ''; // p;\r\n        b = (len>=3 && hrefs[len-3])? '/'+hrefs[len-3]+'/' : site.board;\r\n      } else if (href[0]==='/') {\r\n        if (href[1]==='/') {\r\n          if (href.indexOf('//boards.4chan')===0) {\r\n            p = len>=7? hrefs[6].slice(1) : '';\r\n            t = len>=6? hrefs[5] : '';\r\n            b = len>=4? '/'+hrefs[3]+'/' : site.board;\r\n          } else return [];\r\n        } else if (len!=5) {\r\n          p = len>=5? hrefs[4].slice(1) : '';\r\n          t = len>=4? hrefs[3] : '';\r\n          b = '/'+hrefs[1]+'/';\r\n        }\r\n      }\r\n      return ['4chan',b,t,p]\r\n    },\r\n\r\n    update_posts_remove: function(th_old,i,pnode){\r\nif (pref.debug_mode['13'] && th_old.posts[i].pn.parentNode.parentNode!==pnode) console.log(th_old.posts[i].pn);\r\n      var tgt = th_old.posts[i].pn.parentNode;\r\n      var expander = (i==0)? tgt.nextSibling : null; // for merge\r\n      pnode.removeChild(tgt);\r\n      if (expander && expander.tagName==='SPAN') pnode.removeChild(expander);\r\n    },\r\n////    update_posts_remove_lock: function(th_old,i,pnode, now_height){ // TEST, slow implementation\r\n////      var ref, ref_pos;\r\n////      var tgt = th_old.posts[i].pn.parentNode;\r\n////      if (now_height && tgt.offsetTop<now_height) ref = tgt.nextSibling || tgt.parentNode.nextSibling;\r\n////      if (ref) ref_pos = ref.offsetTop;\r\n////      pnode.removeChild(th_old.posts[i].pn.parentNode);\r\n////      return (ref)? ref.offsetTop - ref_pos : 0;\r\n////    },\r\n    update_posts_insert: function(src,dst,i,j,pnode){\r\n      var ref = (j<dst.length)? dst[j].pn.parentNode : null;\r\n      if (!src[i].pn) src[i].pn = this.post_json2html(src[i], src[i].board);\r\n      var tgt = src[i].pn.parentNode || this.post_container(src[i].pn,src[i].no);\r\n      var expander = (i==0)? tgt.nextSibling : null; // for merge\r\n      pnode.insertBefore(tgt, ref);\r\n      if (expander && expander.tagName==='SPAN') pnode.insertBefore(expander, ref);\r\n    },\r\n//    update_posts_insert: function(src,dst,i,j,pnode){ // working code.\r\n//      var ref;\r\n//      if (j<dst.length) {\r\n//        ref = dst[j].pn.parentNode;\r\n//        if (ref.tagName==='SPAN') ref = ref.nextSibling; // skip summary, don't see j===1 for merge.\r\n//      } else ref = null;\r\n//      if (!src[i].pn) src[i].pn = this.post_json2html(src[i], src[i].board);\r\n//      var tgt = src[i].pn.parentNode || this.post_container(src[i].pn,src[i].no);\r\n//      pnode.insertBefore(tgt, ref);\r\n//    },\r\n////    update_posts_insert: function(th,th_old,i,j,pnode){ // working code.\r\n//////      var ref = (j==1)? (th_old.posts[0].pn.parentNode.nextSibling || th_old.posts[0].pn.parentNode) : \r\n//////                         th_old.posts[th_old.posts.length-1].pn.parentNode;\r\n////      var ref;\r\n////      if (j<th_old.posts.length) {\r\n////        ref = th_old.posts[j].pn.parentNode;\r\n////        if (ref.tagName==='SPAN') ref = ref.nextSibling; // skip summary, don't see j===1 for merge.\r\n////      } else ref = null;\r\n////      if (!th.posts[i].pn) th.posts[i].pn = this.post_json2html(th.posts[i],th.board);\r\n////      pnode.insertBefore(this.post_container(th.posts[i].pn,th.posts[i].no), ref);\r\n////    },\r\n////    update_posts_insert_lock: function(th,th_old,i,j,pnode, now_height){ // TOO SLOW\r\n////      var ref, ref_pos;\r\n////      if (j<th_old.posts.length) {\r\n////        ref = th_old.posts[j].pn.parentNode;\r\n////        if (ref.tagName==='SPAN') ref = ref.nextSibling; // skip summary, don't see j===1 for merge.\r\n////      } else ref = null;\r\n////      if (now_height && ref) ref_pos = ref.offsetTop;\r\n////      if (!th.posts[i].pn) th.posts[i].pn = this.post_json2html(th.posts[i],th.board);\r\n////      pnode.insertBefore(this.post_container(th.posts[i].pn,th.posts[i].no), ref);\r\n////      return (ref_pos<now_height)? ref.offsetTop - ref_pos : null;\r\n////    },\r\n    update_posts0_class: function(pn,search_result) {\r\n      site2['DEFAULT'].update_posts0_class(pn,search_result);\r\n      var summary = pn.parentNode && pn.parentNode.nextSibling;\r\n      if (summary && summary.classList.contains('summary')) site2['DEFAULT'].update_posts0_class(summary,search_result);\r\n    },\r\n    post_container : function(post_pn,no, op) {\r\n      var pn = document.createElement('div');\r\n      pn.setAttribute('id','pc'+no);\r\n      pn.setAttribute('class','postContainer ' + ((op)? 'op' : 'reply') + 'Container');\r\n      if (op) {\r\n//<div class=\"postLink mobile\"><span class=\"info\">97 Replies / 26 Images</span><a href=\"thread/138122016\" class=\"button\">View Thread</a></div>\r\n      } else {\r\n        pn.innerHTML = '<div class=\"sideArrows\" id=\"sa'+no+'\">&gt;&gt;</div>';\r\n      }\r\n      pn.appendChild(post_pn);\r\n      return pn;\r\n    },\r\n    remove_backlink: function(pn,idx){\r\n      var bks = pn && pn.getElementsByClassName('backlink')[0];\r\n      var blk = bks && bks.childNodes[idx];\r\n      if (blk) bks.removeChild(blk);\r\n    },\r\n    add_backlinks_bks: (function(){\r\n      var bks = document.createElement('div'); // why div???\r\n      bks.setAttribute('class','backlink');\r\n      return function(){\r\n        return bks.cloneNode(false);\r\n      }\r\n    })(),\r\n    add_backlinks_add_1: (function(){\r\n      var blk = document.createElement('a');\r\n      blk.setAttribute('class','quotelink');\r\n      var blk2 = document.createElement('span');\r\n      blk2.appendChild(blk);\r\n      blk2.appendChild(document.createTextNode(' '));\r\n      return function(bks, dbtpth){\r\n        blk.setAttribute('href',dbtpth[5]);\r\n        blk.textContent = dbtpth[4];\r\n        var pn = blk2.cloneNode(true);\r\n        if (dbtpth[0]!=='4chan' || pref.test_mode['91']) { // TO BE REMOVED\r\n          var pn1 = pn.firstChild;\r\n          pn1.onclick = this.backlink_onclick;\r\n//          pn1.onmouseover = this.popups_post_entry;\r\n        }\r\n        bks.appendChild(pn);\r\n      };\r\n    })(),\r\n    add_backlinks_bks_query: function(pn){\r\n      return pn.getElementsByClassName('backlink')[0];\r\n    },\r\n////    add_backlinks: function(pn,backlinks,target, th){\r\n////if (pref.test_mode['35']) return;\r\n////      var bks_pn = pn.getElementsByClassName('backlink')[0];\r\n////      var bks = bks_pn || this.add_backlinks_bks();\r\n////      if (!target) bks.innerHTML = ''; // this hits target===0 also and clean up.\r\n////      for (var i=(target || 0);i<backlinks.length;i++) {\r\n////        var dbtp = this.popups_backlink2dbtpth(backlinks[i], th);\r\n//////        var domain = dbtp[0];\r\n//////        var board = dbtp[1];\r\n//////        var post_no = dbtp[3];\r\n//////        var txt = dbtp[4];\r\n//////        var href = site2[domain].link_dbtp2href(dbtp);\r\n//////        if (domain!==site.nickname) href = site2[domain].absolute_link_1(href);\r\n////\r\n//////        var blk = null; // IS THIS REQUIRED???\r\n//////        if (target!==undefined) {\r\n//////          var as = bks.getElementsByTagName('a');\r\n//////          for (var j=0;j<as.length;j++)\r\n//////            if (as[j].textContent===txt) {\r\n//////              blk = as[j];\r\n//////              break;\r\n//////            }\r\n//////        }\r\n//////        if (!blk)\r\n////        this.add_backlinks_add_1(bks, dbtp);\r\n////        if (target) break;\r\n////      }\r\n////      if (!bks_pn) pn.getElementsByClassName('desktop')[0].appendChild(bks); // for 4chan-X v1.13.8.7\r\n//////        var ref = this.backlink_parent_prevSib(pn);\r\n//////        ref.parentNode.insertBefore(bks,ref.nextSibling);\r\n////    },\r\n    add_backlinks_bks_append: function(pn, bks){\r\n      pn.getElementsByClassName('desktop')[0].appendChild(bks); // for 4chan-X v1.13.8.7\r\n    },\r\n    toplevel_anchor_pos:2,\r\n    link_dbtp2href: function(dbtp, quote){\r\n      return (dbtp[1]!=site.board || dbtp[2]!=site.no? dbtp[1]+'thread/'+dbtp[2] : '') + '#'+(quote?'q':'p')+dbtp[3];\r\n    },\r\n    backlink_onclick: function(){\r\n      highlightReply.call(this,parseInt(this.textContent.substr(2),10)); // call native function in 4chan.\r\n    },\r\n//    backlink_class: 'quotelink',\r\n    backlink_parent_prevSib: function(pn){return pn.getElementsByClassName('postNum')[1];},\r\n\r\n//    post_json2html : site2['vichan'].post_json2html,\r\n    //    post_json2html_file : site2['vichan'].post_json2html_file,\r\n    post_com2txt: function(post){\r\n      return (!post.com)? '' : this.post_com2txt_finisher(post.com.replace(/<[^>]*>/g,' ').replace(/&gt;/g,'>').replace(/&lt;/g,'<').replace(/&quot;/g,'\"').replace(/&#039;/g,\"'\").replace(/&#0*44;/g,',').replace(/&amp;/g,'&'), post); // most of 4chan. speed: 13.07/2.38 inlainchan.\r\n    },\r\n    post_json2html : function(post, board, op, short_link, op_no) {\r\n      if (op_no===undefined) op_no = post.op || post.resto || post.no;\r\n      if (op===undefined) op = post.resto===0 || post.no==post.op;\r\n      var pn = document.createElement('div');\r\n      var time_unit = (post.parse_funcs && post.parse_funcs.time_unit) || 1;\r\n      var date = new Date((post.time || 0) * time_unit);\r\n      var name = post.name || 'Anonymous';\r\n      if (post.ext) {\r\n        var fsize_str = (((post.fsize>1048576)? post.fsize/1048576 : post.fsize/1024)+0.005).toString();\r\n        fsize_str = fsize_str.substr(0,fsize_str.indexOf('.')+3) + ((post.fsize>1048576)? ' MB' : ' KB');\r\n//        var fname_server = site2[post.domain].post_json2html_fname_server(post);\r\n//        var fname = site2[post.domain].post_json2html_fname(post);\r\n        var furl = site2[post.domain].catalog_json2html3_src(post,board);\r\n        var turl = site2[post.domain].catalog_json2html3_thumbnail(post,board);\r\n        var tn_f = (op)? 1 : ((post.tn_w>post.tn_h)? post.tn_w : post.tn_h) / 125; // 150;\r\n        var file_html = \r\n          '<div class=\"file\" id=\"f' + post.no + '\">'+\r\n            '<div class=\"fileText\" id=\"fT' + post.no + '\">File: '+\r\n              '<a '+(post.filename.length>30? 'title=\"'+post.filename+post.ext+'\" ':'')+'href=\"' + furl + '\" target=\"_blank\">'+\r\n                    (post.spoiler? 'Spoiler Image' : post.filename.length>30? post.filename.slice(0,25)+'(...)':post.filename) + post.ext + '</a>'+\r\n              ' (' + fsize_str + ', ' + post.w + 'x' + post.h + ')</div>'+\r\n            '<a class=\"fileThumb\" href=\"' +furl + '\" target=\"_blank\">'+\r\n              '<img src=\"' + turl + '\" alt=\"' + fsize_str + '\" data-md5=\"' + post.md5 + '\" style=\"height: ' + ((post.spoiler)? 100 : (op)? post.tn_h : post.tn_h / tn_f) + 'px; width:' + ((post.spoiler)? 100 : (op)? post.th_w : post.tn_w/tn_f) +'px;\">'+\r\n              '<div data-tip=\"\" data-tip-cb=\"mShowFull\" class=\"mFileInfo mobile\">' + fsize_str + ' ' + post.ext.substr(1).toUpperCase() + '</div>'+\r\n            '</a>'+\r\n          '</div>';\r\n      }\r\n      var dbtp = [post.domain, board, op_no, post.no];\r\n//      var href_prefix = (post.domain!=='4chan' || site.board!==board || site.whereami==='catalog')? board+'thread/' : (site.whereami==='page')? 'thread/' : '';\r\n      pn.innerHTML =\r\n        '<div id=\"p' + post.no + '\" class=\"post reply\">'+\r\n          '<div class=\"postInfoM mobile\" id=\"pim' + post.no + '\">'+\r\n            this.post_json2html_nameblock(post, name, false)+\r\n            '<span class=\"dateTime postNum\" data-utc=\"' + post.time + '\">' + site2['common'].change_utc_to_local(date) + '</span>'+\r\n          '</div>'+\r\n          ((post.ext && op)? file_html : '') +\r\n          '<div class=\"postInfo desktop\" id=\"pi' + post.no + '\">'+\r\n            '<input type=\"checkbox\" name=\"' + post.no +'\" value=\"delete\"> '+ // a blank is here\r\n            ((post.sub)? '<span class=\"subject\">' + post.sub + '</span> ' : '')+\r\n            this.post_json2html_nameblock(post, name, true)+\r\n            '<span class=\"dateTime\" data-utc=\"' + post.time + '\">' + site2['common'].change_utc_to_local(date) + '</span> '+\r\n            '<span class=\"postNum desktop\">'+\r\n              '<a href=\"'+ this.link_dbtp2href_abs(dbtp)      + '\" title=\"Link to this post\">No.</a>'+\r\n              '<a href=\"'+ this.link_dbtp2href_abs(dbtp,true) + '\" title=\"Reply to this post\">' + post.no + '</a>'+\r\n//              '<a href=\"'+ href_prefix + op_no + '#p' + post.no + '\" title=\"Link to this post\">No.</a>'+\r\n//              '<a href=\"'+ href_prefix + op_no + '#q' + post.no + '\" title=\"Reply to this post\">' + post.no + '</a>'+\r\n            '</span>'+\r\n            ' &nbsp; '+\r\n//            ((op)? '<span>[<a href=\"thread/' + op_no + ((post.sub)? '/' + post.sub.replace(/\\s/g,'-').toLowerCase() +' ': '') + '\" class=\"replylink\">Reply</a>]</span>' : '') +\r\n            ((op)? ('<span>[<a href=\"' + site2[post.domain].make_url4([post.domain, board, post.no, 'thread_html'])[0] +'\" class=\"replylink\">Reply</a>]</span>'+\r\n                   ((short_link)? short_link.replace(/>\\[/g,'>').replace(/<a/g,'<span>[<a').replace(/\\]<\\/a/g,'</a>]</span') : '')) : '') +\r\n          '</div>' +\r\n          ((post.ext && !op)? file_html : '') +\r\n          '<blockquote class=\"postMessage\" id=\"m' + post.no + '\">'+ (post.com || '') + '</blockquote>'+ \r\n        '</div>';\r\n      return pn.removeChild(pn.childNodes[0]);\r\n    },\r\n    post_json2html_nameblock: function(post, name, desktop) {\r\n      var color;\r\n      return '<span class=\"nameBlock\">'+\r\n        '<span class=\"name\">' + name + '</span> '+\r\n        ((post.trip)? '<span class=\"postertrip\">' + post.trip + '</span> ' : '') +\r\n        ((post.capcode)? '<strong class=\"capcode hand id_mod\" title=\"Highlight posts by Moderators\">##' + post.capcode + '</strong>' : '')+\r\n//        '<img src=\"//s.4cdn.org/image/modicon.gif\" alt=\"Mod Icon\" title=\"This user is a 4chan Moderator.\" class=\"identityIcon retina\"></span>\r\n        ((post.since4pass)? '<span title=\"Pass user since '+post.since4pass+'\" class=\"n-pu\"></span>':'')+\r\n        ((post.id)? '<span class=\"posteruid id_'+post.id+'\">(ID: '+\r\n          '<span class=\"hand\" title=\"Highlight posts by this ID\"'+\r\n          (desktop? (color = this.post_json2html_colorID(post), ' style=\"color: ' + color[1] + '; background-color: rgb(' + color[0] + ');\"'):'') + '>'+post.id+'</span>'+\r\n        ')</span> ' : '')+\r\n        site2['4chan'].post_flag2html(post) +\r\n      ((desktop)? '</span> ' : '<br></span>');\r\n    },\r\n    post_flag2html: function(post){\r\n      return post.troll_country? '<img src=\"//s.4cdn.org/image/country/troll/'+post.troll_country.toLowerCase()+'.gif\" alt=\"'+post.troll_country+'\" title=\"'+post.country_name+'\" class=\"countryFlag\">'\r\n        : post.country? '<span '+(post.country_name? 'title=\"'+post.country_name+'\" ':'')+'class=\"flag flag-'+post.country.toLowerCase()+'\"></span>' : ''; // post.flag? post.flag.outerHTML : '';\r\n\r\n    },\r\n    post_json2html_colorID: function(post){\r\n      var rgb = 0;\r\n      for (var i=0;i<post.id.length;i++) rgb = (rgb << 5) - rgb + post.id.charCodeAt(i);\r\n      var r = rgb >> 24 & 255;\r\n      var g = rgb >> 16 & 255;\r\n      var b = rgb >> 8  & 255;\r\n      return [ r+','+g+','+b, (.299 * r + .587 * g + .114 * b > 125)? 'black' : 'white'];\r\n    },\r\n// codes from 4chan (extension.min.1076.js)\r\n//    $.hash = function(e) {\r\n//      var t, i, a = 0;\r\n//      for (t = 0,\r\n//           i = e.length; t < i; ++t)\r\n//        a = (a << 5) - a + e.charCodeAt(t);\r\n//      return a\r\n//    }\r\n//    IDColor.compute = function(e) {\r\n//      var t, i;\r\n//      return t = [],\r\n//      i = $.hash(e),\r\n//      t[0] = i >> 24 & 255,\r\n//      t[1] = i >> 16 & 255,\r\n//      t[2] = i >> 8 & 255,\r\n//      t[3] = .299 * t[0] + .587 * t[1] + .114 * t[2] > 125,\r\n//      this.ids[e] = t,\r\n//      t\r\n//    }\r\n//    ,\r\n//    IDColor.apply = function(e) {\r\n//      var t;\r\n//      t = IDColor.ids[e.textContent] || IDColor.compute(e.textContent),\r\n//      e.style.cssText = \"    background-color: rgb(\" + t[0] + \",\" + t[1] + \",\" + t[2] + \");    color: \" + (t[3] ? \"black;\" : \"white;\")\r\n//    }\r\n    page_json2html3_skelton: function(obj) {\r\n      var th = document.createElement('div');\r\n      th.setAttribute('class','thread');\r\n      th.setAttribute('id','t'+obj.no);\r\n      return th;\r\n    },\r\n    page_json2html3 : function(obj,board,thumb_url, assign_pn, clone) { // TEMPORAL, USE thumb_url TO MIMIC.\r\n      var th = this.page_json2html3_skelton(obj);\r\n      var op = clone && obj.posts[0].pn && obj.posts[0].pn.cloneNode(true) || this.post_json2html((obj.posts && obj.posts[0])? obj.posts[0] : obj, obj.board, true, site2[obj.domain].short_link(obj.key, obj.nof_posts, 2, '[Last ',' Posts]'), obj.posts[0].no);\r\n      op.setAttribute('class','post op');\r\n      th.appendChild(this.post_container(op,obj.posts[0].no,true));\r\n      obj.posts[0].pn = op;\r\n      if (obj.posts) {\r\n        for (var i=1;i<obj.posts.length;i++) {\r\n          var pn = clone && obj.posts[i].pn && obj.posts[i].pn.cloneNode(true) || this.post_json2html(obj.posts[i], obj.board);\r\n          th.appendChild(this.post_container(pn,obj.posts[i].no));\r\n          obj.posts[i].pn = pn;\r\n        }\r\n        this.page_json2html3_add_omitted_info(obj,obj.posts,obj.posts);\r\n      }\r\n      return th;\r\n    },\r\n    page_json2html3_replace_expander : function(posts_old, idx, key) {\r\n      var omit_info = posts_old[0].pn.parentNode.parentNode.getElementsByClassName('summary')[0];\r\n      if (omit_info) omit_info.appendChild(cnst.config_expander(key, idx));\r\n    },\r\n    page_json2html3_add_omitted_info : function(th,posts_old,posts) {\r\n      var nof_files = 0;\r\n      for (var i=1;i<posts.length;i++) nof_files += (posts[i].type_data==='html')? posts[i].pn.getElementsByClassName('file').length :\r\n                                                    (posts[i].filename)? 1 : 0;\r\n      var nof_files_omitted = th.nof_files - nof_files;\r\n      var nof_posts_omitted = th.nof_posts - posts.length;\r\n\r\n      var omit_info = (posts_old)? this.parse_funcs['page_html'].get_omitted_info(posts_old[0]) : null;\r\n      if (nof_posts_omitted!=0) {\r\n        if (!omit_info) {\r\n          omit_info = document.createElement('span');\r\n          omit_info.setAttribute('class','summary');\r\n          omit_info.innerHTML = '<img class=\"extButton expbtn\" title=\"Expand thread\" alt=\"+\" data-cmd=\"expand\" data-id=\"' + posts[0].no + '\" ' + \r\n            'src=\"//s.4cdn.org/image/buttons/burichan/post_expand_plus.png\">' +\r\n            '<span class=\"summary\"></span><span style=\"display: none;\">Showing all replies.</span>';\r\n          if (th.domain!=='4chan' || pref[cataLog.embed_mode].use_expander_always) omit_info.appendChild(cnst.config_expander(th.key));\r\n          if (posts_old) this.parse_funcs['page_html'].set_omitted_info(posts_old[0],omit_info);\r\n        }\r\n        omit_info.childNodes[1].textContent = nof_posts_omitted + ((nof_posts_omitted==1)? ' reply' : ' replies') +\r\n                                ((nof_files_omitted)? ' and ' + nof_files_omitted + ' image' + ((nof_posts_omitted!==1)? 's' : '') : '') + ' omitted.';\r\n        if (th.domain!==site.nickname) omit_info.childNodes[0].style.display = 'none';\r\n      } else if (omit_info) omit_info.childNodes[1].textContent = 'Showing all replies.'; //if (omit_info && posts_old && posts_old[0].pn.nextSibling===omit_info) posts_old[0].pn.parentNode.removeChild(omit_info);\r\n      return omit_info;\r\n    },\r\n    catalog_json2html3_thumbnail: function(obj, board) {\r\n      return (!obj.ext)? ''\r\n        : (obj.spoiler)? '//s.4cdn.org/image/spoiler-a1.png'\r\n        : this.protocol+'//i.4cdn.org' + board + obj.tim + 's'  // not 'obj.board' but 'board' is for thread_json.\r\n          + ((obj.ext==='.jpg' || obj.ext==='.png' || obj.ext==='.gif' || obj.ext==='.webm')? '.jpg' : obj.ext);\r\n    },\r\n    catalog_json2html3_src: function(obj, board) {\r\n      return (obj.ext)? this.protocol+'//i.4cdn.org' + board + obj.tim + obj.ext : // not 'obj.board' but 'board' is for thread_json.\r\n                        '';\r\n    },\r\n//    catalog_json2html3_src: function(obj, board) { // working code.\r\n//      return (obj.ext)? this.protocol+'//i.4cdn.org' + board + obj.tim  // not 'obj.board' but 'board' is for thread_json.\r\n//                          + ((obj.ext==='.jpg' || obj.ext==='.webm')? '.jpg' : obj.ext)\r\n//                      : '';\r\n//    },\r\n    catalog_json2html3 : function(obj,board,thumb_url, make_footer) {\r\n      var th = document.createElement('div');\r\n      th.setAttribute('class','thread');\r\n      th.setAttribute('id','thread-'+obj.no);\r\n      th.innerHTML = '<a href=\"' + this.protocol + '//boards.4chan.org' + obj.board + 'thread/' + obj.no + ((obj.sub)? '/'+obj.sub.replace(/ /,'-') : '') + '\">' + // (cause direct jump) fixed.\r\n//      th.innerHTML = '<a>' +\r\n                       '<img alt=\"\" id=\"thumb-' + obj.no + '\" class=\"thumb\"' + // cause popup error\r\n//                       '<img alt=\"\" id=\"thumb-' + obj.no + // don't load image.\r\n                         ((obj.tn_w)? 'width=\"' + ((this.catalog_native_size==='small')? obj.tn_w*3/5 : obj.tn_w) + '\"' : '' ) +\r\n                         ((obj.tn_h)? 'height=\"' + ((this.catalog_native_size==='small')? obj.tn_h*3/5 : obj.tn_h) + '\"' : '' ) +\r\n                         'src=' + thumb_url + ' data-id=\"' + obj.no + '\">' +\r\n                     '</a>' +\r\n                     '<div title=\"(R)eplies / (I)mages\" id=\"meta-' + obj.no + '\" class=\"meta\">' +\r\n                       (make_footer? 'R: <b>' + obj.nof_posts + '</b> / I: <b>' + obj.nof_files + '</b>':'')+'</div>' +\r\n                     '<div class=\"teaser\">' + ((obj.sub)?'<b>'+obj.sub+'</b>':'') + ((obj.com)? ((obj.sub)? ': ' : '' ) + obj.com : '') + '</div>';\r\n//      if (!obj.tn_w || !obj.tn_h) {\r\n        th.childNodes[0].childNodes[0].addEventListener('load',site2['4chan'].catalog_json2html3_onload,false);\r\n//      }\r\n      return th;\r\n    },\r\n    catalog_json2html3_onload : function() {\r\n      this.removeEventListener('load',site2['4chan'].catalog_json2html3_onload,false);\r\n      if (!this.tn_w || !this.tn_h) site2['4chan'].catalog_json2html3_size_changed(this);\r\n      this.removeAttribute('class'); // remove popup.\r\n    },\r\n    catalog_json2html3_size_changed : function(myself) {\r\n      var w = myself.naturalWidth;\r\n      var h = myself.naturalHeight;\r\n      var f = ((w>h)? w : h) / ((site2['4chan'].catalog_native_size==='small')? 150 : 250);\r\n      myself.setAttribute('width', w/f);\r\n      myself.setAttribute('height', h/f);\r\n    },\r\n    favicon : {\r\n      __proto__: site2['DEFAULT'].favicon,\r\n      none: '/favicon.ico',\r\n      reply: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAoUlEQVQ4T61TwRGAMAiTmexMDuVMOlM1XOEoAj60L20gDUlLy8dF6Kd+dM/TqTEmK6shAe4GW8zfQlLVMAGat2NVgr2dUDWJymomBRlJdUCoAEdbFZ7A4qEHw9jHCM5U/k1TiEyMkiqj8ikIgY1YCXxUUQp2NCW3F8malZno9kk9qKLKMKj4nwAScaGiETw2KRix8RWG5MhEjynB24usXusFrlPCCCmAi/UAAAAASUVORK5CYII=',\r\n      reply_to_me: 'png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAvUlEQVQ4T61TXRrDIAiDXWmeabvTzlSvVGb8hFIK3ct8aeUnJkSZxmLZBF+/hBvHWLafRQDY6Wn5B3WKANUhrIkIADQF0Zqxt0NGbP5PACREDhXMDFZREr22g+Wn9VmTMnj3RlqwmKTNJYNfAGi8MPD61mAvEnzAZlDZmA0xs7q08Q7AW5wCVC54aWaxl4A5qFWVCyE+DF830Tf7Kd/ZCBb/BwBFyMgkxNyJgVKFv5CTXeWYM4DqLsTHlD33Lx2GzAg15eTiAAAAAElFTkSuQmCC'\r\n    },\r\n    stats_ID: function(th, posts_new, lth){\r\n      if (!lth.sID) lth.sID = {ids:{}, cs:{}, nid:0, nc:0, np:0, h:null};\r\n      var sID = lth.sID;\r\n      if (th.unique_ips) {\r\n        sID.np = th.unique_ips;\r\n        if (!th.id && th.posts) {\r\n          if (!sID.h) sID.h = [];\r\n          var len = sID.h.length;\r\n          if (sID.h[len-3]!=th.posts[th.posts.length-1].no || sID.h[len-2]!=th.nof_posts || sID.h[len-1]!=th.unique_ips) // not updated data may come because of delay and cache \r\n            sID.h.push(th.posts[th.posts.length-1].no, th.nof_posts, th.unique_ips);\r\n          else if (th.nof_posts<lth.nof_posts) scan.list_nup.add(lth,0,true); // for cache delay, this is safe and never be infinite loop, because lth.nof_posts will be updated to small value copie3d from th.nof_posts.\r\n        }\r\n      }\r\n      if (posts_new && posts_new.length>0 && (th.id || th.country)) {\r\n        for (var i=0;i<posts_new.length;i++) {\r\n          var c = posts_new[i].country;\r\n          if (c) if (sID.cs[c]) sID.cs[c]++; else {sID.cs[c]=1;sID.nc++;}\r\n          if (posts_new[i].id) {\r\n            var id = (c || '') + posts_new[i].id;\r\n            if (sID.ids[id]) sID.ids[id]++; else {sID.ids[id]=1;sID.nid++;}\r\n          }\r\n        }\r\n      }\r\n      if (th.nof_posts==1) {sID.np=1; return false;}\r\n//      return posts_new && posts_new.length>0 && pref.threadStats.full && (!th.id && !th.unique_ips || th.unique_ips>sID.nid); // for thread moving, but this can't make an initial kick.(BUG)\r\n      return posts_new && posts_new.length>0 && pref.threadStats.full && !th.id && !th.unique_ips; // TEMPORAL PATCH, !th.id SHOULD BE REPLAED BY INFO IN boards.json\r\n    },\r\n    get_icon : function(pn,type,kind,tgt_th16){\r\n      return kind=='sticky'? pn.getElementsByClassName('stickyIcon')[0] : null;\r\n    },\r\n    add_icon : function(pn,type,kind,tgt_th16){\r\n      var icon = (kind==='sticky')? this.make_tack() : this.make_showAlways();\r\n      var ref;\r\n//      if (type==='catalog') {\r\n        ref = pn.getElementsByClassName('threadIcons')[0];\r\n        if (!ref) {\r\n          ref = document.createElement('div');\r\n          ref.setAttribute('class','threadIcons');\r\n          pn.insertBefore(ref,pn.getElementsByClassName('meta')[0]);\r\n        }\r\n        ref.appendChild(icon);\r\n//      } else {\r\n//        var op = pn.getElementsByClassName('op')[0];\r\n//        ref = op.getElementsByClassName('mentioned')[0] || op.getElementsByClassName('post_no')[1].nextSibling;\r\n//        ref.parentNode.insertBefore(icon,ref);\r\n//      }\r\n      return icon;\r\n    },\r\n  };\r\n  site2['4channel'] = {\r\n//    nickname:'4channel',\r\n    domain_url: 'boards.4channel.org',\r\n    check_func: site2['4chan'].check_func,\r\n    proto:'4chan'\r\n  };\r\n}\r\nif (pref.features.domains['meguca']) {\r\n  site2['meguca1'] = { // meguca.org v1\r\n    nickname : 'meguca',\r\n    protocol: 'https:',\r\n    home : 'https://meguca.org/favicon.ico',\r\n    domain_url: 'meguca.org',\r\n    domain_url_image: 'meguca.org',\r\n    features : {page: false, graph: false, setting2: false, thread_reader:false},\r\n//    features : {page: false, graph: false, setting2: false, thread_reader:false, catalog:false, setting: false}, // temporal\r\n    components: {\r\n      boardlist: '#navTop'\r\n    },\r\n    pref_default: {\r\n//      patch: {delayed_invoke: {use: true, sec:10}},\r\n      catalog:{image_hover:true},\r\n    },\r\n    boards_json:{boards:[{board:'a'}, {board:'an'}, {board:'cr'}, {board:'g'}, {board:'v'}]},\r\n    check_func : function(){\r\n      var href = window.location.href;\r\n      if (href.indexOf('/meguca.org/')!=-1) {\r\n        site.whereami = (href.indexOf('/catalog')!=-1)? 'catalog'\r\n                      : (href.search(/page[0-9]/)!=-1)? 'page'\r\n                      : (href.search(/[0-9]+$/)!=-1)? 'thread'\r\n//                      : (document.getElementsByTagName('title')[0] && document.getElementsByTagName('title')[0].textContent==='404')? '404' \r\n                      : 'other';\r\n        site.config('meguca.org',this.nickname);\r\n        site.max_page = 3;\r\n        site.header_height = function(){\r\n          var header = document.getElementById('banner');\r\n          if (header) return header.offsetHeight;\r\n          else return 0;\r\n        }\r\n////        site.myself = (site.whereami==='thread')? parseInt(href.replace(/.*res\\//,'').replace(/\\.html/,''),10) : 0;\r\n////        if (site.whereami==='thread' || site.whereami==='page') {\r\n////          site.embed_to['top']    = document.getElementsByName('postcontrols')[0];\r\n////          site.embed_to['bottom'] = document.getElementsByTagName('footer')[0];\r\n////        } else if (site.whereami==='catalog') {\r\n////          site.embed_to['top']    = document.getElementsByTagName('header')[0].nextSibling;\r\n////          site.embed_to['bottom'] = document.getElementsByTagName('footer')[0];\r\n////        }\r\n////        if (site.whereami==='thread' || site.whereami==='page') {\r\n//////          site.postform = document.getElementsByTagName('form')['post'].getElementsByTagName('tbody')[0];\r\n////          site.postform = document.getElementsByTagName('form')['post'];\r\n////          site.postform_comment = document.getElementById('body');\r\n////          this.postform_prep();\r\n////\r\n//////          var bar_bottom = document.getElementsByClassName('bottom')[0];\r\n//////////          site.root_body2 = bar_bottom.insertBefore(document.createElement('span'),bar_bottom.childNodes[1]); // working code.\r\n////////          site.root_body2 = document.getElementsByClassName('pages')[0];\r\n////////          site.root_body2.setAttribute('style','width:auto');\r\n//////////          site.root_body2 = document.getElementById('style-select');\r\n////        }\r\n////        pref.thread_reader.own_posts_tracker = true;\r\n////        setTimeout(function(){this.postprocess_board(this.boards_json)}.bind(this),0);\r\n        return true;\r\n      } else {\r\n        this.prep_own_posts(); // make own_posts structure WITH PROTOTYPE.\r\n        return false;\r\n      }\r\n    },\r\n    make_url4 : function(dbt){\r\n      var url_prefix  = this.protocol + '//' + this.domain_url; // force to use https:\r\n      if (dbt[3]==='page_json' && dbt[2]==0) dbt[3] = 'catalog_json'; // dbt[2] is string, === can't be used.\r\n      if      (dbt[3]==='page_html')    return [url_prefix + ((dbt[2]!=0)? (parseInt(dbt[2],10)+1) :''), 'html'];\r\n      else if (dbt[3]==='catalog_json') return [url_prefix + '/api/board'+ dbt[1].substr(0,dbt[1].length-1), 'json'];\r\n      else if (dbt[3]==='thread_html')  return [url_prefix + dbt[1] + dbt[2], 'html'];\r\n      else if (dbt[3]==='thread_json')  return [url_prefix + '/api/thread/' + dbt[2], 'json'];\r\n    },\r\n////    prep_own_posts_reg: /^4chan\\-track\\-[0-9A-z]+\\-[0-9]+$/,\r\n\r\n\r\n\r\n    catalog_get_native_area: function(){\r\n      return (site.whereami==='catalog')? document.getElementById('catalog') :\r\n                                          document.getElementsByName('postcontrols')[0];\r\n    },\r\n    catalog_native_prep: function(date,pn_filter,pn_tb,pn_hi){\r\n//      var node_ref = document.getElementsByClassName('catalog_search')[0].nextSibling;  // FF doesn't work.\r\n      var node_ref = (site.whereami==='catalog')? document.getElementsByTagName('threads')[0].getElementsByTagName('aside')[0] :\r\n                                                  document.getElementsByName('postcontrols')[0];\r\n      if (site.whereami==='catalog') {\r\n////        var selector_native = document.getElementById('sort_by');\r\n////        if (selector_native.selectedIndex!=0) {\r\n////          selector_native.selectedIndex = 0;\r\n////          var evt = document.createEvent('UIEvents');\r\n////          evt.initUIEvent('change', false, true, window, 1);\r\n////          selector_native.dispatchEvent(evt);\r\n////        }\r\n////        selector_native.style.display = 'none';\r\n////        document.getElementById('image_size').addEventListener('change', site2['lain'].catalog_native_size_changed, false);\r\n        var pn_tb_new = document.createElement('span');\r\n        while (pn_tb.firstChild) pn_tb_new.appendChild(pn_tb.firstChild);\r\n        pn_tb = pn_tb_new;\r\n        pn_tb.appendChild(pn_tb.removeChild(pn_tb.childNodes[3]).firstChild);\r\n        pn_tb.setAttribute('style','float:right');\r\n      } else if (site.whereami==='page') {\r\n        var pctrls = document.getElementsByName('postcontrols')[0];\r\n//        for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.removeChild(pctrls.childNodes[i]);\r\n        pctrls.parentNode.insertBefore(document.createElement('hr'),pctrls.nextSibling);\r\n      }\r\n//      node_ref.parentNode.insertBefore(pn_hi,node_ref);\r\n      if (site.whereami==='catalog') node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n      else node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n      node_ref.parentNode.insertBefore(pn_filter,document.getElementById('catalog'));\r\n      var selector_catchan = pn_filter.getElementsByTagName('select')['catalog.indexing'];\r\n      selector_catchan.setAttribute('style','float:left');\r\n      if (site.whereami==='catalog') node_ref.parentNode.insertBefore(selector_catchan,node_ref);\r\n      else pn_tb.childNodes[3].insertBefore(selector_catchan,pn_tb.childNodes[3].firstChild);\r\n//      pn_tb.childNodes[0].setAttribute('style',pn_tb.childNodes[0].getAttribute('style')+';display:none');\r\n//      pn_tb.childNodes[1].setAttribute('style',pn_tb.childNodes[1].getAttribute('style')+';display:none');\r\n\r\n      node_ref.setAttribute('style','float:left');\r\n      node_ref.parentNode.insertBefore(pn_tb.childNodes[3],node_ref.nextSibling);\r\n//      if (site.whereami==='catalog') document.getElementById('catalog').innerHTML = ''; // clear all thread.\r\n    },\r\n    catalog_json2html3 : function(obj,board,thumb_url, make_footer) {\r\n      var th = document.createElement('article');\r\n      var th_url = site2[obj.domain].make_url4([obj.domain,obj.board,obj.no,'thread_html'])[0];\r\n      var tn_w = obj.tn_w || obj.posts[0].tn_w;\r\n      var tn_h = obj.tn_h || obj.posts[0].tn_h;\r\n      var tn_f = 150 / ((tn_w>tn_h)? tn_w : tn_h);\r\n      var th_class_tn = (site2[obj.domain].historyAPI && pref.pref2.meguca.historyAPI)? 'history' : '';\r\n      var th_class    = th_class_tn + ' ' + pref.script_prefix +'_link';\r\n      var short_link = site2[obj.domain].short_link(obj.key, obj.nof_posts, 1, 'Last ', '');\r\n      th.innerHTML = '<a target=\"_blank\" rel=\"nofollow\" href=\"' + th_url + '\"' + ((th_class_tn)?' class=\"' + th_class_tn + '\"' : '') +'>'+\r\n                        '<img src=\"' + thumb_url + '\" width=\"' + (tn_w * tn_f) + '\" height=\"' + (tn_h * tn_f) + '\" class=\"expanded\">'+\r\n                     '</a>'+\r\n                     '<br>'+\r\n                     '<small>'+\r\n                     '<span title=\"Replies/Images\">'+ (make_footer? (obj.nof_posts-1) + '/' + (obj.nof_files-1):'')+ '</span>'+\r\n                       '<span class=\"act expansionLinks\">'+\r\n                         '<a href=\"' + th_url + '\" class=\"' + th_class + '\">Expand</a>'+\r\n//                         '] [<a href=\"' + th_url + '?last=100\" class=\"' + th_class + '\">Last 100</a>'+\r\n                         ((short_link)? '] [' + short_link : '')+\r\n                       '</span>'+\r\n                     '</small>'+\r\n                     '<br>'+\r\n                     ((obj.sub)? '<h3>' + obj.sub + ' </h3>' : '')+\r\n                     ((obj.com)? obj.com : '');\r\n      return th;\r\n    },\r\n    mark_newer_posts: function(th,date,unmark, short_cut) {\r\n      return site2['DEFAULT'].mark_newer_posts('meguca',th.getElementsByTagName('article'),date,null,unmark, short_cut);\r\n    },\r\n//    get_time_of_post_in_utc: function(post_pn){return this.parse_funcs.post_html.time_pn(post_pn);}, // TEMPORAL\r\n////////    mark_newer_posts : function(nickname,posts,date,style_mark,style_unmark,class_or_tag,key,unmark){\r\n//////////      var offset_top = 0;\r\n////////      var marked_first_post = null;\r\n////////      for (var i=posts.length-1;i>=0;i--) {\r\n////////        var mark = date<site2[nickname].get_time_of_post_in_utc(posts[i]);\r\n////////        var reply = posts[i];\r\n//////////        posts[i] = posts[i].parentNode;\r\n//////////        if (class_or_tag=='class') while (posts[i].className.search(key)==-1) posts[i] = posts[i].parentNode;\r\n//////////        if (class_or_tag=='tag') while (posts[i].tagName.search(key)==-1) posts[i] = posts[i].parentNode;\r\n////////        if (class_or_tag=='class') reply = posts[i].getElementsByClassName(key)[0];\r\n////////        if (class_or_tag=='tag')  reply = posts[i].getElementsByTagName(key)[0];\r\n////////        if (reply)\r\n////////          if (mark) {\r\n////////            reply.setAttribute('style',style_mark);\r\n////////            if (unmark) reply.addEventListener('mouseover', site2[nickname].unmark_post_from_event, false);\r\n//////////            offset_top = reply.offsetTop;\r\n////////            marked_first_post = reply;\r\n////////          } else reply.setAttribute('style',style_unmark);\r\n////////      }\r\n//////////      return offset_top;\r\n////////      return marked_first_post;\r\n////////    },\r\n////////    unmark_post_from_event: function() {\r\n////////      this.setAttribute('style','border: none');\r\n////////      this.removeEventListener('mouseover', site2['common'].unmark_post_from_event, false);\r\n////////    },\r\n\r\n\r\n    prep_own_posts_event : function(e){\r\n      if (e && e.key==='mine') site2['meguca'].prep_own_posts();\r\n      if (window.name==='meguca') send_message('parent',['OWN_POSTS', window.name, site3[window.name].own_posts['ALL']]);\r\n    },\r\n    prep_own_posts_event_received : function(val){\r\n      site3[this.nickname].own_posts['ALL'] = val;\r\n//      for (var i in val) site3[this.nickname].own_posts['ALL'][i] = null;\r\n    },\r\n    prep_own_posts : function(bt){\r\n      if (!site3[this.nickname].own_posts['ALL']) {\r\n        site3[this.nickname].own_posts['ALL'] = {};\r\n        var boards = ['/a/','/an/','/cr/','/g/'];\r\n        for (var i=0;i<boards.length;i++) site3[this.nickname].own_posts[boards[i]] = Object.create(site3[this.nickname].own_posts['ALL']);\r\n      }\r\n      if (localStorage) {\r\n        var nos = JSON.parse(localStorage['mine'] || '{}');\r\n        for (var j in nos) site3[this.nickname].own_posts['ALL'][j] = null;\r\n      }\r\n    },\r\n    wrap_to_parse: {\r\n      get: site2['DEFAULT'].wrap_to_parse.get,\r\n      posts: function(th){\r\n        delete Object.getPrototypeOf(th.posts[0]).com; // PATCH\r\n      },\r\n    },\r\n    short_link:function(name, nof_posts, num, kwd_head, kwd_tail){\r\n      var url = this.make_url4(common_func.name2dbt(name))[0];\r\n      var th_class = pref.script_prefix +'_link';\r\n      return ((!num || num>1)? '<a href=\"' + url + '?last=50' + '\" class=\"' + th_class + '\">' + kwd_head + '50' + kwd_tail + '</a>' : '') +\r\n             '<a href=\"' + url + '?last=100' + '\" class=\"' + th_class + '\">' + kwd_head + '100' + kwd_tail + '</a>';\r\n    },\r\n    catalog_json2html3_src: function(post){return (post.image)? '/static/src/'+post.image.src : undefined}, // TEMPORAL\r\n//    catalog_json2html3_thumbnail: function(post){return (post.image)? '/static/thumb/'+post.image.thumb : undefined}, // TEMPORAL\r\n    catalog_json2html3_thumbnail: function(post){\r\n      return (post.image)? '/static/'+ ((post.image.spoiler!==undefined && !pref[cataLog.embed_mode].open_spoiler_image)? 'spoil/spoilers'+post.image.spoiler+'.png' :\r\n                                        (post.image.thumb!==undefined)? 'thumb/' + post.image.thumb :\r\n                                                                        'src/' + post.image.src) : undefined;\r\n    },\r\n    post_json2html_fname_server: function(post){return (post.image)? post.image.src : undefined;},\r\n    post_json2html_fname: function(post){return (post.image)? post.image.imgnm : undefined;},\r\n    popups_href2dbtp: function(href){ //, src, th){\r\n//      if (href[0]==='#' && th) {\r\n//        href = th.board+href;\r\n//        src.setAttribute('href',href);\r\n//      }\r\n      var hrefs = href.split(/[\\/#]/);\r\n      var p = hrefs[hrefs.length-1];\r\n      var t = hrefs[hrefs.length-2];\r\n      var b = '/'+hrefs[hrefs.length-3]+'/';\r\n      return ['meguca',b,t,p]\r\n    },\r\n    link_dbtp2href: function(dbtp){\r\n      return dbtp[1] + dbtp[2] + '#' + dbtp[3];\r\n    },\r\n    time_offset: -5,\r\n    parse_funcs : { // meguca\r\n      'post_json' : {\r\n        get no()  {return this.num;},\r\n        get sub() {return this.subject;},\r\n//        get name() {return this.name;},\r\n        name:'Anonymous', // default value\r\n        get txt() {return this.body;},\r\n        get com() {return (this.body)? this.body.replace(this.anchor_regex,this.anchor_func) : '';},\r\n        get filename() {return (this.image)? this.image.imgnm : undefined;},\r\n        get w() {return (this.image)? this.image.dims[0] : undefined;},\r\n        get h() {return (this.image)? this.image.dims[1] : undefined;},\r\n        get tn_w() {return (this.image)? ((this.image.spoiler!==undefined && !pref[cataLog.embed_mode].open_spoiler_image)? 250 : this.image.dims[2]) : undefined;},\r\n        get tn_h() {return (this.image)? ((this.image.spoiler!==undefined && !pref[cataLog.embed_mode].open_spoiler_image)? 250 : this.image.dims[3]) : undefined;},\r\n        get fsize() {return (this.image)? this.image.size : undefined;},\r\n        get ext() {return (this.image)? this.image.ext : undefined;},\r\n        domain:'meguca',\r\n//        type_html: site.whereami,\r\n        get domain_html() {return site.nickname}, // mimic always\r\n        get parse_funcs_html() {return site2[site.nickname].parse_funcs[site.whereami+'_html'];},\r\n        anchor_regex: /(>>)([0-9]+)/g,\r\n        pn: undefined, // stop prototype chain.\r\n      },\r\n      'thread_json' : {\r\n        ths: function(obj, parse_obj){\r\n          var proto_obj = {\r\n            board: parse_obj.board,\r\n            anchor_func: (function(){\r\n              var htmls = ['<a href=\"' + parse_obj.board + parse_obj.thread + '#', '\">&gt;&gt;', '</a>'];\r\n              return function(str,ar,no){\r\n                return htmls[0] + no + htmls[1] + no + htmls[2];\r\n              };\r\n            })(),\r\n            get com() {return this.body;}, // PATCH\r\n            __proto__:site2[parse_obj.domain].parse_funcs.post_json\r\n          };\r\n////          for (var i=0;i<obj.length;i++) obj[i].__proto__ = site2[parse_obj.domain].parse_funcs.post_json;\r\n          var i=0;\r\n          while (i<obj.length && obj[i].state===undefined) obj[i++].__proto__ = proto_obj; // 'state' shows that a post is being typed.\r\n          if (i!==obj.length) obj.splice(i,obj.length-i);\r\n          return [{posts: obj, // ext: obj[0].ext, tim:obj[0].time, obj:null,\r\n                   nof_posts:obj.length,\r\n                   key: parse_obj.domain + parse_obj.board + parse_obj.thread, no: parse_obj.thread,\r\n                   __proto__:parse_obj}];\r\n        },\r\n        get_op_src: function(obj){return site2[obj.domain].protocol + '//' + site2[obj.domain].domain_url + '/static/'+ 'src/' + obj.posts[0].image.src;},\r\n        op_img_url: function(obj){return site2[obj.domain].protocol + '//' + site2[obj.domain].domain_url + '/static/'+ site2['meguca'].catalog_json2html3_thumbnail(obj.posts[0]);},\r\n//        op_img_url: function(obj){return site2[obj.domain].protocol + '//' + site2[obj.domain].domain_url + '/static/'+ // working code.\r\n//                                         ((obj.posts[0].image.spoiler!==undefined)? 'spoil/spoilers'+obj.posts[0].image.spoiler+'.png' :\r\n//                                          (obj.posts[0].image.thumb!==undefined)?   'thumb/' + obj.posts[0].image.thumb :\r\n//                                                                                    'src/' + obj.posts[0].image.src);},\r\n//        nof_posts: function(obj){return obj.posts.length;},\r\n        nof_files: function(obj){return obj.posts[0].imgctr -1;}, // patch\r\n////        nof_files: function(obj){\r\n////          var num = 0;\r\n////          for (var i=0;i<obj.posts.length;i++) if (obj.posts[i].image) num++;\r\n////          return num;\r\n////        },\r\n        time: function(obj){return obj.posts[0].time;},\r\n        time_posted: function(obj){return obj.posts[obj.posts.length-1].time;},\r\n        time_created: function(obj){return obj.posts[0].time;},\r\n        time_bumped: function(obj){\r\n          var i=obj.posts.length-1;\r\n          while (i>0) if (!obj.posts[i].email || obj.posts[i].email!=='sage') return obj.posts[i].time; else i++;\r\n          return obj.posts[0].time;\r\n        },\r\n        sticky: function(th){return false;},\r\n        com: function(obj){return obj.posts[0].body;},\r\n        sub: function(obj){return obj.posts[0].sub;},\r\n        name: function(obj){return obj.posts[0].name;},\r\n        filename: function(obj){return obj.posts[0].image.imgnm;},\r\n//        tn_w: function(obj){return obj.posts[0].tn_w;},\r\n//        tn_h: function(obj){return obj.posts[0].tn_h;},\r\n\r\n        type_com: 'txt',\r\n//        type_com: 'html',\r\n        time_unit: 1,\r\n\r\n//        tn_as: function(th){return th.pn.getElementsByTagName('a');}, // the same as DEFAULT\r\n        //        footer: function(th){return th.pn.getElementsByClassName('meta')[0];},\r\n\r\n//        add_op_img_url: site2['DEFAULT'].parse_parts.add_op_img_url,\r\n        add_op_img_url: function(posts,board,domain){\r\n          for (var i=0;i<posts.length;i++)\r\n            if (posts[i].image) posts[i].op_img_url = site2[domain].protocol + '//' + site2[domain].domain_url + '/static/thumb/' + posts[i].image.thumb;\r\n        },\r\n\r\n        footer: 'catalog_html',\r\n        footer_prep: 'catalog_html',\r\n        proto: 'DEFAULT.thread_json'\r\n      },\r\n      'catalog_html' : {\r\n        footer: function(th){return th.pn.getElementsByClassName('counters')[0];}, // v3.\r\n//        footer: function(th){return th.pn.getElementsByTagName('small')[0].getElementsByTagName('span')[0];}, // working code for v1, v2.\r\n        footer_prep: function(th){th.footer.textContent = '';},\r\n        ths: function(doc) {\r\n          if (!pref.pref2.meguca.historyAPI) {\r\n            var hist = doc.pn.getElementsByClassName('history');\r\n            for (var i=hist.length-1;i>=0;i--) {\r\n              if (hist[i].textContent==='Expand' || hist[i].textContent==='Last 100') hist[i].setAttribute('class',pref.script_prefix+'_link');\r\n              else hist[i].removeAttribute('class');\r\n            }\r\n          }\r\n          var ths = this.ths_array(doc,doc.pn.getElementsByTagName('article'));\r\n          if (site.board==='/all/') for (var i=ths.length-1;i>=0;i--) ths[i].board = ths[i].pn.getElementsByTagName('a')[0].getAttribute('href').replace(/\\d+$/,''); // for v3.\r\n          return ths;\r\n        },\r\n        no : function(th){return th.pn.getElementsByTagName('a')[0].getAttribute('href').replace(/.*\\//g,'');}, // 'replace' for ve.\r\n//        no : function(th){return th.pn.getElementsByTagName('a')[0].getAttribute('href');},\r\n        time_bumped: function(th){return undefined;},\r\n        time_created : function(th){return undefined;},\r\n        nof_posts: function(th){return parseInt(th.footer.textContent.split('/')[0],10);},\r\n        nof_files: function(th){return parseInt(th.footer.textContent.split('/')[1],10);},\r\n        sub: function(th){\r\n          var sub = th.pn.getElementsByTagName('h3')[0];\r\n          return (sub)? common_func.escape(sub.textContent) : undefined;\r\n        },\r\n        name: function(th){return undefined;},\r\n        com: function(th){return th.pn.childNodes[th.pn.childNodes.length-1].textContent;},\r\n        sticky: function(th){return false;},\r\n////////        tn_as: function(th){return th.pn.getElementsByTagName('a');},\r\n////////        tn_imgs: function(th){return (th.tn_as[0])? [th.tn_as[0].getElementsByTagName('imgs')[0]] : [];},\r\n////////        class_thread: 'thread',\r\n////////        class_thumbnail: 'thumb',\r\n//////////        op_img_url: function(th){ // working code.\r\n//////////          var img = th.pn.getElementsByTagName('img')[0];\r\n//////////          return (img)? img.getAttribute('src') : undefined; // patch.\r\n//////////        },\r\n        op_img_url: function(th){\r\n          var img = th.pn.getElementsByTagName('img')[0];\r\n          return img && img.getAttribute('src') || '';},\r\n        get_op_src: function(th){return th.op_img_url.replace(/thumb/,'src');}, // patch\r\n        dynamic_image_hover: true,\r\n        missing_info: 1,\r\n        img2src: function(img, lth){\r\n          if (!lth) lth = this.get_lth_from_node(img);\r\n          if (!lth) return null;\r\n          var src = img.src;\r\n          if (lth.th && lth.th.posts[0].ext) src = src.replace(/thumb/,'src').replace(/\\.\\w+$/,lth.th.posts[0].ext);\r\n          else if (lth.th.parse_funcs.missing_info) scan.scan_ui('image_hover', {tgts: [lth.key], options:{callback:function(){cataLog.image_hover_reentry(img);}, priority:6}}); // NEVER ACTIVATED because catalog.json is read always at initial\r\n          return src;\r\n        },\r\n      },\r\n      'post_html' : {\r\n        time_pn: function(post_pn){\r\n          var time_node = post_pn.getElementsByTagName('time')[0];\r\n          return Date.parse(time_node.title || time_node.textContent) + (pref.localtime_offset - site2['meguca'].time_offset) * 3600000;}, // timezone -5\r\n        pn_name: function(post){return post.pn.getElementsByClassName('name')[0];}, // same as vichan.\r\n      },\r\n    },\r\n    general_event_handler:{\r\n      page:{\r\n        mouseover: function(e){}, // patch for test_mode['98']\r\n      },\r\n      catalog:{\r\n//        mouseover: function(e){ // working code\r\n//          var et = e.target;\r\n//          var et_tagName = et.tagName;\r\n//          if (et_tagName==='IMG')\r\n//            if (pref[cataLog.embed_mode].image_hover && et.parentNode.tagName==='A') cataLog.image_hover_add.call(et, e);\r\n//        },\r\n        image_hover_check_mode: function(img){\r\n          return img.parentNode.parentNode.parentNode.parentNode.id==='catalog'? 'catalog' : 'page';\r\n        },\r\n        recSearch_thread: function(tgt,ecT){\r\n          while (tgt && tgt!=ecT) {\r\n            if (tgt.classList && tgt.classList.contains('op')) return tgt;\r\n            else tgt = tgt.parentNode;\r\n          }\r\n          return null;\r\n        },\r\n        __proto__: site2['DEFAULT'].general_event_handler.catalog\r\n      },\r\n    },\r\n    favicon : {\r\n      __proto__: site2['DEFAULT'].favicon,\r\n      none: '/static/favicon.ico',\r\n      reply: '/static/css/ui/unreadFavicon.ico',\r\n      reply_to_me: '/static/css/ui/replyFavicon.ico',\r\n    },\r\n    make_tack: function(){\r\n      var tack = document.createElement('div');\r\n      tack.innerHTML = '<svg class=\"sticky\" xmlns=\"http://www.w3.org/2000/svg\" width=\"8\" height=\"8\" viewBox=\"0 0 8 8\"><path d=\"M1.34 0a.5.5 0 0 0 .16 1h.5v2h-1c-.55 0-1 .45-1 1h3v3l.44 1 .56-1v-3h3c0-.55-.45-1-1-1h-1v-2h.5a.5.5 0 1 0 0-1h-4a.5.5 0 0 0-.09 0 .5.5 0 0 0-.06 0z\"></path></svg>';\r\n      return tack.childNodes[0];\r\n    },\r\n  };\r\n  site2['meguca2'] = { // meguca.org v2\r\n    home: 'https://meguca.org/assets/favicons/default.ico',\r\n    components: {\r\n      boardlist: '#banner', // '#board-navigation'\r\n    },\r\n    boards_json: undefined, // terminate prototype chain\r\n    check_func: function(reentry){ // required to be a own property.\r\n      var href = window.location.href;\r\n      if (href.indexOf('/meguca.org/')!=-1) {\r\n        site.whereami = (href.search(/[A-z]+\\/(\\?page=\\d+)*$/)!=-1)? 'page'\r\n                      : (href.search(/[0-9]+(\\?last=\\d+)*$/)!=-1)? 'thread'\r\n                      : (href.search(/catalog\\/*$/)!=-1)? 'catalog' : 'other';\r\n        site.config('meguca.org',this.nickname, reentry);\r\n        site.no = (site.whereami==='thread')? parseInt(href.replace(/.*meguca\\.org\\/\\w*\\/([0-9]+)/,'$1'),10) : '';\r\n        if (site.whereami==='page') {\r\n          var idx = href.indexOf('?page=');\r\n          site.page = idx!=-1 && parseInt(href.substr(idx+6),10) || 0;\r\n        } else site.page = null;\r\n        if (reentry) return;\r\n        site.max_page = 3;\r\n        site.header_height = function(){\r\n          var header = document.getElementById('banner');\r\n          return (header)? header.offsetHeight : 0;\r\n        }\r\n        return true;\r\n      } else {\r\n//        this.prep_own_posts(); // make own_pxoosts structure WITH PROTOTYPE.\r\n        return false;\r\n      }\r\n    },\r\n    check_func_whereami: function(){\r\n    },\r\n////    url_boards_json : function(){return ['https://meguca.org/json/boardList', 'json'];}, // working code.\r\n////    postprocess_board: function(val){\r\n////      for (var i=0;i<val.length;i++) {\r\n////        var bd = liveTag.mems.init({domain:this.nickname, board:'/'+val[i].id+'/'});\r\n////        bd.o = i;\r\n////        if (val[i].tags && val[i].tags.length!=0) liveTag.postprocess_board_add_btag(val[i].tags,bd);\r\n////      }\r\n////    },\r\n    utilize_boards_json: true,\r\n    url_boards_json : function(){return ['https://meguca.org/json/boardTimestamps', 'json'];}, // need to be debugged\r\n    postprocess_board: function(val){\r\n      var order = 0;\r\n      for (var i in val) {\r\n        var bd = liveTag.mems.init({domain:this.nickname, board:'/'+i+'/'});\r\n        bd.o = order++;\r\n        Object.defineProperty(bd,'max',{value:val[i], writable:true});\r\n        if (bd.read_max===undefined) Object.defineProperty(bd,'read_max',{value:0, writable:true});\r\n//        if (val[i].tags && val[i].tags.length!=0) liveTag.postprocess_board_add_btag(val[i].tags,bd);\r\n      }\r\n    },\r\n    make_url4 : function(dbt){\r\n      var url_prefix  = this.protocol + '//' + this.domain_url; // force to use https:\r\n      if (dbt[3].substr(0,4)==='page' && dbt[2]==0) dbt[3] = 'catalog_json'; // dbt[2] is string, === can't be used.\r\n//      if      (dbt[3]==='page_html')    return [url_prefix + ((dbt[2]!=0)? (parseInt(dbt[2],10)+1) :''), 'html'];\r\n      return (dbt[3]==='catalog_json')? [url_prefix + '/json'+ dbt[1], 'json', 'meguca' + dbt[1] + 'j0'] :\r\n             (dbt[3]==='thread_html')?  [url_prefix + dbt[1] + dbt[2], 'html'] :\r\n             (dbt[3]==='thread_json')?  [url_prefix + '/json'+ dbt[1]+dbt[2], 'json'] : undefined;\r\n    },\r\n//    trim_list: 'force_init', // catalog_json is changed to have no posts. // this way is more optimized than fetching each thread when some threads are watched.\r\n    catalog_get_native_area: function(){\r\n      return document.getElementById((site.whereami==='catalog')? 'catalog'\r\n                                   : (site.whereami==='page')?    'index-thread-container' : 'threads');\r\n    },\r\n    catalog_get_native_scroll_area: function(){\r\n      return (site.whereami==='catalog')? document.getElementsByTagName('section')[1] : window;\r\n    },\r\n    catalog_native_prep_wait_loop_timeout: 100,\r\n    catalog_native_prep_wait_loop: function(whereami, callback){\r\n      if (--this.catalog_native_prep_wait_loop_timeout<0) return;\r\n      if ((whereami==='catalog' && (!document.getElementsByName('sortMode')[0])) ||\r\n          (whereami==='page' &&    (!document.getElementById('catalog-controls') || !document.getElementById('index-thread-container'))) ||\r\n          (whereami==='thread' &&  (!document.getElementById('expand-images') || !document.getElementById('threads')))\r\n         ) setTimeout(function(){this.catalog_native_prep_wait_loop(whereami,callback);}.bind(this),1000);\r\n      else callback();\r\n    },\r\n    catalog_native_prep: function(date,pn_filter,pn_tb,pn_hi){\r\n//      var node_ref = document.getElementsByClassName('catalog_search')[0].nextSibling;  // FF doesn't work.\r\n//      var node_ref = (site.whereami==='catalog')? document.getElementById('threads').getElementsByTagName('aside')[0] :\r\n      var node_ref = (site.whereami==='catalog')? document.getElementsByName('sortMode')[0]\r\n                   : (site.whereami==='page')? document.getElementById('catalog-controls').getElementsByTagName('input')['search']\r\n                   : document.getElementById('expand-images'); // .parentNode.nextSibling;\r\n      if (site.whereami==='catalog' && node_ref.nextSibling===cataLog.components.catalog.indexing) return; // return if just focused, not entered from transition.\r\n//      if (pn_tb.childNodes[3] && pn_tb.childNodes[3].ondblclick) cnst.tb_prep_for_embed(pn_tb);\r\n//      if (site.whereami==='catalog' || site.whereami==='page') {\r\n        if (!cataLog.components.initialized) {\r\n//          var pn_tb_new = document.createElement('span');\r\n//          while (pn_tb.firstChild) pn_tb_new.appendChild(pn_tb.firstChild);\r\n//          pn_tb = pn_tb_new;\r\n          pn_tb.setAttribute('style','float:right');\r\n          cataLog.components.pn12_0 = pn_tb;\r\n          cataLog.components.pn_hi = pn_tb.removeChild(pn_tb.childNodes[3]); //.firstChild;\r\n          var redraw = function(){\r\n////            console.log('redraw');\r\n            cataLog.catalog_obj2.func_track_reset();\r\n            cataLog.insert_myself(null,null,null,true);\r\n            cataLog.show_catalog();\r\n          }\r\n//          var reentry_tap = function(e){\r\n//////            console.log('reentry');\r\n//            observer3.disconnect();\r\n////            this.catalog_native_prep(null, pn_filter, pn_tb);\r\n////            if (this.catalog_get_native_area()!=cataLog.components.initialized) { // doesn't work\r\n////              console.log('found background refresh');\r\n////              cataLog.components.initialized = this.catalog_get_native_area();\r\n//          }; // .bind(this);\r\n//          window.addEventListener('focus', reentry_tap, false);\r\n\r\n          var updated_by_native = false;\r\n          var observe_native_bg = function(e){\r\n//            updated_by_native = true;\r\n////            console.log('found an update in background');\r\n\r\n            if (pref[site.whereami].embed) { // test\r\n//              observer3.disconnect();\r\n//              cataLog.catalog_obj2.masked = false;\r\n              cataLog.general_event_handler.destroy();\r\n//              cataLog.triage.off();\r\n              cataLog.triage_parent_set();\r\n              cataLog.general_event_handler = new cataLog.GEH(cataLog.parent);\r\n              cataLog.general_event_handler.init();\r\n              redraw();\r\n              site2['meguca'].catalog_native_prep(null, pn_filter, pn_tb);\r\n//              blur_tap();\r\n            }\r\n\r\n          };\r\n          var observer3 = new MutationObserver(observe_native_bg);\r\n//          var blur_tap = function(){\r\n//////            console.log('start observe...');\r\n////            observer3.observe(cataLog.parent, {childList: true}); // doesn't work\r\n            observer3.observe(document.getElementById('threads'), {childList: true});\r\n////            cataLog.catalog_obj2.masked = true;\r\n//          };\r\n//          window.addEventListener('blur', blur_tap, false);\r\n          pref_func.settings.onchange_funcs['button_test'] = observe_native_bg; // test\r\n\r\n          var loading_image = document.getElementById('loading-image');\r\n          var skip_initial_call = loading_image.style.display!=='none';\r\n          var observer_tap = function(e){\r\n            if (e[0].target.style.display!=='none') {\r\n              site2['meguca'].historyAPI_blocking = true;\r\n              if (site.whereami==='thread') site2['meguca'].prep_own_posts(); // patch for IDB, but BUG, this has a racing condition.\r\n            } else {\r\n              site2['meguca'].historyAPI_blocking = false;\r\n              if (!skip_initial_call) {\r\n////                console.log('mascot off');\r\n                cataLog.DIH.image_hover_remove();\r\n                cataLog.general_event_handler.destroy();\r\n//                cataLog.triage.off();\r\n                for (var name in cataLog.threads) cataLog.gClg.remove_thread(name, true);\r\n//                for (var name in cataLog.threads) if (cataLog.threads[name][1]) if (cataLog.catalog_obj2.func_hide(name)) cataLog.threads[name][1] = false;\r\n\r\n                site2['meguca'].check_func(true);\r\n                if (pref[site.whereami].embed) { // using site.whereami instead of cataLog.embed_mode\r\n//                  cataLog.catalog_obj2.masked = false;\r\n                  cataLog.set_embed_xxxx(); // this changes embed_mode\r\n                  cataLog.triage_parent_set();\r\n                  cataLog.general_event_handler = new cataLog.GEH(cataLog.parent);\r\n                  cataLog.general_event_handler.init();\r\n//                  if (!pref.test_mode['90']) {\r\n                  if ((site.whereami==='catalog' || site.whereami==='page') && !pref.test_mode['90']) redraw();\r\n                  site2['meguca'].catalog_native_prep(null, pn_filter, pn_tb);\r\n//                  reentry_tap(); // WILL call show_catalog here, from pref3.catalog.filter.kwd.clear()\r\n                } // else cataLog.catalog_obj2.masked = true;\r\n                recovery.reentry();\r\n                receive_message_emu();\r\n              }\r\n              skip_initial_call = false;\r\n            }\r\n          };\r\n          var observer = new MutationObserver(observer_tap);\r\n//          observer.observe(document.getElementById('page-container'), {childList: true});\r\n          observer.observe(loading_image, {attributes: true});\r\n////          window.addEventListener('popstate', function(event) {console.log(\"onpopstate: location: \" + document.location + \", state: \" + JSON.stringify(event.state));}, false); // doesn't work\r\n//////          setTimeout(function(){require('state').page.onChange('thread', function(e){\r\n//////            console.log('state_changed: ',e);\r\n//////          });},30000);\r\n////          setTimeout(function(){ // working code, but spec was changed on 2017.06.12\r\n////            var test_func = function(e){console.log('state changed');};\r\n////            var div = document.createElement('div');\r\n////            div.id = 'CatChan_csi';\r\n////            div.setAttribute('data-csi',0);\r\n//////            div.textContent = 0;\r\n//////            div.onclick = test_func; // can't call\r\n////            site.script_body.appendChild(div);\r\n////            var scr = document.createElement('script');\r\n////            scr.setAttribute('type', 'application/javascript');\r\n//////            scr.textContent = 'console.log(\"Hello\");';\r\n//////            scr.textContent = 'console.log(require(\"state\"));';\r\n//////            scr.textContent = 'var tgt_func = document.getElementById(\"CatChan_csi\").onclick;'+\r\n//////                              'require(\"state\").page.onChange(\"thread\", tgt_func);';\r\n////            scr.textContent = 'var tgt = document.getElementById(\"CatChan_csi\");'+\r\n//////                              'function mutate(){tgt.textContent+=1;}'+\r\n////                              'function mutate(){tgt.setAttribute(\"data-csi\",parseInt(tgt.getAttribute(\"data-csi\"),10)+1);}'+\r\n////                              'require(\"state\").page.onChange(\"thread\", mutate);'+\r\n////                              'require(\"state\").page.onChange(\"page\", mutate);'+\r\n////                              'require(\"state\").page.onChange(\"catalog\", mutate);';\r\n////            site.script_body.appendChild(scr);\r\n////            site.script_body.removeChild(scr);\r\n////            var observer2 = new MutationObserver(test_func);\r\n////            observer2.observe(div, {attributes: true});\r\n//////            observer2.observe(div.childNodes[0], {attributes: true, characterData: true});\r\n//////            console.log('unsafeWindow: ');\r\n//////            unsafeWindow.require('state').page.onChange('thread', function(e){\r\n//////              console.log('state_changed: ',e);\r\n//////            });\r\n////          },10000);\r\n        }\r\n//      } else if (site.whereami==='page') {\r\n////        var pctrls = document.getElementsByName('postcontrols')[0];\r\n//////        for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.removeChild(pctrls.childNodes[i]);\r\n////        pctrls.parentNode.insertBefore(document.createElement('hr'),pctrls.nextSibling);\r\n//      }\r\n//      node_ref.parentNode.insertBefore(pn_hi,node_ref);\r\n      if (site.whereami==='catalog') {\r\n        node_ref.parentNode.appendChild(pn_tb);\r\n        node_ref.parentNode.parentNode.insertBefore(cataLog.components.pn_hi, node_ref.parentNode);\r\n      } else {\r\n        node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n        node_ref.parentNode.insertBefore(cataLog.components.pn_hi, node_ref);\r\n      }\r\n      if (site.whereami==='catalog') {\r\n        var ctlg = document.getElementById('catalog');\r\n        ctlg.parentNode.insertBefore(pn_filter,ctlg);\r\n      } else node_ref.parentNode.insertBefore(pn_filter,document.getElementById('catalog'));\r\n      if (site.whereami==='catalog') site2['DEFAULT'].catalog_native_prep_swap_sortSel(node_ref);\r\n      else {\r\n//        var selector_catchan = pn_filter.getElementsByTagName('select')['catalog.indexing'];\r\n//        selector_catchan.setAttribute('style','float:left');\r\n//        if (!cataLog.components.initialized) pn_tb.childNodes[3].insertBefore(cataLog.components.catalog.indexing, pn_tb.childNodes[3].firstChild);\r\n        node_ref.parentNode.insertBefore(cataLog.components.catalog.indexing, node_ref.nextSibling);\r\n//        node_ref.setAttribute('style','float:left');\r\n      }\r\n//      pn_tb.childNodes[0].setAttribute('style',pn_tb.childNodes[0].getAttribute('style')+';display:none');\r\n//      pn_tb.childNodes[1].setAttribute('style',pn_tb.childNodes[1].getAttribute('style')+';display:none');\r\n//      if (site.whereami!=='catalog' && !cataLog.components.initialized) node_ref.parentNode.insertBefore(pn_tb.childNodes[3],node_ref.nextSibling);\r\n      if (site.whereami=='catalog' || site.whereami=='page') {\r\n        document.getElementById('banner').style=\"height:auto\";\r\n        pref3.catalog.filter.kwd.init(document.getElementById('catalog-controls').getElementsByTagName('input')['search'], pn_filter);\r\n      }\r\n      cataLog.components.initialized = true; // this.catalog_get_native_area();\r\n    },\r\n//    catalog_native_prep: function(date,pn_filter,pn_tb,pn_hi){ // working code\r\n//      //      var node_ref = document.getElementsByClassName('catalog_search')[0].nextSibling;  // FF doesn't work.\r\n//      //      var node_ref = (site.whereami==='catalog')? document.getElementById('threads').getElementsByTagName('aside')[0] :\r\n//      var node_ref = (site.whereami==='catalog')? document.getElementsByName('sortMode')[0] :\r\n//            document.getElementById('expand-images').parentNode.nextSibling;\r\n//      cnst.tb_prep_for_embed(pn_tb);\r\n//      if (site.whereami==='catalog') {\r\n//        var pn_tb_new = document.createElement('span');\r\n//        while (pn_tb.firstChild) pn_tb_new.appendChild(pn_tb.firstChild);\r\n//        pn_tb = pn_tb_new;\r\n//        pn_tb.setAttribute('style','float:right');\r\n//        pn_tb.setAttribute('style','float:right');\r\n//      } else if (site.whereami==='page') {\r\n//        var pctrls = document.getElementsByName('postcontrols')[0];\r\n//        //        for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.removeChild(pctrls.childNodes[i]);\r\n//        pctrls.parentNode.insertBefore(document.createElement('hr'),pctrls.nextSibling);\r\n//      }\r\n//      //      node_ref.parentNode.insertBefore(pn_hi,node_ref);\r\n//      if (site.whereami==='catalog') {\r\n//        node_ref.parentNode.appendChild(pn_tb);\r\n//        node_ref.parentNode.parentNode.insertBefore(pn_tb.removeChild(pn_tb.childNodes[3]).firstChild, node_ref.parentNode);\r\n//      } else node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n//      if (site.whereami==='catalog') {\r\n//        var ctlg = document.getElementById('catalog');\r\n//        ctlg.parentNode.insertBefore(pn_filter,ctlg);\r\n//      } else node_ref.parentNode.insertBefore(pn_filter,document.getElementById('catalog'));\r\n//      var selector_catchan = pn_filter.getElementsByTagName('select')['catalog.indexing'];\r\n//      selector_catchan.setAttribute('style','float:left');\r\n//      if (site.whereami==='catalog') node_ref.parentNode.insertBefore(selector_catchan,node_ref);\r\n//      else pn_tb.childNodes[3].insertBefore(selector_catchan,pn_tb.childNodes[3].firstChild);\r\n//      //      pn_tb.childNodes[0].setAttribute('style',pn_tb.childNodes[0].getAttribute('style')+';display:none');\r\n//      //      pn_tb.childNodes[1].setAttribute('style',pn_tb.childNodes[1].getAttribute('style')+';display:none');\r\n//\r\n//      node_ref.setAttribute('style','float:left');\r\n//      if (site.whereami!=='catalog') node_ref.parentNode.insertBefore(pn_tb.childNodes[3],node_ref.nextSibling);\r\n//      if (site.whereami=='catalog') {\r\n//        node_ref.style.display = 'none';\r\n//        document.getElementById('banner').style=\"height:auto\";\r\n//        var search = document.getElementById('catalog-controls').getElementsByTagName('input')['search'];\r\n//        var search2 = search.cloneNode(false);\r\n//        search2.name = 'catalog.filter.kwd.str';\r\n//        search2.oninput = cataLog.event_func;\r\n//        search.parentNode.insertBefore(search2,search);\r\n//        search.setAttribute('style','display:none');\r\n//        pref3.catalog.filter.kwd.obj = [pn_filter.getElementsByTagName('input')['catalog.filter.kwd.str'], search2];\r\n//        pref3.catalog.filter.kwd.clear();\r\n//      }\r\n//    },\r\n    post_json2html: site2['4chan'].post_json2html,\r\n    page_json2html3_skelton: site2['4chan'].page_json2html3_skelton,\r\n    page_json2html3: site2['4chan'].page_json2html3,\r\n    page_json2html3_replace_expander: site2['4chan'].page_json2html3_replace_expander,\r\n    page_json2html3_add_omitted_info: site2['4chan'].page_json2html3_add_omitted_info,\r\n    post_container: site2['4chan'].post_container,\r\n    wrap_to_parse: site2['DEFAULT'].wrap_to_parse, // bypass meguca1\r\n    catalog_json2html3_thumbnail: function(post){\r\n      return (post.image)? this.protocol + '//' + this.domain_url_image + // fullpath is required for desktopNotification.\r\n        ((post.image.spoiler!==undefined && !pref[cataLog.embed_mode].open_spoiler_image)? '/spoil/default.jpg' :\r\n        (post.image.thumbType===14)? '/audio.png' :\r\n        '/images/thumb/' + post.image.SHA1 + ((post.image.thumbType===0 || post.image.thumbType===undefined && post.image.fileType===0)? '.jpg' : '.png')) : undefined;\r\n//        '/images/thumb/' + post.image.SHA1 + ((post.image.fileType===0)? '.jpg' : '.png')) : undefined;\r\n    },\r\n//    catalog_json2html3_src: (function(){\r\n//      var fileType = ['jpg', 'png', 'gif', 'webm', 'pdf', 'svg', 'mp4', 'mp3', 'ogg'];\r\n//      return function(post){return (post.image)? '/images/src/' + post.image.SHA1 + '.' + fileType[post.image.fileType] : undefined;};\r\n//    })(),\r\n    catalog_json2html3_src: function(post){\r\n      return (post.image)? this.protocol + '//' + this.domain_url_image + '/images/src/' + post.image.SHA1 +\r\n                             (post.ext || Object.getOwnPropertyDescriptor(this.parse_funcs.post_json_template, 'ext').get.call(post)) // for archive. It's before wrap. <- REALLY?\r\n                         : undefined;},\r\n//    catalog_json2html3_src: function(post){return (post.image)? '/images/src/' + post.image.SHA1 + (post.ext || Object.getOwnPropertyDescriptor(this.parse_funcs.post_json_template, 'ext').get.call(post)) :\r\n//                                                                undefined;}, // for archive. It's before wrap.\r\n//    catalog_json2html3_src: function(post){return (post.image)? '/images/src/' + post.image.SHA1 + post.ext : undefined;},\r\n    post_json2html_fname_server: function(post){return (post.image)? post.image.SHA1 + ((post.image.fileType===0)? '.jpg' : '.png') : undefined;},\r\n    post_json2html_fname: function(post){return (post.image)? post.filename + post.ext : undefined;},\r\n    parse_funcs: {\r\n      'page_html': { // for popup\r\n        get_omitted_info: site2['4chan'].parse_funcs.page_html.get_omitted_info,\r\n        set_omitted_info: site2['4chan'].parse_funcs.page_html.set_omitted_info,\r\n        replace_omitted_info: site2['4chan'].parse_funcs.page_html.replace_omitted_info,\r\n        replace_omitted_info2: site2['4chan'].parse_funcs.page_html.replace_omitted_info2,\r\n      },\r\n      'thread_json' : {\r\n        ths: function(obj, parse_obj) {\r\n          var th = this.prep_th_posts(obj);\r\n          th.nof_posts = th.posts.length; // for not being reduced if posts are sliced.\r\n          obj.__proto__ = parse_obj;\r\n//          if (pref.catalog.filter.kwd.post) site2['meguca'].wrap_to_parse.posts(th); // patch for each posts' \"com\". // v3 // patched in catalog_filter_query_keyword.query_11\r\n//          if (pref.catalog.filter.kwd.post) site2['DEFAULT'].wrap_to_parse.posts(th); // patch for each posts' \"com\". // v2\r\n          return [th];\r\n        },\r\n        prep_th_posts: function(obj){ // API was changed on 2017.02.19.\r\n          var th = Object.create(obj); // keep original as it is for archiving.\r\n          if (th.sticky) th.sticky = true; // overwrite property of the same name before setting prototype to use polarity.\r\n          th.board = '/' + obj.board +'/';\r\n          obj.no = obj.id || obj.no; // '|| obj.no' for restoring from archive.\r\n          delete obj.id;\r\n          var posts = [obj];\r\n////          var flag = false; // working code -2016.10.06\r\n////          var max_no = 0;\r\n////          for (var i in th.posts) {\r\n          if (obj.posts) for (var i=0;i<obj.posts.length;i++) {\r\n            var post = obj.posts[i];\r\n//            if (pref.test_mode['72'] && post.editing) break; // static for live tagging and archiving, extraction will be done before finishing the posts.\r\n            if (post.id) {\r\n              post.no = post.id;\r\n              delete post.id;\r\n            }\r\n            posts[posts.length] = post;\r\n////            if (max_no>post.no) flag = true;\r\n////            max_no = post.no;\r\n          }\r\n////          if (flag) posts.sort(function(a,b){return a.no - b.no;});\r\n////          th.posts_obj = th.posts;\r\n          th.posts = posts;\r\n          return th;\r\n        },\r\n        get_op_src: function(obj){return site2[obj.domain].catalog_json2html3_src(obj.posts[0]);},\r\n        op_img_url: 'DEFAULT.common', // function(th) {return site2['meguca'].catalog_json2html3_thumbnail(th, th.board);},\r\n//        op_img_url: function(obj){return site2[obj.domain].protocol + '//' + site2[obj.domain].domain_url + site2['meguca'].catalog_json2html3_thumbnail(obj.posts[0]);},\r\n//        add_op_img_url: site2['DEFAULT'].parse_parts.add_op_img_url,\r\n        time_unit: 1000,\r\n        type_com: 'txt',\r\n//        posts_full: 'DEFAULT.catalog_json',\r\n        posts_full: null,\r\n        has_editing: true,\r\n        posts_obj: function(th,no_in){\r\n          var posts_obj = {};\r\n          var i=th.posts.length;\r\n          while (--i>=0) {\r\n            var no = th.posts[i].no;\r\n            posts_obj[no] = th.posts[i];\r\n            if (no===no_in) break;\r\n          }\r\n          return posts_obj;\r\n//          th.posts_obj = posts_obj;\r\n//          return posts_obj[no_in];\r\n        },\r\n        key: 'DEFAULT.common',\r\n      },\r\n      'catalog_json': {\r\n        ths: function(obj, parse_obj) {\r\n          var ths = [];\r\n          var page_base = parseInt(parse_obj.page || 0, 10);\r\n          if (obj.threads) obj = obj.threads; // for v2\r\n          for (var j=0;j<obj.length;j++) {\r\n            var th = this.prep_th_posts(obj[j]);\r\n            th.page = (page_base + Math.floor(j/15)) + '.' + j%15;\r\n//            if (th.sticky) th.sticky = true; // overwrite property of the same name before setting prototype to use polarity.\r\n//            th.board = '/' + th.board +'/';\r\n//            obj[j].no = th.id;\r\n//            delete obj[j].id;\r\n//            th.posts = [th.__proto__];\r\n//            th.posts_obj = {};\r\n//            th.posts_obj[th.no] = th.posts[0];\r\n            obj[j].__proto__ = parse_obj;\r\n            ths[ths.length] = th;\r\n          }\r\n          return ths;\r\n        },\r\n//        footer: function(th){return th.pn.getElementsByClassName('meta')[0];},\r\n//        posts: 'DEFAULT.catalog_json',\r\n//        posts: function(th){\r\n//          var posts = site2['DEFAULT'].parse_funcs.catalog_json.posts(th);\r\n//          if (th.last_replies) posts = posts.concat(th.last_replies);\r\n//          return posts;\r\n//        },\r\n//        has_editing: false,\r\n        has_posts: true, // API was changed on 2017.02.19. // false,\r\n//        missing_info: 1, // API was changed on 2017.02.19. // com is missing.\r\n        proto: 'thread_json',\r\n      },\r\n      'shortCatalog_json_template': {\r\n        proto: 'catalog_json_template'\r\n      },\r\n      'page_json_template': {\r\n        proto: 'catalog_json_template'\r\n      },\r\n      'catalog_json_template': {\r\n        dont_have_com: true,\r\n        get nof_posts(){return this.postCtr;}, // v3\r\n//        get nof_posts(){return this.postCtr+1;}, // v2\r\n//        com: '', // doesn't have this. // changed.\r\n//        get max(){return this.lastUpdated;},\r\n        proto: 'thread_json_template'\r\n      },\r\n      'thread_json_template': {\r\n        get time_posted(){return this.replyTime*1000;},\r\n        get time_bumped(){return this.bumpTime*1000;},\r\n        get time_created(){return this.time*1000;},\r\n//        get nof_posts(){return this.posts.length;}, // remove editing posts. // BUG. reduced if posts are sliced.\r\n        get nof_files(){return this.imageCtr;},\r\n        get com(){return this.body;},\r\n        proto: 'post_json_template'\r\n      },\r\n      'post_json': {\r\n        anchor: function(board,op,no, cross, href){\r\n          if (!href) href = ((cross)? '/all/' : board) + '#p' + no;\r\n          return '<em>'+\r\n                   '<a class=\"history post-link\" data-id=\"' + no + '\" href=\"' + href + '\">&gt;&gt;' + no + '</a>'+\r\n                   '<a class=\"hash-link history\" href=\"' + href + '\"> #</a> '+\r\n                 '</em>';\r\n        },\r\n      },\r\n      'post_json_template': (function(){\r\n        var fileType = ['jpg', 'png', 'gif', 'webm', 'pdf', 'svg', 'mp4', 'mp3', 'ogg', 'zip', '7z', 'tar.gz', 'tar.xz', 'flac', 'noFile', 'txt'];\r\n        return {\r\n          get filename() {return (this.image)? this.image.name : undefined;},\r\n          get w(){return (this.image)? this.image.dims[0] : undefined;},\r\n          get h(){return (this.image)? this.image.dims[1] : undefined;},\r\n          get tn_w(){return (this.image)? ((this.image.spoiler!==undefined && !pref[cataLog.embed_mode].open_spoiler_image)? 150 : this.image.dims[2] || 125) : undefined;},\r\n          get tn_h(){return (this.image)? ((this.image.spoiler!==undefined && !pref[cataLog.embed_mode].open_spoiler_image)? 150 : this.image.dims[3] || 125) : undefined;},\r\n          get fsize(){return (this.image)? this.image.size : undefined;},\r\n          get ext(){return (this.image)? '.'+fileType[this.image.fileType] : undefined;},\r\n          get sub(){return (this.subject)? common_func.escape(this.subject) : '';},\r\n          get capcode(){return this.auth;},\r\n          get md5(){return (this.image)? this.image.MD5 : undefined;},\r\n          get sha1(){return (this.image)? this.image.SHA1 : undefined;},\r\n          get country(){return (this.flag)? this.flag.toUpperCase() : undefined;},\r\n          name: 'Anonymous',\r\n          get txt(){return this.body;},\r\n          get com(){\r\n//            var txt2com = site2[site.nickname].parse_funcs.post_html.txt2com;\r\n            var anchor_class = (site2[site.nickname].parse_funcs.post_html.txt2com_anchor_class)? '\" class=\"' + site2[site.nickname].parse_funcs.post_html.txt2com_anchor_class : '';\r\n            var anchor_regex = /(>>)([0-9]+)/g;\r\n            var anchor_func_tgt = null;\r\n            var anchor_func_1 = (site.nickname==='meguca')? site2['meguca'].parse_funcs.post_json.anchor\r\n                                                          : function(board,op,no,cross){ // for v3\r\n              return '<a href=\"' + ((cross)? '/cross/' : board) + op + '#p' + no + anchor_class + '\">&gt;&gt;' + no + '</a>'; // URL is changed on 2017/05/30\r\n            };\r\n            function anchor_func(str,arrow,no){\r\n              var links = anchor_func_tgt.links;\r\n              var i=0;\r\n              while (i<links.length && links[i].id!=no) i++; // link.no is string, != is used intentionally.\r\n              return (i<links.length)? anchor_func_1(anchor_func_tgt.board, links[i].op, no, anchor_func_tgt.op!=links[i].op, null) // editing post isn't included in links.\r\n                : str;\r\n//              while (i<links.length && links[i][0]!=no) i++; // working code -2018.10.31\r\n//              return (i>=links.length)? str\r\n//                   : anchor_func_1(anchor_func_tgt.board, links[i][1], no, anchor_func_tgt.op!=links[i][1], null); // editing post isn't included in links.\r\n            }\r\n//            function anchor_func(board, str,arrow,no){ // v2\r\n//              var link = this[no];\r\n//              return (link)? '<a href=\"/' + link.board + '/' + link.op + '#' + no + anchor_class +\r\n//                '\">&gt;&gt;' + ((link.board!=board)? '&gt;/'+ link.board +'/' : '') + no + '</a>' : str; // links isn't provided while editing\r\n//            }\r\n            var spoiler_replace_txt = site2[site.nickname].parse_funcs.post_html.txt2com_spoiler_replace_txt || '<spoiler>$1</spoiler>';\r\n            var quote_replace_txt = (site.nickname==='meguca')? '<em>$1</em>' : '<span class=\"quote\">$1</span>';\r\n            var c2t_count;\r\n            function command2txt(str){\r\n              return '<strong>' + str + ' (' + ((this[c2t_count])? this[c2t_count++].val : '') + ')</strong>';\r\n            }\r\n            Object.defineProperty(site2['meguca'].parse_funcs.post_json_template,'com',{get:function(){\r\n                if (!this.body) return '';\r\n                var com = common_func.escape_text(this.body);\r\n                if (this.links) { // v3\r\n                  anchor_func_tgt = this;\r\n                  com = com.replace(anchor_regex,anchor_func);\r\n                }\r\n//                if (this.links) com = com.replace(anchor_regex,anchor_func.bind(this.links, this.board.slice(1,-1))); // v2\r\n                com = com.replace(/(^>[^>].*$)/mg,quote_replace_txt);\r\n                com = com.replace(/\\*\\*(.*?)((\\*\\*)|$)/mg,spoiler_replace_txt);\r\n                if (this.commands) {\r\n                  c2t_count = 0;\r\n                  com = com.replace(/^#(pyu|flip|\\d*d\\d+|8ball)$/mg,command2txt.bind(this.commands));\r\n                }\r\n                com = com.replace(/(https*:\\/\\/[^\\s]*)(\\s|$)/mg,'<a href=\"$1\" target=\"_blank\">$1</a>$2');\r\n                return com.replace(/\\n/g,'<br>');\r\n              }, enumerable:true, configurable:true});\r\n            return this.com;}, // return Object.defineProperty(...).com doesn't work, because 'this' refers site2['meguca'].parse_funcs.post_json_template.\r\n//          get com(){return (this.body)? site2[site.nickname].parse_funcs.post_html.txt2com((this.links)? this.body.replace(anchor_regex,anchor_func(this.links)) : this.body) : '';}, // BUG, /a/1179831(test thread) doesn't have links and cause error. // links isn't provided while editing.\r\n//          get posts_editing(){\r\n//            var posts_editing = {};\r\n//            for (var i=0;i<this.posts.length;i++) if (this.posts[i].editing) posts_editing[this.posts[i].no] = this.posts[i];\r\n//            return Object.defineProperty(this,'posts_editing',{value:posts_editing, writable:true, enumerable:true, configurable:true}).posts_editing;\r\n//          },\r\n          sticky: false,\r\n          pn: undefined, // block getter\r\n          get no(){return this.id;},\r\n          time: undefined, // patch\r\n          flag: undefined,\r\n          flags: undefined,\r\n          get parse_funcs_html(){\r\n            Object.defineProperty(site2['meguca'].parse_funcs.post_json_template,'parse_funcs_html',\r\n              {value:site2[site.nickname].parse_funcs[site.whereami+'_html'], writable:true, enumerable:true, configurable:true});\r\n            return this.parse_funcs_html;},\r\n          proto: 'DEFAULT.common'\r\n        };\r\n      })(),\r\n    },\r\n    mimic_always: true,\r\n    post_com2txt: function(post){\r\n      return (post.body)? post.body.replace(/\\*\\*([^(\\*\\*)\\n]*)((\\*\\*)|$)/mg,' $1 ') : '';\r\n    },\r\n    proto: 'meguca1'\r\n  };\r\n  common_func.Object_modifyDescriptor(site2['meguca2'],'check_func',{writable:false}); // for reentry.\r\n\r\n  site2['meguca'] = { // meguca.org v3\r\n    domain_url_image: 'meguca.org/assets', // changed around 2018.04.01\r\n//    domain_url_image: 'images.meguca.org/assets',\r\n    check_func: site2['meguca2'].check_func, // needed as a own property.\r\n//    url_boards_json: function(){return ['https://meguca.org/json/' + ((pref.pref2['meguca'].utilize_boards_json)? 'boardTimestamps' : 'boardList'), 'json'];},\r\n    url_boards_json : function(){return ['https://meguca.org/json/board-list', 'json'];},\r\n//    url_boards_json : function(){return ['https://meguca.org/json/boardList', 'json'];}, // working code before 2017.06.19\r\n    postprocess_board: function(val){\r\n      for (var i=0;i<val.length;i++) {\r\n        var bd = liveTag.mems.init({domain:this.nickname, board:'/'+val[i].id+'/'});\r\n        bd.o = i;\r\n        if (val[i].tags && val[i].tags.length!=0) liveTag.postprocess_board_add_btag(val[i].tags,bd);\r\n      }\r\n    },\r\n    utilize_boards_json: false,\r\n    catalog_get_native_scroll_area: undefined, // always window.\r\n//    spoiler_text: {\r\n//      open_rule: 'del, del em {color: #fff!important;}',\r\n//    },\r\n    make_url4 : function(dbt){\r\n      var url_prefix  = this.protocol + '//' + this.domain_url; // force to use https:\r\n      var json_prefix = '/json/boards'; // '/json'; // working code before  2017.06.19\r\n      return (dbt[3]==='catalog_json')? [url_prefix + json_prefix + dbt[1]+ 'catalog', 'json']\r\n           : (dbt[3]==='page_json')?    [url_prefix + json_prefix + dbt[1]+ '?page='+dbt[2], 'json']\r\n           : (dbt[3]==='thread_html')?  [url_prefix + dbt[1] + dbt[2], 'html']\r\n           : (dbt[3]==='thread_json')?  [url_prefix + json_prefix + dbt[1]+dbt[2], 'json']\r\n           : (dbt[3]==='page_html')?    [url_prefix + dbt[1], 'html'] : undefined;\r\n    },\r\n    historyAPI: false, // true, // changed on 2017.06.12 \r\n    historyAPI_blocking: false,\r\n    short_link:function(name, nof_posts, num, kwd_head, kwd_tail){\r\n      var url = this.make_url4(common_func.name2dbt(name))[0];\r\n      var th_class = 'history lastN-link ' + pref.script_prefix +'_link';\r\n      return '<a href=\"' + url + '?last=100' + '\" class=\"' + th_class + '\">' + kwd_head + '100' + kwd_tail + '</a>';\r\n    },\r\n    wrap_to_parse: {\r\n      get: site2['DEFAULT'].wrap_to_parse.get,\r\n      posts: function(th, start){site2['DEFAULT'].wrap_to_parse.posts(th, start || th.localArchive && 1 || undefined, {op:th.no || th.id});},\r\n//      posts: function(th, start){site2['DEFAULT'].wrap_to_parse.posts(th, start, {op:th.no || th.id});},\r\n    },\r\n    lth_init: function(th){\r\n      liveTag.mems.init({board:'/cross/', domain:th.domain});\r\n      Object.defineProperty(liveTag.mems['meguca'],'/cross/',{value:liveTag.mems['meguca']['/cross/'], configurable:true, enumerable:false, writable:true});\r\n    },\r\n    prep_own_posts: function(bt){\r\n      if (window.opener && window.name==='meguca') setTimeout(this.prep_own_posts_IDB.bind(this),0); // wait to configure IDB module.\r\n      else this.prep_own_posts_IDB();\r\n    },\r\n    prep_own_posts_IDB: function(bt){\r\n      IDB.req_raw('meguca', 'meguca', 'mine', null, this.prep_own_posts_IDB_callback.bind(this), 'get_all'); // This has a racing condition, http request in subframe is faster than IDB usually.\r\n    },\r\n    prep_own_posts_IDB_callback: function(domain, board, no, result){\r\n      var all = {};\r\n      for (var i in result) all[result[i].id] = null;\r\n      site3[this.nickname].own_posts = {ALL:all};\r\n//      var boards = ['/a/','/an/','/cr/','/g/'];\r\n//      for (var i=0;i<boards.length;i++) site3[this.nickname].own_posts[boards[i]] = all;\r\n      if (window.opener && window.name==='meguca') this.prep_own_posts_event();\r\n    },\r\n\r\n    popups_post_pnode: function(pnode){\r\n      while (pnode.tagName!=='ARTICLE' && pnode.parentNode) pnode = pnode.parentNode;\r\n      return pnode;\r\n    },\r\n//    backlink_class: 'backlinks', // for popups_add_1\r\n    add_backlinks_pn: function(pn, target){\r\n      var bks = pn.getElementsByClassName('backlinks')[0];\r\n      if (!bks) {\r\n        bks = document.createElement('span');\r\n        bks.setAttribute('class','spaced backlinks');\r\n        pn.appendChild(bks);\r\n        return {pn:bks, hrefs:{}};\r\n      } else return {pn:bks, hrefs:this.add_backlinks_hrefs(bks, target)};\r\n    },\r\n    add_backlinks_hrefs: function(bks, target){\r\n      var hrefs = {};\r\n      if (!target) bks.innerHTML = '';\r\n      else {\r\n        var as = bks.getElementsByTagName('a');\r\n        for (var j=0;j<as.length;j++) hrefs[as[j].getAttribute('href')] = null;\r\n      }\r\n      return hrefs;\r\n    },\r\n    add_backlinks_add_1: function(bks, dbtp, href){\r\n      var blk = document.createElement('span');\r\n      blk.innerHTML = site2['meguca'].parse_funcs.post_json.anchor(dbtp[1], dbtp[2], dbtp[3], null, href);\r\n      blk = blk.childNodes[0];\r\n//      blk.onclick = this.backlink_onclick;\r\n//      blk.onmouseover = this.popups_post_entry;\r\n      if (dbtp[0]!=='meguca' || pref.test_mode['91']) {\r\n        blk.childNodes[0].onclick = this.backlink_onclick;\r\n        blk.childNodes[1].onclick = this.backlink_onclick;\r\n//        blk.childNodes[0].onmouseover = this.popups_post_entry;\r\n//        blk.childNodes[1].onmouseover = this.popups_post_entry;\r\n      }\r\n      bks.pn.appendChild(blk);\r\n    },\r\n    add_backlinks: function(pn,backlinks,target, th){ // MUST CHANGE TO USE site2['DEFAULT'].add_backlinks, but meguca is down and I can't debugg it now, so I leave this.\r\n      var bks = this.add_backlinks_pn(pn, target);\r\n      for (var i=(target || 0);i<backlinks.length;i++) {\r\n        var dbtp = this.popups_backlink2dbtpth(backlinks[i], th);\r\n        var domain = dbtp[0];\r\n        var href = site2[domain].link_dbtp2href_abs(dbtp);\r\n//        if (domain!==site.nickname) href = site2[domain].absolute_link_1(href);\r\n        if (bks.hrefs[href]!==null) this.add_backlinks_add_1(bks, dbtp, href);\r\n        if (target) break;\r\n      }\r\n    },\r\n    popups_href2dbtp: function(href){ //, src, th){\r\n//      if (href[0]==='#' && th) {\r\n//        href = th.board+th.no+href; // this.link_dbtp2href([th.domain, th.board, th.no, href.substr(2)]);\r\n//        src.setAttribute('href',href);\r\n//      }\r\n      var hrefs = href.split(/[\\/#]/);\r\n      var p = hrefs[hrefs.length-1].substr(1); // remove 'p'\r\n      var b = '/'+hrefs[hrefs.length-3]+'/';\r\n      var t = hrefs[hrefs.length-2];\r\n      if (!t) t = -1;\r\n      return ['meguca',b,t,p]\r\n    },\r\n    toplevel_anchor_pos:2,\r\n    link_dbtp2href: function(dbtp){\r\n      return dbtp[1] + dbtp[2] + '#p' + dbtp[3];\r\n    },\r\n\r\n    popups_post_fetch: function(th, dbt){\r\n      httpd.req({initiator:'popup',\r\n                 tgts:[{url:'https://meguca.org/json/post/'+dbt[3], responseType:'json', tgt:dbt[0]+'/*/'+dbt[2]+'#'+dbt[3], data_type:'json', domain:th.domain}],\r\n                 callback_1:site2[th.domain].popups_post_fetch_callback.bind(site2[th.domain]),\r\n//                 INDICATOR: {shift:function(){}, report:function(){}},\r\n                 IDX:0, FINISHED:0, SUC:0, max:1,\r\n                 dbt:dbt,\r\n                },8);\r\n    },\r\n    popups_post_fetch_callback: function(req,val, REQ){\r\n      var post_0 = {domain:REQ.dbt[0], board:REQ.dbt[1], no:REQ.dbt[2], type_data:'json', domain_html:site.nickname, key:REQ.dbt[0]+REQ.dbt[1]+REQ.dbt[2]};\r\n//      var post_0 = {domain:REQ.dbt[0], board:'/'+val.response.board+'/', no:REQ.dbt[2], type_data:'json', domain_html:site.nickname};\r\n      delete val.response.board;\r\n      var th = {posts:[post_0, val.response], __proto__:post_0};\r\n      site2[th.domain].wrap_to_parse.posts(th);\r\n      var lth = liveTag.mems.init(th);\r\n//      var lth = liveTag.prep_tags(th);\r\n      this.popups_fetched(th,lth, 1);\r\n//      cataLog.format_html.prepare_html_post(th, th.posts[1]);\r\n//      this.popups_add_1(th, th.posts[1], pref[cataLog.embed_mode].popup, lth.q, th.no===th.posts[1].no, false); // cut quote link.\r\n//      if (this.popup_info && this.popup_info.key===REQ.dbt[0]+REQ.dbt[1]+REQ.dbt[2]+'#'+th.posts[1].no) this.popups_post_entry({target:this.popup_info.node, __proto__:this.popup_info});\r\n    },\r\n    post_json2html_imagesearch_href: {\r\n      google: function(url){return 'https://www.google.com/searchbyimage?image_url='+url;},\r\n      iqdb: function(url){return 'http://iqdb.org/?url='+url;},\r\n      saucenao: function(url){return 'http://saucenao.com/search.php?db=999&amp;url='+url;},\r\n      whatAnime: function(url){return 'https://whatanime.ga/?url='+url;},\r\n      desustorage: function(md5){return 'https://desuarchive.org/_/search/image/'+md5;},\r\n      exhentai: function(sha1){return 'http://exhentai.org/?fs_similar=1&amp;fs_exp=1&amp;f_shash='+sha1;},\r\n    },\r\n    post_json2html_imagesearch_1: function(provider,src_x,label){\r\n      var href = this.post_json2html_imagesearch_href[provider](src_x);\r\n      return '<a class=\"image-search ' + provider + '\" target=\"_blank\" rel=\"nofollow\" href=\"' + href + '\">' + label + '</a>';\r\n    },\r\n    post_json2html_imagesearch: function(pref_imgsearch,furl,md5,sha1){\r\n      return ((pref_imgsearch.google)?             this.post_json2html_imagesearch_1('google'     ,furl,'G' ) : '')+\r\n             ((pref_imgsearch.iqdb)?               this.post_json2html_imagesearch_1('iqdb'       ,furl,'Iq') : '')+\r\n             ((pref_imgsearch.saucenao)?           this.post_json2html_imagesearch_1('saucenao'   ,furl,'Sn') : '')+\r\n             ((pref_imgsearch.whatAnime)?          this.post_json2html_imagesearch_1('whatAnime'  ,furl,'Wa') : '')+\r\n             ((pref_imgsearch.desustorage && md5)? this.post_json2html_imagesearch_1('desustorage',md5, 'Ds') : '')+\r\n             ((pref_imgsearch.exhentai && sha1  )? this.post_json2html_imagesearch_1('exhentai'   ,sha1,'Ex') : '');\r\n    },\r\n    post_json2html: function(post, board, op, short_link, op_no) {\r\n      var pn = document.createElement('div');\r\n      var time_unit = (post.parse_funcs && post.parse_funcs.time_unit) || 1;\r\n      var date = new Date((post.time || 0) * time_unit);\r\n      var name = post.name || 'Anonymous';\r\n      var file_header_html= '';\r\n      var file_html= '';\r\n      if (post.ext) {\r\n        var fsize_str = (((post.fsize>1048576)? post.fsize/1048576 : post.fsize/1024)+0.005).toString();\r\n        fsize_str = fsize_str.substr(0,fsize_str.indexOf('.')+3) + ((post.fsize>1048576)? ' MB' : ' KB');\r\n//        var fname_server = site2[post.domain].post_json2html_fname_server(post);\r\n//        var fname = site2[post.domain].post_json2html_fname(post);\r\n        var furl = site2[post.domain].catalog_json2html3_src(post,board);\r\n        var turl = site2[post.domain].catalog_json2html3_thumbnail(post,board);\r\n        var tn_f = (op)? 1 : ((post.tn_w>post.tn_h)? post.tn_w : post.tn_h) / 150;\r\n        file_header_html = '<figcaption class=\"spaced\">'+\r\n            '<a class=\"image-toggle act\" hidden=\"\"></a>'+\r\n            ((pref[cataLog.embed_mode].imagesearch.use)? '<span class=\"spaced image-search-container\">'+\r\n              this.post_json2html_imagesearch(pref[cataLog.embed_mode].imagesearch, furl, post.md, post.sha1) + '</span>' : '')+\r\n            '<span class=\"fileinfo\">'+\r\n              '<span class=\"filesize\">' + fsize_str + '</span>'+\r\n              '<span class=\"dims\">' + post.w + 'x' + post.h + '</span>'+\r\n            '</span>'+\r\n            '<a href=\"' + ((post.domain==='meguca')? furl.replace(/images\\.meguca\\.org/,'meguca.org') : furl) + '\" download=\"' + post.filename + post.ext + '\">' + post.filename + post.ext + '</a>'+\r\n//            '<a href=\"' + furl + '\" download=\"' + post.filename + post.ext + '\">' + post.filename + post.ext + '</a>'+\r\n          '</figcaption>';\r\n        file_html = '<figure>'+\r\n            '<a target=\"_blank\" href=\"' + furl + '\">'+\r\n              '<img src=\"' + turl + '\" width=\"' + post.tn_w + '\" height=\"' + post.tn_h + '\">'+\r\n            '</a>'+\r\n          '</figure>';\r\n      }\r\n      pn.innerHTML = '<article id=\"p' + post.no + '\" class=\"glass' + ((post.ext)? ' media' : '') + '\">'+\r\n          '<input type=\"checkbox\" class=\"deleted-toggle\">'+\r\n          '<header class=\"spaced\"><input type=\"checkbox\" class=\"mod-checkbox hidden\">'+\r\n            '<b class=\"name\">'+post.name+'</b>'+\r\n            ((post.country)? '<img class=\"flag\" src=\"/assets/flags/' + post.country.toLowerCase() + '.svg\" title=\"' + post.country + '\">' : '')+\r\n            '<time>' + site2['common'].change_utc_to_local(date) + '</time>'+\r\n            '<nav>'+\r\n//              '<a class=\"history\" href=\"' + board + op_no + ((post.domain==='meguca')? '?last=100' : '')) + '#p'+post.no + '\">No.</a>'+\r\n//              '<a class=\"history quote\" href=\"/all/2025573?last=100#p2032325\">2032325</a>'+\r\n              '<a class=\"history\" href=\"' + '#p'+post.no + '\">No.</a>'+\r\n              '<a class=\"history quote\" href=\"#p' + post.no + '\">' + post.no + '</a>'+\r\n            '</nav>'+\r\n            ((op)? '<span>'+\r\n              '<span class=\"act\">'+\r\n                 '<a class=\"history expand-link\" href=\"' + board + post.no + '\">Expand</a>'+\r\n              '</span>'+\r\n              ((short_link)? '<span class=\"act\">'+ short_link + \r\n//                '<a class=\"history lastN-link\" href=\"/all/2114139?last=100\">Last 100</a>'+\r\n              '</span>' : '' )+\r\n            '</span>' : '' )+\r\n            '<a class=\"control\">'+\r\n              '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"8\" height=\"8\" viewBox=\"0 0 8 8\">'+\r\n                '<path d=\"M1.5 0l-1.5 1.5 4 4 4-4-1.5-1.5-2.5 2.5-2.5-2.5z\" transform=\"translate(0 1)\"></path>'+\r\n              '</svg>'+\r\n            '</a>'+\r\n          '</header>'+\r\n          file_header_html+\r\n          '<div class=\"post-container\">'+\r\n            file_html+\r\n            '<blockquote>'+\r\n//              '<em>'+\r\n//                '<a class=\"history post-link\" data-id=\"2032314\" href=\"/all/2025573#p2032314\">&gt;&gt;2032314</a>'+\r\n//                '<a class=\"hash-link history\" href=\"/all/2025573#p2032314\"> #</a> '+ // there is a blank here.\r\n//              '</em>'+\r\n//              '<br>Well the grave has already been dug<br>Might as well hop in'+\r\n              post.com+\r\n            '</blockquote>'+\r\n          '</div>'+\r\n        '</article>';\r\n      return pn.removeChild(pn.childNodes[0]);\r\n    },\r\n\r\n    \r\n    post_container: function(pn){return pn},\r\n    update_posts_remove: function(th_old,i,pnode){\r\n      pnode.removeChild(th_old.posts[i].pn);\r\n    },\r\n    update_posts_insert: function(src,dst,i,j,pnode){\r\n      var ref = (j<dst.length)? dst[j].pn : pnode.getElementsByTagName('aside')[0];// dst[dst.length-1].pn.nextSibling; // dst[dst.length-1].pn.nextSibling;\r\n      if (!src[i].pn) src[i].pn = this.post_json2html(src[i], src[i].board);\r\n      var tgt = src[i].pn;\r\n      pnode.insertBefore(tgt, ref);\r\n    },\r\n    page_json2html3_skelton: function(obj, both) {\r\n      var th = document.createElement('section');\r\n      th.setAttribute('class','index-thread');\r\n      th.setAttribute('data-id',obj.no);\r\n      th.innerHTML = '<input type=\"checkbox\" class=\"deleted-toggle\">'+\r\n                     '<aside class=\"act posting glass\"><a href=\"'+ obj.board + obj.no + '?last=100#bottom\">Reply</a></aside>';\r\n      return (both)? [th,th.childNodes[1]] : th;\r\n    },\r\n    page_json2html3 : function(obj,board,thumb_url, assign_pn) { // TEMPORAL, USE thumb_url TO MIMIC.\r\n      var doms = this.page_json2html3_skelton(obj, true);\r\n      var th = doms[0];\r\n      var ref = doms[1];\r\n//      if (!obj.posts) obj.posts = {posts:[{}], _proto__:obj}; // obj.posts = [obj]; // test patch for catalog->page transition.\r\n      var op = this.post_json2html((obj.posts && obj.posts[0])? obj.posts[0] : obj, board, true, site2[obj.domain].short_link(obj.key, obj.nof_posts, 2, 'Last ',''), obj.no);\r\n//      if (!obj.posts) obj.posts = cataLog.threads[obj.key][4].slice(0,1); // test patch for catalog->page transition.\r\n//      op.setAttribute('class','post op');\r\n      th.insertBefore(op,ref);\r\n      if (assign_pn || !obj.posts[0].pn) obj.posts[0].pn = op;\r\n      if (obj.posts) {\r\n        for (var i=1;i<obj.posts.length;i++) {\r\n          var pn = this.post_json2html(obj.posts[i], board);\r\n          th.insertBefore(pn,ref);\r\n          if (assign_pn || !obj.posts[i].pn) obj.posts[i].pn = pn;\r\n        }\r\n        this.page_json2html3_add_omitted_info(obj,obj.posts,obj.posts);\r\n      }\r\n      return th;\r\n    },\r\n    page_json2html3_replace_expander : function(posts_old, idx, key) {\r\n      var omit_info = this.parse_funcs['page_html'].get_omitted_info(posts_old[0]);\r\n      if (omit_info) omit_info.appendChild(cnst.config_expander(key, idx));\r\n    },\r\n    page_json2html3_add_omitted_info : function(th,posts_old,posts) {\r\n      var nof_files = 0;\r\n      for (var i=0;i<posts.length;i++) nof_files += (posts[i].type_data==='html')? posts[i].pn.getElementsByClassName('figure').length :\r\n                                                    (posts[i].filename)? 1 : 0;\r\n      var nof_files_omitted = th.nof_files - nof_files;\r\n      var nof_posts_omitted = th.nof_posts - posts.length;\r\n\r\n      var omit_info = (posts_old)? this.parse_funcs['page_html'].get_omitted_info(posts_old[0]) : null;\r\n      if (nof_posts_omitted!=0) {\r\n        if (!omit_info) {\r\n          omit_info = document.createElement('span');\r\n          omit_info.setAttribute('class','omit');\r\n          omit_info.setAttribute('data-omit',nof_posts_omitted);\r\n          omit_info.setAttribute('data-image-omit',nof_files_omitted);\r\n          omit_info.innerHTML = ' <span class=\"act\"><a href=\"' + posts[0].no + '\" class=\"history\">See All</a></span>';\r\n          if (th.domain!=='meguca' || pref[cataLog.embed_mode].use_expander_always) omit_info.appendChild(cnst.config_expander(th.key));\r\n          if (posts_old) this.parse_funcs['page_html'].set_omitted_info(posts_old[0],omit_info);\r\n        }\r\n        omit_info.childNodes[0].textContent = nof_posts_omitted + ((nof_posts_omitted==1)? ' post' : ' posts') +\r\n                                ((nof_files_omitted)? ' and ' + nof_files_omitted + ' image' + ((nof_posts_omitted!==1)? 's' : '') : '') + ' omitted ';\r\n//        if (th.domain!==site.nickname) omit_info.childNodes[0].style.display = 'none';\r\n      } else if (omit_info) omit_info.childNodes[0].textContent = 'Showing all posts.'; // if (omit_info && posts_old) posts_old[0].pn.removeChild(omit_info);\r\n      return omit_info;\r\n    },\r\n\r\n\r\n    catalog_json2html3 : function(obj,board,thumb_url, make_footer) {\r\n      var th = document.createElement('article');\r\n      th.id = 'p'+obj.no;\r\n      th.setAttribute('class','glass media op' + ((obj.deleted)? ' deleted' : ''));\r\n      th.setAttribute('data-id',obj.no);\r\n      var th_url = site2[obj.domain].make_url4([obj.domain,obj.board,obj.no,'thread_html'])[0];\r\n      if (thumb_url) {\r\n        var tn_w = obj.tn_w || obj.posts[0].tn_w;\r\n        var tn_h = obj.tn_h || obj.posts[0].tn_h;\r\n        var tn_f = 150 / ((tn_w>tn_h)? tn_w : tn_h);\r\n      }\r\n      var th_class_tn = (site2[obj.domain].historyAPI && pref.pref2.meguca.historyAPI)? 'history' : '';\r\n      var th_class    = th_class_tn + ((th_class_tn)? ' ':'') + pref.script_prefix +'_link';\r\n      var short_link = site2[obj.domain].short_link(obj.key, obj.nof_posts, 1, 'Last ', '');\r\n//      if (!thumb_url) thumb_url = site2[obj.domain].catalog_json2html3_thumbnail(obj, obj.board) || site2[obj.domain].catalog_json2html3_thumbnail(obj.posts[0], obj.board); // for reentry\r\n      th.innerHTML = \r\n        '<input type=\"checkbox\" class=\"deleted-toggle\">'+\r\n        ((thumb_url)? '<figure>'+\r\n          '<a class=\"' + th_class_tn + '\" href=\"' + board + obj.no + '\">'+\r\n          '<img width=\"' + (tn_w * tn_f) + '\" height=\"' + (tn_h * tn_f) + '\" class=\"catalog\" src=\"'+ thumb_url + '\"></a>'+\r\n        '</figure>' : '' )+\r\n        '<span class=\"spaced thread-links hide-empty\">'+\r\n          '<b class=\"board\">' + board + '</b>'+\r\n        '<span class=\"counters\" title=\"Posts/Images\">'+(make_footer? (obj.nof_posts-1) + '/' + (obj.nof_files-1):'')+'</span>'+\r\n          '<span class=\"act\">'+\r\n            ((obj.domain==='meguca')? '<a class=\"' + th_class_tn + ' lastN-link\" href=\"' + board + obj.no + '?last=100\">Last 100</a></span>' :\r\n                                      '<a href=\"' + th_url + '\" class=\"'+ th_class + ' lastN-link\">Expand</a>'+\r\n                                      ((short_link)? '] [' + short_link : ''))+\r\n          '</span>'+\r\n        '</span><br>'+\r\n        ((obj.sub)? '<h3>' + obj.sub + ' </h3>' : '')+\r\n        '<blockquote>' + ((obj.com)? obj.com : '') + '</blockquote>';\r\n      return th;\r\n    },\r\n    mark_newer_posts: function(th_pn,date,unmark, short_cut, th) {\r\n      var ths = (th)? [th] : site2['meguca'].wrap_to_parse.get(document, 'meguca', site.board, site.whereami+'_html', (site.whereami==='thread')? {thread:site.no} : null);\r\n//      if (!th && th_pn!==document) return site2['meguca1'].mark_newer_posts(th_pn,date,unmark, short_cut); // patch.\r\n//      if (!th) {\r\n//        th = JSON.parse(document.getElementById('post-data').innerHTML); // JSON.parse(th_pn.getElementById('post-data').innerHTML);\r\n//        th.posts = [th].concat(th.posts);\r\n//        var pns = th_pn.getElementsByTagName('article');\r\n//        for (var i=0;i<pns;i++) th.posts[i].pn = pns[i];\r\n//      }\r\n      var marked_first_post = null;\r\n      for (var i=ths.length-1;i>=0;i--)\r\n        marked_first_post = ths[i].posts[0].pn && this.mark_newer_posts2(ths[i].posts, date, unmark, short_cut) || marked_first_post; // ths[i].posts[0].pn for reentry.\r\n      return marked_first_post;\r\n    },\r\n    parse_funcs: {\r\n      'shortCatalog_json': {\r\n        has_posts: false,\r\n        proto: 'meguca2.catalog_json'\r\n      },\r\n      'catalog_json': {\r\n        has_posts: false, // API was changed on 2017/5/24.\r\n      },\r\n      'catalog_html': {\r\n        ths_json: 'thread_html',\r\n        ths: function(doc) {\r\n          var ths = site2['meguca2'].parse_funcs.catalog_html.ths(doc);\r\n          var obj = this.ths_json(doc, ths.map(function(v){return v.pn;}), 'shortCatalog_json', 'catalog_html');\r\n          for (var i=0;i<obj.length;i++) obj[i].page = Math.floor(i/15) + '.' + (i%15);\r\n          return obj; //site2['meguca'].wrap_to_parse.get(obj, 'meguca', doc.board, 'shortCatalog_json');\r\n//          setTimeout(function(){\r\n//          cataLog.scan_boards_keyword_callback2('meguca,'+doc.board+',j0,shortCatalog_json', {date:Date.now(), status:200, response:obj},\r\n//            ['reentry_data',Object.create(cataLog.scan_boards_keyword_callback2_default_args)]);\r\n//          }, 0);\r\n//          return ths; // REDUNDANT, pass twice.\r\n//          return site2['meguca2'].parse_funcs.catalog_html.ths(doc);\r\n        },\r\n        get_omitted_info: function(){},\r\n        set_omitted_info: function(){},\r\n        pn_name: 'thread_html',\r\n      },\r\n      'page_json': {\r\n        proto: 'meguca2.catalog_json',\r\n      },\r\n      'post_json': {\r\n        pn: 'DEFAULT.post_json',\r\n      },\r\n      'page_html': {\r\n        ths: function(doc) {\r\n          var obj = this.ths_json(doc, document.getElementsByClassName('index-thread'), 'page_json', 'page_html');\r\n//          var href = window.location.href;\r\n//          var idx  = href.indexOf('?page=');\r\n//          var page = (idx!=-1)? href.substr(idx+6) : 0; // SHOULD BE site.page;\r\n          for (var i=0;i<obj.length;i++) obj[i].page = site.page + '.' + i;\r\n          return obj;\r\n        },\r\n//        footer: function(th){return this.insert_footer4(th.pn.getElementsByClassName('deleted-toggle')[0]);},\r\n        get_max_page: function(doc){\r\n          var len;\r\n          var pgn = doc.getElementsByClassName('pagination')[0];\r\n          return pgn? (len = pgn.childNodes.length, (len<=1)? len : len-1) : 1;\r\n        },\r\n        proto: 'thread_html',\r\n      },\r\n      'thread_html': {\r\n        ths_json: function(doc, pns, type_parse, type_html) {\r\n          var obj = JSON.parse(doc.pn.getElementById('post-data').innerHTML);\r\n          obj = site2['meguca'].wrap_to_parse.get(obj, 'meguca', doc.board, type_parse);\r\n          var dic = {};\r\n          for (var i=0;i<pns.length;i++) dic[pns[i].dataset.id] = pns[i];\r\n          for (var i=0;i<obj.length;i++) {\r\n            obj[i].pn = dic[obj[i].no];\r\n            var posts_pns = obj[i].pn && obj[i].pn.getElementsByTagName('article');\r\n            if (posts_pns) {\r\n              for (var j=0;j<obj[i].posts.length;j++) obj[i].posts[j].pn = posts_pns[j];\r\n              Object.defineProperty(obj[i], 'footer', {value:this.footer(obj[i]), configurable:true, enumerable:true, writable:true});\r\n              Object.defineProperty(obj[i], 'type_mimic', {value:type_html, configurable:true, enumerable:true, writable:true});\r\n            }\r\n          }\r\n//          Object.defineProperty(obj[0].__proto__.__proto__.__proto__, 'type_mimic', {value:type_html, configurable:true, enumerable:true, writable:true}); // BUG. this also effects *_json at next fetch.\r\n          obj[0].__proto__.__proto__.__proto__.parse_funcs_html = site2['meguca'].parse_funcs[type_html];\r\n          return obj;\r\n        },\r\n        ths: function(doc) {return this.ths_json(doc, [document.getElementById('thread-container')], 'thread_json', 'thread_html');},\r\n        footer: function(th){return site2['DEFAULT'].parse_funcs.page_html.insert_footer4(th.pn.getElementsByClassName('deleted-toggle')[0]);},\r\n        get_thread_links: function(th){return th.pn.querySelectorAll('.expand-link,.lastN-link,.'+pref.script_prefix+'_link');},\r\n        get_omitted_info: function(post){\r\n          return post.pn && post.pn.getElementsByClassName('omit')[0] || undefined;\r\n//          var omit_info = post.pn && post.pn.lastChild; // post.pn for transition\r\n//          return (omit_info && omit_info.classList.contains('omit'))? omit_info : undefined; // BUG, this refers backlinks\r\n        },\r\n        set_omitted_info : function(post, info){if (info) post.pn.appendChild(info);},\r\n        replace_omitted_info : function(dst, src){dst.childNodes[0].textContent = src.childNodes[0].textContent;},\r\n        replace_omitted_info2 : function(dst, src, th){\r\n          if (!src) {\r\n            var span = document.createElement('span');\r\n            span.setAttribute('style','display:none');\r\n            dst.insertBefore(span,dst.childNodes[1]);\r\n            span.appendChild(dst.childNodes[0]);\r\n            dst.childNodes[1].setAttribute('style','display:none');\r\n          } else {\r\n            if (dst.childNodes[1].style.display==='none') {\r\n              dst.insertBefore(dst.childNodes[0].childNodes[0], dst.firstChild);\r\n              dst.removeChild(dst.childNodes[1]);\r\n              dst.childNodes[1].removeAttribute('style');\r\n            }\r\n            this.replace_omitted_info(dst,src);\r\n          }\r\n        },\r\n//        replace_omitted_info2: site2['4chan'].parse_funcs.page_html.replace_omitted_info2,\r\n        pn_name: function (post){return post.pn.getElementsByClassName('name')[0].childNodes[0];},\r\n      },\r\n      'thread_json': {\r\n        prep_to_archive: function(obj){\r\n          obj[0].posts = obj.slice(1);\r\n          return obj[0];\r\n        },\r\n        proto: 'meguca2.thread_json',\r\n      },\r\n    },\r\n    favicon : {\r\n      __proto__: site2['DEFAULT'].favicon,\r\n      none: '/assets/favicons/default.ico',\r\n      reply: '/assets/favicons/unread.ico',\r\n      reply_to_me: '/assets/favicons/reply.ico',\r\n    },\r\n    proto: 'meguca2'\r\n  };\r\n  common_func.Object_modifyDescriptor(site2['meguca'],'check_func',{writable:false}); // for reentry.\r\n\r\n  site2['imeguca'] = {\r\n    nickname: 'imeguca',\r\n    domain_url: 'images.meguca.org',\r\n    home: 'https://images.meguca.org/assets/favicons/default.ico',\r\n    check_func: site2['DEFAULT'].check_func,\r\n  };\r\n}\r\nif (pref.features.domains['lain'] || pref.features.domains['lainjp']) {\r\n  site2['lain'] = { //lainchan.org // 5.1.3\r\n    nickname : 'lain',\r\n    home : site.protocol + '//lainchan.org/q/index.html',\r\n//    home : site.protocol + '//lainchan.org',\r\n    X_FRAME_OPTIONS: true,\r\n    CONTENT_SECURITY_POLICY_FRAME: true,\r\n    protocol: 'https:',\r\n    domain_url: 'lainchan.org',\r\n    postform_rules: null,\r\n    features : {page: false, graph: true, setting2: false},\r\n    boards_json:site2['DEFAULT'].generate_boards_json([['\\u03bb',5],['diy',2],['sec',6],['tech',6],['inter',2],['lit',3],['music',3],['vis',3],['hum',3],['drg',3],['zzz',2],['layer',1],['q',7],['r',7]],3),\r\n//    boards_json:{boards:[{board:'cyb', pages:7}, {board:'sci', pages:2}, {board:'tech', pages:7}, {board:'\\u03bb', pages:7}, {board:'layer', pages:5}, {board:'zzz', pages:17}, {board:'w', pages:4}, {board:'feels', pages:7}, {board:'drg', pages:4}, {board:'lit', pages:7}, {board:'civ', pages:1}, {board:'diy', pages:7}, {board:'art', pages:7}, {board:'r', pages:9}, {board:'q', pages:3}, {board:'f', pages:2}, {board:'sec', pages:3}, {board:'cult', pages:4}]},\r\n    check_func : function(){\r\n      var href = window.location.href;\r\n      if (href.indexOf(this.domain_url)===-1 || href.search(new RegExp(this.domain_url+'\\/*$'))!=-1) return false;\r\n//      if (href.indexOf(new RegExp(this.domain_url))!=-1) {\r\n        site.whereami = (href.indexOf('/catalog')!=-1)? 'catalog'\r\n                      : (href.indexOf('/res/')!=-1)? 'thread'\r\n                      : (document.title==='404')? '404' \r\n//                      : (site.board==='/all/' || site.board==='/popular/')? 'other'\r\n//                      : (!pref.test_mode['29'] && (site.board==='/all/' || site.board==='/popular/'))? 'other'\r\n                      : 'page';\r\n//                      : (href.search(/\\/$|(index|[0-9]+)\\.html|\\/all$|\\/popular$/)!=-1)? 'page'\r\n//                      : 'other';\r\n        if (site.whereami==='thread') site.no = parseInt(href.replace(/.*res\\//,'').replace(/\\.html/,''),10);\r\n        site.config(this.domain_url, this.nickname);\r\n        site.max_page = 7;\r\n        site.header_height = function(){\r\n          var header = document.getElementsByClassName('boardlist')[0];\r\n          return (header)? header.offsetHeight : 0;\r\n        }\r\n//        site.myself = site.no || 0;\r\n        site.embed_to = (site.whereami==='thread' || site.whereami==='page')? {\r\n          top: function(){return document.getElementsByName('postcontrols')[0];},\r\n          bottom: function(){return document.getElementsByTagName('footer')[0];}\r\n        } : (site.whereami==='catalog')? {\r\n          top: function(){return document.getElementsByTagName('header')[0].nextSibling;},\r\n          bottom: function(){return document.getElementsByTagName('footer')[0];}\r\n        } : {};\r\n        if (site.whereami==='thread' || site.whereami==='page') {\r\n//          site.postform = document.getElementsByTagName('form')['post'].getElementsByTagName('tbody')[0];\r\n          site.postform = document.getElementsByTagName('form')['post'];\r\n          if (site.postform) {\r\n//            site.postform_comment = document.getElementById('body');\r\n            this.postform_prep();\r\n\r\n//          var bar_bottom = document.getElementsByClassName('bottom')[0];\r\n//////          site.root_body2 = bar_bottom.insertBefore(document.createElement('span'),bar_bottom.childNodes[1]); // working code.\r\n////          site.root_body2 = document.getElementsByClassName('pages')[0];\r\n////          site.root_body2.setAttribute('style','width:auto');\r\n//////          site.root_body2 = document.getElementById('style-select');\r\n          }\r\n        }\r\n//        pref.thread_reader.own_posts_tracker = true;\r\n////////        setTimeout(function(){this.postprocess_board(this.boards_json)}.bind(this),0);\r\n//        var ss = document.querySelector('link[href^=\"/stylesheets/\"]');\r\n        // http://stackoverflow.com/questions/2635814/javascript-capturing-load-event-on-link\r\n        // But https://pie.gd/test/script-link-events/\r\n        if (this.nickname==='lain') {\r\n          styleSheet.add_to_watch(document.getElementById('stylesheet'));\r\n          styleSheet.add_to_watch(document.getElementById('code_stylesheet'));\r\n        }\r\n//        var ss = document.getElementById('stylesheet'); // doesn't work because chrome and FF don't support onload event from link tag.\r\n//        ss.addEventListener('load',styleSheet.styles_changed,false);\r\n        return true;\r\n//      } else return false;\r\n    },\r\n    styles: [['a.dotted', 'border-bottom:1px dashed;']],\r\n//    catalog_threads_in_page : function(doc){return doc.getElementsByClassName('mix');},\r\n    catalog_posts_in_thread : function(doc){return doc.getElementsByClassName('replyContainer');},\r\n    max_page : function(){return 10;},\r\n    all_boards: ['/popular/','/all/','/mega/','/random/', '/culture/','/psy/'],\r\n    make_url4: function(dbt){\r\n      return (site2['lain'].all_boards.indexOf(dbt[1])!=-1 && dbt[3]!=='catalog_html')? undefined : site2['vichan'].make_url4.call(this,dbt);\r\n//      return (site2['lain'].all_boards.indexOf(dbt[1])!=-1 && dbt[3]!=='catalog_html')? undefined : this.__proto__.make_url4.call(this,dbt); // cause error from lainjp\r\n    },\r\n\r\n    catalog_native_prep: function(date,pn_filter,pn_tb,pn_hi){\r\n//      var node_ref = document.getElementsByClassName('catalog_search')[0].nextSibling;  // FF doesn't work.\r\n      var node_ref = (site.whereami==='catalog')? document.getElementsByClassName('threads')[0]\r\n                                                : document.getElementsByName('postcontrols')[0];\r\n      site2['DEFAULT'].catalog_native_prep_sel(pn_filter,pn_tb,site.whereami==='catalog'? document.getElementById('sort_by') : null);\r\n      if (site.whereami==='catalog') {\r\n        document.getElementById('image_size').addEventListener('change', site2['lain'].catalog_native_size_changed, false);\r\n        pn_tb.style.display='inline';\r\n        pn_tb.childNodes[3].style.display='inline';\r\n//        var pn_tb_new = document.createElement('span'); // rip from div to span\r\n//        while (pn_tb.firstChild) pn_tb_new.appendChild(pn_tb.firstChild);\r\n//        pn_tb = pn_tb_new;\r\n//        var pn3 = pn_tb.removeChild(pn_tb.childNodes[3]);\r\n//        while (pn3.firstChild) pn_tb.appendChild(pn3.firstChild); // rip from div to span\r\n////        pn_tb.appendChild(pn_tb.removeChild(pn_tb.childNodes[3]).firstChild);\r\n        if (this.nickname==='lain') {\r\n          document.getElementsByClassName('controls')[0].appendChild(pn_tb);\r\n        } else {\r\n          var threads0 = document.getElementsByClassName('threads')[0];\r\n          threads0.parentNode.insertBefore(pn_tb,threads0);\r\n        }\r\n        node_ref.parentNode.insertBefore(pn_filter,node_ref);\r\n      } else { // if (site.whereami==='page') {\r\n        var pctrls = document.getElementsByName('postcontrols')[0];\r\n//        for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.removeChild(pctrls.childNodes[i]);\r\n//        pctrls.parentNode.insertBefore(document.createElement('hr'),pctrls.nextSibling);\r\n        if (this.nickname==='lain') {\r\n          var blotter = document.getElementsByClassName('blotter')[0];\r\n          var pn = document.createElement('div');\r\n          pn.setAttribute('style','float:left');\r\n          pn.appendChild(blotter.nextSibling.nextSibling);\r\n          pn.appendChild(blotter.nextSibling.nextSibling);\r\n          if (site.whereami==='page') pn.appendChild(document.createTextNode(' | '));\r\n          blotter.parentNode.insertBefore(pn,blotter.nextSibling.nextSibling);\r\n          pn.parentNode.insertBefore(pn_filter, pn.nextSibling);\r\n          pn.parentNode.insertBefore(pn_tb, pn.nextSibling);\r\n        } else {\r\n          pctrls.parentNode.insertBefore(pn_filter,pctrls);\r\n          pctrls.parentNode.insertBefore(pn_tb,pctrls);\r\n        }\r\n      }\r\n//      node_ref.parentNode.insertBefore(pn_hi,node_ref);\r\n//      if (site.whereami==='catalog') node_ref.previousElementSibling.appendChild(pn_tb);\r\n//      if (site.whereami==='catalog') node_ref.previousSibling.appendChild(pn_tb);\r\n//      else node_ref.parentNode.insertBefore(pn_tb,node_ref);\r\n//      node_ref.parentNode.insertBefore(pn_filter,node_ref);\r\n//      pn_tb.childNodes[0].setAttribute('style',pn_tb.childNodes[0].getAttribute('style')+';display:none');\r\n//      pn_tb.childNodes[1].setAttribute('style',pn_tb.childNodes[1].getAttribute('style')+';display:none');\r\n////////      return site2['lain'].catalog_from_native(date,document,site.board,site.whereami+'_html');\r\n    },\r\n////    catalog_get_native_area: function(){\r\n////      if (site.whereami==='catalog') return document.getElementById('Grid');\r\n////      else {\r\n////        var pc = document.getElementsByName('postcontrols')[0];\r\n////        return pc.insertBefore(document.createElement('div'),pc.firstChild);\r\n////      }\r\n////    },\r\n\r\n////////    catalog_from_native : function(date,doc,board,type) { // working code.\r\n////////      return site2[this.nickname].wrap_to_parse.get(doc, this.nickname, board, type);\r\n////////////      var parse_obj = {domain:this.nickname, board:board, parse_funcs:site2[this.nickname].parse_funcs[type], __proto__:site4.parse_funcs_on_demand};\r\n////////////      var ths = {pn:doc, __proto__:parse_obj};\r\n////////////      return ths.ths;\r\n////////    },\r\n//    catalog_get_native_area: function(){return document.getElementById('Grid');},\r\n    catalog_native_size: (document.getElementById('image_size'))? document.getElementById('image_size').value : 'small',\r\n    catalog_native_size_changed: function(){site2[site.nickname].catalog_native_size = this.value;},\r\n    parse_funcs : { // lainchan\r\n      'catalog_html' : {\r\n        sticky: function(th){return th.footer.textContent.indexOf('(sticky)')!=-1;},\r\n//        sticky: function(th){return false;}, // patch\r\n        ths: function(doc){\r\n          var ths = this.__proto__.ths(doc);\r\n          if (site2['lain'].all_boards.indexOf(site.board)!=-1)\r\n            for (var i=ths.length-1;i>=0;i--) ths[i].board = '/' + ths[i].pn.getAttribute('data-board') + '/';\r\n          for (var i=0;i<ths.length;i++) ths[i].page = Math.floor(i/10) + '.' + i%10;\r\n          return ths;\r\n        },\r\n      },\r\n      'page_html':{\r\n//        tn_as: function (th){\r\n//          var as = [];\r\n////          var files = th.pn.getElementsByClassName('op')[0].getElementsByClassName('file');\r\n//          var files = th.pn.getElementsByClassName('files')[0].getElementsByClassName('file');\r\n//          for (var i=0;i<files.length;i++) {\r\n//            var as_tmp = files[i].getElementsByTagName('a');\r\n//            if (as_tmp) for (var j=0;j<as_tmp.length;j++) if (as_tmp[j].getElementsByTagName('img')[0]) as[as.length] = as_tmp[j];\r\n//          }\r\n//          return as;\r\n//        },\r\n        ths: function(doc){\r\n//          var ths = site2['vichan'].parse_funcs.page_html.ths(doc);\r\n          var ths = this.__proto__.ths(doc);\r\n          if (site2['lain'].all_boards.indexOf(site.board)!=-1) {\r\n            for (var i=ths.length-1;i>=0;i--) {\r\n              var key = site.nickname + '/' + ths[i].pn.getAttribute('data-board') + '/' + ths[i].no;\r\n              if (cataLog.threads[key]) {ths.splice(i,1);continue;}\r\n              ths[i].board = '/' + ths[i].pn.getAttribute('data-board') + '/';\r\n            }\r\n//            for (var i=0;i<ths.length;i++) {\r\n////            for (var i=ths.length-1;i>=0;i--) {\r\n//              var prev = ths[i].pn.previousSibling;\r\n//              if (!prev || prev.tagName!=='H2') {ths.splice(i,ths.length-i);break;}\r\n////              if (!prev || prev.tagName!=='H2') {ths.splice(i,1);continue;}\r\n////              if (!prev || !prev.getElementsByTagName('a')[0]) {ths.splice(i,1);continue;}\r\n//              ths[i].board = prev.getElementsByTagName('a')[0].textContent;\r\n//              prev.classList.add(pref.script_prefix+'_hs');\r\n////              prev.setAttribute('style','display:none');\r\n////              ths[i].pn.insertBefore(prev,ths[i].pn.firstChild);\r\n//            }\r\n            if (ths.length===0) cataLog.show_catalog();\r\n          }\r\n          return ths;\r\n        },\r\n      },\r\n      'catalog_json' : {\r\n        time_unit: 1000,\r\n      },\r\n      'post_html' : {\r\n        img2src: function(img){\r\n          var src = img.parentNode.href;\r\n          if (src.search(/.webm/)!=-1) src = src.replace(/.*player.php\\?v=/,'').replace(/&t=.*/,'');\r\n//              https://lainchan.org/player.php?v=/test/src/1449566174628.webm&t=1449422283293.webm&loop=1\r\n          return src;\r\n        }\r\n      },\r\n\r\n    },\r\n    colorID: function(pn) {\r\n      var id = pn.getElementsByClassName('poster_id')[0];\r\n      if (id && id.style && !id.style.backgroundColor) {\r\n        site2['vichan'].colorID(pn);\r\n        var prev = id.previousSibling;\r\n        id.textContent = 'ID: '+id.textContent;\r\n        if (prev.textContent===' ID: ') prev.textContent = '';\r\n      }\r\n    },\r\n    catalog_json2html3_thumbnail: function(obj, board) {\r\n      return (obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png' || obj.ext==='.pdf')? 'https://' + this.domain_url + board + 'thumb/' + obj.tim + '.png'\r\n           : (obj.ext==='.epub')? 'https://' + this.domain_url + '/static/lain_epub.jpg' : '';\r\n    },\r\n////////    catalog_json2html3 : function(obj,board,thumb_url) {\r\n////////      var th = document.createElement('div');\r\n////////      th.setAttribute('class','mix');\r\n////////      th.setAttribute('style','display: inline-block;');\r\n//////////      if (obj.ext==='.gif' || obj.ext==='.png') obj.ext='.jpg';\r\n////////      if (obj.ext==='.gif' || obj.ext==='.jpeg') obj.ext='.jpg';\r\n////////      th.innerHTML = '<div class=\"thread grid-li grid-size-' + this.catalog_native_size + '\">' +\r\n////////                     '<a href=\"' + thumb_url + '\">' +\r\n////////                       '<img src=\"' + thumb_url +\r\n////////                       '\" id=\"img-' + obj.no +\r\n////////                       '\" data-subject=\"' + obj.sub +\r\n////////                       '\" data-name=\"' + obj.name +\r\n////////                       '\" data-muhdifference=\"\" data-last-reply=\"\" data-last-subject=\"\" data-last-name=\"\" data-last-difference=\"\"' +\r\n////////                       'class=\"' + board + ' thread-image\" title=\"' + new Date(obj.last_modified*1000).toLocaleString() + ' '+obj.ext + '\"></a>' +\r\n////////                     '<div class=\"replies\"><strong>R: ' + (obj.nof_posts-1) +' / I: ' + obj.nof_files +\r\n//////////                     ((pref.catalog_footer_show_board_name)? ' '+board : '')\r\n////////                     '</strong>' + \r\n////////                     ((obj.sub)? '<p class=\"intro\"><span class=\"subject\">' + obj.sub + '</span></p>' : '<br>') +\r\n////////                     obj.com + '</div></div>';\r\n////////      return th;\r\n////////    },\r\n    catalog_from_json3 : function(obj,board) {\r\n      return site2[this.nickname].wrap_to_parse.get(obj, this.nickname, board, 'catalog_json');\r\n////      var parse_obj = {domain:this.nickname, board:board, parse_funcs:this.parse_funcs['catalog_json'], __proto__:site4.parse_funcs_on_demand};\r\n////      var ths = {obj:obj, __proto__:parse_obj};\r\n////      return ths.ths;\r\n    },\r\n    favicon : {\r\n      __proto__: site2['DEFAULT'].favicon,\r\n      none: '/favicon.png',\r\n      reply: 'png;base64,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',\r\n      reply_to_me: 'png;base64,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'\r\n    },\r\n    proto : 'vichan'\r\n  };\r\n}\r\nif (pref.features.domains['lainjp']) {\r\n  site2['lainjp'] = { //lainchan.jp // ?.?.?\r\n    nickname : 'lainjp',\r\n    home : site.protocol + '//lainchan.jp/lainicon.ico',\r\n    X_FRAME_OPTIONS: true,\r\n    CONTENT_SECURITY_POLICY_DATAURI: true,\r\n    CONTENT_SECURITY_POLICY_FRAME: true,\r\n    protocol: 'https:',\r\n    domain_url: 'lainchan.jp',\r\n    postform_rules: null,\r\n    features : {page: false, graph: true, setting2: false, postform:true},\r\n    boards_json:site2['DEFAULT'].generate_boards_json([['cyb',2],['tech',2],['cult',2],['\\u03bb',1],['\\u03bc',1],['psy',1],['feels',1],['q',2],['r',1]],2),\r\n    check_func: site2['lain'].check_func,\r\n    components: {\r\n      boardlist: '#overheader',\r\n//      postform_comment: 'textarea[name=\"'+ pref.script_prefix + '_draft\"]',\r\n//      postform_submit: 'button[name=\"'+ pref.script_prefix + '_send\"]',\r\n      __proto__:site2['vichan'].components\r\n    },\r\n    parse_funcs: {\r\n      catalog_html: {\r\n        sticky: function(th){return th.pn.getElementsByTagName('strong')[0].textContent.search(/\\(sticky\\)/)!=-1},\r\n        proto: 'lain.catalog_html'\r\n      },\r\n    },\r\n    post_container: function(post_pn,no){return post_pn;},\r\n    update_posts_remove: function(th_old,i,pnode,merge){\r\n      var tgt = th_old.posts[i].pn;\r\n      if (i==0 && tgt.classList.contains('op')) this.update_posts_insert_pack(tgt);\r\n      else pnode.removeChild(tgt.nextSibling);\r\n      pnode.removeChild(tgt);\r\n    },\r\n    catalog_json2html3_thumbnail: function(obj, board) {\r\n      return (obj.ext==='.jpg' || obj.ext==='.jpeg' || obj.ext==='.gif' || obj.ext==='.png')? 'https://' + this.domain_url + board + 'thumb/' + obj.tim + '.png' :\r\n             (obj.ext==='.pdf')? 'https://' + this.domain_url + '/static/pdf.png' : '';\r\n    },\r\n    favicon : {\r\n      __proto__: site2['lain'].favicon,\r\n      none: '/lainicon.ico',\r\n    },\r\n    proto: 'lain'\r\n  };\r\n}\r\nif (window.location.href.search(/localhost/)!=-1) {\r\n  pref.test_mode['94'] = true;\r\n  pref.catalog.embed_page = false;\r\n  pref.virtualBoard.scan_domains['dist'] = 'none';\r\n}\r\nif (pref.test_mode['94']) { // pref.features.domains['dist']) {\r\n  site2['dist'] = { //distchan\r\n    nickname: 'dist',\r\n    domain_url: 'localhost',\r\n    boards_json:site2['DEFAULT'].generate_boards_json([['a',1], ['undefined',1]],3),\r\n    check_func: function(){ // must be owned.\r\n      site2['DEFAULT'].check_func.call(this),\r\n      site.postform = document.getElementsByClassName('postForm')[0];\r\n    },\r\n    make_url4 : function(dbt, trim_page){ // dbt[2] is string. // modified from 4chan.\r\n      var url_prefix  = site.protocol + '//' + this.domain_url  + dbt[1];\r\n      if (dbt[3]==='catalog_html' || (trim_page && dbt[2]==0 && dbt[3]==='page_json')) dbt[3] = 'catalog_json'; // catalog_html is a skelton.\r\n      return (dbt[3]==='page_json')?       [url_prefix + (parseInt(dbt[2],10)+1) + '.json', 'json', (trim_page)? this.nickname+dbt[1]+'j0' : undefined] : // dbt[2] is string.\r\n             (dbt[3]==='catalog_json')?    [url_prefix + 'catalog.json', 'json', this.nickname+dbt[1]+'j0'] :\r\n             (dbt[3]==='thread_json')?     [url_prefix + dbt[2] + '.json', 'json'] :\r\n             (dbt[3]==='page_html')?       [url_prefix + ((dbt[2]!=0)? (parseInt(dbt[2],10)+1) :''), 'html'] :\r\n             (dbt[3]==='thread_html')?     [url_prefix + dbt[2], 'html'] : null;\r\n    },\r\n    parse_funcs: {\r\n      other_html: {},\r\n    },\r\n    testPoster: (function(){\r\n      var queue = [];\r\n//      var post_func = DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(function(){ // working code.\r\n//        var area_com = document.getElementsByTagName('form')[0].getElementsByTagName('textarea')[0];\r\n//        var button_submit = document.getElementsByTagName('form')[0].getElementsByTagName('input')[0];\r\n//        var post = queue.shift();\r\n//        if (post) {\r\n////          console.log(post.com);\r\n//          area_com.textContent = post.com;\r\n////          button_submit.click();\r\n//          setTimeout(submit,600);\r\n//          if (queue.length>0) post_func();\r\n//        }\r\n//        function submit(){\r\n//          button_submit.click();\r\n//        }\r\n//      }),1000);\r\n      var pn_message = document.getElementsByClassName('message')[1];\r\n      if (pn_message) {\r\n        pn_message.innerHTML = '<div></div><div></div><div></div><div></div>';\r\n        var pn_hist   = pn_fifo_factory(pn_message.childNodes[0]);\r\n        var pn_makeThread = pn_fifo_factory(pn_message.childNodes[1]);\r\n        var pn_prune  = pn_fifo_factory(pn_message.childNodes[2]);\r\n        var pn_errors = pn_fifo_factory(pn_message.childNodes[3]);\r\n      }\r\n      var xhr_reqs = new Map();\r\n      var xhr_frees = [];\r\n      var a_update = document.getElementsByClassName('a_update')[0];\r\n      var post_func = DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(function(){\r\n        var all_data = queue.shift();\r\n        var op = all_data.op;\r\n        var post = all_data.post;\r\n        if (post) {\r\n          if (post.no===op) post.new_thread = true; // patch for bug.\r\n          var data = {type:'json', action:(post.new_thread)? 'makeThread' : (post.pruned)? 'prune' : 'post', board:post.board.slice(1,-1), thread:op, body:queue.length+': '+post.com, subject:post.sub, debug:op};\r\n          if (post.com && post.com.indexOf(' is ')!=-1) data.tag = post.com.substr(post.com.indexOf(' is ')+4).split(/[\\W]/)[0];\r\n          var pn = document.createElement('div');\r\n          var key = data.action+'/'+data.board+'/'+data.thread;\r\n//          pn_messages.set(pn,key);\r\n//          var xhr_events = xhr_events_factory(pn);\r\n          var xhr = xhr_frees.shift() || new_xhr();\r\n          xhr_reqs.set(xhr,{pn:pn, data:data});\r\n          xhr.open('POST', '//localhost/post.php', true);\r\n          xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\r\n          xhr.send(EncodeHTMLForm(data));\r\n          pn.textContent = timestamp()+': '+key+(data.tag? ' '+data.tag:'');\r\n          var old = pn_hist(pn);\r\n          if (old)\r\n            if (old.textContent.indexOf('OK.')===-1) pn_errors(old);\r\n            else if (old.textContent.indexOf('prune')!==-1) pn_prune(old);\r\n            else if (old.textContent.indexOf('makeThread')!==-1) pn_makeThread(old);\r\n        }\r\n          function new_xhr(){\r\n            var xhr = new XMLHttpRequest();\r\n            xhr.addEventListener('load',  xhr_events, false);\r\n            xhr.addEventListener('error', xhr_events, false);\r\n            xhr.addEventListener('abort', xhr_events, false);\r\n            xhr.responseType = 'json';\r\n            return xhr;\r\n          }\r\n          \r\n//          function xhr_events_factory(pn_in) {\r\n//            var pn = pn_in;\r\n//            return function(e) {\r\n          function xhr_events(e) {\r\n            var xhr = e.target;\r\n            var myobj = xhr_reqs.get(xhr);\r\n            var pn = myobj.pn;\r\n            var data = myobj.data;\r\n              var str = (xhr.status==200)? xhr.response && xhr.response.message : xhr.status;\r\n              var str2 = pn.textContent;\r\n              var str2_idx = str2.indexOf(': ')+2;\r\n              str2 = [str2.slice(0,str2_idx), str2.slice(str2_idx)];\r\n              if (str && str.indexOf('OK.')!=-1) {\r\n                str2[1] = str2[1].replace(/(makeThread|post|prune)/,'');\r\n                var str = str.split(' ');\r\n                str[1] = str[1].slice(0,8);\r\n                str[4] = str[4].slice(0,8);\r\n                str[5] = 'op/sec,';\r\n                str = str.join(' ');\r\n              }\r\n  //            if (str===null) str = 'null: '+data.action;\r\n              pn.textContent = str2[0]+ timestamp() +': '+ str + str2[1];\r\n//              pn_messages.delete(pn);\r\n  //            if (xhr.status==200 && localStorage) localStorage['newPost'] = xhr.response.no;\r\n              a_update.textContent = data.thread;\r\n  //            a_update.click(undefined, op); // fail to pass;\r\n              if (data.board===site.board.slice(1,-1) && data.action!=='prune') a_update.click();\r\n              if (queue.length>0) post_func(pref.test_mode.num || 500);\r\n            xhr_reqs.delete(xhr);\r\n            xhr_frees.push(xhr);\r\n//            }\r\n          }\r\n          function EncodeHTMLForm(data) {\r\n            var data_out = [];\r\n            var i=0;\r\n            for(var key in data) data_out[i++] = encodeURIComponent(key) + '=' + encodeURIComponent(data[key]);\r\n            return data_out.join('&').replace(/%20/g,'+');\r\n          }\r\n//        }\r\n      },500));\r\n      function timestamp(){\r\n        var time = new Date();\r\n        return time.toLocaleTimeString() + '.' + ('00' + time.getMilliseconds()).slice(-3);\r\n      }\r\n      function pn_fifo_factory(pn){\r\n        var filled = false;\r\n        return function(pn_add){\r\n          pn.insertBefore(pn_add,pn.firstChild);\r\n          if (filled) return pn.removeChild(pn.lastChild);\r\n          else filled = pn.childNodes.length>=10;\r\n          return null;\r\n        };\r\n      }\r\n      return function entry_func(post, op){\r\n        if (typeof(post)==='string') queue = queue.concat({post:{board:'/'+post.split('/')[1]+'/', pruned:true}, op:post.split('/')[2]});\r\n        else if (post) queue = queue.concat({post:post, op:op});\r\n        post_func(pref.test_mode.num || 500);\r\n      }\r\n    })(),\r\n    features : {catalog: true},\r\n    parse_funcs: {\r\n      'catalog_json': {\r\n        ths: function(obj, parse_obj) {\r\n          var ths = [];\r\n          var page_base = parseInt(parse_obj.page || 0, 10);\r\n          for (var j=0;j<obj.length;j++) {\r\n            var th = Object.create(obj[j]);\r\nth.sub = obj[j].subject; // TEMPORAL\r\n            th.board = '/' + obj[j].board +'/';\r\n            th.page = (page_base + Math.floor(j/15)) + '.' + j%15;\r\n            th.posts = [obj[j]];\r\n            obj[j].__proto__ = parse_obj;\r\n            ths[ths.length] = th;\r\n          }\r\n          return ths;\r\n        },\r\n        op_img_url: function(){return '/distchan.png';},\r\n        key: function(th){return th.domain+th.board+th.no;},\r\n        has_posts: false,\r\n        __proto__: site2['meguca'].parse_funcs.catalog_json\r\n      },\r\n      'thread_json': {\r\n        ths: function(obj, parse_obj){\r\n          return site2['DEFAULT'].parse_funcs['thread_json'].ths({posts:obj, nof_posts:obj.length, board:'/'+obj[0].board+'/'}, parse_obj);\r\n        },\r\n        __proto__: site2['meguca'].parse_funcs.thread_json\r\n      },\r\n      __proto__: site2['meguca'].parse_funcs\r\n    },\r\n    catalog_json2html3: site2['meguca'].catalog_json2html3,\r\n    __proto__: site2['4chan'], // proto: '4chan',\r\n  };\r\n}\r\n\r\n////////  if (!site2['futaba']) site2['futaba'] = { // working code.\r\n////////    nickname : 'futaba',\r\n////////    check_func : function(){\r\n////////      if (window.location.href.search(/2chan.net/)!=-1) { // futaba\r\n////////        site.config('2chan.net','futaba');\r\n////////        site.max_page = site2['futaba'].max_page_futaba[site.server_name + site.board];\r\n////////        return true;\r\n////////      } else return false;\r\n////////    },\r\n////////    max_page_futaba : {\r\n////////      'may/b/' : 11,\r\n////////      'jun/b/' : 10,\r\n////////      'dec/b/' : 8,\r\n////////    },\r\n////////    max_page : function(bn){return site2['futaba'].max_page_futaba[bn];},\r\n//////////    make_url : function(board,no){return ['http://'+site.server_name+'.2chan.net' + board + ((no==0)? 'futaba' : no) + '.htm', 'html'];},\r\n////////    make_url4 : function(dbt){return ['http://'+site.server_name+'.2chan.net' + dbt[1] + ((dbt[2]==0)? 'futaba' : dbt[2]) + '.htm', 'html'];},\r\n////////    get_ops : function(doc){\r\n////////      var ops = [];\r\n////////      var responds = doc.getElementsByClassName('hsbn');\r\n//////////      for (var i=0;i<responds.length;i++) ops.push(responds[i].href.substr(-13,9)); // doesn't work for sub-docment.\r\n//////////      for (var i=0;i<responds.length;i++) ops.push(responds[i].getAttribute('href').substr(-13,9)); // may\r\n////////      for (var i=0;i<responds.length;i++) ops.push(responds[i].getAttribute('href').replace(/res\\//,'').replace(/\\.htm/,''));\r\n////////      return ops;\r\n////////    },\r\n////////    get_posts : function(doc) {\r\n////////      var posts = [];\r\n////////      var inputs = doc.getElementsByTagName('input');\r\n////////      for (var i=0;i<inputs.length;i++) if (inputs[i].value=='delete') posts.push(inputs[i].name);\r\n////////      return posts;\r\n////////    },\r\n////////    format_thread : function(doc){return doc;},\r\n////////  };\r\n\r\n\r\n//if (pref.test_mode['18']) { // leak test about 8chan catalog in 4chan.\r\n//  delete site2['8chan'].parse_funcs['catalog_html'].th_init;\r\n//  delete site2['8chan'].parse_funcs['catalog_html'].th_destroy;\r\n//}\r\n\r\n//  for (var i in site2) {\r\n//    if (i=='DEFAULT') continue;\r\n//    for (var j in site2['DEFAULT'])\r\n//      if (site2[i][j]===undefined) site2[i][j]=site2['DEFAULT'][j];\r\n//  }\r\n  for (var i in site2) {\r\nif (pref.test_mode['94'] && i==='dist') continue;\r\n    for (var j in site2[i].parse_funcs) {\r\n      if (typeof(site2[i].parse_funcs[j])==='string') {\r\n        var tgt = site2[i].parse_funcs[j];\r\n        site2[i].parse_funcs[j] = site2[i].parse_funcs[tgt];\r\n        continue;\r\n      }\r\n      for (var k in site2[i].parse_funcs[j]) { // working code.\r\n        if (k!=='proto' && typeof(Object.getOwnPropertyDescriptor(site2[i].parse_funcs[j],k).value)==='string') { // skip getter.\r\n//        if (k!=='proto' && typeof(site2[i].parse_funcs[j][k])==='string') {\r\n          tgt = site2[i].parse_funcs[j][k].split('.');\r\n////          if (tgt.length>1) site2[i].parse_funcs[j][k] = (tgt.length===3)? site2[tgt[0]].parse_funcs[tgt[1]][tgt[2]] : // working code.\r\n////                                                                           site2[i].parse_funcs[tgt[0]][tgt[1]];\r\n          var tgt_obj = (tgt.length===3)? site2[tgt[0]].parse_funcs[tgt[1]][tgt[2]] : // vichan.catalog_json.XXX\r\n                        (tgt.length===2 && site2[i].parse_funcs[tgt[0]] && site2[i].parse_funcs[tgt[0]][tgt[1]])? site2[i].parse_funcs[tgt[0]][tgt[1]] : // catalog_json.XXX\r\n                        (tgt.length===2 && site2[tgt[0]] && site2[tgt[0]].parse_funcs[tgt[1]] && site2[tgt[0]].parse_funcs[tgt[1]][k])? site2[tgt[0]].parse_funcs[tgt[1]][k] : // vichan.catalog_json\r\n                        (tgt.length===1)? site2[i].parse_funcs[tgt[0]] && site2[i].parse_funcs[tgt[0]][k] : // catalog_json\r\n                        null;\r\n          if (tgt_obj) site2[i].parse_funcs[j][k] = tgt_obj;\r\n        }\r\n      }\r\n////      if (i!=='DEFAULT' || j!=='common') { // working code.\r\n////        var proto = (site2[i].parse_funcs[j].hasOwnProperty('proto'))? site2[i].parse_funcs[j].proto : (site2['DEFAULT'].parse_funcs[j] && i!=='DEFAULT')? 'DEFAULT.'+j : 'DEFAULT.common';\r\n//////        if (pref.debug_mode['0']) site2[i].parse_funcs[j].proto = proto; // debug\r\n////        proto = (proto.indexOf('.')==-1)? site2[i].parse_funcs[proto] : site2[proto.substr(0,proto.indexOf('.'))].parse_funcs[proto.substr(proto.indexOf('.')+1)];\r\n////        site2[i].parse_funcs[j].__proto__ = proto;\r\n//////        if (!pref.debug_mode['0']) delete site2[i].parse_funcs[j].proto;\r\n////        delete site2[i].parse_funcs[j].proto;\r\n////      }\r\n      if (i!=='DEFAULT' || j!=='common') {\r\n        var proto = (site2[i].parse_funcs[j].hasOwnProperty('proto'))? site2[i].parse_funcs[j].proto :\r\n                    (site2[i].hasOwnProperty('proto') && i!=='DEFAULT')? site2[i].proto + '.' + j :\r\n                    (site2['DEFAULT'].parse_funcs[j] && i!=='DEFAULT')? 'DEFAULT.'+j : 'DEFAULT.common';\r\n//        var proto2= (site2[i].parse_funcs[j].hasOwnProperty('proto'))? site2[i].parse_funcs[j].proto : // old\r\n//                    (site2['DEFAULT'].parse_funcs[j] && i!=='DEFAULT')? 'DEFAULT.'+j : 'DEFAULT.common';\r\n//if (proto!==proto2) console.log(i+':'+j+', '+proto+', '+proto2+', '+(proto===proto2));\r\n        proto = (j.slice(-9)==='_template' && proto==='DEFAULT.common')? site2['DEFAULT'].wrap_to_parse.get_getters() :\r\n                (proto.indexOf('.')==-1)? site2[i].parse_funcs[proto] : site2[proto.substr(0,proto.indexOf('.'))].parse_funcs[proto.substr(proto.indexOf('.')+1)];\r\n//        if (proto!==null) proto = (proto.indexOf('.')==-1)? site2[i].parse_funcs[proto] : site2[proto.substr(0,proto.indexOf('.'))].parse_funcs[proto.substr(proto.indexOf('.')+1)];\r\n        site2[i].parse_funcs[j].__proto__ = proto;\r\n        delete site2[i].parse_funcs[j].proto;\r\n      }\r\n    }\r\n    if (i!=='DEFAULT') {\r\n      proto = (site2[i].hasOwnProperty('proto'))? site2[i].proto : 'DEFAULT';\r\n//      if (pref.debug_mode['0']) site2[i].proto = proto; // debug\r\n      if (site2[i].parse_funcs) site2[i].parse_funcs.__proto__ = site2[proto].parse_funcs;\r\n      if (site2[i].patch) site2[i].patch.__proto__ = site2[proto].patch;\r\n      site2[i].__proto__ = site2[proto];\r\n//      if (!pref.debug_mode['0']) delete site2[i].proto;\r\n      delete site2[i].proto;\r\n    }\r\n  }\r\n//  for (var i in site2) {\r\n//    if (i==='DEFAULT' || i==='common') continue;\r\n//    if (!site2[i].hasOwnProperty('prep_own_posts_event')) {\r\n//      site2[i].prep_own_posts_event = site2[i].prep_own_posts_event.bind(site2[i]); // DOESN'T WORK, WHY??? MAY THIS BE CHROME'S BUG??? but I found a better solution.\r\n//console.log('DEBUG: '+i);\r\n//    }\r\n//  }\r\n//    site2['lain'].prep_own_posts_event = site2['lain'].prep_own_posts_event.bind(site2['lain']); // works correctly.\r\n//    site2['KC'].prep_own_posts_event = site2['KC'].prep_own_posts_event.bind(site2['KC']);\r\n\r\n//if (pref.debug_mode['0']) console.log(common_func.debug_show_proto('8chan:catalog_html',site2['8chan'].parse_funcs['catalog_html'])); // debug\r\n//if (pref.debug_mode['0']) console.log(common_func.debug_show_proto('8chan:page_html',site2['8chan'].parse_funcs['page_html'])); // debug\r\n//console.log(common_func.debug_show_proto('8chan_live:thread_html',site2['8chan_live'].parse_funcs['thread_html'])); // debug\r\n//console.log(common_func.debug_show_proto('8chan:page_html',site2['8chan'].parse_funcs['page_html'])); // debug\r\n//console.log(common_func.debug_show_proto('4chan:thread_html',site2['4chan'].parse_funcs['thread_html'])); // debug\r\n\r\n//  for (var i in site2) if (i!=='DEFAULT' && i!=='common') {\r\n//    var proto = site2[i].hasOwnProperty('proto')? site2[i].proto : false;\r\n//    site2[i].__proto__ = (proto)? site2[proto] : site2['DEFAULT'];\r\n//    if (proto) delete site2[i].proto;\r\n//    for (var j in site2[i].parse_funcs) {\r\n//      proto = site2[i].parse_funcs[j].hasOwnProperty('proto')? site2[i].parse_funcs[j].proto : false;\r\n//      if (proto) proto = (proto.indexOf('.')==-1)? site2[i].parse_funcs[proto] : site2[proto.substr(0,proto.indexOf('.'))].parse_funcs[proto.substr(proto.indexOf('.')+1)];\r\n//      site2[i].parse_funcs[j].__proto__ = (proto)? proto\r\n//                                        : (site4.parse_funcs[j])? site4.parse_funcs[j] : site4.parse_funcs.common;\r\n//      if (proto) delete site2[i].parse_funcs[j].proto;\r\n//    }\r\n//  }\r\n//  for (var i in site4.parse_funcs) if (i!=='common') site4.parse_funcs[i].__proto__ = site4.parse_funcs.common;\r\n\r\n//  if (  localStorage &&   localStorage[pref.script_prefix+'.pref']) pref_func.pref_overwrite(pref,JSON.parse(  localStorage[pref.script_prefix+'.pref']),true);\r\n//  if (sessionStorage && sessionStorage.pref) pref_func.pref_overwrite(pref,JSON.parse(sessionStorage.pref),true);\r\n//  pref_func.site2_json();\r\n  site2['ALL'] = {};\r\n\r\n  var site3 = {};\r\n  for (var i in site2) if (i!=='DEFAULT' && i!=='common' && i!=='meguca1' && i!=='meguca2') {\r\n    site3[i] = {boards: null, tags: {cs:[], ci:[]}, own_posts:{}};\r\n    if (site2[i].hasOwnProperty('check_func')) {\r\n      site2[i].check_func();\r\n      delete site2[i].check_func; // reduce memory consumption.\r\n    }\r\n    site.nicknames.push(i);\r\n    site2['ALL'][site2[i].domain_url] = i;\r\n  }\r\n  if (!site.embed_to['top']) site.embed_to['top'] = site.root_body && site.root_body.firstChild;\r\n  if (!site.embed_to['bottom']) site.embed_to['bottom'] = site.root_body && site.root_body.lastChild;\r\n\r\n  if (pref.pref2.KC.summer_time) site2['KC'].time_offset = 2;\r\n  pref_func.site2_json(false,true,['site2','pref_func','site3']);\r\n\r\n  if (window.top != window.self) {\r\n    if (site.nicknames.indexOf(window.name)==-1 && window.name!==site.embed_frame) return; //don't run on frames or iframes\r\n    for (var i in site2) if (site.nicknames.indexOf(i)!=-1 && i!=site.nickname) delete site2[i];\r\n  }\r\n\r\n  var pipe_name = pref.script_prefix + '.graph.' + site.board + '__pipe__';\r\n  var info_raw  = site.nickname + site.board;\r\n\r\n  if (!window.SharedWorker) {\r\n    pref.info_server = false;\r\n    pref.info_client = false;\r\n  }\r\n//  pref_func.str2obj('catalog_board_list_str');\r\n//  pref_func.str2obj2(pref.catalog,'style_general_list_obj2',pref.catalog.style_general_list_str);\r\n//  pref_func.str2obj2(pref.catalog.board,'ex_list_obj2',pref.catalog.board.ex_list_str);\r\n  if (!site0.isStep) pref_func.obj_init();\r\n  pref3.stats.use = pref.stats.use;\r\n  pref3.stats.estimate_posts = pref.stats.estimate_posts;\r\n\r\n  var notifier = (function(){\r\n    var sound = (pref.features.notify.sound)? (function(){\r\n      var audio = null\r\n      function make_beep(){\r\n        var wav_str = [];\r\n        var dl = header_prep_monaural8(pref.notify.sound.beep_length_f);\r\n        data_prep_monaural8(pref.notify.sound.beep_freq,dl,pref.notify.sound.beep_volume_f);\r\n        for (var i=0;i<wav_str.length;i++) if (wav_str[i].length==1) wav_str[i] = '0'+wav_str[i];\r\n        return new Audio('data:audio/wav,%'+wav_str.join('%'));\r\n\r\n        function header_prep_monaural8(period) {\r\n          var dl=Math.floor(period*44100);\r\n          var header_size=46;\r\n          header_add(0x52494646,4,1);     //riff\r\n          header_add(dl+header_size,4,0); //size\r\n          header_add(0x57415645,4,1);     //WAVE\r\n          header_add(0x666d7420,4,1);     //fmt\r\n          header_add(0x12,4,0);           //size of fmt\r\n          header_add(0x01,2,0);           //linearPCM\r\n          header_add(0x01,2,0);           //Stereo\r\n          header_add(44100,4,0);          //44.1kHz\r\n          header_add(44100,4,0);          //176400 bit/sec\r\n          header_add(1,2,0);              //block size, 4Byte\r\n          header_add(8,2,0);              //bit/sample\r\n          header_add(0,2,0);              //size of ext\r\n    //      header_add(0x66616374,4,1);     //fact\r\n    //      header_add(4,4,0);              //size of fact\r\n    //      header_add(0xdbcd5a00,4,1);     //data of fact\r\n          header_add(0x64617461,4,1);     //data\r\n          header_add(dl,4,0);             //size of data\r\n          return dl;\r\n  \r\n          function header_add(val,num,big_endian) {\r\n            if (big_endian==1) for (var i=0;i<num;i++) wav_str.push('');\r\n            for (var i=0;i<num;i++) {\r\n              if (big_endian==1) wav_str[wav_str.length-1-i] = (val%0x100).toString(16);\r\n              else wav_str.push((val%0x100).toString(16));\r\n              val = Math.floor(val/0x100);\r\n            }\r\n          }\r\n        }\r\n        function data_prep_monaural8(freq,period,vol){\r\n          var pi2 = 3.141592654*2;\r\n          vol *=127;\r\n          for (var i=0;i<period;i++) {\r\n            var val = Math.floor(Math.sin(pi2*freq*i/44100)*vol+0x80)%0x100;\r\n            wav_str.push(val.toString(16));\r\n          }\r\n        }\r\n      }\r\n      function make_audio(){\r\n        if (pref.notify.sound.src==='file') {\r\n          var file = pref3.notify.sound.file && pref3.notify.sound.file.files[0];\r\n          if (file) return new Audio(URL.createObjectURL(file));\r\n        }\r\n        return make_beep();\r\n      }\r\n      function src_changed(e,src){\r\n        if (audio) audio.pause();\r\n        src = src.slice(13); // remove 'notify.sound.'\r\n        if (src==='pause') return;\r\n        audio = null;\r\n        if (pref.notify.sound.notify && (src==='notify' || src==='src' || src.indexOf(pref.notify.sound.src)===0)) play();\r\n      }\r\n      function play(){  // pref.notify.sound.notify is checked in caller\r\n        if (!audio) audio = make_audio();\r\n        audio.play();\r\n      }\r\n      pref_func.settings.onchange_funcs['notify.sound.*w/'] = src_changed;\r\n      return {play: play};\r\n    })() : {play:function(){}};\r\n\r\n    var favicon = (pref.features.notify.favicon)? (function(){\r\n      var favicon = site2[site.nickname].favicon.get_favicon();\r\n      var title = site2[site.nickname].favicon.get_title();\r\n      var title_org = title.innerHTML;\r\n      var favicon_current = 'none';\r\n      var title_current = '';\r\n      function favicon_set(favicon_next){\r\n        if (favicon_current!==favicon_next) {\r\n          var str = site2[site.nickname].favicon[favicon_next];\r\n          if (str[0]!=='/') str = 'data:image/'+str;\r\n          favicon.setAttribute('href',str);\r\n          favicon_current = favicon_next;\r\n        }\r\n      }\r\n//      var func_debug = function(e){for (var i=0;i<e.length;i++) console.log(e[i].target.href);};\r\n//      new MutationObserver(func_debug).observe(favicon, {attributes:true});\r\n//      function favicon_set(str){ // working code.\r\n//        if (!favicon) favicon = site2[site.nickname].favicon.get_favicon();\r\n//        if (str[0]!=='/') str = 'data:image/'+str;\r\n//        favicon.setAttribute('href',str);\r\n//      }\r\n\r\n      function set(){\r\n        var sum = new liveTag.CountNR();\r\n        if (pref.liveTag.watch_all) sum.count_all();\r\n//        if (pref.liveTag.watch_all) {\r\n//          for (var d in liveTag.mems) {\r\n//            for (var b in liveTag.mems[d]) {\r\n//              if (liveTag.mems[d][b].nr<0) {\r\n//                var sum_sub = new liveTag.CountNR();\r\n//                for (var t in liveTag.mems[d][b]) sum_sub.count(liveTag.mems[d][b][t].wt);\r\n//                liveTag.mems[d][b].nrtm = sum_sub.nrtm;\r\n//                liveTag.mems[d][b].nr   = sum_sub.nr;\r\n//              }\r\n////              sum.count([0x000c0000, (liveTag.mems[d][b].nrtm<<16) + liveTag.mems[d][b].nr]); // BUG, nr overflowed in 4chan.\r\n//              sum.nrtm += liveTag.mems[d][b].nrtm;\r\n//              sum.nr   += liveTag.mems[d][b].nr;\r\n//        }}} else {\r\n        else {\r\n          var threads = cataLog.threads;\r\n          if (threads) for (var name in threads) sum.count(threads[name][19]);\r\n        }\r\n        if (pref.notify.favicon) favicon_set((sum.nrtm!=0)? 'reply_to_me' : (sum.nr!=0)? 'reply' : 'none');\r\n        if (pref.notify.title.notify)\r\n          title_set((sum.nr==0 && pref.notify.title.hide_zero)? '' : (pref.catalog.footer.nrtm && sum.nrtm? sum.nrtm + '/' : '') + sum.nr + ' - ');\r\n      }\r\n      function title_set(str){\r\n        if (title_current!==str) {\r\n          title.innerHTML = str + title_org;\r\n          title_current = str;\r\n        }\r\n      }\r\n      return {\r\n        set : new DelayBuffer(set, 200).get_binded_delayed_do(),\r\n      } \r\n    })() : {set:function(){}};\r\n\r\n    var desktop = (Notification && pref.features.notify.desktop)? (function(){\r\n      function get_permission(){\r\n        if (Notification.permission !== 'granted') {\r\n          Notification.requestPermission(function (status) {\r\n            if (Notification.permission !== status) {\r\n              Notification.permission = status;\r\n            }\r\n          });\r\n        }\r\n        return Notification.permission==='granted';\r\n      }\r\n      get_permission();\r\n\r\n//      var dtns = {};\r\n      var dtns = [];\r\n      var dtns_queue = [];\r\n      function show(th,obj,num){\r\n        if (pref.test_mode['94'] && site.nickname==='dist') return site2[site.nickname].testPoster((num>=0)? obj[num] : obj, th.no);\r\n        if (dtns.length + dtns_queue.length < pref.notify.desktop.limit)\r\n          if (Notification.permission === 'granted' || get_permission()) show_1(th,obj,num);\r\n      }\r\n//      function show(name,obj,num){ // working code.\r\n//        if (dtns.length>pref.notify.desktop.limit) return;\r\n//        if (Notification.permission === 'granted') show_1(name,obj,num);\r\n//        else if (Notification && Notification.permission !== 'denied') {\r\n//          Notification.requestPermission(function (status) {\r\n//            if (Notification.permission !== status) {\r\n//              Notification.permission = status;\r\n//            }\r\n//            if (status === 'granted') show_1(name,obj,num);\r\n//          })\r\n//        }\r\n//      }\r\n      var pn = document.createElement('div');\r\n      function show_1(th,objs,num){\r\n        var obj = (num>=0)? objs[num] : objs;\r\n        obj = {icon: obj.op_img_url,\r\n               body: obj.com || '',\r\n               __proto__: obj};\r\n        if (obj.reply_of_mine && pref.catalog_footer_ignore_my_own_posts) return;\r\n        obj.title = ( // (obj.appear_thread)? 'Appear thread ' :\r\n                     (obj.new_thread)? 'New Thread ' :\r\n                     (obj.reply_to_me && pref.notify.desktop.reply_to_me)? '(You) in ' :\r\n                      '') + (th.sub || th.key);\r\n//        if (obj.tag) obj.tag = 'CatChan/' + obj.tag;\r\n        obj.tag = pref.script_prefix+'/' + th.key + ', '+(objs.length-num-1);\r\n        pn.innerHTML = obj.body;\r\n//        var dtn = new Notification(obj.title,{tag:obj.tag, body:pn[brwsr.innerText], icon:obj.icon});\r\n//        var dtn = new Notification(obj.title,{tag:obj.tag, body:pn[brwsr.innerText].trim(), icon:obj.icon}); // trim for KC\r\n        obj.body = pn[brwsr.innerText].trim(); // trim for KC\r\n        if (pref.notify.desktop.delay===0) show_1_queued(obj);\r\n        else {\r\n          dtns_queue[dtns_queue.length] = obj;\r\n          show_1_queued_delayed(); // FF denies multiple notifications at a time.\r\n        }\r\n      }\r\n      var show_1_queued_delayed = new DelayBuffer(show_1_queued, 200).get_binded_delayed_do();\r\n      function show_1_queued(obj) {\r\n        if (!obj) obj = dtns_queue.shift();\r\n        var dtn = new Notification(obj.title, obj); // trim for KC\r\n        dtn.onclick = win_focus;\r\n//        dtn.onclose = close_1;\r\n        var id = (pref.notify.desktop.lifetime!=0)? setTimeout(close_1, pref.notify.desktop.lifetime*1000) : null;\r\n        dtns[dtns.length] = [dtn, id];\r\n//console.log(dtns.length);\r\n//        dtns[obj.tag] = dtn;\r\n//        if (pref.notify.desktop.lifetime!=0) setTimeout(function(){dtn.close();delete dtns[obj.tag];},pref.notify.desktop.lifetime*1000); // can't call this in setTimeout without 'use strict'\r\n        if (dtns_queue.length>0) show_1_queued_delayed();\r\n      }\r\n      function close_1(){dtns.shift()[0].close();}\r\n      function win_focus(){window.focus();for (var i=dtns.length-1;i>=0;i--) if (dtns[i][0]===this || i==0) {if (dtns[i][1]) clearTimeout(dtns[i][1]);dtns.splice(i,1);break;}}\r\n      function close_all(){while (dtns.length>0) {if (dtns[0][1]) clearTimeout(dtns[0][1]);close_1();}}\r\n//      function win_focus(){window.focus();clearTimeout(dtns.shift()[1]);};\r\n//      function close_all(){while (dtns.length>0) close_1();}\r\n////      function win_focus(){window.focus()};\r\n////      function close_all(){\r\n////        for (var i in dtns) dtns[i].close();\r\n////      }\r\n      window.addEventListener('beforeunload', close_all, false);\r\n      return {\r\n        show : show,\r\n      }\r\n    })() : {show:function(){}};\r\n    return {\r\n      sound:   sound,\r\n      favicon: favicon,\r\n      desktop: desktop,\r\n      changed: function(th, tgt_th19_4){\r\n        if (pref.notify.favicon || pref.notify.title.notify) favicon.set();\r\n//        if (!threads[name][19][5] && tgt_th19_4 && tgt_th19_4.length!=0) { // I think that tgt_th19_4 is redundant, but error occured, so patched.\r\n          var sound_flag = false;\r\n          var init = pref4.refresh.count<=1;\r\n          var dt = (pref.notify.desktop.show_last)? 0 : tgt_th19_4.length-1;\r\n          for (var i=tgt_th19_4.length-1;i>=0;i--) {\r\n            if (pref.notify.sound.reply || (pref.notify.sound.reply_to_me && tgt_th19_4[i].reply_to_me)) sound_flag = true;\r\n            if (i<=dt && pref.notify.desktop.notify)\r\n              if (pref.notify.desktop.reply || (pref.notify.desktop.reply_to_me && tgt_th19_4[i].reply_to_me)) if (!init || !pref.notify.desktop.supp_init) desktop.show(th,tgt_th19_4,i, true);\r\n          }\r\n          if (pref.notify.sound.notify && sound_flag) if (!init || !pref.notify.sound.supp_init) notifier.sound.play();\r\n//        }\r\n//console.log(tgt_th19_4.length);\r\n      },\r\n////      changed: function(name,threads){\r\n////        if (pref.notify.favicon) favicon.set(threads);\r\n////        var sound_flag = false;\r\n//////threads[name][19][5] = false; // for debug.\r\n////        if (!threads[name][19][5] && threads[name][19][4] && threads[name][19][4].length!=0) { // I think that threads[name][19][4] is redundant, but error occured, so patched.\r\n////          if (pref.notify.desktop.notify) {\r\n////            var i = (pref.notify.desktop.show_last)? 0 : threads[name][19][4].length-1;\r\n////            while (i>=0) {\r\n////              if (i==0 || !pref.notify.desktop.show_last)\r\n////                if (pref.notify.desktop.reply || (pref.notify.desktop.reply_to_me && threads[name][19][4][i].to_me)) desktop.show(name,threads[name][19][4],i);\r\n////              i--;\r\n////            }\r\n////          }\r\n////          for (var i=0;i<threads[name][19][4].length;i++) if (pref.notify.sound.reply || (pref.notify.sound.reply_to_me && threads[name][19][4][i].to_me)) sound_flag = true;\r\n////        }\r\n////        if (pref.notify.sound.notify && sound_flag) notifier.sound.play();\r\n//////console.log(threads[name][19][4].length);\r\n////      },\r\n////      appeared: function(names,threads){ // working code.\r\n//////        if (pref.notify.sound.notify) notifier.sound.play();\r\n////        if (pref.notify.favicon || pref.notify.title.notify) favicon.set(threads);\r\n////        var sound_flag = false;\r\n////        for (var i=0;i<names.length;i++) {\r\n////          var name = names[i];\r\n//////          if (threads[name][19][0]<0) { // 'changed' shall not be issued.\r\n//////            if (pref.notify.desktop.new_thread && threads[name][19][8]) desktop.show(name,[{new_thread:true, body:threads[name][0].innerHTML}],0);\r\n////            var dbt = common_func.name2domainboardthread(name,true);\r\n//////            if (pref.notify.desktop.notify && (pref.notify.desktop.appear || (pref.notify.desktop.new_thread && threads[name][19][8])))\r\n////            if (pref.notify.desktop.notify &&   ((pref.notify.desktop.appear && !(threads[name][19][0]!==0 && (pref.notify.desktop.reply || pref.notify.desktop.reply_to_me)))\r\n////                                              || (pref.notify.desktop.new_thread && threads[name][19][8])))\r\n//////              desktop.show(name,[{new_thread:threads[name][19][8], body:threads[name][0].innerHTML, icon:site2[dbt[0]].get_op_image_url(threads[name][0],threads[name][18])}],0);\r\n////              desktop.show(name,{new_thread:threads[name][19][8], body:threads[name][0].innerHTML, icon:threads[name][26]},-1);\r\n////            if (pref.notify.sound.appear || (pref.notify.sound.new_thread && threads[name][19][8])) sound_flag = true;\r\n////        }\r\n////        if (pref.notify.sound.notify && sound_flag) notifier.sound.play();\r\n////      }\r\n      appeared: function(th, new_thread){\r\n        var threads = cataLog.threads;\r\n        if (pref.notify.favicon || pref.notify.title.notify) favicon.set(threads);\r\n        var watch = liveTag.mems[th.domain][th.board][th.no].wt;\r\n        if (pref.notify.desktop.notify && ((pref.notify.desktop.appear && !(watch[0]!==0 && (pref.notify.desktop.reply || pref.notify.desktop.reply_to_me)))\r\n                                            || (pref.notify.desktop.new_thread && new_thread)))\r\n          desktop.show(th,{new_thread:new_thread, __proto__:th},-1);\r\n        if (pref.notify.sound.notify && (pref.notify.sound.appear || (pref.notify.sound.new_thread && new_thread))) notifier.sound.play();\r\n      }\r\n    }\r\n  })();\r\n\r\n  var ports = {};\r\n  var messages_to_send = {};\r\n  var init_func = {};\r\n  var receive_func = {};\r\n  function make_port_parent(name,win){\r\n    if (ports[name]) send_message(name,['CLOSE']);\r\n    ports[name] = 'init';\r\n    init_func[name] = function(e){initialize(e,name,win);};\r\n    window.addEventListener('message', init_func[name], false);\r\n    if (pref.debug_mode['0']) console.log(window.name + ': Waiting for connection from '+name+' ...');\r\n    function initialize(e,name,win) {\r\n      if (pref.debug_mode['0']) console.log(window.name + ': Connecting from '+e.data);\r\n//      if (e.source==win) {\r\n//      if (e.source==win && site2[e.data]) { // remove \"{\"name\":\"twttr:private:requestArticleUrl\"}\" from someone...\r\n//      if (e.source==win && site.nicknames.indexOf(e.data)!=-1) { // remove \"{\"name\":\"twttr:private:requestArticleUrl\"}\" from someone... in Tampermonkey. // BUG.\r\n//      if (e.source==win && new RegExp(site.nicknames.join('|')).test(e.data)) { // remove \"{\"name\":\"twttr:private:requestArticleUrl\"}\" from someone... in Tampermonkey.\r\n      if ((e.source==win && new RegExp(site.nicknames.join('|')).test(e.data)) ||\r\n          (e.source==site.embed_frame_win && site.whereami==='frame' && e.data.indexOf('CLOSE')==-1)) { // remove \"{\"name\":\"twttr:private:requestArticleUrl\"}\" from someone... in Tampermonkey.\r\n        if (pref.debug_mode['0']) console.log(window.name + ': Connected successfully.');\r\n        if (!brwsr.ff) init_receive_port(name,e.ports[0]);\r\n        else init_receive_port(name,win);\r\n        window.removeEventListener('message', init_func[name], false);\r\n        delete init_func[name];\r\n        if (messages_to_send[name]) {\r\n          for (var i=0;i<messages_to_send[name].length;i++) if (send_message(name,messages_to_send[name][i][0], null, messages_to_send[name][i][1])) break;\r\n          delete messages_to_send[name];\r\n        }\r\n        if (name=='_blank') send_message(name,['CLOSE']);\r\n      } else if (pref.debug_mode['0']) console.log(window.name + ': FAIL.');\r\n    }\r\n  }\r\n  function make_port_child(parent){\r\n    if (pref.debug_mode['0']) console.log(window.name + ': Try to connect to parent...');\r\n    if (!brwsr.ff) {\r\n      var channel = new MessageChannel();\r\n      init_receive_port('parent',channel.port1);\r\n      parent.postMessage(window.name, '*', [channel.port2]); // Specification(order of arguments) was changed.\r\n//      parent.postMessage(window.name, [channel.port2], '*'); // chrome 59 doesn't work this\r\n    } else { // FF doesn't support channel messaging.\r\n      init_receive_port('parent',parent);\r\n      parent.postMessage(window.name, '*');\r\n    }\r\n  }\r\n  function init_receive_port(name,port){\r\n    ports[name] = port;\r\n    receive_func[name] = function(e){receive_message(e,name);};\r\n    if (!brwsr.ff) {\r\n      port.addEventListener('message', receive_func[name], false);\r\n      port.start();\r\n    } else window.onmessage = receive_func[name];\r\n  }\r\n  function close_connection(name){\r\n    if (!brwsr.ff) ports[name].close();\r\n    ports[name].removeEventListener('message', receive_func[name], false);\r\n    delete receive_func[name];\r\n    delete ports[name];\r\n  }\r\n  function send_message(name,message,win,list){\r\n    if (Array.isArray(message) && Array.isArray(message[0])) {message = message[0]; console.log('WARNING, PATCHED: send_mesage');}// patch, ready for depatch and testing.\r\n//    if (typeof(val[0])==='string') val = [val];\r\n//    if (!ports[name]) make_port_parent(name,win);\r\n    if (win) make_port_parent(name,win);\r\n    if (ports[name]==='init') { // chrome works at ==.\r\n      if (!messages_to_send[name]) messages_to_send[name] = [];\r\n      messages_to_send[name].push([message, list]);\r\n    } else {\r\n      if (!ports[name]) name='parent';\r\n      if (pref.debug_mode['0']) console.log(window.name + ': Sent to '+name+': '+ JSON.stringify(message).substr(0,80));\r\n      if (!brwsr.ff) ports[name].postMessage(message, list);\r\n      else ports[name].postMessage(message,'*', list);\r\n//      if (!brwsr.ff) ports[name].postMessage(JSON.stringify(val[i]));\r\n//      else ports[name].postMessage(JSON.stringify(val[i]),'*');\r\n      if (message[0]=='CLOSE') {close_connection(name); return true;} // fallback for chrome's removing extensions.\r\n    }\r\n  }\r\n  var received_messages_404 = null;\r\n  var send_message_emu = [];\r\n  function receive_message_emu(name) {\r\n    while (send_message_emu.length>0) receive_message({data:send_message_emu.shift()}, name || site.key);\r\n  }\r\n  function receive_message(e,name) {\r\n    if (pref.debug_mode['0']) console.log(window.name + ': Received from '+name+': '+e.data.toString().substr(0,80));\r\n    var val = e.data;\r\n    var list = e.ports;\r\n//    var val = JSON.parse(e.data);\r\n    if (site.whereami==='404' && val[0]!=='CLOSE') {if (!received_messages_404) received_messages_404 = [e.data]; else received_messages_404.push(e.data); return;}\r\n    if (typeof(val)=='string') val=JSON.parse(val); // patch for GM.\r\n    if (val[0]=='HTTPD') httpd.sub_funcs(val[1]);\r\n    else if (val[0]=='IDB' && IDB) IDB.sub_funcs(val[1], list);\r\n    else if (val[0]=='ARCHIVER' && archiver) archiver.sub_funcs(val[1], val[2]);\r\n    else if (val[0]=='CLOSE') close_connection(name);\r\n    else if (val[0]=='MARK' && val[1]>0) {\r\n      var marked_first_post = site.myself && site2[site.nickname].mark_newer_posts2(site.myself.posts,val[1],pref.catalog.unmark_on_hover, true) || null;\r\n//      var marked_first_post = (common_obj.thread_reader && pref.test_mode['16'])? common_obj.thread_reader.mark_newer_posts(val[1])\r\n//                                                        : site2[site.nickname].mark_newer_posts(document,val[1],pref.catalog.unmark_on_hover, true);\r\n      if (marked_first_post) scrollTo(0,marked_first_post.offsetTop - site.header_height());\r\n      else scrollTo(0,document.body.clientHeight - window.innerHeight); // to the last\r\n      if (common_obj.thread_reader) common_obj.thread_reader.mark_posts_from_parent(val[1]);\r\n    }\r\n////    else if (val[0]=='SUBFRAME_INIT') http_req.remote();\r\n////    else if (val[0]=='SUB_GET') http_req.sub_get(val[1]);\r\n////    else if (val[0]=='SUB_ACK') http_req.sub_ack(val[1]);\r\n////    else if (val[0]=='SUB_DEST') http_req.sub_dest(val[1]);\r\n    else if (val[0]=='OWN_POSTS') {\r\n      if (site2[val[1]].prep_own_posts_event_received) site2[val[1]].prep_own_posts_event_received(val[2]);\r\n      else site3[val[1]].own_posts = val[2];\r\n    } else if (val[0]=='TRIAGE') {\r\n//console.log('receive: TRIAGE, '+val[1]+', '+val[2]+', '+val[3]);\r\n//      if (catalog_obj && catalog_obj.catalog_func()!=null) catalog_obj.catalog_func().triage_exe_0(val[1],val[2],'',true,val[3]);\r\n      if (catalog_obj && catalog_obj.catalog_func()!=null) catalog_obj.catalog_func().triage_exe_pipe(val[1]);\r\n    } else if (val[0]=='UIP') {\r\n      if (uip_tracker) uip_tracker.annotate_from_catalog(val[1]);\r\n    }\r\nelse if (pref.test_mode['34'] && val[0]==='ECHO') setTimeout(function(){send_message(window.name? 'parent' : 'meguca',['ECHO',val[1]])},5000);\r\n  }\r\n//  function receive_message(e,name) { // working code for old http_req\r\n//    if (pref.debug_mode['0']) console.log(window.name + ': Received from '+name+': '+e.data.toString().substr(0,80));\r\n//    var val = JSON.parse(e.data);\r\n//    if (typeof(val)=='string') val=JSON.parse(val); // patch for GM.\r\n//    if (val[0]=='CLOSE') close_connection(name);\r\n//    else if (val[0]=='MARK' && val[1]>=0) {\r\n//      var offset_top = site2[site.nickname].mark_newer_posts(document,val[1]);\r\n//      scrollTo(0,offset_top);\r\n//    } else if (val[0]=='SUBFRAME_INIT') {\r\n//      http_req.remote();\r\n//    } else if (val[0]=='SUB_GET') {\r\n//      http_req.get(val[1][0],val[1][1],val[1][2],val[1][3],val[1][4],val[1][5],val[1][6]);\r\n//    } else if (val[0]=='SUB_ACK') {\r\n//      iframes[name][1]--;\r\n//      http_req.onload_local(val[1],val[2]);\r\n//    }\r\n//  }\r\n  function close_all(){\r\n    for (var name in ports) send_message(name,['CLOSE']);\r\n  }\r\n  window.addEventListener('beforeunload', close_all, false);\r\n  if (window.opener) {\r\n//console.log('child');\r\n    make_port_child(window.opener);\r\n////    for (var i in site2) // moved to before.\r\n////      if (site2[i].nickname===window.name) {\r\n////        for (var i in site.features) site.features[i] = false;\r\n////        brwsr.sw_cache = null;\r\n////        pref.cloudflare.auto_reload = false;\r\n////        break;\r\n////      }\r\n    if (site2[window.name] && site2[window.name].prep_own_posts_event) {\r\n      window.addEventListener('storage', site2[window.name].prep_own_posts_event, false);\r\n      site2[window.name].prep_own_posts();\r\n      site2[window.name].prep_own_posts_event();\r\n    }\r\n  }\r\n  if (pref.cloudflare.auto_reload) {\r\n    var cf_error = document.getElementsByClassName('cf-error-code');\r\n    if (cf_error.length>0 && parseInt(cf_error[0].textContent,10)>=500) setTimeout(function(){location.reload();},pref.cloudflare.auto_reload_time*60000);\r\n  }\r\n\r\n//  var ports = {}; // working code for test\r\n//  function make_port_parent(name, val){\r\n//    ports[name] = val;\r\n//    var port;\r\n//    if (pref.debug_mode['0']) console.log('parent: '+name+', '+val);\r\n//    window.onmessage = function(e) {\r\n//      if (pref.debug_mode['0']) console.log('from child #unkown: '+e.data);\r\n//      port = e.ports[0];\r\n//      port.postMessage(JSON.stringify(['MARK',val]));\r\n//      port.postMessage(JSON.stringify('CLOSE'));\r\n//      port.close();\r\n////      port.onmessage = function(e) {\r\n////        if (pref.debug_mode['0']) console.log(e.data);\r\n////        port.postMessage('received : ('+Date.now()+')');\r\n////      }\r\n//    }\r\n//  }\r\n//\r\n//  function make_port_child(prt){\r\n//    if (pref.debug_mode['0']) console.log('child :');\r\n//    var channel = new MessageChannel;\r\n//    var port = channel.port1;\r\n//    prt.postMessage('Connection: ', [channel.port2], '*');\r\n////    prt.postMessage('start', [channel.port2], '*');\r\n////    setInterval(function() {port.postMessage('sent : ' + (+new Date));}, 2000);\r\n////    port.onmessage = function(e) {if (pref.debug_mode['0']) console.log(e.data);};\r\n//    port.onmessage = function(e) {\r\n//      if (pref.debug_mode['0']) console.log(e.data);\r\n//      var val = JSON.parse(e.data);\r\n//      if (val[0]=='CLOSE') port.close();\r\n//      else if (val[0]=='MARK' && val[1]>=0) {\r\n//        var offset_top = site2[site.nickname].mark_newer_posts(document,val[1]);\r\n//        scrollTo(0,offset_top);\r\n//      }\r\n//    };\r\n//  }\r\n//  if (window.opener) make_port_child(window.opener);\r\n\r\n  var httpd = (function(){\r\n    var iframes = {};\r\n    var local = true;\r\n    var parser = new DOMParser();\r\n//    var serializer = new XMLSerializer();\r\n    var xhrs = new Map();\r\n    var xhrs_free = [];\r\n    var xhrs_count = 0;\r\n    var remote_opened = {};\r\n    var remote_count = 0;\r\n    var remote_reqs = {};\r\n    var reqs = [];\r\n    var reqs_waiting_finish = [];\r\n    var pause = 0;\r\n    var crawler_spawn   = new Watchdog(dispatch, pref.scan.crawler_idle_time_to_spawn);\r\n    var xhrs_reqs = [];\r\n    var crawler_timeout = new Watchdog(xhr_timeout, 30000);\r\n    var health_indicator;\r\n    function dispatch_if_idle(){\r\n      if (!crawler_spawn.id) dispatch();\r\n    }\r\n    function dispatch(xhr, req_from){\r\n      if (!pause) for (var p=8;p>=0;p--) if (reqs[p] && (xhrs_count<pref.scan.crawler || p==8)) {\r\n        while (reqs[p][0] && reqs[p][0].tgts.length===0) reqs[p].shift();\r\n        var req = reqs[p][0];\r\n        var i=0;\r\n        while (req && req.ERR_5xx && req_from!==req) req = reqs[p][++i];\r\n        if (!req) continue;\r\n        var req_1;\r\n        if (!req.INDICATOR) {\r\n          req.INDICATOR = health_indicator.shift('limegreen', req.initiator[0], req.initiator, p);\r\n          req.INDICATOR.report({start:Date.now(), prog:req}); // make reference loop.\r\n          req.IDX = 0;\r\n          req.FINISHED = 0;\r\n          req.SUC = 0;\r\n          if (!req.max) req.max = req.tgts.length;\r\n        }\r\n        var req_1 = (req.get_tgt_func)? req.get_tgt_func(req) : {REQ:req, __proto__:req.tgts[req.IDX++]};\r\n        if (req.IDX>=req.max) reload_reqs(req,p);\r\n        xhrs_count++; // THIS CAN BE A SINK AND CAUSE DEADLOCK WHEN OVER X_FRAME_OPTIONS.\r\n        if (req_1) {\r\n          req.INDICATOR.report({tgt:req_1.tgt || url2tgt(req_1.url)});\r\n          if (req_1.domain===site.nickname && !req_1.domain_xhr || pref.network.cross_domain!=='indirect') download_local(xhr, req_1);\r\n          else {\r\n            if (xhr) xhrs_free[xhrs_free.length] = xhr;\r\n            download_remote(req_1);\r\n          }\r\n          if (pref.scan.crawler_adaptive) crawler_spawn.restart(pref.scan.crawler_idle_time_to_spawn);\r\n          else if (xhrs_count<pref.scan.crawler) dispatch();\r\n        } else {\r\n          if (!(req.IDX<req.max && (req.refresh || req.found_threads<req.max_threads))) {\r\n            reload_reqs(req,p);\r\n            req.FINISHED += req.max - req.IDX;\r\n            req.IDX = req.max;\r\n          }\r\n          setTimeout(function(){xhr_onload_1({type:'SKIPPED_TO_END'}, xhr, {REQ:req}, true, {date:Date.now(), status:200});},0);\r\n        }\r\n        return;\r\n      }\r\n      if (crawler_spawn.id) crawler_spawn.stop();\r\n      if (xhr) xhrs_free[xhrs_free.length] = xhr;\r\n    }\r\n    function url2tgt(url){return url.substr(url.lastIndexOf('/')+1);}\r\n    function reload_reqs(req,p){\r\n      if (reqs[p] && reqs[p].length>1) reqs[p].shift();\r\n      else reqs[p] = null;\r\n      reqs_waiting_finish[reqs_waiting_finish.length] = req;\r\n    }\r\n    function download_remote(req){\r\n      var domain = req.domain_xhr || req.domain;\r\n      if (!iframes[domain]) {\r\n        cnst.make_iframe(domain);\r\n        iframes[domain] = window.open(site2[domain] && site2[domain].home || req.url, domain);\r\n        send_message(domain,['HTTPD',['SUB_FRAME_INIT']],iframes[domain]);\r\n      }\r\n      remote_opened[domain] = null;\r\n      remote_reqs[remote_count] = req;\r\n      if (!req.archive) req.responseType = 'text';\r\n      send_message(domain,['HTTPD',['SUB_GET',[{ID:remote_count++, url:req.url, responseType:req.responseType, domain:req.domain,\r\n                                                board:req.board, no:req.no, key:req.key, archive:req.archive,\r\n                                                to_file:req.to_file, to_idb:req.to_idb, kind:req.kind, timestamp:req.timestamp,// for archive\r\n                                                domain_xhr:req.domain_xhr,\r\n                                               }]]]);\r\n    }\r\n    function sub_get(args){\r\n      download_local(undefined,args[0]);\r\n    }\r\n    var GM_XMLHttpRequestWrapper = function(){\r\n      this.onload  = this.onload.bind(this);\r\n      this.onerror = this.onerror.bind(this);\r\n      this.onabort = this.onabort.bind(this);\r\n    };\r\n    GM_XMLHttpRequestWrapper.prototype = {\r\n      open: function(method, url){\r\n        this.method = method;\r\n        this.url = url;\r\n      },\r\n      send: function(){\r\n        this.response = null;\r\n        GM_xmlhttpRequest(this);\r\n      },\r\n      onload: function(e){\r\n        this.response = e.response;\r\n        if (!this.response) // GM has 'response', this is for emulation.\r\n          this.response = (this.responseType==='document')? new DOMParser().parseFromString(e.responseText, 'text/xml')\r\n                        : (this.responseType==='json')? JSON.parse(e.responseText)\r\n//                   : (this.responseType==='arraybuffer')? new DOMParser().parseFromString(e.responseText, 'text/xml')\r\n//                   : (this.responseType==='blob')? new DOMParser().parseFromString(e.responseText, 'text/xml')\r\n                        : e.responseText;\r\n// GM has 'arraybuffer' from 3.2, // http://www.greasespot.net/2015/05/greasemonkey-32-release.html\r\n// TM has 'arraybuffer' from ? // https://github.com/Tampermonkey/tampermonkey/issues/279\r\n//        if (this.responseType==='arraybuffer') console.log(this.url+', '+this.response.byteLength);\r\n        this.onXXX('load', e, xhr_onload);\r\n      },\r\n      onerror: function(e){this.onXXX('error',e, xhr_onload);},\r\n      onabort: function(e){this.onXXX('abort',e, xhr_onload);},\r\n      onXXX: function(type, result, callback){\r\n        this.type = type;\r\n        this.result = result;\r\n        callback(this);\r\n      },\r\n      onXXX_factory: function(type, func){\r\n        return function(result){this.onXXX(type, result, func);}.bind(this);\r\n      },\r\n      set onreadystatechange(v){this._onreadystatechange = (v)? this.onXXX_factory('readystatechange',v) : v;},\r\n      get onreadystatechange(){return this._onreadystatechange || this.dummy_func;},\r\n      set onprogress(v){this._onprogress = (v)? this.onXXX_factory('progress',v) : v;},\r\n      get onprogress(){return this._onprogress || this.dummy_func;},\r\n      dummy_func: function(){}, // for chrome emulation, it uses existence of property, not a value.\r\n      get status(){return this.result && this.result.status || 1404;},\r\n      get responseText(){return this.result.responseText;},\r\n      get target(){return this;},\r\n      result: null,\r\n    };\r\n    function download_local(xhr, req){\r\n      if (!xhr) { \r\n        if (xhrs_free.length>0) xhr = xhrs_free.pop();\r\n        else {\r\n          if (pref.network.cross_domain==='GM') xhr = new GM_XMLHttpRequestWrapper();\r\n          else {\r\n            xhr = new XMLHttpRequest();\r\n            xhr.onload  = xhr_onload;\r\n            xhr.onerror = xhr_onload;\r\n            xhr.onabort = xhr_onload;\r\n          }\r\n        }\r\n      }\r\n      xhrs.set(xhr, req);\r\n      xhr.open('GET', req.url);\r\n      xhr.responseType = req.responseType;\r\n      xhr.send();\r\n      xhr_timeout_start(xhr,Date.now(),req);\r\n    }\r\n    function xhr_timeout_start(xhr,date,req){\r\n      req.TIMEOUT = ((req.TIMEOUT)? req.TIMEOUT : date) + pref.network.timeout*1000;\r\n      xhrs_reqs[xhrs_reqs.length] = xhr;\r\n      if (xhrs_reqs.length===1) crawler_timeout.restart(pref.network.timeout*1000);\r\n    }\r\n    function xhr_timeout_restart(xhr,date){\r\n      var idx = xhrs_reqs.indexOf(xhr);\r\n      if (idx<0) return true; // timeouted.\r\n      xhrs_reqs.splice(idx,1);\r\n      if (idx===0) {\r\n        if (xhrs_reqs.length>0) {\r\n          var timeout = xhrs.get(xhrs_reqs[0]).TIMEOUT - date;\r\n          if (timeout>0) crawler_timeout.restart(timeout);\r\n          else xhr_timeout();\r\n        } else crawler_timeout.stop();\r\n      }\r\n    }\r\n    function xhr_timeout(){\r\n      var xhr = xhrs_reqs[0];\r\n      if (pref.debug_mode['25']) console.log('xhr_timeout: '+xhr.readyState+', '+xhr.responseURL);\r\n      if (!xhr.onreadystatechange) {\r\n        xhr.onreadystatechange = xhr_onreadystatechange;\r\n        xhr.onprogress = xhr_onreadystatechange;\r\n        xhr_onreadystatechange({target:xhr});\r\n      } else xhr_onload({target:xhr, type:'TIMEOUT'});\r\n    }\r\n    function xhr_onreadystatechange(e){\r\n      var xhr = e.target;\r\n      var req = xhrs.get(xhr);\r\n      if (pref.debug_mode['25']) console.log('xhr_onreadystatechange: '+req.url+((e.type==='progress')? ': '+e.loaded+'/'+e.total:''));\r\n      if (e.type==='progress') e.target.onreadystatechange = null;\r\n      var date = Date.now();\r\n      xhr_timeout_restart(xhr,date);\r\n      xhr_timeout_start(xhr,date,req);\r\n    }\r\n    function xhr_onload(e){\r\n      var xhr = e.target;\r\n      var date = Date.now();\r\n      if (xhr_timeout_restart(xhr,date)) return; // timeouted.\r\n      xhr.onreadystatechange = null;\r\n      xhr.onprogress = null;\r\n      var req = xhrs.get(xhr);\r\n      var valid = xhr.status===200 || xhr.status===304;\r\n      var value = (xhr.responseType==='text')? {date: date, status: xhr.status, responseText: (valid)? xhr.responseText: null} :\r\n                                               {date: date, status: xhr.status, response:     (valid)? xhr.response    : null};\r\n      xhr_onload_1(e, xhr, req, valid, value);\r\n    }\r\n    function xhr_onload_1(e, xhr, req, valid, value){ // CACHE HIT ENTRY HERE\r\n      if (local) {\r\n        xhrs_count--;\r\n        var end = ++req.REQ.FINISHED === req.REQ.IDX && req.REQ.IDX >= req.REQ.max;\r\n        dispatch(xhr, (value.status<500)? req : null);\r\n        if (end) end_proc_httpd(req.REQ);\r\n        // CACHE WRITE CODE HERE\r\n        if (valid) {\r\n          req.REQ.SUC++;\r\n          onload_local(req, value);\r\n        } else {\r\n          if (value.status>=500 && !req.REQ.ERR_5xx) req.REQ.ERR_5xx = setTimeout(\r\n            (function(req){\r\n              return function(){\r\n                delete req.ERR_5xx;\r\n                dispatch_if_idle();\r\n              }})(req.REQ),30000);\r\n          req.REQ.INDICATOR.report({err_str:(req.tgt||url2tgt(req.url))+'('+value.status+((e.type!=='load')? ':'+e.type : '')+')'});\r\n          if (req.REQ.callback_1_fail) req.REQ.callback_1_fail(req, value, req.REQ);\r\n        }\r\n        if (end) end_proc_user(req.REQ, value.date);\r\n        req.REQ = null; // cut reference loop for GC.\r\n      } else {\r\n        send_message('parent',['HTTPD',['SUB_ACK',[req.ID, {type:(req.archive)? 'ARCHIVE' : e.type}, valid, (req.archive)? {date:value.date, status:value.status, responseText:'', response:{}} : value]]]);\r\n        xhrs_free[xhrs_free.length] = xhr;\r\n        if (valid && req.archive) onload_archive(req, value);\r\n      }\r\n    }\r\n    function sub_ack(args){\r\n      var req = remote_reqs[args[0]];\r\n      delete remote_reqs[args[0]];\r\n      xhr_onload_1(args[1], undefined, req, args[2], args[3]);\r\n    }\r\n    function end_proc_httpd(req){ // called local only\r\n      reqs_waiting_finish.splice(reqs_waiting_finish.indexOf(req),1);\r\n      if (req.archive) req.TAR_FLUSH = remote_opened;\r\n      free_xhrs();\r\n    }\r\n    function free_xhrs(){\r\n      if (xhrs_count===0) {\r\n        xhrs.clear();\r\n        if (local) for (var domain in remote_opened) send_message(domain,['HTTPD',['SUB_FREE']]);\r\n        remote_count = 0;\r\n        remote_opened = {};\r\n      } else for (var i=0;i<xhrs_free.length;i++) xhrs.delete(xhrs_free[i]);\r\n      xhrs_free = [];\r\n    }\r\n    function onload_local(req,value) {\r\n      if (req.responseType==='text') {\r\n        if (req.data_type==='html') value.response = parser.parseFromString(value.responseText, 'text/html');\r\n        else if (req.data_type==='json') value.response = JSON.parse(value.responseText);\r\n      }\r\n      req.REQ.callback_1(req, value, req.REQ);\r\n//        req.REQ.callback(req.key, value, req.callback_arg);\r\n    }\r\n    function onload_archive(req, value){\r\n      if (typeof(req.archive)==='string') {\r\n        archiver.download_url4(value.response, req.archive);\r\n        return;\r\n      }\r\n      if (req.from && local) delete archiver.list_all_obj_downloading[req.from];\r\n      var ignore_domain = pref.network.cross_domain!=='indirect';\r\n      if ((req.domain_xhr||req.domain)===site.nickname || ignore_domain) {\r\n        var suffix = req.kind + '_'+ req.url.replace(/.*\\//g,'');\r\n        if (req.to_file) archiver.download_url3(value.response, req, suffix, req.timestamp);\r\n        if (req.to_idb) if (!pref.test_mode['65'] || !local) IDB.req(req.domain, req.board, req.no, suffix, value.response, 'put');\r\n      }\r\n      if (local && req.REQ.TAR_FLUSH) { // remote doesn't have 'req.REQ'\r\n//        if (check_timestamp_and_flush(req.timestamp)) // flush local\r\n        archiver.tar.flush((xhrs_count===0)? undefined : req.timestamp);\r\n        for (var domain in req.REQ.TAR_FLUSH) send_message(domain,['HTTPD',['SUB_TAR_FLUSH',[(xhrs_count===0)? undefined : req.timestamp]]]); // flush remote\r\n      }\r\n    }\r\n    function onload_archive_fail(req, value){\r\n      if (req.from) delete archiver.list_all_obj_downloading[req.from]; // patch, retry code should be here.\r\n    }\r\n    function check_timestamp_and_flush(timestamp){\r\n      if (reqs[0] && reqs[0][0] && reqs[0][0].timestamp === timestamp && reqs[0][0].tgts.length>0) return false;\r\n//      if (reqs[0] && reqs[0][0] && reqs[0][0].timestamp === timestamp) return false;\r\n      for (var i=0;i<reqs_waiting_finish.length;i++) if (reqs_waiting_finish[i].timestamp===timestamp) return false;\r\n      archiver.tar.flush((xhrs_count===0)? undefined : timestamp);\r\n      return true;\r\n    }\r\n    function end_proc_user(req, date){\r\n      if (req.callback) req.callback(req); // this must be prior to report({end:}), because somefunc reports err_str to indicator.\r\n      req.INDICATOR.report({end:date});\r\n    }\r\n    function sub_tar_flush(args){\r\n      archiver.tar.flush(args[0]);\r\n    }\r\n    function sub_frame_init(){local=false;}\r\n    function pause_cancel(){\r\n      if (pause>0) {\r\n        if (--pause>0) pause_timeout.delayed_do();\r\n      } else {\r\n        pause_timeout.cancel();\r\n        dispatch_if_idle();\r\n      }\r\n    }\r\n    var pause_timeout = new DelayBuffer(pause_cancel,10000);\r\n    var sub_funcs = {SUB_GET:sub_get, SUB_ACK:sub_ack, SUB_FREE:free_xhrs, SUB_TAR_FLUSH:sub_tar_flush, SUB_FRAME_INIT:sub_frame_init};\r\n    return {\r\n      req: function(reqs_in, priority){\r\n        if (!reqs[priority]) reqs[priority] = [reqs_in];\r\n        else reqs[priority].push(reqs_in);\r\n        if (reqs_in.tgts.length!==0) dispatch();\r\n      },\r\n      req_add: function(reqs_in, priority){\r\n        if (!reqs[priority] || reqs[priority].length===0) reqs[priority] = [reqs_in]; // BUG, destroy prototype.\r\n        else reqs[priority][reqs[priority].length-1].tgts = reqs[priority][reqs[priority].length-1].tgts.concat(reqs_in.tgts);\r\n        dispatch_if_idle();\r\n      },\r\n      check_timestamp_and_flush: check_timestamp_and_flush,\r\n      onload_archive: onload_archive,\r\n      onload_archive_fail: onload_archive_fail,\r\n      sub_funcs: function(args){\r\n        sub_funcs[args[0]](args[1]);\r\n      },\r\n      pause_req: function(){\r\n        pause++;\r\n        pause_timeout.delayed_do();\r\n      },\r\n      pause_cancel: pause_cancel,\r\n      set_health_indicator: function(val){health_indicator = val;},\r\n      get isLocal(){return local;},\r\n    };\r\n  })();\r\n\r\n  var http_req = { // emulation of old interface for uip tracker.\r\n    get: function (sender,key,url,callback,sw_cache,sw_cache_write,callback_arg, archived){\r\n      var dbt = (key.indexOf(',')==-1)? common_func.name2dbt(key): key.split(',');\r\n      if (url==='') url = site2[dbt[0]].make_url4(dbt);\r\n      else if (typeof(url)==='string') url = [ url, 'raw'];\r\n      key = dbt.join(',');\r\n      httpd.req({initiator:key,\r\n                 tgts:[{url:url[0], responseType:(url[1]==='html')? 'document' : (url[1]==='raw')? 'text' : url[1], tgt:key, data_type:url[1], domain:dbt[0]}],\r\n                 callback_1:function(req,val){callback(key,val,callback_arg);},\r\n                 INDICATOR: {shift:function(){}, report:function(){}},\r\n                 IDX:0, FINISHED:0, SUC:0, max:1,\r\n                },6);\r\n    },\r\n  };\r\n\r\n////  var http_req = (function(){ // working code.\r\n////    var iframes = {};\r\n//////    var caches = {}; // prevent occuring multiple access to the same url in short time.\r\n////    var local = true;\r\n////    var parser = new DOMParser();\r\n////    var serializer = new XMLSerializer();\r\n//////    var doc;\r\n//////    var pool; // object pool\r\n////    var reqs = {};\r\n////    var Req = function(sender){\r\n////      this.sender = sender;\r\n////      this.req = null;\r\n////      this.httpd = new XMLHttpRequest();\r\n////      this.httpd.onload  = Req.prototype.onload.bind(this);\r\n////      this.httpd.onerror = this.httpd.onload;\r\n////      this.httpd.onabort = this.httpd.onload;\r\n////    }\r\n////    Req.prototype.onload = function(){\r\n//////      if (local) onload_local(this.sender,{date: Date.now(), __proto__:this.httpd},false); // cause illegal invocation, I don't know why.\r\n////      if (local) {\r\n////        if (this.httpd.responseType==='text') onload_text(this.sender,{date: Date.now(), status: this.httpd.status, responseText: this.httpd.responseText},false); // temporaly patch.\r\n////        else onload_local(this.sender,{date: Date.now(), status: this.httpd.status, response: this.httpd.response},false);\r\n////      } else send_message('parent',[['SUB_ACK',[this.sender,Date.now(),this.httpd.status,this.httpd.responseText]]]);\r\n////    };\r\n////    function get_make_Req(sender, req){\r\n////      if (reqs[sender]===undefined) reqs[sender] = new Req(sender);\r\n////      if (req) reqs[sender].req = req;\r\n////      return reqs[sender];\r\n////    }\r\n////    function destroy_httpd(sender){\r\n////      delete reqs[sender];\r\n////    }\r\n////////    function make_httpd(sender){ // working code.\r\n////////      var httpd = new XMLHttpRequest();\r\n////////      function httpd_events(){\r\n//////////        if (local) onload_local(sender,{date: Date.now(), status: httpd.status, responseText: httpd.responseText},false);\r\n////////        if (local) {\r\n////////          if (httpd.responseType==='text') onload_local(sender,{date: Date.now(), status: httpd.status, responseText: httpd.responseText},false); // temporaly patch.\r\n////////          else onload_local(sender,{date: Date.now(), status: httpd.status, response: httpd.response},false);\r\n////////        } else send_message('parent',[['SUB_ACK',[sender,Date.now(),httpd.status,httpd.responseText]]]);\r\n////////      }\r\n////////      httpd.addEventListener('load',  httpd_events, false);\r\n////////      httpd.addEventListener('error', httpd_events, false);\r\n////////      httpd.addEventListener('abort', httpd_events, false);\r\n////////      httpds[sender] = [httpd, httpd_events];\r\n////////    }\r\n////////    function destroy_httpd(sender){\r\n////////      if (sender in httpds) {\r\n////////        var httpd = httpds[sender][0];\r\n////////        var httpd_events = httpds[sender][1];\r\n////////        httpd.removeEventListener('load',  httpd_events, false);\r\n////////        httpd.removeEventListener('error', httpd_events, false);\r\n////////        httpd.removeEventListener('abort', httpd_events, false);\r\n////////        delete httpds[sender];\r\n//////////if (pref.test_mode['30']) console.log('destroyed: '+site.nickname+'/'+sender)\r\n////////      }\r\n////////    }\r\n////    function make_iframe(domain,url){\r\n//////      var ifrm = cnst.init('left:200px:bottom:200px:display:none:Show'); // working code.\r\n////////      var ifrm = cnst.init('left:200px:bottom:200px:' + ((pref.debug_mode['0'])? '' : 'display:none:') + 'Show');\r\n////////      var ifrm = cnst.init('left:200px:bottom:200px:Show');\r\n//////      ifrm.innerHTML = '<iframe name=' + domain + '></iframe>';\r\n////      cnst.make_iframe(domain);\r\n//////      try {\r\n////        iframes[domain] = window.open((site2[domain].home!=='')? site2[domain].home : url, domain);\r\n////        send_message(domain,[['SUBFRAME_INIT']],iframes[domain]);\r\n//////      } catch (e) {\r\n//////        console.log('IFRAME OPEN ERROR'); // not debugged yet.\r\n//////      }\r\n//////      iframes[domain].onerror = function(){console.log('IFRAME OPEN ERROR');}; // can't catch\r\n////    }\r\n////    function onload_from_sw_cache_check(key,value,args) {\r\n////      if (value!==null) {\r\n//////        var date = value[0];\r\n//////        var req_date = Date.now() - args[4]*1000;\r\n//////        if (date>req_date) {onload_from_sw_cache(key,value,args);return;}\r\n////        if (args[4]===true || value.date > Date.now() - args[4]*1000) {onload_text(args[0],value,true);return;} // date check.\r\n////      }\r\n////      get_req(args[0],args[1],args[2],args[3],false,args[5]);\r\n////    }\r\n////    function onload_text(sender,value,from_cache) {\r\n////      if (reqs[sender]) { // for 8chan's 524 error(Origin Time-out)\r\n////        if (reqs[sender].req.data_type==='html') {\r\n////          value.response = parser.parseFromString(value.responseText, 'text/html');\r\n//////          delete value.responseText;\r\n////        } else if (reqs[sender].req.data_type==='json') {\r\n////          value.response = (value.status==200)? JSON.parse(value.responseText) : value.responseText;\r\n////        }\r\n////        onload_local(sender,value,from_cache);\r\n////      }\r\n//////      value.response = null;\r\n////    }\r\n////    function onload_local(sender,value,from_cache) {\r\n////      if (!reqs[sender]) return;\r\n////      var req = reqs[sender].req;\r\n//////      if (!from_cache && data_type==='html') {\r\n//////        doc = parser.parseFromString(value.responseText, 'text/html');\r\n//////        site2.common.remove_by_tagname(doc,'script');\r\n//////        doc.getElementsByTagName('head')[0].innerHTML = '';\r\n////////        value = {date:value.date, status:value.status, responseText:serializer.serializeToString(doc)};\r\n//////      }\r\n//////      if (!from_cache && cache_write) {\r\n////////        caches[key] = [date, value.status, response_txt];\r\n////////        setTimeout(function(){delete caches[key];},10000);\r\n////////        if (pref.info_server && brwsr.sw_cache && value.status==200) brwsr.sw_cache.setItem(key,[date, response_txt]);\r\n////////        if (pref.info_server && brwsr.sw_cache && value.status==200) brwsr.sw_cache.setItem(key,[date, value.status, response_txt]);\r\n//////        if (pref.info_server && brwsr.sw_cache && value.status==200) {\r\n//////          if (data_type==='html') value = {date:value.date, status:value.status, responseText:serializer.serializeToString(doc)};\r\n//////          brwsr.sw_cache.setItem(key,value);\r\n//////        }\r\n//////      }\r\n//////      if (data_type==='html') {value.response = doc; delete value.responseText;} // trial patch.\r\n//////      else if (data_type==='json') {value.response = JSON.parse(value.responseText); delete value.responseText;}\r\n//////      callback(key, value, callback_arg);\r\n////\r\n////      if (!from_cache && req.data_type==='html' && value.response) {\r\n//////        site2.common.remove_by_tagname(value.response,'script');\r\n//////        var dbt = common_func.name2domainboardthread(key,true);\r\n////        var dbt = req.key.split(',');\r\n////if (pref.test_mode['28']) {\r\n////        site2[dbt[0]].preprocess_doc(value.response);\r\n////}\r\n////if (pref.test_mode['50'] && site2[dbt[0]].preprocess_doc2 && site2[dbt[0]].preprocess_doc2[dbt[3]]) site2[dbt[0]].preprocess_doc2[dbt[3]](value.response);\r\n////if (pref.test_mode['4']) {\r\n////  site2[dbt[0]].remove_posts(value.response,pref.test_mode.num);\r\n////  site2.common.remove_double_br(value.response);\r\n////}\r\n////        if (value.response.getElementsByTagName('head')[0]) value.response.getElementsByTagName('head')[0].innerHTML = '';\r\n////      }\r\n//////var check_perf = ['http_req :', performance.now()];\r\n////      if (!from_cache && req.cache_write) {\r\n////        if (pref.info_server && brwsr.sw_cache && value.status==200) {\r\n////          if (req.data_type==='html') site2.common.remove_by_tagname(value.response,'script');\r\n////          var value_sw_cache = (req.data_type==='html')? {date:value.date, status:value.status, responseText:serializer.serializeToString(value.response)}\r\n////                                                       : {date:value.date, status:value.status, responseText:JSON.stringify(value.response)};\r\n//////check_perf.push(performance.now());\r\n////          brwsr.sw_cache.setItem(req.key,value_sw_cache);\r\n//////check_perf.push(performance.now());\r\n////        }\r\n////      }\r\n////// https://github.com/rtomayko/rack-cache/issues/111 Cache hit gives 200 instead of 304 when behind Nginx, Nginx + StringEtag + chrome.\r\n////if (pref.test_mode['48'] && value.status===304) console.log('onload_local: 304, '+req.key);\r\n////      req.callback(req.key, value, req.callback_arg);\r\n//////if (sender==='catalog') common_func.perf_out(check_perf);\r\n////    }\r\n////    function get_req(sender,domain,url,key,sw_cache,data_type, archived){\r\n//////      if (caches[key]) setTimeout(function(){onload_local(sender,{date: caches[key][0], status: caches[key][1], responseText: caches[key][2]},true);},0); // this make racing condition at checking page in catalog.\r\n////      if ((sw_cache===true || (typeof(sw_cache)==='number' && sw_cache!=0)) && brwsr.sw_cache)\r\n////        brwsr.sw_cache.trygetItem(key,onload_from_sw_cache_check,[sender,domain,url,key,sw_cache,data_type]);\r\n////      else {\r\n////        if (domain==site.nickname || pref.catalog_cross_domain_connection=='direct') {\r\n////          var httpd = get_make_Req(sender).httpd;\r\n////          httpd.open('GET', url, true);\r\n////          httpd.responseType = (archived)? 'text' : (data_type==='html')? 'document' : (data_type==='json')? 'json' : 'text';\r\n////          httpd.send(null);\r\n////        } else {\r\n////          if (!iframes[domain]) make_iframe(domain,url);\r\n////          send_message(domain,[['SUB_GET',[sender,domain,url,key,sw_cache,'text']]]);\r\n////        }\r\n////      }\r\n////    }\r\n////    return {\r\n////      get: function (sender,key,url,callback,sw_cache,sw_cache_write,callback_arg, archived){\r\n////        var dbt = (key.indexOf(',')==-1)? common_func.name2dbt(key): key.split(',');\r\n////        if (url==='') url = site2[dbt[0]].make_url4(dbt);\r\n////        else if (typeof(url)==='string') url = [ url, 'raw'];\r\n////        key = dbt.join(',');\r\n////        get_make_Req(sender, {url:url[0], callback:callback, key:key, sw_cache:sw_cache, sw_cache_write:sw_cache_write, callback_arg:callback_arg, data_type:url[1]});\r\n////        get_req(sender,dbt[0],url[0],key,sw_cache,url[1], archived);\r\n////      },\r\n////////////      get: function (sender,key,url,callback,sw_cache,sw_cache_write,callback_arg){ // working code.\r\n////////////        var dbt = cnst.name2domainboardthread(key,true);\r\n////////////        key = dbt[0]+dbt[1]+dbt[2];\r\n////////////        if (url==='')\r\n////////////          if (dbt[2][0]==='c' || dbt[2][0]==='p' || dbt[2][0]==='j') url = site2[dbt[0]].make_url(dbt[1],parseInt(dbt[2].substr(1),10),dbt[2][0]);\r\n////////////          else url = [site2[dbt[0]].make_url3(dbt[1],dbt[2]), (dbt[2][0]!=='t')? 'html' : 'json'];\r\n////////////        if (typeof(url)==='string') url = [ url, 'raw'];\r\n////////////        req[sender] = {url:url[0], callback:callback, key:key, sw_cache:sw_cache, sw_cache_write:sw_cache_write, callback_arg:callback_arg, data_type:url[1]};\r\n////////////        get_req(sender,dbt[0],url[0],key,sw_cache,url[1]);\r\n////////////      },\r\n////      close:   function(sender){\r\n////        destroy_httpd(sender);\r\n////        if (!pref.test_mode['30']) for (var domain in iframes) send_message(domain,[['SUB_DEST',[sender]]]);\r\n////      },\r\n////      sub_dest: function(args){destroy_httpd(args[0]);},\r\n////      sub_get: function(arg){get_req(arg[0],arg[1],arg[2],arg[3],arg[4],arg[5]);},\r\n////      sub_ack: function(arg){\r\n////        var value =  {date: arg[1], status: arg[2], responseText: arg[3]};\r\n////        onload_text(arg[0], value, false);\r\n////if (pref.test_mode['34']) send_message('meguca',[['ECHO',arg]]);\r\n////      },\r\n////      remote : function(){local=false;}\r\n////    };\r\n////  })();\r\n\r\n//  var http_req = (function(){ // working code, but chokes when and err occur.\r\n//    var reqs = [];\r\n//    var caches = {}; // prevent occuring multiple access to the same url in short time.\r\n//    var httpd = new XMLHttpRequest();\r\n//    var httpd_events = function(){onload_local(httpd.status,httpd.responseText);}; // for local\r\n//    httpd.addEventListener('load',  httpd_events, false);\r\n//    httpd.addEventListener('error', httpd_events, false);\r\n//    httpd.addEventListener('abort', httpd_events, false);\r\n//    \r\n//    function onload_local(status,response_txt) {\r\n//      var req = reqs[0];\r\n//\r\n//      if (req[1]!=null) req[1](status, response_txt);\r\n//        if (pref.info_server && brwsr.sw_cache)\r\n//          brwsr.sw_cache.setItem(req[2]+req[3]+req[4],JSON.stringify([Date.now(), response_txt]));\r\n//\r\n//      prep_next();\r\n//    }\r\n//    function prep_next() {\r\n//      reqs.shift();\r\n//      if (reqs.length!=0) req_get(true); // javascript doesn't allow multiphe threads in a program, so this works well.\r\n//    }\r\n//    function req_get(force) {\r\n//      if (!force && reqs.length>=2) return;\r\n//      var url = reqs[0][0];\r\n//      if (reqs[0][2]==site.nickname || pref.catalog_cross_domain_connection=='direct') {\r\n//        httpd.open('GET', url, true);\r\n//        httpd.send(null);\r\n//      } else {\r\n//        var domain = reqs[0][2];\r\n//        if (!iframes[domain]) {\r\n////          iframes[domain] = [window.open(url,domain), 0];\r\n////          var ifrm = cnst.init('left:300px:bottom:300px:Show');\r\n//          var ifrm = cnst.init('left:300px:bottom:300px:display:none:Show');\r\n//          ifrm.innerHTML = '<iframe name=' + domain + '></iframe>';\r\n//          iframes[domain] = [window.open(url,domain), 0];\r\n//          send_message(domain,[['SUBFRAME_INIT']]);\r\n//        }\r\n//        send_message(domain,[['SUB_GET',reqs[0]]]);\r\n//        iframes[domain][1]++;\r\n//      }\r\n//    }\r\n//    return {\r\n//      get: function(url,callback,domain,board,page,sw_cache,sender){\r\n//        reqs.push([url,callback,domain,board,page,sw_cache,sender]);\r\n//        req_get(false);\r\n//      },\r\n//      remote: function(){\r\n//        httpd.removeEventListener('load',  httpd_events, false);\r\n//        httpd.removeEventListener('error', httpd_events, false);\r\n//        httpd.removeEventListener('abort', httpd_events, false);\r\n//        httpd_events = function(){\r\n//          send_message('parent',[['SUB_ACK',httpd.status, httpd.responseText]]);\r\n//          prep_next();\r\n//        };\r\n//        httpd.addEventListener('load',  httpd_events, false);\r\n//        httpd.addEventListener('error', httpd_events, false);\r\n//        httpd.addEventListener('abort', httpd_events, false);\r\n//      },\r\n//      onload_local: onload_local\r\n//    };\r\n//  })();\r\n\r\n  var cnst = (function(){\r\n    var opts = new WeakMap();\r\n    var tb_funcs = {\r\n      op_p: function(e){\r\n        var s = e.currentTarget.parentNode.style;\r\n        var op = parseFloat(s.opacity) || 1;\r\n        s.opacity = (e.target.name==='op_p')? ((op+0.1>=1)? 1 : op+0.1)\r\n                                            : ((op-0.1<=0.1)? 0.1: op-0.1);\r\n      },\r\n      roll_toggle: function(e, options){\r\n        if (options.cn.style.display=='none') this.rolldown(options);\r\n        else this.rollup(options);\r\n      },\r\n      roll_if_auto: function(e, from_start){\r\n        var options = opts.get(e.currentTarget);\r\n        if (!options) return; // for popup\r\n        if (from_start) {\r\n          if (options.auto_roll && options.cn.style.display!=='none') {\r\n            this.rollup(options);\r\n            options.auto_unroll = true;\r\n          }\r\n        } else if (options.auto_unroll && options.cn.style.display==='none') {\r\n          this.rolldown(options);\r\n          options.auto_unroll = false;\r\n        }\r\n      },\r\n      rolldown: function(options){\r\n        options.tb.style.width = '';\r\n        options.cn.style.display = ''; // for dollchan\r\n        if (options.rolldown) options.rolldown.call(options.this_obj);\r\n      },\r\n      rollup: function(options){\r\n        options.tb.style.width = options.tb.offsetWidth + 'px'; // for dollchan\r\n        options.cn.style.display = 'none'; // for dollchan\r\n        if (options.rollup) options.rollup.call(options.this_obj);\r\n      },\r\n      top: function(e, options){\r\n        this.maximize(options.pn, options.tb, options.cn, e.target.name, options, e.target);\r\n      },\r\n//    var state_arr = ['top','bottom','float','max']; // ['top','bottom','max','float']; // changed 2018.03.30, probably a bug.\r\n      maximize: function(pn,tb,cn, req, options, button_pressed){\r\n        var state = options.maximize_state;\r\n        var now = state[0];\r\n  //      if (options.before_maximize) options.before_maximize(state_str, now);\r\n        state[5].style.display = null;\r\n        var cns = (options.maximize_tgt || cn).style; \r\n        if (now==='float') state = [req, pn.style.left, pn.style.top, cns.width, cns.height, button_pressed, pn.style.right, pn.style.bottom];\r\n        else {state[0] = req; state[5] = button_pressed;}\r\n        if (req==='max') {\r\n          var header_height = site.header_height();\r\n          common_func.overwrite_prop(pn.style, {left:'0px', top:header_height + 'px', position:'fixed', resize:'none', zIndex:pref.style.zIndex});\r\n          common_func.overwrite_prop(cns,\r\n            {width: document.documentElement.clientWidth + 'px', height: document.documentElement.clientHeight - tb.offsetHeight - header_height + 'px', resize:'none'});\r\n        } else if (req==='float'){\r\n          common_func.overwrite_prop(pn.style, {left:state[1], top:state[2], position:'fixed', resize:'both', right:state[6], bottom:state[7], zIndex:pref.style.zIndex});\r\n//          common_func.overwrite_prop(cns, {width:state[3], height:state[4], resize:'both'});\r\n          common_func.overwrite_prop(cns, options.maximize_float_style_pnch1 || {width:state[3], height:state[4], resize:'both'});\r\n        } else {\r\n          var ref = site.embed_to[req]; // 'top' or 'bottom'\r\n          if (ref){\r\n            if (typeof(site.embed_to[req])=='function') ref = site.embed_to[req] = site.embed_to[req](); // lazy evaluation\r\n            common_func.overwrite_prop(pn.style, {left:'auto', top:'auto', position:'relative', resize:'none', right:'auto', bottom:'auto', zIndex:null});\r\n//            common_func.overwrite_prop(pn.style, options.maximize_embed_style_pn || {left:'auto', top:'auto', position:'static', resize:'none'});\r\n            common_func.overwrite_prop(cns, options.maximize_embed_style_pnch1 || {width:'auto', height:'auto', resize:'none'});\r\n//            common_func.overwrite_prop(cns, {width:'auto', height:'auto', resize:'none'});\r\n            ref.parentNode.insertBefore(pn,ref);\r\n          }\r\n        }\r\n        button_pressed.style.display = 'none';\r\n        options.maximize_state = state;\r\n        if (options.maximize) options.maximize.call(options.this_obj, req, now);\r\n      },\r\n      exit: function(e, options){\r\n        if (options.exit) options.exit.call(options.this_obj,e);\r\n        else cnst.div_destroy(options.pn, true);\r\n      },\r\n      settings: function(e, options){\r\n//        if (!pref.test_mode['102'] && !options) return; // patch for embed\r\n        var btn = (e.target.tagName==='BUTTON')? e.target : e.target.parentNode;\r\n        var tgt = opts.get(btn) || options.cn.childNodes[0];\r\n        tgt.style.display = (tgt.style.display==='none')? null : 'none';\r\n        cnst.toggleButton(btn);\r\n      },\r\n    };\r\n    tb_funcs.op_m = tb_funcs.op_p;\r\n    tb_funcs.bottom = tb_funcs.top;\r\n    tb_funcs.float = tb_funcs.top;\r\n    tb_funcs.max = tb_funcs.top;\r\n    tb_funcs.filter = tb_funcs.settings;\r\n    function tb_clicks(e){\r\n      var et = e.target;\r\n      var func = (e.type==='click')? et.tagName==='BUTTON' && tb_funcs[et.name] || et.parentNode.tagName==='BUTTON' && tb_funcs[et.parentNode.name]\r\n                                   : (et.tagName==='DIV' || et.tagName==='SPAN') && tb_funcs['roll_toggle']; // double click\r\n      if (func) {\r\n        e.stopPropagation();\r\n        func.call(tb_funcs, e, opts.get(e.currentTarget.parentNode));\r\n      }\r\n    }\r\n    function ev_to_close(e){\r\n      e.stopPropagation();\r\n      tb_funcs.exit.call(tb_funcs, e, opts.get(e.currentTarget.parentNode));\r\n    }\r\n//    function tb_dblclick(e){\r\n//      if (e.target.tagName==='DIV' || e.target.tagName==='SPAN') tb_funcs['roll_toggle'](e);\r\n//    }\r\n    function tack_float(e){\r\n      var obj = opts.get(e.currentTarget);\r\n      (obj && obj.float || cnst.tack_float_nSblgs)(e);\r\n    }\r\n    function tack_dock(e){\r\n      var obj = opts.get(opts.get(e.currentTarget.parentNode).tack);\r\n      (obj && obj.embed || cnst.tack_dock_nSblgs)(e);\r\n    }\r\n\r\n    function tb_mousedown2(e){\r\n      prep_drag(e, e.currentTarget.parentNode.parentNode);\r\n    }\r\n    function tb_mousedown(e){\r\n      prep_drag(e, e.currentTarget.parentNode);\r\n    }\r\n//    function flip_top(s){\r\n//      return bottom2top(s,{offsetHeight:0});\r\n//    }\r\n    function bottom2top(s,pn){ // can be used as top2bottom also.\r\n      return document.documentElement.clientHeight - parseInt(s, 10) - pn.offsetHeight;\r\n    }\r\n    function right2left(s,pn){\r\n      return document.documentElement.clientWidth - parseInt(s, 10) - pn.offsetWidth;\r\n    }\r\n    function div_mousedown(e){\r\n      if (!pref.proto.popup2_resize || !div_resize_on_border(e))\r\n        if (!(pref.proto.popup2_sel==='sel' || mouse_cursor_on_text(e)))\r\n          if (!pref[cataLog.embed_mode].thumbnail.hover.dragfloat || !cataLog.DIH || !cataLog.DIH.hover_ex) prep_drag(e, e.currentTarget);\r\n    }\r\n    var resize_tlbr = null;\r\n    function div_resize_on_border(e){\r\n      var ecT = e.currentTarget;\r\n      var s = ecT.style;\r\n      var top = e.clientY - ((s.top)? parseInt(s.top, 10) : bottom2top(s.bottom,ecT));\r\n      var left = e.clientX - ((s.left)? parseInt(s.left, 10) : right2left(s.right,ecT));\r\n      var bottom = ecT.offsetHeight - top;\r\n      var right = ecT.offsetWidth - left;\r\n      var tlbr = [top, left, bottom, right];\r\n      for (var i=0;i<4;i++) if (tlbr[i]<=pref.proto.popup2_resize_bw) {\r\n        for (var j=0;j<4;j++) tlbr[j] = (tlbr[j]<=pref.proto.popup2_resize_cw)? parseInt(window.getComputedStyle(ecT)[j%2?'width':'height'],10) : null;\r\n        document.body.addEventListener('mouseup', div_mouseup_resize, false);\r\n//        document.body.addEventListener('mousemove', div_mousemove_resize, false); // NOT STABLE, causes mouseout.\r\n        document.body.addEventListener('dragend', div_mouseup_resize, false);\r\n        document.body.addEventListener('drag', div_mousemove_resize, false);\r\n        drag_sx = e.screenX;\r\n        drag_sy = e.screenY;\r\n        tlbr.push(parseInt(s.top,10), parseInt(s.left,10), parseInt(s.bottom,10), parseInt(s.right,10), ecT);\r\n        resize_tlbr = tlbr;\r\n        e.stopPropagation();\r\n        ecT.draggable = true;\r\n//        ecT.style.cursor = (tlbr[0] && tlbr[1] || tlbr[2] && tlbr[3])? 'nwse-resize'\r\n//                         : (tlbr[0] && tlbr[3] || tlbr[2] && tlbr[1])? 'nesw-resize'\r\n//                         : (tlbr[0] || tlbr[2])? 'row-resize': 'col-resize';\r\n        return true;\r\n      }\r\n      return false;\r\n    }\r\n    function div_mousemove_resize(e){\r\n      if (e.screenX===0) return; // BUG of chome??? Last event contains error value.\r\n      var tlbr = resize_tlbr;\r\n      var pn = tlbr[8];\r\n      var s = pn.style;\r\n      var dx = e.screenX - drag_sx;\r\n      var dy = e.screenY - drag_sy;\r\n      if (tlbr[0]) {s.height = tlbr[0] - dy + 'px'; if (s.top)    s.top    = tlbr[4] + dy + 'px';}\r\n      if (tlbr[1]) {s.width  = tlbr[1] - dx + 'px'; if (s.left)   s.left   = tlbr[5] + dx + 'px';}\r\n      if (tlbr[2]) {s.height = tlbr[2] + dy + 'px'; if (s.bottom) s.bottom = tlbr[6] - dy + 'px';}\r\n      if (tlbr[3]) {s.width  = tlbr[3] + dx + 'px'; if (s.right)  s.right  = tlbr[7] - dx + 'px';}\r\n      e.stopPropagation();\r\n    }\r\n    function div_mouseup_resize(e){\r\n      var ecT = e.currentTarget;\r\n      ecT.removeEventListener('drag', div_mousemove_resize, false);\r\n      ecT.removeEventListener('dragend', div_mouseup_resize, false);\r\n//      ecT.removeEventListener('mousemove', div_mousemove_resize, false);\r\n      ecT.removeEventListener('mouseup', div_mouseup_resize, false);\r\n      e.stopPropagation();\r\n      ecT.draggable = false;\r\n      resize_tlbr = null;\r\n//      ecT.style.cursor = null;\r\n    }\r\n    function prep_drag(e, pn){\r\n      pn.draggable = true;\r\n      pn.addEventListener('dragstart', div_dragstart_dynamic, false);\r\n      pn.addEventListener('mouseup', div_mouseup, false);\r\n      e.stopPropagation();\r\n    }\r\n    function div_mouseup(e){\r\n      e.currentTarget.removeEventListener('mouseup', div_mouseup, false);\r\n      e.currentTarget.draggable = false;\r\n    }\r\n    function mouse_cursor_on_text(e){\r\n      if (e.target.tagName==='INPUT' || e.target.tagName==='TEXTAREA' || e.target.tagName==='SELECT') return true;\r\n      if (pref.proto.popup2_sel==='move') return false;\r\n      var et_cn = e.target.childNodes;\r\n//      if (et_cn.length===1) return et_cn[0].nodeType===3; // textNode\r\n      var range = new Range();\r\n      for (var i=0;i<et_cn.length;i++) {\r\n        var tx = (et_cn[i].tagName==='BUTTON' || et_cn[i].tagName==='SELECT')? 0 : pref.proto.popup2_sel_tolerance;\r\n        range.selectNode(et_cn[i]);\r\n        var rects = range.getClientRects();\r\n        for (var j=0;j<rects.length;j++) {\r\n          var rect = rects[j];\r\n          if (rect.bottom>e.clientY && e.clientY>=rect.top)\r\n            if (rect.left-tx < e.clientX && e.clientX < rect.right+tx) return true;\r\n        }\r\n      }\r\n      return false;\r\n    }\r\n    var drag_sx;\r\n    var drag_sy;\r\n//    var drag_cursor_style;\r\n    var root_body = document.body;\r\n    function div_dragstart_dynamic(e){ // with tb or popup\r\n      e.currentTarget.removeEventListener('dragstart', div_dragstart_dynamic, false);\r\n      e.currentTarget.removeEventListener('mouseup', div_mouseup, false);\r\n      tb_funcs.roll_if_auto(e, true);\r\n      div_dragstart(e, true)\r\n    }\r\n    function div_dragstart(e, dynamic){ // static\r\n      var cT = e.currentTarget;\r\n//      if (this.pn) this.pn.removeEventListener('dragstart', this.event_funcs.dragstart, false);\r\n      drag_sx = e.screenX;\r\n      drag_sy = e.screenY;\r\n//      drag_cursor_style = pn.style.cursor;\r\n//      pn.style.cursor = 'move';\r\n      e.dataTransfer.setData('text/plain', ''); // for FF. CH doesn't require this.\r\n      e.dataTransfer.effectAllowed = 'move';\r\n      e.dataTransfer.dropEffect = 'move';\r\n//      e.preventDefault();\r\n      e.stopPropagation(); // prevent from invoking twice when legend on chart is moved.\r\n      cT.style.opacity = 0.4;\r\n//      div_dragend_caller = this;\r\n      cT.addEventListener('dragend', (dynamic)? div_dragend_dynamic : div_dragend, false);\r\n      root_body.addEventListener('dragover',div_dragover,false);\r\n    }\r\n    function div_dragover(e){ // http://www.html5rocks.com/ja/tutorials/dnd/basics/\r\n      e.preventDefault();\r\n      e.dataTransfer.dropEffect = 'move';\r\n    }\r\n//    var div_dragend_caller;\r\n    function div_dragend_dynamic(e){\r\n      div_dragend(e, true);\r\n      tb_funcs.roll_if_auto(e, false);\r\n      e.currentTarget.draggable = false;\r\n    }\r\n    function div_dragend(e, dynamic){\r\n      root_body.removeEventListener('dragover',div_dragover,false);\r\n      var cT = e.currentTarget;\r\n      var s = cT.style;\r\n      cT.removeEventListener('dragend', (dynamic)? div_dragend_dynamic : div_dragend, false);\r\n      if (s.left) s.left  = (parseInt(s.left ,10) + e.screenX - drag_sx) + 'px';\r\n      else        s.right = (parseInt(s.right,10) - e.screenX + drag_sx) + 'px';\r\n      if (s.bottom) s.bottom = (parseInt(s.bottom,10) - e.screenY + drag_sy) + 'px';\r\n      else          s.top =    (parseInt(s.top   ,10) + e.screenY - drag_sy) + 'px';\r\n//      if (div_dragend_caller.dragend) div_dragend_caller.dragend.call(div_dragend_caller.this_obj,e); // isn't used anymore.\r\n//      div_dragend_caller = null;\r\n      s.opacity = 1;\r\n      e.stopPropagation();\r\n    }\r\n    function div_scroll(e){\r\n      var val = (!brwsr.ff)? e.wheelDelta : -e.detail*40;\r\n      var s = e.currentTarget.style;\r\n      if (s.bottom) s.bottom = (parseInt(s.bottom,10) - val) + 'px'; // from bottom.\r\n      else s.top = (parseInt(s.top,10) + val) + 'px';\r\n      e.preventDefault();\r\n    }\r\n    var tile = {\r\n      left   : 0,\r\n      bottom : 0,\r\n      last_pn: null, // CAUTION. grep last pn permanently.\r\n    };\r\n    return {\r\n      init3: function(obj){\r\n        return this.init(obj.func_str,null,null,null,null,obj.pn_st, obj);\r\n      },\r\n      init2: function(obj){\r\n        return this.init(obj.func_str,obj.rolldown_func,obj.rollup_func,obj.exit_func,obj.maximize_func,obj.pn_st);\r\n      },\r\n      init: function(func_str,rolldown_func,rollup_func,exit_func,maximize_func,site_settings, options){\r\n        var options_is_given = (options!==undefined);\r\n        if (options===undefined) options = { // options WILL BE this.\r\n          rolldown: rolldown_func,\r\n          rollup: rollup_func,\r\n          exit: exit_func,\r\n          maximize: maximize_func,\r\n        };\r\n        var pn = document.createElement('span');\r\n        options.pn = pn; // must be prior to 'tb_press'\r\n        if (site_settings) {\r\n          pn.textContent = ' '+func_str.replace(/.*:button:/,'').replace(/:.*/,'');\r\n          pn.setAttribute('style','cursor:pointer');\r\n          site_settings.appendChild(document.createTextNode(' '));\r\n          site_settings.appendChild(pn);\r\n          return pn;\r\n        }\r\n//        var pn = document.createElement('div');\r\n        if (!pn.style) pn.style = {};\r\n        pn.style.position = 'fixed';\r\n        pn.draggable = true;\r\n        pn.style.padding = '0px';\r\n        pn.style.zIndex = pref.style.zIndex;\r\n        pn.style.float = 'left'; // for embed_to_top/bottom\r\n        pn.style.display = 'inline-block';\r\n        var funcs = func_str.split(':');\r\n        var i=0;\r\n        if (funcs[0]!='pop') {\r\n//          pn.style.background = '#e5ecf9';\r\n//          pn.style.color = '#000000';\r\n//          pn.style.fontWeight = 'normal';\r\n//          pn.style.border = '1px solid blue';\r\n//          pn.style.border = 'none';\r\n        } else {\r\n          var pop = true;\r\n          pn.addEventListener(brwsr.mousewheel, div_scroll, false);\r\n          pn.name = 'catalog_pop';\r\n          i=1;\r\n          pn.draggable = false;\r\n        }\r\n        pn.setAttribute('class', pref.script_prefix+'_window');\r\n//        var rollup_func_tb = null;\r\n        var tgt = pn;\r\n        while (i<funcs.length) {\r\n          var arg = funcs[i++];\r\n          if (arg=='tb') {\r\n            pn.setAttribute('class', pref.script_prefix+'_titleBar');\r\n            pn.innerHTML = pref_func.format_html_str('<div style=\"height:auto;overflow:hidden\">' +\r\n                '<div style=\"float: left\"><BTN\"roll_toggle,-\"><BTN\"op_m,&lt;\"><BTN\"op_p,&gt;\"><span style=\"width:16px;display:inline-block\"></span></div>' +\r\n                '<div style=\"float: right\"><BTN\"top,^\"><BTN\"bottom,v\"><BTN\"float,o\" style=\"display:none\"><BTN\"max,[]\"><BTN\"exit,X\"></div>' +\r\n                '<div></div>' +\r\n              '</div>' +\r\n              '<div class=\"' + pref.script_prefix + '_window\" style=\"margin: 0px 3px 3px 3px;clear:both\"></div>');\r\n            var tb = pn.childNodes[0];\r\n            var cn = pn.childNodes[1];\r\n//            tb.childNodes[2].style.height = tb.childNodes[0].offsetHeight + 'px';\r\n//            tb.childNodes[0].style.cursor = 'move';\r\n//            tb.childNodes[2].style.cursor = 'move';\r\n//            rollup_func_tb = function(){rollup(pn,pn.childNodes[1], options);};\r\n//            tb.childNodes[0].childNodes[0].onclick = rollup_func_tb;\r\n//            tb.childNodes[0].childNodes[1].onclick = function(){opacity(pn, false);};\r\n//            tb.childNodes[0].childNodes[2].onclick = function(){opacity(pn, true);};\r\n//            tb.childNodes[0].childNodes[3].ondblclick = rollup_func_tb;\r\n//            tb.childNodes[2].ondblclick = rollup_func_tb;\r\n            options.maximize_state = ['float',null,null,null,null,tb.childNodes[1].childNodes[2]];\r\n//            options.maximize_state_str = 'float';\r\n//            tb.childNodes[1].childNodes[0].onclick = function(){maximize(pn,tb,0, options);}; // can reduce footprint if 'prototype' is used.\r\n//            tb.childNodes[1].childNodes[1].onclick = function(){maximize(pn,tb,1, options);};\r\n//            tb.childNodes[1].childNodes[2].onclick = function(){maximize(pn,tb,2, options);};\r\n//            tb.childNodes[1].childNodes[3].onclick = function(){maximize(pn,tb,3, options);};\r\n//            tb.childNodes[1].childNodes[4].onclick = (options.this_obj)? options.exit.bind(options.this_obj) : options.exit;\r\n//            if (brwsr.ff) {\r\n            pn.draggable = false;\r\n//            tb.childNodes[0].draggable = true;\r\n//            tb.childNodes[2].draggable = true;\r\n//            }\r\n            tgt = pn.childNodes[1];\r\n            tb.onclick = tb_clicks;\r\n            tb.ondblclick = tb_clicks;\r\n//            tb.ondblclick = tb_dblclick;\r\n            tb.childNodes[0].onmousedown = tb_mousedown2; // these will be removed.\r\n            tb.childNodes[1].onmousedown = tb_mousedown2;\r\n            tb.childNodes[2].onmousedown = tb_mousedown2;\r\n            tb.onmousedown = tb_mousedown;\r\n            options.tb = tb;\r\n            options.cn = cn;\r\n            opts.set(pn,options);\r\n          } else if (arg=='ftb') {\r\n            tb.childNodes[0].removeChild(tb.childNodes[0].childNodes[0]);\r\n            pn.insertBefore(cn,tb);\r\n            var s = tb.style;\r\n            s.position = 'absolute';\r\n            s.top = '0px';\r\n            s.width = '100%';\r\n            cn.style.margin = '3px';\r\n            tb.classList.add(pref.script_prefix+'_autoTp');\r\n            var pf = pref[cataLog.embed_mode].thumbnail.hover;\r\n            if (pf.df_dblC) cn.ondblclick = ev_to_close;\r\n            tb.ondblclick = ev_to_close;\r\n            if (pf.df_mW) pn['on'+brwsr.mousewheel] = div_scroll;\r\n          } else if (arg=='tb_press') {\r\n            var btn = funcs[i++];\r\n            if (btn!=='float') tb_clicks({target:tb.getElementsByTagName('button')[btn], currentTarget:tb, type:'click', stopPropagation:function(){}});\r\n          } else if (arg=='embed') {\r\n            tb.childNodes[0].onmousedown = null; // overwrite\r\n            tb.childNodes[1].onmousedown = null;\r\n            tb.childNodes[2].onmousedown = null;\r\n            tb.onmousedown = null;\r\n          } else if (arg=='bottom_top') {\r\n            this.bottom_top(pn);\r\n          } else if (arg=='txt' || (brwsr.ff && arg=='button')) {\r\n            tgt.appendChild(document.createTextNode(funcs[i++]));\r\n            tgt.style.cursor = 'pointer';\r\n            tgt.style.padding = '2px 5px 2px 5px';\r\n          } else if (arg=='button') {\r\n            tgt.innerHTML = '<input type=\"button\" value=\"' + funcs[i++] + '\">';\r\n//            tgt.innerHTML = '<button draggable=\"true\">' + funcs[++] + '</button>';\r\n            tgt.style.padding = '0';\r\n            tgt.style.border = '0';\r\n            tgt.style.background = 'none';\r\n          } else if (arg=='Show2') {\r\n            if (site.root_body!==site.root_body2 && site.root_body2) {\r\n              pn.style.position = 'static';\r\n              site.root_body2.appendChild(pn);\r\n            } else site.root_body.appendChild(pn);\r\n          } else if (arg=='Show') site.script_body.appendChild(pn);\r\n//          } else if (arg=='Show') site.root_body.appendChild(pn);\r\n          else if (arg=='tile' || arg=='tile2') {\r\n            if (funcs[i++]=='set') {\r\n              if (funcs[i]=='left') {tile[funcs[i]] = parseInt(pn.style[funcs[i]].replace(/px/,''),10) + pn.offsetWidth;i++;}\r\n              else {tile[funcs[i]] = parseInt(pn.style[funcs[i]].replace(/px/,''),10) + pn.offsetHeight;i++;}\r\n            } else if (arg==='tile') {pn.style[funcs[i]] = tile[funcs[i]]+'px';i++;} // tile:get\r\n            else {pn.style[funcs[i]] = tile[funcs[i]]+parseInt(funcs[i+1],10)+'px';i+=2;} // tile2:get\r\n            \r\n//            console.log(tile);\r\n          } else tgt.style[arg] = funcs[i++];\r\n        }\r\n//        options.event_funcs = {};\r\n        if (tb || pop) pn.addEventListener('mousedown', div_mousedown, false);\r\n        else pn.addEventListener('dragstart', div_dragstart, false);\r\n//        options.event_funcs.dragstart = div_dragstart.bind(options);\r\n//        pn.addEventListener('dragstart', options.event_funcs.dragstart, false);\r\n        tile.last_pn = pn;\r\n//        options.rollup_func_tb = rollup_func_tb;\r\n        if (options_is_given) return options;\r\n        return pn;\r\n//        return (rollup_func_tb)? [pn,rollup_func_tb] : pn;\r\n      },\r\n      tile_set_bottom: function(){if (tile.last_pn) tile.bottom = tile.last_pn.offsetHeight;},\r\n      tile_set_left: function(){if (tile.last_pn) tile.left = tile.last_pn.offsetWidth;},\r\n//      top2bottom: bottom2top,\r\n      left2right: right2left,\r\n//      flip_top: flip_top,\r\n      bottom_top: function(pn){\r\n        var s = pn.style;\r\n        if (s.bottom) {\r\n          s.top = bottom2top(s.bottom,pn) + 'px';\r\n          s.bottom = null;\r\n        }\r\n        if (s.right) {\r\n          s.left = right2left(s.right,pn) + 'px';\r\n          s.right = null;\r\n        }\r\n      },\r\n      void_func: function(){},\r\n      div_mousedown: div_mousedown,\r\n      div_dragstart: div_dragstart,\r\n      div_scroll: div_scroll,\r\n      div_destroy: function(pn,child_of_body, options){\r\n//        pref_func.tooltips.remove_hier(pn);\r\n//        pref_func.tooltips.remove_root(pn);\r\n        if (child_of_body) pn.parentNode.removeChild(pn);\r\n        if (pn.name || opts.has(pn)) pn.removeEventListener('mousedown', div_mousedown, false);\r\n        else pn.removeEventListener('dragstart', div_dragstart, false);\r\n//        pn.removeEventListener('dragstart', (options)? options.event_funcs.dragstart : div_dragstart, false);\r\n        if (pn.name) pn.removeEventListener(brwsr.mousewheel, div_scroll, false);\r\n        return null;\r\n      },\r\n      tb_prep_for_embed: function(tb){\r\n        tb.childNodes[0].innerHTML = '';\r\n        tb.childNodes[1].innerHTML = '';\r\n//        tb.childNodes[0].draggable = false;\r\n//        tb.childNodes[3].ondblclick = null;\r\n//        tb.childNodes[3].draggable = false;\r\n        tb.childNodes[3].removeAttribute('style');\r\n        tb.ondblclick = null;\r\n//        tb.onmousedown = null;\r\n//        tb.childNodes[2].onmousedown = null;\r\n      },\r\n      add_to_tb: function(pn,str){\r\n        var pn_2 = document.createElement('div');\r\n        pn_2.style.float = 'right'; // doesn't work on FF\r\n        pn_2.style.resize = 'none';\r\n        pn_2.style.overflow = 'visible';\r\n        pn_2.innerHTML = str;\r\n        pn.childNodes[0].insertBefore(pn_2,pn.childNodes[0].childNodes[pn.childNodes[0].childNodes.length-1]);\r\n//        if (brwsr.ff) pn.childNodes[0].childNodes[2].setAttribute('style','float: right');\r\n        if (brwsr.ff) pn_2.setAttribute('style','float: right');\r\n        return pn_2;\r\n      },\r\n      show_hide: function(pn,pn2, pn3){\r\n        if (pn.style.display=='none') {\r\n          pn.style.display='';\r\n          if (pn2) pn2.style.height = parseInt(pn2.style.height.replace(/px/,''),10) - pn.offsetHeight + 'px'; // May not work? It depends on the timing of invoking rendering engine. Chrome is ok.\r\n          if (pn3) pn3.style.top    = parseInt(pn3.style.top.replace(/px/,''),10)    + pn.offsetHeight + 'px';\r\n        } else {\r\n          if (pn2) pn2.style.height = parseInt(pn2.style.height.replace(/px/,''),10) + pn.offsetHeight + 'px';\r\n          if (pn3) pn3.style.top    = parseInt(pn3.style.top.replace(/px/,''),10)    - pn.offsetHeight + 'px';\r\n          pn.style.display='none';\r\n        }\r\n      },\r\n//      rollup: function(tb,pn){rollup(tb,pn,cnst.void_func,cnst.void_func);},\r\n      name2domainboardthread: common_func.name2domainboardthread,\r\n//      name2domainboardthread: function(name,fill){\r\n//        var thread = name.replace(/[^\\/]*\\//g,'');\r\n//        var domain = name.replace(/\\/.*/,'');\r\n//        var board  = name.replace(new RegExp('^'+domain),'').replace(new RegExp(thread+'$'),'');\r\n//        if (thread==domain)\r\n//          if (thread.search(/[^0-9]/)!=-1) thread ='';\r\n//          else domain = '';\r\n//        if (fill) {\r\n//          if (domain==='') domain = site.nickname;\r\n//          if (board==='') board = site.board;\r\n//        }\r\n//        return [domain,board,thread];\r\n//      },\r\n      get_time: function(){\r\n        var now = new Date();\r\n        var hour = now.getHours();\r\n        var min = now.getMinutes();\r\n        var sec = now.getSeconds();\r\n        if(hour<10) hour = '0' + hour;\r\n        if(min<10)  min  = '0' + min;\r\n        if(sec<10)  sec  = '0' + sec;\r\n        return hour + ':' + min + ':' + sec;\r\n      },\r\n      make_destroy: function(parent,key,func_make,func_destroy){\r\n        if (!parent[key]) parent[key] = func_make();\r\n        else parent[key] = func_destroy();\r\n      },\r\n      make_popup: function(parent,tgt,html,onchange_func){\r\n        parent[tgt] = cnst.init('left:0px:tile:get:bottom:Show:tb',cnst.void_func,cnst.void_func, function(){\r\n            parent[tgt] = cnst.div_destroy(parent[tgt], true);\r\n          },cnst.void_func);\r\n        parent[tgt].childNodes[1].innerHTML = html;\r\n        pref_func.add_onchange(parent[tgt].childNodes[1],onchange_func);\r\n      },\r\n      make_iframe: function(name){\r\n        if (site2[name] && site2[name].X_FRAME_OPTIONS && pref.network.overXFO || site2[site.nickname].CONTENT_SECURITY_POLICY_FRAME && pref.network.overCSPF) {\r\n//           setTimeout(function(){window.focus();},2000); // this doesn't effect.\r\n          return;\r\n        }\r\n        var ifrm = document.createElement('iframe');\r\n        ifrm.name = name;\r\n        ifrm.setAttribute('style','display:none');\r\n        site.script_body.appendChild(ifrm);\r\n        return ifrm;\r\n      },\r\n\r\n\r\n      subscribe: function(container, tgt){ // for [] container.\r\n        container.push(tgt);\r\n      },\r\n      unsubscribe: function(container, tgt){\r\n        var idx = container.indexOf(tgt);\r\n        if (idx!=-1) container.splice(idx,1);\r\n      },\r\n      foreach: function(container, func){\r\n        for (var i=0;i<container.length;i++) func(container[i]);\r\n      },\r\n      auto_shrink_board_selector: (function(){\r\n        var sels = [];\r\n        function focus(){\r\n          this.removeAttribute('style');\r\n          for (var j=0;j<this.length;j++) {\r\n            this.options[j].text = pref.catalog_board_list_obj[j][0].key;\r\n            color(this.options[j],j);\r\n          }\r\n        }\r\n        function blur(){\r\n          for (var j=0;j<this.length;j++)\r\n            if (j!=this.selectedIndex) this.options[j].text = '';\r\n          color(this,this.selectedIndex);\r\n        }\r\n        function prep(sel, idx){\r\n          if (idx===undefined) idx = sel.selectedIndex;\r\n          sel.length=0;\r\n          for (var j=0;j<pref.catalog_board_list_obj.length;j++) {\r\n            sel.length++;\r\n            sel.options[sel.length-1].text = pref.catalog_board_list_obj[j][0]['key'];\r\n          }\r\n          sel.selectedIndex = (idx>=sel.length)? 0 : idx;\r\n          sel.onblur();\r\n        }\r\n        function color(pn,idx){\r\n          if (pref3.stats.use && (pref.stats.auto_acquisition || pref.stats.auto_acquisition_all) && stats.query_auto_acquisition(idx)) pn.setAttribute('style','background:#b5fbda');\r\n          else pn.removeAttribute('style');\r\n        }\r\n        return {\r\n          setup: function(sel, idx){\r\n            sel.onfocus = focus;\r\n            sel.onblur = blur;\r\n            prep(sel, idx);\r\n            cnst.subscribe(sels,sel);\r\n          },\r\n          str_changed: function(){\r\n            cnst.foreach(sels,prep);\r\n          },\r\n          destroy: function(sel){\r\n            cnst.unsubscribe(sels,sel);\r\n          },\r\n          color: function(){\r\n            cnst.foreach(sels,function(inst){color(inst,inst.selectedIndex);});\r\n          },\r\n        };\r\n      })(),\r\n      auto_shrink_selector: (function(){\r\n        var options = Object.create(null);\r\n        function focus(){\r\n          var opts = options[this.getAttribute('name')];\r\n          for (var j=0;j<this.length;j++) if (this.options[j].text==='') this.options[j].text = opts[j];\r\n        }\r\n        function blur(){\r\n          var opts = [];\r\n          for (var j=0;j<this.length;j++) {\r\n            opts[j] = this.options[j].text;\r\n            if (j!=this.selectedIndex) this.options[j].text = '';\r\n          }\r\n          options[this.getAttribute('name')] = opts;\r\n        }\r\n        return function(sel){\r\n          sel.onfocus = focus;\r\n          sel.onblur = blur;\r\n          sel.onblur();\r\n        };\r\n      })(),\r\n      config_expander: (function(){\r\n        function make_opts(){\r\n          var num = pref[cataLog.embed_mode].t2h_num_of_posts;\r\n          return ['Same as the page', pref[cataLog.embed_mode].t2h_L + ' posts', pref[cataLog.embed_mode].t2h_M + ' posts',\r\n                  num + ' posts', num + ' + all unread posts', 'All unread posts', 'All'];\r\n        }\r\n        function focus(){\r\n          var opts = make_opts();\r\n          for (var j=0;j<this.length;j++) if (this.options[j].text==='') this.options[j].text = opts[j];\r\n        }\r\n        function blur(){\r\n          for (var j=0;j<this.length;j++) if (j!=this.selectedIndex) this.options[j].text = '';\r\n        }\r\n        return function(key, idx){\r\n          var sel = document.createElement('select');\r\n          sel.className = pref.script_prefix + '_expander';\r\n          sel.setAttribute('data-key',key);\r\n          sel.length = 7;\r\n          if (idx===undefined) idx = 0;\r\n          sel.selectedIndex = idx;\r\n          sel.options[idx].text = (idx===0)? 'Expand...' : make_opts()[idx];\r\n          sel.onfocus = focus;\r\n          sel.onblur = blur;\r\n//          sel.onblur();\r\n          return sel;\r\n        };\r\n      })(),\r\n      icons: {\r\n        filter: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcAQAAAABaduI5AAAAAnRSTlMAAQGU/a4AAABUSURBVAjXY/j///8HBjAx////CQz8//8zMLD//8fAwPz/DwND4/8fAgwH/n8wYHhQ/6CA4YP9gQ8MP+QbPzD84Wf+wPCPnx2ol5+fLKJfHmovnAAAn79HiYOE2q8AAAAldEVYdGRhdGU6Y3JlYXRlADIwMTUtMTAtMjlUMDI6MTM6MzkrMDk6MDBxKtFiAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE1LTEwLTI5VDAyOjEzOjM5KzA5OjAwAHdp3gAAAABJRU5ErkJggg==',\r\n        settings: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcAQAAAABaduI5AAAAAnRSTlMAAQGU/a4AAABWSURBVAjXdY6xDcAgDAQvGzAKG2QllykiwWgexWxgKQ2dI4yULs1X9/dPWHMyHrudYZegvVQ6FBQqdqrgzRwLF0ZM4YjJfySS8K4tQaq2dOlzKCe/By9fz0MDWLKIZgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNS0xMC0yOVQwMjowMzowNiswOTowMMhjeagAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTUtMTAtMjlUMDI6MDM6MDYrMDk6MDC5PsEUAAAAAElFTkSuQmCC',\r\n        refresh: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcAQAAAABaduI5AAAAAnRSTlMAAQGU/a4AAABmSURBVAjXbY6xDYAwDASfijLegBUYLRuAlCIljITEAowQNnCZIspjQ0tzkvX6e4NKBREudIw7KgaBTqugLEVwUwWnI9HOzMNh6UarhR+8QWaXD4nNBW02VY0ujdAA9SH1yXfcYG88J0BH+yT9vZAAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTUtMTAtMjhUMjM6NDg6MDYrMDk6MDASyn1kAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE1LTEwLTI4VDIzOjQ4OjA2KzA5OjAwY5fF2AAAAABJRU5ErkJggg==',\r\n        img: function(src){return '<img src=\"' + src + '\" style=\"width:14px;height:14px\">';},\r\n        button_settings: function(){return '<button type=\"button\" name=\"settings\">'+this.img(this.settings)+'</button>';},\r\n      },\r\n      toggleButton: function(pn){\r\n        if (pn.style && pn.style.border) pn.style.border = '';\r\n        else pn.style.border = 'inset 2px';\r\n      },\r\n//      toggleButton: (function(){\r\n//        var style_str = 'width:14px;height:14px';\r\n//        return function(name,icon){\r\n//          var button = document.createElement('button');\r\n//          button.src = cnst.icons[icon];\r\n//          button.setAttribute('style',style_str);\r\n//          return button;\r\n//        };\r\n//      })(),\r\n      createElement: function(html){\r\n        var pn = document.createElement('div');\r\n        pn.innerHTML = html;\r\n        return (pn.childNodes.length===1)? pn.childNodes[0] : pn.querySelectorAll('*'); // return static array.\r\n      },\r\n      set_tack_float: function(pn, func_float, func_embed){\r\n        if (func_float || func_embed) opts.set(pn, {float: func_float, embed: func_embed});\r\n        pn.onclick = tack_float;\r\n        return pn;\r\n      },\r\n      tack_float_nSblgs: function(e, all){\r\n        var ecT = e.currentTarget;\r\n        var tgt = ecT.nextSibling;\r\n        var left = tgt.offsetLeft - tgt.scrollLeft;\r\n        var tgt_p = tgt.parentNode;\r\n        var scrollTop;\r\n        while (tgt_p && !scrollTop) {scrollTop = tgt_p.scrollTop; tgt_p = tgt_p.parentNode;}\r\n        var top = tgt.offsetTop - (scrollTop||0);\r\n        var obj = cnst.init3({func_str:'left:'+left+'px:top:'+top+'px:overflow:hidden:Show:tb', exit:tack_dock, tack:ecT});\r\n        obj.cn.innerHTML = '<div style=\"display: none\"></div><div></div>';\r\n        var dst = obj.cn.childNodes[1];\r\n        tgt.parentNode.insertBefore(obj.pn,tgt);\r\n        dst.appendChild(tgt);\r\n        if (all) while (obj.pn.nextSibling) dst.appendChild(obj.pn.nextSibling);\r\n        ecT.style.display = 'none';\r\n        return obj;\r\n      },\r\n      tack_dock_nSblgs: function(e){\r\n        var pn = e.currentTarget.parentNode;\r\n        var obj = opts.get(pn);\r\n        var tack_p = obj.tack.parentNode;\r\n        var ref = obj.tack.nextSibling;\r\n        var src = obj.cn.childNodes[1];\r\n        while (src.firstChild) tack_p.insertBefore(src.firstChild,ref); // all childrens are retrieved always.\r\n        obj.tack.style.display = null;\r\n        cnst.div_destroy(pn, true);\r\n        return obj.tack;\r\n      },\r\n      tack_dock_e2tack: function(e){\r\n        var pn = e.currentTarget.parentNode;\r\n        return opts.get(pn).tack;\r\n      },\r\n      set_target_of_button: function(button, tgt){\r\n        opts.set(button, tgt);\r\n      },\r\n    };\r\n  })();\r\n\r\n////  function Cnst2(func_str,funcs_args){ // rolldown, rollup, exit, maximize // test for prototype base coding.\r\n////    var pn = document.createElement('div');\r\n////    if (!pn.style) pn.style = {};\r\n////    pn.style.position = 'fixed';\r\n////    pn.draggable = true;\r\n////    pn.style.padding = '0px';\r\n////    var funcs = func_str.split(':');\r\n////    var i=0;\r\n////    if (funcs[0]!='pop') {\r\n////      pn.style.background = '#e5ecf9';\r\n////      pn.style.color = '#000000';\r\n////      pn.style.fontWeight = 'normal';\r\n////      pn.style.border = '1px solid blue';\r\n//////      pn.style.border = 'none';\r\n////    } else {\r\n////      pn.addEventListener(brwsr.mousewheel, div_scroll, false);\r\n////      pn.name = 'catalog_pop';\r\n////      i=1;\r\n////    }\r\n////    this.pn = pn;\r\n////\r\n////    var tgt = pn;\r\n////    var funcs = func_str.split(':');\r\n////    while (i<funcs.length) {\r\n////      var arg = funcs[i++];\r\n////      if (arg=='tb') {\r\n////        pn.style.background = '#b5ccf9';\r\n////        pn.innerHTML = '<div>' +\r\n////          '<div style=\"float: left\"><button name=\"rollup\">-</button><button name=\"opacity,-0.1\"><</button><button name=\"opacity,0.1\">></button><span>&emsp;</span></div>' +\r\n////          '<div style=\"float: right\"><button name=\"embed_top\" style=\"display:inline\">^</button><button name=\"embed_bottom\" style=\"display:inline\">_</button><button name=\"float\" style=\"display:none\">o</button><button name=\"maximize\" style=\"display:inline\">[]</button><button name=\"exit\">X</button></div>' +\r\n////          '<div></div>' +\r\n////          '</div>' +\r\n////          '<div style=\"background: #e5ecf9; margin: 0px 3px 3px 3px\"></div>';\r\n////        var tb = pn.childNodes[0];\r\n////        tb.childNodes[2].style.height = tb.childNodes[0].offsetHeight + 'px';\r\n////        tb.childNodes[2].ondblclick = (function(myself){return function(){myself.button_click(\"rollup\");};})(this);\r\n//////        tb.childNodes[0].childNodes[3].ondblclick = tb.childNodes[2].ondblclick;\r\n////        pn.draggable = false;\r\n////        tb.childNodes[0].draggable = true;\r\n////        tb.childNodes[2].draggable = true;\r\n////        tb.childNodes[0].style.cursor = 'move';\r\n////        tb.childNodes[2].style.cursor = 'move';\r\n////        tgt = pn.childNodes[1];\r\n////        this.tb = tb;\r\n////        this.opacity = 1;\r\n////        this.rolluped = false;\r\n////        this.state = ['float'];\r\n////        this.button_click_event = (function(myself){return function(){myself.button_click.call(myself,this.name);};})(this);\r\n////        this.funcs = {};\r\n////        common_func.overwrite_prop(this.funcs,funcs_args);\r\n////        var buttons = pn.getElementsByTagName('button');\r\n////        for (var j=0;j<buttons.length;j++) buttons[j].onclick = this.button_click_event;\r\n////        this.pn_1 = pn.childNodes[1];\r\n////      } else if (arg=='txt' || (brwsr.ff && arg=='button')) {\r\n////        tgt.appendChild(document.createTextNode(funcs[i++]));\r\n////        tgt.style.cursor = 'pointer';\r\n////        tgt.style.padding = '2px 5px 2px 5px';\r\n////      } else if (arg=='button') {\r\n////        tgt.innerHTML = '<input type=\"button\" value=\"' + funcs[i++] + '\">';\r\n//////        tgt.innerHTML = '<button draggable=\"true\">' + funcs[++] + '</button>';\r\n////        tgt.style.padding = '0';\r\n////        tgt.style.border = '0';\r\n////        tgt.style.background = 'none';\r\n////      } else if (arg=='Show2') {\r\n////        if (site.root_body!==site.root_body2 && site.root_body2) {\r\n////          pn.style.position = 'static';\r\n////          site.root_body2.appendChild(pn);\r\n////        } else site.root_body.appendChild(pn);\r\n////      } else if (arg=='Show') site.root_body.appendChild(pn);\r\n////      else if (arg=='tile') {\r\n////        if (funcs[i++]=='set') {\r\n////          if (funcs[i]=='left') {this.tile[funcs[i]] = parseInt(pn.style[funcs[i]].replace(/px/,''),10) + pn.offsetWidth;i++;}\r\n////          else {this.tile[funcs[i]] = parseInt(pn.style[funcs[i]].replace(/px/,''),10) + pn.offsetHeight;i++;}\r\n////        } else {pn.style[funcs[i]] = this.tile[funcs[i]]+'px';i++;}\r\n////      } else tgt.style[arg] = funcs[i++];\r\n////    }\r\n////    pn.addEventListener('dragstart', this.div_dragstart, false);\r\n//////    pn.addEventListener('dragstart', this.div_dragstart, true);\r\n////    pn.addEventListener('dragend', this.div_dragend, false);\r\n////  }\r\n////\r\n////  Cnst2.prototype = {\r\n////    tile : {lef: 0, bottom: 0},\r\n////    button_click : function(name){\r\n////      if (name.indexOf('opacity')!=-1) {\r\n////        this.opacity += parseFloat(name.substr(name.indexOf(',')+1),10);\r\n////        if (this.opacity>1) this.opacity = 1;\r\n////        else if (this.opacity<0.1) this.opacity = 0.1;\r\n////        this.pn.style.opacity = this.opacity;\r\n////      } else if (name.indexOf('rollup')!=-1) {\r\n////        if (this.rolluped) {\r\n////          this.tb.style.width = ''; // means 'auto'\r\n////          this.pn_1.style.display = ''; // for dollchan\r\n////          if (this.funcs.rolldown) this.funcs.rolldown();\r\n////        } else {\r\n////          this.tb.style.width = this.tb.offsetWidth + 'px'; // for dollchan\r\n////          this.pn_1.style.display = 'none'; // for dollchan\r\n////          if (this.funcs.rollup) this.funcs.rollup();\r\n////        }\r\n////        this.rolluped = !this.rolluped;\r\n////      } else if (['embed_top','embed_bottom','float','maximize'].indexOf(name)!=-1) {\r\n////        common_func.overwrite_prop(this.tb.childNodes[1].getElementsByTagName('*')[this.state[0]].style,{display:'inline'});\r\n////        if (this.state[0]=='float') this.state = [name, this.pn.style.left, this.pn.style.top, this.pn.childNodes[1].style.width, this.pn.childNodes[1].style.height];\r\n////        else this.state[0] = name;\r\n////        if (name=='maximize') {\r\n////          var header_height = site.header_height();\r\n////          common_func.overwrite_prop(this.pn.style, {left:'0px', top:header_height + 'px', position:'fixed', resize:'none'});\r\n////          common_func.overwrite_prop(this.pn.childNodes[1].style,\r\n////            {width: document.documentElement.clientWidth + 'px', height: document.documentElement.clientHeight - this.tb.offsetHeight - header_height + 'px', resize:'none'});\r\n////        } else if (name=='float'){\r\n////          common_func.overwrite_prop(this.pn.style, {left:this.state[1], top:this.state[2], position:'fixed', resize:'both'});\r\n////          common_func.overwrite_prop(this.pn.childNodes[1].style, {width:this.state[3], height:this.state[4], resize:'both'});\r\n////        } else {\r\n////          var ref = site.embed_to[(name==='embed_top')?'top':'bottom'];\r\n////          if (ref){\r\n////            common_func.overwrite_prop(this.pn.style, {left:'auto', top:'auto', position:'static', resize:'none'});\r\n////            common_func.overwrite_prop(this.pn.childNodes[1].style, {width:'auto', height:'auto', resize:'none'});\r\n////            ref.parentNode.insertBefore(this.pn,ref);\r\n////          }\r\n////        }\r\n////        common_func.overwrite_prop(this.tb.childNodes[1].getElementsByTagName('*')[this.state[0]].style,{display:'none'});\r\n////        if (this.funcs.maximize) this.funcs.maximize();\r\n////      } else if (name==='exit') this.funcs.exit();\r\n////    },\r\n////    drag_sx: null,\r\n////    drag_sy: null,\r\n////    div_dragstart: function(e){\r\n//////    var drag_cursor_style;\r\n////      this.drag_sx = e.screenX;\r\n////      this.drag_sy = e.screenY;\r\n//////      drag_cursor_style = pn.style.cursor;\r\n//////      pn.style.cursor = 'move';\r\n////      e.dataTransfer.setData('text/plain', ''); // for FF. CH doesn't require this.\r\n//////      e.preventDefault();\r\n//////      e.stopPropagation();\r\n////    },\r\n////    div_dragend: function(e){\r\n////      if (e.currentTarget.style.left!='') e.currentTarget.style.left   = (parseInt(e.currentTarget.style.left.replace(/px/,''))   + e.screenX - this.drag_sx) + 'px';\r\n////      else e.currentTarget.style.right = (parseInt(e.currentTarget.style.right.replace(/px/,''))   - e.screenX + this.drag_sx) + 'px';\r\n////      if (e.currentTarget.style.bottom!='') e.currentTarget.style.bottom = (parseInt(e.currentTarget.style.bottom.replace(/px/,'')) - e.screenY + this.drag_sy) + 'px'; // from bottom.\r\n////      else e.currentTarget.style.top = (parseInt(e.currentTarget.style.top.replace(/px/,'')) + e.screenY - this.drag_sy) + 'px';\r\n//////      pn.style.cursor = drag_cursor_style;\r\n////    }\r\n////  }\r\n\r\n  var timer_obj;\r\n  var chart_obj;\r\n  var setting_obj;\r\n  var post_form_obj;\r\n//  var wafd = null;\r\n  var catalog_obj;\r\n  var cnst_obj = (function(){\r\n    site.script_body = document.createElement('div');\r\n    site.script_body.className = pref.script_prefix;\r\n    site.script_body.innerHTML = '<div style=\"display:none\"></div><div></div>';\r\n    site.popup_body = site.script_body.childNodes[1];\r\n    site.root_body.appendChild(site.script_body);\r\n    var sf = site.features;\r\n    var pf = pref.features;\r\n    if (sf.postform && pf.postform && !(site.postform!=null || site2[site.nickname].postform.activation)) {\r\n      var draft = document.createElement('div');\r\n      draft.innerHTML = '<div><textarea style=\"height:5em;display:none\" cols=\"20\" name=\"' + pref.script_prefix + '_draft\"></textarea><button name=\"' + pref.script_prefix + '_send\" style=\"display:none\">send</button></div>'; // <div> was added for tack_float\r\n      site.script_body.appendChild(draft);\r\n      draft = draft.childNodes[0];\r\n      site.components['postform_comment'] = draft.childNodes[0];\r\n      site.postform = site.components['postform_comment']; // redundant. need to be cleaned up.\r\n      site.components['postform_submit'] = draft.childNodes[1];\r\n    }\r\n    if (site.settings) {\r\n      site.settings.innerHTML = '<span>[CC</span><span></span>]';\r\n      site.settings.setAttribute('style','float:right;');\r\n      var pn_st = site.settings.childNodes[1];\r\n      site.settings.childNodes[0].setAttribute('style','cursor:pointer');\r\n      site.settings.childNodes[0].onclick = function(){cnst.show_hide(pn_st);};\r\n      site.settings.childNodes[1].setAttribute('style','display:none');\r\n    }\r\n    function make_button(str){\r\n      return cnst.init2({func_str:'tile:get:left:tile:get:bottom:button:'+str+':Show2:tile:set:left',pn_st:pn_st});\r\n    }\r\n    if (sf.setting && pf.setting) make_button('settings').addEventListener('click', pref_func.settings.show_hide, false);\r\n    if (sf.catalog && pf.catalog) {\r\n      catalog_obj = make_catalog_obj(pref[site.whereami] && pref[site.whereami].embed? (pref.test_mode['114']? make_button('Watcher') : null) : make_button('Catalog'));\r\n      if (pref.catalog.embed && site.whereami==='catalog') site2[site.nickname].catalog_native_frame_prep(make_button('Frame'));\r\n    }\r\n    if (!pref.test_mode['94']) cnst.tile_set_left();\r\n    chart_obj = make_chart_obj((sf.graph && pf.graph && pref3.stats.use)? make_button('Graph') : null);\r\n    if (sf.setting2 && pf.setting2) setting_obj = make_setting_obj(make_button('settings2'));\r\n    if (sf.postform && pf.postform && (site.postform!=null || site2[site.nickname].postform.activation)) {\r\n//      wafd = make_wafd();\r\n      post_form_obj = make_post_form_obj(make_button(draft?'Draft':'PostForm'));\r\n    }\r\n    if (sf.debug && pf.debug) {\r\n      make_debug_obj(make_button('debug'));\r\n//  var pn_debug_out    = cnst.init('left:200px:bottom:50px:txt:debug_out');\r\n    }\r\n    if (sf.page && pf.page) {\r\n//      var pn0 = cnst.init('tile:get:left:tile:get:bottom:txt:init:Show2:tile:set:bottom');\r\n      var pn0 = cnst.init2({func_str:'tile:get:left:tile:get:bottom:txt:init:Show2',pn_st:pn_st});\r\n      timer_obj  = make_timer_obj(pn0);\r\n    }\r\n    cnst.tile_set_bottom();\r\n    if (sf.catalog && pf.catalog) if (pref.catalog.board.board_tags_same) pref_func.settings.onchange_funcs['tag.same_tag_refresh']();\r\n  })();\r\n\r\n  function make_uip_tracker (){\r\n//    var base_thread = site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'thread_html', {thread:site.no})[0];\r\n////    site.thread = site.get_ops(document)[0];\r\n////    var url = site.protocol + '//a.4cdn.org' + site.board +'thread/' + site.thread + '.json';\r\n////    var url2= site.protocol + '//a.4cdn.org' + site.board +'catalog.json';\r\n////    var url = site2[site.nickname].get_json_url_thread(site.board,site.thread);\r\n//    var url2= site2[site.nickname].get_json_url_catalog(site.board);\r\n//    var key = site.nickname + site.board + site.no;\r\n    var post_uip = [];\r\n    var last_updated = [0,1,1]; //no,posts,uips\r\n    var posts_old = {};\r\n    var uip_tracker_id;\r\n    uip_check();\r\n//    function uip_check(){http_req.get('uip',key,url,uip_show,false,false);}\r\n    function uip_check(){\r\n      uip_tracker_id = null;    \r\n      site2[site.nickname].uip_check(uip_show, sage_detect);\r\n    }\r\n//    if (pref.debug_mode['0']) { // for debug\r\n////      window.addEventListener('load',function(){console.log(new Date().toLocaleTimeString()+': load_event');},false); // can't get.\r\n////      window.addEventListener('DOMSubtreeModified',function(){console.log(new Date().toLocaleTimeString()+': DOMSubtreeModified');},false); // get too much because of root.\r\n//      site2[site.nickname].catalog_threads_in_page(document)[0].addEventListener('DOMSubtreeModified',function(){console.log(new Date().toLocaleTimeString()+': DOMSubtreeModified');},false); // ok.\r\n//    }\r\n\r\n    var observer = new MutationObserver(uip_show_from_doc);\r\n    observer.observe(site.myself.pn, {childList: true});\r\n//    function add_dom_event_listener(){\r\n//      observer.observe(site.myself.pn, {childList: true});\r\n//    }\r\n    function remove_dom_event_listener(){\r\n      observer.disconnect();\r\n    }\r\n//    add_dom_event_listener();\r\n\r\n    var auto_open = (function(){\r\n      var threads = {};\r\n      var threads_req = {};\r\n      var threads_opened = {};\r\n      var max_no = site.no;\r\n      function auto_open_prep(key,value){\r\n//        var dbt = key.split(','); // for universal\r\n//        var ths = site2[dbt[0]].wrap_to_parse.get(value.response, dbt[0], dbt[1], dbt[3]);\r\n//        for (var i=0;i<ths.length;i++) {\r\n//          var th = ths[i];\r\n        var obj = value.response; // 4chan or 8chan only\r\n        for (var i=0;i<obj.length;i++) for (var j=0;j<obj[i].threads.length;j++) {\r\n          var th = obj[i].threads[j];\r\n          threads[th.no] = {sub:th.sub, name:th.name, com:th.com}; // for reducing memory consumption\r\n          if (max_no<th.no) max_no = th.no;\r\n        }\r\n//        var obj = site2[site.nickname].parse_json_catalog(value.responseText);\r\n//        for (var i=0;i<obj.length;i++) {\r\n//          for (var j=0;j<obj[i].threads.length;j++) {\r\n//            var no = obj[i].threads[j].no;\r\n//            threads[no] = {};\r\n//            threads[no].sub = obj[i].threads[j].sub;\r\n//            threads[no].com = obj[i].threads[j].com;\r\n//            if (max_no<no) max_no=no;\r\n//          }\r\n//        }\r\n        auto_open_check();\r\n      }\r\n      function auto_open_check(){\r\n        var rx = new RegExp(pref.uip_tracker.auto_open_kwd || '.*');\r\n        for (var i in threads_req) {\r\n          var th = threads[i];\r\n          if (th && i>site.no && threads_opened[i]===undefined) {\r\n            if (th.sub && th.sub.search(rx)!=-1 || th.name && th.name.search(rx)!=-1 || th.com && th.com.search(rx)!=-1) {\r\n              window.open(site2[site.nickname].make_url4([site.nickname, site.board, i, 'thread_html'])[0], '_blank');\r\n  //            window.open(site2[site.nickname].make_url3(site.board,i), '_blank');\r\n              threads_opened[i] = i;\r\n            }\r\n            delete threads_req[i];\r\n          } else if (max_no>i || threads_req[i]--<=0) delete threads_req[i];\r\n        }\r\n      }\r\n      return function(posts, posts_new, posts_old){\r\n        var i=posts.length-1;\r\n        while (i>=1 && i>=pref.uip_tracker.auto_open_th && posts_old[posts[i].no]===undefined) i--; // don't check OP\r\n        if (i==posts.length-1) return;\r\n        var pn_test = document.createElement('span');\r\n        while (++i<posts.length) {\r\n          pn_test.innerHTML = posts[i].com;\r\n          var pn_a = pn_test.getElementsByTagName('a');\r\n          for (var j=0;j<pn_a.length;j++) {\r\n            var tgt = pn_a[j].textContent.match(/>>([0-9]+)$/);\r\n            if (!tgt) continue; else tgt = tgt[1];\r\n            if (posts_new[tgt]!==undefined || posts_old[tgt]!==undefined) continue; // invoke redundant check if ahchor refers deleted posts\r\n  //        var flag = true;\r\n  //        var tgt = pn_a[j].textContent.substr(2);\r\n  //        for (var k=0;k<nof_posts.length;k++) if (posts[k].no==tgt) {flag=false;break;}\r\n  ////        if (flag) console.log('auto_opener: '+tgt);\r\n            threads_req[tgt] = 3; // check 3 times for non-coherency not between catalog and threads\r\n          }\r\n        }\r\n        auto_open_check();\r\n        if (Object.keys(threads_req).length!=0) http_req.get('uip_auto',[site.nickname,site.board,site.no,'catalog_json'].join(),'',auto_open_prep);\r\n      };\r\n    })();\r\n                       \r\n    function uip_show(key,value){ // from http\r\n      uip_show_2(key,value,true);\r\n    }\r\n    function uip_show_from_doc(e){ // from document\r\n //     uip_show_2(Date.now(),1200,'',false);\r\n      if (post_uip.length!=0) uip_show_3();\r\n      else if (time_req + interval > Date.now() + pref.uip_tracker.interval*1000) {\r\n        clearTimeout(uip_tracker_id);\r\n        waste_count = 0;\r\n        uip_retry();\r\n      }\r\n    }\r\n    function uip_show_3(){  // show\r\n//      remove_dom_event_listener();\r\n      for (var i=0;i<post_uip.length;i++) {\r\n        var tgt_uip = post_uip[i];\r\n        var no = tgt_uip[0];\r\n        var tgt_post = site2[site.nickname].uip_tgt_post(no);\r\n        if (tgt_post) {\r\n          var pn_uip = document.createElement('span');\r\n          pn_uip.innerHTML = ' (<span>'+tgt_uip[2]+'</span>)';\r\n          if (tgt_uip[4]) pn_uip.childNodes[1].setAttribute('style',pref.uip_tracker.highlight_str);\r\n          if (pref.uip_tracker.posts) {\r\n            var pn_posts = document.createElement('span');\r\n            pn_posts.innerHTML = '<span>'+ tgt_uip[1] +'</span>' + ((tgt_uip[5] && pref.uip_tracker.deletion.show)? '('+(\r\n              pref.uip_tracker.deletion.link? tgt_uip[5].map(function(v){return '<a href=\"#p'+v+'\" class=\"quotelink\">&gt;&gt;'+v+'</a>';}) : tgt_uip[5]).join()+')' : '') + '/';\r\n            if (tgt_uip[3]) pn_posts.childNodes[0].setAttribute('style',pref.uip_tracker.highlight_str);\r\n            pn_uip.insertBefore(pn_posts,pn_uip.childNodes[1]);\r\n          }\r\n          if (tgt_uip[5] && (pref.uip_tracker.deletion.name || pref.uip_tracker.deletion.addName || pref.uip_tracker.deletion.post))\r\n            for (var j=0;j<tgt_uip[5].length;j++) sage_annotate({no:tgt_uip[5][j]},pref.uip_tracker.deletion,true);\r\n          if (pref.uip_tracker.sage.page) {\r\n            var pn_page = document.createElement('span');\r\n            if (!page_his[no]) page_his[no] = {pn:pn_page, his:[]};\r\n            else {\r\n              page_his[no].pn = pn_page;\r\n              if (page_his[no].his.length>0) show_page(page_his[no]);\r\n            }\r\n            pn_uip.insertBefore(pn_page,pn_uip.lastChild);\r\n          }\r\n          var post_nums = site2[site.nickname].uip_post_num(tgt_post);\r\n          post_nums[post_nums.length-1].appendChild(pn_uip);\r\n          if (!pn_first && i==0) pn_first = [pn_uip, tgt_uip];\r\n          post_uip.splice(i--,1);\r\n        }\r\n      }\r\n//      sage_detect(); // require to merge this with catalog, format_html.update_draw runs after this and removes style of post.pn.\r\n//      add_dom_event_listener();\r\n    }\r\n    function uip_show_2(key,value,from_http){ // from http and doc\r\n//console.log(new Date(value.date).toLocaleTimeString()+', IN, '+from_http);\r\n      waste_count++;\r\n      if (value.status==200) {\r\n//        var obj = JSON.parse(value.responseText);\r\n        var posts = site2[site.nickname].parse_json_thread(('response' in value)? value.response : JSON.parse(value.responseText),from_http).posts;\r\n        var nof_posts = posts.length;\r\n        var uips = posts[nof_posts-1]['unique_ips'] || last_updated[2];\r\n        var last_no = posts[nof_posts-1]['no'];\r\n        if (last_updated[0]!=last_no || last_updated[1]!=nof_posts || last_updated[2]!=uips) {\r\nif (pref.debug_mode['31']) console.log(new Date(value.date).toLocaleTimeString()+', '+last_no+', '+nof_posts+', '+uips);\r\n          var posts_new = {};\r\n          for (var i=0;i<posts.length;i++) posts_new[posts[i].no] = null;\r\n          if (pref.uip_tracker.auto_open && last_updated[0]!=0) auto_open(posts, posts_new, posts_old);// last_updated[0]!=0 blocks initial trial.\r\n          var post_hilight = (posts.length<last_updated[1] || posts[last_updated[1]-1]['no']!=last_updated[0]);\r\n          if (pref.uip_tracker.deletion.show || pref.uip_tracker.deletion.name || pref.uip_tracker.deletion.addName || pref.uip_tracker.deletion.post) {\r\n            var posts_deleted = [];\r\n            for (var i in posts_old) if (posts_new[i]===undefined) posts_deleted[posts_deleted.length] = i;\r\nif (pref.debug_mode['31'] && posts_deleted!=='') console.log('uip_deleted '+posts_deleted);\r\n          }\r\n          last_updated = [last_no,nof_posts,uips,post_hilight,last_updated[2]!=uips, (posts_deleted.length!=0)? posts_deleted : null];\r\n          post_uip.push(last_updated);\r\n          waste_count = 0; // pass here always at first.\r\n          posts_old = posts_new;\r\n        }\r\n        uip_show_3();\r\n        var p0 = posts[0];\r\n      }\r\n      if (value.status==404 || (p0 && (p0['archived'] || p0['closed']))) uip_tracker_destroy();\r\n      else uip_retry();\r\n    }\r\n    var waste_count = 0;\r\n    var interval = 0;\r\n    var time_req = 0;\r\n    function uip_retry(){\r\n      if (pref.uip_tracker.on) {\r\n        interval = (interval===0 || waste_count==0 || !pref.uip_tracker.adaptive)? ((pref.uip_tracker.interval>10)? pref.uip_tracker.interval : 10)*1000 // waste_count===0 always at initial. // interval===0 prevent from causing inifinite loop when !uip_first in annotate_from_catalog.\r\n                 : (waste_count%8==0)? ((interval>=1800000)? 3600000 : interval*2)\r\n                 : interval;\r\n        uip_tracker_id = setTimeout(uip_check,interval);\r\n        time_req = Date.now();\r\n      } else uip_tracker_destroy();\r\n    }\r\n    var pn_first = null;\r\n    function annotate_from_catalog(vals){\r\n      if (vals[0]==='page') {\r\n        var his = JSON.parse(vals[1]);\r\n        for (var i in his) page_his[i] = {pn:null, his:his[i]};\r\n        return;\r\n      }\r\n      if (vals[0]==='sage') {\r\n        sage_detect({posts:vals.map(function(v){return {no:v, email:'sage'};})}); // posts[0].no==='sage', but posts[0] will be ignored.\r\n        return;\r\n      }\r\n      var uip_first = (pn_first)? pn_first[1] : (post_uip.length!=0)? post_uip.splice(0,1)[0] : null;\r\n      for (var i=0;i<vals.length;i+=3) post_uip[post_uip.length] = [vals[i], vals[i+1], vals[i+2], false, vals[i+1]==vals[i+2] || i>=3 && vals[i+2]!=vals[i-1], null];\r\n      if (pref.uip_tracker.sage.page) {\r\n        var nos = {};\r\n        for (var i=0;i<post_uip.length;i++) nos[post_uip[i][0]] = null;\r\n        for (var i in page_his) if (nos[i]===undefined) post_uip.splice(post_uip.length-1,0,[i, '?', '?', false, false, null]);\r\n      }\r\n      if (!uip_first) {\r\n        last_updated = post_uip[post_uip.length-1]; // RACING CONDITION. this is faster than network access usually.\r\n        pn_first = true;\r\n      } else {\r\n//        console.log('Hit: uip_tracker: racing condition');\r\n        var uip_last = post_uip[post_uip.length-1];\r\n        if (uip_last[0]!=uip_first[0] || uip_last[1]!=uip_first[1] || uip_last[2]!=uip_first[2])\r\n          post_uip[post_uip.length] = uip_first.slice(0,3).concat(false, uip_last[2]!=uip_first[2], null);\r\n        if (pn_first) pn_first[0].parentNode.removeChild(pn_first[0]);\r\n      }\r\n      uip_show_3();\r\n    }\r\n    var page_his = {};\r\n    var sage_done = {};\r\n    var sage_scheduled = {};\r\n    function sage_detect(th){\r\n      for (var i in sage_scheduled) if (sage_annotate(sage_scheduled[i])) delete sage_scheduled[i];\r\n      if (!th || !th.posts) return;\r\n      for (var i=th.posts.length-1;i>=1;i--)\r\n        if (th.posts[i].email==='sage' && sage_done[th.posts[i].no]===undefined) sage_annotate(th.posts[i]);\r\n        else break;\r\n      // patch for 4chan's bug.\r\n      // 4chan sends corrupted data sometimes. Bump oerder and posts are NOT synchronized, posts may be dropped around before 1s from generation.\r\n      // You can see this by comparing Last-Modified in http header with timestamp of posts. I saw 3 sec delay so far.\r\n      // In this situation, threads in top orders are seen as overevaluated; just bumped, but there are no new posts.\r\n      // This bug requires re-evaluation of sage, so I can't use stateful fast approach.\r\n      if (pref.uip_tracker.sage.patch_bug) { // patch for 4chan's bug.\r\n        for (var i=th.posts.length-1;i>=1;i--)\r\n          if (th.posts[i].email!=='sage')\r\n            if (sage_done[th.posts[i].no]===null || sage_scheduled[th.posts[i].no]) {\r\n              if (pref.debug_mode['30']) console.log('OVERDETECTION: '+th.posts[i].no);\r\n              if (sage_done[th.posts[i].no]===null) sage_annotate(th.posts[i], {name_str:'', addName_str:'OVERDETECTED_', post_str:'', __proto__:pref.uip_tracker.sage});\r\n              delete sage_scheduled[th.posts[i].no];\r\n              delete sage_done[th.posts[i].no];\r\n            } else break;\r\n      }\r\n      if (pref.uip_tracker.sage.page && th.page!==undefined) {\r\n        var last_no = th.posts[th.posts.length-1].no;\r\n        var page = page2num(th.page);\r\n        if (!page_his[last_no]) page_his[last_no] = {pn:null, his:[page]};\r\n        else if (site2['4chan'].page_his_update(page_his[last_no].his, page)) if (page_his[last_no].pn) show_page(page_his[last_no]);\r\n      }\r\n    }\r\n    function sage_annotate(post, pref_obj, deletion){\r\n      var pn = site2[site.nickname].uip_tgt_post(post.no);\r\n      if (pn) {\r\n        var pn_name = site2[site.nickname].parse_funcs['post_html'].pn_name({pn:pn, __proto__:post});\r\n        if (!pref_obj) pref_obj = pref.uip_tracker.sage;\r\n        if (pref_obj.name) pn_name.setAttribute('style',pref_obj.name_str);\r\n        if (pref_obj.addName) pn_name.textContent = pref_obj.addName_str + pn_name.textContent;\r\n        if (pref_obj.post) pn.setAttribute('style',pref_obj.post_str);\r\n        if (!deletion) sage_done[post.no] = null;\r\n        return true;\r\n      } else if (!deletion) sage_scheduled[post.no] = post;\r\n    }\r\n    function show_page(obj){\r\n      obj.pn.textContent = '/'+obj.his.map(function(v){return Math.floor(v/15)+'.'+(v%15);}).join('\\u2192');\r\n    }\r\n    function page2num(page){\r\n      var ps = page.split('.');\r\n      return parseInt(ps[0],10)*15+parseInt(ps[1],10);\r\n    }\r\n    function uip_tracker_destroy(){\r\n      remove_dom_event_listener();\r\n      uip_tracker = null;\r\n//if (pref.debug_mode['0'] && uip_tracker===null) console.log('uip_tracker: stopped, '+value.status);\r\n    }\r\n\r\n    return {\r\n      get_id: function(){return uip_tracker_id;},\r\n      annotate_from_catalog: annotate_from_catalog\r\n//      annotate_from_catalog: function(arg){setTimeout(annotate_from_catalog.bind(null, arg), 10000);} // for test\r\n    }\r\n  }\r\n  var uip_tracker=null;\r\n//  setTimeout(uip_tracker_init,2); // patch for LiveTag.\r\n  function uip_tracker_init(){\r\n    if (uip_tracker===null && site.features.uip_tracker && pref.features.uip_tracker && site.isthread && pref.uip_tracker.on) uip_tracker = make_uip_tracker();\r\n    else if (!pref.uip_tracker.on) {\r\n      if (uip_tracker) clearTimeout(uip_tracker.get_id());\r\n      uip_tracker = null;\r\n    }\r\n  }\r\n\r\n  function make_thread_reader(){\r\n//    site.no = site2[site.nickname].get_ops(document)[0]; // patch, will be changed to site.no.\r\n//    var base_thread = site2[site.nickname].catalog_threads_in_page(document)[0];\r\n    var name = site.nickname+site.board+site.no;\r\n//    var dbt = common_func.name2domainboardthread(name);\r\n    var dummy = {sticky:null};\r\n    var threads = {};\r\n    threads[name] = [];\r\n////////    threads[name][8]  = [0,0,0,0];\r\n    threads[name][19] = liveTag.mems.init({domain:site.nickname, board:site.board, no:site.no}).wt; // [2]; // prepare data structures.\r\n//    threads[name][19][0] = 0x000f0000; // start watching, init.\r\n//    threads[name][19] = [1,0,0,0,null,true,-1,0,true];\r\n    var favicon_obj = [];\r\n////////    var buf_id = null;\r\n////////    function updated_buf(){if (!buf_id) buf_id = setTimeout(updated,100);}\r\n//    var posts = {};\r\n////////    var nof_posts = 0;\r\n//    var init = true;\r\n////////    var time_lastpost = 0;\r\n////////    var num_of_children = 0;\r\n////////    var myself_th = {pn:base_thread, post_no_last:-1,\r\n////////      domain:site.nickname, board:site.board, parse_funcs:site2[site.nickname].parse_funcs['thread_html'], __proto__:site4.parse_funcs_on_demand};\r\n////////    var site_live = site.nickname + ((site2[site.nickname+'_live'])? '_live' : '');\r\n////////    var myself_th = site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'thread_html',\r\n////////                      {thread:site.myself, parse_funcs:site2[site_live].parse_funcs['thread_html']})[0];\r\n//    var parse_obj = {domain:site.nickname, board:site.board,\r\n//                     parse_funcs:site2[site_live].parse_funcs['thread_html'],\r\n//                     __proto__:site4.parse_funcs_on_demand};\r\n//    var myself_th = {pn:base_thread, __proto__:parse_obj};\r\n//    var myself_th = {pn:base_thread, domain:site.nickname, board:site.board,\r\n//                     parse_funcs:site2[site_live].parse_funcs['thread_html'],\r\n//                     __proto__:site4.parse_funcs_on_demand};\r\n////////    var regexp_anchor    = />>[0-9]+/g;\r\n////////    var regexp_anchor_cb = />>>\\/[0-9A-z_\\+]+\\/[0-9]+/g;\r\n////////    var remake_own_posts = true;\r\n\r\n\r\n\r\n    var own_posts_tracker = function(){\r\n      var get_flag = true;\r\n      function get_my_posts_no(){\r\n        get_flag = true;\r\n      }\r\n      function update_own_posts(posts,init){\r\n        if (posts.length==0) {get_flag = false; return;} // clearing get_flag for watching thread which may not have any new posts in lainchan, a conflict may occur in KC...  // length check for KC.\r\n        if (get_flag) {\r\n          var key = pref.script_prefix + '.own_posts.' + site.board + site.no;\r\n          var own_posts = JSON.parse(localStorage[key] || \"[]\");\r\n          var my_posts = [];\r\n          if (!init) {\r\n            my_posts[0] = posts[posts.length-1];\r\n            own_posts[own_posts.length] = my_posts[0].no;\r\n            localStorage[key] = JSON.stringify(own_posts);\r\n          } else {\r\n            var i = 0;\r\n            var j = posts.length-1;\r\n            while (i<own_posts.length) {\r\n              while (j>0 && own_posts[i]>posts[j].no) j--;\r\n              if (own_posts[i]===posts[j].no) my_posts[my_posts.length] = posts[j];\r\n              i++;\r\n            }\r\n          }\r\n          for (var i=0;i<my_posts.length;i++) {\r\n            var pn_name = my_posts[i].parse_funcs_html.pn_name(my_posts[i]);\r\n            if (pref.thread_reader.show_own_post_by==='plain') pn_name.parentNode.insertBefore(document.createTextNode(' (You)'), pn_name.nextSibling);\r\n            else pn_name.innerHTML = pn_name.innerHTML + ' (You)';\r\n          }\r\n          get_flag = false;\r\n        }\r\n        for (var i=0;i<posts.length;i++) site2[site.nickname].check_reply.add_you(posts[i]);\r\n      }\r\n      function event_submit(){\r\n        if (this.name==='post') get_my_posts_no();\r\n      }\r\n      return {\r\n        update_own_posts: update_own_posts,\r\n        get_my_posts_no: get_my_posts_no,\r\n        event_submit: event_submit,\r\n      }\r\n    };\r\n    if (pref.thread_reader.own_posts_tracker) {\r\n      own_posts_tracker = own_posts_tracker();\r\n      if (!site.components.postform_submit) window.addEventListener('submit', own_posts_tracker.event_submit, false); // doesn't work....\r\n    } else {\r\n      own_posts_tracker = null;\r\n//      if (!site.components.postform_submit) window.removeEventListener('submit', own_posts_tracker.event_submit, false);\r\n    }\r\n\r\n////////    var ignore_old = pref.catalog_footer_ignore_my_own_posts; // patch for showing (You), don't discard my post...\r\n////////    pref.catalog_footer_ignore_my_own_posts = false;\r\n////////    updated(true);\r\n////////    pref.catalog_footer_ignore_my_own_posts = ignore_old;\r\n////////\r\n//////////    threads[name][19][5] = false; // modified in check_reply\r\n////////    common_func.set_value_to_root(threads[name][19],'5',false);\r\n////////    function remake_own_posts_flag(){remake_own_posts = true;}\r\n////////    function add_event_to_submit(pn){pn.addEventListener('click', remake_own_posts_flag, false);}\r\n////////    function remove_event_from_submit(pn){pn.addEventListener('click', remake_own_posts_flag, false);}\r\n//    function add_event_to_submit(pn){pn.addEventListener('click', site2[site.nickname].check_reply.remake_own_posts, false);}\r\n//    function remove_event_from_submit(pn){pn.addEventListener('click', site2[site.nickname].check_reply.remake_own_posts, false);}\r\n    function add_event_to_submit(pn){\r\n      pn.addEventListener('click', site2[site.nickname].check_reply.remake_own_posts, false);\r\n      if (own_posts_tracker) pn.addEventListener('click', own_posts_tracker.get_my_posts_no, false);\r\n    }\r\n    function remove_event_from_submit(pn){\r\n      pn.removeEventListener('click', site2[site.nickname].check_reply.remake_own_posts, false);\r\n      if (own_posts_tracker) pn.removeEventListener('click', own_posts_tracker.get_my_posts_no, false);\r\n    }\r\n////////    function updated(init){\r\n////////      buf_id = null;\r\n//////////console.log('called');\r\n////////      if (pref.thread_reader.check_num_of_children) {\r\n////////        if (num_of_children>=myself_th.pn.childNodes.length) return; // KC doesn't work by this, because all of children are not posts.\r\n////////          num_of_children = myself_th.pn.childNodes.length;\r\n////////      }\r\n////////////      myself_th.parse_funcs['pop_post_prep'](myself_th);\r\n////////      site2[site.nickname].check_reply.check(myself_th, threads[name][19]);\r\n////////      delete myself_th.posts;\r\n////////////////      nof_posts += threads[name][19][7]; // patch\r\n////////      for (var i=0;i<threads[name][19][4].length;i++)\r\n////////        threads[name][19][4][i].pn.addEventListener('mouseover', favicon_check, false);\r\n//////////console.log('length:'+threads[name][19][4].length);\r\n////////\r\n\r\n//////////      threads[name][19][1] = 0;\r\n////////      threads[name][19][4] = [];\r\n////////      var flag_first = true;\r\n////////      var post_no_last_new = myself_th.post_no_last;\r\n////////      myself_th.parse_funcs['pop_post_prep'](myself_th);\r\n////////      while (1) {\r\n////////        myself_th.post = myself_th.parse_funcs['pop_post'](myself_th);\r\n////////        if (myself_th.post && myself_th.post.post_no>myself_th.post_no_last) {\r\n////////      \r\n//////////      for (var i=base_thread.childNodes.length-1;i>=0;i--) { // num of posts is changed by hover and inline.\r\n//////////        var classname = base_thread.childNodes[i].className;\r\n//////////        if (classname && classname.indexOf('post')!=-1 && classname.indexOf('reply')!=-1) { // remove popuped posts.\r\n//////////          var id = base_thread.childNodes[i].id;\r\n//////////          if (!(id in posts)) {\r\n////////          if (flag_first) {\r\n////////            post_no_last_new = myself_th.post.post_no;\r\n////////            if (remake_own_posts) {\r\n////////              site2[site.nickname].prep_own_posts(); // couldn't get an event from myself, so don't miss posts from my thread.\r\n////////              remake_own_posts = false;\r\n////////            }\r\n////////            time_lastpost = myself_th.post.time;\r\n////////            flag_first = false;\r\n////////          }\r\n////////          nof_posts++;\r\n//////////          posts[id] = id;\r\n//////////          var post = myself_th.post.pn; // temporal\r\n////////          if (!init) {\r\n//////////            var post = base_thread.childNodes[i];\r\n//////////            var image = post.getElementsByClassName('post-image');\r\n//////////            image = (image[0])? image[0].src : undefined;\r\n//////////            var body = post.getElementsByClassName('body')[0].innerHTML;\r\n////////            var to_me  = false;\r\n////////            var anchors = regexp_anchor.exec(myself_th.post.com);\r\n////////            if (anchors!==null) {\r\n////////              for (var j=0;j<anchors.length;j++) {\r\n////////                var tgt = anchors[j].substr(2);\r\n////////                if (site3[site.nickname].own_posts[dbt[1]+tgt]===null) {to_me = true; break;}\r\n////////            }}\r\n////////            if (!to_me) {\r\n////////              anchors = regexp_anchor_cb.exec(myself_th.post.com);\r\n////////              if (anchors!==null) {\r\n////////                for (var j=0;j<anchors.length;j++) {\r\n////////                  var tgt = anchors[j].substr(3);\r\n////////                  if (site3[site.nickname].own_posts[tgt]===null) {to_me = true; break;}\r\n////////            }}}\r\n//////////            var anchors = body.match(/&gt;&gt;[0-9]+/g);\r\n//////////            if (anchors) {\r\n//////////              for (var j=0;j<anchors.length;j++) {\r\n//////////                var tgt = anchors[j].substr(8);\r\n//////////                if (site3[site.nickname].own_posts[dbt[1]+tgt]===null) {to_me = true; break;}\r\n//////////            }}\r\n//////////            if (!to_me) {\r\n//////////              anchors = body.match(/&gt;&gt;&gt;\\/[0-9A-z_\\+]+\\/[0-9]+/g);\r\n//////////              if (anchors) {\r\n//////////                for (var j=0;j<anchors.length;j++) {\r\n//////////                  var tgt = anchors[j].substr(12);\r\n//////////                  if (site3[site.nickname].own_posts[tgt]===null) {to_me = true; break;}\r\n//////////            }}}\r\n////////            threads[name][19][4].unshift(\r\n////////              {icon: myself_th.post.op_img_url,\r\n////////               body: myself_th.post.com,\r\n////////               time: myself_th.post.time,\r\n//////////               icon: image,\r\n//////////               body: body,\r\n//////////               time: Date.parse(post.getElementsByTagName('time')[0].getAttribute('datetime')) - pref.localtime_offset*3600000,\r\n////////               to_me: to_me,\r\n////////               offsetTop: myself_th.post.pn.offsetTop});\r\n////////            if (to_me) threads[name][19][1]++;\r\n////////          }\r\n////////          myself_th.post.pn.addEventListener('mouseover', favicon_check_event, false);\r\n//////////            if (time_lastpost<threads[name][19][4][0].time) time_lastpost=threads[name][19][4][0].time;\r\n//////////          } else break;\r\n//////////        }\r\n//////////      }\r\n////////\r\n////////        } else break;\r\n////////      }\r\n////////      myself_th.post_no_last = post_no_last_new;\r\n\r\n////////\r\n////////      if (!init) {\r\n//////////      if (init) {init=false;buf_id=null;return;}\r\n////////////////        threads[name][8][2]  = nof_posts;\r\n//////////        for (var i=0;i<threads[name][19][4].length;i++) favicon_obj.push([threads[name][19][4][i].pn.offsetTop,threads[name][19][4][i]]);\r\n//////////        for (var i=threads[name][19][4].length-1;i>=0;i--) favicon_obj.push([threads[name][19][4][i].pn.offsetTop,threads[name][19][4][i]]);\r\n////////        for (var i=threads[name][19][4].length-1;i>=0;i--) favicon_obj.push(threads[name][19][4][i]);\r\n//////////        threads[name][19][2] = nof_posts - favicon_obj.length;\r\n////////        threads[name][19][2] = favicon_obj.length;\r\n////////\r\n//////////      if (!init) { // merge with mark_newer_posts. MIGHT CAUSE UNSTABLITY???\r\n//////////        var nof_posts = site2[site.nickname].get_posts(document).length; // works well in static.\r\n//////////        threads[name][8][2] = nof_posts;\r\n//////////        site2[site.nickname].check_reply_to_me(name,dbt,threads[name][19], document, threads[name][8], dummy);\r\n//////////        for (var i=0;i<threads[name][19][4].length;i++) favicon_obj.push([site2[site.nickname].get_post_offsetTop(document,nof_posts-1-i),threads[name][19][4][i]]);\r\n////////\r\n////////        if (threads[name][19][4].length!=0) notifier.changed(name, threads[name][19][4]);\r\n////////      }\r\n////////      if (own_posts_tracker && cataLog.embed_mode!=='thread') own_posts_tracker.update_own_posts(threads[name][19][4],init); // PATCH\r\n//////////      if (own_posts_tracker) own_posts_tracker.update_own_posts(threads[name][19][4],init);\r\n////////    }\r\n\r\n    function mark_posts_from_parent(time){\r\n      time /= site2[site.nickname].parse_funcs.thread_html.time_unit;\r\n      ignore_scroll = true;\r\n      if (favicon_obj[0] && favicon_obj[0].time<time) { // not debugged this path, usually doesn't occur.\r\n        var i = 1;\r\n        while (i<favicon_obj.length && favicon_obj[i].time<=time) i++;\r\n        favicon_obj_trim({target:favicon_obj[i-1].pn});\r\n      } else {\r\n        var site_live = site.nickname + ((site2[site.nickname+'_live'])? '_live' : '');\r\n        var th = site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'thread_html',\r\n                   {thread:site.no, parse_funcs:site2[site_live].parse_funcs['thread_html']})[0];\r\n        var end = th.posts.length;\r\n        if (favicon_obj[0]) while (end>0 && th.posts[end-1].time>=favicon_obj[0].time) end--;\r\n        var i=end;\r\n        while (i>0 && th.posts[i-1].time>time) i--; // th.posts[--i].pn.addEventListener('mouseover', favicon_obj_trim, false);\r\n        favicon_obj = th.posts.slice(i,end).concat(favicon_obj);\r\n      }\r\n    }\r\n    function updated(new_posts, init){ // called from catalog\r\n      for (var i=new_posts.length-1;i>=0;i--) {\r\n//        new_posts[i].pn.addEventListener('mouseover', favicon_obj_trim, false);\r\n        favicon_obj.push(new_posts[i]);\r\n      }\r\n      threads[name][19][1] = (threads[name][19][1]&0xffff0000) + favicon_obj.length;\r\n//      if (new_posts.length!=0) notifier.changed(name, new_posts);\r\n      if (own_posts_tracker) own_posts_tracker.update_own_posts(new_posts,init);\r\n    }\r\n//    function favicon_check_event(){\r\n//      this.removeEventListener('mouseover', favicon_check_event, false);\r\n//      favicon_check();\r\n//    }\r\n    var ignore_scroll = false;\r\n    var ref_height_checked = 0;\r\n    function favicon_check(e){\r\n      if (this===window && ignore_scroll) {ignore_scroll = false; return;}\r\n      if (favicon_obj.length==0) return;\r\n      var ref_height = brwsr.document_body.scrollTop;\r\n      if (ref_height<=ref_height_checked) return;\r\n      else ref_height_checked = ref_height;\r\n      ref_height += window.innerHeight; //  -50;\r\n      favicon_obj_trim(e,ref_height);\r\n    }\r\n    function favicon_obj_trim(e,ref_height){\r\n      var time;\r\n      while (favicon_obj.length!=0) {\r\n        if (ref_height && favicon_obj[0].pn.offsetTop + favicon_obj[0].pn.offsetHeight>ref_height) break;\r\n        var tgt = favicon_obj.shift();\r\n//        tgt.pn.removeEventListener('mouseover', favicon_obj_trim, false);\r\n        time = tgt.time * site2[site.nickname].parse_funcs['post_json'].time_unit;\r\n//        if (pref['thread'].mark_new_posts) site2['DEFAULT'].unmark_post(tgt.pn);\r\n//        if (pref['thread'].mark_new_posts) tgt.pn.setAttribute('style','border:none');\r\n//        if (e.currentTarget===tgt.pn) break;\r\n      }\r\n      if (time) {\r\n        threads[name][19][1] = favicon_obj.length;\r\n//        threads[name][19][0] = time;\r\n        for (var i=0;i<favicon_obj.length;i++) if (favicon_obj[i].reply_to_me) threads[name][19][1]+=0x10000;\r\n        notifier.favicon.set(threads);\r\n        if (pref.thread_reader.sync && window.opener) send_message('parent',['TRIAGE',[name,'TRACK',threads[name][19][1],false,time]]); // for tracking what you see\r\n      }\r\n    }\r\n//    function mark_newer_posts(time){ // working code\r\n//      var retval = null;\r\n//      var i=0;\r\n//      while (i<favicon_obj.length && favicon_obj[i].time < time) i++;\r\n//      if (i<favicon_obj.length) retval = favicon_obj[i].pn;\r\n//      while (i<favicon_obj.length) {\r\n//        favicon_obj[i].marked = true;\r\n////        favicon_obj[i].pn.setAttribute('style','background:yellow');\r\n//        favicon_obj[i].pn.setAttribute('style','border:2px solid red');\r\n//        i++;\r\n//      }\r\n//      ignore_scroll = true;\r\n//      return retval; // scroll will be done.\r\n//    }\r\n\r\n    var triage;\r\n    var btns_p = document.createElement('div');\r\n    btns_p.innerHTML =\r\n      '<div>'+\r\n        '<button name=\"thread_reader.buttons.B\" type=\"button\">B</button>'+\r\n        '<button name=\"thread_reader.buttons.UB\" type=\"button\">UB</button>'+\r\n        ((window.opener)? '<button name=\"thread_reader.buttons.X\" type=\"button\">X</button>'+\r\n                          '<button name=\"thread_reader.buttons.v\" type=\"button\">v</button>' : '')+\r\n      '</div>';\r\n    var btns = btns_p.getElementsByTagName('button');\r\n    btns['thread_reader.buttons.B'].onclick  = function(){common_func.modify_bookmark(name,true)};\r\n    btns['thread_reader.buttons.UB'].onclick = function(){common_func.modify_bookmark(name,false)};\r\n    if (window.opener) {\r\n      btns['thread_reader.buttons.X'].onclick = function(){triage_exe('KILL','');};\r\n      btns['thread_reader.buttons.v'].onclick = function(){triage_exe('TIME','');};\r\n    }\r\n//    var th_link = document.getElementById('thread-links');\r\n//    th_link.parentNode.insertBefore(buttons,th_link);\r\n    var pn_ref = (typeof(site.embed_to['bottom'])==='function')? site.embed_to['bottom']() : site.embed_to['bottom'];\r\n    pn_ref.parentNode.insertBefore(btns_p,pn_ref);\r\n    if (window.opener && pref.thread_reader.triage) {\r\n//      var triage_all = common_func.make_triage({onclick:triage_event, wheelpatch:false});\r\n//      triage_str = triage_all.str;\r\n//      th_link.parentNode.insertBefore(triage_all.pn,th_link);\r\n      triage = new common_func.Triage(pref.catalog_triage_str,{onclick:triage_event, wheelpatch:false, name:'thread_reader_triage'});\r\n      btns_p.appendChild(triage.pn);\r\n    }\r\n    pref_func.tooltips.add_root(btns_p);\r\n\r\n    function triage_event(){\r\n      var flds = this.name.split(',');\r\n      var i = parseInt(flds[0].replace(/[^\\(]*\\(/,''),10);\r\n      var j = parseInt(flds[1].replace(/\\).*/,''),10);\r\n//      var i = parseInt(flds[0],10);\r\n//      var j = parseInt(flds[1],10);\r\n      triage_exe(triage.str[i][j],triage.str[i][j+2]);\r\n    }\r\n    function triage_exe(com0,com1){\r\n      send_message('parent',['TRIAGE',[name,com0,com1,true, site2['DEFAULT'].check_reply.get_checked_time(threads[name][19])]]);\r\n      if (pref.thread_reader.triage_close) window.close();\r\n    }\r\n\r\n//    window.addEventListener('storage', site2[site.nickname].prep_own_posts_event, false); // can't catch events from this thread.\r\n    if (pref.notify.favicon) window.addEventListener('scroll', favicon_check, false);\r\n//    base_thread.addEventListener('DOMSubtreeModified',updated_buf,false);\r\n//    base_thread.addEventListener('DOMNodeInserted',updated_buf,false);\r\n////////    var observer = new MutationObserver(updated_buf);\r\n////////    observer.observe(myself_th.pn, {childList: true});\r\n\r\n//    threads[name][19][3] = --threads[name][19][0];threads[name][19][0]--;updated(); // debug\r\n//    if (site.components.postform_submit) add_event_to_submit(site.components.postform_submit);\r\n    function setup_submit(inst_submit, postform_submit){\r\n      if (!inst_submit && pref.thread_reader.own_posts_tracker && postform_submit) {\r\n        add_event_to_submit(postform_submit);\r\n        inst_submit = postform_submit;\r\n      } else if (inst_submit && (!pref.thread_reader.own_posts_tracker || !postform_submit)) {\r\n        remove_event_from_submit(inst_submit);\r\n        inst_submit = null;\r\n      }\r\n      return inst_submit;\r\n    }\r\n    var inst_submit  = setup_submit(null, site.components.postform_submit);\r\n    var inst_submit2 = setup_submit(null, site.components.postform_submit2);\r\n////////    window.addEventListener('storage', remake_own_posts_flag, false);\r\n    window.addEventListener('storage', site2[site.nickname].check_reply.remake_own_posts, false);\r\n\r\n    if (pref.test_mode['116'] && site.nickname==='4chan') (function(){ // popup youtube\r\n      var tacks = new WeakMap();\r\n      site2[site.nickname].catalog_get_native_area().addEventListener('click',function(e){\r\n        var et = e.target;\r\n        if (et.tagName==='A' && et.dataset.cmd=='embed') { //  && (!et.nextElementSibling || !et.nextElementSibling.classList.contains('stickyIcon'))) {\r\n          var tack = tacks.get(et);\r\n          if (!tack) observer.observe(et.parentNode, {childList: true});\r\n          else {\r\n            if (tack.parentNode) tack.remove(); // for racing condition\r\n            else tacks.get(tack).remove();\r\n            tacks.delete(tack);\r\n            tacks.delete(et);\r\n          }\r\n        }\r\n      },false);\r\n      var observer = new MutationObserver(function(e){\r\n        var tgt = e[0].addedNodes[0];\r\n        var tack = site2[site.nickname].make_tack();\r\n        tack.onclick = cnst.tack_float_nSblgs;\r\n        tacks.set(tgt.previousElementSibling,tack);\r\n        tacks.set(tack,tgt);\r\n        tgt.parentNode.insertBefore(tack,tgt);\r\n        observer.disconnect();\r\n      });\r\n    })();\r\n\r\n    if (pref.test_mode['120'] && (pref.IDinfo.ID || pref.IDinfo.flag)) (function(){ // 4chan and 8chan\r\n      var IDop = site.myself.parse_funcs.id(site.myself);\r\n      var pfID = !pref.IDinfo.auto || IDop;\r\n      var pfFlag = !pref.IDinfo.auto || site.myself.posts[0].flag;\r\n      if (!pfID && !pfFlag && !pref.IDinfo.trip && !pref.IDinfo.name) return;\r\n      var IDs = {};\r\n      var flags = {};\r\n      var IDFlags = {};\r\n      var trips = {};\r\n      var names = {};\r\n      var nameTrips = {};\r\n      function entry(posts){\r\n        if (pref.IDinfo.ID && pfID) show(IDs, posts, 'pn_id', 'id', '', '', pref.IDinfo.nofIDs, null, null, pref.IDinfo.IDop);\r\n        if (pref.IDinfo.flag && pfFlag) show(flags, posts, 'flag', 'country', '(', ')', pref.IDinfo.nofFlags, pref.IDinfo.IDFlag && IDFlags, 'id');\r\n        if (pref.IDinfo.trip) show(trips, posts, 'pn_trip', 'trip', '(', ')', pref.IDinfo.nofTrips);\r\n        if (pref.IDinfo.name) show(names, posts, 'pn_name', 'name', '(', ')', pref.IDinfo.nofNames, pref.IDinfo.nameTrip && nameTrips, 'trip');\r\n      }\r\n      function show(obj, posts, prop_pn, prop, header, trailer, show_total, combo, combo_prop, show_IDop){\r\n        var updated = {};\r\n        if (posts) for (var i=0;i<posts.length;i++) {\r\n          var post = posts[i];\r\n          var pn = post[prop_pn];\r\n          if (pn) {\r\n            var post_prop = post[prop];\r\n            prep(obj, post_prop, pn, updated);\r\n            if (combo && post[combo_prop]) {\r\n              if (combo[post_prop]==undefined) combo[post_prop] = {};\r\n              combo[post_prop][post[combo_prop]] = null;\r\n            }\r\n          }\r\n//          if (IDFlags && post.id && post.country) {\r\n//            if (IDFlags[post.country]==undefined) IDFlags[post.country] = {};\r\n//            IDFlags[post.country][post.id] = null;\r\n//          }\r\n        } else for (var i in obj) updated[i] = 0;\r\n        show_pn(obj, updated, header, trailer, show_total, combo, show_IDop);\r\n      }\r\n      function prep(obj, key, pn, updated){\r\n        var val = {pn:pn, c:Object.keys(obj).length+(!obj[key]?1:0)};\r\n        if (!obj[key]) {\r\n          val.m = true; // mark\r\n          obj[key] = [val];\r\n        } else obj[key].push(val);\r\n        if (updated[key]===undefined) updated[key] = obj[key].length-1;\r\n      }\r\n      function show_pn(obj, updated, header, trailer, total, obj_combo, show_op){\r\n        for (var key in updated) {\r\n          var combo = obj_combo && obj_combo[key] && Object.keys(obj_combo[key]).length || 0;\r\n          var op = show_op && IDop===key? 'OP:' : '';\r\n          var pns = obj[key];\r\n          for (var i=0;i<pns.length;i++) {\r\n            var str = (header || '') + op + (i+1)+'/'+pns.length+(combo? '/'+combo:'')+(total? '/':trailer);\r\n//            var str = op + (i+1)+'/'+pns.length+(combo? '/'+combo:'')+(total? '/':trailer);\r\n            if (i<updated[key]) pns[i].pn.textContent = str;\r\n            else {\r\n//              if (header) pns[i].pn.parentNode.insertBefore(document.createTextNode(header), pns[i].pn);\r\n              var pn = document.createElement('span');\r\n              pn.innerHTML = str+(total? '<span'+(pns[i].m?' style=\"color:red\"':'')+'>'+pns[i].c+'</span>'+trailer:'');\r\n              pns[i].pn = pns[i].pn.parentNode.insertBefore(pn, pns[i].pn.nextSibling).firstChild;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      entry(site.myself.posts);\r\n      var proto = site2['DEFAULT'].wrap_to_parse.prep_pfunc(site.nickname, site.board, 'post_html');\r\n      new MutationObserver(function(e){\r\n        var posts = [];\r\n        for (var i=0;i<e.length;i++) if (e[i].addedNodes) for (var j=0;j<e[i].addedNodes.length;j++) posts[posts.length] = {pn:e[i].addedNodes[j], __proto__:proto};\r\n        entry(posts);\r\n//        for (var i=0;i<e.length;i++) if (e[i].addedNodes) entry(Array.prototype.map.call(e[i].addedNodes, function(v){return {pn:v};}));\r\n      }).observe(site.myself.pn, {childList: true});\r\n      function redraw(e,src){\r\n        if (pfID && (pref.IDinfo.ID ^ src==='IDinfo.ID')) remove_pn(IDs);\r\n        if (pfFlag && (pref.IDinfo.flag ^ src==='IDinfo.flag')) remove_pn(flags, true);\r\n        if (pref.IDinfo.name ^ src==='IDinfo.name') remove_pn(names, true);\r\n        if (pref.IDinfo.trip ^ src==='IDinfo.trip') remove_pn(trips, true);\r\n        entry(null);\r\n      }\r\n      function remove_pn(obj, header){\r\n        for (var i in obj) for (var j=0;j<obj[i].length;j++) {\r\n          var pn = obj[i][j].pn.parentNode;\r\n          obj[i][j].pn = pn.previousSibling;\r\n//          if (header) pn.parentNode.removeChild(pn.previousSibling.previousSibling);\r\n          pn.parentNode.removeChild(pn);\r\n        }\r\n      }\r\n      pref_func.settings.onchange_funcs['IDinfo.*w/'] = redraw;\r\n    })();\r\n                                                                       \r\n    return {\r\n//      mark_newer_posts: mark_newer_posts,\r\n      destroy : function(){ // destroy\r\n        pref_func.tooltips.remove_root(btns_p);\r\n//        base_thread.removeEventListener('DOMSubtreeModified',updated_buf,false);\r\n//        base_thread.removeEventListener('DOMNodeInserted',updated_buf,false);\r\n        observer.disconnect();\r\n////////        window.removeEventListener('storage', remake_own_posts_flag, false);\r\n        window.removeEventListener('storage', site2[site.nickname].check_reply.remake_own_posts, false);\r\n        if (inst_submit ) remove_event_from_submit(inst_submit);\r\n        if (inst_submit2) remove_event_from_submit(inst_submit2);\r\n        return null;\r\n      },\r\n      setup_submit2: function(){inst_submit2 = setup_submit(inst_submit2, site.components.postform_submit2);},\r\n      own_posts_tracker: own_posts_tracker,\r\n      updated: updated,\r\n      mark_posts_from_parent: mark_posts_from_parent,\r\n    }\r\n  }\r\n  function thread_reader_init(){\r\n    if (common_obj.thread_reader===null && site.features.thread_reader && pref.features.thread_reader && site.whereami==='thread' && pref.thread_reader.use) common_obj.thread_reader = make_thread_reader();\r\n    else if (!pref.thread_reader.use && common_obj.thread_reader) common_obj.thread_reader = common_obj.thread_reader.destroy();\r\n  }\r\n//  setTimeout(thread_reader_init,1); // call after making liveTag, and for safety, used setTimeout. (thread_reader_init contains DOM access, it may fail).\r\n\r\n\r\n\r\n  var liveTag = {\r\n    pn : null,\r\n    pn_summary : null,\r\n//    pn_filter_rexp : null,\r\n    active: {pk:0, in:0, ex:0},\r\n    tags_ci: null, // refers tags.__proto__\r\n    tags : Object.create(Object.create(null)),\r\n                                // tags[TAG] = {key:, num;, mems:, cbx:{pk:, in:, ex:}, (tgts:,) pn:, pn_num:, // summary tree\r\n                                //              ur:};\r\n//  mems : Object.create(null), // member tree : mems[domain][boards][no] = [[[],{},' '], [[],{}], threads_name_19];\r\n                                //   [0]:fixed, [1]:bumped, [x][0]:tags, [x][1]:keys, [0][2]:string,\r\n                                //   [2]:threads[name][19]\r\n                                //     [0]:time_of_checked, [1]:num_of_unread_replies_TO_ME, [2]:num_of_unread_replies,\r\n                                //     [3]:time_of_checked_time_internal, [4]:args_for_desktop_notification, [5]:init,\r\n                                //     [6]:time_of_checked_old, [7]:num_of_checked_posts, [8]:inital_loop,\r\n                                //     [9]:tag_temp, [10]:num_of_posts\r\n    mems : Object.create(null, {  //  CAUTION. USED ALWAYS EVEN IF pref.liveTag.use===false\r\n      getFromName: {value: function(name) {\r\n        var dbt = common_func.fullname2dbt(name);\r\n        return (dbt[2])? this[dbt[0]][dbt[1]][dbt[2]] : this[dbt[0]][dbt[1]];}},\r\n//      exist: {value: function(th) {\r\n//        return this[th.domain] && this[th.domain][th.board] && this[th.domain][th.board][th.no];}},\r\n      init: {value: (function(){\r\n        function prep_domain(th){\r\n////        if (this[th.domain]===undefined) this[th.domain] = Object.create(null, {proto:{value:Object.create(this.acc, {domain:{value:th.domain}})}, // working code.\r\n////                                                                                pfunc:{value:Object.create(null)}});\r\n////        if (!th.board) return this[th.domain];\r\n////\r\n////        if (this[th.domain][th.board]===undefined) {\r\n////          this[th.domain][th.board] = Object.create(this[th.domain].proto,\r\n////                                                     {proto:{value:Object.create(this[th.domain].proto,\r\n////                                                                                  {board:{value:th.board},\r\n////                                                                                   btag:{value:'#'+th.board.substr(1,th.board.length-2)}})},\r\n////                                                      nr:{value:0, writable:true}, nrtm:{value:0, writable:true}, nr_dirty:{value:false, writable:true},\r\n////                                                      u:{value:0, writable:true}, board:{value:th.board}, read_time:{value:0, writable:true},\r\n////                                                     });\r\n\r\n          this[th.domain] = Object.create(Object.create(this.acc, {domain:{value:th.domain}}),\r\n                                          {p:{value:Object.create(null)}, // pool of parse_funcs\r\n//                                         u:{value:0, writable:true}, // for 'add_domain'\r\n                                          });\r\n          if (site2[th.domain].lth_init) site2[th.domain].lth_init(th); \r\n        }\r\n        function prep_board(th){\r\n          var btag = '#'+th.board.substr(1,th.board.length-2);\r\n          if (liveTag.tags[btag] && liveTag.tags[btag].ref_tag === btag) btag = liveTag.tags[btag].ref_tag; // force to use the same reference.\r\n          this[th.domain][th.board] = Object.create(Object.create(Object.getPrototypeOf(this[th.domain]),\r\n                                                                  {board:{value:th.board},\r\n                                                                   btag:{value:btag, writable:true}}),\r\n                                                    {nr:{value:0, writable:true},\r\n                                                     nrtm:{value:0, writable:true},\r\n//                                                     nr_dirty:{value:false, writable:true},\r\n                                                     u:{value:0, writable:true},\r\n//                                                     read_time:{value:0, writable:true},\r\n                                                     o:{value:null, writable:true}, // for 'add_domain' // order\r\n//                                                     f:{value:0, writable:true}, // for 'add_domain'\r\n                                                     p:{value:{}, configurable:true, writable:true}, // pool of parse_funcs\r\n                                                     pgs:{value:null, writable:true}, // for 'add_domain' // max pages\r\n                                                     d:{value:0, writable:true}, // flags\r\n                                                     // s:   for statistics\r\n                                                     // sr:  for statistics\r\n                                                     // srt: for statistics\r\n                                                    });\r\n          if (pref.liveTag.inherit_board_name) {\r\n            liveTag.update_tags_in_th_sub([], {}, [btag], {}, 1, null, 0, this[th.domain][th.board]);\r\n//            liveTag.update_boardlist_1(btag); // for passive virtual boarding. // BUG. don't update new tags.\r\n            liveTag.update_pn_buf.delayed_do();\r\n          }\r\n        }\r\n        function prep_thread(th){\r\n//          this[th.domain][th.board][th.no] = {1:undefined, 2:[0,0,0,0,null,true,-2, 0, true, [], 1],  // init [10] as 1.// working code.\r\n//                                              u:0, no:th.no,\r\n//                                              __proto__:Object.getPrototypeOf(this[th.domain][th.board])};\r\n          var bd = this[th.domain][th.board];\r\n          bd[th.no] = Object.create(Object.getPrototypeOf(bd),{ // 28/324 for 1,2,u,no,tl.\r\n                                                                // 28/240 for 1,2,u,no.\r\n                                                                // 28/236 for 1,2,u,no,tl. (1===null)\r\n                                                                // 28/152 for   2,u,no.\r\n            '1':{value:undefined, writable:true},\r\n            '2':{value:[0x00830000, 0, 0]}, // 16/48 Bytes each. (header/all=header+contents)\r\n////                                               '2':{value:Object.create(this.watch,{ // 4,5,7,9 are shared for reducing memory consumption. // working code. // 28/116 Bytes each.\r\n////                                                 '0':{value:0x00010000, writable:true},\r\n////                                                 '1':{value:0, writable:true},\r\n////                                                 '2':{value:0, writable:true},\r\n//////                                                 '3':{value:0, writable:true},\r\n//////                                                 '6':{value:-2, writable:true},\r\n//////                                                 '8':{value:true, writable:true},\r\n//////                                                 '10':{value:-1, writable:true}\r\n////                                               })},\r\n            u:{value:0, writable:true}, // require 32Bytes/instance, 2.5% memory increase/instance.\r\n            no:{value:th.no, writable:true},\r\n            // tl: locked tag data\r\n            // s: for statistics\r\n            // th:  thread data, aka th.\r\n            // ta:  live thread, 'posts' contains all live posts.\r\n            // pd:  posts_deleted\r\n            // ed_p: editing posts\r\n            // ed_t: editing tags\r\n            // ed_u: update timestamp for editing posts,\r\n            // sID: stats of IDs\r\n            // sg: saged posts\r\n            // pgh: page history\r\n            // usWT: unsynced watch time; catalog data is delayed from thread sometime, triage through pipe may hit this in 4chan.\r\n          });\r\n//          var btag = bd[th.no].btag; // redundant\r\n//          liveTag.key_dirty[(pref.liveTag.ci)? btag.toLowerCase() : btag] = null;\r\n//          var btag2 = bd[th.no].btag2;\r\n//          if (btag2) for (var i=0;i<btag2.length;i++) liveTag.key_dirty[(pref.liveTag.ci)? btag2[i].toLowerCase() : btag2[i]] = null;\r\n        }\r\n        return function(th) {\r\n          if (this[th.domain]===undefined) prep_domain.call(this,th);\r\n          if (!th.board) return this[th.domain];\r\n          if (this[th.domain][th.board]===undefined) prep_board.call(this,th);\r\n          if (!th.no) return this[th.domain][th.board];\r\n          if (this[th.domain][th.board][th.no]===undefined) prep_thread.call(this,th);\r\n          return this[th.domain][th.board][th.no];\r\n        }\r\n      })()},\r\n//      watch: {value: Object.create(null, {  //'1':{value:undefined, writable:true, configurable:true}, // default value of 1.\r\n//                                          '4':{value:null, writable:true},\r\n//                                          '5':{value:true, writable:true},\r\n//                                          '7':{value:0, writable:true},\r\n//                                          '9':{value:[], writable:true},\r\n//                                         })},\r\n      acc: {value: Object.create(null, {  // to reduce memory consumption.\r\n        0: { // TAGS MUST BE UPDATED BY REPLACING INSTEAD OF SPLICING because Footer takes stateful approach at test_mode['119']\r\n////          get: function() {return (pref.liveTag.inherit_board_name && pref.liveTag.lock_board_name)? [this.btag] : null;}, // working code.\r\n////          set: function(val) {if (!pref.liveTag.inherit_board_name || !pref.liveTag.lock_board_name || val.length>=2) // inherit and lock ensures val.length>=1\r\n////                 Object.defineProperty(this,'0',{value:val, enumerable:true, configurable:true, writable:true}); // works.\r\n//////                 this.mems[this.domain][this.board][this.no]  = [val, this[1], this[2]];\r\n////               },\r\n////        },\r\n          get: function() {\r\n            var tag = this.btags;\r\n            if (this.tl) tag = (tag)? tag.concat(this.tl) : this.tl;\r\n            return tag || [];\r\n          },\r\n          set: function(val) {\r\n            var ref = this.btags;\r\n            if (ref) {\r\n              if (pref.liveTag.ci) ref = ref.map(function(v){return v.toLowerCase();});\r\n//              if (pref.liveTag.ci) for (var i=0;i<ref.length;i++) ref[i] = ref[i].toLowerCase(); // BUG, ref may original, not shallow copy.\r\n              for (var i=0;i<val.length;i++) if (ref.indexOf((pref.liveTag.ci)? val[i].toLowerCase() : val[i])!=-1) val.splice(i--,1);\r\n            }\r\n            if (val.length>0) this.tl = val;\r\n            else if (this.tl!==undefined) delete this.tl;\r\n          },\r\n        },\r\n        t: {get: function(){return this[1];}}, // TEMPORAL\r\n        t0: {get: function(){return this[0];}, set: function(v){this[0] = v;}}, // TEST PATCH, TO BE REMOVED\r\n        t1: {get: function(){return this[1];}, set: function(v){this[1] = v;}}, // TEST PATCH, TO BE REMOVED\r\n        wt: {get: function(){return this[2];}, set: function(v){this[2] = v;}}, // TEST PATCH, TO BE REMOVED\r\n        key: {get: function(){return this.domain + this.board + ((this.no)? this.no : '');}},\r\n//        tag: {get: function(){return (this[0] || []).concat(this[1] || []);}},\r\n        tags:{get: function(){return (this[0] || []).concat(this[1] || []);}}, // renaming function. use this later.\r\n//        tag: {get: function(){\r\n//          var tag0 = this[0];\r\n//          var tag1 = this[1];\r\n//          return (tag0 && tag1)? tag0.concat(tag1) : (tag0)? tag0 : (tag1)? tag1 : null;\r\n//        }},\r\n        btags: {get: function(){\r\n          var tags = (pref.liveTag.inherit_board_name && pref.liveTag.lock_board_name)? [this.btag] : null;\r\n          return (this.btag2 && pref.liveTag.inherit_board_tags && pref.liveTag.lock_board_tags)? (tags? tags.concat(this.btag2) : this.btag2) : tags;}},\r\n        watched:  {get: function(){return  this[2][0]&0x000c0000;}}, // see 'check_reply'\r\n        time_checked: {get: function(){return  this[2][2];}},\r\n        archived: {get: function(){return (this[2][0]&0x00700000) >> 20;},\r\n                   set: function(v){this[2][0] = this[2][0] & 0xff8fffff | ((v&0x07)<<20);}},\r\n        posts_saved:{get: function(){return (this[2][0]&0x02000000) >> 25;},\r\n                     set: function(v){this[2][0] = this[2][0] & 0xfdffffff | ((v&0x01)<<25);}},\r\n        force_ar: {get: function(){return (this[2][0]&0x00500000) >> 20;}}, // init or rescan\r\n        rescan_dp:{get: function(){return (this[2][0]&0x01000000) >> 24;},\r\n                   set: function(v){this[2][0] = this[2][0] & 0xfeffffff | ((v&0x01)<<24);}},\r\n        nrtm:     {get: function(){return (this[2][1]) >> 16;}},\r\n        nr:       {get: function(){return  this[2][1]&0x0000ffff;}}, // set directly in check_reply.check_1 and thread_reader.favicon_obj_trim\r\n        nof_posts:{get: function(){return  this[2][0]&0x0000ffff ;},\r\n                   set: function(v){this[2][0] = (this[2][0] & 0xffff0000) + v;}},\r\n\r\n        LS_synced: {get: function(){return this.d&0x00000001;},\r\n                    set: function(v){this.d = (this.d&0xfffffffe) | (v&0x01);}},\r\n        IDB_synced:{get: function(){return (this.d&0x00000002) >> 1;},\r\n                    set: function(v){this.d = (this.d&0xfffffffd) | ((v&0x01)<<1);}},\r\n      })}\r\n    }),\r\n//    mems_obj_accessors: { // to reduce memory consumption.\r\n//      get 0() {return (this._btag)? ((this._0)? [this.btag].concat(this._0) : [this.btag]) : this._0;}, // _0 is null at initial, and will never back to null after once promoted to [].\r\n//      set 0(val) {if (val[0]===this.btag) {\r\n//                     this._btag = true;\r\n//                     val.shift();\r\n//                   } else this._btag = false;\r\n//                   this._0 = (val.length!=0)? val : null;\r\n//                 }\r\n//    },\r\n    postprocess_board_add_btag: function(tags,bd){\r\n      for (var j=0;j<tags.length;j++) {\r\n        tags[j] = '#'+tags[j].replace(/[&<>'\"#]/g,'');\r\n        if (tags[j].length>pref.liveTag.maxstr) tags.splice(j--,1);\r\n      }\r\n      var flag = bd.btag2 && bd.btag2.length===tags.length;\r\n      if (flag) for (var j=0;j<tags.length;j++) if (tags[j]!==bd.btag2[j]) {flag = false;break;}\r\n      if (!flag) {\r\n        for (var j=0;j<tags.length;j++) if (liveTag.tags[tags[j]] && liveTag.tags[tags[j]].ref_tag===tags[j]) tags[j] = liveTag.tags[tags[j]].ref_tag; // force to use the same pointer to reduce memory consumption.\r\n        Object.defineProperty(Object.getPrototypeOf(bd),'btag2',{value:tags, writable:true});\r\n        if (pref.liveTag.inherit_board_tags) {\r\n          liveTag.inherit_board_tags_changed_1(tags, bd);\r\n//          for (var j=0;j<tags.length;j++) liveTag.update_boardlist_1(tags[j]); // for passive virtual boarding. // BUG. don't update new tags.\r\n//          for (var j=0;j<tags.length;j++) liveTag.update_pn_buf.delayed_do(); // called in liveTag.inherit_board_tags_changed_1\r\n        }\r\n      }\r\n    },\r\n    retag: function(lth, scan){ // retag IS NOT a full function, which tags are extracted from OP is not stored.\r\n      if (scan) {\r\n        scan.list_nup.add_scan(lth);\r\n        lth.wt[0] |= 0x00020000;\r\n      }\r\n      var th = {com:lth.tags.join(' '), parse_funcs:{type_com:'txt'}, __proto__:lth}; // patch\r\n      liveTag.prep_tags(th, true);\r\n      if (cataLog.threads[lth.key]) cataLog.Footer.update_force(lth.key,null,lth);\r\n    },\r\n    retag_db: DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(function(){if (cataLog.catalog_filter_changed) cataLog.catalog_filter_changed();}, 10)),\r\n    inherit_board_name_changed: function(){\r\n      for (var d in this.mems) for (var b in this.mems[d]) this.inherit_board_tags_changed_1([this.mems[d][b].btag], this.mems[d][b], !pref.liveTag.inherit_board_name);\r\n////      if (!pref.liveTag.inherit_board_name) this.delete_tags_buffered();\r\n    },\r\n    inherit_board_tags_changed: function(){\r\n      for (var d in this.mems) for (var b in this.mems[d]) if (this.mems[d][b].btag2) this.inherit_board_tags_changed_1(this.mems[d][b].btag2, this.mems[d][b], !pref.liveTag.inherit_board_tags);\r\n////      if (!pref.liveTag.inherit_board_tags) this.delete_tags_buffered();\r\n    },\r\n    inherit_board_tags_changed_1: function(tags, bd, remove){\r\n      for (var i=0;i<tags.length;i++) this.retag_in_th_sub(tags[i], bd, remove); // must before 'this.retag'.\r\n      for (var j in bd) {\r\n        var th_key = bd.domain + bd.board + bd[j].no;\r\n        this.retag(bd[j], remove && bd[j].tags.length >= pref.liveTag.max);\r\n      }\r\n      this.retag_db();\r\n      this.update_pn_buf.delayed_do();\r\n    },\r\n    ex_list_changed: function(){ // on demand remove only. When you remove a piece of list, reload is required.\r\n      if (pref.liveTag.ex_list) {\r\n        for (var d in this.mems) for (var b in this.mems[d]) for (var t in this.mems[d][b]) {\r\n          var lth = this.mems[d][b][t];\r\n          var tags_len = lth.tags.length;\r\n          if (this.exclude_tags(lth, lth.t0, lth.t1, true)) this.retag(lth, tags_len>=pref.liveTag.max);\r\n        }\r\n      }\r\n    },\r\n    exclude_tags: function(lth, tags0, tags1, remove){\r\n      var ex_list = pref_func.merge_obj5a(lth,pref.liveTag.ex_list_obj5,null);\r\n      if (!ex_list) return;\r\n      var t0 = this.exclude_tags_1(tags0, ex_list, remove? lth : null);\r\n      var t1 = this.exclude_tags_1(tags1, ex_list, remove? lth : null);\r\n      if (remove) {\r\n        if (t0) lth.t0 = t0;\r\n        if (t1) lth.t1 = t1;\r\n      }\r\n      return t0 || t1;\r\n    },\r\n    exclude_tags_1: function(tags, ex_list, lth){ // CAUTION. LIMIT CHANGABLE TAG OR ISSUE REDUNDANT ACCESS.\r\n      var flag = false;\r\n      if (tags) for (var i=tags.length-1;i>=0;i--) {\r\n        loop_tag: for (var k=0;k<ex_list.length;k++) if (ex_list[k].test(tags[i])) {\r\n          if (lth) this.delete_tags(tags[i],lth.key);\r\n          tags.splice(i,1);\r\n          flag = true;\r\n          break loop_tag;\r\n        }\r\n      }\r\n      return flag? tags : null;\r\n    },\r\n//    exclude_tags: function(lth, tag, remove){ // working code\r\n//      var ex_list = pref_func.merge_obj5a(lth,pref.liveTag.ex_list_obj5,null);\r\n//      if (ex_list) {\r\n//        var flag = false;\r\n//        for (var k=0;k<ex_list.length;k++) { // CAUTION. LIMIT CHANGABLE TAG OR ISSUE REDUNDANT ACCESS.\r\n//          for (var j=0;j<2;j++) {\r\n//            if (tag[j]) for (var i=tag[j].length-1;i>=0;i--) if (ex_list[k].test(tag[j][i])) {\r\n////            if (tag[j]) for (var i=0;i<tag[j].length;i++) if (ex_list[k].test(tag[j][i])) { // BUG, cause infinite loop when ex_list refers btag(board's tag).\r\n//              if (remove) this.delete_tags(tag[j][i],lth.key);\r\n//              tag[j].splice(i,1);\r\n////              tag[j].splice(i--,1);\r\n//              flag = true;\r\n//            }\r\n//          }\r\n//        }\r\n//      }\r\n//      return flag;\r\n//    },\r\n    key_dirty: Object.create(null),\r\n//    key_dirty_creation: Object.create(Object.create(null)),\r\n//    key_dirty: null, // {__proto__:key_dirty_creation},\r\n////    tags_mems: Object.create(null, { // working code.\r\n////      keys_obj: {get: function(){ // working code.\r\n////        var keys = Object.create(null);\r\n////        for (var i in this) {\r\n////////////if (!pref.test_mode['23']) { // test_mode['23'] is meaningless, because String is handled by reference.\r\n////////////          var val = this[i];\r\n////////////} else {\r\n////////////          var val = this.search_from_dic(this[i]);\r\n////////////}\r\n////          if (i[i.length-1]==='/') {\r\n////            var dbt = common_func.fullname2dbt(i);\r\n////            for (var j in liveTag.mems[dbt[0]][dbt[1]]) keys[i+j] = this[i];\r\n////          } else keys[i] = this[i];\r\n////        }\r\n////        return keys;\r\n////      }},\r\n////      keys_length: {get: function(){\r\n////        var len = 0;\r\n////        for (var i in this) {\r\n////          if (i[i.length-1]==='/') {\r\n////            var dbt = common_func.fullname2dbt(i);\r\n////            len += Object.keys(liveTag.mems[dbt[0]][dbt[1]]).length;\r\n////          } else len++;\r\n////        }\r\n////        return len;\r\n////      }},\r\n////////////      search_from_dic: {value: function(no){for (var i in this.dic) if (this.dic[i]==no) return i;}},\r\n////////////      clean_up_dic: {value: function(){\r\n////////////        var keys = {};\r\n////////////        for (var i in this) keys[this[i]] = null;\r\n////////////        for (var i in this.dic) if (keys[this.dic[i]]!==null) delete this.dic[i];\r\n////////////      }},\r\n////    }),\r\n    tags_array_old : [],\r\n    tags_proto: {pk:false, in:false, ex:false, pn:null,\r\n      mems_keys_obj: function(){ // working code.\r\n        var keys = {};\r\n        for (var i of this.mems.keys())\r\n          if (i.no===undefined) for (var j in i) keys[i[j].key] = this.mems.get(i);\r\n          else keys[i.key] = this.mems.get(i);\r\n        return keys;\r\n      },\r\n      mems_keys: function*(){ // iterator is slow in chome because iterator is not optimized.\r\n        for (var i of this.mems.keys())\r\n          if (i.no===undefined) for (var j in i) yield i[j];\r\n          else yield i;\r\n      },\r\n      mems_keys_length: function(){\r\n        var len = 0;\r\n        for (var i of this.mems.keys())\r\n//          if (i.no===undefined) len += Object.keys(i).length; // slow???\r\n          if (i.no===undefined) for (var j in i) ++len;\r\n          else ++len;\r\n        return len;\r\n      },\r\n      mems_keys_length_and_set_top: function(){\r\n        var len = 0;\r\n        var keys = {};\r\n        for (var i of this.mems.keys()) {\r\n          var key = this.mems.get(i);\r\n          if (keys[key]===undefined) keys[key] = 0;\r\n          if (i.no===undefined) for (var j in i) {++keys[key];++len;} // working code.\r\n          else {++keys[key];++len;}\r\n//          if (i.no===undefined) {\r\n//            if (Object.keys(i).length===0) {++keys[key];++len;} // TEST for passive virtual boarding. // TEMPORAL PATCH // empty boards goes high.\r\n//            if (Object.keys(i).length===0) {if (len===0) {++keys[key];++len;}} // TEST for passive virtual boarding. // TEMPORAL PATCH // tag which has only 1 thread goes down.\r\n//            else for (var j in i) {++keys[key];++len;}\r\n//          } else {++keys[key];++len;}\r\n        }\r\n        for (var j in keys) if (keys[j]>keys[this.key] || (keys[j]==keys[this.key] && j<this.key)) this.key = j;\r\n        if (this.key===this.ref_tag) this.key = this.ref_tag; // get the same reference to reduce memory consumption.\r\n        return len;\r\n      },\r\n      mems_boards: function(){\r\n        var tgts = {};\r\n        for (var j of this.mems.keys()) tgts[j.key.substr(0,j.key.lastIndexOf('/')+1)]=null;\r\n        return tgts;\r\n      },\r\n    },\r\n    scan_regex : /#[^#, \\.:;\\n\\|\"<>&]+(?=[#, \\.:;\\n\\|\"<>&]|$)/g, // ATTENTION. REFER function prep_tag_str();\r\n////    update_tags_in_th_sub: function(tags, keys, src, keys_fix, num, th, ur, btag){ // working code for obj.\r\n////      var count = tags.length;\r\n////      var i = 0;\r\n////      while (count<num && i<src.length) {\r\n////        var k = src[i++];\r\n////        var k_ci = (pref.liveTag.ci)? k.toLowerCase() : k;\r\n////        if (k_ci===k) k_ci=k; // to reduce memory consumption.\r\n////        if (keys_fix[k_ci]===undefined) {\r\n////          if (keys[k_ci]===undefined) {\r\n////            keys[k_ci] = k; // discarded every time, so needless to think about reference of 'k'.\r\n//////            tags[count++] = k;\r\n////            if (this.tags[k]===undefined) {\r\n////              if (this.tags_ci[k_ci]===undefined) {\r\n////////////if (!pref.test_mode['23']) {\r\n////                this.tags_ci[k_ci] = {key:k, mems:Object.create(this.tags_mems), ref_tag:k,\r\n//////                                    pk:false, in:false, ex:false, // moved to prototype\r\n////                                      pn:null, pn_num:0, ur:ur, __proto__:this.tags_proto};\r\n////////////} else {\r\n////////////                this.tags[k] = {key:k, mems:Object.create(this.tags_mems, {dic:{value:{}, writable:true}, dic_no:{value:0, writable:true}}),\r\n////////////                                cbx:{pk:false, in:false, ex:false}, pn:null, pn_num:0, ur:ur};\r\n////////////}\r\n////                if (this.tags[k]===undefined) this.tags[k] = this.tags_ci[k_ci];\r\n////              } else this.tags[k] = this.tags_ci[k_ci];\r\n//////              this.tags[k].tgts[k] = null;\r\n////            }\r\n////////            this.tags[k].mems[name] = k;\r\n////            var mems = this.tags[k].mems;\r\n////////////if (!pref.test_mode['23']) {\r\n////////////            var val = k;\r\n////////////} else {\r\n////////////            if (mems.dic[k]===undefined) {mems.dic[k]=mems.dic_no++;} // to reduce memory consumption, use dictionary.\r\n////////////            var val = mems.dic[k];\r\n////////////}\r\n////            if (k===this.tags[k].ref_tag) k = this.tags[k].ref_tag; // get the same reference to reduce memory consumption. This makes major of members see 'btag'.\r\n////            else for (var j in mems) if (k===mems[j]) {k=mems[j]; break;}\r\n////            if (k!==btag) {\r\n////              if (mems[th.key]!==k) this.key_dirty[k_ci] = null; // cases are changed or a new tag is added. 'if (keys[k_ci]!==k)' ensures (pref.liveTag.ci===true).\r\n////              mems[th.key] = k; // write always to force to use the same reference to reduce memory.\r\n////            }\r\n////            tags[count++] = k;\r\n////          }  // else if (keys[k_ci]!==k) this.tags[this.tags_ci[k_ci]].key_dirty = true; // case is changed. 'if (keys[k_ci]!==k)' ensures (pref.liveTag.ci===true).\r\n////        }\r\n////      }\r\n////      return i;\r\n////    },\r\n    update_tags_in_th_sub: function(tags, keys, src, keys_fix, num, th, ur, bd, clean){\r\n      var count = tags.length;\r\n      var i = 0;\r\n      while (count<num && i<src.length) {\r\n        var k = src[i++];\r\n        var k_ci = (pref.liveTag.ci)? k.toLowerCase() : k;\r\n        if (k_ci===k) k_ci=k; // to reduce memory consumption.\r\n        if (keys_fix[k_ci]===undefined) {\r\n          if (keys[k_ci]===undefined) {\r\n            keys[k_ci] = k; // discarded every time, so needless to think about reference of 'k'.\r\n            if (this.tags[k]===undefined) {\r\n              if (this.tags_ci[k_ci]===undefined) {\r\n                if (this.key_dirty[k_ci]===null) { // fallback for rare case, Case of deleted alerady.\r\n                //  Since tags_array_old ISN'T synchronized with tas.tags_ci,\r\n                //  the same key would be duplicated in tags_array_old when deletion, creation, deletion and creation(4 operations) were in a timeslot. This would be a bug.\r\n                  this.update_pn(); // synchronize them now.\r\n                }\r\n////                this.tags_ci[k_ci] = {key:k, mems: new Map(), ref_tag:k, // not optimized\r\n////                                      pn:null, pn_num:0, ur:ur, __proto__:this.tags_proto};\r\n                var mems_map = new Map(); // consumes 16 Bytes per content, but I can't reduce.... If this is changed to Set, 2.5% reduce in 8chan, but 0.5% in 4chan.(estimated)\r\n                this.tags_ci[k_ci] = {key:k, mems: mems_map, ref_tag:k, // optimized in V8\r\n                                      num:0, ur:ur, __proto__:this.tags_proto};\r\n//                                      pn:null, pn_num:0, ur:ur, __proto__:this.tags_proto};\r\n//                if (k!==k_ci) this.tags[k] = this.tags_ci[k_ci]; // this is equiavlent to 'if (this.tags[k]===undefined)' because this.tags.__proto__ === this.tags_ci // moved to later and was consolidated.\r\n                this.tags_array_old[this.tags_array_old.length] = this.tags_ci[k_ci];\r\n//                this.key_dirty_creation[k_ci] = null; // for pickup in 'update_pn'\r\n//                if (pref.debug_mode['3']) console.log('Added: '+k);\r\n              }\r\n              if (k!==k_ci) { // this is equiavlent to 'if (this.tags[k]===undefined)' because this.tags.__proto__ === this.tags_ci\r\n                this.tags[k] = this.tags_ci[k_ci];\r\n                if (this.tags_ci[k_ci].sb===undefined) this.tags_ci[k_ci].sb = [k]; // subscribe for deletion\r\n                else this.tags_ci[k_ci].sb[this.tags_ci[k_ci].sb.length] = k;\r\n              }\r\n            } // 'else' isn't required because this.tags.__proto__ === this.tags_ci\r\n            var mems = this.tags[k].mems;\r\n            if (k===this.tags[k].ref_tag) k = this.tags[k].ref_tag; // get the same reference to reduce memory consumption. This makes major of members see 'btag'.\r\n            else for (var j in mems) if (k===mems.get(j)) {k=mems.get(j); break;}\r\n//            if (k!==btag) {\r\n            if (!mems.has(bd)) {\r\n              var me = (th===null)? bd : bd[th.no];\r\n              var val = mems.get(me);\r\n              if (val===undefined || val!==k) this.key_dirty[k_ci] = null; // a new tag is added or cases are changed. 'if (keys[k_ci]!==k)' ensures (pref.liveTag.ci===true).\r\n              mems.set(me,k); // write always to force to use the same reference to reduce memory.\r\n            } else if (!clean) this.key_dirty[k_ci] = null; // board tag is hit. Case may be changed in case of board tag.\r\n            tags[count++] = k;\r\n          }\r\n        }\r\n        var tag_reserved = this.tags_reserved[k_ci];\r\n        if (th===null) {\r\n          var tag_pk = this.tags_ci[k_ci]['pk'];\r\n          if (tag_reserved!==undefined || tag_pk) this.tags_reserved_found_scan(k_ci, true, tag_reserved, tag_pk, bd);\r\n        } else if (tag_reserved!==undefined) this.tags_reserved_found(k_ci, true, tag_reserved);\r\n      }\r\n      return i;\r\n    },\r\n    retag_in_th_sub: function(tag, bd, remove){\r\n      if (remove) {\r\n        if (this.tags[tag]) this.delete_tags(tag, bd.key); // , true);\r\n      } else { // consolidate\r\n        this.update_tags_in_th_sub([], {}, [tag], {}, 1, null, 0, bd);\r\n        var mems = this.tags[tag].mems;  \r\n        for (var t in bd) if (mems.has(t)) mems.delete(t);\r\n      }\r\n    },\r\n    update_tags_in_th: function(src_new, src_old, keys_fix, num, th, watch, bd){\r\n      var ur = this.generate_ur(watch[1]); // moved to here from 'extract_tags' because 'prep_tags' needs this when it has tags_old.\r\n      var tags = [];\r\n      var keys = {};\r\n      this.update_tags_in_th_sub(tags, keys, src_new, keys_fix, num, th, ur, bd);\r\n      if (src_old) {\r\n        var i = this.update_tags_in_th_sub(tags, keys, src_old, keys_fix, num, th, ur, bd);\r\n        while (i<src_old.length) {\r\n          var k = src_old[i++];\r\n          var k_ci = (pref.liveTag.ci)? k.toLowerCase() : k;\r\n          if (keys_fix[k_ci]===undefined) {\r\n            if (keys[k_ci]!==k) this.key_dirty[k_ci] = null; // case is changed, or removed. 'if ((k_ci in keys) && keys[k_ci]!==k)' ensures (pref.liveTag.ci===true).\r\n            if (keys[k_ci]===undefined) this.delete_tags(k,th.key);\r\n          }\r\n        }\r\n      }\r\n      for (var i in keys_fix) this.check_update_tags_color(keys_fix[i],ur);\r\n      for (var i=0;i<tags.length;i++) this.check_update_tags_color(tags[i],ur);\r\n//      this.update_pn();\r\n//      this.update_pn_buf.delayed_do();\r\n//      return [tags, keys, false];\r\n      src_new = null;\r\n      this.keys_fix = keys;\r\n      return tags;\r\n    },\r\n    remove_tags_in_th: function(dbt){\r\n      var lth = this.mems[dbt[0]][dbt[1]][dbt[2]];\r\n      if (!lth) return;\r\n      var tags = lth.tags;\r\n      for (var i=0;i<tags.length;i++) this.delete_tags(tags[i],lth.key);\r\n      var btags = lth.btags;\r\n      if (pref3.stats.use) stats.thread_removed(dbt);\r\n      if (lth.q) lth.q = null; // cut cyclic reference, lth.q.__proto__  = lth\r\n      if (lth.nr && (pref.notify.favicon || pref.notify.title.notify)) notifier.favicon.set();\r\n      delete this.mems[dbt[0]][dbt[1]][dbt[2]];\r\n      if (btags) for (var i=0;i<btags.length;i++) {\r\n        this.key_dirty[(pref.liveTag.ci)? btags[i].toLowerCase() : btags[i]] = null;\r\n        if (pref.liveTag.style.use) this.update_ur_1(btags[i]); // btags are updated here, AFTER deleting lth.\r\n      }\r\n      this.update_pn_buf.delayed_do();\r\n//      if (pref.debug_mode['3']) console.log('remove: '+name);\r\n//      if (pref.debug_mode['3']) {\r\n////        var th_count = 0;\r\n////        for (var d in this.mems) for (var b in this.mems[d]) for (var t in this.mems[d][b]) th_count++;\r\n////        console.log('remove: '+name+', '+tags.tag+', tags_ci+tags: '+Object.keys(this.tags_ci).length+'+'+Object.keys(this.tags).length+', threads:'+th_count);\r\n//        for (var i in this.tags_ci) for (var j of this.tags_ci[i].mems.keys()) if (j===tags) console.log('ERROR: tags_ci['+i+'].mems has a reference to a deleted thread.');\r\n//      }\r\n    },\r\n    delete_tags: function(tag,name){ // , buffered_deletion){\r\n//      delete this.tags[tag].mems[name];\r\n      var tag_ci = (pref.liveTag.ci)? tag.toLowerCase() : tag;\r\n      this.key_dirty[tag_ci] = null;\r\n//      delete this.key_dirty_creation[tag_ci];\r\n      if (this.tags[tag]) {\r\n        if (this.tags[tag].mems.delete(this.mems.getFromName(name)) && pref.liveTag.style.use) this.update_ur_1(tag); // only thread's tag is updated here. see remove_tags_in_th.\r\n//        this.tags[tag].mems.delete(this.mems.getFromName(name));\r\n//        if (pref.liveTag.style) this.update_ur_1(tag); // BUG. btags can't be updated here synchronously, because ur is generated by enumerating lths, which will be deleted AFTER here.\r\n//      if (Object.keys(this.tags[tag].mems).length==0) {\r\n        if (this.tags[tag].mems.size==0) {\r\n          var pn = this.tags[tag].pn;\r\n          if (this.tags[tag].pn!==null) this.pn.removeChild(this.tags[tag].pn); // CAUSE ERROR, WHY??? // because of multiple deletion orz. this.tags[tag].pn === this.tags_ci[tag_ci].pn in this case, because this.tags[X] refers prototype which is this.tags_ci[Y]\r\n//          if (this.tags[tag].pn!==null) if (this.tags[tag].pn.parentNode===this.pn) this.pn.removeChild(this.tags[tag].pn);\r\n//          delete this.tags[tag].tgts[tag];\r\n          for (var i in this.active) if (this.tags[tag][i]) this.active[i]--;\r\n          var subscribers = this.tags_ci[tag_ci].sb;\r\n          if (subscribers) for (var i=0;i<subscribers.length;i++) delete this.tags[subscribers[i]];\r\n          delete this.tags_ci[tag_ci];\r\n////          delete this.tags[tag];\r\n//////          if (pref.liveTag.ci) for (var i in this.tags) if (!this.tags[i]) delete this.tags[i]; // tags are not removed in 'update_tags_in_th_sub' if cases are changed.\r\n//////          for (var i in this.tags) if (this.tags[i]===this.tags_ci[tag_ci]) delete this.tags[i]; // TOO SLOW\r\n////          if (!buffered_deletion) { // BUFFERED DELETION MUST BE EXECUTED ATOMICALLY, NO ACCESS TO this.taga BEFORE EXECUTION OF DELETION IS NOT ALLOWED.\r\n////            var keys_tags = Object.keys(this.tags);\r\n////            var tags_ci_obj = this.tags_ci[tag_ci];\r\n////            for (var i=0;i<keys_tags.length;i++) if (this.tags[keys_tags[i]]===tags_ci_obj) delete this.tags[keys_tags[i]];\r\n//////            if (this.tags_ci[tag_ci].pn) this.pn.removeChild(this.tags_ci[tag_ci].pn); // BUG, CAUSED AN ERROR, because of documentfragment??? // because of multiple deletion orz.\r\n////            delete this.tags_ci[tag_ci];\r\n////          } else {\r\n////            if (!this.delete_tags_buffered_list) this.delete_tags_buffered_list = new Set();\r\n////            this.delete_tags_buffered_list.add(this.tags_ci[tag_ci]);\r\n////          }\r\n          if (pref.debug_mode['3']) console.log('Remove: '+tag);\r\n        }\r\n      }\r\n    },\r\n////    delete_tags_buffered_list: null,\r\n////    delete_tags_buffered: function(){\r\n////      if (!this.delete_tags_buffered_list) return;\r\n////      var keys_tags = Object.keys(this.tags);\r\n////      for (var i=0;i<keys_tags.length;i++) if (this.delete_tags_buffered_list.has(this.tags[keys_tags[i]])) delete this.tags[keys_tags[i]];\r\n////      for (var i in this.tags_ci) if (this.delete_tags_buffered_list.has(this.tags_ci[i])) {\r\n//////        if (this.tags_ci[i].pn) this.pn.removeChild(this.tags_ci[i].pn); // because of multiple deletion orz.\r\n////        delete this.tags_ci[i];\r\n////      }\r\n////      this.delete_tags_buffered_list = null;\r\n////    },\r\n    check_update_tags_color: function(tag, ur){ // checks 0->1 only.\r\n      var ur_old = this.tags[tag].ur;\r\n      this.tags[tag].ur |= ur;\r\n//      if (pref.debug_mode['4']) if (ur_old!=ur) console.log('ur: '+tag+', '+ur_old+' <- '+ur);\r\n      if (~ur_old & ur) this.update_tag_node(tag);\r\n    },\r\n    rm_404: function(domain, board, nos){\r\n      if (this.mems[domain] && this.mems[domain][board]) {\r\n        var mems = this.mems[domain][board];\r\n        for (var i in mems) if (nos[i]===undefined) if (this.rm_404_1(domain,board,i)) nos[i]=null;\r\n      }\r\n    },\r\n    rm_404_1: function(domain, board, no, from_IDB){\r\n      var name = domain+board+no;\r\n      var lth;\r\n      var keep = pref.liveTag.rm_404==='no' || (lth = liveTag.mems.getFromName(name), lth && lth.watched && (pref.liveTag.rm_404==='watched' || lth.nr));\r\n//      if (keep) {\r\n//        var tgt_th = cataLog.threads[name];\r\n//        if (tgt_th && tgt_th[14]!=='IDB' && tgt_th[14]!=='FILE') {\r\n//          if (tgt_th[14]!=='x') {\r\n//            tgt_th[14]='x';\r\n//            cataLog.Footer.update_force(name); // temporal, this will be rewritten after implementing watcher\r\n//          }\r\n//        }\r\n//        return true; // must be here; before 'check_clean', which is NOT supporsed to be issued multiple times.\r\n//      }\r\n      if (!from_IDB) {\r\n        if (!pref.test_mode['65']) if (pref.archive.IDB.auto_clean) IDB.req(domain, board, no, 'pruned_time', Date.now(), 'check_clean');\r\n        if (!pref.test_mode['67']) archiver.clean_list(domain, board, no);\r\n        if (!keep && !pref.test_mode['65'] && pref.archive.IDB.auto_restore && cataLog.threads[name]) cataLog.restore_th_from_IDB(domain, board, no);\r\n      }\r\n      if (keep) {\r\n        var tgt_th = cataLog.threads[name];\r\n        if (tgt_th && tgt_th[14]!=='IDB' && tgt_th[14]!=='FILE') {\r\n          if (tgt_th[14]!=='x') {\r\n            tgt_th[14]='x';\r\n            cataLog.Footer.update_force(name); // temporal, this will be rewritten after implementing watcher\r\n          }\r\n        }\r\n        return true;\r\n      }\r\n      cataLog.gClg.remove_thread(name);\r\n      this.remove_tags_in_th([domain,board,no]);\r\n      if (pref[cataLog.embed_mode].deleted_posts.auto_clean) site2[domain].clean_up_deleted_posts_1(board + no);\r\n    },\r\n//    find_friend_tag_ci: function(tag){\r\n//      var tag_l = tag.toLowerCase();\r\n//      for (var i in liveTag.tags) if (tag!==i && tag_l===liveTag.tags[i].key.toLowerCase()) return i;\r\n//      return null;\r\n//    },\r\n    tooltip: function(e, str){\r\n      var tag;\r\n      var et = e.target;\r\n      if (et.type==='checkbox') {\r\n        var suffix = et.name.substr(-2,2);\r\n        tag = et.getAttribute('name').slice(0,-3);\r\n        str += ((suffix==='pk')? 'Fetch' : (suffix==='in')? 'Show' : 'Hide') + ' threads which have ' + tag + '.'\r\n      } else {\r\n        tag = et.getAttribute('name');\r\n        str += tag + ': ' + liveTag.make_info(tag) +'<br>';\r\n//        for (var i in liveTag.tags[tag].mems) str += i + ', ';\r\n        var myDomain = new RegExp('^'+site.nickname);\r\n        for (var i of liveTag.tags[tag].mems.keys()) str += i.key.replace(myDomain,'') + ', ';\r\n      }\r\n      return str;\r\n//      pref_func.tooltips.show_1.call(et, e, str, null, et.type!=='checkbox');\r\n    },\r\n    boardlist_click_entry: function(e){\r\n      if (!e.ctrlKey) {\r\n        e.preventDefault();\r\n        var tag = this.textContent;\r\n        liveTag.cbx_changed(tag, pref.liveTag.click_func_bl, null, this);\r\n      }\r\n    },\r\n    generate_ur: function(info){\r\n      return ((info>>16)!=0)? 3 : ((info&0x0000ffff)!=0)? 1 : 0;\r\n    },\r\n    CountNR: (function(){\r\n// [ForInStatement is not fast case]\r\n// http://www.html5rocks.com/en/tutorials/performance/mystery/?redirect_from_locale=ja\r\n      var CountNR = function(){\r\n        this.nrtm = 0;\r\n        this.nr   = 0;\r\n        this.nth  = 0;\r\n      }\r\n      CountNR.prototype = {\r\n        count: function(th){\r\n          if (th[0]&0x000c0000) {\r\n            var nr = th[1]&0x0000ffff;\r\n            if (nr) {\r\n              this.nrtm += th[1]>>16;\r\n              this.nr   += nr;\r\n              this.nth++;\r\n            }\r\n          }\r\n        },\r\n        count_all: function(){\r\n          for (var d in liveTag.mems) for (var b in liveTag.mems[d]) {\r\n            var lbd = liveTag.mems[d][b];\r\n            if (lbd.nr<0) { // check dirty\r\n              var cnr = new liveTag.CountNR();\r\n              for (var t in lbd) cnr.count(lbd[t].wt);\r\n              lbd.nrtm = cnr.nrtm;\r\n              lbd.nr   = cnr.nr;\r\n            }\r\n//              sum.count([0x000c0000, (lbd.nrtm<<16) + lbd.nr]); // BUG, nr overflowed in 4chan.\r\n            this.nrtm += lbd.nrtm;\r\n            this.nr   += lbd.nr;\r\n          }},\r\n      }\r\n      return CountNR;\r\n    })(),\r\n    update_ur: function(name,ur,all_case){\r\n      var dbt = common_func.fullname2dbt(name);\r\n      this.mems[dbt[0]][dbt[1]].nr = -1; // mark as dirty\r\n      var tags = this.mems[dbt[0]][dbt[1]][dbt[2]].tags;\r\n      for (var i=0;i<tags.length;i++)\r\n        if (!all_case) {if (this.tags[tags[i]]) this.check_update_tags_color(tags[i],ur);}\r\n        else this.update_ur_1(tags[i]);\r\n    },\r\n//    update_ur: function(name,ur,all_case){ // working code\r\n//      var dbt = common_func.fullname2dbt(name);\r\n//      var tag = this.mems[dbt[0]][dbt[1]][dbt[2]];\r\n//      this.mems[dbt[0]][dbt[1]].nr = -1;\r\n////      var tag = this.mems.getFromName(name);\r\n//      for (var j=0;j<2;j++) if (tag[j]) for (var i=0;i<tag[j].length;i++) \r\n//        if (!all_case) {if (this.tags[tag[j][i]]) this.check_update_tags_color(tag[j][i],ur);}\r\n//        else this.update_ur_1(tag[j][i]);\r\n//    },\r\n    update_ur_1: function(tag){ // subfunc of 'count_ur'\r\n      var ur_old = this.tags[tag].ur;\r\n      var ur = 0;\r\nif (!pref.test_mode['24']) {\r\n      var mems_objs = this.tags[tag].mems_keys_obj(); // working code.\r\n      for (var i in mems_objs) {\r\n//        var info = this.mems.getFromName(i).wt;\r\n        var info = this.mems.getFromName(i);\r\n        if (info) ur |= liveTag.generate_ur(info.wt[1]);\r\n      }\r\n} else {\r\n      for (var i of this.tags[tag].mems_keys())\r\n        ur |= liveTag.generate_ur(i.wt[1]);\r\n}\r\n      if (ur_old!=ur) {\r\n        this.tags[tag].ur = ur;\r\n        this.update_tag_node(tag);\r\n      }\r\n    },\r\n//    count_ur: function(tag){\r\n//      var nums = this.count_ur_sub(tag);\r\n//      var friends = Object.create(null);\r\n//      friends[tag] = null;\r\n//      if (pref.liveTag.ci) {\r\n//        var tag_l = tag.toLowerCase();\r\n//        for (var i in liveTag.tags) {\r\n//          if (tag!==i && tag_l===liveTag.tags[i].key.toLowerCase()) {\r\n//            friends[i]=null;\r\n//            if (this.tags[i].ur_cs===null) this.count_ur_sub(i);\r\n//            for (var j=0;j<4;j++) nums[j] += this.tags[i].ur_cs[j];\r\n//          }\r\n//        }\r\n//      }\r\n//      for (var i in friends) this.tags[i].ur = nums;\r\n//      return nums;\r\n//    },\r\n//    count_ur_sub: function(tag){\r\n    count_ur: function(tag){\r\n      var nof_th = 0;\r\n      var bds = {};\r\n      var counter = new this.CountNR();\r\nif (!pref.test_mode['24']) {\r\n      var mems_objs = this.tags[tag].mems_keys_obj(); // working code.\r\n      for (var i in mems_objs) {\r\n        var dbt = common_func.fullname2dbt(i);\r\n        var info = this.mems[dbt[0]][dbt[1]][dbt[2]].wt;\r\n        if (info) counter.count(info);\r\n        bds[dbt[0]+dbt[1]] = null;\r\n      }\r\n      nof_th = this.tags[tag].mems_keys_length();\r\n} else {\r\n      for (var i of this.tags[tag].mems_keys()) {\r\n        counter.count(i.wt);\r\n        bds[i.domain+i.board] = null;\r\n        nof_th++;\r\n      }\r\n}\r\n      var nof_bds = Object.keys(this.tags[tag].mems_boards()).length;\r\n      return [counter.nrtm, counter.nr, counter.nth, nof_th, Object.keys(bds).length, nof_bds];\r\n    },\r\n    make_info: function(tag){\r\n      var nums = liveTag.count_ur(tag); // must exec every time because every update are NOT exact.\r\n      return 'U: '+nums[0]+'/'+nums[1]+'/'+nums[2]+' / T: '+nums[3]+' / B: '+nums[4]+'/'+nums[5];\r\n    },\r\n    tag_onmouseover: function(e){\r\n//      var et = e.target;\r\n//      if (pref.liveTag.info) pref_func.tooltips.show_1.call(et, e, liveTag.make_info(et.textContent), null, true);\r\n      return liveTag.make_info(e.target.textContent);\r\n    },\r\n    cbx_changed: function(tag, func, no_scan, node_in_boardlist, backward){\r\n      var obj = this.tags[tag];\r\n      var stOut  = obj['in']===false && obj['ex']===true;\r\n      var stNone = obj['in']===false && obj['ex']===false;\r\n      var stIn   = obj['in']===true  && obj['ex']===false;\r\n      var inv_in = func==='pkin' || func==='in' || func==='inex' && (backward? !stNone : !stOut);\r\n      var inv_pk = func==='pkin' && obj['pk']===obj['in'];\r\n      var inv_ex = func==='ex' || func==='inex' && (backward? !stIn : !stNone);\r\n      if (inv_in) this.cbx_emulate_inv(tag, 'in', no_scan); // 'in' must be processed first to prevent auto set.\r\n      if (inv_pk) this.cbx_emulate_inv(tag, 'pk', no_scan); // 'in' is NOT changed here.\r\n      if (inv_ex) this.cbx_emulate_inv(tag, 'ex', no_scan);\r\n      if (cataLog.catalog_filter_changed) cataLog.catalog_filter_changed();\r\n      this.update_tag_node(tag, node_in_boardlist);\r\n    },\r\n//    cbx_changed: function(tag, func, no_scan, node_in_boardlist){ // working code\r\n//      if (func==='pkin') {\r\n//        if (this.tags[tag]['pk'] !== !this.tags[tag]['in']) {\r\n//          this.tags[tag]['pk'] = !this.tags[tag]['in'];\r\n//          if (this.tags[tag].pn!==null) this.tags[tag].pn.childNodes[0].checked = this.tags[tag]['pk'];\r\n//          this.cbx_onchange(tag,'pk', no_scan); // 'in' is upped automatically when pk goes 0 -> 1.\r\n//        }\r\n//        if (this.tags[tag]['in'] !== this.tags[tag]['pk']) {\r\n//          this.tags[tag]['in'] = this.tags[tag]['pk'];\r\n//          if (this.tags[tag].pn!==null) this.tags[tag].pn.childNodes[1].checked = this.tags[tag]['in'];\r\n//          this.cbx_onchange(tag,'in');\r\n//        }\r\n//      } else {\r\n//        var in_old = this.tags[tag]['in'];\r\n//        if (func==='in' || (func==='inex' && !(this.tags[tag]['in']===false && this.tags[tag]['ex']===true))) {\r\n//          this.tags[tag]['in'] = !this.tags[tag]['in'];\r\n//          if (this.tags[tag].pn!==null) this.tags[tag].pn.childNodes[1].checked = this.tags[tag]['in'];\r\n//          this.cbx_onchange(tag,'in');\r\n//        }\r\n//        if (func==='ex' || (func==='inex' && !(in_old===false && this.tags[tag]['ex']===false))) {\r\n//          this.tags[tag]['ex'] = !this.tags[tag]['ex'];\r\n//          if (this.tags[tag].pn!==null) this.tags[tag].pn.childNodes[2].checked = this.tags[tag]['ex'];\r\n//          this.cbx_onchange(tag,'ex');\r\n//        }\r\n//      }\r\n//      this.cbx_onchange_after();\r\n//      this.update_tag_node(tag, node_in_boardlist);\r\n//    },\r\n//    filter_onchange_entry : function(e){liveTag.filter_onchange(this, e);},\r\n    filter_onchange: function(pref_obj, init){\r\n      pref_obj.rexps = common_func.kwd_prep_regexp(pref_obj);\r\n//      this.pn_filter_rexp = (pref.catalog.filter.tag_search.str==='')? null : new RegExp(pref.catalog.filter.tag_search.str, (pref.liveTag.ci)? 'i': undefined);\r\n////      for (var i in this.tags) // working code.\r\n////        if (this.tags[i].pn!==null) this.tags[i].pn.style.display = (this.pn_filter_rexp===null || this.pn_filter_rexp.test(i))? '' : 'none';\r\n      if (!init) this.update_pn(pref_obj === pref.catalog.filter.tag_search);\r\n    },\r\n////    set_reserved_tags: function(tags,set){ // working code\r\n////      for (var i=0;i<tags.length;i++) {\r\n////        var tag = tags[i];\r\n////        var tag_ci = (pref.liveTag.ci)? tag.toLowerCase() : tag;\r\n////        if (this.tags_ci[tag_ci]) {\r\n////          if (this.tags_ci[tag_ci]['pk']!=set) this.cbx_changed(tag_ci,'pkin', true);\r\n////          this.update_tag_node(tag_ci);\r\n////          tags.splice(i--,1);\r\n////        }\r\n////      }\r\n////    },\r\n    tags_reserved: Object.create(null),\r\n    tags_reserved_found_scan: function(tag_ci,set, prop, pk, bd){\r\n      if (prop==='pk' || pk) {\r\n        scan.list_nup.add_board(bd,0);\r\n        scan.scan('b',bd.domain);\r\n      }\r\n      if (prop!==undefined) this.tags_reserved_found(tag_ci,set, prop);\r\n    },\r\n    tags_reserved_found: function(tag_ci,set, prop){\r\n      if (this.tags_ci[tag_ci][prop]!=set) this.cbx_changed(tag_ci, prop==='pk'? 'pkin':prop, true);\r\n      delete this.tags_reserved[tag_ci];\r\n    },\r\n    tags_reserved_init: function(tags,set){\r\n      this.tags_reserved = Object.create(null);\r\n      var bds_pickup = {};\r\n      for (var i=0;i<tags.length;i++) {\r\n        var prop = tags[i][0]==='!'? 'ex' : tags[i][1]==='#'? 'pk' : 'in'; // !#tag for 'ex', ##tag for 'pkin', #tag for 'in'\r\n        var tag = prop==='in'? tags[i] : tags[i].slice(1);\r\n        var tag_ci = (pref.liveTag.ci)? tag.toLowerCase() : tag; // tags_ci must be used becase tags in blist is raw, the tag may not exist in liveTag.tags[tag].\r\n        if (this.tags_ci[tag_ci]) {\r\n          this.tags_reserved_found(tag_ci,set, prop);\r\n          if (set && prop==='pk') {\r\n            var bds = liveTag.tags_ci[tag_ci].mems_boards();\r\n            for (var bd in bds) bds_pickup[bd] = null;\r\n          }\r\n        } else if (set) this.tags_reserved[tag_ci] = prop;\r\n      }\r\n      return bds_pickup;\r\n    },\r\n    update_pn_last_filter_active: false,\r\n    sort_func: function(a,b){return b.num - a.num || b.mems.size - a.mems.size || ((b.key > a.key)? -1:1);},\r\n    update_pn_disp_func: function(rexps, key){\r\n      if (rexps===null) return 0;\r\n      for (var i=0;i<rexps.length;i++) if (rexps[i].test(key)) return 1; // match any\r\n      return 0;\r\n    },\r\n    update_pn_buf: null,\r\n    update_pn: function(from_filter){\r\n      if (this.pn===0) return; // trap for thread_reader.\r\n      if (this.pn===null) {\r\n        this.pn = document.getElementsByName('catalog.filter.tag_list')[0];\r\n        if (this.pn) {\r\n          this.pn.style.height = '16px';\r\n          this.pn.style.width = '250px';\r\n          this.pn_summary = this.pn.previousSibling.childNodes[0];\r\n          this.pn.onchange = this.cbx_onchange_entry;\r\n          this.filter_onchange(pref.catalog.filter.tag_search, true);\r\n        } else {\r\n          this.pn = 0;\r\n          return;\r\n        }\r\n      }\r\n      this.update_pn_1_lazy.cancel();\r\n      this.update_pn_1(from_filter, true);\r\n    },\r\n    update_pn_pos: null,\r\n    update_pn_1_lazy: null, // bound later, update_pn_1.bind(liveTag,true)\r\n    update_pn_1: function(from_filter, from_initial){\r\n//      if (this.reserved) { // worning code\r\n//        this.set_reserved_tags(this.reserved,true);\r\n//        if (this.reserved.length===0) this.reserved = null;\r\n//      }\r\n\r\n////      var tags_array = []; // working code.\r\n//////      var keys = {};\r\n//////      for (var i in this.tags) // patch, this can be removed if this.tags is fully overlayed at pref.liveTag.ci. // PATCHES CAN BE REMOVED\r\n//////        if (keys[i]!==null) {\r\n//////          keys[i] = null;\r\n//////          tags_array[tags_array.length] = {key:i, num:Object.keys(this.tags[i].mems).length};\r\n//////        }\r\n//////      if (pref.liveTag.ci) {\r\n//////        for (var i=0;i<tags_array.length;i++) { // search major key\r\n//////          keys = {};\r\n//////          var mems = this.tags[tags_array[i].key].mems;\r\n//////          for (var j in mems) keys[mems[j]] = (keys[mems[j]] || 0) +1;\r\n//////          for (var j in keys) if (keys[j]>keys[tags_array[i].key]) tags_array[i].key = j;\r\n//////        }\r\n//////      }\r\n////\r\n////      if (pref.liveTag.ci) {\r\n////        for (var i in this.key_dirty) { // set major key\r\n////          var tag_obj = this.tags_ci[(pref.liveTag.ci)? i.toLowerCase() : i];\r\n////          if (tag_obj) {\r\n////            var keys = {};\r\n////            var mems = tag_obj.mems;\r\n////            for (var j in mems) keys[mems[j]] = (keys[mems[j]] || 0) +1;\r\n////            var key_old = tag_obj.key;\r\n////////////if (!pref.test_mode['23']) {\r\n////            for (var j in keys) if (keys[j]>keys[tag_obj.key]) tag_obj.key = j;\r\n////////////} else {\r\n////////////            for (var j in keys) if (keys[j]>keys[tag_obj.key]) tag_obj.key = tag_obj.mems.search_from_dic(j);\r\n////////////            mems.clean_up_dic();\r\n////////////}\r\n////            if (key_old!==tag_obj.key) if (tag_obj.pn) tag_obj.pn.childNodes[3].textContent = Object.keys(tag_obj.mems).length + ': ' + tag_obj.key;\r\n////          }\r\n////        }\r\n////      }\r\n////      this.key_dirty = Object.create(null);\r\n////      for (var i in this.tags_ci) tags_array[tags_array.length] = {key:this.tags_ci[i].key, num:this.tags_ci[i].mems_keys_length(),\r\n////                                                                   disp: (this.pn_filter_rexp===null || !this.pn_filter_rexp.test(this.tags_ci[i].key))? 0 : 1};\r\n////      tags_array.sort(this.sort_func);\r\n\r\n//      var tags_array = this.tags_array_old; // working code.\r\n//      for (var i=0;i<tags_array.length;i++) {\r\n//        var key = tags_array[i].key;\r\n//        var k_ci = (pref.liveTag.ci)? key.toLowerCase() : key;\r\n//        if (this.key_dirty[k_ci]===null) {\r\n//          delete this.key_dirty[k_ci];\r\n//          if (this.tags_ci[k_ci]) {\r\n//            tags_array[i].num = (pref.liveTag.ci)? this.tags_ci[k_ci].mems_keys_length_and_set_top() : this.tags_ci[k_ci].mems_keys_length();\r\n//            if (key!==this.tags_ci[k_ci].key) {\r\n//              if (this.tags_ci[k_ci].pn) this.tags_ci[k_ci].pn.childNodes[3].textContent = tags_array[i].num + ': ' + this.tags_ci[k_ci].key;\r\n//              tags_array[i].key = this.tags_ci[k_ci].key;\r\n//            }\r\n//          } else {\r\n//            tags_array.splice(i--,1);\r\n//            continue;\r\n//          }\r\n//        }\r\n//        if (from_filter) tags_array[i].disp = this.update_pn_disp_func(pref.catalog.filter.tag_search.rexps, tags_array[i].key);\r\n//      }\r\n//      for (var i in this.key_dirty)\r\n//        if (this.tags_ci[i]) {\r\n//          var tags_ary_num = (pref.liveTag.ci)? this.tags_ci[i].mems_keys_length_and_set_top() : this.tags_ci[i].mems_keys_length(); // sets key\r\n//          tags_array[tags_array.length] = {key:this.tags_ci[i].key, num:tags_ary_num,\r\n//                                           disp: this.update_pn_disp_func(pref.catalog.filter.tag_search.rexps, this.tags_ci[i].key)};\r\n//        }\r\n//      tags_array.sort(this.sort_func);\r\n//      this.key_dirty = Object.create(null);\r\n\r\n      var tags_array = this.tags_array_old;\r\n      var dirty_count = 0;\r\n      var dirty_count_deleted = 0;\r\n      for (var k_ci in this.key_dirty) { // must enumerate item in prototype.\r\n        if (this.tags_ci[k_ci]) {\r\n          this.tags_ci[k_ci].num = (pref.liveTag.ci)? this.tags_ci[k_ci].mems_keys_length_and_set_top() : this.tags_ci[k_ci].mems_keys_length();\r\n//          delete this.key_dirty_creation[k_ci]; // may be respawned, typically by IDB.\r\n        } else dirty_count_deleted++; // CAUTION, this incudes count of creation.\r\n        dirty_count++;\r\n      }\r\n//      for (var k_ci in this.key_dirty_creation) if (this.tags_ci[k_ci]) tags_array[tags_array.length] = this.tags_ci[k_ci];\r\n      if (dirty_count || pref.test_mode['73']) tags_array.sort(this.sort_func);\r\n\r\n////      for (var i in this.tags) tags_array[tags_array.length] = {key:i, num:Object.keys(this.tags[i].mems).length, mems:{}}; // working code.\r\n//////      for (var i in this.tags) { // working code, moved to 'delete_tags'.\r\n//////        var num = Object.keys(this.tags[i].mems).length;\r\n//////        if (num==0){\r\n//////          if (this.tags[i].pn!==null) this.pn.removeChild(this.tags[i].pn);\r\n//////          delete this.tags[i];\r\n//////          if (pref.debug_mode['3']) console.log('Remove: '+i);\r\n//////        } else tags_array[tags_array.length] = {key:i, num:num, mems:{}};\r\n//////      }\r\n////\r\n////      tags_array.sort(this.sort_func);\r\n////\r\n////      if (pref.liveTag.ci) {\r\n////        var tags_ci = Object.create(null);\r\n////        for (var i=0;i<tags_array.length;i++) {\r\n////          var key = tags_array[i].key.toLowerCase();\r\n////          if (!(key in tags_ci)) tags_ci[key] = i;\r\n////          else {\r\n////            var src = this.tags[tags_array[i].key];\r\n////            var ref = this.tags[tags_array[tags_ci[key]].key];\r\n////            var dst = tags_array[tags_ci[key]];\r\n////            for (var j in src.mems) if (!(j in ref.mems)) dst.mems[j] = null;\r\n////            dst.num = Object.keys(ref.mems).length + Object.keys(dst.mems).length;\r\n////            tags_array[i].num = 0;\r\n//////            src.pk = ref.pk;\r\n//////            src.in = ref.in;\r\n//////            src.ex = ref.ex;\r\n//////            ref.ci[tags_array[i].key] = null;\r\n////////            src.ci = {};\r\n////            if (src.pn!==null) { // force to remake to reflect changes next time.\r\n////              if (src.pn!==null) this.pn.removeChild(src.pn);\r\n////              src.pn=null;\r\n////              src.pn_num=0;\r\n////            }\r\n////          }\r\n////        }\r\n////        tags_array.sort(this.sort_func);\r\n////      }\r\n//////      if (pref.debug_mode['3']) console.log(JSON.stringify(tags_array));\r\n\r\n      if (dirty_count) from_initial = true;\r\n      var exam_pn = from_filter || this.update_pn_pos;\r\n      var limit = pref.liveTag.lazy_each;\r\n      var rexps = pref.catalog.filter.tag_search.rexps;\r\n      var historical_filter_active = rexps || this.update_pn_last_filter_active;\r\n      if (historical_filter_active || dirty_count_deleted) {\r\n        var docfrag = (rexps && this.pn.firstChild)? null : document.createDocumentFragment();\r\n        var pos_insert = (from_initial)? 0 : this.update_pn_pos[0];\r\n        var pf_boards = pref.catalog.filter.tag_search.show_nof_boards;\r\n        for (var i=(from_initial)? 0 : this.update_pn_pos[1];i<tags_array.length;i++) {\r\n          var key = tags_array[i].key;\r\n          var key_ci = (pref.liveTag.ci)? key.toLowerCase() : key;\r\n          var dirty = (key_ci in this.key_dirty);\r\n          var tag_obj = this.tags_ci[key_ci];\r\n          if (tag_obj) {\r\n            if (historical_filter_active) {\r\n              var pn = tag_obj.pn;\r\n              if (exam_pn || dirty) {\r\n                var disp = this.update_pn_disp_func(rexps, key_ci);\r\n                if (disp===0) {\r\n                  if (pn!==null) {\r\n                    this.pn.removeChild(pn);\r\n                    tag_obj.pn = null;\r\n                  }\r\n                } else {\r\n                  if (pn!==null) {\r\n                    if (dirty) tag_obj.pn.childNodes[3].textContent = tag_obj.num + ': ' + key;\r\n                    if (limit>0) if (this.pn.childNodes[pos_insert]!==pn) {\r\n                      this.pn.insertBefore(pn, this.pn.childNodes[pos_insert] || null);\r\n                      if (--limit==0) this.update_pn_pos = [pos_insert+1,i+1];\r\n                    }\r\n                  } else if (limit>0) {\r\n                    pn = document.createElement('div');\r\n                    pn.setAttribute('name',key);\r\n                    pn.innerHTML = \r\n                      '<input type=\"checkbox\" name=\"' + key_ci + '.pk\" ' + ((tag_obj['pk'])? 'checked' : '') + '>' + \r\n                      '<input type=\"checkbox\" name=\"' + key_ci + '.in\" ' + ((tag_obj['in'])? 'checked' : '') + '>' + \r\n                      '<input type=\"checkbox\" name=\"' + key_ci + '.ex\" ' + ((tag_obj['ex'])? 'checked' : '') + '>' +\r\n                        tag_obj.num +(pf_boards? '/'+Object.keys(this.tags[key].mems_boards()).length:'')+': ' + key; // same in popup_filter\r\n                    tag_obj.pn = pn;\r\n                    if (docfrag) docfrag.appendChild(pn);\r\n                    else this.pn.insertBefore(pn, this.pn.childNodes[pos_insert] || null);\r\n                    if (--limit==0) this.update_pn_pos = [pos_insert+1,i+1];\r\n                  }\r\n                  pos_insert++;\r\n                }\r\n              } else if (pn) pos_insert++;\r\n            }\r\n          } else tags_array.splice(i--,1); // for deleted tags, they weren't removed in 'delete_tags'.\r\n          if ((dirty_count<=0 || dirty && --dirty_count<=0) && (!historical_filter_active || limit<=0)) break;\r\n        }\r\n        if (limit<=0 && this.update_pn_pos[1]<tags_array.length) this.update_pn_1_lazy.delayed_do(pref.liveTag.lazy_delay);\r\n        else this.update_pn_pos = null;\r\n        if (docfrag) this.pn.appendChild(docfrag);\r\n        this.pn_summary.textContent = (rexps)? pos_insert+'/'+tags_array.length : '';\r\n      }\r\n\r\n//      var historical_filter_active = pref.catalog.filter.tag_search.rexps.length!=0 || this.update_pn_last_filter_active; // working code.\r\n//      if (historical_filter_active || dirty_count_deleted) {\r\n//        if (pref.debug_mode['34']) {console.time('update_pn');console.time('update_pn2');}\r\n//        var docfrag = (pref.catalog.filter.tag_search.rexps.length!==0 && this.pn.firstChild)? null : (pref.test_mode['74'])? this.pn.cloneNode() : document.createDocumentFragment();\r\n//        var pos_insert=0;\r\n//        for (var i=0;i<tags_array.length;i++) {\r\n//          var key = tags_array[i].key;\r\n//          var key_ci = (pref.liveTag.ci)? key.toLowerCase() : key;\r\n//          var dirty = (key_ci in this.key_dirty);\r\n//          var tag_obj = this.tags_ci[key_ci];\r\n//          if (tag_obj) {\r\n//            var pn = tag_obj.pn;\r\n//            if (from_filter || dirty) {\r\n//              var disp = this.update_pn_disp_func(pref.catalog.filter.tag_search.rexps, key_ci);\r\n//              if (pn!==null) {\r\n//                if (disp===0) { // for passive virtual boarding.\r\n// //            if (tags_array[i].num===0 || tags_array[i].disp===0) {\r\n//                  this.pn.removeChild(pn);\r\n//                  tag_obj.pn = null;\r\n//                } else {\r\n//                  if (dirty) tag_obj.pn.childNodes[3].textContent = tag_obj.num + ': ' + key;\r\n//                  if (this.pn.childNodes[pos_insert]!==pn) this.pn.insertBefore(pn, this.pn.childNodes[pos_insert] || null);\r\n//                  pos_insert++;\r\n//                }\r\n//              } else if (disp==1) { // for passive virtual boarding.\r\n//    //          } else if (tags_array[i].num!=0 && tags_array[i].disp==1) {\r\n//                pn = document.createElement('div');\r\n//                pn.setAttribute('name',key);\r\n////                pn = document.createElement('span');\r\n//                pn.innerHTML = ((pref.test_mode['101'])? '<span>P</span><span>I</span><span>E</span>'\r\n//                                : '<input type=\"checkbox\" name=\"' + key_ci + '.pk\" ' + ((tag_obj['pk'])? 'checked' : '') + '>' +\r\n//                                '<input type=\"checkbox\" name=\"' + key_ci + '.in\" ' + ((tag_obj['in'])? 'checked' : '') + '>' +\r\n//                                '<input type=\"checkbox\" name=\"' + key_ci + '.ex\" ' + ((tag_obj['ex'])? 'checked' : '') + '>') +\r\n//                  tag_obj.num + ': ' + key;\r\n////                               '<span name=\"' + key + '\">' + tag_obj.num + ': ' + key + '</span><br>';\r\n//                if (docfrag) docfrag.appendChild(pn);\r\n//                else this.pn.insertBefore(pn, this.pn.childNodes[pos_insert] || null);\r\n//                pos_insert++;\r\n////                this.pn.insertBefore(pn, this.pn.childNodes[pos_insert++] || null);\r\n//                tag_obj.pn = pn;\r\n//              }\r\n//            } else if (pn) pos_insert++;\r\n//          } else {\r\n//            tags_array.splice(i--,1); // for deleted tags, wasn't checked in 'delete_tags'.\r\n////            if (--dirty_count_deleted<=0 && !historical_filter_active) break; // redundant.\r\n//          }\r\n//          if (dirty && --dirty_count<=0 && !historical_filter_active) break;\r\n//        }\r\n//        if (pref.debug_mode['34']) console.timeEnd('update_pn');\r\n//        if (docfrag) { // no effect\r\n//          if (pref.test_mode['74']) { // no effect\r\n//            this.pn.parentNode.replaceChild(docfrag, this.pn);\r\n//            this.pn = docfrag;\r\n//          } else this.pn.appendChild(docfrag);\r\n//        }\r\n//        if (pref.debug_mode['34']) console.timeEnd('update_pn2');\r\n//        this.pn_summary.textContent = (pref.catalog.filter.tag_search.rexps.length!==0)? pos_insert+'/'+tags_array.length : '';\r\n//      }\r\n\r\n////      var j=0;\r\n//      var pos_insert=0; // working code.\r\n//      for (var i=0;i<tags_array.length;i++) {\r\n//        var key = tags_array[i].key;\r\n//        if (!this.tags[key]) {tags_array.splice(i--,1);continue;} // for deleted tags, didn't checked in 'delete_tags'.\r\n//        var num = tags_array[i].num;\r\n//        var num_old = this.tags[key].pn_num;\r\n//        if (num!==num_old || from_filter) {\r\n//          var str = num + ': ' + key;\r\n//          this.tags[key].pn_num = num;\r\n//          var pn = this.tags[key].pn;\r\n//          if (pn!==null) {\r\n//            if (tags_array[i].disp===0) { // for passive virtual boarding.\r\n////            if (tags_array[i].num===0 || tags_array[i].disp===0) {\r\n//              this.pn.removeChild(pn);\r\n//              this.tags[key].pn = null;\r\n//            } else {\r\n//              this.tags[key].pn.childNodes[3].textContent = str;\r\n////              if (this.tags_array_old[j] && key===this.tags_array_old[j].key) j++;\r\n////              else {\r\n//              if (this.pn.childNodes[pos_insert]!==pn) this.pn.insertBefore(pn, this.pn.childNodes[pos_insert] || null);\r\n//              pos_insert++;\r\n////                this.pn.insertBefore(pn, this.pn.childNodes[pos_insert++] || null);\r\n////                if (pref.debug_mode['3']) console.log('Insert: '+((num>num_old)?'promote: ':'demote: ')+key+', '+num_old+' -> '+num+', '+i+', '+j+', '+num_of_skip);\r\n////                if (num<num_old) num_of_skip--;\r\n////              }\r\n//            }\r\n//          } else if (tags_array[i].disp==1) { // for passive virtual boarding.\r\n////          } else if (tags_array[i].num!=0 && tags_array[i].disp==1) {\r\n//            pn = document.createElement('span');\r\n//            pn.innerHTML = '<input type=\"checkbox\" name=\"' + key + '.pk\" ' + ((this.tags[key]['pk'])? 'checked' : '') + '>' + \r\n//                           '<input type=\"checkbox\" name=\"' + key + '.in\" ' + ((this.tags[key]['in'])? 'checked' : '') + '>' + \r\n//                           '<input type=\"checkbox\" name=\"' + key + '.ex\" ' + ((this.tags[key]['ex'])? 'checked' : '') + '>' +\r\n//                           '<span name=\"' + key + '\">' + str + '</span><br>';\r\n//            pn.childNodes[0].onchange = this.cbx_onchange_entry;\r\n//            pn.childNodes[1].onchange = this.cbx_onchange_entry;\r\n//            pn.childNodes[2].onchange = this.cbx_onchange_entry;\r\n////            pn.childNodes[0].onmouseover = this.tooltip;\r\n////            pn.childNodes[1].onmouseover = this.tooltip;\r\n////            pn.childNodes[2].onmouseover = this.tooltip;\r\n////            pn.childNodes[3].onmouseover = this.tooltip;\r\n////            pn.style = {};\r\n////            pn.style.display = (this.pn_filter_rexp===null || this.pn_filter_rexp.test(key))? '' : 'none';\r\n//            this.pn.insertBefore(pn, this.pn.childNodes[pos_insert++] || null);\r\n//            this.tags[key].pn = pn;\r\n////            for (var j in this.tags[key].tgts) this.tags[j].pn = pn;  // PATCHES CAN BE REMOVED\r\n//          }\r\n//        } else if (tags_array[i].disp==1) pos_insert++;\r\n//////        } else { // tracking // working code.\r\n//////          while (j<this.tags_array_old.length && key!==this.tags_array_old[j].key) {\r\n//////            if (this.tags[this.tags_array_old[j].key] && this.tags[this.tags_array_old[j].key].pn_num==this.tags_array_old[j].num) num_of_skip++; // removed(to be 0) while waiting or not processed yet(demote)\r\n////////            if (pref.debug_mode['3']) {\r\n////////              var debug_str = this.tags_array_old[j].key+', '+this.tags_array_old[j].num+', '+num_of_skip;\r\n////////              if (this.tags[this.tags_array_old[j].key]===undefined) console.log('Removed: '+debug_str);\r\n////////              else if (this.tags[this.tags_array_old[j].key].pn_num==this.tags_array_old[j].num) console.log('Skip: '+debug_str);\r\n////////            }\r\n//////            j++;\r\n//////          }\r\n//////          j++;\r\n//////        }\r\n//      }\r\n      this.tags_array_old = tags_array;\r\n      this.key_dirty = Object.create(null);\r\n//      this.key_dirty_creation = Object.create(Object.create(null));\r\n//      this.key_dirty = Object.create(this.key_dirty_creation);\r\n\r\n//      if (pref.debug_mode['3']) { // CHECKER, working code.\r\n//        var flag = true;\r\n//        var dom = [];\r\n//        for (var i=0;i<tags_array.length;i++) {\r\n//          if (tags_array[i].num==0) break;\r\n//          var tgt = this.pn.childNodes[i].childNodes[3].textContent;\r\n//          var key = tgt.replace(/[^:]+: /,'');\r\n//          dom[dom.length] = key;\r\n//          if (tags_array[i].key!==key) {\r\n//            var j=0;\r\n//            while (j<tags_array.length && tags_array[j].key!==key) j++;\r\n//            if (j==tags_array.length) j=-1;\r\n//            var k=0;\r\n//            while (k<this.tags_array_old.length && this.tags_array_old[k].key!==key) k++;\r\n//            if (k==this.tags_array_old.length) k=-1;\r\n//            console.log('ERROR: '+tgt+', should be '+j+', but '+i+', '+k+' in old');\r\n//            flag = false;\r\n//          }\r\n//        }\r\n//        if (!flag) {\r\n//          console.log(tags_array);\r\n//          console.log(dom);\r\n//          console.log(this.tags_array_old);\r\n//        }\r\n//      }\r\n\r\n//      this.pn.innerHTML = '';\r\n//      for (var i=0;i<tags_array.length;i++) if (tags_array[i].num!=0) {\r\n//        var item = document.createElement('span');\r\n//        var key = tags_array[i].key;\r\n//        var str  = tags_array[i].num + ': ' + key;\r\n//        item.innerHTML = '<input type=\"checkbox\" name=\"' + key + '.pk\" ' + ((this.tags[key].pk)? 'checked' : '') + '>' +\r\n//                         '<input type=\"checkbox\" name=\"' + key + '.in\" ' + ((this.tags[key].in)? 'checked' : '') + '>' +\r\n//                         '<input type=\"checkbox\" name=\"' + key + '.ex\" ' + ((this.tags[key].ex)? 'checked' : '') + '>' +\r\n//                         '<span name=\"' + key + '\">' +  str + '</span><br>';\r\n//        item.childNodes[0].onchange = this.cbx_onchange_entry;\r\n//        item.childNodes[1].onchange = this.cbx_onchange_entry;\r\n//        item.childNodes[2].onchange = this.cbx_onchange_entry;\r\n//        item.childNodes[3].onmouseover = pref_func.tooltips.show;\r\n//        this.pn.appendChild(item);\r\n//      }\r\n      if (pref.virtualBoard.show && !from_filter) this.update_boardlist();\r\n      this.update_pn_last_filter_active = rexps;\r\n    },\r\n    popup_filter: (function(){\r\n      var oninput_funcs = {\r\n        'catalog.filter.tag_search.str': function(){liveTag.filter_onchange(pref.catalog.filter.tag_search);},\r\n        __proto__: pref_func.settings.oninput_funcs.__proto__\r\n      };\r\n      var onchange_funcs = {\r\n        'catalog.filter.tag_search.re': oninput_funcs['catalog.filter.tag_search.str'],\r\n        'catalog.filter.tag_search.show_nof_boards': function(){\r\n          var pf_boards = pref.catalog.filter.tag_search.show_nof_boards;\r\n          for (var i=0;i<liveTag.tags_array_old.length;i++) {\r\n            var key = liveTag.tags_array_old[i].key;\r\n            var tag_obj = liveTag.tags[key];\r\n            if (tag_obj && tag_obj.pn) tag_obj.pn.childNodes[3].textContent = tag_obj.num +(pf_boards? '/'+Object.keys(liveTag.tags[key].mems_boards()).length:'')+': ' + key; // same in update_pn_1\r\n          }\r\n        },\r\n        __proto__: oninput_funcs\r\n      };\r\n      return {\r\n        html:\r\n          '<div style=\"float:left\">'+\r\n            '<input type=\"checkbox\" name=\"catalog.filter.tag\"> Tag :'+\r\n          '</div>'+\r\n          '<div style=\"float:left\">'+\r\n            '<div>'+\r\n              ' Fetcn / In / Out / Threads / Tag '+\r\n              '<ITBL25\"catalog.filter.tag_search.str\" placeholder=\"Search tags...\">'+\r\n  //            ' <ICBX\"catalog.filter.tag_search.ci\">CI'+\r\n              ' <ICBX\"catalog.filter.tag_search.re\">RE'+\r\n            '</div>'+\r\n            '<div><span></span>'+pref_func.settings.html_funcs.rollup(\r\n              '<IC\"catalog.filter.tag_search.show_nof_boards\">Show number of boards<br>'+\r\n              '<BTN\"tagB.shown_t_pk,T\"><BTN\"tagB.shown_t_in,T\"><BTN\"tagB.shown_t_ex,T\"> Toggle checkboxes of shown tags<br>'+ // span for not being wrapped by label.\r\n              '<BTN\"tagB.shown_c_pk,C\"><BTN\"tagB.shown_c_in,C\"><BTN\"tagB.shown_c_ex,C\"> Clear checkboxes of shown tags<br>'+\r\n              '<BTN\"tagB.all_c_pk,C\"><BTN\"tagB.all_c_in,C\"><BTN\"tagB.all_c_ex,C\"> Clear checkboxes of all tags')+'<br></div>'+\r\n            '<div style=\"overflow:auto;resize:both;float:left\" name=\"catalog.filter.tag_list\"></div>'+\r\n            pref_func.settings.html_funcs.rollup('<div style=\"clear:both\">'+\r\n              '<BTN\"tag2bList,Add\"> selected tags to the last of board group<br>'+\r\n              '1,Label: <ITBL20\"catalog.filter.tag2bList.label\" placeholder=\"default: topmost tag\"><br>'+\r\n              '1,<IR\"catalog.filter.tag2bList.by,tag\">By tag<br>'+\r\n              '1,<IR\"catalog.filter.tag2bList.by,board\">By board<br>'+\r\n            '</div>')+\r\n  //          '<a name=\"SHOW\" style=\"cursor:pointer\" data-str=\"[\\u25b2]\">[\\u25bc]</a>'+\r\n  //          '<div name=\"SUB\" style=\"clear:both;display:none\">TEST</div>'+\r\n          '</div>'+\r\n          '<div style=\"clear:both\"></div>', // for floating\r\n        oninput_funcs: oninput_funcs,\r\n        onchange_funcs: onchange_funcs,\r\n        popup: function(){\r\n          if (liveTag.pn) return;\r\n          var exit_func = function(){\r\n            pref_func.tooltips.remove_root(popup.pn);\r\n            liveTag.pn = null;\r\n            cnst.div_destroy(popup.pn, true);\r\n          };\r\n          var popup = cnst.init3({func_str:'top:0px:left:0px:Show:tb', exit:exit_func});\r\n          popup.cn.innerHTML = pref_func.format_html_str(liveTag.popup_filter.html);\r\n          pref_func.add_onchange(popup.cn,onchange_funcs, oninput_funcs);\r\n          pref_func.apply_prep(popup.pn, false);\r\n          pref_func.tooltips.add_root(popup.pn);\r\n          liveTag.update_pn(true);\r\n        },\r\n      };\r\n    })(),\r\n    cbx_all_onchange: function(e){\r\n      var et = e.target;\r\n      var clear = et.name.substr(-4,1)==='c';\r\n      var prop = et.name.substr(-2,2);\r\n      var all = et.name.substr(-8,3)==='all';\r\n      var tgts_all = null;\r\n      for (var tag_ci in liveTag.tags_ci) {\r\n        var obj = liveTag.tags_ci[tag_ci];\r\n        if (all || obj.pn) if (!clear || obj[prop]) {\r\n          liveTag.cbx_emulate_inv(tag_ci, prop, true);\r\n          liveTag.update_tag_node(tag_ci);\r\n          if (prop==='pk' && obj[prop]) {\r\n            var tgts = liveTag.tags_ci[tag_ci].mems_boards();\r\n            if (!tgts_all) tgts_all = tgts;\r\n            else for (var b in tgts) tgts_all[b] = tgts[b];\r\n          }\r\n        }\r\n      }\r\n      if (tgts_all && Object.keys(tgts_all).length!=0) scan.scan_ui('refresh_tag', {tgts: tgts_all, options:{callback:function(){scan.scan('t');}, priority:6}});\r\n      if (cataLog.catalog_filter_changed) cataLog.catalog_filter_changed();\r\n    },\r\n    cbx_emulate_inv: function(tag, prop, no_scan){\r\n      var obj = this.tags[tag];\r\n      var val = !obj[prop];\r\n      obj[prop] = val;\r\n      if (obj.pn!==null) obj.pn.childNodes[prop==='pk'? 0 : prop==='in'? 1 : 2].checked = val;\r\n      this.cbx_onchange(tag, prop, val, no_scan);\r\n    },\r\n////    cbx_onchange_entry : function(e){liveTag.cbx_onchange(this, e, true);},\r\n////    cbx_onchange : function(sender, e, from_cbx){ // working code.\r\n////      var prop = sender.name.substr(-2,2);\r\n//////      var val = e.target.checked;\r\n////      var val = sender.checked;\r\n////      var tag = sender.name.substr(0,sender.name.length-3);\r\n    cbx_onchange_entry: function(e){\r\n      var et = e.target;\r\n      var tag = et.name.slice(0,-3);\r\n      var prop = et.name.substr(-2,2);\r\n      liveTag.tags[tag][prop] = et.checked;\r\n      liveTag.cbx_onchange(tag, prop, liveTag.tags[tag][prop]);\r\n      if (cataLog.catalog_filter_changed) cataLog.catalog_filter_changed();\r\n      liveTag.update_tag_node(tag);\r\n    },\r\n    cbx_onchange : function(tag, prop, val, no_scan){\r\n      this.active[prop] += (val)? 1 : -1;\r\n      if (prop==='pk') {\r\n        if (val && !this.tags[tag]['in']) this.cbx_emulate_inv(tag, 'in');\r\n//        if (val && !this.tags[tag]['in']) {\r\n//          this.tags[tag]['in'] = true;\r\n//          this.active['in'] += 1;\r\n//          if (this.tags[tag].pn!==null) this.tags[tag].pn.childNodes[1].checked = true;\r\n////          this.update_pn_buf.delayed_do();\r\n//        }\r\n//        var tgts = {};\r\n////        var now = Date.now();\r\n////        var prev = now - pref.liveTag.pickup_interval*1000;\r\n////        for (var i in this.tags)\r\n////          if (this.tags[i]['pk'] && (this.tags[i]['pk']==='true' || this.tags[i]['pk']<prev)) {\r\n////            this.tags[i]['pk']=now;\r\n////            for (var j in this.tags[i].mems) tgts[j.substr(0,j.lastIndexOf('/')+1)]=null;\r\n////          }\r\n////        if (val) for (var i in this.tags[tag].tgts) for (var j in this.tags[i].mems) tgts[j.substr(0,j.lastIndexOf('/')+1)]=null; // working code.\r\n////        if (val) for (var j in this.tags[tag].mems) tgts[j.substr(0,j.lastIndexOf('/')+1)]=null;\r\n//        if (val) for (var j of this.tags[tag].mems.keys()) tgts[j.key.substr(0,j.key.lastIndexOf('/')+1)]=null; // working code.\r\n        if (val && !no_scan && catalog_obj && catalog_obj.catalog_func()!=null) {\r\n          var tgts = this.tags[tag].mems_boards();\r\n          if (Object.keys(tgts).length!=0) scan.scan_ui('refresh_tag', {tgts: tgts, options:{callback:function(){scan.scan('t');}, priority:6}});\r\n        }\r\n      }\r\n      if (prop==='in' || prop==='ex') {\r\n        if (this.active['in']+this.active['ex']===((val)? 1 : 0)) {\r\n//        if (this.active['in']===((val)? 1 : 0)) {\r\n          pref.catalog.filter.tag = val; // may toggle twice if func==='inex', but leave this because func==='inex' isn't used so much.\r\n          if (pref_func.mirror_targets.pn12_0_4)\r\n            pref_func.apply_prep(pref_func.mirror_targets.pn12_0_4.getElementsByTagName('input')['catalog.filter.tag'],false);\r\n        }\r\n      }\r\n//      if (catalog_obj && catalog_obj.catalog_func()!=null) catalog_obj.catalog_func().catalog_filter_changed();\r\n    },\r\n    add_tags_to_boardlist: function(){\r\n      var tags = liveTag.tags_array_old;\r\n      var label = pref.catalog.filter.tag2bList.label || (tags.filter(function(v){return v.in;})[0] || tags.filter(function(v){return v.pk;})[0] || tags.filter(function(v){return v.ex;})[0]).key;\r\n      var str_ary;\r\n      if (pref.catalog.filter.tag2bList.by==='tag') str_ary = [\r\n        tags.filter(function(v){return v.in;}).map(function(v){return v.key;}).join(','),\r\n        tags.filter(function(v){return v.pk;}).map(function(v){return '#'+v.key;}).join(','),\r\n        tags.filter(function(v){return v.ex;}).map(function(v){return '!'+v.key;}).join(',')];\r\n      else {\r\n        var obj_in = tags.filter(function(v){return v.in;}).map(function(v){return v.mems_boards();});\r\n        var obj_pk = tags.filter(function(v){return v.pk;}).map(function(v){return v.mems_boards();});\r\n        var obj_ex = tags.filter(function(v){return v.ex;}).map(function(v){return v.mems_boards();});\r\n        var obj = {};\r\n        for (var i=0;i<obj_in.length;i++) for (var j in obj_in[i]) obj[j] = null;\r\n        for (var i=0;i<obj_pk.length;i++) for (var j in obj_pk[i]) obj[j] = null;\r\n        for (var i=0;i<obj_ex.length;i++) for (var j in obj_ex[i]) delete obj[j];\r\n        str_ary = Object.keys(obj);\r\n      }\r\n      pref_func.settings.onchange_funcs['tag.add_to_list'](label +' ,'+ str_ary.filter(function(v){return v;}).join(','));\r\n    },\r\n    search_by_tags : function(lth){\r\n      var retval = !this.active.in;\r\n      var tags = lth.tags; // all tags in an array\r\n      if (this.active.in)           for (var i=0;i<tags.length;i++) if ((tags[i] in this.tags) && this.tags[tags[i]]['in']) {retval = true; break;}\r\n      if (retval && this.active.ex) for (var i=0;i<tags.length;i++) if ((tags[i] in this.tags) && this.tags[tags[i]]['ex']) {retval = false; break;}\r\n      return retval;\r\n    },\r\n//    search_by_tags : function(tags){ // working code.\r\n//      var retval = !this.active.in;\r\n//      if (this.active.in)           for (var j=0;j<2;j++) if (tags[j]) for (var i=0;i<tags[j].length;i++) if ((tags[j][i] in this.tags) && this.tags[tags[j][i]]['in']) {retval = true; break;}\r\n//      if (retval && this.active.ex) for (var j=0;j<2;j++) if (tags[j]) for (var i=0;i<tags[j].length;i++) if ((tags[j][i] in this.tags) && this.tags[tags[j][i]]['ex']) {retval = false; break;}\r\n//      return retval;\r\n//    },\r\n    keys_fix: null, // to reduce memory consumption. THIS IS USED GLOBALLY.\r\n    prep_tags: function(th, retag){ // prepare tag holder and extract tags in op.\r\n//      if (this.mems[th.domain] && this.mems[th.domain][th.board] && this.mems[th.domain][th.board][th.no]) return this.mems[th.domain][th.board][th.no];\r\n//      else {\r\n      var lth = this.mems.init(th);\r\n      var watch = lth.wt;\r\n      if ((watch[0]&0x00010000) && (pref.liveTag.watch_all && th.time_created) ||\r\n          (watch[0]&0x00840000)===0x00800000 && (th.time_created>0||th.time_posted>0)) // for meguca or those don't have time at first.\r\n        cataLog.set_watch_time_thread(th.key, cataLog.embed_mode, th.time_created, th.time_posted, th, watch);\r\n      if ((watch[0]&0x00010000) || retag) {\r\n        if (watch[0]&0x00010000) {\r\n          if (!pref.test_mode['64'] && pref[cataLog.embed_mode].deleted_posts.merge) archiver.prep_deleted_posts(th,lth);\r\n          if (!pref.test_mode['67']) archiver.check_op(th, lth);\r\n//          if (pref.liveTag.watch_all && th.time_created) cataLog.set_watch_time_thread(th.key, cataLog.embed_mode, th.time_created, th.time_posted, th, watch);\r\n          watch[0] = (watch[0]&0xfffe0000);\r\n        }\r\n//        if (pref.liveTag.watch_all && th.time_created) { // working code.\r\n//          var time_watch = catalog_obj.catalog_func().get_watch_time_of_a_thread(th.key, th.time_created, th.time_posted || th.time_bumped, true);\r\n//          if (time_watch) site2[th.domain].check_reply.set_watch_time(watch, time_watch);\r\n//        }\r\n////        if (tag[2][0]===-1) tag[2][0]=1; // patch. This may be redundant.\r\n//        if (tag[2][0]&0x00010000) tag[2][0] &= 0xfffe0000; // there is a path which doesn't throuth 'check_reply'. // redundant, do it in 'check_reply.check_t1_op'\r\n////        if (watch[0]!==0) tag[2][2]=1; // PATCH with BUG, if op contains replies to me, this way can't find it until the thread gets new replies.\r\n        var pf = pref.liveTag;\r\n        var tags = [[],[]]; // first time only.\r\n        if (pref.liveTag.inherit_board_name) { // working code.\r\n          var idx0 = (pref.liveTag.lock_board_name)? 0 : 1;\r\n          tags[idx0][0] = lth.btag; // '#'+th.board.replace(/\\//g,'');\r\n        }\r\n        if (pref.liveTag.inherit_board_tags && lth.btag2) {\r\n          var idx1 = (pref.liveTag.lock_board_tags)? 0 : 1;\r\n          tags[idx1] = tags[idx1].concat(lth.btag2);\r\n        }\r\n        var tags_op = site2[th.domain].check_reply.check_t1_op(th); // extracting tags in op is redundant when tags are NOT locked, but locked extracting is only here, so this can't be removed.\r\n        if (tags_op.length!=0) {\r\n          var idx2 = (pref.liveTag.lock_tags_in_op)? 0 : 1;\r\n          tags[idx2] = tags[idx2].concat(tags_op);\r\n//          tags[idx2] = tags_op.concat(tags[idx2]);\r\n        }\r\n        this.exclude_tags(th, tags[0], tags[1]);\r\n//        if (tags_old) for (var i=0;i<2;i++) if (tags_old[i]) tags[i] = tags[i].concat(tags_old[i]);\r\n        if (th.parse_funcs.has_editing && th.posts[0].editing && tags[0].length!=0) tags[0] = this.extract_tags_trim_editing(th, lth, tags[0]);\r\n        if (tags[0].length!=0) lth.t0 = this.update_tags_in_th(tags[0], null, {}, (tags[0].length < pref.liveTag.max)? tags[0].length : pref.liveTag.max, th, watch, this.mems[th.domain][th.board]); // update this.keys_fix\r\n        if (tags[1].length!=0) this.extract_tags(th, tags[1], this.keys_fix);\r\n        else {\r\n          if (lth.t1!==null) lth.t1 = null;\r\n          this.update_pn_buf.delayed_do();\r\n        }\r\n      }\r\n      return lth;\r\n    },\r\n    update_tags_in_editing_posts: function(th, lth, ed_f){ // called only when th.parse_funcs.has_editing === true.\r\n      var posts_obj = th.parse_funcs.posts_obj(th,lth.ed_t[lth.ed_t.length-1].no);\r\n      var flag_added = false;\r\n      for (var i=lth.ed_t.length-1;i>=0;i--) if (typeof(lth.ed_t[i])!=='string') {\r\n        var post = posts_obj[lth.ed_t[i].no];\r\n        if (post && !post.editing) {\r\n          if (pref.liveTag.from==='post' || post.no==th.no) {\r\n            site2[th.domain].wrap_to_parse.posts({posts:[post], __proto__:th});\r\n            var extracted_tags = site2[th.domain].check_reply.check_t1_op(post);\r\n            if (extracted_tags.length!=0) flag_added = true;\r\n            lth.ed_t = lth.ed_t.slice(0,i).concat(extracted_tags).concat(lth.ed_t.slice(i+1));\r\n          } else lth.ed_t.splice(i,1);\r\n          ed_f[ed_f.length] = post;\r\n        }\r\n      }\r\n      if (ed_f.length==0) return undefined;\r\n      if (pref.debug_mode['24']) console.log(th.key+': retag_req: '+extracted_tags+', '+flag_added+', '+(lth.ed_t && lth.ed_t.map(function(v){return (typeof(v)==='string')? v : v.no+'('+v.time+')';})));\r\n      if (lth.ed_t.length==0) {\r\n        lth.ed_t = null;\r\n        return undefined;\r\n      }\r\n      return (flag_added)? this.extract_tags(th, lth.ed_t, null, null, true) : // has extracted_tags always.\r\n        (extracted_tags)? this.extract_tags_trim_editing(th, lth, lth.ed_t, true) && undefined : // return undefined for not update intentionally.\r\n        undefined;\r\n    },\r\n    extract_tags_trim_editing: function(th, lth, extracted_tags, retag_editing){\r\n      var ex_tags_keep = null;\r\n      for (var i=extracted_tags.length-1;i>=0;i--) if (typeof(extracted_tags[i])!=='string') { // tags are reverse ordered.\r\n        if (!ex_tags_keep) ex_tags_keep = extracted_tags.slice(0,i+1);\r\n        extracted_tags.splice(i,1);\r\n      }\r\n      if (ex_tags_keep || retag_editing) {\r\n        lth.ed_t = (retag_editing || !lth.ed_t)? ex_tags_keep : ex_tags_keep.concat(lth.ed_t); // reverse order\r\n        if (pref.debug_mode['24']) console.log(th.key+ ': lth.ed_t: '+ (lth.ed_t && lth.ed_t.map(function(v){return (typeof(v)==='string')? v : v.no+'('+v.time+')';})));\r\n      }\r\n      return extracted_tags;\r\n    },\r\n    extract_tags: function(th, extracted_tags, keys_fix, clean, retag_editing){\r\n      var lth = this.mems[th.domain][th.board][th.no];\r\n      if (th.parse_funcs.has_editing) extracted_tags = this.extract_tags_trim_editing(th, lth, extracted_tags, retag_editing);\r\n      if (!keys_fix) {\r\n        this.keys_fix = {};\r\n        var t0 = lth.t0; // runs getter 1 times only.\r\n        if (t0!==null && t0.length!=0) {\r\n          if (pref.liveTag.ci) for (var i=0;i<t0.length;i++) this.keys_fix[t0[i].toLowerCase()] = t0[i];\r\n          else for (var i=0;i<t0.length;i++) this.keys_fix[t0[i]] = t0[i];\r\n        }\r\n      }\r\n      var t0len = t0!==undefined? t0.length : lth.t0.length;\r\n      var t1 = this.update_tags_in_th(extracted_tags, lth.t1, this.keys_fix, pref.liveTag.max-t0len, th, lth.wt, this.mems[th.domain][th.board], clean);\r\n      if (t1.length!=0 || (lth.t1 && lth.t1.length!==0)) lth.t1 = t1;\r\n      this.update_pn_buf.delayed_do();\r\n      this.keys_fix = null;\r\n//      else if (ur>=0) {\r\n//        for (var j=0;j<2;j++) {\r\n//          var tgt = tag[j];\r\n//          for (var i=0;i<tgt.length;i++) this.check_update_tags_color(tgt[i],ur);\r\n//        }\r\n//      }\r\n      return lth;\r\n    },\r\n    tags_boardlist: null,\r\n    update_boardlist: function(force_redraw){\r\n////      if (!site3[site.nickname].bds && site3[site.nickname].boards) { // working code.\r\n//////        site3[site.nickname].bds = {};\r\n////        for (var i=0;i<site3[site.nickname].boards.length;i++) site3[site.nickname].bds['/'+site3[site.nickname].boards[i].board+'/'] = null;\r\n////      }\r\n//      if (site.components.boardlist && site3[site.nickname].bds) {\r\n      if (site.components.boardlist) {\r\n        if (this.tags_boardlist===null) {\r\n          this.tags_boardlist = [];\r\n          pref_func.settings.onchange_funcs['virtualBoard.search.show'](null, true);\r\n          this.filter_onchange(pref.virtualBoard.search, true);\r\n        }\r\n        var i=0;\r\n        var flag = force_redraw;\r\n        var p = 0;\r\n        var j=0;\r\n        var p_remove = pref.virtualBoard.p_board==='both' && pref.virtualBoard.p_remove;\r\n        var sv_rexps = pref.virtualBoard.search.show && pref.virtualBoard.search.rexps; // search valid and rexps\r\n        while (j<pref.virtualBoard.max && i<this.tags_array_old.length) {\r\n//        while (i<pref.virtualBoard.max+p && i<this.tags_array_old.length) {\r\n          var key = this.tags_array_old[i].key;\r\n          if (p_remove && (('/'+key.substr(1)+'/') in this.mems[site.nickname])) p++;\r\n          else if (!sv_rexps || this.update_pn_disp_func(sv_rexps, (pref.liveTag.ci)? key.toLowerCase() : key)) {\r\n            if (this.tags_boardlist[j]!==key) {\r\n              this.tags_boardlist[j] = key;\r\n              flag = true;\r\n            }\r\n            j++;\r\n          }\r\n          i++;\r\n        }\r\n        if (j!=this.tags_boardlist.length) {this.tags_boardlist.splice(j,this.tags_boardlist.length-j); flag=true;}\r\n        if (flag) site2[site.nickname].show_boardlist(this.tags_boardlist, this.boardlist_click_entry);\r\n      }\r\n    },\r\n////    update_boardlist_1: function(tag){ // working code, but too slow.\r\n////      var pn = this.update_tag_string([tag].concat(this.tags_boardlist), ' / ', this.boardlist_click_entry);\r\n////      site2[site.nickname].show_boardlist(pn);\r\n////    },\r\n//    update_boardlist_1: (function(){ // working code, but not used.\r\n//      var buf = [];\r\n//      var delayed_do = new DelayBuffer(\r\n//        function(){\r\n//          var tags = Object.create(null);\r\n//          for (var i=0;i<buf.length;i++) tags[liveTag.tags_ci[(pref.liveTag.ci)? buf[i].toLowerCase() : buf[i]].key] = null;\r\n////          var pn = liveTag.update_tag_string(Object.keys(tags).concat(liveTag.tags_boardlist), ' / ', liveTag.boardlist_click_entry); // slow in 8chan.\r\n//          site2[site.nickname].show_boardlist_physical_board(Object.keys(tags), liveTag.boardlist_click_entry);\r\n//          buf = [];\r\n//        }, 500).get_binded_delayed_do();\r\n//      return function(tag) {\r\n//        if (site.components.boardlist) {\r\n//          buf[buf.length] = tag;\r\n//          delayed_do();\r\n//        }\r\n//      };\r\n//    })(),\r\n\r\n//    refresh_end_proc: function(){\r\n//      for (var i in this.tags) if (this.tags[i].ur_cs===null) this.count_ur_sub(i);\r\n//      for (var i in this.tags_update_state) this.tags[i].ur = null;\r\n//      for (var i in this.tags_update_state) {\r\n//        if (this.tags[i].ur===null) this.count_ur(i);\r\n//        this.update_tag_node(i);\r\n//      }\r\n//      this.tags_update_state = Object.create(null);\r\n//    },\r\n    update_tag_node: function(tag, node_in_boardlist){\r\n      if (cataLog.threads!==null) {\r\n////if (!pref.test_mode['24']) {\r\n        var keys = liveTag.tags[tag].mems_keys_obj(); // runs getter only 1 time. // working code.\r\n        for (var name in keys) cataLog.Footer.color_tag_node(name,tag);\r\n//          if (cataLog.Footer) {\r\n//            var pn = cataLog.Footer.query_tag_node(name,tag);\r\n//            if (pn) this.color_tag_node(pn,tag);\r\n//          }\r\n////          if (cataLog.threads[name] && cataLog.threads[name][24] && cataLog.threads[name][24][3])\r\n////            this.update_tag_node_1(cataLog.threads[name][24][3],keys[name]);\r\n//////} else {\r\n//////        for (var i of this.tags[tag].mems_keys()) {\r\n//////          var name = i.key;\r\n//////          if (cataLog.threads[name] && cataLog.threads[name][24] && cataLog.threads[name][24][3])\r\n//////            this.update_tag_node_1(cataLog.threads[name][24][3].getElementsByClassName(pref.script_prefix+'_tag'), this.tags[tag].mems.get(i)); // can't get tag when i is derived from board.\r\n//////        }\r\n//////}\r\n      }\r\n      var tag_bl = this.tags_ci[(pref.liveTag.ci)? tag.toLowerCase() : tag].key;\r\n      var pn = node_in_boardlist || site2[site.nickname].query_tag_node(tag_bl);\r\n      if (pn) this.color_tag_node(pn, tag_bl);\r\n//      else if (this.tags_boardlist && this.tags_boardlist.indexOf(tag_bl)!=-1) this.update_tag_node_1(site.components.boardlist, tag_bl);\r\n    },\r\n//    update_tag_node: function(tag, node_in_boardlist){ // working code.\r\n//      if (catalog_obj && catalog_obj.catalog_func()!=null) {\r\n//        var threads = catalog_obj.catalog_func().threads;\r\n//        for (var t in liveTag.tags[tag].tgts) \r\n//          for (var name in liveTag.tags[t].mems) \r\n//            if (threads[name] && threads[name][24] && threads[name][24][3]) this.update_tag_node_1(threads[name][24][3].getElementsByClassName(pref.script_prefix+'_tag'),tag);\r\n//      }\r\n//      if (node_in_boardlist) this.color_tag_node(node_in_boardlist, tag);\r\n//      else if (this.tags_boardlist.indexOf(tag)!=-1) this.update_tag_node_1(site.components.boardlist.getElementsByClassName(pref.script_prefix+'_tag'), tag);\r\n//    },\r\n//    update_tag_node_1: function(ppn, tag){ // working code, but removed because of query\r\n//      var pns = ppn.getElementsByClassName(pref.script_prefix+'_tag');\r\n//      var tag_ci = tag.toLowerCase();\r\n//      for (var j=0;j<pns.length;j++) {\r\n//        var txt = pns[j].textContent;\r\n//        if (txt===tag || (pref.liveTag.ci && txt.toLowerCase()===tag_ci)) {\r\n//          this.color_tag_node(pns[j],tag);\r\n//          break;\r\n//        }\r\n//      }\r\n//    },\r\n    color_tag_node : function(node, tag){\r\n      var pf = pref.liveTag.style;\r\n      var tobj = this.tags[tag];\r\n      var ur = (!pf.use)? 0 : tobj.ur;\r\n      var style = (tobj['ex'])? (ur>=2? pf.exurtm : ur>=1? pf.exur : pf.ex)\r\n                : (tobj['in'])? (ur>=2? pf.inurtm : ur>=1? pf.inur : pf.in)\r\n                : ur>=2? pf.urtm : ur>=1? pf.ur : null;\r\n//      var style_str = (this.tags[tag]['ex'])? pref.liveTag.style_ex_str :\r\n//                      (this.tags[tag]['in'])? pref.liveTag.style_in_str :\r\n//                      (!pref.liveTag.style || this.tags[tag].ur<=0)? null :\r\n//                      (this.tags[tag].ur>=2)? pref.liveTag.style_urtm_str : pref.liveTag.style_ur_str;\r\n      if (style) node.setAttribute('style',style); // this can accept '!important'\r\n      else node.removeAttribute('style');\r\n    },\r\n//    color_tag_node : function(node, tag){\r\n//      if (this.tags[tag]['in']) common_func.init_set_style(node,pref.liveTag.style_in_obj4);\r\n//      else if (pref.liveTag.style) {\r\n//        if (this.tags[tag].ur>2) common_func.init_set_style(node,pref.liveTag.style_urtm_obj4);\r\n//        else if (this.tags[tag].ur>0) common_func.init_set_style(node,pref.liveTag.style_ur_obj4);\r\n//        else common_func.init_set_style(node,null);\r\n//      } else common_func.init_set_style(node,null);\r\n//    },\r\n    update_tag_nodes: function(tags, sep_txt, func_click, pn_old, tags_old){ // stateful fast approach\r\n      var tags_old_org = (pref.debug_mode['35'])? tags_old && tags_old.slice() : null;\r\n      var debug_refs = (tags_old_org)? [] : null;\r\n      var pn = pn_old || document.createElement('span');\r\n      var ref = pn.firstChild;\r\n      for (var j=0;j<tags.length;j++) {\r\n        var debug_before = tags_old && tags_old.slice();\r\n        if (tags_old_org) debug_refs.push(ref && ref.textContent || null);\r\n        var sep = null;\r\n        var tag = tags[j];\r\n        if (tags_old && tag==tags_old[j]) {\r\n          if (ref) ref = ref.nextSibling;\r\n          if (ref && j!=tags.length-1) ref = ref.nextSibling; // check j for shortening case\r\n          if (tags_old_org) debug_refs.push('same');\r\n        } else {\r\n          var idx = (tags_old)? tags_old.indexOf(tag, j) : -1;\r\n          if (idx==-1) { // new\r\n            pn.insertBefore(this.create_tag_node_1(tag, func_click, 'span'), ref);\r\n            sep = true;\r\n            if (tags_old) tags_old.splice(j,0,tag);\r\n            if (tags_old_org) debug_refs.push('new');\r\n          } else if (idx==j+1) { // down\r\n            var tgt = ref;\r\n            var sep2 = ref.nextSibling; // sep must exist, because this is a case of down.\r\n            ref = sep2.nextSibling;\r\n            var idx2 = tags.indexOf(tags_old[j], j+1);\r\n            var tag2 = tags_old.splice(j,1)[0];\r\n            if (idx2==-1) {\r\n              pn.removeChild(sep2);\r\n              pn.removeChild(tgt);\r\n              if (tags_old_org) debug_refs.push('remove');\r\n            } else {\r\n              var ref2 = pn.childNodes[(idx2+1)*2-1] || null;\r\n              pn.insertBefore(sep2, ref2); // reverse order\r\n              pn.insertBefore(tgt, ref2);\r\n              tags_old.splice(idx2,0,tag2);\r\n              if (tags_old_org) debug_refs.push('down');\r\n            }\r\n            ref = ref.nextSibling;\r\n            if (ref && j!=tags.length-1) ref = ref.nextSibling; // check j for shortening\r\n          } else { // up\r\n            var tgt = pn.childNodes[idx*2];\r\n            sep = tgt.previousSibling; // sep must exist, because this is a case of up.\r\n            pn.insertBefore(tgt,ref);\r\n            tags_old.splice(j,0,tags_old.splice(idx,1)[0]);\r\n            if (tags_old_org) debug_refs.push('up');\r\n          }\r\n        }\r\n        if (j!=tags.length-1 && (!ref || sep)) pn.insertBefore(sep!==true && sep || document.createTextNode(sep_txt), ref);\r\n        if (tags_old_org) {\r\n          if (tags_old && tags.slice(0,j+1).toString()!==tags_old.slice(0,j+1).toString())\r\n            console.log('ERROR: update_tag_nodes: arr: ', j, tags_old, tags, debug_before, tags_old_org, debug_refs);\r\n          if (tags_old && pn.textContent.indexOf(tags_old.slice(0,j+1).join(sep_txt))!=0)\r\n            console.log('ERROR: update_tag_nodes_1: ', j, pn.textContent, tags_old, debug_before, tags_old_org, debug_refs);\r\n        }\r\n      }\r\n      if (ref) {\r\n        while (ref.nextSibling) pn.removeChild(ref.nextSibling);\r\n        pn.removeChild(ref);\r\n      }\r\n      if (tags_old_org) if (pn.textContent!==this.create_tag_nodes(tags, sep_txt, func_click).textContent)\r\n          console.log('ERROR: update_tag_nodes: ', pn.textContent, tags, tags_old_org);\r\n      return pn;\r\n    },\r\n    create_tag_nodes: function(tags, sep, func_click){\r\n      var pn = document.createElement('span');\r\n//      pn.setAttribute('class',pref.script_prefix+'_tag');\r\n//      pn.setAttribute('name',pref.script_prefix+'_tag_parent');\r\n      for (var j=0;j<tags.length;j++) {\r\n        if (j!=0 && sep) pn.appendChild(document.createTextNode(sep));\r\n        pn.appendChild(this.create_tag_node_1(tags[j], func_click, 'span'));\r\n      }\r\n      return pn;\r\n    },\r\n    create_tag_node_1: function(tag, func_click, tagname){\r\n      var pn = document.createElement(tagname);\r\n      pn.setAttribute('class',pref.script_prefix+'_tag');\r\n      pn.textContent = tag;\r\n      this.color_tag_node(pn,tag);\r\n      pn.onclick = func_click;\r\n//      pn.onmouseover = this.tag_onmouseover;\r\n      return pn;\r\n    },\r\n    tag_node_onclick: function(e){\r\n      var tag = this.textContent;\r\n      liveTag.cbx_changed(tag, pref.liveTag.click_func, null, null, e.ctrlKey);\r\n    }\r\n\r\n//    extract_tags_in_posts : function(th, tags, name){\r\n//      tag[1] = this.update_tags_in_th(tags, tag[1][0], tag[0][1], pref.liveTag.max-tag[0][0].length, name);\r\n//      this.update_pn_buf.delayed_do();\r\n//    },\r\n  };\r\n//  liveTag.key_dirty = Object.create(liveTag.key_dirty_creation);\r\n//  liveTag.cbx_onchange_entry = liveTag.cbx_onchange_entry(liveTag);\r\n//  liveTag.update_pn_buf = new DelayBuffer(liveTag.update_pn.bind(liveTag), 500);\r\n  liveTag.update_pn_buf = new DelayBuffer(liveTag.update_pn.bind(liveTag), pref.liveTag.disp_delay);\r\n  liveTag.update_pn_1_lazy = new DelayBuffer(liveTag.update_pn_1.bind(liveTag, true), pref.liveTag.lazy_delay);\r\n  liveTag.tags_ci = Object.getPrototypeOf(liveTag.tags);\r\n  pref_func.site2_json(false,true,['liveTag']);\r\n//  thread_reader_init();\r\n\r\n////  function LiveTag(tags, mems){ // I want to use 'Tag', but this brings difficulty into search...\r\n////    this.tags = tags || Object.create(null); // tags : tags[TAG] = {key:, num;, mem:, pk:, in:, ex:};  // summary tree.\r\n////    this.mems = mems || Object.create(null); // mems : mems[DOMAIN_BOARD][TAG] = {'THREAD':null, ...}; // member tree.\r\n//////    Object.defineProperty(this, 'filter', {get: this.prep_filter_value, enumerable:true, configurable:true});\r\n////    this.pn = document.createElement('div');\r\n////    this.cbx_onchange_entry = (function(myself){function(){myself.cbx_onchange(this.name, this.checked);}})(this);\r\n////    this.footer_onclick_entry = (function(myself){function(){myself.footer_onclick(this.name);}})(this);\r\n////    this.active = null;\r\n////  }\r\n////  LiveTag.prototype = {\r\n////    cbx_onchange : function(name,checked){\r\n////      var name = this.name.split('.');\r\n////      this.tags[name[0]][name[1]] = checked;\r\n////      this.prep_search();\r\n//////      this.prep_filter_val();\r\n//////      Object.defineProperty(this, 'filter', {get: this.prep_filter_value, enumerable:true, configurable:true});\r\n////    },\r\n////    extract_tags_in_op : function(pn) {\r\n////      var tags = pn[brwsr.innerText].match(tags_scan_regex);\r\n////      var tags_uniq = Object.create(null);\r\n////      for (var i=tags.length-1;i>=0;i--) if (tags[i] in tags_uniq) tags.splice(i,1); else tags_uniq[tags[i]] = null; // uniq in Case Sensitive\r\n////      if (tags.length>pref.catalog.tag.max) return [];\r\n////      if (tags.length>pref.catalog.tag.ignore) tags.splice(0,tags.length-pref.catalog.tag.ignore);\r\n////      return tags;\r\n////    },\r\n////    update_tags : function(ths, partial){\r\n////      var tags_in_board = Object.create(null);\r\n////      for (var i=0;i<ths.length;i++) {\r\n////        for (var j=0;j<ths[i].tags.length;j++) {\r\n////          if (!tags_in_board[ths[i].tags[j]]) tags_in_board[ths[i].tags[j]] = Object.create(null);\r\n////          tags_in_board[ths[i].tags[j]][ths[i].no] = null;\r\n////        }\r\n////      }\r\n////      var db = ths[0].domain + ths[0].board;\r\n////      if (!this.mems[db]) this.mems[db] = Object.create(null);\r\n////      var mems_db = this.mems[db];\r\n////      var tags = this.tags;\r\n////      if (!partial) {\r\n////        for (var i in mems_db) {\r\n////          if (i in tags_in_board) {\r\n////            tags[i].num += Object.keys(tags_in_board[i]).length - Object.keys(mems_db[i]).length;\r\n////            mems_db[i] = tags_in_board[i];\r\n////            tags_in_board[i] = null;\r\n////          } else {\r\n////            tags[i].num -= Object.keys(mems_db[i]).length;\r\n////            delete tags[i].mem[db];\r\n////            if (tags[i].num==0 && !tags[i].pk && !tags[i].in && !tags[i].ex) delete tags[i];\r\n////            delete mems_db[i];\r\n////          }\r\n////        }\r\n////      } else {\r\n////        for (var i in tags_in_board) {\r\n////          if (in in mems_db) {\r\n////            old_len = Object.keys(mems_db[i]).length;\r\n////            for (var j in tags_in_board[i]) mems_db[i][j] = tags_in_board[i][j];\r\n////            tags[i].num += Object.keys(mems_db[i]).length - old_len;\r\n////            tags_in_board[i] = null;\r\n////          }\r\n////        }\r\n////      }\r\n////      for (var i in tags_in_board) {\r\n////        if (tags_in_board[i]!==null) { // i isn't in mems_db\r\n////          if (!(i in tags)) tags[i] = {key:i, num;0, mem:Object.create(null), pk:false, in:false, ex:false};\r\n////          tags[i].num += Object.keys(tags_in_board[i]).length;\r\n////          tags[i].mem[db] = null;\r\n////          mems_db[i] = tags_in_board[i];\r\n////        }\r\n////      }\r\n////    },\r\n////    update_pn : function(ci){\r\n////      var tags = this.tags;\r\n////      var tags_array = [];\r\n////      for (var i in tags) tags_array[tags_array.length] = tags[i];\r\n////      tags_array.sort(this.sort_func);\r\n////      if (ci) {\r\n////        var tags_ci = Object.create(null);\r\n////        for (var i=0;i<tags_array.length;i++) {\r\n////          var key = tags_array[i].key.toLowerCase();\r\n////          if (!(key in tags_ci)) tags_ci[key] = i;\r\n////          else {\r\n////            tags_array[tags_ci[key]].num += tags_array[i].num; // CAUSE OVERESTIMATION, BUT EXECUTION SPEED HAS MORE PRIORITY, THEREFORE LEAVE THIS.\r\n////            tags_array[tags_ci[key]].pk  |= tags_array[i].pk;\r\n////            tags_array[tags_ci[key]].in  |= tags_array[i].in;\r\n////            tags_array[tags_ci[key]].ex  |= tags_array[i].ex;\r\n////            tags_array.splice(i,1);\r\n////            i--;\r\n////          }\r\n////        }\r\n////        tags_array.sort(this.sort_func);\r\n////      }\r\n////      this.pn.innerHTML = '';\r\n////      for (var i=0;i<tags_array.length;i++) {\r\n////        var item = document.createElement('span');\r\n////        var str  = tags_array[i].num + ': ' + tags_array[i].key;\r\n////        item.innerHTML = '<input type=\"checkbox\" name=\"' + tags_array[i].key + '.pk\" ' + ((tags_array[i].pk)? 'checked' : '') + '>' + \r\n////                         '<input type=\"checkbox\" name=\"' + tags_array[i].key + '.in\" ' + ((tags_array[i].in)? 'checked' : '') + '>' + \r\n////                         '<input type=\"checkbox\" name=\"' + tags_array[i].key + '.ex\" ' + ((tags_array[i].ex)? 'checked' : '') + '>' + str + '<br>';\r\n////        item.childNodes[0].onchange = this.cbx_onchange_entry;\r\n////        item.childNodes[1].onchange = this.cbx_onchange_entry;\r\n////        item.childNodes[2].onchange = this.cbx_onchange_entry;\r\n////        this.pn.appendChild(item);\r\n////      }\r\n////    },\r\n////    prep_search : function(){\r\n////      var active = {pk:false, in:false, ex:false};\r\n////      var tags = this.tags;\r\n////      for (var i in tags) if (tags[i].pk) {active.pk = true; break;}\r\n////      for (var i in tags) if (tags[i].in) {active.in = true; break;}\r\n////      for (var i in tags) if (tags[i].ex) {active.ex = true; break;}\r\n////      this.active = active;\r\n////    }\r\n////    get_pick_up_mems : function(){\r\n////      var retval = {};\r\n////      if (this.active.pk) for (var i in tags) if (tags[i].pk) for (var j in tags[i].mem) retval[j] = null;\r\n////      return retval;\r\n////    },\r\n//////    prep_filter_value : function(){\r\n//////      var retval = {pk:Object.create(null), in:Object.create(null), ex:Object.create(null)};\r\n//////      for (var i in this.tags) {\r\n//////        if (this.tags[i].pk) retval.pk[i] = null;\r\n//////        if (this.tags[i].in) retval.in[i] = null;\r\n//////        if (this.tags[i].ex) retval.ex[i] = null;\r\n//////      }\r\n//////      Object.defineProperty(this, 'filter', {value: retval, writable:true, enumerable:true, configurable:true});\r\n//////    },\r\n////    prep_footer : function(tags){\r\n////      var ft = document.createElement('span');\r\n////      ft.setAttribute('style','cursor:pointer');\r\n////      for (var i=tags.length-1;i>=0;i--) {\r\n////        var tag_pn = document.createElement('span');\r\n////        tag_pn.innerHTML = tags[i] + ' ';\r\n////        tag_pn.onclick = this.footer_onclick_entry;\r\n////        ft.appendChild(tag_pn);\r\n////      }\r\n////      return ft;\r\n////    },\r\n////    footer_onclick : function(name) {\r\n////      var sel = pref.tag.footer_clicked;\r\n////      this.tags[name][sel] = !this.tags[name][sel];\r\n////      this.pn.getElementsByTagName('input')[name+'.'+sel] = this.tags[name][sel];\r\n////    },\r\n\r\n//  https://nolanlawson.com/2015/09/29/indexeddb-websql-localstorage-what-blocks-the-dom/    // IndexedDB IS TOO SLOW TO USE, Chrome47@2015.09.29\r\n//  http://stackoverflow.com/questions/28693674/indexeddb-slow-retrieval-issue               // IndexedDB IS TOO SLOW TO USE @2015.02\r\n//  http://stackoverflow.com/questions/10102571/indexeddb-very-slow-compared-to-websql-what-am-i-doing-wrong // IndexedDB IS TOO SLOW TO USE @2012.01.12\r\n//  https://dev.mozilla.jp/2012/07/why-no-filesystem-api-in-firefox/\r\n//  https://developer.mozilla.org/ja/docs/Web/API/IndexedDB_API/Browser_storage_limits_and_eviction_criteria#Storage_limits\r\n//  https://developer.mozilla.org/en-US/docs/Web/API/File_System_API/Introduction\r\n//  http://www.html5rocks.com/ja/tutorials/file/filesystem/\r\n  var IDB = (function(){\r\n    function IDBRequest_onerror(e){\r\n      console.log('IDB: ERROR: ',e);\r\n      indicator.report({err_str:'IDB_ERROR:'+e.target.error.name});\r\n      for (var key of db_info.keys()) console.log(db_info.get(key));\r\n      console.log('last_closed: ',last_closed);\r\n    }\r\n    function IDBRequest_onblocked(e){\r\n      if (pref.debug_mode['21']) console.log('IDB: BLOCKED: '+e.oldVersion+' -> '+e.newVersion);\r\n    }\r\n    function IDBTransaction_onabort(e){\r\n      console.log('IDBT: ABORT: '+e.target.error.name,e);\r\n      indicator.report({err_str:'IDBT_ABORT:'+e.target.error.name});\r\n      var tr = e.target;\r\n      var db = tr.db;\r\n//      if (tr.error.name==='TimeoutError') {\r\n//        var info = tr_info.get(tr);\r\n//        tr_info.delete(e.target);\r\n//        console.log(info);\r\n//        if (info && info.req) {\r\n//          add_req(reqs_re, db.name, info.req); // retry\r\n//          console.log('Requeued... '+db.name.replace(/^[^\\/]*/,'')+req.no+' '+req.kind);\r\n//        }\r\n//      }\r\n      // http://stackoverflow.com/questions/10477489/what-are-the-details-can-be-obtained-from-webkitstorageinfo-queryusageandquota\r\n//      if (window.webkitStorageInfo) window.webkitStorageInfo.queryUsageAndQuota(webkitStorageInfo.TEMPORARY, console.log.bind(console));\r\n      if (navigator.webkitTemporaryStorage) navigator.webkitTemporaryStorage.queryUsageAndQuota(console.log.bind(console));\r\n      IDBT_rereq(db, tr, 'IDBT_abort:'+tr.error.name);\r\n//      IDB_close(db, null, 'IDBT_abort:'+tr.error.name);\r\n    }\r\n    function IDBTransaction_onerror(e){\r\n      console.log('IDBT: ERROR: '+e.target.error.name,e);\r\n      indicator.report({err_str:'IDBT_ERROR:'+e.target.error.name});\r\n      var tr = e.target.transaction;\r\n      var db = e.target.db || e.target.transaction && e.target.transaction.db;\r\n      IDBT_rereq(db, tr, 'IDBT_onerror:'+tr.error.name);\r\n//      IDB_close(db, null, true);\r\n    }\r\n    function IDBRequest_onupgradeneeded(e){\r\n      e.target.onsuccess = null; // prevent from being called twice.\r\n      IDBRequest_onsuccess_open(e, true);\r\n    }\r\n    function IDBRequest_onsuccess_open(e, from_upgrade){\r\n      var db = e.target.result;\r\n      version[db.name] = db.version;\r\n      delete waiting_open[db.name+((from_upgrade)? 'vc' : 'rw')];\r\n//      var reqs = (from_upgrade)? reqs_vc[db.name] : reqs_rw[db.name];\r\n      var reqs = from_upgrade && reqs_vc[db.name] || reqs_rw[db.name];\r\n      if (pref.debug_mode['20']) {\r\n        var count = 1;\r\n        var debug_reqs = reqs && reqs.debug_query() || null;\r\n//        var debug_coms = reqs && reqs.ary.slice(0,10).map(function(v){return v.kind;});\r\n        console.log('IDB: opened: '+(db_info.size+1)+' '+db.name.replace(/^[^\\/]*/,'')+' v'+db.version+', '+(debug_reqs && debug_reqs.length)+' req(s), '+e.type+', '+(debug_reqs && debug_reqs.coms));\r\n      }\r\n//      if (db_info.has(db)) console.log('IDB: ERROR: the same db was returned.', db_info.get(db));\r\n      var info = {type:e.type, tr_count:1, reqs:reqs, pass:0, wdg:null, crawler:1, oss:{}, tr_info:new Map(), req_kinds:{}, coms:debug_reqs && debug_reqs.coms, done:0, done_put:0}; // tr_count.set(db, 1); // tr_count.set(db, (tr_count.get(db)||0)+1); // returns the same db sometimes.\r\n      db_info.set(db, info);\r\n      if (reqs) {\r\n        for (var i=0;i<db.objectStoreNames.length;i++) info.oss[db.objectStoreNames[i]] = null;\r\n        if (from_upgrade) {\r\n          var tr = e.target.transaction;\r\n          tr_inc(db);\r\n          tr_set(tr, function(){IDBRequest_close({target:{db:db}});});\r\n          if (db.version==1) { // patch for the first creation.\r\n            delete waiting_open[db.name+'rw']; // entried by 'rw' always.\r\n            pref4.archive.IDB_board_sel_options = null;\r\n            db.createObjectStore('Meta'); // dummy write\r\n            return req_end(db, from_upgrade);\r\n          }\r\n          var num_downgraded = 0;\r\n          while (true) {\r\n            indicator_update();\r\n            var req = reqs.shift();\r\n            info.pass++;\r\n            if (!req) break;\r\n            if (pref.debug_mode['20']) info.done++;\r\n            if (pref.debug_mode['22'] && req.kind!=='put') console.log('req_upgrade: '+req.no+', '+req.kind+', '+req.key+', '+reqs.debug_query().length);\r\n            info.req_kinds[req.kind] = null;\r\n            var contains = info.oss[req.no]===null;\r\n            if (req.kind==='put') {\r\n              if (!contains) {\r\n                make_1(db, req, IDBRequest_close);\r\n                info.oss[req.no] = null;\r\n                if (pref.debug_mode['22']) console.log('req_upgrade: '+req.no+', '+req.kind+', '+req.key+', '+reqs.debug_query().length);\r\n              } else {\r\n                add_req(reqs_rw, db.name, req); // downgrade\r\n                if (pref.debug_mode['22']) num_downgraded++;\r\n              }\r\n//              else put_1(db,req, IDBRequest_close);\r\n            } else if (req.kind==='delete_th') {\r\n              if (contains) delete_th_1(db, req, tr); // returns void, not a transaction.\r\n            }\r\n          }\r\n          if (pref.debug_mode['22'] && num_downgraded) console.log('req_upgrade: downgraded: '+num_downgraded);\r\n          req_end(db, from_upgrade);\r\n        } else {\r\n          var loop_func = function complete_func(){req_1(db,reqs,from_upgrade,complete_func);}\r\n          info.complete_func = loop_func;\r\n          req_1(db, reqs, from_upgrade, loop_func);\r\n//          while (info.crawler<pref.archive.IDB.nof_tr && !reqs.isEmpty) { // not sensitive when reqs are added after this.\r\n//            info.crawler++;\r\n//            req_1(db, reqs, from_upgrade, loop_func);\r\n//          }\r\n        }\r\n      } else req_end(db, from_upgrade);\r\n    }\r\n    function req_1(db, reqs, from_upgrade, complete_func){ // multi transaction can be accepted, but not debugged.\r\n      var info = db_info.get(db);\r\n      if (!info) return; // closed by watchdog\r\n      indicator_update();\r\n      var req = (waiting_open[db.name+'vc']!==undefined)? null : reqs.shift();\r\n      info.pass++;\r\n      if (req) {\r\n        if (pref.debug_mode['20']) info.done++;\r\n        if (pref.debug_mode['22'] && req.kind!=='put_m') console.log(db.name.replace(/^[^\\/]*/,'')+req.no+', '+req.kind+', '+req.key+', '+reqs.debug_query().length);\r\n        var contains = info.oss[req.no]===null;\r\n        if (req.kind==='get_all_m') {\r\n          var reqs_current = [];\r\n          var nos = {};\r\n          for (var i=0;i<req.reqs.length;i++) if (info.oss[req.reqs[i].no]===null) {\r\n            reqs_current[reqs_current.length] = req.reqs[i];\r\n            nos[req.reqs[i].no] = null;\r\n          }\r\n          if (reqs_current.length!==0) get_all(db,{nos:Object.keys(nos), reqs:reqs_current}, complete_func);\r\n          else complete_func();\r\n//        } else if (req.kind==='get_all') {\r\n//          if (contains) get_all(db,{nos:[req.no], reqs:[req]}, complete_func);\r\n//          else complete_func();\r\n        } else if (req.kind==='list_os') {\r\n          req.obj(site.nickname, db.name.substr(pref.script_prefix.length+1), Array.prototype.slice.call(db.objectStoreNames).filter(function(v){return v!=='Meta';}));\r\n          complete_func();\r\n        } else if (req.kind==='put_m') {\r\n          var reqs_current = [];\r\n          var nos = {};\r\n          for (var i=0;i<req.reqs.length;i++)\r\n            if (info.oss[req.reqs[i].no]!==null) add_req(reqs_vc, db.name, req.reqs[i]); // upgrade\r\n            else {\r\n              reqs_current[reqs_current.length] = req.reqs[i];\r\n              nos[req.reqs[i].no] = null;\r\n            }\r\n          if (pref.debug_mode['22']) console.log(db.name.replace(/^[^\\/]*/,'')+(reqs_current[0] && reqs_current[0].no || 'skipped')+'('+Object.keys(nos).length+')'+', '+req.kind+'('+reqs_current.length+'), '+req.key+', '+reqs.debug_query().length);\r\n          if (reqs_current.length>1) {\r\n            req.reqs = reqs_current;\r\n            req.nos = Object.keys(nos);\r\n            put_1(db,req, complete_func);\r\n          } else if (reqs_current.length==1) put_1(db,reqs_current[0], complete_func);\r\n          else complete_func();\r\n        } else if (req.kind==='put') {\r\n          if (!contains) {add_req(reqs_vc, db.name, req);complete_func();} // upgrade\r\n          else put_1(db,req, complete_func);\r\n//        } else if (req.kind==='put_if') {\r\n//          if (contains) put_1(db,req, complete_func);\r\n//          else complete_func();\r\n        } else if (req.kind==='delete') {\r\n          if (contains) delete_1(db,req, complete_func);\r\n          else complete_func();\r\n        } else if (req.kind==='clean_up' || req.kind==='clean_m') {\r\n          if (!times_pruned[db.name]) times_pruned[db.name] = {list:[], write:null};\r\n          var list = times_pruned[db.name].list;\r\n          var list_len_old = list.length;\r\n          var nos = {Meta:null, __proto__:req.obj};\r\n          for (var i=0;i<list.length;i++) nos[list[i].no] = null;\r\n          if (req.kind==='clean_up') {\r\n            var date = Date.now();\r\n            var names = db.objectStoreNames;\r\n            for (var i=0;i<names.length;i++) if (nos[names[i]]!==null) list[list.length] = {no:names[i], pruned_time:date};\r\n          } else {\r\n            for (var i=0;i<req.reqs.length;i++)\r\n              if (info.oss[req.reqs[i].no]===null) if (nos[req.reqs[i].no]!==null) list[list.length] = {no:req.reqs[i].no, pruned_time:req.reqs[i].obj};\r\n          }\r\n          if (times_pruned[db.name].write===null) {\r\n            times_pruned[db.name].write = false;\r\n            clean_up(db, req, complete_func);\r\n          } else clean_up_end_proc(db, null, complete_func, list.length!==list_len_old);\r\n//        } else if (req.kind==='check_clean') { // working code.\r\n//          if (!times_pruned[db.name]) times_pruned[db.name] = [];\r\n//          if (contains) times_pruned[db.name][times_pruned[db.name].length] = {no:req.no, pruned_time:req.obj};\r\n//          clean_up_end_proc(db, null, complete_func, contains);\r\n\r\n//          if (req.kind==='clean_up') { // working code.\r\n//            var tgts = [];\r\n//            for (var i=0;i<db.objectStoreNames.length;i++) if (req.obj[db.objectStoreNames[i]]!==null) tgts[tgts.length] = db.objectStoreNames[i];\r\n//            clean_up(db, {tgts:tgts, prune:(req.kind==='clean_up'), __proto__:req}, complete_func); // call 'clean_up_end_proc' in 'clean_up'.\r\n//          } else {\r\n//            check_cleaned[db.name][check_cleaned[db.name].length] = {no:req.no, pruned_time:req.obj};\r\n//            reqs[reqs.length] = {no:-1, key:'pruned_time', obj:check_cleaned[db.name], kind:'put'};\r\n//            clean_up_end_proc(db, null, complete_func);\r\n//          }\r\n////        } else if (req.kind==='clean_up') { // working code.\r\n////          check_cleaned[db.name] = Date.now();\r\n////          var tgts = [];\r\n////          for (var i=0;i<db.objectStoreNames.length;i++) if (req.obj[db.objectStoreNames[i]]!==null) tgts[tgts.length] = db.objectStoreNames[i];\r\n////          clean_up(db, {tgts:tgts, prune:true, __proto__:req}, complete_func);\r\n//////          for (var i=0;i<db.objectStoreNames.length;i++) if (req.obj[db.objectStoreNames[i]]!==null) clean_1(db, {no:db.objectStoreNames[i], prune:true, __proto__:req});\r\n////        } else if (req.kind==='check_clean') {\r\n////          var date = Date.now();\r\n////          if (date - (check_cleaned[db.name] || 0 ) > pref.archive.IDB.check_every * ((pref.test_mode['75'])? 60000 : 3600000)) {\r\n////            check_cleaned[db.name] = date;\r\n////            clean_up(db, {tgts:Array.prototype.slice.call(db.objectStoreNames), __proto__:req}, complete_func);\r\n////          } else complete_func();\r\n//////          for (var i=0;i<db.objectStoreNames.length;i++) clean_1(db, {no:db.objectStoreNames[i], __proto__:req});\r\n        } else complete_func();\r\n        if (info.crawler<pref.archive.IDB.nof_tr && !reqs.isEmpty) {\r\n          info.crawler++;\r\n          req_1(db, reqs, from_upgrade, complete_func);\r\n        }\r\n      } else if (--info.crawler===0) req_end(db, from_upgrade);\r\n    }\r\n    function req_end(db, from_upgrade){\r\n      IDBRequest_close({target:{db:db}});\r\n      var req_parent = from_upgrade && reqs_vc[db.name] && reqs_vc || reqs_rw;\r\n      if (req_parent[db.name] && req_parent[db.name].isEmpty) delete req_parent[db.name];\r\n//      delete (from_upgrade && reqs_vc[db.name] && reqs_vc || reqs_rw)[db.name]; // BUG, might be remade.\r\n      if (reqs_re[db.name]) reqs_re2rw(db.name);\r\n//      if ((!from_upgrade)? reqs_vc[db.name] : reqs_rw[db.name]) open_db(db.name, (!from_upgrade)? db.version+1 : undefined);\r\n//      if (req_parent===reqs_vc) {\r\n      if (from_upgrade) {\r\n        if (reqs_rw[db.name] && !reqs_rw[db.name].isEmpty) open_db(db.name);\r\n      } else if (reqs_vc[db.name] && !reqs_vc[db.name].isEmpty) open_db(db.name, true);\r\n      if (Object.keys(reqs_rw).length===0 && Object.keys(reqs_vc).length===0 && Object.keys(reqs_re).length===0) watchdog.stop();\r\n    }\r\n    function reqs_re2rw(db_name){\r\n      if (reqs_rw[db_name]) reqs_rw[db_name].push_all(reqs_re[db_name]);\r\n      else reqs_rw[db_name] = reqs_re[db_name];\r\n      delete reqs_re[db_name];\r\n    }\r\n\r\n    function delete_th_1(db,req, tr){\r\n//      tr_inc(db);\r\n      db.deleteObjectStore(req.no);\r\n//      tr_set(tr, (function(func_prev){\r\n//        return function(e){\r\n//          if (func_prev) func_prev(e);\r\n//          IDBRequest_close({target:{db:db}}); // cause ERROR, probably bug in browser, oncomplete is fired too early at createObjectStore and deleteObjectStore.\r\n//        }\r\n//      })(tr.oncomplete));\r\nif (pref.debug_mode['23']) console.log('IDB: delete_th: '+db.name+req.no+', '+db.objectStoreNames.length);\r\n    }\r\n    function make_1(db,req, complete_func){\r\n      tr_inc(db);\r\n      var tr = db.createObjectStore(req.no).transaction;\r\n      tr_set(tr, (function(func_prev){ // tr belongs to db, transaction.oncomplete is called ONE TIME, so cascade oncomplete funcs.\r\n        return function(e){\r\nif (!pref.test_mode['66']) {\r\n          put_1(db,req, complete_func);\r\n} else {\r\n          add_req(reqs_rw, db.name, req); // downgrade // DOESN'T WORK WHY???  // cause ERROR, probably bug in browser, oncomplete is fired too early at createObjectStore and deleteObjectStore.\r\n          complete_func({target:{db:db}});\r\n}\r\n          if (func_prev) func_prev(e);\r\n        }\r\n      })(tr.oncomplete));\r\n    }\r\n    function put_1(db,reqs_in, complete_func){\r\n      var reqs = reqs_in.reqs || [reqs_in];\r\n      try {\r\n        var IDBT = tr_set(db.transaction(reqs_in.nos || reqs_in.no, 'readwrite', reqs_in), complete_func, reqs_in, db);\r\n        for (var i=0;i<reqs.length;i++) {\r\n          var req = reqs[i];\r\n          if (pref.test_mode['82'] && req.obj instanceof Blob) {\r\n            if (pref.test_mode['83']) req.obj = null;\r\n            else if (pref.test_mode['84']) {\r\n              var str = '';\r\n              while (str.length*2<req.obj.size) str += Math.random();\r\n              req.obj = str;\r\n            } else {\r\n              var codes = [];\r\n              for (var j=0;j*2<req.obj.size;j++) codes[j] = Math.floor(Math.random()*65536);\r\n              req.obj = String.fromCharCode.apply(null,codes);\r\n            }\r\n          }\r\n          if (pref.debug_mode['23']) console.log('put_'+((reqs_in.nos)?'m: ':'1: ')+db.name.replace(/^[^\\/]*/,'')+req.no+', '+req.key+((req.key==='posts')? ':'+req.obj.length:'')+((reqs_in.nos)? ' '+(i+1)+'/'+reqs_in.nos.length+'/'+reqs_in.reqs.length:''));\r\n          var IDBR = IDBT.objectStore(req.no).put((req.key!=='posts')? req.obj : JSON.stringify(req.obj, archiver.store_json_func),\r\n                                                  (req.key!=='posts')? req.key : req.key+'_'+req.obj[0].no);\r\n          IDBR.onerror   = IDBRequest_onerror;\r\n//          IDBR.onsuccess = clear_wdg_get_db; // IDBRequest_onsuccess;\r\n        }\r\n        if (pref.debug_mode['20']) db_info.get(db).done_put += reqs.length;\r\n      } catch (e){\r\n//        if (pref.debug_mode['20'])\r\n          console.log('IDB: fail to put: '+e.name+': ' + JSON.stringify(req,['no','key','kind']), e, db_info.get(db));\r\n        if (e.name==='InvalidStateError') { // retry when latter requests catch up with a prior request which creates new objectStore.\r\n          add_req(reqs_re, db.name, req); // retry\r\n          if (pref.debug_mode['20']) console.log('IDB: re-scheduled:');\r\n        }\r\n        complete_func({target:{db:db}});\r\n      }\r\n    }\r\n//    function IDBRequest_onsuccess(e){\r\n//      var db = clear_wdg_get_db(e);\r\n//      var info = db_info.get(db);\r\n//      if (info) info = info.tr_info.get(e.target.transaction);\r\n//      if (info && --info.nof_reqs===0) info.func(e);\r\n//    }\r\n    function delete_1(db,req, complete_func){\r\n      tr_set(db.transaction(req.no,'readwrite'), complete_func).objectStore(req.no).delete(req.key); // .onsuccess = IDBRequest_close;\r\n    }\r\n    function tr_set(tr, complete_func, req, db){\r\n      tr.oncomplete = (req)? IDBTransaction_oncomplete : complete_func;\r\n      tr.onabort    = IDBTransaction_onabort;\r\n      tr.onerror    = IDBTransaction_onerror;\r\n      if (req) db_info.get(db).tr_info.set(tr,{req:req, func:complete_func}); //, nof_reqs:req.reqs && req.reqs.length || 1});\r\n      return tr;\r\n    }\r\n    function IDBTransaction_oncomplete(e){\r\n      var info = db_info.get(e.target.db);\r\n      if (info) {\r\n        var func = info.tr_info.get(e.target).func;\r\n        info.tr_info.delete(e.target);\r\n        if (func) func(e);\r\n      }\r\n    }\r\n    function clean_up(db,req, complete_func){\r\n      var contains = db.objectStoreNames.contains('Meta');\r\n      if (contains) tr_set(db.transaction('Meta','readwrite'), complete_func).objectStore('Meta').get('pruned_time').onsuccess = clean_1_onsuccess;\r\n      else {\r\n        times_pruned[db.name].write = true;\r\n        clean_up_end_proc(db,req, complete_func, true);\r\n      }\r\n    }\r\n    function clean_1_onsuccess(e, prune){\r\n      var db = e.target.transaction.db;\r\n      var src = e.target.result;\r\n      if (src) {\r\n        var info = db_info.get(db);\r\n        var oss = info && info.oss || {};\r\n        src = src.filter(function(v){return oss[v.no]===null;});\r\n        var src_obj = {};\r\n        for (var i=0;i<src.length;i++) {if (src_obj[src[i].no]!==undefined) src.splice(src_obj[src[i--].no],1); src_obj[src[i].no] = i;}\r\n        times_pruned[db.name].list = src.concat(times_pruned[db.name].list.filter(function(v){return src_obj[v.no]===undefined;}));\r\n      }\r\n      times_pruned[db.name].write = true;\r\n      clean_up_end_proc(db, null, null, true); // 'complete_func' will be called by transaction.oncomplete.\r\n    }\r\n//    function clean_up(db,req, complete_func){ // working code.\r\n//      req.complete_func = function(e, tr){\r\n//        if (tr) {\r\n//          if (req.tgts.length===0) return;\r\n//          tr.oncomplete = null;\r\n//        }\r\n//        clean_1(db,req, complete_func);\r\n//      };\r\n////      req.complete_func = function(){clean_1(db,req, complete_func);};\r\n//      req.tr = pref.archive.IDB.nof_tr;\r\n//      for (var i=0;i<req.tr;i++) clean_1(db,req, complete_func);\r\n//    }\r\n//    function clean_1(db,req, complete_func){\r\n//      if (req.tgts.length===0) {\r\n//        if (--req.tr===0) clean_up_end_proc(db,req, complete_func, true);\r\n//        return;\r\n//      }\r\n//      if (db_info.get(db).wdg) delete db_info.get(db).wdg;\r\n//      var no = req.tgts.shift();\r\n//      if (pref.debug_mode['23']) console.log('clean_1: '+no+', '+req.tgts.length);\r\n//      tr_set(db.transaction(no,'readwrite'), req.complete_func).objectStore(no).get('pruned_time').onsuccess = (req.prune)? clean_1_onsuccess_prune : clean_1_onsuccess;\r\n//    }\r\n////    function clean_1(db,req){ // CAUSE ERROR in Chrome, \"Internal error: Too many transactions queued.\" Upper limit is about 400-500.\r\n////      tr_inc(db);\r\n////      var tr = db.transaction(req.no,'readwrite');\r\n////      tr.objectStore(req.no).get('pruned_time').onsuccess = (req.prune)? clean_1_onsuccess_prune : clean_1_onsuccess;\r\n////      tr.oncomplete = IDBRequest_close;\r\n////      tr.onaboart = IDBTransaction_onabort;\r\n////      tr.onerror = IDBTransaction_onerror;\r\n////    }\r\n//    function clean_1_onsuccess_prune(e){\r\n//      clean_1_onsuccess(e, true);\r\n//    }\r\n//    function clean_1_onsuccess(e, prune){\r\n//      var value = e.target.result;\r\n//      if (!value && !prune) return;\r\n//      var date = value || Date.now();\r\n//      var db_name = e.target.transaction.db.name;\r\n//      var board = db_name.replace(pref.script_prefix+'.','');\r\n//      check_cleaned[db_name][check_cleaned[db_name].length] = {no:e.target.source.name, pruned_time:date};\r\n//      if (!value && prune) e.target.source.put(date, 'pruned_time');\r\n//      else if (pref.test_mode['76']) e.target.transaction.oncomplete(null, e.target.transaction);\r\n//    }\r\n//////    function clean_1_onsuccess(e, prune){ // working code.\r\n//////      var value = e.target.result;\r\n//////      var date = Date.now();\r\n//////      if (!value && prune) e.target.source.put(date, 'pruned_time');\r\n//////      else {\r\n//////        if (value + pref.archive.IDB.prune * 3600000 < date) acc(site.nickname, e.target.transaction.db.name.replace(pref.script_prefix+'.',''),\r\n//////                                                                 e.target.source.name, null, null, 'delete_th');\r\n//////      }\r\n//////    }\r\n    function clean_up_end_proc(db,req, complete_func, put_to_IDB){\r\n      var tgts = times_pruned[db.name].list;\r\n//      if (sort) tgts.sort(function(a,b){return a.pruned_time - b.pruned_time;}); // sort is in-place\r\n      var time_prune = Date.now() - pref.archive.IDB.prune * 3600000;\r\n//      var board = db.name.replace(pref.script_prefix+'.','');\r\n      var i=0;\r\n      while (i<tgts.length && tgts[i].pruned_time < time_prune) {\r\n        if (pref.archive.IDB.auto_restore_remove) liveTag.rm_404_1(site.nickname, db.name.replace(/^[^\\/]*/,''), tgts[i].no, true);\r\n        if (pref.archive.IDB.prune_flush) add_req(reqs_rw, db.name, {no:tgts[i++].no, key:null, obj:flush_and_prune, kind:'get_all'}, true);\r\n        else add_req(reqs_vc, db.name, {no:tgts[i++].no, key:null, obj:null, kind:'delete_th'}, true);\r\n      }\r\n//      while (i<tgts.length && tgts[i].pruned_time < time_prune) add_req(reqs_vc, db.name, {no:tgts[i++].no, key:null, obj:null, kind:'delete_th'}, true); // acc(site.nickname, board, tgts[i++].no, null, null, 'delete_th');\r\n      if (i>0) tgts.splice(0,i);\r\n      if (times_pruned[db.name].write && (put_to_IDB || i!==0)) add_req(reqs_rw, db.name, {no:'Meta', key:'pruned_time', obj:tgts, kind:'put'});\r\n      if (complete_func) complete_func();\r\n    }\r\n    function flush_and_prune(domain, board, no, result){\r\n      var filename = 'CatChan_archive_pruned_'+domain+'-'+board.slice(1,-1)+'-'+no+'.tar';\r\n      var file_id = 'pruned_'+domain+board+no+Date.now();\r\n      archiver.event_funcs['export_thread'](domain, board, no, result, file_id, filename);\r\n      acc(domain, board, no, null, null, 'delete_th');\r\n    }\r\n    function get_all(db,reqs_in, complete_func){\r\n//      var req = tr_set(db.transaction(req.no,'readonly'), complete_func).objectStore(req.no).getAll(req.key).onsuccess = req.obj;\r\n      var IDBT = tr_set(db.transaction(reqs_in.nos,'readonly'), complete_func);\r\n      for (var i=0;i<reqs_in.reqs.length;i++) {\r\n        var req = reqs_in.reqs[i];\r\n        if (pref.debug_mode['23']) console.log('get_all: '+db.name.replace(/^[^\\/]*/,'')+req.no+', '+req.key);\r\n        var IDBR = IDBT.objectStore(req.no).openCursor((req.key==='posts')? IDBKeyRange.bound('posts', 'postt', false, true) : undefined);\r\n        IDBR.onsuccess = get_all_onsuccess;\r\n        req.result = {};\r\n        req_dictionary.set(IDBR,req);\r\n      }\r\n    }\r\n    var req_dictionary = new Map();\r\n    function clear_wdg_get_db(e){\r\n      var db = e.target.transaction.db;\r\n      var info = db_info.get(db);\r\n      if (info) info.pass++; // may be stopped by watchdog.\r\n      return db;\r\n    }\r\n    function get_all_onsuccess(e){\r\n      var db = clear_wdg_get_db(e);\r\n      var IDBR = e.target;\r\n      var req = req_dictionary.get(IDBR);\r\n      var cursor = e.target.result;\r\n      if (cursor) {\r\n        req.result[cursor.key] = (cursor.key.indexOf && cursor.key.indexOf('posts')===0)? JSON.parse(cursor.value) :\r\n//                                 (req.key==='posts')? null :\r\n                                 (cursor.value instanceof ArrayBuffer)? common_func.arraybuffer2blob(cursor.key, cursor.value) : cursor.value;\r\n        cursor.continue();\r\n      } else {\r\n        req_dictionary.delete(IDBR);\r\n        var board = e.target.transaction.db.name.replace(pref.script_prefix+'.','');\r\n        var no = e.target.source.name;\r\n        setTimeout((function(req,board,no){return function(){req.obj(site.nickname, board, no, req.result);};})(req,board,no),0);\r\n        if (pref.debug_mode['29']) {\r\n          var sum = 0;\r\n          for (var i in req.result) sum += (i.indexOf('posts')===0)? JSON.stringify(req.result[i]).length*2 : req.result[i] && req.result[i].size;\r\n          console.log('IDB: '+board+no+': '+Object.keys(req.result).length+' files, '+sum.toLocaleString()+' bytes.');\r\n        }\r\n      }\r\n    }\r\n    function IDBRequest_close(e){\r\n      var db = e.target.source && e.target.source.transaction.db || e.target.db || e.target.result;\r\n      var info = db_info.get(db);\r\n      if (!info) return; // closed by WATCHDOG.\r\n      if (info.tr_count!==1) info.tr_count -= 1; //      if (tc===1) {db.close();tr_count.delete(db);}\r\n      else IDB_close(db, info);\r\n    }\r\n    function IDBT_rereq(db, tr, message){\r\n      var info = db_info.get(db);\r\n      if (info && tr.mode!=='readonly') {\r\n        var req = info.tr_info.get(tr).req;\r\n        add_req((req.kind==='delete_th')? reqs_vc : reqs_re, db.name, req);\r\n        console.log(message+': close and re-req, '+req.kind);\r\n      }\r\n    }\r\n    function IDB_close(db, info, force){\r\n      if (!info) info = db_info.get(db);\r\n      if (force && info) for (var i of info.tr_info.keys()) IDBT_rereq(db, i, force);\r\n      db_info.delete(db);\r\n      var case_of_test_mode78 = !force && info.req_kinds['delete_th']!==undefined && Object.keys(info.req_kinds).length===1 || db.version==1;\r\n      if (pref.debug_mode['26'] && case_of_test_mode78) console.log('Hit the case of test_mode[78]');\r\n//      if (Object.keys(info.req_kinds).length===0 && db.version===1) console.log('test: v1');\r\n//      else\r\n      if (!case_of_test_mode78 || pref.test_mode['78']) db.close();\r\n      else setTimeout(function(){db.close();},0);\r\n      if (pref.debug_mode['20']) console.log('IDB: closed: '+db_info.size+' '+db.name.replace(/^[^\\/]*/,'')+' v'+db.version+', '+((info)? info.type+', done:'+info.done+', done_put:'+info.done_put+', '+info.coms : ''));\r\n      if (info) info.db = db;\r\n      last_closed = info;\r\n      indicator_update();\r\n    }\r\n    var last_closed = null; // for debug\r\n    var db_info = new Map();\r\n    function tr_inc(db){\r\n      db_info.get(db).tr_count += 1;\r\n    }\r\n    var times_pruned = {};\r\n    var version = {};\r\n    var waiting_open = {}; // exclusive request,(closing a transaction without any acceess may cause an IDB ABORT ERROR)\r\n    var reqs_vc = {};\r\n    var reqs_rw = {};\r\n    var reqs_re = {};\r\n    var sub_callbacks = {};\r\n    function acc(domain,board,no,key,obj, kind){\r\n//      var db_name = pref.script_prefix+'.'+domain+board;\r\n      if (domain===site.nickname) {\r\n        var db_name = pref.script_prefix+'.'+board;\r\n        var req_obj = {no:no, key:key, obj:obj, kind:kind};\r\n        var reqs = (kind==='delete_th')? reqs_vc : reqs_rw;\r\n        add_req(reqs, db_name, req_obj, true);\r\n//      if (!reqs[db_name]) reqs[db_name] = [req_obj]; // not improved.\r\n//      else reqs[db_name].push(req_obj);\r\n//      open_db(db_name, ver);\r\n      } else {\r\n        if (typeof(obj)==='function') {\r\n          sub_callbacks[domain+board+no] = obj;\r\n          obj = 'sub_callback';\r\n        }\r\n//try {\r\n        if (pref.test_mode['86'] && (obj instanceof ArrayBuffer)) send_message(domain,['IDB',['ACC',[domain,board,no,key,null, kind]]], null, [obj]); // https://bugs.chromium.org/p/chromium/issues/detail?id=334408\r\n        else send_message(domain,['IDB',['ACC',[domain,board,no,key,obj, kind]]]);\r\n//} catch (e) { // BUG. pn is attatched in some case.\r\n//  console.log(e);\r\n//}\r\n      }\r\n    }\r\n    function open_db(db_name, ver, from_watchdog){\r\n      var key = db_name+((ver)? 'vc' : 'rw');\r\n      if (waiting_open[key]!==undefined && (!from_watchdog || ++waiting_open[key]<db_info.size)) {\r\n        if (pref.debug_mode['27']) if (from_watchdog) console.log('IDB: WATCHDOG: '+key+', '+waiting_open[key]);\r\n        return;\r\n      }\r\n      waiting_open[key] = 0;\r\n      var req = window.indexedDB.open(db_name, ver && version[db_name]+1 || undefined); // version[db_name]+1 is NaN at initial.\r\n      req.onerror = IDBRequest_onerror;\r\n      req.onsuccess = IDBRequest_onsuccess_open;\r\n      req.onupgradeneeded = IDBRequest_onupgradeneeded;\r\n      req.onblocked = IDBRequest_onblocked;\r\n    }\r\n    function req_raw(domain,db_name,os_name,key,obj, kind){\r\n      if (domain===site.nickname) {\r\n        var req_obj = {no:os_name, key:key, obj:obj, kind:kind};\r\n        var reqs = (kind==='delete_th')? reqs_vc : reqs_rw;\r\n        add_req(reqs, db_name, req_obj, true);\r\n      }\r\n    }\r\n    function add_req(reqs, db_name, req, call){\r\n      indicator_req_count++;\r\n      if (!indicator && indicator_parent) {\r\n        indicator = indicator_parent.shift('limegreen', 'w', 'IDB', 0);\r\n        indicator.report({start:Date.now(), prog_str:'Opening'});\r\n      } else indicator_update();\r\n      if (!reqs[db_name]) {\r\n        reqs[db_name] = new ReqFifo(db_name, reqs!==reqs_vc, req);\r\n        if (call) open_db(db_name, reqs===reqs_vc);\r\n      } else {\r\n        var spawn = reqs===reqs_rw && reqs[db_name].isEmpty;\r\n        reqs[db_name].push(req);\r\n        if (spawn) {\r\n          for (var i of db_info.keys()) {\r\n            var info = db_info.get(i);\r\n            if (info.crawler<pref.archive.IDB.nof_tr && i.name===db_name && info.type==='success') {\r\n              info.crawler++;\r\n              setTimeout(info.complete_func, 100);\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      watchdog.start(pref.archive.IDB.watchdog*1000);\r\n    }\r\n    var ReqFifo = function(db_name, allow_multi, init_val){\r\n      this.ary = [];\r\n      this.ary_ro = [];\r\n//      this.count = 0;\r\n      this.allow_multi = allow_multi;\r\n      if (!this.reqs[db_name]) this.reqs[db_name] = {};\r\n      this.reqs = this.reqs[db_name]; // shared\r\n      this.cls = {}; // req clusters\r\n      if (init_val) this.push(init_val);\r\n      this.cl = null;\r\n      this.cl_idx = 0;\r\n    };\r\n    ReqFifo.prototype = {\r\n      shift: function(){\r\n        var max = (this.allow_multi)? pref.archive.IDB.nof_cl_max : 1;\r\n        var i=0;\r\n        while (i<this.ary_ro.length && i<max && this.ary_ro[i].kind==='get_all') i++;\r\n        if (i!=0) return {kind:'get_all_m', reqs:this.ary_ro.splice(0,i)};\r\n        else if (this.ary_ro.length!==0) return this.ary_ro.shift();\r\n//        if (this.ary_ro.length>0) return this.ary_ro.shift();\r\n        if (this.ary.length===0 && !this.cl) return null;\r\nif (!pref.test_mode['79']) {\r\n        var retval = [];\r\n  if (!pref.test_mode['81']) {\r\n        var ref_no;\r\n        while (retval.length<max) {\r\n          var req = this.ary[i];\r\n          if (!req || req.kind!=='put') break;\r\n          if (ref_no!==undefined && (!req.no || ref_no!==req.no)) break;\r\n          if (req.cl) {\r\n            if (req.idx===undefined) {\r\n              this.ary[i] = {kind:'put', cl:[req].concat(req.cl), idx:0, no:req.no};\r\n              req.cl = null;\r\n              req = this.ary[i];\r\n              this.cls[req.no] = req;\r\n            }\r\n            if (req.idx>=req.cl.length-1) {\r\n              this.cls[req.no] = null;\r\n              i++;\r\n            }\r\n            req = req.cl[req.idx++]; // all reqs are 'put'.\r\n          } else {\r\n            this.cls[req.no] = null;\r\n            i++;\r\n          }\r\n          retval[retval.length] = req;\r\n          delete this.reqs[req.no + req.key]; // shared, so must use delete.\r\n          if (retval.length===pref.archive.IDB.nof_cl-1) ref_no = req.no;\r\n        }\r\n        if (this.ary[i] && this.ary[i].cl && this.ary[i].idx<this.ary[i].cl.length) { // round robin\r\n          var cl = this.ary.splice(i,1)[0];\r\n          this.ary[this.ary.length] = cl;\r\n        }\r\n  } else {\r\n        while (retval.length<max) { // working code.\r\n          var req;\r\n          if (this.cl===null) {\r\n            req = this.ary[i];\r\n            if (!req || req.kind!=='put') break;\r\n            i++;\r\n            if (req.cl) {\r\n              this.cls[req.no] = null;\r\n              this.cl = req.cl;\r\n              this.cl_idx = 0;\r\n              req.cl = null; // for retry.\r\n            }\r\n          } else {\r\n            req = this.cl[this.cl_idx++]; // all reqs are 'put'.\r\n            if (this.cl_idx>=this.cl.length) this.cl = null;\r\n          }\r\n          retval[retval.length] = req;\r\n          delete this.reqs[req.no + req.key]; // shared, so must use delete.\r\n        }\r\n  }\r\n        if (i>0) this.ary.splice(0,i);\r\n        if (i===0 && this.ary[0] && this.ary[0].kind==='check_clean') this.cls['check_clean'] = null;\r\n        return (retval.length>1)? {kind:'put_m', reqs:retval} : (retval.length>0)? retval[0] : this.ary.shift();\r\n} else {\r\n        while (i<max) { // working code // not debugged enough\r\n          var req = this.ary[i];\r\n          if (!req) break;\r\n          if (req.cl) {\r\n            this.ary = this.ary.slice(0,i+1).concat(req.cl,this.ary.slice(i+1));\r\n            req.cl = null; // for retry.\r\n          }\r\n          if (req.kind==='put') {\r\n            this.cls[req.no] = null;\r\n            delete this.cls[req.no + req.key]; // shared, so must use delete.\r\n            i++;\r\n          } else break;\r\n        }\r\n////        while (i<max && this.ary[i] && this.ary[i].kind==='put') {delete this.cls[this.ary[i].no + this.ary[i].key]; i++;} // working code.\r\n////        this.count += i;\r\n        return (i>1)? {kind:'put_m', reqs:this.ary.splice(0,i)} :\r\n                      this.ary.shift();\r\n}\r\n      },\r\n      push: function(req){\r\n        if (req.kind==='get_all' || req.kind==='list_os') {\r\n          this.ary_ro[this.ary_ro.length] = req;\r\n          return;\r\n        }\r\n        if (req.kind==='put') {\r\n          var key = req.no + req.key;\r\n          var req_old = this.reqs[key];\r\n        }\r\n        if (req_old) req_old.obj = (req.key==='posts')? req_old.obj.concat(req.obj) : req.obj;\r\n        else if (key) {\r\n          if (req.key==='posts' || req.key==='pruned_time' || req.key==='posts_deleted') this.reqs[key] = req;\r\n//          var idx = this.reqs[req.no] - count; // maybe NaN // not debugged.\r\n//          if (idx>1 && idx!==this.ary.length) {\r\n//            this.ary.splice(idx,req);\r\n//            this.reqs[req.no] = count + idx +1;\r\n//          } else {\r\n//            this.ary[this.ary.length] = req;\r\n//            this.reqs[req.no] = count+this.ary.length;\r\n          var req_cl = this.cls[req.no];\r\n          if (req_cl) { // 'reqs' is used by 'put_m'.\r\n            if (req_cl.cl) req_cl.cl[req_cl.cl.length] = req;\r\n            else req_cl.cl = [req];\r\n          } else {\r\n            this.ary[this.ary.length] = req;\r\n            this.cls[req.no] = req;\r\n          }\r\n        } else if (req.kind==='check_clean') {\r\n          var key = null + req.key;\r\n          var req_old = this.cls[key];\r\n          if (req_old) req_old.reqs[req_old.reqs.length] = req;\r\n          else {\r\n            req = {kind:'clean_m', reqs:[req], no:null};\r\n            this.cls[key] = req;\r\n            this.ary[this.ary.length] = req;\r\n          }\r\n        } else this.ary[this.ary.length] = req;\r\n      },\r\n      push_all: function(reqs){\r\n        while (!reqs.isEmpty) this.push(reqs.shift());\r\n      },\r\n//      get length(){return this.ary.length - this.idx;},\r\n//      get length(){return this.ary.length + this.ary_ro.length;},\r\n//      get length(){return this.ary.length + this.ary_ro.length + (this.cl && this.cl.length-this.cl || 0);}, // approx.\r\n      get length(){return this.ary.length + this.ary_ro.length;},\r\n      get length_whole(){\r\n        var sum = 0;\r\n        for (var i=0;i<this.ary.length;i++) sum += (this.ary[i].cl)? this.ary[i].cl.length-(this.ary[i].idx||0) : 1;\r\n        return sum + this.ary_ro.length;\r\n      },\r\n      get isEmpty(){return this.ary.length===0 && !this.cl && this.ary_ro.length===0;},\r\n      reqs: {},\r\n      debug_query: function(){\r\n        var whole_array = Array.prototype.concat.apply(this.ary_ro, this.ary.map(function(v){return (v.cl)? ((!pref.test_mode['81'])? v.cl.slice(v.idx || 0) : [v].concat(v.cl)) : v;}));\r\n        var coms = [];\r\n        var count = 1;\r\n        var i=0;\r\n        while (coms.length<20 && i++<whole_array.length) {\r\n          if (whole_array[i] && whole_array[i-1].kind===whole_array[i].kind) count++;\r\n          else {\r\n            coms[coms.length] = whole_array[i-1].kind+((count!=1)? '*'+count:'');\r\n            count = 1;\r\n          }\r\n        }\r\n        if (i<whole_array.length) coms[coms.length-1] += '...';\r\n//        var coms = whole_array.map((function(){ // working code.\r\n//          var count = 1;\r\n//          return function(v,i,a){\r\n//            if (a[i+1] && v.kind===a[i+1].kind) {\r\n//              count++;\r\n//              return null;\r\n//            } else {\r\n//              var retval = v.kind+((count!=1)? '*'+count:'');\r\n//              count = 1;\r\n//              return retval;\r\n//            }\r\n//          }\r\n//        })()).filter(function(v){return v;});\r\n        return {coms:coms, length:this.ary_ro.length+'/'+this.ary.length+'/'+whole_array.length};\r\n      }\r\n    };\r\n    var indicator_parent = null;\r\n    var indicator = null;\r\n    var indicator_req_count = 0;\r\n    var indicator_update = function(){};\r\n    var indicator_update = DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(function(){\r\n      if (!indicator) return;\r\n      var stats = get_status();\r\n      indicator.report({prog_str:stats.str});\r\n      if (stats.total===0) {\r\n        indicator.report({end:Date.now()});\r\n        indicator = null;\r\n        indicator_req_count = 0;\r\n      }\r\n    },100));\r\n    function get_status(){\r\n      var nof_crawlers = 0;\r\n      for (var db of db_info.keys()) nof_crawlers += db_info.get(db).crawler;\r\n      var sums = [0, 0, 0, 0, 0, 0, Object.keys(reqs_vc).length, Object.keys(reqs_rw).length, Object.keys(reqs_re).length, nof_crawlers, db_info.size, Object.keys(waiting_open).length];\r\n      var tgts = [reqs_vc,reqs_rw,reqs_re];\r\n      for (var i=0;i<3;i++) {\r\n        if (sums[i+6]) for (var j in tgts[i]) {\r\n          sums[i+3] += tgts[i][j].length;\r\n          sums[i]   += tgts[i][j].length_whole;\r\n        }\r\n      }\r\n      return {sums:sums, total:sums.reduce(function(a,b){return a+b;}), str:sums.join('/')+'/'+indicator_req_count};\r\n    }\r\n    var watchdog = new Watchdog(function (){\r\n      var stats = get_status();\r\n      if (pref.debug_mode['27']) console.log('IDB: '+stats.str);\r\n      var inactivated = {};\r\n      for (var db of db_info.keys()) {\r\n        var info = db_info.get(db);\r\n        if (pref.debug_mode['27']) console.log(info);\r\n        if (info.wdg!==info.pass) {\r\n          info.wdg = info.pass;\r\n//        if (tgt.req && (!tgt.wdg || tgt.wdg!==tgt.req)) tgt.wdg = tgt.req;\r\n//        if (!tgt.wdg || tgt.wdg!==tgt.req) tgt.wdg = tgt.req; // BUG. lock when tgt.req===unefined or tgt.req===null. // This was patched in 'req_1'\r\n          inactivated[db.name] = null;\r\n        } else {\r\n          indicator_report();\r\n          IDB_close(db, info, 'IDB: WDG');\r\n        }\r\n      }\r\n      for (var i in reqs_vc) if (inactivated[i]!==null && !reqs_vc[i].isEmpty) open_db(i,true, true);\r\n      for (var i in reqs_rw) if (inactivated[i]!==null && (!reqs_vc[i] || reqs_vc[i].isEmpty) && !reqs_rw[i].isEmpty) open_db(i, undefined, true);\r\n      for (var i in reqs_re) if (inactivated[i]!==null && (!reqs_vc[i] || reqs_vc[i].isEmpty) && (!reqs_rw[i] || reqs_rw[i].isEmpty) && !reqs_re[i].isEmpty) {\r\n        reqs_re2rw(i);\r\n        open_db(i, undefined, true);\r\n      }\r\n      for (var db_name_key in waiting_open) {\r\n        var db_name = db_name_key.replace(/(rw|vc)$/,'');\r\n        if (inactivated[db_name]!==null && !reqs_vc[db_name] && !reqs_rw[db_name]) {\r\n          indicator_report();\r\n          open_db(db_name, db_name_key.search(/vc$/)!=-1, true);\r\n        }\r\n      }\r\n      if (stats.total!==0) watchdog.start(pref.archive.IDB.watchdog*1000);\r\n      function indicator_report(){\r\n        if (stats.str) {\r\n          indicator.report({err_str:'WDG: '+stats.str});\r\n          stats.str = '';\r\n        }\r\n      }\r\n    }, 60000);\r\n    return {\r\n      req: acc, // write: function(domain, board, no, key, data,     cmd)\r\n                // read : function(domain, board, no, key, callback, cmd)\r\n      req_raw: req_raw, // read : function(domain, db_name, os_name, key, callback, cmd)\r\n      clean_up: function(domain, board, nos){\r\n        if (version[pref.script_prefix+'.'+board]) {\r\n          acc(domain,board,null,null,nos, 'clean_up');\r\n          liveTag.mems[domain][board].IDB_synced = 1;\r\n        }\r\n      },\r\n      set_indicator: function(indicator){\r\n        if (!indicator_parent) indicator_parent = indicator;\r\n//        indicator_parent.shift().set('Red','IDB:');\r\n      },\r\n      sub_funcs: function(args, list){\r\n        if (args[0]==='ACC') {\r\n          if (args[1][4]==='sub_callback') args[1][4] = IDB.sub_ack;\r\n          else if (list.length>0) args[1][4] = list[0];\r\n          acc.apply(this,args[1]);\r\n        } else if (args[0]==='ACK') {\r\n          var dbtk = args[1].slice(0,3).join('');\r\n          if (sub_callbacks[dbtk]) sub_callbacks[dbtk].apply(this,args[1]);\r\n          delete sub_callbacks[dbtk];\r\n        }\r\n      },\r\n      sub_ack: function(domain, board, no, result){\r\n        send_message('parent',['IDB',['ACK',[domain,board,no,result]]]);\r\n      },\r\n    };\r\n  })();\r\n\r\n  var archiver = (function(){\r\n// http://www.redout.net/data/tar.html\r\n// dollchan\r\n// https://github.com/beatgammit/tar-js/blob/master/lib/tar.js\r\n// https://gist.github.com/kig/417483\r\n    var tar = (function(){\r\n      function make_header(blob, lth, suffix){\r\n        var header = new Uint8Array(512); // UInt8 for checksum.\r\n        suffix = (suffix.substr(0,3)==='tn_')?  'thumbs/' + encode_filename(suffix.substr(3)) :\r\n                 (suffix.substr(0,4)==='img_')? 'images/' + encode_filename(suffix.substr(4)) :\r\n                 encode_filename(suffix);\r\n        var name = lth.domain + '/' + encode_filename(lth.board.slice(1,-1)) + '/' + lth.no + '/' + suffix; // not to encode '/'\r\n        set_header(header,   0, name, 100);  // name\r\n        set_header(header, 100, '100777', 8);  // mode\r\n        set_header(header, 108, '0', 8);       // uid\r\n        set_header(header, 116, '0', 8);       // gid\r\n        set_header(header, 124, (blob.byteLength||blob.size||0).toString(8), 12);  // fileSize, octal // blob may be arraybuffer.\r\n        set_header(header, 136, Math.floor(Date.now()/1000).toString(8), 12);  // mtime, octal\r\n        set_header(header, 148, '        ', 8);  // checksum \r\n        header[156] = 0x30;  // type 0 as a normal file.\r\n        var checksum = 0;\r\n        for(i=0;i<157;i++) checksum += header[i];\r\n        set_header(header, 148, checksum.toString(8), 8); // checksum, octal\r\n        return header;\r\n      }\r\n      function set_header(header, pos, numstr, len) {\r\n        var j=0;\r\n        while (j<numstr.length && j<len) header[pos++] = numstr.charCodeAt(j++) & 0xff;\r\n        if (j<len) header[pos++] = 0x00;\r\n      }\r\n      function encode_filename(str){\r\n        return encodeURIComponent(str).replace(/[!'()*]/g, function(c) {\r\n          return '%' + c.charCodeAt(0).toString(16);});\r\n      }\r\n      var tars = {};\r\n      var count = 0;\r\n      return {\r\n        add_blob: function(blob, lth, suffix, tarfile, ignore_limit){ // blob may be arraybuffer.\r\n          if (!tars[tarfile]) tars[tarfile] = {files:[], size:0};\r\n          var tfile = tars[tarfile];\r\n          var size = blob.byteLength||blob.size;\r\n          tfile.files[tfile.files.length] = make_header(blob, lth, suffix);\r\n          tfile.size += 1;\r\n          tfile.files[tfile.files.length] = blob;\r\n          if (size%512!==0) tfile.files[tfile.files.length] = new Uint8Array(512-size%512);\r\n          tfile.size += Math.floor((size+511)/512);\r\n          if (!ignore_limit && (tfile.size>pref.archive.tarsize*2*1024 || pref.test_mode['71'])) this.flush(tarfile);\r\n        },\r\n        flush: function(tarfile, filename){\r\n          if (!tarfile) {for (var i in tars) this.flush(i); return;}\r\n          if (tars[tarfile]) { // called from both 'httpd.check_timestamp_and_flush' and 'archiver.flush_req', so the file might be flushed.\r\n            tars[tarfile].files[tars[tarfile].files.length] = new Uint8Array(1024);\r\n            download_url4(new Blob(tars[tarfile].files, {type:'application/x-tar'}), filename || 'CatChan_archive_updates_'+site.nickname+'_'+tarfile+'_'+(count++)+'.tar');\r\n            delete tars[tarfile];\r\n          }\r\n        },\r\n      };\r\n    })();\r\n    function store_posts(content, type, lth, suffix){\r\n      if (!window.URL) return;\r\n      if (!timestamp) set_timestamp();\r\n      download_url3(new Blob([content], {type:type}), lth, suffix, timestamp);\r\n    }\r\n    function download_url3(blob, lth, suffix, timestamp){\r\n      if (pref.archive.tar) tar.add_blob(blob, lth, suffix, timestamp);\r\n      else download_url4(blob, 'CatChan_'+lth.key.replace(/\\//g,'_') + '_' + suffix);\r\n    }\r\n    function download_url4(blob, filename){ // blob may be arraybuffer.\r\n      if (blob instanceof ArrayBuffer) blob = common_func.arraybuffer2blob(filename, blob);\r\n      if (brwsr.ff && !httpd.isLocal) {\r\n        send_message('parent',['ARCHIVER', ['DOWNLOAD', [blob, filename]]]);\r\n        return;\r\n      }\r\n      var url = window.URL.createObjectURL(blob);\r\n      download_url(url, filename);\r\n      window.URL.revokeObjectURL(url);\r\n//      if (!brwsr.ff || httpd.isLocal) window.URL.revokeObjectURL(url);\r\n    }\r\n    function download_url(url, filename){ // this doesn't work if url is cross-origined, for example, i.4cdn.org from boards.4chan.org in 4chan.\r\n      if (pref.test_mode['70']) return;\r\n//      if (brwsr.ff && !httpd.isLocal) {\r\n//        send_message('parent',['ARCHIVER', ['DOWNLOAD', [url, filename, site.nickname]]]); // doesn't work\r\n//        return;\r\n//      }\r\n      var a_link = document.createElement('div');\r\n      a_link.innerHTML = '<a href=' + url + ' download=\"' + filename + '\">';\r\n      if (brwsr.ff) site.script_body.appendChild(a_link);\r\n      a_link.childNodes[0].click();\r\n      if (brwsr.ff) site.script_body.removeChild(a_link);\r\n    }\r\n    var proto_archive = {initiator:'archive', get responseType(){return (pref.test_mode['85'])? 'blob' : 'arraybuffer';}, archive:true, callback_1:httpd.onload_archive, callback_1_fail:httpd.onload_archive_fail,\r\n                         get max(){return this.tgts.length;},\r\n                         get tgt(){return this.key + this.url.substr(this.url.lastIndexOf('/'));},\r\n                        };\r\n    var timestamp = null;\r\n    var month = {Jan:'01', Feb:'02', Mar:'03', Apr:'04', May:'05', Jun:'06', Jul:'07', Aug:'08', Sep:'09', Oct:'10', Nov:'11', Dec:'12'};\r\n    function set_timestamp(){\r\n      var arr = new Date().toString().split(' ').slice(1,5);\r\n      timestamp = [arr[2], month[arr[0]], arr[1], arr[3].replace(/:/g,'')].join('');\r\n      httpd.req({tgts:[], timestamp:timestamp, __proto__:proto_archive},0);\r\n    }\r\n    var flush_req = DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(function(){\r\n//      if (reqs.length==0 && xhrs.size==0) tar.flush();\r\n      httpd.check_timestamp_and_flush(timestamp);\r\n    },5000));\r\n    \r\n    var xhrs = new Map();\r\n    var reqs = [];\r\n//    function download_url2(url, lth, kind, to_file, to_idb){ // for test\r\n//      if (!timestamp) set_timestamp();\r\n//      var req = {url:url, lth:lth, kind:kind, to_file:to_file, to_idb:to_idb, timestamp:timestamp};\r\n    function download_url2(reqs_in){\r\n      httpd.req_add({tgts:reqs_in, timestamp:timestamp, __proto__:proto_archive},0);\r\n      return;\r\n    }\r\n////    function download_url2(reqs_in){ // working code.\r\n////      for (var i=0;i<reqs_in.length;i++) {\r\n////        if (xhrs.size>=10) reqs.push(reqs_in[i]);\r\n////        else {\r\n////          var xhr = new XMLHttpRequest();\r\n////          xhr.responseType = 'blob';\r\n////          xhr.onload  = download_url2_1_onload;\r\n////          xhr.onerror = download_url2_1_onload;\r\n////          xhr.onabort = download_url2_1_onload;\r\n////          download_url2_1(xhr, reqs_in[i]);\r\n////        }\r\n////      }\r\n////    }\r\n////    function download_url2_1(xhr, req){ // for test\r\n////      xhrs.set(xhr, req);\r\n////      xhr.open('GET', req.url);\r\n////      xhr.send();\r\n////      return xhr;\r\n////    }\r\n////    function download_url2_1_onload(e){\r\n////      var xhr = e.target;\r\n////      var req = xhrs.get(xhr);\r\n////      if (req.from) delete list_all_obj_downloading[req.from];\r\n////      if(xhr.status === 200 && e.type==='load') {\r\n////        var suffix = req.kind + '_'+ xhr.responseURL.replace(/.*\\//g,'');\r\n////        if (req.to_file) download_url3(xhr.response, req.lth, suffix, req.timestamp);\r\n////        if (!pref.test_mode['65']) if (req.to_idb) IDB.req(req.lth.domain, req.lth.board, req.lth.no, suffix, xhr.response, 'put');\r\n////      }\r\n////      if (reqs.length>0) {\r\n////        req = reqs.shift();\r\n////        download_url2_1(e.target, req);\r\n////      } else xhrs.delete(xhr);\r\n////      if (xhrs.size===0) tar.flush();\r\n////    }\r\n    function img_dl(kind, th, lth, posts, img, img_idb, webm, webm_idb, reqs){\r\n      for (var i=0;i<posts.length;i++) {\r\n        var url = (kind==='tn')? site2[th.domain].catalog_json2html3_thumbnail(posts[i],th.board) : site2[th.domain].catalog_json2html3_src(posts[i],th.board);\r\n        if (url) {\r\n          if (!timestamp) set_timestamp();\r\n//          var proto = {lth:lth, kind:kind, to_file:img||webm, to_idb:img_idb||webm_idb, timestamp:timestamp};\r\n          var proto = {domain:th.domain, board:th.board, no:th.no, key:th.key, kind:kind, to_file:img||webm, to_idb:img_idb||webm_idb, timestamp:timestamp, __proto__:proto_archive};\r\n          if (site2[th.domain].archive_patch_domain) site2[th.domain].archive_patch_domain(proto);\r\n          if ((url.substr(-5,5)==='.webm')? webm || webm_idb : img || img_idb) reqs[reqs.length] = {url:url, __proto__:proto};\r\n          if (posts[i].extra_files) for (var j=0;j<posts[i].extra_files.length;j++) {\r\n            url = (kind==='tn')? site2[th.domain].catalog_json2html3_thumbnail(posts[i].extra_files[j],th.board) : site2[th.domain].catalog_json2html3_src(posts[i].extra_files[j],th.board);\r\n            if ((url.substr(-5,5)==='.webm')? webm || webm_idb : img || img_idb) reqs[reqs.length] = {url:url, __proto__:proto};\r\n          }}}\r\n    }\r\n\r\n    var url_funcs_wrapped = false;\r\n    function url_funcs_wrap(){\r\n      for (var d in site2) {\r\n        if (site2[d].hasOwnProperty('catalog_json2html3_thumbnail')) site2[d].catalog_json2html3_thumbnail = wrap(site2[d].catalog_json2html3_thumbnail);\r\n        if (site2[d].hasOwnProperty('catalog_json2html3_src'))       site2[d].catalog_json2html3_src       = wrap(site2[d].catalog_json2html3_src);\r\n        if (site2[d].hasOwnProperty('parse_funcs')) {\r\n          var tgts = ['catalog_html','page_html','thread_html','post_html'];\r\n          for (var i=0;i<tgts.length;i++)\r\n            if (site2[d].parse_funcs.hasOwnProperty(tgts[i]) && site2[d].parse_funcs[tgts[i]].hasOwnProperty('op_img_url'))\r\n              site2[d].parse_funcs[tgts[i]].op_img_url = wrap(site2[d].parse_funcs[tgts[i]].op_img_url);\r\n        }\r\n      }\r\n      function wrap(func){\r\n        return function(th, board){\r\n          var url = func.call(this, th, board);\r\n          return (url && th.localArchive)? archiver.url2file(th.localArchive, url) : url;\r\n        }\r\n      }\r\n    }\r\n    var archive_no = 0;\r\n    function restore(file, result, archive, IDB){\r\n      if (!window.URL) return;\r\n      var th_obj = (IDB)? result :\r\n                   (file.type==='text/html')? new DOMParser().parseFromString(result, 'text/html') : JSON.parse(result);\r\n      var dbt = (pref.archive.format==='auto')? common_func.name2domainboardthread(file.name.replace(/\\.[^\\.]*$/,'').split('_')[0].split('-').slice(0,3).join('/'),true) :\r\n                                                [site0.domains[pref.archive.domain],\r\n                                                 '/'+pref.archive.board.replace(/\\//g,'')+'/'];\r\n      if (pref.test_mode['80']) dbt[1] = dbt[1].slice(0,-1) + ((IDB)? '_IDB/' : '_File/');\r\n      if (pref.archive.fix_inconsistency && dbt[0]!=='meguca') {\r\n        if (th_obj.posts[0].no!=dbt[2]) { // lain/drg/4654\r\n          th_obj.posts = [common_func.deep_copy(th_obj.posts[0])].concat(th_obj.posts);\r\n          th_obj.posts[0].no = dbt[2];\r\n          console.log('Archiver: Fixed: added dummy OP: '+dbt.join(''));\r\n        }\r\n        for (var i=0;i<th_obj.posts.length;i++) if (th_obj.posts[i].filename===false) {\r\n          th_obj.posts[i].filename = 'LOST_AT_ARCHIVE';\r\n          console.log('Archiver: Fixed: filename was lost: '+dbt.join('')+'#'+th_obj.posts[i].no);\r\n        }\r\n      }\r\n      if (!url_funcs_wrapped) {\r\n        url_funcs_wrap();\r\n        url_funcs_wrapped = true;\r\n      }\r\n      var ths = cataLog.scan_boards_keyword_callback2(dbt[0]+','+dbt[1]+','+ (archive_no++)+',thread_' + ((file.type==='text/html')? 'html' : 'json'),\r\n                                                      {date:Date.now(), status:200, response:th_obj},\r\n                                                      ['archive_restore',{localArchive:archive, page:(IDB)?'IDB':'File',\r\n                                                                          __proto__:cataLog.scan_boards_keyword_callback2_default_args}]);\r\n      cataLog.threads[ths[0].key][16].archiveFile = (IDB)? 'IDB' : file;\r\n      return ths[0];\r\n    }\r\n    function start_1(req, lth, footer, from_check_op){\r\n      if (req==='ARC' || req==='ARC1') {\r\n        lth.archived |= (req==='ARC')? 6 : 1;\r\n//        lth.archived |= (req==='ARC')? 6 : 5;\r\n        if (!from_check_op) scan.list_nup.add_scan(lth);\r\n      } else if (req==='UARC') {\r\n        lth.archived = 0;\r\n        archiver.clean_list(lth.domain, lth.board, lth.no);\r\n      }\r\n      if (footer && pref.catalog.footer.archived) cataLog.Footer.update_force(lth.key);\r\n    }\r\n    var blist = {pn:null, time_bumped:null, time_created:null, time_posted:null, flag:null, footer:null, time_tu:null,\r\n                 nof_posts:null, nof_files:null, tags:null, page:null,\r\n                 parse_funcs:null, // THIS IS REDUNDANT, but this caused a bug, so this is for safe.\r\n                 quotes:null, backlinks:null, reply_to_me:null, reply_of_mine:null, op_img_url:null}; // BUG. meguca has 'backlinks'.\r\n    function store_json_func(key,value){\r\n      return (blist[key]===null)? undefined : value;\r\n    }\r\n\r\n// https://www.w3.org/TR/html5/scripting-1.html#the-script-element\r\n//   Note: When inserted using the document.write() method, script elements execute (typically synchronously), but when inserted using innerHTML and outerHTML attributes, they do not execute at all.\r\n    var sanitize = (function(){\r\n      var funcs = {\r\n        html: (function(){\r\n          var pn = document.createElement('div');\r\n          var wlist = {'A':null, 'SPAN':null, 'DIV':null, 'BLOCKQUOTE':null, 'BR':null, 'WBR':null,\r\n                       'U':null, 'S':null, 'STRIKE':null, 'B':null, 'I':null, 'BIG':null, 'SMALL':null, 'TT':null, 'SUB':null, 'SUP':null, 'EM':null, 'STRONG':null};\r\n          return function (key,value,obj){\r\n            pn.innerHTML = value;\r\n            var tags = pn.getElementsByTagName('*');\r\n            for (var i=0;i<tags.length;i++) if (wlist[tags[i].tagName]!==null) {obj[key] = '';return;}\r\n          }\r\n        })(),\r\n        string: function (key,value,obj){\r\n          if (value.search(/[<>\"'&]/)!=-1) obj[key] = '';\r\n        }\r\n      };\r\n      return function(ary){\r\n        if (ary) for (var j=0;j<ary.length;j++) {\r\n          var obj = ary[j];\r\n          for (var i in obj)\r\n            if (typeof(obj[i])==='string')\r\n              if (i==='com') funcs.html(i, obj[i], obj);\r\n              else funcs.string(i, obj[i], obj);\r\n        }\r\n        return ary;\r\n      }\r\n    })();\r\n    var ls_key_archive = pref.script_prefix + '.archived';\r\n    var list_all_obj = {};\r\n    if (localStorage) load_list();\r\n    if (pref.debug_mode['28']) console.log('list_all_obj: ',list_all_obj);\r\n    var list_all_obj_downloading = {};\r\n    function list_all(){\r\n      if (pref.debug_mode['28']) console.log('list_all_obj_downloading: ',list_all_obj_downloading);\r\n      for (var d in liveTag.mems) {\r\n        var time_unit = site2[d].parse_funcs.post_json.time_unit;\r\n        for (var b in liveTag.mems[d]) {\r\n          var tgt     = list_all_obj[d] && list_all_obj[d][b];\r\n          var tgt_tmp = tgt || {};\r\n          for (var t in liveTag.mems[d][b]) {\r\n            var lth = liveTag.mems[d][b][t];\r\n            var time_checked = list_all_obj_downloading[lth.key] || lth.time_checked/time_unit;\r\n            if (lth.ed_t) time_checked = (pref.archive.editing_timeout)? bug_patch_for_meguca_editing_timeout(lth) || time_checked : lth.ed_t[lth.ed_t.length-1].time - 1; // rewinds to oldest editing post and retry after reload.\r\n            if (lth.archived) {\r\n              if (list_all_obj_downloading[lth.key]) tgt_tmp[t] = list_all_obj_downloading[lth.key];\r\n              else if (!tgt_tmp[t] || tgt_tmp[t]<time_checked) tgt_tmp[t] = time_checked;\r\n            } else if (lth.posts_saved) tgt_tmp[t] = - time_checked; // 'lth.time_checked/time_unit;' can be used here.\r\n//            if (lth.archived && !(lth.key in pref3.archive.list_obj2)) list_all_obj[lth.key] = lth.time_checked; // BUG. NOT implemented yet.\r\n          }\r\n          if (!tgt && Object.keys(tgt_tmp).length!==0) {\r\n            if (!list_all_obj[d]) list_all_obj[d] = {};\r\n            list_all_obj[d][b] = tgt_tmp;\r\n          } else if (tgt && Object.keys(tgt).length===0) delete list_all_obj[d][b];\r\n        }\r\n        if (list_all_obj[d] && Object.keys(list_all_obj[d])===0) delete list_all_obj[d];\r\n      }\r\n    }\r\n    function bug_patch_for_meguca_editing_timeout(lth){\r\n      var time_now = Date.now()/1000;\r\n      for (var i=lth.ed_t.length-1;i>=0;i--) if (typeof(lth.ed_t[i])!=='string') {\r\n        var time = lth.ed_t[i].time;\r\n        if (time_now-time<3600) return time;\r\n      }\r\n      return null;\r\n    }\r\n    function load_list(e){\r\n      if (!e || e.key===ls_key_archive) list_all_obj = JSON.parse(e && e.newValue || localStorage[ls_key_archive] || '{}');\r\n    }\r\n    function save_list(){\r\n      if (pref3.archive.working && localStorage) {\r\n        list_all();\r\n        if (Object.keys(list_all_obj).length===0) delete localStorage[ls_key_archive];\r\n        else localStorage[ls_key_archive] = JSON.stringify(list_all_obj);\r\n        if (pref.debug_mode['28']) console.log('list_all_obj: ',list_all_obj);\r\n      }\r\n    }\r\n    window.addEventListener('storage', load_list, false);\r\n    window.addEventListener('beforeunload', save_list, false);\r\n    return {\r\n      clean_list_all: function(domain, board, nos){\r\n        if (list_all_obj[domain] && list_all_obj[domain][board]) {\r\n          var list_all_obj_bd = list_all_obj[domain][board];\r\n          for (var no in list_all_obj_bd) if (nos[no]===undefined) this.clean_list(domain,board,no);\r\n        }\r\n      },\r\n      clean_list: function(domain,board,no){\r\n        if (list_all_obj[domain] && list_all_obj[domain][board]) delete list_all_obj[domain][board][no]; // Since 4chan has 'delayed pruning', final archiving should be done here.\r\n      },\r\n      check_op: function(th,lth){\r\n        var kwd = pref.archive.kwd;\r\n        if (pref.archive.store_auto && kwd.str && (kwd.sub || kwd.name || kwd.com) &&\r\n            cataLog.threads && cataLog.catalog_filter_query_keyword.kwd(pref.archive.kwd, th.posts, th.domain, th) ||\r\n            this.check_archived_time(th.key, th.domain, th.board, th.no, th.parse_funcs.time_unit)!==false) start_1('ARC', lth, false, true);\r\n      },\r\n      check_archived_time: function(key, domain, board, no, time_unit){\r\n        if (pref.archive.list) {\r\n          var val = pref3.archive.list_obj2[key]; // find d/b/t@xxxx expression\r\n          if (val && val.time) return val.time;\r\n        }\r\n        var val_inherited = list_all_obj[domain] && list_all_obj[domain][board] && list_all_obj[domain][board][no];\r\n        if (pref.archive.list_inherit && val_inherited) return val_inherited;\r\n        if (pref.archive.list) val = pref_func.merge_obj5(key,pref3.archive.list_obj2,null); // find all expresion\r\n        return (val)? val.time/time_unit || val_inherited || 0 : false; // val may be undefined or null.\r\n      },\r\n      update_archived_time: function(name){\r\n        pref3.archive.working = true;\r\n        if (pref3.archive.list_obj2[name] && pref3.archive.list_obj2[name].time) {\r\n          var key = new RegExp('(^|,)'+name.replace(/\\+/,'\\\\+')+'([\\\\^@!][^,\\n]*)*(,|\\n|$)','mg');\r\n//          var millisec = datetime%1000;\r\n//          var time_str = '@' + new Date(datetime).toLocaleString() + ((datetime%1000==0)? '' : '.'+millisec);\r\n//          str = str.value.replace(key,',') + ',' + name + time_str + '\\n';\r\n          pref.archive.list_str = pref.archive.list_str.value.replace(key,',') + ',' + name + '\\n'; // remove time_str\r\n          pref.archive.list_str = str.replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,'');\r\n          pref3.archive.list_obj2[name].time = null;\r\n        }\r\n      },\r\n      store_entry: function(req, downloaded_files){\r\n        if (cataLog.threads) {\r\n          if (pref.archive.src==='shown') for (var name in cataLog.threads) if (cataLog.threads[name][9][0]===null) cataLog.threads[name][9] = cataLog.catalog_filter_query(name, true);\r\n          for (var name in cataLog.threads) {\r\n            var lth = liveTag.mems.getFromName(name);\r\n            if (pref.archive.src==='stored' ||\r\n               (pref.archive.src==='watched' && lth.watched) ||\r\n               (pref.archive.src==='shown' && cataLog.threads[name][9][0])) start_1(req, lth, true);\r\n          }\r\n        }\r\n      },\r\n      start_1: start_1,\r\n      restore_posts_from_IDB: function(value, th,  domain, board, no, result){\r\n        var obj = this.event_funcs['consolidate_IDB_result'](result);\r\n        if (obj.posts.length>1) {\r\n          var lth = th.lth;\r\n////          if (th.posts.length==1) {\r\n////            lth.ta = {\r\n////              posts: obj.posts,\r\n////              nof_posts:obj.posts.length,\r\n////              time_loaded:obj.posts[obj.posts.length-1].time,\r\n////            };\r\n//////          this.store(value, th, lth, null, null, true);\r\n////          } else {\r\n            obj.time_loaded = obj.posts[obj.posts.length-1].time;\r\n            var deletedPosts = this.check_deleted_posts(value, th, lth, obj, true);\r\n            if (lth.archived && deletedPosts && (lth.archived&0x02) && pref.archive.live.post) {\r\n              var suffix_dbt = th.key.replace(/\\//g,'-');\r\n              store_posts(JSON.stringify(site2[th.domain].parse_funcs.thread_json.prep_to_archive(deletedPosts)), 'text/plain', lth, suffix_dbt+'_'+'deleted.json');\r\n            }\r\n////          }\r\n        }\r\n      },\r\n      store_th_to_mem: function(value, th,lth, pf_store, editing_finished){ // for deleted posts detection, search, page mode (, archive).\r\n        if (pf_store!=='no') {\r\n          if (editing_finished && lth.ta.posts) {\r\n            var ta_posts = lth.ta.posts;\r\n            var j=ta_posts.length-1;\r\n            for (var i=editing_finished.length-1;i>=0;i--) {\r\n              while (j>=0 && ta_posts[j].no!=editing_finished[i].no) j--;\r\n              if (j>=0) ta_posts[j] = editing_finished[i];\r\n              else j=ta_posts.length-1;\r\n            }\r\n          }\r\n          var pf_d = pref[cataLog.embed_mode].deleted_posts.detect;\r\n          var posts = (th.posts && th.posts.length>1 && th.nof_posts>th.posts.length && lth.ta && pf_d!=='passive')?\r\n              site2[th.domain].update_posts_replace_prep(th.posts, lth.ta.posts, typeof(pf_store)==='number'? pf_store : -1) :\r\n              (th.parse_funcs.has_posts)? th.posts : lth.ta && lth.ta.posts || th.posts;\r\n          if (!pref.test_mode['65'] && (lth.archived && pref.archive.live.post_idb || pf_d==='full_IDB')) {\r\n            if (!lth.ta && pf_d==='full_IDB') IDB.req(th.domain, th.board, th.no, 'posts', this.restore_posts_from_IDB.bind(this, value, {posts:th.posts, __proto__:th}), 'get_all');\r\n            var time_checked;\r\n            if (lth.ta) time_checked = lth.ta.posts[lth.ta.posts.length-1].time;\r\n            else {\r\n              time_checked = list_all_obj[th.domain] && list_all_obj[th.domain][th.board] && list_all_obj[th.domain][th.board][th.no];\r\n              if (time_checked<0) time_checked = - time_checked;\r\n            }\r\n            var posts_saved;\r\n            if (time_checked && (!lth.ta || lth.ta.posts.length===lth.ta.nof_posts || th.posts.length < th.nof_posts)) {\r\n              var i=th.posts.length;\r\n              while (i>0 && th.posts[i-1].time>time_checked) i--;\r\n              posts_saved = th.posts.slice(i);\r\n            } else posts_saved = th.posts;\r\n            if (editing_finished) posts_saved = editing_finished.concat(posts_saved);\r\n            if (posts_saved.length>0) {\r\n              if (th.type_data==='html') cataLog.format_html.prepare_html_extract_params(th);\r\n              IDB.req(th.domain, th.board, th.no, 'posts', posts_saved, 'put');\r\n              lth.posts_saved = 1;\r\n            }\r\n            if (pref.debug_mode['28'] && posts_saved.length>0) console.log('posts_saved: '+th.key+', '+time_checked+', '+posts_saved[posts_saved.length-1].time+' '+new Date(posts_saved[posts_saved.length-1].time*th.parse_funcs.time_unit).toLocaleString()+', LS:'+(list_all_obj[th.domain] && list_all_obj[th.domain][th.board] && list_all_obj[th.domain][th.board][th.no]));\r\n          }\r\n//          if (!pref.test_mode['65'] && pref.archive.oneshot.post_idb && (lth.archived&0x01)) IDB.req(th.domain, th.board, th.no, 'posts', posts, 'put');\r\n          lth.ta = {\r\n            posts: posts,\r\n            nof_posts:th.nof_posts,\r\n            time_loaded:th.time_loaded,\r\n//            __proto__:th  // for debug.\r\n          };\r\n        } else if (lth.ta) delete lth.ta;\r\n      },\r\n      check_deleted_posts: function(value, th, lth, th_old, fill_IDB){\r\n        if (pref[cataLog.embed_mode].deleted_posts.detect!=='no' && th_old && th_old.posts.length>1) {\r\n          var thp = th.posts;\r\n          var othp = th_old.posts;\r\n          var flag = th.nof_posts === th.posts.length || th.type_source==='thread'; // 'thread' is for safe if inconsistent data is returned.\r\n          var i=1;\r\n          var j=1;\r\n//          if (flag) {i=1;j=1;} // patch for 4chan's inconsistency between catalog_json and thread_json, thread_json returns old data and th_old.posts contains blank in it..\r\n          if (flag) lth.rescan_dp = 0;\r\n          else {\r\n            i = th_old.nof_posts - othp.length +1 -(th.nof_posts - thp.length); // for short posts in 4chan catalog.\r\n            j=1;\r\n            if (i<1) {j+=1-i;i=1;}\r\n          }\r\n          var k=0;\r\n          var m=0;\r\n          var othpd = lth.pd || [];\r\n          var post_deleted;\r\n          var posts_offline = (fill_IDB)? [] : null;\r\n          while (j<othp.length) {\r\n            if (i<thp.length) {\r\n              while (k<othpd.length && thp[i].no>othpd[k].no) k++;\r\n              if (k<othpd.length && thp[i].no==othpd[k].no) {if (!th.native_prep) post_deleted = othpd.splice(k,1); else k++; continue;} // for inconsistent data between thread_json and catalog_json in 4chan.\r\n//              if (j+1<othp.length && othp[j].no === othp[j+1].no) {j++;continue;} // BUG PATCH.\r\n              if (thp[i].no === othp[j].no) {i++;j++;flag=true;continue;}\r\n              if (thp[i].no <   othp[j].no) {if (flag && fill_IDB) posts_offline[posts_offline.length] = thp[i]; // console.log('fill: '+th.no+'#'+thp[i].no); \r\n                                             i++;              continue;}\r\n            }\r\n            while (m<othpd.length && othp[j].no>othpd[m].no) m++;\r\n            if (m<othpd.length && othp[j].no === othpd[m].no) {j++;continue;}\r\n            if (!flag) { // passive detection, deletion of some posts was detected, but I don't know which.\r\n              if (pref[cataLog.embed_mode].deleted_posts.detect.indexOf('full')===0) {lth.rescan_dp=1; scan.list_nup.add_scan(lth);} // can't fild all of them.\r\n              j++;\r\n              continue;\r\n            }\r\n\r\n            post_deleted = othp[j++];\r\n//            while (k<othpd.length && post_deleted.no>=othpd[k].no) k++; // BUG at serial posts are removed.\r\n            if (!post_deleted.deleted_after) {\r\n              if (pref.debug_mode['33'] && (post_deleted.no===undefined || post_deleted.no===null)) alert('Stopped by illegal deleted posts,(BUG)'); // can stop without developer tool\r\n              post_deleted.deleted_after  = th_old.time_loaded;\r\n              post_deleted.deleted_before = value && value.date || null;\r\n//              post_deleted.deleted_debug  = th.type_parse + ', '+ th_old.type_parse + ', last' + (othp.length-j);\r\n              var posts_wrapped = {posts:[th_old.posts[0]].concat(post_deleted), __proto__:th}; // BUG, post may NOT be derived from th.posts[0], html or json. time_unit may differ.\r\n              site2[th.domain].wrap_to_parse.posts(posts_wrapped); // for merge\r\n            }\r\n            othpd.splice(m++,0,post_deleted);\r\n          }\r\n          lth.pd = (othpd.length>0)? othpd : null;\r\n          if (post_deleted) {\r\n            if (pref[cataLog.embed_mode].deleted_posts.store!=='no' && th.domain===site.nickname) {\r\n              var storage = (pref[cataLog.embed_mode].deleted_posts.store==='LS')? localStorage : sessionStorage;\r\n              if (storage) {\r\n                var ls_key = site2[th.domain].ls_key_deletedPosts + th.board + th.no;\r\n                if (othpd.length>0) storage[ls_key] = JSON.stringify(othpd, store_json_func);\r\n                else delete storage[ls_key];\r\n              }\r\n            }\r\n            if (!pref.test_mode['65'] && pref[cataLog.embed_mode].deleted_posts.detect==='full_IDB') this.store_deleted_posts_to_IDB(th, othpd);\r\n//            if (!pref.test_mode['65'] && (lth.archived && pref.archive.live.post_idb || pref[cataLog.embed_mode].deleted_posts.detect==='full_IDB'))\r\n//              IDB.req(th.domain, th.board, th.no, 'posts_deleted', JSON.stringify(othpd, store_json_func), (othpd.length>0)? 'put' : 'delete');\r\n          }\r\n          if (posts_offline && posts_offline.length>0) {\r\n            if (th.domain!==site.nickname) posts_offline = JSON.parse(JSON.stringify(posts_offline, store_json_func)); // for structual clone, remove pn.\r\n            IDB.req(th.domain, th.board, th.no, 'posts', posts_offline, 'put');\r\n          }\r\n          if (pref.debug_mode['19'] && post_deleted && lth.pd)\r\n            for (var i=0;i<lth.pd.length-1;i++)\r\n              if (lth.pd[i].no>=lth.pd[i+1].no)\r\n                console.log('BUG: inorder of posts_deleted: '+th.key+', '+i+', '+lth.pd[i].no+', '+lth.pd[i+1].no);\r\n        }\r\n        return (post_deleted)? othpd : null; // return only if it's changed.\r\n      },\r\n      store_deleted_posts_to_IDB: function(th, othpd){\r\n        IDB.req(th.domain, th.board, th.no, 'posts_deleted', JSON.stringify(othpd, store_json_func), (othpd.length>0)? 'put' : 'delete');\r\n      },\r\n      store_json_func: store_json_func, \r\n      store: function(value, th, lth, posts_new, time_check_old, pf_store, editing_finished){\r\n        var deletedPosts = this.check_deleted_posts(value, th, lth, lth.ta);\r\n        this.store_th_to_mem(value, th,lth, pf_store, editing_finished); // MUST BE AFTER 'check_deleted_posts', because it uses lth.ta for old version of posts and this revises them.\r\n        if (lth.archived) {\r\n          var time_unit = th.parse_funcs.time_unit;\r\n          var time_checked = this.check_archived_time(th.key, th.domain, th.board, th.no, time_unit) || 0;\r\n          time_check_old /= time_unit;\r\n          if (time_checked<time_check_old) time_checked = time_check_old;\r\n//          var time_checked = time_check_old/time_unit || this.check_archived_time(th.key, th.domain, th.board, th.no, time_unit) || 0; // BUG, because time_check_old brings pref.catalog.filter.time_str\r\n          if (!(lth.archived&0x01) && (lth.archived&0x04)) if (th.posts[th.posts.length-1].time<=time_checked || th.time_posted<=time_checked*time_unit) if (!editing_finished) {\r\n            lth.archived &= 0x02;\r\n            return;\r\n          }\r\n//          if (!(lth.archived&0x01) && (lth.archived&0x04)) if (th.posts[th.posts.length-1].time*th.parse_funcs.time_unit<=time_checked || th.time_posted<=time_checked) if (!editing_finished) return;\r\n          if (th.parse_funcs.posts_full) th.parse_funcs.posts_full(th);\r\n          var live_active    = lth.archived&0x02;\r\n          var oneshot_active = lth.archived&0x01;\r\n          var post = live_active && pref.archive.live.post || oneshot_active && pref.archive.oneshot.post;\r\n          var post_idb = live_active && pref.archive.live.post_idb || oneshot_active && pref.archive.oneshot.post_idb;\r\n          var suffix_dbt = th.key.replace(/\\//g,'-');\r\n          if (deletedPosts) {\r\n            if (post) store_posts(JSON.stringify(site2[th.domain].parse_funcs.thread_json.prep_to_archive(deletedPosts)), 'text/plain', lth, suffix_dbt+'_'+'deleted.json');\r\n            if (post_idb && pref[cataLog.embed_mode].deleted_posts.detect!=='full_IDB') this.store_deleted_posts_to_IDB(th, deletedPosts);\r\n          }\r\n//          if (deletedPosts && post) store_posts(JSON.stringify(site2[th.domain].parse_funcs.thread_json.prep_to_archive(deletedPosts)), 'text/plain', lth, suffix_dbt+'_'+'deleted.json');\r\n          var type = (th.type_data==='html')? 'text/html' : 'text/plain';\r\n          var posts_all = (th.type_source==='thread' || th.posts.length===th.nof_posts)? th.posts : (lth.ta && lth.ta.posts.length===th.nof_posts)? lth.ta.posts : null;\r\n          if (post) {\r\n            var sub = (th.posts[0].sub || '').replace(/\\..*/,'');\r\n            var suffix = suffix_dbt + ((pref.archive.sub_in_filename && sub)? '_'+sub : '') + ((th.type_data==='html')? '.html' : '.json');\r\n            if (posts_all) store_posts((th.type_source==='thread')? value.responseText :\r\n                                                                    JSON.stringify(site2[th.domain].parse_funcs.thread_json.prep_to_archive(posts_all), store_json_func),\r\n                                       type, lth, suffix);\r\n            else {this.store_rescan(lth); return;}\r\n          }\r\n          if (posts_new || (lth.archived&0x05) || editing_finished) {\r\n            var tn       = live_active && pref.archive.live.tn       || oneshot_active && pref.archive.oneshot.tn;\r\n            var tn_idb   = live_active && pref.archive.live.tn_idb   || oneshot_active && pref.archive.oneshot.tn_idb;\r\n            var img      = live_active && pref.archive.live.img      || oneshot_active && pref.archive.oneshot.img;\r\n            var img_idb  = live_active && pref.archive.live.img_idb  || oneshot_active && pref.archive.oneshot.img_idb;\r\n            var webm     = live_active && pref.archive.live.webm     || oneshot_active && pref.archive.oneshot.webm;\r\n            var webm_idb = live_active && pref.archive.live.webm_idb || oneshot_active && pref.archive.oneshot.webm_idb;\r\n            if (tn || tn_idb || img || img_idb || webm || webm_idb || post_idb) {\r\n              if (lth.archived&0x05) {\r\n                if (!posts_all && (oneshot_active || (!th.posts[1] || th.posts[1].time>time_checked) && (!lth.ta.posts[1] || lth.ta.posts[1].time>time_checked))) {this.store_rescan(lth); return;}\r\n                if (oneshot_active) posts_new = posts_all;\r\n                else {\r\n                  var posts_src = (th.posts[1] && th.posts[1].time<=time_checked)? th.posts : lth.ta.posts;\r\n                  var i = posts_src.length;\r\n                  while (i>0 && posts_src[i-1].time>time_checked) i--;\r\n                  posts_new = posts_src.slice(i); // posts_src contains posts_new always.\r\n                }\r\n              }\r\n              if (editing_finished) posts_new = editing_finished.concat(posts_new || []);\r\n              if (posts_new.length!=0) {\r\n                if (pref.debug_mode['28']) console.log('archive: '+th.key+', '+posts_new.length+'/'+th.nof_posts);\r\n                var reqs = [];\r\n                if (tn || tn_idb)                       img_dl('tn',  th, lth, posts_new, tn,  tn_idb,  webm, webm_idb, reqs);\r\n                if (img || img_idb || webm || webm_idb) img_dl('img', th, lth, posts_new, img, img_idb, webm, webm_idb, reqs);\r\n                if (reqs.length!=0) {\r\n                  reqs[reqs.length-1].from = th.key;\r\n                  list_all_obj_downloading[th.key] = time_checked;\r\n                  download_url2(reqs);\r\n                }\r\n                if (!pref.test_mode['65'] && post_idb && lth.archived&0x05) IDB.req(th.domain, th.board, th.no, 'posts', posts_new, 'put');\r\n              }\r\n            }\r\n          }\r\n          if (post && (deletedPosts || posts_all) && (!reqs || reqs.length===0 || th.domain!==site.nickname) && pref.archive.tar) flush_req();\r\n          lth.archived &= 0x02;\r\n          this.update_archived_time(th.key);\r\n        }\r\n      },\r\n      store_rescan: function(lth){\r\n        scan.list_nup.add_scan(lth);\r\n        lth.archived |= 0x04;\r\n      },\r\n//      test_dl: function(url){\r\n//        var xhr = download_url2(url, '4chan_test_xxxx_image_'+ url.replace(/.*\\//g,''));\r\n//        xhr.onprogress = function(e){console.log(e.target.responseURL+': '+e.loaded+'/'+e.total);};\r\n//      },\r\n      restore_entry: function(files, imgs, clear_func, posts_deleted){\r\n        var archive = {};\r\n        for (var i=0;i<imgs.length;i++) {\r\n          if (archive[imgs[i].name]===undefined) archive[imgs[i].name] = {file:imgs[i]}; // force to remake url because of having different lifetimes. Old version was '= imgs[i];'\r\n          else if (Array.isArray(archive[imgs[i].name])) archive[imgs[i].name].push({file:imgs[i]});\r\n          else archive[imgs[i].name] = [archive[imgs[i].name], {file:imgs[i]}];\r\n        }\r\n//        for (var i=0;i<imgs.length;i++) archive[imgs[i].name] = {file:imgs[i]}; // force to remake url because of having different lifetimes. Old version was '= imgs[i];'\r\n        var deleted = {};\r\n        if (!pref.test_mode['64'] && pref[cataLog.embed_mode].deleted_posts.merge) for (var i=0;i<posts_deleted.length;i++) deleted[posts_deleted[i].name] = posts_deleted[i];\r\n        var count = 0;\r\n        if (pref.archive.clear_threads && cataLog.threads) cataLog.catalog_clear_threads(0);\r\n        var fileReader = new FileReader();\r\n        var name_deleted;\r\n        fileReader.onerror = function (e){console.log('ERROR at loading json file, '+e);};\r\n        fileReader.onload = function(e){\r\n          if (!name_deleted) {\r\n            restore(files[count-1], fileReader.result, archive);\r\n            if (!pref.test_mode['64'] && pref[cataLog.embed_mode].deleted_posts.merge) {\r\n              name_deleted = files[count-1].name.replace(/(_|\\.).*/,'')+'_deleted.json';\r\n              if (deleted[name_deleted]) {fileReader.readAsText(deleted[name_deleted]); return;}\r\n            }\r\n          } else {\r\n            var name = name_deleted.slice(0,-13).replace(/\\-/g,'/');\r\n            if (pref.test_mode['80']) name = name.replace(/\\/\\d+$/,'_File$&');\r\n            var lth = liveTag.mems.getFromName(name);\r\n            archiver.prep_deleted_posts(lth.th, lth, fileReader.result);\r\n          }\r\n          name_deleted = null;\r\n          if (files.length>count) fileReader.readAsText(files[count++]);\r\n          else if (pref.archive.clear_files) clear_func();\r\n        }\r\n        fileReader.readAsText(files[count++]);\r\n      },\r\n      url2file: function(archive, url){\r\n        var file = archive[url.replace(/[^\\/]*\\//g,'')];\r\n        if (file) {\r\n          if (Array.isArray(file)) file = (url.search(/thumb/)!=-1)? file[0] : file[file.length-1];\r\n          if (!file.url) file.url = window.URL.createObjectURL(file.file);\r\n          return file.url + ((file.file.type==='video/webm')? '\" data-ext=\".webm' : '');\r\n        } else return url;\r\n      },\r\n//      url2file: function(archive, th){ // cause network access because post_json2html makes url begore this.\r\n//        if (!window.URL) return;\r\n//        var tgts = ['src','href'];\r\n//        var all = th.pn.getElementsByTagName('*'); //'*[src],*[href]'\r\n//        for (var i=0;i<all.length;i++)\r\n//          for (var j=0;j<tgts.length;j++) {\r\n//            var url = all[i].getAttribute(tgts[j]);\r\n//            if (url) {\r\n//              var file = archive[url.replace(/[^\\/]*\\//g,'')];\r\n//              if (file) {\r\n//                if (!file.url) file.url = window.URL.createObjectURL(file);\r\n//                all[i].setAttribute(tgts[j], file.url);\r\n//                if (file.type==='video/webm') all[i].setAttribute('data-ext','.webm');\r\n//              }\r\n//            }\r\n//          }\r\n//      },\r\n      prep_deleted_posts: function(th,lth,src, src_obj){\r\n        var posts_deleted = (src)? src_obj || JSON.parse(src) :\r\n          (pref[cataLog.embed_mode].deleted_posts.store==='LS' && localStorage)? sanitize(JSON.parse(localStorage[site2[th.domain].ls_key_deletedPosts + th.board + th.no] || null)) :\r\n          (pref[cataLog.embed_mode].deleted_posts.store==='SS' && sessionStorage)?      JSON.parse(sessionStorage[site2[th.domain].ls_key_deletedPosts + th.board + th.no] || null) : null;\r\n        if (!pref.test_mode['123'] && posts_deleted) { // BUG PATCH\r\n          var nos = {};\r\n          for (var i=0;i<th.posts.length;i++) nos[th.posts[i].no] = null;\r\n          for (var i=posts_deleted.length-1;i>=0;i--) if (!posts_deleted[i].no || nos[posts_deleted[i].no]===null) posts_deleted.splice(i,1);\r\n          if (posts_deleted.length===0) posts_deleted = null;\r\n        }\r\n        if (posts_deleted) {\r\n//          for (var i=0;i<posts_deleted.length;i++) delete posts_deleted[i].pn;\r\n          posts_deleted = site2[th.domain].parse_funcs.thread_json.rip_from_archive(posts_deleted);\r\n          var th_deleted = {posts:[th.posts[0]].concat(posts_deleted),\r\n                            parse_funcs: site2[th.domain].parse_funcs.thread_json,\r\n////                            parse_funcs_html: site2[th.domain].parse_funcs.thread_html,\r\n                            type_parse: 'thread_json',\r\n                            type_source: 'thread',\r\n                            type_data: 'json',\r\n////                            type_html: 'thread_html',\r\n////                            domain_html: th.domain,\r\n//                            nof_posts:th.nof_posts - th.posts.length + posts_deleted.length+1,\r\n                            __proto__:th};\r\n          site2[th.domain].wrap_to_parse.posts(th_deleted, 1);\r\n          if (src && lth.th) {  // NOT DESCRIBED ALL, UNDER IMPLEMENTATION....\r\n            lth.pd = (lth.pd)? site2[th.domain].update_posts_merge_prep(th_deleted.posts, lth.pd, -1, true).slice(1) : posts_deleted;\r\n            if ((cataLog.embed_mode==='page' || cataLog.embed_mode==='thread') && !pref.test_mode['64'] && pref[cataLog.embed_mode].deleted_posts.merge) {\r\n              th.posts = site2[th.domain].update_posts_merge_prep(th.posts, lth.pd, -1, true);\r\n//              cataLog.format_html.update_posts_in_page(th,th.key, null, true);\r\n              cataLog.threads[th.key][16].th = th;\r\n              cataLog.show_catalog(th.key);\r\n            }\r\n            cataLog.Footer.update_force(th.key);\r\n            // CALL UPDATE_POSTS HERE.\r\n          } else lth.pd = posts_deleted;\r\n//          if (src) archiver.check_deleted_posts({date:date_load}, th, {archived:true}, th_deleted); // sourced from pipe.\r\n//          else lth.pd = posts_deleted;\r\n        }\r\n      },\r\n      refresh_start: function(){\r\n        save_list(); // for browser's crash, but this make conflicts when multiple window is opened.\r\n        timestamp=null;\r\n      },\r\n      list_all_obj_downloading: list_all_obj_downloading,\r\n      download_url3: download_url3,\r\n      download_url4: download_url4,\r\n      tar: tar,\r\n      sub_funcs: function(args, callback){\r\n        if (args[0]==='SUB_INIT') {\r\n          cataLog.catalog_clear_threads(0);\r\n          cataLog.auto_update.stop_if_running();\r\n          pref.stats.auto_acquisition = false;\r\n          pref[cataLog.embed_mode].t2h_sel='All';\r\n          if (args[1].IDB) IDB.req(args[1].domain, args[1].board, args[1].no, null,\r\n            (callback)? function(d,b,n,r){archiver.event_funcs['restore3'](d,b,n,r);callback();} : archiver.event_funcs['restore3'].bind(archiver.event_funcs), 'get_all');\r\n          else {\r\n            var tgt = args[1];\r\n            var sel = parseInt(tgt.files_sel,10);\r\n            var files = window.opener.document.getElementsByClassName(pref.script_prefix)[0].querySelectorAll('span[name=\"FILES_ARCHIVE'+sel+'\"]')[0].querySelectorAll('input[type=\"file\"]');\r\n            for (var i=0;i<files.length;i++)\r\n              for (var j=0;j<files[i].files.length;j++) {\r\n                var src = files[i].files[j];\r\n                if (src.name===tgt.name && src.size===tgt.size && src.lastModified===tgt.lastModified) {\r\n                  archiver.event_funcs['restore2'](null, Array.prototype.slice.call(files[i+sel].files), [src]);\r\n                  return;\r\n                }\r\n              }\r\n          }\r\n        } else if (args[0]==='DOWNLOAD') {\r\n          download_url4(args[1][0], args[1][1]);\r\n//          download_url(args[1][0], args[1][1]); // doesn't work\r\n//          send_message(args[1][2],['ARCHIVER', ['REVOKE_URL', args[1][0]]]);\r\n//        } else if (args[0]==='REVOKE_URL') window.URL.revokeObjectURL(args[1]);\r\n        }\r\n      },\r\n      restore: restore,\r\n      event_funcs:pref_func.settings.onchange_funcs.archive,\r\n    };\r\n  })();\r\n \r\n  var recovery = (pref.features.recovery && localStorage)? (function(){\r\n    var key;\r\n    function init(){\r\n      key = site2[site.nickname].ls_key_comment +site.board+site.no;\r\n      var key_old = pref.script_prefix+'.comment.'+site.nickname+site.board+site.no; // patch for half year.\r\n      if (pref.recovery.comment) {\r\n        var comment = localStorage[key] || localStorage[key_old] || '';\r\n        if (comment) {\r\n          if (site.components.postform_comment ) site.components.postform_comment.value  = comment;\r\n          if (site.components.postform_comment2) site.components.postform_comment2.value = comment;\r\n        }\r\n      }\r\n    }\r\n    init();\r\n//    function clear(){if (localStorage) delete localStorage[key];}\r\n    var src = null;\r\n    var com = null;\r\n    function com_changed(){\r\n      src = this;\r\n      delayed_check();\r\n    }\r\n    var delayed_check = new DelayBuffer(check_com,1000).get_binded_delayed_do();\r\n    function check_com(){\r\n      var com_new = src.value;\r\n      if (!com || com.length<=com_new.length) com = com_new;\r\n      src = null;\r\n      delayed_save();\r\n    }\r\n    var delayed_save = new DelayBuffer(save, pref.recovery.interval*1000).get_binded_delayed_do();\r\n    function save(){\r\n      if (com) localStorage[key] = com;\r\n      else delete localStorage[key];\r\n      com = null;\r\n    }\r\n    function save_at_exit(){\r\n      if (src) com = src.value;\r\n      if (com!==null) save();\r\n    }\r\n    function setup(rec_inst,postform_comment,postform_submit){\r\n      if (!rec_inst && pref.recovery.comment && postform_comment) {\r\n        var func = com_changed.bind(postform_comment);\r\n        postform_comment.addEventListener('change',func,false);\r\n        postform_comment.addEventListener('keyup',func,false);\r\n        postform_submit.addEventListener('click',func,false);\r\n        rec_inst = [postform_comment, postform_submit, func];\r\n      } else if (rec_inst && (!pref.recovery.comment || !postform_comment)) {\r\n        rec_inst[0].removeEventListener('change',rec_inst[2],false);\r\n        rec_inst[0].removeEventListener('keyup',rec_inst[2],false);\r\n        rec_inst[1].removeEventListener('click',rec_inst[2],false);\r\n        rec_inst = null;\r\n      }\r\n      return rec_inst;\r\n    }\r\n    var rec_inst = setup(null, site.components.postform_comment, site.components.postform_submit);\r\n    var rec_inst2 = null;\r\n    window.addEventListener('beforeunload', save_at_exit, false);\r\n    return {\r\n      setup: function(){\r\n        rec_inst  = setup(rec_inst, site.components.postform_comment, site.components.postform_submit);\r\n        rec_inst2 = setup(rec_inst2,site.components.postform_comment2,site.components.postform_submit2);\r\n      },\r\n      setup2: function(){rec_inst2 = setup(rec_inst2,site.components.postform_comment2, site.components.postform_submit2);},\r\n//      clear: clear,\r\n      reentry: function(){\r\n        save_at_exit();\r\n        init();\r\n      },\r\n    }\r\n  })() : null;\r\n\r\n  var scan = (function(){\r\n////    list_nup_boards : Object.create(null), // list of next updates of boards.\r\n////    list_nup : Object.create(null), // list of next updates.\r\n    var list_nup = {\r\n      // th.u: 0:ready, >0:requested, <0:blacklisted\r\n      add: function(th, priority, force_thread){ // -1:locked, [1:0]:req, [2]:req_thread, [3]:force_json, [7:4]:priority,\r\n        if (typeof(th)==='string') th = this.get_th(th);\r\n        priority = (priority || 0) <<4;\r\n        if (th.u===0) th.u = priority | ((force_thread)? 7 : 3);\r\n        else if (th.u>0 && th.u<priority) th.u = priority | (th.u&0x0f);\r\n      },\r\n      add_scan: function(th){\r\n        this.add(th);\r\n        scan.scan_threads_delayed_do();\r\n      },\r\n      issued: function(th){\r\n        if (typeof(th)==='string') th = this.get_th(th);\r\n        if (th) th.u = (((th.u&0x03)===1)? 0xffffff00 : 0) | ((th.u===0)? 2 : th.u-1); // 'if (th)' for page(p0, p1...) // keep upper bits.\r\n        return th && th.no && th.archived;\r\n      },\r\n      got_200: function(th){\r\n        var lth = this.get_th(th.key);\r\n        if (lth.u!==0 && (!(lth.u&0x04) || th.type_source==='thread')) lth.u = 0; // not create instances for future implementation.\r\n      },\r\n      got_404: function(th){\r\n        if (typeof(th)==='string') th = this.get_th(th);\r\n        if (th) th.u = -1;\r\n      },\r\n      get_th: function(key){\r\n        var dbt = common_func.fullname2dbt(key);\r\n        if (dbt[2].search(/(p|q)[0-9]+$/)!=-1) return null; // prevent board to be blacklisted when over page loading.\r\n        if (dbt[2][0]==='t') dbt[2] = dbt[2].substr(1);\r\n        else if (dbt[2].search(/^[0-9]/)==-1) dbt[2] = '';\r\n        return liveTag.mems.init({domain:dbt[0], board:dbt[1], no:dbt[2]});\r\n      },\r\n      priority_th: [0, 0x10, 0x20, 0x30, 0x40, 0x50, 0x60, 0x70, 0x80, 0x90, 0xa0, 0xb0, 0xc0, 0xd0, 0xe0, 0xf0, 0x100],\r\n      get_list_thread: function(d, priority){\r\n        var req_th = this.priority_th[priority || 0];\r\n//        var req_th_u = this.priority_th[(priority || 0)+1];\r\n        var count = 0;\r\n        for (var b in liveTag.mems[d])\r\n          for (var t in liveTag.mems[d][b])\r\n           if (liveTag.mems[d][b][t].u>req_th) count++;            \r\n//           if (liveTag.mems[d][b][t].u>req_th && liveTag.mems[d][b][t].u<req_th_u) count++;\r\n        return (count===0)? null : [count, (function*(req_th){\r\n          for (var b in liveTag.mems[d])\r\n            for (var t in liveTag.mems[d][b])\r\n              if (liveTag.mems[d][b][t].u>req_th) yield liveTag.mems[d][b][t]; // for getting robustness\r\n//              if (liveTag.mems[d][b][t].u>req_th && liveTag.mems[d][b][t].u<req_th_u) yield liveTag.mems[d][b][t];\r\n        })(req_th)];\r\n      },\r\n      get_list_thread2: function(d, priority){ // working code.\r\n        var req_th = this.priority_th[priority || 0];\r\n        var list = [];\r\n//        for (var d in liveTag.mems)\r\n        for (var b in liveTag.mems[d])\r\n          for (var t in liveTag.mems[d][b])\r\n            if (liveTag.mems[d][b][t].u>req_th) list[list.length] = liveTag.mems[d][b][t];\r\n        return list;\r\n      },\r\n      get_list_board: function(d, priority){\r\n        var req_th = this.priority_th[priority || 0];\r\n//        var req_th_u = this.priority_th[(priority || 0)+1];\r\n        var count = 0;\r\n        for (var b in liveTag.mems[d])\r\n          if (liveTag.mems[d][b].u>req_th) count++;\r\n//          if (liveTag.mems[d][b].u>req_th && liveTag.mems[d][b].u<req_th_u) count++;\r\n        return (count===0)? null : [count, (function*(req_th){\r\n          for (var b in liveTag.mems[d])\r\n            if (liveTag.mems[d][b].u>req_th) yield liveTag.mems[d][b];\r\n//            if (liveTag.mems[d][b].u>req_th && liveTag.mems[d][b].u<req_th_u) yield liveTag.mems[d][b];\r\n        })(req_th)];\r\n      },\r\n      get_list_board2: function(d, priority){\r\n        var req_th = this.priority_th[priority || 0];\r\n        var list = [];\r\n        for (var b in liveTag.mems[d])\r\n          if (liveTag.mems[d][b].u>req_th) list[list.length] = liveTag.mems[d][b];\r\n        return list;\r\n      },\r\n//      add_domain: function(domain){liveTag.mems[domain].u = 1;},\r\n      add_domain: function(domain, force_thread, boards){\r\n        var max_boards = pref4.scan.max; // invoke getter\r\n        if (!liveTag.active.pk){\r\n          if (!boards) {\r\n            for (var b in liveTag.mems[domain])\r\n              if (liveTag.mems[domain][b].o!==null && liveTag.mems[domain][b].o < max_boards) this.add_board(domain+b, null, force_thread);\r\n          } else for (var i=0;i<boards.length;i++) this.add_board(domain+boards[i], null, force_thread);\r\n        } else {\r\n          if (boards) {\r\n            for (var b in liveTag.mems[domain]) { // working code for '>'\r\n              if (liveTag.tags[liveTag.mems[domain][b].btag].pk) this.add_board(domain+b, null, force_thread);\r\n              var btag2 = liveTag.mems[domain][b].btag2;\r\n              if (btag2) {\r\n                for (var i=0;i<btag2.length;i++)\r\n                  if (liveTag.tags[btag2[i]].pk) this.add_board(domain+b, null, force_thread);\r\n              }\r\n            }\r\n          } else {\r\n            for (var i=0;i<max_boards;i++) if (liveTag.tags_array_old[i]) {\r\n              for (var bt of liveTag.tags[liveTag.tags_array_old[i].key].mems.keys())\r\n                if (!bt.no) this.add_board(bt, null, force_thread);\r\n                else this.add(bt, null, force_thread);\r\n            }\r\n          }\r\n        }\r\n      },\r\n      add_board: function(bd, priority, force_thread, use_boards_json, force_json){\r\n        if (typeof(bd)==='string') bd = this.get_th(bd);\r\n        if (force_thread===2) { // preparation read for search posts\r\n          for (var t in bd) if (!bd[t].ta || bd[t].nof_posts!==bd[t].ta.posts.length) this.add(bd[t], priority, true);\r\n          return;\r\n        }\r\n        if (!use_boards_json || bd.read_max<bd.max) {\r\n          var upper_bits = ((priority || 0) <<4) | ((force_json)? 8 : 0) | ((force_thread)? 4 : 0);\r\n          if (bd.u===0) bd.u = upper_bits | 3;\r\n          else if (bd.u>0 && bd.u<priority) bd.u = upper_bits | (bd.u&0x0f);\r\n        }\r\n//        if (force_thread) for (var t in bd) this.add(bd[t], priority, force_thread); // BUG, bd had no members at initial, threads scan doesn't scheduled.\r\n      },\r\n////      add_board: function(bd, use_boards_json, force_thread, priority){ // working code.\r\n////        if (typeof(bd)==='string') bd = this.get_th(bd);\r\n//////        if (bd.u===0) bd.u = 3;\r\n////        if (bd.u===0 && (!use_boards_json || bd.read_max<bd.max)) bd.u = 3;\r\n//////        bd.u = 3;\r\n//////        if (time) {\r\n//////          if (bd.max) bd.read_max = bd.max;\r\n//////          bd.read_time = time;\r\n//////        }\r\n////        if (force_thread) for (var t in bd) this.add(bd[t], force_thread);\r\n////      },\r\n      got_200_board: function(bd){\r\n        if (typeof(bd)==='string') bd = this.get_th(bd);\r\n        if (bd.u&0x04) for (var t in bd) this.add(bd[t], bd.u&0x00f0, true);\r\n        if (bd.max) bd.read_max = bd.max;\r\n        bd.u = 0;\r\n      },\r\n//      add_board: function(bd, time){ // working code.\r\n//        if (typeof(bd)==='string') bd = this.get_th(bd);\r\n////        if (bd.u===0) bd.u = 3;\r\n//        bd.u = 3;\r\n//        if (bd.max) bd.read_max = bd.max;\r\n//        bd.read_time = time;\r\n//      },\r\n////      get_list_board: function(d){ // working code.\r\n////        var list = [];\r\n//////        var time_th = Date.now()-pref.liveTag.pickup_interval*1000;\r\n//////        for (var d in liveTag.mems) {\r\n////////          if (liveTag.mems[d].u) { // for 'add_domain' // working code.\r\n////////            for (var b in liveTag.mems[d]) if (liveTag.mems[d][b].o!==null && liveTag.mems[d][b].o < pref.scan.max) this.add_board(d+b);\r\n////////            liveTag.mems[d].u = 0;\r\n////////          }\r\n//////          if (domain && d!==domain) continue;\r\n////        for (var b in liveTag.mems[d]) {\r\n////          var tgt = liveTag.mems[d][b];\r\n//////          if (tgt.u>0) if (tgt.read_time<time_th && (tgt.max===undefined || !pref.liveTag.utilize_boards_json || tgt.read_max<tgt.max)) list[list.length] = tgt;\r\n//////          if (tgt.u>0) if (tgt.max===undefined || !pref.liveTag.utilize_boards_json || tgt.read_max<tgt.max) list[list.length] = tgt;\r\n////          if (tgt.u>0) list[list.length] = tgt;\r\n////        }\r\n////        return (list.length!==0)? list : null;\r\n////      },\r\n//      query_list_board: function(domain){ // working code.\r\n//        var d = liveTag.mems[domain];\r\n//        if (d)\r\n//          for (var b in d)\r\n//            if (d[b].u>0) return true;\r\n//        return false;\r\n//      },\r\n      scan_boards_enumerate: function(domain, func, ex_list){\r\n        var thread_or_domain = pref.virtualBoard.scan_domains[domain]==='thread' || ex_list.has(liveTag.mems[domain]);\r\n        var max_boards = pref4.scan.max; // invoke getter\r\n        for (var b in liveTag.mems[domain])\r\n          if (thread_or_domain || Object.keys(liveTag.mems[domain][b]).length!=0)\r\n//            if (ex_list[liveTag.mems[domain][b].key]===undefined) // prevent multiple scan.\r\n            if (!ex_list.has(liveTag.mems[domain][b])) // prevent multiple scan.\r\n              if (liveTag.mems[domain][b].o!==null && liveTag.mems[domain][b].o < max_boards)\r\n                if (!func || func(liveTag.mems[domain][b])) return true;\r\n      },\r\n    };\r\n    var Scanner = function(type, domain, priority, key){ // type: 'b':boards, 't':threads\r\n      this.type = type;\r\n      this.domain = domain;\r\n      this.key = key;\r\n      this.priority = priority || 0;\r\n      this.scanners[key] = this; // and also this.wdg, this.req\r\n    };\r\n    Scanner.prototype = {\r\n      scanners: Object.create(null),\r\n      func_entry: function(){\r\n        var tgts;\r\nif (!pref.test_mode['51']) { // 1-3 times faster than generator.\r\n        tgts = (this.type==='b')? scan.list_nup.get_list_board2(this.domain, this.priority) : scan.list_nup.get_list_thread2(this.domain, this.priority);\r\n        if (tgts.length!=0) this.func_scan(tgts,null);\r\n        else this.exit();\r\n} else {\r\n        tgts = (this.type==='b')? scan.list_nup.get_list_board(this.domain, this.priority) : scan.list_nup.get_list_thread(this.domain, this.priority);\r\n        if (tgts) this.func_scan(tgts,{tgts_iterator:tgts[1], max:tgts[0]});\r\n        else this.exit();\r\n}\r\n      },\r\n      func_scan: function(tgts,options, multi_entry){\r\n        if (!this.wdg) this.wdg = new Watchdog(this.abort.bind(this),30000);\r\n        cataLog.scan_init(this.key, tgts, {callback: this.func_cont.bind(this),\r\n                                           watchdog: this.wdg.restart.bind(this.wdg),\r\n                                           priority: this.priority,\r\n                                           __proto__: options\r\n                                          }, multi_entry);\r\n      },\r\n      func_cont: function() {\r\n        if (this.req) {\r\n          this.req = false;\r\n          this.func_entry();\r\n        } else this.exit();\r\n      },\r\n      exit: function(){\r\n        if (this.wdg) this.wdg.stop();\r\n        this.scanners[this.key] = null\r\n        if (this.type==='b') {\r\n          if (!this.aborted) scan.scan('t', this.domain, this.priority);\r\n        } else if (this.type==='t' && cataLog.catalog_refresh_end) cataLog.catalog_refresh_end();\r\n        if (this.callback) this.callback();\r\n        var priority_next = get_highest_priority(this.type, this.domain);\r\n        var key_next = get_key(this.type, this.domain, priority_next);\r\n        if (this.scanners[key_next]===false) new Scanner(this.type, this.domain, priority_next, key_next).func_entry(); // do scheduled task, but this may not occur.\r\n      },\r\n      abort: function(){\r\n        if (pref.debug_mode['7']) console.log('Scanner_abort: '+this.key);\r\n        cataLog.scan_boards.scan_abort(this.key);\r\n        if (this.aborted===undefined) {\r\n          this.aborted = true;\r\n          this.wdg.restart();\r\n        } else this.exit();\r\n      },\r\n    };\r\n    var ScannerUI = function(key, arg){ // arg is {tgts:, options:}\r\n      this.key = key;\r\n      this.arg = arg;\r\n      this.scanners[key] = this;\r\n      this.callback = this.arg.options && this.arg.options.callback;\r\n    };\r\n    ScannerUI.prototype = {\r\n      scanners: Object.create(null),\r\n      priority: 8,\r\n      func_entry: function(){\r\n        this.func_scan(this.arg.tgts, this.arg.options, true);\r\n      },\r\n      func_cont: function() {\r\n        if (this.queue && this.queue.length>0) {\r\n          this.arg = this.queue.shift();\r\n          this.func_entry();\r\n        } else this.exit();\r\n      },\r\n      __proto__: Scanner.prototype\r\n    };\r\n    function get_key(type, domain, priority){\r\n      return ((type==='b')? 'scan' : 'scan_threads')+ '_' + domain + ':' + (priority || 0);\r\n    }\r\n    function get_highest_priority(type, domain){\r\n      var key_pre = get_key(type, domain, 0).replace(/0$/,'');\r\n      for (var p=8;p>=0;p--) {\r\n        var scanner = Scanner.prototype.scanners[key_pre+p];\r\n        if (scanner || scanner===false) return p;\r\n      }\r\n      return -1;\r\n    }\r\n    var scan_refresh_ex_list = new Set();\r\n    return {\r\n      scan_refresh: function(health_indicator, list, priority, list_domains){\r\n        scan_refresh_ex_list.clear();\r\n        for (var i=0;i<list.length;i++) {\r\n          var dbt = common_func.name2domainboardthread(list[i],true);\r\n          if (dbt[2].search(/^[cj]/)===0) scan_refresh_ex_list.add(liveTag.mems[dbt[0]][dbt[1]]);\r\n          else if (dbt[2].search(/^t*[0-9]+/)===0) scan_refresh_ex_list.add(liveTag.mems[dbt[0]][dbt[1]][(dbt[2][0]==='t')? dbt[2].substr(1) : dbt[2]]); // redundant.\r\n        }\r\n        for (var i in list_domains) scan_refresh_ex_list.add(liveTag.mems[i]);\r\n        scan.scan('t', null, priority);\r\n        if (!pref.liveTag.use)\r\n          for (var tag in liveTag.tags) // activate selected tags for NOT liveTag mode. In this case, tags are not many.\r\n            if (liveTag.tags[tag].pk)\r\n              for (var bt of liveTag.tags[tag].mems.keys())\r\n                if (!scan_refresh_ex_list.has(bt))\r\n                  if (bt.no) scan.list_nup.add(bt,2);\r\n                  else scan.list_nup.add_board(bt,2);\r\n        for (var d in liveTag.mems) {\r\n          if (pref.liveTag.use) {\r\n            if (site2[d].utilize_boards_json && pref.pref2[d].utilize_boards_json) {\r\n              if (list_nup.scan_boards_enumerate(d, null, scan_refresh_ex_list))\r\n                site2[d].get_boards_json('boards_'+d,(function(domain){return function(){scan.scan_refresh_1(domain, true);}})(d),true,health_indicator);\r\n              else scan.scan('t', d);\r\n            } else scan.scan_refresh_1(d, false);\r\n          } else scan.scan('b', d);\r\n        }\r\n      },\r\n      scan_refresh_1: function(domain, use_boards_json){\r\n        list_nup.scan_boards_enumerate(domain, function(bd){scan.list_nup.add_board(bd, null, null, use_boards_json);}, scan_refresh_ex_list);\r\n        scan.scan('b', domain);\r\n      },\r\n//      scan_refresh_move_req: function(list){ // working code.\r\n//        for (var i=0;i<list.length;i++) {\r\n//          var dbt = common_func.name2domainboardthread(list[i],true);\r\n//          if (dbt[2].search(/^[cj]/)===0) {\r\n//            scan.list_nup.add_board(dbt[0]+dbt[1]);\r\n//            list.splice(i--,1);\r\n//          } else if (dbt[2].search(/^t*[0-9]+/)===0) {\r\n//            scan.list_nup.add(dbt[0]+dbt[1]+((dbt[2][0]==='t')? dbt[2].substr(1) : dbt[2]));\r\n//            list.splice(i--,1);\r\n//          }\r\n//        }\r\n//      },\r\n      scan: function(type, domain, priority){\r\n        if (!domain) for (var d in liveTag.mems) this.scan(type, d, priority);\r\n        else {\r\n          var key = get_key(type, domain, priority);\r\n          var scanner = Scanner.prototype.scanners[key];\r\n          if (scanner) scanner.req = true; // multi entry.\r\n          else if (get_highest_priority(type, domain)>=priority) Scanner.prototype.scanners[key] = false; // schedule\r\n          else if (type==='b' && (scanner = Scanner.prototype.scanners[get_key('t', domain, priority)]))\r\n            scanner.callback = function(){scan.scan(type, domain, priority);}; // schedule\r\n          else new Scanner(type, domain, priority, key).func_entry();\r\n        }\r\n      },\r\n      abort: function(){\r\n        for (var s in Scanner.prototype.scanners) {\r\n          var scanner = Scanner.prototype.scanners[s];\r\n          if (scanner) {\r\n            if (scanner.wdg) scanner.wdg.stop();\r\n            scanner.abort();\r\n          }\r\n        }\r\n      },\r\n      scan_ui: function(key, arg){\r\n        new ScannerUI(key, arg).func_entry();\r\n//        var scanner = ScannerUI.prototype.scanners[key];\r\n//        if (scanner) {\r\n//          if (!this.queue) this.queue = [];\r\n//          this.queue[this.queue.length] = arg; // multi entry.\r\n//        } else new ScannerUI(key, arg).func_entry();\r\n      },\r\n      scan_threads_delayed_do: DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(function(){scan.scan('t');}, 200)),\r\n      keyword_load: function(force, health_indicator){\r\n        var flag = true;\r\n        for (var domain in pref.virtualBoard.scan_domains) {\r\n          if (pref.virtualBoard.scan_domains[domain]!=='none') {\r\n            this.keyword_load_1(domain, force, null, health_indicator);\r\n            flag = false;\r\n          }\r\n        }\r\n        if (flag) this.keyword_load_1(site.nickname, force, null, health_indicator);\r\n      },\r\n      keyword_load_1: function(domain, force, boards, health_indicator){\r\n//          if (!site3[domain].boards && (domain===site.nickname || pref.virtualBoard.scan_domains[domain]!=='none')) {\r\n        if (!site3[domain].boards && ((!force && pref.virtualBoard.scan_domains[domain]!=='none') ||\r\n                                       (force && liveTag.active.pk) || !boards)) {\r\n          site2[domain].get_boards_json('kwd_load',function(){scan.keyword_load_1(domain, force, boards, health_indicator)},false,health_indicator);\r\n          return;\r\n        }\r\n//          if (domain===site.nickname || pref.virtualBoard.scan_domains[domain]==='thread') {\r\n//          if (pref.virtualBoard.scan_domains[domain]!=='none' || force) {\r\n        if (pref.virtualBoard.scan_domains[domain]==='thread' || force) {\r\n          scan.list_nup.add_domain(domain, pref.catalog.filter.kwd.post && force, boards);\r\n          scan.scan('b',domain);\r\n        }\r\n      },\r\n      list_nup: list_nup,\r\n    };\r\n  })();\r\n\r\n  function make_catalog_obj(pn12_button){\r\n    var catalog_func = null;\r\n    function show_hide(){\r\n      if (catalog_func===null) catalog_func = make_catalog();\r\n      else catalog_func = catalog_func.destroy();\r\n    }\r\n    var embed_catalog;\r\n    var embed_page;\r\n    var embed_frame;\r\n    var embed_mode;\r\n    var embed_embed;\r\n    function set_embed_xxxx(){\r\n      embed_catalog = pref.catalog.embed && site.whereami==='catalog' || pref.catalog.embed_archive && site.whereami==='archive';\r\n      embed_page    = pref.catalog.embed_page && site.whereami==='page';\r\n      embed_frame   = pref.catalog.embed_frame && site.whereami==='frame';\r\n      embed_mode = (embed_catalog)? 'catalog' :\r\n                   (embed_page)? 'page' :\r\n                   (pref.thread.embed && site.whereami==='thread')? 'thread' : 'float';\r\n      embed_embed = embed_mode!=='float';\r\n      cataLog.embed_mode = embed_mode; // this will be did in later, but do here also for meguca reentry.\r\n    }\r\n    cataLog.set_embed_xxxx = set_embed_xxxx;\r\n    set_embed_xxxx();\r\n    if (pn12_button) pn12_button.addEventListener('click', show_hide, false); // show_hide\r\n    styleSheet.init(embed_mode); // patch, but WHY???\r\n    if (!pref.test_mode['98'] && embed_mode==='catalog') styleSheet.register('.backlink','display:inline;font-size:0.8em;');\r\n//if (!(brwsr.ff && embed_mode==='catalog' && site.nickname==='4chan')) styleSheet.init(); // patch, but WHY???\r\n////////if (!(brwsr.ff && embed_mode==='catalog' && site.nickname==='4chan')) { // patch, but WHY??? // working code.\r\n//////////    var ss = document.styleSheets[document.styleSheets.length-1];\r\n//////////    if (!ss) {\r\n//////////      var ss = document.createElement('style');\r\n//////////      document.head.appendChild(ss);\r\n//////////      ss = ss.sheet;\r\n//////////    }\r\n////////    var ss = document.head.appendChild(document.createElement('style')).sheet;\r\n////////    ss.insertRule('.catalog_triage_parent {pointer-events: none;}',0); \r\n////////    ss.insertRule('.catalog_triage_button {pointer-events: auto;}',1);\r\n////////    pref_func.style_sheet = ss;\r\n////////    pref_func.settings.onchange_funcs['catalog.click_area_add_rule'](); // rule 2.\r\n////////    ss.insertRule('.'+pref.script_prefix+'_tag {cursor:pointer;}',3);\r\n////////}\r\n\r\n    function scan_tags_common(ths,html_str,tags_obj){\r\n      var acc = true;\r\n      if (tags_obj===undefined) {\r\n        tags_obj = {cs:{}, ci:{}};\r\n        acc = false;\r\n      }\r\n      for (var i in ths) {\r\n        var tags_th = ths[i].tags;\r\n        if (tags_th) {\r\n          var dbt = cnst.name2domainboardthread(i,true);\r\n          var tags_th_uniq = {};\r\n          for (var j=tags_th.length-1;j>=0;j--)\r\n            if (tags_th_uniq[tags_th[j]]===undefined) tags_th_uniq[tags_th[j]] = null; // BUG. #aaa and #AAA are counted as 2 in case insensitive mode.\r\n            else tags_th.splice(j,1);\r\n          if (tags_th.length<=pref.catalog.tag.max) {\r\n            var end = (pref.catalog.tag.ignore<tags_th.length)? pref.catalog.tag.ignore : tags_th.length;\r\n            for (var j=0;j<end;j++) {\r\n              for (var k in tags_obj) {\r\n                var tag_test = (k==='cs')? tags_th[j] : tags_th[j].toLowerCase();\r\n                if (tags_obj[k][tag_test]===undefined) tags_obj[k][tag_test] = {num:1,mem:{}};\r\n                else tags_obj[k][tag_test].num++;\r\n                if (!tags_obj[k][tag_test].mem[dbt[0]+dbt[1]]) tags_obj[k][tag_test].mem[dbt[0]+dbt[1]] = 1;\r\n                else tags_obj[k][tag_test].mem[dbt[0]+dbt[1]]++;\r\n      }}}}}\r\n      if (!acc) return scan_tags_common_b(tags_obj,html_str,{cs:[],ci:[]})[0];\r\n    }\r\n    function scan_tags_common_b(tags_obj, html_str, tags){ // CAN'T FIND 1->0 AT A BOARD.\r\n      for (var i in tags_obj) {\r\n        for (var j in tags_obj[i]) {\r\n          var tag_ref = (i==='cs')? j : j.toLowerCase();\r\n          for (var n=0;n<tags[i].length;n++) {\r\n            var tag_test = (i==='cs')? tags[i][n].key : tags[i][n].key.toLowerCase();\r\n            if (tag_ref===tag_test) {\r\n              for (var k in tags_obj[i][j].mem) tags[i][n].mem[k] = tags_obj[i][j].mem[k]; // update.\r\n//var old = tags[i][n].num;\r\n              tags[i][n].num = 0;\r\n              for (var k in tags[i][n].mem) tags[i][n].num += tags[i][n].mem[k];\r\n//if (old!=tags[i][n].num) console.log(i+', '+j+', '+n+', '+tag_test+', '+old+', '+tags[i][n].num);\r\n              delete tags_obj[i][j]; // works in Chrome and FF, BUT DANGEROUS?\r\n              break;\r\n            }\r\n          }\r\n        }\r\n        for (var j in tags_obj[i]) tags[i].push({key:j, num:tags_obj[i][j].num, mem:tags_obj[i][j].mem});\r\n//        tags[i].sort(function(a,b){return b.num - a.num;});\r\n        tags[i].sort(function(a,b){return (b.num!=a.num)? b.num - a.num : (b.key > a.key)? -1:1;});\r\n      }\r\n      for (var i=0;i<tags.ci.length;i++) {\r\n        var key = tags.ci[i].key.toLowerCase();\r\n        for (var j=0;j<tags.cs.length;j++)\r\n          if (key===tags.cs[j].key.toLowerCase()) {tags.ci[i].key=tags.cs[j].key; break;}\r\n      }\r\n      return scan_tags_common_c(tags, html_str);\r\n    }\r\n    function scan_tags_common_c(tags, html_str){\r\n      var tags_tgt = (pref.catalog.filter.tag_ci)? tags.ci : tags.cs;\r\n      var str2 = '';\r\n      for (var i=0;i<tags_tgt.length;i++) {\r\n        var item = tags_tgt[i].num + ': ' + tags_tgt[i].key;\r\n        str2 = str2 + '<input type=\"checkbox\"' + html_str + '> '+item + '<br>';\r\n      }\r\n      return [str2, tags];\r\n    }\r\n//    function scan_tags_common(ths,html_str,tags_obj){\r\n//      var acc = true;\r\n//      if (tags_obj===undefined) {\r\n//        tags_obj = {cs:{}, ci:{}};\r\n//        acc = false;\r\n//      }\r\n//      for (var i in ths) {\r\n//        var tags_th = ths[i].tags;\r\n//        if (tags_th) {\r\n//          var dbt = cnst.name2domainboardthread(i,true);\r\n//          var tags_th_uniq = {};\r\n//          for (var j=tags_th.length-1;j>=0;j--)\r\n//            if (tags_th_uniq[tags_th[j]]===undefined) tags_th_uniq[tags_th[j]] = null;\r\n//            else tags_th.splice(j,1);\r\n//          if (tags_th.length<=pref.catalog.tag.max) {\r\n//            var end = (pref.catalog.tag.ignore<tags_th.length)? pref.catalog.tag.ignore : tags_th.length;\r\n//            for (var j=0;j<end;j++) {\r\n//              for (var k in tags_obj) {\r\n//                var tag_test = (k==='cs')? tags_th[j] : tags_th[j].toLowerCase();\r\n//                if (tags_obj[k][tag_test]===undefined) tags_obj[k][tag_test] = {num:0,mem:{}};\r\n//                tags_obj[k][tag_test].num++;\r\n//                tags_obj[k][tag_test].mem[dbt[0]+dbt[1]] = null;\r\n//      }}}}}\r\n//      if (!acc) return scan_tags_common_b(tags_obj,html_str)[0];\r\n//    }\r\n//    function scan_tags_common_b(tags_obj,html_str){\r\n//      var tags = [];\r\n//      for (var i in tags_obj.cs) tags.push({key:i, num:tags_obj.cs[i].num, mem:tags_obj.cs[i].mem});\r\n//      tags.sort(function(a,b){return b.num - a.num;});\r\n//      if (pref.catalog.filter.tag_ci) {\r\n//        for (var i=0;i<tags.length-1;i++) {\r\n//          var key = tags[i].key.toLowerCase();\r\n//          tags[i].num = tags_obj.ci[key].num;\r\n//          tags[i].mem = tags_obj.ci[key].mem;\r\n//          for (var j=tags.length-1;j>i;j--) if (key===tags[j].key.toLowerCase()) tags.splice(j,1);\r\n//        }\r\n//        tags.sort(function(a,b){return b.num - a.num;});\r\n//      }\r\n//      var str2 = '';\r\n//      for (var i=0;i<tags.length;i++) {\r\n//        var item = tags[i].num + ': ' + tags[i].key;\r\n//        str2 = str2 + '<input type=\"checkbox\"' + html_str + '> '+item + '<br>';\r\n//      }\r\n//      return [str2, tags];\r\n//    }\r\n////    function scan_tags_common(ths,html_str,tags_obj,acc){\r\n////      if (tags_obj===undefined) tags_obj = {};\r\n//////      var tags_obj = {};\r\n////      for (var i in ths) {\r\n////        var tags_th = ths[i].tags;\r\n////        if (tags_th) {\r\n////          var tags_th_uniq = {};\r\n////          for (var j=tags_th.length-1;j>=0;j--)\r\n////            if (tags_th_uniq[tags_th[j]]===undefined) tags_th_uniq[tags_th[j]] = null;\r\n////            else tags_th.splice(j,1);\r\n////          if (tags_th.length<=pref.catalog.tag.max) {\r\n////            var end = (pref.catalog.tag.ignore<tags_th.length)? pref.catalog.tag.ignore : tags_th.length;\r\n////            for (var j=0;j<end;j++) {\r\n////              if (tags_obj[tags_th[j]]===undefined) tags_obj[tags_th[j]] = [0,{}];\r\n////              tags_obj[tags_th[j]][0]++;\r\n////              tags_obj[tags_th[j]][1][i] = 0;\r\n////            }\r\n////          } \r\n////        }\r\n////      }\r\n////      if (!acc) return scan_tags_common_b(tags_obj,html_str);\r\n////    }\r\n////    function scan_tags_common_b(tags_obj,html_str){\r\n////      var tags = [];\r\n////      for (var i in tags_obj) tags.push({key:i, val:tags_obj[i][0], mem:tags_obj[i][1]});\r\n////      tags.sort(function(a,b){return b.val - a.val;});\r\n////      if (pref.catalog.filter.tag_ci) {\r\n////        for (var i=0;i<tags.length-1;i++) {\r\n////          var key = tags[i].key.toLowerCase();\r\n////          for (var j=tags.length-1;j>i;j--) {\r\n////            if (key===tags[j].key.toLowerCase()) {\r\n//////console.log(tags[i].key+', '+tags[i].val +' + '+tags[j].key+', '+tags[j].val);\r\n////              tags[i].val += tags[j].val;\r\n////              for (var k in tags[j].mem) tags[i].mem[k] = 0;\r\n////              tags.splice(j,1);\r\n////            }\r\n////          }\r\n////        }\r\n////        for (var i in tags) tags[i].val = Object.keys(tags[i].mem).length;\r\n////        tags.sort(function(a,b){return b.val - a.val;});\r\n////      }\r\n////      var str2 = '';\r\n////      for (var i=0;i<tags.length;i++) {\r\n////        var item = tags[i].val + ': ' + tags[i].key;\r\n////        str2 = str2 + '<input type=\"checkbox\"' + html_str + '> '+item + '<br>';\r\n////      }\r\n////      return str2;\r\n////    }\r\n    function make_catalog(){\r\n      var healthIndicator = (function(){\r\n        var his = [];\r\n        var count = 0;\r\n        var status = {};\r\n        var HealthIndicator = function(){\r\n          this.pn = document.createElement('span');\r\n          this.pn.innerHTML = '<span style=\"color:limegreen\"></span><span></span>';\r\n          this.pn_countdown = this.pn.childNodes[0];\r\n          this.pn_hi = this.pn.childNodes[1];\r\n//          if (!(embed_catalog)) pn_hi.style['font-size'] = '24px';\r\n          if (!pref.healthIndicator.show) this.pn.style.display = 'none';\r\n          his.push(this);\r\n          this.elems = [];\r\n        }\r\n        HealthIndicator.prototype = {\r\n          shift: function(col,str,initiator,priority){\r\n//            while (this.elems.length>=pref.healthIndicator.max) this.elems.shift().remove_from_parent();\r\n            for (var i=this.elems.length-pref.healthIndicator.max;i>=0;i--) if (this.elems[i].remove_from_parent()) this.elems.splice(i,1);\r\n            var elem = new HealthIndicatorElement(col,str,initiator,priority);\r\n            this.pn_hi.insertBefore(elem.pn, this.pn_hi.firstChild);\r\n            this.elems.push(elem);\r\n            return elem;\r\n          },\r\n          destroy: function(){\r\n            this.pn.parentNode.removeChild(this.pn);\r\n            his.splice(his.indexOf(this),1);\r\n          },\r\n//          remove: function(tgt){this.elems.splice(this.elems.indexOf(tgt),1)[0].remove();},\r\n//          set: function(col,str){this.elems[this.elems.length-1].set(col,str);}, // PATCH\r\n        };\r\n        var HealthIndicatorElement = function(col,str,initiator,priority){\r\n          this.pn = document.createElement('span');\r\n          this.name = 'healthIndicator.' + (count++);\r\n          this.pn.setAttribute('name',this.name);\r\n          this.set(col,str);\r\n          this.pn.onmouseover = mouseover;\r\n          this.pn.onmouseout  = mouseout;\r\n          this.pn.onclick     = click;\r\n          status[this.name] = {initiator:initiator, priority:priority};\r\n          this.show_tooltip_delayed = new DelayBuffer(show_tooltip.bind(this), 100).get_binded_delayed_do();\r\n//          this.status = status[this.name]; // patch for faster execution.\r\n        }\r\n        var src = null;\r\n        HealthIndicatorElement.prototype = {\r\n          set: function(col,str){\r\n            if (str) this.pn.textContent = str;\r\n            if (col) this.pn.setAttribute('style','color:'+col);\r\n          },\r\n          remove_from_parent: function(){ // must be called from parent to remove elems[this].\r\n            if (pref.healthIndicator.dont_retire_running && !status[this.name].end) return false;\r\n            delete status[this.name];\r\n            this.pn.parentNode.removeChild(this.pn);\r\n            if (this.pn===src) mouseout();\r\n            return true;\r\n          },\r\n          remove: function(){\r\n            if (this.remove_from_parent())\r\n              for (var i=0;i<his.length;i++) {\r\n                var idx = his[i].elems.indexOf(this);\r\n                if (idx!=-1) {\r\n                  his[i].elems.splice(idx,1);\r\n                  return;\r\n                }\r\n              }\r\n          },\r\n          report: function(obj){\r\n            var stat = status[this.name];\r\n            if (!stat) return; // when indicator was pruned.\r\n            var prog = stat.prog; // prepare for being overwritten.\r\n            if (obj) for (var i in obj) {\r\n              if (i==='err_str') {\r\n                if (!stat.err_str) this.set('orange');\r\n                stat[i] = ((stat[i])? stat[i]+', ':'') + obj[i];\r\n              } else stat[i] = obj[i];\r\n              if (i==='end') {\r\n                if (prog) {\r\n                  stat.prog_str = (stat.prog.IDX)? prog.IDX+'/'+prog.tgts.length :\r\n                                                   prog.found_threads+'/'+prog.scanned+', '+prog.found_boards+'/'+prog.max;\r\n                  stat.prog = null; // remove reference loop.\r\n                }\r\n                var result = (!stat.err_str || stat.initiator==='IDB')? '\\u25cf' :\r\n                             (prog && prog.SUC)? '\\u25b2' : 'X';\r\n//                             (prog && Object.keys(prog.error_obj).length<prog.max)? '\\u25b2' : 'X';\r\n                this.set((result==='X')?'red':null, result);\r\n              }\r\n            }\r\n            if (src || pref.healthIndicator.expand_running) this.show_tooltip_delayed();\r\n          },\r\n        };\r\n        function mouseover(e){\r\n          if (!pref.tooltips['info'].show) return;\r\n          src = this;\r\n          pref_func.tooltips.req_show('info', e, show_tooltip);\r\n//          show_tooltip.call(this,e);\r\n        }\r\n        function show_tooltip(e){\r\n          var myself = e && e.target || this;\r\n          var name = myself.name || myself.getAttribute('name');\r\n          var stat = status[name];\r\n          if (!stat) return; // retired already.\r\n          if (stat.prog) stat.prog_str = (stat.prog.IDX)? stat.prog.IDX+'/'+stat.prog.tgts.length+', ' + stat.tgt :\r\n                                                          stat.prog.found_threads+'/'+stat.prog.scanned+', '+stat.prog.found_boards+'/'+stat.prog.idx+'/'+stat.prog.max+', ' + stat.tgt;\r\n          if (!e && pref.healthIndicator.expand_running && stat.start && !stat.end) myself.set(null,' :'+stat.prog_str);\r\n          if (src && src.getAttribute('name')===name) {\r\n            var cancel_button = !stat.end && !pref.healthIndicator.cancel;\r\n            var html = 'Initiator: '+stat.initiator+'&emsp;'+\r\n                       ((cancel_button)? '<button name=\"'+name+'\">Cancel</button>' : '')+ '<br>' +\r\n                       ((stat.start)? 'Start: '+ new Date(stat.start).toLocaleTimeString()+'<br>' : '')+\r\n                       ((stat.prog_str)? 'Progress: '+ stat.prog_str+'<br>' : '')+\r\n                      'Priority: '+ stat.priority+'<br>'+\r\n                       ((stat.start && !stat.end && stat.prog)? 'Crawler: '+ stat.prog.crawler+'<br>' : '')+\r\n                       ((stat.err_str)? '<span style=\"color:red\">Errors: '+ stat.err_str+'</span><br>' : '')+\r\n                       ((stat.abort_str)? '<span style=\"color:red\">Abort: '+ stat.abort_str+'</span><br>' : '')+\r\n                       ((stat.end)? 'End: '+ new Date(stat.end).toLocaleTimeString()+'<br>' : '');\r\n            var retval = (!cancel_button)? html : {html:html, callback:tooltip_func}\r\n            if (!e) pref_func.tooltips.show_2(null, retval); // push\r\n            else return retval;\r\n          }\r\n        }\r\n        function mouseout(e){\r\n          src = null;\r\n          if (pref.tooltips['info'].show) pref_func.tooltips.hide2();\r\n        }\r\n        function tooltip_func(pn){\r\n          pn.getElementsByTagName('button')[0].onclick = cancel_scan;\r\n        }\r\n        function click(){\r\n          if (pref.healthIndicator.cancel) cancel_scan.call(this);\r\n        }\r\n        function cancel_scan(){\r\n          var name = this.getAttribute('name');\r\n          if (status[name] && !status[name].end) cataLog.scan_boards.scan_abort(status[name].initiator);\r\n        }\r\n        function show(){\r\n          var disp = (pref.healthIndicator.show)? '' : 'none';\r\n          for (var i=0;i<his.length;i++) his[i].pn.childNodes[1].style.display = disp;\r\n        }\r\n        function shrink_running(){\r\n          if (!pref.healthIndicator.expand_running)\r\n            for (var i=0;i<his.length;i++) \r\n              for (var j=0;j<his[i].elems.length;j++) if (his[i].elems[j].pn.textContent.length>1) his[i].elems[j].set(null,'r');\r\n        }\r\n        return {\r\n          HealthIndicator: HealthIndicator,\r\n          show: show,\r\n          shrink_running: shrink_running,\r\n        }\r\n      })();\r\n      cataLog.healthIndicator = healthIndicator;\r\n      var health_indicator = new healthIndicator.HealthIndicator();\r\n      httpd.set_health_indicator(health_indicator);\r\n\r\n////      var health_indicator = (function(){ // working code.\r\n////        var pn_hi = document.createElement('span');\r\n//////        if (!(embed_catalog)) pn_hi.style['font-size'] = '24px';\r\n////        if (!pref.catalog.health_indicator.on) pn_hi.style.display = 'none';\r\n////        pn12_0.childNodes[3].appendChild(pn_hi);\r\n////        function insert_node(col,str){\r\n////          var max = pref.catalog.health_indicator.max;\r\n////          while (pn_hi.childNodes.length>=max) pn_hi.removeChild(pn_hi.lastChild);\r\n////          var pn = document.createElement('span');\r\n////          if (col) pn.setAttribute('style','color:'+col);\r\n////          if (str) pn.innerHTML = str;\r\n////          pn_hi.insertBefore(pn,pn_hi.firstChild);\r\n////          return pn;\r\n//////          while (pn_hi.childNodes.length>=max) pn_hi.removeChild(pn_hi.childNodes[pn_hi.childNodes.length-1]);\r\n//////          pn_hi.innerHTML = '<span' + ((col)? ' style=\"color:'+col+'\"' : '' ) + '>'+str+'</span>' + pn_hi.innerHTML;\r\n////        }\r\n////        pref_func.health_indicator = pn_hi;\r\n////        return {\r\n////          pn_hi : pn_hi,\r\n////          set: function(pn,col,str){\r\n//////            if (!pn) pn = pn_hi.childNodes[0];\r\n////            if (str) pn.textContent = str;\r\n////            if (col) pn.style.color = col;\r\n////          },\r\n////          shift: function(col,str){return insert_node(col,str);},\r\n////          remove: function(pn){\r\n////            pn.parentNode.removeChild(pn);\r\n////          }\r\n////        }\r\n////      })();\r\n\r\n      var Footer = {\r\n        mode: embed_mode,\r\n        threads: threads,\r\n//        timestamp_trial: 16,\r\n        timestamp: 0,\r\n        timestamp_set: function(){\r\n          if (this.timestamp) {\r\n            this.timestamp += 16; // 16 is the magic number here, search it. This is used in literal forms in all cases.\r\n            this.clg.drawn_idx = 0;\r\n            this.clg.show_catalog(); // update footers, this is too heavy, but required.\r\n//            this.update_all_lazy(null, true);\r\n          }\r\n        },\r\n//        timestamp_trial_prep: function(){this.timestamp_trial = this.timestamp + 16;},\r\n//        timestamp_inc: function(){this.timestamp = this.timestamp_trial;},\r\n//        update_all_flags_force: function(){\r\n//          for (var name in this.threads) this.update(name, true, null, true);\r\n//        },\r\n        update_all_force: function(e,src, flags){\r\n          if (this.mode==='float' ^ src.indexOf('float')!=-1) return;\r\n          if (!flags) this.compile();\r\n          for (var name in this.threads) this.update_force(name);\r\n//          this.update_all_lazy(flags);\r\n        },\r\n//        update_all_lazy: function(flags, only_shown){\r\n//          var idxs = this.clg.idxs;\r\n//          var drawn_idx = this.clg.drawn_idx; // drawn_idx doesn't track exactly, it points meaningless point when tgts_in are given for show_catalog(tgts_in).\r\n//          if (drawn_idx===true) drawn_idx = idxs.length;\r\n//          var end = (only_shown)? drawn_idx : idxs.length;\r\n//          for (var i=0;i<end;i++) if (idxs[i].slice(0,4)!=='ODL:') this.update(idxs[i], flags, null, i<drawn_idx);\r\n//        },\r\n        update_force: function(name,flags,tags){\r\n          this.update(name,flags,tags, true);\r\n        },\r\n        update: function(name,flags,tags, force){ // must update if footer is in clean area of lazy draw.\r\n          var footer = this.threads[name][24];\r\n          if (!footer) return;\r\n          if (this.threads[name][1] && force) { // force or not must be judged by callser.\r\n//          if (this.threads[name][1] && (footer[4]>=this.timestamp || force)) { // BUG, this should be footer[4]>=this.timestamp_TRIAL to track clean area.\r\n            this.insert_footer3(footer, name, flags, tags);\r\n            footer[4] = this.timestamp;\r\n//            footer[4] &= 0xfffffff0; // keep timestamp\r\n          } else {\r\n            footer[4] |= (flags? 0x01 : 0) | (tags? 0x04 : 0) | 0x08; // | (page? 0x02 : 0); // 0x08 is dirty mark\r\n//            if (flags) footer[1] = flags;\r\n//            if (page) footer[2] = page;\r\n          }\r\n        },\r\n        try_dirtifying_tag: function(name,flags,tags, force){\r\n          var footer = this.threads[name][24];\r\n          if (!footer) true;\r\n          if (footer[4] & 0x0f) {\r\n            footer[4] |= 0x04;\r\n            return true;\r\n          }\r\n        },\r\n        draw: function(name){ // must update if footer has not updated data.\r\n          var footer = this.threads[name][24];\r\n          if (!footer) return;\r\n          if (footer[4]!==this.timestamp) {\r\n            this.insert_footer3(footer, name);\r\n            footer[4] = this.timestamp;\r\n          }\r\n//          if (footer[4] & 0x0f) this.insert_footer3(footer, name);\r\n//          footer[4] = this.timestamp_trial; // keep updating while lazy drawing is not completed, but this is too much.\r\n        },\r\n        factory: function(mode, threads, clg){\r\n          return {\r\n            threads: threads,\r\n//            timestamp_trial: this.timestamp,\r\n            timestamp: this.timestamp,\r\n            mode: mode,\r\n            clg: clg,\r\n            __proto__: this\r\n          };\r\n        },\r\n\r\n        pn: document.createElement('div'),\r\n        prep_flag_dom: function(dom){\r\n          if (dom.flag && (dom.flag instanceof Element)) return document.importNode(dom.flag);\r\n          if (!site2[site.nickname].post_flag2html) return undefined;\r\n          this.pn.innerHTML = site2[site.nickname].post_flag2html(dom); // site2[dom.domain_html].post_flag2html(dom); // patch, mimic always\r\n          return this.pn.childNodes[0];\r\n        },\r\n//        prep_flag_dom: function(flags, idx){ // working code\r\n//          var dom = flags[idx];\r\n//          if (dom instanceof Element) return dom;\r\n//          if (dom.flag && (dom.flag instanceof Element)) flags[idx] = dom.flag; // for KC\r\n//          else {\r\n//            this.pn.innerHTML = site2[site.nickname].post_flag2html(dom); // site2[dom.domain_html].post_flag2html(dom); // patch, mimic always\r\n//            flags[idx] = this.pn.childNodes[0];\r\n//          }\r\n//          return flags[idx];\r\n//        },\r\n        ts_refresh: null,\r\n        refresh_start: null,\r\n        formatted_arr: null,\r\n//        format_relative_time: null,\r\n//        format_time: null,\r\n        get_str: null,\r\n        prep_footer3: function(th, footer_old){\r\n          var footer = th.footer;\r\n          footer.classList.add(pref.script_prefix+'_footer');\r\n          var footer_native = th.type_parse==='catalog_html' && th.parse_funcs_html.footer_prep(th, footer) || null;\r\n//          var str = footer.innerHTML.replace(/ *R:[0-9 \\/]*I:[0-9 \\/]*/,'');\r\n//          str = str.replace(/P:[0-9 \\/]*/,'');\r\n//          str = str.replace(/ *\\(sticky\\) */,'');\r\n//          if (str!=='') {\r\n//            footer.innerHTML = '<span></span>' + str;\r\n//            footer = footer.childNodes[0];\r\n//          }\r\n          if (pref[this.mode].footer_br) {\r\n            var footer_style = footer.getAttribute('style');\r\n            footer_style = ((footer_style)? footer_style + ';' : '') + 'clear:both';\r\n            footer.setAttribute('style',footer_style);\r\n          }\r\n          return [footer, null, null, null, 0x06 | (th.country? 0x01 : 0), footer_native, null, null]; // [7] for test_mode['119']\r\n//          return (footer_old)? [footer, th.country, footer_old[2], null,          0x07, null, null] // for reentry\r\n//          return (footer_old)? [footer, th.country, footer_old[2], footer_old[3], 0x07, null, null] // for reentry\r\n//                             : [footer, th.country, null,          null,          0x07, null, null];\r\n        },\r\n        color_tag_node: function(name,tag){\r\n          var pn = this.query_tag_node(name,tag);\r\n          if (pn) liveTag.color_tag_node(pn,tag); // (pn,tag,this.taga) for individual tagging.\r\n        },\r\n        query_tag_node: function(name, tag){\r\n          var footer = this.threads[name] && this.threads[name][24];\r\n          if (!footer) return;\r\nif (pref.test_mode['119']) {\r\n          var tag_ci = tag.toLowerCase();\r\n          var tags = footer[7];\r\n          if (tags) for (var j=0;j<tags.length;j++) if (tags[j]===tag || (pref.liveTag.ci && tags[j].toLowerCase()===tag_ci)) return footer[3].childNodes[j*2];\r\n} else {\r\n          if (this.try_dirtifying_tag(name)) return; // this is ok as long as liveTag.create_tag_nodes is used in insert_footer3\r\n          var pn = footer[3] && footer[3].firstChild;\r\n          while (pn) if (pn.textContent===tag) return pn; else pn = pn.nextElementSibling;\r\n}\r\n        },\r\n        insert_footer3: function(footer, name, flags, tags){\r\n          function remove_nullify(footer,idx){\r\n            footer[0].removeChild(footer[idx]);\r\n            footer[idx] = null;\r\n          }\r\n//          var footer = threads[name][24];\r\n//          if (!footer || !footer[0]) return; // on demand drawing\r\n          var tgt_th = this.threads[name];\r\n          var lth = liveTag.mems.getFromName(name);\r\n          var pf = pref[this.mode].footer;\r\n//          var str;\r\n          if (pf.use) {\r\n            flags = flags || (footer[4]&0x01);\r\n            tags = tags || (footer[4]&0x04);\r\n            var str = this.get_str(tgt_th, lth);\r\n//            if (pf.design==='custom') str = this.get_str(tgt_th, lth); // working code\r\n//            else {\r\n//              var nums2  = tgt_th[8];\r\n//              var page = tgt_th[14] || '?';\r\n//              var str_nr = ((pf.nrtm)? lth.nrtm +'/' : '' ) + lth.nr;\r\n//              var str_nl = (pf.nl && lth.ta && lth.ta.posts)? lth.ta.posts.length+'/' : '';\r\n//              var str_ns = (pf.ns && lth.sg)? '*'+lth.sg.size : '';\r\n//              var str_nd = (pf.nd && lth.pd)? '+'+lth.pd.length : '';\r\n//              str     = ((pf.archived && lth.archived)? 'A ' : '') +\r\n//                        ((pf.design==='native')?\r\n//                          ((pf.nr)? ((lth.watched)? 'U: '+ str_nr + ' / ' : ''):'') + 'R: '+ str_nl+(nums2[2]-1)+str_ns+str_nd +  ' / I: '+nums2[3] + ((pf.page)? ' / P: '+page : '')\r\n//                        : ((pf.nr)? ((lth.watched)? str_nr + '/' : ''):'') + str_nl+nums2[2]+str_ns+str_nd + '/'+nums2[3]+ ((pf.page)? '/'+page : '')); // trial.\r\n//              if (str) str += ' ';\r\n//              if (pf.nf || pf.nid) {\r\n//                var str_nc = pf.nf && lth.sID && lth.sID.nc;\r\n//                var str_nid = pf.nid && lth.sID && (lth.sID.nid || lth.sID.np);\r\n//                str += (str_nid || '') + ((str_nid && str_nc)? '/' : '') + (str_nc || '') + ((str_nid || str_nc)? ' ' : '');\r\n//              }\r\n//  \r\n//              if (pf.ctime) str += this.format_time(nums2[1]) + ' ';\r\n//              if (pf.rctime) str += this.format_relative_time(nums2[1]) + ' ';\r\n//              if (pf.btime && nums2[0]) str += this.format_time(nums2[0]) + ' ';\r\n//              if (pf.rbtime && nums2[0]) str += this.format_relative_time(nums2[0]) + ' ';\r\n//              if (pf.ptime && nums2[4]) str += this.format_time(nums2[4]) + ' ';\r\n//              if (pf.rptime && nums2[4]) str += this.format_relative_time(nums2[4]) + ' ';\r\n//  \r\n//              if (pf.prate) str += Math.floor(nums2[2]/((this.ts_refresh - nums2[1])/86400000)) + ' ';\r\n//              if (pf.board || pf.no || pf.domain) {\r\n//                str += ((pf.domain)? lth.domain : '')+\r\n//                       ((pf.board)? lth.board : '')+\r\n//                       ((pf.no)? lth.no : '') + ' ';\r\n//              }\r\n//            }\r\n          }\r\n  \r\n          if (str) {\r\n            if (footer[5]) footer[5].textContent = str;\r\n            else footer[5] = footer[0].insertBefore(document.createTextNode(str), footer[0].firstChild);\r\n          } else if (footer[5]) remove_nullify(footer,5);\r\n  \r\n          if (pf.tag && pf.use) {\r\n            if (tags || !footer[3]) {\r\nif (pref.test_mode['119']) { // stateful approach\r\n              var tags_new = lth.tags;\r\n              var pn = liveTag.update_tag_nodes(lth.tags, ', ', liveTag.tag_node_onclick, footer[3], footer[7]); // referred from query_tag_node\r\n              footer[7] = tags_new; // stateful approach, TAGS MUST BE UPDATED BY REPLACING INSTEAD OF SPLICING\r\n              if (!footer[3]) footer[3] = footer[0].insertBefore(pn, footer[6]);\r\n//              footer[7] = lth.tags;\r\n//              var pn = liveTag.create_tag_nodes(footer[7], ', ', liveTag.tag_node_onclick); // referred from query_tag_node\r\n//              if (footer[3]) footer[3].parentNode.removeChild(footer[3]);\r\n//              footer[3] = footer[0].insertBefore(pn, footer[6]);\r\n} else {\r\n              var pn = liveTag.create_tag_nodes(lth.tags, ', ', liveTag.tag_node_onclick);\r\n              if (footer[3]) footer[3].parentNode.removeChild(footer[3]);\r\n              footer[3] = footer[0].insertBefore(pn, footer[6]);\r\n}\r\n            }\r\n          } else if (footer[3]) {remove_nullify(footer,3); footer[7] = null;}\r\n//          if (pf.tag && pf.use) { // working code\r\n//            tags = tags && lth;\r\n//            if (!footer[3]) {\r\n//              footer[3] = footer[0].insertBefore(document.createElement('span'), footer[6]);\r\n//              tags = lth;\r\n//            } else if (tags) footer[3].removeChild(footer[3].firstChild);\r\n//            if (tags) footer[3].appendChild(liveTag.update_tag_string(lth.tags, ', ', liveTag.tag_node_onclick));\r\n//          } else if (footer[3]) Footer.remove_nullify(footer,3);\r\n  \r\n          if (pf.flag && pref[this.mode].t2h_num_of_posts>=0 && pf.use) {\r\n            if (flags || !footer[6]) flags = tgt_th[16].recent_posts(); // .slice(); // EMBED_MODE IS USED IN THIS, MUST BE CHANGED.\r\n            if (!footer[6]) {\r\n              footer[6] = footer[0].appendChild(document.createElement('span'));\r\n//              if (!flags) flags = footer[1];\r\n            }\r\n            if (flags && flags.length>0) {\r\n              for (var i=footer[6].childNodes.length-1;i>=0;i--) footer[6].removeChild(footer[6].firstChild);\r\n              for (var i=0;i<flags.length;i++) if (flags[i]) {\r\n                var flag = Footer.prep_flag_dom(flags[i]);\r\n                if (flag) {\r\n                  if (flags[i].deleted_after) flag.classList.add('CatChan_deleted');\r\n                  footer[6].appendChild(flag);\r\n                }\r\n              }\r\n//              var i = flags.length - pref[embed_mode].t2h_num_of_posts; // working code\r\n//              if (i<1) i=1;\r\n//              if (flags[0] && Footer.prep_flag_dom(flags,0)) footer[6].appendChild(flags[0]);\r\n//              while (i<flags.length) {\r\n//                if (flags[i] && Footer.prep_flag_dom(flags,i)) footer[6].appendChild(flags[i]);\r\n//                i++;\r\n//              }\r\n//              footer[1] = flags;\r\n            }\r\n          } else {\r\n            if (footer[6]) remove_nullify(footer,6);\r\n//            if (flags) footer[1] = flags;\r\n          }\r\n          if (pref.debug_mode['32'] && footer[6]) {\r\n            var flags_debug = tgt_th[16].recent_posts(); // .slice();\r\n            var pn = document.createElement('span');\r\n            for (var i=0;i<flags_debug.length;i++) if (flags_debug[i]) {\r\n              var flag = Footer.prep_flag_dom(flags_debug[i]);\r\n              if (flag) {\r\n                if (flags_debug[i].deleted_after) flag.classList.add('CatChan_deleted');\r\n                pn.appendChild(flag);\r\n              }\r\n            }\r\n            var pns = [footer[6], pn].map(function(v){\r\n              return Array.prototype.map.call(v.getElementsByClassName('flag'),function(v){return v.getAttribute('class').match(/flag\\-(..)/)[1];}).toString();});\r\n            if (pns[0]!=pns[1]) console.log('Error: Flags: '+lth.key+': '+'\\n'+pns[0]+'\\n'+pns[1]);\r\n          }\r\n  \r\n  //        footer[0].innerHTML = (pref.catalog_footer)? str : ''; // working code\r\n  //        \r\n  //        if (pref.catalog_footer && pref.catalog_footer_show_tag) {\r\n  //          if (!footer[3]) {\r\n  //            footer[3] = document.createElement('span');\r\n  //            footer[3].innerHTML = '<span></span><span></span>';\r\n  //          }\r\n  //          if (tags) {\r\n  //            for (var i=0;i<2;i++) {\r\n  //              var pn = liveTag.update_tag_string(tags[i], ', ', liveTag.tag_node_onclick);\r\n  //              footer[3].removeChild(footer[3].childNodes[i]);\r\n  //              footer[3].insertBefore(pn,footer[3].childNodes[i] || null);\r\n  //            }\r\n  //          }\r\n  ////          if (tags) { // working code.\r\n  ////            for (var i=0;i<2;i++) {\r\n  ////              if (!tags[i][2] || force_update) {\r\n  ////                var pn = liveTag.update_tag_string(tags[i][0], ', ', liveTag.tag_node_onclick);\r\n  ////                tags[i][2] = true;\r\n  ////                footer[3].removeChild(footer[3].childNodes[i]);\r\n  ////                footer[3].insertBefore(pn,footer[3].childNodes[i] || null);\r\n  ////              }\r\n  ////            }\r\n  ////          }\r\n  //          if (footer[3].parentNode!==footer[0]) footer[0].appendChild(footer[3]);\r\n  //        }\r\n  //\r\n  //        if (pref.catalog_footer_show_flag && (flags || footer[1]) && pref.catalog_footer && pref[embed_mode].t2h_num_of_posts>=0) {\r\n  //          if (flags) footer[1] = flags;\r\n  //          else flags = footer[1];\r\n  //          var i = flags.length - pref[embed_mode].t2h_num_of_posts;\r\n  //          if (i<1) i=1;\r\n  //          if (flags[0] && Footer.prep_flag_dom(flags,0)) footer[0].appendChild(flags[0]);\r\n  //          while (i<flags.length) {\r\n  //            if (flags[i] && Footer.prep_flag_dom(flags,i)) footer[0].appendChild(flags[i]);\r\n  //            i++;\r\n  //          }\r\n  //////////          if (th && site.nickname!==th.domain) site2[th.domain].absolute_link(footer[0], th.board); // patch\r\n  //        }\r\n//            footer[4] = Footer.timestamp;\r\n        }\r\n      };\r\n      Footer.get_str = (function(parent){\r\n        function format_relative_time(time){\r\n          var rt = time - ts_refresh;\r\n          var sign = (rt<0)? '-' : '+';\r\n          var at = Math.floor(Math.abs(rt)/1000);\r\n          var s = at%60;\r\n          var m = (at>=60)? Math.floor((at%3600)/60) : 0;\r\n          var h = (at>=3600)? Math.floor((at%86400)/3600) : 0;\r\n          var d = (at>=86400)? Math.floor(at/86400)+'d' : '';\r\n          return sign + d + ((d && h<10)? '0':'') + ((at>=3600)? h+':':'') + ((at>=3600 && m<10)?'0':'') + ((at>=60)? m+':':'') + ((at>=60 && s<10)?'0':'') + s;\r\n//          return (sat<60)? '0:00:'+at\r\n//            : (at<3600)? '0:Math.floor(at/60)+'mins'\r\n//            : Math.floor(at/3600)+':'+Math.floor((at%3600)/60);\r\n        }\r\n        var ts_refresh = Date.now();\r\n        var ts_refresh_rx = null;\r\n        function format_time(time){\r\n          if (!ts_refresh_rx) ts_refresh_rx = new RegExp(new Date(ts_refresh).toLocaleDateString(),'g');\r\n          return new Date(time).toLocaleString().replace(ts_refresh_rx,'') + ' ';\r\n        }\r\n        var tgt_th = null;\r\n        var lth = null;\r\n        var nums2 = null;\r\n        var funcs = {\r\n          pg: function(pf){return (pf.page)? function(){return tgt_th[14] || '?';} : null;},\r\n          nm: function(pf){return (pf.nrtm)? function(){return lth.watched? lth.nrtm : '';} : null;},\r\n          nr: function(pf){return (pf.nr)?   function(){return lth.watched? lth.nr : '';} : null;},\r\n          rp: function(pf){return (pf.rp)? (pf.rOP? function(){return nums2[2];} : function(){return nums2[2]-1;}) : null;},\r\n          im: function(pf){return (pf.im)? (pf.iOP? function(){return nums2[3];} : function(){return nums2[3]>1? nums2[3]-1 : '';}) : null;},\r\n//          rp: function(pf){return (pf.rp)? function(){return nums2[2];} : null;},\r\n//          r1: function(pf){return (pf.rp)? function(){return nums2[2]-1;} : null;},\r\n//          im: function(pf){return (pf.im)? function(){return nums2[3];} : null;},\r\n//          i1: function(pf){return (pf.im)? function(){return nums2[3]>1? nums2[3]-1 : '';} : null;},\r\n          lp: function(pf){return (pf.nl)? function(){return (lth.ta && lth.ta.posts)? lth.ta.posts.length : '';} : null;},\r\n          dp: function(pf){return (pf.nd)? function(){return lth.pd? lth.pd.length : '';} : null;},\r\n          ar: function(pf){return (pf.archived)? function(){return lth.archived? 'A' : '';} : null;},\r\n          nf: function(pf){return (pf.nf)?  function(){return lth.sID && lth.sID.nc || '';} : null;},\r\n          ni: function(pf){return (pf.nid)? function(){return lth.sID && (lth.sID.nid || lth.sID.np) || '';} : null;},\r\n          ct: function(pf){return (pf.ctime)?  function(){return format_time(nums2[1]);} : null;},\r\n          cT: function(pf){return (pf.rctime)? function(){return format_relative_time(nums2[1]);} : null;},\r\n          bt: function(pf){return (pf.btime)?  function(){return nums2[0]? format_time(nums2[0]) : '';} : null;},\r\n          bT: function(pf){return (pf.rbtime)? function(){return nums2[0]? format_relative_time(nums2[0]) : '';} : null;},\r\n          pt: function(pf){return (pf.ptime)?  function(){return nums2[4]? format_time(nums2[4]) : '';} : null;},\r\n          pT: function(pf){return (pf.rptime)? function(){return nums2[4]? format_relative_time(nums2[4]) : '';} : null;},\r\n          pr: function(pf){return (pf.prate)?  function(){return Math.floor(nums2[2]/((ts_refresh - nums2[1])/86400000));} : null;},\r\n          dn: function(pf){return (pf.domain)? function(){return lth.domain;} : null;},\r\n          bd: function(pf){return (pf.board)?  function(){return lth.board;} : null;},\r\n          no: function(pf){return (pf.no)?     function(){return lth.no;} : null;},\r\n          sp: function(pf){return (pf.ns)?     function(){return lth.sg? lth.sg.size : '';} : null;},\r\n          wrap: function(p,func,l){\r\n            var str = func();\r\n            return str!==''? p+str+l : '';\r\n          },\r\n          concat: function(arr){\r\n            var str = arr[1]();\r\n            for (var i=2;i<arr.length-1;i+=2) {\r\n              var tmp = arr[i+1]();\r\n              if (tmp!=='') str += arr[i] + tmp;\r\n            }\r\n            return str!==''? arr[0] + str + arr[arr.length-1] : '';\r\n          },\r\n        };\r\n        var fmts = {\r\n          native:    '(ar )(U: nm/nr / )R: (lp/)(rp)(*sp)(+dp)( / I: im)( / P: pg) (ni/nf )(ct )(cT )(bt )(bT )(pt )(pT )(pr )(dn)(bd)(no) ',\r\n          condensed: '(ar )(nm/)(nr/)(lp/)(rp)(*sp)(+dp)(/im)(/pg) (ni/nf )(ct )(cT )(bt )(bT )(pt )(pT )(pr )(dn)(bd)(no) ',\r\n          meguca:    '(ar )(dn)(bd)(no) (nm/)(nr/)(lp/)(rp)(*sp)(+dp)(/im)(/pg) (ni/nf )(ct )(cT )(bt )(bT )(pt )(pT )(pr ) ',\r\n//          get custom_str(){return pref[myself.mode].footer.custom_str;}, // patch for minify. This line hits a bug in minifier.\r\n        };\r\n        parent.compile = function(){\r\n          var pf = pref[this.mode].footer;\r\n          var fmt = fmts[pf.design] || pf[pf.design] || ''; // '' for safety\r\n          var elems = 'ar|n[mrfio]|pg|rp|im|[lds]p|[cbp][tT]|pr|dn|bd'\r\n          var arr = fmt.split(new RegExp('(\\\\(.*?(?:'+elems+').*?\\\\))')).filter(function(v){return v;}); // will be changed to fmts[pf[myself.mode]]\r\n          var rx = new RegExp('('+elems+')');\r\n          var obj = {};\r\n          var len = 0;\r\n          var proto = {enumerable:true, configurable:true};\r\n          for (var i=0;i<arr.length;i++) {\r\n            var tmp = arr[i].slice(1,-1).split(rx);\r\n            if (tmp.length>=3) {\r\n              for (var j=1;j<tmp.length;j+=2) tmp[j] = funcs[tmp[j]](pf);\r\n              for (var j=tmp.length-3;j>=0;j-=2) if (!tmp[j+1]) tmp.splice(j,2); else if (j>0 && !tmp[j-1]) tmp[j]='';\r\n              if (tmp[1]) Object.defineProperty(obj, len++, {get: (tmp.length>=5)?    funcs['concat'].bind(null, tmp)\r\n                                                                : (tmp[0] || tmp[2])? funcs['wrap'].bind(null, tmp[0], tmp[1], tmp[2])\r\n                                                                :                     tmp[1], __proto__:proto});\r\n//              if (tmp.length>=5) { // working code, but has a bug.\r\n//                for (var j=1;j<tmp.length;j+=2) tmp[j] = funcs[tmp[j]](pf);\r\n//                for (var j=tmp.length-3;j>=0;j-=2) if (!tmp[j-1] && !tmp[j+1]) tmp.splice(j,2); // access tmp[-1], but ok.\r\n//                if (tmp.length>=3) Object.defineProperty(obj, len++, {get: funcs['concat'].bind(null, tmp), __proto__:proto});\r\n//              } else if (tmp.length>=3) {\r\n//                var func = funcs[tmp[1]](pf);\r\n//                if (func && (tmp[0] || tmp[2])) func = funcs['wrap'].bind(null, tmp[0], func, tmp[2]);\r\n//                if (func) Object.defineProperty(obj, len++, {get: func, __proto__:proto});\r\n            } else if (arr[i]) Object.defineProperty(obj, len++, {value: arr[i], __proto__:proto});\r\n          }\r\n          obj.length = len;\r\n          this.formatted_arr = obj;\r\n          this.timestamp = (pf.prate || pf.rptime || pf.rbtime)? 16 : 0;\r\n          return obj;\r\n        }\r\n        function refresh_start(){\r\n          ts_refresh = Date.now();\r\n          ts_refresh_rx = null;\r\n          this.timestamp_set();\r\n        }\r\n        parent.refresh_start = refresh_start;\r\n        Object.defineProperty(parent,'ts_refresh', {get:function(){return ts_refresh;}, enumerable:true, configurable:true});\r\n//        parent.format_relative_time = format_relative_time;\r\n//        parent.format_time = format_time;\r\n        return function(tgt_th_in, lth_in){\r\n//          if (!this.formatted_arr) this.formatted_arr = compile(this);\r\n          tgt_th = tgt_th_in;\r\n          lth = lth_in;\r\n          nums2 = tgt_th[8];\r\n          return Array.prototype.join.call(this.formatted_arr,'');\r\n        };\r\n      })(Footer);\r\n      Footer.compile();\r\n      cataLog.Footer = Footer;\r\n//      cataLog.insert_footer3 = insert_footer3;\r\n\r\n\r\n      cataLog.embed_mode = embed_mode;\r\n      if (pref[embed_mode].open_spoiler_text) styleSheet.open_spoiler_text();\r\n      if (brwsr.sw_cache && pref.info_client) brwsr.sw_cache.subscribe(true);\r\n      var initialize_loop = true;\r\n\r\nvar Clg = function(embed_embed, embed_mode, watcher){\r\n      var pfai = pref.catalog.appearance.initial;\r\n      var pn12 = cnst.init3({\r\n        func_str:'left:'+pfai.left+'px:top:'+pfai.top+'px:resize:both:'+((embed_embed)? 'display:none:tb:embed':'tb')+':width:'+pfai.width+'px:height:'+pfai.height+'px:resize:both:overflow:auto'+\r\n          ':Show'+(embed_embed?'':':bottom_top')+((embed_mode==='float')? ':tb_press:'+pfai.state:''),\r\n//        rolldown: function(){pn12_0_4.style.display='';},\r\n//        rollup: function(){pn12_0_4.style.display='none';},\r\n        exit: (!watcher)? show_hide : this.destroy.bind(this),\r\n        maximize: show_catalog_cont,\r\n        get auto_roll(){return pref.catalog_auto_rollup_when_moving;}}).pn;\r\n//      var pn12_whole = cnst.init('left:0px:tile:get:bottom:resize:both:Show:tb:width:'+pref.catalog.appearance.initial.width+'px:height:'+pref.catalog.appearance.initial.height+'px:resize:both:overflow:auto',\r\n//        function(){pn12_0_4.style.display='';},function(){pn12_0_4.style.display='none';},show_hide,show_catalog_cont);\r\n//      var pn12 = pn12_whole[0];\r\n//      if (embed_embed) pn12.style.display = 'none';\r\n//      var pn12_rollup_func = pn12_whole[1];\r\n\r\n//// test for prototype base coding.\r\n////      var pn12_whole = new Cnst2('left:0px:tile:get:bottom:resize:both:Show:tb:width:400px:height:400px:resize:both:overflow:auto',\r\n////        {rolldowm:function(){pn12_0_4.style.display='';}, rollup:function(){pn12_0_4.style.display='none';}, exit:show_hide, maximize:show_catalog_cont});\r\n////      var pn12 = pn12_whole.pn;\r\n////      var pn12_rollup_func = pn12_whole.funcs.rollup;\r\n\r\n//      cnst.bottom_top(pn12);\r\n      var pn12_0 = pn12.childNodes[0];\r\n      var pn12_1 = pn12.childNodes[1].appendChild(document.createElement('div'));\r\n//      var pn12_1 = pn12.childNodes[1];\r\n//      pn12_1.id = 'catalog_debug'; // working code.\r\n//      var autorollup_state = false;\r\n//      function auto_hide_catalog() {\r\n//        if (pref.catalog_auto_rollup_when_moving) {\r\n//          if (pn12_1.style.display!='none') {\r\n//            pn12_rollup_func();\r\n//            autorollup_state = true;\r\n//          } else if (autorollup_state) {\r\n//            pn12_rollup_func();\r\n//            autorollup_state = false;\r\n//          }\r\n//        }\r\n//      }\r\n//      pn12.addEventListener('dragstart', auto_hide_catalog, false);\r\n//      pn12.addEventListener('dragend'  , auto_hide_catalog, false);\r\n      var pn12_0_2 = cnst.add_to_tb(pn12,\r\n//        '<label name=\"filter\"><input type=\"checkbox\" name=\"catalog.filter.show\"> Filter </label>' +\r\n//        '<label name=\"settings\"><input type=\"checkbox\" name=\"catalog_show_setting\"> Settings</label>'+\r\n        '<button type=\"button\" name=\"filter\">'+ ((site2[site.nickname].CONTENT_SECURITY_POLICY_DATAURI)? 'F' : cnst.icons.img(cnst.icons.filter)) +'</button>' +\r\n        '<button type=\"button\" name=\"settings\">'+ ((site2[site.nickname].CONTENT_SECURITY_POLICY_DATAURI)? 'S' : cnst.icons.img(cnst.icons.settings)) +'</button>'+\r\n//        '<button name=\"refresh\">Refresh</button>'+\r\n//        '<button name=\"refresh\">\\u27f3</button>'+\r\n        '<button type=\"button\" name=\"refresh\">'+ ((site2[site.nickname].CONTENT_SECURITY_POLICY_DATAURI)? 'R' : cnst.icons.img(cnst.icons.refresh)) +'</button>'+\r\n        '<span name=\"num_of_pages\">'+\r\n          '<span name=\"hide_at_embed\"> up to <input type=\"text\" name=\"catalog_max_page\" size=\"2\" style=\"text-align: right;\">pages in </span></span>'+\r\n        '<span name=\"boards_selector\"><select name=\"catalog_board_list_sel\"></select></span>');\r\n      var board_sel = pn12_0_2.getElementsByTagName('select')['catalog_board_list_sel'];\r\n      cnst.auto_shrink_board_selector.setup(board_sel,pref.catalog_board_list_sel);\r\n      pref_func.apply_prep(pn12_0_2,false);\r\n      var pn12_0_2_children = ['filter','settings','refresh','num_of_pages','boards_selector'];\r\n      for (var i=0;i<pn12_0_2_children.length;i++)\r\n        if (!pref.catalog.appearance.titleBar[pn12_0_2_children[i]]) pn12_0_2.getElementsByTagName('*')[pn12_0_2_children[i]].style.display = 'none';\r\n//      pn12_1.style.width = pn12_0.offsetWidth + 'px';\r\n  if (!watcher) {\r\n      pn12_0.childNodes[3].appendChild(health_indicator.pn);\r\n      var IDB_spacer = document.createElement('span');\r\n      IDB_spacer.textContent = ' ';\r\n      pn12_0.childNodes[3].appendChild(IDB_spacer);\r\n      var IDB_indicator = new healthIndicator.HealthIndicator();\r\n      IDB.set_indicator(IDB_indicator);\r\n      pn12_0.childNodes[3].appendChild(IDB_indicator.pn);\r\n  }\r\n      var pn12_0_4 = document.createElement('div');\r\n      if (embed_mode==='float') pn12_0_4.setAttribute('class', pref.script_prefix+'_window');\r\n      pn12_0_4.style = 'margin:0px 3px; clear:both';\r\n//      pn12_0.appendChild(pn12_0_4);\r\n      pn12_0_4.innerHTML = pref_func.format_html_str(\r\n        '<div style=\"float:right;display:none\">'+\r\n          '<div style=\"float:right\">'+\r\n            '<ICBX\"' + embed_mode + '.auto_update\"> Auto update<br>'+\r\n            '1,<ITB3\"' + embed_mode + '.auto_update_period\"> min.<br>'+\r\n//            '<input type=\"checkbox\" name=\"catalog_snoop_refresh\" checked> Snoop update<br>'+\r\n//            '&emsp;<input type=\"checkbox\" name=\"catalog_promiscuous\"> Promiscuous<br>'+\r\n            '<ICBX\"catalog_refresh_clear\"> Clear latter than<br>'+\r\n            '1,<ITB4\"catalog.max_threads_at_refresh\">th at update<br>'+\r\n            '<BTN\"clear_threads,ClearAllThreads\">'+\r\n          '</div>'+\r\n          '<div style=\"float:right\">'+\r\n            '<div name=\"hide_at_embed\">'+\r\n//              '<select name=\"catalog.indexing\"><option>Last reply</option><option>Creation date</option><option>Reply count</option><option>Image count</option></select><br>'+\r\n              '<select name=\"catalog.indexing\"><option>Bump order</option><option>Creation date</option><option>Reply count</option><option>Image count</option><option>Last reply</option><option>Fast</option><option>/Bump order</option><option>/Creation date</option><option>/Reply count</option><option>/Image count</option><option>/Last reply</option><option>Slow</option></select><br>'+\r\n              'size '+\r\n              '<span name=\"catalog.text_mode.mode.graphic\">'+\r\n                '<input type=\"text\" name=\"catalog_size_width\" size=\"4\" style=\"text-align: right;\"> x '+\r\n                '<input type=\"text\" name=\"catalog_size_height\" size=\"4\" style=\"text-align: right;\"></span>'+\r\n              '<span name=\"catalog.text_mode.mode.text\">'+\r\n                '<input type=\"text\" name=\"catalog_size_text_width\" size=\"4\" style=\"text-align: right;\"> x '+\r\n                '<input type=\"text\" name=\"catalog_size_text_height\" size=\"4\" style=\"text-align: right;\"></span>'+\r\n            '</div>'+\r\n            '<div>'+\r\n//              '&emsp;Order<br>'+\r\n              pref_func.settings.html_funcs.rollup_radio('catalog.order.sticky', ' :Sticky', 1, '',\r\n                ['first:at first','last:at last','dont_care:don\\'t care'])+ '<br>'+\r\n              '<IC\"catalog.order.reply_to_me\">New reply to me at first<br>'+\r\n              '<IC\"catalog.order.reply\">New reply at first<br>'+\r\n//              '<input type=\"checkbox\" name=\"catalog.order.watch\"> Watch listed at first<br>'+\r\n              pref_func.settings.html_funcs.rollup_radio('catalog.order.watch', ' :Watch listed', 1, '',\r\n                ['first:at first','last:at last','dont_care:don\\'t care'])+ '<br>'+\r\n//              '&emsp;<input type=\"radio\" name=\"catalog.order.sticky\" value=\"hide\"> hide<br>'+\r\n            '</div>'+\r\n          '</div>'+\r\n//          '<div style=\"float:right\">'+\r\n//            '<div name=\"hide_at_embed\">'+\r\n//              '<input type=\"radio\" name=\"catalog.text_mode.mode\" value=\"graphic\"> Graphical mode<br>'+\r\n//              '<input type=\"radio\" name=\"catalog.text_mode.mode\" value=\"text\"> Text mode<br>'+\r\n//            '</div>'+\r\n//          '</div>'+\r\n        '</div>'+\r\n        '<div align=\"left\" style=\"float:left;display:none\">'+\r\n          '<div data-show3=\"kwd\">'+\r\n            '<a name=\"HIDE3\" style=\"cursor:pointer\">[-]</a>'+\r\n            '<ICBX\"catalog.filter.kwd.use\"> Keyword :'+\r\n//            '<textarea style=\"height:1em\" cols=\"25\" name=\"catalog.filter.kwd.str\"></textarea>'+\r\n            '<input type=\"text\" name=\"catalog.filter.kwd.str\" size=\"25\">'+\r\n            ' <ICBX\"catalog.filter.kwd.ci\">CI '+\r\n            pref_func.settings.html_funcs.make_sel('catalog.filter.kwd.match', ['match all','match any','unmatch all','unmatch any'])+\r\n            ' <ICBX\"catalog.filter.kwd.sentence\">Sentence'+\r\n            ' <ICBX\"catalog.filter.kwd.re\">RE<br>'+\r\n            '1,(<ICBX\"catalog.filter.kwd.sub\">Subject '+\r\n            '<ICBX\"catalog.filter.kwd.name\">Name '+\r\n            '<ICBX\"catalog.filter.kwd.com\">Comment '+\r\n            '<span style=\"display:none\">'+\r\n              '<span name=\"HIDE4\" style=\"cursor:pointer\">\\u25c0</span>'+\r\n              '<ICBX\"catalog.filter.kwd.trip\">Tripcode '+\r\n              '<ICBX\"catalog.filter.kwd.id\">ID '+\r\n              '<ICBX\"catalog.filter.kwd.file\">Filename '+\r\n              '<ICBX\"catalog.filter.kwd.meta\">No. '+\r\n              '<ICBX\"catalog.filter.kwd.flag\">Flag'+\r\n            '</span>'+\r\n            '<span name=\"SHOW4\" style=\"cursor:pointer\">\\u25b6</span>'+\r\n            ')'+\r\n            ' (<ICBX\"catalog.filter.kwd.op\">OP '+\r\n            '<ICBX\"catalog.filter.kwd.post\">Posts)'+\r\n            '<button name=\"scanBoard\">></button>'+\r\n            '<button name=\"scanSite\">>></button>'+\r\n          (!pref.test_mode['115']? '' : pref_func.settings.html_funcs.rollup(\r\n              '<div>'+\r\n                '&emsp;&emsp;<IC\"filter.disable_list_when_kwd_active\">Disable list filter when keyword filter is active<br>'+\r\n                '2,<IC\"filter.disable_tag_when_kwd_active\">Disable tag filter when keyword filter is active<br>'+\r\n                '1,<IC\"catalog.filter.auto_list.use\">Auto filter list:<br>'+\r\n                '2,<ICBX\"catalog.filter.auto_list.kill\">Hide '+\r\n                '<ICBX\"catalog.filter.auto_list.watch\">Watch '+\r\n                '<ICBX\"catalog.filter.auto_list.show\">Show '+\r\n                '<ICBX\"catalog.filter.auto_list.sticky\">Sticky '+\r\n                '<ICBX\"catalog.filter.auto_list.style\">Style:'+\r\n                '<ITBL25\"catalog.filter.auto_list.style_str\">'+\r\n                '&emsp;<BTN\"add_to_auto,+\"><br>'+\r\n                '2,<TA\"catalog.filter.auto_list.str,40,1\">'+\r\n              '</div>')) +\r\n          '</div>'+\r\n//          '<div>'+\r\n////            '<button name=\"scanSite\">scanSite</button> '+\r\n//////////            '<span name=\"scan_progress\"></span><br>'+\r\n////            '<button name=\"clear_threads\">ClearAllThreads</button>'+\r\n////            '<input type=\"checkbox\" name=\"common.clear_at_manual_scan\">Auto <br>'+\r\n////            '<div style=\"float:left;overflow:auto;resize:both;\" name=\"catalog.filter.tag_site_list\"></div>'+\r\n////            '<input type=\"checkbox\" name=\"catalog.filter.tag_scansite\">scan tags<br>'+\r\n//          '</div>'+\r\n          '<div style=\"clear:both\" data-show3=\"time\">'+\r\n            '<a name=\"HIDE3\" style=\"cursor:pointer\">[-]</a>'+\r\n            'Time: Posted/Created '+\r\n            '<ICBX\"catalog.filter.time\">'+\r\n            '<ICBX\"catalog.filter.time_creation\">Hide '+\r\n//            '<input type=\"checkbox\" name=\"catalog.filter.time_mark\"> Mark: '+\r\n            '<ICBX\"catalog.filter.time_watch\">'+\r\n            '<ICBX\"catalog.filter.time_watch_creation\">Watch '+\r\n//            '<textarea style=\"height:1em\" cols=\"25\" name=\"catalog.filter.time_str\"></textarea>'+\r\n            '<ITBL25\"catalog.filter.time_str\">'+\r\n            '<select name=\"catalog.filter.time_quick_sel\">'+\r\n              '<option>quick select...</option>'+\r\n              '<option>now</option>'+\r\n              '<option>1 hour ago</option>'+\r\n              '<option>2 hours ago</option>'+\r\n              '<option>4 hours ago</option>'+\r\n              '<option>12 hours ago</option>'+\r\n              '<option>1 day ago</option>'+\r\n              '<option>3 days ago</option>'+\r\n              '<option>1 week ago</option>'+\r\n            '</select>'+\r\n//            '<span class=\"CatChan_hMenu\">quick select...'+\r\n//              '<div class=\"CatChan_hMCnt\" style=\"z-index:1\">'+\r\n//                ['now','1 hour ago','2 hours ago','4 hours ago','12 hours ago','1 day ago','3 days ago','1 week ago'].map(function(v){return '<button type=\"button\">'+v+'</button>';}).join('')+\r\n//              '</div>'+\r\n//            '</span>'+\r\n            '<br>'+\r\n          '</div>'+\r\n          '<div style=\"clear:both;display:none\" data-show3=\"tag\">'+\r\n            '<a name=\"HIDE3\" style=\"cursor:pointer;float:left\">[-]</a>'+\r\n            '<span class=\"PLACEHOLDER\" style=\"float:right\"></span>'+ // tack\r\n            liveTag.popup_filter.html+\r\n////            '<div style=\"float:left\">'+\r\n////              '<input type=\"checkbox\" name=\"catalog.filter.tag\"> Tag :'+\r\n////            '</div>'+\r\n////            '<div style=\"float:left\">'+\r\n////              '<div>'+\r\n////                ' Fetcn / In / Out / Threads / Tag '+\r\n////                '<ITBL25\"catalog.filter.tag_search.str\" placeholder=\"Search tags...\">'+\r\n//////                ' <ICBX\"catalog.filter.tag_search.ci\">CI'+\r\n////                ' <ICBX\"catalog.filter.tag_search.re\">RE'+\r\n////              '</div>'+\r\n////              '<div><span></span>'+pref_func.settings.html_funcs.rollup(\r\n////                '<IC\"catalog.filter.tag_search.show_nof_boards\">Show number of boards<br>'+\r\n////                '<BTN\"tagB.shown_t_pk,T\"><BTN\"tagB.shown_t_in,T\"><BTN\"tagB.shown_t_ex,T\"> Toggle checkboxes of shown tags<br>'+ // span for not being wrapped by label.\r\n////                '<BTN\"tagB.shown_c_pk,C\"><BTN\"tagB.shown_c_in,C\"><BTN\"tagB.shown_c_ex,C\"> Clear checkboxes of shown tags<br>'+\r\n////                '<BTN\"tagB.all_c_pk,C\"><BTN\"tagB.all_c_in,C\"><BTN\"tagB.all_c_ex,C\"> Clear checkboxes of all tags')+'<br></div>'+\r\n////              '<div style=\"overflow:auto;resize:both;float:left\" name=\"catalog.filter.tag_list\"></div>'+\r\n////              pref_func.settings.html_funcs.rollup('<div style=\"clear:both\">'+\r\n////                '<BTN\"tag2bList,Add\"> selected tags to the last of board group<br>'+\r\n////                '1,Label: <ITBL20\"catalog.filter.tag2bList.label\" placeholder=\"default: topmost tag\"><br>'+\r\n////                '1,<IR\"catalog.filter.tag2bList.by,tag\">By tag<br>'+\r\n////                '1,<IR\"catalog.filter.tag2bList.by,board\">By board<br>'+\r\n////                '</div>')+\r\n//////              '<a name=\"SHOW\" style=\"cursor:pointer\" data-str=\"[\\u25b2]\">[\\u25bc]</a>'+\r\n//////              '<div name=\"SUB\" style=\"clear:both;display:none\">TEST</div>'+\r\n////            '</div>'+\r\n////            '<div style=\"clear:both\"></div>'+ // for floating\r\n          '</div>'+\r\n          '<div style=\"clear:both;display:none\" data-show3=\"list\">'+\r\n            '<a name=\"HIDE3\" style=\"cursor:pointer;float:left\">[-]</a>'+\r\n            '<div style=\"float:left\">'+\r\n              '<input type=\"checkbox\" name=\"catalog.filter.list\"> Exclusive list:<br>'+\r\n  //            '<input type=\"checkbox\" name=\"catalog.filter.list_mark_time\"> Mark:<br>'+\r\n  //            '<!-- &emsp;<input type=\"checkbox\" name=\"catalog.filter.list_time_scroll\"> Scroll to new post -->'+\r\n  //            '<div style=\"clear:both\">&emsp;<textarea style=\"height:1em\" cols=\"20\" name=\"catalog.filter.list_str\"></textarea></div>'+\r\n              '&emsp;<textarea style=\"height:1em\" cols=\"20\" name=\"catalog.filter.list_str\"></textarea>'+\r\n            '</div>'+\r\n            '<div style=\"float:left\">'+\r\n  //            '<div style=\"float:left\"><input type=\"checkbox\" name=\"catalog.filter.attr_list\"> Attribute list:<br></div>'+\r\n              '<input type=\"checkbox\" name=\"catalog.filter.attr_list\"> Attribute list:<br>'+\r\n              '&emsp;<textarea style=\"height:1em\" cols=\"20\" name=\"catalog.filter.attr_list_str\"></textarea>'+\r\n            '</div>'+\r\n            '<div style=\"float:left\">'+\r\n              'Watch time list:<br>'+\r\n  //            '<input type=\"checkbox\" name=\"catalog.filter.watch_list_mark_time\"> Mark:<br>'+\r\n              '&emsp;<textarea style=\"height:1em\" cols=\"20\" name=\"catalog.filter.watch_list_str\"></textarea>'+\r\n            '</div>'+\r\n            '<div style=\"float:left\">'+\r\n              '<input type=\"checkbox\" name=\"catalog.filter.bookmark_list\"> Bookmark list:<br>'+\r\n              '&emsp;<textarea style=\"height:1em\" cols=\"10\" name=\"catalog.filter.bookmark_list_str\"></textarea>'+\r\n            '</div>'+\r\n            '<div style=\"float:left\">'+\r\n              '<button name=\"load\">load</button><input type=\"checkbox\" name=\"catalog.auto_load_filter\">Auto'+\r\n              '&emsp;<button name=\"load_default\">clear_filters</button><br>'+\r\n              '<button name=\"save\">save</button><input type=\"checkbox\" name=\"catalog.auto_save_filter\">Auto'+\r\n              '&emsp;<input type=\"checkbox\" name=\"catalog.auto_save_filter_at_refresh\">Auto at refresh<br>'+\r\n            '</div>'+\r\n          '</div>'+\r\n          '<div style=\"clear:both\"></div>'+\r\n          '<a name=\"SHOW3\" style=\"cursor:pointer;float:left;display:none\" data-show3=\"kwd\">[+ keyword filter]</a>'+\r\n          '<a name=\"SHOW3\" style=\"cursor:pointer;float:left;display:none\" data-show3=\"time\">[+ Time filter]</a>'+\r\n          '<a name=\"SHOW3\" style=\"cursor:pointer;float:left\" data-show3=\"tag\">[+ Tag search]</a>'+\r\n          '<a name=\"SHOW3\" style=\"cursor:pointer;float:left\" data-show3=\"list\">[+ List filters]</a>'+\r\n        '</div>'+\r\n        '<div style=\"clear:both\"></div>');\r\n      pn12.childNodes[1].insertBefore(pn12_0_4, pn12_1); // appendChild(pn12_0_4);\r\n      var pls = pn12_0_4.getElementsByClassName('PLACEHOLDER');\r\n      pls[0].appendChild(site2[site.nickname].make_tack());\r\n      cnst.set_tack_float(pls[0], hide_prev_float, show_prev_dock);\r\n      var btns = pn12_0_2.getElementsByTagName('button');\r\n      cnst.set_target_of_button(btns['settings'],pn12_0_4.childNodes[0]);\r\n      cnst.set_target_of_button(btns['filter'],pn12_0_4.childNodes[1]);\r\n  this.pn12 = pn12;\r\n  this.pn12_0 = pn12_0;\r\n  this.pn12_1 = pn12_1;\r\n  this.pn12_0_2 = pn12_0_2;\r\n  this.pn12_0_4 = pn12_0_4;\r\n  this.board_sel = board_sel;\r\n  this.threads = {};\r\n  this.idxs = [];\r\n  this.drawn_idx = 0;\r\n  this.mode = embed_mode;\r\n  this.order = pref.catalog.order;\r\n  this.threads_odl = {};\r\n  this.Clgs.push(this);\r\n  this.ppn = pn12_1;\r\n\r\n  var clgs = Clg.prototype.Clgs\r\n  if (clgs.length==2) this.hook_set({\r\n    set drawn_idx(v){this.Clgs.forEach(function(c){c.drawn_idx = v;});},\r\n    footer: {\r\n      update: function(name,flags,tags, force){\r\n        var clgs = Clg.prototype.Clgs;\r\n        for (var i=0;i<clgs.length;i++) if (clgs[i].threads[name]) clgs[i].footer.update(name,flags,tags, force);\r\n      },\r\n      update_force: function(name,flags,tags){\r\n        var clgs = Clg.prototype.Clgs;\r\n        for (var i=0;i<clgs.length;i++) if (clgs[i].threads[name]) clgs[i].footer.update_force(name,flags,tags);\r\n      },\r\n      color_tag_node: function(name,tag){\r\n        var clgs = Clg.prototype.Clgs;\r\n        for (var i=0;i<clgs.length;i++) if (clgs[i].threads[name]) clgs[i].footer.color_tag_node(name,tag);\r\n      },\r\n      update_all_force: function(e,src, flags){\r\n        var clgs = Clg.prototype.Clgs;\r\n        for (var i=0;i<clgs.length;i++) clgs[i].footer.update_all_force(e,src, flags);\r\n      },\r\n      refresh_start: function(){\r\n        var clgs = Clg.prototype.Clgs;\r\n        clgs[0].footer.refresh_start();\r\n        for (var i=1;i<clgs.length;i++) clgs[i].footer.timestamp_set();\r\n      },\r\n      __proto__: Footer},\r\n    show_catalog: function(tgts_in){\r\n      var clgs = Clg.prototype.Clgs;\r\n      for (var i=0;i<clgs.length;i++) {\r\n        var clg = clgs[i];\r\n        if (!tgts_in) clg.show_catalog();\r\n        else if (typeof(tgts_in)==='string') {if (clg.threads[tgts_in]) clg.show_catalog(tgts_in);}\r\n        else {\r\n          var tgts = {};\r\n          var flag = false;\r\n          for (var t in tgts_in) if (clg.threads[t]) {tgts[t] = null; flag = true;}\r\n          if (flag) clg.show_catalog(tgts);\r\n        }\r\n      }\r\n    },\r\n    remove_thread: function(name, pn_only){\r\n      var clgs = Clg.prototype.Clgs;\r\n      for (var i=0;i<clgs.length;i++) clgs[i].remove_thread(name, pn_only);\r\n    },\r\n    __proto__:Clg.prototype});\r\n  this.footer = (clgs.length>=2)? Footer.factory(this.mode, this.threads, this) : (Footer.clg = this, Footer);\r\n    };\r\n      Clg.prototype = {\r\n        Clgs: [],\r\n        destroy: function(e){\r\n          var pn12 = e.currentTarget.parentNode;\r\n          cnst.div_destroy(e.currentTarget.parentNode, true);\r\n          var idx = Clg.prototype.Clgs.map(function(v){return v.pn12;}).indexOf(pn12);\r\n          var clg = Clg.prototype.Clgs.splice(idx,1)[0];\r\n          clg.footer.clg = null; // cut reference loop.\r\n          if (Clg.prototype.Clgs.length==1) Clg.prototype.hook_set(Clg.prototype.Clgs[0]);\r\n        },\r\n        hook_set: function(clg){\r\n          gClg = clg;\r\n          cataLog.Footer = clg.footer;\r\n          show_catalog = clg.show_catalog.bind(clg);\r\n          cataLog.show_catalog = show_catalog;\r\n          cataLog.gClg = gClg;\r\n        },\r\n        remove_thread: function(name, pn_only){\r\n          var ref = this.idxs.indexOf(name);\r\n          var tgt_th = this.threads[name];\r\n          if (name.substr(0,4)!=='ODL:') {\r\n            if (!tgt_th) return;\r\n            var lth = liveTag.mems.getFromName(name);\r\n            if (!pn_only) if (lth.q) site2[lth.domain].popups_release_all(lth, {}); // remove cross thread/board links.\r\n//            remove_threads_events(name); // must NOT use test_mode['104']\r\n            if (tgt_th[1]) {\r\n//              if (pop_up_status[name]) pop_down_op(name); // must NOT use test_mode['110']\r\n              if (tgt_th[0] && tgt_th[0].parentNode===this.ppn) this.func_hide(name); // parent check is for on_demand_draw\r\n              site2['DEFAULT'].update_posts_merge_bases.remove_th(tgt_th[16], true);\r\n              if (ref<this.drawn_idx) this.drawn_idx = 0;\r\n            }\r\n          }\r\n          if (pn_only) {\r\n            tgt_th[0] = false;\r\n            tgt_th[1] = false;\r\n            tgt_th[16].th = tgt_th[7];\r\n            tgt_th[16].posts = null;\r\n  //          if (!tgt_th[16].th) tgt_th[16].th = tgt_th[16];\r\n            if (tgt_th[24]) tgt_th[24][0] = null;\r\n            return;\r\n          }\r\n          delete this.threads[name]; // remove 'ODL:' also\r\n          if (pref.debug_mode['2']) console.log('removed: '+name);\r\n  //        for (var i=this.idxs.length-1;i>=0;i--) if (threads_idx[i]===name) {this.idxs.splice(i,1);break;}\r\n          if (ref>=0) this.idxs.splice(ref,1);\r\n          if (pref.test_mode['95'] && site.nickname==='dist') site2[site.nickname].testPoster(name);\r\n        },\r\n      };\r\n      var pClg = new Clg(embed_embed, embed_mode); // primary catalog\r\n      var pn12 = pClg.pn12;\r\n      var pn12_0 = pClg.pn12_0;\r\n      var pn12_1 = pClg.pn12_1;\r\n      var pn12_0_2 = pClg.pn12_0_2;\r\n      var pn12_0_4 = pClg.pn12_0_4;\r\n      var board_sel = pClg.board_sel;\r\n      var threads = pClg.threads;\r\n      Footer.threads = pClg.threads;\r\n      cataLog.threads = threads;\r\n      var threads_idx = pClg.idxs;\r\n      var pop_up_status = {};\r\n  Object.defineProperty(pClg,'idxs',{get:function(){return threads_idx;}, set:function(v){threads_idx = v;}}); // temporarily patch\r\n  Object.defineProperty(pClg,'order',{get:function(){return pref.catalog.order;}}); // temporarily patch\r\n//  Object.defineProperty(pClg,'drawn_idx',{get:function(){return this.catalog_obj2.drawn_idx;}, set:function(v){this.catalog_obj2.drawn_idx = v;}}); // temporarily patch\r\n  Object.defineProperty(pClg,'ppn',{get:function(){return triage_parent;}, set:function(v){triage_parent = v;}}); // temporarily patch\r\n      var gClg = pClg;\r\n      cataLog.gClg = gClg;\r\n\r\n      function hide_prev_float(e){\r\n        cnst.tack_float_nSblgs(e, true);\r\n//        site.script_body.appendChild(e.currentTarget.nextSibling);\r\n        e.currentTarget.previousSibling.style.display = 'none'; // must be AFTER float not to change offsetLeft.\r\n      }\r\n      function show_prev_dock(e){\r\n        var tack = cnst.tack_dock_e2tack(e);\r\n//        tack.parentNode.insertBefore(e.currentTarget.parentNode,tack);\r\n        tack.previousSibling.style.display = null;\r\n        cnst.tack_dock_nSblgs(e);\r\n      }\r\n\r\n      cataLog.components = {\r\n        catalog: {indexing:pn12_0_4.getElementsByTagName('select')['catalog.indexing']},\r\n        pn12_0: pn12_0,\r\n        pn12_0_4: pn12_0_4,\r\n        pn_hi: null,\r\n      };\r\n//      if (!embed_embed) pn12_0_4.style.background = '#e5ecf9';\r\n//      else if (embed_mode==='catalog') {\r\n      if (embed_mode==='catalog' || embed_mode==='page' || embed_mode==='thread') {\r\n        pn12_0_2.getElementsByTagName('span')['hide_at_embed'].style.display = 'none';\r\n        pn12_0_4.getElementsByTagName('div')['hide_at_embed'].style.display = 'none';\r\n      }\r\n      var hide_target = (pref.catalog.text_mode.mode==='text')? 'catalog.text_mode.mode.graphic' : 'catalog.text_mode.mode.text';\r\n      pn12_0_4.getElementsByTagName('span')[hide_target].style.display = 'none';\r\n      if (embed_mode==='thread') pref_func.pref_overwrite(pref.catalog.filter,pref_default().catalog.filter);\r\n      filter_kwd_prep_init(null, pref.catalog.filter.kwd,true); // prep kwd.rexps\r\n\r\n//      pref_func.tooltips.add_hier(pn12_0_4);\r\n      pref_func.tooltips.add_root(pn12_0_4);\r\n//      if (pref[embed_mode].auto_config_posts_search) auto_config_posts_search_deactivate();\r\n      pref_func.apply_prep(pn12_0_4,false, null, null, true);\r\n//      pref_func.apply_prep(pn12_0_4,true); // obj init.\r\n      var pn12_0_4_selectors = pn12_0_4.getElementsByTagName('select');\r\n      for (var i=0;i<pn12_0_4_selectors.length;i++) cnst.auto_shrink_selector(pn12_0_4_selectors[i]);\r\n//      function catalog_setting_onchange_event(){\r\n////console.log(this);\r\n//        pref_func.apply_prep(this,true);\r\n//        if (onchange_funcs[this.name]) onchange_funcs[this.name]();\r\n//      }\r\n      var pn_filter = pn12_0_4.childNodes[1];\r\n      var catalog_board_list_sel_old;\r\n      var oninput_funcs = {\r\n        'catalog.filter.kwd.str': (function(){\r\n          var pn_use = pn_filter.getElementsByTagName('*')['catalog.filter.kwd.use'];\r\n          return function(e){\r\n            if (pref.catalog.filter.kwd.use == !pref.catalog.filter.kwd.str) {\r\n              pref.catalog.filter.kwd.use = !pref.catalog.filter.kwd.use;\r\n              pref_func.apply_prep(pn_use,false);\r\n            }\r\n            if (e && e.target.name.substr(-4,4)==='.str') pref3.catalog.filter.kwd.str(e);\r\n            filter_kwd_prep(e, pref.catalog.filter.kwd);\r\n          }\r\n        })(),\r\n        'catalog.filter.list_str'  : function(){catalog_filter_changed();if (pref[embed_mode].mark_new_posts) format_html.time_filter_changed();},\r\n        'catalog.filter.attr_list_str': function(){if (pref.catalog.filter.attr_list) catalog_attr_changed();},\r\n        'catalog.filter.tag_search.str': liveTag.popup_filter.oninput_funcs['catalog.filter.tag_search.str'],\r\n        __proto__: pref_func.settings.oninput_funcs.__proto__\r\n      };\r\n      var onchange_funcs = {\r\n//        'catalog.filter.show' : function(){cnst.show_hide(pn_filter,pn12_1);},\r\n//        'catalog_show_setting': function(){cnst.show_hide(pn_setting,pn12_1);},\r\n//        'filter' : function(){cnst.show_hide(pn_filter,pn12_1);cnst.toggleButton(this);}, // pn12_1 for maximize state\r\n//        'settings': function(){cnst.show_hide(pn_setting,pn12_1);cnst.toggleButton(this);},\r\n//        'refresh'             : function(){catalog_refresh(true,null,false);},\r\n        'refresh'             : function(){auto_update.timer_tgt(true);},\r\n        'catalog_board_list_sel' : function(e, init){\r\n          if (!init) {\r\n            e.target.blur();\r\n            if (pref.catalog.auto_save_filter) onchange_funcs.save(catalog_board_list_sel_old);\r\n            if (pref.catalog.refresh.at_switch) catalog_clear_threads(0);\r\n            prep_reserved_tags(false,catalog_board_list_sel_old);\r\n          }\r\n          threads_delayed_pruning = Object.create(null);\r\n          if (pref.catalog.auto_load_filter) onchange_funcs.load();\r\n          if (!init) catalog_refresh(pref.catalog.refresh.at_switch,null,false, true);\r\n//          if (pref[embed_mode].auto_config_posts_search) {\r\n//            pref.catalog.filter.kwd.post = false;\r\n//            pref_func.apply_prep(pn12_0_4.getElementsByTagName('input')['catalog.filter.kwd.post'],true);\r\n//          }\r\n          catalog_board_list_sel_old = pref.catalog_board_list_sel;\r\n        },\r\n        'catalog_size_width'  : catalog_resized,\r\n        'catalog_size_height' : catalog_resized,\r\n        'catalog_size_text_width'  : catalog_resized,\r\n        'catalog_size_text_height' : catalog_resized,\r\n        'catalog.indexing'    : re_sort_thread,\r\n//        'catalog.indexing'    : function(){\r\n//          threads_idx=[];\r\n//          for (var i in threads) insert_thread_idx(i);\r\n//          show_catalog();\r\n//        },\r\n        '*.auto_update' : function(){auto_update.set()},\r\n        '*.auto_update_period' : '*.auto_update',\r\n        'clear_threads'       : function(){catalog_clear_threads(0);show_catalog();},\r\n        'load'                : function(){\r\n          if (localStorage) {\r\n            pref_func.pref_overwrite(pref.catalog.filter,pref_default().catalog.filter);\r\n            try { \r\n              pref_func.pref_overwrite(pref.catalog.filter,JSON.parse(localStorage.getItem(onchange_funcs.load_save_key(board_sel.selectedIndex))),true);\r\n              pref_func.apply_prep(pn_filter,false, null, null, true); // also make obj.\r\n//              pref_func.apply_prep(pn_filter,true); // make obj2.\r\n              filter_kwd_prep_init(null, pref.catalog.filter.kwd, initialize_loop);\r\n              liveTag.filter_onchange(pref.catalog.filter.tag_search, true);\r\n              catalog_attr_changed();\r\n            } catch (e){\r\n              console.log(e);\r\n            }\r\n          }\r\n        },\r\n//        'save_onleave'        : function(){if (pref.catalog.auto_save_filter) onchange_funcs.save();window.removeEventListener('beforeunload', onchange_funcs.save_onleave, false);},\r\n//        'save'                : function(){if (localStorage) localStorage.setItem(onchange_funcs.load_save_key(pref.catalog_board_list_sel),JSON.stringify(pref.catalog.filter));},\r\n        'save'                : function(sel){\r\n          if (localStorage) {\r\n            if (typeof(sel)!=='number') sel = pref.catalog_board_list_sel;\r\n            var pf = pref.catalog.filter;\r\n            var save_str = JSON.stringify(\r\n              pref_func.obj_elim_the_same(pref_default(true).catalog.filter, pref.catalog.filter),\r\n              (!pf.time && !pf.time_watch && !pf.time_watch_creation && !pf.time_creation)?\r\n                function(key,value){return (key==='time_str')? undefined : value;} : undefined);\r\n            var key = onchange_funcs.load_save_key(sel);\r\n            if (!key) return;\r\n            if (save_str==='{}') delete localStorage[key];\r\n            else localStorage.setItem(key, save_str);\r\n          }\r\n        },\r\n        'load_default'               : function(){\r\n//          var pref_def = pref_default();\r\n          pref_func.pref_overwrite(pref.catalog.filter,pref_default().catalog.filter);\r\n//          pref.catalog.filter.time_str = new Date().toLocaleString();\r\n          pref_func.apply_prep(pn12_0_4,false, null, null, true);\r\n//          pref_func.apply_prep(pn12_0_4,true); // obj init.\r\n          filter_kwd_prep(null, pref.catalog.filter.kwd);\r\n          catalog_attr_changed();\r\n        },\r\n        'load_save_key'       : function(num){\r\n          var row_obj = pref.catalog_board_list_obj[num];\r\n          return (row_obj)? pref.script_prefix + '.catalog.filter.' + row_obj[0].key : null;},\r\n        'catalog.filter.kwd.*'   : filter_kwd_active,\r\n//        'catalog.filter.kwd.use'   : filter_kwd_active,\r\n        'catalog.filter.kwd.match' : filter_kwd_prep,\r\n        'catalog.filter.kwd.re'    : filter_kwd_prep,\r\n        'catalog.filter.kwd.ci'    : filter_kwd_prep,\r\n        'catalog.filter.kwd.sentence': filter_kwd_prep,\r\n//        'catalog.filter.kwd.op'    : filter_kwd_active,\r\n//        'catalog.filter.kwd.sub'   : filter_kwd_active,\r\n//        'catalog.filter.kwd.name'  : filter_kwd_active,\r\n//        'catalog.filter.kwd.file'  : filter_kwd_active,\r\n//        'catalog.filter.kwd.com'   : filter_kwd_active,\r\n//        'catalog.filter.kwd.trip'  : filter_kwd_active,\r\n//        'catalog.filter.kwd.meta'  : filter_kwd_active,\r\n        'catalog.filter.kwd.post'  : function(e){\r\n          filter_kwd_active(e);\r\n          if (e.target.checked) {\r\n            if (pref[cataLog.embed_mode].searchAs) onchange_funcs.scanBoard(e, true, true);\r\n            if (pref[cataLog.embed_mode].searchAsA) onchange_funcs.scanSite(e, true, true);\r\n          }\r\n//          if (pref[embed_mode].auto_config_posts_search) {\r\n//            if (e.target.checked) {\r\n//              pref[embed_mode].t2h_sel = 'ALL_agg';\r\n//              if (embed_mode==='catalog') pref[embed_mode].popup2 = 'sr';\r\n//              onchange_funcs.scanBoard();\r\n//            } else {\r\n//              var pref_def = pref_default();\r\n//              pref[embed_mode].t2h_sel = pref_def[embed_mode].t2h_sel;\r\n//              if (embed_mode==='catalog') pref[embed_mode].popup2 = pref_def[embed_mode].popup2;\r\n//            }\r\n//            pref_func.apply_prep(pref_func.mirror_targets.pn13_1,false);\r\n//          }\r\n        },\r\n        'catalog.filter.tag'       : catalog_filter_changed,\r\n//        'catalog.filter.tag_list'  : catalog_filter_changed,\r\n        'catalog.filter.time'      : oninput_funcs['catalog.filter.list_str'],\r\n        'catalog.filter.time_creation' : 'catalog.filter.time',\r\n        'catalog.filter.time_str'  : 'catalog.filter.time',\r\n        'catalog.filter.list'      : 'catalog.filter.time',\r\n        'catalog.filter.watch_list_str' : 'catalog.filter.time',\r\n//        'catalog.filter.attr_list' : catalog_filter_changed,\r\n//        'catalog.filter.attr_list_str' : catalog_filter_changed,\r\n//        'catalog.filter.attr_list' : show_catalog, //catalog_attr_changed,\r\n//        'catalog.filter.attr_list_str' : show_catalog, //catalog_attr_changed\r\n        'catalog.filter.attr_list' : catalog_attr_changed,\r\n//        'scan'                     : scan_tags,\r\n        'scanBoardIf': function(e){onchange_funcs.scanBoard(e,false,true);},\r\n        'scanSiteIf': function(e){onchange_funcs.scanSite(e,false,true);},\r\n        'scanBoard' : function(e, from_auto, required_only){if (!from_auto && pref.common.clear_at_manual_scan) onchange_funcs.clear_threads();scan.keyword_load_1(site.nickname,required_only? 2:true,[site.board], health_indicator);},\r\n\r\n        'scanSite' : function(e, from_auto, required_only){if (!from_auto && pref.common.clear_at_manual_scan) onchange_funcs.clear_threads();scan.keyword_load(required_only? 2:true, health_indicator);},\r\n        'catalog.order.reply_to_me' : re_sort_thread,\r\n        'catalog.order.reply'       : re_sort_thread,\r\n        'catalog.order.watch'       : re_sort_thread,\r\n        'catalog.order.sticky'      : re_sort_thread,\r\n//        'catalog.filter.tag_ci'     : function(){scan_tags_init(scan_tags_common_c(site3[site.nickname].tags,'')[0], null);},\r\n        'catalog.filter.time_quick_sel': function(){\r\n          var time = [0,0,1,2,4,12,24,72,168][this.selectedIndex]*3600000;\r\n          ago_clicked(null, time);\r\n        },\r\n        'catalog.filter.tag_search.re': 'catalog.filter.tag_search.str',\r\n        'catalog.filter.tag_search.show_nof_boards': liveTag.popup_filter.onchange_funcs['catalog.filter.tag_search.show_nof_boards'],\r\n        'tagB.*': liveTag.cbx_all_onchange,\r\n        'tag2bList': liveTag.add_tags_to_boardlist,\r\n        'add_to_auto': function(e){\r\n          var pf = pref.catalog.filter.auto_list;\r\n          var cmds = [pf.kill? 'KILL':null, pf.watch? 'WATCH':null, pf.show? 'SHOW':null, pf.sticky? 'STICKY':null, pf.style? 'ATTR:'+pf.style_str:null].filter(function(v){return v;}).join();\r\n          if (pref.catalog.filter.kwd.str==='') return;\r\n          var str = pref_func.str2obj7.o2s({cmds:cmds, __proto__:pref.catalog.filter.kwd});\r\n          pref.catalog.filter.auto_list.str += str+'\\n';\r\n          var pn = e.target.parentNode.getElementsByTagName('TEXTAREA')[0];\r\n          pref_func.apply_prep(pn,false, null, null, true);\r\n        },\r\n        'filter.disable_list_when_kwd_active': function(){if (pref.catalog.filter.kwd.active) catalog_filter_changed();},\r\n        'filter.disable_tag_when_kwd_active': 'filter.disable_list_when_kwd_active', \r\n        __proto__: oninput_funcs,\r\n      };\r\n////      onchange_funcs.entry_func = (function(myself){ // working code.\r\n////        return function(e){\r\n////          pref_func.apply_prep(this,true);\r\n////          var this_name = this.getAttribute('name'); // for <span>\r\n////          if (myself[this_name]) myself[this_name].call(this,e);\r\n////          else if (this_name.indexOf('.')!=-1 && this_name.substr(0,this_name.indexOf('.'))===embed_mode) {\r\n////            var name = this_name.substr(this_name.indexOf('.')+1);\r\n////            if (myself[name]) myself[name].call(this,e);\r\n////          }\r\n////        }\r\n////      })(onchange_funcs);\r\n      window.addEventListener('beforeunload', window_beforeunload, false);\r\n      oninput_funcs = pref_func.add_onchange_format(oninput_funcs);\r\n      onchange_funcs = pref_func.add_onchange_format(onchange_funcs);\r\n      pref_func.add_onchange(pn12_0_2,onchange_funcs, oninput_funcs); // causes 1 leak.\r\n      cataLog.event_func = pref_func.add_onchange(pn12_0_4,onchange_funcs, oninput_funcs); // causes 1 leak.\r\n//console.log('init_onchange');\r\n      window.addEventListener('storage', site2[site.nickname].prep_own_posts_event, false);\r\n//      site2[site.nickname].prep_own_posts();\r\n      site2[site.nickname].check_reply.make_own_posts(); // prevent from calling twice.\r\n      function window_beforeunload() {\r\n        if (pref.catalog.auto_save_filter && embed_mode!=='thread') onchange_funcs.save();\r\n        window.removeEventListener('beforeunload', window_beforeunload, false);\r\n      }\r\n      if (initialize_loop && pref.virtualBoard.scan && embed_mode!=='thread')\r\n        setTimeout(function(){scan.keyword_load(false, health_indicator);}, pref.virtualBoard.scanDelay*1000);\r\n      \r\n      var pn_setting = pn12_0_4.childNodes[0];\r\n      var triage_parent;\r\n      triage_parent_set();\r\n      function triage_parent_set(){\r\n        triage_parent = (embed_embed)? site2[site.nickname].catalog_get_native_area() : pn12_1;\r\n        cataLog.parent = triage_parent;\r\n        pClg.ppn = triage_parent;\r\n      }\r\n      cataLog.triage_parent_set = triage_parent_set;\r\n//      if (pref.catalog.auto_load_filter) onchange_funcs.load();\r\n      onchange_funcs.catalog_board_list_sel(null,true);\r\n\r\n      var tags_scan_regex = new RegExp('#[^#, \\.:;\\n]+(?=#|,| |\\.|:|;|\\n|$)','g'); // ATTENTION. REFER function prep_tag_str(); // AND ALSO IN scan_tag_obj.\r\n      var scan_boards = (function(){\r\n//        var scan_button   = pn12_0_4.getElementsByTagName('button')['scanSite'];\r\n////////        var scan_boards   = {args:{}, crawler_timer:null, pool:null};\r\n        var scan_boards   = {args:{}, pool:null};\r\n////////        var scan_progress = (function(){\r\n////////          var elem = pn12_0_4.getElementsByTagName('span')['scan_progress'];\r\n////////          var timer = null;\r\n////////          var str = '';\r\n////////          function show(){elem.innerHTML=str; timer=null;}\r\n////////          return function(s){str=s; if (timer===null) timer = setTimeout(show,100);};\r\n////////        })();\r\n////////        function keyword_load(key){ // working code.\r\n////////          if (scan_boards_check_pre(key,true)) {\r\n//////////            if (pref.common.clear_at_manual_scan && !keep) onchange_funcs.clear_threads();\r\n////////            scan_button.innerHTML = 'Cancel';\r\n////////            if (!site3[site.nickname].boards) {\r\n////////              http_req.get(key,site.nickname,site2[site.nickname].url_boards_json(),scan_boards_keyword_callback,pref.scan.lifetime*60,true,key);\r\n////////              scan_progress('Loading boards\\' information');\r\n////////            } else {\r\n////////              var tgts = site2[site.nickname].enumerate_boards_to_scan(); // must remake to evaluate change of preference.\r\n////////              scan_boards_init(key, tgts, {lifetime:pref.scan.lifetime*60, cache_write:true,\r\n////////                                           callback:(pref.liveTag.use)? catalog_liveTag_scan_threads : null, callback_args:'scan'});\r\n////////            }\r\n////////          }\r\n////////        }\r\n        function scan_boards_check_pre(key){\r\n          if (scan_boards.args[key]) {\r\n            if (scan_boards.args[key].max != scan_boards.args[key].idx) {\r\n              scan_boards.args[key].max = scan_boards.args[key].idx;\r\n              if (scan_boards.args[key].indicator) scan_boards.args[key].indicator.report({abort_str:'canceled'});\r\n            } else {\r\n////////              if (scan_boards.args[key].crawler_watchdog) scan_boards.args[key].crawler_watchdog.stop();\r\n////              crawler.watchdog.abort(key);\r\n              if (scan_boards.args[key].indicator) scan_boards.args[key].indicator.report({abort_str:'aborted', end:Date.now()});\r\n              delete scan_boards.args[key];\r\n            }\r\n            return false;\r\n          } else return true;\r\n        }\r\n//        function scan_boards_keyword_init(key){\r\n//          scan_boards_init(key, site3[site.nickname].boards,pref.catalog.filter.tag_scansite,pref.catalog.filter.tag_scansite,pref.scan.lifetime*60);\r\n//          var obj = [];\r\n//          obj.max_threads = pref.scan.max_threads;\r\n//          var count = pref.scan.max;\r\n//          for (var i in site3[site.nickname].boards) if (site3[site.nickname].boards[i].max) {\r\n//            obj.push('/'+site3[site.nickname].boards[i].uri+'/');\r\n//            if (--count==0) break;\r\n//          }\r\n//          scan_boards_init(key, obj, {lifetime:pref.scan.lifetime*60, cache_write:true});\r\n//        }\r\n        function scan_init(key,mem,args, multi_entry){\r\nif (pref.debug_mode['5']) console.log('scan_init: '+key);\r\n          if (!multi_entry && !scan_boards_check_pre(key,false)) return;\r\n          if (!Array.isArray(mem)) mem = Object.keys(mem);\r\n          if (mem.length==0) {\r\n            if (args.callback) args.callback(args.callback_args);\r\n            return;\r\n          }\r\n          scan_boards_init(key, mem, args);\r\n        }\r\n        scan_boards.args_proto = { // for httpd\r\n          callback_1: function(req,value,REQ){\r\n            scan_boards_keyword_callback2(req.key2||'',value,[null,REQ]); // req.key2||'' for over limit error.\r\n          },\r\n          get_tgt_func: function(req){\r\n            if (req.IDX<req.max && (req.refresh || req.found_threads<req.max_threads)) {\r\n              do {\r\n                var tgt = scan_boards_keyword_make_tgt(req,req.IDX++);\r\n              } while (req.IDX<req.max && (!tgt || (pref.catalog.board.ex_list && pref_func.merge_obj5(tgt,pref.catalog.board.ex_list_obj2,{hit:false}).hit)));  // 'if (tgt)' is for tgts_iterator\r\n              if (req.IDX<=req.max) {\r\n                var archived = scan.list_nup.issued(tgt);\r\n                var dbt = common_func.name2dbt(tgt);\r\n                var url = site2[dbt[0]].make_url4(dbt);\r\n                var key2 = dbt.join(',');\r\n                return {REQ:req, url:url[0], responseType:(archived)? 'text' : (url[1]==='html')? 'document' : url[1], tgt:tgt, key2:key2, data_type:url[1], domain:dbt[0]};\r\n              }\r\n            }\r\n          },\r\n          callback: function(req){\r\n            if (req.found_threads>=req.max_threads) req.INDICATOR.report({err_str:'Aborted.(Reached upper limit)'});\r\n            delete scan_boards.args[req.key];\r\n            if (Object.keys(scan_boards.args).length==0) scan_boards.pool = null;\r\n            if (req.callback2) req.callback2(req.callback_args);\r\n          },\r\n          init_func: function(req){\r\n            Object.defineProperty(req,'idx',{get:function(){return this.IDX;}, configurable:true}); // for test.\r\n            Object.defineProperty(req,'indicator',{get:function(){return this.INDICATOR;}, configurable:true}); // for test.\r\n            Object.defineProperty(req,'tgts',{get:function(){return this.obj;}, configurable:true}); // for test.\r\n            Object.defineProperty(req,'initiator',{get:function(){return this.key;}, configurable:true}); // for test.\r\n            if (req.hasOwnProperty('callback')) {\r\n              req.callback2 = req.callback;\r\n              delete req.callback;\r\n            }\r\n          },\r\n        };\r\n        scan_boards.args_proto.callback_1_fail = scan_boards.args_proto.callback_1;\r\n        function scan_boards_init(key, obj, args){\r\n          if (!scan_boards.pool) scan_boards.pool = {\r\n            div: document.createElement('div'), parser: new DOMParser(), doc: null, ths: null, dbt: null, tgts: null, tags:{cs:{}, ci:{}},\r\n            name:null, sticky:null, type:null, wrapper_obj:null};\r\n  //        var obj = site3[site.nickname].boards;\r\n          scan_boards.args[key] = {\r\n                key: key,\r\n                idx: 0,\r\n//                max: (obj.length>pref.scan.max)? pref.scan.max : obj.length,\r\n                max: obj.length,\r\n//                max_threads: (obj.length>pref.scan.max)? obj.length : pref.scan.max,\r\n                max_threads: pref4.scan.max_threads,\r\n                found_threads: 0,\r\n                found_boards: 0,\r\n                scanned: 0,\r\n////////                error: '',\r\n//                error_obj: {},\r\n                crawler: 0,\r\n////////                crawler_max : pref.scan.crawler,\r\n                obj: obj,\r\n//                scan_tag: pref.catalog.filter.tag_scansite,\r\n//                store_tag: pref.catalog.filter.tag_scansite,\r\n                lifetime: 0,\r\n                cache_write: false,\r\n                callback : null,\r\n                callback_args : null,\r\n                pool: scan_boards.pool,\r\n                refresh: null,\r\n                indicator: null,\r\n                tgt_raw: false,\r\n                watchdog: null,\r\n////////                spawn_crawler: function(){scan_boards_spawn_crawler(key);},\r\n////////                crawler_watchdog: null,\r\n                from_auto: null,\r\n                load_on_demand: null,\r\n//                tag_only: null,\r\n                senders_returned:[],\r\n                priority: 0,\r\n                tgts_iterator: null,\r\n            __proto__: scan_boards.args_proto\r\n          };\r\n          for (var i in args) scan_boards.args[key][i] = args[i];\r\n          var sb = scan_boards.args[key];\r\n\r\n          if (sb.load_on_demand && !sb.tgts_iterator) {\r\n////            sb.max = 1; // working code.\r\n////            for (var i=obj.length-1;i>=1;i--) {\r\n////              var name = 'ODL:'+ sb.obj[i];\r\n////              var idx = threads_idx.indexOf(name);\r\n////              if (idx!=-1) threads_idx.splice(idx,1);\r\n////              threads_idx.unshift(name);\r\n////            }\r\n            for (var i=0;i<sb.obj.length;i++) {\r\n              var tgt = scan_boards_keyword_make_tgt(sb,i);\r\n              var dbt = common_func.name2domainboardthread(tgt,true);\r\n              if (dbt[2].search(/[cjpq][1-9]/)===0) {\r\n                threads_index.idx_insert_odl(tgt);\r\n                sb.obj.splice(i--,1);\r\n              }\r\n            }\r\n            if (sb.obj.length===0) {\r\n              if (sb.indicator) sb.indicator.remove();\r\n              if (sb.callback) {\r\n                var func = sb.callback\r\n                var args = sb.callback_args;\r\n              }\r\n              delete scan_boards.args[sb.key];\r\n              return (func)? func(args) : undefined;\r\n            } else {\r\n              if (load_on_demand.get()) sb.callback = (sb.callback)? (function(func_old){return function(){load_on_demand.release();func_old();}})(sb.callback) : load_on_demand.release; // First access may not have mutex.\r\n              sb.max = sb.obj.length;\r\n              pClg.drawn_idx = 0;\r\n            }\r\n          }\r\n\r\n          scan_boards.args_proto.init_func(sb);\r\n          httpd.req(sb, (sb.priority<7)? sb.priority+1 : 1); // patch\r\n          \r\n////          if (!sb.indicator) sb.indicator = health_indicator.shift('limegreen','r',sb.key,sb.priority); // working code.\r\n////          sb.indicator.report({start:Date.now(), prog:sb}); // make reference loop.\r\n////          while (sb.crawler<pref.scan.crawler) {\r\n////////////            scan_boards_spawn_crawler(key, true);\r\n////            crawler.spawn(key, true);\r\n////            if (pref.scan.crawler_adaptive) break;\r\n////          }\r\n        }\r\n////        var crawler = { // working code.\r\n////          key: null,\r\n////          priority: 0,\r\n////          num: 0, // dangerous, may hang up, all crawlers must be returned.\r\n////          wdg_spawn: null,\r\n////          spawn_req: function(sb){\r\n////            this.clear_req(sb);\r\n////            if (sb.priority>=this.priority) {\r\n////              if (this.num<pref.scan.crawler || sb.priority>this.priority) {\r\n////                this.wdg_spawn.start(pref.scan.crawler_idle_time_to_spawn);\r\n////                this.key = sb.key;\r\n////                this.priority = sb.priority;\r\n////              }\r\n////            }\r\n////          },\r\n////          spawn: function(key, init){\r\n////            var sb = scan_boards.args[(key || this.key)]; // not to keep greping 'sb' object, 'key' and 'priority' are primitives.\r\n////            if (sb && sb.idx<sb.max) {\r\n////              var sender = (sb.senders_returned.length>0)? sb.senders_returned.shift() : sb.key+':'+sb.crawler;\r\n////              sb.crawler++;\r\n////              this.num++;\r\n////              this.watchdog.add(sb, sender);\r\n////              if (pref.debug_mode['5']) console.log('crawler_spawn: '+sender+'/'+sb.crawler);\r\n////              scan_boards_keyword([sender,sb],200);\r\n////              if (!init && !pref.scan.crawler_adaptive) this.spawn_req(sb);\r\n////            }\r\n////          },\r\n////          clear_req: function(sb){\r\n////            if (sb.priority>=this.priority) this.wdg_spawn.stop();\r\n////          },\r\n////          check_priority: function(sb, sender){\r\n////            if (sb.priority>=this.priority || sb.crawler==1) return true;\r\n////            else {\r\n////              this.finish(sb, sender);\r\n//////              sb.senders_returned.push(sender);  // THIS CAUSED A BUG,\r\n////                                                   // crawler with status 1200(now changed to -200) call 'finish' immediately,\r\n////                                                   // but this is respawned and causes multiple call of 'watchdog.add'.\r\n////                                                   // For easy debug, this was moved to 'finish'.\r\n////              return false;\r\n////            }\r\n////          },\r\n////          finish: function(sb, sender){\r\n////            this.clear_req(sb);\r\n////            http_req.close(sender);\r\n////            this.watchdog.end(sender);\r\n////            sb.senders_returned.push(sender); // shold be here, but slightly redundant for end.\r\n////            sb.crawler--;\r\n////            this.num--;\r\n////            if (pref.debug_mode['5']) console.log('crawler_finish: '+sender+'/'+sb.crawler);\r\n////          },\r\n////          finish_all: function(sb){\r\n////            this.priority = 0;\r\n////            if (Object.keys(scan_boards.args).length==0) this.reset(); // for safety.\r\n////            else for (var key in scan_boards.args) if (scan_boards.args[key].senders_returned.length>0) this.spawn(key);\r\n////          },\r\n////          reset: function(){\r\n////            this.num = 0;\r\n////            this.watchdog.reset();\r\n////          },\r\n////          watchdog: {\r\n////            list: [],\r\n////            sbs: Object.create(null),\r\n////            add: function(sb,sender){\r\n////              this.list.push(sender);\r\n////              this.sbs[sender] = sb;\r\n////              if (this.list.length===1) this.wdg.start();\r\n////            },\r\n////            end: function(sender){\r\n////              this.report_alive(sender);\r\n////              delete this.sbs[sender];\r\n////              this.list.splice(this.list.indexOf(sender),1);\r\n////              if (this.list.length===0) this.wdg.stop();\r\n//////              else this.wdg.restart(); // this is redundant because report_alive exists before\r\n////            },\r\n////            wdg: null,\r\n////            report_alive: function(sender){\r\n////              if (sender===this.list[0]) {\r\n////                this.list.push(this.list.shift());\r\n////                this.wdg.restart();\r\n////              }\r\n////            },\r\n////            respawn: function(){\r\n////              var sender = this.list[0];\r\n////              var sb = this.sbs[sender];\r\n////              if (pref.debug_mode['7']) console.log('crawler_respawn: '+sender+'/'+((sb)?sb.crawler:'undefined'));\r\n////              scan_boards_keyword([sender,sb],200);\r\n////              this.report_alive(sender);\r\n////            },\r\n////            reset: function(){\r\n////              this.list = [];\r\n////              this.sbs = Object.create(null);\r\n////              this.wdg.stop();\r\n////            },\r\n////            abort: function(key){\r\n////              for (var i=this.list.length-1;i>=0;i--) if (this.list[i].indexOf(key+':')===0) this.end(this.list[i]);\r\n////            },\r\n////          },\r\n////          priority_up: null,\r\n////          priority_release: null,\r\n////          priority_wdg: null,\r\n////          priority_count: 0,\r\n////        };\r\n////        crawler.wdg_spawn = new Watchdog(crawler.spawn.bind(crawler), 100);\r\n////        crawler.watchdog.wdg = new Watchdog(crawler.watchdog.respawn.bind(crawler.watchdog), 30000);\r\n////        crawler.priority_up = function(p){\r\n////                                this.priority = p;\r\n////                                this.priority_count++;\r\n////                                this.priority_wdg.start();\r\n////                              }.bind(crawler);\r\n////        crawler.priority_release = function(){\r\n////                                     if (--this.priority_count<=0) {\r\n////                                       this.priority=0;\r\n////                                       this.priority_wdg.stop();\r\n////                                     } else this.priority_wdg.restart();\r\n////                                   }.bind(crawler);\r\n////        crawler.priority_wdg = new Watchdog(crawler.priority_release, 10000);\r\n\r\n////////        function scan_boards_spawn_crawler_timer(sb){ // working code.\r\n////////          scan_boards_crawler_timer_clear();\r\n////////          if (sb.crawler<sb.crawler_max) scan_boards.crawler_timer = setTimeout(sb.spawn_crawler, pref.scan.crawler_idle_time_to_spawn);\r\n////////        }\r\n////////        function scan_boards_spawn_crawler(key, init){\r\n////////          var sb = scan_boards.args[key];\r\n////////          if (pref.debug_mode['5']) console.log('crawler_spawn: '+sb.key+', '+(sb.crawler+1));\r\n////////          scan_boards_keyword([sb.key+sb.crawler++,sb],200);\r\n////////          if (!init && sb.idx<sb.max) scan_boards_spawn_crawler_timer(sb);\r\n////////        }\r\n////////        function scan_boards_crawler_timer_clear(){\r\n////////          if (scan_boards.crawler_timer!==null) {\r\n////////            clearTimeout(scan_boards.crawler_timer);\r\n////////            scan_boards.crawler_timer=null;\r\n////////          }\r\n////////        }\r\n////////        var CrawlerWatchdog = function(sb){ // patch for 8chan's unstability.\r\n////////          this.sb = sb;\r\n////////          this.tgt = 0;\r\n////////          this.db = new DelayBuffer(this.respawn.bind(this), 30000);\r\n////////          this.db.delayed_do();\r\n////////        }\r\n////////        CrawlerWatchdog.prototype = {\r\n////////          report_alive: function(kwd){\r\n////////            if (!this.sb) return; // stopped already\r\n////////            var me = kwd.substr(this.sb.key.length);\r\n////////            if (this.tgt==me) {\r\n////////              this.tgt = (this.tgt<this.sb.crawler-1)? this.tgt+1 : 0;\r\n////////              this.db.cancel();\r\n////////              this.db.delayed_do();\r\n////////            }\r\n////////          },\r\n////////          respawn: function(){\r\n////////            if (this.sb.idx<this.sb.max) {\r\n////////              if (pref.debug_mode['7']) console.log('crawler_respawn: '+this.sb.key+this.tgt+'/'+this.sb.crawler);\r\n////////              scan_boards_keyword([this.sb.key+this.tgt,this.sb],200);\r\n////////              this.report_alive(this.sb.key+this.tgt);\r\n////////            } else {\r\n////////              if (pref.debug_mode['7']) console.log('crawler_respawn: '+this.sb.key+this.tgt+'/'+this.sb.crawler+', stopped.');\r\n////////              this.stop();\r\n////////            }\r\n////////          },\r\n////////          stop: function(){\r\n////////            this.db.cancel();\r\n////////            this.sb = null; // release pointer\r\n////////          }\r\n////////        }\r\n        function scan_boards_keyword_make_tgt(sb,idx){\r\n          var tgt = (sb.tgts_iterator)? sb.tgts_iterator.next().value : sb.obj[idx];\r\n          if (tgt && typeof(tgt)!=='string') {\r\n            var force_json = tgt.u&0x0080;\r\n            tgt = tgt.key;\r\n          }\r\n          var dbt;\r\n          if (tgt) dbt = cnst.name2domainboardthread(tgt,true);\r\n          return (!tgt)? tgt:\r\n                 (sb.tgt_raw)? tgt :\r\n                 (dbt[2]==='')? tgt + ((pref.catalog.catalog_json | force_json)? 'j0' : 'c0') :\r\n                 (pref.catalog.catalog_json && dbt[2][0].search(/[0-9]/)!=-1)? dbt[0]+dbt[1]+'t'+dbt[2] : tgt;\r\n        }\r\n////        function scan_boards_keyword(args,status){ // working code.\r\n////          var sender = args[0];\r\n////          var sb = args[1];\r\n////          crawler.watchdog.report_alive(sender);\r\n////          if (sb.watchdog) sb.watchdog();\r\n////          if (pref.scan.crawler_adaptive) if (!crawler.check_priority(sb,sender)) return;\r\n////////////          if (sb.crawler_watchdog) sb.crawler_watchdog.report_alive(sender);\r\n//////if (pref.debug_mode['5']) console.log('request_entry: '+sb.idx+'/'+sb.max+', '+sb.found_threads+'/'+sb.max_threads+', '+status);\r\n////if (pref.debug_mode['5'] && sb.idx!=0 && sb.idx%1000==0) console.log('request_progress: '+sb.key+', '+sb.idx+'/'+sb.max+', '+sb.found_threads+'/'+sb.max_threads+', '+status);\r\n////          if (sb.idx<sb.max && (sb.refresh || sb.found_threads<sb.max_threads) && status<500) {\r\n////            var tgt = scan_boards_keyword_make_tgt(sb,sb.idx);\r\n////            sb.idx++;\r\n////////////            scan_progress(sb.found_threads+'/'+sb.scanned+', '+sb.found_boards+'/'+sb.idx+'/'+sb.max+', ' + tgt);\r\n////            if (tgt && (!pref.catalog.board.ex_list || !pref_func.merge_obj5(tgt,pref.catalog.board.ex_list_obj2,{hit:false}).hit)) { // 'if (tgt)' is for tgts_iterator\r\n////              if (sb.indicator) sb.indicator.report({tgt:tgt});\r\n////              http_req.get(sender,tgt,'',scan_boards_keyword_callback2,sb.lifetime,sb.cache_write,args, scan.list_nup.issued(tgt));\r\n////////////              if (sb.idx<sb.max && pref.scan.crawler_adaptive) scan_boards_spawn_crawler_timer(sb);\r\n////              if (pref.scan.crawler_adaptive) crawler.spawn_req(sb);\r\n////            } else scan_boards_keyword(args,200);\r\n////          } else {\r\n////            crawler.finish(sb, sender);\r\n////////////            http_req.close(sender);\r\n////            if (sb.crawler===0) {\r\n////////////              if (pref.scan.crawler_adaptive) scan_boards_crawler_timer_clear();\r\n////////////              if (sb.crawler_watchdog) sb.crawler_watchdog.stop();\r\n////////////              var prog_str = sb.found_threads+'/'+sb.scanned+', '+sb.found_boards+'/'+sb.max\r\n////////////                            + '<span style=\"color:red\">'\r\n////////////                            +( (sb.error!=='')? ', Error at loading '+sb.error :\r\n////////////                              ((!sb.refresh && sb.found_threads>=sb.max_threads)? ', Aborted.(Reached upper limit)' : ''))\r\n////////////                            + '</span>';\r\n////////////              scan_progress(prog_str);\r\n//////              sb.max = sb.idx;\r\n//////              if (sb.key==='scan') scan_button.innerHTML = 'scanSite';\r\n////if (pref.test_mode['22']) {\r\n////              if (sb.store_tag) {\r\n////  //console.log(new Date());\r\n////  //              scan_tags_init(sb.pool.tags);\r\n////                var ret_obj = scan_tags_common_b(sb.pool.tags,'',site3[site.nickname].tags);\r\n////                site3[site.nickname].tags = ret_obj[1];\r\n////                scan_tags_init(ret_obj[0],true);\r\n////  //              sb.pool.div.innerHTML = '';\r\n////  //console.log(new Date());\r\n////              }\r\n////}\r\n//////              sb = null;\r\n////              if (sb.indicator) {\r\n////////////                var keys = Object.keys(sb.error_obj);\r\n////////////                if (keys.length==0) sb.indicator.set(null,'\\u25cf');\r\n////////////                else if (keys.length>=sb.max) sb.indicator.set('red','X');\r\n////////////                else sb.indicator.set(null,'\\u25b2');\r\n////                if (sb.found_threads>=sb.max_threads) sb.indicator.report({err_str:'Aborted.(Reached upper limit)'});\r\n////                sb.indicator.report({end:Date.now()});\r\n////              }\r\n////              delete scan_boards.args[sb.key];\r\n////if (pref.debug_mode['5']) console.log('scan_boards_end: '+sb.key+', Running:'+Object.keys(scan_boards.args));\r\n////              crawler.finish_all(sb);\r\n////              if (Object.keys(scan_boards.args).length==0) scan_boards.pool = null;\r\n////              if (sb.callback) sb.callback(sb.callback_args);\r\n////            }\r\n////          }\r\n////        }\r\n\r\n        cataLog.scan_boards_keyword_callback2_default_args = {refresh:true, found_threads:0, get max_threads(){return pref4.scan.max_threads;}, found_board:0, scanned:0};\r\n        var threads_meguca = {};\r\n        function scan_boards_keyword_callback2(key,value,args, insert_thread_from_native){ // requires snoop and on demand rendering for merge.\r\n////////  if (pref.scan.crawler_adaptive) scan_boards_crawler_timer_clear();\r\n          var sb = args[1];\r\n          var dbt = key.split(',');\r\n////          if (pref.scan.crawler_adaptive) crawler.clear_req(sb);\r\n          if ((value.status==200 || value.status==304) && value.response && sb.found_threads<sb.max_threads) { // Checking 'value.response' is a patch for 8chan's inconsistency, 8chan sometimes return 200 with null. // checking 304 is a patch.\r\nif (dbt[0]==='meguca1' && dbt[3]==='catalog_json') { // PATCH FOR MEGUCA\r\n            for (var i=0;i<value.response.length;i++) {\r\n//              threads_meguca[dbt[1]+value.response[i]] = {page:parseInt(i/10) +'.'+ i%10, refresh:sb.refresh};\r\n              liveTag.mems.init({domain:dbt[0], board:dbt[1], no:value.response[i]});\r\n              threads_meguca[dbt[1]+value.response[i]] = {page:parseInt(i/10) +'.'+ i%10, refresh:sb.refresh || threads_meguca[dbt[1]+value.response[i]] && threads_meguca[dbt[1]+value.response[i]].refresh}; // patch.\r\n              scan.list_nup.add(dbt[0]+dbt[1]+value.response[i], sb.priority);\r\n//              if (pref.liveTag.use) scan.list_nup.add_board(dbt[0]+dbt[1], value.date);\r\n            }\r\n            scan.list_nup.got_200_board(dbt[0]+dbt[1]);\r\n} else {\r\n            var tgts = {};\r\n            var parse_options = (dbt[3]==='thread_html' || dbt[3]==='thread_json')? {thread:dbt[2]} : {page:dbt[2]};\r\n            if (sb.localArchive) {\r\n              parse_options.localArchive = sb.localArchive;\r\n              parse_options.page = sb.page;\r\n            }\r\n            var ths = site2[dbt[0]].wrap_to_parse.get(value.response, dbt[0], dbt[1], dbt[3], parse_options);\r\n            if (sb.localArchive) {\r\n              for (var i=0;i<ths.length;i++) ths[i].key = ths[i].key.substr(0,ths[i].key.lastIndexOf('/')+1) + ths[i].posts[0].no;\r\n              if (ths.length===1) dbt[2] = ths[0].posts[0].no;\r\n            }\r\n            if (sb.force_annotate) { // for reentry in meguca.\r\n              for (var i=0;i<ths.length;i++) if (threads[ths[i].key] && ths[i].pn && threads[ths[i].key][0]!==ths[i].pn) {\r\n                threads[ths[i].key][0] = ths[i].pn;\r\n                threads[ths[i].key][1] = true;\r\n                insert_thread_format_th_pn(threads[ths[i].key], true, true, true, ths[i]);\r\n//                threads[ths[i].key][24] = prep_footer3(ths[i]);\r\n                threads[ths[i].key][16].posts = ths[i].posts;\r\n              }\r\n            }\r\n            sb.scanned += ths.length;\r\nif (pref.test_mode['22']) {\r\n            var tgt_pn = sb.pool.div;\r\n            var from_catalog = dbt[3]==='catalog_json' || dbt[3]==='catalog_html';\r\n            var filter_active = pref.catalog.filter.kwd.active || (pref.catalog.filter.tag && filter_tags.length!=0);\r\n} else {\r\n//            var filter_active = pref.catalog.filter.kwd.active || (pref.catalog.filter.tag && pref.liveTag.use && liveTag.active.in);\r\n//            var filter_active = pref.catalog.filter.kwd.active || (pref.catalog.filter.tag && liveTag.active.in); // for passive but don't use.\r\n            var filter_active_kwd = pref.catalog.filter.kwd.active;\r\n            var filter_active_tag = pref.catalog.filter.tag && liveTag.active.in; // for passive\r\n}\r\n////            var from_json = dbt[3].indexOf('_json')!=-1;\r\n            var refresh = sb.refresh;\r\n            if (dbt[0]==='meguca1' && dbt[3]==='thread_json') { // PATCH FOR MEGUCA\r\n              var tgt_th_meguca = threads_meguca[dbt[1]+dbt[2]];\r\n              if (tgt_th_meguca!== undefined) {\r\n                refresh = tgt_th_meguca.refresh;\r\n                ths[0].page = tgt_th_meguca.page;\r\n                delete threads_meguca[dbt[1]+dbt[2]];\r\n              }\r\n            }\r\n            var post_updated_static = pref.liveTag.from==='post' || pref.stats.use || pref[embed_mode].deleted_posts.detect.indexOf('full')===0 ||\r\n                pref[embed_mode].storePosts==='ALL_agg' || site2[dbt[0]].parse_funcs[dbt[3]].has_editing && (embed_mode==='page' || embed_mode==='thread') ||\r\n                pref[embed_mode].backlink_all;\r\n//            var post_updated_static = pref.liveTag.from==='post' || pref.stats.use || pref[embed_mode].deleted_posts.detect==='full';\r\n            var pf_store = (pref[embed_mode].storePosts==='ALL_agg' || pref[embed_mode].storePosts==='auto' && pref4.search_posts_active_once)? 'ALL' : pref[embed_mode].deleted_posts.detect;\r\n            if (pf_store==='no' && embed_mode==='page') pf_store = pref[embed_mode].t2h_num_of_posts;\r\n            if (pref[embed_mode].detect_sage && dbt[0]==='4chan' && dbt[3]==='catalog_json') site2['4chan'].sage_detect_all(ths);\r\n            for (var i=0;i<ths.length;i++) {\r\n              var th = ths[i];\r\n              if (!th.no) continue; // PATCH for a bug in 4chan, 4chan returns invalid data.\r\n              th.time_loaded = value.date;\r\n              if (sb.native_prep) th.native_prep = true;\r\nif (pref.test_mode['33'] && dbt[0]==='meguca1' && dbt[3]==='thread_json') {scan.list_nup.got_200(th);continue;}\r\nif (pref.test_mode['22']) {\r\n              if (sb.scan_tag && from_catalog) {\r\n                if (th.type_data==='json') tgt_pn.innerHTML = th.name + '\\n' + th.sub + '\\n' + th.com;\r\n                else tgt_pn = th.pn;\r\n                th.tags = tgt_pn[brwsr.innerText].match(tags_scan_regex);\r\n              }\r\n} else {\r\n//var tmp_len = Object.keys(scan.list_nup).length;\r\n//if (tmp_len!=0 && tmp_len%100===0) console.log('len: '+tmp_len);\r\n////////              if (pref.liveTag.use) {\r\n//              var mems_exist = liveTag.mems.exist(th);\r\n              var lth = liveTag.prep_tags(th); // extract tags in op. // editing tags are updated in this. // lth.pd is prepared here.\r\n              var insert_thread_from_native_1 = insert_thread_from_native && insert_thread_from_native_prep(th, lth, insert_thread_from_native);\r\n              th.tags = lth;\r\n              var watch = lth.wt;\r\n              var tgt_th = threads[th.key];\r\n              var tag_updated = (tgt_th)? undefined : th.tags; // force new thread to add tags\r\n              var post_updated = (post_updated_static || (watch[0]&0x002c0000))? false : null; // archiving or watching\r\n//              var post_updated = (post_updated_static || (watch[0]&0x000c0000))? false : null;\r\n\r\n              if (lth.ed_t && th.parse_funcs.has_posts) { // lth.ed_t is created only when th.parse_funcs.has_editing is true. lth.ed_t is shared even if pref.liveTag.from!=='post'\r\n                var ed_f = [];\r\n                tag_updated = liveTag.update_tags_in_editing_posts(th, lth, ed_f) || tag_updated; // lth.ed_t is updated here. \r\n                if (ed_f.length===0) ed_f = null;\r\n              }\r\n//              if (th.parse_funcs.has_editing && th.parse_funcs.has_posts) {\r\n//                var ed_p = lth.ed_p || lth.ed_t; // share lth.ed_t when pref.liveTag.from==='post'\r\n//                if (ed_p) {\r\n//                  var ed_f;\r\n//                  var posts_obj = th.parse_funcs.posts_obj(th,ed_p[ed_p.length-1].no);\r\n//                  for (var j=ed_p.length-1;j>=0;j--) {\r\n//                    var post = posts_obj[ed_p[j]]; // post may be a tag.\r\n//                    if (post && !post.editing) {\r\n//                      if (ed_f) ed_f[ed_f.length] = post;\r\n//                      else ed_f = [post];\r\n//                      //// CODE FOR UPDATING ARCHIVES SHOULD BE HERE.\r\n//                      //// CODE FOR UPDATING POSTS CAN BE HERE.\r\n//                      if (lth.ed_p) {\r\n//                        if (lth.ed_p.length!==1) lth.ed_p.splice(j,1);\r\n//                        else lth.ed_p = null;\r\n//                      }\r\n//                    }\r\n//                  }\r\n//                  if (lth.ed_t) tag_updated = liveTag.update_tags_in_editing_posts(th, lth, posts_obj) || tag_updated; // lth.ed_t is updated here.\r\n//                }\r\n//              }\r\n\r\n//              if (liveTag.mems[dbt[0]][dbt[1]] && liveTag.mems[dbt[0]][dbt[1]].f) scan.list_nup.add(th.key, sb.priority); // use dbt[0] instead of th.domain for /popular/\r\n              if (lth.q && lth.q.waiting && th.parse_funcs.has_posts) site2[th.domain].popups_fetched(th, lth);\r\n              var updated = null;\r\n              var archive_store = (lth.archived || pf_store!=='no') && (!pref.test_mode['67'] && !sb.localArchive);\r\n              var pf_store_th = tgt_th && tgt_th[16].get_t2h_num_of_posts() || 'no';\r\n              var pf_store_1 = (pf_store==='ALL' || pref[embed_mode].storePosts==='ALL' && tgt_th)? -1\r\n                  : (pf_store==='no' || pf_store==='passive' && pf_store_th!=='no')? pf_store_th : pf_store;\r\n              if (post_updated!==null && (lth.nof_posts<th.nof_posts || (watch[0]&0x00060000))) { // watch req || retag req\r\n//              if (post_updated!==null && (lth.nof_posts<th.nof_posts || watch[3]<0)) { // watch[3]<0 is a patch for retag.\r\n//if (th.parse_funcs.has_posts && th.last_replies) console.log(th.key+', '+th.last_replies.length+', '+th.nof_posts+', '+lth.nof_posts);\r\n//                if (pref.debug_mode.unread_count===th.key) console.log('uc: watch[0]='+lth.nof_posts+', nof_posts='+th.nof_posts);\r\n                if (th.type_source==='thread' || \r\n//                    (th.parse_funcs.has_posts && th.last_replies && th.last_replies.length>=th.nof_posts-lth.nof_posts) ||\r\n                    (th.parse_funcs.has_posts && th.posts.length>th.nof_posts-lth.nof_posts && (lth.ta || pref[embed_mode].deleted_posts.detect.indexOf('full')!==0)) ||\r\n                    (th.nof_posts===1 && th.posts[0].time>=0 && !th.parse_funcs.dont_have_com)) {\r\n                  post_updated = true;\r\n                  updated = site2[th.domain].check_reply.check(th, watch, tgt_th, sb.ext_posts || []); // dive in at the first time if page_html contains all posts. sb.ext_posts for embed_mode==='thread'.\r\n//                  if (lth.usWT) triage_exe_pipe(lth.usWT); // should be here, but tgt_th[8] is not updated here.\r\n                  if (pref[embed_mode].backlink_all) site2[th.domain].popups_add_1_cross(th, updated.posts, pref[embed_mode].backlink_all_cross);\r\n                  tag_updated = updated.tags || tag_updated;\r\n                  scan.list_nup.got_200(th); // patch for 8chan. 8chan has an inconsistensy between catalog and threads,\r\n                                             // some threads which are there in catalog sometimes returns 404 if it gets as a thread.\r\n                                             // However, 8chan doesn't return 404, but fails at send(null), so system like watchdog is required.\r\n//                  if (pref.debug_mode['3']) console.log('Check tags: '+th.key+', '+lth.nof_posts);\r\n                  if (pref.threadStats.use && site2[th.domain].stats_ID && (refresh || tgt_th)) if (site2[th.domain].stats_ID(th, updated.posts, lth)) scan.list_nup.add(th.key, 0);\r\n                  if (archive_store) archiver.store(value, th, lth, updated.posts, updated.time_check_old, pf_store_1, ed_f);\r\n                } else { // if (!(th.parse_funcs.has_posts && !th.last_replies))\r\n                  scan.list_nup.add(th.key, sb.priority);\r\n//                  if (pref.debug_mode['3']) console.log('Schedule to check tags: '+th.key+', '+lth.nof_posts);\r\n                  if ((ed_f || (pref.test_mode['129'] && embed_mode==='page')) && archive_store) archiver.store(value, th, lth, undefined, undefined, pf_store_1, ed_f);\r\n                }\r\n              } else {\r\n                if (!sb.localArchive) scan.list_nup.got_200(th);\r\n                if (pref.threadStats.use && site2[th.domain].stats_ID && (refresh || tgt_th)) {\r\n                  site2[th.domain].stats_ID(th, null, lth);\r\n                  if (pref.threadStats.retry && pref.threadStats.full && th.nof_posts<lth.nof_posts && th.type_source==='thread') scan.list_nup.add(th.key, 0); // for obsolete cache data, may cause infinite loop.\r\n                }\r\n//                  if (lth.nof_posts==th.nof_posts || !pref.network.fetch_actively || // only active when count is changed,\r\n//                      // 'th.parse_funcs.missing_info' doesn't have state if the thread is not stored(tgt_th===undefined),\r\n//                      //and all members will be fetched forever.\r\n//                    ((tgt_th)? !tgt_th[23] || th.type_source==='thread' : !th.parse_funcs.missing_info)) scan.list_nup.got_200(th); // for threads which doesn't have posts.\r\n//                  else th.parse_funcs.missing_info_fetch(th);\r\n////                if (th.parse_funcs.has_editing) updated = {posts:th.posts.slice(lth.nof_posts || 0)}; // BUG, REDUNDANT.\r\n                if (((pref.test_mode['129'] && embed_mode==='page') || lth.rescan_dp || lth.force_ar || ed_f || lth.nof_posts!=th.nof_posts && th.parse_funcs.has_posts) && archive_store)\r\n                  archiver.store(value, th, lth, undefined, undefined, pf_store_1, ed_f); // for initial if watched already // BUG!!! THIS DOESN'T WORK IF 304 IS RETURNED. // changed from 'lth.nof_posts<th.nof_posts'.\r\n////                if (lth.nof_posts!=th.nof_posts)\r\n////                  if(!th.parse_funcs.has_editing || th.parse_funcs.has_posts || embed_mode==='catalog') lth.nof_posts = th.nof_posts; // to get updated in next loop. // BUG, REDUNDANT.\r\n                if (lth.nof_posts!=th.nof_posts) lth.nof_posts = th.nof_posts;\r\n              }\r\n////////              }\r\n              if (th.parse_funcs.has_editing) {\r\n                if (updated && pref.liveTag.from!=='post') { // share lth.ed_t always\r\n                  var ed_p = undefined;\r\n                  for (var j=0;j<updated.posts.length;j++) // update is reverse ordered.\r\n                    if (updated.posts[j].editing && updated.posts[j].no!=th.no)\r\n                      if (ed_p) ed_p[ed_p.length] = updated.posts[j];\r\n                      else ed_p = [updated.posts[j]];\r\n                  if (ed_p) {\r\n                    lth.ed_t = (lth.ed_t)? ed_p.concat(lth.ed_t) : ed_p;\r\n                    if (pref.debug_mode['24']) console.log(th.key+ ': lth.ed_t: '+ lth.ed_t.map(function(v){return (typeof(v)==='string')? v : v.no+'('+v.time+')';}));\r\n                  }\r\n                }\r\n//                if (updated && pref.liveTag.from!=='post') { // share lth.ed_t when pref.liveTag.from==='post'\r\n//                  var ed_p = undefined; // ed_p is used previously, so it must be cleared.\r\n//                  for (var j=0;j<updated.posts.length;j++) // update is reverse ordered.\r\n//                    if (updated.posts[j].editing)\r\n//                      if (ed_p) ed_p[ed_p.length] = updated.posts[j];\r\n//                      else ed_p = [updated.posts[j]];\r\n//                  if (ed_p) lth.ed_p = (lth.ed_p)? ed_p.concat(lth.ed_p) : ed_p;\r\n//                }\r\n//                if (updated) for (var j=updated.posts.length-1;j>=0;j--) // update is reverse ordered.\r\n//                  if (updated.posts[j].editing)\r\n//                    if (lth.ed_p) lth.ed_p[lth.ed_p.length] = updated.posts[j].no;\r\n//                    else lth.ed_p = [updated.posts[j].no];\r\n                if (th.type_source==='catalog' && (lth.ed_p || lth.ed_t) && (lth.archived || pref[embed_mode].t2h_sel!=='no' && tgt_th) &&\r\n                  lth.ed_u<th.replyTime) scan.list_nup.add(th.key, sb.priority);\r\n//                if (th.type_source==='catalog' && embed_mode!=='catalog' && tgt_th &&\r\n//                  (tgt_th[16].needs_update<th.replyTime || tgt_th[16].needs_update===null))) scan.list_nup.add(th.key, sb.priority);\r\n//                if (th.type_source==='catalog' && embed_mode!=='catalog' && tgt_th && lth.ed_p) scan.list_nup.add(th.key, sb.priority);\r\n              }\r\n//              if (th.domain==='meguca' && th.type_source==='catalog' && embed_mode!=='catalog' && tgt_th && tgt_th[16].needs_update<th.logCtr) scan.list_nup.add(th.key, sb.priority);\r\n}\r\nif (pref.test_mode['32'] && dbt[0]==='meguca1' && dbt[3]==='thread_json') continue;\r\n              if (lth.th) {\r\n                if (!tgt_th) delete lth.th;\r\n                else if (lth.th.parse_funcs.missing_info && (!th.parse_funcs.missing_info || th.parse_funcs.missing_info<lth.th.parse_funcs.missing_info)) {\r\n                  if (lth.th.pn) th.pn = lth.th.pn;\r\n                  lth.th = th;\r\n                  // lth.th.posts SHOULD BE REDUCED HERE.\r\n                }\r\n              }\r\n////              if (tgt_th) { // working code.\r\n////                if (tgt_th[23]) {\r\n////                  for (var p in tgt_th[23]) {\r\n////                    if (p==='time_posted') {\r\n////                      if (th.time_posted) {tgt_th[8][4] = th.time_posted; delete tgt_th[23][p];}\r\n////                    } else if (p==='op_img_src_url') {\r\n////                      if (th.parse_funcs.get_op_src) {tgt_th[16].op_img_src_url = th.parse_funcs.get_op_src(th); delete tgt_th[23][p];}\r\n////                    }\r\n////                  }\r\n////                  if (Object.keys(tgt_th[23]).length===0) {\r\n////                    tgt_th[23] = null;\r\n//////                    if (missing_info[th.key]!==undefined) delete missing_info[th.key]\r\n////                  }\r\n////                }\r\n////              }\r\n              \r\n              var pick_up_for_search = th.type_source==='thread' && pref[embed_mode].storePosts==='ALL_agg';\r\n              var picked_up_by_kwd_filter = filter_active_kwd && catalog_filter_query_keyword.kwd(pref.catalog.filter.kwd, th.posts, th.domain, th);\r\n              var picked_up_by_tag_filter = filter_active_tag && liveTag.search_by_tags(th.tags);\r\n              var picked_up_by_filter = picked_up_by_kwd_filter || picked_up_by_tag_filter;\r\n              var tgt_th_status = (tgt_th===undefined)? undefined : tgt_th[9][0];\r\n//              var force_update = (tgt_th && (tgt_th[16].expand_posts || (th.type_source==='thread' && (tgt_th[16].needs_update===true || tgt_th[16].needs_update===1)))) || pick_up_for_search;\r\n              var force_update = (tgt_th && (tgt_th[16].expand_posts || (th.type_source==='thread' && tgt_th[16].needs_update===true))) ||\r\n                                 lth.ed_u<th.replyTime || pick_up_for_search;\r\n//              var force_update = (tgt_th && (tgt_th[16].expand_posts || (th.type_source==='thread' &&\r\n//                (tgt_th[16].needs_update===true || (tgt_th[16].needs_update<th.replyTime || tgt_th[16].needs_update===null))))) || pick_up_for_search;\r\n//              if (refresh || (post_updated && tgt_th) || picked_up_by_filter || force_update) {\r\n//              if (!sb.tag_only && (sb.refresh || (post_updated && tgt_th) || picked_up_by_filter)) {\r\n//              if (!sb.tag_only && (sb.refresh || (filter_active && catalog_filter_query_scan(th.posts, th.tags)))) {\r\n////////                if (insert_thread_with_test(th, dbt[3], value.date)) {// RUNS A REDUNDANT POST CHECK AT FIRST TIME....\r\n              if (post_updated===null && tgt_th && (refresh || picked_up_by_filter)) {\r\n//                if (post_updated===null && tgt_th) {\r\n                var tgt_th8 = tgt_th[8];\r\n                post_updated = !((((tgt_th8[0]>tgt_th8[4])? tgt_th8[0] : (tgt_th8[4] || tgt_th8[0])) >= ((th.time_bumped > th.time_posted)? th.time_bumped : (th.time_posted || th.time_bumped))) && // vichan has inconsistency in time between catalog.json and thread.json.\r\n                                 tgt_th8[2]==th.nof_posts && tgt_th8[3]==th.nof_files) || th.type_source==='thread'; // pass thread to revise all of tgt_th[8]\r\n              }\r\n              if (post_updated && (tgt_th || pref[embed_mode].promiscuous) || (refresh || picked_up_by_filter) && !tgt_th || force_update) { // stop merging at preparing cross-thread popup\r\n//              if (post_updated || (refresh || picked_up_by_filter) && !tgt_th || force_update) {\r\n//              if (post_updated || picked_up_by_filter || tgt_th_status===undefined || force_update) {\r\n                if (!tgt_th) { // PATCH, WILL BE REMOVED BY CONSOLIDATING.\r\n                  var pf_store_th_2 = tgt_th16_proto.get_t2h_num_of_posts.call({lth:lth}) || 'no';\r\n                  if (pf_store!=='ALL' && (pf_store==='no' || pf_store==='passive' && pf_store_th_2!=='no'))\r\n                    if (pf_store_1!==pf_store_th_2) archiver.store_th_to_mem(value, th,lth, pf_store_th_2, null);\r\n                }\r\n                if (pref[embed_mode].scroll_lock) show_catalog_scroll_lock.set();\r\n                insert_thread(th, value.date, picked_up_by_kwd_filter, insert_thread_from_native_1); // insert_thread_from_native && ths[i].pn); // '&& ths[i].pn' for reentry.\r\n                tgts[th.key] = true;\r\n                tgt_th = threads[th.key];\r\n              } // else if (pref[embed_mode].load_on_demand) threads_index.idx_reorder(th.key); // place thread before ODL. // changed. // implementation is changed.\r\n              sb.found_threads++;\r\n              if (sb.from_auto && (!tgt_th_status && tgt_th[9][0])) notifier.appeared(th,tgt_th_status===undefined);\r\n//              } // else if (pref[embed_mode].load_on_demand && tgt_th) threads_index.idx_reorder(th.key); // temporal, should be rewritten.  // place thread before ODL. // implementation is changed.\r\n//              if (tgt_th_status!==undefined && tgt_th[16].expand_posts) insert_thread_format_html(th,th.key,false,false,th.type_data==='json'); // format_html.update_posts_in_page(th, th.key, true);\r\nif (!pref.test_mode['31'])\r\n              if (tgt_th) {\r\n                if (th.page) tgt_th[14] = th.page;\r\n                gClg.footer.update(th.key, th.country && post_updated, (tgt_th_status!==undefined)? tag_updated : th.tags);\r\n              }\r\n//              if (tgt_th) insert_footer3(th.key,(post_updated)? th.flags:null, th.page, (tgt_th_status!==undefined)? tag_updated : th.tags, th);\r\n//              if (pref.liveTag.use && i===0) scan.list_nup.add_board(th.domain+th.board, (th.type_source==='catalog')? value.date : null);\r\n//              if (th.tags.q && th.parse_funcs.has_posts) site2[th.domain].popups_fetched(th); // stored AFTER modifying pn. // BUT, posts are deleted sometimes.\r\n              if (lth.usWT) triage_exe_pipe(lth.usWT); // remporarily patch\r\n            }\r\nif (pref.test_mode['22']) {\r\n            if (sb.scan_tag && from_catalog) tag_scan_board(ths, sb);\r\n}\r\n            if (dbt[3]==='catalog_json' || dbt[3]==='catalog_html') {\r\n////              if (pref.liveTag.use) scan.list_nup.add_board(dbt[0]+dbt[1], value.date);\r\n              scan.list_nup.got_200_board(dbt[0]+dbt[1]);\r\n              rm_items_404_check(dbt[0],dbt[1],ths);\r\n//              if (pref[embed_mode].detect_sage && th.domain==='4chan' && dbt[3]==='catalog_json') site2['4chan'].sage_detect_all(ths);\r\n////              if (liveTag.mems[dbt[0]][dbt[1]] && liveTag.mems[dbt[0]][dbt[1]].f) { // 'liveTag.mems[dbt[0]][dbt[1]]' is for /popular/\r\n////                for (var i=0;i<ths.length;i++) scan.list_nup.add(ths[i].key);\r\n////                liveTag.mems[dbt[0]][dbt[1]].f = false;\r\n////              }\r\n//              if (liveTag.mems[dbt[0]][dbt[1]] && liveTag.mems[dbt[0]][dbt[1]].f) liveTag.mems[dbt[0]][dbt[1]].f = false; // 'liveTag.mems[dbt[0]][dbt[1]]' is for /popular/\r\n            }\r\n            if (pref.catalog_max_page_auto && (dbt[3]==='page_html' || (dbt[3]==='catalog_json' && site2[dbt[0]].parse_funcs[dbt[3]].get_max_page))) {\r\n              var max_page = site2[dbt[0]].parse_funcs[dbt[3]].get_max_page(value.response);\r\n              if (max_page) liveTag.mems[dbt[0]][dbt[1]].pgs = max_page;\r\n            }\r\n            if (pref[embed_mode].load_on_demand) {\r\n              var tgt = ths[ths.length-1];\r\n              if (tgt && tgt.type_source==='page' && (!site2[tgt.domain].all_boards || site2[tgt.domain].all_boards.indexOf(site.board)!=-1)) threads_index.idx_raise_odl(tgt);\r\n            }\r\n            if (Object.keys(tgts).length!==0 && !sb.native_prep) {\r\n              sb.found_boards++;\r\n              show_catalog(tgts);\r\n  //          if (pref.catalog.filter.tag_scan_auto) scan_tags();\r\n            }\r\n  \r\n////////            if ((dbt[3]==='thread_html' || dbt[3]==='thread_json') && threads[ths[0].key]) update_thread(dbt[0]+dbt[1]+dbt[2], ths[0], threads[ths[0].key][19]); // patch  // working code.\r\n//            if ((dbt[3]==='thread_html' || dbt[3]==='thread_json') && threads[ths[0].key] && threads[ths[0].key][23]) update_thread(dbt[0]+dbt[1]+dbt[2], ths[0], threads[ths[0].key][19]); // patch to delete threads[name][23]\r\n////            if (dbt[3]==='thread_html') {\r\n////              var name = dbt[0] + dbt[1] + dbt[2];\r\n////              if (threads[name]) { // patch for parallel entry.\r\n////                site2[dbt[0]].check_reply.do(value.response, dbt, threads[name][19], threads[name][8], dbt[3]); // SHOULD CONSOLIDATE TO CHECK_REPLY.CHECK().\r\n////\r\n//////                if (threads[name][20]!==sb.pool.sticky) { // working code.\r\n//////                  site2[dbt[0]].add_sticky_info(threads[name][0],threads[name][18],sb.pool.sticky);\r\n//////                  threads[name][20] = sb.pool.sticky;\r\n//////                }\r\n////                if (threads[name][23]) {\r\n////                  threads[name][23] = false;\r\n////                  threads[name][9] = catalog_filter_query(name);\r\n////                }\r\n//////                if (pref.catalog_footer_show_nof_rep) site2[dbt[0]].insert_footer2(threads[name][0],threads[name][18],threads[name][19],threads[name][8]);\r\n////                if (pref.catalog_footer_show_nof_rep) insert_footer3(threads[name][24],threads[name][19],threads[name][8],name);\r\n////                threads[name][21] = false;\r\n////                if (threads[name][19][0]>=0) notifier.changed(name,threads);\r\n////                threads[name][19][5] = false;\r\n////                threads[name][19][4] = null; // for GC.\r\n////                reorder_thread_idx(name);\r\n//////var debug = '';\r\n//////for (var d=0;d<10;d++) debug += threads_idx[d] + ', ';\r\n//////console.log('ddd :'+debug);\r\n//////              if (reorder_thread_idx(name)) {\r\n//////                tgts = {};\r\n//////                tgts[name] = true;\r\n//////                show_catalog(tgts);\r\n//////              }\r\n////              }\r\n////            }\r\n//            if (sb.native_prep) return ths;\r\n}\r\n          } else { // DON'T USE TH.XXX BECAUSE MEGUCA DOESN'T HAVE.\r\n            if (value.status==404 && (dbt[3]==='thread_json' || dbt[3]==='thread_html')) {\r\n              liveTag.rm_404_1(dbt[0],dbt[1],dbt[2]);\r\n              scan.list_nup.got_404(dbt[0] + dbt[1] + dbt[2]);\r\n            }\r\n            if (sb.found_threads<sb.max_threads) {\r\n////////              sb.error += ((sb.error==='')? '' : ', ') + key;\r\n////////              sb.error_obj[key] = value.status;\r\n              if (value.status==404) comment_out_bookmark(key);\r\n////              if (sb.indicator) {\r\n////                sb.indicator.report({err_str:key+'('+value.status+')'});\r\n////                sb.indicator.set('orange');\r\n////              }\r\n            }\r\n            if (value.response===null && value.status==200) { // patch for 8chan's inconsistency.\r\n              if (pref.debug_mode['16']) console.log('ERROR!!! Inconsistency in server. Server returned null with status 200 for '+site2[dbt[0]].make_url4(dbt)[0]+' , '+key);\r\n              value.status=-200;\r\n            }\r\n            if (value.status==404 && pref.catalog_max_page_auto && (dbt[3]==='page_json' || dbt[3]==='page_html')) {\r\n              var max_page = parseInt(dbt[2].replace(/^[pq]/,''),10);\r\n              if (!liveTag.mems[dbt[0]][dbt[1]].pgs || max_page<liveTag.mems[dbt[0]][dbt[1]].pgs) liveTag.mems[dbt[0]][dbt[1]].pgs = max_page;\r\n            }\r\n          }\r\n////          scan_boards_keyword(args,value.status);\r\n          if (sb.refresh && !pref.test_mode['65'] && pref.archive.IDB.auto_restore && (!threads_delayed_pruning[dbt[0]] || !threads_delayed_pruning[dbt[0]][dbt[1]]) &&\r\n              (dbt[3]=='catalog_json' || dbt[3]==='catalog_html' || dbt[3]=='page_json' || dbt[3]==='page_html') && !window.opener) restore_bd_from_IDB(dbt[0], dbt[1]);\r\n          return ths;\r\n        }\r\n        cataLog.scan_boards_keyword_callback2 = scan_boards_keyword_callback2;\r\n////        function tag_scan_extract_1(pn) { // working code.\r\n////          return pn[brwsr.innerText].match(tags_scan_regex);\r\n////        }\r\n        function tag_scan_board(ths, sb) { // patch\r\n          var ths_tag = {};\r\n          for (var i=0;i<ths.length;i++) ths_tag[ths[i].key] = ths[i];\r\n          scan_tags_common(ths_tag,'',sb.pool.tags);\r\n        }\r\n\r\n////        function tag_scan_extract_1(key,pn,sb) {\r\n////          pn.tags = pn[brwsr.innerText].match(tags_scan_regex);\r\n////          var ths = {};\r\n////          ths[key] = pn;\r\n////          scan_tags_common(ths,'',sb.pool.tags);\r\n////  //        scan_tags_common({key:pn},'',sb.pool.tags,true);\r\n////  //        return pn.tags;\r\n////        }\r\n\r\n////////        function scan_boards_keyword_callback2(key,value,args){\r\n////////          var sb = args[1];\r\n////////          if (pref.scan.crawler_adaptive) scan_boards_crawler_timer_clear();\r\n////////          sb.pool.dbt = cnst.name2domainboardthread(key,true);\r\n////////          if (value.status==200 && sb.found_threads<sb.max_threads) {\r\n////////            if (sb.pool.dbt[2]=='j0' || sb.pool.dbt[2]=='c0') {\r\n////////              if (sb.pool.dbt[2]=='j0') {\r\n////////                sb.pool.type = 'catalog_json';\r\n////////                sb.pool.doc = ('response' in value)? value.response : JSON.parse(value.responseText);\r\n////////                var obj = sb.pool.doc;\r\n//////////                var obj = ('response' in value)? value.response : JSON.parse(value.responseText);\r\n////////    //            if (sb.scan_tag) {\r\n////////    //              for (var i=0;i<obj.length;i++) {\r\n////////    //                for (var j=0;j<obj[i].threads.length;j++) {\r\n////////    //                  sb.pool.div.innerHTML = obj[i].threads[j].com;\r\n////////    //                  obj[i].threads[j].tags = tag_scan_extract_1(sb.pool.dbt[0]+sb.pool.dbt[1]+obj[i].threads[j].no,sb.pool.div,sb);\r\n////////    //                }\r\n////////    //            }}\r\n////////                for (var i=0;i<obj.length;i++) {\r\n////////                  if (obj[i].threads) {\r\n////////                    sb.scanned += obj[i].threads.length;\r\n////////                    for (var j=0;j<obj[i].threads.length;j++) {\r\n////////                      sb.name = sb.pool.dbt[0]+sb.pool.dbt[1]+obj[i].threads[j].no;\r\n//////////                      if (threads[sb.name] && threads[sb.name][20]!==obj[i].threads[j].sticky) { // working code.\r\n//////////                        site2[sb.pool.dbt[0]].add_sticky_info(threads[sb.name][0],threads[sb.name][18],obj[i].threads[j].sticky);\r\n//////////                        threads[sb.name][20] = obj[i].threads[j].sticky;\r\n////////////                        reorder_thread_idx(sb.pool.dbt[0] + sb.pool.dbt[1] +sb.pool.dbt[2].substr(1)); doesn't prepared threads[];\r\n//////////                      }\r\n////////                      if (sb.scan_tag) {\r\n////////                        sb.pool.div.innerHTML = obj[i].threads[j].com + '\\n' + obj[i].threads[j].sub + '\\n' + obj[i].threads[j].name;\r\n////////                        tag_scan_extract_1(sb.pool.dbt[0]+sb.pool.dbt[1]+obj[i].threads[j].no,sb.pool.div,sb);\r\n////////                      }\r\n//////////                      var search_obj = [obj[i].threads[j].com, obj[i].threads[j].sub, obj[i].threads[j].name,'','','','',''];\r\n//////////                      if (!catalog_filter_query_scan(search_obj,sb.pool.div.tags)) {obj[i].threads.splice(j,1);j--;}\r\n////////                      if (!catalog_filter_query_scan(obj[i].threads[j],sb.pool.div.tags)) {obj[i].threads.splice(j,1);j--;}\r\n////////                    }\r\n////////                  }\r\n////////                }\r\n////////    //            for (var i=0;i<obj.length;i++) sb.scanned += obj[i].threads.length; // NOT SO FAST.\r\n////////    //            var kwd = pref.catalog.filter.kwd.str;\r\n////////    //            if (pref.catalog.filter.kwd && kwd!=='') {\r\n////////    //              if (!pref.catalog.filter.kwd.re) kwd = kwd.replace(/\\*/g,'.*');\r\n////////    //              if (pref.catalog.filter.kwd.ci) kwd = new RegExp(kwd,'i');\r\n////////    //              for (var i=0;i<obj.length;i++) {\r\n////////    //                for (var j=obj[i].threads.length-1;j>=0;j--) {\r\n////////    //                  var str = obj[i].threads[j].name + '\\n' + obj[i].threads[j].sub + '\\n' + obj[i].threads[j].com;\r\n////////    //                  var result = (str.search(kwd)!=-1);\r\n////////    //                  if (pref.catalog.filter.kwd.match==='unmatch') result = !result;\r\n////////    //                  if (!result) obj[i].threads.splice(j,1);\r\n////////    //                }\r\n////////    //              }\r\n////////    //            }\r\n////////                if ((pref.catalog.filter.kwd.use && pref.catalog.filter.kwd.str!=='') || (pref.catalog.filter.tag && filter_tags.length!=0))\r\n////////                  sb.pool.ths = site2[sb.pool.dbt[0]].catalog_from_json3(obj,sb.pool.dbt[1]); // heavy, and cause loading in chrome.\r\n////////                else sb.pool.ths = [];\r\n////////              } else {\r\n////////                sb.pool.type = 'catalog_html';\r\n////////                sb.pool.doc = ('response' in value)? value.response : sb.pool.parser.parseFromString(value.responseText, 'text/html');\r\n////////                sb.pool.ths = site2[sb.pool.dbt[0]].catalog_from_native(value.date,sb.pool.doc,sb.pool.dbt[1],sb.pool.type);\r\n////////    //            if (sb.scan_tag) for (var i=0;i<sb.pool.ths.length;i++) sb.pool.ths[i].tags = tag_scan_extract_1(sb.pool.dbt[0]+sb.pool.dbt[1]+sb.pool.ths[i].no,sb.pool.ths[i].pn,sb);\r\n////////                sb.scanned += sb.pool.ths.length;\r\n////////                for (var i=0;i<sb.pool.ths.length;i++) {\r\n////////                  if (sb.scan_tag) tag_scan_extract_1(sb.pool.dbt[0]+sb.pool.dbt[1]+sb.pool.ths[i].no,sb.pool.ths[i].pn,sb);\r\n////////                  if (!catalog_filter_query_scan(sb.pool.ths[i],sb.pool.ths[i].pn.tags)) {sb.pool.ths.splice(i,1);i--;}\r\n////////                }\r\n////////              }         \r\n////////              if (sb.pool.ths.length!=0 && ((pref.catalog.filter.kwd.use && pref.catalog.filter.kwd.str!=='') || (pref.catalog.filter.tag && filter_tags.length!=0))) {\r\n////////                sb.found_boards++;\r\n////////                sb.found_threads += sb.pool.ths.length;\r\n////////                sb.pool.tgts = {};\r\n////////                for (var i=0;i<sb.pool.ths.length;i++) {\r\n////////                  insert_thread_with_test(sb.pool.ths[i], sb.pool.type, value.date); // patch\r\n//////////                  insert_thread_from_native(sb.pool.ths[i], sb.pool.dbt[0], sb.pool.dbt[1], false, value.date);\r\n////////                  sb.pool.tgts[sb.pool.dbt[0]+sb.pool.dbt[1]+sb.pool.ths[i].no] = true;\r\n////////                }\r\n////////                show_catalog(sb.pool.tgts);\r\n////////    //            if (pref.catalog.filter.tag_scan_auto) scan_tags();\r\n////////              }\r\n////////            } else {\r\n////////              var name = sb.pool.dbt[0] + sb.pool.dbt[1] + ((sb.pool.dbt[2][0]==='t')? sb.pool.dbt[2].substr(1) : sb.pool.dbt[2]);\r\n////////              if (threads[name]) { // patch for parallel entry.\r\n////////                sb.pool.type = (sb.pool.dbt[2][0]!=='t')? 'thread_html' : 'thread_json';\r\n////////                if (sb.pool.dbt[2][0]!=='t') sb.pool.doc = ('response' in value)? value.response : sb.pool.parser.parseFromString(value.responseText, 'text/html');\r\n//////////                site2[sb.pool.dbt[0]].check_reply_to_me(name,sb.pool.dbt,threads[name][19],(sb.pool.dbt[2][0]!=='t')? sb.pool.doc : value);\r\n//////////var time_0 = performance.now();\r\n//////////                site2[sb.pool.dbt[0]].check_reply_to_me(name,sb.pool.dbt,threads[name][19],(sb.pool.dbt[2][0]!=='t')? sb.pool.doc : value,threads[name][8], sb.pool, sb.pool.type); // also checks sage.\r\n//////////                site2[sb.pool.dbt[0]].check_reply_to_me(name,sb.pool.dbt,threads[name][19],(sb.pool.dbt[2][0]!=='t')? sb.pool.doc : value.response, threads[name][8], sb.pool, sb.pool.type); // also checks sage.\r\n////////                site2[sb.pool.dbt[0]].check_reply.do((sb.pool.dbt[2][0]!=='t')? sb.pool.doc : value.response, sb.pool.dbt, threads[name][19], threads[name][8], sb.pool.type);\r\n////////\r\n//////////                if (threads[name][19][0]>threads[name][8][4]) threads[name][19][0] = -1; // 2015.05.01 removed, but I don't remember why I wrote this.\r\n////////\r\n//////////console.log('check_reply :'+name+', '+(performance.now()-time_0));\r\n//////////                if (threads[name][20]!==sb.pool.sticky) { // working code.\r\n//////////                  site2[sb.pool.dbt[0]].add_sticky_info(threads[name][0],threads[name][18],sb.pool.sticky);\r\n//////////                  threads[name][20] = sb.pool.sticky;\r\n//////////                }\r\n////////                if (threads[name][23]) {\r\n////////                  threads[name][23] = false;\r\n////////                  threads[name][9] = catalog_filter_query(name);\r\n////////                }\r\n//////////                if (pref.catalog_footer_show_nof_rep) site2[sb.pool.dbt[0]].insert_footer2(threads[name][0],threads[name][18],threads[name][19],threads[name][8]);\r\n////////                if (pref.catalog_footer_show_nof_rep) insert_footer3(threads[name][24],threads[name][19],threads[name][8],name);\r\n////////                threads[name][21] = false;\r\n////////                if (threads[name][19][0]>=0) notifier.changed(name,threads);\r\n////////                threads[name][19][5] = false;\r\n////////                threads[name][19][4] = null; // for GC.\r\n////////                reorder_thread_idx(name);\r\n//////////var debug = '';\r\n//////////for (var d=0;d<10;d++) debug += threads_idx[d] + ', ';\r\n//////////console.log('ddd :'+debug);\r\n//////////              if (reorder_thread_idx(name)) {\r\n//////////                sb.pool.tgts = {};\r\n//////////                sb.pool.tgts[name] = true;\r\n//////////                show_catalog(sb.pool.tgts);\r\n//////////              }\r\n////////              }\r\n////////            }\r\n////////          } else {\r\n////////            if (value.status==404 && (sb.pool.dbt[2][0]=='t' || sb.pool.dbt[2].search(/^[0-9]/)!=-1)) {\r\n////////              var name = sb.pool.dbt[0] + sb.pool.dbt[1] + ((sb.pool.dbt[2][0]==='t')? sb.pool.dbt[2].substr(1) : sb.pool.dbt[2]);\r\n////////              remove_thread(name);\r\n////////            }\r\n////////            if (sb.found_threads<sb.max_threads) sb.error += ((sb.error==='')? '' : ', ') + key;\r\n////////          }\r\n////////          sb.pool.doc = null;\r\n////////          scan_boards_keyword(args,value.status);\r\n////////        }\r\n////////  \r\n////////        function tag_scan_extract_1(key,pn,sb) {\r\n////////  //        sb.pool.tags[key] = {};\r\n////////  //        var tags = pn[brwsr.innerText].match(tags_scan_regex);\r\n////////  //        sb.pool.tags[key].tags = tags;\r\n////////  ////        var tags = div[brwsr.innerText].match(tags_scan_regex);\r\n////////  ////        if (tags) {\r\n////////  ////          var tags_uniq = {};\r\n////////  ////          for (var k=0;k<tags.length;k++) tags_uniq[tags[k]] = 1;\r\n////////  ////          for (var k in tags_uniq) {\r\n////////  ////            if (sb.pool.tags[k]===undefined) sb.pool.tags[k] = [];\r\n////////  ////            sb.pool.tags[k].push(key);\r\n////////  ////          }\r\n////////  ////        }\r\n////////  //        return tags;\r\n////////          pn.tags = pn[brwsr.innerText].match(tags_scan_regex);\r\n////////          var ths = {};\r\n////////          ths[key] = pn;\r\n////////          scan_tags_common(ths,'',sb.pool.tags);\r\n////////  //        scan_tags_common({key:pn},'',sb.pool.tags,true);\r\n////////  //        return pn.tags;\r\n////////        }\r\n        cataLog.scan_init = scan_init;\r\n        return {\r\n          scan_init: scan_init,\r\n          scan_abort: function(key){scan_init(key, {}, {});},\r\n          scan_boards_keyword_callback2: scan_boards_keyword_callback2,\r\n//          update_thread: update_thread,\r\n////          priority_up: crawler.priority_up,\r\n////          priority_release: crawler.priority_release,\r\n        }\r\n      }());\r\n      cataLog.scan_boards = scan_boards;\r\n\r\n      function catalog_resized(myself) {\r\n        var tgt;\r\n        if ((pref.catalog.text_mode.mode==='graphic' && (myself.name==='catalog_size_text_width' || myself.name==='catalog_size_text_height')) ||\r\n            (pref.catalog.text_mode.mode==='text'    && (myself.name==='catalog_size_width'      || myself.name==='catalog_size_height'))) return;\r\n        else tgt = myself.name.substr(myself.name.lastIndexOf('_')+1);\r\n        var val = (pref[myself.name]==0)? '' : pref[myself.name] + 'px';\r\n        for (var i in threads) threads[i][0].style[tgt] = val;\r\n//        for (var i in threads) {\r\n//          threads[i][0].style.width  = (pref.catalog_size_width==0 )? '' : pref.catalog_size_width  + 'px';\r\n//          threads[i][0].style.height = (pref.catalog_size_height==0)? '' : pref.catalog_size_height + 'px';\r\n//        }\r\n      }\r\n      var auto_update = (function(){\r\n        var timer = null;\r\n        var time_remains = 0;\r\n        var timer_tgt = function(from_refresh_button){\r\n          timer=null;\r\n          catalog_refresh(true,null,!from_refresh_button);\r\n          auto_update.set();\r\n        }\r\n        function stop_if_running(){\r\n          if (timer) {clearTimeout(timer); timer=null;}\r\n          if (pref.catalog_auto_update_countdown) health_indicator.pn_countdown.textContent = '';\r\n        }\r\n        function countdown(){\r\n          health_indicator.pn_countdown.textContent = time_remains--;\r\n          if (time_remains<0) timer_tgt();\r\n          else timer = setTimeout(countdown,1000);\r\n        }\r\n        return {\r\n          set : function(){\r\n            stop_if_running();\r\n            if (pref[embed_mode].auto_update) {\r\n              var period = pref[embed_mode].auto_update_period || 0.5;\r\n              if (!pref.catalog_auto_update_countdown) timer = setTimeout(timer_tgt,period*60000);\r\n              else {\r\n                time_remains = period*60;\r\n                countdown();\r\n              }\r\n            }\r\n          },\r\n          stop_if_running: stop_if_running,\r\n          timer_tgt : function(){\r\n            if (timer) {clearTimeout(timer); timer=null;}\r\n            timer_tgt(true);\r\n          }\r\n        }\r\n      })();\r\n      cataLog.auto_update = auto_update;\r\n      if (site.whereami!=='archive') auto_update.set();\r\n//      var auto_update_timer = null; // working code.\r\n//      function set_auto_update(){\r\n//        if (auto_update_timer) {clearTimeout(auto_update_timer);auto_update_timer=null;}\r\n//        if (pref.catalog_auto_update) {\r\n//          var period = pref.catalog_auto_update_period;\r\n//          auto_update_timer=setTimeout(function(){auto_update_timer=null;catalog_refresh(true,null,true);},period*60000);\r\n//        }\r\n//      }\r\n//      set_auto_update();\r\n\r\n////      pn_filter.getElementsByTagName('*')['catalog.filter.tag_search.str'].onkeyup = function(){ // working code.\r\n////        pref_func.apply_prep(this,true);\r\n////        liveTag.filter_onchange();\r\n////      }\r\n////      if (!pref.catalog.filter.show) pn_filter.style.display = 'none';\r\n//      pn_filter.style.display = 'none';\r\n////      pn_filter.getElementsByTagName('*')['catalog.filter.kwd.str'].onkeyup = function(){ // working code.\r\n////        pref_func.apply_prep(this,true,true);\r\n////        if ((!pref.catalog.filter.kwd.use && this.value!=='') || (pref.catalog.filter.kwd.use && this.value==='')) {\r\n////          pref.catalog.filter.kwd.use = !pref.catalog.filter.kwd.use;\r\n////          var use = pn_filter.getElementsByTagName('*')['catalog.filter.kwd.use'];\r\n////          pref_func.apply_prep(use,false,true);\r\n////        }\r\n////      }\r\n      var filter_time_str = pn_filter.getElementsByTagName('*')['catalog.filter.time_str'];\r\n//      pn_filter.getElementsByTagName('button')['now'].onclick = function(){set_time_str(Date.now());}\r\n//      var filter_time_ago_str = pn_filter.getElementsByTagName('*')['catalog.filter.time_ago_str'];\r\n//      filter_time_ago_str.onkeyup = ago_clicked;\r\n//      pn_filter.getElementsByTagName('button')['ago'].onclick= ago_clicked;\r\n      function ago_clicked(e, time_in){\r\n//        if (time_in===undefined) {\r\n//          var str = filter_time_ago_str.value;\r\n//          var time_in = (parseInt(str.replace(/:.*/,''),10)*60+parseInt(str.replace(/[^:]*:/,''),10))*60000;\r\n//        }\r\n        var time = Date.now() - time_in;\r\n        filter_time_str.value = new Date(time).toLocaleString();\r\n        pref_func.apply_prep(filter_time_str,true,true);\r\n      }\r\n//      function ago_clicked(){\r\n//        var str = filter_time_ago_str.value;\r\n//        var time = Date.now() - (parseInt(str.replace(/:.*/,''),10)*60+parseInt(str.replace(/[^:]*:/,''),10))*60000;\r\n//        set_time_str(time);\r\n//      }\r\n//      function set_time_str(time){\r\n//        filter_time_str.value = new Date(time).toLocaleString();\r\n//        pn_filter_changed();\r\n//      };\r\n//      pn_filter.getElementsByTagName('button')['copy'].onclick =\r\n//        function(){\r\n//          pn_filter.getElementsByTagName('textarea')['catalog.filter.time_mark_str'].value=filter_time_str.value;\r\n//          pn_filter_changed();\r\n//        }\r\n      var watch_list = pn_filter.getElementsByTagName('textarea')['catalog.filter.watch_list_str'];\r\n      var search_ex_list = pn_filter.getElementsByTagName('textarea')['catalog.filter.list_str'];\r\n//      search_ex_list.onkeyup = pn_filter_changed;\r\n      var attr_list = pn_filter.getElementsByTagName('textarea')['catalog.filter.attr_list_str'];\r\n//      attr_list.onkeyup = function(){if (pref.catalog.filter.attr_list) catalog_attr_changed();};\r\n//      pn_filter.onchange = pn_filter_changed;\r\n      function pn_filter_changed(){\r\n        pref_func.apply_prep(pn_filter,true);\r\n        catalog_filter_changed();\r\n      }\r\n\r\n////      function scan_tags(){ // working code.\r\n////        var ths = [];\r\n////        var j=0;\r\n////        for (var i in threads) {\r\n////          ths[j] = {};\r\n////          ths[j++].tags = threads[i][0][brwsr.innerText].match(tags_scan_regex); // ATTENTION. DESCRIPTION IS ALSO EXIST IN CATALOG_FILTER_QUERY().\r\n////        }\r\n////        var str2 = scan_tags_common(ths,'');\r\n////        scan_tags_init(str2,false);\r\n////      }\r\n      function scan_tags_init(str2, reload){\r\nif (pref.test_mode['22']) {\r\n        var pn_tag_list = pn_filter.getElementsByTagName('div')['catalog.filter.tag_list'];\r\n        if (reload!==null) pn_tag_list.onchange = function(){prep_tag_str(null, reload, true);};\r\n        pn_tag_list.innerHTML = str2;\r\n        if (pn_tag_list.style.height=='') pn_tag_list.style.height = '30px';\r\n        if (pn_tag_list.style.width=='') pn_tag_list.style.width = '100px';\r\n//        prep_tag_str(true,reload);\r\n        prep_tag_str(true,false);\r\n}\r\n      }\r\n      var filter_tags = [];\r\n      function prep_tag_str(keep,reload, from_onchange){\r\n        var pn_tag_list = pn_filter.getElementsByTagName('div')['catalog.filter.tag_list'];\r\n        var cbxes = pn_tag_list.getElementsByTagName('input');\r\n        if (keep===true) {\r\n          for (var i=0;i<filter_tags.length;i++) filter_tags[i] = filter_tags[i].toString().replace(/^\\//,'').replace(/\\(.*\\n*.*/,'');\r\n          var tags = [];\r\n          for (var i=0;i<cbxes.length;i++) tags[i] = cbxes[i].nextSibling.textContent.replace(/ [0-9]*: /,'');\r\n          for (var i=0;i<filter_tags.length;i++)\r\n            for (var j=0;j<cbxes.length;j++)\r\n              if (tags[j]==filter_tags[i]) cbxes[j].checked = true;\r\n        }\r\n        filter_tags = [];\r\n        var tgts = {};\r\n        var flag = false;\r\n        for (var i=0;i<cbxes.length;i++)\r\n          if (cbxes[i].checked) {\r\n            filter_tags.push(new RegExp(cbxes[i].nextSibling.textContent.replace(/ [0-9]*: /,'').replace(/$/,'(#|,| |\\\\.|:|;|\\n|$)'),(pref.catalog.filter.tag_ci)? 'i' : '')); // ATTENTION. REFER tag_scan_regex.\r\n            if (reload) {\r\n              var tags_tgt = (pref.catalog.filter.tag_ci)? site3[site.nickname].tags.ci[i].mem : site3[site.nickname].tags.cs[i].mem;\r\n              for (var j in tags_tgt) tgts[j] = null;\r\n            }\r\n            flag = true;\r\n          }\r\n        if (from_onchange && flag) {\r\n          pref.catalog.filter.tag = true;\r\n          pref_func.apply_prep(pn12_0_4.getElementsByTagName('input')['catalog.filter.tag'],false);\r\n        }\r\n        if (pref.catalog.filter.tag) catalog_filter_changed();\r\n//        pn_filter_changed();\r\n        if (reload) {\r\n//          for (var i in tgts) console.log(i);\r\n\r\n//          load_list.tag.tgts = []; // working code.\r\n//          for (var i in tgts) load_list.tag.tgts.push(i+'c0');\r\n////          load_list.tag.use_cache = !refresh;\r\n//          load_list.tag.idx = 0;\r\n//          load_list.tag.mutex = true;\r\n//          load_list.tag.from_auto = false;\r\n//          load_list.tag.tgts = trim_list(load_list.tag.tgts,false);\r\n//          if (pref.catalog_refresh_clear) catalog_clear_threads(pref.catalog.max_threads_at_refresh);\r\n//          if (load_list.tag.idx<load_list.tag.tgts.length) get_page(load_list.tag);\r\n          scan_boards.scan_init('refresh_tag',tgts, {lifetime:pref.scan.lifetime*60, cache_write:true});\r\n//          set_auto_update();\r\n          filter_tags_refresh_mem = tgts;\r\n        }\r\n      }\r\n//      function load_save_key(){\r\n//        return pref.script_prefix + '.catalog.adv_str.' + pref.catalog_board_list_obj[board_sel.selectedIndex][0].key;\r\n//      }\r\n//      pn_filter.getElementsByTagName('button')['load_adv_str'].onclick = function(){\r\n//        if (localStorage) {\r\n//          var tmp = JSON.parse(localStorage.getItem(load_save_key()));\r\n//          if (tmp) {\r\n//            search_ex_list.value = tmp[0];\r\n//            attr_list.value = tmp[1];\r\n//          }\r\n//        }\r\n//      };\r\n//      pn_filter.getElementsByTagName('button')['save_adv_str'].onclick = function(){if (localStorage) localStorage.setItem(load_save_key(),JSON.stringify([search_ex_list.value,attr_list.value]));};\r\n      \r\n//      pn_filter.childNodes[11].onclick= function(){\r\n//        var str = pn_filter.childNodes[10].value;\r\n//        var time = Date.now() - (parseInt(str.replace(/:.*/,''),10)*60+parseInt(str.replace(/[^:]*:/,''),10))*60000;\r\n//        pn_filter.childNodes[8].value = new Date(time).toLocaleString();\r\n//        pref_func.apply_prep(pn_filter,true);\r\n//        catalog_filter_changed();\r\n//      };\r\n//      if (pn12_0_2.childNodes[0].checked) cnst.show_hide(pn_filter);\r\n//      pn12_1.style.width  = '';\r\n//      pn12_1.style.height = '';\r\n\r\n      var scroll_event_src = (embed_embed)? ((site2[site.nickname].catalog_get_native_scroll_area)? site2[site.nickname].catalog_get_native_scroll_area() : window) :\r\n                                            triage_parent.parentNode;\r\n//      var scroll_event_src = (embed_embed)? window : triage_parent;\r\n      var pn12_triage;\r\n      var triage_str;\r\n      function remake_triage(finish){\r\n        triage.off();\r\n        pref_func.tooltips.remove_root(pn12_triage);\r\n        if (!finish) make_triage_entry();\r\n      }\r\n      function make_triage_entry(){\r\n        var pn12_triage_all = new common_func.Triage(pref.catalog_triage_str, {onclick:triage_event, wheelpatch:(!embed_embed)? triage_wheel : null, name:'pn_catalog_triage'});\r\n        pn12_triage = pn12_triage_all.pn;\r\n        triage_str = pn12_triage_all.str;\r\n        pn12_triage.style.position = 'absolute';\r\n        pref_func.tooltips.add_root(pn12_triage);\r\n//        var pn12_triage_all = common_func.make_triage({onclick:triage_event, wheelpatch:(!embed_catalog)? triage_wheel : null});\r\n//        pn12_triage = pn12_triage_all.pn;\r\n//        triage_str = pn12_triage_all.str;\r\n//        pn12_triage.style.position = 'absolute';\r\n//        pn12_triage.name = 'pn_catalog_triage';\r\n//        if (pref.tooltip.show) pref_func.tooltips.add(pn12_triage);\r\n//        pn12_triage.addEventListener('mouseover', catalog_triage_out_clear, false);\r\n//        pn12_triage.addEventListener('mouseout' , catalog_triage_out_delay, false);\r\n        pn12_triage.onmouseover = triage.triage_in;\r\nif (pref.test_mode['127']) {\r\n        pn12_triage.onmouseout  = triage.triage_out;\r\n}\r\n        if (!pref.triage.hide_toggle) pn12_triage_all.format_tgt = null;\r\n        triage.set_trg(pn12_triage_all);\r\n      }\r\n//      function make_triage(args){\r\n//        var triage_str = [];\r\n//        var pn_triage = document.createElement('div');\r\n////        pn_triage.style.position = 'absolute';\r\n////        pn_triage.name = 'pn_catalog_triage';\r\n//        pn_triage.className = 'catalog_triage_parent';\r\n//        var triage_str_lines = pref.catalog_triage_str.replace(/\\/\\/.*/mg,'').split('\\n');\r\n//        for (var i=triage_str_lines.length-1;i>=0;i--) if (triage_str_lines[i]==='') triage_str_lines.splice(i,1);\r\n//        var triage_style_replace_list = (!brwsr.ff)? ['background','background-color'] : [];\r\n//        for (var i=0;i<triage_str_lines.length;i++)\r\n//          triage_str[i] = triage_str_lines[i].split(',');\r\n//        for (var i=0;i<triage_str.length;i++) {\r\n//          for (var j=0;j<triage_str[i].length;j+=3) {\r\n//            var triage_button = document.createElement('button');\r\n//            triage_button.innerHTML = triage_str[i][j+1];\r\n//            triage_button.name = i+','+j;\r\n//            triage_button.className = 'catalog_triage_button';\r\n//            var triage_styles = (triage_str[i][j+2])? triage_str[i][j+2].split(';') : [];\r\n//            for (var k=0;k<triage_styles.length;k++) {\r\n//              var style_str = triage_styles[k].replace(/:.*/,'');\r\n//              for (var m=0;m<triage_style_replace_list.length;m+=2) style_str = style_str.replace(triage_style_replace_list[m],triage_style_replace_list[m+1]);\r\n//              triage_button.style[style_str] = triage_styles[k].replace(/[^:]*:/,'');\r\n//            }\r\n////            triage_button.onclick = triage_factory(i,j);\r\n//            triage_button.onclick = args.onclick;\r\n//            pn_triage.appendChild(triage_button);\r\n//            if (args.wheelpatch) triage_button.onmousewheel = triage_wheel;\r\n//          }\r\n//          pn_triage.appendChild(document.createElement('br'));\r\n//        }\r\n////        pn_triage.onclick = function(e){  // also works, but CSS is the better.\r\n////          e.preventDefault();\r\n////          var evt = document.createEvent('MouseEvents');\r\n////          evt.initUIEvent('click', false, true, window, 1);\r\n////          threads[pn12_triage_thread][0].dispatchEvent(evt);\r\n//////console.log('aaa');\r\n////        };\r\n//        return {pn:pn_triage, str:triage_str};\r\n//      }\r\n      function triage_wheel(e){ // patch\r\n        triage.off();\r\n        pref_func.tooltips.hide();\r\n        e.preventDefault();\r\n//        triage_parent.dispatchEvent(e); // copy is required.\r\n          var evt = document.createEvent('MouseEvents');\r\n        evt.initMouseEvent(e.type, e.canBubble, e.cancelable, e.view,\r\n                   e.detail, e.screenX, e.screenY, e.clientX, e.clientY,\r\n                   e.ctrlKey, e.altKey, e.shiftKey, e.metaKey,\r\n                   e.button, e.relatedTarget);\r\n        triage_parent.dispatchEvent(evt); // seems not to work...\r\n      };\r\n//      pn12_triage.childNodes[0].onclick = function(){search_ex_list.value = search_ex_list.value + ',' + pn12_triage_thread + '\\n';pref_func.apply_prep(pn_filter,true);catalog_filter_changed();catalog_triage_out();};\r\n//      pn12_triage.childNodes[2].onclick = function(){\r\n////        var key = /8chan\\/meta\\/18578(@[^,]*)*,/;\r\n//        var key = new RegExp(pn12_triage_thread +'(@[^,]*)*(,|$)','g');\r\n//        search_ex_list.value = search_ex_list.value.replace(/,,+/,',').replace(key,'') + ',' + pn12_triage_thread + '@' + new Date(threads[pn12_triage_thread][8] + pref.localtime_offset*3600000).toLocaleString()+'\\n';\r\n//        pref_func.apply_prep(pn_filter,true);\r\n//        catalog_filter_changed();\r\n//        catalog_triage_out();\r\n//      };\r\n      function triage_event(){\r\n        var flds = this.name.split(',');\r\n        var i = parseInt(flds[0].replace(/[^\\(]*\\(/,''),10);\r\n        var j = parseInt(flds[1].replace(/\\).*/,''),10);\r\n//      function triage(i,j){\r\n        var name = triage.get_triaged_thread_name();\r\n//        triage_exe(name,triage_str[i][j],triage_str[i][j+2],true);\r\n////        pref_func.apply_prep(search_ex_list,true);\r\n////        pref_func.apply_prep(attr_list,true);\r\n////        pref_func.apply_prep(watch_list,true);\r\n//        if (triage_str[i][j]==='UNDO') catalog_attr_changed();\r\n//        else catalog_attr_set(name,threads[name][0]);\r\n//        if (triage_str[i][j]==='WATCH' || triage_str[i][j]==='UNWATCH') show_catalog(name);\r\n//        else catalog_filter_changed();\r\n////        catalog_triage_out();\r\n        triage_exe_0(name,triage_str[i][j],triage_str[i][j+2],true);\r\n      }\r\n      function triage_exe_pipe(args){\r\n        var name = args[0];\r\n        var lth = liveTag.mems.getFromName(name);\r\n        var time_last = threads[name][8][4]||threads[name][8][0];\r\n        if (time_last<args[4]) lth.usWT = args;\r\n        else if (lth.usWT) lth.usWT = null;\r\n        triage_exe_0(args[0],args[1],args[2],args[3],args[4]);}\r\n      function triage_exe_0(name,tri_str_ex,tri_str_attr,hist,datetime){\r\n        if (['ARC','ARC1','UARC'].indexOf(tri_str_ex)!=-1) {\r\n          if (!pref.test_mode['67']) archiver.start_1(tri_str_ex,liveTag.mems.getFromName(name),true); // test patch\r\n          return;\r\n        }\r\n        var changed = triage_exe(name,tri_str_ex,tri_str_attr,hist,datetime);\r\n        name = changed.name;\r\n        if (threads[name]) { // threads[name] might not exist at undo\r\n          if (changed.attr) catalog_attr_set(name,threads[name][0]);\r\n          if (changed.ex) threads[name][9] = catalog_filter_query(name);\r\n        }\r\n        if (changed.watch) {\r\n          threads_index.idx_reorder(name);\r\n          if (pref[embed_mode].mark_new_posts) if (embed_mode!=='catalog') format_html.update(name);\r\n        }\r\n        if (changed.ex || changed.watch) {show_catalog(name); triage.off();}\r\n        if (triage.get_trg().format_tgt) triage.format_buttons(changed.name);\r\n        pref_func.tooltips.hide();\r\n      }\r\n      function triage_exe(name,tri_str_ex,tri_str_attr,hist,datetime){ // KILL,TIME,UNDO,NONE,WATCH,UNWATCH,DELETE,GO\r\n        if (tri_str_ex==='UNWATCH') common_func.modify_bookmark(name,false);\r\n        var changed = {ex:false, attr:false, watch:false, name:name};\r\n        if (tri_str_ex==='GO') {click_thread(name, 'force');return changed;}\r\n        if (tri_str_ex!=='UNDO') {\r\n          if (hist) {\r\n            if (triage_history.length>=pref.catalog_triage_hist*4) triage_history.splice(0,4);\r\n            triage_history.push(arguments);\r\n            triage_history.push(search_ex_list.value);\r\n            triage_history.push(attr_list.value);\r\n            triage_history.push(watch_list.value);\r\n          }\r\n          var key = new RegExp('(^|,)'+name.replace(/\\+/,'\\\\+')+'([\\\\^@!][^,\\n]*)*(,|\\n|$)','mg');\r\n//          if (tri_str_ex.search(/KILL|TIME|WATCH/)!=-1) { // contains UNWATCH\r\n          if (['KILL','TIME','WATCH','UNWATCH','TRACK','DELETE','KILL_N','TIME_N'].indexOf(tri_str_ex)!=-1) {\r\n//            var datetime = threads[name][8][0] + pref.localtime_offset*3600000; // NO BLOCK SCOPE\r\n//            var datetime = ((threads[name][8][0]>threads[name][8][4])? threads[name][8][0] : threads[name][8][4]) + pref.localtime_offset*3600000; // NO BLOCK SCOPE\r\n//            var datetime = (tri_str_ex!=='DELETE')? threads[name][8][4] + pref.localtime_offset*3600000 : 0; // NO BLOCK SCOPE\r\n            if (!datetime) datetime = (tri_str_ex!=='DELETE')? threads[name][8][4]||threads[name][8][0] : 0; // NO BLOCK SCOPE\r\n            var millisec = datetime%1000; // NO BLOCK SCOPE\r\n            var time_str = '@' + new Date(datetime).toLocaleString() + ((datetime%1000==0)? '' : '.'+millisec); // NO BLOCK SCOPE\r\n            var wat_str = watch_list.value;\r\n            if (tri_str_ex==='UNWATCH' && wat_str.indexOf(key)==-1) var unwatch_explicitly = true;\r\n            wat_str = wat_str.replace(key,',');\r\n//            if (tri_str_ex.search(/KILL|UNWATCH/)==-1) {\r\n            if (tri_str_ex!=='DELETE') {\r\n//              if (['TIME','WATCH'].indexOf(tri_str_ex)!=-1) {\r\n              if (tri_str_ex==='WATCH' || tri_str_ex==='TRACK' || (tri_str_ex==='TIME' || tri_str_ex==='TIME_N')) { //  && pref.catalog.auto_watch) {\r\n                wat_str += ',' + name + time_str + '\\n'; // TIME or WATCH\r\n                mark_read_thread(name, datetime, tri_str_ex==='TRACK' && tri_str_attr);\r\n              } else {\r\n                if (unwatch_explicitly) wat_str += ',' + name + '@0\\n';\r\n                mark_read_thread(name, null);\r\n              }\r\n            }\r\n            watch_list.value = wat_str.replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,'');\r\n            changed.watch = true;\r\n          }\r\n//          if (tri_str_ex.search(/KILL|TIME|NONE/)!=-1) {\r\n          if (['KILL','TIME','NONE','DELETE','UNWATCH','KILL_N','TIME_N'].indexOf(tri_str_ex)!=-1) {\r\n            var ex_str = search_ex_list.value.replace(key,',');\r\n            if (['KILL','KILL_N','TIME','TIME_N'].indexOf(tri_str_ex)!=-1) ex_str = ex_str + ',' + name + ((tri_str_ex==='TIME' || tri_str_ex==='TIME_N')? time_str : '') +'\\n';\r\n            search_ex_list.value = ex_str.replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,'');\r\n            changed.ex = true;\r\n          }\r\n////          if (['KILL','TIME','NONE','DELETE'].indexOf(tri_str_ex)!=-1) {\r\n////            var at_str = attr_list.value.replace(key,',') + ((tri_str_attr!=='')? ',' + name + '^' +tri_str_attr : '') +'\\n';\r\n////            attr_list.value = at_str.replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,'');\r\n////            changed.attr = true;\r\n////          }\r\n          if (['KILL','TIME','NONE','DELETE','ATTR','SHOW','UNSHOW','STICKY','UNSTICKY'].indexOf(tri_str_ex)!=-1) {\r\n            var at_str;\r\n            if (tri_str_ex==='DELETE') at_str = '';\r\n            else {\r\n              var at_str = attr_list.value.match(key);\r\n              at_str = (at_str)? at_str[0] : name;\r\n              var at_obj = {val_obj2:null, val_obj3:null};\r\n              pref_func.str2obj2(at_obj,'val_obj2',at_str);\r\n              if (tri_str_ex==='ATTR' && tri_str_attr) pref_func.str2obj2(at_obj,'val_obj2',name+'^'+tri_str_attr, true);\r\n              at_obj = at_obj.val_obj2[name];\r\n              if (!at_obj.style) at_obj.style = {};\r\n              if (!at_obj.cmd) at_obj.cmd = {};\r\n              if (tri_str_ex==='SHOW') at_obj.cmd['show'] = true;\r\n              else if (tri_str_ex==='UNSHOW') delete at_obj.cmd['show'];\r\n              else if (tri_str_ex==='STICKY') {\r\n                if (threads[changed.name][16].systemSticky) delete at_obj.cmd['sticky'];\r\n                else at_obj.cmd['sticky'] = true;\r\n              } else if (tri_str_ex==='UNSTICKY')\r\n                if (threads[changed.name][16].systemSticky) at_obj.cmd['sticky'] = false;\r\n                else delete at_obj.cmd['sticky'];\r\n              at_str = name;\r\n              if (['KILL','TIME','NONE'].indexOf(tri_str_ex)!=-1) {\r\n                if (tri_str_attr!=='') at_str += '^' +tri_str_attr;\r\n              } else { // 'ATTR'\r\n                var at_obj_keys = Object.keys(at_obj.style);\r\n                if (at_obj_keys.length!=0) {\r\n                  for (var i=0;i<at_obj_keys.length;i++) at_obj_keys[i] += ':' + at_obj.style[at_obj_keys[i]];\r\n                  at_str += '^' + at_obj_keys.join(';');\r\n                }\r\n              }\r\n              at_obj_keys = Object.keys(at_obj.cmd);\r\n              if (at_obj_keys.length!=0) {\r\n                for (var i=0;i<at_obj_keys.length;i++) if (at_obj.cmd[at_obj_keys[i]]===false) at_obj_keys[i] += ':false';\r\n                at_str += '!' + at_obj_keys.join(';');\r\n              }\r\n              at_str = (at_str === name)? '' : at_str + '\\n';\r\n            }\r\n            at_str = attr_list.value.replace(key,',') + at_str;\r\n            attr_list.value = at_str.replace(/,,+/g,',').replace(/^,/g,'').replace(/\\n,/g,'\\n').replace(/\\n\\n+/g,'\\n').replace(/^\\n/,'');\r\n            changed.attr = true;\r\n          }\r\n        } else {\r\n          if (triage_history.length!=0) {\r\n            changed.watch = (watch_list.value     !== triage_history[triage_history.length-1]);\r\n            changed.attr  = (attr_list.value      !== triage_history[triage_history.length-2]);\r\n            changed.ex    = (search_ex_list.value !== triage_history[triage_history.length-3]);\r\n            watch_list.value = triage_history.pop();\r\n            attr_list.value = triage_history.pop();\r\n            search_ex_list.value = triage_history.pop();\r\n            var undo_args = triage_history.pop(); // from arguments\r\n            changed.name = undo_args[0];\r\n          }\r\n        }\r\n        if (tri_str_ex==='DELETE') {\r\n          if (tri_str_attr===null) return changed;\r\n          else {\r\n            while (tri_str_attr.length!=0) {\r\n              var name_next = tri_str_attr.shift();\r\n              var changed_next = triage_exe(name_next,tri_str_ex,null,hist,datetime);\r\n              changed.watch |= changed_next.watch;\r\n              changed.ex    |= changed_next.ex;\r\n              changed.attr  |= changed_next.attr;\r\n            }\r\n          }\r\n        }\r\n        if (tri_str_ex==='WATCH' && pref.archive.store_watched) {\r\n          var lth = liveTag.mems.getFromName(name);\r\n          if (!lth.archived) archiver.start_1('ARC',lth,true);\r\n        }\r\n//        if (tri_str_ex==='UNDO') re_sort_thread();\r\n//        else if (['WATCH','UNWATCH'].indexOf(tri_str_ex)!=-1) reorder_thread_idx(name);\r\n//        if (tri_str_ex!=='NONE') pref_func.apply_prep(watch_list,true);\r\n//        if (['UNDO','KILL','TIME','NONE'].indexOf(tri_str_ex)!=-1) pref_func.apply_prep(search_ex_list,true);\r\n//        if (['WATCH','UNWATCH'].indexOf(tri_str_ex)==-1) pref_func.apply_prep(attr_list,true);\r\n        if (changed.watch) pref_func.apply_prep(watch_list,true);\r\n        if (changed.ex)    pref_func.apply_prep(search_ex_list,true);\r\n        if (changed.attr)  pref_func.apply_prep(attr_list,true);\r\n        if (tri_str_ex==='UNDO' && (changed.watch || undo_args[1]==='KILL')) { // re-order, 'KILL' doesn't change watch-list.\r\n//        if (tri_str_ex==='UNDO' && changed.watch) { // re-order\r\n          if (threads[changed.name]) {\r\n            site2['DEFAULT'].check_reply.set_watch_time(threads[changed.name][19], get_watch_time_of_a_thread(changed.name,threads[changed.name][8][1], null, true), changed.name);\r\n//            threads[changed.name][19][0] |= 0x00010000;\r\n            scan_boards.scan_init('triage_undo', [changed.name], {refresh:true, priority:8});\r\n          }\r\n        }\r\n        return changed;\r\n      }\r\n      var triage_history = [];\r\n\r\n      var triage = (function(){\r\n        var trg = null;\r\n        function format_buttons(name){\r\n          var tgt = trg.format_tgt;\r\n          var tgt_th = threads[name];\r\n          var lth = liveTag.mems.getFromName(name);\r\n          for (var i=0;i<tgt.length;i++) tgt[i][0].style.display = (format_funcs[tgt[i][1]](tgt_th,lth))? 'none' : '';\r\n        }\r\n        var format_funcs = { // YOU MUST ALSO CHANGE toggles in Triage.\r\n          'WATCH': function(tgt_th){return (tgt_th[19][0]&0x000c0000) && tgt_th[19][1]===0;},\r\n          'UNWATCH': function(tgt_th){return !(tgt_th[19][0]&0x000c0000);},\r\n          'SHOW': function(tgt_th){return tgt_th[16].icon_show_always;},\r\n          'UNSHOW': function(tgt_th){return !tgt_th[16].icon_show_always;},\r\n          'STICKY': function(tgt_th){return tgt_th[20];},\r\n          'UNSTICKY': function(tgt_th){return !tgt_th[20];},\r\n          'ARC': function(tgt_th,lth){return lth.archived;},\r\n          'ARC1': function(tgt_th,lth){return lth.archived;},\r\n          'UARC': function(tgt_th,lth){return !lth.archived;},\r\n        };\r\n        var on_off = (function(){\r\n          var triaged_name = null;\r\n          var triaged_pn = null;\r\n          var db_thread_out = new DelayBuffer(thread_out,100);\r\n          var thread_out_delayed = DelayBuffer.prototype.delayed_do.bind(db_thread_out);\r\n          var db_triage_off = new DelayBuffer(triage_off,pref.triage.popdown_delay);\r\n          var mode = true; // add/remove or show/hide\r\n          function change_mode(){\r\n            triage_parent.appendChild(pn12_triage);\r\n            mode = false;\r\n          }\r\n          var triage_off_wdg = new Watchdog(triage_off, 100);\r\n          function set_triage_style(style, pn){\r\n            if (!triaged_name) {\r\n              if (mode) pn12_triage = triage_parent.appendChild(pn12_triage);\r\n              else style.display = '';\r\n            }\r\n            var left = pn.offsetLeft - triage_parent.scrollLeft;\r\n            if (pref.catalog_triage_place.slice(-4)==='Left') { // 'topLeft' || 'bottomLeft'\r\n              style.left = left + 'px';\r\n              style.right = null;\r\n            } else {\r\n              style.right = triage_parent.offsetWidth - left - pn.offsetWidth + 'px';\r\n              style.left = null;\r\n            }\r\n            var top = pn.offsetTop - triage_parent.scrollTop;\r\n            if (pref.catalog_triage_place[0]==='t') { // 'topLeft' || 'topRight'\r\n              style.top    = pn.offsetTop - triage_parent.scrollTop + 'px';\r\n              style.bottom = null;\r\n            } else {\r\n              style.bottom = window.innerHeight - top - pn.offsetHeight + 'px';\r\n              style.top    = null;\r\n            }\r\n          }\r\n          function thread_in(e, name){\r\n            if (pref.catalog_triage) {\r\n              if (!pref.test_mode['127']) {\r\n                var pn = e;\r\n                if (!pref.triage.show_always) triage_off_wdg.restart(pref.triage.popdown_delay);\r\n                if (triaged_pn===pn) return; // from mouse on triage\r\n                set_triage_style(pn12_triage.style, pn);\r\n                triaged_pn = pn; // SHOULD USE PN FOR MULTI CATALOG.\r\n                triaged_name = name; //  gGEH.pns_all_keys.get(pn);\r\n                if (trg.format_tgt) format_buttons(triaged_name);\r\n              } else { // working code\r\n                var pn = e.currentTarget;\r\n                db_thread_out.cancel();\r\n                if (triaged_pn===pn) return; // for faster execution.\r\n                if (!triaged_name) {\r\n                  if (mode) pn12_triage = triage_parent.appendChild(pn12_triage);\r\n                  else pn12_triage.style.display = '';\r\n                }\r\n                if (!pref.triage.show_always) {db_triage_off.cancel();db_triage_off.delayed_do();}\r\n                if (triaged_pn) triaged_pn.removeEventListener('mouseout', thread_out_delayed, false);\r\n                var left = pn.offsetLeft - triage_parent.scrollLeft;\r\n                if (pref.catalog_triage_place==='topLeft' || pref.catalog_triage_place==='bottomLeft') {\r\n                  pn12_triage.style.left = left + 'px';\r\n                  pn12_triage.style.right = null;\r\n                } else {\r\n                  pn12_triage.style.right = triage_parent.offsetWidth - left - pn.offsetWidth + 'px';\r\n                  pn12_triage.style.left = null;\r\n                }\r\n                var top = pn.offsetTop  - triage_parent.scrollTop;\r\n                if (pref.catalog_triage_place==='topLeft' || pref.catalog_triage_place==='topRight') {\r\n                  if (top<triage_parent.offsetTop) top = triage_parent.offsetTop;\r\n                  pn12_triage.style.top   = top + 'px';\r\n                  pn12_triage.style.bottom = null;\r\n                } else {\r\n                  pn12_triage.style.bottom = window.innerHeight - top - pn.offsetHeight + 'px';\r\n                  pn12_triage.style.top = null;\r\n                }\r\n                triaged_pn = e.currentTarget;\r\n                triaged_name = triaged_pn.name;\r\n                triaged_pn.addEventListener('mouseout', thread_out_delayed, false);\r\n                if (trg.format_tgt) format_buttons(triaged_name);\r\n              }\r\n            } else triage_off();\r\n          }\r\n          function thread_out(){\r\n            if (triaged_pn) {\r\n              triaged_pn.removeEventListener('mouseout', thread_out_delayed, false);\r\n              triaged_pn = null;\r\n            }\r\n            triage_off();\r\n          }\r\n          function triage_off(){\r\n            if (triaged_name) {\r\n              if (mode) pn12_triage = pn12_triage.parentNode.removeChild(pn12_triage); // for reentry, triage_parent wasn't updated when !pref[embed_mode].embed, for example, catalog -> thread -> catalog wiil cause an error.\r\n//              if (mode) pn12_triage = triage_parent.removeChild(pn12_triage);\r\n              else pn12_triage.style.display = 'none';\r\n              triaged_name = null;\r\n            }\r\n            pref_func.tooltips.hide_if(pn12_triage);\r\n          }\r\n          function thread_out2(e){\r\n            triaged_pn = null;\r\n            triage_off();\r\n          }\r\n//          function onTriage_or_off(e){\r\n//            var pn = e.target;\r\n//            while (pn!=e.currentTarget){\r\n//              if (pn.className==='catalog_triage_parent') {\r\n//                triage_off_wdg.stop();\r\n//                return;\r\n//              } else pn = pn.parentNode;\r\n//            }\r\n//            triaged_pn = null;\r\n//            triage_off();\r\n//          }\r\n          return {\r\n            get_triaged_thread_name: function(){return triaged_name;},\r\n            change_mode: change_mode,\r\n            thread_in:  thread_in,\r\n            off: triage_off,\r\n            off_delay: (!pref.test_mode['127'])? null : function(){db_triage_off.delayed_do(500);},\r\n            triage_in:  (!pref.test_mode['127'])? function(e){triage_off_wdg.stop();e.stopPropagation();gGEH.triage_in2(e); if (gGEH.triage_in) gGEH.triage_in(e);}\r\n                                                : function(){                              db_triage_off.cancel();    db_thread_out.cancel();},\r\n            triage_out: (!pref.test_mode['127'])? null : function(){if (!pref.triage.show_always) db_triage_off.delayed_do();db_thread_out.delayed_do();},\r\n//            onTriage_or_off: onTriage_or_off,\r\n            thread_out2: thread_out2,\r\n          }\r\n        })();\r\n        return {\r\n          get_triaged_thread_name: on_off.get_triaged_thread_name,\r\n          change_mode: on_off.change_mode,\r\n          thread_in:  on_off.thread_in,\r\n          off: on_off.off,\r\n          off_delay: on_off.off_delay,\r\n          triage_in:  on_off.triage_in,\r\n          triage_out: on_off.triage_out,\r\n          set_trg: function(trg_new){trg = trg_new;},\r\n          get_trg: function(){return trg;},\r\n          format_buttons: format_buttons,\r\n//          onTriage_or_off: on_off.onTriage_or_off,\r\n          thread_out2: on_off.thread_out2,\r\n        }\r\n      })();\r\n      make_triage_entry();\r\n      cataLog.triage = triage;\r\n                \r\n\r\n//      function insert_thread_with_test_from_catalog_json(th, snoop, date_load){\r\n//        if (threads[th.key] && threads[th.key][8][0]>=th.time_bumped && threads[th.key][8][2]==th.nof_posts && threads[th.key][8][3]==th.nof_files) return false;\r\n//        site2[th.domain].parse_funcs['catalog_json'].entry(th,['key','pn']);\r\n//\r\n//        var date = [th.time_bumped, th.time_created, th.nof_posts, th.nof_files]; // temporal\r\n//        th.search_obj = [ th.com, th.sub, th.name, '', '', '', '', '']; // temporal\r\n//        var url = site2[th.domain].make_url3(th.board, th.no, '0'); // temporal\r\n//        insert_thread(th.pn, th.domain, th.page, date_load, th.key, th.pn.innerHTML, date, th.search_obj, url, true, th);\r\n//        return true;\r\n//      }\r\n//      function insert_thread_with_test_from_catalog_html(th, snoop, date_load){\r\n//        if (threads[th.key] && threads[th.key][8][0]>=th.time_bumped && threads[th.key][8][2]==th.nof_posts && threads[th.key][8][3]==th.nof_files) return false;\r\n////        var th2 = site2[th.domain].catalog_from_native_1(th.pn,th.board);\r\n////        insert_thread_from_native(th2, th.domain, th.board, snoop, date_load);\r\n//        site2[th.domain].parse_funcs['catalog_html'].entry(th,['sub','name','com','page']);\r\n//        var date = [th.time_bumped, th.time_created, th.nof_posts, th.nof_files]; // temporal\r\n//        th.search_obj = [ th.com, th.sub, th.name, '', '', '', '', '']; // temporal\r\n//        var url = site2[th.domain].make_url3(th.board, th.no, '0'); // temporal\r\n//        insert_thread(th.pn, th.domain, th.page, date_load, th.key, th.pn.innerHTML, date, th.search_obj, url, true, th);\r\n//        return true;\r\n//      }\r\n\r\n      function insert_thread_with_test(th, type, date_load){\r\n        var name = th.key;\r\n        if (threads_candidates_of_deletion && threads_candidates_of_deletion[name]) delete threads_candidates_of_deletion[name];\r\n        if (threads[name] &&\r\n//            ((threads[name][8][4] || threads[name][8][0])>=(th.time_posted || th.time_bumped)) && // vichan has inconsistency in time between catalog.json and thread.json.\r\n            (((threads[name][8][0]>threads[name][8][4])? threads[name][8][0] : (threads[name][8][4] || threads[name][8][0])) >= ((th.time_bumped > th.time_posted)? th.time_bumped : (th.time_posted || th.time_bumped))) && // vichan has inconsistency in time between catalog.json and thread.json.\r\n            threads[name][8][2]==th.nof_posts && threads[name][8][3]==th.nof_files\r\n          && (!threads[name][21] || (th.type_parse!=='thread_html' && th.type_parse!=='thread_json'))) {\r\n//        if (threads[name] && threads[name][8][0]>=th.time_bumped && threads[name][8][2]==th.nof_posts && threads[name][8][3]>=th.nof_files) {\r\n////////          if (threads[name] && pref.catalog_footer_show_page && threads[name][24] && threads[name][24][2]!=th.page) insert_footer3(name,null,th.page);\r\n          return false;\r\n        }\r\nif (pref.test_mode['0']) {\r\n        site2[th.domain].parse_funcs[type].entry(th,site2[th.domain].parse_funcs[type]['after_test']);\r\n}\r\n        insert_thread_passed_test(th, type, date_load);\r\n        return true;\r\n      }\r\n      function insert_thread_passed_test(th, type, date_load){\r\n//        var date = [th.time_bumped, th.time_created, th.nof_posts, th.nof_files]; // temporal\r\n//        th.search_obj = [ (th.com)? th.com : '', (th.sub)? th.sub : '', (th.name)? th.name : '', '', '', '', '', '']; // temporal\r\n        var url = null;\r\n////        if (type==='thread_html' || type==='page_html') {\r\n//////          if (site.nickname!==th.domain) site2[th.domain].absolute_link(th.pn, th.board); // patch for url. BUT BUG.\r\n////          url = site2[th.domain].get_thread_link(th.pn,th.board,pref.catalog_click!='expand',th.key);\r\n////          th.html_org = th.pn.innerHTML; // patch, must be before trim.\r\n////if (!pref.test_mode['5']) {\r\n////          trim_html(th.pn, th.domain, pref.catalog_format.show, th.key); // temporal\r\n////}\r\n////        }\r\n//////        } else url = site2[th.domain].make_url3(th.board, th.no, '0'); // temporal\r\n//////        site2[th.domain].parse_funcs[type]['finisher'](th);\r\n//        insert_thread(null, th.domain, th.page, date_load, th.key, (th.html_org)? th.html_org : th.pn.innerHTML, date, th.search_obj, url, true, th, type);\r\n        insert_thread(null, th.domain, th.page, date_load, th.key, null, th.search_obj, url, true, th, type);\r\n      }\r\n\r\n////////      function insert_thread_from_native(th, nickname, board, snoop, date_load){\r\n////////        var name = nickname + board + th.no;\r\n////////        var date = [th.time_bumped, th.time_created, th.nof_posts, th.nof_files];\r\n////////        var url = site2[nickname].make_url3(board, th.no, '0');\r\n//////////        if (threads[name] && threads[name][8][0]>=date[0]) return 0;\r\n////////        if (threads[name] && threads[name][8][0]>=date[0] && threads[name][8][2]==th.nof_posts && threads[name][8][3]==th.nof_files) return 0;\r\n//////////        if (threads[name] && threads[name][8][0]==date[0] && threads[name][8][2]!=th.nof_posts && nickname==='8chan' && pref.catalog.order.find_sage_in_8chan) threads[name][21] = true; // for 8chan.\r\n////////        return insert_thread(th.pn, nickname, th.page_no, date_load, name, th.pn.innerHTML, date, th.search_obj, url, true, th);\r\n////////      }\r\n\r\n////////      function re_trim_html(){\r\n////////        for (var name in threads) {\r\n////////          var date = get_mark_time(name,pref.catalog.filter.time_mark,pref.catalog.filter.list_mark_time,pref.catalog.filter.watch_list_mark_time);\r\n////////          if (date===0) date = Infinity;\r\n////////          var dbt = cnst.name2domainboardthread(name,true);\r\n////////          site2[dbt[0]].mark_newer_posts(threads[name][0],date);\r\n////////        }\r\n////////      }\r\n      function trim_html(src,nickname,format, name){\r\nif (!pref.test_mode['7']) { // memory leak debug.\r\n  if (!pref.test_mode['8']) {\r\n    if (!pref.test_mode['9']) {// safe\r\n      if (!pref.test_mode['10']) { // safe 30 min.\r\nif (!pref.test_mode['11']) {\r\n        if (!format.fileinfo) site2[nickname].remove_files_info(src);\r\n}\r\nif (!pref.test_mode['12']) {\r\n//        if (!format.posts)    site2[nickname].remove_posts(src,0);\r\n        if (pref[embed_mode].t2h_num_of_posts>=0) site2[nickname].remove_posts(src,(!format.posts)? 0 : pref[embed_mode].t2h_num_of_posts);\r\n}\r\nif (!pref.test_mode['13']) {\r\n        if (format.contents)  site2[nickname].format_thread_contents(src);\r\n}\r\n      }\r\n        if (format.layout)    site2[nickname].format_thread_layout(src);\r\n        if (format.style)     site2[nickname].format_thread_style(src);\r\n                              site2[nickname].format_thread_always(src);\r\n    }\r\n        if (pref[embed_mode].localtime) site2[nickname].localtime(src);\r\n    //        if (pref.catalog.filter.time_mark) site2[nickname].mark_newer_posts(src,date);\r\n  }\r\n}\r\n      }\r\n      function trim_html_mark_time(src,nickname,format, name){\r\n        var date = get_mark_time(name, pref[embed_mode].mark_new_posts, pref[embed_mode].mark_new_posts, pref[embed_mode].mark_new_posts);\r\n        if (date>0) site2[nickname].mark_newer_posts(src,date);\r\n        if (pref[embed_mode].format.thumb.resize) site2[nickname].format_remove_tn_area_size(src);\r\n      }\r\n////////      function insert_thread_from_page(src, nickname, boardname, op_no, page_no, nof_posts, nof_files, snoop, date_load){\r\n////////        var name = nickname + boardname + op_no;\r\n////////        if (snoop && !pref.catalog_promiscuous && !threads[name]) {\r\n////////          var hit = false;\r\n////////          for (var i=0;i<load_list.refresh.tgts.length;i++)\r\n////////            if (load_list.refresh.tgts[i][0].indexOf(nickname+boardname+'p'+page_no)!=-1 ||\r\n////////                load_list.refresh.tgts[i][0].indexOf(nickname+boardname+op_no)!=-1) {hit=true;break;}\r\n////////          if (!hit) return 0;\r\n////////        }\r\n////////        var date = site2[nickname].get_time_of_posts(src);\r\n////////        if (threads[name] && threads[name][13]<date_load) update_page_in_footer(name,page_no,date_load);\r\n////////        if (threads[name] && threads[name][8][0]>=date[0]) return 0;\r\n//////////console.log('In :'+name);\r\n////////        var url = site2[nickname].get_thread_link(src,boardname,pref.catalog_click!='expand',name);\r\n//////////        var date_mark = Date.parse(pref.catalog.filter.time_str) - pref.localtime_offset*3600000;\r\n//////////        console.log(name+', '+date);\r\n//////////        var src1 = document.createElement('div');\r\n//////////        src1.innerHTML = src.innerHTML;\r\n////////        var html_org = src.innerHTML;\r\n////////        var src2 = document.createElement('div');\r\n////////        src2.innerHTML = src.innerHTML;\r\n////////        var cross_domain = pref.catalog_board_list_obj[board_sel.selectedIndex][0]['domain']!=nickname;\r\n////////        var cross_board  = pref.catalog_board_list_obj[board_sel.selectedIndex][0]['board']!=boardname;\r\n////////        date = date.concat(site2[nickname].insert_footer(src,page_no,((cross_domain)? nickname : '')+((cross_board)? boardname : ''),pref.catalog_footer,date,nof_posts,nof_files));\r\n//////////        trim_html(src,  nickname, pref.catalog_format.show, date_mark);\r\n////////////        trim_html(src1, nickname, pref.catalog_format.hover, date_mark);\r\n//////////        trim_html(src2, nickname, pref.catalog_format.search, date_mark);\r\n////////        trim_html(src,  nickname, pref.catalog_format.show, name);\r\n////////        trim_html(src2, nickname, pref.catalog_format.search, name);\r\n////////        return insert_thread(src, nickname, page_no, date_load, name, html_org, date, src2, url, false, {board:boardname});\r\n////////      }\r\n      function image_resize1_onload() {\r\n        this.removeEventListener('load',common_func.image_resize1_onload,false);\r\n        common_func.image_resize(this, pref.catalog_size_tn1_width, pref.catalog_size_tn1_height);\r\n      }\r\n      function image_resize2_onload() {\r\n        this.removeEventListener('load',common_func.image_resize2_onload,false);\r\n        common_func.image_resize(this, pref.catalog_size_tn2_width, pref.catalog_size_tn2_height);\r\n      }\r\n//      function convert_html(name,th){\r\n//        if (!embed_catalog && pref.catalog.text_mode.mode==='text') {\r\n//          var text = document.createElement('span');\r\n//          text.innerHTML = ((pref.catalog.text_mode.sub  && threads[name][4][1][0])? '&emsp;' + threads[name][4][1][0] : '') +\r\n//                           ((pref.catalog.text_mode.name && threads[name][4][2][0])? '&emsp;' + threads[name][4][2][0] : '') +\r\n//                           ((pref.catalog.text_mode.com  && threads[name][4][0][0])? '&emsp;' + threads[name][4][0][0] : '');\r\n//          var footer_new = document.createElement('span');\r\n//          footer_new.innerHTML = th.footer.innerHTML; // make footer on demand.\r\n//          th.footer = footer_new;\r\n//          th.pn.innerHTML = '';\r\n//          th.pn.appendChild(th.footer);\r\n//          th.pn.appendChild(text);\r\n//          threads[name][18] = 'text';\r\n//        } else {\r\n//          th.pn.innerHTML = threads[name][25][1];\r\n//          th.footer = threads[name][25][0];\r\n//        }\r\n//      }\r\n\r\n////////\r\n//////// safe758\r\n////////              page                  catalog + thread\r\n//////// adoptNode    works with errors     works with errors\r\n//////// importNode   works with errors     works with errors\r\n//////// None         works with no errors  works with no errors\r\n////////\r\n//////// Memory leak was found with None (document leaks when I read KC's one), but I'll go with None.\r\n////////\r\n//      function insert_thread(src, nickname, page_no, date_load, name, html_org, src2, url, from_native, th, type){\r\n      function merge_deleted_posts(lth, posts, num, t2h){\r\n        return site2[lth.domain].update_posts_merge_prep(posts, lth.pd, (num===false)? posts.length-1 : (num===-1)? -1 : num, true); // don't have to consider num of deleted posts, it's a sync issue between thread and catalog. Unread deleted posts are in unread posts always.\r\n//        return site2[lth.domain].update_posts_merge_prep(posts, lth.pd, (num===false)? posts.length-1 : (num===-1)? -1 : num + ((t2h==='unread' || t2h==='N_unread')? lth.pd.length : 0), true); // patch; count of unread posts doesn't contain deleted posts.\r\n      }\r\n      var tgt_th16_proto = {\r\n        get no(){return this.dbt[2];},\r\n        get board(){return this.dbt[1];},\r\n        get domain(){return this.dbt[0];},\r\n        get key(){return this.dbt.join('');},\r\n        get nof_posts(){return liveTag.mems.getFromName(this.key).nof_posts;},\r\n        get nof_files(){return threads[this.key][8][3];},\r\n//        get time(){return this.posts[0].time || threads[name][8][1];},\r\n////        get sub(){return threads[this.key][4].sub;}, // this.posts && this.posts[0].sub;}, // for reentry in meguca\r\n////        get com(){return threads[this.key][4].com;}, // this.posts && this.posts[0].com;}, // for reentry in meguca\r\n////        get txt(){return threads[this.key][4].txt;}, // this.posts && this.posts[0].txt;}, // for reentry in meguca\r\n        get tags(){return liveTag.mems.getFromName(this.key);},\r\n        recent_posts: function(num, posts_in, remake){\r\n          if (num===undefined || num===null) num = this.get_t2h_num_of_posts();\r\n          var posts = posts_in;\r\n          if (num!==false && !remake) {\r\n            if (!pref.test_mode['113']) {\r\n              if (this.lth.ta) posts = site2[this.lth.domain].update_posts_replace_prep(null, this.lth.ta.posts, num); // cut // if (lth.ta) is required for merge/merge_list.\r\n            } else {\r\n              if (this.th && this.th.posts) posts = site2[this.lth.domain].update_posts_replace_prep(posts || this.th.posts, this.th.posts, num); // merge, posts===this.th.posts occurs also.\r\n//            var posts = this.th && this.th.posts;\r\n              if (this.posts && (num!=-1 || this.posts!==posts)) posts = site2[this.lth.domain].update_posts_replace_prep(posts || this.posts, this.posts, num); // merge // MUST CHANGE ADDRESS OF th.posts, 'th.posts===th_old.posts' is used 'insert_thread_format_html'\r\n            }\r\n          } \r\n          if (!posts_in) {\r\n            if (posts && this.lth.pd) posts = posts.filter(function(v){return !v.deleted_after;}); // posts may contain >num deleted posts.\r\n            if ((!posts || num<0 || posts.length<=num) && this.lth.ta) posts = site2[this.lth.domain].update_posts_replace_prep(posts || this.lth.ta.posts, this.lth.ta.posts, num);\r\n            if (!posts) posts = [this.op];\r\n          }\r\n//          var posts = this.th && this.th.posts || this.lth.ta && this.lth.ta.posts && site2[this.lth.domain].update_posts_replace_prep(this.posts || this.lth.ta.posts, this.lth.ta.posts, num) || this.posts;\r\n          return (!pref.test_mode['64'] && pref[embed_mode].deleted_posts.merge && this.lth.pd)? merge_deleted_posts(this.lth, posts, num, pref[embed_mode].t2h_sel) : posts;\r\n        },\r\n        get_t2h_num_of_posts: function(){\r\n          var t2h_sel = this.t2h_sel || pref[embed_mode].t2h_sel;\r\n          return (t2h_sel==='page')? this.t2h_page || pref[embed_mode].t2h_num_of_posts\r\n            : (t2h_sel==='L')? pref[embed_mode].t2h_L\r\n            : (t2h_sel==='M')? pref[embed_mode].t2h_M\r\n            : (t2h_sel==='N')? pref[embed_mode].t2h_num_of_posts\r\n            : (t2h_sel==='N_unread')? pref[embed_mode].t2h_num_of_posts + this.lth.nr\r\n            : (t2h_sel==='unread')? (this.lth.watched? this.lth.nr : this.t2h_page || pref[embed_mode].t2h_num_of_posts)\r\n            : (t2h_sel==='no')? 0 : -1; // 'ALL' // and 'ALL_agg'\r\n        },\r\n        expand_num: function(){\r\n          var num = this.get_t2h_num_of_posts()+1;\r\n          var nof_posts = this.nof_posts;\r\n          return (num==0 || num>nof_posts)? nof_posts : num;\r\n        },\r\n        expand: function(idx){\r\n          this.t2h_sel = format_html.get_t2h_from_index(idx);\r\n          var num = this.expand_num();\r\n          var posts = this.recent_posts();\r\n          if (posts.length < num) {\r\n            this.expand_posts = true;\r\n            scan.scan_ui('expand_page', {tgts:[this.key], options:{refresh:true}});\r\n          } else {\r\n            var th = {posts:posts, __proto__:threads[this.key][7]};\r\n            site2[posts[0].domain_html].page_json2html3_add_omitted_info(th, this.posts, th.posts);\r\n            insert_thread_prepare_html_lazy(threads[this.key], false, false, null, th);\r\n            cataLog.show_catalog();\r\n          }\r\n        },\r\n      };\r\n      function insert_thread(th, date_load, picked_up_by_kwd_filter, insert_thread_from_native){\r\n        var date_load = date_load;\r\n        var name = th.key;\r\nif (!pref.test_mode['28']) {\r\n        if (site2[th.domain].preprocess_doc && !insert_thread_from_native) site2[th.domain].preprocess_doc(th.pn);\r\n}\r\n//console.log('insert_thread: '+name+','+th.page+', '+th.nof_posts+', '+th.nof_files);\r\nif (pref.test_mode['26']) {\r\n//        if (!insert_thread_from_native && th.type_data==='html') document.adoptNode(th.pn);  // KC causes memory leak if I don't use adoptNode(). // causes error in page mixing.\r\n        if (!insert_thread_from_native && th.type_data==='html') th.pn = document.adoptNode(th.pn);\r\n}\r\nif (pref.test_mode['27']) {\r\n        if (!insert_thread_from_native && th.type_data==='html') th.pn = document.importNode(th.pn, true);\r\n}\r\n//        if (th.pn.parentNode) th.pn.parentNode.removeChild(th.pn); // redundant.\r\n////        if (site.nickname!==th.domain && th.type_data==='html') site2[th.domain].absolute_link(th);\r\n//////        if (site.nickname!==th.domain) site2[th.domain].absolute_link(th); // make th.pn implicitly.\r\n        var init_new = false;\r\n        var tgt_th = threads[name];\r\n        var date = [th.time_bumped, th.time_created, th.nof_posts, th.nof_files, th.time_posted];\r\n        if (tgt_th && tgt_th[16].needs_update) {\r\n          if (tgt_th[16].needs_update===true) {\r\n            if (tgt_th[7]) th.page = tgt_th[7].page;\r\n            gClg.remove_thread(name);\r\n            tgt_th = undefined;\r\n          } else delete tgt_th[16].needs_update;\r\n        }\r\n        var lth = th.lth;\r\n        if (tgt_th==undefined) {\r\nif (pref.test_mode['19']) { // stability test.\r\n          if (th.parse_funcs_html.th_init) th.parse_funcs_html.th_init(th); // BUG, should be moved into show_catalog() because threads aren't shown all the time and cause memory leak.\r\n}\r\n          init_new = true;\r\n          threads[name] = [(insert_thread_from_native)? th.pn : false, // lazy generation, null may be returned by DOM, so 'false' is used here.\r\n                           insert_thread_from_native && site.whereami!=='archive',\r\n                           (!pref.test_mode['127'])? null : (embed_mode==='page' || !pref.test_mode['110'])? [triage.thread_in, null] : [func_in, func_pop_up], // not used\r\n                           null,\r\n//                           [html_org || th.pn.innerHTML, nickname], // PATCHED. THIS WILL BE REMOVED.\r\n                           null, // not used // th.posts && th.posts.slice(0,1), // 4 // {sub:th.sub, com:th.com, name:th.name, trip:th.trip, filename:th.filename}\r\n//                           click_thread, // 5, click function.\r\n                           [], // 5, click source\r\n                           null,\r\n                           null, // (!pref.test_mode['49'])? th : undefined, // 7, th, // test\r\n                           date,\r\n                           [true,0,true,0], // filter result\r\n//                           (from_native)? click_thread_native : click_thread, null, url, date, true,\r\n                           null, // timestamp for posts search\r\n                           null, null, date_load, th.page, 0,\r\n//                           (from_native && brwsr.ff)? th.init_func : null, // 16\r\n//                           null, // 16, NOT USED\r\n                           { dbt: common_func.name2domainboardthread(name,true),\r\n//                             th_destroy: th.parse_funcs_html.th_destroy,\r\n                             parse_funcs: th.parse_funcs,\r\n                             systemSticky: th.sticky,\r\n                             type_html: th.type_html, // for insert_thread_from_native\r\n                             domain_html: th.domain_html,\r\n                             parse_funcs_html: th.parse_funcs_html,\r\n                             icon_sticky: null,\r\n                             icon_show_always: null,\r\n                             show_always: null,\r\n//                             op_img_src_url: null,\r\n                             th: th,\r\n//                             popups: null, posts:null,\r\n                             lth: lth, // th.lth,\r\n                             op: th.posts && th.posts[0], // required in recent_posts to produce search source if no posts are stored in catalog mode. 'th.posts &&' must be redundant, but I haven't checked consistency yet. \r\n                             __proto__: tgt_th16_proto\r\n                           }, // 16, others\r\n//                           ch[brwsr.innerText].match(tags_scan_regex), // 17, tag\r\n                           null, // 17, tag // NOT USED\r\n                           th.type_html, // 18, type of html\r\n                           null, // 19, tracking info\r\n//                           [0,0,0,0,null,false,-2, 0, true, [], 0], // debug\r\n                             // 19, time_of_checked, num_of_unread_replies_TO_ME, num_of_unread_replies,\r\n                             //     time_of_checked_time_internal, args_for_desktop_notification, init,\r\n                             //     time_of_checked_old, num_of_unread_old, inital_loop // for faster execution.\r\n                             //     tag_temp, num_of_checked_posts_so_far\r\n                           th.sticky, // 20 sticky.\r\n//                           (nickname==='8chan' && from_native && pref.catalog.order.find_sage_in_8chan), // 21, watch.\r\n                           false, // 21, watch.\r\n                           {}, // 22, attr info for rollback.\r\n                           null, // 23, for missing info\r\n                           null, // 24, footer.\r\n                           null, // 25, text_mode [0]: footer, [1]: html_backup\r\n//                           th.op_img_url, // 26 op_iamge_url\r\n                           ];\r\n          tgt_th = threads[name];\r\n//          if (name in threads_last_deleted) tgt_th[8][4] = threads_last_deleted[name].last_post_time;\r\n//          tgt_th[17] = liveTag.prep_tags(th);\r\n          tgt_th[19] = lth.wt; // liveTag.mems[th.domain][th.board][th.no].wt;\r\n          if (!(embed_mode==='catalog' && th.domain===site.nickname) &&\r\n              ((th.domain==='KC' && th.type_source==='catalog') // doesn't have time info\r\n              || th.posts[0].editing // th.domain==='meguca' // doesn't have op. FIXED in v3.\r\n              )) {\r\n            tgt_th[16].needs_update = true;\r\n            if (th.type_source==='catalog') scan.list_nup.add(th.key);\r\n          } else if (th.type_source==='archive') { // for 4chan archive\r\n            tgt_th[16].needs_update = true;\r\n            scan.list_nup.add_scan(th.key);\r\n          }\r\n////          if (th.parse_funcs.missing_info) { // working code.\r\n////            tgt_th[23] = common_func.shallow_copy_1(th.parse_funcs.missing_info);\r\n////            if (pref.network.fetch_actively) th.parse_funcs.missing_info_fetch(th);\r\n////          }\r\n\r\n////          if ((embed_mode==='page' || embed_mode==='thread') && th.nof_posts>1 && th.posts.length===1) {\r\n//////            cataLog.scan_init('refresh_inserted', [th.key], {refresh:true}); // DOESN'T WORK BECAUSE OF SO MANY REQUEST STOP PREVIOUS REQUESTS.\r\n////            catalog_liveTag_scan_ui('scan_ui', {tgts:[th.key], options:{refresh:true}});\r\n////          }\r\n//          if (!(tgt_th[19][0]&0x000c0000) && (tgt_th[19][0]&0x00010000) && tgt_th[19][2]===0) {\r\n//            var time_watch;\r\n//            if (date[4]||date[0]) time_watch = get_watch_time_of_a_thread(name,date[1],date[4]||date[0], true); // THIS MAY BE REDUNDANT, threads pass 'prep_tags' always.\r\n//            if (time_watch===0 && embed_mode==='thread' && pref.catalog.auto_watch) time_watch = (th.posts[th.posts.length-1].time || th.time);\r\n//            if (time_watch!==0) site2[th.domain].check_reply.set_watch_time(tgt_th[19], time_watch);\r\n//          }\r\n////          if (site2[site.nickname].historyAPI) { // for reentry\r\n////            tgt_th[16].tn_w = th.tn_w;\r\n////            tgt_th[16].tn_h = th.tn_h;\r\n////            tgt_th[16].op_img_url = th.op_img_url;\r\n////          }\r\n          if (pref.test_mode['115'] && pref.catalog.filter.auto_list.use) {\r\n            var pf = pref.catalog.filter;\r\n            if (!pref_func.merge_obj5_1(null,pf.list_obj2,th.key) && !pref_func.merge_obj5_1(null,pf.watch_list_obj2,th.key) && !pref_func.merge_obj5_1(null,pf.attr_list_obj2,th.key)) {\r\n              var auto_obj = pref_func.merge_obj5a(th,pref.catalog.filter.auto_list.obj7,null);\r\n              if (auto_obj) catalog_filter_query_keyword.auto_list(th, auto_obj);\r\n            }\r\n          }\r\n        }\r\n        if (th.parse_funcs.posts_full) th.parse_funcs.posts_full(th);\r\n        if (!date[0]) date[0] = tgt_th[8][0];\r\n        if (!date[4]) date[4] = (tgt_th[8][4]<date[0])? date[0] : (tgt_th[8][4])? tgt_th[8][4] : site2[th.domain].check_reply.get_checked_time(tgt_th[19]);\r\n        tgt_th[8] = date;\r\n//        if ((tgt_th[19][0]&0x00840000)===0x00800000 && (date[1]>0||date[4]>0)) { // moved to liveTag.prep_tags\r\n//          set_watch_time_thread(name, embed_mode, date[1],date[4], th, tgt_th[19]); // for meguca or those don't have time at first.\r\n////          if ((tgt_th[19][0]&0x00840000)!==0x00800000) scan.list_nup.add_scan(th.key); // patched by trim_list:'force_init'\r\n////            if (th.type_source==='thread') scan.list_nup.add_scan(th.key);\r\n////            else scan.list_nup.add_board(th.domain+th.board);\r\n//        }\r\n\r\n////        if (tgt_th[16].posts && tgt_th[16].posts.length===1 && (tgt_th[16].parse_funcs.missing_info > (th.parse_funcs.missing_info || -1))) { // PATCH\r\n////          th.posts[0].pn = tgt_th[16].posts[0].pn;\r\n////          tgt_th[16].posts = th.posts; // this cause inconsistency between posts shown and posts stored.\r\n////          tgt_th[16].parse_funcs = th.parse_funcs;\r\n////          tgt_th[16].parse_funcs_html = th.parse_funcs_html;\r\n////          format_html.prepare_html_prep_posts(th);\r\n////        }\r\n        \r\n//        var flag_posts_stored = embed_mode==='catalog' && pref[embed_mode].t2h_sel==='no' && th.parse_funcs.has_posts && pref.catalog.filter.kwd.posts_active && \r\n//          th.posts && // patch for 4chan catalog.\r\n//          (pref[embed_mode].popup2==='sr' || (pref[embed_mode].popup2==='srpv' && catalog_filter_query_keyword.kwd(pref.catalog.filter.kwd, th.posts, th.domain, th))); // for simple search with scan.\r\n//        if (flag_posts_stored) {\r\n//          th.posts = catalog_filter_query_keyword.kwd_make_result(th.posts, th.domain, th);\r\n//          if (th.posts) {\r\n//            th.posts[0].__proto__.search_result = th.posts[0].search_result; // patch. see 'catalog_filter_query_keyword.kwd_make_result'\r\n//            th.posts[0] = th.posts[0].__proto__;\r\n//          }\r\n//        }\r\n\r\n//        tgt_th[9] = (picked_up_by_kwd_filter)? [true] : catalog_filter_query(name); // moved to later to apply t2h_num_of_posts\r\n//        if (insert_thread_from_native) threads[name][16].posts = th.posts; // for reentry // BUG, html update exist in embed_thread.\r\n        if (insert_thread_from_native) threads[name][16].posts = insert_thread_from_native.posts_shown;\r\n//        if (init_new && tgt_th[0]) threads[name][16].posts = th.posts;\r\n        if (th.type_source==='page' || th.domain==='4chan' && th.type_parse==='catalog_json') threads[name][16].t2h_page = th.posts.length-1;\r\n\r\n        if (tgt_th[16].expand_posts && (tgt_th[16].expand_num<=th.nof_posts || th.type_source==='thread')) tgt_th[16].expand_posts = false; // prevent infinite loop caused by !tgt_th[1]\r\n        var t2h_num_of_posts = (th.type_source!=='page' || (tgt_th[16].t2h_sel || pref[embed_mode].t2h_sel)!=='page')? tgt_th[16].get_t2h_num_of_posts() : false;\r\n        if (t2h_num_of_posts!==false) {\r\n          if (init_new && (t2h_num_of_posts<0 || t2h_num_of_posts+1>th.posts.length) && th.posts.length<th.nof_posts && embed_mode==='page') { // load to add\r\n//          if (init_new && (t2h_num_of_posts<0 || t2h_num_of_posts+1>th.posts.length) && th.posts.length<th.nof_posts) { // doesn't work for short links(last 50 posts)\r\n            tgt_th[16].expand_posts = true;\r\n            scan.list_nup.add_scan(th.key);\r\n//            catalog_liveTag_scan_ui('scan_ui', {tgts:[name], options:{refresh:true}});\r\n          }\r\n        }\r\n//        var lth = th.lth;\r\n        if (th.parse_funcs.has_posts) th.posts = tgt_th[16].recent_posts(t2h_num_of_posts, th.posts);\r\n//        if (th.parse_funcs.has_posts && (pref.test_mode['49'] || !flag_posts_stored)) th.posts = tgt_th[16].recent_posts(t2h_num_of_posts, th.posts);\r\n////        if (th.parse_funcs.has_posts && (pref.test_mode['49'] || !flag_posts_stored)) { // working code\r\n////          if (t2h_num_of_posts!==false) {\r\n////            if (tgt_th[16].th) th.posts = site2[th.domain].update_posts_replace_prep(th.posts, tgt_th[16].th.posts, t2h_num_of_posts); // merge\r\n////            if (tgt_th[16].posts) th.posts = site2[th.domain].update_posts_replace_prep(th.posts, tgt_th[16].posts, t2h_num_of_posts); // merge // MUST CHANGE ADDRESS OF th.posts, 'th.posts===th_old.posts' is used 'insert_thread_format_html'\r\n//////            if (embed_mode==='catalog' && th.posts.length<((t2h_num_of_posts>0)? t2h_num_of_posts : th.nof_posts) && lth.ta && lth.ta.posts.length>th.posts.length) th.posts = site2[th.domain].update_posts_replace_prep(th.posts, lth.ta.posts, t2h_num_of_posts); // merge, ONLY FOR FLAGS, CAN BE REMOVED AFTER CHANGING TO INCREMENTAL FLAGS.\r\n////            // CAUSE BUG??? may cayse mixing posts which should use different prototype, posts_html and posts_json.\r\n////          }\r\n////          if (!pref.test_mode['64'] && pref[embed_mode].deleted_posts.merge && lth.pd) th.posts = merge_deleted_posts(lth, th.posts, t2h_num_of_posts, pref[embed_mode].t2h_sel);\r\n//////            th.posts = site2[th.domain].update_posts_merge_prep(th.posts, th.lth.pd, \r\n//////              (t2h_num_of_posts===false)? th.posts.length-1 : t2h_num_of_posts + ((t2h_num_of_posts==='unread' || t2h_num_of_posts==='N_unread')? th.lth.pd.length : 0), true);\r\n////        }\r\n        if (!th.page && tgt_th[16].th) th.page = tgt_th[16].th.page;\r\n        if (!init_new && th.parse_funcs.has_posts) tgt_th[16].th = th;\r\n        if ((!pref.test_mode['49'] && pref[embed_mode].t2h_sel!=='no' || site2[site.nickname].historyAPI) && (!tgt_th[7] || th.parse_funcs.has_posts)) tgt_th[7] = th; // patch for reentry\r\n//        if (!pref.test_mode['49'] && pref[embed_mode].t2h_sel!=='no') tgt_th[7] = th;\r\n        if (pref[embed_mode].t2h_sel==='no') th.posts = th.posts.slice(0,1); // don't change th.posts itself, some other catalog may grep that.\r\n        lth.th = th;\r\n//        if (!pref.test_mode['49'] && th.parse_funcs.has_posts && pref.catalog.filter.kwd.posts_active && !flag_posts_stored) tgt_th[7] = th; // BUG at catalog.\r\n        tgt_th[9][2] = null;\r\n//        tgt_th[9] = (pref.filter.disable_list_when_kwd_active && picked_up_by_kwd_filter)? [true] : catalog_filter_query(name);\r\n        tgt_th[9] = catalog_filter_query(name, true); // slightly redundant.\r\n\r\n        catalog_attr_set(th.key,tgt_th[0]); // for cmd '!show'.\r\n        if (insert_thread_from_native || (tgt_th[16].expand_posts && tgt_th[1] && !pref.catalog.filter.kwd.posts_active) || pref.test_mode['36']) insert_thread_prepare_html_lazy(tgt_th, init_new, insert_thread_from_native, null, th);\r\n////        else {\r\n////          var th_old = tgt_th[16].th;\r\n////          if (th_old.posts.length<=1 || th.posts.length>1 && th.posts[th.posts.length-1].no > th_old.posts[th_old.posts.length-1].no) tgt_th[16].th = th;\r\n////          else if (th.page) th_old.page = th.page;\r\n////          catalog_attr_set(th.key,tgt_th[0]); // for 'show'.\r\n////        }\r\n\r\n        if (th.domain==='meguca') {\r\n//        if (th.domain==='meguca' && tgt_th[16].needs_update!==true) {\r\n          if (lth.ed_t) {\r\n            lth.ed_u = th.replyTime; // meguca don't update JSON while editing.\r\n//          var ed_p = lth.ed_p || lth.ed_t; // share lth.ed_t when pref.liveTag.from==='post'\r\n//          if (ed_p) {\r\n//            var i=0;\r\n//            while (i<ed_p.length && typeof(ed_p[i])==='string') i++;\r\n//            lth.ed_u = (!th.posts[1] || th.posts[1].no<=ed_p[i])? -1 : th.replyTime; // -1 for force update when editing posts are in scope. // 0 can't be used, because lth.ed_u becomes falsy.\r\n          } else if (lth.ed_u) lth.ed_u = undefined; // null can't be used because (null<123) is true.\r\n//          if (ed_p || tgt_th[16].needs_update<th.replyTime || tgt_th[16].needs_update===null)\r\n//            tgt_th[16].needs_update = (ed_p && !(th.posts[1] && th.posts[1].no<=ed_p[ed_p.length-1]))? null : th.replyTime; // null means 'in scope and force update'.\r\n//        if (th.domain==='meguca' && tgt_th[16].needs_update!==true) tgt_th[16].needs_update = th.lastUpdated || ((th.lth.ed_p)? null : undefined); // lastUpdated may be undefined.\r\n//        if (th.parse_funcs.has_editing && tgt_th[16].needs_update!==true) tgt_th[16].needs_update = (th.lth.ed_p)? 1 : null;\r\n        }\r\n        if (pref.test_mode['114'] && Clg.prototype.Clgs.length>=2) clone_thread(Clg.prototype.Clgs[1],name);\r\n        return threads_index.idx_reorder(name);\r\n      }\r\n      function set_watch_time_thread(name, embed_mode, time_created, time_posted, th, watch){\r\n        var time_watch = get_watch_time_of_a_thread(name,time_created,time_posted, true);\r\n        if (time_watch>0) site2['DEFAULT'].check_reply.set_watch_time(watch, time_watch, name);\r\n        else if (time_watch===0 && embed_mode==='thread' && pref.catalog.auto_watch) site2['DEFAULT'].check_reply.set_watched_to_last(watch, time_posted || time_created, name);\r\n        else site2['DEFAULT'].check_reply.set_unwatch(watch);\r\n      }\r\n//      function set_watch_time_thread(name, embed_mode, time_created, time_posted, th, tgt_th19){\r\n//        var time_watch = get_watch_time_of_a_thread(name,time_created,time_posted, true);\r\n//        if (time_watch===0 && embed_mode==='thread' && pref.catalog.auto_watch) time_watch = (th.posts[th.posts.length-1].time || th.time);\r\n//        site2[th.domain].check_reply.set_watch_time(tgt_th19, time_watch);\r\n//      }\r\n      cataLog.set_watch_time_thread = set_watch_time_thread;\r\n\r\n      function insert_thread_prepare_html_lazy(tgt_th, init_new, insert_thread_from_native, from_lazy, th){\r\n        var th = tgt_th[16].th || th;\r\n        site2[th.domain].wrap_to_parse.posts(th); // don't need extraction, or KC needs it???\r\n//        format_html.prepare_html_prep_posts(th); // wrap always for popup2, including \"embed_mode==='catalog'\".\r\n        if (init_new || (embed_mode==='page' || embed_mode==='thread')) format_html.prepare_html(th, init_new);\r\n\r\n        if (init_new) insert_thread_format_th_pn(tgt_th, init_new, insert_thread_from_native, from_lazy, th);\r\n//          convert_html(name,th);\r\n//          threads[name][25] = [threads[name][24][0], threads[name][0].innerHTML, threads[name][18]];\r\n////////          insert_footer3(name,th.flags,th.page,threads[name][17]);\r\n        if (tgt_th[0]) insert_thread_format_html(th,th.key,init_new,insert_thread_from_native);\r\nif (pref.test_mode['124']) { // must be redundant, but not debugged, so this is left as test code for a while.\r\n        if (embed_mode==='catalog' && th.parse_funcs.has_posts) {\r\n          var lth = th.lth;\r\n          if (lth.ta && lth.ta.posts.length<th.posts) tgt_th[16].posts = th.posts; // patch for 4chan.\r\n          else if (tgt_th[16].posts) tgt_th[16].posts = null;\r\n        }\r\n}\r\n        tgt_th[16].th = null;\r\n      }\r\n      function insert_thread_format_th_pn(tgt_th, init_new, insert_thread_from_native, from_lazy, th){\r\n        if (init_new) {\r\n//          tgt_th[16].op_img_src_url = (th.parse_funcs.get_op_src)? th.parse_funcs.get_op_src(th) : th.op_img_url;\r\n          var ch = tgt_th[0];\r\n          tgt_th[3] = [ch.innerHTML, th.domain]; // PATCHED. THIS WILL BE REMOVED.\r\n          ch.name = th.key; // ch.setAttribute('name',name); // for native html // obsolete\r\n          gGEH.pns_all_keys.set(ch,th.key);\r\n          if (embed_mode==='float' || (th.domain!==site.nickname && !pref.catalog.mimic_base_site)) {\r\n            ch.style.width  = ((pref.catalog.text_mode.mode==='text')? pref.catalog_size_text_width  : pref.catalog_size_width ) + 'px';\r\n            ch.style.height = ((pref.catalog.text_mode.mode==='text')? pref.catalog_size_text_height : pref.catalog_size_height) + 'px';\r\n            ch.style.float = 'left';\r\n            ch.style.overflow = 'hidden';\r\n//            ch.style.background = '#e5ecf9';\r\n          }\r\n          if (!ch.style) ch['style'] = {};\r\n\r\n          if (pref.test_mode['127']) tgt_th[0].addEventListener('mouseover', tgt_th[2][0], false);\r\n\r\nif (pref.test_mode['104']) {\r\n          common_func.dom_addEventListener(tgt_th[5], th.pn, 'click', click_thread_whole);\r\n          common_func.dom_addAttribute(th.pn, 'class', pref.script_prefix+'_thread');\r\n          var tn_as = th.parse_funcs_html.tn_as(th);\r\n          if (embed_mode!=='page' && embed_mode!=='thread') for (var i=0;i<tn_as.length;i++) {\r\n            tn_as[i].onclick = click_thread_tn; // preventDefault is in this event handler.\r\n            common_func.dom_addAttribute(tn_as[i], 'class', pref.script_prefix+'_thumbnail');\r\n          }\r\n}\r\n          var tn_imgs = th.parse_funcs_html.tn_imgs(th);\r\n          if (pref[embed_mode].format.thumb.resize) // BUG, should be moved into show_catalog() because threads aren't shown all the time and cause memory leak.\r\n            for (var i=0;i<tn_imgs.length;i++) tn_imgs[i].addEventListener('load',(i==0)?image_resize1_onload : image_resize2_onload, false);\r\n\r\n//          if (tgt_th[20]===true) tgt_th[16].icon_sticky = (insert_thread_from_native)? site2[th.domain_html].get_icon(tgt_th[0],th.type_html, 'sticky', tgt_th[16]) :\r\n//                                                                                       site2[th.domain_html].add_icon(tgt_th[0],th.type_html, 'sticky', tgt_th[16]); // first time only.\r\n          catalog_attr_set(th.key,tgt_th[0]);\r\n  \r\n          if (embed_mode==='float' && pref.catalog.text_mode.mode==='text') { // place after th.op_img_url. // NEED TO MODIFY REMOVE_THREAD TO PREVENT MEMORY LEAK.\r\n            var text = document.createElement('span');\r\n            text.innerHTML = ((pref.catalog.text_mode.sub && th.sub)? '&emsp;' + th.sub : '') +\r\n                             ((pref.catalog.text_mode.name && th.name)? '&emsp;' + th.name : '') +\r\n                             ((pref.catalog.text_mode.com && th.com)? '&emsp;' + th.com : '');\r\n            var footer = th.footer; // make footer on demand.\r\n            var footer_new = document.createElement('span');\r\n            footer_new.innerHTML = footer.innerHTML;\r\n            th.footer = footer_new;\r\n            th.pn.innerHTML = '';\r\n            th.pn.appendChild(th.footer);\r\n            th.pn.appendChild(text);\r\n            tgt_th[18] = 'text';\r\n          }\r\n          tgt_th[24] = Footer.prep_footer3(th, tgt_th[24]); // for reentry in meguca.\r\n//          if (from_lazy) insert_footer3(th.key, null, th.page, th.tags, th); // consolidated into show_catalog\r\n        }\r\n      }\r\n\r\n      function insert_thread_format_html(th,name,init_new,insert_thread_from_native, force_prep_html){\r\n//        if (force_prep_html) format_html.prepare_html(th); // for json\r\n        site2['DEFAULT'].check_reply.set_own_posts(th);\r\n        var posts_used;\r\n//        if (th.type_source==='page') threads[name][16].t2h_page = th.posts.length-1;\r\n        var init_or_refresh = init_new || insert_thread_from_native && site.nickname==='meguca'; // for reentry // TEMPORAL PATCH!!!\r\n        if (init_or_refresh) {\r\n//        if (init_new || insert_thread_from_native && site.nickname==='meguca') { // for reentry // TEMPORAL PATCH!!!\r\n//        if (init_new || insert_thread_from_native) { // for reentry // BUG, html update mode exist in embed_thread.\r\n//        if (init_new) {\r\n          if (th.type_html==='page' || th.type_html==='thread') {\r\n            var links = th.parse_funcs_html.get_thread_links(th.pn? th : {pn:threads[name][0], __proto__:th}); // for reentry. // THIS MUST BE HERE BEFORE update_posts_in_page, OP is also removed from th.pn at merge mode.\r\n//            var links = th.parse_funcs_html.get_thread_links(th); // THIS MUST BE HERE BEFORE update_posts_in_page, OP is also removed from th.pn at merge mode.\r\n            if (links) for (var i=0;i<links.length;i++) links[i].onclick = click_link;\r\n          }\r\n        }\r\n// working code, but BUG. this makes 'threads[name][16].posts === th.posts' BEFORE merging th.posts which contains deleted posts in 'embed_mode==='thread', so no merge will occur.\r\n// But I remember I had troubled here..., safe1309-1308.\r\n        if (embed_mode==='page' || embed_mode=='thread') {\r\n          posts_used = format_html.update_posts_in_page(th,name, init_or_refresh, insert_thread_from_native);\r\n          if (pref[embed_mode].popup && th.type_html!=='catalog') site2[th.domain].popups_add(threads[name][16].posts, th, insert_thread_from_native && pref[embed_mode].env.popup_native && !pref[embed_mode].env.event_dynamic, insert_thread_from_native, !pref.catalog.filter.kwd.posts_active);\r\n        } else if (pref.test_mode['124']) if (init_or_refresh) {\r\n          threads[name][16].posts = th.posts;\r\n          posts_used = th.posts;\r\n        }\r\n        if (!init_or_refresh) if (th.type_source!=='catalog' && embed_mode==='float') threads[name][3][0] = (th.pn)? th.pn.innerHTML : null; // PATCHED TEMPORARILY, this will be deleted.\r\n//        if (init_or_refresh) {\r\n//          if (embed_mode==='page' || embed_mode=='thread') posts_used = format_html.update_posts_in_page(th,name, true, insert_thread_from_native); // threads[name][16].posts!==th.posts is moved into 'update_posts_in_page'\r\n//          else {\r\n//            threads[name][16].posts = th.posts;\r\n//            posts_used = th.posts;\r\n//          }\r\n//////          if (embed_mode==='page' || embed_mode==='thread') {\r\n////          if (embed_mode==='page' && threads[name][16].posts && threads[name][16].posts!==th.posts) format_html.update_posts_in_page(th,name,null, true);\r\n////          else threads[name][16].posts = th.posts;\r\n////          if ((embed_mode==='page' || embed_mode==='thread') && !pref.test_mode['64'] && pref[embed_mode].deleted_posts.merge && th.lth.pd) format_html.update_posts_in_page(th,name,null, true);\r\n\r\n//          if (insert_thread_from_native && embed_mode==='page' && pref[embed_mode].use_expander_always) site2[th.domain_html].page_json2html3_replace_expander(th.posts, format_html.get_t2h_index(threads[name]), name);\r\n//          if (th.type_html==='page' || th.type_html==='thread') {\r\n////            var links = th.parse_funcs_html.get_thread_links(th);\r\n////            if (links) for (var i=0;i<links.length;i++) links[i].onclick = click_link;\r\n////            if (th.parse_funcs.time_unit!==1) { // BUG!!! REFER 'update_posts_1'\r\n////              var tu = th.parse_funcs.time_unit;\r\n////              for (var i=0;i<th.posts.length;i++) th.posts[i].time *= th.parse_funcs.time_unit;\r\n////            }\r\n//            var pref_env = (!insert_thread_from_native)? pref[embed_mode] :\r\n//                                                         {\r\n//                                                           colorID: pref[embed_mode].colorID && !pref[embed_mode].env.colorID_native,\r\n//                                                           backlink: pref[embed_mode].backlink && !pref[embed_mode].env.backlink_native, // do nothing because all posts don't have post.backlinks because this is before calling 'popups_add'.\r\n//                                                           localtime: pref[embed_mode].localtime && !pref[embed_mode].env.localtime_native,\r\n//                                                         };\r\n//            for (var i=0;i<th.posts.length;i++) format_html.prepare_html_post(th, th.posts[i], th.tags.q, pref_env);\r\n////            for (var i=0;i<th.posts.length;i++) site2[th.domain_html].format_pn(th.posts[i].pn, th.tags.q && th.tags.q[th.posts[i].no], pref_env, th.posts[i]);\r\n//          }\r\n//        } else {\r\n//          if (th.domain==='KC' && embed_mode==='page' && pref[embed_mode].use_expander_always) site2[th.domain_html].page_json2html3_replace_expander(th.posts, format_html.get_t2h_index(threads[name]), name); // test patch for KC, I don't know why but other than KC generates ERROR.\r\n//          if (embed_mode==='page' || embed_mode==='thread') if (th.parse_funcs.has_posts) posts_used = format_html.update_posts_in_page(th,name, null, insert_thread_from_native);\r\n//          if (th.type_source!=='catalog' && embed_mode==='float') threads[name][3][0] = (th.pn)? th.pn.innerHTML : null; // PATCHED TEMPORARILY, this will be deleted.\r\n//        }\r\n////        if (embed_mode==='page' && th.posts && th.posts[0].search_result!==undefined && threads[name][16].posts) site2[th.domain_html].update_posts0_class(threads[name][16].posts[0].pn, th.posts[0].search_result); // place here, because sometimes filter is given at initial, and that is 'init_new===true' // patch for 4chan catalog. moved to 'format_pn'\r\n////        if (th.posts && th.posts[0].search_result!==undefined && threads[name][16].posts) site2[th.domain_html].update_posts0_class(threads[name][16].posts[0].pn, th.posts[0].search_result); // place here, because sometimes filter is given at initial, and that is 'init_new===true'\r\n\r\nif (pref.test_mode['124']) { // must be redundant, but not debugged, so this is left as test code for a while.\r\n        var idx_new_post = (init_new)? 0 : 1;\r\n        if (embed_mode=='page' && th.type_data==='json') { // TEMPORAL PATCH\r\n          th.domain_html = site.nickname;\r\n          th.parse_funcs_html = site2[th.domain_html].parse_funcs.page_html;\r\n          for (var i=idx_new_post;i<th.posts.length;i++) if (!th.posts[i].pn) th.posts[i].pn = site2[th.domain_html].post_json2html(th.posts[i],th.board);\r\n          for (var i=idx_new_post;i<th.posts.length;i++) th.posts[i].tn_imgs = th.parse_funcs_html.tn_imgs(th.posts[i]);\r\n          posts_used = th.posts.slice(idx_new_post);\r\n        }\r\n}\r\n////        insert_thread_format_html_add_events(th, posts_used, insert_thread_from_native);\r\n//        if ((embed_mode==='page' || embed_mode==='thread') && pref[embed_mode].popup && th.type_html!=='catalog') site2[th.domain].popups_add(threads[name][16], th, insert_thread_from_native && pref[embed_mode].env.popup_native && !pref[embed_mode].env.event_dynamic, insert_thread_from_native);\r\n////        if (pref.catalog.filter.kwd.post && th.posts) threads[name][4] = th.posts;\r\n////        threads[name][9] = catalog_filter_query(name);\r\n////if (pref.test_mode['5']) {\r\n////        if (init_new && th.type_html!='catalog' && (type==='thread_html' || type==='page_html')) { // modify HTML at end because of DYNAMIC PARSE.\r\n//////          trim_html(threads[name][0], th.domain, pref[embed_mode].format.show, th.key);\r\n////          if (pref[embed_mode].localtime) site2[nickname].localtime(th.pn); // PATCH\r\n////        }\r\n////}\r\n        if (pref[embed_mode].hide_posts_without_images) format_html.hide_posts_without_images(th,name);\r\n        if (embed_mode!=='catalog') format_html.update_draw(name, threads[name][16].posts);\r\n        insert_thread_format_html_add_events(th, posts_used, insert_thread_from_native);\r\n      }\r\n      function insert_thread_format_html_add_events(th, posts_used, insert_thread_from_native){\r\n        if (posts_used && (embed_mode==='page' || embed_mode==='thread')) {\r\n          var add_event = !pref[embed_mode].env.expand_thumbnail_inline_native || !insert_thread_from_native || (pref[embed_mode].expand_thumbnail_inline_all_after && pref[embed_mode].env.event_dynamic);\r\n          var expand_now = pref[embed_mode].expand_thumbnail_initial;\r\n          var expand_on_demand = pref[embed_mode].thumbnail.inline.ondemand;\r\n          if (add_event || expand_now || !pref.test_mode['104'])\r\n            for (var j=0;j<posts_used.length;j++) {\r\n              var tn_imgs = th.parse_funcs_html.tn_imgs(posts_used[j]);\r\n              if (tn_imgs) for (var i=0;i<tn_imgs.length;i++) {\r\n                if (pref.test_mode['104']) tn_imgs[i].onclick = DIH.expand_thumbnail_inline;\r\n                else if (!add_event && !(pref[embed_mode].env.event_dynamic && th.domain===site.nickname)) GEH.prototype.blacklist_click.add(tn_imgs[i]);\r\n//                tn_imgs[i].onclick = (add_event)? expand_thumbnail_inline : expand_thumbnail_on_demand_set; // REDUNDANT???\r\n                if (expand_now) {\r\n                  if (expand_on_demand) {\r\n                    DIH.expand_thumbnail_queue_add(tn_imgs[i]);\r\n                    expand_now = false;\r\n                  } else DIH.expand_thumbnail_inline.call(tn_imgs[i], null, true);\r\n                }\r\n              }\r\n            }\r\n        }\r\n//        if (pref.test_mode['103']) if (posts_used && ((embed_mode==='catalog' && init_new) || (embed_mode==='page' || embed_mode==='thread')))  // working code, but static.\r\n//          if (pref[embed_mode].image_prefetch || (pref[embed_mode].image_hover && (!pref[embed_mode].env.image_hover_native || !insert_thread_from_native)))\r\n//            if (th.parse_funcs.has_posts && (embed_mode==='page' || embed_mode==='thread')) {\r\n//              for (var j=0;j<posts_used.length;j++) {\r\n//                var tn_imgs = th.parse_funcs_html.tn_imgs(posts_used[j]);\r\n//                if (tn_imgs) for (var i=0;i<tn_imgs.length;i++) tn_imgs[i].onmouseover = image_hover_add;\r\n//              }\r\n//            } else if (init_new && !th.parse_funcs_html.dynamic_image_hover) {\r\n//              var tn_imgs = th.parse_funcs_html.tn_imgs(th);\r\n//              for (var i=0;i<tn_imgs.length;i++) tn_imgs[i].onmouseover = image_hover_add;\r\n//            }\r\n      }\r\n      var format_html = {\r\n        prepare_html_prep_posts: function(th){\r\n          site2[th.domain].wrap_to_parse.posts(th);\r\n//          if (th.parse_funcs.posts_full) th.parse_funcs.posts_full(th); // BUG, DOESN'T HIT FILTER BEFORE BEING SHOWN.\r\n          if (th.type_data==='html') this.prepare_html_extract_params(th); // extraction function assumes that it has all of properties, this must be after 'posts_full'.\r\n        },\r\n        prepare_html_extract_params: function(th){\r\n          if (!th.extracted) {\r\n            if (th.parse_funcs.filename) {\r\n              for (var i=0;i<th.posts.length;i++) if (th.posts[i].pn) th.posts[i].filename = th.parse_funcs.filename(th.posts[i]); // deleted posts may be merged.\r\n//              for (var i=0;i<th.posts.length;i++) th.posts[i].filename = th.parse_funcs.filename(th.posts[i]);\r\n              th.filename = th.parse_funcs.filename(th);\r\n            }\r\n            if (th.parse_funcs.prep_mimic) th.parse_funcs.prep_mimic(th);\r\n            th.extracted = true;\r\n          }\r\n        },\r\n        prepare_html: function(th, init_new){\r\n          var tgt_th = threads[th.key];\r\n//        if ((th.domain!==site.nickname || site.whereami+'_html'!=type) && pref.catalog.mimic_base_site && th.pn && site2[site.nickname].catalog_json2html3) { // for KC.\r\n//        if ((th.domain!==site.nickname || site.whereami!='catalog') && pref.catalog.mimic_base_site && th.pn && site2[site.nickname].catalog_json2html3) { // cause document leak in KC\r\n//          site2[th.domain].wrap_to_parse.posts(th);\r\n//          if (th.parse_funcs.posts_full) th.parse_funcs.posts_full(th);\r\n          var mimic = ((th.domain!==site.nickname || site.whereami+'_html'!==th.type_mimic) && pref.catalog.mimic_base_site);\r\n          var mimic_tgt = ((embed_mode==='page' || embed_mode==='thread') && site2[site.nickname].page_json2html3)? 'page' : 'catalog'; // temporal, remove '&& site2[site.nickname].page_json2html3' later.\r\n          if (pref.test_mode['92']) mimic_tgt = 'catalog'; // for 4chan-X catalog.\r\n//          if (init_new || !mimic)\r\n//            if (mimic_tgt==='page' && th.type_data==='html') this.prepare_html_extract_params(th); // for popup2, always wrapping is required.\r\n          if (mimic) {\r\n            if (init_new) {\r\n              var tmp_pn = (mimic_tgt==='page')? site2[site.nickname].page_json2html3(th,th.board,th.op_img_url, true) : // FIXED, BUT WHY THIS WAS 'false'??? <- probably patch for type_data==='html'\r\n                                                 site2[site.nickname].catalog_json2html3(th,th.board,th.op_img_url);\r\n              Object.defineProperty(th, 'pn', {value: tmp_pn, writable:true, enumerable:true, configurable:true});\r\n            }\r\n            th.type_html = mimic_tgt;\r\n            th.domain_html = site.nickname;\r\n            th.parse_funcs_html = site2[site.nickname].parse_funcs[th.type_html+'_html']; // overwrite.\r\n          } else if (th.type_data==='html') site2.common.remove_by_tagname(th.pn,'script');\r\n          if (init_new) {\r\n            if (tgt_th[0]===false) { // patch\r\n              tgt_th[0] = th.pn;\r\n              tgt_th[16].type_html = th.type_html;\r\n              tgt_th[16].domain_html = th.domain_html;\r\n              tgt_th[16].parse_funcs_html = th.parse_funcs_html;\r\n            }\r\n            Object.defineProperty(th, 'footer', {value: th.parse_funcs_html.footer(th), writable:true, enumerable:true, configurable:true});\r\n            this.prep_anchor_links(th.pn, th); // Files in op are out of posts[0].pn sometimes, so these must be called with 'th'.\r\n//            if (th.localArchive) if (!pref.test_mode['67']) archiver.url2file(th.localArchive, th); // merged to root html generator to prevent needless prefetch.\r\n//            if (th.parse_funcs.has_editing) for (var i=0;i<th.posts.length;i++) if (th.posts[i].editing)\r\n//              th.posts[i].pn.classList.add(pref.script_prefix+'_post_editing');\r\n//              th.posts[i].pn.style.background = '#cec952';\r\n          }\r\n//          else {\r\n//            var pfunc_pn = site2[th.domain_html].parse_funcs['post_json'].pn;\r\n//            for (var i=1;i<th.posts.length;i++) {\r\n//              if (!th.posts[i].pn) th.posts[i].pn = pfunc_pn(th.posts[i]);\r\n//              site2[th.domain].toplevel_anchor(th.posts[i], th.no);\r\n//              if (site.nickname!==th.domain) site2[th.domain].absolute_link(th.posts[i]);\r\n//              if (th.localArchive) if (!pref.test_mode['67']) archiver.url2file(th.localArchive, th.posts[i]);\r\n//              if (th.posts[i].editing) th.posts[i].pn.style.background = '#cec952';\r\n//            }\r\n//          }\r\n        },\r\n        prep_anchor_links: function(pn, th){\r\n          if (pref.test_mode['109'] || th.no!=site.no || th.board!=site.board || th.domain!=site.nickname) site2[th.domain].toplevel_anchor(pn, th);\r\n          if (site.nickname!==th.domain) site2[th.domain].absolute_link(pn);\r\n        },\r\n        prepare_html_post: function(th, post, thq, pref_env, not_anchor){\r\n          if (!post.pn) {\r\n            post.pn = site2[th.domain_html].parse_funcs['post_json'].pn(post);\r\n            if (!thq) thq = th.lth.q; // for expand old posts, to add backlinks.\r\n          }\r\n          if (!not_anchor) this.prep_anchor_links(post.pn, th);\r\n//          if (th.localArchive) if (!pref.test_mode['67']) archiver.url2file(th.localArchive, post); // merged to root html generator to prevent needless prefetch.\r\n          site2[th.domain_html].format_pn(post.pn, (thq)? thq[post.no] : null, pref_env, post, th);\r\n          if (post.editing) post.pn.classList.add(pref.script_prefix+'_post_editing');\r\n//          if (post.editing) post.pn.style.background = '#cec952';\r\n        },\r\n        get_t2h_from_index: function(idx){\r\n          return ['page','L','M','N','N_unread','unread','all'][idx];\r\n        },\r\n        get_t2h_index: function(tgt_th){\r\n          var t2h_sel = tgt_th[16].t2h_sel || pref[embed_mode].t2h_sel; \r\n          return (t2h_sel==='page')? 0 :\r\n                 (t2h_sel==='L')? 1 :\r\n                 (t2h_sel==='M')? 2 :\r\n                 (t2h_sel==='N')? 3 :\r\n                 (t2h_sel==='N_unread')? 4 :\r\n                 (t2h_sel==='unread')? 5 : 6;\r\n        },\r\n//        get_t2h_num_of_posts: function(tgt_th, type_source){ // moved to tgt_th[16].prototype\r\n//          var t2h_sel = tgt_th[16] && tgt_th[16].t2h_sel || pref[embed_mode].t2h_sel; \r\n//          if (t2h_sel!=='page' || type_source!=='page' || tgt_th[16].expand_posts) {\r\n//            return (t2h_sel==='page')? tgt_th[16].t2h_page || pref[embed_mode].t2h_num_of_posts :\r\n//                   (t2h_sel==='L')? pref[embed_mode].t2h_L :\r\n//                   (t2h_sel==='M')? pref[embed_mode].t2h_M :\r\n//                   (t2h_sel==='N')? pref[embed_mode].t2h_num_of_posts :\r\n//                   (t2h_sel==='N_unread')? pref[embed_mode].t2h_num_of_posts + ((tgt_th[19][0]&0x000c0000)? (tgt_th[19][1]&0x0000ffff) : 0) :\r\n//                   (t2h_sel==='unread')? ((tgt_th[19][0]&0x000c0000)? (tgt_th[19][1]&0x0000ffff) : tgt_th[16].t2h_page) :\r\n//                   (t2h_sel==='no')? 0 : -1; // 'ALL' and 'ALL_agg'\r\n//          } else return false;\r\n//        },\r\n        update_posts_in_page: function(th,name, init_new, insert_thread_from_native){\r\n//        update_posts_in_page: function(th,name, force_prep_html, remove){\r\n//          if (!th.parse_funcs.has_posts && !remove) return;\r\n//          if (force_prep_html) this.prepare_html(th); // for json\r\n          var tgt_th = threads[name];\r\n          var posts_used = [];\r\n////          var t2h_num_of_posts = this.get_t2h_num_of_posts(tgt_th, th.type_source);\r\n////          if (t2h_num_of_posts!==false) {\r\n//////            if (t2h_num_of_posts>=0 && th.posts.length > t2h_num_of_posts+1) th.posts.splice(1,th.posts.length - t2h_num_of_posts -1);\r\n////            if (t2h_num_of_posts>=0 && th.posts.length > t2h_num_of_posts+1)\r\n////              th.posts = th.posts.slice(0,1).concat(th.posts.slice(th.posts.length - t2h_num_of_posts)); // SLIGHTLY REDUNDANT, SHOULD BE CONSOLIDATED.\r\n////            else site2[th.domain].update_posts_replace_prep(th,tgt_th[16], t2h_num_of_posts);\r\n////            site2[th.domain].page_json2html3_add_omitted_info(th, th.posts, th.posts);\r\n////          }\r\n//          if (!pref.test_mode['64'] && pref[embed_mode].deleted_posts.merge && th.lth.pd) {\r\n//            th.posts_alive = th.posts;\r\n//            th.posts_full  = site2[th.domain].update_posts_merge_prep(th.posts, th.lth.pd, th.posts.length-1, true);\r\n//            th.posts = th.posts_full;\r\n////            tgt_th[16].posts = site2[th.domain].update_posts_merge_prep(tgt_th[16].posts, th.lth.pd, true);\r\n//            site2[th.domain_html].update_posts_replace(th,tgt_th[16],(pref[embed_mode].merge)? site2['DEFAULT'].update_posts_merge_base : tgt_th[0], pref[embed_mode].merge, tgt_th[1]);\r\n//          } else \r\n          var mb = site2['DEFAULT'].update_posts_merge_bases;\r\n          var merge_base_tgts = (init_new && (tgt_th[1] || !mb.initialized))? mb.base_tgts(th.key) : null;\r\n          var merge_base = (tgt_th[1] && merge_base_tgts)? mb.query((tgt_th[16].posts && tgt_th[16].posts!==th.posts)? {pn:tgt_th[0], __proto__:tgt_th[16]} : th, merge_base_tgts, true) : mb.bases[th.key]; // redundant but for saster execution, shall works correctly if this doesn't exist. (not debugged.)\r\n          if (merge_base_tgts && !tgt_th[1] && !mb.initialized) mb.setup_hook();\r\n//          var merge_base = (pref[embed_mode].merge && tgt_th[1])? site2['DEFAULT'].update_posts_merge_bases.query((tgt_th[16].posts && tgt_th[16].posts!==th.posts)? {pn:tgt_th[0], __proto__:tgt_th[16]} : th, 'ALL', true) : site2['DEFAULT'].update_posts_merge_bases.bases[th.key]; // redundant but for saster execution, shall works correctly if this doesn't exist. (not debugged.)\r\n//          if (init_new && merge_base && merge_base.pn!==th.pn) site2[th.domain_html].update_posts_merge_init(th, merge_base);\r\n\r\n          var pf = pref[embed_mode];\r\n          var pf_env = (!insert_thread_from_native)? pf\r\n              : {colorID: pf.colorID && !pf.env.colorID_native,\r\n                 backlink: pf.backlink && !pf.env.backlink_native,\r\n                 localtime: pf.localtime && !pf.env.localtime_native};\r\n          if (merge_base || tgt_th[16].posts && ((!insert_thread_from_native || insert_thread_from_native.init) && tgt_th[16].posts!==th.posts)) {\r\n//          if (!init_new || tgt_th[16].posts && tgt_th[16].posts!==th.posts) {\r\n            if (init_new) {\r\n              posts_used = th.posts.slice(); // patch for merging deleted posts at initial.\r\n              for (var i=0;i<th.posts.length;i++) format_html.prepare_html_post(th, th.posts[i], th.lth.q, pf_env, init_new);\r\n            }\r\n            site2[th.domain_html].update_posts_replace(th,tgt_th[16], tgt_th[0], merge_base, tgt_th[1], posts_used);\r\n//          site2[th.domain_html].update_posts_replace(th,tgt_th[16],(pref[embed_mode].merge)? site2['DEFAULT'].update_posts_merge_base : tgt_th[0], pref[embed_mode].merge, tgt_th[1], posts_used);\r\n//            if (tgt_th[16].expand_posts) tgt_th[16].expand_posts = null;\r\n          } else {\r\n            tgt_th[16].posts = th.posts;\r\n            posts_used = !insert_thread_from_native? th.posts : (insert_thread_from_native.init)? insert_thread_from_native.posts_shown : insert_thread_from_native.posts_updated;\r\n            for (var i=0;i<posts_used.length;i++) format_html.prepare_html_post(th, posts_used[i], th.lth.q, pf_env, init_new);\r\n          }\r\n          if (init_new && insert_thread_from_native && embed_mode==='page' && pref[embed_mode].use_expander_always) site2[th.domain_html].page_json2html3_replace_expander(th.posts, format_html.get_t2h_index(threads[name]), name);\r\n          return posts_used;\r\n        },\r\n        replace_posts_by_search: function(tgt_th){ // tgt_th[16].th may be set by updater.\r\n          var th = tgt_th[7];\r\n          if (pref.catalog.filter.kwd.posts_active) {\r\n            if (tgt_th[10]!=pref.catalog.filter.kwd.timestamp || tgt_th[16].th) { // existence of tgt_th[16].th means thread is updated.\r\n              tgt_th[10] = pref.catalog.filter.kwd.timestamp;\r\n              var th_new = catalog_filter_query_keyword.kwd_make_result(tgt_th[16].recent_posts(pref[embed_mode].sourceOfSP==='auto'? -1 : null), th.domain);\r\n//              var th_new = catalog_filter_query_keyword.kwd_make_result(th.posts, th.domain, th);\r\n              if (!th_new) {\r\n                tgt_th[9][0] = false;\r\n                tgt_th[16].th = null;\r\n              } else {\r\n                var flag = (!tgt_th[16].posts || tgt_th[16].posts.length!==th_new.length);\r\n                if (!flag) {\r\n                  var i=th_new.length-1;\r\n                  while (i>=0) {\r\n                    if (tgt_th[16].posts[i].no!==th_new[i].no) {flag=true; break;} // for no OP\r\n                    i--;\r\n                  }\r\n//                  if (!flag && tgt_th[16].posts && tgt_th[16].posts[0] && tgt_th[16].posts[0].pn && // BUG in page mode, tgt_th[16].posts[0].pn exists always even if flag==true.\r\n//                      (tgt_th[16].posts[0].pn.classList.contains('CatChan_search_miss')==th_new[0].search_result))\r\n//                    site2[th.domain_html].update_posts0_class(tgt_th[16].posts[0].pn,th_new[0].search_result);\r\n                }\r\n                if (tgt_th[16].posts && tgt_th[16].posts[0] && tgt_th[16].posts[0].pn &&\r\n                    (tgt_th[16].posts[0].pn.classList.contains('CatChan_search_miss')==th_new[0].search_result))\r\n                  site2[th.domain_html].update_posts0_class(tgt_th[16].posts[0].pn,th_new[0].search_result);\r\n                if (flag) {    \r\n                  format_html.prepare_html_prep_posts(th);\r\n                  tgt_th[16].th = {posts:th_new, __proto__:th};\r\n//                  tgt_th[10] = pref.catalog.filter.kwd.timestamp;\r\n                } else if (tgt_th[16].th) tgt_th[16].th = null;\r\n              }\r\n            }\r\n          } else if (tgt_th[10] || tgt_th[16].th){ // rollback\r\n            if (!tgt_th[16].th) tgt_th[16].th = {posts:tgt_th[16].recent_posts(null,null,true), __proto__:th};\r\n//            if (!tgt_th[16].th) tgt_th[16].th = scopy_th(th);\r\n            tgt_th[10] = false;\r\n          }\r\n          if (tgt_th[16].th && tgt_th[7]) // updated by this or updater.\r\n            if (tgt_th[16].posts===tgt_th[7].posts) tgt_th[7].posts = tgt_th[7].posts.slice(); // backup\r\n        },\r\n        posts_search_inactivated: function(){\r\n          for (var name in threads) {\r\n            var th = threads[name][7];\r\n            var tgt_th16 = threads[name][16];\r\n            if (tgt_th16.posts && tgt_th16.posts[0] && tgt_th16.posts[0].pn && tgt_th16.posts[0].pn.classList.contains('CatChan_search_miss')) {\r\n              site2[th.domain_html].update_posts0_class(tgt_th16.posts[0].pn,true);\r\n//              delete th.posts[0].search_result; // can't update omitted info in page mode.\r\n            }\r\n          }\r\n          pClg.drawn_idx = 0; // lazy filter.\r\n        },\r\n        hide_posts_without_images: function(th,name){\r\n          var posts = threads[name][16].posts;\r\n          for (var i=0;i<posts.length;i++) {\r\n            var tn_imgs = th.parse_funcs_html.tn_imgs(th.posts[i]); // for test\r\n            if (tn_imgs.length===0) posts[i].pn.style.display = 'none';\r\n          }\r\n        },\r\n        update_draw: function(name, posts) { // , pn, th){\r\n          if (pref[embed_mode].mark_new_posts && (threads[name][19][0]&0x000c0000)) {// draw only\r\n            var mark_time = get_mark_time(name,pref.catalog.filter.time_watch || pref.catalog.filter.time_watch_creation,true,true);\r\n            if (mark_time===0 && embed_mode==='thread') mark_time = site2['DEFAULT'].check_reply.get_checked_time(threads[name][19]);\r\n            if (mark_time>0) site2[threads[name][16].domain_html].mark_newer_posts2(posts, mark_time, embed_mode==='thread', true);\r\n          }\r\n        },\r\n        update: function(name){ // draw and ERASE.\r\n          var date = (pref[embed_mode].mark_new_posts && (threads[name][19][0]&0x000c0000))? get_mark_time(name, true, true, true) : 0;\r\n          if (date===0) date = Infinity; // to erase mark\r\n          if (threads[name][16].posts) site2[threads[name][16].domain_html].mark_newer_posts2(threads[name][16].posts, date, null, false);\r\n        },\r\n        time_filter_changed: function(){ // draw and ERASE.\r\n          if (embed_mode!=='catalog') for (var name in threads) this.update(name);\r\n        },\r\n      }\r\n      cataLog.format_html = format_html;\r\n\r\n      function get_watch_time_of_a_thread(name, time_created, time_posted, extra_format){\r\n        var ret_time = get_mark_time(name,pref.catalog.filter.time_watch || pref.catalog.filter.time_watch_creation,true,true, extra_format);\r\n        return (extra_format && ret_time<0)? -ret_time :\r\n               (time_posted && ret_time>time_posted)? 0 :\r\n               (!pref.catalog.filter.time_watch && pref.catalog.filter.time_watch_creation && ret_time>time_created)? 0 :\r\n               ret_time;\r\n      }\r\n      cataLog.get_watch_time_of_a_thread = get_watch_time_of_a_thread;\r\n\r\n      function func_in(e){pop_up_delay(e,this.name);triage.thread_in(e);}\r\n      function func_pop_up(e){pop_up_delay(e,this.name);}\r\n\r\n// Footer was here\r\n\r\n      function re_sort_thread(){\r\n        threads_index.idx_re_sort();\r\n      }\r\n      common_func.Object_defProps(Clg.prototype, (function(){ // threads_idx, threads_odl and drawn_idx must be separated.\r\n//        var threads_odl = {};\r\n//        var threads_odl_default = { '8': [0, undefined, undefined, undefined, undefined], // disable 'on demand mode' at indexing of 1,2,3\r\n        var threads_odl_default = { '8': [0, 0, 0, 0, 0],\r\n                                   '19': [0,0,0]};\r\n        function get_threads_odl_default(str){\r\n          var page = parseInt(str.substr(str.lastIndexOf('/')+2),10);\r\n          return (page===0)? {'8': [undefined, undefined, undefined, undefined, undefined], __proto__: threads_odl_default} : // force to top\r\n                             {'8': [-page, -page, -page, -page, -page], __proto__: threads_odl_default};  // force to last\r\n        }\r\n        var threads_odl,threads;\r\n        var start,end;\r\n        var kwd_odl = 'ODL:';\r\n        var check_funcs = {\r\n          reply_to_me: function(tgt_th){return (tgt_th[19][0]&0x000c0000) && (tgt_th[19][1]>>16)!=0;},\r\n          reply: function(tgt_th){return (tgt_th[19][0]&0x000c0000) && tgt_th[19][1]!=0;},\r\n          watch_first: function(tgt_th){return tgt_th[19][0]&0x000c0000;},\r\n          watch_last: function(tgt_th){return !(tgt_th[19][0]&0x000c0000);},\r\n          sticky_first: function(tgt_th){return tgt_th[20];},\r\n          sticky_last: function(tgt_th){return !tgt_th[20];},\r\n        }\r\n        function get_tgt_th(str){\r\n          return (str.indexOf(kwd_odl)===0)? (threads_odl[str] || get_threads_odl_default(str)) :\r\n                                             threads[str];\r\n        }\r\n        function check_sub(myself, check_func, idxs){\r\n          var ref = start;\r\n          while (ref<end && check_func(get_tgt_th(idxs[ref]))) ref++;\r\n          if (check_func(myself)) end = ref;\r\n          else start = ref;\r\n        }\r\n        var funcs_get_date = {\r\n          0: function(tgt_th8){return tgt_th8[0] || tgt_th8[4];},\r\n          4: function(tgt_th8){return tgt_th8[4] || tgt_th8[0];},\r\n          get 5(){var now = Footer.ts_refresh; return function(tgt_th8){return (now - tgt_th8[1])/tgt_th8[2];}}, // this allows minus value, which is caused by unprecise local clock.\r\n//          get 5(){var now = Date.now(); return function(tgt_th8){return (now - tgt_th8[1])/tgt_th8[2];}}, // this allows minus value, which is caused by unprecise local clock.\r\n          1: function(tgt_th8){return tgt_th8[1];},\r\n          2: function(tgt_th8){return tgt_th8[2];},\r\n          3: function(tgt_th8){return tgt_th8[3];},\r\n        }\r\n        function insert(name, clg){\r\n          var idxs = clg.idxs;\r\n          threads = clg.threads;\r\n          threads_odl = clg.threads_odl;\r\n          start = 0;\r\n          end = idxs.length;\r\n          var pf = clg.order;\r\n          var myself = get_tgt_th(name);\r\n          if (pf.sticky!=='dont_care') check_sub(myself, (pf.sticky==='last')? check_funcs.sticky_last : check_funcs.sticky_first, idxs);\r\n          if (pf.reply_to_me) check_sub(myself, check_funcs.reply_to_me, idxs);\r\n          if (pf.reply) check_sub(myself, check_funcs.reply, idxs);\r\n          if (pf.watch!=='dont_care') check_sub(myself, (pf.watch==='last')? check_funcs.watch_last : check_funcs.watch_first, idxs);\r\n          var get_date = funcs_get_date[pref.catalog.indexing%6];\r\n//          var indexing  = pref.catalog.indexing%6;\r\n//          var indexing2 = pref.catalog.indexing;\r\n//          var get_date = (indexing===0 || indexing===4)? function(tgt_th){return tgt_th[8][indexing] || tgt_th[8][(indexing===0)?4:0];} :\r\n//                         (indexing===5)?                 (function(){var now = Date.now(); return function(tgt_th){return (now - tgt_th[8][1])/tgt_th[8][2];}})() :\r\n//                                                         function(tgt_th){return tgt_th[8][indexing];};\r\n          var date = get_date(myself[8]);\r\n          var check_func = (pref.catalog.indexing>=5 && pref.catalog.indexing<11)? function(tgt_th){return date>=get_date(tgt_th[8]);} :\r\n                                                                                   function(tgt_th){return date<=get_date(tgt_th[8]);};\r\n          var ref = start;\r\n          while (ref<end && check_func(get_tgt_th(idxs[ref]))) ref++;\r\n  \r\n          if (ref==idxs.length) idxs[idxs.length] = name;\r\n          else idxs.splice(ref,0,name);\r\n  //        if (ref<=drawn_idx) drawn_idx = 0; // can't track by 'drawn_idx = ref; drawn_y = 0;'. drawn_xxx must be synchronized.\r\n          return ref;\r\n        }\r\n        return {\r\n          idx_raise_odl: function(th){\r\n            var i = this.idxs.indexOf(th.key);\r\n            if (i!=-1) {\r\n              var kwd_odldb = kwd_odl + th.domain + th.board;\r\n              while (++i<this.idxs.length) {\r\n                if (this.idxs[i].indexOf(kwd_odldb)===0) {\r\n                  this.threads_odl[this.idxs[i]] = {'8':[ (th.time_posted || th.time_bumped), th.time_created, th.nof_posts, th.nof_files, (th.time_bumped || th.time_posted) ],\r\n                                                 __proto__:threads_odl_default};\r\n                  insert(this.idxs.splice(i,1)[0], this);\r\n                  break;\r\n            }}}\r\n          },\r\n          idx_delete_odl: function(keys){\r\n            for (var i=0;i<keys.length;i++) delete this.threads_odl[kwd_odl+keys[i]];\r\n          },\r\n          idx_insert_odl: function(name){\r\n            delete this.threads_odl[kwd_odl+name];\r\n            this.idx_reorder(kwd_odl+name);\r\n          },\r\n//          clear: clear, // NEED TO BE IMPLEMENTED to clear 'threads_odl' to prevent memory from leaking.\r\n          idx_re_sort: function(){\r\n            var odls = this.idxs.filter(function(v){return v.substr(0,4)==='ODL:';});\r\n            this.idxs = [];\r\n            for (var i in this.threads) insert(i, this);\r\n            this.idxs = this.idxs.concat(odls);\r\n            this.drawn_idx = 0;\r\n            this.show_catalog();\r\n          },\r\n          idx_reorder: function(name){\r\n            var idx_old = this.idxs.indexOf(name);\r\n            if (idx_old!=-1) this.idxs.splice(idx_old,1);\r\n            var idx_new = insert(name, this);\r\n            if ((idx_new !== idx_old || this.mode==='page') && (idx_new < this.drawn_idx || idx_old < this.drawn_idx)) this.drawn_idx = 0;\r\n            else if (this.mode==='page' && this.drawn_idx===true) this.drawn_idx = 0;\r\n  //          else if (this.mode==='page' && this.drawn_idx===true) this.drawn_idx = idx_new; // BUG??? this doesn't track drawn_y and ref_count.\r\n  //          if (idx_new !== idx_old && (idx_new < this.drawn_idx || idx_old < this.drawn_idx)) this.drawn_idx = 0; // BUG. doesn't redraw if its size is changed.\r\n            return (idx_new !==idx_old || (this.threads[name] && this.threads[name][9][0]!=this.threads[name][1])); // returns need to redraw.\r\n          },\r\n        };\r\n      })());\r\n      var threads_index = pClg;\r\n      \r\n//      var threads_index = pref.test_mode['114']? pClg : (function(){ // threads_idx, threads_odl and drawn_idx must be separated. // working code.\r\n//        function re_sort(){\r\n//          var odl = [];\r\n//          for (var i=0;i<threads_idx.length;i++) if (threads_idx[i].substr(0,4)==='ODL:') odl[odl.length] = threads_idx[i];\r\n//          threads_idx=[];\r\n//          for (var i in threads) insert(i);\r\n//          for (var i=0;i<odl.length;i++) threads_idx[threads_idx.length] = odl[i];\r\n//          drawn_idx = 0;\r\n//          show_catalog();\r\n//        }\r\n////      function reorder_threads_idx(names){\r\n////        for (var i in names) reorder_thread_idx(i);\r\n////      }\r\n//////      function reorder_thread_idx(name, skip_check){ // working code.\r\n////////        for (var i=0;i<threads_idx.length;i++) if (threads_idx[i]==name) {threads_idx.splice(i,1);break;}\r\n////////        insert_thread_idx(name);\r\n//////        var i;\r\n//////        if (!skip_check) {\r\n//////          i = 0;\r\n//////          while (i<threads_idx.length && threads_idx[i]!==name) i++;\r\n//////          if (i<threads_idx.length) threads_idx.splice(i,1);\r\n//////        } else i = -1;\r\n//////        return (i!=insert_thread_idx(name) || (threads[name] && threads[name][9][0]!=threads[name][1])); // returns need to redraw.\r\n//////      }\r\n//\r\n//////      function raise_threads_idx_odl(db,key){ // works, but blocked by stikies.\r\n//////        var idx = threads_idx.indexOf(key);\r\n//////        if (idx!=-1) {\r\n//////          var kwd_odldb = 'ODL:'+db;\r\n//////          for (var i=idx+1;i<threads_idx.length;i++)\r\n//////            if (threads_idx[i].indexOf(kwd_odldb)===0) {\r\n//////              if (i!=idx+1) threads_idx.splice(idx+1,0,threads_idx.splice(i,1)[0]);\r\n//////              break;\r\n//////            }\r\n//////        }\r\n//////      }\r\n//////      function raise_threads_idx_odl(db){ // working, but blinks when there are 'watched and first' threads. (stickies can't be sticky)\r\n//////        for (var i=threads_idx.length-1;i>=0;i--)\r\n//////          if (threads_idx[i].indexOf(db)===0) {\r\n//////            if (i<threads_idx.length-2) {\r\n//////              var kwd_odldb = 'ODL:'+db;\r\n//////              for (var j=i+1;j<threads_idx.length;j++)\r\n//////                if (threads_idx[j].indexOf(kwd_odldb)===0) {\r\n//////                  if (j!=i+1) threads_idx.splice(i+1,0,threads_idx.splice(j,1)[0]);\r\n//////                  break;\r\n//////                }\r\n//////            }\r\n//////            break;\r\n//////          }\r\n//////      }\r\n//        function reorder(name){\r\n//          var idx_old = threads_idx.indexOf(name);\r\n//          if (idx_old!=-1) threads_idx.splice(idx_old,1);\r\n//          var idx_new = insert(name);\r\n//          if ((idx_new !== idx_old || embed_mode==='page') && (idx_new < drawn_idx || idx_old < drawn_idx)) drawn_idx = 0;\r\n//          else if (embed_mode==='page' && drawn_idx===true) drawn_idx = 0;\r\n////          else if (embed_mode==='page' && drawn_idx===true) drawn_idx = idx_new; // BUG??? this doesn't track drawn_y and ref_count.\r\n////          if (idx_new !== idx_old && (idx_new < drawn_idx || idx_old < drawn_idx)) drawn_idx = 0; // BUG. doesn't redraw if its size is changed.\r\n//          return (idx_new !==idx_old || (threads[name] && threads[name][9][0]!=threads[name][1])); // returns need to redraw.\r\n//        }\r\n//        var threads_odl = {};\r\n////        var threads_odl_default = { '8': [0, undefined, undefined, undefined, undefined], // disable 'on demand mode' at indexing of 1,2,3\r\n//        var threads_odl_default = { '8': [0, 0, 0, 0, 0],\r\n//                                   '19': [0,0,0]};\r\n//        function get_threads_odl_default(str){\r\n//          var page = parseInt(str.substr(str.lastIndexOf('/')+2),10);\r\n//          return (page===0)? {'8': [undefined, undefined, undefined, undefined, undefined], __proto__: threads_odl_default} : // force to top\r\n//                             {'8': [-page, -page, -page, -page, -page], __proto__: threads_odl_default};  // force to last\r\n//        }\r\n//        var start,end;\r\n//        var kwd_odl = 'ODL:';\r\n//        var check_funcs = {\r\n//          reply_to_me: function(tgt_th){return (tgt_th[19][0]&0x000c0000) && (tgt_th[19][1]>>16)!=0;},\r\n//          reply: function(tgt_th){return (tgt_th[19][0]&0x000c0000) && tgt_th[19][1]!=0;},\r\n//          watch_first: function(tgt_th){return tgt_th[19][0]&0x000c0000;},\r\n//          watch_last: function(tgt_th){return !(tgt_th[19][0]&0x000c0000);},\r\n//          sticky_first: function(tgt_th){return tgt_th[20];},\r\n//          sticky_last: function(tgt_th){return !tgt_th[20];},\r\n//        }\r\n//        function get_tgt_th(str){\r\n//          return (str.indexOf(kwd_odl)===0)? (threads_odl[str] || get_threads_odl_default(str)) :\r\n//                                             threads[str];\r\n//        }\r\n//        function check_sub(myself, check_func){\r\n//          var ref = start;\r\n//          while (ref<end && check_func(get_tgt_th(threads_idx[ref]))) ref++;\r\n//          if (check_func(myself)) end = ref;\r\n//          else start = ref;\r\n//        }\r\n//        var funcs_get_date = {\r\n//          0: function(tgt_th8){return tgt_th8[0] || tgt_th8[4];},\r\n//          4: function(tgt_th8){return tgt_th8[4] || tgt_th8[0];},\r\n//          get 5(){var now = Date.now(); return function(tgt_th8){return (now - tgt_th8[1])/tgt_th8[2];}},\r\n//          1: function(tgt_th8){return tgt_th8[1];},\r\n//          2: function(tgt_th8){return tgt_th8[2];},\r\n//          3: function(tgt_th8){return tgt_th8[3];},\r\n//        }\r\n//        function insert(name){\r\n//          start = 0;\r\n//          end = threads_idx.length;\r\n//          var pf = pref.catalog.order;\r\n//          var myself = get_tgt_th(name);\r\n//          if (pf.sticky!=='dont_care') check_sub(myself, (pf.sticky==='last')? check_funcs.sticky_last : check_funcs.sticky_first);\r\n//          if (pf.reply_to_me) check_sub(myself, check_funcs.reply_to_me);\r\n//          if (pf.reply) check_sub(myself, check_funcs.reply);\r\n//          if (pf.watch!=='dont_care') check_sub(myself, (pf.watch==='last')? check_funcs.watch_last : check_funcs.watch_first);\r\n//          var get_date = funcs_get_date[pref.catalog.indexing%6];\r\n////          var indexing  = pref.catalog.indexing%6;\r\n////          var indexing2 = pref.catalog.indexing;\r\n////          var get_date = (indexing===0 || indexing===4)? function(tgt_th){return tgt_th[8][indexing] || tgt_th[8][(indexing===0)?4:0];} :\r\n////                         (indexing===5)?                 (function(){var now = Date.now(); return function(tgt_th){return (now - tgt_th[8][1])/tgt_th[8][2];}})() :\r\n////                                                         function(tgt_th){return tgt_th[8][indexing];};\r\n//          var date = get_date(myself[8]);\r\n//          var check_func = (pref.catalog.indexing>=5 && pref.catalog.indexing<11)? function(tgt_th){return date>=get_date(tgt_th[8]);} :\r\n//                                                                                   function(tgt_th){return date<=get_date(tgt_th[8]);};\r\n//          var ref = start;\r\n//          while (ref<end && check_func(get_tgt_th(threads_idx[ref]))) ref++;\r\n//  \r\n//          if (ref==threads_idx.length) threads_idx[threads_idx.length] = name;\r\n//          else threads_idx.splice(ref,0,name);\r\n//  //        if (ref<=drawn_idx) drawn_idx = 0; // can't track by 'drawn_idx = ref; drawn_y = 0;'. drawn_xxx must be synchronized.\r\n//          return ref;\r\n//        }\r\n//        function raise_odl(th){\r\n//          var i = threads_idx.indexOf(th.key);\r\n//          if (i!=-1) {\r\n//            var kwd_odldb = 'ODL:'+ th.domain + th.board;\r\n//            while (++i<threads_idx.length) {\r\n//              if (threads_idx[i].indexOf(kwd_odldb)===0) {\r\n//                threads_odl[threads_idx[i]] = {'8':[ (th.time_posted || th.time_bumped), th.time_created, th.nof_posts, th.nof_files, (th.time_bumped || th.time_posted) ],\r\n//                                               __proto__:threads_odl_default};\r\n//                insert(threads_idx.splice(i,1)[0]);\r\n//                break;\r\n//          }}}\r\n//        }\r\n//        function delete_odl(keys){\r\n//          for (var i=0;i<keys.length;i++) delete threads_odl[kwd_odl+keys[i]];\r\n//        } \r\n//        function insert_odl(name){\r\n//          delete threads_odl[kwd_odl+name];\r\n//          reorder(kwd_odl+name);\r\n//        }\r\n//        return {\r\n//          idx_insert: insert,\r\n//          idx_raise_odl: raise_odl,\r\n//          idx_delete_odl: delete_odl,\r\n//          idx_insert_odl: insert_odl,\r\n////          clear: clear, // NEED TO BE IMPLEMENTED to clear 'threads_odl' to prevent memory from leaking.\r\n//          idx_reorder: reorder,\r\n//          idx_re_sort: re_sort,\r\n//        }\r\n//      })();\r\n////////      function insert_thread_idx(name){ // working code.\r\n////////        var indexing = pref.catalog.indexing;\r\n////////        var ref=0;\r\n////////        var end = threads_idx.length;\r\n////////        var dbt = common_func.fullname2dbt(name);\r\n////////        var kwd_odl   = 'ODL:';\r\n////////        var kwd_odldb = kwd_odl+dbt[0]+dbt[1];\r\n////////        var check_func;\r\n////////        function skip_odl_th(ref){\r\n////////          var str = threads_idx[ref];\r\n////////          if (str.indexOf(kwd_odl)===0) return str.indexOf(kwd_odldb)!==0;\r\n////////          else return check_func(threads[str]);\r\n////////        }\r\n//////////console.log(name+', S: '+threads[name][19][1]+'/'+(threads[name][8][2]-threads[name][19][2])+', '+threads[name][8][2]+', '+threads[name][8][3]);\r\n////////        if (pref.catalog.order.reply_to_me) {\r\n////////          check_func = function(tgt_th){return tgt_th[19][0]!==0 && tgt_th[19][1]!=0;};\r\n////////          while (ref<end && skip_odl_th(ref)) ref++;\r\n////////          if (threads[name][19][0]!==0 && threads[name][19][1]!=0) {end=ref;ref=0;}\r\n//////////console.log(name+', M: '+ref+'/'+end+', '+threads[name][19][1]);\r\n////////        }\r\n////////        if (pref.catalog.order.reply) {\r\n////////          var ref2 = ref;\r\n//////////          while (ref2<end && threads_idx[ref2].substr(0,4)!=='ODL:' && threads[threads_idx[ref2]][19][2]!=threads[threads_idx[ref2]][8][2]) ref2++;\r\n//////////          while (ref2<end && threads_idx[ref2].substr(0,4)!=='ODL:' && threads[threads_idx[ref2]][19][2]!=0 && threads[threads_idx[ref2]][19][2]!=threads[threads_idx[ref2]][8][2]) ref2++;\r\n//////////          if (threads[name][19][2]!=0 && threads[name][19][2]!=threads[name][8][2]) end = ref2;\r\n////////          check_func = function(tgt_th){return tgt_th[19][0]!==0 && tgt_th[19][2]>0;};\r\n////////          while (ref2<end && skip_odl_th(ref2)) ref2++;\r\n////////          if (threads[name][19][0]!==0 && threads[name][19][2]>0) end = ref2;\r\n////////          else ref = ref2;\r\n//////////console.log(name+', N: '+ref+'/'+end+', '+(threads[name][8][2]-threads[name][19][2]));\r\n////////        }\r\n//////////        if (pref.catalog.order.watch) { // working code.\r\n//////////          var ref2 = ref;\r\n//////////          while (ref2<end && threads_idx[ref2].substr(0,4)!=='ODL:' && threads[threads_idx[ref2]][19][0]!==0) ref2++;\r\n//////////          if (threads[name][19][0]!==0) end = ref2;\r\n////////////          while (ref2<end && threads_idx[ref2].substr(0,4)!=='ODL:' && threads[threads_idx[ref2]][19][2]!=0) ref2++;\r\n////////////          if (threads[name][19][2]!=0) end = ref2;\r\n//////////          else ref = ref2;\r\n////////////console.log(name+', R: '+ref+'/'+end);\r\n//////////        }\r\n////////        if (pref.catalog.order.watch!=='dont_care') { // working code.\r\n////////          var polarity = (pref.catalog.order.watch==='last');\r\n////////          var ref2 = ref;\r\n////////          check_func = function(tgt_th){return polarity ^ tgt_th[19][0]!==0;};\r\n////////          while (ref2<end && skip_odl_th(ref2)) ref2++;\r\n////////          if (polarity ^ threads[name][19][0]!==0) end = ref2;\r\n////////          else ref = ref2;\r\n//////////console.log(name+', R: '+ref+'/'+end);\r\n////////        }\r\n////////        if (pref.catalog.order.sticky!=='dont_care') {\r\n////////          var polarity = (pref.catalog.order.sticky==='last');\r\n////////          var ref2 = ref;\r\n////////          check_func = function(tgt_th){return polarity ^ tgt_th[20];};\r\n////////          while (ref2<end && skip_odl_th(ref2)) ref2++;\r\n////////          if (polarity ^ threads[name][20]) end = ref2;\r\n////////          else ref = ref2;\r\n//////////console.log(name+', T: '+ref+'/'+end);\r\n////////        }\r\n////////        var date = threads[name][8][indexing] || threads[name][8][(indexing===0)?4:0];\r\n////////        check_func = function(tgt_th){return date<=(tgt_th[8][indexing] || tgt_th[8][(indexing===0)?4:0]);};\r\n////////        while (ref<end && skip_odl_th(ref)) ref++;\r\n////////        if (ref==threads_idx.length) threads_idx[threads_idx.length] = name;\r\n////////        else threads_idx.splice(ref,0,name);\r\n//////////console.log(name+', F: '+ref+'/'+end+', '+threads_idx.length);\r\n//////////        if (ref<=drawn_idx) drawn_idx = 0; // can't track by 'drawn_idx = ref; drawn_y = 0;'. drawn_xxx must be synchronized.\r\n////////        return ref;\r\n////////      }\r\n\r\n      function expand_shrink_thread(name){\r\n        if (threads[name][0].style.width=='') {\r\n          if (pref.catalog_expand_with_hr && embed_mode!=='catalog') show_catalog_hr(name,'shrink');\r\n          threads[name][0].style.width = pref.catalog_size_width + 'px';\r\n          threads[name][0].style.height = pref.catalog_size_height + 'px';\r\n        } else {\r\n          threads[name][0].style.width = '';\r\n          threads[name][0].style.height = '';\r\n          if (pref.catalog_expand_with_hr && embed_mode!=='catalog') show_catalog_hr(name,'add');\r\n        }\r\n      }\r\n\r\n      var DIH = (function(){ // Dynamic Image Handler\r\n        var hover_tn = null;\r\n        var hover_ex = null;\r\n        var hover_pf = null;\r\n        var image_expand_on_demand_instance = null;\r\n        var image_expanding = [];\r\n        var zoom = null;\r\n        function image_hover_prep(img,src, mode){\r\n          var img_ex = clone_img(img, src, mode, 'hover');\r\n          if (!img_ex) return;\r\n          img_ex.style.position = 'fixed';\r\n          img_ex.style.top = '0px';\r\n          img_ex.style.right = '0px';\r\n          img_ex.style.pointerEvents = 'none';\r\n  //        if (pref.test_mode['69']) archiver.test_dl(img_ex.src);\r\n          return img_ex;\r\n        }\r\n        function get_mode(e){\r\n          return e.currentTarget===site.popup_body? 'page' : embed_mode;\r\n        }\r\n        function image_hover_add(e,src){\r\n          var mode = get_mode(e);\r\n          var img_tn = e.target; //  : this; // e.currentTarget;\r\n          if (pref[embed_mode].image_hover) {\r\n            var divert = hover_pf && hover_pf[1]===img_tn;\r\n            var img_ex;\r\n            if (divert) {\r\n              img_ex = hover_pf[0];\r\n              img_ex.style.display = '';\r\n              hover_pf = null;\r\n            } else {\r\n              img_ex = image_hover_prep(img_tn,src, mode);\r\n              if (!img_ex) return;\r\n            }\r\n            img_ex.style.zIndex = pref[embed_mode].thumbnail.hover.popup_zIndex;\r\n//            img_tn.addEventListener('mouseout', image_hover_remove_tn, false);\r\n            if (!divert) site.script_body.appendChild(img_ex);\r\n            e.preventDefault();\r\n            httpd.pause_req();\r\n            img_ex.onload  = image_hover_onload;\r\n            img_ex.onerror = httpd.pause_cancel;\r\n            if (hover_ex) image_hover_remove(); // placed after show to reduce redraw.\r\n            hover_tn = img_tn;\r\n            hover_ex = img_ex;\r\n          }\r\n\r\n          if (hover_pf) {\r\n            hover_pf[0].parentNode.removeChild(hover_pf[0]);\r\n            hover_pf = null;\r\n          }\r\n          if (pref[embed_mode].image_prefetch) {\r\n            var name = get_name_recursive(img_tn);\r\n            var img_next = site2[site.nickname].get_next_image(img_tn);\r\n            if (img_next) {\r\n              var img_pf = image_hover_prep(img_next, null, mode);\r\n              img_pf.style.display = 'none';\r\n              site.script_body.appendChild(img_pf);\r\n              hover_pf = [img_pf,img_next];\r\n            }\r\n          }\r\n        }\r\n//        function image_hover_remove_tn(e){\r\n//          hover_tn.removeEventListener('mouseout', image_hover_remove_tn, false);\r\n//          image_hover_remove();\r\n//        }\r\n        function image_hover_remove(){\r\n          if (hover_ex) site.script_body.removeChild(hover_ex);\r\n          hover_ex = null;\r\n        }\r\n        function image_hover_snatch(){\r\n          if (!hover_ex) return;\r\n//          hover_tn.removeEventListener('mouseout', image_hover_remove_tn, false);\r\n          if (zoom_required(hover_ex)) {\r\n            hover_ex.style.cursor = 'zoom-in';\r\n            hover_ex.onclick = image_hover_zoom_in;\r\n          }\r\n          return hover_ex;\r\n        }\r\n        function image_hover_snatch_end(){\r\n          var s = hover_ex.style;\r\n          s.position = null;\r\n          s.pointerEvents = null;\r\n          s.zIndex = null;\r\n          s.top = null;\r\n          s.right = null;\r\n          if (hover_ex.tagName==='VIDEO') hover_ex.play();\r\n          hover_ex = null;\r\n        }\r\n        function image_hover_onload(e){\r\n          httpd.pause_cancel();\r\n          var pf = pref[embed_mode].thumbnail['hover'];\r\n          if (!pf.zoom) return;\r\n          var img = e.target;\r\n          if (zoom_required(img, true)) {\r\n            hover_tn.addEventListener('mouseout', image_hover_zoom_end, false);\r\n            hover_tn.addEventListener('mousemove', image_hover_zoom_prep, false);\r\n            hover_tn.addEventListener('click', image_hover_zoom_start, false);\r\n            zoom = {x:document.documentElement.clientWidth - img.clientWidth, y:img.clientHeight, state:null};\r\n//            zoom = {x:document.documentElement.clientWidth - parseInt(s.maxWidth,10), y:parseInt(s.maxHeight,10), state:null};\r\n          }\r\n        }\r\n        function zoom_required(img, check){\r\n          var pf = pref[embed_mode].thumbnail['hover'];\r\n          if (check && !pf.zoom) return false;\r\n          var s = img.style;\r\n          return pf.limit_width && (img.naturalWidth > parseInt(s.maxWidth,10)) || pf.limit_height && (img.naturalHeight > parseInt(s.maxHeight,10));\r\n        }\r\n        function zoom_included(e){\r\n          return e.clientX>zoom.x && e.clientY<zoom.y;\r\n        }\r\n        function image_hover_zoom_prep(e){\r\n          if (zoom_included(e)) {\r\n            if (!zoom.state) {\r\n              e.target.style.cursor = 'zoom-in';\r\n              zoom.state = true;\r\n            }\r\n          } else if (zoom.state) {\r\n            e.target.style.cursor = 'auto';\r\n            zoom.state = false;\r\n          }\r\n        }\r\n        function image_hover_zoom_end(e){\r\n          var tn = e.currentTarget;\r\n          tn.removeEventListener('mouseout', image_hover_zoom_end, false);\r\n          tn.removeEventListener('mousemove', image_hover_zoom_prep, false);\r\n          tn.removeEventListener('click', image_hover_zoom_start, false);\r\n          tn.style.cursor = null;\r\n        }\r\n        function image_hover_zoom_start(e){\r\n          if (zoom_included(e)) {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n            image_hover_zoom_end(e);\r\n//            e.currentTarget.removeEventListener('mouseout', image_hover_remove_tn, false);\r\n            hover_ex.onmouseout = image_hover_remove;\r\n            image_hover_zoom_in({target:hover_ex, clientX:e.clientX, clientY:e.clientY});\r\n            image_hover_draggable(hover_ex);\r\n          }\r\n        }\r\n        function image_hover_draggable(pn){\r\n          pn.style.pointerEvents = 'auto';\r\n          pn.draggable = true;\r\n          pn.ondragstart = cnst.div_dragstart;\r\n          pn['on'+brwsr.mousewheel] = cnst.div_scroll;\r\n        }\r\n        function maxWidth(inline_or_hover){\r\n          return document.documentElement.clientWidth  - pref[embed_mode].thumbnail[inline_or_hover].margin_width;\r\n        }\r\n        function maxHeight(inline_or_hover){\r\n          return document.documentElement.clientHeight - pref[embed_mode].thumbnail[inline_or_hover].margin_height;\r\n        }\r\n        function zoom_factor(img){\r\n          var fx = img.naturalWidth/(parseInt(img.style.maxWidth,10) || maxWidth('hover'));\r\n          var fy = img.naturalHeight/(parseInt(img.style.maxHeight,10) || maxHeight('hover'));\r\n          return (fx>fy)? fx : fy;\r\n        }\r\n        function zoom_in_place(e, s, f){\r\n          if (!s.top) {\r\n            s = e.target.parentNode.parentNode.style;\r\n            var oT = e.target.offsetTop;\r\n            var oR = e.target.offsetLeft; // e.target.parentNode.parentNode.offsetWidth - e.target.offsetWidth - e.target.offsetLeft; // PATCH\r\n          }\r\n          s.top = parseInt(s.top,10)*f + ((oT||0)-e.clientY)*(f-1) + 'px';\r\n          s.right = parseInt(s.right,10)*f - (document.documentElement.clientWidth - (oR||0) - e.clientX) * (f-1) + 'px';\r\n        }\r\n        function image_hover_zoom_in(e){\r\n          var et = e.target;\r\n          var s = et.style;\r\n          zoom_in_place(e, s, zoom_factor(et));\r\n          s.maxWidth  = 'none';\r\n          s.maxHeight = 'none';\r\n          s.cursor  = 'zoom-out';\r\n          et.onclick = image_hover_zoom_out;\r\n        }\r\n        function image_hover_zoom_out(e){\r\n          var et = e.target;\r\n          var s = et.style;\r\n          zoom_in_place(e, s, 1/zoom_factor(et));\r\n          s.maxWidth  = maxWidth('hover')+'px';\r\n          s.maxHeight = maxHeight('hover')+'px';\r\n          s.cursor = 'zoom-in';\r\n          et.onclick = image_hover_zoom_in;\r\n        }\r\n\r\n        function clone_img_make_src(img, mode, inline_or_hover, from_initial){\r\n          var name = get_name_recursive(img);\r\n          if (!from_initial && pref[embed_mode].env.event_dynamic && inline_or_hover!==undefined &&\r\n            ((inline_or_hover==='inline')? pref[embed_mode].env.expand_thumbnail_inline_native : pref[embed_mode].env.image_hover_native)) return;\r\n  //        &&  common_func.fullname2dbt(name)[0]===site.nickname) return;\r\n          if (!name && pref.test_mode['106'] && pref.test_mode['107']) return img.src; // patch for expand all at initial in 4chan, BUT I DON'T KNOW WHY...\r\n          var tgt_domain_html = (pref.catalog.mimic_base_site)? site.nickname : threads[name][16].domain_html;\r\n  //        var tgt_th16 = threads[name][16];\r\n  ////      var src = ((tgt_th16.type_html==='catalog')? tgt_th16.op_img_src_url : img.parentNode.href) || pn.src;\r\n  //        return ((tgt_th16.type_html==='catalog')? // working code\r\n  //          site2[tgt_th16.domain_html].parse_funcs.catalog_html.img2src && site2[tgt_th16.domain_html].parse_funcs.catalog_html.img2src(img) :\r\n  //          site2[tgt_th16.domain_html].parse_funcs.post_html.img2src(img)) || img.src;\r\n          mode = site2[tgt_domain_html].general_event_handler[site.whereami].image_hover_check_mode(img);\r\n          if (mode!=='catalog') return site2[tgt_domain_html].parse_funcs.post_html.img2src(img) || img.src; // working code, but cause an error at merging when the base is lost.\r\n  //        if (embed_mode!=='catalog') return site2[tgt_th16.domain_html].parse_funcs.post_html.img2src(img) || img.src; // working code, but cause an error at merging when the base is lost.\r\n          else {\r\n            if (!name) return;\r\n            var lth = liveTag.mems.getFromName(name);\r\n            return site2[lth.domain].parse_funcs[lth.th.type_parse].get_op_src(lth.th, img);\r\n          }\r\n        }\r\n        function clone_img(img, src, mode, inline_or_hover, from_initial){\r\n          var pn = img.cloneNode();\r\n  //        pn.src = (embed_mode==='page')? img.parentNode.href : pn.src; // TEMPORARILY!!!\r\n          if (!src) src = clone_img_make_src(img, mode, inline_or_hover, from_initial);\r\n          if (!src) return; // return when native dynamic function works.\r\n          var ext = (src.search(/^blob/)===0)? site2['DEFAULT'].parse_funcs.post_html.img2ext(img) : '';\r\n          if (src.indexOf('data-ext')!=-1) { // PATCH for archive\r\n            ext = src.slice(src.indexOf('data-ext')+10).replace(/\".*/,'');\r\n            src = src.replace(/\".*/,'');\r\n          }\r\n          if (src.substr(-5,5)==='.webm' || ext==='.webm' || img.getAttribute('data-ext')==='.webm') {\r\n            if (pref[embed_mode].thumbnail[inline_or_hover].webm && !from_initial) {\r\n              if (hover_ex && hover_ex.src===src) {\r\n                pn = hover_ex;\r\n                hover_ex = null;\r\n                pn.style.position = null;\r\n                pn.style.top = null;\r\n                pn.style.right = null;\r\n                pn.style.pointerEvents = null;\r\n    //            pn.play();\r\n              } else {\r\n                var pn = document.createElement('video');\r\n                pn.controls = true;\r\n                pn.autoplay = true;\r\n                //  <video controls=\"\" loop=\"\" autoplay=\"\" class=\"expandedWebm\" src=\"xxx.webm\" style=\"max-width: 957px; max-height: 587px;\"></video> // 4chan\r\n              }\r\n  if (!pref.test_mode['63']) {\r\n              pn.loop  = pref[embed_mode].thumbnail[inline_or_hover].webm_loop;\r\n              pn.muted = pref[embed_mode].thumbnail[inline_or_hover].webm_mute;\r\n  }\r\n            } else return null;\r\n          }\r\n          pn.src = src;\r\n          pn.style.width = 'auto';\r\n          pn.style.height = 'auto';\r\n          if (pref[embed_mode].thumbnail[inline_or_hover].limit_width)  pn.style.maxWidth  = (document.documentElement.clientWidth  - pref[embed_mode].thumbnail[inline_or_hover].margin_width)  + 'px';\r\n          if (pref[embed_mode].thumbnail[inline_or_hover].limit_height) pn.style.maxHeight = (document.documentElement.clientHeight - pref[embed_mode].thumbnail[inline_or_hover].margin_height) + 'px';\r\n          return pn;\r\n        }\r\n        function expand_thumbnail_inline(e, from_initial){\r\n          var mode = get_mode(e || {currentTarget:this});\r\n          if (pref[embed_mode].expand_thumbnail_inline && image_expanding.indexOf(this)==-1) {\r\n            var img_ex = clone_img(this, null, mode, 'inline', from_initial);\r\n            if (!img_ex) {expand_thumbnail_on_demand_set.call(this);return;}\r\n  //          if (!img_ex) return;\r\n            if (img_ex.tagName!=='VIDEO') {\r\n              img_ex.style.display = 'none';\r\n              img_ex.addEventListener('load',expand_thumbnail_inline_load, false);\r\n              this.style.opacity = 0.5;\r\n            }\r\n            this.parentNode.insertBefore(img_ex,this.nextSibling);\r\n  //          this.onclick = null; // can't track event accurately because 'on demand expand' mode adds click event to images which have a native expansion event.\r\n            image_expanding.push(img_ex);\r\n            \r\n            if (e) e.preventDefault();\r\n            if (img_ex.tagName==='VIDEO') {\r\n              expand_thumbnail_inline_load.call(img_ex);\r\n              img_ex.play(); // may be diverted from image_hover\r\n            }\r\n          }\r\n        }\r\n        function expand_thumbnail_inline_load(){\r\n          this.previousSibling.style.display = 'none';\r\n          this.style.display = '';\r\n          this.previousSibling.style.opacity = '';\r\n          this.removeEventListener('load',expand_thumbnail_inline_load, false);\r\n          this.onclick = shrink_thumbnail_inline;\r\n          if (site2[site.nickname].format_expanded_thumbnail) site2[site.nickname].format_expanded_thumbnail(this);\r\n          var idx = image_expanding.indexOf(this);\r\n          if (idx>=0) image_expanding.splice(idx,1);\r\n  \r\n          if (site.patch.expand_thumbnail_inline_load) site.patch.expand_thumbnail_inline_load.call(this);\r\n          expand_thumbnail_on_demand_set.call(this);\r\n        }\r\n        function expand_thumbnail_on_demand_set(){\r\n          if (pref[embed_mode].expand_thumbnail_inline && (pref[embed_mode].expand_thumbnail_initial || pref[embed_mode].expand_thumbnail_inline_all_after)) {\r\n            var img_next = site2[site.nickname].get_next_image(this,get_now_height()); // now_height for jump scroll\r\n            if (img_next && img_next.style.display!=='none') expand_thumbnail_on_demand(img_next);\r\n          }\r\n        }\r\n        function expand_thumbnail_on_demand(img){\r\n          var ref_height = get_ref_height(pref[embed_mode].thumbnail.inline.ref_height/100);\r\n          var offsetTop;\r\n          if (Array.isArray(img)) {\r\n            var tgt;\r\n            var nowHeight = get_now_height();\r\n            for (var i=0;i<img.length;i++) {\r\n              var ot = img[i].offsetTop;\r\n              if (ot>=nowHeight && ot<offsetTop || i===0) {\r\n                tgt = img[i];\r\n                offsetTop = ot;\r\n              }\r\n            }\r\n            img = tgt;\r\n          } else offsetTop = img.offsetTop;\r\n          if (offsetTop<ref_height || !pref[embed_mode].thumbnail.inline.ondemand) {\r\n            image_expand_on_demand_instance = null;\r\n            expand_thumbnail_inline.call(img, null, true);\r\n          } else image_expand_on_demand_instance = img;\r\n        }\r\n        function expand_thumbnail_queue_add(img){\r\n          if (!image_expand_on_demand_instance) image_expand_on_demand_instance = img;\r\n          else if (Array.isArray(image_expand_on_demand_instance)) image_expand_on_demand_instance[image_expand_on_demand_instance.length] = img;\r\n          else image_expand_on_demand_instance = [image_expand_on_demand_instance, img];\r\n          show_catalog_cont(); // patch, delayed 200ms\r\n        }\r\n        function shrink_thumbnail_inline(e){\r\n  //        this.previousSibling.onclick = expand_thumbnail_inline;\r\n          this.previousSibling.style.display = '';\r\n          e.preventDefault();\r\n          \r\n          if (this.getAttribute('data-originalWidth')) {\r\n            var pnode = this.parentNode.parentNode;\r\n            pnode.style.width = this.getAttribute('data-originalWidth');\r\n          }\r\n          this.parentNode.removeChild(this);\r\n        }\r\n        return {\r\n//          get_mode: function(e){return e.currentTarget===site.popup_body? 'page' : embed_mode;},\r\n          image_hover_add: image_hover_add,\r\n          image_hover_remove: image_hover_remove,\r\n          image_hover_reentry: function(img, mode){\r\n            if (!mode) mode = embed_mode; // TEMPORAL PATCH. all reentry func in GIH must be revised.\r\n            if (hover_ex && hover_ex.src===img.src) hover_ex.src = clone_img_make_src(img, mode);\r\n          },\r\n          image_hover_snatch: image_hover_snatch,\r\n          image_hover_snatch_end: image_hover_snatch_end,\r\n          get hover_ex(){return hover_ex;},\r\n          expand_thumbnail_inline: expand_thumbnail_inline,\r\n          expand_thumbnail_on_demand: function(){\r\n            if (image_expand_on_demand_instance) expand_thumbnail_on_demand(image_expand_on_demand_instance);\r\n          },\r\n          expand_thumbnail_queue_add: expand_thumbnail_queue_add,\r\n        };\r\n      })();\r\n//      function image_hover_add(e,src){\r\n//        DIH.image_hover_add.call(this,e,src);\r\n//      }\r\n      cataLog.DIH = DIH;\r\n//      cataLog.image_hover_add = image_hover_add;\r\n      cataLog.image_hover_reentry = DIH.image_hover_reentry;\r\n\r\n      function get_name_recursive(pn){\r\n        while (pn && !pn.name) pn = pn.parentNode;\r\n        return pn && pn.name;\r\n      }\r\n      function click_thread_tn(e){\r\n        if (pref[embed_mode].click==='none') return;\r\n        e.preventDefault();\r\n        if (pref[embed_mode].click_area==='entire') return;\r\n        click_thread(get_name_recursive(e.target), (e.target.classList.contains(pref.script_prefix+'_link'))? e.target.getAttribute('href') : null);\r\n      }\r\n      function click_thread_whole(){\r\n        if (pref[embed_mode].click_area==='entire') click_thread(this.name);\r\n      }\r\n      function click_thread(name, url){\r\n        if (url) open_new_thread((url==='force')? null : url, name);\r\n        else if (pref[embed_mode].click==='open') open_new_thread(null, name);\r\n        else if (threads[name][18]!=='catalog' && pref[embed_mode].click==='expand') expand_shrink_thread(name);\r\n      }\r\n      function click_link(e){\r\n        e.preventDefault();\r\n        if (this.href) open_new_thread(this.href, get_name_recursive(this));\r\n      }\r\n//      function click_thread(name){\r\n//        if (typeof(name)==='object') name= this.name;\r\n//        var name = this.name;\r\n//        if (pref.click=='expand') expand_shrink_thread(name);\r\n//        else open_new_thread(threads[name][7], name);\r\n//      }\r\n\r\n      function add_open_new_thread_event(name,args){\r\n        for (var i=0;i<args.length;i++) {\r\n          var elem = args[i][0];\r\n          var url  = args[i][1];\r\n          var func = function(){open_new_thread(url, name);if (pref[embed_mode].click==='expand') expand_shrink_thread(name);};\r\n          elem.addEventListener('click', func, false);\r\n          args[i][1] = func;\r\n        }\r\n        return args;\r\n      }\r\n      function remove_open_new_thread_event(args){\r\n        for (var i=0;i<args.length;i++) args[i][0].removeEventListener('click', args[i][1], false);\r\n        return null;\r\n      }\r\n      function get_mark_time(name,time,list,watch, extra_format){\r\n        if (watch) {\r\n          var date_mark = pref_func.merge_obj5(name,pref.catalog.filter.watch_list_obj2,{hit:false});\r\n          if ('time' in date_mark) return (extra_format)? -date_mark.time : date_mark.time;\r\n        }\r\n        if (list) {\r\n          date_mark = pref_func.merge_obj5(name,pref.catalog.filter.list_obj2,{hit:false});\r\n          if ('time' in date_mark) return date_mark.time;\r\n          else if (date_mark.hit) return 0;\r\n        }\r\n        if (time && pref.catalog.filter.time_str!=='') return Date.parse(pref.catalog.filter.time_str);\r\n        else return 0;\r\n      }\r\n//      function get_mark_time(name){\r\n//        var date_mark = -1;\r\n////        if (pref.catalog.filter.time_mark) date_mark = Date.parse(pref.catalog.filter.time_mark_str) - pref.localtime_offset*3600000;\r\n//        if (pref.catalog.filter.time_mark) date_mark = Date.parse(pref.catalog.filter.time_str) - pref.localtime_offset*3600000;\r\n//        if (pref.catalog.filter.list_mark_time) {\r\n//          var time_list = catalog_filter_query_time_list(name)[1];\r\n//          if (time_list) date_mark = time_list;\r\n//        }\r\n//        return date_mark;\r\n//      }\r\n      function open_new_thread(url, name){\r\n        var dbt = common_func.fullname2dbt(name);\r\n        if (threads[name][16].archiveFile) url = site2[(pref.archive.open_local)? site.nickname : dbt[0]].make_url4([site.nickname, site.board, '0','page_html'])[0];\r\n//        if (threads[name][16].archiveFile) url = site2[dbt[0]].make_url4(common_func.name2dbt(name).slice(0,2).concat(['0','page_html']))[0];\r\n        else {\r\n          if (url===null) {\r\n            url = site2[dbt[0]].make_url4(common_func.name2dbt(name))[0]; // temporal\r\n            if (pref.catalog_open_last50!=='no') {\r\n              var short_link = document.createElement('div');\r\n              short_link.innerHTML = site2[dbt[0]].short_link(name, threads[name][8][2], null, '', '');\r\n              var as = short_link.getElementsByTagName('a');\r\n              for (var i=0;i<as.length;i++) {\r\n                if (pref.catalog_open_last50==='exist' || !(threads[name][19][0]&0x000c0000) || (parseInt(as[i].textContent,10)>(threads[name][19][1]&0x0000ffff))) {\r\n                  url = as[i].getAttribute('href');\r\n                  break;\r\n          }}}}\r\n        }\r\n//////////        if (url===null) url = site2[threads[name][16].dbt[0]].make_url3(threads[name][16].dbt[1], threads[name][16].dbt[2], '0'); // temporal // working code.\r\n////////        if (url===null) url = site2[threads[name][16].dbt[0]].make_url4(common_func.name2dbt(name))[0]; // temporal\r\n////////        if (typeof(url)==='string') url = [url];\r\n////////        var idx = 0;\r\n////////        var unread50 = (threads[name][19][0]!==0 && threads[name][19][2]<=50);\r\n////////        if      (pref.catalog_open_last50==='no')    idx = 0;\r\n////////        else if (pref.catalog_open_last50==='exist') idx = url.length-1;\r\n////////        else if (pref.catalog_open_last50==='exist_watch') idx = (unread50)? url.length-1 : 0;\r\n////////        else {\r\n////////          var dbt = common_func.fullname2dbt(name); // patch\r\n////////if (dbt[0]==='8chan' || dbt[0]==='lain') { // patch.\r\n////////          if (url.length==1 && threads[name][8][2]>100) url[1] = url[0].replace(/.html/,'+50.html');\r\n////////          if (pref.catalog_open_last50==='speculative') idx = (threads[name][8][2]>100)? url.length-1 : 0;\r\n////////          else if (pref.catalog_open_last50==='spec_watch') idx = (unread50)? url.length-1 : 0;\r\n////////}\r\n////////        }\r\n////////        url = url[idx];\r\n\r\n//console.log(url);\r\n//        var cw = window.open(url,(pref.catalog_open_in_new_tab)? '_blank' : '_self');\r\n        var window_name = (site.embed_frame_win)? site.embed_frame\r\n                        : (pref.catalog_open_where==='named')? name + ((threads[name][16].archiveFile)? 'A' : '')\r\n                        : (pref.catalog_open_where==='_blank')? name + '_' + Date.now() : pref.catalog_open_where;\r\n//                        : (pref.catalog_open_in_new_tab)? ((pref.catalog_use_named_window)? name : '_blank') : '_self';\r\n        var time_marked = (pref[embed_mode].mark_new_posts)? get_watch_time_of_a_thread(name,threads[name][8][1], null, true) : 0;\r\n        var message = ['MARK',time_marked];\r\n        if (!site2[site.nickname].historyAPI || !site2[dbt[0]].historyAPI || !pref.pref2.meguca.historyAPI) {\r\n          var cw = window.open(url,window_name);\r\n          send_message(window_name, message,cw);\r\n          if (pref.uip_tracker.on) {\r\n            var lth = liveTag.mems.getFromName(name);\r\n            if (pref.uip_tracker.sage.annotate) {\r\n              if (pref.uip_tracker.sage.annotate_page && lth.pgh) send_message(window_name, ['UIP', ['page',JSON.stringify(lth.pgh)]]);\r\n              if (lth.sg && lth.sg.size) send_message(window_name, ['UIP', ['sage'].concat(Array.from(lth.sg))]);\r\n            }\r\n            if (pref.uip_tracker.annotate) if (lth.sID && lth.sID.h) send_message(window_name, ['UIP',lth.sID.h]);\r\n          }\r\n          if (threads[name][16].archiveFile) {\r\n            var file = threads[name][16].archiveFile;\r\n            send_message(window_name, ['ARCHIVER',['SUB_INIT',(file==='IDB')? {IDB:true, domain:dbt[0], board:(pref.test_mode['80'])? dbt[1].slice(0,-5)+'/' : dbt[1], no:dbt[2]} : // cut '_IDB'\r\n                                                                              {name:file.name, size:file.size, lastModified:file.lastModified, files_sel:pref.archive.files_sel} ]]);\r\n          }\r\n        } else {\r\n          if (site2[site.nickname].historyAPI_blocking) return; // patch for meguca, killing click, but this is dangerous.\r\n          send_message_emu.push(message);\r\n        }\r\n        if (pref.catalog.auto_watch) triage_exe_0(name,'WATCH','',true);\r\n      }\r\n      function mark_read_thread(name,time, track){\r\n        if (time!==null) site2['DEFAULT'].check_reply.set_watched_to_last(threads[name][19], time, name, track);\r\n        else site2['DEFAULT'].check_reply.set_unwatch(threads[name][19]);\r\n        if (pref.liveTag.style.use) liveTag.update_ur(name,0,true);\r\n//        site2[cnst.name2domainboardthread(name,true)[0]].insert_footer2(threads[name][0],threads[name][18],threads[name][19],threads[name][8]);\r\n        gClg.footer.update_force(name, pref.catalog.footer.flag);\r\n//        if (reorder_thread_idx(name)) show_catalog(name); // called in triage_exe\r\n        if (pref.notify.favicon) notifier.favicon.set(threads);\r\n      }\r\n\r\n      var show_catalog_init_funcs;\r\n      var show_catalog_scroll_lock = (function(){\r\n        var marks = null;\r\n//        var set = Watchdog.prototype.restart.bind(new Watchdog(scroll_back, 5));\r\n        var wdg  = new Watchdog(scroll_back, 5);\r\n        var wdg2 = new Watchdog(tgt_lock_calcel, 100); // 500ms scroll lock and watchdog for oscillation.\r\n        var set = Watchdog.prototype.restart.bind(wdg);\r\n//        var last_viewed = null;\r\n        function tgt_lock_calcel(){\r\n          wdg.cancel();\r\n          marks = null;\r\n        }\r\n        function scroll_back(){\r\n          var mark_top = marks[0].offsetTop || 0;\r\n          var abs_top = mark_top - marks[1] + marks[2];\r\n          if (abs_top<0) abs_top = 0;\r\n          if (!mark_top || get_now_height()===abs_top) { // may cause oscillation\r\n//            marks = null;\r\n//             wdg2.stop(); // scroll lock\r\n            return;\r\n          }\r\n          window.scrollTo(0, abs_top);\r\n          set();\r\n        }\r\n        var last_viewed = null;\r\n        function start(pn){\r\n          if (marks===null || pn) {\r\n//            if (marks && pn) scroll_back();\r\n            if (!pn) {\r\n              pn = (wdg2.id)? last_viewed : // scroll locked\r\n                              cataLog.general_event_handler.get_last_viewed() || last_viewed; // return null when initial or deleted\r\n              if (!pn) return;\r\n            }\r\n            marks = [pn, pn.offsetTop, get_now_height()];\r\n            last_viewed = pn;\r\n////            if (last_viewed) { // working code.\r\n////              marks = [last_viewed, last_viewed.offsetTop, get_now_height()];\r\n////              set();\r\n////            }\r\n//            var now_height = get_now_height();\r\n//            var last_top; // working code.\r\n//            if (last_viewed) last_top = last_viewed.offsetTop;\r\n//            if (last_viewed && last_top >= now_height && last_top <= now_height + window.innerHeight) marks = [last_viewed, last_top, now_height];\r\n//            else { // scrolled\r\n//              var posts = (embed_mode==='thread')? site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'thread_html', {thread:site.no})[0].posts :\r\n//                                                   site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'page_html', {page:0})[0].posts;\r\n//              var step = posts.length >> 1;\r\n//              var i = 0;\r\n//              while (step>0) {\r\n//                if (posts[i+step].pn.offsetTop<now_height) i += step;\r\n//                step >>= 1;\r\n//              }\r\n//              while (i<posts.length-1 && posts[i].pn.offsetTop<now_height) i++;\r\n//              marks = [posts[i].pn, posts[i].pn.offsetTop, now_height];\r\n//            }\r\n          }\r\n          wdg2.restart();\r\n          set();\r\n        }\r\n        return {\r\n          modified: function(tgt){\r\n//            start((tgt.pn && marks[0]===tgt.pn)? site2[site.nickname].general_event_handler[site.whereami].get_prev_mark(tgt.pn) : null); // fail if get_prev_mark returns undefined;\r\n            if (tgt.pn && marks && marks[0]===tgt.pn) {\r\n              scroll_back();\r\n              marks = null; // get_prev_mark may return undefined\r\n//              start(site2[site.nickname].general_event_handler[site.whereami].get_prev_mark(tgt.pn));\r\n              start(site2[site.nickname].general_event_handler[site.whereami].get_mark_from_height(tgt.pn.offsetTop));\r\n              cataLog.general_event_handler.clear_last_viewed();\r\n            } else start();\r\n          },\r\n          set: start,\r\n//          viewed: function(tgt){if (!marks) last_viewed = tgt;},\r\n//          viewed: function(tgt){\r\n//            if (!wdg2.id)\r\n//              last_viewed = tgt;}, // scroll lock\r\n        }\r\n      })();\r\n      cataLog.show_catalog_scroll_lock = show_catalog_scroll_lock;\r\n//      var drawn_idx = 0;\r\n      var show_catalog_cont = new DelayBuffer(show_catalog_delayed, 200).get_binded_delayed_do();\r\n      cataLog.show_catalog_cont = show_catalog_cont;\r\n      function show_catalog_delayed(){\r\n        ref_heights = null;\r\n        if (pClg.drawn_idx!==true) show_catalog();\r\n        else if (cataLog.catalog_obj2.lazy_draw) cataLog.catalog_obj2.lazy_draw();\r\n        cataLog.DIH.expand_thumbnail_on_demand();\r\n      }\r\n      var ref_heights = null;\r\n      function get_ref_height(threshold){\r\n        if (!threshold) threshold = 1.5;\r\n//        return (embed_embed)? brwsr.document_body.scrollTop + window.innerHeight * threshold // slow.\r\n//                            : triage_parent.scrollTop + triage_parent.clientHeight * threshold;\r\n        if (!ref_heights) ref_heights = {scrollTop: (scroll_event_src===window)? brwsr.document_body.scrollTop : scroll_event_src.scrollTop,\r\n                                         innerHeight: (scroll_event_src===window)? window.innerHeight : scroll_event_src.clientHeight}; // BUG, NEED TO ADD EVENTLISTENER TO TRIAGE_PARENT.'resize'.\r\n        return ref_heights.scrollTop + ref_heights.innerHeight * threshold;\r\n      }\r\n      cataLog.get_ref_height = get_ref_height;\r\n      function get_now_height(){\r\n        return (embed_embed)? brwsr.document_body.scrollTop : triage_parent.scrollTop;\r\n      }\r\n      function scopy_th(th){\r\n         var dst = {posts:[], __proto__:th};\r\n         for (var i=0;i<th.posts.length;i++) dst.posts[i] = {__proto__:th.posts[i]};\r\n         return dst;\r\n      }\r\nvar debug_str2;\r\n//      function show_catalog(tgts_in,sound){\r\n    var catalog_obj2_proto = {\r\n      show_catalog: function(tgts_in){\r\n//        if (this.masked) {this.updated_but_masked = true; return;} // test patch for meguca.\r\nif (pref.debug_mode['11']) {\r\n  var debug_str = threads_idx_debug(this.drawn_idx, this.drawn_y, this.ref_count, this.idxs);\r\n}\r\nif (pref.test_mode['23']) this.drawn_idx = 0;\r\n        var draw_on_demand = pref[embed_mode].draw_on_demand && this.permit_draw_on_demand;\r\n        var draw_adaptive = draw_on_demand && pref.network.adaptive;\r\n        var draw_count = 0;\r\n        if (draw_on_demand) {\r\n          var ref_height = get_ref_height((pref[cataLog.embed_mode].merge)? 4 : (this.disp_th20)? 0.2 : (this.disp_th100)? 1 : 1.5);\r\n          if (this.drawn_idx!==0 && this.drawn_y>=ref_height)\r\n            if (this.ppn.offsetTop + this.ppn.offsetHeight<this.drawn_y) this.drawn_y = -1; // for expanding posts or images.\r\n//            if (this.ppn.offsetHeight<this.drawn_y) this.drawn_idx = 0; // for expanding posts or images.\r\n            else return;\r\n//          if (drawn_idx!==0 && this.drawn_y>=ref_height) return;\r\n        }\r\n        if (pref[embed_mode].scroll_lock) show_catalog_scroll_lock.set();\r\n        var tgts;\r\n        if (typeof(tgts_in)==='string') {\r\n          tgts = {};\r\n          tgts[tgts_in] = null;\r\n//        } else if (Array.isArray(tgts_in)) {\r\n//          tgts = {};\r\n//          for (var i=0;i<tgts_in.length;i++) tgts[tgts_in[i]] = null;\r\n        } else tgts = tgts_in;\r\n        var tgts_count = (tgts)? Object.keys(tgts).length : undefined;\r\n//        if (embed_catalog) {show_catalog_native();return;}\r\n//        if (tgts) for (var name in tgts) if (threads[name] && threads[name][0].parentNode) threads[name][0].parentNode.removeChild(threads[name][0]); // this is required when the thread is moved to later. // THIS CAUSES A BLINK.\r\n////////        catalog_triage_out();\r\n        var triage_thread = triage.get_triaged_thread_name();\r\n//        pref_func.tooltips.hide();\r\n        var catalog_expand_with_hr = (embed_mode==='float' && pref.catalog_expand_with_hr) || pref[embed_mode].env.disp_filler;\r\n        if (tgts!==undefined) for (var i=0;i<this.drawn_idx;i++) if (this.idxs[i] in tgts) {this.drawn_idx = i;break;}\r\n        this.ref_count_init = pref[embed_mode].env.disp_offset;\r\n        if (catalog_expand_with_hr) this.ref_count_init = show_catalog_skip_hs(this.ref_count_init);\r\n        if (!draw_on_demand || this.drawn_idx===0 || this.drawn_idx===true) {\r\n          this.func_track_reset(); // called with drawn_idx===true from 'release_draw'.\r\n//          cataLog.Footer.timestamp_trial_prep();\r\n        }\r\n        var load_tgt = '';\r\n//        this.drawn_idx_mb = -1;\r\n//        var appeared = [];\r\n//var debug = '';\r\n//for (var d=0;d<threads_idx.length;d++) if (threads_idx[d]!=='ODL:' && threads[threads_idx[d]][9][0]) debug += threads_idx[d] + ', ';\r\n//console.log(debug);\r\n        var i=0;\r\n        var i_start = this.drawn_idx;\r\n        var mode_merge_tails = (pref[cataLog.embed_mode].merge_list && pref.proto.merge_first && !pref[cataLog.embed_mode].merge)? null : false;\r\n        var lazy_step = pref[cataLog.embed_mode].lazyDraw.step;\r\n        var lazy_check = false;\r\n//        var i_start = (draw_on_demand && drawn_idx!==true)? drawn_idx : 0;\r\n        while (i<this.idxs.length) {\r\n//console.log(this.drawn_y+', '+triage_parent.scrollTop+', '+triage_parent.clientHeight*1.5+', '+ref_height);\r\n          var name = this.idxs[i];\r\n          var tgt_th = this.threads[name];\r\n          if (name.substr(0,4)==='ODL:') {\r\n            if (load_tgt==='') {\r\n              load_tgt = name;\r\n              if (load_on_demand.call([load_tgt.substr(4)])) this.idxs.splice(i,1);\r\n              break;\r\n            }\r\n          } else {\r\n            if (draw_on_demand && this.drawn_y>=ref_height) {\r\n              if (!this.lazy_draw || mode_merge_tails===false) break; // {cataLog.Footer.timestamp_inc(); break;}\r\n              if (mode_merge_tails===null) mode_merge_tails = i + 1; // be true\r\n              if (!site2['DEFAULT'].update_posts_merge_bases.isShownForTails(name)) {i++;continue;}\r\n            }\r\n            if (tgts_count===0 && mode_merge_tails===false) break;\r\n            if (i>=i_start) {\r\n              if (i%lazy_step===0) lazy_check = true;\r\n              if (draw_on_demand || tgts===undefined || name in tgts) {\r\n                if (tgt_th[9][0]===null) tgt_th[9] = catalog_filter_query(name, true);\r\n                if (tgt_th[9][0] && (embed_mode==='page' || pref.test_mode['52'])) format_html.replace_posts_by_search(tgt_th); // may change tgt_th[9][0]\r\n                if (tgt_th[9][0]) {\r\n                  if (!tgt_th[0] || tgt_th[16].th) {\r\n                    insert_thread_prepare_html_lazy(tgt_th, !tgt_th[0], false, true);\r\n                    if (draw_adaptive) {\r\n                      if (++draw_count==pref.network.th100) {\r\n                        ref_height = get_ref_height(1);\r\n                        if (!this.disp_th100) {this.disp_th100 = setTimeout(function(){this.disp_th100 = null; this.show_catalog();}.bind(this), pref.network.th100_delay);}\r\n                      } else if (draw_count===pref.network.th20) {\r\n                        ref_height = get_ref_height(0.2);\r\n                        if (!this.disp_th20) {\r\n                          clearTimeout(this.disp_th100);\r\n                          this.disp_th20 = setTimeout(function(){this.disp_th20 = null; this.show_catalog();}.bind(this), pref.network.th20_delay);}\r\n                        draw_adaptive = false; // close\r\n                      }\r\n                    }\r\n                  }\r\n                  this.footer.draw(name);\r\n                  if (mode_merge_tails) {\r\n                    if (!tgt_th[1]) if (this.func_show(name,null,catalog_expand_with_hr)) tgt_th[1] = true;\r\n                    i++;\r\n                    continue;\r\n                  }\r\n////                  if (tgts!==undefined) { // working code.\r\n////                    ref_count = 0;\r\n////                    for (var j=0;j<i;j++) if (threads_idx[j].substr(0,4)!=='ODL:' && threads[threads_idx[j]][1]) ref_count++;\r\n////                  }\r\n////                  if (catalog_expand_with_hr) {\r\n////                    var j = 0;\r\n////                    var j_max = triage_parent.childNodes.length;\r\n////                    while (j<=ref_count && j<j_max) if (triage_parent.childNodes[j++].tagName!=='DIV') ref_count++;\r\n////                  }\r\n                  var ref;\r\n                  if (tgts!==undefined) {\r\n                    var j=i-1;\r\n                    while (j>=0 && (this.idxs[j].substr(0,4)==='ODL:' || !this.threads[this.idxs[j]][1] || (this.func_search_ref && this.func_serach_ref(this.idxs[j])))) j--;\r\n                    if (j>=0) {\r\n                      ref = this.threads[this.idxs[j]][0].nextSibling;\r\n                      if (catalog_expand_with_hr && ref) ref = ref.nextSibling;\r\n                    } else ref = this.ppn.childNodes[this.ref_count_init];\r\n//                    delete tgts[name];\r\n//                    if (Object.keys(tgts).length===0) tgts='END';\r\n                  } else ref = this.ppn.childNodes[this.ref_count];\r\n                  if (ref!==tgt_th[0] || !tgt_th[1]) {\r\n                    if (this.func_show(name,ref,catalog_expand_with_hr)) tgt_th[1] = true;\r\n                    if (pref.test_mode['127']) if (triage_thread) {triage.off_delay();triage_thread=null;}\r\n                  }\r\n//                  if (this.lazy_draw) this.lazy_draw(name);\r\n//                  if (this.lazy_draw) if (this.lazy_draw(name, get_ref_height(4)) this.backup_mb_state(i);\r\n                  if (tgt_th[1]) {this.func_track_shown(name, draw_on_demand && lazy_check); lazy_check = false;}\r\n//                  if (threads[name][1]) { // working code.\r\n//                    if (draw_on_demand) drawn_y = threads[name][0].offsetTop; // for faster execution. DOM function is too heavy.\r\n//                    ref_count += this.ref_step;\r\n//                    if (catalog_expand_with_hr) ref_count = show_catalog_skip_hs(ref_count);\r\n//                  }\r\n                } else if (tgt_th[1]) {\r\n                  if (pop_up_status[name]) pop_down_event(name);\r\n//                  threads[name][11] = remove_open_new_thread_event(threads[name][11]);\r\n                  if (this.func_hide(name,catalog_expand_with_hr)) tgt_th[1] = false;\r\n                  if (pref.test_mode['127']) if (triage_thread) {triage.off_delay();triage_thread=null;}\r\n                }\r\n// BUG\r\n//              } else {\r\n////                var ref = triage_parent.childNodes[ref_count];\r\n////                for (var name in tgts) if (threads[name] && ref===threads[name][0]) {ref.parentNode.removeChild(ref);break;} // this is required when the thread is moved to later. // threads[name] may not exist when it is snoop, that contains redundant threads.\r\n//                while (1) {\r\n//                  var flag = true;\r\n//                  var ref2 = triage_parent.childNodes[ref_count];\r\n//                  for (var name2 in tgts) if (threads[name2] && ref2===threads[name2][0]) {\r\n//                    ref2.parentNode.removeChild(ref2);\r\n//                    flag=false;\r\n//                    break;\r\n//                  } // this is required when the thread is moved to later. // threads[name] may not exist when it is snoop, that contains redundant threads.\r\n//                  if (flag) break;\r\n//                }\r\n//                if (threads[name][9][0]) ref_count++; // name must proceed by the count of eliminated in above.  THIS IS A BUG.\r\n// BUG\r\n                if (tgts!==undefined) if (tgts[name]!==undefined) tgts_count--;\r\n              }\r\n            }\r\n            i++;\r\n          }\r\n          if (triage_thread===name) triage_thread = null;\r\n        }\r\n        if (mode_merge_tails) i = mode_merge_tails -1;\r\n        this.drawn_idx = (!draw_on_demand || i==this.idxs.length)? true : (i<i_start)? i_start : i;\r\n        if (this.lazy_draw) this.lazy_draw();\r\n//        if (this.drawn_idx_mb!=-1) this.restore_mb_state();\r\n//        if (appeared.length!=0 && sound) notifier.appeared(appeared,threads);\r\n//var str_debug = '';\r\n//for (var d=0;d<threads_idx.length;d++) if (threads[threads_idx[d]][1] && threads[threads_idx[d]][9][0]) str_debug += threads_idx[d] + threads[threads_idx[d]][8][pref.catalog.indexing] + ',';\r\n//console.log(str_debug);\r\n////        if (catalog_expand_with_hr)\r\n////          for (var i=triage_parent.childNodes.length-2;i>=0;i--)\r\n////            if (triage_parent.childNodes[i].tagName==='HR' && triage_parent.childNodes[i+1].tagName==='HR') triage_parent.removeChild(triage_parent.childNodes[i+1]);\r\nif (pref.debug_mode['11'] && embed_mode!=='thread' && !pref[embed_mode].merge) {\r\n        var flag = -1;\r\n        var d_count = 0;\r\n        for (var d=0;d<i;d++) {\r\n          if (this.idxs[d][0]!=='O' && this.threads[this.idxs[d]][1]) {\r\n            var dbt = common_func.fullname2dbt(this.idxs[d]);\r\n            var tgt,tgt_bt;\r\n            if (embed_mode==='page' && site.nickname==='4chan') {\r\n              tgt = this.ppn.getElementsByClassName('CatChan_thread')[d_count++];\r\n              tgt_bt = site.board + tgt.id.substr(1);\r\n            } else if (embed_mode==='page' && site.nickname==='8chan') {\r\n              tgt = this.ppn.getElementsByClassName('CatChan_thread')[d_count++];\r\n              tgt_bt = '/' + tgt.getAttribute('data-board') + '/' + tgt.id.substr(7);\r\n            } else {\r\n              tgt = this.ppn.childNodes[pref[embed_mode].env.disp_offset + d_count++];\r\n              tgt_bt = (embed_mode==='page')? '/' + tgt.getAttribute('data-board') + '/' + tgt.id.substr(7) :\r\n                                              tgt.getElementsByTagName('a')[0].getAttribute('href').replace('res/','').replace('.html','').replace(/.*lainchan.org/,'').replace(/.*8ch.net/,'').replace('thread/','').replace(/.*4chan.org/,'').replace(/.*meguca.org/,'').replace(/.*krautchan.net/,'').replace(/thread\\-/,'');\r\n              if (dbt[0]==='4chan' && embed_mode==='catalog') tgt_bt = tgt_bt.substr(0,tgt_bt.lastIndexOf('/'));\r\n            }\r\n            if (dbt[1]+dbt[2]!==tgt_bt) {\r\n              var debug_str4='';\r\n              for (var j=d+1;j<d+5;j++) debug_str4 += this.idxs[j]+', ';\r\n              console.log('ERROR: '+d+', '+tgt_bt+', '+this.idxs[d]+': '+i+', '+debug_str4);\r\n              flag = i;\r\n            }\r\n          }\r\n        }\r\n        var debug_str3 = threads_idx_debug(this.drawn_idx, this.drawn_y, this.ref_count, this.idxs);\r\n        if (flag!=-1) {\r\n          console.log('PREV: '+debug_str2);\r\n          console.log('IN:   '+debug_str);\r\n          for (var i=0;i<flag+5;i++) if (this.ppn.childNodes[i]) console.log(this.ppn.childNodes[i]);\r\n          console.log('OUT:  '+debug_str3);\r\n//          console.trace();\r\n        } else {\r\n//          console.log('OK: '+debug_str);\r\n        }\r\n        debug_str2 = debug_str3;\r\n}\r\n      },\r\n      func_show: function(name,ref){\r\n        this.ppn.insertBefore(this.threads[name][0],(ref && ref.parentNode===this.ppn)? ref : null); // if many threads are removed, ref refers horizontal splitter.\r\n        return true;\r\n      },\r\n      func_hide: /*(site.whereami!=='archive')?*/ function(name){\r\n        this.ppn.removeChild(this.threads[name][0]);\r\n        return true;\r\n//      } : function(name){ // patch\r\n//        threads[name][0].parentNode.removeChild(threads[name][0]);\r\n//        return true;\r\n      },\r\n      func_track_shown: function(name, update_drawn_y){\r\n        if (update_drawn_y) this.drawn_y = this.threads[name][0].offsetTop; // for faster execution. DOM function is too heavy.\r\n        this.ref_count += this.ref_step;\r\n      },\r\n      func_track_reset: function(){\r\n        this.ref_count = this.ref_count_init;\r\n        this.drawn_y = -1;\r\n        this.drawn_idx= 0; // temporal patch, should be this.drawn_idx\r\n//        cataLog.Footer.timestamp_inc();\r\n      },\r\n//      backup_mb_state: function(idx){\r\n//        if (this.drawn_idx_mb==-1) {\r\n//          this.drawn_idx_mb = idx;\r\n//          this.ref_count_mb = this.ref_count;\r\n//        }\r\n//      },\r\n//      restore_mb_state: function(){\r\n//        drawn_idx = this.drawn_idx_mb;\r\n//        this.ref_count = this.ref_count_mb;\r\n//      },\r\n      permit_draw_on_demand: true,\r\n      ref_step: 1,\r\n      drawn_y: -1, // for floating catalog\r\n      ref_count: 0,\r\n      ref_count_init: 0,\r\n//      drawn_idx_mb: -1,\r\n//      ref_count_mb: 0,\r\n    };\r\n\r\n      if (pref.test_mode['96'] && embed_mode==='catalog') { // test for faster execution, removes redundant queries of offsetTop\r\n        catalog_obj2_proto = {\r\n          func_track_shown: (function(func_org){\r\n            return function(name, update_drawn_y){\r\n             var y_old = this.drawn_y;\r\n              var check_y = this.od_count%this.od_width==0;\r\n              func_org.call(this, name, update_drawn_y && check_y);\r\n              if (check_y && y_old==this.drawn_y) this.od_width++;\r\n              this.od_count++;\r\n            }\r\n          })(catalog_obj2_proto.func_track_shown),\r\n          func_track_reset: (function(func_org){\r\n            return function(){\r\n              func_org.call(this);\r\n              this.od_count = 0;\r\n            };\r\n          })(catalog_obj2_proto.func_track_reset),\r\n          func_od_reset: function(){\r\n            this.od_width = 1;\r\n            show_catalog_cont();\r\n          },\r\n          od_width: 1, // on_demand_mode\r\n          od_count: 0,\r\n          __proto__: catalog_obj2_proto\r\n        };\r\n      }\r\n      scroll_event_src.addEventListener('scroll', show_catalog_cont, false);\r\n      window.addEventListener('resize', (pref.test_mode['96'] && embed_mode==='catalog')? catalog_obj2_proto.func_od_reset.bind(catalog_obj2_proto) : show_catalog_cont, false);\r\n      var catalog_obj2 = catalog_obj2_proto;\r\n      if (embed_mode==='page' && site2[site.nickname].all_boards && site2[site.nickname].all_boards.indexOf(site.board)!=-1) { // PATCH\r\n        catalog_obj2 = {\r\n          func_show: function(name){\r\n            var ch = this.threads[name][0];\r\n            if (ch.previousSibling && ch.previousSibling.tagName==='H2') {\r\n              ch.previousSibling.style.display = '';\r\n              ch.style.display = '';\r\n              return true;\r\n            } else return false;\r\n          },\r\n          func_hide: function(name){\r\n            var ch = this.threads[name][0];\r\n            if (ch.previousSibling && ch.previousSibling.tagName==='H2') {\r\n              ch.previousSibling.style.display = 'none';\r\n              ch.style.display = 'none';\r\n              return true;\r\n            } else return false;\r\n          },\r\n          permit_draw_on_demand: false,\r\n          __proto__: catalog_obj2_proto\r\n        }\r\n////////      } else if (pref[embed_mode].merge) { // TEST // working code, but very slow because of basesd on HTML.\r\n////////        var base_name = site.nickname + site.board + site.no;\r\n////////        catalog_obj2 = {\r\n////////          func_show_hide: function(name, show_or_hide){\r\n////////            if (embed_mode==='thread' && base_name===name) return true;\r\n////////            var myself = site2[site.nickname].update_posts_prep_merge();\r\n////////            var dst = myself.posts;\r\n////////            var pnode = myself.pn;\r\n////////            var dbt = name.split('/');\r\n////////            var posts = threads[name][16].posts;\r\n////////            var src = {domain:dbt[0], board:dbt[1], no:dbt[2], posts:posts};\r\n////////            if (show_or_hide) {\r\n//////////////////              var j = dst.posts.length-1;\r\n//////////////////              var i = posts.length-1;\r\n//////////////////              while (i>=0) {\r\n//////////////////                while (j>0 && dst.posts[j].time>posts[i].time) j--;\r\n//////////////////                if (dst.posts[j].com===posts[i].com) break;\r\n//////////////////                else i--;\r\n//////////////////              }\r\n//////////////////              while (++i<posts.length) {\r\n//////////////////                while (j<dst.posts.length && dst.posts[j].time<posts[i].time) j++;\r\n//////////////////                site2[site.nickname].update_posts_insert(src, dst, i, j, pnode);\r\n//////////////////              }\r\n////////////              var time_merged = threads[name][16].time_merged || 0; // working code.\r\n////////////              var i = 0;\r\n////////////              var j = 0;\r\n//////////////              var scroll_add = 0;\r\n//////////////              var now_height = (pref[embed_mode].scroll_lock && !init)? get_now_height() : 0;\r\n//////////////              var now_height_tmp = now_height;\r\n////////////              if (time_merged!==0) {\r\n////////////                i = posts.length;\r\n////////////                while (i>0 && posts[i-1].time>time_merged) i--;\r\n////////////                j = dst.posts.length;\r\n////////////                while (j>0 && dst.posts[j-1].time>time_merged) j--;\r\n////////////              }\r\n////////////              while (i<posts.length) {\r\n////////////                while (j<dst.posts.length && (dst.posts[j].time<posts[i].time || dst.posts[j].time==posts[i].time && dst.posts[j].no<=posts[i].no)) j++;\r\n////////////                site2[site.nickname].update_posts_insert(src, dst, i++, j, pnode);\r\n//////////////                var add_val = site2[site.nickname].update_posts_insert(src, dst, i++, j, pnode, now_height_tmp); // slow\r\n//////////////                if (add_val!==null) scroll_add += add_val;\r\n//////////////                else now_height_tmp = 0;\r\n////////////                if (pref[embed_mode].scroll_lock) show_catalog_scroll_lock.modified(src.posts[i-1]);\r\n////////////              }\r\n////////////              threads[name][16].time_merged = posts[posts.length-1].time;\r\n//////////////              if (scroll_add) window.scrollTo(0,now_height + scroll_add);\r\n////////              site2[site.nickname].update_posts_insert_merge(src.posts,0);\r\n////////            } else {\r\n//////////              var back = 0;\r\n//////////              var now_height;\r\n//////////              if (pref[embed_mode].scroll_lock) now_height = get_now_height();\r\n////////              for (var i=posts.length-1;i>=0;i--) {\r\n//////////                if (pref[embed_mode].scroll_lock) if (src.posts[i].offsetTop<now_height) back += src.posts[i].offsetHeight; // TEST, SHOULD INCLUDE container.\r\n////////                if (src.posts[i].pn) site2[site.nickname].update_posts_remove(src, i, pnode, true);\r\n////////              }\r\n//////////              if (back) window.scrollTo(0,now_height-back);\r\n////////              threads[name][16].time_merged = 0;\r\n////////            }\r\n////////            return true;\r\n////////          },\r\n////////          func_show: function(name){if (!threads[name][1]) this.func_show_hide(name, true); return true;},\r\n////////          func_hide: function(name){if ( threads[name][1]) this.func_show_hide(name, false);return true;},\r\n////////          permit_draw_on_demand: false,\r\n////////          __proto__: catalog_obj2_proto\r\n////////        }\r\n////////        if (embed_mode==='page') {\r\n////////          var top = site2[site.nickname].wrap_to_parse.get(document, site.nickname, site.board, 'page_html', {page:0})[0];\r\n////////          catalog_obj2.base_name = site.nickname + site.board + top.no;\r\n////////          site2['DEFAULT'].update_posts_merge_base = top.pn;\r\n////////        }\r\n//////////        if (pref[embed_mode].scroll_lock && site2[site.nickname].update_posts_remove_lock) {// TEST // TOO SLOW\r\n//////////          site2[site.nickname].update_posts_remove = site2[site.nickname].update_posts_remove_lock;\r\n//////////          site2[site.nickname].update_posts_insert = site2[site.nickname].update_posts_insert_lock;\r\n//////////        }\r\n////////        show_catalog_init_funcs = (embed_mode==='page')? function(){\r\n////////          for (var name in threads)\r\n////////          if (threads[name][0]!==site2['DEFAULT'].update_posts_merge_base && threads[name][0].parentNode===triage_parent) {\r\n////////            if (threads[name][0].nextSibling.tagName==='HR') triage_parent.removeChild(threads[name][0].nextSibling);\r\n////////            triage_parent.removeChild(threads[name][0]);\r\n////////            catalog_obj2.func_show_hide(name, true);\r\n////////          }\r\n////////        } : null;\r\n      } else if (pref[embed_mode].env.disp_filler) {\r\n        catalog_obj2 = catalog_obj2_factory_filler((pref[embed_mode].env.disp_filler[0]==='<')? document.createElement('hr') : document.createTextNode(pref[embed_mode].env.disp_filler));\r\n      } else if (embed_mode==='float' && pref.catalog_expand_with_hr) {\r\n        catalog_obj2 = {\r\n          func_show: function(name,ref){\r\n            if (this.threads[name][1]) show_catalog_hr(name,'remove');\r\n            this.ppn.insertBefore(this.threads[name][0],(ref && ref.parentNode===this.ppn)? ref : null); // if many threads are removed, ref refers horizontal splitter.\r\n            show_catalog_hr(name,'add');\r\n            return true;\r\n          },\r\n          func_hide: function(name){\r\n            show_catalog_hr(name,'remove');\r\n            this.ppn.removeChild(this.threads[name][0]);\r\n            return true;\r\n          },\r\n          func_track_shown: function(name, update_drawn_y){\r\n            this.__proto__.func_track_shown.call(this, name, update_drawn_y);\r\n            this.ref_count = show_catalog_skip_hs(this.ref_count);\r\n          },\r\n          __proto__: catalog_obj2_proto\r\n        }\r\n//        var pctrls = triage_parent;\r\n//        for (var i=pctrls.childNodes.length-1;i>=0;i--) if (pctrls.childNodes[i].tagName==='HR') pctrls.removeChild(pctrls.childNodes[i]);\r\n//        pctrls.parentNode.insertBefore(document.createElement('hr'),pctrls.nextSibling);\r\n      }\r\n      function catalog_obj2_factory_filler(filler){\r\n        return {\r\n          func_show: function(name,ref){\r\n            var hr = this.threads[name][1] && this.threads[name][0].nextSibling || this.filler.cloneNode(false); // for 4chan, lastChild.nextSibling === null.\r\n//            var hr = (threads[name][1])? threads[name][0].nextSibling : this.filler.cloneNode(false);\r\n            this.ppn.insertBefore(this.threads[name][0],ref);\r\n            this.ppn.insertBefore(hr,ref);\r\n            return true;\r\n          },\r\n          func_hide: function(name){\r\n            this.ppn.removeChild(this.threads[name][0].nextSibling);\r\n            this.ppn.removeChild(this.threads[name][0]);\r\n            return true;\r\n          },\r\n          ref_step: 2,\r\n          filler: filler,\r\n          __proto__: catalog_obj2_proto\r\n        };\r\n      }\r\n      common_func.Object_defProps(Clg.prototype, catalog_obj2);\r\n      var show_catalog = pClg.show_catalog.bind(pClg);\r\n//      var show_catalog = (catalog_obj2)? catalog_obj2.show_catalog.bind(catalog_obj2) :\r\n//                                         catalog_obj2_proto.show_catalog.bind(catalog_obj2_proto);\r\n      cataLog.show_catalog = show_catalog;\r\n      cataLog.catalog_obj2 = pClg; // Clg.prototype;\r\n//      cataLog.catalog_obj2 = catalog_obj2;\r\n//      var show_catalog_db_th100 = new DelayBuffer(show_catalog, pref.network.th100_delay);\r\n//      var show_catalog_db_th20 = new DelayBuffer(show_catalog, pref.network.th20_delay);\r\n\r\nfunction threads_idx_debug(idx,y,count, threads_idx){\r\n  var str = 'drawn_idx:'+idx+', drawn_y:'+y+', ref_count:'+count+' ';\r\n  for (var i=0;i<threads_idx.length;i++) if (!threads[threads_idx[i]] || threads[threads_idx[i]][1]) str += threads_idx[i]+', ';\r\n  str += '::: '+JSON.stringify(threads_idx);\r\n  return str;\r\n}\r\n      var load_on_demand = (function(){\r\n        var mutex = true;\r\n        var timer = null;\r\n        function release(){\r\n          if (timer) {\r\n            clearTimeout(timer);\r\n            timer = null;\r\n          }\r\n          mutex = true;\r\n        }\r\n        return {\r\n          call: function(tgts){\r\n            if (this.get()) {\r\n              threads_index.idx_delete_odl(tgts);\r\n              scan_boards.scan_init('on_demand_load', tgts, {refresh:true, crawler_max:1, callback:load_on_demand.release_draw});\r\n              return true;\r\n            } else return false;\r\n          },\r\n          release: release,\r\n          release_draw: function(){release();show_catalog();},\r\n          get: function(){\r\n            var retval = mutex;\r\n            if (retval) timer = setTimeout(release, pref.catalog_load_on_demand_timeout*1000);\r\n            mutex = false;\r\n            return retval;\r\n          }\r\n        }\r\n      })();\r\n\r\n      function show_catalog_skip_hs(ref_count){\r\n        var c_len = triage_parent.childNodes.length;\r\n        var class_hs = pref.script_prefix+'_hs';\r\n//        while (ref_count<c_len && triage_parent.childNodes[ref_count].className===class_hs) ref_count++;\r\n        if (ref_count<c_len && triage_parent.childNodes[ref_count].className===class_hs) ref_count++;\r\n        return ref_count;\r\n      }\r\n      function show_catalog_hr(name,func){\r\n        if (embed_mode==='catalog') return;\r\n        var pn = threads[name][0];\r\n        var class_hs = pref.script_prefix+'_hs';\r\n        if (func==='add' && pn.style.width==='' && pn.style.height==='') {\r\n          if (pn.previousSibling && pn.previousSibling.className!==class_hs) pn.parentNode.insertBefore(site2[site.nickname].horizontal_separator_in_index(),pn);\r\n          if (pn.nextSibling && pn.nextSibling.className!==class_hs) pn.parentNode.insertBefore(site2[site.nickname].horizontal_separator_in_index(),pn.nextSibling);\r\n        }\r\n        if (func==='shrink' || func==='remove' && pn.style.width==='' && pn.style.height==='' || func==='add' && (pn.style.width!=='' || pn.style.height!=='')) {\r\n          var pn_test = (pn.previousSibling && pn.previousSibling.className===class_hs)? pn.previousSibling.previousSibling : null;\r\n          if (pn_test && (pn_test.style.width!=='' || pn_test.style.height!=='')) pn.parentNode.removeChild(pn.previousSibling);\r\n          var pn_test = (pn.nextSibling && pn.nextSibling.className===class_hs)? pn.nextSibling.nextSibling : null;\r\n          if (pn_test && (pn_test.style.width!=='' || pn_test.style.height!=='')) pn.parentNode.removeChild(pn.nextSibling);\r\n        }\r\n        if (func==='remove') {\r\n//          if (pn.previousSibling && pn.previousSibling.className===class_hs && pn.nextSibling && pn.nextSibling.className===class_hs) pn.parentNode.removeChild(pn.previousSibling); // BUG IN 8ch page mode, remoev first br and 'ref' becomes null.\r\n          if (pn.previousSibling && pn.previousSibling.className===class_hs && pn.nextSibling && pn.nextSibling.className===class_hs) pn.parentNode.removeChild(pn.nextSibling);\r\n//          if (pn.nextSibling && pn.nextSibling.className===class_hs && pn.nextSibling.nextSibling && pn.nextSibling.nextSibling.className===class_hs) pn.parentNode.removeChild(pn.nextSibling);\r\n        }\r\n      }\r\n\r\n////      function show_catalog_hr(name,func){ // working code.\r\n////        var pn = threads[name][0];\r\n//////        var sibls = ['previousSibling', 'nextSibling'];\r\n//////        if (pn.style.width==='' && pn.style.height==='') {\r\n//////          for (var i=0;i<sibls.length;i++)\r\n//////            while (pn[sibls[i]] && pn[sibls[i]].tagName==='HR' && pn[sibls[i]][sibls[i]].tagName==='HR') pn.parentNode.removeChild(pn[sibls[i]]);\r\n////        if (func==='add' && pn.style.width==='' && pn.style.height==='') {\r\n////          if (pn.previousSibling && pn.previousSibling.tagName!=='HR') pn.parentNode.insertBefore(document.createElement('hr'),pn);\r\n////          if (pn.nextSibling && pn.nextSibling.tagName!=='HR') pn.parentNode.insertBefore(document.createElement('hr'),pn.nextSibling);\r\n////        }\r\n////        if (func==='shrink' || func==='remove' && pn.style.width==='' && pn.style.height==='' || func==='add' && (pn.style.width!=='' || pn.style.height!=='')) {\r\n////          var pn_test = (pn.previousSibling && pn.previousSibling.tagName==='HR')? pn.previousSibling.previousSibling : null;\r\n////          if (pn_test && (pn_test.style.width!=='' || pn_test.style.height!=='')) pn.parentNode.removeChild(pn.previousSibling);\r\n////          var pn_test = (pn.nextSibling && pn.nextSibling.tagName==='HR')? pn.nextSibling.nextSibling : null;\r\n////          if (pn_test && (pn_test.style.width!=='' || pn_test.style.height!=='')) pn.parentNode.removeChild(pn.nextSibling);\r\n////        }\r\n////        if (func==='remove') {\r\n////          if (pn.previousSibling && pn.previousSibling.tagName==='HR' && pn.nextSibling && pn.nextSibling.tagName==='HR') pn.parentNode.removeChild(pn.previousSibling);\r\n//////          for (var i=0;i<sibls.length;i++) {\r\n//////            var pn_test = pn[sibls[i]][sibls[i]];\r\n//////            if (pn_test.tagName==='DIV' && pn_test.style && (pn_test.style.width!=='' || pn_test.style.height!=='')) pn.parentNode.removeChild(pn[sibls[i]]);\r\n//////          }\r\n////        }\r\n////      }\r\n\r\n      function catalog_attr_set(name,pn){\r\n        var tgt_th = threads[name];\r\n        var val = null;\r\n        if (pref.catalog.filter.attr_list) {\r\n          if (pref.catalog.style_general_list) val = pref_func.merge_obj5(name,pref.catalog.style_general_list_obj2,val);\r\n          if (pref.catalog.filter.attr_list)   val = pref_func.merge_obj5(name,pref.catalog.filter.attr_list_obj2,val);\r\n        }\r\n//        if (val && val.style) {\r\n////          var styles = val.style.split(';');\r\n////          for (var i=0;i<styles.length;i++) {\r\n////            var stl = styles[i].split(':');\r\n////            pn.style[stl[0]] = stl[1];\r\n////          }\r\n////console.log('catalog_attr_set :'+name+', '+val.toSource());\r\n////          for (var stl in val)\r\n////            if (stl.indexOf('style')==0) pn.style[stl.substr(6)] = val[stl];\r\n////          for (var stl in val) {\r\n////            if (stl.indexOf('style')==0 && stl.length>6) pn.style[stl.substr(6)] = val[stl];\r\n////            if (stl.indexOf('style')==0 && stl.length>6) {\r\n////              pn.setAttribute('style',pn.getAttribute('style')+stl.substr(6)+':'+val[stl]+';');\r\n////              console.log('catalog_attr_set_1 :'+name+', '+pn.getAttribute('style')+';'+stl.substr(6)+val[stl]+':');\r\n////            }\r\n////          }\r\n//          for (var stl in val.style) pn.style[stl] = val.style[stl];\r\n        //        }\r\n        if (tgt_th[0]) {\r\n          var rollback_info = tgt_th[22];\r\n          if (val && val.style) {\r\n            for (var stl in val.style) {\r\n              if (!(stl in rollback_info)) rollback_info[stl] = pn.style[stl];\r\n              pn.style[stl] = val.style[stl];\r\n            }\r\n          }\r\n          for (var stl in rollback_info) {\r\n            if (!val || !val.style || !(stl in val.style)) {\r\n              if (rollback_info[stl]===undefined) delete pn.style[stl];\r\n              else pn.style[stl] = rollback_info[stl];\r\n              delete rollback_info[stl];\r\n            }\r\n          }\r\n        }\r\n        if (val && val.cmd || tgt_th[20] || tgt_th[16].icon_show_always || tgt_th[16].systemSticky) {\r\n//        if (val && val.cmd || tgt_th[16].icon_sticky || tgt_th[16].icon_show_always || tgt_th[16].systemSticky) {\r\n          var sticky = !!((val && val.cmd && val.cmd['sticky']!==undefined)? val.cmd['sticky'] : tgt_th[16].systemSticky); // !! for ^\r\n          if (sticky ^ tgt_th[20]) {\r\n            tgt_th[20] = sticky;\r\n            threads_index.idx_reorder(name);\r\n            flag_redraw = true;\r\n            if (show_catalog && tgt_th[0]) show_catalog(name); // 'if (show_catalog)' is a patch.\r\n          }\r\n          if (tgt_th[20] != tgt_th[16].icon_sticky) tgt_th[16].icon_sticky = site2[site.nickname].set_icon(tgt_th[0],tgt_th[16].type_html, 'sticky', tgt_th[16], sticky); // pass always because of lazy draw, pn was not prepared at initial.\r\n          var showAlways = val && val.cmd && val.cmd['show'];\r\n          if (showAlways ^ !!tgt_th[16].icon_show_always) { // show\r\n            tgt_th[16].icon_show_always = site2[site.nickname].set_icon(tgt_th[0],tgt_th[16].type_html, 'show_always', tgt_th[16]);\r\n            tgt_th[16].show_always = showAlways; // for lazy pn generation.\r\n            tgt_th[9] = catalog_filter_query(name);\r\n            if (show_catalog && tgt_th[0]) show_catalog(name); // 'if (show_catalog)' is a patch.\r\n          }\r\n        }\r\n      }\r\n    \r\n////      function catalog_obj_merge(name,obj,val){\r\n////        var dbt = cnst.name2domainboardthread(name,true);\r\n////        if (val===null) val = {hit:false};\r\n////        val = catalog_obj_merge_1(val,obj,'DEFAULT');\r\n////        val = catalog_obj_merge_1(val,obj,dbt[0]); // domain\r\n////        val = catalog_obj_merge_1(val,obj,dbt[1]); // board\r\n////        val = catalog_obj_merge_1(val,obj,dbt[0]+dbt[1]); // domain+board\r\n////        val = catalog_obj_merge_1(val,obj,dbt[2]); // thread\r\n////        val = catalog_obj_merge_1(val,obj,dbt[0]+dbt[2]); // domain+thread\r\n////        val = catalog_obj_merge_1(val,obj,dbt[1]+dbt[2]); // board+thread\r\n////        val = catalog_obj_merge_1(val,obj,name);\r\n////        return val;\r\n////      }\r\n////      function catalog_obj_merge_1(val,obj,key){\r\n////        if (obj[key]) {\r\n////          for (var i in obj[key])\r\n//////            if (val[i]===undefined || typeof(obj[key][i])!=='object') val[i] = obj[key][i];\r\n//////            else for (var j in obj[key][i]) val[i][j] = obj[key][i][j]; // 2nd level.\r\n////            if (typeof(obj[key][i])!=='object') val[i] = obj[key][i];\r\n////            else {\r\n////              if (val[i]===undefined) val[i]={};\r\n////              for (var j in obj[key][i]) val[i][j] = obj[key][i][j]; // 2nd level.\r\n////            }\r\n////          val.hit = true;\r\n////        }\r\n////        return val;\r\n////      }\r\n\r\n      function filter_kwd_prep_init(e, kwd, init) {\r\n        kwd.str_old = '';\r\n        kwd.fail_list = {};\r\n        kwd.suc_list  = {};\r\n        filter_kwd_prep(e, kwd, init);\r\n      }\r\n      function filter_kwd_prep(e, kwd, init) {\r\n        if (!kwd) kwd = pref.catalog.filter.kwd;\r\n        kwd.rexps = common_func.kwd_prep_regexp(kwd);\r\n//        kwd.timestamp = Date.now(); // not saved because pref.default() don't geenrate this.\r\n        filter_kwd_active(e, kwd, init);\r\n      }\r\n      var filter_kwd_count = 0;\r\n      function filter_kwd_active(e, kwd, init) {\r\n        if (!kwd) kwd = pref.catalog.filter.kwd;\r\n        var val_old = kwd.posts_active;\r\n        var basic_active = kwd.use && kwd.rexps && (kwd.sub || kwd.name || kwd.com || kwd.file || kwd.meta || kwd.trip || kwd.id || kwd.flag);\r\n        kwd.active       = basic_active && (kwd.op || kwd.post);\r\n        kwd.posts_active = basic_active &&            kwd.post;\r\n        pref4.search_posts_active_once |= kwd.posts_active;\r\n        if (!init && !kwd.posts_active && val_old) format_html.posts_search_inactivated();\r\n        kwd.timestamp = filter_kwd_count++; // not saved because pref.default() don't geenrate this. // use single entity for multi catalog or switching pref.*.filter object.\r\nif (!pref.test_mode['59']) {\r\n        if (e && e.target.name==='catalog.filter.kwd.str' && kwd.match===0 && (!kwd.re || /^[\\w\\s]*$/.test(kwd.str+kwd.str_old))) {\r\n          for (var i in kwd.fail_list) {\r\n            if (kwd.str.indexOf(kwd.fail_list[i])!==0) delete kwd.fail_list[i];\r\n            else if (kwd.fail_list[i]===kwd.str) kwd.timestamp = i;\r\n          }\r\n          for (var i in kwd.suc_list) {\r\n            if (kwd.suc_list[i].indexOf(kwd.str)!==0) delete kwd.suc_list[i];\r\n            else if (kwd.suc_list[i]===kwd.str) kwd.timestamp = i;\r\n          }\r\n        } else {\r\n          kwd.fail_list = {};\r\n          kwd.suc_list  = {};\r\n        }\r\n        if (kwd.str) {\r\n          kwd.fail_list[kwd.timestamp] = kwd.str;\r\n          kwd.suc_list[kwd.timestamp]  = kwd.str;\r\n        }\r\n}\r\n        if (!init) catalog_filter_changed();\r\n      }\r\n      var catalog_filter_query_keyword = (function(){\r\n        function query_1(kwd, rexp, posts, domain, th){\r\n          if (kwd.op) if (query_11(kwd, rexp, posts[0].DUMMY && th || posts[0], domain)) return true;\r\n          if (kwd.post) for (var j=1;j<posts.length;j++) if (query_11(kwd, rexp, posts[j], domain)) return true;\r\n          return false;\r\n        }\r\n//        function query_1(kwd, rexp, posts, domain, th){ // working code.\r\n//          var post_array = Array.isArray(posts);\r\n//          var start = (!post_array || kwd.op)? 0 : 1; // temporarily\r\n//          var end   = ( post_array && kwd.post)? posts.length : 1; // tamporarily\r\n//          for (var j=start;j<end;j++) {\r\n//            var pst = (post_array)? posts[j] : (j==0)? posts : null;\r\n//            if (pst && query_11(kwd, rexp, pst, domain)) return true; // if posts are not exist, th.posts becomes 'undefined'.\r\n//          }\r\n//          return false;\r\n//        }\r\n////        var com2txt_flag = false; // SLOW.\r\n////        var com2txt_rexp = /<[^>]*>|&([#\\w\\d]*);/g\r\n////        var com2txt_subs = {\r\n////          gt : '>',\r\n////          lt : '<',\r\n////          amp: '&',\r\n////          hellip: '\\u2026',\r\n////          larr: '\\u2190',\r\n////          rarr: '\\u2192',\r\n////          mdash: '\\u2014',\r\n////          ndash: '\\u2013',\r\n////          qout:'\"', // 4chan\r\n////          '#039':\"'\", // 4chan\r\n////          '#044':',', // 4chan\r\n////          '#44' :',', // 4chan\r\n////        };\r\n////        function com2txt(match,p1,offset,string){\r\n////          if (match[0]==='&') {\r\n////            var retval = com2txt_subs[p1];\r\n////            if (retval) return retval;\r\n////            com2txt_flag = true;\r\n////            if (pref.debug_mode['17']) console.log('not interpreted html: '+match+', '+string);\r\n////          }\r\n////          return ' '; // case of <[^>]*> or not interpreetd.\r\n////        }\r\n        var pn_com = document.createElement('div');\r\n//        var pn_com = document.createElement('textarea'); // preserve tags in HTML. // slower than div.\r\n        function query_11(kwd, rexp, pst, domain){\r\n          if (kwd.sub)  if (pst.sub  && rexp.test(pst.sub )) return true;\r\n          if (kwd.name) if (pst.name && rexp.test(pst.name)) return true;\r\n//          if (kwd.com)  if (pst.com) {\r\n          if (kwd.com) {\r\n            if (pst.parse_funcs && pst.parse_funcs.type_com==='txt') { //  || pref.test_mode['53']) {\r\n              if (rexp.test(pst.body || pst.com)) return true; // fastest, speed ratio: part/total = 1/1.\r\n            } else {\r\n//              if (!pref.test_mode['54']) {\r\n////                if (!pref.test_mode['57']) {\r\n              var txt = site2[domain].post_com2txt(pst); // 9.4/1.99 for lainchan, 13.07/2.38 for 4chan.\r\n              if (txt && rexp.test(txt)) return true;\r\n//                var txt = site2[domain].post_com2txt(pst); // 9.4/1.99 for lainchan, 13.07/2.38 for 4chan.\r\n//                if (txt) {\r\n//                  if (txt.search(/&[#\\w\\d]+;/)!=-1 && !pref.test_mode['58']) {\r\n//                    if (pref.debug_mode['17']) console.log('not interpreted html: '+txt);\r\n//                    pn_com.innerHTML = pst.com; // giving com is faster than giving txt.\r\n//                    txt = pn_com[brwsr.innerText];\r\n//                  }\r\n//                  if (rexp.test(txt)) return true;\r\n//                }\r\n//////                } else { // SLOW.\r\n//////                  com2txt_flag = false;\r\n////////                  var txt = pst.com.replace(com2txt_rexp, com2txt); // StringReplaceGlobalRegexpWithfunction is heavy. 19.76/3.33\r\n//////                  var txt = pst.com.replace(/<[^>]*>|&([#\\w\\d]*);/g, com2txt); // This still outs StringReplaceGlobalRegexpWithfunction.\r\n//////                  if (com2txt_flag) {\r\n//////                    pn_com.innerHTML = pst.com;\r\n//////                    txt = pn_com[brwsr.innerText];\r\n//////                  }\r\n//////                  if (rexp.test(txt)) return true;\r\n//////                }\r\n////              } else {\r\n////                pn_com.innerHTML = (!pref.test_mode['55'])? pst.com :  // TOO SLOW!!!. 53.72/7.65\r\n////                                                            pst.com.replace(/<[^>]*>/g,' ');  // TOO SLOW, FURTHER!!!. 60.51/8.21\r\n////                if (rexp.test(pn_com[brwsr.innerText])) return true;\r\n////              }\r\n            }\r\n          }\r\n          if (kwd.trip) if (pst.trip && rexp.test(pst.trip)) return true;\r\n          if (kwd.id) if (pst.id && rexp.test(pst.id)) return true;\r\n          if (kwd.file) {\r\n            if (pst.filename && rexp.test(pst.filename)) return true;\r\n            if (pst.extra_files)\r\n              for (var k=pst.extra_files.length-1;k>=0;k--)\r\n                if (pst.extra_files[k].filename && rexp.test(pst.extra_files[k].filename)) return true;\r\n          }\r\n          if (kwd.meta) if (pst.no && rexp.test(pst.no)) return true;\r\n          if (kwd.flag) if (pst.country && rexp.test(pst.country)) return true;\r\n          return false;\r\n        }\r\n        return {\r\n          kwd: function(kwd,posts, domain, th){\r\n            if (!kwd.use || !kwd.rexps) return true;\r\n//            var retval = kwd.match<2; // working code.\r\n//            if (kwd.match%2===0) { // all\r\n//              for (var i=0;i<kwd.rexps.length;i++) if (retval!==query_1()) return false;\r\n//              return true;\r\n//            } else {\r\n//              for (var i=0;i<kwd.rexps.length;i++) if (retval===query_1()) return true;\r\n//              return false;\r\n//            }\r\n            var any_or_all = kwd.match%2===1; // undefined means all\r\n            var testval = !!((kwd.match>=2) ^ any_or_all);\r\n            for (var i=0;i<kwd.rexps.length;i++) if (testval===query_1(kwd, kwd.rexps[i], posts, domain, th)) return any_or_all;\r\n            return !any_or_all;\r\n          },\r\n          kwd_1: function(kwd,posts, domain){ // for single post, match any or unmatch all.\r\n            var unmatch_or_match = kwd.match>=2; // undefined means match\r\n            for (var i=0;i<kwd.rexps.length;i++) if (query_11(kwd, kwd.rexps[i], posts, domain)) return !unmatch_or_match; // match any or unamtch all\r\n            return unmatch_or_match;\r\n          },\r\n          kwd_make_result: function(posts, domain, kwd){\r\n            if (!kwd) kwd = pref.catalog.filter.kwd;\r\n            var result = [Object.create(posts[0])]; // not to change source for 'posts_search_miss'. // BUG. wrapper just add protptpye to itself, it doesn't take this into account, but patched.\r\n//            var result = [posts[0]]; // can't update omitted info in page mode.\r\n            result[0].search_result = this.kwd_1(kwd, posts[0], domain);\r\n            for (var i=1;i<posts.length;i++) if (this.kwd_1(kwd, posts[i], domain)) result[result.length] = posts[i];\r\n            return (result.length!=1 || result[0].search_result)? result : null;\r\n          },\r\n          auto_list: function(th, obj){\r\n            for (var i=0;i<obj.length;i++)\r\n              if (obj[i].use!==false && this.kwd({use:true, __proto__:obj[i]}, th.posts, th.domain, th)) {\r\n                var cmds = obj[i].cmds.split(',');\r\n                for (var j=0;j<cmds.length;j++) {\r\n                  var idx = cmds[j].indexOf(':');\r\n                  if (idx===-1) triage_exe_0(th.key, cmds[j], ''); // CAUTION: TRIAGE IS SLOW BECAUSE IT IS DESIGNED TO BE USED GUI, it redraws doms and remake objs always.\r\n                  else triage_exe_0(th.key, cmds[j].slice(0,idx), cmds[j].slice(idx+1));\r\n                }\r\n              }\r\n          },\r\n        };\r\n      })();\r\n      cataLog.catalog_filter_query_keyword = catalog_filter_query_keyword;\r\n//        for (var i=0;i<kwd.kwds.length;i++) { // OR\r\n//          for (var j=start;j<end;j++) {\r\n//            var pst = (post_array)? posts[j] : (j==0)? posts : null;\r\n//            if (pst!==null) {\r\n//              if (kwd.sub)  if (pst.sub  && kwd.kwds[i].test(pst.sub )) return retval;\r\n//              if (kwd.com)  if (pst.com  && kwd.kwds[i].test(pst.com )) return retval;\r\n//              if (kwd.name) if (pst.name && kwd.kwds[i].test(pst.name)) return retval;\r\n//              if (kwd.trip) if (pst.trip && kwd.kwds[i].test(pst.trip)) return retval;\r\n//              if (kwd.file) {\r\n//                if (pst.filename && kwd.kwds[i].test(pst.filename)) return retval;\r\n//                if (pst.extra_files)\r\n//                  for (var k=pst.extra_files.length-1;k>=0;k--) \r\n//                    if (pst.extra_files[k].filename && kwd.kwds[i].test(pst.extra_files[k].filename)) return retval;\r\n//              }\r\n//            }\r\n//          }\r\n//        }\r\n//        return !retval;\r\n//      function catalog_filter_query_keyword(str_in){\r\n//        if (!pref.catalog.filter.kwd.use) return true;\r\n//        var kwd = pref.catalog.filter.kwd.str;\r\n//        if (kwd==='') return true;\r\n//        var str = ((pref.catalog.filter.kwd.op       )? str_in[0]+'\\n' : '')\r\n//                + ((pref.catalog.filter.kwd.op_sub   )? str_in[1]+'\\n' : '')\r\n//                + ((pref.catalog.filter.kwd.op_name  )? str_in[2]+'\\n' : '')\r\n//                + ((pref.catalog.filter.kwd.op_file  )? str_in[3]+'\\n' : '')\r\n//                + ((pref.catalog.filter.kwd.post     )? str_in[4]+'\\n' : '')\r\n//                + ((pref.catalog.filter.kwd.post_sub )? str_in[5]+'\\n' : '')\r\n//                + ((pref.catalog.filter.kwd.post_name)? str_in[6]+'\\n' : '')\r\n//                + ((pref.catalog.filter.kwd.post_file)? str_in[7]+'\\n' : '');\r\n//        if (str==='') return true;\r\n//\r\n//        var flag = true;\r\n//        var kwds = kwd.split(' ');\r\n//        for (var i=0;i<kwds.length;i++) {\r\n//          if (kwds[i]==='') continue;\r\n//          kwd = kwds[i];\r\n//          if (!pref.catalog.filter.kwd.re) kwd = kwd.replace(/[\\.\\(\\)\\[\\]\\+\\?\\^\\$\\{\\}]/g,'\\\\$&').replace(/\\*/g,'.*');\r\n//          if (pref.catalog.filter.kwd.ci) kwd = new RegExp(kwd,'i');\r\n//          var result = (str.search(kwd)!=-1);\r\n//          if (pref.catalog.filter.kwd.match==='unmatch') result = !result;\r\n//          flag = flag & result;\r\n//        }\r\n//        return flag;\r\n//      }\r\n////////      function catalog_filter_query_tag(tags){ // working code.\r\n//////////        if (!pref.catalog.filter.tag || filter_tags.length==0) return true;\r\n////////        if (!pref.catalog.filter.tag) return true;\r\n////////if (pref.test_mode['22']) {\r\n////////        if (filter_tags.length==0) return false;\r\n////////        if (!tags) return false;\r\n//////////console.log(tags);\r\n////////        for (var i=0;i<tags.length;i++)\r\n////////          for (var j=0;j<filter_tags.length;j++)\r\n////////            if (tags[i].search(filter_tags[j])!=-1) return true;\r\n////////        return false;\r\n////////} else {\r\n////////        return liveTag.search_by_tags(tags);\r\n////////}\r\n////////      }\r\n      function catalog_filter_query(name, no_reset){\r\n        var tgt_th = threads[name];\r\n        var val_old = tgt_th[9][0];\r\n        tgt_th[9][0] = catalog_filter_query_1(name, tgt_th);\r\n        if (!no_reset && val_old !== tgt_th[9][0]) pClg.drawn_idx = 0;\r\n        return tgt_th[9];\r\n      }\r\n      function catalog_filter_query_1(name, tgt_th){\r\n        if (tgt_th[16].show_always && !pref.catalog.filter.kwd.active) return true; // can't set 'tgt_th[16].icon_show_always' if (tgt_th[0]===null)\r\n        if (pref.catalog.filter.tag && (!pref.catalog.filter.kwd.active || !pref.filter.disable_tag_when_kwd_active)) if (!liveTag.search_by_tags(tgt_th[16].lth)) return false;\r\n        if (pref.catalog.filter.time)          if ((tgt_th[8][4]||tgt_th[8][0])<=pref3.catalog.filter.time_obj) return false;\r\n        if (pref.catalog.filter.time_creation) if ( tgt_th[8][1]               <=pref3.catalog.filter.time_obj) return false;\r\n//        if (pref.catalog.filter.time) { // working code.\r\n//          var time = Date.parse(pref.catalog.filter.time_str);\r\n////          if (tgt_th[8][0]<=time && tgt_th[8][4]<=time) return [false];\r\n//          if ((tgt_th[8][4]||tgt_th[8][0])<=time) {tgt_th[9][0] = false; return;}\r\n//        }\r\n        if (pref.catalog.filter.list && (!pref.catalog.filter.kwd.active || !pref.filter.disable_list_when_kwd_active)) { // use [1]\r\n          var retval = catalog_filter_query_time_list(name);\r\n          if (retval[0]===false) {tgt_th[9] = retval; return tgt_th[9][0];}\r\n        }\r\n//        else if (pref.catalog.filter.list_mark_time) [true, get_mark_time(name)];\r\n        if (pref.catalog.filter.kwd.active) { // use [2],[3]\r\n          var tgt_posts = tgt_th[16].recent_posts((pref.catalog.filter.kwd.post)? (pref[embed_mode].sourceOfSP==='auto'? -1 : null) : 0);\r\nif (pref.test_mode['59']) { // BUG. THIS DOESN'T WORK WITH OTHER FILTERS, NEEDS TO BE SPLITTED. \r\n          if (!catalog_filter_query_keyword.kwd(pref.catalog.filter.kwd, tgt_posts, common_func.fullname2dbt(name)[0])) return false;\r\n} else {\r\n          if (!((pref.catalog.filter.kwd.fail_list[tgt_th[9][3]] && tgt_th[9][2]===false) ||\r\n                (pref.catalog.filter.kwd.suc_list[tgt_th[9][3]]  && tgt_th[9][2]===true ))) {\r\n            tgt_th[9][3] = pref.catalog.filter.kwd.timestamp;\r\n            tgt_th[9][2] = catalog_filter_query_keyword.kwd(pref.catalog.filter.kwd, tgt_posts, common_func.fullname2dbt(name)[0]);\r\n          } else {\r\n            if (pref.debug_mode['18'] && tgt_th[9][2]!==catalog_filter_query_keyword.kwd(pref.catalog.filter.kwd, tgt_posts, common_func.fullname2dbt(name)[0])) console.log('BUG, test59, '+name);\r\n          }\r\n          if (!tgt_th[9][2]) return false;\r\n}\r\n//          else if (pref[embed_mode].popup2==='sr' || pref[embed_mode].popup2==='srpv') tgt_th[10] = catalog_filter_query_keyword.kwd_make_result(tgt_posts);\r\n        }\r\n        return true;\r\n      }\r\n      cataLog.catalog_filter_query = catalog_filter_query;\r\n////      function catalog_filter_query_scan(posts,tags){\r\n////        if (!catalog_filter_query_keyword.kwd(pref.catalog.filter.kwd, posts)) return false;\r\n//////        if (!catalog_filter_query_keyword(str)) return false;\r\n////if (pref.test_mode['22']) {\r\n////        if (!catalog_filter_query_tag(tags)) return false;\r\n////} else {\r\n//////        if (!catalog_filter_query_tag(tags[0][0].concat(tags[1][0]))) return false;\r\n////        if (pref.catalog.filter.tag) if (!liveTag.search_by_tags(tags)) return false;\r\n////}\r\n////        return true;\r\n////      }\r\n      function catalog_filter_query_time_list(name){\r\n        var val = pref_func.merge_obj5(name,pref.catalog.filter.list_obj2,{hit:false});\r\n//        if (val.time) return [(!pref.catalog.filter.list || val.time<threads[name][8][0] || val.time<threads[name][8][4]), val.time]; // hit always.\r\n        if (val.time) return [(!pref.catalog.filter.list || val.time<(threads[name][8][4]||threads[name][8][0])), val.time]; // hit always.\r\n        else if (val.hit) return [!pref.catalog.filter.list];\r\n        return [true];\r\n      }\r\n      function catalog_filter_changed(){\r\nif (pref.test_mode['60']) {        \r\n        if (pref.catalog.filter.kwd.use || pref.catalog.filter.tag || pref.catalog.filter.time || pref.catalog.filter.list) for (var th in threads) threads[th][9] = catalog_filter_query(th);\r\n        else {\r\n//          for (var th in threads) threads[th][9] = [true];\r\n          for (var th in threads) threads[th][9][0] = true;\r\n          gClg.drawn_idx = 0;\r\n        }\r\n} else {\r\n        var val = (pref.catalog.filter.kwd.use || pref.catalog.filter.tag || pref.catalog.filter.time || pref.catalog.filter.list)? null : true;\r\n        for (var th in threads) threads[th][9][0] = val;\r\n        gClg.drawn_idx = 0;\r\n}  \r\n        if (show_catalog) show_catalog(); // 'if (show_catalog)' is a patch.\r\n//console.log('filter_changed');\r\n//        catalog_refresh_gather_info(); // cut at 2015.05.15.\r\n      }\r\n      cataLog.catalog_filter_changed = catalog_filter_changed;\r\n      function catalog_attr_changed(){\r\n//        if (pref.catalog.filter.attr_list)\r\n//          for (var th in threads) catalog_attr_set(th,threads[th][0]);\r\n//        if (pref.catalog.filter.attr_list) {\r\n          pref_func.apply_prep(attr_list,true);\r\n          for (var name in threads) catalog_attr_set(name,threads[name][0]);\r\n//          show_catalog(); // don't require.\r\n//        }\r\n      }\r\n\r\n      var pop_up_delay_id = {};\r\n      function pop_up_delay(e,name){\r\n        if (pref[embed_mode].popup2==='no' || pref[embed_mode].popup2==='sr' && !pref.catalog.filter.kwd.active) return; \r\n//        if (threads[name][0].style.width=='' && threads[name][0].style.height=='' && pref.catalog_no_popup_at_expanded) return;\r\n        if (pref.catalog_popdown=='imm' || pop_up_status[name]) pop_up_op(e,name); // patch\r\n        else {\r\n          if (pop_up_delay_id[name]) clearTimeout(pop_up_delay_id[name]);\r\n          else { // init\r\n            threads[name][0].addEventListener('mousemove' , threads[name][2][1]);\r\n            threads[name][6] = function(){clearTimeout(pop_up_delay_id[name]);};\r\n            threads[name][0].addEventListener('mouseout'  , threads[name][6]);\r\n          }\r\n          pop_up_delay_id[name] = setTimeout(function(){pop_up_op(e,name);},pref.catalog_popup_delay);\r\n        } \r\n      }\r\n      function pop_up_op(e,name){\r\n        if (pop_up_status[name]) {\r\n          pop_keep_event(name);\r\n          return;\r\n        }\r\n        var ch = threads[name][0];\r\n        if (pop_up_delay_id[name]) {\r\n          ch.removeEventListener('mousemove' , threads[name][2][1]);\r\n          ch.removeEventListener('mouseout'  , threads[name][6]);\r\n          delete pop_up_delay_id[name];\r\n        }\r\n        var pn = pop_up_set_contents(null, pref[embed_mode].popup2, name);\r\n        if (pn) {\r\n          site2['DEFAULT'].popups_posts.set_pos(pn,e);\r\n          site.popup_body.appendChild(pn);\r\n        }\r\n        if (pref.catalog_popup_size_fix) { \r\n          pn.style.width  = pn.offsetWidth + 'px';\r\n          pn.style.height = pn.offsetHeight + 'px';\r\n        }\r\n        pop_up_status[name] = [null, function(){pop_down_event(name);}, function(){pop_keep_event(name);}, ch, pn];\r\n        if (pref[embed_mode].popup2==='chart') {\r\n          if (chart_obj && pref3.stats.use) {\r\n            pop_up_status[name][5] = new chart_obj.PostChart(pn,[name]); // must be after appendChild to draw. (just to call destroy?)\r\n          } else pn.innerHTML = 'Statistics needs to be activated.';\r\n        }\r\n        if (pref.catalog_popdown=='imm') {\r\n          if (document.documentElement.clientHeight/2-e.clientY>0) {\r\n            if (parseInt(pn.style.top.replace(/px/,''),10) + pn.offsetHeight > document.documentElement.clientHeight) {\r\n              if (pn.offsetHeight > document.documentElement.clientHeight) pn.style.top = '0px';\r\n              else {pn.style.top = null; pn.style.bottom = '0px';}\r\n            }\r\n          } else if (parseInt(pn.style.bottom.replace(/px/,''),10) + pn.offsetHeight > document.documentElement.clientHeight) {pn.style.bottom = ''; pn.style.top = '0px';}\r\n        } else {\r\n          pn.addEventListener('mouseover', pop_up_status[name][2], false);\r\n          pn.addEventListener('mouseout', pop_up_status[name][1], false);\r\n        }\r\n        ch.addEventListener('mouseout', pop_up_status[name][1], false);\r\n      }\r\n      function pop_keep_event(name){\r\n        if (pop_up_status[name][0]) {clearTimeout(pop_up_status[name][0]);pop_up_status[name][0]=null;}\r\n      }\r\n      function pop_down_event(name){\r\n        if (!pop_up_status[name][0]) pop_up_status[name][0] = setTimeout(function(){pop_down_op(name);},(pref.catalog_popdown=='imm')? 0 : pref.catalog_popdown_delay);\r\n      }\r\n      function pop_down_op(name){\r\n        if (pop_up_status[name][5]) pop_up_status[name][5].destroy();\r\n//        if (pop_up_status[name]==undefined) return;\r\n        var ch = pop_up_status[name][3];\r\n        var pn = pop_up_status[name][4];\r\n        ch.removeEventListener('mouseout' , pop_up_status[name][1], false);\r\n        if (pref.catalog_popdown!='imm') {\r\n          pn.removeEventListener('mouseover', pop_up_status[name][2], false);\r\n          pn.removeEventListener('mouseout' , pop_up_status[name][1], false);\r\n        }\r\n        if (threads[name][12]) threads[name][12] = remove_open_new_thread_event(threads[name][12]);\r\n        pn = cnst.div_destroy(pn,true);\r\n        delete pop_up_status[name]; //prevent memory leak.\r\n      }\r\n      function pop_up_set_contents(pn, kind, name, kwd){\r\n        var flag_search = kind==='sr' || kind==='srpv';\r\n        var posts_active = kwd || pref.catalog.filter.kwd.posts_active;\r\n        var th = {posts: threads[name][16].recent_posts(flag_search && posts_active && pref[embed_mode].sourceOfSP==='auto'? -1 : null),\r\n//          type_data: 'json', // BUG, lth.ta.posts may contain different type of data, see archiver.store_th_to_mem and archiver.check_deleted_posts. // NEED TO BE MODIFIED\r\n          __proto__:threads[name][7] || threads[name][16]};\r\n//        var th = threads[name][7] || threads[name][16];\r\n//        var th = threads[name][7];\r\nif (!pref.test_mode['49'] && posts_active && th) {\r\n        var search_result = (flag_search)? catalog_filter_query_keyword.kwd_make_result(th.posts, th.domain, kwd) : null; // lazy\r\n}\r\n        if (kind==='sr' && !search_result) return;\r\n        if (!pn) pn = cnst.init('pop:border:1px solid blue');\r\n        if (kind!=='chart') {\r\nif (!pref.test_mode['49']) {\r\n//          if (th) {\r\n            var lth = th.lth;\r\n            th = (kind==='dp')? {posts:[{search_result:false, __proto__:th.posts[0]}].concat(lth && lth.pd || []), __proto__:th} :\r\n                 (kind!=='pv' && search_result && {posts:search_result, __proto__:th}) || th;\r\n            format_html.prepare_html_prep_posts(th); // REDUNDANT for 2nd times or later.\r\n//            insert_thread_prepare_html_lazy(threads[name], !threads[name][0], false, true); // is this the better? not debugged yet.\r\n//            for (var i=0;i<th.posts.length;i++) th.posts[i] = Object.create(lth.q && lth.q[th.posts[i].no] || th.posts[i]); // wrap for re-assining pn, otherwise this causes a problem when popupX in embed_mode===page. // Backlink tracking system tries to add backlinks to lth.q[no].pn instead of th.posts[i].pn. lth.q stores oldest shown pn, while th.posts stores newest loaded posts. This might ought to be consolidated, but I haven't resolved how it should be handled. // BUG, THIS DOESN'T WORK ALSO, BECAUSE th.posts[i] is wrapped but the function popups_add tries to add backlinks to thq[no] directly.\r\n            for (var i=0;i<th.posts.length;i++) th.posts[i] = Object.create(th.posts[i]); // wrap for re-assining pn, otherwise this causes a problem when popupX in embed_mode===page.\r\n            var pn_result = site2[site.nickname].page_json2html3(th,th.board,th.op_img_url, true, kwd);\r\n            if (!pref.test_mode['98'] && pref[embed_mode].popup) format_html.prep_anchor_links(pn_result, th);\r\n            if (!pref.test_mode['98'] && pref[embed_mode].popup) site2[th.domain].popups_add(th.posts, th, false, false, !kwd); // !kwd for test_mode['121'] // make backlink data beforehand. This prepares html for thq[no] in vain, but acceptable. This is required after prep_anchor_links and before format_pn, because internal function popups_href2dbtp requires thread.no in href, and the function backlink() in format_pn will add backlinks according to the data which is generated by popups_add.\r\n//            if ((search_result || kind==='dp') && th.posts[0].search_result===false) site2[th.domain_html].update_posts0_class(th.posts[0].pn, th.posts[0].search_result);\r\n            for (var i=0;i<th.posts.length;i++) site2[th.domain_html].format_pn(th.posts[i].pn, lth && lth.q && lth.q[th.posts[i].no], null, th.posts[i], th); // SHOULD CHANGE TO USE prepare_html_post to mark editing and consolidate control flow.\r\n            site2['DEFAULT'].check_reply.set_own_posts(th);\r\n            if (pref[embed_mode].mark_new_posts) format_html.update_draw(th.key, th.posts);\r\n//            if (!pref.test_mode['98'] && pref[embed_mode].popup) site2[th.domain].popups_add(th.posts, th, false, false, !kwd); // !kwd for test_mode['121']\r\n            if (kwd && !th.posts[0].search_result) Array.prototype.forEach.call(pn_result.getElementsByClassName('CatChan_search_miss'), function(v){v.style.display = 'none';});\r\n            pn.name = th.key; // obsolete\r\n            gGEH.pns_all_keys.set(pn,th.key);\r\n//          } else pn_result = document.createTextNode('You must be set to store posts at least 1, see \\'Catalog\\' tab in settings.');\r\n          pn.appendChild(pn_result);\r\n          catalog_attr_set(name,pn.childNodes[0]);\r\n} else {\r\n          pn.innerHTML = threads[name][3][0];\r\n          trim_html(pn, threads[name][3][1], pref[embed_mode].format.hover, name);\r\n          trim_html_mark_time(pn, threads[name][3][1], pref[embed_mode].format.hover, name);\r\n          var nickname = name.replace(/\\/.*/,'');\r\n//        if (pref.catalog.filter.list_mark_time && threads[name][9][1]) site2[nickname].mark_newer_posts(pn,threads[name][9][1]);\r\n          var date = get_mark_time(name, pref[embed_mode].mark_new_posts, pref[embed_mode].mark_new_posts, pref[embed_mode].mark_new_posts);\r\n          if (date>0) site2[nickname].mark_newer_posts(pn,date);\r\n          threads[name][12] = add_open_new_thread_event(name,site2[nickname].modify_thread_link(pn));\r\n          catalog_attr_set(name,pn);\r\n}\r\n        }\r\n        return pn;\r\n      }\r\n      cataLog.pop_up_set_contents = pop_up_set_contents;\r\n\r\n//      var page_delim = [];\r\n//      for (var i=0;i<site.max_page;i++) page_delim[i] = null;\r\n//      var page_delim_idx = [];\r\n\r\n      var load_list = {refresh: {key:'',    idx:0, tgts:null, mutex:true, use_cache:false, from_auto:false, page_check:true },\r\n                       ondemand:{key:'odl', idx:0, tgts:null, mutex:true, use_cache:false, from_auto:false, page_check:false},\r\n                       tag:     {key:'tag', idx:0, tgts:null, mutex:true, use_cache:true,  from_auto:false, page_check:false}};\r\n      var filter_tags_refresh_mem = {};\r\n      var refresh_use_cache = false;\r\n      function prep_reserved_tags(set,idx, not_initial){\r\n        var tags = pref.catalog_board_list_obj[idx] && pref.catalog_board_list_obj[idx][0].tags || null;\r\n        if (tags && not_initial) tags = tags.filter(function(v){return v[0]==='#' && v[1]==='#';});\r\n//        if (tags && not_initial) for (var i=tags.length-1;i>=0;i--) if (tags[i][1]!=='#') tags.splice(i,1);\r\n        return (tags)? liveTag.tags_reserved_init(tags,set) : null; // 'liveTag.tags_reserved_init' modifies tags.\r\n      }\r\n//      function prep_reserved_tags(set,idx){ // working code.\r\n//        var tags = pref.catalog_board_list_obj[idx][0].tags || null;\r\n//        if (tags) {\r\n//          tags = tags.slice();\r\n//          liveTag.set_reserved_tags(tags,set);\r\n//          if (set) liveTag.reserved = (tags.length!==0)? tags : null;\r\n//        }\r\n//      }\r\n      function make_refresh_list(sel,bookmark_list_str, refresh, not_initial){\r\n//      function make_refresh_list(remove_attr){\r\n        var tgts = [];\r\n        var tgt_domains = {};\r\n        if (site.whereami==='boards' && sel==0) pref_func.str2obj('catalog_board_list_str');\r\n        var blist = pref.catalog_board_list_obj[sel].slice();\r\n        var domains = blist[0].domains_for_all_boards;\r\n        if (domains) {\r\n          for (var i=0;i<domains.length;i++) {\r\n            var domain = domains[i];\r\n            if (!site3[domain].boards) return function(callback){ // singlelined because this may cause infinite loop if reading boards_json is failed.\r\n              site2[domain].get_boards_json('refresh_boards_json',callback,false,health_indicator);};\r\n//            if (!site3[domain].boards) {\r\n//              site2[domain].get_boards_json('refresh_boards_json',reentry_func,false,health_indicator);\r\n//              return tgts; // singlelined because this may cause infinite loop if reading boards_json is failed.\r\n//            }\r\n          }\r\n          for (var i=0;i<domains.length;i++)\r\n            if (refresh && site2[domains[i]].utilize_boards_json && pref.pref2[domains[i]].utilize_boards_json && pref.pref2[domains[i]].utilize_boards_json_domain)\r\n              tgt_domains[domains[i]] = null;\r\n            else for (var j in liveTag.mems[domains[i]]) blist[blist.length] = liveTag.mems[domains[i]][j];\r\n        }\r\n        var bds_picked_up_by_tags = prep_reserved_tags(true,sel, not_initial);\r\n        for (var bd in bds_picked_up_by_tags) {\r\n          for (var j=1;j<blist.length;j++) if (blist[j].key===bd) break;\r\n          if (j==blist.length) blist[blist.length] = liveTag.mems.getFromName(bd); // scan.add_board(bd);\r\n        }\r\n        if (bookmark_list_str) tgts = bookmark_list_str.replace(/\\s*\\/\\/.*$/mg,',').replace(/\\n/g,',').replace(/,,+/g,',').replace(/^,/,'').replace(/,$/,'').split(',');\r\n        if (tgts[0]==='') tgts = [];\r\n//        var page_str = (pref.catalog.design==='page')? 'p' : 'c';\r\n        var j = 0;\r\n        while (blist.length>1) {\r\n          for (var i=1;i<blist.length;i++) {\r\n            var key = blist[i].key.replace(/\\s/g,''); // replace... is redundant\r\n            var dbt = cnst.name2domainboardthread(key,true);\r\n            var max_page_bd = pref.catalog_max_page_select==='auto' && liveTag.mems[dbt[0]] && liveTag.mems[dbt[0]][dbt[1]] && liveTag.mems[dbt[0]][dbt[1]].pgs || pref.catalog_max_page;\r\n            if (dbt[2]) {\r\n              if (j==0) tgts.push(key);\r\n              else blist.splice(i--,1)\r\n            } else if ((!blist[i].max_page || j<blist[i].max_page) && j<max_page_bd) tgts.push(key+ ((pref.catalog.catalog_json)? 'q':'p') +j);\r\n            else blist.splice(i--,1)\r\n          }\r\n          j++;\r\n        }\r\n\r\n////        for (var j=0;j<pref.catalog_max_page;j++) // working code.\r\n////          for (var i=1;i<blist.length;i++) {\r\n//////            if (blist[i]['key'].search(/[^\\/]*\\/[^\\/]*\\/[0-9]+/)!=-1) {if (j==0) tgts.push(blist[i]['key']);} // working code.\r\n////            var key = blist[i].key.replace(/\\s/g,''); // replace... is redundant\r\n////            if (common_func.fullname2dbt(key)[2]) {if (j==0) tgts.push(key);}\r\n////            else if (!blist[i].max_page || j<blist[i].max_page) tgts.push(key+ ((pref.catalog.catalog_json)? 'q':'p') +j);\r\n////          }\r\n//////        if (remove_attr) for (var i=0;i<tgts.length;i++) tgts[i] = tgts[i].replace(/!.*/,'');\r\n//////        for (var i=tgts.length-1;i>=0;i--) { // working code\r\n//////          var dbt = cnst.name2domainboardthread(tgts[i],true);\r\n//////          if (tgts[i].indexOf(dbt[1])==-1) tgts[i] = dbt[0] + dbt[1] + tgts[i];\r\n//////          else if (tgts[i].indexOf(dbt[0])==-1) tgts[i] = dbt[0] + tgts[i];\r\n//////        }\r\n        return {tgts:tgts, tgt_domains:tgt_domains};\r\n      }\r\n      function trim_list(tgts,embed_init, mode){\r\n        if (pref.catalog.board.ex_list) {\r\n          for (var i=tgts.length-1;i>=0;i--) {\r\n            var val = pref_func.merge_obj5(tgts[i],pref.catalog.board.ex_list_obj2,{hit:false});\r\n            if (val.hit) tgts.splice(i,1);\r\n          }\r\n        }\r\n        if (pref.catalog.design==='catalog' || (pref.catalog.design==='auto' && mode==='catalog') || mode==='chart') {\r\n          for (var i=tgts.length-1;i>=0;i--) {\r\n            var dbt = cnst.name2domainboardthread(tgts[i],true);\r\n            if ((site2[dbt[0]].trim_list!=='no' || mode==='chart') && tgts[i].search(/\\/[pq][0-9]*/)!=-1) {\r\n//            if ((dbt[0]==='8chan' ||dbt[0]==='4chan') && tgts[i].search(/\\/p[0-9]*/)!=-1) {\r\n//            if (dbt[0]==='8chan' && tgts[i].search(/\\/p[0-9]*/)!=-1) {\r\n//              if (tgts[i].search(/\\/p0$/)!=-1 && (!embed_init || dbt[1]!=site.board)) tgts[i] = tgts[i].replace(/p0/,(pref.catalog.catalog_json)? 'j0' : 'c0');\r\n              if (tgts[i].search(/\\/[pq]0$/)!=-1 && (!embed_init || dbt[1]!=site.board || dbt[0]!=site.nickname || (site2[dbt[0]].trim_list==='force_init' || pref3.stats.use)))\r\n                tgts[i] = tgts[i].replace(/[pq]0/,(pref.catalog.catalog_json || site2[dbt[0]].trim_list==='force_init')? 'j0' : 'c0');\r\n              else if (tgts[i].search(/\\/[pq][0-9]$/)!=-1) tgts.splice(i,1); // ratain thread\r\n            }\r\n          }\r\n        }\r\n        if (mode==='page' && embed_init) { // patch\r\n          if (pref.liveTag.use) {\r\n            var bds = {};\r\n            for (var i=0;i<tgts.length;i++) {\r\n              var dbt = cnst.name2domainboardthread(tgts[i],true);\r\n              bds[dbt[0]+dbt[1]+((pref.catalog.catalog_json)? 'j0':'c0')] = null; // add a catalog for scan all thread.\r\n            }\r\n            for (var i in bds) tgts[tgts.length] = i;\r\n//            cataLog.scan_init('init_tag',bds, {tag_only:true});\r\n          }\r\n//          if (pref.liveTag.use) { // working code.\r\n//            for (var i=0;i<tgts.length;i++) {\r\n//              var dbt = cnst.name2domainboardthread(tgts[i],true);\r\n//              scan.list_nup.add_board(dbt[0]+dbt[1]);\r\n//            }\r\n//          }\r\n          if (tgts[0] && tgts[0].search(site.nickname+site.board+'[pq]0')===0) tgts.splice(0,1);\r\n////          var site_db = site.nickname+site.board;\r\n////          for (var i=0;i<tgts.length;i++) { // working code, but obsolete.\r\n////            if (tgts[i].indexOf(site_db)===0) {\r\n////              if (tgts[i].search(site_db+'[pq]0')===0) tgts.splice(i--,1)[0];\r\n////              else if (pref[mode].load_on_demand) threads_idx[threads_idx.length] = 'ODL:'+tgts.splice(i--,1)[0];\r\n////            }\r\n////          }\r\n          if (pref[mode].load_on_demand) pClg.drawn_idx = 0;\r\n        }\r\n//        if (mode==='thread') { // patch\r\n//          if (board_sel.selectedIndex===0) {\r\n//            if (embed_init) tgts.splice(0,1);\r\n//            else tgts = [site.nickname + site.board + site.no];\r\n//          }\r\n//        }\r\n        for (var i=tgts.length-1;i>=0;i--) {\r\n          var dbt = common_func.name2dbt(tgts[i]);\r\n          var url = site2[dbt[0]].make_url4(dbt, pref.catalog.design!=='page' && (pref.catalog.indexing!==0 || pref.liveTag.from!=='none')); // trim for 4chan. // !=='none' IS ALWAYS TRUE, WHY...\r\n          if (!url) tgts.splice(i,1);\r\n          else if (url[2] && url[2]!==tgts[i]) {\r\n            if (tgts.indexOf(url[2])!=-1) tgts.splice(i,1);\r\n            else tgts[i] = url[2];\r\n          }\r\n//          if (!site2[dbt[0]].make_url4(dbt)) tgts.splice(i,1);\r\n        }\r\n        return tgts;\r\n      }\r\n\r\n\r\n//      function remove_threads_events(name){\r\n//        if (pref.test_mode['127']) if (threads[name][0]) threads[name][0].removeEventListener('mouseover', threads[name][2][0], false);\r\n//        if (pref.test_mode['104']) common_func.dom_removeEventListener(threads[name][5]);\r\n//        if (threads[name][11]) threads[name][11] = remove_open_new_thread_event(threads[name][11]);\r\n//      }\r\n//      function remove_thread(name, pn_only){\r\n//        var ref = threads_idx.indexOf(name);\r\n//        if (name.substr(0,4)!=='ODL:') {\r\n//          if (!threads[name]) return;\r\n//          var dbt = common_func.fullname2dbt(name);\r\n//          var lth = liveTag.mems.getFromName(name);\r\n//          if (!pn_only) if (lth.q) site2[dbt[0]].popups_release_all(lth, {}); // remove cross thread/board links.\r\n////          if (!pn_only) if (threads[name][16].popups) for (var i in threads[name][16].popups) site2[dbt[0]].popups_release(lth, i); // remove cross thread/board links.\r\n//          remove_threads_events(name);\r\n//          if (threads[name][1]) {\r\n//            if (pop_up_status[name]) pop_down_op(name);\r\n////            if (threads[name][0].parentNode===triage_parent) { // working code.\r\n//////              if (pref.catalog_expand_with_hr && !embed_catalog) show_catalog_hr(name,'remove');\r\n//////              triage_parent.removeChild(threads[name][0]); // for 4chan's native\r\n////              catalog_obj2.func_hide(name);\r\n////            }\r\n//            if (threads[name][0] && threads[name][0].parentNode===triage_parent) pClg.func_hide(name); // parent check is for on_demand_draw\r\n//            site2['DEFAULT'].update_posts_merge_bases.remove_th(threads[name][16], true);\r\n////            if (threads[name][0] && threads[name][0].parentNode===triage_parent || pref[embed_mode].merge) // parent check is for on_demand_draw and merging threads.\r\n////              catalog_obj2.func_hide(name);\r\n//            if (ref<pClg.drawn_idx) pClg.drawn_idx = 0;\r\n//          }\r\n////          if (threads[16].archiveFile) {\r\n////            if (threads[16].archiveFile==='IDB') {\r\n////            } else {\r\n////              var files = threads[16].archiveFile;\r\n////              while (files) {\r\n////                for (var i in files) if (files[i].url) window.URL.revokeObjectURL(files[i].url);\r\n////                files = Object.getPrototypeOf(files);\r\n////              }\r\n////            }\r\n////          }\r\n////          if (lth) {\r\n////            delete lth.th;\r\n////            delete lth.ta;\r\n////            delete lth.pd;\r\n////          }\r\n//        }\r\n//        if (pn_only) {\r\n//          threads[name][0] = false;\r\n//          threads[name][1] = false;\r\n//          threads[name][16].th = threads[name][7];\r\n//          threads[name][16].posts = null;\r\n////          if (!threads[name][16].th) threads[name][16].th = threads[name][16];\r\n//          if (threads[name][24]) threads[name][24][0] = null;\r\n//          return;\r\n//        }\r\n//        delete threads[name]; // remove 'ODL:' also\r\n//if (pref.debug_mode['2']) console.log('removed: '+name);\r\n////        for (var i=threads_idx.length-1;i>=0;i--) if (threads_idx[i]===name) {threads_idx.splice(i,1);break;}\r\n//        if (ref>=0) threads_idx.splice(ref,1);\r\n//if (pref.test_mode['95'] && site.nickname==='dist') site2[site.nickname].testPoster(name);\r\n//      }\r\n//      cataLog.remove_thread = remove_thread;\r\n//////      function remove_thread(name){ // working code.\r\n//////        if (name.substr(0,4)!=='ODL:' && threads[name]) { // BUG. SHOULD WORK WITHOUT CHECKING threads[name]\r\n//////          var dbt = common_func.fullname2dbt(name);\r\n//////          if (threads[name][16].popups) for (var i=0;i<threads[name][16].popups.length;i++) site2[dbt[0]].popups_release(threads[name][16].popups[i]);\r\n////////        if (name.substr(0,4)!=='ODL:') {\r\n////////          if (threads[name][16].th_destroy) threads[name][16].th_destroy(threads[name][0], threads[name][16].parse_funcs);\r\n//////          threads[name][0].removeEventListener('mouseover', threads[name][2][0], false);\r\n////////          threads[name][0].removeEventListener('click', threads[name][5], false);\r\n////////          for (var i=0;i<threads[name][5].length;i++) threads[name][5][i].removeEventListener('click', click_thread, false);\r\n//////          common_func.dom_removeEventListener(threads[name][5]);\r\n//////          if (threads[name][11]) remove_open_new_thread_event(threads[name][11]);\r\n//////          if (threads[name][1]) {\r\n////////            if (threads[name][12]) remove_open_new_thread_event(threads[name][12]);\r\n//////            if (pop_up_status[name]) pop_down_op(name);\r\n////////            triage_parent.removeChild(threads[name][0]);\r\n//////            if (threads[name][0].parentNode===triage_parent) triage_parent.removeChild(threads[name][0]); // for 4chan's native\r\n//////          }\r\n////////          if (threads[name][17][0][0].length!=0) liveTag.remove_tags_in_th(threads[name][17][0][0], name);\r\n////////          if (threads[name][17][1][0].length!=0) liveTag.remove_tags_in_th(threads[name][17][1][0], name);\r\n////////          liveTag.remove_tags_in_th(name);\r\n//////        }\r\n//////        delete threads[name]; // remove 'ODL:' also\r\n//////if (pref.debug_mode['2']) console.log('removed: '+name);\r\n//////        for (var i=threads_idx.length-1;i>=0;i--) if (threads_idx[i]===name) {threads_idx.splice(i,1);break;}\r\n//////      }\r\n      var threads_candidates_of_deletion = null;\r\n      function catalog_clear_threads_candidates_of_deletion(num, schedule){\r\n        if (threads_candidates_of_deletion!==null) {\r\n          for (var name in threads_candidates_of_deletion)\r\n           if (threads[name] && threads_candidates_of_deletion[name]===((threads[name][8][0]>threads[name][8][4])? threads[name][8][0] : (threads[name][8][4] || threads[name][8][0]))) gClg.remove_thread(name);\r\n          threads_candidates_of_deletion = null;\r\n        }\r\n      }\r\n      function catalog_clear_threads(num, schedule){\r\n//        threads_last_deleted = {};\r\n//        catalog_triage_out();\r\n        var idx = 0;\r\n        while (idx<threads_idx.length && idx<num) if (threads_idx[idx++].substr(0,4)==='ODL:') num++;\r\n        if (!schedule) {\r\n          if (pref.test_mode['127']) triage.off_delay();\r\n          while (threads_idx.length>num) {\r\n            var name = threads_idx[threads_idx.length-1];\r\n//          if (name.substr(0,4)!=='ODL:') threads_last_deleted[name] = {sticky:threads[name][20], last_post_time:threads[name][8][4], last_post_count:threads[name][8][2]};\r\n//          threads_last_deleted[name] = threads[name][20];\r\n            gClg.remove_thread(name);\r\n          }\r\n        } else {\r\n          if (threads_candidates_of_deletion===null) threads_candidates_of_deletion = {};\r\n          while (threads_idx.length>num) {\r\n            var name = threads_idx[num++];\r\n            if (name.substr(0,4)==='ODL:') {gClg.remove_thread(name);num--;}\r\n            else threads_candidates_of_deletion[name] = (threads[name][8][0]>threads[name][8][4])? threads[name][8][0] : (threads[name][8][4] || threads[name][8][0]);\r\n          }\r\n        }\r\n////////        if (!schedule) remake_boards();\r\n      }\r\n      cataLog.catalog_clear_threads = catalog_clear_threads;\r\n////////      function remake_boards(){\r\n////////        boards = {};\r\n////////        for (var name in threads) {\r\n////////          var dbt = cnst.name2domainboardthread(name,true);\r\n////////          boards[dbt[0]+dbt[1]] = null;\r\n////////        }\r\n////////      }\r\n      function catalog_refresh(refresh, embed_init, from_auto, from_switch) {\r\n        pref4.refresh.count++;\r\n        gClg.footer.refresh_start();\r\n        if (!pref.test_mode['67'] && !embed_init) archiver.refresh_start();\r\n        if (!from_switch && !embed_init && pref.catalog.auto_save_filter_at_refresh) onchange_funcs['save']();\r\n        var result = catalog_refresh_1(embed_mode, refresh, embed_init, from_auto, 'refresh', board_sel.selectedIndex, pref.catalog.filter.bookmark_list_str, false, undefined, from_switch);\r\n        if (typeof(result)==='function') result(function(){catalog_refresh(refresh, embed_init, from_auto);});\r\n      }\r\n      function catalog_refresh_1(mode, refresh, embed_init, from_auto, scan_name, sel, bookmark_list_str, get_board_list, callback, from_switch) {\r\n        var tgts_all = make_refresh_list(sel, bookmark_list_str, refresh, !embed_init && !from_switch);\r\n        if (typeof(tgts_all)==='function') return tgts_all; // must be reentried.\r\n        var tgts = tgts_all.tgts;\r\n        if (get_board_list) {\r\n          var bds = {};\r\n          for (var i=0;i<tgts.length;i++) {\r\n            var dbt = common_func.name2domainboardthread(tgts[i],true);\r\n            if (dbt[2][0].search(/^[pqcj]/)!=-1) bds[dbt[0]+dbt[1]] = null;\r\n            else bds[dbt[0]+dbt[1]+dbt[2].replace(/^t/,'')] = null; // patch\r\n          }\r\n        }\r\n        if (scan_name && pref3.stats.use && pref.stats.auto_acquisition_all) stats.register_auto_acquisition(sel);\r\n        tgts = trim_list(tgts,embed_init, mode);\r\n        var priority = (!refresh)? 0 : (from_auto)? 2:4;\r\n        if (tgts.length===0) return (refresh)? scan.scan_refresh(health_indicator, tgts, priority, tgts_all.tgt_domains) : tgts;\r\n        if (refresh) {\r\n          catalog_clear_threads_candidates_of_deletion();\r\n          if (pref.catalog_refresh_clear && !embed_init) catalog_clear_threads(pref4.scan.max_threads_at_refresh, true);\r\n        }\r\n////////        load_on_demand.release(); // prevent from hanging up.\r\n        if (scan_name) scan_boards.scan_init(scan_name, tgts,\r\n                                             {refresh:refresh,\r\n                                              callback: function(){scan.scan_refresh(health_indicator, tgts, priority, tgts_all.tgt_domains);\r\n                                                                   if (callback) callback();},\r\n                                              from_auto:from_auto, load_on_demand:pref[mode].load_on_demand, priority:priority});\r\n        return (get_board_list)? Object.keys(bds) : tgts;\r\n      }\r\n      cataLog.catalog_refresh_1 = catalog_refresh_1;\r\n      \r\n////      function catalog_refresh(refresh, embed_init, from_auto, indicator) { // working code.\r\n//////if (pref.debug_mode['0']) console.log(new Date().toLocaleTimeString() + ', refresh: start: ');\r\n//////        set_auto_update();\r\n////        if (pref.catalog.filter.time_ago_str_sync_at_refresh) ago_clicked();\r\n////        load_list.refresh.use_cache = !refresh;\r\n////        load_list.refresh.idx = 0;\r\n////        load_list.refresh.mutex = true;\r\n////        load_list.refresh.from_auto = from_auto;\r\n////        load_list.refresh.tgts = trim_list(make_refresh_list(board_sel,pref.catalog.filter.bookmark_list),embed_init);\r\n////        if (load_list.refresh.tgts.length===0) return;\r\n////        if (threads_candidates_of_deletion!==null) {\r\n////          for (var name in threads_candidates_of_deletion)\r\n////           if (threads[name] && threads_candidates_of_deletion[name]===((threads[name][8][0]>threads[name][8][4])? threads[name][8][0] : (threads[name][8][4] || threads[name][8][0]))) remove_thread(name);\r\n////          threads_candidates_of_deletion = null;\r\n////////////          remake_boards();\r\n////        }\r\n////        if (refresh && pref.catalog_refresh_clear && !embed_init) catalog_clear_threads(pref.catalog.max_threads_at_refresh, true);\r\n//////        for (var i=0;i<load_list.refresh.tgts.length;i++) load_list.refresh.tgts[i] = [load_list.refresh.tgts[i], from_auto];\r\n////////////        load_on_demand.release(); // prevent from hanging up.\r\n////        if (load_list.refresh.idx<load_list.refresh.tgts.length) {\r\n//////if (!pref.test_mode['15']) scan_boards.scan_init('refresh', load_list.refresh.tgts, {refresh:true, crawler_max:1, indicator:indicator, callback:catalog_refresh_watch});\r\n//////if (!pref.test_mode['15']) scan_boards.scan_init('refresh', load_list.refresh.tgts, {refresh:true, indicator:indicator, callback:catalog_refresh_watch, from_auto:from_auto, load_on_demand:pref[embed_mode].load_on_demand});\r\n////if (!pref.test_mode['15']) scan_boards.scan_init('refresh', load_list.refresh.tgts, {refresh:true, callback:catalog_refresh_watch, from_auto:from_auto, load_on_demand:pref[embed_mode].load_on_demand, priority:(from_auto)?2:4});\r\n////else {\r\n//////          health_indicator.shift('limegreen','0');\r\n////          load_list.refresh.indicator = indicator;\r\n////          get_page(load_list.refresh);\r\n////}\r\n////        } else catalog_refresh_watch();\r\n//////        scan_boards.scan_init('refresh_tag',filter_tags_refresh_mem,(refresh)? 0 : pref.scan.lifetime*60, catalog_refresh_watch);\r\n////if (pref.test_mode['22'])\r\n////        scan_boards.scan_init('refresh_tag', filter_tags_refresh_mem, {lifetime:((refresh)? 0 : pref.scan.lifetime*60), cache_write:true});\r\n////      }\r\n////      \r\n////////      function catalog_refresh_watch() { // working code.\r\n//////////console.log('test');\r\n////////        var tgts = {};\r\n////////        for (var name in threads) if (threads[name][21]) tgts[name] = null;\r\n////////        scan_boards.scan_init('refresh_watch', tgts, {callback:catalog_refresh_gather_info, refresh:true});\r\n//////////console.time('refresh_watch');\r\n//////////        scan_boards.scan_init('refresh_watch', tgts, {callback:catalog_refresh_gather_info, force_json:pref.catalog.order.find_sage_in_8chan});\r\n////////      }\r\n////////      cataLog.catalog_refresh_watch = catalog_refresh_watch;\r\n////      function catalog_refresh_watch() { // working code, @safe1080\r\n////        catalog_refresh_gather_info();\r\n////      }\r\n////      var missing_info = {};\r\n////      function catalog_refresh_gather_info() {\r\n////        var tgts = missing_info;\r\n////        missing_info = {};\r\n//////////////console.timeEnd('refresh_watch');\r\n////////////        var tgts = {};\r\n////////////        for (var name in threads) {\r\n////////////          if (!pref.catalog.filter.time && !pref.catalog.filter.list && !threads[name][9][0]) continue;\r\n//////////////          var dbt = common_func.name2domainboardthread(name);\r\n//////////////          if (dbt[0]==='8chan' && pref.catalog.indexing==4 && threads[name][23]) tgts[name] = true; // get time of sage post in 8chan from json.\r\n//////////////          if (pref.catalog.indexing==4 && threads[name][23] && threads[name][23].time_posted===null) tgts[name] = true; // get time_posted\r\n////////////          if (pref.catalog.indexing==4 && threads[name][8][4]===undefined) tgts[name] = true; // get time_posted\r\n//////////////          if (!threads[name][9][0]) continue;\r\n//////////////          if (dbt[0]==='8chan' && pref.catalog.order.sticky!=='dont_care' && threads[name][20]===null) tgts[dbt[0]+dbt[1]] = true; // get sticky in 8chan from json.\r\n////////////        }\r\n//////////////console.log(tgts);\r\n////        scan_boards.scan_init('refresh_watch', tgts, {tgt_raw: true,\r\n////                                                      callback: function(){scan.scan_refresh(health_indicator);}});\r\n//////                                                      callback: (pref.liveTag.utilize_boards_json)? catalog_refresh_boards : catalog_liveTag_scan_boards,\r\n//////                                                      callback_args: (pref.liveTag.utilize_boards_json)? 'refresh_watch' : null});\r\n//////        if (pref.liveTag.utilize_boards_json && embed_mode==='catalog') catalog_liveTag_scan_threads(); // patch for 8chan, boards_json is too heavy.\r\n////      }\r\n////\r\n////      function catalog_refresh_boards() { // patch for 8chan // working code, @safe1069\r\n//////        if (liveTag.mems['8chan']) {\r\n//////          var tgts = scan.list_nup.get_list_board('8chan',true);\r\n////////          if (tgts.length!=0) http_req.get('refresh_watch','8chan,boards_json,boards_json,boards_json',site2['8chan'].url_boards_json(),catalog_refresh_boards_callback,0,true,catalog_liveTag_scan_boards);\r\n//////          if (tgts.length!=0) site2['8chan'].get_boards_json('refresh_watch',catalog_liveTag_scan_boards,true,health_indicator);\r\n//////          else catalog_liveTag_scan_boards();\r\n//////        } else catalog_liveTag_scan_boards();\r\n////        if (scan.list_nup.query_list_board('8chan')) {\r\n////          site2['8chan'].get_boards_json('refresh_watch',catalog_liveTag_scan_boards,true,health_indicator);\r\n////          return;\r\n////        }\r\n////        catalog_liveTag_scan_boards();\r\n////      }\r\n////////////      function catalog_refresh_boards_callback(key,value,callback){\r\n//////////////if (pref.debug_mode['7']) console.log('boards_json:');\r\n////////////        if (value.status==200) {\r\n////////////          var dbt = key.split(',');\r\n////////////          site2[dbt[0]].postprocess_board(value.response);\r\n////////////////          site3[dbt[0]].boards = value.response.boards || value.response; // patch for 8chan. WHY DO THEY CHANGE THE SPEC REPEATEDLY WITHOUT A PARTICULAR REASON??? // working code.\r\n////////////////          site3[dbt[0]].boards_to_scan = null;\r\n////////////////          if (site2[dbt[0]].make_site3_bds) site2[dbt[0]].make_site3_bds();\r\n////////////        }\r\n////////////        if (callback) callback();\r\n////////////      }\r\n////\r\n////      var mutex_wd_liveTag_scan_boards = new MutexWatchdog('scan');\r\n////      function catalog_liveTag_scan_boards(domain) {\r\n////        if (pref.liveTag.use) {\r\n////          if (!mutex_wd_liveTag_scan_boards.get()) {catalog_refresh_end(); return;}\r\n////          if (pref.debug_mode['7']) var d_str = '';\r\n////          var tgts = scan.list_nup.get_list_board(domain);\r\n////////          var tgts = []; // working code.\r\n////////          var time_th = Date.now()-pref.liveTag.pickup_interval*1000;\r\n////////          for (var i in scan.list_nup_boards) {\r\n////////            var dbt = common_func.fullname2dbt(i);\r\n////////            if (scan.list_nup_boards[i].time<time_th && (!scan.list_nup_boards[i].max || scan.list_nup_boards[i].max<liveTag.mems[dbt[0]][dbt[1]].max)) {\r\n////////              tgts[tgts.length] = i;\r\n////////              if (pref.debug_mode['7']) d_str += i + ':' +scan.list_nup_boards[i].max+'/'+liveTag.mems[dbt[0]][dbt[1]].max+', ';\r\n////////            }\r\n////////          }\r\n////          if (pref.debug_mode['7']) for (var i=0;i<tgts.length;i++) d_str += tgts[i].key + ':' +tgts[i].read_max+'/'+tgts[i].max+', ';\r\n////          if (Object.keys(tgts).length!=0) {\r\n////            scan_boards.scan_init('scan', tgts, {callback: catalog_liveTag_scan_boards_cont,\r\n////                                                 watchdog: mutex_wd_liveTag_scan_boards.restart.bind(mutex_wd_liveTag_scan_boards),\r\n////////////                                                 crawler_watchdog: true\r\n//////                                                 priority: 1,\r\n////                                                });\r\n////            if (pref.debug_mode['7']) console.log('catalog_liveTag_scan_boards: '+tgts.length+', '+d_str);\r\n////          } else {\r\n////            mutex_wd_liveTag_scan_boards.stop();\r\n////            catalog_liveTag_scan_threads();\r\n////          }\r\n////        } else catalog_liveTag_scan_threads();\r\n////      }\r\n////      function catalog_liveTag_scan_boards_cont() {\r\n////        mutex_wd_liveTag_scan_boards.stop();\r\n////        if (mutex_wd_liveTag_scan_boards.query_req()) catalog_liveTag_scan_boards();\r\n////        else catalog_liveTag_scan_threads();\r\n////      }\r\n////      function catalog_liveTag_scan_cancel() {\r\n////        mutex_wd_liveTag_scan_boards.abort();\r\n////        scan_boards.scan_abort('scan');\r\n////        mutex_wd_liveTag_scan_threads.abort();\r\n////        scan_boards.scan_abort('scan_threads');\r\n////      }\r\n////\r\n////      var catalog_liveTag_scan_threads_delayed_do = DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(catalog_liveTag_scan_threads, 200));\r\n////      var mutex_wd_liveTag_scan_threads = new MutexWatchdog('scan_threads');\r\n////      function catalog_liveTag_scan_threads() {\r\n////        if (!mutex_wd_liveTag_scan_threads.get()) {catalog_refresh_end();return;} // multi entry.\r\n////////        var tgts = []; // working code.\r\n////////        for (var i in scan.list_nup)\r\n////////////          if (scan.list_nup[i]!==null) {\r\n////////////            scan.list_nup[i] = null;\r\n////////////            tgts[tgts.length] = i;\r\n////////////          } else delete scan.list_nup[i];\r\n//////////          if (--scan.list_nup[i]>=0) tgts[tgts.length] = i; // leave nodes of <0 as black listed, patch for 8chan.\r\n////////          if (scan.list_nup[i]>0) tgts[tgts.length] = i;\r\n////        var tgts = scan.list_nup.get_list_thread();\r\n////        if (Object.keys(tgts).length!=0) scan_boards.scan_init('scan_threads', tgts, {callback: catalog_liveTag_scan_threads_cont,\r\n////                                                                                      watchdog: mutex_wd_liveTag_scan_threads.restart.bind(mutex_wd_liveTag_scan_threads),\r\n////////////                                                                                      crawler_watchdog: true\r\n////                                                                                     });\r\n////        else {\r\n////          mutex_wd_liveTag_scan_threads.stop();\r\n////          catalog_refresh_end();\r\n////        }\r\n////      }\r\n////      function catalog_liveTag_scan_threads_cont() {\r\n////        mutex_wd_liveTag_scan_threads.stop();\r\n////        if (mutex_wd_liveTag_scan_threads.query_req()) catalog_liveTag_scan_threads();\r\n////        else catalog_refresh_end();\r\n////      }\r\n////      cataLog.catalog_liveTag_scan_threads = catalog_liveTag_scan_threads;\r\n////      cataLog.catalog_liveTag_scan_threads_delayed_do = catalog_liveTag_scan_threads_delayed_do;\r\n\r\n      function catalog_refresh_end(){\r\n        if (pref.notify.favicon || pref.notify.title.notify) notifier.favicon.set(threads);\r\n//        if (pref.liveTag.style) liveTag.refresh_end_proc();\r\n//if (pref.debug_mode['9']) for (var i in scan.list_nup) if (scan.list_nup[i]<=0) console.log('list_nup: '+i+', '+scan.list_nup[i]);\r\n        if (pref.debug_mode['3']) {\r\n          var th_count = 0;\r\n          for (var d in liveTag.mems) for (var b in liveTag.mems[d]) for (var t in liveTag.mems[d][b]) th_count++;\r\n          var ths = {};\r\n          for (var i in liveTag.tags_ci) for (var j of liveTag.tags_ci[i].mems.keys()) ths[j.key] = null;\r\n          console.log('refresh_end: tags_ci+tags: '+Object.keys(liveTag.tags_ci).length+'+'+Object.keys(liveTag.tags).length+', threads:'+th_count+', '+Object.keys(ths).length);\r\n        }\r\n        if (pref[embed_mode].load_on_demand) show_catalog();\r\n      }\r\n      cataLog.catalog_refresh_end = catalog_refresh_end;\r\n\r\n////      var mutex_wd_liveTag_scan_ui = new MutexWatchdog('scan_ui'); // working code, @safe1069\r\n////      var liveTag_scan_ui_queue = {};\r\n////      function catalog_liveTag_scan_ui(key,arg) { // arg is {tgts:, options:}\r\n////        if (arg) {\r\n////          if (!liveTag_scan_ui_queue[key]) liveTag_scan_ui_queue[key] = {queue:[], mutex: new MutexWatchdog(key)};\r\n////          liveTag_scan_ui_queue[key].queue.push(arg);\r\n////        }\r\n////        var mutex = liveTag_scan_ui_queue[key].mutex;\r\n////        var queue = liveTag_scan_ui_queue[key].queue;\r\n////        if (!mutex.get()) return; // multi entry.\r\n////        if (queue.length>0) {\r\n////          var tgt = queue.shift();\r\n////          var scan_obj = {\r\n////            callback: catalog_liveTag_scan_ui_cont,\r\n////            callback_args: key,\r\n////            watchdog: mutex.restart.bind(mutex),\r\n////////////            crawler_watchdog: true,\r\n////            __proto__: tgt.options};\r\n////          scan_boards.scan_init(key, tgt.tgts, scan_obj);\r\n////        } else mutex.stop();\r\n////      }\r\n////      function catalog_liveTag_scan_ui_cont(key) {\r\n////        liveTag_scan_ui_queue[key].mutex.stop();\r\n////        catalog_liveTag_scan_ui(key);\r\n////      }\r\n\r\n//      function catalog_refresh_gather_info() {\r\n//        if (pref.catalog.order.sticky!=='dont_care') {\r\n//          var tgts = {};\r\n//          for (var name in threads) if (threads[name][20]===null) {\r\n//            var dbt = common_func.name2domainboardthread(name);\r\n//            tgts[dbt[0]+dbt[1]] = null;\r\n//          }\r\n//          if (Object.keys(tgts).length!=0) scan_boards.scan_init('refresh_watch', tgts, {force_json:true, callback:re_sort_thread});\r\n//        }\r\n//      }\r\n//      var flag_initial_refresh = (site.whereami==='boards') && pref.catalog.refresh.except_bt;\r\n\r\n      if (embed_frame) site2[site.nickname].catalog_frame_prep(pn12);\r\n//      else if (embed_mode==='float') pn12_0.getElementsByTagName('button')[pref.catalog.appearance.initial.state].onclick();\r\n//      else if (embed_mode==='float') {\r\n//        if (pref.catalog.appearance.initial.state==='maximized') pn12_0.childNodes[1].childNodes[3].onclick();\r\n//        else if (pref.catalog.appearance.initial.state==='top') pn12_0.childNodes[1].childNodes[0].onclick();\r\n//        else if (pref.catalog.appearance.initial.state==='bottom') pn12_0.childNodes[1].childNodes[1].onclick();\r\n///      }\r\n      if (embed_embed) {  // for native catalog\r\n//        pn12.style.display = 'none';\r\n        setTimeout(function(){ // required for 4chan, causes too many deleted posts ssometimes\r\n          cnst.tb_prep_for_embed(pn12_0);\r\n          pn12_0.appendChild(pn12_0_4);\r\n          site2[site.nickname].catalog_native_prep(Date.now(),pn12_0_4,pn12_0, embed_mode==='catalog');\r\n          var ths = insert_myself(null,null, true);\r\n//          if (site.whereami==='catalog') site2[site.nickname].clean_up_LS(ths);\r\n          if ((embed_mode==='page' && site2[site.nickname].all_boards && site2[site.nickname].all_boards.indexOf(site.board)!=-1) ||\r\n              (embed_mode==='thread' && pref.thread.env.auto_update_native)) { // BUG(,but patched), this cause conflicts, because insert_myself doesn't take merge_mode into account.\r\n            var observer = new MutationObserver(insert_myself);\r\n//            var observer = new MutationObserver(function(){setTimeout(insert_myself,10);}); // wait native script for 4chan, but doesn't work.\r\n//            observer.observe(triage_parent, {childList: true});\r\n            observer.observe((embed_mode==='page')? ths[0].pn.parentNode : ths[0].pn, {childList: true});\r\n            triage.change_mode();\r\n          }\r\n          if (show_catalog_init_funcs) show_catalog_init_funcs();\r\n          if (pref.catalog.filter.kwd.active && (embed_mode==='page' || embed_mode==='catalog')) show_catalog();\r\n          if (pref.catalog_board_list_sel!==0 && !(pref.catalog.board.all_boards && pref.catalog_board_list_sel===pref.catalog_board_list_obj.length-1)) {\r\n            var tgts = cataLog.catalog_refresh_1(embed_mode, false, false, false, false, pref.catalog_board_list_sel, false, false, null, true);\r\n            var key_me = site.nickname+site.board+((embed_mode==='catalog')? 'c0' : (embed_mode==='page')? 'p0' : site.no);\r\n            var key_me2= site.nickname+site.board+((embed_mode==='catalog')? 'j0' : (embed_mode==='page')? 'q0' : 't'+site.no);\r\n            if (Array.isArray(tgts) && pref.catalog.refresh.at_switch && tgts.indexOf(key_me)===-1 && tgts.indexOf(key_me2)===-1) catalog_clear_threads(0);\r\n          }\r\n//          if (pref.catalog_board_list_sel!==0 && pref.catalog.refresh.at_switch) catalog_clear_threads(0);\r\n        },0);\r\n        pn12.parentNode.removeChild(pn12);\r\n//        },10); // wait native script for 4chan, but doesn't work.\r\n      }\r\n      function insert_myself(e,observer,init,force_annotate){\r\n//          var ths = scan_boards.scan_boards_keyword_callback2(site.nickname+','+site.board+','+site.no+','+((embed_catalog)?'catalog':'page')+'_html',\r\n        var new_posts = [];\r\n        if (!pref.test_mode['122'] || init) {\r\n//          if (!init && (pref[embed_mode].merge || pref[embed_mode].merge_list)) return; // patch\r\n          if (e) {\r\n            var pfunc = site2[site.nickname].parse_funcs['post_html'].nativeUpdate2pn;\r\n            var posts_updated = {};\r\n            for (var i=0;i<e.length;i++) if (e[i].addedNodes) for (var j=0;j<e[i].addedNodes.length;j++) {\r\n              var key = (site.whereami==='thread')? site.key : gGEH.get_key_recursive(e[i].addedNodes[j], document);\r\n              var post = {pn:pfunc(e[i].addedNodes[j])};\r\n              if (!posts_updated[key]) posts_updated[key] = [post];\r\n              else posts_updated[key][posts_updated[key].length] = post;\r\n            }\r\n          }\r\n          var insert_thread_from_native = {init:init, posts_updated:init? null : posts_updated};\r\n          var ths = scan_boards.scan_boards_keyword_callback2(site.nickname+','+site.board+','+((site.whereami==='thread')?site.no:'0')+','+site.whereami+'_html',\r\n                                                              {date:Date.now(), status:200, response:document},\r\n                                                              ['native_prep',{native_prep:true, ext_posts:new_posts, force_annotate:force_annotate,\r\n                                                                              __proto__:cataLog.scan_boards_keyword_callback2_default_args}], insert_thread_from_native);\r\n          if (site.whereami==='thread') Object.defineProperty(site,'myself',{value:ths[0], writable:true, enumerable:true, configurable:true});\r\n        } else { // TEST PATCH\r\n          // DATA PROCESSING IS REQUIRED HERE, tag extraction, favicon and archiving.\r\n          var pfunc = site2[site.nickname].parse_funcs['post_html'].nativeUpdate2pn;\r\n          if (e) for (var i=0;i<e.length;i++) if (e[i].addedNodes) for (var j=0;j<e[i].addedNodes.length;j++) new_posts[new_posts.length] = {pn:pfunc(e[i].addedNodes[j])};\r\n          site2[site.myself.domain].wrap_to_parse.posts({posts:new_posts, __proto__:site.myself});\r\n          for (var i=0;i<new_posts.length;i++) format_html.prepare_html_post(site.myself, new_posts[i]);\r\n          for (var i=0;i<new_posts.length;i++) site.myself.posts[site.myself.posts.length] = new_posts[i];\r\n          insert_thread_format_html_add_events(site.myself, new_posts, true);\r\n          threads[site.myself.key][7] = site.myself;\r\n          threads[site.myself.key][16].posts = site.myself.posts;\r\n        }\r\n        if (embed_mode==='thread' && common_obj.thread_reader && new_posts.length!==0) common_obj.thread_reader.updated(new_posts,init);\r\n        return ths;\r\n      }\r\n      cataLog.insert_myself = insert_myself;\r\n        \r\n      function insert_thread_from_native_prep(th, lth, obj){\r\n        var posts_updated = obj.posts_updated && obj.posts_updated[th.key];\r\n        if (posts_updated) site2[th.domain].wrap_to_parse.posts({posts:posts_updated, __proto__:th});\r\n        var retval = {init: obj.init, posts_shown:lth.pd? th.posts.slice():th.posts, posts_updated: posts_updated}; // posts_shown===th.posts is for tgt_th[16].posts===th.psots in update_posts_in_page, (but not used)\r\n        if (lth.pd) {\r\n          if (site.myself && posts_updated && site.myself.posts.length + posts_updated.length == th.posts.length) th.posts = site.myself.posts.slice().concat(posts_updated); // prevent from re-parsing in thread.\r\n          var i=1; // doesn't contain OP\r\n          var j=0;\r\n          while (i<th.posts.length && j<lth.pd.length) { // lower posts may be parsed already.\r\n            if (th.posts[i].no==lth.pd[j].no) th.posts.splice(i,1);\r\n            else if (th.posts[i].no>lth.pd[j].no) j++;\r\n            else i++; // for broken data, i++ for default is the robustest.\r\n          }\r\n        }\r\n        return retval;\r\n      }\r\n////////      if (embed_catalog || embed_page) {  // for native catalog // working code.\r\n////////        pn12.style.display = 'none';\r\n////////        setTimeout(function(){ // patch for liveTag.\r\n////////          var date = Date.now();\r\n////////          site2[site.nickname].catalog_native_prep(date,pn12_0_4,pn12_0, embed_catalog);\r\n////////          insert_thread_from_native = true;\r\n//////////          var ths = scan_boards.scan_boards_keyword_callback2(site.nickname+','+site.board+','+site.no+','+((embed_catalog)?'catalog':'page')+'_html',\r\n////////          var ths = scan_boards.scan_boards_keyword_callback2(site.nickname+','+site.board+',0,'+((embed_catalog)?'catalog':'page')+'_html',\r\n////////                                                              {date:date, status:200, response:document},\r\n////////                                                              ['native_prep',{native_prep:true, found_threads: 0, max_threads:500, found_board:0, scanned:0, refresh:true}]);\r\n////////          insert_thread_from_native = false;\r\n////////          if (pref.thread_reader.own_posts_tracker && pref.thread_reader.clean_up_own_posts && site.whereami==='catalog') site2[site.nickname].clean_up_own_posts(ths,site.board);\r\n////////        },0);\r\n////////      }\r\n\r\n//    if (embed_mode!=='thread') setTimeout(function(){ // patch for liveTag.\r\n      if ((!window.opener || !window.name || window.name.slice(-1)!=='A') && site.whereami!=='archive') setTimeout(function(){ // patch for liveTag and archive.\r\n//    if (!window.opener) setTimeout(function(){ // patch for liveTag and archive. // THIS CAUSE WRONG BEHAVIOR when the page was load by clicking [catalog]\r\n      if (pref.catalog_board_list_sel!=0 || pref[embed_mode].env.refresh_initial) catalog_refresh(site.whereami!=='boards', embed_embed, false);\r\n    },1);\r\n      if (pref[embed_mode].merge || pref[embed_mode].merge_list)\r\n        setTimeout(site2['DEFAULT'].update_posts_merge_bases.onchange_merge.bind(null,({target:{name:embed_mode+'.merge'+(pref[embed_mode].merge?'':'_list')}})),2);\r\n\r\n      function catalog_insert(key) {\r\n        var dbt = key.split(',');\r\n        if (pref.catalog_promiscuous || (dbt[0]+dbt[1] in boards)) scan_boards.scan_init('snoop', [key], {lifetime:3600, crawler_max:1, tgt_raw:true});\r\n      }\r\n      function catalog_insert_snoop(key,value) {\r\n        catalog_insert2(key,value,true,true);\r\n      }\r\n      function catalog_insert2(key,value,snoop,from_auto) {\r\n//var check_perf = ['catalog_refresh :', performance.now()];\r\n        var dbt = key.split(',');\r\n        var nickname = dbt[0];\r\n        var board = dbt[1];\r\n        var read_type = dbt[3];\r\n        var page_no = dbt[2];\r\n        var thread = dbt[2];\r\n////////        var dbt = cnst.name2domainboardthread(key,true);\r\n////////        var nickname = dbt[0];\r\n////////        var board = dbt[1];\r\n////////        var read_type = (dbt[2][0]==='p')? 'page_html' : ((dbt[2][0]==='c')? 'catalog_html' : ((dbt[2][0]==='j')? 'catalog_json' : 'thread_html'));\r\n////////        var page_no = (read_type==='thread_html')? '?' : dbt[2].substr(1);\r\n////////        var thread = dbt[2];\r\n        if (snoop && !pref.catalog_promiscuous && read_type==='thread_html' && !threads[name]) {\r\n          var hit = false;\r\n          for (var i=0;i<load_list.refresh.tgts.length;i++) if (load_list.refresh.tgts[i][0].indexOf(name)!=-1) {hit=true;break;}\r\n          if (!hit) return 0; // return if no interest.\r\n        }\r\nif (pref.test_mode['3']) return;\r\n        if (!('response' in value)) value.response = (read_type==='catalog_json')? JSON.parse(value.responseText)\r\n                                                                                 : new DOMParser().parseFromString(value.responseText, 'text/html'); // cause memory leak at KC/int/.\r\nif (pref.test_mode['2']) return;\r\n//check_perf.push(performance.now());\r\n        var tgts_show = {};\r\n//        catalog_clear_threads(pref.catalog.max_threads);\r\n////////        if ((read_type==='page_html' || read_type==='thread_html') && nickname==='NONE') { // for debug\r\n//////////        if ((read_type==='page_html' || read_type==='thread_html') && nickname==='KC') { // for debug\r\n//////////        if ((read_type==='page_html' || read_type==='thread_html') && nickname!=='8chan') { // for debug\r\n//////////        if ((read_type==='page_html' && nickname!=='8chan') || read_type==='thread_html') { // for debug\r\n//////////        if (read_type==='page_html' || read_type==='thread_html') {\r\n////////          var name = nickname + board + thread;\r\n////////          if (snoop && !pref.catalog_promiscuous && read_type==='thread_html' && !threads[name]) {\r\n////////            var hit = false;\r\n////////            for (var i=0;i<load_list.refresh.tgts.length;i++) if (load_list.refresh.tgts[i][0].indexOf(name)!=-1) {hit=true;break;}\r\n////////            if (!hit) return 0; // return if no interest.\r\n////////          }\r\n//////////          value.responseText = site2[nickname].preprocess_html(value.responseText,read_type==='page_html'); // cause memory leak.\r\n//////////          var doc = ('response' in value)? value.response : new DOMParser().parseFromString(value.responseText, 'text/html');\r\n////////          var doc = value.response;\r\n////////          site2[nickname].preprocess_doc(doc);\r\n////////          var nof_posts = 0;\r\n////////          var nof_files = 0;\r\n////////          if (read_type==='thread_html') {\r\n////////            var nof_pi = site2[nickname].thread2headline(doc);\r\n////////            nof_posts  = nof_pi[0];\r\n////////            nof_files = nof_pi[1];\r\n////////            nof_pi = null; // for test\r\n////////            site2[nickname].add_thread_link(doc,site2[nickname].make_url3(board,thread));\r\n////////          }\r\n////////          if (site.nickname!=nickname || site.board!=board) site2[nickname].absolute_link(doc,board);\r\n////////          var threads_in_page = site2[nickname].catalog_threads_in_page(doc);\r\n////////          var th_no = site2[nickname].get_ops(doc);\r\n////////\r\n////////          for (var i=0;i<threads_in_page.length;i++) {\r\n////////            var p_node = threads_in_page[i].parentNode;\r\n////////            insert_thread_from_page(threads_in_page[i], nickname, board, th_no[i], page_no+((read_type==='page_html' && pref.show_page_fraction)? '.'+i : ''), (i==0)?nof_posts : 0, (i==0)?nof_files : 0, snoop, value.date);\r\n//////////          if (threads_in_page[i].parentNode==p_node) threads_in_page[i].parentNode.removeChild(threads_in_page[i]);\r\n////////            tgts_show[nickname+board+th_no[i]]=true;\r\n////////          }\r\n////////        } else {\r\n//          if (read_type==='thread_html') site2[nickname].add_thread_link(value.response,site2[nickname].make_url3(board,thread));\r\n//          if (read_type==='page_html' || read_type==='thread_html') site2[nickname].preprocess_doc(value.response);\r\n          var ths;\r\nif (pref.test_mode['0']) {\r\n          ths = {domain:nickname, board:board, page:page_no};\r\n          if (read_type==='catalog_json') ths.obj = value.response;\r\n          else ths.pn = value.response;\r\n          site2[ths.domain].parse_funcs[read_type].entry(ths,site2[ths.domain].parse_funcs[read_type]['before_test']);\r\n          ths = ths.ths;\r\n} else {\r\n//////          ths = Object.create({domain:nickname, board:board, page:page_no, parse_funcs:site2[nickname].parse_funcs[read_type], __proto__:site4.parse_funcs_on_demand});\r\n//////          if (read_type==='catalog_json') ths.obj = value.response;\r\n//////          else Object.defineProperty(ths,'pn',{value:value.response, enumerable:true, configurable:true, writable:true});\r\n////          var parse_obj = Object.create({domain:nickname, board:board, page:page_no, parse_funcs:site2[nickname].parse_funcs[read_type], __proto__:site4.parse_funcs_on_demand});\r\n////          ths = (read_type==='catalog_json')? {obj:value.response, __proto__:parse_obj} : {pn:value.response, __proto__:parse_obj};\r\n////          ths = ths.ths;\r\n          ths = site2[nickname].wrap_to_parse.get(value.response, nickname, board, read_type, {page:page_no});\r\n}\r\n          if (read_type==='catalog_json' || read_type==='catalog_html') rm_items_404_check(nickname,board,ths); // consumes 15-40 ms, too slow.\r\n          if (snoop && !pref.catalog_promiscuous) for (var i=ths.length-1;i>=0;i--) if (!(ths[i].key in threads)) ths.splice(i,1);\r\n//check_perf.push(performance.now());\r\n          for (var i=0;i<ths.length;i++) {\r\n//            if (read_type!=='catalog_json' && ths[i].pn.parentNode) ths[i].pn.parentNode.removeChild(ths[i].pn); // patch for memory leak issue, but probably fixed.\r\n            if (insert_thread_with_test(ths[i], read_type, value.date)) tgts_show[ths[i].key]=true;\r\n          }\r\n////////        }\r\n//check_perf.push(performance.now());\r\n        if (Object.keys(tgts_show).length!=0) {\r\n          show_catalog(tgts_show,from_auto);\r\n//          if (pref.catalog.filter.tag_scan_auto) scan_tags();\r\n        }\r\n//check_perf.push(performance.now());\r\n//check_perf.push('num: '+Object.keys(tgts_show).length);\r\n//common_func.perf_out(check_perf);\r\n      }\r\n\r\n      var threads_delayed_pruning = Object.create(null);\r\n      function restore_bd_from_IDB(domain, board){\r\n        if (!threads_delayed_pruning[domain]) threads_delayed_pruning[domain] = {};\r\n        if (!threads_delayed_pruning[domain][board]) threads_delayed_pruning[domain][board] = {};\r\n        IDB.req(domain, board, null, null, restore_bd_from_IDB_1, 'list_os');\r\n      }\r\n      function restore_bd_from_IDB_1(domain, board, nos){\r\n        for (var i=0;i<nos.length;i++) if (pref.test_mode['80'] || !threads[domain+board+nos[i]]) restore_th_from_IDB(domain, board, nos[i]);\r\n      }\r\n      function restore_th_from_IDB(domain, board, no){\r\n        IDB.req(domain, board, no, null, archiver.event_funcs['restore3'].bind(archiver.event_funcs), 'get_all');\r\n        if (!threads_delayed_pruning[domain]) threads_delayed_pruning[domain] = {}; // BUG, if a 404 thread is loaded before catalog, since this is used as a flag in above 'restore_bd_from_IDB' function.\r\n        if (!threads_delayed_pruning[domain][board]) threads_delayed_pruning[domain][board] = {};\r\n        threads_delayed_pruning[domain][board][no] = true;\r\n      }\r\n      cataLog.restore_th_from_IDB = restore_th_from_IDB;\r\n      function rm_items_404_check(domain, board, ths){\r\n        if (pref.patch.rm_404_blacklist.indexOf(domain)!=-1) return; // PATCH for 8chan, 8chan sends corrupted data.\r\n//        if (pref.catalog.bookmark_list_rm404) {\r\n//          var val = catalog_obj_merge(db,pref.catalog.filter.list_obj3,null);\r\n//          val = catalog_obj_merge(db,pref.catalog.filter.attr_list_obj3,val);\r\n//          if (val.hit) return true;\r\n//        }\r\n//        return false;\r\n//        return pref.catalog.bookmark_list_rm404\r\n//            && ((db in pref.catalog.filter.list_obj3) || (db in pref.catalog.filter.attr_list_obj3) || (db in pref.catalog.filter.watch_list_obj3));\r\n        var nos = Object.create(pref.archive.IDB.auto_restore && threads_delayed_pruning[domain] && threads_delayed_pruning[domain][board] || null);\r\n        for (var i=0;i<ths.length;i++) nos[ths[i].no] = null;\r\n        liveTag.rm_404(domain, board, nos); // MEMBERS of nos ARE ADDED IN THIS. // call remove_thread in this.\r\n        var db = domain + board;\r\n        var flag_item = (pref.catalog.bookmark_list_rm404\r\n            && ((db in pref.catalog.filter.list_obj3) || (db in pref.catalog.filter.attr_list_obj3) || (db in pref.catalog.filter.watch_list_obj3)));\r\n        if (flag_item) rm_items_404(db,nos);\r\n        if (!pref.test_mode['67']) archiver.clean_list_all(domain, board, nos);\r\n        var lbd = liveTag.mems[domain][board];\r\n        if (!lbd.LS_synced) {\r\n          site2[domain].clean_up_LS(domain, board, nos);\r\n          lbd.LS_synced = 1;\r\n        }\r\n        if (!pref.test_mode['65'] && !lbd.IDB_synced && pref.archive.IDB.auto_clean_init) IDB.clean_up(domain, board, nos);\r\n      }\r\n      function rm_items_404(db,nos){\r\n//console.log('rrr');\r\n        var tgts = [[pref.catalog.filter.list_str,      pref.catalog.filter.list_obj2,      search_ex_list],\r\n                    [pref.catalog.filter.attr_list_str, pref.catalog.filter.attr_list_obj2, attr_list],\r\n                    [pref.catalog.filter.watch_list_str, pref.catalog.filter.watch_list_obj2, watch_list]];\r\n        var db_len = db.length;\r\n        for (var i=0;i<tgts.length;i++) {\r\n//          var changed = false;\r\n////          for (var name in tgts[i][1]) { // too slow\r\n////            var dbt = common_func.name2domainboardthread(name,true);\r\n//////            if (dbt[0]===nickname && dbt[1]===board && dbt[2]!=='') {\r\n//////              var flag = false;\r\n//////              for (var j=0;j<ths.length;j++) if (dbt[2]==ths[j].no) {flag=true;break;}\r\n//////              if (!flag) {\r\n////            if (dbt[0]+dbt[1]===db && dbt[2]!=='') {\r\n////              if (nos[dbt[2]]===undefined) {\r\n////                if (pref.debug_mode['0']) console.log(name);\r\n////                triage_exe(name,'DELETE','',false);\r\n////                changed = true;\r\n////                if (threads[name]) remove_thread(name);\r\n////              }\r\n////            }\r\n////          }\r\n//          for (var name in tgts[i][1]) {\r\n////            if (!(name in nos) && name.indexOf(db)==0) {\r\n//            if (name.indexOf(db)==0 && name.length!=db.length && !(name in nos)) {\r\n//              if (pref.debug_mode['2']) console.log('rm_items_404: ' + name);\r\n//              triage_exe(name,'DELETE','',false); // BUG, this changes tgts[i][1], so inconsistency occurs, and requires redundant sequences.\r\n//              changed = true;\r\n//              if (threads[name]) remove_thread(name);\r\n//            }\r\n//          }\r\n//          if (changed) { // seems to be redundant.\r\n//            tgts[0][2].value = tgts[0][2].value.replace(/\\n\\n+/g,'\\n'); // triage_exe executes both.\r\n//            tgts[1][2].value = tgts[1][2].value.replace(/\\n\\n+/g,'\\n');\r\n//            tgts[2][2].value = tgts[2][2].value.replace(/\\n\\n+/g,'\\n');\r\n//            pref_func.apply_prep(tgts[i][2],true);\r\n//            pref_func.apply_prep(tgts[i][2],false);\r\n//          }\r\n          var list = [];\r\n          for (var name in tgts[i][1]) {\r\n            if (name.length>db_len && name.indexOf(db)===0 && !(name.substr(db_len) in nos)) {\r\n              if (pref.debug_mode['2']) console.log('rm_items_404: ' + name);\r\n              list[list.length] = name;\r\n            }\r\n          }\r\n          if (list.length>0) triage_exe(list[0],'DELETE',list.slice(1),false); // BUG, this changes tgts[i][1], so inconsistency occurs, and requires redundant sequences.\r\n        }\r\n      }\r\n\r\n//      function req_events(key,value,list) { // working code.\r\n//        list.mutex = true;\r\n////if (pref.debug_mode['0']) console.log(new Date().toLocaleTimeString() + ', refresh: callback: '+load_list.refresh.tgts[load_list.refresh.idx]+', '+load_list.refresh.idx);\r\n//        if (value.status==200 && (value.responseText || value.response)) catalog_insert2(key,value,false,list.from_auto);\r\n//        else {\r\n//          if (value.status==404) comment_out_bookmark(key);\r\n//          list.indicator.set('orange');\r\n//        }\r\n//        if (list.idx<list.tgts.length && value.status<500) {\r\n//          if (!pref[embed_mode].load_on_demand) get_page(list);\r\n//        } else {\r\n//          if (list.idx==1 && value.status!=200) list.indicator.set('red','X');\r\n//          else if (list.idx==list.tgts.length) list.indicator.set(null,'\\u25cf');\r\n//          else list.indicator.set(null,'\\u25b2');\r\n//          if (list.check_page) {\r\n//            refresh_idx_page = 0;\r\n//            page_check_entry();\r\n//          } else http_req.close('catalog'+list.key);\r\n//          catalog_refresh_watch();\r\n//        }\r\n//      }\r\n//      function get_page(list){\r\n////if (pref.debug_mode['0']) console.log(new Date().toLocaleTimeString() + ', refresh: get: '+list.tgts[list.idx]+', '+list.idx);\r\n//        if (pref[embed_mode].load_on_demand && list.idx==0) \r\n//          for (var i=list.tgts.length-1;i>=1;i--) {\r\n//            var name = 'ODL:'+list.tgts[i];\r\n//            if (threads[name]) remove_thread(name);\r\n//            threads_idx.unshift(name);\r\n//          }\r\n////        if (tgt===undefined) tgt = list.tgts[list.idx];\r\n////        else tgt = [tgt,false];\r\n//        if (list.idx==0 && !list.indicator) list.indicator = health_indicator.shift('limegreen','0');\r\n//        list.indicator.set(null,(list.idx+1)+'/'+list.tgts.length);\r\n//        http_req.get('catalog'+list.key,list.tgts[list.idx].replace(/!.*/,''),'',req_events,list.use_cache,true,list);\r\n//        list.idx++;\r\n//        list.mutex = false;\r\n//      }\r\n//\r\n////      function req_events(key,value,args) {\r\n//////if (pref.debug_mode['0']) console.log(new Date().toLocaleTimeString() + ', refresh: callback: '+refresh_tgts[refresh_idx][0]+', '+refresh_idx);\r\n////        var inserted_idx = 0;\r\n//////        var key = refresh_tgts[refresh_idx][0].replace(/!.*/,'');\r\n//////        var key = args[0].replace(/!.*/,'');\r\n////        if (value.status==200 && value.responseText) {\r\n////          inserted_idx = catalog_insert2(key,value,false,args[1]);\r\n////        } else {\r\n////          if (value.status==404) comment_out_bookmark(key);\r\n////          health_indicator.set('orange');\r\n////        }\r\n////        refresh_idx++;\r\n////        if (refresh_idx<refresh_tgts.length && value.status<500) {\r\n////          if (!pref[embed_mode].load_on_demand) get_page();\r\n////          else {\r\n////            if (threads_idx.length==inserted_idx+1) threads_idx.push('url');\r\n////            else threads_idx.splice(inserted_idx+1,0,'url');\r\n//////            threads_idx.splice(page_delim_idx[refresh_idx],0,'url'); // THIS MAKES SUBTLE BUG, insert point slides from here at snoop refresh, but ok to use, so I'll omit.\r\n////            show_catalog();\r\n////          }\r\n////        } else {\r\n////          if (refresh_idx==1 && value.status!=200) health_indicator.set('red','X');\r\n////          else if (refresh_idx==refresh_tgts.length) health_indicator.set(null,'\\u25cf');\r\n////          else health_indicator.set(null,'\\u25b2');\r\n////          refresh_idx_page = 0;\r\n////          page_check_entry();\r\n////        }\r\n////      }\r\n////      function get_page(){\r\n//////if (pref.debug_mode['0']) console.log(new Date().toLocaleTimeString() + ', refresh: get: '+refresh_tgts[refresh_idx][0]+', '+refresh_idx);\r\n////        health_indicator.set(null,(refresh_idx+1)+'/'+refresh_tgts.length);\r\n////        http_req.get('catalog',refresh_tgts[refresh_idx][0].replace(/!.*/,''),'',req_events,refresh_use_cache,true,refresh_tgts[refresh_idx]);\r\n////      }\r\n\r\n      var refresh_idx_page;\r\n      function page_check_entry(){\r\n        while (refresh_idx_page<load_list.refresh.tgts.length) {\r\n          if (load_list.refresh.tgts[refresh_idx_page][0].search(/!page/)==-1) refresh_idx_page++;\r\n          else {\r\n            var name = load_list.refresh.tgts[refresh_idx_page++][0].replace(/!.*/,'');\r\n            if (threads[name]) {\r\n              if (threads[name][14].toString()[0]=='?') {\r\n                var page_no_old = parseInt(threads[name][15].toString().replace(/\\..*/,''),10);\r\n                if (isNaN(page_no_old)) page_no_old = 0;\r\n                page_check(name,page_no_old,page_check_callback);\r\n                break;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      function page_check_callback(name,str,date){\r\n//console.log('Callback : '+name+', '+str);\r\n        update_page_in_footer(name,str,date); // to show Dead.\r\n        page_check_entry();\r\n      }\r\n      function update_page_in_footer(name,str,date){\r\n//        if (threads[name]) {\r\n        if (threads[name] && threads[name][0].getElementsByTagName('div')['catalog_footer']) { // patch for threads, this will be removed.\r\n          var pn = threads[name][0].getElementsByTagName('div')['catalog_footer'].childNodes[0];\r\n          if (pn) {\r\n//            var str = str + '@' + new Date(date).toLocaleTimeString();\r\n            pn.innerHTML = pn.innerHTML.replace(/[^\\/]*$/,str);\r\n          }\r\n          threads[name][13]=date;\r\n          threads[name][15]=threads[name][14];\r\n          threads[name][14]=str;\r\n        }\r\n      }\r\n \r\n      function page_check(name,page_ini,callback){\r\n        var dbt = cnst.name2domainboardthread(name,true);\r\n        var domain = dbt[0];\r\n        var board = dbt[1];\r\n        var thread = dbt[2];\r\n        var page_idx = [];\r\n        var max_page = site2[domain].max_page(dbt[1]);\r\n        page_idx[0] = page_ini;\r\n        page_idx[1] = (page_ini+1)%(max_page+1);\r\n        for (var i=0;i<=max_page;i++) if (i!=page_idx[0] && i!=page_idx[1] && (!refresh_use_cache || i!=max_page)) page_idx.push(i);\r\n//        if (!refresh_use_cache) for (var i=0;i<5;i++) page_idx.push(page_idx[i]); // for retry, but live cache working...\r\n        var page_no;\r\n        var key;\r\n      \r\n        function page_check(){\r\n          page_no = page_idx.shift();\r\n          key = (page_no==max_page)? domain+board+thread : domain+board+'p'+page_no;\r\n//          http_req.get('catalog',key,url,req_events_page_check,refresh_use_cache);\r\n          http_req.get('catalog',key,'',req_events_page_check,refresh_use_cache,true);\r\n        }\r\n        page_check();\r\n        function req_events_page_check(key,value) {\r\n//console.log('Read : '+name+', '+key+', '+value.status);\r\n          var callback_str = null;\r\n          if (value.status!=200) {\r\n            if (page_no==max_page && value.status==404) callback_str = 'Dead';\r\n            else callback_str = 'HTTP'+value.status;\r\n          } else {\r\n            var doc = ('response' in value)? value.response : new DOMParser().parseFromString(value.responseText, 'text/html');\r\n            var ops = site2[domain].get_ops(doc);\r\n            var hit = false;\r\n            if (page_no!=max_page) for (var i=0;i<ops.length;i++) if (thread==ops[i]) {hit=true;callback_str = page_no+((pref.show_page_fraction)? '.'+i : '');}\r\n            if (!hit) {\r\n              if (value.responseText != null && page_idx.length!=0) setTimeout(page_check, 0); // live cache make racing condition with this. I don't know why.\r\n              else callback_str = '?' + ((!refresh_use_cache)? '(missing)' : '');\r\n              if (site2[domain].check_thread_archived(doc)) callback_str = 'Archived';\r\n            }\r\n          }\r\n          if (value.status==200) catalog_insert2(key,value,true); // update\r\n          if (callback_str!==null) {\r\n            if (callback_str==='Dead' || callback_str==='Archived') {\r\n              comment_out_bookmark(name);\r\n//              var tgt = pn12_0_4.getElementsByTagName('textarea')['catalog.filter.bookmark_list_str'];\r\n//              tgt.value = comment_out_key(name,tgt.value);\r\n//              pref_func.apply_prep(tgt,true);\r\n            }\r\n            callback(name,callback_str,value.date);\r\n          }\r\n//console.log('Out : '+name+', '+key+', '+value.status);\r\n        }\r\n      }\r\n      function comment_out_bookmark(name){\r\n        var tgt = pn12_0_4.getElementsByTagName('textarea')['catalog.filter.bookmark_list_str'];\r\n        tgt.value = comment_out_key(name,tgt.value);\r\n        pref_func.apply_prep(tgt,true);\r\n      }\r\n      function comment_out_key(key,str){\r\n////        var comments = [];\r\n////        var str_ret = '';\r\n////        var comment = new RegExp('//.*$','m');\r\n////        while (1) {\r\n////          var idx = str.search(comment);\r\n////          if (idx!=-1) comments.push([idx,str.match(comment)[0]]);\r\n////          else break;\r\n////        }\r\n//        return str.replace(key,'//$&');\r\n        var rep_str = (pref.catalog.bookmark_list_rm404)? '' : '//$&';\r\n////        return str.replace(new RegExp(key+'(!page)*(,|\\n|$)','g'),rep_str); // working code.\r\n        var dbt = key.split(',');\r\n        return str.replace(new RegExp(dbt[0]+dbt[1]+dbt[2]+'(!page)*(,|\\n|$)','g'),rep_str);\r\n      }\r\n\r\n      initialize_loop = false;\r\n      pref_func.mirror_targets.pn12_0_2 = pn12_0_2;\r\n      pref_func.mirror_targets.pn12_0_4 = pn12_0_4;\r\n\r\n      var GEH = function(parent){ // GeneralEventHandler\r\n        this.parent = parent;\r\n        this.subscribers = [];\r\n        this.valid = null;\r\n        this.last_viewed = null;\r\n        this.last_Y = 0;\r\n      };\r\n      GEH.prototype = {\r\n        setup: function(reset){\r\n          if (pref[embed_mode].scroll_lock && !this.valid && !reset){\r\n            this.valid = this.mouseover_lock.bind(this);\r\n            this.parent.addEventListener('mouseover', this.valid, true);\r\n          } else if (this.valid) {\r\n            this.parent.removeEventListener('mouseover', this.valid, true);\r\n            this.valid = null;\r\n          }\r\n        },\r\n//        var geh = site2[site.nickname].general_event_handler[site.whereami];\r\n        mouseover_lock: function(e){\r\n//if (pref.debug_mode['14']) if (last_viewed) site2[site.nickname].general_event_handler[site.whereami].get_mark(last_viewed, get_now_height()+last_Y).style.border = 'none';\r\n          this.last_viewed = e.target;\r\n          this.last_Y = e.clientY;\r\n////          if (geh.last_viewed.call(this,e)) show_catalog_scroll_lock.viewed(e.target);\r\n//          //          e.stopPropagation();\r\n//if (pref.debug_mode['14']) {\r\n//  var pn = site2[site.nickname].general_event_handler[site.whereami].get_mark(e.target, get_now_height()+last_Y);\r\n//  if (!pn.classList.contains('post')) console.log(e.target, pn)\r\n//  pn.style.border = '1px solid blue';\r\n//}\r\n        },\r\n        change: (function(){\r\n          var class_expander = pref.script_prefix + '_expander';\r\n          return function(e){\r\n            if (e.target.className===class_expander) {\r\n              var name = e.target.getAttribute('data-key');\r\n              cataLog.threads[name][16].expand(e.target.selectedIndex);\r\n//              threads[name][16].t2h_sel = format_html.get_t2h_from_index(e.target.selectedIndex);\r\n//              threads[name][16].expand_posts = true;\r\n////            drawn_idx = 0; // patched in 'show_catalog', because this is required when images are expanded.\r\n//              scan.scan_ui('expand_page', {tgts:[name], options:{refresh:true}});\r\n              e.target.blur();\r\n            }\r\n          };\r\n        })(),\r\n        blacklist_click: new WeakSet(),\r\n        geh: site2[site.nickname].general_event_handler[site.whereami],\r\n        click: function(e){\r\n          var et = e.target;\r\n          if (!pref.test_mode['104']) {\r\n            var isThumbnail = GEH.prototype.geh.isThumbnail(e);\r\n            if (cataLog.embed_mode==='catalog' && (isThumbnail || pref[cataLog.embed_mode].click_area==='entire')) {\r\n              e.preventDefault();\r\n              var key = gGEH.get_key_recursive(e.target, e.currentTarget)\r\n              if (key) click_thread(key);\r\n//              var tgt = GEH.prototype.geh.recSearch_thread(e.target, e.currentTarget);\r\n//              if (tgt) click_thread(tgt.name);\r\n            } else if (isThumbnail) {\r\n              var domain = site2['DEFAULT'].popups_posts.href2domain(et.getAttribute('src'));\r\n              if (!GEH.prototype.blacklist_click.has(et) && (!pref[embed_mode].env.expand_thumbnail_inline_native || !(pref[embed_mode].env.event_dynamic && domain===site.nickname)))\r\n                DIH.expand_thumbnail_inline.call(e.target, e);\r\n            }\r\n//          if (!pref.test_mode['104'] && GEH.prototype.geh.isThumbnail(e)) {\r\n//            if (cataLog.embed_mode==='catalog') click_thread_tn(e);\r\n//            else {\r\n//              var domain = site2['DEFAULT'].popups_posts.href2domain(et.getAttribute('src'));\r\n//              if (!GEH.prototype.blacklist_click.has(et) && (!pref[embed_mode].env.expand_thumbnail_inline_native || !(pref[embed_mode].env.event_dynamic && domain===site.nickname)))\r\n//                DIH.expand_thumbnail_inline.call(e.target, e);\r\n//            }\r\n          } else if (et.tagName==='A') {\r\n            if (pref.test_mode['93']) {\r\n              var filename = et.getAttribute('download');\r\n              if (filename) {\r\n                var href = et.getAttribute('href');\r\n                var tgt_domain = href.search(/^(https*:)*\\/\\//)!=-1 && href.replace(/^(https*:)*\\/\\//,'').match(/^([^/]*)\\//)[1];\r\n                if (site2['ALL'][tgt_domain]) tgt_domain = site2[site2['ALL'][tgt_domain]].nickname;\r\n                if (tgt_domain!=site2[site.nickname].domain_url) {\r\n                  httpd.req({tgts:[{url:href, domain:tgt_domain, archive:filename, responseType:'blob'}], max:1, initiator:'download', callback_1:function(){}},6);\r\n                  e.preventDefault();\r\n                  e.stopPropagation();\r\n                  return;\r\n                }\r\n              }\r\n            }\r\n            if (pref.test_mode['87']) {\r\n              if (et.href.indexOf('//www.youtube.com')!==-1) insert_iframe_youtube(et.href.replace(/watch\\?v=/,'embed/'), e);\r\n              else if (et.href.indexOf('//youtu.be')!==-1)   insert_iframe_youtube(et.href.replace(/youtu.be/,'youtube.com/embed'), e);\r\n              else {\r\n                var cmd = et.getAttribute('data-cmd');\r\n                if (cmd && cmd.indexOf(pref.script_prefix)===0) {\r\n                  cmd = cmd.substr(pref.script_prefix.length+1);\r\n                  if (cmd==='remove_next') remove_next(e);\r\n                }\r\n              }\r\n            }\r\n          }\r\n          function insert_iframe_youtube(url, e, et){\r\n            var et = e.target;\r\n            var close_button = document.createElement('span');\r\n            close_button.innerHTML = ' [<a data-cmd=\"'+pref.script_prefix+'_remove_next\">Remove</a>] ';\r\n            if (!et.nextSibling || et.nextSibling.innerHTML!==close_button.innerHTML) {\r\n              e.target.parentNode.insertBefore(close_button,et.nextSibling);\r\n              var div = document.createElement('div');\r\n              div.innerHTML = '<iframe src=\"' + url + '\" width=\"640\" height=\"360\" frameborder=\"0\" allowfullscreen=\"\"></iframe>';\r\n              div.classList.add('media-embed');\r\n              et.parentNode.insertBefore(div,close_button.nextSibling);\r\n            }\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n          }\r\n          function remove_next(e){\r\n            e.target.parentNode.parentNode.removeChild(e.target.parentNode.nextSibling);\r\n            e.target.parentNode.parentNode.removeChild(e.target.parentNode);\r\n          }\r\n        },\r\n        get_last_viewed: function(){\r\n          return (this.last_viewed)? site2[site.nickname].general_event_handler[site.whereami].get_mark(this.last_viewed, get_now_height()+this.last_Y) : null;\r\n        },\r\n        clear_last_viewed: function(){this.last_viewed = null;},\r\n        init: function(){\r\n          var dynamic_image_hover = site2[site.nickname].parse_funcs[site.whereami+'_html'].dynamic_image_hover;\r\n          var geh = site2[site.nickname].general_event_handler[site.whereami];\r\n//          if (geh && geh.mouseover && (geh.add_mouseover || dynamic_image_hover)) if (pref.test_mode['103']) common_func.dom_addEventListener(this.subscribers, this.parent, 'mouseover', geh.mouseover);\r\n          common_func.dom_addEventListener(this.subscribers, this.parent, 'change', this.change);\r\n          if (pref.test_mode['87'] || pref.test_mode['93'] || !pref.test_mode['104']) common_func.dom_addEventListener(this.subscribers, this.parent, 'click', this.click);\r\n          if (!pref.test_mode['104']) site.popup_body.addEventListener('click', this.click, false);\r\n          this.setup();\r\n//          if (!pref.test_mode['98']) if (pref.test_mode['103']) site.popup_body.addEventListener('mouseover', site2[site.nickname].general_event_handler['page'].mouseover, false);\r\n          this.parent.addEventListener('dragstart', this.dragstart, false);\r\n          this.parent.addEventListener('dragend', this.dragend, false);\r\n          site.popup_body.addEventListener('dragstart', this.dragstart, false);\r\n          site.popup_body.addEventListener('dragend', this.dragend, false);\r\n        },\r\n        destroy: function(){\r\n          this.setup(true);\r\n          common_func.dom_removeEventListener(this.subscribers);\r\n        },\r\n        mouseover: function(e, force){\r\n          var et = e.target;\r\n          site2['DEFAULT'].popups_posts.over(e, force);\r\n          if (pref.liveTag.info && pref.tooltips['info'].show)\r\n            if (et.className===pref.script_prefix+'_tag') pref_func.tooltips.req_show('info', e, liveTag.tag_onmouseover); // mouseover only for faster execution. mouseleave is needed strictly.\r\n            else pref_func.tooltips.hide2();\r\n          \r\n        },\r\n        mouseleave_bl: function(e){\r\n          if (pref.liveTag.info) pref_func.tooltips.hide2();\r\n        },\r\n        drag_sx: 0,\r\n        drag_sy: 0,\r\n        dragstart: function(e){\r\n          var myself = GEH.prototype;\r\n          myself.drag_sx = e.screenX;\r\n          myself.drag_sy = e.screenY;\r\n        },\r\n        dragend: function(e){\r\n          if (!pref[embed_mode].thumbnail.hover.dragfloat || (!DIH.hover_ex && e.target.tagName!=='IMG')) return;\r\n          var myself = GEH.prototype;\r\n          var img = DIH.image_hover_snatch();\r\n          var right = ((img)? parseInt(img.style.right,10) : cnst.left2right(e.clientX - e.offsetX, e.target)) - (e.screenX - myself.drag_sx);\r\n          var top = ((img)? parseInt(img.style.right,10) : e.clientY - e.offsetY) + e.screenY - myself.drag_sy;\r\n          var cn = cnst.init3({\r\n            func_str:'right:'+right+'px:top:'+top+'px:tb:ftb:overflow:auto:Show'}).cn;\r\n          cn.appendChild(img || e.target.cloneNode());\r\n          if (img) DIH.image_hover_snatch_end();\r\n        },\r\n      };\r\n      cataLog.GEH = GEH;\r\n      cataLog.general_event_handler = new GEH(triage_parent);\r\n      setTimeout(cataLog.general_event_handler.init.bind(cataLog.general_event_handler), 500); // WHY 500ms delay?\r\n\r\n      var GEH_mouseover_force = (function(func){return function(e){func(e,true);e.stopPropagation()};})(GEH.prototype.mouseover);\r\n//      var GEH_mouseover_force = (function(func){return function(e){func(e,true);};})(GEH.prototype.mouseover);\r\n      if (!pref.test_mode['98']) site.popup_body.addEventListener('mouseover',GEH_mouseover_force,false);\r\n      site.root_body.addEventListener('mouseover', GEH.prototype.mouseover, false);\r\n//      triage_parent.addEventListener('mouseover', (embed_mode==='float')? GEH_mouseover_force : GEH.prototype.mouseover, false);\r\n//      triage_parent.addEventListener('mouseleave', site2['DEFAULT'].popups_posts.leave, false);\r\n      if (site.components.boardlist) {\r\n        site.components.boardlist.addEventListener('mouseover',GEH.prototype.mouseover,false);\r\n        site.components.boardlist.addEventListener('mouseleave',GEH.prototype.mouseleave_bl,false);\r\n      }\r\n      site2['DEFAULT'].popups_posts.init(triage_parent);\r\n\r\n      function make_watcher(){\r\n        var pn_test = document.createElement('div');\r\n        var clg = new Clg(false,'float', true);\r\n        for (var name in pClg.threads) clone_thread(clg, name);\r\n//        clg.ppn.setAttribute('style','white-space:nowrap');\r\n//        clg.ppn.setAttribute('style','text-overflow:ellipsis;white-space:nowrap;width:100%');\r\n        clg.show_catalog();\r\n      }\r\n      function clone_thread(clg, name){\r\n        if (!clg.threads[name]) {\r\n          var max_txt = 500;\r\n          var lth = liveTag.mems.getFromName(name);\r\n          var pn = document.createElement('div');\r\n          pn.className = pref.script_prefix+'_headline';\r\n//          pn.setAttribute('style','white-space:nowrap;text-overflow:ellipsis;overflow:hidden;width:100%');\r\n          var txt = site2[lth.domain].post_com2txt(lth.th);\r\n          var sub_com = ((lth.th.sub? '<b>'+lth.th.sub+'</b>: ': '') + txt);\r\n          var sub_com_max = max_txt - (lth.th.sub? 2:0);\r\n          if (sub_com.length>=sub_com_max) sub_com = sub_com.slice(0, sub_com_max) + '...';\r\n          pn.innerHTML = '<span></span> '+sub_com;\r\n          clg.threads[name] = {0:pn, 16:{__proto__:pClg.threads[name][16]}, 24:[pn.firstChild, null,null,null,0x06], __proto__:pClg.threads[name]};\r\n        }\r\n        clg.idx_reorder(name);\r\n      }\r\n      \r\n      return {\r\n        destroy: function(){ // destructor\r\n          if (pref.test_mode['114']) {\r\n            make_watcher();\r\n            styleSheet.register_cc('headline','white-space:nowrap;text-overflow:ellipsis;overflow:hidden;width:100%');\r\n            return this;\r\n          }\r\n\r\n          cataLog.general_event_handler.destroy();\r\n//          triage.off();\r\n          for (var name in threads) gClg.remove_thread(name);\r\n//          pref_func.remove_onchange(pn12_0_2); // prevent leak.\r\n//          pref_func.remove_onchange(pn12_0_4); // prevent leak.\r\n          pref_func.mirror_targets.pn12_0_2 = null;\r\n          pref_func.mirror_targets.pn12_0_4 = null;\r\n          catalog_clear_threads(0);\r\n          if (brwsr.sw_cache && brwsr.sw_cache.subscribe) brwsr.sw_cache.subscribe(false);\r\n//          pref_func.health_indicator = null;\r\n          health_indicator.destroy();\r\n//          if (embed_catalog) if (catalog_native_destroy) catalog_native_destroy();\r\n          cnst.auto_shrink_board_selector.destroy(board_sel);\r\n          window_beforeunload();\r\n//          pref_func.tooltips.remove_hier(pn12_triage);\r\n          remake_triage(true);\r\n//          pref_func.tooltips.remove_hier(pn12_0_4);\r\n          pref_func.tooltips.remove_root(pn12_0_4);\r\n          pref_func.tooltips.hide();\r\n//          clearTimeout(auto_update_timer);\r\n          auto_update.stop_if_running();\r\n          pn12.parentNode.removeChild(pn12);\r\n          window.removeEventListener('storage', site2[site.nickname].prep_own_posts_event, false); // debug\r\n          scroll_event_src.removeEventListener('scroll', show_catalog_cont, false);\r\n          window.removeEventListener('resize', show_catalog_cont, false);\r\n//          pn12.removeEventListener('dragstart', auto_hide_catalog, false);\r\n//          pn12.removeEventListener('dragend'  , auto_hide_catalog, false);\r\n//          pn12_triage.removeEventListener('mouseover', catalog_triage_out_clear, false);\r\n//          pn12_triage.removeEventListener('mouseout' , catalog_triage_out_delay, false);\r\n          pn12 = null;\r\n          liveTag.pn = null;\r\n          for (var i in cataLog) cataLog[i] = null;\r\n          return null;\r\n        },\r\n        remake_triage: remake_triage,\r\n        triage_exe_pipe: triage_exe_pipe,\r\n        catalog_insert: catalog_insert,\r\n        pn12_0_4: pn12_0_4,\r\n        pn12_0_2: pn12_0_2,\r\n        catalog_resized: catalog_resized,\r\n        get_threads: function(){return threads;},\r\n        catalog_filter_changed: catalog_filter_changed,\r\n        scan_boards: scan_boards,\r\n        show_catalog: show_catalog,\r\n//        threads: threads,\r\n        catalog_liveTag_scan_site: onchange_funcs['scanSite'],\r\n      }\r\n    }\r\n    return {\r\n      catalog_func: function(){return catalog_func;},\r\n      scan_tags_common: scan_tags_common,\r\n      show_hide: show_hide,\r\n    }\r\n  }\r\n\r\n  var stats = (pref3.stats.use)? (function(){\r\n    var tree_404 = {};\r\n    function thread_removed(dbt){\r\n      var lth = liveTag.mems[dbt[0]][dbt[1]][dbt[2]];\r\n      if (lth.ss) {\r\n        if (Array.isArray(lth.ss)) for (var i=0;i<lth.ss.length;i++) {if (lth.ss[i].rm) lth.ss[i].rm.update_thread(lth.s, 0, true);}\r\n        else if (lth.ss.rm) lth.ss.rm.update_thread(lth.s, 0, true);\r\n      }\r\n      if (pref.stats.retain_404 && lth.s) {\r\n        if (!tree_404[dbt[0]]) tree_404[dbt[0]] = {};\r\n        if (!tree_404[dbt[0]][dbt[1]]) tree_404[dbt[0]][dbt[1]] = {};\r\n        tree_404[dbt[0]][dbt[1]][dbt[2]] = liveTag.mems[dbt[0]][dbt[1]][dbt[2]];\r\n//        if (tree_404[dbt[0]][dbt[1]].sr || Object.keys(tree_404[dbt[0]][dbt[1]]).length>64) update_board_rm(tree_404[dbt[0]][dbt[1]]);\r\n        if (pref.test_mode['44'] || tree_404[dbt[0]][dbt[1]].sr || Object.keys(tree_404[dbt[0]][dbt[1]]).length>64) update_board_rm(tree_404[dbt[0]][dbt[1]]);\r\n      }\r\n    }\r\n    \r\n    var label_funcs = {\r\n      hour: function(t){return new Date(t*60000).toString().split(' ')[4].replace(/:\\d*$/,'');},\r\n      day: function(t){return new Date(t*60000).toString().replace(/\\s\\d{4}.*/,'');},\r\n      sunday : function(t){\r\n        var str = new Date(t*60000).toString();\r\n        return (str.split(' ')[0]=='Sun')? str.replace(/\\s\\d{4}.*/,'') : '';\r\n      },\r\n      month : function(t){\r\n        var str = new Date(t*60000).toString();\r\n        return (str.split(' ')[2]=='01')? str.replace(/\\s\\d{4}.*/,'') : '';\r\n      },\r\n      quarter_year : function(t){\r\n        var strs = new Date(t*60000).toString().split(' ');\r\n        return (strs[2]<=7 && ['Jan','Apr','Jul','Oct'].indexOf(strs[1])!=-1)? strs.slice(1,4).join(' ') : '';\r\n      },\r\n    }\r\n    label_funcs['1'] = [60, label_funcs.hour, 1];\r\n//    label_funcs['2'] = [60, label_funcs.hour, 1]; // debug\r\n    label_funcs['10'] = [60, label_funcs.hour, 1];\r\n    label_funcs['60'] = [1440, label_funcs.day, 1];\r\n    label_funcs['1440'] = [1440, label_funcs.sunday, 0];\r\n    label_funcs['10080'] = [1440, label_funcs.quarter_year, 0];\r\n//    var time_unit_arr = [1,2,60,1440,10080]; // debug\r\n    var time_unit_arr = [1,10,60,1440,10080];\r\n\r\n    function thread_created(lth){\r\n      for (var i=0;i<instances.length;i++) {\r\n        var result = pref_func.merge_obj5(lth.key, instances[i].tgts_obj2,{hit:false});\r\n        if (result.hit) instances[i].check_and_add_thread(lth);\r\n      }\r\n    }\r\n    var time_root = Math.floor(Date.now()/60000);\r\n    var instances= [];\r\n//    var count = 0;\r\n    var Stats = function(chart, tgts, key){\r\n      instances.push(this);\r\n      this.chart = chart;\r\n      this.tolerance = 0;\r\n//      this.name = 'graph_'+ count++;\r\n      this.draw = DelayBuffer.prototype.delayed_do.bind(new DelayBuffer(this.refresh.bind(this), pref.stats.draw_delay*1000));\r\n      this.wdg_tick = new Watchdog(this.prep_time.bind(this), 60000);\r\n      this.fromNo = (pref3.stats.estimate_posts)? new StatsFromNo(this) : null; // for subscribe, this pointer can't be changed.\r\n      this.tgts_changed(tgts, key, true); // this.tgts, this.key\r\n      this.time_unit_changed(pref.chart.inst.time_sel, true); // this.time_base, this.time_unit, this.time_last, time_sel\r\n      this.len_changed((this.chart && this.chart.len>pref.stats.len_capture)? this.chart.len : pref.stats.len_capture); // this.len, this.data_p, this.data_t, this.data_l, this.min_idx, this.data_p_old, this.data_t_old, this.shift, this.rm.data_p, this.rm.data_t\r\n    };\r\n    Stats.prototype = {\r\n      destroy: function(){\r\n        this.chart = null;\r\n        this.save_all_unsubscribe(true);\r\n        this.wdg_tick.stop();\r\n        instances.splice(instances.indexOf(this),1);\r\n      },\r\n      merge_1: function(dst,src){\r\n        if (src) for (var i=0;i<src.length;i++) if (dst[i]<src[i]) dst[i] = src[i]; // src[i] may be undefined.\r\n        return dst;\r\n      },\r\n      merge_1_hier: function(dst,src, lower){\r\n        var num = this.time_unit/lower.time_unit;\r\n        var start = Math.ceil((lower.time_base - this.time_base)/this.time_unit);\r\n        var i = (num - (lower.time_base%this.time_unit)/lower.time_unit)%num; // start offset\r\n        while (i<src.length) {\r\n          this.merge_1_hier_1(dst, src, start, i, num, lower);\r\n          i+=num;\r\n          start++;\r\n        }\r\n      },\r\n      merge_1_hier_1: function(dst,src,idx_d,idx_s,num, lower){\r\n        var data = 0;\r\n        var end = (src.length>=idx_s+num)? num : src.length - idx_s;\r\n        for (var j=0;j<end;j++) data += src[idx_s+j];\r\n        if (pref.debug_mode['15'])\r\n          if (data>dst[idx_d])\r\n            console.log('merge_1_hier_1: '+this.time_unit+': '+idx_d+', '+dst[idx_d]+'->'+data+', '+\r\n                        new Date((this.time_base+idx_d*this.time_unit)*60000).toLocaleString()+', '+\r\n                        new Date((lower.time_base+idx_s*lower.time_unit)*60000).toLocaleString()+', '+num);\r\n        if (data>dst[idx_d]) dst[idx_d] = data;\r\n      },\r\n      save_all_unsubscribe: function(from_destructor){ // destructive\r\n        if (this.tgts && pref.stats.save && auto_acquisition_keys['@'+this.key]!==undefined) {\r\n          var timestamp = Math.floor(Date.now()/60000);\r\n          if (auto_acquisition_keys['@'+this.key]!==timestamp) { // prevent from saving twice in auto_acquisition\r\n            var chart_bak = this.chart;\r\n            this.chart = null; // don't draw\r\n            var idx = time_unit_arr.indexOf(this.time_unit);\r\n////            this.save();\r\n////            for (var i=1;i<time_unit_arr.length;i++) {\r\n////              this.time_unit_changed((idx+i)%time_unit_arr.length);\r\n////              this.save();\r\n////            }\r\n            var data_lower = null;\r\n            for (var i=0;i<time_unit_arr.length;i++) {\r\n              this.time_unit_changed(i);\r\n              this.save(data_lower);\r\n              data_lower = {data_p:this.data_p, data_t:this.data_t, time_unit:this.time_unit, time_base:this.time_base};\r\n            }\r\n            if (!from_destructor) this.time_unit_changed(idx);\r\n            this.chart = chart_bak;\r\n            auto_acquisition_keys['@'+this.key] = timestamp;\r\n          }\r\n        }\r\n        if (this.tgts) {\r\n          this.prep('both',this.prep_thread_unsubscribe);\r\n          if (this.fromNo) this.fromNo.prep('live',this.fromNo.prep_board_unsubscribe);\r\n        }\r\n      },\r\n      Zcompress: function(str){\r\n        return str.replace(/0,(0,)+/g,function(match){return 'z'+match.length/2+',';});\r\n//        var test2 = this.Zdecompress(test);\r\n//        if (test2!==str) console.log('ERROR: '+str+', '+test+', '+test2);\r\n//        return str;\r\n      },\r\n      Zdecompress: function(str){\r\n        return str.replace(/z(\\d+),/g,function(match,p1){\r\n          var str = '';\r\n          var len = parseInt(p1,10);\r\n          for(var i=0;i<len;i++) str+='0,';\r\n          return str;\r\n        });\r\n      },\r\n      get_ls_key: function(){\r\n        if (pref.test_mode['38']) return pref.script_prefix + '.graph.' + this.time_unit + '.' + this.key+'_test38';\r\n        return pref.script_prefix + '.graph.' + this.time_unit + '.' + this.key;\r\n      },\r\n      save: function(data_lower){ // destructive\r\n        if (this.data_p && pref.stats.load && pref.stats.save && localStorage) {\r\n          this.merge_1(this.data_p, this.data_p_old);\r\n          this.merge_1(this.data_t, this.data_t_old);\r\n          if (data_lower) {\r\n            this.merge_1_hier(this.data_p, data_lower.data_p, data_lower);\r\n            this.merge_1_hier(this.data_t, data_lower.data_t, data_lower);\r\n          }\r\n          var i=0;\r\n          while (i<this.data_p.length && this.data_p[i]===0 && this.data_t[i]===0) i++;\r\n          var data_save = [this.time_base+i*this.time_unit, this.data_p.slice(0,this.len+1).slice(i), this.data_t.slice(0,this.len+1).slice(i)];\r\nif (!pref.test_mode['42']) {\r\n          if (this.fromNo) {\r\n            var fN = this.fromNo;\r\n            fN.valid = true;\r\n            fN.prep('live',fN.prep_board_check_valid);\r\n            if (!fN.valid) for (var j=0;j<fN.data_p.length;j++) fN.data_p[j] = 0;\r\n            else if (fN.data_p_old) {\r\n              var idx_last = fN.data_p_old.length-1;\r\n              if (fN.data_p[idx_last]>fN.data_p_old[idx_last]) fN.data_p_old[idx_last] = fN.data_p[idx_last]; // overwrite last data, because last data may NOT complete its period.\r\n            }\r\n            if (fN.data_p_old) fN.data_p = fN.data_p_old.concat(fN.data_p.slice(fN.data_p_old.length));\r\n            for (var j=fN.data_p.length-2-this.tolerance;j<fN.data_p.length;j++) fN.data_p[j] = 0; // fill 0 to last 2 or more.\r\n            data_save[3] = fN.data_p.slice(0,this.len+1).slice(i);\r\n          }\r\n}\r\n          localStorage[this.get_ls_key()] = this.Zcompress(JSON.stringify(data_save));\r\n          if (pref.debug_mode['15']) console.log('saved: '+this.get_ls_key());\r\n        }\r\n      },\r\n      load: function(){\r\n        if (pref.stats.load && localStorage) {\r\n          var data = localStorage[this.get_ls_key()];\r\n          if (data) {\r\n            data = JSON.parse(this.Zdecompress(data));\r\n            var start = (this.time_base - data[0])/this.time_unit;\r\n            var end   = Math.floor((time_root - this.time_last)/this.time_unit); // negative value.\r\n            if (end===0) end = undefined;\r\n            if (start>=0) {\r\n              this.data_p_old = data[1].slice(start, end);\r\n              this.data_t_old = data[2].slice(start, end);\r\n              if (this.fromNo && data[3]) this.fromNo.data_p_old = data[3].slice(start, end);\r\n            } else {\r\n              this.data_p_old = this.array_init([],0,0).slice(0,-start).concat(data[1].slice(0,end));\r\n              this.data_t_old = this.array_init([],0,0).slice(0,-start).concat(data[2].slice(0,end));\r\n              if (this.fromNo && data[3]) this.fromNo.data_p_old = this.array_init([],0,0).slice(0,-start).concat(data[3].slice(0,end));\r\n            }\r\n            if (this.fromNo && this.fromNo.data_p_old) while (this.fromNo.data_p_old[this.fromNo.data_p_old.length-1]===0) this.fromNo.data_p_old.pop();\r\n          } else {\r\n            this.data_p_old = null;\r\n            this.data_t_old = null;\r\n          }\r\n        } \r\n      },\r\n      tgts_changed: function(tgts, key, skip_init){\r\n        this.save_all_unsubscribe();\r\n        this.tgts = tgts;\r\n        this.key = key;\r\n        pref_func.str2obj2(this,'tgts_obj2',tgts.join(','),null,true); // make this.tgts_obj2\r\n        this.prep('both',this.prep_thread_subscribe);\r\n        if (!skip_init) this.init();\r\n      },\r\n      time_unit_changed: function(sel, skip_init){\r\n        if (this.fromNo) this.fromNo.prep('live',this.fromNo.prep_board_unsubscribe);\r\n//        this.save();\r\n//        if (typeof(sel)!=='number') sel = sel.target.selectedIndex;\r\n        this.time_sel = sel;\r\n        this.time_unit = time_unit_arr[sel];\r\n        if (!skip_init) this.init();\r\n      },\r\n      len_changed: function(len){\r\n//        this.save();\r\n        this.len = len;\r\n        this.init();\r\n      },\r\n      init: function(){\r\n        this.time_last = null; // force to remake\r\n        this.data_p = [];\r\n        this.data_t = [];\r\n        this.data_l = [];\r\n        this.rm = (this.chart && (this.chart.show.ep || this.chart.show.et))? new StatsRm(this) : null;\r\n        if (this.fromNo) {\r\n          this.fromNo.data_p = [];\r\n          this.fromNo.data_p_old = [];\r\n          this.fromNo.min_idx = 0;\r\n        }\r\n        this.refresh(true);\r\n      },\r\n      array_init: function(arr,start,val){\r\n        for (var i=start;i<this.len+2;i++) if (arr[i]===undefined) arr[i] = val; // len+2\r\n        return arr;\r\n      },\r\n      tz_offset: new Date().getTimezoneOffset(),\r\n      label_init: function(start){\r\n        var lfunc = label_funcs[this.time_unit];\r\n        var i = (lfunc[2])? Math.floor((Math.floor(((this.time_base-this.tz_offset) + (this.len+2)*this.time_unit)/lfunc[0])*lfunc[0] - (this.time_base-this.tz_offset))/this.time_unit) :\r\n                            this.len+2;\r\n        while (i>=start) {\r\n          this.data_l[i] = lfunc[1](this.time_base + i*this.time_unit);\r\n          i -= (lfunc[2])? lfunc[0]/this.time_unit : 1;\r\n        }\r\n      },\r\n      prep_time: function(init){\r\n        var time_now = Math.floor((Date.now()/60000+this.tolerance)/this.time_unit)*this.time_unit;\r\n        if (this.time_last!==time_now) {\r\n          var distance = (time_now - this.time_last)/this.time_unit;\r\n          this.time_last = time_now;\r\n          this.time_base = time_now - this.time_unit * this.len;\r\n          var start = 0;\r\n          if (!init && distance!==0) {\r\n            if (distance>this.len) distance = this.len;\r\n            this.data_p.splice(0,distance);\r\n            this.data_t.splice(0,distance);\r\n            this.data_l.splice(0,distance);\r\n            if (this.rm) {\r\n              this.rm.data_p.splice(0,distance);\r\n              this.rm.data_t.splice(0,distance);\r\n            }\r\n            if (this.fromNo) {\r\n              this.fromNo.data_p.splice(0,distance);\r\n              if (this.fromNo.data_p_old) {this.fromNo.data_p_old.splice(0,distance); if (this.fromNo.data_p_old.length===0) this.fromNo.data_p_old = null;}\r\n              this.fromNo.min_idx -= distance;\r\n            }\r\n            if (this.data_p_old) {this.data_p_old.splice(0,distance); if (this.data_p_old.length===0) this.data_p_old = null;}\r\n            if (this.data_t_old) {this.data_t_old.splice(0,distance); if (this.data_t_old.length===0) this.data_t_old = null;}\r\n            start = this.len - distance;\r\n            this.min_idx -= distance;\r\n            if (this.min_idx<0) this.min_idx = 0; // this.min_idx <= this.len, therefore this may occur.\r\n          }\r\n          this.array_init(this.data_p,start,0);\r\n          this.array_init(this.data_t,start,0);\r\n          this.array_init(this.data_l,start,'');\r\n          if (this.rm) {\r\n            this.array_init(this.rm.data_p,start,0);\r\n            this.array_init(this.rm.data_t,start,0);\r\n          }\r\n          if (this.fromNo) this.array_init(this.fromNo.data_p,start,0);\r\n          this.label_init(start);\r\n          this.shift = (init)? 0 : this.shift + distance;\r\n        }\r\n        this.wdg_tick.restart(this.time_unit*60000);\r\n      },\r\n      prep: function(tree, func, func_t){\r\n        for (var i=0;i<this.tgts.length;i++) {\r\n          var dbt = common_func.name2domainboardthread(this.tgts[i],true);\r\n          if (tree==='live' || tree==='both') this.prep_1(liveTag.mems, dbt, func, func_t);\r\n          if (tree==='dead' || tree==='both') this.prep_1(tree_404, dbt, func, func_t);\r\n        }\r\n      },\r\n      prep_1: function(tree, dbt, func, func_t){\r\n        if (dbt[2]) {\r\n          if (tree[dbt[0]] && tree[dbt[0]][dbt[1]] && tree[dbt[0]][dbt[1]][dbt[2]] && func_t!==null) ((func_t)? func_t : func).call(this,tree[dbt[0]][dbt[1]][dbt[2]]);\r\n        } else if (dbt[1]) {\r\n          if (tree[dbt[0]] && tree[dbt[0]][dbt[1]]) this.prep_board(tree[dbt[0]][dbt[1]],func, func_t);\r\n        } else {\r\n          if (tree[dbt[0]]) this.prep_domain(tree[dbt[0]],func, func_t);\r\n        }\r\n      },\r\n      prep_domain: function(ld,func){\r\n        for (var b in ld) this.prep_board(ld[b],func, func_t);\r\n      },\r\n      prep_board: function(ldb,func){\r\n        for (var t in ldb) func.call(this,ldb[t]);\r\n      },\r\n      prep_thread_init: function(ldbt){\r\n        if (ldbt.s) this.update_thread(ldbt.s, 0);\r\n      },\r\n      check_and_add_thread: function(ldbt){\r\n        if (ldbt.s && !this.prep_thread_unsubscribe(ldbt,true)) {\r\n          this.update_thread(ldbt.s, 0, true);\r\n          this.prep_thread_subscribe(ldbt);\r\n        }\r\n      },\r\n      prep_thread_subscribe: function(ldbt){\r\n        if (Array.isArray(ldbt.ss)) ldbt.ss.push(this);\r\n        else if (ldbt.ss) ldbt.ss = [ldbt.ss, this];\r\n        else ldbt.ss = this;\r\n      },\r\n      prep_thread_unsubscribe: function(ldbt, check_only){\r\n        if (Array.isArray(ldbt.ss)) {\r\n          var idx = ldbt.ss.indexOf(this);\r\n          if (check_only) return (idx!==-1);\r\n          if (idx!=-1) {\r\n            ldbt.ss.splice(idx,1);\r\n            if (ldbt.ss.length===1) ldbt.ss = ldbt.ss[0];\r\n          }\r\n        } else if (ldbt.ss===this) {\r\n          if (check_only) return true;\r\n          delete ldbt.ss;\r\n        } else return false;\r\n      },\r\n      refresh: function(init){\r\n        if (pref.debug_mode['15']) console.log('updated: '+this.data_p.slice(this.len-10).toString()+', '+this.min_idx);\r\n        this.prep_time(init);\r\n        if (init) {\r\n          this.prep('live',this.prep_thread_init);\r\n          this.rm_tmp = new StatsRm(this, this.data_p, this.data_t);\r\n          this.rm_tmp.prep('dead',this.rm_tmp.prep_board_init, this.prep_thread_init);\r\n          if (this.rm) this.rm.prep('dead',this.rm.prep_board_init, this.prep_thread_init);\r\n          if (this.fromNo) this.fromNo.prep('live',this.fromNo.prep_board_init, true);\r\n          this.load();\r\n          if (this.chart) this.chart.replace_data(this);\r\n        } else if (this.shift!==0 || this.min_idx!==this.data_p.length) {\r\n          if (this.fromNo) this.fromNo.prep('live',this.fromNo.prep_board_init, false, true);\r\n          if (this.chart) this.chart.update_data2(this);\r\n        }\r\n        this.min_idx = this.data_p.length; // 'this.min_idx = this.len-1;' is suitable if local and server clocks are synced.\r\n      },\r\n//      remove_thread: function(s, start, from_thread){\r\n//        this.update_thread(s, start, from_thread);\r\n//        if (this.min_idx!==undefined) {\r\n//          this.__proto__.min_idx = this.min_idx;\r\n//          delete this.min_idx;\r\n//        }\r\n//      },\r\n      update_thread: function(s, start, from_thread){\r\n        if (!s) return;\r\n        if (start===0) this.update_thread_1(this.data_t, s, 0, 0);\r\n        this.update_thread_1(this.data_p, s, start, s.length-1);\r\n        if (from_thread) this.draw();\r\n      },\r\n      update_thread_1: function(data, s, start, end){\r\n        for (var j=end;j>=start;j--) {\r\n          var idx = Math.floor((s[j]-this.time_base)/this.time_unit);\r\n          var idx_over = idx - this.len -1;\r\n          if (idx_over>0) {\r\n            if (pref.stats.tolerant) {\r\n              this.tolerance = idx_over*this.time_unit + this.tolerance;\r\n              if (this.tolerance>pref.stats.tolerance) this.tolerance = pref.stats.tolerance;\r\n              this.prep_time(false);\r\n            }\r\n            idx = this.len+1;\r\n          }\r\n          if (idx>=0) {\r\n//            data[(idx<=this.len)? idx : this.len+1]++;\r\n            data[idx]++;\r\n            if (idx<this.min_idx) this.min_idx = idx;\r\n          } else break;\r\n        }\r\n      },\r\n    };\r\n    var StatsRm = function(parent, data_p, data_t){\r\n      this.data_p = data_p || [];\r\n      this.data_t = data_t || [];\r\n      Object.defineProperty(this,'min_idx',{set: function(val){this.__proto__.min_idx = val;},\r\n                                            get: function(){return this.__proto__.min_idx;}, // necessary\r\n                                            configurable:true, enumerable:true});\r\n      for (var i in StatsRm_prototype) this[i] = StatsRm_prototype[i];\r\n      this.__proto__ = parent;\r\n    };\r\n    var StatsRm_prototype = {\r\n      prep_board: function(ldb,func, func_t){\r\n        if (ldb.sr) func.call(this,ldb);\r\n        else for (var t in ldb) func_t.call(this,ldb[t]);\r\n      },\r\n      prep_board_init: function(ldb){ // for initial only\r\n        this.prep_board_init_1(ldb.sr, this.data_p);\r\n        this.prep_board_init_1(ldb.srt,this.data_t);\r\n      },\r\n      prep_board_init_1: function(ldbs,dst){ // for initial only\r\n        var data = ldbs[this.time_sel][1];\r\n        var offset = (this.time_base - ldbs[this.time_sel][0])/this.time_unit; // offset>=0 is always true.\r\n        var i = offset;\r\n        while (i<data.length) {\r\n          if (data[i]) dst[i-offset] += data[i];\r\n          i++;\r\n        }\r\n      },\r\n    };\r\n    var StatsFromNo = function(parent){\r\n      this.data_p = [];\r\n      this.min_idx = 0;\r\n      for (var i in StatsFromNo_prototype) this[i] = StatsFromNo_prototype[i];\r\n      this.__proto__ = parent;\r\n    };\r\n    var StatsFromNo_prototype = {\r\n      prep_board_subscribe: function(ldb){\r\n        if (!ldb.s) setup_board_no(ldb,'s');\r\n        ldb.s[this.time_sel][2].push(this);\r\n      },\r\n      prep_board_unsubscribe: function(ldb){\r\n        if (ldb.s && this.time_sel) {\r\n          var idx = ldb.s[this.time_sel][2].indexOf(this);\r\n          if (idx!=-1) ldb.s[this.time_sel][2].splice(idx,1);\r\n        }\r\n      },\r\n      prep: function(tree, func, subscribe, aggregate){\r\n        if (subscribe) this.__proto__.prep.call(this.fromNo,'live',this.fromNo.prep_board_subscribe, null);\r\n        if (aggregate) for (var i=this.min_idx;i<this.data_p.length;i++) this.data_p[i] = 0;\r\n        this.new_vals = {};\r\n        this.__proto__.prep.call(this, 'live', func, null);\r\n        for (var i in this.new_vals) this[i] = this.new_vals[i];\r\n        delete this.new_vals;\r\n      },\r\n      prep_board: function(ldb,func){\r\n        func.call(this,ldb);\r\n      },\r\n      prep_board_init: function(ldb,func){\r\n        var data = ldb.s[this.time_sel][1];\r\n        var offset = (this.time_base - ldb.s[this.time_sel][0])/this.time_unit; // offset>=0 is always true.\r\n        var i = this.min_idx + offset;\r\n        if (i<2) i = 2; // skip [0], because [0] contains old data.\r\n        var data_last;\r\n        var j=i-1;\r\n        while (j>0 && !data[j]) j--;\r\n        if (j>0) data_last = data[j];\r\n        else {\r\n          while (i<data.length && !data[i]) i++;\r\n          data_last = data[i++];\r\n        }\r\n        if (pref.stats.patch_tm) {\r\n          var idx_last = ((j>0)? j : i-1)-offset;\r\n          var idx_last2 = idx_last; // for not writing any data\r\n          while (i<data.length) {\r\n            if (data[i]) {\r\n              this.data_p[idx_last] += data[i] - data_last;\r\n              data_last = data[i];\r\n              idx_last2 = idx_last;\r\n              idx_last = i-offset;\r\n            }\r\n            i++;\r\n          }\r\n          if (this.new_vals.min_idx===undefined || this.new_vals.min_idx > idx_last2) this.new_vals.min_idx = idx_last2;\r\n        } else {\r\n          while (i<data.length) {\r\n            if (data[i]) {\r\n              this.data_p[i-offset] += data[i] - data_last;\r\n              data_last = data[i];\r\n            }\r\n            i++;\r\n          }\r\n          if (this.new_vals.min_idx===undefined || this.new_vals.min_idx > i - offset) this.new_vals.min_idx = i - offset;\r\n        }\r\n      },\r\n      update_posts_no: function(time_base,idx_in){\r\n        var idx = (time_base-this.time_base)/this.time_unit + idx_in;\r\n        if (idx>=0 && idx<this.min_idx) this.min_idx = idx;\r\n      },\r\n      prep_board_check_valid: function(ldb,func){\r\n        this.valid &= ldb.s[time_unit_arr.length]>=0;\r\n      },\r\n//      __proto__: Stats.prototype\r\n    };\r\n////    function setup_board_no(ldb, data, time_sel){\r\n////      for (var t in ldb) if (ldb[t].s) update_posts_no_1(ldb[t].s, ldb[t].sn, 0, ldb, time_sel);\r\n////      var j=0;\r\n////      while (j<data.length && !data[j]) j++;\r\n////      if (j!==0 && j!=data.length) for (var i=0;i<j;i++) data[i] = data[j];\r\n////if (pref.test_mode['43']) {\r\n////      while (j<data.length) {if (!data[j]) data[j] = data[j-1];j++;} // cause spike\r\n////} else {  \r\n////      while (j<data.length) { // average, not debugged.\r\n////        var j_old = j++;\r\n////        while (j<data.length && !data[j]) j++;\r\n////        if (j_old+1===j) continue;\r\n////        if (j<data.length) {\r\n//////console.log('setup_board_no: averaging: '+j_old+', '+j);\r\n////          var step = (data[j]-data[j_old])/(j-j_old);\r\n////          for (var i=1;i<j-j_old;i++) data[j_old+i] = data[j_old]+Math.floor(step*i);\r\n////        }\r\n////      }\r\n////}\r\n////    }\r\n    function update_board_rm(ldb){\r\n      if (!ldb.sr) {\r\n        setup_board_no(ldb,'sr');\r\n        setup_board_no(ldb,'srt');\r\n//        for (var i=0;i<time_unit_arr.length;i++) for (var j=0;j<pref.stats.len_capture+2;j++) ldb.sr[i][1][j] = 0;\r\n      }\r\n      for (var t in ldb) {\r\n        if (ldb[t].s) for (var i=0;i<time_unit_arr.length;i++) {\r\n          update_posts_no_1(ldb.sr[i],  null, 0, ldb[t].s.length, ldb[t].s, time_unit_arr[i], update_posts_rm_1_func, 0);\r\n          update_posts_no_1(ldb.srt[i], null, 0, 1,               ldb[t].s, time_unit_arr[i], update_posts_rm_1_func, 0);\r\n        }\r\n        delete ldb[t];\r\n      }\r\n    }\r\n    function setup_board_no(ldb,key){\r\n      Object.defineProperty(ldb, key, {value:[], configurable:true, writable:false});\r\n      for (var i=0;i<time_unit_arr.length;i++) {\r\n//        ldb[key][i] = [null,[],[],0]; // [time_base, data, subscribers, tolerance]\r\n        ldb[key][i] = [null,(i<3)?[]:{length:pref.stats.len_capture+2, __proto__:Array.prototype},[],0];\r\n//        ldb[key][i] = [null,{length:pref.stats.len_capture+2, __proto__:Array.prototype},[],0]; // debug // length isn't updated automatically after 'splice' shorten it.\r\n        update_posts_no_time(ldb[key][i], time_unit_arr[i]);\r\n      }\r\n      if (key==='s') ldb[key][time_unit_arr.length] = -Object.keys(ldb).length; // count\r\n    }\r\n    function update_posts_no_time(ldbst, time_unit, idx_over){\r\n      var time_now = Math.floor((Date.now()/60000 + ldbst[3])/time_unit)*time_unit;\r\n      var time_base = time_now - time_unit * pref.stats.len_capture;\r\n      if (!ldbst[0]) {ldbst[0] = time_base;return;} // initialize\r\n      else if (time_base!==ldbst[0] || idx_over) {\r\n        var shift = (time_base-ldbst[0])/time_unit;\r\n        var shift_add = 0;\r\n        if (idx_over>shift && pref.stats.tolerant) {\r\n          if (ldbst[3] + (idx_over-shift)*time_unit<pref.stats.tolerance) {\r\n            ldbst[3] = idx_over*time_unit;\r\n            shift_add = idx_over - shift;\r\n          } else {\r\n            ldbst[3] = pref.stats.tolerance;\r\n            shift_add = Math.floor((pref.stats.tolerance-ldbst[3])/time_unit);\r\n          }\r\n        }\r\n        ldbst[1].splice(0, shift + shift_add);\r\n        if (!Array.isArray(ldbst[1])) ldbst[1].length = pref.stats.len_capture+2;\r\n//        var last_data = ldbst[1][ldbst[1].length-1];\r\n//        for (var i=0;i<shift+shift_add;i++) ldbst[1][ldbst[1].length] = last_data;\r\n        ldbst[0] = time_base + shift_add*time_unit;\r\n        return shift + shift_add;\r\n      }\r\n    }\r\n    function update_posts_rm_1_func(data,idx){\r\n      data[idx] = (data[idx] || 0) +1;\r\n    }\r\n    function update_posts_no_1_func(data,idx,th,j){\r\n      var post_no = th.posts[j].no || th.no;\r\n      if (data[idx]===undefined || data[idx]<post_no) data[idx] = post_no;\r\n    }\r\n    function update_posts_no_1_func_min(data,idx,th,j){ // for 4chan's bug, corrupted timeline when a thread is moved from other board.\r\n      var post_no = th.posts[j].no || th.no;\r\n      if (data[idx]===undefined || data[idx]>post_no) data[idx] = post_no; // THIS REQUIRES IN-ORDER OR FULL SCAN in update_posts_no_1 and PICKUP in ??? must be shifted by 1.\r\n    }\r\n    function update_posts_no(ldb, th, start, lths){\r\n      if (!ldb.s) setup_board_no(ldb,'s');\r\n      for (var i=0;i<time_unit_arr.length;i++) update_posts_no_1(ldb.s[i], th, start, lths.length, lths, time_unit_arr[i],\r\n        (pref.stats.patch_tm)? update_posts_no_1_func_min : update_posts_no_1_func, th.posts.length);\r\n      ldb.s[time_unit_arr.length]++;\r\n    }\r\n    function update_posts_no_1(ldbst, th, start, end, lths, time_unit, func, j){\r\n      var time_base = ldbst[0];\r\n      var data = ldbst[1];\r\n      var idx_old;\r\n      for (var p=end-1;p>=start;p--) {\r\n        var idx = Math.floor((lths[p]-time_base)/time_unit);\r\n        if (--j>=0 && idx===idx_old && !pref.stats.patch_tm) continue; // full scan at patch_tm\r\n        var idx_over = idx - pref.stats.len_capture -1;\r\n        if (idx_over>0) {\r\n          idx -= update_posts_no_time(ldbst, time_unit, idx_over);\r\n          if (idx>pref.stats.len_capture+1) idx = pref.stats.len_capture+1;\r\n          time_base = ldbst[0];\r\n        } else if (idx<0) idx = 0;\r\n        func(data,idx,th,j);\r\n        if (idx===0 && !pref.stats.patch_tm) break;\r\n        idx_old = idx;\r\n      }\r\n      for (var k=0;k<ldbst[2].length;k++) ldbst[2][k].update_posts_no(time_base,idx);\r\n    }\r\n        \r\n    var auto_acquisition_keys = {};\r\n    function get_ac_key(sel){return pref.catalog_board_list_obj[sel][0].key;} // key is a user string.\r\n    function auto_acquisition_beforeunload(){\r\n      if (pref.stats.auto_acquisition && cataLog.embed_mode!=='thread')\r\n        for (var i=pref.catalog_board_list_obj.length-1;i>=0;i--)\r\n          if (auto_acquisition_keys['@'+get_ac_key(i)]!==undefined) {\r\n            var tgts = cataLog.catalog_refresh_1('chart', false, false, false, false, i, false, true);\r\n            if (typeof(tgts)!=='function') new Stats(null, tgts, get_ac_key(i), false).destroy();\r\n          }\r\n    }\r\n    window.addEventListener('beforeunload', auto_acquisition_beforeunload, false);\r\n    function auto_acquisition_init(idx){\r\n      if (pref.stats.auto_acquisition && cataLog.catalog_refresh_1 && cataLog.embed_mode!=='thread') {\r\n        if (idx===undefined) idx = pref.catalog_board_list_obj.length-1;\r\n        while (idx>=0 && (!pref.catalog_board_list_obj[idx][0].cmds || pref.catalog_board_list_obj[idx][0].cmds.indexOf('stats')===-1)) idx--;\r\n        if (idx>=0) {\r\n          if (pref.stats.auto_acquisition) stats.register_auto_acquisition(idx);\r\n          var result = cataLog.catalog_refresh_1('chart', false, false, false, 'stats_ac', idx, false, true, function(){auto_acquisition_init(idx-1);});\r\n          if (typeof(result)==='function') result(function(){auto_acquisition_init(idx);});\r\n        }\r\n      }\r\n    }\r\n    if (pref.stats.auto_acquisition_scan && site.whereami!=='archive') setTimeout(auto_acquisition_init, pref.stats.auto_acquisition_scan_delay*1000);\r\n    return {\r\n      aggregate: function(th){\r\n        if (!th.posts) return;\r\n        var ldb = liveTag.mems[th.domain][th.board];\r\n        var lth = ldb[th.no];\r\n        if (!lth.s) lth.s = []; // stat\r\n        var tu = th.parse_funcs.time_unit;\r\n        var start = lth.s.length;\r\n        var p = start;\r\n        if (lth.pd && pref.test_mode['128']) th = {posts: site2[lth.domain].update_posts_merge_prep(th.posts, lth.pd, -1, true), __proto__:th};\r\n        var i = th.posts.length - (th.nof_posts - lth.s.length);\r\n        if (i<0) return; // i=0; // {p=-i; i=0;} // patch for short thread (last 50 replies) at embed_mode==='thread'.\r\n        while (i<th.posts.length) lth.s[p++] = Math.floor(th.posts[i++].time * tu / 60000);\r\n        if (lth.ss) { // subscribers\r\n          if (Array.isArray(lth.ss)) for (var i=0;i<lth.ss.length;i++) lth.ss[i].update_thread(lth.s,start, true);\r\n          else lth.ss.update_thread(lth.s,start, true);\r\n        } else if (start===0) thread_created(lth);\r\n        if (pref3.stats.estimate_posts) update_posts_no(ldb, th, start, lth.s, th.posts.length);\r\n      },\r\n      thread_removed: thread_removed,\r\n      Stats: Stats,\r\n      register_auto_acquisition: function(sel){\r\n        auto_acquisition_keys['@'+get_ac_key(sel)] = null;\r\n        cnst.auto_shrink_board_selector.color();\r\n      },\r\n      query_auto_acquisition: function(sel){\r\n        return auto_acquisition_keys['@'+get_ac_key(sel)]!==undefined;\r\n      },\r\n//      redraw_all: function(){\r\n//        for (var i=0;i<instances.length;i++) instances[i].init();\r\n//      }\r\n    };\r\n  })() : null;\r\n               \r\n\r\n  function make_chart_obj(pn1){\r\n//    var pref_graph = {key: null, pipe: null}; // working code.\r\n//    pn1.addEventListener('click', show_hide, false);\r\n//    var data = chart_data_init();\r\n//    pref_graph.key = pref.script_prefix + '.graph.' + site.board;\r\n//    if (localStorage && pref.load_data && localStorage.getItem(pref_graph.key)!==null) data = brwsr.JSON_parse(localStorage.getItem(pref_graph.key));\r\n//\r\n//    var pn2_func = null;\r\n//    function show_hide(){  // Toggle Show/Hide\r\n//      if (pn2_func==null) pn2_func = prep_pn2();\r\n//      else pn2_func = pn2_func.destroy();\r\n//    }\r\n//    var size_loc = ['400px', '400px', '5px', '50px', '120px', '390px'];\r\n\r\n    var time_unit_sel_html =\r\n      '<select name=\"chart.inst.time_sel\">'+\r\n        '<option>1 min</option>'+\r\n        '<option>10 mins</option>'+\r\n        '<option>1 hour</option>'+\r\n        '<option>1 day</option>'+\r\n        '<option>1 week</option>'+\r\n      '<select>';\r\n    var chart_options_str = [\r\n        'Number of points: <input type=\"text\" name=\"chart.inst.len\" size=\"3\" style=\"text-align: right;\"><br>',\r\n        'Scale of new thread: <input type=\"text\" name=\"chart.inst.scale_thread\" size=\"3\" style=\"text-align: right;\"><br>',\r\n//        '<input type=\"checkbox\" name=\"chart.inst.separate\">Separate estimated, observed and alive<br>',\r\n        'Show: Posts/Threads:<br>',\r\n        '&emsp;&emsp;<input type=\"checkbox\" name=\"chart.inst.show.np\">'+\r\n        '<input type=\"checkbox\" name=\"chart.inst.show.nt\" disabled style=\"visibility:hidden\"> Estimated, '+\r\n        '<input type=\"checkbox\" name=\"chart.inst.clip_np\">Clip: '+\r\n          '<input type=\"text\" name=\"chart.inst.clip_np_val\" size=\"4\" style=\"text-align: right;\"><br>',\r\n        '&emsp;&emsp;<input type=\"checkbox\" name=\"chart.inst.show.p\">'+\r\n        '<input type=\"checkbox\" name=\"chart.inst.show.t\"> Observed<br>',\r\n        '&emsp;&emsp;<input type=\"checkbox\" name=\"chart.inst.show.ep\">'+\r\n        '<input type=\"checkbox\" name=\"chart.inst.show.et\"> Alive<br>',\r\n        '<input type=\"checkbox\" name=\"chart.inst.show_legend\">Legend<br>',\r\n        '<input type=\"checkbox\" name=\"chart.inst.options.animation\">Animation (Doesn\\'t work on FF)<br>',\r\n        '<input type=\"checkbox\" name=\"chart.inst.options.pointDot\">Point dot: radius '+\r\n          '<input type=\"text\" name=\"chart.inst.options.pointDotRadius\" size=\"1\" style=\"text-align: right;\"><br>'\r\n      ];\r\n    if (!pn1) return {\r\n      time_unit_sel_html: time_unit_sel_html,\r\n      chart_options_str: chart_options_str,\r\n    }\r\n\r\n    pn1.addEventListener('click', make_new_chart, false);\r\n    var charts = [];\r\n    function make_new_chart(){\r\n      cnst.subscribe(charts,new PostChart());\r\n      if (charts.length===1) {\r\n        common_func.dom_addEventListener(common_obj.events_beforeunload, window, 'focus', window_focus);\r\n        common_func.dom_addEventListener(common_obj.events_beforeunload, window, 'blur', window_blur);\r\n      }\r\n    }\r\n    function window_focus(){\r\n      cnst.foreach(charts, function(inst){inst.chart_posts.options.animation = inst.options.animation;});\r\n    }\r\n    function window_blur(){\r\n      if (pref.chart.off_anime_blur) cnst.foreach(charts, function(inst){inst.chart_posts.options.animation = false;});\r\n    }\r\n    function destroy_all(){\r\n      cnst.foreach(charts, function(inst){inst.destroy();});\r\n    }\r\n    window.addEventListener('beforeunload', destroy_all, false);\r\n\r\n    var count = 0;\r\n    var PostChart = function(pn_popup, tgts, skelton){\r\n//      this.data_graph;\r\n//      this.chart_posts;\r\n      if (!skelton) common_func.deep_copy(this,pref.chart.inst);\r\n      if (!pn_popup) {\r\n        this.name = 'graph_' + count++;\r\n\r\n        this.pn2_obj = cnst.init3({\r\n          this_obj:this,\r\n          __proto__:this.pn2_template});\r\n        var pn2 = this.pn2_obj.pn;\r\n        var pn2_2 = cnst.add_to_tb(pn2, time_unit_sel_html + (!skelton? '<select name=\"chart.inst.board_sel\"><select>' : '')+ cnst.icons.button_settings());\r\n        pn2.childNodes[1].innerHTML = pref_func.format_html_str(\r\n          '<div style=\"display:none\">'+\r\n            '<div style=\"float:right\">'+ chart_options_str.join('') + '</div>'+\r\n            '<div style=\"clear:both\"></div>'+\r\n          '</div>'+\r\n          '<div style=\"position:relative\"></div>');\r\n        pref_func.apply_prep(pn2,false);\r\n        var sels = pn2.getElementsByTagName('select');\r\n        cnst.auto_shrink_selector(sels['chart.inst.time_sel']);\r\n        this.legend = cnst.init3({func_str:'border:1px solid lightblue:cursor:move:position:absolute:left:80px:top:40px'});\r\n        this.pn2 = pn2;\r\n        this.set_legend_str();\r\n        var onchange_entry_bound = this.onchange_entry.bind(this);\r\n        pn2.childNodes[0].onchange = onchange_entry_bound;\r\n        pn2.childNodes[1].childNodes[0].onchange = onchange_entry_bound;\r\n        if (skelton) {\r\n          cnst.bottom_top(pn2);\r\n//          pn2.style.top = parseInt(skelton.pn_canvas_root.style.top,10) - pn2.offsetHeight + 'px';\r\n//          pn2.style.left = skelton.pn_canvas_root.style.left;\r\n          this.show_legend = false;\r\n          var pns = pn2.querySelectorAll('input[name],textarea[name],select[name]');\r\n          for (var i=0;i<pns.length;i++) {\r\n            var tgt_hier = pref_func.get_tgt(pns[i].getAttribute('name').replace(/chart.inst./,''),this);\r\n            pref_func.apply_prep_load(pns[i],tgt_hier[0], tgt_hier[1]);\r\n          }\r\n//          pn2.childNodes[1].replaceChild(skelton.pn_canvas_root, pn2.childNodes[1].childNodes[1]);\r\n          cnst.subscribe(charts,this);\r\n          return pn2;\r\n        }\r\n        this.pn_board_sel = sels['chart.inst.board_sel'];\r\n        cnst.auto_shrink_board_selector.setup(this.pn_board_sel, pref.catalog_board_list_sel);\r\n        this.board_sel = pref.catalog_board_list_sel;\r\n        this.pn_canvas_root = pn2.childNodes[1].childNodes[1];\r\n      } else {\r\n        this.pn_canvas_root = pn_popup;\r\n        this.show = {np:false, p:true, ep:false, nt:false, t:true, et:false};\r\n      }\r\n      this.pn_canvas_root.style.width = pref.chart.window_width + 'px';\r\n      this.pn_canvas_root.style.height = pref.chart.window_height + 'px';\r\n      this.pn_canvas_root.style.resize = 'both';\r\n      this.pn_canvas_root.style.overflow = 'hidden';\r\n      this.pn_canvas = document.createElement('canvas');\r\n      this.pn_canvas_root.appendChild(this.pn_canvas);\r\n      this.chart_size_changed(true); // patch\r\n  //      this.chart_create_draw(); called from stats\r\n      this.stats = (!pn_popup)? new stats.Stats(this, this.get_tgts(), pref.catalog_board_list_obj[this.board_sel][0].key) : // call 'chart_create_draw' in this.\r\n                                new stats.Stats(this, tgts, 'popup');\r\n  //      this.track_legend_pos();\r\n  ////      pn2.addEventListener('resize',  //) // can't get.\r\n      this.canvas_active = true;\r\n      this.pn_canvas_root.onmousemove = this.deactivate_canvas_if_mouse_on_corner.bind(this);\r\n      this.pn_canvas_root.onclick = this.chart_size_changed.bind(this);\r\n  //      pn2.ondragover = this.dragover_pn2.bind(this);\r\n  //      pn2.ondrop = this.drop_pn2.bind(this);\r\n  //      this.legend.pn.ondragend = function(e){e.stopPropagation();};\r\n      if (!pn_popup) {\r\n        if (this.show_legend) this.append_legend();\r\n        cnst.bottom_top(pn2);\r\n      }\r\n    };\r\n    PostChart.prototype = {\r\n      get_tgts: function(scan_name){\r\n        return (!cataLog.catalog_refresh_1)? [site.nickname+site.board] :\r\n                                             cataLog.catalog_refresh_1('chart', false, false, false, scan_name, this.board_sel, false, true);\r\n      },\r\n      board_sel_changed: function(e){\r\n        e.target.blur();\r\n        var tgts = this.get_tgts((pref.chart.instant_scan)? this.name : null); // also scan\r\n        if (typeof(tgts)==='function') tgts(this.board_sel_changed.bind(this));\r\n        else this.stats.tgts_changed(tgts, pref.catalog_board_list_obj[this.board_sel][0].key);\r\n      },\r\n      len_changed: function(){\r\n        if (this.len>this.stats.len) this.stats.len_changed.call(this.stats, this.len); // call redraw\r\n        else if (this.stats.len!=pref.stats.len_capture) this.stats.len_changed.call(this.stats, pref.stats.len_capture); // call redraw\r\n        else this.replace_data(this.data_src);\r\n      },\r\n      deactivate_canvas_if_mouse_on_corner: function(e){\r\n        var ecTs = e.currentTarget.style;\r\n        if ((parseInt(ecTs.width,10) - e.offsetX<=10 && parseInt(ecTs.height,10) - e.offsetY<=10) ^ !this.canvas_active) {\r\n          this.pn_canvas.style.pointerEvents = this.canvas_active? 'none' : 'auto';\r\n          this.canvas_active = !this.canvas_active;\r\n        }\r\n      },\r\n      chart_size_changed: function(init){ // patch\r\n//        if (str==='top' || str==='bottom') this.pn_canvas_root.style.overflow = '';\r\n//        else if (typeof(str)==='string') this.pn_canvas_root.style.overflow = 'hidden';\r\n//        this.pn_canvas_root.style.resize = 'both';\r\n//        if (this.pn_canvas_root.style.overflow==='hidden') {\r\n//        if (this.pn2_obj.maximize_state_str==='float') {\r\n        this.pn_canvas.style.width  = this.pn_canvas_root.style.width;\r\n        this.pn_canvas.style.height = this.pn_canvas_root.style.height; // (this.pn_canvas_root.style.height.replace(/px/,'')-10)+'px';\r\n        this.pn_canvas.width  = this.pn_canvas_root.clientWidth;\r\n        this.pn_canvas.height = this.pn_canvas_root.clientHeight; // - 10;\r\n//        }\r\n        if (init!==true) this.chart_redraw();\r\n      },\r\n      chart_redraw: function(){ // old 'chart_create_draw' in this.\r\n        if (this.chart_posts) this.chart_posts.destroy();\r\n        \r\n        this.data_graph = chart_data_init(); // deep copy always.\r\n        var dd = this.data_graph.datasets;\r\n        var fN = this.data_src.fromNo;\r\n        var dr = this.data_src.rm;\r\n        var ds = this.data_src;\r\n//        this.idxs  = (dr)? ((fN)? {p:1, t:3, ep:2, et:4, np:0} : {p:0, t:2, ep:1, et:3}) :\r\n//                           ((fN)? {t:1, np:0} : {t:1, p:0});\r\n        var layer = 0;\r\n        this.idxs = {};\r\n        var idxs = this.idxs;\r\n        idxs.np = (fN && this.show.np)? layer++ : -1;\r\n        idxs.p  = (      this.show.p )? layer++ : -1;\r\n        idxs.ep = (dr && this.show.ep)? layer++ : -1;\r\n        idxs.t  = (      this.show.t )? layer++ : -1;\r\n        idxs.et = (dr && this.show.et)? layer++ : -1;\r\n\r\n        if (idxs.np!=-1) dd[idxs.np] = chart_data_init_1('post_fromNo','151,187,205',0.2);\r\n        if (idxs.p !=-1) dd[idxs.p ] = chart_data_init_1('Posts','98,152,179', 0.2);\r\n        if (idxs.ep!=-1) dd[idxs.ep] = chart_data_init_1('exist_p','66,119,136',0.15); // '151,187,205',0.2\r\n        if (idxs.t !=-1) dd[idxs.t ] = chart_data_init_1('Threads','204,0,0', 0.2);\r\n        if (idxs.et!=-1) dd[idxs.et] = chart_data_init_1('exist_t','140,0,0',0.2); // '204,128,128',0.2\r\n\r\nif (pref.test_mode['39'] && dd[pref.test_mode.num]) dd[pref.test_mode.num] = chart_data_init_1(dd[pref.test_mode.num].label,pref.test_mode.test_str, pref.test_mode.num_f);\r\n        var start = (this.len<this.stats.len)? this.stats.len - this.len : 0;\r\n        this.data_graph.labels = ds.data_l.slice(start); // I don't know why, but shallow copy is required, I can't use source array directly.\r\n        if (idxs.p !=-1) dd[idxs.p].data = this.stats.merge_1(ds.data_p.slice(start), (ds.data_p_old)? ds.data_p_old.slice(start) : null);\r\n        if (idxs.t !=-1) {\r\n          dd[idxs.t].data = this.stats.merge_1(ds.data_t.slice(start), (ds.data_t_old)? ds.data_t_old.slice(start) : null);\r\n          if (this.scale_thread!=1) this.scale_setup(dd[idxs.t].data);\r\n        }\r\n        if (dr) {\r\n//          dd[5] = chart_data_init_1('old_t','204,0,0');\r\n//          dd[0].data = ds.data_p.slice(start);\r\n//          dd[1].data = ds.data_t.slice(start);\r\n//          dd[2].data = dr.data_p.slice(start); // raw\r\n//          dd[3].data = dr.data_t.slice(start);\r\n          if (idxs.ep!=-1) dd[idxs.ep].data = this.arr_dec_slice(ds.data_p, dr.data_p, start);\r\n          if (idxs.et!=-1) {\r\n            dd[idxs.et].data = this.arr_dec_slice(ds.data_t, dr.data_t, start);\r\n            if (this.scale_thread!=1) this.scale_setup(dd[idxs.et].data);\r\n          }\r\n//          dd[2].data = ds.data_p.map(function(v,i){return v - this[i];}.bind(dr.data_p)); // TOO SLOW...\r\n//          dd[3].data = ds.data_t.map(function(v,i){return v - this[i];}.bind(dr.data_t));\r\nif (pref.test_mode['40']) {\r\n//          dd[4] = chart_data_init_1('old_p','98,152,179');\r\n//          dd[4].fillColor = 'rgba(0,255,0,0.2)';\r\n          dd[layer] = chart_data_init_1('old_p','0,255,0',0.1);\r\n          dd[layer++].data = ds.data_p_old.slice(start);\r\n          dd[layer] = chart_data_init_1('p_raw','98,152,179',0.2);\r\n          dd[layer++].data = ds.data_p.slice(start);\r\n//          dd[5].data = ds.data_t_old.slice(start);\r\n}\r\n        }\r\n        if (fN && idxs.np!=-1) {\r\n          dd[idxs.np].data = (fN.data_p_old)? fN.data_p_old.concat(fN.data_p.slice(fN.data_p_old.length)).slice(start) : fN.data_p.slice(start);\r\n          if (fN.data_p_old) {\r\n            var idx_last = fN.data_p_old.length-1;\r\n            if (fN.data_p[idx_last]>fN.data_p_old[idx_last]) if (idx_last-start>=0) dd[idxs.np].data[idx_last-start] = fN.data_p[idx_last]; // overwrite last data, because last data may NOT complete its period.\r\n          }\r\n          if (this.clip_np) {\r\n            var data_np = dd[idxs.np].data;\r\n            for (var i=0;i<data_np.length;i++) data_np[i] = this.clip_np_func(data_np[i]);\r\n          }\r\n//          if (pref.stats.patch_tm) dd[idxs.np].data = dd[idxs.np].data.slice(1).concat(0); // shift only at initial\r\n//          dd[idxs.np].data = fN.data_p.slice(start);\r\n//          var old_sliced = fN.data_p_old.slice(start);\r\n//          for (var i=0;i<old_sliced.length;i++)\r\n//            if (old_sliced[i])\r\n//              dd[idxs.np].data[i] = old_sliced[i];\r\nif (pref.test_mode['41']) {\r\n          dd[layer] = chart_data_init_1('post_fromNo_old','0,255,0',0.2);\r\n          dd[layer++].data = fN.data_p_old.slice(start);\r\n          dd[layer] = chart_data_init_1('post_fromNo','0,128,0',0);\r\n          dd[layer++].data = fN.data_p.slice(start);\r\n}\r\n        }\r\n//        Chart.defaults.global.animation = pref.stats.animation;\r\n        this.scale_thread_old = this.scale_thread;\r\n        var ctx = this.pn_canvas.getContext('2d');\r\n        this.chart_posts = new Chart(ctx).Line(this.data_graph, this.options);\r\n      },\r\n      clip_np_func: function(data){\r\n        return (data<0)? 0 :\r\n               (data>this.clip_np_val)? this.clip_np_val : data;\r\n      },\r\n      arr_dec_slice: function(src, dec, start){\r\n        var arr = [];\r\n        var p = 0;\r\n        for (var i=start;i<src.length;i++) arr[p++] = src[i] - dec[i];\r\n        return arr;\r\n      },\r\n      scale_setup: function(dst,old){\r\n        if (old!==undefined) for (var i=0;i<dst.length;i++) dst[i].value = dst[i].value/old*this.scale_thread;\r\n        else for (var i=0;i<dst.length;i++) dst[i] *= this.scale_thread;\r\n        return dst;\r\n      },\r\n      scale_changed: function(){\r\n        this.set_legend_str();\r\n        if (this.scale_thread_old!==0) {\r\n          this.scale_setup(this.chart_posts.datasets[this.idxs.t].points, this.scale_thread_old);\r\n          if (this.idxs.et!==undefined && this.data_graph.datasets[this.idxs.et]) this.scale_setup(this.chart_posts.datasets[this.idxs.et].points, this.scale_thread_old);\r\n          this.chart_posts.update();\r\n        } else this.chart_redraw();\r\n        this.scale_thread_old = this.scale_thread;\r\n      },\r\n      set_legend_str: function(){\r\n//        var str = '<ul class=\"line-legend\"><li style=\"color:rgba(98,152,179,1)\"><span style=\"color: black;\">Posts</span></li><li style=\"color:rgba(204,0,0,1)\"><span style=\"color: black;\">Threads ' + ((this.scale_thread==1)? '' : 'x'+ this.scale_thread) + '</span></li></ul>'\r\n        var str = '<span style=\"color:rgba(98,152,179,1)\">\\u25cf</span><span style=\"color: black;\"> Posts</span><br>'+\r\n                  '<span style=\"color:rgba(204,0,0,1)\">\\u25cf</span><span style=\"color: black;\"> Threads ' + ((this.scale_thread==1)? '' : 'x'+ this.scale_thread+' ') + '</span>'\r\n        this.legend.pn.innerHTML = str;\r\n      },\r\n//      dragover_pn2: function(e) {e.preventDefault();}, // working code.\r\n//      drop_pn2: function (e) {\r\n//        e.preventDefault(); // FF require this.\r\n//        var str = e.dataTransfer.getData('text');\r\n//        if (str!='') {\r\n//          if (pref.import_format=='obj') data = JSON.parse(str);\r\n//          else {\r\n//            var str_s = str.split(/\\r\\n|\\r|\\n|\\\\n/);\r\n//            data.labels = str_s[0].split(',');\r\n//            for (var i=0;i<2;i++) {\r\n//              var str_sc = str_s[i+1].split(',');\r\n//              for (var j=0;j<str_sc.length;j++) data.datasets[i].data[j] = (str_sc[j]!='')? parseInt(str_sc[j],10) : 0;\r\n//            }\r\n//          }\r\n//        }\r\n//        chart_redraw();\r\n//      },\r\n//      toggle_settings: function(e){ // working code\r\n//        cnst.show_hide(this.pn2_settings, null, this.legend.pn);\r\n//        cnst.toggleButton(e.currentTarget);\r\n//      },\r\n      destroy : function (){\r\n        if (!brwsr.ff) this.chart_posts.stop();\r\n        this.chart_posts.destroy();\r\n//        pn2.removeEventListener('click', chart_redraw, false);\r\n//        pn2.removeEventListener('dragover', dragover_pn2, false);\r\n//        pn2.removeEventListener('drop', drop_pn2, false);\r\n//        pn2.removeEventListener('dragend', div_dragend_pn2, false);\r\n//        pn6.removeEventListener('dragend', function(e){e.stopPropagation();}, false);\r\n        //        size_loc = [pn2.style.width, pn2.style.height, pn2.style.left, pn2.style.bottom, pn6.style.left, pn6.style.bottom];\r\n        this.stats.destroy();\r\n        this.stats = null;\r\n        if (this.pn2) {\r\n          cnst.div_destroy(this.legend.pn, false, this.legend);\r\n          cnst.div_destroy(this.pn2, true, this.pn2_obj);\r\n          cnst.auto_shrink_board_selector.destroy(this.pn_board_sel);\r\n          cnst.unsubscribe(charts, this);\r\n        }\r\n        return null;\r\n      },\r\n//      clear : function () {this.chart_redraw();}, // working code.\r\n//      update_data : function(time_str, posts, threads){\r\n//        while (data_graph.labels.length>=pref.max_graph) chart_posts.removeData();\r\n//        chart_posts.addData([posts,threads*pref.scale_thread],time_str);\r\n//        chart_posts.update();\r\n//      },\r\n//      update: function(){\r\n//        chart_redraw();\r\n//      },\r\n      replace_data: function(src){\r\n        if (!this.stats) this.stats = src; // patch\r\n        this.data_src = src;\r\n        this.chart_redraw();\r\n      },\r\n      update_data2 : function(src){\r\n        var i = src.shift;\r\n        while (i>0) {this.chart_posts.removeData();i--;}\r\n        var data = [];\r\n        for (var i=src.data_p.length-src.shift;i<src.data_p.length;i++) {\r\n          if (src.fromNo && this.idxs.np!=-1) data[this.idxs.np] = (this.clip_np)? this.clip_np_func(src.fromNo.data_p[i]) : src.fromNo.data_p[i];\r\n          if (this.idxs.p!=-1) data[this.idxs.p] = src.data_p[i];\r\n          if (this.idxs.t!=-1) data[this.idxs.t] = src.data_t[i]*this.scale_thread;\r\n          if (src.rm) {\r\n            if (this.idxs.ep!=-1) data[this.idxs.ep] =  src.data_p[i] - src.rm.data_p[i];\r\n            if (this.idxs.et!=-1) data[this.idxs.et] = (src.data_t[i] - src.rm.data_t[i])*this.scale_thread;\r\n          }\r\n          this.chart_posts.addData(data, src.data_l[i]);\r\n        }\r\n        var tgt_p = (this.idxs.p!=-1)? this.chart_posts.datasets[this.idxs.p] : null;\r\n        var tgt_t = (this.idxs.t!=-1)? this.chart_posts.datasets[this.idxs.t] : null;\r\n        var tgt_ep = (this.idxs.ep!=-1 && src.rm)? this.chart_posts.datasets[this.idxs.ep] : null;\r\n        var tgt_et = (this.idxs.et!=-1 && src.rm)? this.chart_posts.datasets[this.idxs.et] : null;\r\n        var tgt_np = (this.idxs.np!=-1 && src.fromNo)? this.chart_posts.datasets[this.idxs.np] : null;\r\n        var p = src.min_idx - (this.stats.len - this.len);\r\n        var i = src.min_idx;\r\n        if (p<0) {\r\n          i += -p;\r\n          p=0;\r\n        }\r\n        if (pref.stats.patch_tm && tgt_np && p>0 && i>0) tgt_np.points[p-1].value = (this.clip_np)? this.clip_np_func(src.fromNo.data_p[i-1]) : src.fromNo.data_p[i-1];\r\n        while (i<src.data_p.length-src.shift) {\r\n          if (tgt_p) tgt_p.points[p].value =  (src.data_p_old && src.data_p_old[i]>src.data_p[i])? src.data_p_old[i] : src.data_p[i];\r\n          if (tgt_t) tgt_t.points[p].value = ((src.data_t_old && src.data_t_old[i]>src.data_t[i])? src.data_t_old[i] : src.data_t[i]) *this.scale_thread;\r\n//            chart_posts.label.points[p].value = src.data_l[i];\r\n          if (tgt_ep) tgt_ep.points[p].value =  src.data_p[i] - src.rm.data_p[i];\r\n          if (tgt_et) tgt_et.points[p].value = (src.data_t[i] - src.rm.data_t[i]) *this.scale_thread;\r\n          if (tgt_np) tgt_np.points[p].value = (this.clip_np)? this.clip_np_func(src.fromNo.data_p[i]) : src.fromNo.data_p[i];\r\n          p++;\r\n          i++;\r\n        }\r\n        src.shift = 0;\r\n        this.chart_posts.update();\r\n      },\r\n      append_legend: function(){this.pn_canvas_root.appendChild(this.legend.pn);},\r\n      remove_legend: function(){this.pn_canvas_root.removeChild(this.legend.pn);},\r\n    }\r\n    PostChart.prototype.pn2_template = {\r\n      get func_str(){return 'left:' +(((count-1)%5)*20)+ 'px:tile2:get:bottom:' +(((count-1)%5)*20)+ ':Show:tb'}, // ':resize:both:float:left:Show:tb:width:' +\r\n//        pref.chart.window_width + 'px:height:' + pref.chart.window_height + 'px:resize:both:overflow:hidden';},\r\n//      rolldown: PostChart.prototype.append_legend,\r\n//      rollup: PostChart.prototype.remove_legend,\r\n      maximize: PostChart.prototype.chart_size_changed,\r\n//      maximize_embed_style_pn: {left:'auto', top:'auto', position:'relative', resize:'none'}, //  {left:'auto', top:'auto', position:'static', resize:'none'}\r\n      maximize_embed_style_pnch1: {}, //  {width:'auto', height:'auto', resize:'none'}\r\n      maximize_float_style_pnch1: {}, //  {width:state[3], height:state[4], resize:'both'}\r\n      exit: PostChart.prototype.destroy,\r\n      get maximize_tgt(){return this.this_obj.pn_canvas_root;}, \r\n    };\r\n    PostChart.prototype.onchange_entry = function(e){\r\n      var tgt_hier = pref_func.get_tgt(e.target.name.replace(/chart.inst./,''),this);\r\n      var prop = tgt_hier[1];\r\n//      var val = (e.target.type==='checkbox')? e.target.checked : (e.target.type==='text')? parseInt(e.target.value,10) : e.target.selectedIndex;\r\n//      target_hier[0][prop] = val;\r\n      pref_func.apply_prep_set(tgt_hier[0], tgt_hier[1], e.target);\r\n      if (this.onchange_funcs[prop]) this.onchange_funcs[prop].call(this,e);\r\n    };\r\n    PostChart.prototype.onchange_funcs = {\r\n      pointDot: PostChart.prototype.chart_redraw,\r\n      pointDotRadius: PostChart.prototype.chart_redraw,\r\n      scale_thread: PostChart.prototype.scale_changed,\r\n      animation: function(){this.chart_posts.options.animation = this.options.animation;},\r\n      len: PostChart.prototype.len_changed,\r\n      separate: function(){this.stats.init();},\r\n      time_sel: function(e){e.target.blur();this.stats.time_unit_changed(this.time_sel);},\r\n      board_sel: PostChart.prototype.board_sel_changed,\r\n      show_legend: function(e){if (e.target.checked) this.append_legend(); else this.remove_legend();},\r\n      clip_np: PostChart.prototype.chart_redraw,\r\n      clip_np_val: function(){\r\n        if (!this.clip_np) {\r\n          this.clip_np = true;\r\n          this.pn2.querySelector('input[name=\"chart.inst.clip_np\"]').checked = true;\r\n        }\r\n        PostChart.prototype.chart_redraw.call(this);\r\n      },\r\n    };\r\n    PostChart.prototype.onchange_funcs.np = PostChart.prototype.onchange_funcs.separate;\r\n    PostChart.prototype.onchange_funcs.p  = PostChart.prototype.onchange_funcs.separate;\r\n    PostChart.prototype.onchange_funcs.ep = PostChart.prototype.onchange_funcs.separate;\r\n    PostChart.prototype.onchange_funcs.t  = PostChart.prototype.onchange_funcs.separate;\r\n    PostChart.prototype.onchange_funcs.et = PostChart.prototype.onchange_funcs.separate;\r\n\r\n    return {\r\n      clear: function(){}, // dummys\r\n      dump: function(format){},\r\n      data_update: function(time_str, posts, threads){},\r\n      PostChart: PostChart,\r\n//      clear: function(){ // working code.\r\n//        data = chart_data_init();\r\n//        if (pn2_func!=null) pn2_func.clear();\r\n//      },\r\n//      dump: function(format){ // http://stackoverflow.com/questions/22055598/writing-a-json-object-to-a-text-file-in-javascript\r\n//        var url;\r\n//        if (format=='csv') {\r\n//          var out_labels = data.labels;\r\n//          var out_data0 = data.datasets[0].data;\r\n//          var out_data1 = data.datasets[1].data;\r\n//          url = 'data:text/json;charset=utf8,' + encodeURIComponent(out_labels) + '\\\\n' + encodeURIComponent(out_data0) + '\\\\n' + encodeURIComponent(out_data1);\r\n//        } else if (format=='obj') url = 'data:text/json;charset=utf8,' + JSON.stringify(data);\r\n//        window.open(url, '_blank');\r\n//        window.focus();\r\n//      },\r\n//      data_update: function(time_str, posts, threads){\r\n//        if (pn2_func!=null) pn2_func.data_update(time_str, posts, threads);\r\n//        if (data.labels.length>=pref.max_capture) {\r\n//          data.datasets[0].data.slice(-pref.max_capture+1);\r\n//          data.datasets[1].data.slice(-pref.max_capture+1);\r\n//          data.labels.slice(-pref.max_capture+1); // labels are copied shallowly, but now made deep copy manually.\r\n//        }\r\n//        data.labels.push(time_str);\r\n//        data.datasets[0].data.push(posts);\r\n//        data.datasets[1].data.push(threads);\r\n//        if (pref.aggregator=='true' && pref.write_to_ls && localStorage) {\r\n//          localStorage.setItem(pipe_name,  JSON.stringify([time_str, posts, threads]));\r\n//          localStorage.setItem(pref_graph.key, JSON.stringify(data));\r\n//        }\r\n      //      },\r\n      time_unit_sel_html: time_unit_sel_html,\r\n      chart_options_str: chart_options_str,\r\n    }\r\n    function chart_data_init() {\r\n      return {\r\n        labels: ['dummy','dummy'], // at least 2 data required at first, or filling collapse. This is probably a BUG in Chart.js.\r\n        datasets: []\r\n      };\r\n    }\r\n    function chart_data_init_1(label, color, alpha) {\r\n      return {\r\n        label: label,\r\n        fillColor: 'rgba(' + color + ',' + alpha + ')',\r\n        strokeColor: 'rgba(' + color + ',1)',\r\n        pointColor: 'rgba(' + color + ',1)',\r\n        pointStrokeColor: '#fff',\r\n        pointHighlightFill: '#fff',\r\n        pointHighlightStroke: 'rgba(' + color + ',1)',\r\n        data: [0,0]\r\n      };\r\n    }\r\n  }\r\n\r\n  function make_setting_obj(pn8){\r\n//  var setting = (function(){\r\n//    var pn8 = div_init(8,'55px','30px','button','settings');\r\n//    var pn8 = cnst.init('left:55px:bottom:30px:button:settings:Show');\r\n    pn8.addEventListener('click', show_hide, false);\r\n    var pn7 = null;\r\n    var pn7_1 = null;\r\n    function show_hide(){  // Toggle Show/Hide\r\n      pn7 = prep_pn7(pn7==null);\r\n    }\r\n    function prep_pn7(make){\r\n      if (make) {\r\n//        pn7 = div_init(7,'5px','50px','div','');\r\n//        pn7 = cnst.init('left:5px:bottom:50px:Show:tb',cnst.void_func,cnst.void_func,show_hide,cnst.void_func);\r\n//if (pref.test_mode['17']) pn7 = cnst.init('left:0px:tile:get:bottom:Show',cnst.void_func,cnst.void_func,show_hide,cnst.void_func); // leaks nodes.\r\nif (pref.test_mode['17']) {pn7 = document.createElement('div');pn7.innerHTML='<div></div><div></div>';site.root_body.appendChild(pn7);} // leaks nodes.\r\nelse \r\n        pn7 = cnst.init('left:0px:tile:get:bottom:Show:tb',cnst.void_func,cnst.void_func,show_hide,cnst.void_func);\r\nif (pref.test_mode['17']) pn7_1 = pn7;\r\nelse \r\n        pn7_1 = pn7.childNodes[1];\r\n        pn7_1.innerHTML = '<div><div style=\"float:left\">\\\r\nStatistics:<br>\\\r\n&emsp;Interval: <input type=\"text\" name=\"interval_found\" size=\"6\" style=\"text-align: right;\">min<br>\\\r\n&emsp;<input type=\"checkbox\" name=\"check_page\"> Show page no. of this thread<br>\\\r\n&emsp;&emsp;<input type=\"checkbox\" name=\"show_page_fraction\"> Show fraction of page No.<br>\\\r\n&emsp;<input type=\"checkbox\" name=\"check_post\"> Show num of new posts in this board<br>\\\r\n&emsp;<input type=\"checkbox\" name=\"check_thread\"> Show num of new threads in this board<br>\\\r\n&emsp;&emsp; Max_capture: <input type=\"text\" name=\"max_capture\" size=\"6\" style=\"text-align: right;\"> points<br>\\\r\n&emsp;&emsp;&emsp;Show recent : <input type=\"text\" name=\"max_graph\" size=\"6\" style=\"text-align: right;\"> points in graph<br>\\\r\n&emsp;&emsp;&emsp;Scale of #threads in graph: <input type=\"text\" name=\"scale_thread\" size=\"6\" style=\"text-align: right;\"><br>\\\r\n<!-- &emsp;&emsp;<input type=\"radio\" name=\"autoconf\" value=\"auto\"> Automatic configuration<br>\\\r\n&emsp;&emsp;<input type=\"radio\" name=\"autoconf\" value=\"manual\"> Manual configuration<br> -->\\\r\n&emsp;&emsp;&emsp;<input type=\"radio\" name=\"aggregator\" value=\"true\"> Aggregate data<br>\\\r\n&emsp;&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"write_to_ls\"> Write to localStrage (server)<br>\\\r\n&emsp;&emsp;&emsp;<input type=\"radio\" name=\"aggregator\" value=\"false\"> Listen from localStrage (client)<br>\\\r\n&emsp;&emsp;<input type=\"checkbox\" name=\"load_data\"> Load data from localStrage at the start<br>\\\r\n&emsp;&emsp;Import format (drop whole text on graph)<br>\\\r\n&emsp;&emsp;&emsp;<input type=\"radio\" name=\"import_format\" value=\"csv\"> csv<br>\\\r\n&emsp;&emsp;&emsp;<input type=\"radio\" name=\"import_format\" value=\"obj\"> obj<br>\\\r\n&emsp;&emsp;<input type=\"button\" value=\"Dump(csv)\"><input type=\"button\" value=\"Dump(obj)\">&emsp;<input type=\"button\" value=\"Clear data\"><br>\\\r\n<input type=\"checkbox\" name=\"auto_start\"> Start automatically (Delayed 10sec.)<br>\\\r\n<br>'+\r\n//          'UIP tracker for 4chan:<br>'+\r\n//          '&emsp;<input type=\"checkbox\" name=\"uip_tracker.on\"> Show num of unique IPs after post No.<br>'+\r\n//          '&emsp;&emsp;<input type=\"checkbox\" name=\"uip_tracker.posts\"> Show num of posts(checking for deletion timing)<br>'+\r\n//          '&emsp;&emsp;Interval: <input type=\"text\" name=\"uip_tracker.interval\" size=\"3\" style=\"text-align: right;\">sec'+\r\n//          '&emsp;<input type=\"checkbox\" name=\"uip_tracker.adaptive\"> Adaptive<br>'+\r\n//          '&emsp;<input type=\"checkbox\" name=\"uip_tracker.auto_open\"> Open next thread automatically<br>'+\r\n//          '&emsp;&emsp;Conditions:<br>'+\r\n//          '&emsp;&emsp;&emsp;After <input type=\"text\" name=\"uip_tracker.auto_open_th\" size=\"3\" style=\"text-align: right;\">th post<br>'+\r\n//          '&emsp;&emsp;&emsp;OP contains <textarea style=\"height:1em\" cols=\"20\" name=\"uip_tracker.auto_open_kwd\"></textarea><br>'+\r\n//          '<br>'+\r\n//'For dollchan: (workaround for bugs)<br>\\\r\n//&emsp;<input type=\"checkbox\" name=\"workaround_for_dollchan\"> Consistency checker for thubmnails of attached images<br>\\\r\n//&emsp;&emsp;runs at<br>\\\r\n//&emsp;&emsp;<input type=\"radio\" name=\"wafd_tb\" value=\"tb\">every time when mouse leaves from thumbnail\\'s area<br>\\\r\n//&emsp;&emsp;<input type=\"radio\" name=\"wafd_tb\" value=\"reply\">only when mouse hovers on the reply button<br>\\\r\n//&emsp;<input type=\"checkbox\" name=\"wafd_open_spoiler\"> Open text spoilers<br>\\\r\n//&emsp;&emsp;(You must turn off the same function in dollchan beforehand)<br>\\\r\n'<!-- Post form:<br>\\\r\n&emsp;<input type=\"checkbox\" name=\"hide_rules\"> Hide rules<br>\\\r\n&emsp;<input type=\"checkbox\" name=\"hide_Go\"> Hide \\'Go\\'<br> -->\\\r\n<br>\\\r\n<br>'+\r\n//Share loaded html with other tabs to update<br>\\\r\n//&emsp;<input type=\"checkbox\" name=\"info_server\"> Broadcast loaded html to other tabs (server)<br>\\\r\n//&emsp;<input type=\"checkbox\" name=\"info_client\"> Listen other tab\\'s broadcasting (client)<br>\\\r\n//<br>\\\r\n//Command interface for overwriting site preference<br>\\\r\n//&emsp;<textarea style=\"height:1em\" cols=\"40\" name=\"overwrite_site2_json_str\"></textarea><br>\\\r\n//&emsp;<input type=\"button\" value=\"JSON\"><br>\\\r\n//&emsp;<textarea style=\"height:1em\" cols=\"40\" name=\"overwrite_site2_eval_str\"></textarea><br>\\\r\n//&emsp;<input type=\"button\" value=\"EVAL\"><br>\\\r\n//</div><div style=\"float:left\">&emsp;&emsp;&emsp;</div><div style=\"float:left\">'+\r\n//Catalog:<br>\\\r\n//&emsp;Cross domain connection:<br>\\\r\n//&emsp;&emsp;<input type=\"radio\" name=\"catalog_cross_domain_connection\" value=\"direct\"> Direct connection<br>\\\r\n//&emsp;&emsp;<input type=\"radio\" name=\"catalog_cross_domain_connection\" value=\"indirect\"> Indirect connection<br>\\\r\n//<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"catalog_fake_access\"> Fake access made by human to avoid poor administration<br>\\\r\n//&emsp;&emsp;&emsp;(This causes heavier network traffic and server load,<br>\\\r\n//&emsp;&emsp;&emsp;but administrators can\\'t see what script you are using)<br>\\\r\n//&emsp;Configuration:<br>\\\r\n//&emsp;&emsp;(To get faster feeling, you should check them all.)<br> -->\\\r\n//&emsp;Networking: load on demand for reducing initial network traffic<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_draw_on_demand\"> Threads<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_load_on_demand\"> HTMLs<br>\\\r\n//&emsp;Localtime offset<input type=\"text\" name=\"localtime_offset\" size=\"2\" style=\"text-align: right;\"><br>'+\r\n//          '&emsp;Tagging:<br>'+\r\n//          '&emsp;&emsp;Ignore tags latter than <input type=\"text\" name=\"catalog.tag.ignore\" size=\"2\" style=\"text-align: right;\">th in a board/thread<br>'+\r\n//          '&emsp;&emsp;Ignore boards/threads which have more than <input type=\"text\" name=\"catalog.tag.max\" size=\"2\" style=\"text-align: right;\"> tags<br>'+\r\n//          '&emsp;Board group configuration:<br>'+\r\n//          '&emsp;&emsp;<textarea rows=\"9\" cols=\"60\" name=\"catalog_board_list_str\"></textarea><br>'+\r\n//          '&emsp;&emsp;<input type=\"checkbox\" name=\"catalog.board.owners_recommendation\"> Read owner\\'s recommendation<br>'+\r\n////          '&emsp;&emsp;<input type=\"button\" value=\"Scan\"> Scan board tags<br>'+\r\n//          '&emsp;&emsp;<input type=\"button\" value=\"Generate\"> Generate board groups from tags<br>'+\r\n//          '&emsp;<input type=\"checkbox\" name=\"catalog.style_general_list\"> Use general style<br>'+\r\n//          '&emsp;&emsp;<textarea rows=\"4\" cols=\"40\" name=\"catalog.style_general_list_str\"></textarea><br>'+\r\n//'&emsp;Catalog/Pop-up/Search<br>\\\r\n//<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"catalog_format.show.images_2nd\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.hover.images_2nd\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.search.images_2nd\"> 2nd or more images in OP<br> -->\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_format.show.posts\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.hover.posts\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.search.posts\"> Posts<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_format.show.fileinfo\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.hover.fileinfo\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.search.fileinfo\"> File information<br>\\\r\n//<!--&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_checkbox_deletion_show\">\\\r\n//<input type=\"checkbox\" name=\"catalog_checkbox_deletion_hover\">\\\r\n//<input type=\"checkbox\" name=\"catalog_checkbox_deletion_search\"> Checkbox for deletion<br> -->\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_format.show.contents\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.hover.contents\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.search.contents\"> Format contents<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_format.show.layout\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.hover.layout\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.search.layout\"> Format layout<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_format.show.style\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.hover.style\">\\\r\n//<input type=\"checkbox\" name=\"catalog_format.search.style\"> Format style<br>\\\r\n//<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"catalog_border_show\">&emsp;&emsp;&emsp; Show border<br> -->\\\r\n//<!-- &emsp;&emsp;<input type=\"checkbox\" name=\"catalog_enable_background\">&emsp;&emsp;&emsp; Use backgfound color<br> -->\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_footer\"> Info(num of posts, images and page)<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_footer_br\"> always over/under the image<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_popup\"> Use pop-up window<br>\\\r\n//&emsp;&emsp;&emsp;appear/disappear:<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"radio\" name=\"catalog_popdown\" value=\"imm\">immediately<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"radio\" name=\"catalog_popdown\" value=\"delay\">delayed \\\r\n//<input type=\"text\" name=\"catalog_popup_delay\" size=\"6\" style=\"text-align: right;\">\\\r\n//<input type=\"text\" name=\"catalog_popdown_delay\" size=\"6\" style=\"text-align: right;\"> ms<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_popup_size_fix\"> Fix size when you move it<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_localtime\"> Localtime<br>\\\r\n//&emsp;&emsp;Num of posts in thread headline: <input type=\"text\" name=\"catalog_t2h_num_of_posts\" size=\"3\" style=\"text-align: right;\"><br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_triage\"> Enable triage pop-up<br>\\\r\n//&emsp;&emsp;&emsp; Style:<textarea style=\"height:1em\" cols=\"40\" name=\"catalog_triage_str\"></textarea><br>\\\r\n//<!-- &emsp;<input type=\"checkbox\" name=\"catalog_enable_cross_board\"> Enable cross-board catalog<br> -->\\\r\n//<!-- &emsp;<input type=\"checkbox\" name=\"catalog_enable_cross_domain\"> Enable cross-domain catalog<br> -->\\\r\n//<!-- &emsp;&emsp; Cache working in <textarea style=\"height:1em\" cols=\"20\" name=\"catalog_sw_domain\"></textarea><br> -->'+\r\n//&emsp;Click to:<br>\\\r\n//&emsp;&emsp;<input type=\"radio\" name=\"catalog_click\" value=\"open\">Go to/Open the thread<br>\\\r\n//&emsp;&emsp;<input type=\"radio\" name=\"catalog_click\" value=\"expand\">Expand/shrink the OP in catalog<br>\\\r\n//&emsp;&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_expand_at_initial\"> Expand at initial<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_no_popup_at_expanded\"> Don\\'t popup when the catalog is expanded<br>\\\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_open_in_new_tab\"> Open the thread in new tab<br>\\\r\n//&emsp;&emsp;&emsp;<input type=\"checkbox\" name=\"catalog_use_named_window\"> Prevent opening a thread in multiple tabs<br>\\\r\n//<br>\\\r\n'</div></div><div style=\"clear: both\">\\\r\n<input type=\"button\" value=\"cancel\">\\\r\n<input type=\"button\" value=\"apply\">\\\r\n<input type=\"button\" value=\"ok\">\\\r\n&emsp;<input type=\"button\" value=\"apply+save\">\\\r\n<input type=\"button\" value=\"load_default\">\\\r\n<input type=\"button\" value=\"load_samples\">'+\r\n//&emsp;&emsp;<input type=\"checkbox\" name=\"debug_mode\"> Debug mode\\\r\n//<input type=\"checkbox\" name=\"show_tooltip\"> Show tooltips\\\r\n'</div>';\r\nif (!pref.test_mode['17']) { // node leak test.\r\n        pref_apply_prep(false);\r\n//        if (brwsr.ff) pn7.draggable = false;\r\n        cnst.bottom_top(pn7);\r\n}\r\n      }\r\nif (!pref.test_mode['17']) {\r\n      var fm = pn7_1.getElementsByTagName('input');\r\n      for (var i=0;i<fm.length;i++) {\r\n        if (fm[i].type=='button') {\r\n          if (make) fm[i].addEventListener('click', button_action, false);\r\n          else fm[i].removeEventListener('click', button_action, false);\r\n        }\r\n      }\r\n}\r\n      if (make) return pn7;\r\n      else {\r\nif (pref.test_mode['17']) {\r\n  pn7_1.innerHTML = '';\r\n  pn7.parentNode.removeChild(pn7);\r\n  return null;\r\n} else\r\n        pn7_1 = null;\r\n        return cnst.div_destroy(pn7, true); // returns null\r\n      }\r\n\r\n//      function pref_apply_prep(set){\r\n//        var fm = pn7_1.getElementsByTagName('input');\r\n//        for (var i=0;i<fm.length;i++) {\r\n//          if (fm[i].type=='button') continue;\r\n//          var tgt = fm[i].name;\r\n//          if (set) {\r\n//            if      (typeof(pref[tgt])=='number' ) pref[tgt] = parseInt(fm[i].value,10);\r\n//            else if (typeof(pref[tgt])=='boolean') pref[tgt] = fm[i].checked;\r\n//            else if (typeof(pref[tgt])=='string' ) if (fm[i].checked) pref[tgt] = fm[i].value;\r\n//          } else {\r\n//            if      (typeof(pref[tgt])=='number' ) fm[i].value = pref[tgt];\r\n//            else if (typeof(pref[tgt])=='boolean') fm[i].checked = pref[tgt];\r\n//            else if (typeof(pref[tgt])=='string' ) if (pref[tgt] == fm[i].value) fm[i].checked = true;\r\n//          }\r\n//        }\r\n//        if (set) {\r\n//          sessionStorage.pref = JSON.stringify(pref);\r\n//          listener();\r\n//          timer_obj.init();\r\n//        }\r\n//      }\r\n      function pref_apply_prep(set){\r\n        pref_func.apply_prep(pn7_1,set);\r\n        if (set) {\r\n          listener();\r\n          timer_obj.init();\r\n//          if (wafd!=null) wafd.workaround_for_dollchan_pref_changed();\r\n        }\r\n      }\r\n      function button_action(e){\r\n//        console.log(e);\r\n        var src = e.currentTarget.value;\r\n        if      (src=='apply'       ) pref_apply_prep(true);\r\n        else if (src=='cancel'      ) show_hide();\r\n        else if (src=='ok'          ) {pref_apply_prep(true);show_hide();}\r\n        else if (src=='apply+save'  ) {pref_apply_prep(true);if (localStorage) localStorage[pref.script_prefix+'.pref']=JSON.stringify(pref);}\r\n        else if (src=='load_default') {pref = pref_default();pref_apply_prep(false);pref_apply_prep(true);pref_func.obj_init();} // last pref_apply_prep is for writing to sessionStrage.\r\n//        else if (src=='load_backwash_style') {pref_func.pref_overwrite(pref,pref_func.pref_samples['backwash']);pref_apply_prep(false);}\r\n        else if (src=='load_samples') {pref_func.pref_samples.init();}\r\n        else if (src=='Dump(csv)'   ) chart_obj.dump('csv');\r\n        else if (src=='Dump(obj)'   ) chart_obj.dump('obj');\r\n        else if (src=='Clear data'  ) chart_obj.clear();\r\n        else if (src=='JSON'        ) {pref_func.apply_prep(pn7_1.getElementsByTagName('TEXTAREA')['overwrite_site2_json_str'],true);pref_func.site2_json();}\r\n        else if (src=='EVAL'        ) {pref_func.apply_prep(pn7_1.getElementsByTagName('TEXTAREA')['overwrite_site2_eval_str'],true);pref_func.site2_eval();}\r\n      }\r\n    }\r\n//  })();\r\n  }\r\n\r\n//  var listener = (function(){\r\n  function make_listener(){\r\n    var on = false;\r\n    var value_old;\r\n    function listen_event(e){\r\n//      console.log('EVENT:'+e.key);\r\n      if (e.newValue===null) return;\r\n      if (e.key===pipe_name && pref.aggregator==='false') {\r\n        var tmp = brwsr.JSON_parse(e.newValue);\r\n        if (tmp[0]!=value_old) {\r\n          value_old = tmp[0];\r\n          chart_obj.data_update(tmp[0], tmp[1], tmp[2]);\r\n          timer_obj.show_page([null, '+'+tmp[1]+'+'+tmp[2]+'@'+tmp[0]]);\r\n        }\r\n//      } else if (e.key.search(info_raw)!=-1 && pref.info_client) {\r\n//        var page_no = e.key.substr(info_raw.length);\r\n//        var timer = timer_obj.timer();\r\n//        if (timer!=null) {\r\n//          var value = JSON.parse(e.newValue);\r\n//          timer.page_check4(value[0], page_no, new DOMParser().parseFromString(value[1],'text/html'));\r\n//        }\r\n      }\r\n    }\r\n    function setup(){\r\n      if (!on && pref.aggregator==='false') {\r\n        window.addEventListener   ('storage', listen_event, false);\r\n        on = true;\r\n      } else if (on && pref.aggregator==='true') {\r\n        window.removeEventListener('storage', listen_event, false);\r\n        on = false;\r\n      }\r\n    }\r\n    setup();\r\n    return setup;\r\n  };\r\n//  })();\r\n  var listener = null;\r\n  if (site.features.listener && pref.features.listener) listener = make_listener();\r\n\r\n  function make_timer_obj(pn0){\r\n//  var timer_obj = (function(){\r\n////    var pn0 = div_init(0,'5px',  '5px' ,'txt','init');\r\n//    var pn0 = cnst.init('left:0px:bottom:0px:txt:init:fontSize:24px:Show:tile:set:left:tile:set:bottom');\r\n    pn0.addEventListener('click', function(){init(false);}, false);  // Toggle ON/OFF\r\n    var timer_obj2 = null;\r\n    function init(property_changed){\r\n      if (timer_obj2 == null && (pref.check_page || (pref.aggregator=='true' && (pref.check_thread || pref.check_post)))) timer_obj2 = make_timer(pn0);\r\n      else if (timer_obj2 != null) {\r\n        if (!property_changed || (!pref.check_page && (pref.aggregator=='false' || (!pref.check_thread && !pref.check_post)))) stop_destroy();\r\n        else if (property_changed) timer_obj2.timer().restart(false);\r\n      }\r\n    }\r\n    function stop_destroy(){\r\n      timer_obj2 = timer_obj2.destroy();\r\n      pn0.style.color = 'gray';\r\n    }\r\n//    if (pref.auto_start) init(false);\r\n    if (pref.auto_start) setTimeout(function(){init(false);},10000);\r\n    var pn0_str = ['',''];\r\n    return {\r\n      init : function(){init(true);},\r\n      finished : function(){stop_destroy();},\r\n      timer: function(){return timer_obj2;},\r\n      show_page : function(str){\r\n//        pn0.appendChild(document.createTextNode(str+'@'+cnst.get_time()));\r\n//        pn0.textContent = str+'@'+cnst.get_time();\r\n        if (                 str[0]!=null) pn0_str[0] = str[0]+'@'+cnst.get_time();\r\n        if (str.length>=2 && str[1]!=null) pn0_str[1] = str[1];\r\n        if (str.length>=3 && str[2]!=null) pn0_str[0] = str[2];\r\n//        pn0.textContent = pn0_str1 +', '+ pn0_str2 +', '+pn0_str3;\r\n        if (pn0_str[0]!='' && pn0_str[1]!='') pn0.textContent = pn0_str[0] +', '+ pn0_str[1];\r\n        else pn0.textContent = pn0_str[0] + pn0_str[1];\r\n      }\r\n    }\r\n//  })();\r\n  }\r\n\r\n  function make_timer(pn0){\r\n    var page = (function(){\r\n      var idx = [];\r\n      var p = 0;\r\n      var now = 0;\r\n      var str_place='';\r\n      var check_page = pref.check_page;\r\n      if (window.location.href.search(site.thread_keyword)==-1) check_page = false;\r\n//      var flag = [false,false,mode_graph_only]; // top, last, myself, to be got.\r\n      \r\n//      idx[0] = 0;\r\n//      idx[1] = site.max_page -1; // last page\r\n//      for (var i=2;i<site.max_page;i++) idx[i]=i-1;\r\n//      idx[site.max_page] = site.max_page; // +1 for myself.\r\n      function init(){\r\n        var j=0;\r\n        idx[0] = -1; // -1 for mot match.\r\n        idx[1] = -1;\r\n        if (pref.check_post) idx[j++] = 0;\r\n        if (pref.check_thread) idx[j++] = site.max_page-1;\r\n        var next = (now+1)%(site.max_page+1);\r\n        if (now !=idx[0] && now !=idx[1]) idx[j++] = now;  // idx[2] for page_no.\r\n        if (next!=idx[0] && next!=idx[1]) idx[j++] = next; // idx[3] for next_page.\r\n        for (var i=0;i<=site.max_page;i++)\r\n          if (i!=now && i!=next && i!=idx[0] && i!=idx[1]) idx[j++] = i;\r\n        flag = [!pref.check_post, !pref.check_thread, !check_page];\r\n        p=0;\r\n//        if (flag[0] && flag[1] && flag[2]) timer.stop();\r\n      }\r\n      init();\r\n  \r\n      return {\r\n        no   : function() {return idx[p];},\r\n        step : function() {p=(p+1)%(site.max_page+1);},\r\n        prep_next : function() {init();},\r\n        flag_set : function(i) {flag[i]=true;},\r\n        all_got  : function() {return flag[0] && flag[1] && flag[2];},\r\n        str_set  : function(i,j) {if (check_page && i!=site.max_page) {str_place = i + '.' + j; now=i;}}, // patch for a bug of showing '20.0'.\r\n        str_get  : function() {return str_place;},\r\n        init : function(){init();}\r\n      }\r\n    })();\r\n\r\n    var last_post_old = 0;\r\n    var last_post = 0;\r\n    var last_ops_old = [];\r\n    var num_of_new_threads = 0;\r\n    var timer = (function(){\r\n      var req = new XMLHttpRequest();\r\n      req.addEventListener('load',  req_events, false);\r\n      req.addEventListener('error', req_events, false);\r\n      req.addEventListener('abort', req_events, false);\r\n    \r\n      function req_events(evt) {\r\n        var parser = new DOMParser();\r\n        if (req.status==404) timer.dead();\r\n        else {\r\n          var date = Date.now();\r\n          if (pref.info_server && page.no()!=site.max_page && brwsr.sw_cache)\r\n            brwsr.sw_cache.setItem(info_raw+'p'+page.no(),{date: date, status: req.status, responseText: req.responseText});\r\n          if (pref.catalog_snoop_refresh && catalog_obj.catalog_func()!=null)\r\n            catalog_obj.catalog_func().catalog_insert(info_raw+'p'+page.no(),{date: date, status: req.status, responseText: req.responseText});\r\n          page_check2(parser.parseFromString(req.responseText, 'text/html'));\r\n        }\r\n      }\r\n      function get_page(url) {\r\n        req.open('GET', url, true);\r\n        req.send(null);\r\n      }\r\n      var checking = false;\r\n      var time_str;\r\n      function page_check3(){\r\n        if (!checking) {\r\n          checking = true;\r\n          time_str = cnst.get_time();\r\n          page_check();\r\n        }\r\n      }\r\n      function page_check(){\r\n//        timer.stop(false);\r\n//        var url = site.url_prefix + page.no() + '.html';\r\n//        var url = site.make_url([site.board, page.no(), 'p')[0];\r\n        var url = site2[site.nickname].make_url4([site.nickname, site.board, page.no(), 'page_html'])[0];\r\n        if (page.no()==site.max_page) url = window.location.href;\r\n        get_page(url);\r\n      }\r\n\r\n      var interval_missing = 1000;\r\n//      var interval_found   = 60000 * 10;\r\n//      var interval_error   = 60000 * 10; // 10 min.\r\n      var retry_count = 0;\r\n      var retry_limit = (site.max_page+1)+5;\r\n      var id = null;\r\n      var interval_old = 0;\r\n      function timer_restart(force){\r\n        if (force || interval_old != pref.interval_found) {\r\n          timer_stop(false);\r\n          id = setInterval(page_check3, pref.interval_found*60000);\r\n        }\r\n        interval_old = pref.interval_found;\r\n      }\r\n      timer_restart(true);\r\n      page_check3();\r\n      pn0.style.color = '#000000';\r\n\r\n      function timer_stop(end){\r\n        if (id!=null) clearInterval(id);\r\n        id = null;\r\n        if (end) pn0.style.color = 'gray';\r\n      }\r\n\r\n//      var myself = get_nos(document,-1,-1);\r\n      var myself = (window.location.href.search(site.thread_keyword)!=-1)? get_nos(document,-1,-1) :-2;\r\n      return {\r\n//        req : function(){return req;}, // for debug\r\n        req : req, // for debug\r\n        found: function(){\r\n          retry_count = 0;\r\n//          id = setInterval(page_check3, pref.interval_found*60000);\r\n          checking = false;\r\n        },\r\n        missing: function(){\r\n          if (req.status==200 && retry_count++<retry_limit) setTimeout(page_check, interval_missing);\r\n          else {\r\n            retry_count = 0;\r\n//            id = setInterval(page_check, interval_error);\r\n            checking = false;\r\n          }\r\n        },\r\n        stop:  function(end){timer_stop(end);},\r\n        dead:  function(){timer_obj.show_page(['Dead']);timer_stop(true);timer_obj.finished();},\r\n        myself: function(){return myself;},\r\n        restart: function(force){timer_restart(force)},\r\n        timestr: function(){return time_str;},\r\n        destroy: function(){\r\n          req.removeEventListener('load',  req_events, false);\r\n          req.removeEventListener('error', req_events, false);\r\n          req.removeEventListener('abort', req_events, false);\r\n        }\r\n      }\r\n    })();\r\n\r\n    if (brwsr.sw_cache && pref.info_client) brwsr.sw_cache.subscribe(true);\r\n    return {\r\n      destroy: function(){\r\n        if (brwsr.sw_cache) brwsr.sw_cache.subscribe(false);\r\n        timer.stop(true);\r\n        timer.destroy();\r\n        return null;\r\n      },\r\n      timer: function(){return timer;},\r\n//      page_check4: page_check4\r\n      page_check5: page_check5\r\n    }\r\n\r\n    function page_check5(key,value,args){\r\n      var page_no = common_func.name2domainboardthread(key,true)[2].substr(1);\r\n      page_check4(value.date, page_no, new DOMParser().parseFromString(value.responseText,'text/html'));\r\n    }\r\n    function page_check4(time_stamp, page_no, doc){\r\n      var ops = site.get_ops(doc);\r\n      var myself = timer.myself();\r\n      for (var i=0;i<ops.length;i++) {\r\n        if (myself==ops[i]) {\r\n          page.str_set(page_no,i);\r\n          var str = page.str_get() + '@' + new Date(time_stamp).toLocaleTimeString();\r\n          timer_obj.show_page([null,null,str]);\r\n          page.prep_next();\r\n          timer.restart(true);\r\n          if (pref.check_page) options.func0_exe(page.str_get());\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    function page_check2(doc){\r\n      var page_no = page.no();\r\n      get_nos(doc,timer.myself(),page_no);\r\n      if (page.all_got() && page.no()!=site.max_page) {\r\n        var increase_posts = (last_post_old==0)? 0 : last_post-last_post_old;\r\n        var str = '';\r\n        if (pref.check_page)   str = page.str_get();\r\n        if (pref.check_post)   str = str + '+' + increase_posts;\r\n        if (pref.check_thread) str = str + '+' + num_of_new_threads;\r\n        timer_obj.show_page([str]);\r\n        page.prep_next();\r\n        timer.found();\r\n        increase_posts = parseInt(increase_posts,10);\r\n        if (isNaN(increase_posts) || increase_posts==null) increase_posts = 0;\r\n        if (pref.check_post || pref.check_thread) chart_obj.data_update(timer.timestr(),increase_posts, num_of_new_threads);\r\n        last_post_old = last_post;\r\n        if (pref.check_page) options.func0_exe(page.str_get());\r\n      } else {\r\n        timer_obj.show_page([page_no+'?']);\r\n        page.step();\r\n        timer.missing();\r\n      }\r\n    }\r\n\r\n    function get_nos(tgt_doc,myself,page_no){\r\n//      var ops = [];\r\n//      var num = 0;\r\n//      var divs = tgt_doc.getElementsByTagName('div');\r\n//      for (var i=0;i<divs.length;i++) {\r\n//        if (divs[i].className == 'thread' || divs[i].className == 'thread kc_showReplies') {\r\n//          var op_no = divs[i].id.substring(7); // substring(7) for removing 'thread_'\r\n//          if (myself==op_no) {str_place = page.str_set(page_no,num); page.flag_set(2);}\r\n//          ops[num++] = op_no;\r\n//        }\r\n//      }\r\n      var ops = site.get_ops(tgt_doc);\r\n      for (var i=0;i<ops.length;i++) if (myself==ops[i]) {page.str_set(page_no,i); page.flag_set(2);break;}\r\n      if (myself==-1) return ops[0];\r\n      if (page_no==0) {\r\n        page.flag_set(0);\r\n        last_post = get_last_post(tgt_doc);\r\n      }\r\n      if (page_no==site.max_page-1) {\r\n        page.flag_set(1);\r\n        var len = last_ops_old.length\r\n        if (len!=0) {\r\n          var last_op = ops[ops.length-1];\r\n          var i=0;\r\n          while (i<len && last_op!=last_ops_old[len-i-1]) i++;\r\n          num_of_new_threads = i;\r\n        } else num_of_new_threads = 0;\r\n        last_ops_old = ops;\r\n      }\r\n    }\r\n\r\n    function get_last_post(tgt_doc){\r\n      var posts = site.get_posts(tgt_doc);\r\n//      var posts = [];\r\n//      var anchors = tgt_doc.getElementsByTagName('a');\r\n//      var num = 0;\r\n//      for (var i=0;i<anchors.length;i++)\r\n//        if (anchors[i].name != '') posts[num++] = anchors[i].name;\r\n      var last_post = posts[0];\r\n      for (var i=1;i<posts.length;i++) {\r\n        if (posts[i]>last_post) last_post=posts[i];\r\n//      else break; // Cause a bug when a post had made in a sunk thread and immediately deleted.\r\n      }\r\n      return last_post;\r\n    }\r\n  }\r\n\r\n////function make_wafd(){ // deleted 2018.10.23\r\n////    function on_change_workaround_for_dollchan(exe){\r\n//////      pref.workaround_for_dollchan = workaround_for_dollchan.checked;\r\n////      if (pref.workaround_for_dollchan == true) {\r\n//////        document.getElementById('postform_row_files').style.display = '';\r\n//////        var tmp = document.getElementsByTagName('input');\r\n//////        for (var i=0;i<tmp.length;i++) if (tmp[i].type=='file') tmp[i].parentNode.style.display = '';\r\n////        if (exe) on_change_workaround_for_dollchan_2(); // temporarily.\r\n////        if (pref.wafd_tb=='tb') document.getElementById('postform_label_comment').addEventListener('mouseout', on_change_workaround_for_dollchan, false);\r\n////        else site.components.postform_submit.addEventListener('mouseenter', on_change_workaround_for_dollchan, false);\r\n////      } else {\r\n//////        document.getElementById('postform_row_files').style.display = 'none';\r\n////        if (pref.wafd_tb=='tb') document.getElementById('postform_label_comment').removeEventListener('mouseout', on_change_workaround_for_dollchan, false);\r\n////        else site.components.postform_submit.removeEventListener('mouseenter', on_change_workaround_for_dollchan, false);\r\n////      }\r\n////    }\r\n////    function workaround_for_dollchan_pref_changed(){\r\n////      if (pref.workaround_for_dollchan == true) {\r\n////        pref.workaround_for_dollchan = false;\r\n////        pref.wafd_tb = (pref.wafd_tb=='tb')? 'reply' : 'tb';\r\n////        on_change_workaround_for_dollchan(null);\r\n////        pref.workaround_for_dollchan = true;\r\n////        pref.wafd_tb = (pref.wafd_tb=='tb')? 'reply' : 'tb';\r\n////        on_change_workaround_for_dollchan(null);\r\n////      }\r\n////      open_spoiler();\r\n////    }\r\n////    function on_change_workaround_for_dollchan_2(){\r\n////      var inputs = document.getElementsByTagName('input');\r\n////      var files = [];\r\n////      for (var i=0;i<inputs.length;i++) if (inputs[i].type=='file') files.push(inputs[i]);\r\n////      var grand_parent = document.getElementById('postform_row_files');\r\n////      var parent;\r\n////      for (var i=0;i<grand_parent.childNodes.length;i++) if (grand_parent.childNodes[i].align=='left') parent = grand_parent.childNodes[i];\r\n//////      for (var i=0;i<4;i++) for (var j=0;j<4;j++) if (files[i].name==('file_'+j)) parent.childNodes[i].appendChild(files[i]);\r\n////      for (var i=0;i<files.length;i++) {\r\n////        var no = parseInt(files[i].name.replace(/file_/,\"\"));\r\n////        parent.childNodes[no].appendChild(files[i]);\r\n//////        parent.childNodes[no].style.display = '';\r\n//////        files[i].addEventListener('change', on_change_workaround_for_dollchan_3, false);\r\n////        var evt = document.createEvent('UIEvents');\r\n////        evt.initUIEvent('change', false, true, window, 1);\r\n////        files[i].dispatchEvent(evt);\r\n////      }\r\n////\r\n//////      var images = images = document.getElementsByClassName('de-file-img');\r\n//////      var thumbnails = [];\r\n//////      for (var i=0;i<images.length;i++) if (images[i].tagName=='IMG') thumbnails.push(images[i]);\r\n////      var thumbnails_parent = document.getElementById('postform_label_comment');\r\n////      var show_thumbnails = true;\r\n////      for (var i=0;i<files.length;i++) {\r\n//////        if (files[i].value=='' && thumbnails[i]!=undefined) thumbnails[i].parentNode.removeChild(thumbnails[i]);\r\n////        if (files[i].value=='') {\r\n////          var thumbnail = thumbnails_parent.getElementsByTagName('img')[0];\r\n////          if (thumbnail!=undefined) thumbnail.parentNode.removeChild(thumbnail);          \r\n////        }\r\n////        if (files[i].value!='' || show_thumbnails) {\r\n////          thumbnails_parent.childNodes[i].style.display = '';\r\n////          if (files[i].value=='') show_thumbnails = false;\r\n////        } else thumbnails_parent.childNodes[i].style.display = 'none';\r\n//////        console.log(i + ': '+ files[i].value);\r\n////      }\r\n////    }\r\n//////    function on_change_workaround_for_dollchan_3(){\r\n//////      console.log('change');\r\n//////    }\r\n////    if (pref.workaround_for_dollchan == true) on_change_workaround_for_dollchan(false); // initial\r\n////\r\n////    var spoiler_org = null;\r\n////    var rule = [];\r\n////    function open_spoiler(){\r\n////      if (pref.wafd_open_spoiler == true) {\r\n////        rule = [];\r\n////        for (var j=0;j<document.styleSheets.length;j++)\r\n////          for (var i=0;i<document.styleSheets[j].cssRules.length;i++)\r\n////            if (document.styleSheets[j].cssRules[i].selectorText && document.styleSheets[j].cssRules[i].selectorText.search(/spoiler/)!=-1) rule.push(j,i)\r\n////        if (document.styleSheets[rule[0]].cssRules[rule[1]].selectorText.search(/hover/)!=-1) {rule.push(rule.shift());rule.push(rule.shift());}\r\n////        spoiler_org = document.styleSheets[rule[0]].cssRules[rule[1]].style.cssText;\r\n////        document.styleSheets[rule[0]].cssRules[rule[1]].style.cssText = document.styleSheets[rule[2]].cssRules[rule[3]].style.cssText;\r\n////      } else if (spoiler_org!=null) document.styleSheets[rule[0]].cssRules[rule[1]].style.cssText = spoiler_org;\r\n////    }\r\n////    if (pref.wafd_open_spoiler == true) open_spoiler(); // initial\r\n////    return{\r\n//////      on_change_workaround_for_dollchan: function(exe){on_change_workaround_for_dollchan(exe);},\r\n////      workaround_for_dollchan_pref_changed: function(){workaround_for_dollchan_pref_changed();}\r\n////    }\r\n////  }\r\n\r\n  function make_post_form_obj(pn9){\r\n//  var post_form = (function(){\r\n//    var pn9 = div_init(9,'120px','30px','button','post_form');\r\n//    var pn9 = cnst.init('left:120px:bottom:30px:button:post_form:Show');\r\n    var tack;\r\n    pn9.addEventListener('click', show_hide2, false);\r\n    if (site2[site.nickname].postform) {\r\n      tack = site2[site.nickname].postform.init();\r\n      if (tack) cnst.set_tack_float(tack, postform_float, postform_dock);\r\n//      if (tack) tack.addEventListener('click', show_hide, false);\r\n    }\r\n    function postform_focus(){\r\n      site.components.postform_comment.focus();\r\n    }\r\n    function postform_float(e){\r\n      if (site2[site.nickname].postform.activation) site2[site.nickname].postform.activation();\r\n      var obj = cnst.tack_float_nSblgs(e);\r\n      obj.rolldown = postform_focus;\r\n      pn10 = obj.pn;\r\n      obj.cn.childNodes[0].innerHTML = \r\n        '<div>'+\r\n          '<input type=\"checkbox\" name=\"prevent_redirection\">prevent redirection'+\r\n        '</div>'+\r\n        '<div></div>';\r\n      pn10_2 = obj.cn.childNodes[0];\r\n      pref_func.apply_prep(pn10_2,false);\r\n      pn10_2.getElementsByTagName('input')['prevent_redirection'].onchange = on_change_redirection;\r\n      options.func0_prep(obj.cn.childNodes[0].childNodes[1],obj.pn, obj.cn);\r\n      postform_focus();\r\n      if (site.postform.getAttribute('name') === pref.script_prefix + '_draft') {\r\n        site.postform.style.display = null;\r\n        obj.pn.style.top = '0px';\r\n        obj.pn.style.left = '0px';\r\n      }\r\n    }\r\n    function postform_dock(e){\r\n      cnst.tack_dock_nSblgs(e);\r\n      if (site.postform.getAttribute('name') === pref.script_prefix + '_draft') site.postform.style.display = 'none';\r\n    }\r\n    function show_hide2(){\r\n      if (tack.style.display!=='none') postform_float({currentTarget:tack});\r\n      else postform_dock({currentTarget:pn10.childNodes[0]});\r\n    }\r\n    var pn10 = null;\r\n    var pn10_2 = null;\r\n//    var pn10_2 = cnst.add_to_tb(pn10,'<input type=\"checkbox\">workaround for dollchan<input type=\"checkbox\">prevent redirection');\r\n//    var pn10_2 = document.createElement('div');\r\n//    pn10_2.style.float = 'right'; // doesn't work on FF\r\n//    pn10_2.innerHTML = '<input type=\"checkbox\">workaround for dollchan<input type=\"checkbox\">prevent redirection'\r\n//    var prevent_redirection = pn10_2.childNodes[2];\r\n//    prevent_redirection.onchange = on_change_redirection;\r\n//    var workaround_for_dollchan = pn10_2.childNodes[0];\r\n//    workaround_for_dollchan.onchange = on_change_workaround_for_dollchan;\r\n//    var workaround_for_dollchan;\r\n//    var on = false; // working code\r\n////    var hidden_elements = [];\r\n//    function show_hide(){\r\n//      if (site2[site.nickname].postform.activation) site2[site.nickname].postform.activation();\r\n//      var tgt    = site.postform;\r\n//      if (!on) {\r\n//        if (pn10==null) {\r\n//          var left = tgt.offsetLeft - tgt.scrollLeft;\r\n//          var top = tgt.offsetTop - tgt.scrollTop + site.header_height();\r\n//          pn10 = cnst.init('left:'+left+'px:top:'+top+'px:overflow:hidden:Show:tb',function(){site.components.postform_comment.focus();},cnst.void_func,show_hide,cnst.void_func);\r\n////          pn10 = cnst.init('left:0px:tile:get:bottom:overflow:hidden:Show:tb',function(){site.components.postform_comment.focus();},cnst.void_func,show_hide,cnst.void_func)[0];\r\n//          pn10.id = 'pn10_debug';\r\n////          pn10_2 = cnst.add_to_tb(pn10,'<input type=\"checkbox\" name=\"workaround_for_dollchan\">workaround for dollchan<input type=\"checkbox\" name=\"prevent_redirection\">prevent redirection');\r\n//          pn10_2 = cnst.add_to_tb(pn10,'<input type=\"checkbox\" name=\"prevent_redirection\">prevent redirection');\r\n//          pref_func.apply_prep(pn10_2,false);\r\n////          prevent_redirection = pn10_2.childNodes[2];\r\n//          prevent_redirection = pn10_2.childNodes[0];\r\n//          prevent_redirection.onchange = on_change_redirection;\r\n////          workaround_for_dollchan = pn10_2.childNodes[0];\r\n////          workaround_for_dollchan.onchange = on_change_workaround_for_dollchan;\r\n////          pn10.childNodes[0].insertBefore(pn10_2,pn10.childNodes[0].childNodes[2]);\r\n////          if (brwsr.ff)  pn10.childNodes[0].childNodes[2].style.float = 'right'; // doesn't work\r\n////          if (brwsr.ff) pn10.childNodes[0].childNodes[2].outerHTML = pn10.childNodes[0].childNodes[2].outerHTML.replace(/<div/,\"<div style=\\\"float: right\\\"\"); // discard events configuration\r\n////          if (brwsr.ff) pn10.childNodes[0].childNodes[2].setAttribute('style','float: right');\r\n//          pn10.childNodes[1].innerHTML = '<div style=\"display: none\"></div><div></div>';\r\n////          options.func0_prep(pn10.childNodes[1].childNodes[0],pn10.childNodes[0]);\r\n//          options.func0_prep(pn10.childNodes[1].childNodes[0],pn10);\r\n//        }\r\n////        parent = tgt.parentNode; // working code\r\n////        no = 0;\r\n////        while (parent.childNodes[no]!=tgt && no < parent.childNodes.length) no++;\r\n////        pn10.childNodes[1].childNodes[1].appendChild(tgt);\r\n////        site.root_body.appendChild(pn10);\r\n//        tgt.parentNode.insertBefore(pn10,tgt);\r\n//        pn10.childNodes[1].childNodes[1].appendChild(tgt);\r\n////        var labels = document.getElementsByClassName('label'); // working code for KC, but dangerous.\r\n////        for (var i=0;i<labels.length;i++) {\r\n////          if (labels[i].innerHTML==\"Go to:\" || labels[i].innerHTML==\"Password:\") {\r\n////            if (labels[i].parentNode.style.display != 'none'){\r\n////              labels[i].parentNode.style.display = 'none';\r\n////              hidden_elements.push(labels[i].parentNode);\r\n////            }\r\n////          }\r\n////        }\r\n////        if (site.postform_rules!=null) {\r\n////          site.postform_rules.style.display = 'none';\r\n////          hidden_elements.push(site.postform_rules);\r\n////        }\r\n//        if (site2[site.nickname].postform) site2[site.nickname].postform.on(site.postform);\r\n//        site.components.postform_comment.focus();\r\n////        cnst.bottom_top(pn10);\r\n//      } else {\r\n//        if (site2[site.nickname].postform) site2[site.nickname].postform.off(pn10);\r\n////        while (hidden_elements.length!=0) hidden_elements.pop().style.display = '';\r\n//        pn10.parentNode.insertBefore(pn10.childNodes[1].childNodes[1].lastChild,pn10);\r\n//        pn10.parentNode.removeChild(pn10);\r\n//      }\r\n//      on = !on;\r\n//      if (tgt.getAttribute('name') === pref.script_prefix + '_draft') tgt.style.display = (on)? '' : 'none';\r\n//    }\r\n\r\n    var submits = [];\r\n    var forms_post = [];\r\n    var forms = document.getElementsByTagName('form');\r\n//    for (var i=0;i<forms.length;i++) if (forms[i].method!='post') forms.splice(i,1); // post, delete, report // doesn't work.\r\n    for (var i=0;i<forms.length;i++) if (forms[i].method=='post') forms_post.push(forms[i]); // post, delete, report\r\n    for (var i=0;i<forms_post.length;i++) {\r\n      var inputs = forms_post[i].getElementsByTagName('input');\r\n      for (var j=0;j<inputs.length;j++) if (inputs[j].type=='submit') submits.push(inputs[j]);\r\n    }\r\n//    var posted = [];\r\n//    for (var i=0;i<submits.length;i++) {posted.push(false); submits[i].addEventListener('click', function(){posted[i] = true;}, false);} // doesn't work because of closure.\r\n//    for (let i=0;i<submits.length;i++) {posted.push(false); submits[i].addEventListener('click', function(){posted[i] = true;}, false);} // 'let' can't be used in chrome script.\r\n    var posted = false;\r\n    var targets = [];\r\n    for (var i=0;i<submits.length;i++) submits[i].addEventListener('click', function(){posted = true;}, false);\r\n//    window.addEventListener('beforeunload', on_beforeunload, false);\r\n    var pn11;\r\n    function on_change_redirection(){\r\n//      pref.prevent_redirection = prevent_redirection.checked;\r\n      if (pn10_2!=null) pref_func.apply_prep(pn10_2,true);\r\n      if (pref.prevent_redirection == true) {\r\n        if (!pn11) {\r\n          pn11 = cnst.make_iframe('redirect_target');\r\n          pn11.onload = function(){if (pn11.location && pn11.location.href!='about:blank') pn11.location.replace('about:blank');}; // clear always.\r\n        }\r\n        for (var i=0;i<submits.length;i++) {\r\n          targets[i] = forms[i].target;\r\n          forms[i].target = 'redirect_target';\r\n        }\r\n      } else for (var i=0;i<submits.length;i++) forms[i].target = targets[i];\r\n    }\r\n    if (pref.prevent_redirection == true) on_change_redirection(); // initial\r\n//    function on_beforeunload(e){ // doesn't work. too late?\r\n//      if (prevent_redirection.checked == true) {\r\n//        console.log('beforeunload: ' + e);\r\n////        for (var i=0;i<submits.length;i++) {\r\n////          if (posted[i]) forms[i].target = 'rediret_target';\r\n////          posted[i] = false;\r\n////        }\r\n//        if (posted) for (var i=0;i<submits.length;i++) {\r\n//          targets[i] = forms[i].target;\r\n//          forms[i].target = 'redirect_target';\r\n//        }\r\n//      }\r\n//    }\r\n\r\n//    function on_change_workaround_for_dollchan(){\r\n////      pref.workaround_for_dollchan = workaround_for_dollchan.checked;\r\n//      if (pn10_2!=null) pref_func.apply_prep(pn10_2,true);\r\n//      if (pref.workaround_for_dollchan == true) {\r\n////        document.getElementById('postform_row_files').style.display = '';\r\n////        var tmp = document.getElementsByTagName('input');\r\n////        for (var i=0;i<tmp.length;i++) if (tmp[i].type=='file') tmp[i].parentNode.style.display = '';\r\n//        if (pn10_2!=null) on_change_workaround_for_dollchan_2(); // temporarily.\r\n//        if (pref.wafd_tb=='tb') document.getElementById('postform_label_comment').addEventListener('mouseout', on_change_workaround_for_dollchan, false);\r\n//        else site.components.postform_submit.addEventListener('mouseenter', on_change_workaround_for_dollchan, false);\r\n//      } else {\r\n////        document.getElementById('postform_row_files').style.display = 'none';\r\n//        if (pref.wafd_tb=='tb') document.getElementById('postform_label_comment').removeEventListener('mouseout', on_change_workaround_for_dollchan, false);\r\n//        else site.components.postform_submit.removeEventListener('mouseenter', on_change_workaround_for_dollchan, false);\r\n//      }\r\n//    }\r\n//    if (pref.workaround_for_dollchan == true) on_change_workaround_for_dollchan(); // initial\r\n//    function on_change_workaround_for_dollchan(){\r\n//      if (pn10_2!=null) pref_func.apply_prep(pn10_2,true);\r\n//      wafd.on_change_workaround_for_dollchan(true);\r\n//    }\r\n//    if (pref.workaround_for_dollchan == true) wafd.on_change_workaround_for_dollchan(false); // initial\r\n\r\n//    function on_change_workaround_for_dollchan_2(){\r\n//      var inputs = document.getElementsByTagName('input');\r\n//      var files = [];\r\n//      for (var i=0;i<inputs.length;i++) if (inputs[i].type=='file') files.push(inputs[i]);\r\n//      var grand_parent = document.getElementById('postform_row_files');\r\n//      var parent;\r\n//      for (var i=0;i<grand_parent.childNodes.length;i++) if (grand_parent.childNodes[i].align=='left') parent = grand_parent.childNodes[i];\r\n////      for (var i=0;i<4;i++) for (var j=0;j<4;j++) if (files[i].name==('file_'+j)) parent.childNodes[i].appendChild(files[i]);\r\n//      for (var i=0;i<files.length;i++) {\r\n//        var no = parseInt(files[i].name.replace(/file_/,\"\"));\r\n//        parent.childNodes[no].appendChild(files[i]);\r\n////        parent.childNodes[no].style.display = '';\r\n////        files[i].addEventListener('change', on_change_workaround_for_dollchan_3, false);\r\n//        var evt = document.createEvent('UIEvents');\r\n//        evt.initUIEvent('change', false, true, window, 1);\r\n//        files[i].dispatchEvent(evt);\r\n//      }\r\n//\r\n////      var images = images = document.getElementsByClassName('de-file-img');\r\n////      var thumbnails = [];\r\n////      for (var i=0;i<images.length;i++) if (images[i].tagName=='IMG') thumbnails.push(images[i]);\r\n//      var thumbnails_parent = document.getElementById('postform_label_comment');\r\n//      var show_thumbnails = true;\r\n//      for (var i=0;i<files.length;i++) {\r\n////        if (files[i].value=='' && thumbnails[i]!=undefined) thumbnails[i].parentNode.removeChild(thumbnails[i]);\r\n//        if (files[i].value=='') {\r\n//          var thumbnail = thumbnails_parent.getElementsByTagName('img')[0];\r\n//          if (thumbnail!=undefined) thumbnail.parentNode.removeChild(thumbnail);          \r\n//        }\r\n//        if (files[i].value!='' || show_thumbnails) {\r\n//          thumbnails_parent.childNodes[i].style.display = '';\r\n//          if (files[i].value=='') show_thumbnails = false;\r\n//        } else thumbnails_parent.childNodes[i].style.display = 'none';\r\n////        console.log(i + ': '+ files[i].value);\r\n//      }\r\n//    }\r\n////    function on_change_workaround_for_dollchan_3(){\r\n////      console.log('change');\r\n////    }\r\n\r\n//    var pn11 = cnst.make_iframe('redirect_target');\r\n//    pn11.onload = function(){if (pn11.location && pn11.location.href!='about:blank') pn11.location.replace('about:blank');}; // clear always.\r\n//////    var pn11 = div_init(11,'100px','100px','div'); // working code.\r\n//////    pn11.style.display = 'none';\r\n////    var pn11 = cnst.init('left:100px:bottom:100px:display:none:Show');\r\n////    pn11.id = 'pn11_debug';\r\n////    pn11.addEventListener('click', function(){on_load('parent_click');}, false);\r\n////    // delete contents for preventing from getting new posts by auto-updater.\r\n//////    function pn11_init(){ // works on Chrome, but causes infinite loop on FF.\r\n////      pn11.innerHTML = '<iframe name=\"redirect_target\" id=\"redirect_target\"></iframe>';\r\n////////      document.getElementsByName('redirect_target')[0].setAttribute('onload','alert(\"AAA\");return false;'); // work\r\n////////      document.getElementsByName('redirect_target')[0].setAttribute('onload','on_load();'); // fail;\r\n////////      document.getElementsByName('redirect_target')[0].onload  = function(){on_load('child_load')}; // work\r\n////////      document.getElementsByName('redirect_target')[0].onclick = function(){on_load('child_click')}; // for debug.\r\n////      pn11.childNodes[0].onload  = function(){on_load('child_load')}; // work\r\n////      pn11.childNodes[0].onclick = function(){on_load('child_click')}; // for debug.\r\n//////    }\r\n//////    pn11_init();\r\n////    function on_load(from_where){\r\n////      console.log('load: '+from_where);\r\n////      site.components.postform_submit.disabled = false;\r\n//////      top.redirect_target.document\r\n//////      if (posted) for (var i=0;i<submits.length;i++) forms[i].target = targets[i];\r\n//////      posted = false;\r\n//////      if (pn11.style.display=='none') pn11_init();\r\n//////      if (pn11.style.display=='none') frames['redirect_target'].location.replace('about:blank');\r\n////      if (pn11.style.display=='none') if (frames['redirect_target'].location.href!='about:blank') frames['redirect_target'].location.replace('about:blank');\r\n////    }\r\n//////    var pn11_on = false;\r\n////    function debug(){\r\n//////      if (!pn11_on) site.root_body.appendChild(pn11);\r\n//////      else site.root_body.removeChild(pn11); // can't prevent redirection.\r\n////      if (pn11.style.display=='none') pn11.style.display = '';\r\n////      else {\r\n////        pn11.style.display = 'none';\r\n//////      pn11_on = !pn11_on;\r\n//////      frames['redirect_target'].document.open();\r\n//////      frames['redirect_target'].document.write('deleted');\r\n//////      frames['redirect_target'].document.close();  // delete contents for preventing from getting new posts by auto-updater.\r\n//////        pn11_init();\r\n////        if (frames['redirect_target'].location.href!='about:blank') frames['redirect_target'].location.replace('about:blank');\r\n////      }\r\n////    }\r\n////    \r\n//////// working code\r\n//////    var pn11 = div_init(11,'100px','100px','div');\r\n//////    pn11.id = 'pn11_debug';\r\n//////    pn11.innerHTML = '<iframe name=\"redirect_target\" id=\"redirect_target\"></iframe>'\r\n//////    pn11.addEventListener('click', function(){on_load('parent_click');}, false);\r\n////////    document.getElementsByName('redirect_target')[0].setAttribute('onload','alert(\"AAA\");return false;'); // work\r\n////////    document.getElementsByName('redirect_target')[0].setAttribute('onload','on_load();'); // fail;\r\n//////    document.getElementsByName('redirect_target')[0].onload  = function(){on_load('child_load')};\r\n//////    document.getElementsByName('redirect_target')[0].onclick = function(){on_load('child_click')}; // for debug.\r\n//////    var forms = document.getElementsByTagName('form');\r\n//////    for (var i=0;i<forms.length;i++) {\r\n//////      if (forms[i].method=='post') forms[i].target = 'redirect_target'; // post, delete, report\r\n//////    }\r\n////////    window.addEventListener('load', on_load, false);\r\n//////    pn11.addEventListener('load', on_load, false);\r\n////////    pn11.redirect_target.addEventListener('load', on_load, false);\r\n//////    function on_load(from_where){\r\n//////      console.log('load: '+from_where);\r\n//////      site.components.postform_submit.disabled = false;\r\n////////      top.redirect_target.document\r\n//////    }\r\n    return {\r\n      debug: function(){debug();}\r\n    }\r\n//  })();\r\n  };\r\n\r\n\r\n  var pn_debug = 0;\r\n//  var pn_debug_button = div_init(-1,'200px','30px','button','debug');\r\n//  var pn_debug_button = cnst.init('left:200px:bottom:30px:button:debug:Show');\r\n//  var pn_debug_out    = div_init(2,'200px','50px','txt','debug_out');\r\n//  var pn_debug_out    = cnst.init('left:200px:bottom:50px:txt:debug_out');\r\n  function make_debug_obj(pn_debug_button){\r\n    pn_debug_button.addEventListener('click', debug, false);\r\n    function debug(e){\r\n      console.log('debug');\r\n      if (site.components.postform_submit!=null) site.components.postform_submit.disabled = false;\r\n//      pn_debug_out.textContent += 'debug';\r\n      if (post_form_obj) post_form_obj.debug();\r\n//      worker.port.postMessage(\"Scott\");\r\n//      worker.port.postMessage(JSON.stringify(['SET','test2','Scott']));\r\n//      worker.port.postMessage(JSON.stringify(['GET','test2']));\r\n//      var str = timer_obj.timer().timer().req.responseText;\r\n//      console.log(str);\r\n//      worker.port.postMessage(JSON.stringify(['ECHO','ON']));\r\n//      brwsr.sw_cache.setItem(site.nickname+site.board+'0',JSON.stringify([cnst.get_time(), str]));\r\n\r\n    }\r\n  }\r\n\r\n  // can't use sw_cache in 8chan because of 'Content Security Policy' header\r\n  brwsr.sw_cache = (brwsr.sw_cache && window.SharedWorker && (pref.info_server || pref.info_client))? (function(){\r\n// working code.\r\n//    script = 'self.onmessage = function(e){self.postMessage(e.data);};'\r\n//    var blob = new Blob([script], {type: 'text/javascript'});\r\n//    var blobURL = URL.createObjectURL(blob);\r\n//    var echoWorker = new unsafeWindow.Worker(blobURL);\r\n//    URL.revokeObjectURL(blobURL);\r\n//    echoWorker.onmessage = function (oEvent) {\r\n//      console.log(\"Worker said : \" + oEvent.data);\r\n//    };\r\n//    echoWorker.postMessage(\"ali\");\r\n\r\n// http://www.sitepoint.com/javascript-shared-web-workers-html5/\r\n    if (!localStorage) return null;\r\n    var worker = null;\r\n    var sw_alive = false;\r\n    var key_ls = pref.script_prefix+'.bs'; // backing store\r\n    var url = localStorage[key_ls]; // should use cookie instead of localStorage.\r\n    if (url) {\r\n      if (!prep_sw(url)) prep_sw();\r\n    } else prep_sw();\r\n    function prep_sw(blobURL) {\r\n      if (!blobURL) {\r\n        var script = '\\\r\n          var ports = [];\\\r\n          var store = {};\\\r\n          var connections = 0;\\\r\n          self.addEventListener(\"connect\", function(e){\\\r\n            var port = e.ports[0];\\\r\n            var no = connections++;\\\r\n            var func = function(e){msg_parser(e,port,no)};\\\r\n            port.addEventListener(\"message\", func, false);\\\r\n            port.start();\\\r\n            port.postMessage(JSON.stringify([\"INFO\",\"Connected: #\" + no]));\\\r\n            ports.push({port:port, func:func, echo:true, subscribe:false});\\\r\n          }, false);\\\r\n          function msg_parser(e,port,no){\\\r\n            if (ports[no].echo) port.postMessage(e.data);\\\r\n            var fields = JSON.parse(e.data);\\\r\n            if (fields[0]==\"ECHO\") ports[no].echo = fields[1];\\\r\n            else if (fields[0]==\"GET\") port.postMessage(JSON.stringify([\"ACK\",fields[1],store[fields[1]]]));\\\r\n            else if (fields[0]==\"CLOSE\") {\\\r\n              port.removeEventListener(\"message\", ports[no].func, false);\\\r\n              ports[no] = null;\\\r\n            }\\\r\n/*            else if (fields[0]==\"SET\") store[fields[1]]=fields[2];*/\\\r\n            else if (fields[0]==\"SET\") {\\\r\n              var old_val = store[fields[1]];\\\r\n              if (old_val!=fields[2]) {\\\r\n                var msg = JSON.stringify([\"EVENT\",fields[1]]);\\\r\n                for (var i=0;i<ports.length;i++)\\\r\n                  if (i==no) store[fields[1]]=fields[2];\\\r\n                  else if (ports[i] && ports[i].subscribe) ports[i].port.postMessage(msg);\\\r\n              }\\\r\n            } else if (fields[0]==\"STAT\") stat_post(port,\"STAT_ACK\",fields[1]);'+\r\n           'else if (fields[0]==\"SUBSCRIBE\") ports[no].subscribe = fields[1];'+\r\n         '}'+\r\n         'var gc = setInterval(gc_func, 600000);'+\r\n         'function gc_func(){'+\r\n           'var date = Date.now() - 3600000;'+\r\n           'for (var i in store) if (store[i].date < date) delete store[i];'+\r\n//           'stat_post(ports[0].port,\"STAT_REP\",false);'+\r\n//           'for (var i in store) ports[0].port.postMessage(JSON.stringify([i,store[i].date,store[i].date-date]));'+\r\n         '}'+\r\n         'function stat_post(port,str,dump){'+\r\n           'var live = 0;'+\r\n           'for (var i=0;i<ports.length;i++) if (ports[i]) live++;'+\r\n//           'var count = 0;'+\r\n//           'for (var i in store) count++;'+\r\n//           'var msg = JSON.stringify([str,\"Connected: \"+live+\"/\"+connections+\", Stored: \"+count]);'+\r\n           'var msg = JSON.stringify([str,\"Connected: \"+live+\"/\"+connections+\", Stored: \"+Object.keys(store).length]);'+\r\n           'port.postMessage(msg);'+\r\n           'var count = 0;'+\r\n           'if (dump) for (var i in store) port.postMessage(JSON.stringify([\"DUMP_ACK\",(count++)+\": \"+i+\", \"+JSON.stringify(store[i])]));'+\r\n         '}\\\r\n        ';\r\n        var blob = new Blob([script], {type: 'text/javascript'});\r\n        blobURL = URL.createObjectURL(blob);\r\n        localStorage[key_ls] = blobURL;\r\n      }\r\n      try {\r\n        worker = new unsafeWindow.SharedWorker(blobURL); // FF throws exception when blobURL is invalid. But chorome doesn't throw.\r\n//        worker = new unsafeWindow.SharedWorker('blob:https%3A//krautchan.net/87996484-6a43-44c8-ab11-efe455fd2b2b');\r\n//        URL.revokeObjectURL(blobURL); // Chrome need several secondss to invoke. If you place this here, it doesn't work on chrome.\r\n        worker.port.addEventListener('message', sw_out, false);\r\n//        worker.port.addEventListener('message', sw_get, false);\r\n        worker.port.addEventListener('message', sw_tryget, false);\r\n        worker.port.start();\r\n//        worker.port.postMessage(\"Alyssa\");\r\n//        worker.port.postMessage(JSON.stringify(['ECHO','Alyssa']));\r\n//        worker.port.postMessage(JSON.stringify(['SET','test0','val_0']));\r\n//        worker.port.postMessage(JSON.stringify(['SET','test1','val_1']));\r\n//        worker.port.postMessage(JSON.stringify(['GET','test0']));\r\n//        worker.port.postMessage(JSON.stringify(['GET','test1']));\r\n//        console.log(url);\r\n        return true;\r\n      } catch(e) {\r\n//        console.log('catch error at making worker');\r\n//        prep_sw(undefined); // FF with 'Content Security Policy' header will make infinite loop.\r\n        return false;\r\n      }\r\n    }\r\n    function sw_out(e){\r\n//      alert('Worker said : ' + e.data);\r\n//      console.log('Worker said : ' + e.data);\r\n      console.log(new Date().toLocaleTimeString() + ', Worker said : ' + e.data.substr(0,120));\r\n      if (!sw_alive) {\r\n        worker.port.postMessage(JSON.stringify(['STAT']));\r\n//        worker.port.postMessage(JSON.stringify(['STAT',true]));\r\n        if (!pref.debug_mode['0']) worker.port.postMessage(JSON.stringify(['ECHO',false]));\r\n//        worker.port.postMessage(JSON.stringify(['ECHO',true]));\r\n//        worker.port.postMessage(JSON.stringify(['ECHO',false]));\r\n        window.addEventListener('beforeunload',\r\n          function(){\r\n            worker.port.postMessage(JSON.stringify(['CLOSE']));\r\n            worker.port.close();\r\n          }, false);\r\n      }\r\n      sw_alive = true;\r\n      if (!pref.debug_mode['0']) worker.port.removeEventListener('message', sw_out, false);\r\n    }\r\n    if (!brwsr.ff && worker) setTimeout(function(){\r\n//      console.log('alive = '+ sw_alive);\r\n      if (url!==null && !sw_alive) {\r\n        worker.port.removeEventListener('message', sw_out, false);\r\n        worker.port.close();\r\n        if (!prep_sw()) brwsr.sw_cache = null; // kill myself\r\n      }\r\n    },5000);\r\n//    var store = [];\r\n//    function sw_get(e){\r\n//      var fields = JSON.parse(e.data);\r\n//      if (fields[0]==\"ACK\") store[fields[1]]=fields[2];\r\n//    }\r\n    var callbacks = [];\r\n    var tryget_ids = [];\r\n    var fields = null; // static object for scan.\r\n    function sw_tryget(e){\r\n      fields = JSON.parse(e.data);\r\n      if (fields[0]==\"ACK\") {\r\n        var key = fields[1];\r\n        clearTimeout(tryget_ids[key]);\r\n        if (callbacks[key]) {\r\n          callbacks[key][0](key,fields[2],callbacks[key][1]); // callback with value.\r\n          delete callbacks[key];\r\n        }\r\n      } else if (fields[0]==\"EVENT\") {\r\n        if (pref.info_client && fields[1].search(info_raw)!=-1 && fields[1].substr(info_raw.length,1)=='p') {\r\n          var page_no = fields[1].substr(info_raw.length+1);\r\n          var timer = (timer_obj)? timer_obj.timer() : null;\r\n          if (timer!=null) {\r\n//            var value = JSON.parse(fields[2]);\r\n//            timer.page_check4(value[0], page_no, new DOMParser().parseFromString(value[1],'text/html'));\r\n            brwsr.sw_cache.trygetItem(fields[1],timer.page_check5);\r\n          }\r\n        }\r\n        if (pref.info_client && catalog_obj && catalog_obj.catalog_func()!=null && pref.catalog_snoop_refresh)\r\n          catalog_obj.catalog_func().catalog_insert(fields[1]);\r\n      }\r\n      fields = null;\r\n    }\r\n    function tryget_timeout(key){ // timeout is sequential always.\r\n      callbacks[key][0](key,null,callbacks[key][1]); // callback with null.\r\n      delete callbacks[key];\r\n    }\r\n    return (!worker)? null : {\r\n      setItem: function(key,value){worker.port.postMessage(JSON.stringify(['SET',key,value]));},\r\n//      getItem: function(key){\r\n//        worker.port.postMessage(JSON.stringify(['GET',key]));\r\n//        while (store[key]==undefined) sleep(0);\r\n//        var retval = store[key];\r\n//        delete store[key];\r\n//        return retval;\r\n//      },\r\n      trygetItem: function(key,callback,args){\r\n        callbacks[key] = [callback,args];\r\n        tryget_ids[key] = setTimeout(function(){tryget_timeout(key);},2000); // timeout 2sec\r\n        worker.port.postMessage(JSON.stringify(['GET',key]));\r\n      },\r\n      subscribe: function(sub){worker.port.postMessage(JSON.stringify(['SUBSCRIBE',sub]));},\r\n      addEventListener: function(){\r\n      }\r\n    }\r\n  })() : null;\r\n\r\n  (function(){\r\n    var key = 'CatChan_archive_'+window.name;\r\n    var func_invoke = (pref.catalog.embed_page && site.whereami==='page' && sessionStorage && sessionStorage[key])? function(){\r\n      catalog_obj.show_hide();\r\n      setTimeout(function(){\r\n        var data = JSON.parse(sessionStorage[key]);\r\n        if (sessionStorage[key+'M']) data[2] = function(){\r\n          send_message_emu = JSON.parse(sessionStorage[key+'M']);\r\n          receive_message_emu(window.name);\r\n          if (pref.archive.IDB.redirect_404_CSP) {\r\n            var str = document.head.innerHTML + document.body.innerHTML;\r\n            var blob = new Blob([str],{type:'text/html'});\r\n            var url = URL.createObjectURL(blob);\r\n            window.open(url,window.name+'B');\r\n          }\r\n        };\r\n        send_message_emu = [data];\r\n        receive_message_emu(window.name);\r\n      },100);\r\n    } : catalog_obj && catalog_obj.show_hide;\r\n    if (site.whereami==='404' && pref.archive.IDB.redirect_404) {\r\n      if (sessionStorage) setTimeout(function(){\r\n        var key_a = key+'A';\r\n        if (!sessionStorage[key_a]) {\r\n          var dbt = common_func.fullname2dbt(window.name);\r\n          sessionStorage[key_a] = JSON.stringify(['ARCHIVER',['SUB_INIT', {IDB:true, domain:dbt[0], board:dbt[1], no:dbt[2]}]]);\r\n          if (received_messages_404) sessionStorage[key_a+'M'] = JSON.stringify(received_messages_404); // this requires message pump(setTimeout)\r\n          var url = site2[site.nickname].make_url4([site.nickname, site.board, '0','page_html'])[0];\r\n          window.name = window.name+'A';\r\n//          setTimeout(function(){window.open(url,'_self');},5000); // for debug\r\n          window.open(url,'_self');\r\n        } else delete sessionStorage[key_a];\r\n      },5000);\r\n    } else if ((pref.catalog.embed && site.whereami==='catalog') || (pref.catalog.embed_page && site.whereami==='page') || (pref.thread.embed && site.whereami==='thread') || (pref.catalog.embed_archive && site.whereami==='archive')) { //patch\r\n      if (catalog_obj) {\r\n        if (site2[site.nickname].catalog_native_prep_wait_loop) site2[site.nickname].catalog_native_prep_wait_loop(site.whereami, func_invoke);\r\n        else if (pref.patch.delayed_invoke.use) setTimeout(func_invoke, pref.patch.delayed_invoke.sec*1000);\r\n        else func_invoke();\r\n      }\r\n    }\r\n    setTimeout(thread_reader_init,0); // invoke after catalog to reduce times of making site.myself\r\n    setTimeout(uip_tracker_init,0);\r\n  })();\r\n// console debug commands for SharedWorker.\r\n//\r\n// var url = localStorage['CatChan.backing_store'];\r\n// var worker = new window.SharedWorker(url);\r\n// worker.port.onmessage = function(e){console.log(e.data.substr(0.120));};\r\n// worker.port.start();\r\n// worker.port.postMessage(JSON.stringify(['STAT']));\r\n\r\n\r\n//  function test_sw_cache(){\r\n//    sw_cache.setItem('/int/','aaa');\r\n//    sw_cache.trygetItem('/int/',sw_dummy);\r\n//    function sw_dummy(key,val){\r\n//      console.log(key,val);\r\n//    }\r\n//  }\r\n//  setTimeout(test_sw_cache,10000);\r\n\r\n// OPTIONS FROM HERE\r\n  options.func0_prep = function(pn,tb, ppn){ // schedule poster.\r\n    var tb_0 = cnst.add_to_tb(tb,cnst.icons.button_settings());\r\n//    tb_0.childNodes[0].onchange = function(){cnst.show_hide(pn);};\r\n    pn.innerHTML = '<div style=\"float:left\"><input type=\"checkbox\">autobumper</div><div style=\"float:right\"><input type=\"button\" value=\"Schedule\"><select name=\"time_sel\"><option>at</option><option>later</option></select><input type=\"time\" name=\"time\" value=\"08:41\"></div><div style=\"float:right\"></div>';\r\n    pn.childNodes[1].childNodes[0].addEventListener('click', schedule_post, false);\r\n//// working code for relative time.\r\n////    var cd_id = null;\r\n////    var cd_id_m = null;\r\n////    var cd_id_30s = null;\r\n////    var bg_back     = pn.parentNode.style.background;\r\n//////    var bg_back_org = bg_back;\r\n////    var time_to_post;\r\n////    function schedule_post(){\r\n////      if (cd_id==null && cd_id_30s==null) {\r\n//////        pn.childNodes[1].childNodes[0].value = 'Cancel';\r\n////        var sel_id = pn.childNodes[1].childNodes[1].selectedIndex;\r\n////        var time_val = pn.childNodes[1].childNodes[2].value;\r\n////        \r\n////        time_to_post = parseInt(time_val.substr(0,2),10)*3600 + parseInt(time_val.substr(3,2),10)*60;\r\n////        if (sel_id==0) {\r\n////          var time_str = cnst.get_time();\r\n////          time_to_post -= parseInt(time_str.substr(0,2),10)*3600 + parseInt(time_str.substr(3,2),10)*60 + parseInt(time_str.substr(6,2),10);\r\n////        }\r\n////        if (time_to_post<=0) time_to_post += 86400;\r\n////        cd_id = setTimeout(countdown_post_30s,(time_to_post-30)*1000); // NOT ACCURATE. slip 70s for 5h.\r\n////        countdown_m(time_to_post%60);\r\n////        set_background_and_button_value();\r\n//////        pn.parentNode.style.background = '#f5ecf9';\r\n////      } else {\r\n////        if (cd_id    !=null) {clearTimeout(cd_id); cd_id = null;}\r\n////        if (cd_id_m  !=null) {clearTimeout(cd_id_m);cd_id_m = null;}\r\n////        if (cd_id_30s!=null) cd_id_30s = cd_id_30s();\r\n//////        pn.parentNode.style.background = bg_back;\r\n////        cd_txt.innerHTML = '';\r\n//////        pn.childNodes[1].childNodes[0].value = 'Schedule';\r\n////        set_background_and_button_value();\r\n////      }\r\n////    }\r\n////    var cd_txt = pn.childNodes[2];\r\n////    function countdown_m(dec){\r\n////      var str = '';\r\n////      if (time_to_post%60!=0) str = time_to_post%60 + 's';\r\n////      if (time_to_post>=60)   str = Math.round((time_to_post%3600)/60) + 'm' + str;\r\n////      if (time_to_post>=3600) str = Math.round(time_to_post/3600) + 'h' + str;\r\n////      cd_txt.innerHTML = str;\r\n////      time_to_post -= dec;\r\n////      cd_id_m = setTimeout(function(){countdown_m(60);},dec*1000);\r\n////    }\r\n////    function countdown_post_30s(){\r\n////      cd_id_30s = countdown_post(30);\r\n////      clearInterval(cd_id_m);\r\n////      cd_id = null;\r\n////      cd_id_m = null;\r\n////    }\r\n\r\n    var cd_id = null;\r\n    var cd_id_s = null;\r\n    var bg_back     = pn.parentNode.style.background;\r\n    var time_at_post;\r\n    function schedule_post(){\r\n      if (cd_id==null && cd_id_s==null) {\r\n        var sel_id = pn.childNodes[1].childNodes[1].selectedIndex;\r\n        var time_val = pn.childNodes[1].childNodes[2].value;\r\n        var hour = parseInt(time_val.substr(0,time_val.indexOf(':')),10);\r\n        var min  = parseInt(time_val.substr(time_val.indexOf(':')+1),10);\r\n        var time_now = Date.now();\r\n        if (sel_id==0) {\r\n          time_at_post = new Date().setHours(hour,min,0);\r\n          if (time_at_post<time_now) time_at_post+=86400*1000;\r\n        } else time_at_post = time_now + (hour*3600+min*60)*1000;\r\n        countdown_m();\r\n      } else {\r\n        if (cd_id  !=null) {clearTimeout(cd_id);cd_id=null;}\r\n        if (cd_id_s!=null) {clearInterval(cd_id_s);cd_id_s=null;}\r\n        cd_txt.innerHTML = '';\r\n      }\r\n      set_background_and_button_value(false);\r\n    }\r\n    var cd_txt = pn.childNodes[2];\r\n    function countdown_m(){\r\n      var time_now = Date.now();\r\n      var time_till_post = time_at_post-time_now;\r\n      if (time_till_post%60000>=1000 && time_till_post>60000) cd_id = setTimeout(countdown_m,time_till_post%60000);\r\n      else if (time_till_post<90000) cd_id = setTimeout(function(){cd_id_s=countdown_post(30);cd_id=null;},time_till_post-30*1000);\r\n      else cd_id = setTimeout(countdown_m,(time_till_post+30000)%60000+30000);\r\n      var str = '';\r\n//      if (time_till_post %60000) str = (time_till_post%60000)/1000 + 's'; // debug\r\n      if (time_till_post %60000>=1000 && time_till_post%60000<=59499) str = Math.round((time_till_post%60000)/1000) + 's';\r\n      if (time_till_post>=59500)   str = Math.floor(((time_till_post+500)%3600000)/60000) + 'm' + str;\r\n      if (time_till_post>=3599500) str = Math.floor( (time_till_post+500)/3600000) + 'h' + str;\r\n      cd_txt.innerHTML = str;\r\n    }\r\n\r\n    function countdown_post(sec){\r\n      cd_txt.innerHTML = sec + 's';\r\n      set_background_and_button_value(true);\r\n      return setInterval(countdown_s, 1000);\r\n\r\n      function countdown_s(){\r\n        sec -= 1;\r\n        cd_txt.innerHTML = sec + 's';\r\n        if (sec==0) {\r\n//          alert('post at '+ Date());\r\n          var evt = document.createEvent('MouseEvents');\r\n          evt.initUIEvent('click', false, true, window, 1);\r\n          site.components.postform_submit.dispatchEvent(evt);\r\n          schedule_post(); // cancel procedure\r\n        }\r\n      }\r\n    }\r\n\r\n    var autobumper = pn.childNodes[0].childNodes[0];\r\n    autobumper.onchange = function(){set_background_and_button_value(false);};\r\n    function set_background_and_button_value(cd_s){\r\n      ppn.style.background = (cd_s)? '#ffc0cb' : ((cd_id!=null)? '#f5ecf9' : ((autobumper.checked)? '#e5f4f9' : bg_back));\r\n      var value = (cd_s || cd_id!=null)? 'Cancel' : 'Schedule';\r\n      pn.childNodes[1].childNodes[0].value = value;\r\n    }\r\n    var timer_deadtime = null;\r\n    options.func0_exe = function(page){\r\n      var posts_itt = document.getElementsByClassName('postreply').length - document.getElementsByClassName('de-post-deleted').length;\r\n      if (parseFloat(page)>=site.max_page-1 && autobumper.checked && timer_deadtime==null && posts_itt < site.autosage) {\r\n//      if (parseFloat(page)>=1 && autobumper.checked && timer_deadtime==null) { // for debug }\r\n        cd_id_s = countdown_post(30);\r\n        timer_deadtime = setTimeout(function(){timer_deadtime=null;},3600*1000); // 1h\r\n      }\r\n    }\r\n  }\r\n// NEXT TIME PASSWORD fDEPJ9Uo\r\n// OPTIONS TO HERE\r\n\r\n})();\r\n"]}